             PGM        PARM(&PFILE &PFLDR &PFEIL)

/* 08082019   bkv Hentet rettelser fra IMM og B24                    */

/* Initiering av parametre.                                          */

             DCL        VAR(&PFILE)  TYPE(*CHAR) LEN(12)
             DCL        VAR(&PFLDR)  TYPE(*CHAR) LEN(20)
             DCL        VAR(&PFEIL)  TYPE(*CHAR) LEN(1)

/* Parametre som brukes for å hente data fra IFS området             */

             dcl        var(&fradoc) type(*char) len(30)
             dcl        var(&framap) type(*char) len(30)
             dcl        var(&tillib) type(*char) len(10)
             dcl        var(&tilfil) type(*char) len(10)
             dcl        var(&tilmbr) type(*char) len(10)
             dcl        var(&fgr)    type(*char) len(3)
             dcl        var(&sts)    type(*char) len(8)

/* Initierer feil-flagg                                              */

             CHGVAR     VAR(&PFEIL) VALUE('0')

/* Tømmer rapportør vareregister                                     */

             CLRPFM     FILE(JRVAPF)
             CHGPF      FILE(JRVAPF) SIZE(*NOMAX)

/* Kopierer rapportør-fil til arbeidsfil                             */

             IF         COND(&PFLDR *NE ' ') THEN(DO)
/*           CPYFRMPCD  FROMFLR(&PFLDR) TOFILE(JRVAPF) +       */
/*                        FROMDOC(&PFILE) MBROPT(*ADD)         */
/*           MONMSG     MSGID(CPF8A00) EXEC(GOTO CMDLBL(FEIL)) */
/*           MONMSG     MSGID(IWS1611) EXEC(GOTO CMDLBL(FEIL)) */
             rtvdtaara  dtaara(*lda (931 03)) rtnvar(&fgr)
/*           chgvar     var(&framap)  value('/ASP/' *cat +     */
/*                                           &fgr   *cat +     */
/*                                           '/' *cat &pfldr)  */

             if         cond(%sst(&pfldr 1 1) *eq '/') then(do)
                if         cond(%sst(&pfldr 2 3) *ne &fgr) then(do)
                   chgvar     var(&pfldr)  value(&fgr *cat &pfldr)
                enddo
             enddo
             else       do
                if         cond(%sst(&pfldr 1 3) *ne &fgr) then(do)
                   chgvar     var(&pfldr)  value(&fgr *cat '/' *cat &pfldr)
                enddo
             enddo


             chgvar     var(&framap)  value('/ASP/' *cat &pfldr)

             chgvar     var(&fradoc)  value(&PFILE)
             chgvar     var(&tillib)  value('*LIBL')
             chgvar     var(&tilfil)  value('JRVAPF')
             chgvar     var(&tilmbr)  value('JRVAPF')
             chgvar     var(&sts)     value('A')  /* 'A' dersom *Add */
             call       pgm(aspfrstmf) parm(+
                            &fradoc +
                            &framap +
                            &tillib +
                            &tilfil +
                            &tilmbr +
                            &sts)
             if         cond(&sts *ne ' ') then(goto cmdlbl(feil))
             ENDDO
             ELSE       CMD(DO)
             CPYF       FROMFILE(&PFILE) TOFILE(JRVAPF) MBROPT(*ADD) +
                          FMTOPT(*NOCHK)
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(FEIL))
             ENDDO

             GOTO       CMDLBL(END)

 FEIL:       CHGVAR     VAR(&PFEIL) VALUE('1')

 END:        ENDPGM
