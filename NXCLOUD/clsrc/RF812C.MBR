             PGM        PARM(&LIST &BMID)

/* Initiering av parametre.                                          */

             DCL        VAR(&LIST) TYPE(*CHAR) LEN(128)
             DCL        VAR(&WSID) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BMID) TYPE(*CHAR) LEN(15)
             DCL        VAR(&STAT) TYPE(*CHAR) LEN(1)
             DCL        VAR(&MLD1) TYPE(*CHAR) LEN(40)
             DCL        VAR(&MLD2) TYPE(*CHAR) LEN(40)
             DCL        VAR(&WALI) TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&WAPO) TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&POST) TYPE(*CHAR)  LEN(1)

/* Tømmer fil fra forrige overføring                                 */

             CLRPFM     FILE(GEMONBPF)
/*           MONMSG     MSGID(CPF2105)                               */

/* Utlegging av kortfile                                             */

             CHGVAR     VAR(&WALI) VALUE(6)
             CHGVAR     VAR(&WAPO) VALUE(30)
             CHGVAR     VAR(&MLD1) VALUE('Generering av korttranser')
             CHGVAR     VAR(&MLD2) VALUE('og overføring pågår.     ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)

/* Kaller program                                                    */
             CHGVAR     VAR(&POST) VALUE('0')

             CALL       PGM(RF812R) PARM(&LIST &POST)

/* Avslutter hvis vi ikke har funnet noen poster                    */
             IF         COND(&POST *EQ '0') THEN(GOTO CMDLBL(END))

/* Starter overføring av file til Logiq og GE Capital               */
             CALL       PGM(RF828C) PARM(&BMID &STAT)

/* Sender melding                                                    */

             RTVDTAARA  DTAARA(*LDA (901 10)) RTNVAR(&WSID)
             SNDBRKMSG  MSG('BM Kort: Kortfil er ferdig generert og overført') +
                          TOMSGQ(&WSID)

 END:        ENDPGM
