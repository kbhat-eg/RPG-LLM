/*                                                                   */
/*-------------------------------------------------------------------*/
/* Program for å slette indexer                                        */
/*                                                                   */
/* angi filgrupppe og/eller lvrfilgruppe og/eller miljø              */
/*      og/eller tabell og/eller hva                                 */
/*                                                                   */
/* for mer info, se:                                                 */
/*    https://confluence.egretail.no/display/AS400/DBA+NX+indekser   */
/*                                                                   */
/* eks: CALL ASPGPLU630/IDXDLT PARM('630' 'ADBLVR630' 'A40')         */
/* eks: CALL ASPGPLU630/IDXDLT PARM('630' 'ADBLVR630' 'A40' 'VVARPF')*/
/* eks: CALL ASPGPLU630/IDXDLT PARM('630' 'ADBLVR630' 'A40' '*ALL')  */
/*                                                                   */
/*   hva:                                                            */
/*        (blank):  samme som 0                                      */
/*        0:  gjør 1 + 3                                             */
/*        1:  opprett SP                                             */
/*        2:  slett SP                                               */
/*        3:  kjør SP                                                */

             PGM        parm(&dlib &LVRB_P &ENVB_P &TBLE_P &VER_P)

 /* Parametre                                                         */
             DCL        VAR(&dlib)    TYPE(*CHAR) LEN(10)
             DCL        VAR(&LVRB_P)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&ENVB_P)  TYPE(*CHAR) LEN(3)
             DCL        VAR(&TBLE_P)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&VER_P)   TYPE(*CHAR)  LEN(3)

             DCL        VAR(&VER)       TYPE(*DEC) LEN(3 0)

 /* Sjekk Parametre                                                    */
             IF         COND(&TBLE_P *EQ ' ') THEN(DO)
                CHGVAR     VAR(&TBLE_P) VALUE('*ALL')
             ENDDO

             IF         COND(&VER_P *EQ ' ') THEN(DO)
                RTVDTAARA  DTAARA(*LDA (1003 3)) RTNVAR(&ENVB_P)
                call       pgm(AR700R) parm(&ENVB_P &VER)
                CHGVAR     VAR(&VER_P) VALUE(%CHAR(&VER))
             ENDDO

             RUNSQL     SQL('CALL ADB.SP_NEXSTEP_DROP_IX_' *CAT &VER_P +
                          *CAT '(''' *cat &DlIB *bcat ''',''' *cat &TBLE_P +
                          *bcat ''')') COMMIT(*NONE) NAMING(*SYS)
             MONMSG     MSGID(SQL9010)
 /* 2DP  */
             RUNSQL     SQL('CALL ADB.SP_NEXSTEP_DROP_2DP_IX_' *CAT &VER_P +
                          *CAT '(''' *cat &DlIB *bcat ''',''' *cat &TBLE_P +
                          *bcat ''')') COMMIT(*NONE) NAMING(*SYS)
             MONMSG     MSGID(SQL9010)

 END:        ENDPGM


