
/*           Innlensing av rabattMatrise          Optimera           */

             pgm

      dcl        var(&lib)  type(*char) len(10)
      dcl        var(&ban)  type(*char) len(60)
      dcl        var(&utf)  type(*char) len(60)
      dcl        var(&fgr)       type(*char) len(3)
      dcl        var(&fix)       type(*char) len(3)
      dcl        var(&fir)       type(*dec)  len(3 0) value(0)
      dcl        var(&lag)       type(*dec)  len(3 0) value(0)

      DCL        VAR(&CO402_KEY) TYPE(*CHAR) LEN(50)
      DCL        VAR(&CO402_V1)  TYPE(*CHAR) LEN(1)
      DCL        VAR(&CO402_V2)  TYPE(*CHAR) LEN(2048)
      dcl        var(&m1)        type(*char) len(50)
      dcl        var(&m2)        type(*char) len(50)
      dcl        var(&sv)        type(*char) len(1)
      dcl        var(&f12)       type(*char) len(1)
      dcl        var(&usr)       type(*char) len(10)
      dcl        var(&t5)        type(*char) len(5)
      dcl        var(&t6)        type(*char) len(6)
      dcl        var(&t7)        type(*char) len(7)
      dcl        var(&t8)        type(*char) len(8)
      dcl        var(&t9)        type(*char) len(9)
      dcl        var(&t10)       type(*char) len(10)

      rtvdtaara  dtaara(*lda (931 3))  rtnvar(&fgr)
      rtvdtaara  dtaara(*lda (944 3))  rtnvar(&fix)
      rtvdtaara  dtaara(*lda (911 10)) rtnvar(&usr)
      chgvar     var(&fir)   value(&fix)
/*    Sjekk om filgruppa er satt opp for innlesning fra excel       */

      CHGVAR     VAR(&CO402_KEY) VALUE('OPPDATERE_FRAB_FRA_EXCEL')
      CALL       PGM(CO402R) PARM(&FGR &FIR &LAG &CO402_KEY +
                    &CO402_V1 &CO402_V2)

      IF         COND(&CO402_V1 *ne '1') THEN(do)
        chgvar     var(&m1)  value('Din filgruppe er ikke satt opp med denne +
                                   funksjonen')
        chgvar     var(&m2)  value('Kontakt ansvarlig dersom du vil ha tilgang')
        call       pgm(aa007r) parm(&m1 &m2 &sv &f12)
        goto       cmdlbl(end)
      enddo

/*  Sjekk om brukeren har tilgang til rutina              */
      if cond(%scan(' ' &usr) *eq 6) then(do)
        chgvar  var(&t5)   value(%sst(&usr 1 5))
        if cond(%scan(&t6 &co402_v2) *ne 0) then(goto cmdlbl(usr_ok))
      enddo
      if cond(%scan(' ' &usr) *eq 7) then(do)
        chgvar  var(&t6)   value(%sst(&usr 1 6))
        if cond(%scan(&t6 &co402_v2) *ne 0) then(goto cmdlbl(usr_ok))
      enddo
      if cond(%scan(' ' &usr) *eq 8) then(do)
        chgvar  var(&t7)   value(%sst(&usr 1 7))
        if cond(%scan(&t7 &co402_v2) *ne 0) then(goto cmdlbl(usr_ok))
      enddo
      if cond(%scan(' ' &usr) *eq 9) then(do)
        chgvar  var(&t8)   value(%sst(&usr 1 8))
        if cond(%scan(&t8 &co402_v2) *ne 0) then(goto cmdlbl(usr_ok))
      enddo
      if cond(%scan(' ' &usr) *eq 10) then(do)
        chgvar  var(&t9)   value(%sst(&usr 1 9))
        if cond(%scan(&t9 &co402_v2) *ne 0) then(goto cmdlbl(usr_ok))
      enddo
      if cond(%scan(' ' &usr) *eq 0) then(do)
        chgvar  var(&t10)   value(%sst(&usr 1 10))
        if cond(%scan(&t10 &co402_v2) *ne 0) then(goto cmdlbl(usr_ok))
      enddo
        chgvar     var(&m1)  value('Din bruker har ikke tilgang til denne +
                                   funksjonen')
        chgvar     var(&m2)  value('Kontakt ansvarlig dersom du vil ha tilgang')
        call       pgm(aa007r) parm(&m1 &m2 &sv &f12)
        goto       cmdlbl(end)

usr_ok:

/*    chgvar     var(&alt)    value(' ')                     */
/*    chgvar     var(&rabkat) value(' ')                     */
start:
/*    sndrcvf    rcdfmt(M1WIN)                               */
/*    chgvar     var(&in31)    value('0')                    */
/*    chgvar     var(&in32)    value('0')                    */
/*  F3                                                               */
/*    if         cond(&In03) then(do)                        */
/*      goto     cmdlbl(end)                                 */
/*    enddo                                                  */

/*    if         cond(&alt *ne ' ' *and +                    */
/*                    &alt *ne 'J') then(do)                 */
/*      chgvar   var(&in31)  value('1')                      */
/*      goto     cmdlbl(usr_ok)                              */
/*    enddo                                                  */

/*    if         cond(&rabkat *ne ' ' *and +              */
/*                    &rabkat *ne 'J') then(do)           */
/*      chgvar   var(&in32)  value('1')                   */
/*      goto     cmdlbl(usr_ok)                           */
/*    enddo                                               */

/*    if         cond(&alt *ne ' ' *and +                 */
/*                    &rabkat *ne ' ') then(do)           */
/*      chgvar   var(&in31)  value('1')                   */
/*      goto     cmdlbl(usr_ok)                           */
/*    enddo                                               */

/*    chgdtaara  dtaara(*lda (11 1)) value(&alt)          */
/*    chgdtaara  dtaara(*lda (12 1)) value(&rabkat)       */

      rtvdtaara  dtaara(*lda (934 10)) rtnvar(&lib)

      clrpfm     file(*libl/xlfrab)
      monmsg     msgid(cpf4101) exec(do)
        crtpf    file(clfrab) rcdlen(512) text('Innlesning av +
                          rabatt-matrise fra excel')
      enddo

      call       pgm(nyrabmxu)

      call       pgm(uppdifs) parm('XLFRAB    ' &LIB +
                                          'XLFRAB    ' &ban &utf)

end:         endpgm
