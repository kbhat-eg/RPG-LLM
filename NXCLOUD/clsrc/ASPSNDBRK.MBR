             PGM        parm(&msg &wb1 &wb2 &wb3 &wb4 &wb5 &wb6 +
                                  &wb7 &wb8 &wb9 &wb10 &svar)
             DCL        VAR(&WMBR)     TYPE(*CHAR) LEN(10)
             DCL        VAR(&JOB)      TYPE(*CHAR) LEN(10)
             DCL        VAR(&USR)      TYPE(*CHAR) LEN(10)
             DCL        VAR(&NBR)      TYPE(*CHAR) LEN(6)
             DCL        VAR(&MSG)      TYPE(*CHAR) LEN(512)
             DCL        VAR(&WS)     TYPE(*CHAR)   LEN(10)
             DCL        VAR(&US)     TYPE(*CHAR)   LEN(10)
             DCL        VAR(&WHO)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&WH1)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&WH2)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&WH3)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&WH4)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&WH5)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&WH6)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&WH7)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&WH8)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&WH9)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&WH10)   TYPE(*CHAR)   LEN(10)
             DCL        VAR(&Wb1)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&Wb2)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&Wb3)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&Wb4)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&Wb5)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&Wb6)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&Wb7)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&Wb8)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&Wb9)    TYPE(*CHAR)   LEN(10)
             DCL        VAR(&Wb10)   TYPE(*CHAR)   LEN(10)
             DCL        VAR(&type)   TYPE(*CHAR)   LEN(5)
             DCL        VAR(&svar)   TYPE(*CHAR)   LEN(1)
             DCL        VAR(&tx)     TYPE(*CHAR)   LEN(1)
             DCL        VAR(&B)      TYPE(*CHAR)   LEN(1)
             DCL        VAR(&T1)     TYPE(*CHAR)   LEN(1)
             DCL        VAR(&T2)     TYPE(*CHAR)   LEN(1)
             DCL        VAR(&T3)     TYPE(*CHAR)   LEN(1)
             DCL        VAR(&T4)     TYPE(*CHAR)   LEN(1)
             DCL        VAR(&T5)     TYPE(*CHAR)   LEN(1)
             DCL        VAR(&T6)     TYPE(*CHAR)   LEN(1)
             DCL        VAR(&WALI)   TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&WAPO)   TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&MLD1)   TYPE(*CHAR) LEN(40)
             DCL        VAR(&MLD2)   TYPE(*CHAR) LEN(40)
/*                                                                   */
             DCLF       FILE(IWBRK)
/*                                                                   */
             RTVJOBA    JOB(&JOB) USER(&USR) NBR(&NBR)
/*                                                                   */
             chgvar     var(&type)  value('*INFO')
             if         cond(&svar *eq 'J') then(do)
               chgvar   var(&type)  value('*INQ')
             enddo
/*                                                                   */
/*Danner arbeidsfil for spool                                        */
/*                                                                   */
CRTBRK:      CLRPFM     FILE(*LIBL/IWBRK) MBR(*FIRST)
             MONMSG     MSGID(CPF3142) EXEC(DO)
             CRTPF      FILE(*CURLIB/IWBRK) RCDLEN(132) MAXMBRS(*NOMAX)
             GOTO       CMDLBL(CRTBRK)
                        ENDDO
             MONMSG     MSGID(CPF3141) EXEC(DO)
             ADDPFM     FILE(*LIBL/IWBRK) MBR(IWBRK)
             MONMSG     MSGID(CPF3213 CPF7306 CPA0701) EXEC(DO)
             CHGPF      FILE(*LIBL/IWBRK) MAXMBRS(*NOMAX)
             GOTO       CMDLBL(CRTBRK)
                        ENDDO
                        ENDDO

/* Varselbilde 1                                                     */
/*           IF         COND(&DSBTCH *NE '1') THEN(DO)               */
/*           CHGVAR     VAR(&WALI) VALUE(4)                          */
/*           CHGVAR     VAR(&WAPO) VALUE(34)                         */
/*           CHGVAR     VAR(&MLD1) VALUE('Oppdaterer               ')*/
/*           CHGVAR     VAR(&MLD2) VALUE('***Historisk faktura *** ')*/
/*           CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)   */
/*           ENDDO                                                   */
/*                                                                   */
/*                                                                   */
/*                                                                   */
             WRKACTJOB  OUTPUT(*PRINT) SBS(QINTER)
/*                                                                   */
/*                                                                   */
/*Kopierer faktura fra spool til arbeidsregister                     */
/*                                                                   */
             CPYSPLF    FILE(QPDSPAJB) TOFILE(*LIBL/IWBRK) +
                          JOB(&NBR/&USR/&JOB) SPLNBR(*LAST) +
                          TOMBR(IWBRK) CTLCHAR(*NONE)
             MONMSG     MSGID(CPA0000 CPF0000)
/*                                                                   */
/*Sletter spoolfile                                                  */
/*                                                                   */
             DLTSPLF    FILE(QPDSPAJB) SPLNBR(*LAST) SELECT(&USR)
/*                                                                   */
/* Test om div. register finnes                                      */
/*                                                                   */
NYRCV:       RCVF
             MONMSG     MSGID(CPF0864) EXEC(DO)
                        GOTO CMDLBL(ENDPGM)
               ENDDO
             CHGVAR     VAR(&TX) VALUE(%SUBSTRING(&IWBRK 29 1))
             CHGVAR     VAR(&WS) VALUE(%SUBSTRING(&IWBRK 4 10))
             CHGVAR     VAR(&US) VALUE(%SUBSTRING(&IWBRK 17 10))
             if         cond(&ws *eq ' ') then(do)
               goto     cmdlbl(nyrcv)
             enddo
             if         cond(&us *eq ' ') then(do)
               goto     cmdlbl(nyrcv)
             enddo
             if         cond(&tx *Lt '0') then(do)
               goto     cmdlbl(nyrcv)
             enddo
             if         cond(&tx *gt '9') then(do)
               goto     cmdlbl(nyrcv)
             enddo

             chgvar     var(&wh1)  value(&wb1)
             chgvar     var(&wh2)  value(&wb2)
             chgvar     var(&wh3)  value(&wb3)
             chgvar     var(&wh4)  value(&wb4)
             chgvar     var(&wh5)  value(&wb5)
             chgvar     var(&wh6)  value(&wb6)
             chgvar     var(&wh7)  value(&wb7)
             chgvar     var(&wh8)  value(&wb8)
             chgvar     var(&wh9)  value(&wb9)
             chgvar     var(&wh10) value(&wb10)
/*                                                                   */
             chgvar     var(&who) value(&wh1)
             chgvar     var(&wh1) value('  ')
/*                                                                   */
             CHGVAR     VAR(&T1) VALUE(%SUBSTRING(&WHO 1 1))
             CHGVAR     VAR(&T2) VALUE(%SUBSTRING(&WHO 2 1))
             CHGVAR     VAR(&T3) VALUE(%SUBSTRING(&WHO 3 1))
             CHGVAR     VAR(&T4) VALUE(%SUBSTRING(&WHO 4 1))
             CHGVAR     VAR(&T5) VALUE(%SUBSTRING(&WHO 5 1))
             CHGVAR     VAR(&T6) VALUE(%SUBSTRING(&WHO 6 1))
/*                                                                   */
start:
             CHGVAR     VAR(&WS) VALUE(%SUBSTRING(&IWBRK 4 10))
             CHGVAR     VAR(&US) VALUE(%SUBSTRING(&IWBRK 17 10))
/*                                                                   */
             if         cond(&us *eq &who) then(do)
             goto       cmdlbl(sndmsg)
             enddo

             CHGVAR     VAR(&B) VALUE(%SUBSTRING(&US 1 1))
/*                                                                   */
             IF         COND(&B *EQ &T1) THEN(DO)
              IF         COND(&T2 *EQ '*') THEN(DO)
                         GOTO CMDLBL(SNDMSG)
                         ENDDO
             CHGVAR     VAR(&B) VALUE(%SUBSTRING(&US 2 1))
/*                                                                   */
             IF         COND(&B *EQ &T2) THEN(DO)
              IF         COND(&T3 *EQ '*') THEN(DO)
                         GOTO CMDLBL(SNDMSG)
                         ENDDO
             CHGVAR     VAR(&B) VALUE(%SUBSTRING(&US 3 1))
/*                                                                   */
             IF         COND(&B *EQ &T3) THEN(DO)
              IF         COND(&T4 *EQ '*') THEN(DO)
                         GOTO CMDLBL(SNDMSG)
                         ENDDO
             CHGVAR     VAR(&B) VALUE(%SUBSTRING(&US 4 1))
/*                                                                   */
             IF         COND(&B *EQ &T4) THEN(DO)
              IF         COND(&T5 *EQ '*') THEN(DO)
                         GOTO CMDLBL(SNDMSG)
                         ENDDO
             CHGVAR     VAR(&B) VALUE(%SUBSTRING(&US 5 1))
/*                                                                   */
             IF         COND(&B *EQ &T5) THEN(DO)
              IF         COND(&T6 *EQ '*') THEN(DO)
                         GOTO CMDLBL(SNDMSG)
                         ENDDO
             ENDDO
             ENDDO
             ENDDO
             ENDDO
             ENDDO
             if         cond(&wh2 *ne '  ') then(do)
               chgvar   var(&who) value(&wh2)
               chgvar   var(&wh2) value(' ')
               goto     cmdlbl(start)
             enddo
             if         cond(&wh3 *ne '  ') then(do)
               chgvar   var(&who) value(&wh3)
               chgvar   var(&wh3) value(' ')
               goto     cmdlbl(start)
             enddo
             if         cond(&wh4 *ne '  ') then(do)
               chgvar   var(&who) value(&wh4)
               chgvar   var(&wh4) value(' ')
               goto     cmdlbl(start)
             enddo
             if         cond(&wh5 *ne '  ') then(do)
               chgvar   var(&who) value(&wh5)
               chgvar   var(&wh5) value(' ')
               goto     cmdlbl(start)
             enddo
             if         cond(&wh6 *ne '  ') then(do)
               chgvar   var(&who) value(&wh6)
               chgvar   var(&wh6) value(' ')
               goto     cmdlbl(start)
             enddo
             if         cond(&wh7 *ne '  ') then(do)
               chgvar   var(&who) value(&wh7)
               chgvar   var(&wh7) value(' ')
               goto     cmdlbl(start)
             enddo
             if         cond(&wh8 *ne '  ') then(do)
               chgvar   var(&who) value(&wh8)
               chgvar   var(&wh8) value(' ')
               goto     cmdlbl(start)
             enddo
             if         cond(&wh9 *ne '  ') then(do)
               chgvar   var(&who) value(&wh9)
               chgvar   var(&wh9) value(' ')
               goto     cmdlbl(start)
             enddo
             if         cond(&wh10 *ne '  ') then(do)
               chgvar   var(&who) value(&wh10)
               chgvar   var(&wh10) value(' ')
               goto     cmdlbl(start)
             enddo

             GOTO       CMDLBL(NYRCV)
/*                                                                   */
 SNDMSG:     SNDBRKMSG  MSG(&MSG) TOMSGQ(&WS) MSGTYPE(&TYPE)
             GOTO       CMDLBL(NYRCV)


/*                                                                   */
 ENDPGM:     ENDPGM
