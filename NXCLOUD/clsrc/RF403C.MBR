/* Tatt vekk test på om bibliotek finnes 17.8.05 HFL                 */
             PGM
             DCLF       FILE(RF403D)

             DCL        VAR(&A1VGPL) TYPE(*CHAR) LEN(1)
             DCL        VAR(&A1VOKO) TYPE(*CHAR) LEN(1)
             DCL        VAR(&A1VBNK) TYPE(*CHAR) LEN(1)
             DCL        VAR(&A1VTEL) TYPE(*CHAR) LEN(1)
             DCL        VAR(&A1VOFA) TYPE(*CHAR) LEN(1)
             DCL        VAR(&A1VSHO) TYPE(*CHAR) LEN(1)
             DCL        VAR(&A1VLAG) TYPE(*CHAR) LEN(1)
             DCL        VAR(&A1VSTA) TYPE(*CHAR) LEN(1)
             DCL        VAR(&A1FGRP) TYPE(*CHAR) LEN(3)
             DCL        VAR(&A1FIRM) TYPE(*CHAR) LEN(3)
             DCL        VAR(&A1TGRP) TYPE(*CHAR) LEN(3)
             DCL        VAR(&A1TFIR) TYPE(*CHAR) LEN(3)
             DCL        VAR(&LEVL)   TYPE(*CHAR) LEN(2)
             DCL        VAR(&OKOK)   TYPE(*CHAR) LEN(2)
             DCL        VAR(&FGRP)   TYPE(*CHAR) LEN(3)
             DCL        VAR(&FIRM)   TYPE(*CHAR) LEN(3)
             DCL        VAR(&BIBL)   TYPE(*CHAR) LEN(06) VALUE('ADB   ')
             DCL        VAR(&MLD3)   TYPE(*CHAR) LEN(50)
             DCL        VAR(&MLD4)   TYPE(*CHAR) LEN(50)
             DCL        VAR(&SVAR)   TYPE(*CHAR) LEN(1)
             DCL        VAR(&MLD1)   TYPE(*CHAR) LEN(40)
             DCL        VAR(&MLD2)   TYPE(*CHAR) LEN(40)
             DCL        VAR(&WALI)   TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&WAPO)   TYPE(*DEC)  LEN(2 0)

/* Kontrollere brukertilgang                                         */

             CHGVAR     VAR(&LEVL) VALUE('40')
             CHGVAR     VAR(&OKOK) VALUE('  ')
             CALL       PGM(AA050C)  PARM(&LEVL &OKOK)
             IF         COND(&OKOK *NE 'OK') THEN(DO)
             CALL       PGM(AA004C)
             GOTO       CMDLBL(ENDPGM)
             ENDDO


/* Hente inn filgruppe / firma fra LDA                               */

             RTVDTAARA  DTAARA(*LDA (931 03)) RTNVAR(&FGRP)
             RTVDTAARA  DTAARA(*LDA (944 03)) RTNVAR(&FIRM)

             CHGVAR     VAR(&A1FGRP) VALUE(&FGRP)
             CHGVAR     VAR(&A1FFIR) VALUE(&FIRM)

             SNDRCVF    RCDFMT(A1BLD)

/* F3 + F12                                                          */
             IF         COND(&IN03) THEN(GOTO CMDLBL(ENDPGM))
             IF         COND(&IN12) THEN(GOTO CMDLBL(ENDPGM))

             CHGVAR     VAR(%SST(&BIBL 4 3)) VALUE(&A1TGRP)

/* Varselbilde med bekreftelse på om jobb skal settes i gang         */

             CHGVAR     VAR(&MLD3) +
                        VALUE('Kopierer 000/ADBxxx til 000/ADByyy')
             CHGVAR     VAR(&MLD4) +
                        VALUE('       Bekreft at dette er riktig !')
             CHGVAR     VAR(%SST(&MLD3 10 3)) VALUE(&FIRM)
             CHGVAR     VAR(%SST(&MLD3 17 3)) VALUE(&FGRP)
             CHGVAR     VAR(%SST(&MLD3 25 3)) VALUE(&A1TFIR)
             CHGVAR     VAR(%SST(&MLD3 32 3)) VALUE(&A1TGRP)

             CALL       PGM(AA007R)    PARM(&MLD3 &MLD4 &SVAR &IN12)

             IF         COND(&IN12 *EQ '1') +
                          THEN(GOTO CMDLBL(ENDPGM))

             IF         COND(&SVAR *EQ ' ' *OR &SVAR *EQ 'J') +
                          THEN(GOTO CMDLBL(VIDERE))
             ELSE       CMD(GOTO CMDLBL(ENDPGM))

VIDERE:

/*  Call rutiner for å flytte firma                                  */

ASOKON:

             IF         COND(&A1VOKO *EQ '1') THEN(DO)

/*           Tester på om biblioteket finnes:                        */

/*           CHKOBJ     OBJ(ASOKON)     OBJTYPE(*LIB)                */
/*           MONMSG     MSGID(CPF9801)  EXEC(GOTO CMDLBL(ASBANK))    */

/*           Tester på om filer finnes:                              */

             CHKOBJ     OBJ(&BIBL/RKUNPF)   OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801)      EXEC(GOTO CMDLBL(ASBANK))

/*  Kopierer firma i database-filer ASOKON                           */

             CHGVAR     VAR(&WALI) VALUE(4)
             CHGVAR     VAR(&WAPO) VALUE(44)

             CHGVAR     VAR(&MLD1) VALUE('Kopiering av filer...      ')
             CHGVAR     VAR(&MLD2) VALUE('...... ASOKON .......      ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)

             CALL       PGM(RF405C)    PARM(&A1TGRP &A1TFIR)
             ENDDO

ASBANK:

             IF         COND(&A1VBNK *EQ '1') THEN(DO)

/*           Tester på om biblioteket finnes:                        */

/*           CHKOBJ     OBJ(ASBANK)     OBJTYPE(*LIB)                */
/*           MONMSG     MSGID(CPF9801)  EXEC(GOTO CMDLBL(ASTELE))    */

/*           Tester på om filer finnes:                              */

             CHKOBJ     OBJ(&BIBL/DHTRPF)   OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801)      EXEC(GOTO CMDLBL(ASTELE))

/*  Kopierer firma i database-filer ASBANK                           */

             CHGVAR     VAR(&WALI) VALUE(4)
             CHGVAR     VAR(&WAPO) VALUE(44)

             CHGVAR     VAR(&MLD1) VALUE('Kopiering av filer...      ')
             CHGVAR     VAR(&MLD2) VALUE('...... ASBANK .......      ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)

             CALL       PGM(DB405C)    PARM(&A1TGRP &A1TFIR)
             ENDDO

ASTELE:

             IF         COND(&A1VTEL *EQ '1') THEN(DO)

/*           Tester på om biblioteket finnes:                        */

/*           CHKOBJ     OBJ(ASBANK)     OBJTYPE(*LIB)                */
/*           MONMSG     MSGID(CPF9801)  EXEC(GOTO CMDLBL(ASOFAK))    */

/*           Tester om filer finnes:                                 */

             CHKOBJ     OBJ(&BIBL/GFASPF)   OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801)      EXEC(GOTO CMDLBL(ASOFAK))

/*  Kopierer firma i database-filer ASTELE                           */

             CHGVAR     VAR(&WALI) VALUE(4)
             CHGVAR     VAR(&WAPO) VALUE(44)

             CHGVAR     VAR(&MLD1) VALUE('Kopiering av filer...      ')
             CHGVAR     VAR(&MLD2) VALUE('...... ASTELE .......      ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)

             CALL       PGM(GL405C)    PARM(&A1TGRP &A1TFIR)
             ENDDO

ASOFAK:

             IF         COND(&A1VOFA *EQ '1') THEN(DO)

/*           Tester på om biblioteket finnes:                        */

/*           CHKOBJ     OBJ(ASOFAK)     OBJTYPE(*LIB)                */
/*           MONMSG     MSGID(CPF9801)  EXEC(GOTO CMDLBL(ASSHOP))    */

/*           Tester om filer finnes:                                 */

             CHKOBJ     OBJ(&BIBL/VVARPF)   OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801)      EXEC(GOTO CMDLBL(ASSHOP))

/*  Kopierer firma i database-filer ASOFAK                           */

             CHGVAR     VAR(&WALI) VALUE(4)
             CHGVAR     VAR(&WAPO) VALUE(44)

             CHGVAR     VAR(&MLD1) VALUE('Kopiering av filer...      ')
             CHGVAR     VAR(&MLD2) VALUE('...... ASOFAK .......      ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)

             CALL       PGM(FO405C)    PARM(&A1TGRP &A1TFIR)
             ENDDO

ASSHOP:

/*                                                                   */
             IF         COND(&A1VSHO *EQ '1') THEN(DO)

/*           Tester på om biblioteket finnes:                        */

/*           CHKOBJ     OBJ(ASSHOP)     OBJTYPE(*LIB)                */
/*           MONMSG     MSGID(CPF9801)   EXEC(GOTO CMDLBL(ASLAGR))   */

/*           Tester om filer finnes:                                 */

             CHKOBJ     OBJ(&BIBL/BOHEPF)   OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801)   EXEC(GOTO CMDLBL(ASLAGR))

/*  Kopierer firma i database-filer ASSHOP                           */

             CHGVAR     VAR(&WALI) VALUE(4)
             CHGVAR     VAR(&WAPO) VALUE(44)

             CHGVAR     VAR(&MLD1) VALUE('Kopiering av filer...      ')
             CHGVAR     VAR(&MLD2) VALUE('...... ASSHOP .......      ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)

             CALL       PGM(BO405C)    PARM(&A1TGRP &A1TFIR)
             ENDDO

ASLAGR:

             IF         COND(&A1VLAG *EQ '1') THEN(DO)

/*           Tester på om biblioteket finnes:                        */

/*           CHKOBJ     OBJ(ASLAGR)     OBJTYPE(*LIB)                */
/*           MONMSG     MSGID(CPF9801)   EXEC(GOTO CMDLBL(ASSTAT))   */

/*           Tester om filer finnes:                                 */

             CHKOBJ     OBJ(&BIBL/LOHEPF)   OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801)   EXEC(GOTO CMDLBL(ASSTAT))

/*  Kopierer firma i database-filer ASLAGR                           */

             CHGVAR     VAR(&WALI) VALUE(4)
             CHGVAR     VAR(&WAPO) VALUE(44)

             CHGVAR     VAR(&MLD1) VALUE('Kopiering av filer...      ')
             CHGVAR     VAR(&MLD2) VALUE('...... ASLAGR .......      ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)

             CALL       PGM(LA405C)    PARM(&A1TGRP &A1TFIR)
             ENDDO

ASSTAT:

             IF         COND(&A1VSTA *EQ '1') THEN(DO)

/*           Tester på om biblioteket finnes:                        */

/*           CHKOBJ     OBJ(ASSTAT)     OBJTYPE(*LIB)                */
/*           MONMSG     MSGID(CPF9801)   EXEC(GOTO CMDLBL(ASPGPL))   */

/*           Tester om filer finnes:                                 */

             CHKOBJ     OBJ(&BIBL/SSTAPF)   OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801)   EXEC(GOTO CMDLBL(ASPGPL))

/*  Kopierer firma i database-filer ASSTAT                           */

             CHGVAR     VAR(&WALI) VALUE(4)
             CHGVAR     VAR(&WAPO) VALUE(44)

             CHGVAR     VAR(&MLD1) VALUE('Kopiering av filer...      ')
             CHGVAR     VAR(&MLD2) VALUE('...... ASSTAT .......      ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)

             CALL       PGM(SF405C)    PARM(&A1TGRP &A1TFIR)
             ENDDO

ASPGPL:

             IF         COND(&A1VGPL *EQ '1') THEN(DO)

/*           Tester på om biblioteket finnes:                        */

/*           CHKOBJ     OBJ(ASPGPL)     OBJTYPE(*LIB)                */
/*           MONMSG     MSGID(CPF9801)   EXEC(GOTO CMDLBL(ENDPGM))   */

/*           Tester om filer finnes:                                 */

             CHKOBJ     OBJ(&BIBL/AFIRPF)   OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801)   EXEC(GOTO CMDLBL(ENDPGM))

/*  Kopierer firma i database-filer ASPGPL                           */

             CHGVAR     VAR(&WALI) VALUE(4)
             CHGVAR     VAR(&WAPO) VALUE(44)

             CHGVAR     VAR(&MLD1) VALUE('Kopiering av filer...      ')
             CHGVAR     VAR(&MLD2) VALUE('...... ASPGPL .......      ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)

             CALL       PGM(AA405C)    PARM(&A1TGRP &A1TFIR)
             ENDDO

 ENDPGM:     ENDPGM
