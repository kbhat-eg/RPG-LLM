             PGM       (&etik &fide &ovfa &filg &firm &lagr +
/*7.01*/               &alle &mapp &full)
/*-------------------------------------------------------------------*/
/* Initiering av parametere                                          */
/*7.01 310820 bsa Mulighet for komplette uttrekk                     */
/*                                                                   */
/*8.01 250522 bsa Eget valg for REST API integrasjon                 */
/*8.02 030921 bsa  Utvidet med etiketter til Delfi                   */
/*                                                                   */
/*-------------------------------------------------------------------*/

             DCL        VAR(&clib)     TYPE(*CHAR) LEN(6) value('ADBxxx')
             DCL        VAR(&etik)     TYPE(*char) LEN(1)
             DCL        VAR(&fide)     TYPE(*char) LEN(50)
             DCL        VAR(&ovfa)     TYPE(*char) LEN(10)
             DCL        VAR(&filg)     TYPE(*char) LEN(3)
             DCL        VAR(&firm)     TYPE(*dec)  LEN(3 0)
             DCL        VAR(&LAGR)     TYPE(*dec)  LEN(2 0)
             DCL        VAR(&ALLE)     TYPE(*CHAR) LEN(1)
             DCL        VAR(&MAPP)     TYPE(*CHAR) LEN(10)
/*7.01*/     dcl        var(&full)     type(*dec) len(1 0)
             DCL        VAR(&MEMB) TYPE(*CHAR) LEN(10) +
                          VALUE('AUTOHYLLE')
             DCL        VAR(&OVRF) TYPE(*CHAR) LEN(10) +
/*9.01*/                VALUE('PRICERDT01')
/*9.01*/     DCL        VAR(&FNA1)  TYPE(*CHAR) LEN(100) VALUE(' ')
/*9.01*/     DCL        VAR(&FNA2)  TYPE(*CHAR) LEN(100) VALUE(' ')
             DCL        VAR(&TOFI)  TYPE(*CHAR) LEN(85)
             DCL        VAR(&STAT)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&SMSG)  TYPE(*CHAR) LEN(1) VALUE('1')
/*9.01*/     DCL        VAR(&OVRF2) TYPE(*CHAR) LEN(10) +

             chgvar     var(%sst(&clib 4 3)) value(&filg)
/*           CHGVAR     VAR(&fna1) VALUE(&fide *tcat '.txt')     */
             CHGVAR     VAR(&ovrf) VALUE(&ovfa)
/*9.01       CHGVAR     VAR(&ovrf2) VALUE('PRICERMG01')          */
/*9.01*/     CHGVAR     VAR(&ovrf2) VALUE('PRICERMG' *tcat %char(&lagr))
/*9.01*/     if         cond(&lagr *lt 10) then(do)
/*9.01*/     CHGVAR     VAR(&ovrf2) VALUE('PRICERMG0' *tcat %char(&lagr))
/*9.01*/     enddo

/*           Sjekk arbeidsregister                                   */

             CHKOBJ     OBJ(VETXPF) OBJTYPE(*FILE) MBR(&MEMB)
             MONMSG     MSGID(CPF9815) EXEC(DO)
             ADDPFM     FILE(VETXPF) MBR(&MEMB) TEXT('Varer til +
                          hylleforkanter ')
             ENDDO

/* Call av utplukksprogram                                           */

             CLRPFM     FILE(VETXPF) MBR(&MEMB)
             OVRDBF     FILE(VETXPF) TOFILE(VETXPF) MBR(&MEMB)

/* Nixdorf/ESL  */

             if         cond(&etik *EQ 'E') then(do)
/*7.01*/     call       pgm(fp266r) parm(&lagr &alle &filg &firm &full &stat)
             call       pgm(fp264r) parm(&fide &fna1 &fna2)
             enddo

/* 8.02 Delfi/Breece */

/*8.02*/     if         cond(&etik *EQ 'D') then(do)
/*8.02*/     call       pgm(fp267r) parm(&lagr &alle &filg &firm &stat)
/*8.02*/     call       pgm(fp264r) parm(&fide &fna1 &fna2)
/*8.02*/     enddo

/* Pricer   */

             if         cond(&etik *EQ 'P') then(do)
/*7.01*/     CALL       PGM(FP265R) PARM(&LAGR &ALLE &full &STAT)
             enddo

/* Dersom poster er lagt ut - kopieres data til overføringsfil       */

             IF         COND(&STAT *EQ '0') +
             THEN(GOTO CMDLBL(END))

             if         cond(&etik *EQ 'E') then(do)
             CPYF       FROMFILE(&clib/VETXPF) +
                          TOFILE(&clib/AUTHPF) FROMMBR(AUTOHYLLE) +
                          TOMBR(AUTHPF) MBROPT(*REPLACE) FMTOPT(*NOCHK)
             enddo

             if         cond(&etik *EQ 'P') then(do)
             CPYF       FROMFILE(&clib/VETXPF) +
                          TOFILE(&clib/PRICER) FROMMBR(AUTOHYLLE) +
                          TOMBR(PRICER) MBROPT(*REPLACE) FMTOPT(*NOCHK)
             enddo

/*8.02*/     if         cond(&etik *EQ 'D') then(do)
/*8.02*/     CPYF       FROMFILE(&clib/VETXPF) +
/*8.02*/                  TOFILE(&clib/AUTHPF) FROMMBR(AUTOHYLLE) +
/*8.02*/                  TOMBR(AUTHPF) MBROPT(*REPLACE) FMTOPT(*NOCHK)
/*8.02*/     enddo


/* Sjekker kommuniksjonsform                                         */

             IF         COND(&mapp *EQ 'FTP') +
             THEN(GOTO CMDLBL(FTP))
/*8.01*/     if         cond(&mapp *EQ 'SFTP') +
/*8.01*/     then(goto cmdlbl(IFS))
/*8.01*/     if         cond(&mapp *EQ 'IFS') +
/*8.01*/     then(goto cmdlbl(IFS))
/*8.01*/     if         cond(&mapp *EQ 'REST') +
/*8.01*/     then(goto cmdlbl(REST))

/* Starter FTP overføring til ESL server                             */

/*FTP:  */
FTP:         CALL       PGM(AF700C) PARM(&OVRF &STAT &FNA1 &SMSG)
/*9.01*/     CALL       PGM(AF700C) PARM(&OVRF2 &STAT &FNA2 &SMSG)
             GOTO       CMDLBL(END)

/* Starter kopiering til integret filsystem                          */

IFS:         CHGVAR     VAR(&TOFI) VALUE('/home/' *tcat &clib *TCAT +
                                   '/hylleforkanter/' *TCAT +
                                    &fna1)

             CPYTOSTMF  FROMMBR('/qsys.lib/' *TCAT &CLIB *TCAT +
                          '.lib/authpf.file/authpf.mbr') +
                          TOSTMF(&TOFI) STMFOPT(*REPLACE) +
                          STMFCCSID(1208)

             CHGVAR     VAR(&TOFI) VALUE('/home/' *tcat &clib *TCAT +
                                   '/hylleforkanter/' *TCAT +
                                         &fna2)

             CPYTOSTMF  FROMMBR('/qsys.lib/' *TCAT &CLIB *TCAT +
                          '.lib/aflgpf.file/aflgpf.mbr') +
                          TOSTMF(&TOFI) STMFOPT(*REPLACE) +
                          STMFCCSID(1208)
/*8.01*/     goto       cmdlbl(END)


/* 8.01 Nytt valg for kommunikasjon REST                              */

REST:        CHGVAR     VAR(&TOFI) VALUE('/home/' *tcat &clib *TCAT +
/*8.01*/                           '/hylleforkanter_rest/' *TCAT +
/*8.01*/                            &fna1)

/*8.01*/     CPYTOSTMF  FROMMBR('/qsys.lib/' *TCAT &CLIB *TCAT +
/*8.01*/                  '.lib/authpf.file/authpf.mbr') +
/*8.01*/                  TOSTMF(&TOFI) STMFOPT(*REPLACE) +
/*8.01*/                  STMFCCSID(1208)



END:           RMVM       FILE(*LIBL/VETXPF) MBR(&MEMB)

             ENDPGM
