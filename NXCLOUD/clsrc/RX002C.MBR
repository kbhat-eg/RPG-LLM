/* ________________________________________________________________ */
/* Denne jobben skal sette opp JOBSCD-jobb som oppdaterer Saldo     */
/*       fra IFS-omr√•det til Kundereskontro hvert n. minutt         */
/* ________________________________________________________________ */

             PGM        parm(&fgr &min)
             dcl        var(&jobb)   type(*char) len(10)
             dcl        var(&firm)   type(*char) len(3)
             dcl        var(&fgr)    type(*char) len(3)
             dcl        var(&tix)    type(*char) len(8)
             dcl        var(&usr)    type(*char) len(10) Value('ASP_xxx')

             dcl        var(&dt)     type(*char) len(20)
             dcl        var(&min)    type(*char) len(3)
             dcl        var(&tt)     type(*char) len(2)
             dcl        var(&mm)     type(*char) len(2)
             dcl        var(&ttn)    type(*dec)  len(3 0)
             dcl        var(&mmn)    type(*dec)  len(3 0)
             dcl        var(&minn)   type(*dec)  len(3 0)
             dcl        var(&rest)   type(*dec)  len(3 0)

             chgvar     var(&usr)    value('ASP_' *cat &fgr)
             rtvdtaara  dtaara(*lda (944 3)) rtnvar(&firm)

/* &jobb */  chgvar     var(&jobb)  value(&fgr *tcat '_VISMAX')
             rtvjoba    datetime(&dt)
             chgvar     var(&tt)  value(%sst(&dt 9 2))
             chgvar     var(&mm)  value(%sst(&dt 11 2))
             chgvar     var(&ttn)  value(%dec(&tt))
             chgvar     var(&mmn)  value(%dec(&mm))
             chgvar     var(&minn) value(%dec(&min))
             chgvar     var(&mmn)  value(&mmn + &minn)
             chgvar     var(&rest) value(&mmn / 60)
             chgvar     var(&mmn)  value(&mmn - &rest * 60)
             chgvar     var(&ttn)  value(&ttn + &rest)
             chgvar     var(&tt)   value(&ttn)
             chgvar     var(&mm)   value(&mmn)
             chgvar     var(&tix)  value(&tt *cat '.' *cat &mm *cat '.00')


             rmvjobscde job(&jobb)
             monmsg     msgid(cpf0000)
             addjobscde job(&jobb) cmd(call pgm(aabatch) +
                          parm(&fgr 'RX001START' '2' &firm)) +
                          frq(*once) scddate(*current) scdday(*none) +
                          rcyacn(*sbmhld) +
                          scdtime(&tix) jobd(*usrprf) +
                          jobq(*jobd) user(&usr) +
                          text('Oppdat. saldo fra ekst.system')

             ENDPGM
