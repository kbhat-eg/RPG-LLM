/* Oppretting/oppdatering av tabeller og indekser på bakgrunn av DDF */
/* Programmet takler maksimalt 25 indekser pr. tabell                */

/* Tabeller opprettes med:                                           */
/*   SIZE(*NOMAX) REUSEDLT(*YES) SRTSEQ(*LANGIDUNQ) LANGID(NOR)      */

             PGM        PARM(&FILE &DLIB &NULL)

             DCL        VAR(&FILE) TYPE(*CHAR) LEN(6)
             DCL        VAR(&DLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&NULL) TYPE(*CHAR) LEN(1)

             DCL        VAR(&BACK) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INDX) TYPE(*CHAR) LEN(6)

             DCL        VAR(&INLA) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLB) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLC) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLD) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLE) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLF) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLG) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLH) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLI) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLJ) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLK) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLL) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLM) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLN) TYPE(*CHAR) LEN(6)

             DCL        VAR(&INLR) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INLU) TYPE(*CHAR) LEN(6)

             DCL        VAR(&INL1) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INL2) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INL3) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INL4) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INL5) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INL6) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INL7) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INL8) TYPE(*CHAR) LEN(6)
             DCL        VAR(&INL9) TYPE(*CHAR) LEN(6)

/* Setter databibliotek til current library                          */

             CHGCURLIB  CURLIB(&DLIB)

/* Utleder navn på backup-tabell og indeks-prefix                    */

             CHGVAR     VAR(&BACK) VALUE(%SUBSTRING(&FILE 1 4) *CAT +
                          'BF')
             CHGVAR     VAR(&INDX) VALUE(%SUBSTRING(&FILE 1 4) *CAT +
                          'L*')

/* Utleder navn indekser                                             */

             CHGVAR     VAR(&INLA) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'A')
             CHGVAR     VAR(&INLB) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'B')
             CHGVAR     VAR(&INLC) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'C')
             CHGVAR     VAR(&INLD) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'D')
             CHGVAR     VAR(&INLE) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'E')
             CHGVAR     VAR(&INLF) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'F')
             CHGVAR     VAR(&INLG) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'G')
             CHGVAR     VAR(&INLH) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'H')
             CHGVAR     VAR(&INLI) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'I')
             CHGVAR     VAR(&INLJ) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'J')
             CHGVAR     VAR(&INLK) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'K')
             CHGVAR     VAR(&INLL) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'L')
             CHGVAR     VAR(&INLM) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'M')
             CHGVAR     VAR(&INLN) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'N')

             CHGVAR     VAR(&INLR) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'R')
             CHGVAR     VAR(&INLU) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          'U')

             CHGVAR     VAR(&INL1) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          '1')
             CHGVAR     VAR(&INL2) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          '2')
             CHGVAR     VAR(&INL3) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          '3')
             CHGVAR     VAR(&INL4) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          '4')
             CHGVAR     VAR(&INL5) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          '5')
             CHGVAR     VAR(&INL6) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          '6')
             CHGVAR     VAR(&INL7) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          '7')
             CHGVAR     VAR(&INL8) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          '8')
             CHGVAR     VAR(&INL9) VALUE(%SUBSTRING(&INDX 1 5) *CAT +
                          '9')

/* Tar vare på tabellinnholdet i temporær backup-tabell og sletter   */
/* eksisterende tabell og tilhørende indekser                        */

             CHKOBJ     OBJ(&DLIB/&FILE) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(GOTO CMDLBL(DDF))

             CHKOBJ     OBJ(&DLIB/&BACK) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(GOTO CMDLBL(BACKUP))

             DLTF       FILE(&DLIB/&BACK)

 BACKUP:     CPYF       FROMFILE(&DLIB/&FILE) TOFILE(&DLIB/&BACK) +
                          CRTFILE(*YES)

             DLTF       FILE(&DLIB/&INDX)
             MONMSG     MSGID(CPF2125)

             DLTF       FILE(&DLIB/&FILE)

/* Opretter tabell med tilhørende indekser                           */

 DDF:        CRTPF      FILE(&DLIB/&FILE) SRCFILE(QDDFSRC) +
                          SIZE(*NOMAX) REUSEDLT(*YES) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)

             CRTLF      FILE(&DLIB/&INLA) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLB) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLC) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLD) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLE) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLF) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLG) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLH) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLI) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLJ) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLK) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLL) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLM) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLN) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)

             CRTLF      FILE(&DLIB/&INLR) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INLU) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)

             CRTLF      FILE(&DLIB/&INL1) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INL2) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INL3) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INL4) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INL5) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INL6) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INL7) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INL8) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)
             CRTLF      FILE(&DLIB/&INL9) SRCFILE(QDDFSRC) +
                          SRTSEQ(*LANGIDUNQ) LANGID(NOR)
             MONMSG     MSGID(CPF7302)

/* Kopierer tilbake tabellinnhold fra temporær backup-tabell         */

             CHKOBJ     OBJ(&DLIB/&BACK) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(GOTO END)

             IF         COND(&NULL *NE '1') THEN( +
             CPYF       FROMFILE(&DLIB/&BACK) +
                          TOFILE(&DLIB/&FILE) MBROPT(*ADD) +
                          FMTOPT(*MAP *DROP))

             DLTF       FILE(&DLIB/&BACK)

 END:        ENDPGM
