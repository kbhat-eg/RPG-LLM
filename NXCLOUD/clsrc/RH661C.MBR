             PGM
/* 6.10 25.08.11  NHO  Ny liste/mva/konto                            */

/* Definere parametere og variabler                                  */

             DCL        VAR(&IN03)  TYPE(*CHAR)  LEN(1)
             DCL        VAR(&BTCH)  TYPE(*CHAR)  LEN(1)
             DCL        VAR(&MEMBX)  TYPE(*CHAR) LEN(5)
             DCL        VAR(&MEMB)   TYPE(*DEC)  LEN(5 0)
             DCL        VAR(&WSID)  TYPE(*CHAR)  LEN(10)
             DCL        VAR(&WALI)  TYPE(*DEC)   LEN(2 0)
             DCL        VAR(&WAPO)  TYPE(*DEC)   LEN(2 0)
             DCL        VAR(&MLD1)  TYPE(*CHAR)  LEN(40)
             DCL        VAR(&MLD2)  TYPE(*CHAR)  LEN(40)
             DCL        VAR(&WMM1)  TYPE(*CHAR)  LEN(10) VALUE('RHA     ')
             DCL        VAR(&MVATST) TYPE(*CHAR) LEN(1) VALUE(' ')
             DCL        VAR(&KONMVA) TYPE(*CHAR) LEN(1)
             dcl        var(&stat)   type(*dec)  len(1 0)
             dcl        var(&jkey)   type(*char) len(41)
             dcl        var(&fgr)    type(*char) len(3)
             dcl        var(&aar)    type(*char) len(4)
             dcl        var(&usr)    type(*char) len(10)


/* Henter verdier i fra LDA.                                         */

             RTVDTAARA  DTAARA(*LDA (864 5))  RTNVAR(&MEMBX)
             RTVDTAARA  DTAARA(*LDA (863 1))  RTNVAR(&BTCH)
             RTVDTAARA  DTAARA(*LDA (314 1))  RTNVAR(&MVATST)
             RTVDTAARA  DTAARA(*LDA (931 3))  RTNVAR(&fgr)
             RTVDTAARA  DTAARA(*LDA (911 10)) RTNVAR(&usr)

             RTVDTAARA  DTAARA(*LDA (316 1))  RTNVAR(&KONMVA)
             CHGVAR     VAR(&MEMB) VALUE(&MEMBX)
             CHGVAR     VAR(%SST(&WMM1 4 5)) VALUE(&MEMB)

/* Varselbilde 1                                                     */

             IF         COND(&BTCH *NE '1') THEN(DO)
             CHGVAR     VAR(&WALI) VALUE(6)
             CHGVAR     VAR(&WAPO) VALUE(40)
             CHGVAR     VAR(&MLD1) VALUE('Vennligst vent litt .....')
             CHGVAR     VAR(&MLD2) VALUE('Utskrift pågår ..........')
  /*         CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)        */
             ENDDO

/* Bygger membere dersom de ikke finnes                              */


/* Overide databasefile til aktuelt member                           */


/* Overstyring av printerfile                                        */

             IF         COND(&KONMVA *EQ 'J') THEN(DO)
             CHGDTAARA  DTAARA(*LDA (316 1)) VALUE('N')
/*           CALL       PGM(AP601C)    PARM('RH661P' &BTCH)  */

/*  Legger inn valg av program avhengig av 2016 eller 2017 +++)      */
/*           Filgruppe 630  skal også kjøre nytt for test            */

             rtvdtaara  dtaara(*lda (306 4)) rtnvar(&aar)
             if         cond(&aar *gt '2016') then(do)
               call     pgm(ap601c)    parm('RH661S' &btch)
               call     pgm(RH661R17)  parm(&wmm1)
               CALL     PGM(AP606C)    PARM('RH661S')
               goto     cmdlbl(RH661ok)
             enddo
             call       pgm(ap601c)    parm('RH661P' &btch)
             CALL       PGM(RH661R)    PARM(&WMM1)
             CALL       PGM(AP606C)    PARM('RH661P')
RH661ok:
             CHGDTAARA  DTAARA(*LDA (316 1)) VALUE('J')
             ENDDO

/* Ny utskrift                                                       */

             IF         COND(&KONMVA *EQ 'N') THEN(DO)
/*           CALL       PGM(AP601C)    PARM('RH664P' &BTCH)   */


/*  Legger inn valg av program avhengig av 2016 eller 2017 +++)      */
/*           Filgruppe 630  skal også kjøre nytt for test            */

             rtvdtaara  dtaara(*lda (306 4)) rtnvar(&aar)
             if         cond(&aar *gt '2016') then(do)
               call     pgm(AP601C)    parm('RH664S' &btch)
               call     pgm(RH664R17)  parm(&wmm1)
               CALL     PGM(AP606C)    PARM('RH664S')
               goto     cmdlbl(RH664ok)
             enddo
             call       pgm(AP601C)    parm('RH664P' &btch)
             CALL       PGM(RH664R)    PARM(&WMM1)
             CALL       PGM(AP606C)    PARM('RH664P')
RH664ok:

             ENDDO

/* Kontrolliste                                                      */

             IF         COND(&MVATST *EQ 'J') THEN(DO)

             IF         COND(&BTCH *NE '1') THEN(DO)
             CHGVAR     VAR(&WALI) VALUE(6)
             CHGVAR     VAR(&WAPO) VALUE(2)
             CHGVAR     VAR(&MLD1) VALUE('K O N T R O L L - L I S T E')
             CHGVAR     VAR(&MLD2) VALUE('****    MVA-OPPGJØR   *****')
  /*         CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)        */
             ENDDO

/* Program for printerstyring                                        */

             CALL       PGM(AP600R) PARM('RF112 ' '0' '0' &IN03 &BTCH)

/* Overstyring av printerfile                                        */

             CALL       PGM(AP601C)    PARM('RF112P' &BTCH)

/* Utskrift                                                          */
             CALL       PGM(RF112R)    PARM(&WMM1)

             CALL       PGM(AP606C)    PARM('RF112P')

             ENDDO

/* Journal-liste                                                     */

             IF         COND(&MVATST *NE 'J') THEN(DO)

/*    Legger ut mva-oppgjør som xml-fil   RMVXPF                  */
             call       pgm(ax400c)

             IF         COND(&BTCH *NE '1') THEN(DO)
             CHGVAR     VAR(&WALI) VALUE(6)
             CHGVAR     VAR(&WAPO) VALUE(2)
             CHGVAR     VAR(&MLD1) VALUE('J O U R N A L - L I S T E  ')
             CHGVAR     VAR(&MLD2) VALUE('****    MVA-OPPGJØR   *****')
   /*        CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)        */
             ENDDO

/* Call av oppdatering                                               */

             IF         COND(&BTCH *NE '1') THEN(DO)
             CHGVAR     VAR(&WALI) VALUE(6)
             CHGVAR     VAR(&WAPO) VALUE(40)
             CHGVAR     VAR(&MLD1) VALUE('Vennligst vent ..........')
             CHGVAR     VAR(&MLD2) VALUE('Oppdatering pågår .......')
   /*        CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)        */
             ENDDO

/* Overide databasefile til aktuelt member                           */

             chgvar     var(&stat)   value(0)
             chgvar     var(&jkey)   value(' ')

             CALL       PGM(RF110R)  PARM(&WMM1 &jkey &stat)

/* Call av utskrift-program                                          */

             IF         COND(&BTCH *NE '1') THEN(DO)
             CHGVAR     VAR(&WALI) VALUE(8)
             CHGVAR     VAR(&WAPO) VALUE(36)
             CHGVAR     VAR(&MLD1) VALUE('Vennligst vent ..........')
             CHGVAR     VAR(&MLD2) VALUE('Utskrift pågår ..........')
   /*        CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)      */
             ENDDO

/* Program for printerstyring                                        */

             CALL       PGM(AP600R) PARM('RF115 ' '0' '0' &IN03 &BTCH)

/* Overstyring av printerfile                                        */

             CALL       PGM(AP601C)    PARM('RF115P' &BTCH)

/* Utskrift                                                          */

             CALL       PGM(RF115R)    PARM(&WMM1)

             CALL       PGM(AP606C)    PARM('RF115P')

             ENDDO

/* Opprydding i fysiske filer                                        */

             CALL       PGM(RF702R) PARM(&WMM1)  /* RJOULU */
 ENDPGM:     ENDPGM
