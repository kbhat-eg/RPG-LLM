             PGM        parm(&p &f &n)

/*    NB!!!  Søk på Foreløpig og fjern denne linja før virkelig test */


             dcl        var(&filg)  type(*char) len(3)
             dcl        var(&firm)  type(*char) len(3)
             dcl        var(&wfir)  type(*dec)  len(3 0)
             dcl        var(&frem)  type(*char) len(20)
             dcl        var(&fmot)  type(*char) len(20)
             dcl        var(&favr)  type(*char) len(20)
             dcl        var(&focr)  type(*char) len(20)
             dcl        var(&fkto)  type(*char) len(20)
             dcl        var(&fink)  type(*char) len(20)
             dcl        var(&ftff)  type(*char) len(20)
             dcl        var(&bibl)  type(*char) len(6)
             dcl        var(&bank)  type(*char) len(2) value('DN')
             dcl        var(&komm)  type(*char) len(4)
             dcl        var(&in03)  type(*dec)  len(1 0)
             dcl        var(&linj)  type(*dec) len(2 0) value(2)
             dcl        var(&posi)  type(*dec) len(3 0) value(43)
             dcl        var(&fbane) type(*char) len(50)
             dcl        var(&tbane) type(*char) len(50) +
                          value('/qsys.lib/      .lib/+
                                 rsvepf.file/rsvepf.mbr')
             dcl        var(&mbr)    type(*char)  len(10)
             dcl        var(&usr)    type(*char)  len(10)
             dcl        var(&mbrtxt) type(*char)  len(50)
             dcl        var(&mn)     type(*dec)   len(1 0)
             dcl        var(&mx)     type(*char)  len(1)
             dcl        var(&dat)    type(*char)  len(6)
             dcl        var(&tid)    type(*char)  len(6)
             dcl        var(&mbra)   type(*char)  len(10) Value('TELE')
             dcl        var(&tra)    type(*char)  len(1)
             dcl        var(&p)      type(*char)  len(3)
             dcl        var(&f)      type(*char)  len(10)
             dcl        var(&n)      type(*char)  len(10)
             dcl        var(&mld1)   type(*char)  len(30)
             dcl        var(&mld2)   type(*char)  len(30)
             dcl        var(&posx)   type(*dec)   len(2 0) VALUE(5)
             dcl        var(&posy)   type(*dec)   len(2 0) VALUE(5)
             dcl        var(&lestfor) type(*char) len(1)
             dcl        var(&type)    type(*char) len(10)
             dCL    VAR(&fil)  TYPE(*char) LEN(10) value('RSVEPF')
             dCL        VAR(&lib)  TYPE(*char) LEN(10)
             dCL        VAR(&utf)  TYPE(*CHAR) LEN(60)
             dCL        VAR(&mem)  TYPE(*CHAR) LEN(10)
             dCL        VAR(&dir)  TYPE(*CHAR) LEN(60)
             dCL        VAR(&bstmf) TYPE(*CHAR) LEN(60)
             dCL        VAR(&bobj)  TYPE(*CHAR) LEN(60)

             rtvdtaara  dtaara(*lda (911 10)) rtnvar(&usr)
             rtvdtaara  dtaara(*lda (944 03)) rtnvar(&firm)
             chgvar     var(%sst(&mbra 5 3))  value(&firm)
/*  Sjekk om det finnes transer fra TELE fra før                    */
             call       pgm(ra202r)  parm(&mbra &tra)
             if         cond(&tra *eq 'J') then(do)
               call     pgm(aa007r) parm('Det finnes Banktranser +
                        fra før på dette firma     ' +
                        'Behandle disse før du kjører innlesning +
                         på nytt' ' ' ' ')
                goto cmdlbl(slutt)
                enddo

/*TEST       goto       cmdlbl(Tst2)     NB!   NB!!!!!!  NB!  */

/* Tømmer transfil fra Svea:                                         */

             clrpfm     file(*libl/rsvepf)
             monmsg   msgid(cpf3142) exec(do)
               crtpf    file(rsvepf) rcdlen(512) text('Mottak av +
                          data fra Svea')
             enddo

             if         cond(&p *ne 'IFS') then(goto cmdlbl(Tmbr))

/*                                                                  */
/*   Henter filer fra IFS m/HENTIFS                                 */

      rtvdtaara  dtaara(*lda (934 10)) rtnvar(&lib)
      chgvar     var(&mem)   value(&fil)
      call       pgm(hentifs)  parm(&fil &lib &mem &dir &utf)

      if         cond(&utf *eq 'Avbrudd') then(do)
        goto     cmdlbl(slutt)
      enddo
/*  Sjekk om fil er lest før eller noener hoppet over         */
      chgvar     var(&type)  value('SVEA')
      call       pgm(RA223R)  parm(&type &dir)
      if         cond(&type *eq 'Avbrudd') then(do)
                  goto   cmdlbl(slutt)
                 enddo
/*  Sjekk om filen er lest inn før                                  */

             chgvar     var(&lestfor) value(' ')
             call       pgm(ra221r) parm(&lestfor)
             if         cond(&lestfor *eq 'J') then(do)
               goto     cmdlbl(slutt)
             enddo

/*   Ta kopi av input filea til \asp\xxx\svea\Backup                 */
             chgvar     var(&bstmf) value(%sst(&dir 1 14) +
                                    *tcat ('Backup'))
             crtdir     dir(&bstmf) dtaaut(*rwx) objaut(*all)
             monmsg     msgid(cpfa0a0)
             chgvar     var(&bobj)  value(&bstmf *tcat '\' +
                                    *tcat (%sst(&dir 15 15)))
             cpy        obj(&dir)  toobj(&bobj)
             rmvlnk     objlnk(&dir)
tst2:
/* Ta backup av innlest fil til RSVEPF m/member = Maammddnn          */



/*  Sjekk om backupfil finnes                                        */
             chkobj     obj(*libl/rsvbpf)  objtype(*file)
             monmsg     msgid(cpf9815 cpf9801) exec(do)
               crtpf    file(*curlib/rsvbpf) rcdlen(512) +
                        maxmbrs(*nomax) size(*nomax) +
                        text('Backup av transer fra Svea')
             enddo
/*  Lage membernavn i backupfil                                      */
             chgvar     var(&mn) value(9)
             chgvar     var(&mx) value('9')
             rtvjoba    date(&dat)
             rtvsysval  sysval(qtime)  rtnvar(&tid)
mbrnext:     chgvar     var(&mbr)  value('M' *cat %sst(&dat 5 2) +
                        *cat %sst(&dat 3 2) *cat %sst(&dat 1 2) +
                        *cat (&mx))
             chgvar     var(&mbrtxt) value('Dato:' *cat &dat *cat +
                        '     Kl.:' *cat &tid *cat +
                        '    Bruker:' *cat &usr)
             chkobj     obj(*libl/rsvbpf) objtype(*file) mbr(&mbr)
             monmsg     msgid(cpf9815) exec(do)
               addpfm   file(*libl/rsvbpf) mbr(&mbr) text(&mbrtxt)
               goto     cmdlbl(mbrok)
             enddo
             if         cond(&mn *eq 0) then(goto cmdlbl(noback))
             chgvar     var(&mn) value(&mn - 1)
             chgvar     var(&mx) value(&mn)
             goto       cmdlbl(mbrnext)

/*   Ta backup av inputfil                                           */
mbrok:       cpyf       fromfile(*libl/rsvepf) tofile(*curlib/rsvbpf) +
                        frommbr(*first) tombr(&mbr) mbropt(*add) +
                        fmtopt(*nochk)
             monmsg     msgid(cpf2817 cpf2863)

             goto       cmdlbl(noback)

/*  Hente inn tildigere innlest fil                                  */

 tmbr:       cpyf       fromfile(&f) tofile(radrpf) frommbr(&n) +
                          mbropt(*replace) fmtopt(*nochk)
noback:
/*    Bygge økonomitranser                                           */
             clrpfm     file(re0tpf) mbr(&mbra)
             monmsg     msgid(cpf3141) exec(do)
               addpfm   file(re0tpf) mbr(&mbra) +
                        text('Innbetalinger fra Svea ')
             enddo
             ovrdbf     file(re0tpf)  mbr(&mbra)
             call       pgm(ra220r)

/*  Tilrettelegger poster for oppdatering                            */

             ovrdbf     file(re0tpf) mbr(&mbra)
             call       pgm(re115r)  parm(&mbra)
             dltovr     file(re0tpf)

slutt:       ENDPGM
