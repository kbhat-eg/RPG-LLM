/*                                                                   */
 strpgm:     pgm

             dcl        var(&p1)  type(*char) len(16)
             dcl        var(&p2)  type(*char) len(16)   Value('Chk_SKTIST')
             dcl        var(&msg) type(*char) len(320)
             dcl        var(&sys) type(*char) len(8)
             dcl        var(&ok)  type(*char) len(2)    Value('ok')
             dcl        var(&ps)  type(*char) len(3)
             dcl        var(&pt)  type(*char) len(100)

             dclf       file(*libl/skti_aut)

             rtvneta    sysname(&sys)
rcvf:        rcvf
             monmsg     msgid(cpf0864)  exec(goto cmdlbl(Sjekk))
             if         cond(&OAUSR *eq '*PUBLIC' *and +
                             &OAOBJA *ne '*ALL') then(DO)
               chgvar   var(&ok)  value('FF')
             enddo
             goto       cmdlbl(rcvf)

Sjekk:      if         cond(&ok *ne 'ok') then(do)
               chgvar     var(&msg)  value('Bruker *PUBLIC +
                                   har ikke lenger tilgangen: *ALL +
                                   til SKTIST/I1 på ' *cat &sys)
               addlible   lib(nxc_distr)  position(*last)
               monmsg     msgid(cpf0000)
               call       pgm(send_sms)  parm(&p1 &p2 &msg)

 /*   Legger også ut melding i NXLA for ev senere og kunne se når feil  */

             chgvar     var(&ps)              value('001')
             chgvar     var(&pt)              value(&msg)
             call       pgm(egd99c) parm+
                        ('CHK_SKTIST' +
                         'TST_SKTI2 ' +
                         &ps +
                         &pt)
             enddo

             endpgm
