      PGM        parm(&fgr)
      /*    Endret &dir fra L* til XLB*    */
      dcl        var(&dir)   type(*CHAR) len(60) value('\asp\xxx\MalProff\XLB*')
      dcl        var(&fil)   type(*char) len(10) value('MPINPUT')
      dcl        var(&lib)   type(*char) len(10) value('ADBxxx')
      dcl        var(&mbr)   type(*char) len(10) value('MPINPUT')
      dcl        var(&utf)   type(*CHAR) len(60)
      dcl        var(&fgr)   type(*CHAR) len(3)
      dcl        var(&d)     type(*CHAR) len(30)
      dcl        var(&Ts)    type(*CHAR) len(20)
      dcl        var(&Bf)    type(*CHAR) len(60)
      dcl        var(&Stat)  type(*CHAR) len(10)
      dcl        var(&Inp)   type(*CHAR) len(60)
      dcl        var(&IF)    type(*CHAR) len(60)
      dcl        var(&MbrSz) type(*Dec)  len(10 0)

      dcl        var(&c_comm)  type(*char) len(1)   value('1')
      dcl        var(&c_stat)  type(*char) len(8)   value(' ')
      dcl        var(&c_errt)  type(*char) len(120) value(' ')

      dcl        var(&prog)    type(*char) len(10)  value('RMPGETIFS2')
      dcl        var(&sekv)    type(*char) len(03)  value('001')
      dcl        var(&text)    type(*char) len(200)
      dcl        var(&jobb)    type(*char) len(10)  value('RMPGETIFS2')
/*  For tet  */
      dcl        var(&filb)  type(*char) len(10)  value('MPINPUT')
      dcl        var(&telx)  type(*char) len(3)
      dcl        var(&teln)  type(*dec)  len(3 0) value(0)

      dclf       file(HentIfsW)

      chgvar     var(%sst(&dir 6 3))   value(&fgr)
      chgvar     var(%sst(&lib 4 3))   value(&fgr)

/*    Les HentIfsW og se om det er noen filer og behandle            */

rcv:    rcvf
        monmsg     msgid(CPF0864) exec(do)   /* Slutt på fil  */
           goto    cmdlbl(endcmt)
        enddo


        if         cond(%sst(&hentifsw 2 3) *eq 'XLB'  *and +
                        %scan('.csv' &hentifsw) *gt 0) then(do)  /*  Inputfil */
          chgvar     var(&if)  value(%sst(&hentifsw 2 24))

 /* chgvar    var(&text)  value('Start RMPGETIFS2 m/beh av fil: ' *cat &if) */
 /* call      pgm(RMP97C)  parm(&jobb &prog &sekv &text)                    */

BehEnFil:    /*   Input:  &lib &fil &dir &If(fil lest fra oversikt)  */
          chgvar     var(&utf) value('/qsys.lib/' *tcat +
                     &lib *tcat '.lib/' +
                     *tcat &fil *tcat '.file/' +
                     *tcat &mbr *tcat '.mbr')
          chgvar     var(&inp)  value(%sst(&dir 1 18) *tcat &If)

 /*     Kopier fil fra IFS-område til &FIL                            */
          cpyfrmstmf fromstmf(&inp) tombr(&utf) mbropt(*add) +
                     stmfcodpag(*stmf)
          monmsg     msgid(cpfa095) exec(do)
            cpyfrmstmf fromstmf(&inp) tombr(&utf) mbropt(*add) +
                     stmfcodpag(*PCASCII)
            monmsg     msgid(cpfa09e cpfa095)
          enddo
        enddo

 /*     Sjekk om kopiert fil inneholder data                          */
        rtvmbrd    file(&fil) mbr(*first) nbrcurrcd(&mbrsz)
        if         cond(&mbrsz *eq 0) then(do)
          goto     cmdlbl(rcv)
        enddo

    /*  chgvar     var(&text)   value('Start RMP010R fra RMPGETIFS2')      */
    /*  call      pgm(RMP97C)   parm(&jobb &prog &sekv &text)              */

        chgvar    var(&teln)    value(&teln + 1)
        chgvar    var(&telx)    value(&teln)
/*      Oppdatering av en fil                                       */
        Call       pgm(RMP010R)   parm(&stat &If +
                                   &c_comm &c_stat &c_errt)

/*      if         cond(&stat *eq 'Ok' *and +                       */
/*                      &c_stat *eq '  ' *and +                     */
        if         cond(%sst(&hentifsw 2 3) *eq 'XLB') then(do)   /* Inputfil */
          rtvsysval  sysval(Qdatetime)  rtnvar(&Ts)
          chgvar     var(&Bf)   Value(%sst(&dir 1 18) *tcat 'Backup' +
                                        *tcat '\L_' *tcat &Ts)
          mov        obj(&inp)  Toobj(&Bf)
          chgatr     obj(&Bf) atr(*Text) value(*none) Text(&If)
        enddo

        clrpfm     file(&lib/&fil)
/*                                                       Commit      */
  /*    Commit               */
        goto     cmdlbl(rcv)

        if         cond(&stat *ne 'Ok' *or +
                        &c_stat *ne 'Ok') then(do)
/*                                                       RollBack    */
/*        rollback                  */
        enddo

endcmt: /* EndCmtCtl */

end:  ENDPGM
