             PGM        PARM(&FIRM &NREF &NUMM)
/*---------------------------------------------------------------------*/
/* 7.01 11.08.20 bsa Logiq klager på at det kommer to runder med       */
/*                   ordrebekreftelser. Ønsker kun et sett.            */
/*                                                                     */
/*---------------------------------------------------------------------*/


/* Initiering av parametre.                                          */

             DCL        VAR(&FIRM) TYPE(*DEC)  LEN(3 0)
             DCL        VAR(&NREF) TYPE(*DEC)  LEN(6 0)
/*6.nu*/     DCL        VAR(&NUMM) TYPE(*DEC)  LEN(8 0)

             DCL        VAR(&MEMB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&OVRF) TYPE(*CHAR) LEN(10) VALUE('NBSORES')
             DCL        VAR(&OVRX) TYPE(*CHAR) LEN(10) VALUE('LOGORES')
             DCL        VAR(&STAT) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FILN) TYPE(*CHAR) LEN(20)
             DCL        VAR(&SMSG) TYPE(*CHAR) LEN(1)  VALUE('0')

/* Henter membernavn/filnavn                                         */

             CALL       PGM(NN750R) PARM(&MEMB)

/* Oppretter member i overføringsfil, og kaller program for          */
/* generering av ordrebekreftelse                                    */

             ADDPFM     FILE(NETORES) MBR(&MEMB)
             OVRDBF     FILE(NETORES) MBR(&MEMB) OVRSCOPE(*CALLLVL)

             CALL       PGM(NN751R) PARM(&FIRM &NREF &NUMM)

             DLTOVR     FILE(NETORES)

/* Kopierer til member for sending med activ-sjekk                   */

             CPYF       FROMFILE(NETORES) TOFILE(NETORES) +
                          FROMMBR(&MEMB) TOMBR(NETORES) MBROPT(*ADD)

/* Sender ordrebekreftelse via FTP                                   */

             CHGVAR     VAR(&FILN) VALUE(&MEMB)

/* 7.01      CALL       PGM(AF700C) PARM(&OVRF &STAT &FILN &SMSG)     */

/* 7.01      IF         COND(&STAT *EQ ' ') THEN(CHGVAR VAR(&STAT) +  */
/* 7.01                   VALUE('0'))                                 */

             CALL       PGM(AF700C) PARM(&OVRX &STAT &FILN &SMSG)

             IF         COND(&STAT *EQ ' ') THEN(CHGVAR VAR(&STAT) +
                          VALUE('0'))

/* Dersom overføringen er OK, tømmes overføringsfil                  */

             IF         COND(&STAT *EQ '0') THEN(DO)
             CLRPFM     FILE(NETORES) MBR(NETORES)
             ENDDO

/* Fjerner arbeidsmember                                             */

             RMVM       FILE(NETORES) MBR(&MEMB)

 END:        ENDPGM
