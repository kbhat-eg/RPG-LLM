/* 11.10.10 Kan ikke slette fil/membere  NHO                         */
             PGM        PARM(&SYST)

/* Initiering av parametre.                                          */
/* Sender med riktige parametere ved call til RLØ61R                 */
             DCL        VAR(&MLD3)  TYPE(*CHAR) LEN(41)
             DCL        VAR(&MLD4)  TYPE(*DEC)  LEN(2 0)

             DCL        VAR(&FGRP)  TYPE(*CHAR) LEN(3)
             DCL        VAR(&SYST)  TYPE(*CHAR) LEN(4)
             DCL        VAR(&FFIR)  TYPE(*CHAR) LEN(3)
             DCL        VAR(&USER)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&WALI)  TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&WAPO)  TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&MLD1)  TYPE(*CHAR) LEN(40)
             DCL        VAR(&MLD2)  TYPE(*CHAR) LEN(40)
             DCL        VAR(&MEMB)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&WPLIB) TYPE(*CHAR) LEN(8)
             DCL        VAR(&MALIB) TYPE(*CHAR) LEN(10) VALUE('MLTARC')
             DCL        VAR(&MBTX)  TYPE(*CHAR) LEN(25)
             dcl        var(&cmprf) type(*char) len(10)
             dcl        var(&cmpr)  type(*char) len(30)
             dcl        var(&fper)  type(*char) len(1)
             dcl        var(&ip)    type(*char) len(15)
             dcl        var(&port)  type(*char) len(4)
             dcl        var(&par1)  type(*char) len(130)

/* Henter verdier i fra LDA.                                         */

             RTVDTAARA  DTAARA(*LDA (944 03)) RTNVAR(&FFIR)
             RTVDTAARA  DTAARA(*LDA (931 03)) RTNVAR(&FGRP)

             RTVDTAARA  DTAARA(*LDA (911 10)) RTNVAR(&USER)

             CHGVAR     VAR(%SST(&MEMB 1 4))  VALUE(&SYST)
             CHGVAR     VAR(%SST(&MEMB 5 3))  VALUE(&FFIR)
             CHGVAR     VAR(%SST(&MALIB 7 3))  VALUE(&FGRP)

/* Sjekk om det finnes posteringer i valgte delsystem                */

/* Varselbilde dersom poster ikke finnes i FOVFPF                    */

             IF         COND(&SYST *EQ 'FAKT') THEN(DO)
             CHKOBJ     OBJ(*LIBL/FOVFPF) OBJTYPE(*FILE) MBR(*FIRST)
             MONMSG     MSGID(CPF9815) EXEC(DO)
             CHGVAR     VAR(&WALI) VALUE(10)
             CHGVAR     VAR(&WAPO) VALUE(26)
             CHGVAR     VAR(&MLD1) VALUE('Ingen poster fra ASOFAK  ')
             CHGVAR     VAR(&MLD2) VALUE('Rutinen avsluttes ...... ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
             DLYJOB     DLY(5)
             GOTO       CMDLBL(ENDPGM)
             ENDDO
             GOTO       CMDLBL(OVERFOR)
             ENDDO

/* Varselbilde dersom poster ikke finnes i BOVFPF                    */

             IF         COND(&SYST *EQ 'SHOP') THEN(DO)
             CHKOBJ     OBJ(*LIBL/BOVFPF) OBJTYPE(*FILE) MBR(*FIRST)
             MONMSG     MSGID(CPF9801) EXEC(DO)
             CHGVAR     VAR(&WALI) VALUE(10)
             CHGVAR     VAR(&WAPO) VALUE(26)
             CHGVAR     VAR(&MLD1) VALUE('Ingen poster fra ASSHOP  ')
             CHGVAR     VAR(&MLD2) VALUE('Rutinen avsluttes ...... ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
             DLYJOB     DLY(5)
             GOTO       CMDLBL(ENDPGM)
             ENDDO
             GOTO       CMDLBL(OVERFOR)
             ENDDO

/* Varselbilde dersom poster ikke finnes i LOVFPF                    */

             IF         COND(&SYST *EQ 'LAGR') THEN(DO)
/*           CHGVAR     VAR(%SST(&MEMB 3 8))  VALUE(&USER)           */
             CHKOBJ     OBJ(*LIBL/LOVFPF) OBJTYPE(*FILE) MBR(*FIRST)
             MONMSG     MSGID(CPF9801) EXEC(DO)
             CHGVAR     VAR(&WALI) VALUE(10)
             CHGVAR     VAR(&WAPO) VALUE(26)
             CHGVAR     VAR(&MLD1) VALUE('Ingen poster fra ASLAGR  ')
             CHGVAR     VAR(&MLD2) VALUE('Rutinen avsluttes ...... ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
             DLYJOB     DLY(5)
             GOTO       CMDLBL(ENDPGM)
             ENDDO
             GOTO       CMDLBL(OVERFOR)
             ENDDO

/* Varselbilde dersom poster ikke finnes i LONREPF     EAS01         */

             IF         COND(&SYST *EQ 'LONN') THEN(DO)

/* Legger LONPGMBT inn i biblioteksliste                             */

             ADDLIBLE   LIB(LONPGMBT)
             MONMSG     MSGID(CPF2103)

/* Valg av klientgruppe                                          */

             CALL       PGM(LON550R)

             CHGVAR     VAR(&WPLIB) VALUE(%SST(*LDA 800 8))

             ADDLIBLE   LIB(&WPLIB)
             MONMSG     MSGID(CPF2103)

             CHKOBJ     OBJ(*LIBL/LONREPF) OBJTYPE(*FILE) +
                          MBR(*FIRST) /* EAS01 */
             MONMSG     MSGID(CPF9801) EXEC(DO)
             CHGVAR     VAR(&WALI) VALUE(10)
             CHGVAR     VAR(&WAPO) VALUE(26)
             CHGVAR     VAR(&MLD1) VALUE('Ingen poster fra 3P LØNN ')
             CHGVAR     VAR(&MLD2) VALUE('Rutinen avsluttes ...... ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
             DLYJOB     DLY(5)
             GOTO       CMDLBL(ENDPGM)
             ENDDO
             GOTO       CMDLBL(OVERFOR)
             ENDDO

/* Varselbilde dersom poster ikke finnes i scannefil MultiSupport    */

             IF         COND(&SYST *EQ 'MULT') THEN(DO)
             CHKOBJ     OBJ(*LIBL/REMSPF) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(DO)
             CHGVAR     VAR(&WALI) VALUE(10)
             CHGVAR     VAR(&WAPO) VALUE(26)
             CHGVAR     VAR(&MLD1) VALUE('Ingen poster fra Scanning')
             CHGVAR     VAR(&MLD2) VALUE('Rutinen avsluttes ...... ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
             DLYJOB     DLY(5)
             GOTO       CMDLBL(ENDPGM)
             ENDDO
             GOTO       CMDLBL(OVERFOR)
             ENDDO

/* Varselbilde dersom poster ikke finnes i scannefil fra Compello    */

             IF         COND(&SYST *EQ 'COMP') THEN(DO)
             CHKOBJ     OBJ(*LIBL/REMSPF) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(DO)
               CHGVAR     VAR(&WALI) VALUE(10)
               CHGVAR     VAR(&WAPO) VALUE(26)
               CHGVAR     VAR(&MLD1) VALUE('Ingen poster fra Scanning')
               CHGVAR     VAR(&MLD2) VALUE('Rutinen avsluttes ...... ')
               CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
               DLYJOB     DLY(5)
               GOTO       CMDLBL(ENDPGM)
             ENDDO
             GOTO       CMDLBL(OVERFOR)
             ENDDO

/* Varselbilde dersom poster ikke finnes i returfil MultiSupport     */

             IF         COND(&SYST *EQ 'FLOW') THEN(DO)
             CHKOBJ     OBJ(*LIBL/ACCPOSF5) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(DO)
             CHGVAR     VAR(&WALI) VALUE(10)
             CHGVAR     VAR(&WAPO) VALUE(26)
             CHGVAR     VAR(&MLD1) VALUE('Ingen poster fra WorkFlow')
             CHGVAR     VAR(&MLD2) VALUE('Rutinen avsluttes ...... ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
             DLYJOB     DLY(5)
             GOTO       CMDLBL(ENDPGM)
             ENDDO
             GOTO       CMDLBL(OVERFOR)
             ENDDO

/* Varselbilde dersom poster ikke finnes i LOVFPF/BEST               */

             IF         COND(&SYST *EQ 'BEST') THEN(DO)
             CHGVAR     VAR(%SST(&MEMB 1 4))  VALUE('FLOW')
             CHKOBJ     OBJ(*LIBL/LOVFPF) OBJTYPE(*FILE) MBR(&MEMB)
             MONMSG     MSGID(CPF9801) EXEC(DO)
             CHGVAR     VAR(&WALI) VALUE(10)
             CHGVAR     VAR(&WAPO) VALUE(26)
             CHGVAR     VAR(&MLD1) VALUE('Ingen poster fra INN.FAKT')
             CHGVAR     VAR(&MLD2) VALUE('Rutinen avsluttes ...... ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
             DLYJOB     DLY(5)
             GOTO       CMDLBL(ENDPGM)
             ENDDO
             GOTO       CMDLBL(OVERFOR)
             ENDDO

/* Denne overføring er ikke spesifisert                              */

             CHGVAR     VAR(&WALI) VALUE(10)
             CHGVAR     VAR(&WAPO) VALUE(26)
             CHGVAR     VAR(&MLD1) VALUE('Denne type overføring er ')
             CHGVAR     VAR(&MLD2) VALUE('ikke definert i RF1TRANS ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
             DLYJOB     DLY(5)
             GOTO       CMDLBL(ENDPGM)
/* Varselbilde 2                                                     */
OVERFOR:
             CHGVAR     VAR(&WALI) VALUE(13)
             CHGVAR     VAR(&WAPO) VALUE(32)
             CHGVAR     VAR(&MLD1) VALUE('Vennligst vent ..........')
             CHGVAR     VAR(&MLD2) VALUE('Posteringer overføres ...')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)

/* Bygger membernavn fra delsystem                                   */

             CHGVAR     VAR(&MBTX) VALUE('Poster fra delsystem ' +
                                   *CAT &SYST)

/* Bygger membere dersom de ikke finnes                              */

/*           CHKOBJ     OBJ(RBUNPF)    OBJTYPE(*FILE) MBR(&MEMB)     */
/*           MONMSG     MSGID(CPF9815) EXEC(DO)                      */
/*           ADDPFM     FILE(RBUNPF) MBR(&MEMB) TEXT(&MBTX)          */
/*           ENDDO                                                   */

/*           CHKOBJ     OBJ(RBUNL1)    OBJTYPE(*FILE) MBR(&MEMB)     */
/*           MONMSG     MSGID(CPF9815) EXEC(DO)                      */
/*           ADDLFM     FILE(RBUNL1) MBR(&MEMB) DTAMBRS((RBUNPF +    */
/*                        (&MEMB))) TEXT(&MBTX)                      */
/*           ENDDO                                                   */

/*           CHKOBJ     OBJ(RBUNLU)    OBJTYPE(*FILE) MBR(&MEMB)     */
/*           MONMSG     MSGID(CPF9815) EXEC(DO)                      */
/*           ADDLFM     FILE(RBUNLU) MBR(&MEMB) DTAMBRS((RBUNPF +    */
/*                        (&MEMB))) TEXT(&MBTX)                      */
/*           ENDDO                                                   */

/*           CHKOBJ     OBJ(RTRAPF)    OBJTYPE(*FILE) MBR(&MEMB)     */
/*           MONMSG     MSGID(CPF9815) EXEC(DO)                      */
/*           ADDPFM     FILE(RTRAPF) MBR(&MEMB) TEXT(&MBTX)          */
/*           ENDDO                                                   */

/*           CHKOBJ     OBJ(RTRAL1)    OBJTYPE(*FILE) MBR(&MEMB)     */
/*           MONMSG     MSGID(CPF9815) EXEC(DO)                      */
/*           ADDLFM     FILE(RTRAL1) MBR(&MEMB) DTAMBRS((RTRAPF +    */
/*                        (&MEMB))) TEXT(&MBTX)                      */
/*           ENDDO                                                   */

/*           CHKOBJ     OBJ(RTRALU)    OBJTYPE(*FILE) MBR(&MEMB)     */
/*           MONMSG     MSGID(CPF9815) EXEC(DO)                      */
/*           ADDLFM     FILE(RTRALU) MBR(&MEMB) DTAMBRS((RTRAPF +    */
/*                        (&MEMB))) TEXT(&MBTX)                      */
/*           ENDDO                                                   */

/* Overføring av poster fra AS Ordre/Fakturering                     */

             IF         COND(&SYST *EQ 'FAKT') THEN(DO)
 /*          OVRDBF     FILE(RBUNLU)   MBR(&MEMB)                    */
 /*          OVRDBF     FILE(RTRAPF)   MBR(&MEMB)                    */
             CALL       PGM(RFA15R)  PARM(&MEMB)
 /*          CLRPFM     FILE(*LIBL/FOVFPF) MBR(*FIRST)               */
             MONMSG     MSGID(CPF3200)
             ENDDO

/* Overføring av poster fra AS Shop                                  */

             IF         COND(&SYST *EQ 'SHOP') THEN(DO)
/*           OVRDBF     FILE(RBUNLU)   MBR(&MEMB)                    */
/*           OVRDBF     FILE(RTRAPF)   MBR(&MEMB)                    */
             CALL       PGM(RFB15R) PARM(&MEMB)
/*           CLRPFM     FILE(*LIBL/BOVFPF) MBR(*FIRST)               */
             MONMSG     MSGID(CPF3200)
             ENDDO

/* Overføring av poster fra AS Lager/Innkjøp                         */

             IF         COND(&SYST *EQ 'LAGR') THEN(DO)
 /*          OVRDBF     FILE(RBUNLU)   MBR(&MEMB)                    */
 /*          OVRDBF     FILE(RTRAPF)   MBR(&MEMB)                    */
 /*          OVRDBF     FILE(LOVFL1)   MBR(&MEMB)                    */
             CALL       PGM(RFI15R) PARM(&MEMB)
 /*          CLRPFM     FILE(*LIBL/LOVFPF) MBR(*FIRST)               */
             MONMSG     MSGID(CPF3200)
             ENDDO

/* Overføring av poster fra AS Lager/Innkjøp (INNG.FAKT)             */

             IF         COND(&SYST *EQ 'BEST') THEN(DO)
 /*          OVRDBF     FILE(RBUNLU)   MBR(&MEMB)                    */
 /*          OVRDBF     FILE(RTRAPF)   MBR(&MEMB)                    */
 /*          OVRDBF     FILE(LOVFL1)   MBR(&MEMB)                    */
             CALL       PGM(RFI15R) PARM(&MEMB)
 /*          CLRPFM     FILE(*LIBL/LOVFPF) MBR(*FIRST)               */
             MONMSG     MSGID(CPF3200)
             ENDDO

/* Overføring av poster fra MultiSupport - Preregistrering           */

             IF         COND(&SYST *EQ 'MULT') THEN(DO)
             CALL       WFIMPORT
/*           OVRDBF     FILE(RBUNLU)   MBR(&MEMB)                    */
/*           OVRDBF     FILE(RTRAPF)   MBR(&MEMB)                    */
             CALL       PGM(RFP15R) PARM(&MEMB)
/*           CLRPFM     FILE(*LIBL/REMSPF) MBR(*FIRST)               */
             MONMSG     MSGID(CPF3200)
             ENDDO

/* Overføring av poster fra Compello     - Preregistrering           */

             IF         COND(&SYST *EQ 'COMP') THEN(DO)
     /*  Sjekk om regler er satt vedr periode i COMPRfff hvor fff = firmanr.  */
               chgdtaara  dtaara(*lda (100 30)) value('          ')
               chgvar     var(&cmprf) value('COMPR' *cat &ffir)
               rtvdtaara  dtaara(&cmprf) rtnvar(&cmpr)
               monmsg     msgid(cpf1015) exec(do)
                 goto     cmdlbl(nocmpreg)
               enddo
               chgdtaara  dtaara(*lda (100 10)) +
                          value(%substring(&cmpr 1 10))
/*  20.06.2011 sst */
               chgvar     var(&ip)   value(%substring(&cmpr 9 15))
               chgvar     var(&port) value(%substring(&cmpr 24 4))
               chgvar     var(&par1) value('start http://' *tcat +
                          (&ip) *tcat +
                          ':' *cat +
                          (&port) *cat +
                          '/compelloserver-1.0/' *cat +
                          'export-servlet?filgruppe=ADB' *cat +
                          &fgrp *cat +
                          '^&firma=' *cat +
                          &ffir)
             strpco
             monmsg       msgid(cpf0000 iws4010)
             strpccmd     pccmd(&par1) pause(*no)

nocmpreg:
/*  Foreløpig kopi av alle overførte transer fra Compello til remspfb   */
             CPYF       FROMFILE(REMSPF) TOFILE(REMSPFB) +
                          MBROPT(*ADD) CRTFILE(*NO)
             monmsg     msgid(cpf2817 cpf2861) exec(do)
             CPYF       FROMFILE(REMSPF) TOFILE(*CURLIB/REMSPFB) +
                          CRTFILE(*YES)
             CHGPF      FILE(REMSPFB) SIZE(*NOMAX)
             monmsg     msgid(cpf0000)
             enddo
/*             OVRDBF     FILE(RBUNLU)   MBR(&MEMB)                  */
/*             OVRDBF     FILE(RTRAPF)   MBR(&MEMB)                  */
/*   Tildele periode i recordene dersom dette ikke er gjort fra Comp */
               CALL       PGM(RFP14R) PARM(&MEMB)
/*   Bygger transer for dette firma og filgruppe                     */
               CALL       PGM(RFP15R) PARM(&MEMB)
/*   NB!! trans slettes i RFP15R da ikke alle firma kjøres samtidig  */
/*             CLRPFM     FILE(*LIBL/REMSPF) MBR(*FIRST)             */
/*             MONMSG     MSGID(CPF3200)                             */

/*   Dersom det posteres på avsluttet periode gis melding om dette  */

               rtvdtaara  dtaara(*lda (110 1)) rtnvar(&fper)
               if         cond(&fper *eq 'J') then(do)
                 chgvar     var(&wali) value(12)
                 chgvar     VAR(&wapo) value(35)
                 chgvar     VAR(&mld1) value('Det ligger posteringer her ')
                 chgvar     VAR(&mld2) value('på avsluttet periode...... ')
                 call       pgm(aa006c)  parm(&wali &wapo &mld1 &mld2)
                 dlyjob     dly(5)
               enddo
             enddo

/* Overføring av poster fra MultiSupport - Flow                      */

             IF         COND(&SYST *EQ 'FLOW') THEN(DO)

             ADDLIBLE   LIB(&MALIB)
             MONMSG     MSGID(CPF2103)

/*           Generer logisk file - ACCPOSL2  hvis ikke finnes        */

             CHKOBJ OBJ(*CURLIB/ACCPOSL2) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(DO)

             CRTLF      FILE(*CURLIB/ACCPOSL2) +
                          SRCFILE(*LIBL/QDDFSRC) MAXMBRS(*NOMAX) +
                          SRTSEQ(*LANGIDUNQ)     LANGID(NOR)
             MONMSG     MSGID(CPF7302)

             ENDDO

             CALL       PGM(RFM14R)

/*           OVRDBF     FILE(RBUNLU)   MBR(&MEMB)                 */
/*           OVRDBF     FILE(RTRAPF)   MBR(&MEMB)                 */
             CALL       PGM(RFM15R) PARM(&MEMB)
             MONMSG     MSGID(CPF3200)
             ENDDO

/* Overføring av poster fra AS Lager/Innkjøp (INNG.FAKT)             */

             IF         COND(&SYST *EQ 'BEST') THEN(DO)
/*           OVRDBF     FILE(RBUNLU)   MBR(&MEMB)                    */
/*           OVRDBF     FILE(RTRAPF)   MBR(&MEMB)                    */
/*           OVRDBF     FILE(LOVFL1)   MBR(&MEMB)                    */
             CALL       PGM(RFI15R) PARM(&MEMB)
             CLRPFM     FILE(*LIBL/LOVFPF) MBR(&MEMB)
             MONMSG     MSGID(CPF3200)
             ENDDO


/* Overføring av poster fra 3P Lønn                                  */

             IF         COND(&SYST *EQ 'LONN') THEN(DO)
/*           OVRDBF     FILE(RBUNLU)   MBR(&MEMB)                    */
/*           OVRDBF     FILE(RTRAPF)   MBR(&MEMB)                    */
             CALL       PGM(RLØ16R) PARM(&MEMB &MLD3 &MLD4)
             RMVLIBLE   LIB(&WPLIB)
             ENDDO

ENDPGM:      ENDPGM
