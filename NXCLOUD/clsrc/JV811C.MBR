             PGM        PARM(&DIRE &FILE &ZIPF &NFIL)

/* Definering av parametre.                                          */

             DCL        VAR(&DIRE) TYPE(*CHAR) LEN(50)
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(50)
             DCL        VAR(&NFIL) TYPE(*CHAR) LEN(50)
             DCL        VAR(&ZFIL) TYPE(*CHAR) LEN(50)
             DCL        VAR(&ZIPF) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FIRM) TYPE(*DEC)  LEN(3 0) VALUE(000)

/* Definering av variable                                            */

             DCL        VAR(&CLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&IFIL) TYPE(*CHAR) LEN(50) VALUE(' ')
             DCL        VAR(&DFIL) TYPE(*CHAR) LEN(70)
             DCL        VAR(&JAVA) TYPE(*CHAR) LEN(1000)


/* Fjerner dummy-verdi bakerst i mottatte parametre                  */

             CHGVAR     VAR(&DIRE) VALUE(%SUBSTRING(&DIRE 1 49))
             CHGVAR     VAR(&FILE) VALUE(%SUBSTRING(&FILE 1 49))
             CHGVAR     VAR(&NFIL) VALUE(%SUBSTRING(&NFIL 1 49))


/* Pakker ut zipp                                                    */
             IF         COND(&ZIPF *EQ '1') THEN(DO)
             CHGVAR     VAR(&JAVA) VALUE('java asp.zip.UnpackZip -z' +
                          *TCAT &DIRE *TCAT '/' *TCAT &FILE *BCAT +
                          '-d' *TCAT &DIRE *TCAT '/')
             QSH        CMD(&JAVA)
             CHGVAR     VAR(&ZFIL) VALUE(&DIRE *TCAT '/' *TCAT &FILE)
             RMVLNK OBJLNK(&ZFIL)
             CHGVAR     VAR(&FILE) VALUE(&NFIL)
             ENDDO

/*           SNDMSG     MSG('JV811C/Start: ' *TCAT &FILE) +   */
/*                        TOUSR(ASP_xxx)                      */

/* Henter current library                                            */

             RTVJOBA    CURLIB(&CLIB)

/* Oppretter temporær fil og kopierer mottatt fil inn i denne        */

             DLTF       FILE(FTPNIBX)
             MONMSG     MSGID(CPF2105)
             CRTPF      FILE(FTPNIBX) RCDLEN(400) TEXT('Temporær +
                          fil') SIZE(*NOMAX)
             CHGVAR     VAR(&IFIL) VALUE(&DIRE *TCAT '/' *TCAT &FILE)
             CHGVAR     VAR(&DFIL) VALUE('/qsys.lib/' *TCAT &CLIB +
                          *TCAT '.lib/FTPNIBX.file/FTPNIBX.mbr')
             CPYFRMSTMF FROMSTMF(&IFIL) TOMBR(&DFIL) MBROPT(*REPLACE)

/* Behandler mottatt fil avhengig av filnavn                         */

 DELTAKER:   IF         COND(&FILE *EQ DELTAKER.XML) THEN(DO)
             CPYF       FROMFILE(FTPNIBX) TOFILE(NXDEPF) +
                          MBROPT(*ADD) FMTOPT(*NOCHK)
             CALL       PGM(JV840R) PARM(&FIRM)
             DEL        OBJLNK(&IFIL)
             RGZPFM     FILE(NXDEPF)
             MONMSG     MSGID(CPF2900)
             GOTO       CMDLBL(END)
             ENDDO

 PRODUSENT:  IF         COND(&FILE *EQ PRODUSNT.XML) THEN(DO)
             CPYF       FROMFILE(FTPNIBX) TOFILE(NXPRPF) +
                          MBROPT(*ADD) FMTOPT(*NOCHK)
             CALL       PGM(JV841R) PARM(&FIRM)
             DEL        OBJLNK(&IFIL)
             RGZPFM     FILE(NXPRPF)
             MONMSG     MSGID(CPF2900)
             GOTO       CMDLBL(END)
             ENDDO

 VAREGRP:    IF         COND(&FILE *EQ VAREGRP.XML) THEN(DO)
             CPYF       FROMFILE(FTPNIBX) TOFILE(NXVGPF) +
                          MBROPT(*ADD) FMTOPT(*NOCHK)
             CALL       PGM(JV842R) PARM(&FIRM)
             DEL        OBJLNK(&IFIL)
             RGZPFM     FILE(NXVGPF)
             MONMSG     MSGID(CPF2900)
             GOTO       CMDLBL(END)
             ENDDO

 MODUL:      IF         COND(&FILE *EQ MODUL.XML) THEN(DO)
             CPYF       FROMFILE(FTPNIBX) TOFILE(NXMOPF) +
                          MBROPT(*ADD) FMTOPT(*NOCHK)
             CALL       PGM(JV845R) PARM(&FIRM)
             DEL        OBJLNK(&IFIL)
             RGZPFM     FILE(NXMOPF)
             MONMSG     MSGID(CPF2900)
             GOTO       CMDLBL(END)
             ENDDO

 VARE:       IF         COND(&FILE *EQ VARE.XML) THEN(DO)
             CPYF       FROMFILE(FTPNIBX) TOFILE(NXVAPF) +
                          MBROPT(*ADD) FMTOPT(*NOCHK)
             CALL       PGM(JV850R) PARM(&FIRM)
             DEL        OBJLNK(&IFIL)
             RGZPFM     FILE(NXVAPF)
             MONMSG     MSGID(CPF2900)
             GOTO       CMDLBL(END)
             ENDDO

 PRIS:       IF         COND(&FILE *EQ PRIS.XML) THEN(DO)
             CPYF       FROMFILE(FTPNIBX) TOFILE(NXVPPF) +
                          MBROPT(*ADD) FMTOPT(*NOCHK)
             CALL       PGM(JV851R) PARM(&FIRM)
             DEL        OBJLNK(&IFIL)
             RGZPFM     FILE(NXVPPF)
             MONMSG     MSGID(CPF2900)
             GOTO       CMDLBL(END)
             ENDDO

 VARE_UTG:   IF         COND(&FILE *EQ VARE_UTG.XML) THEN(DO)
/*           CPYF       FROMFILE(FTPNIBX) TOFILE(NXVSPF)      */
             CPYF       FROMFILE(FTPNIBX) TOFILE(NXVAPF) +
                          MBROPT(*ADD) FMTOPT(*NOCHK)
             CALL       PGM(JV850R) PARM(&FIRM)
             DEL        OBJLNK(&IFIL)
             RGZPFM     FILE(NXVAPF)
             MONMSG     MSGID(CPF2900)
             GOTO       CMDLBL(END)
             ENDDO

 BETINGELSE: IF         COND(&FILE *EQ BETING.XML) THEN(DO)
             CPYF       FROMFILE(FTPNIBX) TOFILE(NXBEPF) +
                          MBROPT(*ADD) FMTOPT(*NOCHK)
             CALL       PGM(JP730R) PARM(&FIRM)
             DEL        OBJLNK(&IFIL)
             RGZPFM     FILE(NXBEPF)
             MONMSG     MSGID(CPF2900)
             GOTO       CMDLBL(END)
             ENDDO

 KAMPANJE:   IF         COND(&FILE *EQ KAMPANJE.XML) THEN(DO)
             CPYF       FROMFILE(FTPNIBX) TOFILE(NXKAPF) +
                          MBROPT(*ADD) FMTOPT(*NOCHK)
             CALL       PGM(JM730R) PARM(&FIRM)
             DEL        OBJLNK(&IFIL)
             RGZPFM     FILE(NXKAPF)
             MONMSG     MSGID(CPF2900)
             GOTO       CMDLBL(END)
             ENDDO

 KALKYLE:    IF         COND(&FILE *EQ KALKYLE.XML) THEN(DO)
             ENDDO

 END:
/*           SNDMSG     MSG('JV811C/Slutt: ' *TCAT &FILE) +        */
/*                        TOUSR(ASP_xxx)                           */
             ENDPGM
