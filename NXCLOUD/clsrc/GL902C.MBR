
             PGM        PARM(&FGRP &FIRM)

             DCL        VAR(&FGRP) TYPE(*CHAR) LEN(3)
             DCL        VAR(&FIRM) TYPE(*CHAR) LEN(3)
             DCL        VAR(&FDIR) TYPE(*CHAR) LEN(6) VALUE('DIRREM')

             DCL        VAR(&FREM8) TYPE(*CHAR) LEN(8)
             DCL        VAR(&FMOT8) TYPE(*CHAR) LEN(8)
             DCL        VAR(&FAVR8) TYPE(*CHAR) LEN(8)
             DCL        VAR(&FOCR8) TYPE(*CHAR) LEN(8)
             DCL        VAR(&FKTO8) TYPE(*CHAR) LEN(8)
             DCL        VAR(&FINK8) TYPE(*CHAR) LEN(8)
             DCL        VAR(&FTFF8) TYPE(*CHAR) LEN(8)

             DCL        VAR(&FREM) TYPE(*CHAR) LEN(20)
             DCL        VAR(&FMOT) TYPE(*CHAR) LEN(20)
             DCL        VAR(&FAVR) TYPE(*CHAR) LEN(20)
             DCL        VAR(&FOCR) TYPE(*CHAR) LEN(20)
             DCL        VAR(&FKTO) TYPE(*CHAR) LEN(20)
             DCL        VAR(&FINK) TYPE(*CHAR) LEN(20)
             DCL        VAR(&FTFF) TYPE(*CHAR) LEN(20)

             DCL        VAR(&FIFS) TYPE(*CHAR) LEN(45)
             DCL        VAR(&IFSV) TYPE(*CHAR) LEN(65)
             DCL        VAR(&IFSD) TYPE(*CHAR) LEN(65)

             DCL        VAR(&KOMM) TYPE(*CHAR) LEN(4)
             DCL        VAR(&BANK) TYPE(*CHAR) LEN(2) VALUE('DN')
             DCL        VAR(&IN03) TYPE(*DEC) LEN(1 0) VALUE(2)
             DCL        VAR(&LINJ) TYPE(*DEC) LEN(2 0) VALUE(2)
             DCL        VAR(&POSI) TYPE(*DEC) LEN(3 0) VALUE(43)

             DCL        VAR(&BIBL) TYPE(*CHAR) LEN(6)
             DCL        VAR(&PATH) TYPE(*CHAR) LEN(50)
             DCL        VAR(&BANE1) TYPE(*CHAR) LEN(10) +
                          VALUE('/qsys.lib/')
             DCL        VAR(&BANE2) TYPE(*CHAR) LEN(27) +
                          VALUE('.lib/gstrpf.file/gstrpf.mbr')
             DCL        VAR(&tild)  TYPE(*CHAR) LEN(25)
             DCL        VAR(&fraf)  TYPE(*CHAR) LEN(10)

/* Henter *CURLIB:                                                   */
             RTVDTAARA  DTAARA(*LDA (934 6)) RTNVAR(&BIBL)

/*   Bygger path til bruk i IFS-kommandoen:                          */
             CHGVAR     VAR(&PATH) VALUE(&BANE1 *CAT &BIBL *CAT &BANE2)

/* Henter IFS-Mappenavn.                                             */

             CALL       PGM(GL119R) PARM(&KOMM &BANK &IN03 +
                          &LINJ &POSI &FIFS)

/* Bygger GSTRPF:                                                    */
/*           CRTPF      FILE(ADB/GSTRPF) RCDLEN(160) SIZE(*NOMAX)    */
/*           MONMSG     MSGID(CPF0000)                               */

/* Tømmer hjelpefilen GSTRPF:                                        */
/*                                                                   */
             CLRPFM     FILE(*LIBL/GSTRPF) /* Hjelpefile for +
                          overføring av data fra datastrømfiler til +
                          databasene til ASTELE */
/*                                                                   */
/* Overfører DIRREM til GSTRPF (Sourcefile):                         */
/*                                                                   */
             CPYF       FROMFILE(*LIBL/DIRREM) TOFILE(*LIBL/GSTRPF) +
                          MBROPT(*REPLACE) FMTOPT(*NOCHK)
             MONMSG     MSGID(CPF0000)
/*                                                                   */
/* Overfører GSTRPF til datastrømfile:                               */
/*                                                                   */
             CHGVAR     VAR(&IFSD) VALUE(&FIFS *TCAT &FDIR)
/*                                                                   */
             CPYTOSTMF  FROMMBR(&PATH) TOSTMF(&IFSD) +
                          STMFOPT(*REPLACE) STMFCODPAG(*PCASCII)
             CHGAUT     OBJ(&IFSD) USER(*PUBLIC) DTAAUT(*RWX) +
                          OBJAUT(*ALL)
             MONMSG     MSGID(CPF0000)

/* Kopierer deretter remitteringsfile som kan navnestyres pr.        */
/* firma, over til bankfiler:                                        */

             CALL       PGM(GL320C) PARM(&FGRP &FIRM &FREM &FMOT +
                          &FAVR &FOCR &FKTO &FINK &FTFF)

/* Hopper ut dersom mottaksretur IKKE er utfylt.  Dette indikerer at */
/* sammenslåing av returfiler skjer i egen bat-fil på PC'n, og at    */
/* sammenslåing her IKKE skal gjøres.                                */

             IF         COND(&FREM *EQ '        ') THEN(DO)
             GOTO       CMDLBL(IKKEBRUK)
             ENDDO

             CHGVAR     VAR(&IFSV) VALUE(&FIFS *TCAT &FREM)
             CHGVAR     VAR(&FREM8) VALUE(%SST(&FREM 1 8))

             CPYTOSTMF  FROMMBR(&PATH) TOSTMF(&IFSV) +
                          STMFOPT(*REPLACE) STMFCODPAG(*PCASCII)
             CHGAUT     OBJ(&IFSV) USER(*PUBLIC) +
                          DTAAUT(*RWX) OBJAUT(*ALL)
             MONMSG     MSGID(CPFA0B1) /* hvis filen finnes fra før, og +
                          bruker ikke er eier, feiler chgaut */
/*           CPYTOPCD   FROMFILE(*LIBL/&FREM) TOFLR(PCFILER) +   */
/*                        TODOC(&FREM8) REPLACE(*YES)            */
             chgvar     var(&tild) value(&frem8)
             chgvar     var(&fraf) value(&frem)
             call       pgm(asptostmf) +
                        parm(&fraf +
                             &fraf +
                             'PCFILER             ' +
                             &tild   +
                             '   ')
               MONMSG     MSGID(CPF0000)
 IKKEBRUK:

 ENDPGM:     ENDPGM
