             PGM        PARM(&MEMB)
/*-------------------------------------------------------------------*/
/* 7.01 101120 bsa Parameter som sendes inn og mellom FO616 og FO946 */
/* 7.01            er forskjellig. Må synkronisers.                  */
/* 7.02 261120 ask Lagt inn switch-styrt danning av kostposteringer  */
/*                                                                   */
/* 8.01 010824 bsa Gir mulighet for samlefakturering. Primært P/PN.  */
/* 8.02 211124 bsa Kjører summering av faktura uansett om det er     */
/* 8.02            samling eller ikke. Da vil vi løse problemet med  */
/* 8.02            ordre som "burde" byttet ordretype.               */
/* 8.03 091024 ask Endret switch navn på kostføring                  */
/*                                                                   */
/*                                                                   */
/*                                                                   */
/*                                                                   */
/*------------------------------------------------------------------ */

/* Initiering av parametere                                          */

             DCL        VAR(&MEMB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PROG) TYPE(*CHAR) LEN(10)
/*7.01*/     DCL        VAR(&PARM) TYPE(*CHAR) LEN(34)

             DCL        VAR(&CO402_KEY) TYPE(*CHAR) LEN(50)
             DCL        VAR(&CO402_V1)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&CO402_V2)  TYPE(*CHAR) LEN(2048)
             dcl        var(&map)       type(*char) len(70)
             dcl        var(&grp)       type(*char) len(10)
             dcl        var(&fgr)       type(*char) len(3)
             dcl        var(&fix)       type(*char) len(3)
             dcl        var(&fir)       type(*dec)  len(3 0) value(0)
             dcl        var(&lag)       type(*dec)  len(3 0) value(0)
/*8.01*/     dcl        var(&otyp) type(*char) len(2)

/* Hente inn fra LDA                                                 */

             RTVDTAARA  DTAARA(*LDA (871 10)) RTNVAR(&PROG)
             RTVDTAARA  DTAARA(*LDA (1023 2)) RTNVAR(&otyp)

/* Override parameterfilene/membrene                                 */

             OVRDBF     FILE(FPSOL1) TOFILE(*FILE) MBR(&MEMB)

/* Call av sjekk om summering av samlet fakturering                  */

/*8.02       if         cond(&otyp *EQ '99') then(do)                */
/*8.01*/       call       pgm(FO621R) parm(&parm)
/*8.02       enddo                                                   */

/* Call av oppdateringsprogram                                       */

             CALL       PGM(FO616R) PARM(&PARM)

/* Danner kostprisposteringer fra statistikk om switch er satt       */

             /*8.03*/
             CHGVAR     VAR(&CO402_KEY) VALUE('POST_KOST') /*8.03*/
             rtvdtaara  dtaara(*lda (931 3)) rtnvar(&fgr)
             rtvdtaara  dtaara(*lda (944 3)) rtnvar(&fix)
             chgvar     var(&fir)   value(&fix)
             CALL       PGM(CO402R) PARM(&FGR &FIR &LAG &CO402_KEY +
                          &CO402_V1 &CO402_V2)

             IF         COND(&CO402_V1 *EQ '1') THEN(do)
                CALL       PGM(FO617R)
             enddo

/* Override av parametermembrene oppheves                            */

             DLTOVR     FILE(FPSOL1)

/* Kaller opp program for utskrift   (Fakt/Kred)                     */

             CALL       PGM(&PROG) PARM(&PARM)

             ENDPGM
