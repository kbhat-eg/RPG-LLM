             PGM        PARM(&HEAD &TEXT &TYPE)

             DCL        VAR(&HEAD) TYPE(*CHAR) LEN(180)
             DCL        VAR(&TEXT) TYPE(*CHAR) LEN(512)
             DCL        VAR(&TYPE) TYPE(*CHAR) LEN(1)

             DCL        VAR(&CURUSR) TYPE(*CHAR) LEN(10)
             DCL        VAR(&SUBJ) TYPE(*CHAR) LEN(200)

             DCL        VAR(&SYSNAM) TYPE(*CHAR) LEN(8)
             DCL        VAR(&LIBTXT) TYPE(*CHAR) LEN(50)
             DCL        VAR(&DLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&MSER) TYPE(*CHAR) LEN(35)
             DCL        VAR(&STATUS) TYPE(*CHAR) LEN(1)

             RTVJOBA    CURUSER(&CURUSR) CURLIB(&DLIB)
             RTVNETA    SYSNAME(&SYSNAM)
             RTVLIBD    LIB(&DLIB) TEXT(&LIBTXT)

/* Henter ut mailserver */

             CALL       PGM(AM705C) PARM(&MSER &STATUS)
             IF         COND(&STATUS *NE ' ') THEN(DO)
             GOTO       CMDLBL(GENERROR)
             ENDDO

             IF         COND(&TYPE *EQ 'E') THEN(DO)
             CHGVAR     VAR(&SUBJ) VALUE('ERROR(' *TCAT &SYSNAM +
                          *TCAT ':' *BCAT &DLIB *BCAT '-' *BCAT +
                          &LIBTXT *TCAT ',' *BCAT &CURUSR *TCAT +
                          '):' *BCAT &HEAD)
             SNDMAIL    SERVER(&MSER) +
                          RECIPIENT('mads@asp-as.no') +
                          FROM('system@asp-as.no') +
                          SUBJECT(&SUBJ) MESSAGE(&TEXT) +
                          BMESSAGE('Asp as')
             SNDMAIL    SERVER(&MSER) +
                          RECIPIENT('tom.erik.watterud@asp-as.no') +
                          FROM('system@asp-as.no') SUBJECT(&SUBJ) +
                          MESSAGE(&TEXT) BMESSAGE('Asp as')
             ENDDO
             GOTO       CMDLBL(END)

GENERROR:
             CHGVAR     VAR(&SUBJ) VALUE('ERROR(' *TCAT &SYSNAM +
                          *TCAT ':' *BCAT &DLIB *BCAT '-' *BCAT +
                          &LIBTXT *TCAT ',' *BCAT &CURUSR *TCAT +
                          '):' *BCAT &HEAD)
             CHGVAR     VAR(&TEXT) VALUE('(' *TCAT &SUBJ *TCAT ')' +
                          *BCAT &TEXT)
             SNDMSG     MSG(&TEXT) TOUSR(*REQUESTER)

END:
             ENDPGM
