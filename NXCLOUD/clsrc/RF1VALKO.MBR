/* 03.05.11 NHO Sjekk om jobb er i bruk fra register RJOBPF          */
             PGM        PARM(&MEMB)

             DCL        VAR(&MEMB)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&WKUN)  TYPE(*DEC)  LEN(6 0)
             DCL        VAR(&WCAL)  TYPE(*DEC)  LEN(1 0)
             DCL        VAR(&BTCH)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&MEM1)  TYPE(*CHAR) LEN(10) VALUE('RFA      ')
             DCL        VAR(&MEM2)  TYPE(*CHAR) LEN(10) VALUE('RFB      ')
             DCL        VAR(&MEM3)  TYPE(*CHAR) LEN(10) VALUE('RFC      ')
             DCL        VAR(&IN03)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&WALI)  TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&WAPO)  TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&MLD1)  TYPE(*CHAR) LEN(30)
             DCL        VAR(&MLD2)  TYPE(*CHAR) LEN(30)
             DCL        VAR(&FEIL)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&TELL)  TYPE(*DEC)  LEN(7 0)
             DCL        VAR(&INFO)  TYPE(*CHAR) LEN(1)

/* Finn bruker + parameter for utskrift                              */

             RTVDTAARA  DTAARA(*LDA (863 1))  RTNVAR(&BTCH)
             CHGVAR VAR(%SST(&MEM1 4 7)) VALUE(&MEMB)
             CHGVAR VAR(%SST(&MEM2 4 7)) VALUE(&MEMB)
             CHGVAR VAR(%SST(&MEM3 4 7)) VALUE(&MEMB)
             CHGVAR VAR(&WKUN) VALUE(0)
             CHGVAR VAR(&WCAL) VALUE(1)
             chgdtaara  dtaara(*lda (1 10)) value(&memb)

/* Tømmer arbeidsfiler FØR kjøring                                  */

             CALL       PGM(RF701R) PARM(&MEM1)  /* RTRIPF */

             CALL       PGM(RF702R) PARM(&MEM1)  /* RJOULU */
             CALL       PGM(RF702R) PARM(&MEM2)  /* RJOULU */
             CALL       PGM(RF702R) PARM(&MEM3)  /* RJOULU */

/* Program for printerstyring                                        */

             CALL       PGM(AP600R) PARM('RF112 ' '1' '0' &IN03 &BTCH)

             IF         COND(&IN03 *EQ '1') THEN(GOTO CMDLBL(ENDPGM))


             IF         COND(&BTCH *NE '1') THEN(DO)
             CHGVAR     VAR(&WALI) VALUE(6)
             CHGVAR     VAR(&WAPO) VALUE(40)
             CHGVAR     VAR(&MLD1) VALUE('Vennligst vent ..........')
             CHGVAR     VAR(&MLD2) VALUE('Fordelinger pågår .......')
 /*          CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)  */
             ENDDO


/* Tømm aktuelt member i databasefilen                               */


/* Testrutine for å finne ut hvor den har hoppet ut                 */

             crtdtaara  dtaara(*curlib/tstkliko) type(*char) len(100) +
                          value('    ') text('Test av Rf1KLIKO')
             monmsg  msgid(cpf0000)
             chgdtaara  dtaara(tstkliko (1 100)) VALUE('     ')
             chgdtaara  dtaara(tstkliko (1 7)) VALUE('StartGR')

/* Call av fordelings-parametre                                      */

             CALL       PGM(RF102R) PARM(&MEM1 &MEMB)
             chgdtaara  dtaara(tstkliko (10 7)) VALUE('RF102RK')

/* Call av kontrollprogram                                           */

             CALL       PGM(RF104C) PARM(&MEM1 &FEIL &TELL)

    /*      Feil oppdaget av programmet   */
             IF         COND(&FEIL *NE ' ') THEN(DO)
     /*      GOTO       SLETT     */
             ENDDO

/* Varselbilde dersom poster ikke finnes                             */

             IF         COND(&TELL *EQ 0) THEN(DO)
             CHGVAR     VAR(&WALI) VALUE(10)
             CHGVAR     VAR(&WAPO) VALUE(26)
             CHGVAR     VAR(&MLD1) VALUE('Ingen poster finnes .... ')
             CHGVAR     VAR(&MLD2) VALUE('Rutinen avsluttes ...... ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
             GOTO       CMDLBL(SLETT)
             ENDDO

/* Call av oppsplitting                                              */

             IF         COND(&BTCH *NE '1') THEN(DO)
             CHGVAR     VAR(&WALI) VALUE(8)
             CHGVAR     VAR(&WAPO) VALUE(36)
             CHGVAR     VAR(&MLD1) VALUE('Vennligst vent ..........')
             CHGVAR     VAR(&MLD2) VALUE('Oppsplitting pågår ......')
 /*          CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2) */
             ENDDO

             CALL       PGM(RF105R) PARM(&MEM1)

/* Sett SWITCH = XXX0XXXX (U4 = Av)                                  */

             CHGJOB     SWS(XXX0XXXX) /* E5.01 */

             CALL       PGM(RF108R) PARM(&MEM1 &MEM2)

/* Summering av bilag                                                */

             CALL       PGM(RF109R) PARM(&MEM2 &MEM3 &MEMB)

/* Call av utskrift-program                                          */

             IF         COND(&BTCH *NE '1') THEN(DO)
             CHGVAR     VAR(&WALI) VALUE(12)
             CHGVAR     VAR(&WAPO) VALUE(28)
             CHGVAR     VAR(&MLD1) VALUE('Vennligst vent ..........')
             CHGVAR     VAR(&MLD2) VALUE('Utskrift pågår ..........')
    /*       CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2) */
             ENDDO

             CALL       PGM(RF112C) PARM(&MEM3)

 SLETT:

/* Opprydding i arbeids-filer                                        */

             CALL       PGM(RF701R) PARM(&MEM1)  /* RTRIPF */

             CALL       PGM(RF702R) PARM(&MEM3)  /* RJOULU */

 ENDPGM:

/* Sjekk jobbregister                                                */
             CHGVAR     VAR(&INFO) VALUE('S')
             CALL       PGM(RJ001R)    PARM(&MEMB &INFO)

             ENDPGM
