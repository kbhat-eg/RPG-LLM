/* 03.05.11 NHO Sjekk om jobb er i bruk fra register RJOBPF          */
/*6.30    11.10.16 NHO User må angis til 10 posisjoner               */
             PGM        PARM(&SYST)

             DCL        VAR(&SYST) TYPE(*CHAR) LEN(4)
             DCL        VAR(&FFIR)  TYPE(*CHAR) LEN(3)
             DCL        VAR(&USER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&WALI) TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&WAPO) TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&MLD1) TYPE(*CHAR) LEN(40)
             DCL        VAR(&MLD2) TYPE(*CHAR) LEN(40)
             DCL        VAR(&MEMB) TYPE(*CHAR) LEN(10)

             DCL        VAR(&INFO)  TYPE(*CHAR) LEN(1)

/* Sjekk om bilagsregistrering eller overføring fra delsystem        */

             IF         COND(&SYST *EQ 'BRUK') THEN(DO)
             RTVDTAARA  DTAARA(*LDA (911 10)) RTNVAR(&USER)
 /*          CHGVAR     VAR(%SST(&MEMB 1 7)) VALUE(&USER)        */
             CHGVAR     VAR(%SST(&MEMB 1 10)) VALUE(&USER)
             ENDDO

             IF         COND(&SYST *NE 'BRUK') THEN(DO)
             RTVDTAARA  DTAARA(*LDA (944 03)) RTNVAR(&FFIR)
             CHGVAR     VAR(%SST(&MEMB 1 4))  VALUE(&SYST)
             CHGVAR     VAR(%SST(&MEMB 5 3))  VALUE(&FFIR)
             ENDDO

/* Sjekk om posteringer finnes?!?                                    */
             CALL       PGM(RF700R) PARM(&MEMB)
             IF   COND(&MEMB *EQ ' ') THEN(DO)
             CHGVAR     VAR(&WALI) VALUE(4)
             CHGVAR     VAR(&WAPO) VALUE(2)
             CHGVAR     VAR(&MLD1) VALUE('KONTROLL-LISTE             ')
             CHGVAR     VAR(&MLD2) VALUE('Ingen posteringer finnes!! ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
             DLYJOB     DLY(5)
             GOTO       CMDLBL(ENDPGM)
             ENDDO

/* Sjekk jobbregister                                                */
             CALL       PGM(RJ001R)    PARM(&MEMB &INFO)

             IF         COND(&INFO *EQ '2') THEN(DO)
             CHGVAR     VAR(&WALI) VALUE(10)
             CHGVAR     VAR(&WAPO) VALUE(26)
             CHGVAR     VAR(&MLD1) VALUE('Rutinen er i bruk....... ')
             CHGVAR     VAR(&MLD2) VALUE('Rutinen avsluttes ...... ')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
             DLYJOB     DLY(5)
             GOTO       CMDLBL(ENDPGM)
             ENDDO


/* Varselbilde 1                                                     */

             CHGVAR     VAR(&WALI) VALUE(4)
             CHGVAR     VAR(&WAPO) VALUE(2)
             CHGVAR     VAR(&MLD1) VALUE('K O N T R O L L - L I S T E')
             CHGVAR     VAR(&MLD2) VALUE('***************************')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)


/* Call av utskriftsprogram                                          */

             CALL       PGM(RF1VALKO) PARM(&MEMB)

 ENDPGM:     ENDPGM
