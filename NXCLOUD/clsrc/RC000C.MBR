             PGM

/* Inkasso:  Kopierer alle asp\n50\inkasso\ut\backup\Innb*           */
/*           til *curlib/sventemp                                    */
/*                                                                   */

/* 7.01 R7.00 250220 BKV  Byttet AA006C med AA011C pga Newlook      */
/*                        Kommentert ut noen av AA006C              */

             DCL        VAR(&IN03)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&IN12)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&BTCH)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&MLD1)  TYPE(*CHAR) LEN(40)
             DCL        VAR(&MLD2)  TYPE(*CHAR) LEN(40)
             DCL        VAR(&MLD3)  TYPE(*CHAR) LEN(50)
             DCL        VAR(&MLD4)  TYPE(*CHAR) LEN(50)
             DCL        VAR(&SVAR)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&WALI)  TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&WAPO)  TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&FIRM)  TYPE(*CHAR) LEN(3)
             DCL        VAR(&MBER)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&filg)  TYPE(*CHAR) LEN(3)
             DCL        VAR(&fras)  TYPE(*CHAR) LEN(80) +
                             value('/asp/n50/inkasso/ut/Backup/')
             DCL        VAR(&tils)  TYPE(*CHAR) LEN(80) +
                             value('/')
             DCL        VAR(&tild)  TYPE(*CHAR) LEN(80)
             DCL        VAR(&tilf)  TYPE(*CHAR) LEN(60)
             DCL        VAR(&tlib)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&tmbr)  TYPE(*CHAR) LEN(10) value('RCNRPF')
             DCL        VAR(&posx)  TYPE(*dec)  LEN(2 0) value(5)
             DCL        VAR(&posy)  TYPE(*dec)  LEN(2 0) value(7)
             DCL        VAR(&i)     TYPE(*dec)  LEN(3 0)
             DCL        VAR(&j)     TYPE(*dec)  LEN(3 0)
             DCL        VAR(&mbrsz) TYPE(*dec)  LEN(10 0)

             dclf       file(*libl/Hentrcnr)

             rtvdtaara  dtaara(*lda (931 03))  rtnvar(&filg)
             rtvdtaara  dtaara(*lda (934 10))  rtnvar(&tlib)
/*           chgvar     var(%sst(&fras 6 03))  value(&filg)  */
/*           chgvar     var(%sst(&tils 6 03))  value(&filg)  */

             clrpfm     file(*libl/sventmp)
             monmsg     msgid(cpf3142) exec(do)
               crtpf    file(sventmp) rcdlen(1024) size(*nomax)
             enddo
             chgvar     var(&tilf) value('/qsys.lib/' *tcat &tlib +
                          *tcat '.lib/sventmp.file/' +
                          *tcat 'sventmp.mbr')

/*   Her finnes alle filer fra Svea,  Må ev deles i forskj. typer  */

             chgvar     var(%sst(&fras 27 06)) value('/Innb*')
             dsplnk     obj(&fras)  output(*print)
             monmsg     msgid(CPFA0A9) exec(do)
               chgvar   var(&mld1) value('Mappe eksisterer ikke å må bygges')
               chgvar   var(&mld2) value(&fras)
               call       pgm(aa011c) parm(&posx &posy &mld1 &mld2)
/*                dlyjob   dly(5)                                             */
               goto     cmdlbl(endpgm)
             enddo

logok:
      cpysplf    file(qsysprt) tofile(*curlib/Hentrcnr) +
                   splnbr(*last) jobsysname(*only)
      monmsg     msgid(cpf9812) exec(do)
        crtpf    file(*curlib/Hentrcnr) rcdlen(132)
        goto     cmdlbl(logok)
      enddo

      dltsplf    file(qsysprt) splnbr(*last)


rcv:         rcvf
             monmsg     msgid(cpf0864) exec(goto endpgm)
             if         cond(%sst(&hentrcnr 26 4) = 'STMF') then(do)
  /*           goto     cmdlbl(rcv)           */
             enddo
             chgvar     var(&i)  value(0)
nexti:       chgvar     var(&i)  value(&i + 1)
             if         cond(&i < 45) then(do)
               if       cond(%sst(&hentrcnr &i 3) = '.tx') then(do)
                 goto   cmdlbl(kopier)
               enddo
               else
                 do
                   goto cmdlbl(nexti)
                 enddo
             enddo
             else
               do
                 goto   cmdlbl(rcv)
             enddo
             goto       cmdlbl(nexti)

kopier:      chgvar     var(&j)    value(&i + 2)
             chgvar     var(%sst(&fras 28 47)) value(' ')
             chgvar     var(%sst(&fras 28 &j)) +
                        value(%sst(&hentrcnr 2 &j))

             cpyfrmstmf fromstmf(&fras) tombr(&tilf) mbropt(*add)

             goto       rcv

 ENDPGM:     ENDPGM
