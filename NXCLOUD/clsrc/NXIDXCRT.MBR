/*                                                                   */
/*-------------------------------------------------------------------*/
/* Program for å lage indexer                                        */
/*                                                                   */
/* angi filgrupppe og/eller lvrfilgruppe og/eller miljø              */
/*      og/eller tabell og/eller hva                                 */
/*                                                                   */
/* for mer info, se:                                                 */
/*    https://confluence.egretail.no/display/AS400/DBA+NX+indekser   */
/*                                                                   */
/* eks: CALL ASPGPLU630/IDXCRT PARM('630' 'ADBLVR630' 'A40')         */
/* eks: CALL ASPGPLU630/IDXCRT PARM('630' 'ADBLVR630' 'A40' 'VVARPF')*/
/* eks: CALL ASPGPLU630/IDXCRT PARM('630' 'ADBLVR630' 'A40' '*ALL')  */
/*                                                                   */
/*   hva:                                                            */
/*        (blank):  samme som 0                                      */
/*        0:  gjør 1 + 3                                             */
/*        1:  opprett SP                                             */
/*        2:  slett SP                                               */
/*        3:  kjør SP                                                */

             PGM       parm(&dlib &fgrp &LVRB_P &ENVB_P &TBLE_P &VER)

 /* Parametre                                                         */
             DCL        VAR(&FGRP)   TYPE(*CHAR) LEN(3)  /* Filgr    */
             DCL        VAR(&LVRB_P) TYPE(*CHAR) LEN(10)
             DCL        VAR(&ENVB_P) TYPE(*CHAR) LEN(3)
             DCL        VAR(&TBLE_P) TYPE(*CHAR) LEN(10)
             DCL        VAR(&dlib)   TYPE(*CHAR) LEN(10) /* Datalib  */

             DCL        VAR(&VER)       TYPE(*char) LEN(3)
             DCL        VAR(&ENVB)      TYPE(*CHAR) LEN(3)
             DCL        VAR(&sys)       TYPE(*CHAR) LEN(12)

             rtvneta    sysname(&sys)

             IF         COND(&TBLE_P *EQ ' ') THEN(DO)
                CHGVAR     VAR(&TBLE_P) VALUE('*ALL')
             ENDDO

             IF         COND(&VER *EQ ' ') THEN(DO)
                call       pgm(AR701R) parm(&sys &fgrp &VER)
             ENDDO


 /* FGR  */

             CHGCURLIB  CURLIB(&dlib)

             RUNSQL     SQL('CALL ADB.SP_NEXSTEP_CREATE_IX_' *CAT &VER +
                          *CAT '(''' *cat &dlib *bcat ''',''' *cat &TBLE_P +
                          *bcat ''')') COMMIT(*NONE) NAMING(*SYS) +
                          DECMPT(*COMMA) SRTSEQ(*LANGIDUNQ) LANGID(NOR)

      /* 2DP  */
                /* Har filgruppen 2DP ? */
             CHKOBJ     OBJ(BOSERVERS) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(DO)
                GOTO       CMDLBL(LVR)
             ENDDO

             RUNSQL     SQL('CALL ADB.SP_NEXSTEP_CREATE_2DP_IX_' *CAT +
                          &VER *CAT '(''' *cat &dlib *bcat ''',''' *cat +
                          &TBLE_P *bcat ''')') COMMIT(*NONE) NAMING(*SYS) +
                          DECMPT(*COMMA) SRTSEQ(*LANGIDUNQ) LANGID(NOR)


 /* LVR  */
 LVR:
             IF         COND(&LVRB_P *EQ ' ') THEN(DO)
                GOTO       CMDLBL(ENV)
             ENDDO


             CHGCURLIB  CURLIB(&LVRB_P)
             ADDLIBLE   &dlib
             MONMSG     MSGID(CPF2103)

             RUNSQL     SQL('CALL ADB.SP_NEXSTEP_CREATE_LVR_IX_' *CAT +
                          &VER *CAT '(''' *cat &LVRB_P *bcat ''',''' +
                          *cat &TBLE_P *bcat ''')') COMMIT(*NONE) +
                          NAMING(*SYS) DECMPT(*COMMA) SRTSEQ(*LANGIDUNQ) +
                          LANGID(NOR)

             CHGCURLIB  CURLIB(&dlib)
             ADDLIBLE   &LVRB_P
             MONMSG     MSGID(CPF2103)

 /* ENV  */
 ENV:
             IF         COND(&ENVB_P *EQ ' ') THEN(DO)
                GOTO       CMDLBL(END)
             ENDDO

             CHGCURLIB  CURLIB(&ENVB_P)
             ADDLIBLE   &dlib
             MONMSG     MSGID(CPF2103)

             RUNSQL     SQL('CALL ADB.SP_NEXSTEP_CREATE_ENV_IX_' *CAT +
                          &VER *CAT '(''' *cat &ENVB *bcat ''',''' *cat +
                          &TBLE_P *bcat ''')') COMMIT(*NONE) NAMING(*SYS) +
                          DECMPT(*COMMA) SRTSEQ(*LANGIDUNQ) LANGID(NOR)

             CHGCURLIB  CURLIB(&dlib)
             ADDLIBLE   &ENVB_P
             MONMSG     MSGID(CPF2103)


 END:        ENDPGM

