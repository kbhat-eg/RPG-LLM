             PGM     parm(&bsta)

/* Initiering av parametre.                                          */

             DCL        VAR(&OVRF) TYPE(*CHAR) LEN(10) +
                          VALUE('NBSEDIHNTB')
             DCL        VAR(&FILN)  TYPE(*CHAR) LEN(20)
             DCL        VAR(&STAT)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&BSTA)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&SMSG)  TYPE(*CHAR) LEN(1) VALUE('1')
/*           DCL        VAR(&MLD1)  TYPE(*CHAR) LEN(50)               */
/*           DCL        VAR(&MLD2)  TYPE(*CHAR) LEN(50)               */
/*           DCL        VAR(&SVAR)  TYPE(*CHAR) LEN(1)                */

/* Bygger temporær fil for mottak - avbryter om den allerede finnes  */

             CRTPF      FILE(*CURLIB/LEDITMP) RCDLEN(80) SIZE(*NOMAX)
             MONMSG     MSGID(CPF7302) EXEC(DO)
             CHGVAR     VAR(&BSTA) VALUE('E')
             GOTO       CMDLBL(END)
             ENDDO

/* Henter meldinger via FTP fra NBS                                  */

             CALL       PGM(AF700C_SBM) PARM(&OVRF &STAT &FILN &SMSG)

/* Kopierer temporær fil til mottaksfil                              */

             CPYF       FROMFILE(*CURLIB/LEDITMP) TOFILE(LWERPF) +
                          MBROPT(*ADD) FMTOPT(*NOCHK)

/* Sjekk om temporærfil er tom                                       */

             MONMSG     MSGID(CPC2957) EXEC(GOTO CMDLBL(DEL))

/* Sjekk om kopiering feilet                                         */

             MONMSG     MSGID(CPF0000) EXEC(DO)
             CHGVAR     VAR(&BSTA) VALUE('E')
             GOTO       CMDLBL(END)
             ENDDO

/* Sletter temporær fil etter vellykket mottak                       */

 DEL:        DLTF       FILE(LEDITMP)

 END:        ENDPGM
