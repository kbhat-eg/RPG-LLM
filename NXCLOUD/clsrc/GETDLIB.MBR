
             PGM        parm(&file &lib &sfil &fgr)

             DCL        VAR(&file)        TYPE(*CHAR) LEN(10)
             DCL        VAR(&filq)        TYPE(*CHAR) LEN(10)
             DCL        VAR(&sfil)        TYPE(*CHAR) LEN(10)
             DCL        VAR(&lib)         TYPE(*CHAR) LEN(10)
             DCL        VAR(&fgr)         TYPE(*CHAR) LEN(3)
             DCL        VAR(&slibT)       TYPE(*CHAR) LEN(10)  value('NXKORRTEMP')
             DCL        VAR(&slib1)       TYPE(*CHAR) LEN(10)  value('NXKORR')
             DCL        VAR(&slib2)       TYPE(*CHAR) LEN(10)  value('NXCLOUD')
             DCL        VAR(&sys)         TYPE(*CHAR) LEN(08)
             DCL        VAR(&T)           TYPE(*CHAR) LEN(01)
             DCL        VAR(&aspusr)      TYPE(*CHAR) LEN(10)
             DCL        VAR(&grp)         TYPE(*CHAR) LEN(10)
             DCL        VAR(&lvrl)        TYPE(*CHAR) LEN(10)

   /*        rtvdtaara  dtaara(*lda (934 10)) rtnvar(&lib)     */
   /*        rtvdtaara  dtaara(*lda (931 03)) rtnvar(&fgr)     */
             rtvneta    sysname(&sys)
             if         cond(&sys *eq 'EGTEST' *and +
                             &fgr = 'EGT') then(do)
               chgvar   var(&T)   value('J')
             enddo

/*  Dersom filnavnet ender på 'ST ' er det en sql definert fil                */
             chgvar    var(&file)   value(%upper(&file))
             chgvar    var(&filq)   value(%upper(&file))
             if         cond(%Sst(&filq 5 2) *eq 'ST' *or +
                             %sst(&filq 5 2) *eq 'SQ') then(do)
               chgvar   var(%sst(&filq 5 2))  value('SQ')
               goto     cmdlbl(tstsql)
             enddo

/*  Skal filen genereres i ADBXXX?                                           */
t1:          chgvar    var(&sfil)           value('qddfsrc')
             if         cond(&t *eq 'J') then(do)
               rtvmbrd    file(&slibT/&sfil)  mbr(&file)
               monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t2))
               chgvar    var(&lib)            value('ADB' *cat &fgr)
               goto      cmdlbl(end)
             enddo

t2:          rtvmbrd    file(&slib1/&sfil)  mbr(&file)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t3))
             chgvar    var(&lib)            value('ADB' *cat &fgr)
             goto      cmdlbl(end)

t3:          rtvmbrd    file(&slib2/&sfil)  mbr(&file)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t4))
             chgvar    var(&lib)            value('ADB' *cat &fgr)
             goto      cmdlbl(end)

/*  Skal filen genereres i ADB?                                              */
t4:          chgvar    var(&sfil)           value('qddfadb')
             if         cond(&t *eq 'J') then(do)
               rtvmbrd    file(&slibT/&sfil)  mbr(&file)
               monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t5))
               chgvar    var(&lib)            value('ADB')
               goto      cmdlbl(end)
             enddo

t5:          rtvmbrd    file(&slib1/&sfil)  mbr(&file)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t6))
             chgvar    var(&lib)            value('ADB')
             goto      cmdlbl(end)

t6:          rtvmbrd    file(&slib2/&sfil)  mbr(&file)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t7))
             chgvar    var(&lib)            value('ADB')
             goto      cmdlbl(end)

/*  Skal filen genereres i XXXLVR?                                           */
t7:          chgvar    var(&sfil)           value('qddflvr')
             if         cond(&t *eq 'J') then(do)
               rtvmbrd    file(&slibT/&sfil)  mbr(&file)
               monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t8))
               chgvar    var(&lib)            value(&fgr *cat 'LVR')
               goto      cmdlbl(endlvr)
             enddo

t8:          rtvmbrd    file(&slib1/&sfil)  mbr(&file)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t9))
             chgvar    var(&lib)            value(&fgr *cat 'LVR')
             goto      cmdlbl(endlvr)

t9:          rtvmbrd    file(&slib2/&sfil)  mbr(&file)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t10))
             chgvar    var(&lib)            value(&fgr *cat 'LVR')
             goto      cmdlbl(endlvr)
endlvr:
             rtvobjd    obj(&file) objtype(*file) rtnlib(&lvrl)
             if         cond(&lvrl *ne '   ') then(do)
   /*          chgvar   var(&lib)  value(&lvrl)   Må ryddes opp i J filer vedr ADBXXX/xxxlvr/immlvr   */
   /*          goto     cmdlbl(end)                                                                   */
             enddo

/*  Skal filen genereres i Miljø?                                          */
t10:         chgvar    var(&sfil)           value('qddfmil')
             chgvar    var(&aspusr)   value('ASP_' *cat &fgr)
             rtvusrprf usrprf(&aspusr) grpprf(&grp)
             if         cond(&t *eq 'J') then(do)
               rtvmbrd    file(&slibT/&sfil)  mbr(&file)
               monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t11))
               chgvar    var(&lib)       value(%sst(&grp 5 3))
               goto      cmdlbl(end)
             enddo

t11:         rtvmbrd    file(&slib1/&sfil)  mbr(&file)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t12))
             chgvar    var(&lib)       value(%sst(&grp 5 3))
             goto      cmdlbl(end)

t12:         rtvmbrd    file(&slib2/&sfil)  mbr(&file)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(t13))
             chgvar    var(&lib)       value(%sst(&grp 5 3))
             goto      cmdlbl(end)

/*  Filen ikke funnet.  Da blir den 'foreløpig' generert i ADBXXX          */
t13:
             chgvar    var(&lib)            value('ADB' *cat &fgr)
             chgvar    var(&sfil)           value('qddfsrc')
             goto      cmdlbl(end)
tstsql:
/*  Skal filen genereres i ADBXXX   som SQL-fil                             */
s1:          chgvar    var(&sfil)           value('qsqlsrc')
             if         cond(&t *eq 'J') then(do)
               rtvmbrd    file(&slibT/&sfil)  mbr(&filq)
               monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s2))
               chgvar    var(&lib)            value('ADB' *cat &fgr)
               goto      cmdlbl(end)
             enddo

s2:          rtvmbrd    file(&slib1/&sfil)  mbr(&filq)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s3))
             chgvar    var(&lib)            value('ADB' *cat &fgr)
             goto      cmdlbl(end)

s3:          rtvmbrd    file(&slib2/&sfil)  mbr(&filq)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s4))
             chgvar    var(&lib)            value('ADB' *cat &fgr)
             goto      cmdlbl(end)

/*  Skal filen genereres i ADB?                                             */
s4:          chgvar    var(&sfil)           value('qsqladb')
             if         cond(&t *eq 'J') then(do)
               rtvmbrd    file(&slibT/&sfil)  mbr(&filq)
               monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s5))
               chgvar    var(&lib)            value('ADB')
               goto      cmdlbl(end)
             enddo

s5:          rtvmbrd    file(&slib1/&sfil)  mbr(&filq)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s6))
             chgvar    var(&lib)            value('ADB')
             goto      cmdlbl(end)

s6:          rtvmbrd    file(&slib2/&sfil)  mbr(&filq)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s7))
             chgvar    var(&lib)            value('ADB')
             goto      cmdlbl(end)

/*  Skal filen genereres i XXXLVR?                                          */
s7:          chgvar    var(&sfil)           value('qsqllvr')
             if         cond(&t *eq 'J') then(do)
               rtvmbrd    file(&slibT/&sfil)  mbr(&filq)
               monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s8))
               chgvar    var(&lib)            value(&fgr *cat 'LVR')
               goto      cmdlbl(end)
             enddo

s8:          rtvmbrd    file(&slib1/&sfil)  mbr(&filq)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s9))
             chgvar    var(&lib)            value(&fgr *cat 'LVR')
             goto      cmdlbl(end)

s9:          rtvmbrd    file(&slib2/&sfil)  mbr(&filq)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s10))
             chgvar    var(&lib)            value(&fgr *cat 'LVR')
             goto      cmdlbl(end)

/*  Skal filen genereres i Miljø?                                           */
s10:         chgvar    var(&sfil)           value('qsqlmil')
             if         cond(&t *eq 'J') then(do)
               rtvmbrd    file(&slibT/&sfil)  mbr(&filq)
               monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s11))
               chgvar    var(&lib)       value(%sst(&grp 5 3))
               goto      cmdlbl(end)
             enddo

S11:         rtvmbrd    file(&slib1/&sfil)  mbr(&filq)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s12))
             chgvar    var(&lib)       value(%sst(&grp 5 3))
             goto      cmdlbl(end)

s12:         rtvmbrd    file(&slib2/&sfil)  mbr(&filq)
             monmsg    msgid(cpf9815 cpf9812)       exec(goto cmdlbl(s13))
             chgvar    var(&lib)       value(%sst(&grp 5 3))
             goto      cmdlbl(end)

/*  Filen ikke funnet.  Da blir den 'foreløpig' generert i ADBXXX          */
s13:
             chgvar    var(&lib)            value('ADB' *cat &fgr)
             chgvar    var(&sfil)           value('qsqlsrc')
             goto      cmdlbl(end)

 END:        ENDPGM
