
/* Finne filgrupper pr. miljø                                        */
             PGM        PARM(&SAVF &MILJ)

             DCL        VAR(&SAVF)     TYPE(*CHAR) LEN(1)
             DCL        VAR(&MILJ)     TYPE(*CHAR) LEN(3)
             DCL        VAR(&BIBL)     TYPE(*CHAR) LEN(10)

             DCLF       FILE(*LIBL/AFILPF)

/* Tester på om biblioteket finnes (for miljø)                       */
             CHKOBJ     OBJ(&MILJ)     OBJTYPE(*LIB)
             MONMSG     MSGID(CPF9801) EXEC(GOTO CMDLBL(ENDPGM))

/* Legge inn miljø som current library                               */
             CHGCURLIB  CURLIB(&MILJ)

/* Save av miljø først                                               */
             CHGVAR     VAR(&BIBL)     VALUE(&MILJ)
             CALL       PGM(AN025C)    PARM(&SAVF &BIBL)

/* Leser file-gruppe fil i aktuelt miljø                             */
LESFIL:      RCVF
             MONMSG     MSGID(CPF0864) EXEC(GOTO CMDLBL(ENDPGM))

/* Tester på om biblioteket finnes (for filegruppe)                  */
             CHKOBJ     OBJ(&AGBIBL)   OBJTYPE(*LIB)
             MONMSG     MSGID(CPF9801) EXEC(GOTO CMDLBL(LESFIL))

/* Tester på om filer er representert:                               */
             CHKOBJ     OBJ(&AGBIBL/RKUNPF)   OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(GOTO CMDLBL(LESFIL))

             IF         COND(&AGFGRP *EQ '   ') THEN(DO)
             GOTO       CMDLBL(ENDPGM)
             ENDDO

/* Kaller opp program for backup                                     */

             IF         COND(&AGBACK *EQ ' ') THEN(DO)
             CALL       PGM(AN025C)    PARM(&SAVF &AGBIBL)
             ENDDO

             GOTO       CMDLBL(LESFIL)

ENDPGM:      ENDPGM
