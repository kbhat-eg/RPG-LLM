/*                                                                   */
 strpgm:     pgm

             dcl        var(&fra)  type(*char) len(3)
             dcl        var(&til)  type(*char) len(3)
             dcl        var(&f1)   type(*char) len(6)
             dcl        var(&f2)   type(*char) len(6)
             dcl        var(&f3)   type(*char) len(6)
             dcl        var(&f4)   type(*char) len(6)
             dcl        var(&f5)   type(*char) len(6)
             dcl        var(&f6)   type(*char) len(6)
             dcl        var(&f7)   type(*char) len(6)
             dcl        var(&f8)   type(*char) len(6)
             dcl        var(&f9)   type(*char) len(6)
             dcl        var(&f10)  type(*char) len(6)
             dcl        var(&f)    type(*char) len(10)
             dcl        var(&ver)  type(*char) len(3)
             dcl        var(&akt)  type(*char) len(1)
             dcl        var(&srv)  type(*char) len(8)
             dcl        var(&grp)  type(*char) len(10)
             dcl        var(&clib) type(*char) len(10)
             dcl        var(&lib)  type(*char) len(10)

             dclf       file(adb/afgri1)

             rtvneta    sysname(&srv)
             rtvjoba    curlib(&clib)

/*   parameter for hvilke filer og fra til filgruppe som skal genereres      */
             call ag936c parm(&fra &til &ver *akt &f1 &f2 &f3 &f4 &f5 &f6 &f7 &f8 &f9 &f10)

rcvf:        rcvf
             monmsg     msgid(cpf0864)  exec(goto cmdlbl(end))

             if         cond(&afgsrv *ne &srv  *or  +
                             &afgver *ne &ver  *or  +
                             &afgfgr *lt &fra  *or  +
                             &afgfgr *gt &til) then(do)
               goto     cmdlbl(rcvf)
             enddo

/*  Ev.  avslutte aktive jobber og disable brukere                   */
             if         cond(&akt *eq 'J') then(do)
               addlible lib(nxc_distr) position(*last)
               monmsg   msgid(cpf0000)
               chgvar   var(&lib)   value('ADB' *cat &afgfgr)
               chgcurlib curlib(&lib)
               call     pgm(egd21c)             /* Disable brukere i miljøet */
               call     pgm(endjobwiz)          /* Ev. kaster ut aktive brukere/jobber  */
             enddo

             chgvar     var(&grp)    value('GRP_' *cat &afgmil)
             if         cond(&f1 *ne '  ') then(do)
               chgvar   var(&f)     value(&f1)
               callsubr subr(Beh_Fil)
             enddo

             if         cond(&f2 *ne '  ') then(do)
               chgvar   var(&f)     value(&f2)
               callsubr subr(Beh_Fil)
             enddo

             if         cond(&f3 *ne '  ') then(do)
               chgvar   var(&f)     value(&f3)
               callsubr subr(Beh_Fil)
             enddo

             if         cond(&f4 *ne '  ') then(do)
               chgvar   var(&f)     value(&f4)
               callsubr subr(Beh_Fil)
             enddo

             if         cond(&f5 *ne '  ') then(do)
               chgvar   var(&f)     value(&f5)
               callsubr subr(Beh_Fil)
             enddo

             if         cond(&f6 *ne '  ') then(do)
               chgvar   var(&f)     value(&f6)
               callsubr subr(Beh_Fil)
             enddo

             if         cond(&f7 *ne '  ') then(do)
               chgvar   var(&f)     value(&f7)
               callsubr subr(Beh_Fil)
             enddo

             if         cond(&f8 *ne '  ') then(do)
               chgvar   var(&f)     value(&f8)
               callsubr subr(Beh_Fil)
             enddo

             if         cond(&f9 *ne '  ') then(do)
               chgvar   var(&f)     value(&f9)
               callsubr subr(Beh_Fil)
             enddo

             if         cond(&f10 *ne '  ') then(do)
               chgvar   var(&f)     value(&f10)
               callsubr subr(Beh_Fil)
             enddo

/*   compilere spesialprogrammer i ASKUND_xxx for denne filgruppa    */

             call       pgm(egd17c)  parm(&afgfgr)

/*  Ev.  åpne igjen for brukere i dette miljøet                      */
             if         cond(&akt *eq 'J') then(do)
               call     pgm(egd23c)             /* Enable brukere i miljøet */
             enddo

             goto       cmdlbl(rcvf)

End:
             chgcurlib  curlib(&clib)

/* ______________________________________________________________________*/
Subr         Subr(Beh_Fil)

             if         cond(%sst(&f 5 2) *eq 'PF') then(do)
               call     pgm(ag916c)  parm(&f &afgfgr &grp ' ')
             enddo
             if         cond(%sst(&f 5 2) *eq 'ST') then(do)
               call     pgm(ag918c)  parm(&f &afgfgr &grp ' ')
             enddo

EndSubr
/* ______________________________________________________________________*/
             endpgm
