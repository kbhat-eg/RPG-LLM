             PGM        parm(&file &bane)

/* Definering av variable                                            */

             dcl        var(&file) type(*char) len(20)
             dcl        var(&bane) type(*char) len(70)
             dcl        var(&clib) type(*char) len(10)
             DCL        VAR(&ifil) type(*char) len(70)
             DCL        VAR(&dfil) type(*char) len(70)
             DCL        VAR(&bfil) type(*char) len(70)
             DCL        VAR(&xfil) type(*char) len(70)
             DCL        VAR(&msg)  type(*char) len(70)
             dcl        var(&dat)  type(*char) len(6)
             dcl        var(&w_t)  type(*dec)  len(2 0)
             dcl        var(&w_x)  type(*char) len(2)

/*           chgvar     var(&msg)  value('FILE: ' *tcat &file +   */
/*                                  *cat 'Bane: ' *tcat &bane)    */
/*           call       debugcl parm(&msg)                        */
/* Henter current library                                            */

             rtvjoba    curlib(&clib)

/* Oppretter temporær fil og kopierer motatt fil inn i denne         */

             DLTF       FILE(VEITEMP)
             MONMSG     MSGID(CPF2105)
             CRTPF      FILE(VEITEMP) RCDLEN(30) TEXT('Temporær +
                          fil') SIZE(*NOMAX)
             MONMSG     MSGID(CPF2105)

             chgvar     var(&ifil) value(&bane *tcat '/' *tcat &file)
             chgvar     var(&bfil) value(&bane *tcat '/backup')

             CHGVAR     VAR(&dFIL) VALUE('/qsys.lib/' *TCAT &CLIB +
                         *TCAT '.lib/VEITEMP.file/VEITEMP.mbr')
             crtdir     dir(&bfil)
             monmsg     msgid(cpfa0a0)
/*           chgvar     var(&msg)  value('Bfil: ' *tcat &bfil)    */
/*           call       debugcl parm(&msg)                        */

             CPYFRMSTMF FROMSTMF(&IFIL) TOMBR(&DFIL) MBROPT(*REPLACE)
             monmsg     msgid(cpfa0a9 cpfa095) exec(do)
               goto     cmdlbl(end)
             enddo
  /*  Bygge Backupfil  */
             chgvar     var(&bfil) value(&bfil *tcat '/Sald_')
             rtvjoba    date(&dat)
             chgvar     var(&bfil) value(&bfil *tcat '20' +
                                   *tcat %sst(&dat 5 2) *tcat '_' +
                                   *tcat %sst(&dat 3 2) *tcat '_' +
                                   *tcat %sst(&dat 1 2) *tcat '_')
             chgvar     var(&xfil)  value(&bfil)
NyBfil:      chgvar     var(&w_t)   value(&w_t + 1)
             chgvar     var(&w_x)   value(&w_t)
             chgvar     var(&bfil)  value(&xfil *tcat &w_x)

             mov        obj(&ifil) toobj(&bfil)
             monmsg     msgid(cpfa0a0) exec(do)
               goto     cmdlbl(NyBfil)
             enddo

/* Behandler mottatt fil                                             */

             CPYF       FROMFILE(VEITEMP) TOFILE(VEINPF) +
                          MBROPT(*REPLACE) FMTOPT(*NOCHK)

             CALL       PGM(RX001R)

/*           DLYJOB     DLY(60)      */
 END:        ENDPGM
