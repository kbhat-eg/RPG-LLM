/* Beskrivelse av parametre                                         */
/*   DLIB = Databibliotek, filgruppe                                */
/*   FIRM = Firmanummer                                             */
/*   FELL = Navn p책 teller                                          */
/*   TYPE = Type teller                                             */
/*   NUMM = Returnerte teller verdi                                 */
/*   STAT = Status. Alt annet enn *blank er tegn p책 feil            */
/*                                                                  */
/*   STAT = Status. Skal settes ved feil. Beskrivelse av status-    */
/*           koder m책 lages, og beskrives her.                      */
/*                                                                  */
             PGM        PARM(&DLIB &FIRM &FELL &TYPE &NUMM &STAT)

             DCL        VAR(&DLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&FIRM) TYPE(*DEC) LEN(3 0)

             DCL        VAR(&KODE) TYPE(*CHAR) LEN(1) VALUE('0')
             DCL        VAR(&FELL) TYPE(*CHAR) LEN(6)
             DCL        VAR(&TYPE) TYPE(*CHAR) LEN(2)
             DCL        VAR(&FAST) TYPE(*CHAR) LEN(10) VALUE(' ')
/*6.nu*/     DCL        VAR(&NUMM) TYPE(*DEC) LEN(8 0)

             DCL        VAR(&STAT) TYPE(*CHAR) LEN(1)

             DCL        VAR(&FGRP) TYPE(*CHAR) LEN(3)
             DCL        VAR(&CFIR) TYPE(*CHAR) LEN(3)

/* Setter biblioteksliste                                            */

             CHGVAR     VAR(&FGRP) VALUE(%SUBSTRING(&DLIB 4 3))
             CHGVAR     VAR(&CFIR) VALUE(&FIRM)

             CALL       PGM(ASPINI/AA724C) PARM(&FGRP)

             CHGCURLIB  CURLIB(&DLIB)
             CHGDTAARA  DTAARA(*LDA (944 3)) VALUE(&CFIR)

/* Starter transaksjon (commitment control)                          */
             STRCMTCTL  LCKLVL(*CHG)

/* Legg inn alt som skal skje under her -------------------------    */
/* Ved feil i programmet skal man hoppe til ERR etter 책 ha satt      */
/* &STAT --------------------------------------------------------    */
/* Alle MONMSG skal evt hoppe til ERR ---------------------------    */
/*                                                                   */
             CHGVAR     VAR(&KODE) VALUE('0')
             CALL       PGM(AS100R) PARM(&KODE &FIRM &FELL +
                          &TYPE &FAST &NUMM)

             IF         COND(&KODE *EQ '7') THEN(DO)
             CHGVAR     VAR(&STAT) VALUE('1')
             GOTO       CMDLBL(ERR)
             ENDDO
             IF         COND(&KODE *EQ '8') THEN(DO)
             CHGVAR     VAR(&STAT) VALUE('2')
             GOTO       CMDLBL(ERR)
             ENDDO
             IF         COND(&KODE *EQ '9') THEN(DO)
             CHGVAR     VAR(&STAT) VALUE('3')
             GOTO       CMDLBL(ERR)
             ENDDO

/* -------------------------------------------------------*/
             COMMIT
 END:
             ENDCMTCTL
             RETURN

 ERR:
             ROLLBACK
             GOTO       CMDLBL(END)
             ENDPGM
