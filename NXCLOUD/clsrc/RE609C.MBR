             PGM

/* Endret til IFS utlegg                         041213 BOF          */
/* Initiering av parametre.                                          */

             DCL        VAR(&WALI)   TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&WAPO)   TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&MLD1)   TYPE(*CHAR) LEN(40)
             DCL        VAR(&MLD2)   TYPE(*CHAR) LEN(40)
             DCL        VAR(&FFIR)   TYPE(*CHAR) LEN(3)
             DCL        VAR(&FAVD)   TYPE(*CHAR) LEN(4)
             DCL        VAR(&MEMB) TYPE(*CHAR) LEN(10) VALUE('KLI   ')
             DCL        VAR(&FGRP)     TYPE(*CHAR) LEN(3)
             DCL        VAR(&CLIB)     TYPE(*CHAR) LEN(10)
             DCL        VAR(&MAPX)     TYPE(*CHAR) LEN(30)
             DCL        VAR(&FFIL)     TYPE(*CHAR) LEN(70)
             DCL        VAR(&TFIL)     TYPE(*CHAR) LEN(70)
             DCL        VAR(&FILNF)    TYPE(*CHAR) LEN(25)

/* Henter verdier i fra LDA.                                         */

             RTVDTAARA  DTAARA(*LDA (944 03)) RTNVAR(&FFIR)
             RTVDTAARA  DTAARA(*LDA (357 04)) RTNVAR(&FAVD)
             CHGVAR     VAR(%SST(&MEMB 4 3)) VALUE(&FFIR)

/* Varselbilde 2                                                     */

             CHGVAR     VAR(&WALI) VALUE(4)
             CHGVAR     VAR(&WAPO) VALUE(44)
             CHGVAR     VAR(&MLD1) VALUE('Vennligst vent litt .....')
             CHGVAR     VAR(&MLD2) VALUE('Utplukk pågår ...........')
             CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)

/* Bygger membere dersom de ikke finnes                              */

             CHKOBJ     OBJ(RE05PF) OBJTYPE(*FILE) MBR(&MEMB)
             MONMSG     MSGID(CPF9815) EXEC(DO)
             ADDPFM     FILE(RE05PF) MBR(&MEMB) TEXT('Saldobalanse +
                          til TOTAL for PC')
             ENDDO

             CLRPFM     FILE(RE05PF) MBR(&MEMB)
             MONMSG     MSGID(CPF3100)

/* Utplukking av poster                                              */

             OVRDBF     FILE(RE05PF) MBR(&MEMB)

             CALL       PGM(RE609R)

             DLTOVR     FILE(RE05PF)

/* Utvekslingsfile legges ut i DIR: PCTOTAL (I:)                     */
/*                                                                   */
/*           CPYTOPCD   FROMFILE(*LIBL/RE05PF) TOFLR(PCTOTAL) +      */
/*                        FROMMBR(&MEMB) TODOC(&MEMB) REPLACE(*YES) +*/
                          /* Saldobalanse fra AS Økonomi */
/*                                                                   */
/*           MONMSG     MSGID(CPF0000)                               */

/* Kopierer til IFS                                               */

             RTVDTAARA  DTAARA(*LDA (931 03)) RTNVAR(&FGRP)
             RTVJOBA    CURLIB(&CLIB)

 /* Danner mappen på IFS asp/xxx  i tilfelle denne ikke finnes */
             CHGVAR     VAR(&MAPX)  VALUE('/asp/' *TCAT &FGRP)
             CRTDIR     DIR(&MAPX)     DTAAUT(*RWX) OBJAUT(*ALL)
             MONMSG     MSGID(CPF0000)
 /* Danner mappen på IFS */
             CHGVAR     VAR(&MAPX)  VALUE('/asp/' *TCAT &FGRP +
                                       *TCAT '/' *TCAT 'PCTOTAL')
             CRTDIR     DIR(&MAPX)     DTAAUT(*RWX) OBJAUT(*ALL)
             MONMSG     MSGID(CPF0000)
 /* danner og overfører til temp fil */
             CRTSRCPF   FILE(R05TMP) RCDLEN(1024) MBR(R05TMP) +
                          TEXT('Temp.fil Total rapp') SIZE(*NOMAX)
             MONMSG     MSGID(CPF0000)
             CPYF       FROMFILE(*LIBL/RE05PF) TOFILE(*LIBL/R05TMP) +
                          FROMMBR(&MEMB) TOMBR(R05TMP) +
                          MBROPT(*REPLACE) FMTOPT(*CVTSRC)
             CHGVAR     VAR(&filnf) VALUE(&memb *TCAT '.xls')
             CHGVAR     VAR(&TFIL) VALUE(&MAPX *TCAT '/' *TCAT &filnf)


             CHGVAR     VAR(&FFIL) VALUE('/qsys.lib/' *TCAT &CLIB +
                                   *TCAT '.lib/R05TMP.file/R05TMP.mbr')

  /*                                                                  */

             CPYTOSTMF  FROMMBR(&FFIL) TOSTMF(&TFIL) +
                           STMFOPT(*REPLACE) STMFCODPAG(*PCASCII)
             CHGAUT     OBJ(&TFIL) USER(*PUBLIC) DTAAUT(*RWX) +
                          OBJAUT(*ALL)


 END:        ENDPGM
