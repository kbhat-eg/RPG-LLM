             PGM   parm(&frafil +
                        &frambr +
                        &tilmap +
                        &tildok +
                        &typ)
/*  Eier av ev nye cataloger legges i &DUS                          */

/* Initiering av parametre.                                          */

             DCL        VAR(&frafil) TYPE(*char) LEN(10) /* RKUNPF */
             DCL        VAR(&frambr) TYPE(*char) LEN(10) /* RKUNPF */
             DCL        VAR(&tilmap) TYPE(*char) LEN(20) /* OKONOMI */
             DCL        VAR(&tildok) TYPE(*CHAR) LEN(25) /* Kunder */
             DCL        VAR(&typ)    TYPE(*CHAR) LEN(3)  /* xls */
             DCL        VAR(&map)    TYPE(*char) LEN(40)
             DCL        VAR(&x)      TYPE(*char) LEN(40)
             DCL        VAR(&FGRP)     TYPE(*CHAR) LEN(3)
             DCL        VAR(&CLIB)     TYPE(*CHAR) LEN(10)
             DCL        VAR(&MAPX)     TYPE(*CHAR) LEN(30)
             DCL        VAR(&ffil)     TYPE(*CHAR) LEN(70)
             DCL        VAR(&tfil)     TYPE(*CHAR) LEN(70)
             DCL        VAR(&i)        TYPE(*dec)  LEN(3 0)
             DCL        VAR(&j)        TYPE(*dec)  LEN(3 0)
             DCL        VAR(&dus)      TYPE(*char) LEN(10) value('ASP')

             DCL        VAR(&GRPPRF)   TYPE(*CHAR) LEN(10)

/* Kopierer til IFS                                               */

             RTVDTAARA  DTAARA(*LDA (931 03)) RTNVAR(&FGRP)
             RTVJOBA    CURLIB(&CLIB)

             RTVUSRPRF  GRPPRF(&GRPPRF)
             if         cond(&GRPPRF *ne ' ' *and &GRPPRF *ne '*NONE') +
                          then(do)
                chgvar     var(&dus)      value(&GRPPRF)
             enddo

 /* Danner mappen på IFS asp/xxx  i tilfelle denne ikke finnes */

             CHGVAR     VAR(&MAPX)  VALUE('/asp/' *TCAT &FGRP)
/*   bkv fjernet 20082019                                                     */
/*              CRTDIR     DIR(&MAPX)      dtaaut(*INDIR) objaut(*INDIR)      */
/*              MONMSG     MSGID(CPF0000)                                     */
/*              chgown     obj(&mapx)     newown(&dus)                        */
/*              MONMSG     MSGID(CPF0000)                                     */

 /* Danner mappen på IFS */
nymapp:      if         cond(&tilmap *ne '   ') then(do)
               chgvar     var(&map)    value(' ')
               chgvar     var(&x)      value(&tilmap)
               if         cond(%sst(&x 1 8) *eq &mapx) then(do)
                 chgvar   var(&map) value(&tilmap)
               enddo
               if         cond(%sst(&x 1 8) *ne &mapx) then(do)
                 chgvar   var(&map) value(&mapx *tcat '/' +
                                          *tcat &x)
               enddo

               chgvar     var(&i)  value(%scan('/' &map 10))
               if         cond(&i *ne 0) then(do)
                 chgvar   var(&j)     value(&i - 1)
                 chgvar   var(&x)     value(%sst(&map 1 &j))
                 crtdir     dir(&x)      dtaaut(*INDIR) objaut(*INDIR)
                 monmsg   msgid(cpfa0a0)
                 monmsg     msgid(cpf0000)
                 CHGPGP     obj(&x) NEWPGP(*none)
                 MONMSG     MSGID(CPFA0B1)
                 chgown     obj(&x)   newown(&dus) RVKOLDAUT(*NO)
                 MONMSG     MSGID(CPFA0B1)
                 monmsg     msgid(cpf0000)
               enddo

               if         cond(&i *ne 0) then(do)
                 chgvar   var(&j)     value(&i + 1)
                 chgvar   var(&i)  value(%scan('/' &map &j))
                 if       cond(&i *ne 0) then(do)
                   chgvar var(&j)     value(&i - 1)
                   chgvar var(&x)     value(%sst(&map 1 &j))
                   crtdir     dir(&x)      dtaaut(*INDIR) objaut(*INDIR)
                   monmsg msgid(cpfa0a0)
                   monmsg     msgid(cpf0000)
                   CHGPGP     obj(&x) NEWPGP(*none)
                   MONMSG     MSGID(CPFA0B1)
                   chgown     obj(&x)   newown(&dus) RVKOLDAUT(*NO)
                   MONMSG     MSGID(CPFA0B1)
                   monmsg     msgid(cpf0000)
                 enddo
               enddo

               if         cond(&i *ne 0) then(do)
                 chgvar   var(&j)     value(&i + 1)
                 chgvar   var(&i)  value(%scan('/' &map &j))
                 if       cond(&i *ne 0) then(do)
                   chgvar var(&j)     value(&i - 1)
                   chgvar var(&x)     value(%sst(&map 1 &j))
                   crtdir     dir(&x)      dtaaut(*INDIR) objaut(*INDIR)
                   monmsg msgid(cpfa0a0)
                   monmsg     msgid(cpf0000)
                   CHGPGP     obj(&x) NEWPGP(*none)
                   MONMSG     MSGID(CPFA0B1)
                   chgown     obj(&x)   newown(&dus) RVKOLDAUT(*NO)
                   MONMSG     MSGID(CPFA0B1)
                   monmsg     msgid(cpf0000)
                 enddo
               enddo

               if         cond(&i *ne 0) then(do)
                 chgvar   var(&j)     value(&i + 1)
                 chgvar   var(&i)  value(%scan('/' &map &j))
                 if       cond(&i *ne 0) then(do)
                   chgvar var(&j)     value(&i - 1)
                   chgvar var(&x)     value(%sst(&map 1 &j))
                   crtdir     dir(&x)      dtaaut(*INDIR) objaut(*INDIR)
                   monmsg msgid(cpfa0a0)
                   monmsg     msgid(cpf0000)
                   CHGPGP     obj(&x) NEWPGP(*none)
                   MONMSG     MSGID(CPFA0B1)
                   chgown     obj(&x)   newown(&dus) RVKOLDAUT(*NO)
                   MONMSG     MSGID(CPFA0B1)
                   monmsg     msgid(cpf0000)
                 enddo
               enddo

               crtdir     dir(&map)    dtaaut(*INDIR) objaut(*INDIR)
               monmsg   msgid(cpfa0a0)
               CHGPGP     obj(&map) NEWPGP(*none)
               MONMSG     MSGID(CPFA0B1)
               chgown     obj(&map)   newown(&dus) RVKOLDAUT(*NO)
               MONMSG     MSGID(CPFA0B1)
               monmsg     msgid(cpf0000)

             enddo

 /* danner og overfører til temp fil */
             crtsrcpf   file(aspTMP) rcdlen(1024) mbr(aspTMP) +
                          text('Temp.fil IFS') size(*nomax) aut(*all)
             monmsg     msgid(CPF5813 cpf7302) exec(do)
               clrpfm    file(*libl/asptmp)
             enddo
             cpyf       fromfile(*libl/&frafil) tofile(*libl/aspTMP) +
                          frommbr(&frambr) tombr(aspTMP) +
                          mbropt(*replace) fmtopt(*cvtsrc)
             monmsg     msgid(CPF2817 cpf2869) exec(do)
               /*       Filen er tom         */
               chgvar   var(&typ)   value('TOM')
               goto     cmdlbl(end)
             enddo
             if         cond(&typ *ne ' ') then(do)
               chgvar   var(&tildok) value(&tildok *tcat '.' *cat &typ)
             enddo
             chgvar     var(&tfil) value(&map *tcat +
                                       '/' *tcat &tildok)

             chgvar     var(&ffil) value('/qsys.lib/' *tcat &clib +
                                   *tcat '.lib/aspTMP.file/aspTMP.mbr')

             cpytostmf  frommbr(&ffil) tostmf(&tfil) stmfopt(*replace) +
                          stmfcodpag(*pcascii) aut(*indir)
             monmsg     msgid(cpfA097) exec(do)
                cpytostmf  frommbr(&ffil) tostmf(&tfil) stmfopt(*replace) +
                             aut(*indir)
             enddo
             CHGPGP     obj(&tfil) NEWPGP(*none)
             MONMSG     MSGID(CPFA0B1) /* hvis filen finnes fra før, og +
                          bruker ikke er eier, feiler chgaut */
             chgown     obj(&tfil)   newown(&dus) RVKOLDAUT(*NO)
             MONMSG     MSGID(CPFA0B1) /* hvis filen finnes fra før, og +
                          bruker ikke er eier, feiler chgaut */
             chgaut     obj(&tfil) user(*public) dtaaut(*rwx) objaut(*all)
             monmsg     msgid(cpfA0B1)

 END:        ENDPGM
