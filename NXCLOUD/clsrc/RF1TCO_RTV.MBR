/********************************************************************/
/*                                                                  */
/* 5770SS1 V7R3M0 160422   Utdata fra RTVCLSRC   02.04.19 14.23.33  */
/*                                                                  */
/* Programnavn  . . . . . . . . . . . . . . :   RF1TCOMP          PN*/
/* Biblioteknavn  . . . . . . . . . . . . . :   ASKORR630         PL*/
/* Modulnavn  . . . . . . . . . . . . . . . :   RF1TCOMP          MN*/
/* Biblioteknavn  . . . . . . . . . . . . . :   *LIBL             ML*/
/* Opprinnelig kildefil . . . . . . . . . . :   QCLLESRC          SN*/
/* Biblioteknavn  . . . . . . . . . . . . . :   ASKORR630         SL*/
/* Opprinnelig kildekomponent . . . . . . . :   RF1TCOMP          SM*/
/* Endring av kildefil                                              */
/*   dato/klokkeslett . . . . . . . . . . . :   15.06.17 10.55.45 SC*/
/* Tekst  . . : TX*/
/* Eier . . . . . . . . . . . . . . . . . . :   SST630            OW*/
/* Hente inkludert kilde  . . . . . . . . . :   *NO               RI*/
/*                                                                ED*/
/********************************************************************/
     PGM PARM(&SYST &JKEY &STAT)
     DCL VAR(&FGRP) TYPE(*CHAR) LEN(3)
     DCL VAR(&LIB) TYPE(*CHAR) LEN(10) VALUE('ADB ')
     DCL VAR(&SYST) TYPE(*CHAR) LEN(4)
     DCL VAR(&FFIR) TYPE(*CHAR) LEN(3)
     DCL VAR(&WALI) TYPE(*DEC) LEN(2 0)
     DCL VAR(&WAPO) TYPE(*DEC) LEN(2 0)
     DCL VAR(&MLD1) TYPE(*CHAR) LEN(40)
     DCL VAR(&MLD2) TYPE(*CHAR) LEN(40)
     DCL VAR(&M50) TYPE(*CHAR) LEN(50)
     DCL VAR(&MEMB) TYPE(*CHAR) LEN(10)
     DCL VAR(&CMPRF) TYPE(*CHAR) LEN(10)
     DCL VAR(&CMPR) TYPE(*CHAR) LEN(200)
     DCL VAR(&FPER) TYPE(*CHAR) LEN(1)
     DCL VAR(&JKEY) TYPE(*CHAR) LEN(41)
     DCL VAR(&STAN) TYPE(*DEC) LEN(1 0)
     DCL VAR(&STAT) TYPE(*CHAR) LEN(1)
     DCL VAR(&JSTA) TYPE(*DEC) LEN(2 0) VALUE(0)
     DCL VAR(&JMLD) TYPE(*CHAR) LEN(200)
     DCL VAR(&STS) TYPE(*CHAR) LEN(1) VALUE(' ')
     DCL VAR(&RV1) TYPE(*DEC) LEN(1 0) VALUE(0)
     DCL VAR(&RV2) TYPE(*DEC) LEN(1 0) VALUE(0)
     DCL VAR(&RV3) TYPE(*DEC) LEN(2 0) VALUE(0)
     DCL VAR(&OMSTART) TYPE(*CHAR) LEN(1) VALUE(' ')
     RTVDTAARA DTAARA(*LDA (944 03)) RTNVAR(&FFIR)
     RTVDTAARA DTAARA(*LDA (931 03)) RTNVAR(&FGRP)
     CHGVAR VAR(%SST(&LIB 4 3)) VALUE(&FGRP)
     CHGVAR VAR(%SST(&MEMB 1 4)) VALUE(&SYST)
     CHGVAR VAR(%SST(&MEMB 5 3)) VALUE(&FFIR)
     CALL PGM(RV015R) PARM(&RV1 &RV2)
     IF COND(&RV1 *EQ 5) THEN(DO)
     CLRPFM FILE(RCMRPF)
     MONMSG MSGID(CPF3142) EXEC(DO)
     CALL PGM(RGCMRC) PARM(&FGRP ' ')
     ENDDO
     CHGVAR VAR(&RV3) VALUE(08)
NYSTART: +
     CALL PGM(FA730R) PARM(&RV3 &RV2)
     IF COND(&RV2 *EQ 1) THEN(DO)
     GOTO CMDLBL(ENDPGM)
     ENDDO
     CHGVAR VAR(&RV2) VALUE(1)
     CALL PGM(FA720R) PARM(&RV3 &RV2)
     ENDDO
     CHKOBJ OBJ(&LIB/RCMPPF) OBJTYPE(*FILE)
     MONMSG MSGID(CPF9801) EXEC(DO)
     CALL PGM(RGCMPC) PARM(&FGRP ' ')
     ENDDO
     CHKOBJ OBJ(&LIB/IINKST) OBJTYPE(*FILE)
     MONMSG MSGID(CPF9801) EXEC(DO)
     CALL PGM(AG902C) PARM('IINKST' &LIB)
     ENDDO
     CHKOBJ OBJ(&LIB/RNAVPF) OBJTYPE(*FILE)
     MONMSG MSGID(CPF9801) EXEC(DO)
     CRTPF FILE(&LIB/RNAVPF) SRCFILE(QDDFSRC)
     CHGPF FILE(RNAVPF) SIZE(*NOMAX)
     STRJRNPF FILE(ADBXXX/RNAVPF) JRN(*CURLIB/BUTIJRN) -
OMTJRNE(*OPNCLO)
     MONMSG MSGID(CPF0000)
     ENDDO
OVERFOR:
     CHGDTAARA DTAARA(*LDA (1 1)) VALUE('J')
     OVRDBF FILE(RCOML2) TOFILE(&LIB/RCOML2)
     OVRDBF FILE(RCMPLU) TOFILE(&LIB/RCMPLU)
     CALL PGM(XC100R) PARM(&STS)
     IF COND(&STS *NE ' ') THEN(DO)
     IF COND(&STS *EQ 'F') THEN(DO)
     CHGVAR VAR(&MLD1) VALUE('Noen poster inneholder feil,')
     CHGVAR VAR(&MLD2) VALUE('Sjekk feiltranser.')
     CHGVAR VAR(&STAT) VALUE('F')
     ENDDO
     IF COND(&STS *EQ 'B') THEN(DO)
     CHGVAR VAR(&MLD1) VALUE('Diff. i overføringen.')
     CHGVAR VAR(&MLD2) VALUE('Sjekk bilag i feiltranser.')
     CHGVAR VAR(&STAT) VALUE('B')
     ENDDO
     IF COND(&STS *EQ '0') THEN(DO)
     CHGVAR VAR(&MLD1) VALUE('Ingen poster ble funnet for')
     CHGVAR VAR(&MLD2) VALUE('overføring til Nexstep')
     CHGVAR VAR(&STAT) VALUE('T')
     ENDDO
     IF COND(&JKEY *EQ ' ') THEN(DO)
     CHGVAR VAR(&WALI) VALUE(7)
     CHGVAR VAR(&WAPO) VALUE(21)
     CHGVAR VAR(&M50) VALUE(&MLD1 *TCAT ' ' *CAT &MLD2)
     CALL PGM(AA005R) PARM(&M50)
     ENDDO
     GOTO CMDLBL(NAVEND)
     ENDDO
     CHGDTAARA DTAARA(*LDA (1 1)) VALUE(' ')
     OVRDBF FILE(RCOML2) TOFILE(&LIB/RCOML2)
     OVRDBF FILE(RCMPLU) TOFILE(&LIB/RCMPLU)
     CALL PGM(XC100R) PARM(&STS)
     IF COND(&STS *NE ' ') THEN(DO)
     IF COND(&STS *EQ 'F') THEN(DO)
     CHGVAR VAR(&MLD1) VALUE('Noen poster inneholder feil')
     CHGVAR VAR(&MLD2) VALUE('Sjekk feiltranser før ny overføring')
     CHGVAR VAR(&STAT) VALUE('F')
     ENDDO
     IF COND(&STS *EQ '0') THEN(DO)
     CHGVAR VAR(&MLD1) VALUE('Ingen poster ble funnet for')
     CHGVAR VAR(&MLD2) VALUE('overføring til Nexstep     ')
     CHGVAR VAR(&STAT) VALUE('T')
     ENDDO
     IF COND(&STS *EQ 'B') THEN(DO)
     CHGVAR VAR(&MLD1) VALUE('Diff. i overføringen.')
     CHGVAR VAR(&MLD2) VALUE('Sjekk bilag i feiltranser.')
     CHGVAR VAR(&STAT) VALUE('B')
     ENDDO
     IF COND(&JKEY *EQ ' ') THEN(DO)
     CHGVAR VAR(&WALI) VALUE(7)
     CHGVAR VAR(&WAPO) VALUE(21)
     CALL PGM(AA006C) PARM(&WALI &WAPO &MLD1 &MLD2)
     DLYJOB DLY(5)
     ENDDO
     GOTO CMDLBL(NAVEND)
     ENDDO
     IF COND(&SYST *EQ 'COMP') THEN(DO)
     CHGDTAARA DTAARA(*LDA (100 200)) VALUE('          ')
     CHGVAR VAR(&CMPRF) VALUE('COMPR' *CAT &FFIR)
     RTVDTAARA DTAARA(&CMPRF *ALL) RTNVAR(&CMPR)
     MONMSG MSGID(CPF1015) EXEC(DO)
     GOTO CMDLBL(NOCMPREG)
     ENDDO
     CHGDTAARA DTAARA(*LDA (100 10)) VALUE(%SUBSTRING(&CMPR 1 10))
     CHGDTAARA DTAARA(*LDA (111 16)) VALUE(%SUBSTRING(&CMPR 28 16))
     CHGVAR VAR(&WALI) VALUE(10)
     CHGVAR VAR(&WAPO) VALUE(26)
     CHGVAR VAR(&MLD1) VALUE('Poster fra Compello hentes ')
     CHGVAR VAR(&MLD2) VALUE('Vennligst vent           ')
     IF COND(&JKEY *EQ ' ') THEN(DO)
     CALL PGM(AA006C) PARM(&WALI &WAPO &MLD1 &MLD2)
     DLYJOB DLY(2)
     ENDDO
NOCMPREG:
     CLRPFM FILE(RCMRPF)
     OVRDBF FILE(RCMPL1) TOFILE(&LIB/RCMPL1)
     CALL PGM(RFP14R) PARM(&MEMB &JKEY &STAN)
     IF COND(&STAN *EQ 1) THEN(DO)
     IF COND(&JKEY *EQ ' ') THEN(DO)
     CHGVAR VAR(&JSTA) VALUE(15)
     CHGVAR VAR(&JMLD) VALUE('Ingen poster hentet fra Skanning')
     CALL PGM(AB705R) PARM(&JKEY &JSTA &JMLD)
     ENDDO
     GOTO CMDLBL(NAVEND)
     ENDDO
     OVRDBF FILE(RCMPL1) TOFILE(&LIB/RCMPL1)
     CALL PGM(RFP16R) PARM(&MEMB &JKEY &STAN)
     CHGVAR VAR(&STAT) VALUE('O')
     RTVDTAARA DTAARA(*LDA (110 1)) RTNVAR(&FPER)
     IF COND(&FPER *EQ 'J') THEN(DO)
     CHGVAR VAR(&WALI) VALUE(12)
     CHGVAR VAR(&WAPO) VALUE(35)
     CHGVAR VAR(&MLD1) VALUE('Det ligger posteringer her ')
     CHGVAR VAR(&MLD2) VALUE('på avsluttet periode...... ')
     CHGVAR VAR(&STAT) VALUE('P')
     IF COND(&JKEY *EQ ' ') THEN(DO)
     CALL PGM(AA006C) PARM(&WALI &WAPO &MLD1 &MLD2)
     DLYJOB DLY(5)
     ENDDO
     ENDDO
     ENDDO
NAVEND: +
     IF COND(&RV1 *EQ 5) THEN(DO)
     CHGVAR VAR(&RV2) VALUE(0)
     CALL PGM(FA720R) PARM(&RV3 &RV2)
     ENDDO
ENDPGM: +
     ENDPGM
