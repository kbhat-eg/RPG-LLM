             PGM        PARM(&REGN &MBER)

/* Utskrift av kvitteringsliste v/returoppdatering +                 */
/* generering av regnskapstransaksjoner.                             */
/* Forsøker løse problemer med at lister er skrevet ut. BSA 150612   */
/* 6.20  10.09.15  nho   Lagt inn FIX program for forfallsdato       */
/* 6.30  02.11.15  bsa   Trøbbel med håndtering av utkø              */
/* Initiering av parametre.                                          */

/*6.10*/     DCL        VAR(&PROA) TYPE(*CHAR) LEN(1)
             DCL        VAR(&PERI) TYPE(*CHAR) LEN(4)
             DCL        VAR(&REGN) TYPE(*CHAR) LEN(2)

             DCL        VAR(&PROG) TYPE(*CHAR) LEN(10) +
                          VALUE('GL115R')

             DCL        VAR(&RAPP) TYPE(*CHAR) LEN(10) +
                          VALUE('GL115P')

             DCL        VAR(&VALG) TYPE(*CHAR) LEN(1) VALUE(' ')

             DCL        VAR(&IN03)   TYPE(*CHAR) LEN(1)
             DCL        VAR(&IN12)   TYPE(*DEC) LEN(1 0)

             DCL        VAR(&PROG)   TYPE(*CHAR) LEN(10)
             DCL        VAR(&RAPP)   TYPE(*CHAR) LEN(10)
             DCL        VAR(&OVRS)   TYPE(*CHAR) LEN(1)
             DCL        VAR(&FORM)   TYPE(*CHAR) LEN(10)
             DCL        VAR(&OUTQ)   TYPE(*CHAR) LEN(10)
             DCL        VAR(&ACPIX)  TYPE(*CHAR) LEN(4)
             DCL        VAR(&ACPI)   TYPE(*DEC)  LEN(4 0)
             DCL        VAR(&AKOPX)  TYPE(*CHAR) LEN(6)
             DCL        VAR(&AKOP)   TYPE(*DEC)  LEN(6 0)
             DCL        VAR(&HLDQ)   TYPE(*CHAR) LEN(4)
             DCL        VAR(&ALINX)  TYPE(*CHAR)  LEN(3)
             DCL        VAR(&ALIN)   TYPE(*DEC)  LEN(3 0)
             DCL        VAR(&PRTY)   TYPE(*CHAR) LEN(1)
             DCL        VAR(&OFLWX)  TYPE(*CHAR) LEN(3)
             DCL        VAR(&OFLW)   TYPE(*DEC)  LEN(3 0)
             DCL        VAR(&BTCH)   TYPE(*CHAR) LEN(1)

             DCL        VAR(&FIRM)   TYPE(*CHAR) LEN(3)
             DCL        VAR(&MBER)   TYPE(*CHAR) LEN(7)
   /*        DCL        VAR(&MBER)   TYPE(*CHAR) LEN(5) */
             DCL        VAR(&TEXT)   TYPE(*CHAR) LEN(50)
             DCL        VAR(&USER)   TYPE(*CHAR) LEN(10)
             DCL        VAR(&MBER1)  TYPE(*CHAR) LEN(10)
             DCL        VAR(&MBER2) TYPE(*CHAR) LEN(10)

/* LDA skal ved oppkall av denne rutinen inneholde en verdi i        */
/* posisjon 844-844 for å fortelle om formularparametre skal         */
/* vises på skjermen (verdi="1") før de legges ut i LDA, eller       */
/* legges direkte ut i LDA fra formularregister (verdi= " ").        */

/* Oppdaterer LDA med navn på prinfile og kode for om formular-      */
/* parametre skal endres.                                            */

             CHGDTAARA  DTAARA(*LDA (800 10)) VALUE(&PROG)
             CHGDTAARA  DTAARA(*LDA (844 1)) VALUE(&VALG)
             CHGDTAARA  DTAARA(*LDA (846 10)) VALUE(&PROG)

/* Oppkall av utskriftsparametre.                                    */

/*           CALL       PGM(AP100R) PARM(&IN03 &IN12) */

             CALL       PGM(AP600R) PARM('GL115' '1' '0' &IN03 &BTCH)

/* Tester om F3 eller F12 er tastet.  Da skal rapport ikke skrives.  */

             IF         COND(&IN03 *EQ '1') THEN(GOTO CMDLBL(END))
             IF         COND(&IN12 *EQ 1) THEN(GOTO CMDLBL(END))

/* Henter verdier i fra LDA.                                         */

             RTVDTAARA  DTAARA(*LDA (800 10)) RTNVAR(&PROG)
             RTVDTAARA  DTAARA(*LDA (810 10)) RTNVAR(&OUTQ)
             RTVDTAARA  DTAARA(*LDA (820 10)) RTNVAR(&FORM)
             RTVDTAARA  DTAARA(*LDA (830 4)) RTNVAR(&ACPIX)
             RTVDTAARA  DTAARA(*LDA (834 4)) RTNVAR(&HLDQ)
             RTVDTAARA  DTAARA(*LDA (838 6)) RTNVAR(&AKOPX)
             RTVDTAARA  DTAARA(*LDA (845 1)) RTNVAR(&OVRS)
             RTVDTAARA  DTAARA(*LDA (846 10)) RTNVAR(&RAPP)
             RTVDTAARA  DTAARA(*LDA (856 3)) RTNVAR(&ALINX)
             RTVDTAARA  DTAARA(*LDA (859 1)) RTNVAR(&PRTY)
             RTVDTAARA  DTAARA(*LDA (860 3)) RTNVAR(&OFLWX)
             RTVDTAARA  DTAARA(*LDA (863 1)) RTNVAR(&BTCH)
             RTVDTAARA  DTAARA(*LDA (864 5)) RTNVAR(&MBER)
             RTVDTAARA  DTAARA(*LDA (911 10)) RTNVAR(&USER)
/*6.30*/     RTVDTAARA  DTAARA(*LDA (584 1)) RTNVAR(&PROA)

/* ANTALL KOPIER, LINJER og CPI må konverteres til numerisk felt.    */

             CHGVAR     VAR(&AKOP) VALUE(&AKOPX)
             CHGVAR     VAR(&ACPI) VALUE(&ACPIX)
             CHGVAR     VAR(&ALIN) VALUE(&ALINX)
             CHGVAR     VAR(&OFLW) VALUE(&OFLWX)
/*6.10*/     IF         COND(&PROA *EQ '1') THEN(DO)
/*6.10*/     CHGVAR     VAR(&OUTQ) VALUE('PDFPRINT')
/*6.10*/     ENDDO

/* Tester om printfile skal overrides.                               */

             IF         COND(&OVRS *EQ ' ') THEN(GOTO +
                          CMDLBL(NOTOVRPRTF))

/* Endrer printfile ut i fra nye verdier.                            */

             OVRPRTF    FILE(GL115PF) TOFILE(*FILE) DEV(&OUTQ) +
                          PAGESIZE(&ALIN) CPI(&ACPI) +
                          OVRFLW(&OFLW) OUTQ(&OUTQ) +
                          FORMTYPE(&FORM) COPIES(&AKOP) +
                          HOLD(&HLDQ) OUTPTY(&PRTY)

/* Endrer printfile ut i fra nye verdier.                            */

             OVRPRTF    FILE(GL115PL) TOFILE(*FILE) DEV(&OUTQ) +
                          PAGESIZE(&ALIN) CPI(&ACPI) +
                          OVRFLW(&OFLW) OUTQ(&OUTQ) +
                          FORMTYPE(&FORM) COPIES(&AKOP) +
                          HOLD(&HLDQ) OUTPTY(&PRTY)

NOTOVRPRTF:

/* Dersom regnskapsperiode IKKE er utfylt, så indikerer dette        */
/* at det IKKE er postering som skal legges ut til regnskap:         */

             IF         COND(&REGN *NE 'JA') THEN(DO)
             GOTO       CMDLBL(IKKEMEMBER)
             ENDDO

/* BYGGER UNIKT MEMBERNØKKEL -> "GLxxxxx":                         */

/* Hvor xxxx = Unik teller fra AP100R.                               */

             CHGVAR     VAR(%SST(&MBER 1 2)) VALUE('GL')
             CHGVAR     VAR(%SST(&MBER 3 5)) VALUE(&MBER)

/* Redigerer beskrivelse:                                          */

             RTVDTAARA  DTAARA(*LDA (944 3)) RTNVAR(&FIRM)
             CHGVAR     VAR(%SST(&TEXT 1 4)) VALUE('TELE')
             CHGVAR     VAR(%SST(&TEXT 6 6)) VALUE('Firma:')
             CHGVAR     VAR(%SST(&TEXT 13 3)) VALUE(&FIRM)
             CHGVAR     VAR(%SST(&TEXT 17 7)) VALUE('Bruker:')
             CHGVAR     VAR(%SST(&TEXT 25 10)) VALUE(&USER)

/* Bygger membere dersom de ikke finnes                              */


/* Overide databasefile til aktuelt member                           */


IKKEMEMBER:
             RTVDTAARA  DTAARA(*LDA (944 3)) RTNVAR(&FIRM)
             CHGVAR     VAR(%SST(&MBER2 1 4)) VALUE('TELE')
             CHGVAR     VAR(%SST(&MBER2 5 3)) VALUE(&FIRM)
             CHGVAR     VAR(%SST(&MBER1 1 10)) VALUE(&MBER)
             CALL       PGM(FIXGUR2)
             CALL       PGM(GL115R) PARM(&REGN &MBER1 &MBER2)

END:
