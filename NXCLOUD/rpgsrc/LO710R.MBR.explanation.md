# RPG Program LO710R: Explanation

This program is written in RPG IV (ILE RPG) and is designed for the IBM iSeries (AS/400) platform. The purpose of the program is to display information about the person holding an order, making use of a physical file `LOHEL1` (renamed `lohel1r`) and a display file `LO710D` (workstn device).

Below, we break down the key parts of the code for onboarding and maintenance.

---

## Header and Comments

- The **header specifications** (`h option(*nodebugio) datedit(*dmy)`) control compile-time options:
  - `*nodebugio`: Omits debug information for file I/O.
  - `datedit(*dmy)`: Sets date editing to "day-month-year".
- Comments (in Norwegian) describe the purpose: "Show information about who is holding the order".

---

## File Declarations

```rpg
flohel1    if   e           k disk    rename(lohepfr:lohel1r)
flo710d    cf   e             workstn
```
- `lohel1`: Physical file (input, keyed, disk), externally described. Renamed to `lohel1r` within this program.
- `lo710d`: Display file, for screen I/O.

---

## Definition of Parameters and Variables

### Parameters

```rpg
d p_firm          s                   like(lofirm)
d p_numm          s                   like(lonumm)
d p_suff          s                   like(losuff)
```
- **Program parameters:** These are the input values to the program, typically coming from another program in a call statement.
  - `p_firm`: Company.
  - `p_numm`: Order number.
  - `p_suff`: Order suffix.

### Local Data Area Variables

```rpg
d                uds
d l_firm                944    946  0
d l_fnav                951    980
```
- **User Data Structure (UDS):** Used for local storage, often to pass data between programs or carry job-related info.
  - `l_firm`, `l_fnav` point to specific positions in the data area.

### Key Variables

```rpg
d lohel1_numm     s                   like(lonumm)
d lohel1_suff     s                   like(losuff)
```
- Local variables for the order number and suffix, used as key fields for file access.

### Other Variables

```rpg
d w_firm          s                   like(lofirm)
```
- Working copy of the company code.

---

## Mainline Logic

### Initialization

```rpg
c                   eval      x1dumy = *blank
```
- Initializes a dummy variable, probably used to clear/display a blank field on the screen.

### Retrieve Order Header Information

```rpg
c     lohel1_key    chain     lohel1r
B001 c                   if        %found
 001  *
 001 c                   eval      x1kous = lokous
 001 c                   eval      x1kows = lokows
 001  *
B002 c                   if        lokoda <> *loval
 002 c     *dmy          move      lokoda        x1koda
E002 c                   endif
 001  *
 001 c     *hms          move      lokoti        x1koti
 001  *
E001 c                   endif
```
- **Chain operation:** Fetches a record from `lohel1r` using the keys defined in `lohel1_key`.
- **%found:** Checks if a matching record was found.
- If found:
  - Sets values like `x1kous` and `x1kows` from fields in the file (likely identifying who holds the order).
  - Transfers date (`lokoda`) and time (`lokoti`) fields if appropriate.

### Display

```rpg
c                   exfmt     x1bld
```
- Formats and displays the screen format `x1bld` from the display file.

---

## Program End

```rpg
c                   eval      *inlr = *on
c                   return
```
- Sets on the last record indicator (`*INLR`), ensuring program cleanup.
- Returns from the program.

---

## Subroutine: *INZSR (Initialization Subroutine)

### Parameter List

```rpg
c     *inzsr        begsr
c     *entry        plist
c                   parm                    p_firm
c                   parm                    p_numm
c                   parm                    p_suff
```
- Defines how parameters are received from the calling program.

### Key List Preparation

```rpg
c     lohel1_key    klist
c                   kfld                    w_firm
c                   kfld                    lohel1_numm
c                   kfld                    lohel1_suff
```
- Defines the keyed fields for accessing `lohel1`.

### Assigning Key Values

```rpg
c                   eval      w_firm = p_firm
c                   eval      lohel1_numm = p_numm
c                   eval      lohel1_suff = p_suff
c                   endsr
```
- Transfers the parameter values to the local key fields, preparing for file access.

---

# Summary / How It Works

1. **Initialization**: The program receives three parameters: company, order number, and suffix.
2. **Key Setup**: These parameters are used to set up the keys for reading the order header file.
3. **Record Fetch (CHAIN)**: The program reads the relevant order from the file using these keys.
4. **Field Assignment**: If a record is found, certain fields are assigned to display variables.
5. **Screen Display**: The information is displayed on the screen using a specific format.
6. **End**: The program closes down correctly, returning to the caller.

---

## Key Concepts Covered

- **CHAIN**: Random access retrieval of a keyed record in a file.
- **%FOUND**: Returns true if the previous operation (e.g., CHAIN) was successful.
- **EXFMT**: Reads input and writes output to a display file; here, it displays the info.
- **Parameter passing**: Program expects to be called with three parameters.
- **KLIST/KFLD**: Constructs a key list to use in file operations.

---

## Onboarding Note

- If you enhance or maintain this program, focus on the consistency of field definitions and key access logic.
- For UI adjustments, modify the display file (`LO710D`) and adjust the RPG code accordingly.
- For additional fields or more complex business logic, ensure new parameters or display variables are mapped appropriately.

---

**This program is a classic example of an RPG order inquiry screen, keyed on company/order/suffix, showing who is responsible for an order.**