      /TITLE  ASSHOP: Henter inn fra ordre-register til butikk-register
     h datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASSHOP
      * Program . . . . : BOHNOR
      * Beskrivelse . . : Henter inn fra ordre-register til butikk
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       100101 AMD  Programmet er lagt om til standard ILE
      *
3.31  * R3.31 100101 AMD  Statistikk ble ikke oppdatert med varegruppe
3.31  *                   på varer hentet fra LVR (ordre hentet til butikk)
3.32  * R3.32 290301 AMD  Lagt inn mulighet for å styre om rabatter skal
      *                   vises med prosent, eller som bare et nettobeløp.
6.10  * R6.10 021210 BSA  Vi har tatt i bruk prisliste suffix til korthåndtering
6.10  *                   Feltet kan ikke endres i dette programmet.
8.01  *PRG2   210622 bof  Utvidet prisgruppe fra 1 til 2 posisjoner
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     ffohel1    if   e           k disk    rename(fohepfr:fohel1r)
     ffohelu    uf   e           k disk    rename(fohepfr:fohelur)
     ffodtl1    if   e           k disk    rename(fodtpfr:fodtl1r)
     fbmhelu    uf a e           k disk    rename(bmhepfr:bmhelur)
     fbmdtlu    uf a e           k disk    rename(bmdtpfr:bmdtlur)
      *
      * Definering av Local data area
      *
     d                uds
     d l_wsid                901    910
     d l_user                911    920
      *
      * Definering av parametere
      *
     d p_firm          s                   like(fofirm)
     d p_aarr          s                   like(bnaarr)
     d p_kode          s                   like(w_alf1)
     d p_numm          s                   like(fonumm)
     d p_suff          s                   like(fosuff)
     d p_wsid          s                   like(bnwsid)
      *
      * Definering av variabler i nøkler
      *
     d w_firm          s                   like(fofirm)
     d fohel1_numm     s                   like(fonumm)
     d fohel1_suff     s                   like(fosuff)
     d fodtl1_line     s                   like(fdline)
     d fodtl1_numm     s                   like(fdnumm)
     d fodtl1_suff     s                   like(fdsuff)
     d bmhelu_aarr     s                   like(bnaarr)
     d bmhelu_numm     s                   like(bnnumm)
     d bmhelu_wsid     s                   like(bnwsid)
     d bmdtlu_aarr     s                   like(bmaarr)
     d bmdtlu_numm     s                   like(bmnumm)
     d bmdtlu_line     s                   like(bmline)
     d bmdtlu_wsid     s                   like(bmwsid)
      *
      * Definering av variable
      *
     d w_date          s               d   datfmt(*iso)
     d w_time          s               t   timfmt(*iso)
     d w_alf1          s              1
      *
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Forklaring til statuskode fra forrige program
      *
      * Kode=1  :  Henter inn ordren til butikk, merker at den er tatt
      *            inn i butikk på ordren i OFAK
      *
      * Kode=2  :  Henter kun inn heading til butikk, merker IKKE
      *            ordren, men legger ordrenummer inn som PRISORDRE-NR
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Merker Ordre i ORDRE-HODE-REGISTER, Er tatt inn i butikk
      *
      * Kode=7  :  Ordren er tatt inn fra ASOFAK til ASSHOP
      *            for behandling, Ordren kan derfor ikke
      *            behandles i ASOFAK nå. Kode vises på spørring
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c                   if        p_kode = '1'
     c     fohel1_key    chain     fohelur                            90
     c                   if        *in90 = *off
     c                   eval      fokode = 7
     c                   update    fohelur
     c                   endif
     c                   endif
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Henter inn linjer fra  ORDRE-LINJE-REGISTER
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c                   if        p_kode = '1'
     c     fodtl1_key    setll     fodtl1r
      *
     c     startl        tag
     c                   eval      *in90 = *off
     c                   read      fodtl1r                                90
      *
     c                   if        *in90 = *off
     c                   if        fodtl1_numm = fdnumm
     c                   if        fodtl1_suff = fdsuff
     c                   eval      bmdtlu_line = fdline
     c     bmdtlu_key    chain     bmdtlur                            92
     c                   if        *in92 = *on
     c                   eval      bmfirm = w_firm
     c                   eval      bmaarr = bmdtlu_aarr
     c                   eval      bmwsid = bmdtlu_wsid
     c                   eval      bmnumm = bmdtlu_numm
     c                   eval      bmline = bmdtlu_line
      *
      * Legger over opplysninger om den enkelte linjen
      *
     c                   eval      bmltyp = fdltyp
     c                   eval      bmvare = fdvare
     c                   eval      bmenh1 = fdenh1
     c                   eval      bmtek1 = fdtek1
     c                   eval      bmtek2 = fdtek2
     c                   eval      bmanta = fdanta
     c                   eval      bmkpri = fdkpri
     c                   eval      bmsapr = fdsapr
     c                   eval      bmkopr = fdkopr
     c                   eval      bmselk = *zero
     c                   eval      bmrab1 = fdrab1
     c                   eval      bmrab2 = fdrab2
3.31 c                   eval      bmogrp = fdogrp
3.31 c                   eval      bmhgrp = fdhgrp
3.31 c                   eval      bmugrp = fdugrp
3.31 c                   eval      bmlvre = fdlvre
      *
     c                   eval      bmsums = fdsums - fdsumr
      *
     c                   write     bmdtlur
     c                   endif
      *
     c                   goto      startl
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Henter inn fra         ORDRE-HODE-REGISTER
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     fohel1_key    chain     fohel1r                            90
      *
      * Legger ut igjen ordren med nytt ordrenummer
      *
     c     bmhelu_key    chain     bmhelur                            90
     c                   if        *in90 = *on
     c                   eval      bnfirm = w_firm
     c                   eval      bnaarr = bmhelu_aarr
     c                   eval      bnwsid = bmhelu_wsid
     c                   eval      bnnumm = bmhelu_numm
      *
      * Legger over opplysninger
      *
     c                   eval      bnotyp = footyp
     c                   eval      bnlage = folage
     c                   eval      bnbinr = *zero
     c                   eval      bnkref = fokref
     c                   eval      bnbdat = w_date
     c                   eval      bnldat = foldat
     c                   eval      bnfkda = fofkda
     c                   eval      bnffda = foffda
     c                   eval      bnbetb = fobetb
     c                   eval      bnselg = foselg
     c                   eval      bndist = fodist
     c                   eval      bnlmat = folmat
     c                   eval      bnlbet = folbet
     c                   eval      bnvalk = fovalk
     c                   eval      bnrkat = forkat
     c                   eval      bnsped = fosped
     c                   eval      bnkjor = fokjor
     c                   eval      bnmkod = fomkod
     c                   eval      bnlkun = folkun
     c                   eval      bnkund = fokund
     c                   eval      bnkuna = fokuna
     c                   eval      bnnavn = fonavn
     c                   eval      bnadr1 = foadr1
     c                   eval      bnadr2 = foadr2
     c                   eval      bnsted = fosted
     c                   eval      bnavde = foavde
     c                   eval      bnkont = fokont
     c                   eval      bnspes = fospes
     c                   eval      bnproj = foproj
     c                   eval      bnakti = foakti
     c                   eval      bnkgfa = fokgfa
     c                   eval      bnvref = fovref
     c                   eval      bndref = fodref
     c                   eval      bnrekv = forekv
     c                   eval      bnlmtx = folmtx
     c                   eval      bnlbtx = folbtx
     c                   eval      bnrabp = forabp
     c                   eval      bnpord = fopord
6.10 c**                 eval      bnpsuf = fopsuf
     c                   eval      bnmott = *zero
     c                   eval      bntotb = *zero
     c                   eval      bntotx = fototx
     c                   eval      bndate = w_date
     c                   eval      bntime = w_time
3.32 c                   eval      bnneto = foneto
      *
     c                   if        p_kode = '1'
     c                   eval      bnornr = fonumm
     c                   eval      bnorsu = fosuff
     c                   endif
      *
     c                   eval      bntots = fotots - fototr
      *
     c                   write     bmhelur
     c                   endif
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Oppdaterer butikk-ordre med PRISORDRE-NUMMER
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c                   if        p_kode = '2'
     c     bmhelu_key    chain     bmhelur                            90
     c                   if        *in90 = *off
     c                   eval      bnpord = fohel1_numm
     c                   eval      bnpsuf = fohel1_suff
     c                   update    bmhelur
     c                   endif
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     *inzsr        begsr
      *
      * Nullstilling av felter som ikke kan redefineres
      *
     c                   eval      w_alf1 = *blank
      *
      * Key for file : ORDRE-HODE-REGISTER
      *
     c     fohel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fohel1_numm
     c                   kfld                    fohel1_suff
      *
      * Key for file : ORDRE-LINJE-REGISTER
      *
     c     fodtl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fodtl1_numm
     c                   kfld                    fodtl1_suff
     c                   kfld                    fodtl1_line
      *
      * Key for file : BONG-HODE-REGISTER
      *
     c     bmhelu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    bmhelu_aarr
     c                   kfld                    bmhelu_wsid
     c                   kfld                    bmhelu_numm
      *
      * Key for file : BONG-LINJE-REGISTER
      *
     c     bmdtlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    bmdtlu_aarr
     c                   kfld                    bmdtlu_wsid
     c                   kfld                    bmdtlu_numm
     c                   kfld                    bmdtlu_line
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Tar inn parameter fra forrige program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     *entry        plist
     c                   parm                    p_kode
     c                   parm                    p_firm
     c                   parm                    p_aarr
     c                   parm                    p_wsid
     c                   parm                    p_numm
     c                   parm                    p_suff
      *
      * Legger inn firmanummer i nøkkel
      *
     c                   eval      w_firm = p_firm
      *
      * Legger inn ordrenummer og suffix inn i nøkklene
      *
     c                   eval      fohel1_numm = p_numm
     c                   eval      fohel1_suff = p_suff
      *
     c                   eval      fodtl1_numm = p_numm
     c                   eval      fodtl1_suff = p_suff
     c                   eval      fodtl1_line = *zero
      *
     c                   eval      bmhelu_aarr = p_aarr
     c                   eval      bmhelu_wsid = p_wsid
     c                   eval      bmhelu_numm = *zero
      *
     c                   eval      bmdtlu_aarr = p_aarr
     c                   eval      bmdtlu_wsid = p_wsid
     c                   eval      bmdtlu_numm = *zero
     c                   eval      bmdtlu_line = *zero
      *
      * Legger inn dagens dato
      *
     c                   time                    w_date
     c                   time                    w_time
      *
     c                   endsr
