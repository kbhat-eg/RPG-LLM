## Overview

This is an ILE RPG (RPG IV) program intended for processing customers for debt collection (inkasso) selection. The program contains business rules for filtering and selecting customers and their transactions for further debt collection processing. It's built around several physical files (database tables), indicator usage conventions, and historical change logs.

Key concepts:
- **Customer selection for debt collection**
- **Processing postings (transactions)**
- **Special handling and filtering**
- **Use of indicators for control flow**
- **Handling batch and audit data**

---

## Header and Historical Comments

- The header includes system and program identifiers, description, version history, and functional comments.
- Change logs are thoroughly documented, giving context for functional changes over time.

---

## File Definitions

- Several database files are defined and renamed for local reference:
    - `rkunl1`, `rkunlu`: Main customer files.
    - `rkbplr`: Customer addition/supplementary file (additional info).
    - `rktrl1`: Customer postings/transactions.
    - `rkwbpf`, `rkwblu`: Selected postings, probably temporary work files.
    - `rca0l1`: Status info, e.g., voucher types to exclude.

All files are keyed and disk-based.

---

## Data Structures and Fields

### User Data Section (`uds`)

- Fields are pulled from a "uds" (user data space), using positional definitions.
- Fields include customer info, firm, period, posting start/end, selection ranges, etc.
- `kun` is an array for up to 10 specific customer numbers.

### Work Variables

- Variables for date manipulation, counters, timestamps, etc.
- Variables for tracking the current firm, customer, and posting.

### External Program Declaration

- Interface for calling another program (`CO402R`), used for conditional business logic depending on external parameters or config, e.g., whether to update customers with certain attributes.

---

## Main Program Logic

### INIT section

- Sets the `w_firm` (working firm) variable.
- Prepares to loop through the customer file (`rkunlu`).

---

### LOOP: Select Customers

- `setll` and `reade` to position and read the customer file.
- **Main customer processing loop** begins and continues until EOF.

#### Customer exclusion logic

- Several checks skip customers from further processing:
    - Exclusion based on `rkrenk` (interest/correction attributes).
    - Direct goto to `nykund` tag if excluded.
    - Additional check: if the customer is "excluded from collection" via the supplementary file (`rkbplr`) or by external config (via `CO402R`/`u_inkk`).
    - Only customers within specified number and category ranges and with a positive balance are processed.
    - If customer does not match, the loop continues to the next with `nykund`.

#### Customer inclusion logic

- If the customer passes all filters:
    - Calls subroutine `beh_trans` to process the customer’s transactions.
    - After processing, may call `slett_trans` to delete work-file postings for this customer if needed.
    - Updates the `rkinkk` (debt collection indicator) based on whether the customer has a remaining balance or not.
    - Updates audit fields and writes changes to the customer record.

---

### beh_trans: Process Customer Transactions

- Loops through all postings for the selected customer (`rktrl1`).
- Multiple business rules are applied to each posting:
    - Filters out postings from certain departments, previously sent to collection, marked as complaints, or with zero balance.
    - Excludes postings that have not been reminded enough times.
    - Excludes specific voucher codes (from `rca0l1` and hardcoded 65).
    - **Special logic**: Credit postings (negative balance) bypass due date checks.
    - For debits, only postings that are overdue based on the current date plus allowed days are considered.
- Eligible postings are recorded in the work file (`rkwbpfr`) and contribute to the remaining balance (`w_rest`).

---

### slett_trans_a and slett_trans: Clean Negative Balance Postings

- These routines scan the work file(s) for customers with the `inkasso` code set to 'N' and delete their temporary postings.
- `slett_trans` operates on a single customer, `slett_trans_a` on all customers.

---

### Initial Setup and Keylist Definitions (*inzsr)

- Sets up date conversion for the posting date.
- Defines all keylists for relative record positioning in the files.
- Loads exclusion lists (voucher codes).
- Calls the external program `CO402R` to check if the "do not update customer with INKK='N'" rule should be active.

---

## Indicator Usage

- Indicators (e.g., 61, 62, 63, *inLR) are used for IO status, subroutine control, and field protection.
- Comments document indicator mapping by function.

---

## Key Business Rules

- Only process customers with the right company, number, and categories.
- Skip customers that are explicitly marked as not for collection in either base or supplementary files.
- Only process postings that are overdue, not already escalated, not complaints, not to be excluded by code, and positive due.
- Write selected postings to a work file.
- Mark customer as processed for collection if any due remains, otherwise clear the flag.
- Remove temporary postings for customers marked as "not for collection".

---

## Norwegian Business Terms

- Many field names originate from Norwegian accounting terms: 
    - "Inkasso" (debt collection), 
    - "Purring" (reminder), 
    - "Kreditpost" (credit posting), 
    - "Bilagskode" (voucher code),
    - "Kunde" (customer), etc.

---

## Special Handling

- The program is modified for specific customers or business partners, as noted in the change log (e.g., Skattum, Mestergruppen).
- The external program (`CO402R`) is called for advanced, customer-specific control, like when customers should **not** be set for collection.

---

## Summary

**This RPG program is a robust, rule-driven batch process for selecting and preparing customers and their transactions for debt collection.** It is built to be extensible for customer- and version-specific requirements and to ensure that only eligible customers and postings proceed to collection, with strong audit and indicator support. The program’s flow is heavily documented both in code and through change logs.

**Onboarding Recommendations:**
- Understand each physical file’s layout and business meaning.
- Become familiar with indicator handling for flow control.
- Study business rules in context with company configuration (much logic is parameter-driven).
- Reading Norwegian comments/field names will help with domain knowledge.

---

**If you need clarification on a specific subroutine, field, or business rule block, let me know!**