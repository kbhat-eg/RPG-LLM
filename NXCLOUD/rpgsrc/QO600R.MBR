      /TITLE  ASOFAK: Inntasting av parameter for ordre-utskrift
     h option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOFAK
Q.01  * Program . . . . : QO600R
      * Beskrivelse . . : Inntasting av parameter for ordre-utskrift
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       090301 AMD  Programmet er skrevet om til standard ILE
      * R3.31 090301 AMD  Lagt inn melding dersom bruker ikke har tilgang
      *                   til å sette igang fakturering
5.01  * R5.01 060502 AMD  Lagt inn melding dersom det forsøkes gjenutskrift
5.01  *                   av pakkseddel, og bruker ikke har lov til det.
5.02  * R5.02 140502 AMD  Bygget inn brukerstyrt valg av tekster i bildet
5.02  *                   for utskrift av interne ordrepapirer
5.03  * R5.03 150502 AMD  Kode for Felles / direkte / jobbkø, hentes fra
5.03  *                   ordretype, og legges inn i skjermbildet.
5.04  * R5.04 211002 AMD  Lagt inn logikk for sending av e-mail
5.41  * R5.41 160605 AMD  Endring av kontroll på skrevet pakkseddel
      * 6.10  240609 BSA  Oppdatert med sporingsinformasjon
pdf   * 6.10  150610 BSA  Håndteringen av mail skjer nå fra parameterbilde 2
pdf   *                   for POA aktiverte rutiner.
6.11  * 6.10  051010 BSA  Må kunne skille mellom ny og gammel rutine for å legge
6.11  *                   ut e-mail.
6.20  * 6.20  220813 BSA  Send feilmelding hvis email er valgt og PROA er aktivert
6.NU  * R6.30 260514 bsa  Programmet gjennomgått mtp nummerutvidelser.
7.xx  * 7.00  290116 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
Q.01  * 7.00  080219 bsa  Quick wins - automatisere utskrifter
Q.02  *K0000  151123 bsa  Quick wins - korrigeres til å bruke standard
Q.02  *K0000              funksjonalitet, og ikke hardkodet rutine.
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
Q.01 fqo600d    cf   e             workstn
     fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
5.02 fvbldl1    if   e           k disk    rename(vbldpfr:vbldl1r)
     ffohelu    uf   e           k disk    rename(fohepfr:fohelur)
     ffohel1    if   e           k disk    rename(fohepfr:fohel1r)
     ffplolu    uf a e           k disk    rename(fplopfr:fplolur)
     ffplol1    if   e           k disk    rename(fplopfr:fplol1r)
3.31 ffusrl1    if   e           k disk    rename(fusrpfr:fusrl1r)
      *
      * Definering av local data area
      *
     d                uds
pdf  d l_poff                584    584
pdf  d l_ruti                800    809
     d l_wsid                901    910
     d l_user                911    920
pdf  d l_filg                931    933
     d l_sfir                944    946  0
pdf  d l_avde                947    950  0
      *
      * Definering av parametere
      *
     d p_firm          s                   like(fofirm)
6.NU d p_numm          s                   like(fonumm)
     d p_suff          s                   like(fosuff)
     d p_ipor          s                   like(w_alf1)
6.11 d p_ruti          s                   like(l_ruti)
6.11 d p_pdf           s              1
Q.01 d p_acti          s              2
      *
      * Definering av variable i nøkler
      *
     d w_firm          s                   like(fofirm)
     d fohel1_numm     s                   like(fonumm)
     d fohel1_suff     s                   like(fosuff)
     d fplol1_numm     s                   like(fkponr)
     d fplol1_suff     s                   like(fkpsuf)
     d votyl1_otyp     s                   like(vaotyp)
5.02 d vbldl1_balt     s                   like(vabalt)
3.31 d fusrl1_user     s                   like(fbuser)
      *
      * Definering av variable
      *
     d w_alf1          s              1
     d w_skor          s              1
     d w_sjek          s              1
     d w_outq          s             10
     d w_otyp          s                   like(footyp)
     d w_palt          s                   like(fkpalt)
     d w_svar          s                   like(fkpdir)
6.11 d w_ruti          s                   like(l_ruti)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Velg utfra ORDRETYPE hvilket bilde som skal vises
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
      *  Hent opplysninger fra ORDRE-HODE-REGISTER
      *
     c     fohel1_key    chain     fohel1r                            90
     c                   if        *in90 = *off
     c                   eval      w_otyp = footyp
     c                   endif
      *
      *  Hent opplysninger fra UTPLUKK-PARAM-REGISTER
      *       (Ordretype hentes kun om den finnes plukket tidligere)
      *
     c     fplol1_key    chain     fplol1r                            90
     c                   if        *in90 = *off
     c                   eval      w_otyp = fkpoty
     c                   endif
      *
      *  Hent opplysninger fra ORDRETYPE-REGISTER
      *
     c                   eval      votyl1_otyp = w_otyp
     c     votyl1_key    chain     votyl1r                            90
5.03  *
      *  Utfra ordretype (akk.type) hopp til riktig bilde
      *
     c     vaoakk        cabeq     0             e2tag
     c     vaoakk        cabeq     1             e3tag
     c     vaoakk        cabeq     2             e4tag
     c     vaoakk        cabeq     3             e5tag
      *
     c                   goto      xslutt
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  E2 Behandler valg for utskrift av TILBUD
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     e2tag         tag
      *
6.11 c                   eval      w_ruti = 'FTILB    '
6.11 c                   exsr      sjk_proa
      *
      *  Nullstiller felter som benyttes
      *
     c                   eval      e2valg = *zero
     c                   eval      e2svar = vaofdj
     c                   eval      e2outq = *blank
      *
     c     e2taga        tag
Q.01  * Skal ikke vise skjermbilde
Q.01 c                   if        1 = 2
     c                   exfmt     e2bld
Q.01 c                   endif
      *
      *  F3=Avslutt
      *
     c                   if        *inkc  = *on
     c                   eval      p_ipor = '1'
     c                   goto      xslutt
     c                   endif
      *
      *  Sjekk om skriver er en gyldig device
      *
     c                   if        e2outq <> *blank
      *
     c                   eval      w_sjek = *blank
     c                   call      'FQPRTC'
     c                   parm                    w_sjek
     c                   parm                    e2outq
      *
     c                   if        w_sjek <> *blank
     c                   eval      *in31 = *on
     c                   goto      e2taga
     c                   endif
     c                   endif
6.20  * Send feilmelding hvis valg 3 og PROA er aktivert.
6.20 c                   if        *in35  = *on and
6.20 c                             e2svar = 3
6.20 c                   eval      *in36 = *on
6.20 c                   goto      e2taga
6.20 c                   endif
      *
      *  Legger opplysninger over i felles-felter
      *
Q.01 c**                 eval      w_palt = e2valg
Q.01 c                   eval      w_palt = 0
Q.01 c**                 eval      w_svar = e2svar
Q.01 c                   eval      w_svar = 1
     c                   eval      w_outq = e2outq
5.04  *
5.04  *  Styring til e-mail
5.04  *
5.04 C                   if        e2svar = 3
5.04 C                   eval      e2svar = 1
5.04 C                   eval      e2outq = 'E_MAIL_ASP'
5.04 c                   eval      w_svar = e2svar
5.04 c                   eval      w_outq = e2outq
5.04 C                   endif
      *
     c                   goto      start
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  E3 Behandler valg for utskrift av ORDREBEKREFTELSE/PLUKKLISTE
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     e3tag         tag
      *
Q.02 c                   eval      w_ruti = 'FOBEK    '
Q.02 c**                 eval      w_ruti = 'FOBEKQW  '
6.11 c                   exsr      sjk_proa
      *
      *  Nullstiller felter som benyttes
      *
     c                   eval      e3valg = *zero
     c                   eval      e3svar = vaofdj
     c                   eval      e3outq = *blank
5.02 c                   eval      e3btx1 = *blank
5.02 c                   eval      e3btx2 = *blank
5.02  *
5.02  *  Henter inn tekster fra fil for bilde-
5.02  *  alternativer dersom det er benyttet
5.02  *
5.02 c                   eval      vbldl1_balt = vaobld
5.02 c     vbldl1_key    chain     vbldl1r
5.02  *
5.02 c                   if        %found
5.02 c                   if        vabtx1 <> *blank
5.02 c                   eval      e3btx1 = '0=' + vabtx1
5.02 c                   endif
5.02 c                   if        vabtx2 <> *blank
5.02 c                   eval      e3btx2 = '1=' + vabtx2
5.02 c                   endif
5.02 c                   else
5.02 c                   eval      e3btx1 = '0=Ordrebekreftelse'
5.02 c                   eval      e3btx2 = '1=Plukkliste'
5.02 c                   endif
5.02  *
      *
     c     e3taga        tag
Q.01  * Skal ikke vise skjermbilde
Q.01 c                   if        1 = 2
     c                   exfmt     e3bld
Q.01 c                   endif
      *
      *  F3=Avslutt
      *
     c                   if        *inkc  = *on
     c                   eval      p_ipor = '1'
     c                   goto      xslutt
     c                   endif
5.02  *
5.02  *  Sjekk om alternativ 1 er gyldig,
5.02  *  eller om bare 0 skal kunne benyttes
5.02  *
5.02 c                   if        e3btx2 = *blank
5.02 c                   if        e3valg = 1
5.02 c                   eval      *in34  = *on
5.02 c                   goto      e3taga
5.02 c                   endif
5.02 c                   endif
      *
      *  Sjekk om skriver er en gyldig device
      *
     c                   if        e3outq <> *blank
      *
     c                   eval      w_sjek = *blank
     c                   call      'FQPRTC'
     c                   parm                    w_sjek
     c                   parm                    e3outq
      *
     c                   if        w_sjek <> *blank
     c                   eval      *in31 = *on
     c                   goto      e3taga
     c                   endif
     c                   endif
6.20  * Send feilmelding hvis valg 3 og PROA er aktivert.
6.20 c                   if        *in35  = *on and
6.20 c                             e3svar = 3
6.20 c                   eval      *in36 = *on
6.20 c                   goto      e3taga
6.20 c                   endif
      *
      *  Legger opplysninger over i felles-felter
      *
Q.01 c**                 eval      w_palt = e3valg
Q.01 c                   eval      w_palt = 0
Q.01 c**                 eval      w_svar = e3svar
Q.01 c                   eval      w_svar = 1
     c                   eval      w_outq = e3outq
5.04  *
5.04  *  Styring til e-mail
5.04  *
5.04 C                   if        e3svar = 3
5.04 C                   eval      e3svar = 1
5.04 C                   eval      e3outq = 'E_MAIL_ASP'
5.04 C                   eval      w_svar = e3svar
5.04 C                   eval      w_outq = e3outq
5.04 C                   endif
      *
     c                   goto      start
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  E4 Behandler valg for utskrift av PAKKSEDDEL
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     e4tag         tag
      *
6.11 c                   eval      w_ruti = 'FPAKK    '
6.11 c                   exsr      sjk_proa
      *
      *  Nullstiller felter som benyttes
      *
     c                   eval      e4svar = vaofdj
     c                   eval      e4outq = *blank
      *
     c     e4taga        tag
Q.01  * Skal ikke vise skjermbilde
Q.01 c                   if        1 = 2
     c                   exfmt     e4bld
Q.01 c                   endif
      *
      *  F3=Avslutt
      *
     c                   if        *inkc  = *on
     c                   eval      p_ipor = '1'
     c                   goto      xslutt
     c                   endif
5.01  *
5.01  *  Kontroll om bruker har lov til å starte
5.01  *  gjenutskrift av pakkseddel
5.01  *
5.41 c                   if        fbko09 <> 1
5.01 c                   if        fopaks =  1
5.01 c                   eval      *in33  = *on
5.01 c                   goto      e4taga
5.01 c                   endif
5.01 c                   endif
      *
      *  Sjekk om skriver er en gyldig device
      *
     c                   if        e4outq <> *blank
      *
     c                   eval      w_sjek = *blank
     c                   call      'FQPRTC'
     c                   parm                    w_sjek
     c                   parm                    e4outq
      *
     c                   if        w_sjek <> *blank
     c                   eval      *in31 = *on
     c                   goto      e4taga
     c                   endif
     c                   endif
      *
      *  Legger opplysninger over i felles-felter
      *
     c                   eval      w_palt = *zero
Q.01 c**                 eval      w_svar = e4svar
Q.01 c                   eval      w_svar = 1
     c                   eval      w_outq = e4outq
      *
     c                   goto      start
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  E5 Behandler valg for utskrift av FAKTURA/KREDITNOTA
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     e5tag         tag
      *
6.11 c                   eval      w_ruti = 'FFAKK    '
6.11 c                   exsr      sjk_proa
      *
      *  Nullstiller felter som benyttes
      *
     c                   eval      e5svar = vaofdj
     c                   eval      e5outq = *blank
      *
     c     e5taga        tag
     c                   exfmt     e5bld
      *
      *  F3=Avslutt
      *
     c                   if        *inkc  = *on
     c                   eval      p_ipor = '1'
     c                   goto      xslutt
     c                   endif
3.31  *
3.31  *  Kontroll om bruker har lov til å sette igang fakturering.
3.31  *
3.31 c                   if        fbko08 <> 1
3.31 c                   eval      *in33  = *on
3.31 c                   goto      e5taga
3.31 c                   endif
      *
      *  Sjekk om skriver er en gyldig device
      *
     c                   if        e5outq <> *blank
      *
     c                   eval      w_sjek = *blank
     c                   call      'FQPRTC'
     c                   parm                    w_sjek
     c                   parm                    e5outq
      *
     c                   if        w_sjek <> *blank
     c                   eval      *in31 = *on
     c                   goto      e5taga
     c                   endif
     c                   endif
      *
      *  Legger opplysninger over i felles-felter
      *
     c                   eval      w_palt = *zero
     c                   eval      w_svar = e5svar
     c                   eval      w_outq = e5outq
      *
     c                   goto      start
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  START Behandler oppdatering av ORDRE-HODE-REGISTER
      *        samt utlegging/oppdatering av UTPLUKK-PARAM-REGISTER
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     start         tag
      *
      *  Oppdater ORDRE-HODE-REGISTER, ordren er nå til behandling
      *
     c                   if        fokode <> 3
     c                   call      'FO709R'
     c                   parm                    fohel1_numm
     c                   parm                    fohel1_suff
     c                   endif
      *
      *  Dersom ordren allerede er plukket, skal ikke koden endres
      *
     c     fohel1_key    chain     fohelur                            90
     c                   if        *in90  = *off
      *
     c                   if        fokode <> 3
     c                   eval      fokode = 2
     c                   endif
      *
6.10 c                   time                    foedat
6.10 c                   time                    foetim
6.10 c                   eval      foeusr = l_user
     c                   update    fohelur
     c                   endif
      *
      *  Legg ut nye records til  ORDRE-PLUKK-HODE-REGISTER
      *  Eventuelt oppdater, dersom ordren allerede er plukket
      *
     c     fplol1_key    chain     fplolur                            90
     c                   if        *in90  = *on
     c                   eval      fkpfir = w_firm
     c                   eval      fkponr = fplol1_numm
     c                   eval      fkpsuf = fplol1_suff
     c                   eval      fkpoty = w_otyp
     c                   eval      fkpwsd = l_wsid
     c                   eval      fkpusr = l_user
     c                   eval      fkpalt = w_palt
     c                   eval      fkpdir = w_svar
     c                   write     fplolur
     c                   else
     c                   eval      fkpalt = w_palt
     c                   eval      fkpdir = w_svar
     c                   update    fplolur
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Kaller opp utskriftsprogrammet, dersom direkte utskrift
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   if        w_svar = 1 or
     c                             w_svar = 2
Q.01 c                   call      'QO604R'
     c                   parm                    w_skor
     c                   parm                    w_firm
     c                   parm                    fplol1_numm
     c                   parm                    fplol1_suff
     c                   parm                    w_otyp
     c                   parm                    w_svar
     c                   parm                    w_outq
Q.01 c                   parm                    p_acti
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
6.11  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.11  *  Subrutine for initiering av program
6.11  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.11  *
6.11 c     sjk_proa      begsr
6.11  *
6.20 c                   eval      *in36 = *off
6.11 c                   eval      p_pdf ='0'
6.11 c                   eval      p_ruti= w_ruti
6.11  * Sjekk om PROA er aktivert
6.11 c                   call      'AP608R'
6.11 c                   parm                    p_ruti
6.11 c                   parm                    p_pdf
6.11  * p_pdf = '1' = PROA aktivert
6.11 c                   if        p_pdf = '1'
6.11 c                   eval      *in35 = *on
6.11 c                   endif
6.11  *
6.11 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      *  Nullstilling av felter som ikke kan redefineres
      *
     c                   eval      w_skor = *blank
     c                   eval      w_sjek = *blank
     c                   eval      w_outq = *blank
pdf  c                   eval      *in35 = *off
      *
      * Key for file : ORDRE-TYPE-REGISTER
      *
     c     votyl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    votyl1_otyp
5.02  *
5.02  * Key for file : BILDE-ALTERNATIVER
5.02  *
5.02 c     vbldl1_key    klist
5.02 c                   kfld                    w_firm
5.02 c                   kfld                    vbldl1_balt
      *
      * Key for file : ORDRE-HODE-REGISTER
      *
     c     fohel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fohel1_numm
     c                   kfld                    fohel1_suff
      *
      * Key for file : ORDRE-PLUKK-HODE-REGISTER
      *
     c     fplol1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fplol1_numm
     c                   kfld                    fplol1_suff
3.31  *
3.31  * Key for brukerregister
3.31  *
3.31 c     fusrl1_key    klist
3.31 c                   kfld                    w_firm
3.31 c                   kfld                    fusrl1_user
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Tar inn parameter fra forrige program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *entry        plist
     c                   parm                    p_ipor
     c                   parm                    p_firm
     c                   parm                    p_numm
     c                   parm                    p_suff
Q.01 c                   parm                    p_acti
      *
      *  Legger inn firmanummer i nøkklene
      *
     c                   eval      w_firm      = p_firm
      *
      *  Legger inn ordrenummer og suffix i nøkklene
      *
     c                   eval      fohel1_numm = p_numm
     c                   eval      fohel1_suff = p_suff
     c                   eval      fplol1_numm = p_numm
     c                   eval      fplol1_suff = p_suff
3.31  *
3.31  * Hente inn brukerregister
3.31  *
3.31 c                   eval      fusrl1_user = l_user
3.31 c     fusrl1_key    chain     fusrl1r                            90
      *
      * Nullstiller returvalg
      *
     c                   eval      p_ipor = *blank
      *
     c                   endsr
