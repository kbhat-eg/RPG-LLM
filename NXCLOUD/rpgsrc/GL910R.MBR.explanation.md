# RPG Program Explanation: GL910R

This RPG program is designed to generate unique filenames using the current date and time. The filenames are constructed by combining a given prefix (before a dot in the input), a timestamp, and a suffix (after the dot in the input). Hereâ€™s a breakdown of the code, its structure, and purpose:

---

## **Header and Documentation**

- `h option(*nodebugio) datedit(*dmy)`  
  Controls compile options: disables debug I/O, and sets date editing to day/month/year format.

- **Header Comments**  
  Includes program name (`GL910R`), description (in Norwegian: "Generere unike filnavn med dato og klokke" = "Generate unique filenames with date and clock"), version information, author, and change log.

---

## **Data Structure Definitions**

### 1. **Timestamp Temporary Storage**
```rpg
d                 ds
d d_tmps                        26
d  d_tmps3                       3  0 overlay(d_tmps:21)
```
- **d_tmps**: A 26-character temporary storage for timestamp
- **d_tmps3**: A 3-digit numeric overlay starting at position 21 in `d_tmps` (could represent milliseconds or a unique part)

### 2. **Filename Assembly**
```rpg
d                 ds
d d_fnav                        20
d  d_fnav01                      1    overlay(d_fnav)     inz('D')
d  d_fnav02                      6  0 overlay(d_fnav:2)
d  d_fnav03                      2    overlay(d_fnav:8)   inz('.T')
d  d_fnav04                      6  0 overlay(d_fnav:10)
d  d_fnavx3                      3  0 overlay(d_fnav:16)
```
- **d_fnav**: 20-character string to build the filename (excluding prefix and suffix)
- **d_fnav01**: 1st character, initialized to 'D'
- **d_fnav02**: 6 digits (positions 2-7), will store the date
- **d_fnav03**: 2 characters (positions 8-9), initialized to '.T'
- **d_fnav04**: 6 digits (positions 10-15), will store the time
- **d_fnavx3**: 3 digits (positions 16-18), will store part of the timestamp for uniqueness

---

## **Parameter Variables**

```rpg
d p_finn          s             20
d p_fnut          s             50
```
- **p_finn**: Input file name (max 20 chars)
- **p_fnut**: Output file name (max 50 chars, to be returned)

---

## **Working Variables**

- **w_tmps** (type Z): Timestamp variable.
- **w_dato** (type D, ISO): Date.
- **w_time** (type T, ISO): Time.
- **w_dato_6**: 6-digit numeric for date (YYMMDD).
- **w_time_6**: 6-digit numeric for time (HHMMSS).
- **w_posi**: Position of the dot in the input name.
- **w_prex**: Prefix (before dot).
- **w_sufx**: Suffix (after dot).

---

## **Main Logic**

### 1. **Split Input Filename**
```rpg
c                   eval      w_posi = %scan('.':p_finn)
c                   if        w_posi > 0
c                   eval      w_prex = %subst(p_finn:1:w_posi-1)
c                   eval      w_sufx = %subst(p_finn:w_posi+1)
c                   endif
```
- `w_posi` finds position of the dot in input.
- If found, separates prefix and suffix:
    - `w_prex` = substring before the dot.
    - `w_sufx` = substring after the dot.

### 2. **Retrieve Date and Time**
```rpg
c                   time                    w_dato
c                   time                    w_time
c                   time                    w_tmps
```
- Gets current date, time, and timestamp.

### 3. **Format Date and Time**
```rpg
c     *ymd          move      w_dato        w_dato_6
c     *hms          move      w_time        w_time_6
c                   move      w_tmps        d_tmps
```
- Moves date and time into 6-digit numeric forms.
- Moves timestamp into `d_tmps`.

### 4. **Construct Filename Core**
```rpg
c                   eval      d_fnav02 = w_dato_6
c                   eval      d_fnav04 = w_time_6
c                   eval      d_fnavx3 = d_tmps3
```
- Places date, time, and part of timestamp into specific overlays within `d_fnav`.

### 5. **Build Final Unique Filename**
```rpg
c                   eval      p_fnut = %trim(%trim(w_prex) + '_' +
c                             %trim(d_fnav) + '.' + %trim(w_sufx))
```
- Assembles:  
    **prefix** + '_' + **auto-generated filename** + '.' + **suffix**  
    Removes leading/trailing spaces from each part.

---

## **Program End and Parameter Handling**

### **Program Termination**
```rpg
c                   eval      *inlr = *on
c                   return
```
- Marks last record (end program).
- Returns control to caller.

### **Parameter Interface (PLIST)**
```rpg
c     *entry        plist
c                   parm                    p_finn
c                   parm                    p_fnut
```
- Defines parameter list for program entry:  
    - Input: `p_finn`  
    - Output: `p_fnut`

---

## **Example**

**If input parameter `p_finn` = "ORDER.TXT"**  
- `w_prex` = 'ORDER'
- `w_sufx` = 'TXT'
- Assume date=240604 (June 4, 2024), time=151230 (15:12:30), `d_tmps3`= '471'
- `d_fnav` = 'D240604.T151230471'
- **Output `p_fnut`** = 'ORDER_D240604.T151230471.TXT'

---

## **Summary**

- The program takes a filename as input.
- Splits it into prefix and suffix.
- Generates a unique string based on the current date and time.
- Concatenates the prefix, unique string, and suffix to create a new unique filename.
- Returns this new filename to the caller.

This is useful for generating archival or log filenames that need to be unique based on the time they are created. The coding style is traditional ILE RPG, with heavy use of data structures and overlays.