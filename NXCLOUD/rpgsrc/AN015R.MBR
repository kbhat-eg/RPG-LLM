     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Program . . . . : AN015R
      * Beskrivelse . . : Generering av nattrutine, backup
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      * R1.08 151097  AMD Programmet er skrevet om og forenklet
6.11  * R6.10 261112  AMD Lagt inn nytt valg for backup til savefile
6.11  *                   uten å kjøre ut på tape
6.21  * R6.21 171013  AMD Utlegging til savefile må legges opp senere
6.21  *                   i prossessen
      *
      *
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fqcllesrc  o  a f  096        disk
      *
      * Definisjon av tabeller
      *
6.11 d rec             s             80    dim(31) ctdata perrcd(1)             Programlinjer
     d fra             s              1    dim(10)                              Hjelpe-array
     d til             s              1    dim(84)                              Hjelpe-array
      *
      * Definering av data-strukturer
      *
     d                 ds
     d d_dato                         6  0
     d  d_aaar                        2  0 overlay(d_dato)
     d  d_mmnd                        2  0 overlay(d_dato:3)
     d  d_ddag                        2  0 overlay(d_dato:5)
      *
      * Definering av local data area
      *
     d                 ds
     d d_valg                       128
     d  d_time                        6  0 overlay(d_valg)
     d  d_dens                       11    overlay(d_valg:7)
     d  d_rorg                        1    overlay(d_valg:18)
     d  d_back                        1    overlay(d_valg:19)
     d  d_ssbs                        1    overlay(d_valg:20)
     d  d_prc1                        1    overlay(d_valg:21)
     d  d_prc2                        1    overlay(d_valg:22)
     d  d_genp                        1    overlay(d_valg:23)
     d  d_savf                        1    overlay(d_valg:24)
     d  d_smap                        1    overlay(d_valg:25)
      *                                                                     -
      * Definering av parametere
      *                                                                     -
     d p_valg          s            128
      *                                                                     -
      * Definering av variable
      *                                                                     -
     d n               s              2  0
     d w_dato          s              6  0
     d w_recc          s             84
     d w_tell          s              6  0
     d x               s              2  0
     d y               s              2  0
     d z               s              2  0
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Legg ut records til Cl-program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Legger ut starten på CL-programmet
      *
     c                   for       n = 1 to 4
     c                   add       100           w_tell
     c                   movel     rec(n)        w_recc
     c                   except    xrecut
     c                   endfor
      *
      * Legg ut parameter for om det skal benyttes savefile eller ikke
      *
6.11 c                   if        d_savf = ' '
     c                   add       100           w_tell
     c                   movel     rec(5)        w_recc
     c                   except    xrecut
     c                   endif
      *
     c                   if        d_savf = '1'
     c                   add       100           w_tell
     c                   movel     rec(6)        w_recc
     c                   except    xrecut
     c                   endif
6.11  *
6.11 c                   if        d_savf = '2'
6.11 c                   add       100           w_tell
6.11 c                   movel     rec(7)        w_recc
6.11 c                   except    xrecut
6.11 c                   endif
      *
      * Legger inn riktig density i parameter i CL-programmet
      *
     c                   exsr      xdensi
      *
6.11  * Legger ut siste del av CL-programmet (A)
      *
6.11 c                   for       n = 12 to 18
     c                   add       100           w_tell
     c                   movel     rec(n)        w_recc
     c                   except    xrecut
     c                   endfor
6.11  *
6.11  * Legger ut siste del av CL-programmet (B)
6.11  * men ikke dersom valg 2 er foretatt, backup til savefile
6.11  * uten å kjøre dette ut på tape etterpå.
6.11  *
6.21 c*Sper              if        d_savf <> '2'
6.21 c*Sper              for       n = 19 to 25
6.21 c*Sper              add       100           w_tell
6.21 c*Sper              movel     rec(n)        w_recc
6.21 c*Sper              except    xrecut
6.21 c*Sper              endfor
6.21 c*Sper              endif
6.11  *
6.11  * Legger ut siste del av CL-programmet (C)
6.11  *
6.11 c                   for       n = 26 to 31
6.11 c                   add       100           w_tell
6.11 c                   movel     rec(n)        w_recc
6.11 c                   except    xrecut
6.11 c                   endfor
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   eval      *inlr = *on
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Legger inn riktig DENSITY
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xdensi        begsr
      *
      * Redigerer CL-linje hvor DENSITY legges inn (CHGVAR)
      *
     c                   movea     d_dens        fra
     c                   eval      z = *zero
      *
     c                   for       y = 1 to 10
     c                   if        fra(y) <> *blank
     c                   add       1             z
     c                   endif
     c                   endfor
      *
     c                   if        z = 5
6.11 c                   movel     rec(8)        w_recc
     c                   endif
     c                   if        z = 6
6.11 c                   movel     rec(9)        w_recc
     c                   endif
     c                   if        z = 7
6.11 c                   movel     rec(10)       w_recc
     c                   endif
     c                   if        z = 8
6.11 c                   movel     rec(11)       w_recc
     c                   endif
     c                   eval      til = *blank
     c                   movea     w_recc        til
      *
     c                   z-add     41            z
      *
     c                   for       y = 1 to 10
     c                   if        fra(y) <> *blank
     c                   add       1             z
     c                   eval      til(z) = fra(y)
     c                   endif
     c                   endfor
      *
     c                   eval      w_recc = *blank
     c                   movea     til           w_recc
     c                   add       100           w_tell
     c                   except    xrecut
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
     c                   eval      w_recc = *blank
     c                   eval      w_tell = *zero
     c                   eval      w_dato = *zero
     c                   eval      n = *zero
     c                   eval      x = *zero
     c                   eval      y = *zero
     c                   eval      z = *zero
      *
     c                   eval      d_aaar = uyear
     c                   eval      d_mmnd = umonth
     c                   eval      d_ddag = uday
     c                   eval      w_dato = d_dato
      *
      * Parameterliste
      *
     c     *entry        plist
     c                   parm                    p_valg
      *
     c                   eval      d_valg = p_valg
      *
     c                   endsr
      *
     oqcllesrc  eadd         xrecut
     o                       w_recc              96
     o                       w_tell               6
     o                       w_dato              12
**
             PGM                                                  /*1*/
             DCL       VAR(&KODE) TYPE(*DEC)  LEN(2 0)            /*2*/
             DCL       VAR(&SAVF) TYPE(*CHAR) LEN(1)              /*3*/
             DCL       VAR(&DENS) TYPE(*CHAR) LEN(8)              /*4*/
             CHGVAR    VAR(&SAVF) VALUE(' ')                      /*5*/
             CHGVAR    VAR(&SAVF) VALUE('1')                      /*6*/
             CHGVAR    VAR(&SAVF) VALUE('2')                      /*7*/
             CHGVAR    VAR(&DENS) VALUE('     ')                  /*8*/
             CHGVAR    VAR(&DENS) VALUE('      ')                 /*9*/
             CHGVAR    VAR(&DENS) VALUE('       ')               /*10*/
             CHGVAR    VAR(&DENS) VALUE('        ')              /*11*/
 /*                                                                12*/
             CRTLIB    LIB(ADB.SAVF)                             /*13*/
             MONMSG    MSGID(CPF2111)                            /*14*/
 /*                                                                15*/
 /* Kopi av databibliotek                                          16*/
 /*                                                                17*/
             CALL      PGM(AN025R)     PARM(&SAVF)               /*18*/
 /*                                                                19*/
 /* Legg ut savefilen på tape dersom savefile er valgt             20*/
 /*                                                                21*/
             IF         COND(&SAVF *EQ '1') THEN(DO)             /*22*/
             SAVLIB     LIB(ADB.SAVF) DEV(TAP01) ENDOPT(*LEAVE) +
                          PRECHK(*YES)                           /*24*/
             ENDDO                                               /*25*/
 /*                                                                26*/
 /* Kopi av programbibliotek                                       27*/
 /*                                                                28*/
             CALL      PGM(AN026R)     PARM(&SAVF)               /*29*/
 /*                                                                30*/
SLUTT:       ENDPGM                                              /*31*/
