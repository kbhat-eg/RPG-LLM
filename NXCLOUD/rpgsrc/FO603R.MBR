      /TITLE  ASOFAK: Utskrift/Utplukk fra ordre-register
     h option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOFAK
      * Program . . . . : FO603R
      * Beskrivelse . . : Utskrift/Utplukk fra ordre-register
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
8.01  *K0000  200723 bsa  Nytt program
8.02  *K0000  150224 bsa  Justeringer etter første tilbakemelding. Fjerner
8.02  *K0000              til ordretyper.
8.03  *K0000  110424 bsa  Endringer etter tilbakemelding. Ref NXS-17461
8.04  *K0000  230524 bsa  Skal bare behandle "samme" ordretyper.
8.05  *K0000  251024 bsa  Feil sjekk på ordretype
8.06  *K0000  311024 bsa  Feil ved utvalg av enkeltnummer
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     ffo603d    cf   e             workstn
     frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
     ffkprl1    if   e           k disk    rename(fkprpfr:fkprl1r)
     fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
     ffohelu    uf   e           k disk    rename(fohepfr:fohelur)
     ffohel1    if   e           k disk    rename(fohepfr:fohel1r)
     ffohelo    if   e           k disk    rename(fohepfr:fohelor)
     ffplolu    uf a e           k disk    rename(fplopfr:fplolur)
     fvinfl1    if   e           k disk    rename(vinfpfr:vinfl1r)
     ffusrl1    if   e           k disk    rename(fusrpfr:fusrl1r)
     ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
     ffntrl2    if   e           k disk    rename(fntrpfr:fntrl2r)
     ffntrl1    if   e           k disk    rename(fntrpfr:fntrl1r)
     ffscnl1    if   e           k disk    rename(fscnpfr:fscnl1r)
     ffodtlr    if   e           k disk    rename(fodtpfr:fodtlrr)
     fsdepl1    if   e           k disk    rename(sdeppfr:sdepl1r)
     fvot1l1    if   e           k disk    rename(vot1pfr:vot1l1r)
      *
8.03 d oty             s              2    dim(6)
     d ot1             s              2    dim(6)
     d ot2             s              2    dim(6)
     d ot3             s              2    dim(6)
     d ot4             s              2    dim(6)
     d ot5             s              2    dim(6)
     d ot6             s              2    dim(6)
8.03 d nty             s              2    dim(6)
      *
      * Definering av Local data area
      *
     d                uds
     d l_wsid                901    910
     d l_user                911    920
     d l_sfir                944    946  0
      *
      * Definering av data strukturer
      *
     d                 ds
     d d_kkey_til                    15
     d  d_firm_til                    3  0 overlay(d_kkey_til)
     d  d_otyp_til                    2    overlay(d_kkey_til:4)
     d  d_numm_til                    8  0 overlay(d_kkey_til:6)
     d  d_suff_til                    2  0 overlay(d_kkey_til:14)
     d                 ds
     d d_kkey_les                    15
     d  d_firm_les                    3  0 overlay(d_kkey_les  )
     d  d_otyp_les                    2    overlay(d_kkey_les  :4)
     d  d_numm_les                    8  0 overlay(d_kkey_les  :6)
     d  d_suff_les                    2  0 overlay(d_kkey_les  :14)
      *
      * Definering av parametere
      *
     d p_firm          s                   like(fofirm)
     d p_ftor          s                   like(w_alf1)
     d p_type          s              4
     d p_kom1          s             30
     d p_kom2          s             30
     d p_opdt          s              1
8.03 d p_stat          s              1
      *
     d b_slet          s              1    inz(*off)
      *
      * Definering av variable i nøkler
      *
     d w_firm          s                   like(fofirm)
     d rkunl1_kund     s                   like(rkkund)
     d fkprl1_kund     s                   like(flkund)
     d fkprl1_kpro     s                   like(flkpro)
     d fohel1_numm     s                   like(fonumm)
     d fohel1_suff     s                   like(fosuff)
     d fohelo_numm     s                   like(fonumm)
     d fohelo_otyp     s                   like(footyp)
     d fohelo_suff     s                   like(fosuff)
     d votyl1_otyp     s                   like(vaotyp)
     d vinfl1_ityp     s                   like(vaityp)
     d fusrl1_user     s                   like(fbuser)
     d fplolu_numm     s                   like(fkponr)
     d fplolu_suff     s                   like(fkpsuf)
     d fntrl2_kftp     s                   like(fnkftp)
     d fntrl1_numm     s                   like(fnnumm)
     d fntrl1_suff     s                   like(fnsuff)
     d fodtlr_numm     s                   like(fdnumm)
     d fodtlr_suff     s                   like(fdsuff)
     d fodtlr_line     s                   like(fdline)
     d sdepl1_kund     s                   like(skkund)
     d sdepl1_numm     s                   like(sknumm)
     d sdepl1_tell     s                   like(sktell)
      *
      * Definering av variable
      *
     d w_alf1          s              1
     d w_bdat          s                   like(fobdat)
     d w_ldat          s                   like(foldat)
     d w_belo          s                   like(fotots)
     d w_otyp          s                   like(footyp)
     d w_palt          s                   like(fkpalt)
     d w_knav          s                   like(rknavn)
     d w_pnav          s                   like(flnavn)
     d w_itxt          s                   like(vaitxt)
     d w_atxt          s             20
     d w_sekv          s                   like(rksekv)
     d w_foty          s                   like(footyp)
     d w_onxt_01       s                   like(vaonxt)
     d w_onxt_02       s                   like(vaonxt)
8.03 d w_onxt_03       s                   like(vaonxt)
8.03 d w_onxt_04       s                   like(vaonxt)
8.03 d w_onxt_05       s                   like(vaonxt)
8.03 d w_onxt_06       s                   like(vaonxt)
     d w_ftor          s              1
     d w_numm          s              8  0
     d w_suff          s              2  0
     d w_type          s              2
     d w_pdir          s              1  0
     d w_outq          s             10
     d w_x             s              2  0
     d w_inte          s              1    inz(*off)
     d w_ekst          s              1    inz(*off)
     d w_utpl          s              1    inz(*off)
8.04 d w_ooko          s              1    inz(*off)
8.04 d w_noko          s              1    inz(*off)
8.04 d w_osta          s              1    inz(*off)
8.04 d w_nsta          s              1    inz(*off)
      *
     d b_depo          s              1
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  D0 Behandler inntasting av ordretyper samt utvalgsmetode
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   eval      w_utpl = *off
     c                   eval      w_x = 0
     c                   eval      w_ekst = *off
     c                   eval      w_inte = *off
     c                   eval      oty = *blanks
     c                   eval      nty = *blanks
      *
      *  Send Alt
      *
     c                   write     d9bld
      *
      *  Bare data
      *
     c     d9tagb        tag
     c                   exfmt     d9bld
      *
      *  F3=Avslutt program
      *
     c     *inkc         cabeq     *on           xslutt
      *
      * F4=Spørring
      *
     c                   if        *inkd  = *on
     c                   exsr      spØrring
     c                   goto      d9tagb
     c                   endif
8.03  *
8.03  *  F7=Avslutt og gå tilbake til "gammel" versjon.
8.03  *
8.03 c                   if        *inkg  = *on
8.03 c                   eval      p_stat = *on
8.03 c                   goto      xslutt
8.03 c                   endif
      *
      *  Sjekk,  finnes ordretype(fra) i ORDRETYPE-REGISTER
      *
     c                   if        %trim(d9oty1) <> *blanks
      *
     c                   eval      votyl1_otyp = d9oty1
     c     votyl1_key    chain     votyl1r
     c                   if        not %found
     c                   eval      *in31 = *on
     c                   goto      d9tagb
     c                   endif
      *
     c                   if        vaoakk <> 2
     c                   eval      *in32 = *on
     c                   goto      d9tagb
     c                   endif
      *
     c     votyl1_key    chain     vot1l1r
     c                   if        %found and
     c                             va1int = 1
     c                   eval      w_inte = *on
     c                   else
     c                   eval      w_ekst = *on
     c                   endif
      *
      *  Ta vare på neste ordretyper
      *
     c                   eval      w_x = 0
     c                   if        %trim(vaon01) <> *blanks
     c                   eval      w_x = w_x +1
     c                   eval      ot1(w_x) = vaon01
     c                   endif
      *
     c                   if        %trim(vaon02) <> *blanks
     c                   if        %lookup(vaon02:ot1) = 0
     c                   eval      w_x = w_x +1
     c                   eval      ot1(w_x) = vaon02
     c                   endif
     c                   endif
      *
     c                   if        %trim(vaon03) <> *blanks
     c                   if        %lookup(vaon03:ot1) = 0
     c                   eval      w_x = w_x +1
     c                   eval      ot1(w_x) = vaon03
     c                   endif
     c                   endif
      *
     c                   if        %trim(vaon04) <> *blanks
     c                   if        %lookup(vaon04:ot1) = 0
     c                   eval      w_x = w_x +1
     c                   eval      ot1(w_x) = vaon04
     c                   endif
     c                   endif
      *
     c                   if        %trim(vaon05) <> *blanks
     c                   if        %lookup(vaon05:ot1) = 0
     c                   eval      w_x = w_x +1
     c                   eval      ot1(w_x) = vaon05
     c                   endif
     c                   endif
      *
     c                   if        %trim(vaon06) <> *blanks
     c                   if        %lookup(vaon06:ot1) = 0
     c                   eval      w_x = w_x +1
     c                   eval      ot1(w_x) = vaon06
     c                   endif
     c                   endif
      *
     c                   move      vaonxt        w_onxt_01
      *
     c                   endif
      *
     c                   if        %trim(d9oty2) <> *blanks
      *
     c                   eval      votyl1_otyp = d9oty2
     c     votyl1_key    chain     votyl1r
     c                   if        not %found
     c                   eval      *in31 = *on
     c                   goto      d9tagb
     c                   endif
      *
     c                   if        vaoakk <> 2
     c                   eval      *in32 = *on
     c                   goto      d9tagb
     c                   endif
      *
     c     votyl1_key    chain     vot1l1r
     c                   if        %found and
     c                             va1int = 1
     c                   eval      w_inte = *on
     c                   else
     c                   eval      w_ekst = *on
     c                   endif
      *
      *  Ta vare på verdier fra ordretype-register
      *
     c                   eval      w_x = 0
     c                   if        %trim(vaon01) <> *blanks
     c                   eval      w_x = w_x +1
     c                   eval      ot2(w_x) = vaon01
     c                   endif
      *
     c                   if        %trim(vaon02) <> *blanks
     c                   if        %lookup(vaon02:ot2) = 0
     c                   eval      w_x = w_x +1
     c                   eval      ot2(w_x) = vaon02
     c                   endif
     c                   endif
      *
     c                   if        %trim(vaon03) <> *blanks
     c                   if        %lookup(vaon03:ot2) = 0
     c                   eval      w_x = w_x +1
     c                   eval      ot2(w_x) = vaon03
     c                   endif
     c                   endif
      *
     c                   if        %trim(vaon04) <> *blanks
     c                   if        %lookup(vaon04:ot2) = 0
     c                   eval      w_x = w_x +1
     c                   eval      ot2(w_x) = vaon04
     c                   endif
     c                   endif
      *
     c                   if        %trim(vaon05) <> *blanks
     c                   if        %lookup(vaon05:ot2) = 0
     c                   eval      w_x = w_x +1
     c                   eval      ot2(w_x) = vaon05
     c                   endif
     c                   endif
      *
     c                   if        %trim(vaon06) <> *blanks
     c                   if        %lookup(vaon06:ot2) = 0
     c                   eval      w_x = w_x +1
     c                   eval      ot2(w_x) = vaon06
     c                   endif
     c                   endif
      *
     c                   move      vaonxt        w_onxt_02
      *
     c                   endif
      *
8.03 c                   if        %trim(d9oty3) <> *blanks
8.03  *
8.03 c                   eval      votyl1_otyp = d9oty3
8.03 c     votyl1_key    chain     votyl1r
8.03 c                   if        not %found
8.03 c                   eval      *in31 = *on
8.03 c                   goto      d9tagb
8.03 c                   endif
8.03  *
8.03 c                   if        vaoakk <> 2
8.03 c                   eval      *in32 = *on
8.03 c                   goto      d9tagb
8.03 c                   endif
8.03  *
8.03 c     votyl1_key    chain     vot1l1r
8.03 c                   if        %found and
8.03 c                             va1int = 1
8.03 c                   eval      w_inte = *on
8.03 c                   else
8.03 c                   eval      w_ekst = *on
8.03 c                   endif
8.03  *
8.03  *  Ta vare på verdier fra ordretype-register
8.03  *
8.03 c                   eval      w_x = 0
8.03 c                   if        %trim(vaon01) <> *blanks
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot3(w_x) = vaon01
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon02) <> *blanks
8.03 c                   if        %lookup(vaon02:ot3) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot3(w_x) = vaon02
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon03) <> *blanks
8.03 c                   if        %lookup(vaon03:ot3) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot3(w_x) = vaon03
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon04) <> *blanks
8.03 c                   if        %lookup(vaon04:ot3) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot3(w_x) = vaon04
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon05) <> *blanks
8.03 c                   if        %lookup(vaon05:ot3) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot3(w_x) = vaon05
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon06) <> *blanks
8.03 c                   if        %lookup(vaon06:ot3) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot3(w_x) = vaon06
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   move      vaonxt        w_onxt_03
8.03  *
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(d9oty4) <> *blanks
8.03  *
8.03 c                   eval      votyl1_otyp = d9oty4
8.03 c     votyl1_key    chain     votyl1r
8.03 c                   if        not %found
8.03 c                   eval      *in31 = *on
8.03 c                   goto      d9tagb
8.03 c                   endif
8.03  *
8.03 c                   if        vaoakk <> 2
8.03 c                   eval      *in32 = *on
8.03 c                   goto      d9tagb
8.03 c                   endif
8.03  *
8.03 c     votyl1_key    chain     vot1l1r
8.03 c                   if        %found and
8.03 c                             va1int = 1
8.03 c                   eval      w_inte = *on
8.03 c                   else
8.03 c                   eval      w_ekst = *on
8.03 c                   endif
8.03  *
8.03  *  Ta vare på verdier fra ordretype-register
8.03  *
8.03 c                   eval      w_x = 0
8.03 c                   if        %trim(vaon01) <> *blanks
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot4(w_x) = vaon01
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon02) <> *blanks
8.03 c                   if        %lookup(vaon02:ot4) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot4(w_x) = vaon02
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon03) <> *blanks
8.03 c                   if        %lookup(vaon03:ot4) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot4(w_x) = vaon03
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon04) <> *blanks
8.03 c                   if        %lookup(vaon04:ot4) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot4(w_x) = vaon04
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon05) <> *blanks
8.03 c                   if        %lookup(vaon05:ot4) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot4(w_x) = vaon05
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon06) <> *blanks
8.03 c                   if        %lookup(vaon06:ot4) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot4(w_x) = vaon06
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   move      vaonxt        w_onxt_04
8.03  *
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(d9oty5) <> *blanks
8.03  *
8.03 c                   eval      votyl1_otyp = d9oty5
8.03 c     votyl1_key    chain     votyl1r
8.03 c                   if        not %found
8.03 c                   eval      *in31 = *on
8.03 c                   goto      d9tagb
8.03 c                   endif
8.03  *
8.03 c                   if        vaoakk <> 2
8.03 c                   eval      *in32 = *on
8.03 c                   goto      d9tagb
8.03 c                   endif
8.03  *
8.03 c     votyl1_key    chain     vot1l1r
8.03 c                   if        %found and
8.03 c                             va1int = 1
8.03 c                   eval      w_inte = *on
8.03 c                   else
8.03 c                   eval      w_ekst = *on
8.03 c                   endif
8.03  *
8.03  *  Ta vare på verdier fra ordretype-register
8.03  *
8.03 c                   eval      w_x = 0
8.03 c                   if        %trim(vaon01) <> *blanks
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot5(w_x) = vaon01
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon02) <> *blanks
8.03 c                   if        %lookup(vaon02:ot5) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot5(w_x) = vaon02
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon03) <> *blanks
8.03 c                   if        %lookup(vaon03:ot5) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot5(w_x) = vaon03
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon04) <> *blanks
8.03 c                   if        %lookup(vaon04:ot5) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot5(w_x) = vaon04
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon05) <> *blanks
8.03 c                   if        %lookup(vaon05:ot5) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot5(w_x) = vaon05
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon06) <> *blanks
8.03 c                   if        %lookup(vaon06:ot5) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot5(w_x) = vaon06
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   move      vaonxt        w_onxt_05
8.03  *
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(d9oty6) <> *blanks
8.03  *
8.03 c                   eval      votyl1_otyp = d9oty6
8.03 c     votyl1_key    chain     votyl1r
8.03 c                   if        not %found
8.03 c                   eval      *in31 = *on
8.03 c                   goto      d9tagb
8.03 c                   endif
8.03  *
8.03 c                   if        vaoakk <> 2
8.03 c                   eval      *in32 = *on
8.03 c                   goto      d9tagb
8.03 c                   endif
8.03  *
8.03 c     votyl1_key    chain     vot1l1r
8.03 c                   if        %found and
8.03 c                             va1int = 1
8.03 c                   eval      w_inte = *on
8.03 c                   else
8.03 c                   eval      w_ekst = *on
8.03 c                   endif
8.03  *
8.03  *  Ta vare på verdier fra ordretype-register
8.03  *
8.03 c                   eval      w_x = 0
8.03 c                   if        %trim(vaon01) <> *blanks
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot6(w_x) = vaon01
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon02) <> *blanks
8.03 c                   if        %lookup(vaon02:ot6) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot6(w_x) = vaon02
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon03) <> *blanks
8.03 c                   if        %lookup(vaon03:ot6) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot6(w_x) = vaon03
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon04) <> *blanks
8.03 c                   if        %lookup(vaon04:ot6) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot6(w_x) = vaon04
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon05) <> *blanks
8.03 c                   if        %lookup(vaon05:ot6) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot6(w_x) = vaon05
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %trim(vaon06) <> *blanks
8.03 c                   if        %lookup(vaon06:ot6) = 0
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      ot6(w_x) = vaon06
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   move      vaonxt        w_onxt_06
8.03  *
8.03 c                   endif
      *
     c*                  if        %trim(d9tot1) <> *blanks
      *
     c*                  eval      votyl1_otyp = d9tot1
     c*    votyl1_key    chain     votyl1r
     c*                  if        not %found
     c*                  eval      *in31 = *on
     c*                  goto      d9tagb
     c*                  endif
      *
     c*                  if        vaoakk <> 3
     c*                  eval      *in36 = *on
     c*                  goto      d9tagb
     c*                  endif
      *
     c*    votyl1_key    chain     vot1l1r
     c*                  if        %found and
     c*                            va1int = 1
     c*                  eval      w_inte = *on
     c*                  else
     c*                  eval      w_ekst = *on
     c*                  endif
      * Sjekk at det er gyldig neste-ordretype for
     c*                  if        %lookup(d9tot1:ot1) = 0
     c*                  eval      *in37 = *on
     c*                  goto      d9tagb
     c*                  endif
      *
     c*                  endif
      *
     c*                  if        %trim(d9tot2) <> *blanks
      *
     c*                  eval      votyl1_otyp = d9tot2
     c*    votyl1_key    chain     votyl1r
     c*                  if        not %found
     c*                  eval      *in31 = *on
     c*                  goto      d9tagb
     c*                  endif
      *
     c*                  if        vaoakk <> 3
     c*                  eval      *in36 = *on
     c*                  goto      d9tagb
     c*                  endif
      * Sjekk at det er gyldig neste-ordretype for
     c*                  if        %lookup(d9tot2:ot2) = 0
     c*                  eval      *in37 = *on
     c*                  goto      d9tagb
     c*                  endif
      *
     c*    votyl1_key    chain     vot1l1r
     c*                  if        %found and
     c*                            va1int = 1
     c*                  eval      w_inte = *on
     c*                  else
     c*                  eval      w_ekst = *on
     c*                  endif
      *
     c*                  endif
      *
     c                   if        w_inte = *on and
     c                             w_ekst = *on
     c                   eval      *in33 = *on
     c                   goto      d9tagb
     c                   endif
      *
     c                   if        %trim(d9oty1) = *blanks and
8.03 c                             %trim(d9oty2) = *blanks and
8.03 c                             %trim(d9oty3) = *blanks and
8.03 c                             %trim(d9oty4) = *blanks and
8.03 c                             %trim(d9oty5) = *blanks and
8.03 c                             %trim(d9oty6) = *blanks
     c                   eval      *in34 = *on
     c                   goto      d9tagb
     c                   endif
      *
      * Samle opp ordretypene som skal behandles
      *
     c                   eval      w_x = 0
     c                   if        %lookup(d9oty1:oty) = 0
     c                   if        %trim(d9oty1) <> *blanks
     c                   eval      w_x = w_x +1
     c                   eval      oty(w_x) = d9oty1
8.03 c*                  eval      nty(w_x) = d9tot1
8.03 c*                  else
     c                   eval      nty(w_x) = w_onxt_01
     c                   endif
     c                   endif
      *
     c                   if        %lookup(d9oty2:oty) = 0
     c                   if        %trim(d9oty2) <> *blanks
     c                   eval      w_x = w_x +1
     c                   eval      oty(w_x) = d9oty2
8.03 c*                  eval      nty(w_x) = d9tot2
8.03 c*                  else
     c                   eval      nty(w_x) = w_onxt_02
     c                   endif
     c                   endif
8.03  *
8.03 c                   if        %lookup(d9oty3:oty) = 0
8.03 c                   if        %trim(d9oty3) <> *blanks
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      oty(w_x) = d9oty3
8.03 c                   eval      nty(w_x) = w_onxt_03
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %lookup(d9oty4:oty) = 0
8.03 c                   if        %trim(d9oty4) <> *blanks
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      oty(w_x) = d9oty4
8.03 c                   eval      nty(w_x) = w_onxt_04
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %lookup(d9oty5:oty) = 0
8.03 c                   if        %trim(d9oty5) <> *blanks
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      oty(w_x) = d9oty5
8.03 c                   eval      nty(w_x) = w_onxt_05
8.03 c                   endif
8.03 c                   endif
8.03  *
8.03 c                   if        %lookup(d9oty6:oty) = 0
8.03 c                   if        %trim(d9oty6) <> *blanks
8.03 c                   eval      w_x = w_x +1
8.03 c                   eval      oty(w_x) = d9oty6
8.03 c                   eval      nty(w_x) = w_onxt_06
8.03 c                   endif
8.03 c                   endif
      *
8.04  * Loop gjennom og sjekk at vi ikke har en miks av ordretyper
      *
8.04 c                   eval      w_ooko = *off
8.04 c                   eval      w_noko = *off
8.04 c                   eval      w_osta = *off
8.04 c                   eval      w_nsta = *off
      *
8.04 c     1             do        6             w_x
8.04 c                   if        nty(w_x) <> *blanks
      *
8.04 c                   eval      votyl1_otyp = nty(w_x)
8.04 c     votyl1_key    chain     votyl1r
8.04 c                   if        %found
8.04 c                   if        vaooko = 1
8.04 c                   eval      w_ooko = *on
8.04 c                   else
8.04 c                   eval      w_noko = *on
8.04 c                   endif
8.04 c                   if        vaosta = 1
8.04 c                   eval      w_osta = *on
8.04 c                   else
8.04 c                   eval      w_nsta = *on
8.04 c                   endif
8.04 c                   endif
8.04  *
8.04 c                   endif
8.04 c                   enddo
8.04  *
8.04  * Miks av ordretyper ?
8.04  *
8.04 c                   if        w_ooko = *on and
8.04 c                             w_noko = *on
8.04 c                   eval      *in35 = *on
8.04 c                   goto      d9tagb
8.04 c                   endif
8.04  * Miks av ordretyper ?
8.04 c                   if        w_osta = *on and
8.04 c                             w_nsta = *on
8.04 c                   eval      *in35 = *on
8.04 c                   goto      d9tagb
8.04 c                   endif
      *
      *
      *  Finner utvalgsmetode og hopper til riktig subrutine
      *
     c     d9svar        cabeq     1             d91taga                        Fra/Til
     c     d9svar        cabeq     2             d92taga                        Sekvens
     c     d9svar        cabeq     3             d93taga                        Tilfeldig
     c     d9svar        cabeq     4             d94taga                        Andre valg
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  D1 Behandler plukking av ordrenummer  fra/til
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     d91taga       tag
      *
      *  Send Alt
      *
     c                   write     d91bld
      *
      *  Bare data
      *
     c     d91tagb       tag
     c                   exfmt     d91bld
      *
      *  F3=Avslutt program
      *
     c     *inkc         cabeq     *on           xslutt
      *
      *  Sjekk,  Ordrenummer fra må være utfylt
      *
     c                   if        d9fonr = *zero
     c                   eval      *in33  = *on
     c                   goto      d91tagb
     c                   endif
      *
      *  Sjekk,  Ordrenummer til må være større enn ordrenummer fra
      *          eller ordrenummer til må være blank
      *
     c                   if        d9tonr <> *zero
     c                   if        d9tonr < d9fonr
     c                   eval      *in34 = *on
     c                   goto      d91tagb
     c                   endif
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Behandler utplukk av ordre fra/til
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     1             do        2             w_x
     c                   if        oty(w_x) <> *blanks
     c                   eval      w_foty = nty(w_x)
     c                   eval      fohelo_otyp = oty(w_x)
     c                   eval      fohelo_numm = d9fonr
     c                   eval      fohelo_suff = *zero
     c     fohelo_key    setll     fohelo
      *
     c                   eval      d_otyp_til = oty(w_x)
     c                   eval      d_numm_til = d9fonr
     c                   eval      d_suff_til = 99
      *
     c                   if        d9tonr <> *zero
     c                   eval      d_numm_til = d9tonr
     c                   endif
      *
      *  Starter utplukk av ordre
      *
     c     d91tag1       tag
     c                   read      fohelo                                 90
     c     *in90         cabeq     *on           xny_otyp
      *
     c                   eval      d_firm_les = fofirm
     c                   eval      d_otyp_les = footyp
     c                   eval      d_numm_les = fonumm
     c                   eval      d_suff_les = fosuff
     c     d_kkey_les    cabgt     d_kkey_til    xny_otyp
      *
     c                   exsr      oppord9
      *
     c                   goto      d91tag1
      *
     c     xny_otyp      tag
      *
     c                   endif
     c                   enddo
      *
     c                   if        w_utpl = *on
     c                   eval      w_ftor = *blanks
     c                   eval      w_numm = *zero
     c                   eval      w_suff = *zero
     c                   eval      w_pdir = *zero
     c                   eval      w_type = *blanks
     c                   eval      w_outq = *blanks
     c                   call      'FO605R'
     c                   parm                    w_ftor
     c                   parm                    w_firm
     c                   parm                    w_numm
     c                   parm                    w_suff
     c                   parm                    w_type
     c                   parm                    w_pdir
     c                   parm                    w_outq
     c                   endif
      *
     c                   goto      xslutt
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  D2 Behandler plukking av ordrenummer  utfra sekvens på kunde
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     d92taga       tag
      *
      *  Send Alt
      *
     c                   write     d92bld
      *
      *  Bare data
      *
     c     d92tagb       tag
     c                   exfmt     d92bld
      *
      *  F3=Avslutt program
      *
     c     *inkc         cabeq     *on           xslutt
      *
      *  Er t.o.m. dato en gyldig dato (ordredato)
      *
     c                   if        d92bdat <> 0
     c     *dmy          test(d)                 d92bdat                32
     c                   if        *in32 = *on
     c                   goto      d92tagb
     c                   endif
      *
      *  Snu dato før test
      *
     c     *dmy          move      d92bdat       w_bdat
     c                   endif
      *
      *  Er t.o.m. dato en gyldig dato (pakkseddeldato)
      *
     c                   if        d92ldat <> 0
     c     *dmy          test(d)                 d92ldat                33
     c                   if        *in33 = *on
     c                   goto      d92tagb
     c                   endif
      *
      *  Snu dato før test
      *
     c     *dmy          move      d92ldat       w_ldat
     c                   endif
      *
      *  Kontroll om fra er større enn til dersom til er oppgitt
      *
     c                   if        d92tonr <> *zero
     c                   if        d92fonr > d92tonr
     c                   eval      *in34 = *on
     c                   goto      d92tagb
     c                   endif
     c                   endif
      *
      *  Dersom til ikke er
      *  oppgitt, legges fra
      *  ut i til
      *
     c                   if        d92tonr = *zero
     c                   eval      d92tonr = d92fonr
     c                   endif
      *
      *  Minst en sekvenskode
      *  må være oppgitt
      *
     c                   if        d92sek1 = *zero
     c                   if        d92sek2 = *zero
     c                   if        d92sek3 = *zero
     c                   if        d92sek4 = *zero
     c                   eval      *in31  = *on
     c                   goto      d92tagb
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Behandler plukking av ordrenummer utfra sekvens på kunde
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     1             do        2             w_x
     c                   if        oty(w_x) <> *blanks
     c                   eval      w_foty = nty(w_x)
     c                   eval      fohelo_otyp = oty(w_x)
     c                   eval      fohelo_numm = *zero
     c                   eval      fohelo_suff = *zero
     c     fohelo_key    setll     fohelo
      *
      *  Starter utplukk av ordre
      *
     c     d92tag1       tag
     c                   read      fohelo                                 90
     c     *in90         cabeq     *on           xny_oty2
     c     footyp        cabne     fohelo_otyp   xny_oty2
      *
      *  Valg på avdeling
      *
     c                   if        d92avde <> 0 and
     c                             foavde <> 0 and
     c                             d92avde <> foavde
     c                   goto      d92tag1
     c                   endif
      *
      *  Ta med avdeling 0 ?
      *
     c                   if        d92avde <> 0 and
     c                             foavde =  0 and
     c                             d92avd0 =  0
     c                   goto      d92tag1
     c                   endif
      *
     c                   if        d92avde =  0 and
     c                             foavde <> 0 and
     c                             d92avd0 =  1
     c                   goto      d92tag1
     c                   endif
      *
      *  Sjekk på dato dersom oppgitt (Ordredato)
      *
     c                   if        w_bdat <> *loval
     c                   if        fobdat > w_bdat
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
      *  Sjekk på dato dersom oppgitt (Pakkseddeldato)
      *
     c                   if        w_ldat <> *loval
     c                   if        foldat =  *loval
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
     c                   if        w_ldat <> *loval
     c                   if        foldat > w_ldat
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
      *  Sjekk på beløpsgrense dersom oppgitt
      *
     c                   if        d92belg > *zero
     c                   eval      w_belo = fotots - fototr
      *
     c                   if        d92belk <> 'U'
     c                   if        w_belo < d92belg
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
     c                   if        d92belk = 'U'
     c                   if        w_belo > d92belg
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
     c                   endif
      *
      *  Sjekk på ordre fra-til dersom oppgitt
      *
     c                   if        d92fonr > *zero
     c                   if        fonumm < d92fonr
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
     c                   if        d92fonr > *zero
     c                   if        fonumm > d92tonr
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
      *  Sjekke sekvensnummer
      *
     c                   eval      rkunl1_kund = fokund
     c     rkunl1_key    chain     rkunl1r                            92
      *
     c                   if        *in92 = *off
      *
     c                   eval      w_sekv = rksekv
      *
      * Er kundeprosjekt oppgitt
      *
     c                   if        fokpro <> 0
     c                   eval      fkprl1_kund = fokund
     c                   eval      fkprl1_kpro = fokpro
     c     fkprl1_key    chain     fkprl1r
     c                   if        %found(fkprl1)
     c                   eval      w_sekv = flsekv
     c                   endif
     c                   endif
      *
     c                   if        d92sek1 <> *zero
     c                   if        w_sekv = d92sek1
     c                   exsr      oppord9
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
     c                   if        d92sek2 <> *zero
     c                   if        w_sekv = d92sek2
     c                   exsr      oppord9
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
     c                   if        d92sek3 <> *zero
     c                   if        w_sekv = d92sek3
     c                   exsr      oppord9
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
     c                   if        d92sek4 <> *zero
     c                   if        w_sekv = d92sek4
     c                   exsr      oppord9
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
      * Ta med sekvenskode 00 ?
      *
     c                   if        d92sek0 = 1
     c                   if        w_sekv = *zero
     c                   exsr      oppord9
     c                   goto      d92tag1
     c                   endif
     c                   endif
      *
     c                   endif
      *
     c                   goto      d92tag1
      *
     c     xny_oty2      tag
      *
     c                   endif
     c                   enddo
      *
     c                   if        w_utpl = *on
     c                   eval      w_ftor = *blanks
     c                   eval      w_numm = *zero
     c                   eval      w_suff = *zero
     c                   eval      w_pdir = *zero
     c                   eval      w_type = *blanks
     c                   eval      w_outq = *blanks
     c                   call      'FO605R'
     c                   parm                    w_ftor
     c                   parm                    w_firm
     c                   parm                    w_numm
     c                   parm                    w_suff
     c                   parm                    w_type
     c                   parm                    w_pdir
     c                   parm                    w_outq
     c                   endif
      *
     c                   goto      xslutt
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  D3 Behandler plukking av ordrenummer  tilfeldige
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     d93taga       tag
      *
     c                   eval      d93uonr = *zero
     c                   eval      d93usuf = *zero
     c                   eval      d93ionr = *zero
     c                   eval      d93isuf = *zero
      *
      *  Send Alt
      *
     c                   write     d93bld
      *
      *  Bare data
      *
     c     d93tagb       tag
     c                   exfmt     d93bld
      *
      *  F3=Avslutt program
      *
     c     *inkc         cabeq     *on           xslutt
      *
      *  Ingen ordrenummer er tastet, avslutt tilfeldig registrering
      *
     c                   if        d93ionr = *zero
     c                   if        d93isuf = *zero
     c                   goto      xslutt
     c                   endif
     c                   endif
      *
      *  Sjekk, Finnes ordrenummer i ORDRE-HODE-REGISTER
      *
     c                   eval      fohel1_numm = d93ionr
     c                   eval      fohel1_suff = d93isuf
     c     fohel1_key    chain     fohel1r                            90
     c                   if        *in90 = *on
     c                   eval      *in31 = *on
     c                   goto      d93tagb
     c                   endif
      *
      *  Sjekk, Er ordretype på ordre lik med
      *        med ordretype fra i parameter
      *
8.05 c                   if        %lookup(footyp:oty) = 0
     c                   eval      *in32 = *on
     c                   goto      d93tagb
     c                   endif
8.06 c**                 eval      w_foty = nty(w_x)
      *
8.05 c                   eval      w_x = 1
8.05 c     footyp        lookup    oty(w_x)                               90
8.05 c                   if        *in90 = *on
8.05 c                   eval      w_foty = nty(w_x)
8.05 c                   endif
      *
8.05 c                   if        %trim(w_foty) = *blanks
8.05 c                   eval      *in34 = *on
8.05 c                   goto      d93tagb
8.05 c                   endif
      *
      *  Behandler utplukk
      *
     c                   exsr      oppord9
      *
      *  Legger inn for å vise siste utplukkede ordrenummer
      *
     c                   eval      d93uonr = fohel1_numm
     c                   eval      d93usuf = fohel1_suff
      *
      *  Blanker felter for å registrere nytt ordrenummer
      *
     c                   eval      d93ionr = *zero
     c                   eval      d93isuf = *zero
      *
     c                   goto      d93tagb
      *
     c                   if        w_utpl = *on
     c                   eval      w_ftor = *blanks
     c                   eval      w_numm = *zero
     c                   eval      w_suff = *zero
     c                   eval      w_pdir = *zero
     c                   eval      w_type = *blanks
     c                   eval      w_outq = *blanks
     c                   call      'FO605R'
     c                   parm                    w_ftor
     c                   parm                    w_firm
     c                   parm                    w_numm
     c                   parm                    w_suff
     c                   parm                    w_type
     c                   parm                    w_pdir
     c                   parm                    w_outq
     c                   endif
      *
     c                   goto      xslutt
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * D4 Behandler plukking av ordrenummer andre valg
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     d94taga       tag
      *
      * Send Alt
      *
     c                   write     d94bld
      *
      * Bare data
      *
     c     d94tagb       tag
     c                   exfmt     d94bld
      *
      * F3=Avslutt program
      *
     c                   if        *inkc  = *on
     c                   goto      xslutt
     c                   endif
      *
      * F4=Spørring
      *
     c                   if        *inkd  = *on
     c                   exsr      spØrring
     c                   goto      d94tagb
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandler plukking av ordrenummer utfra andre valg
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     1             do        2             w_x
     c                   if        oty(w_x) <> *blanks
     c                   eval      w_foty = nty(w_x)
     c                   eval      fohelo_otyp = oty(w_x)
     c                   eval      fohelo_numm = *zero
     c                   eval      fohelo_suff = *zero
     c     fohelo_key    setll     fohelo
      *
      * Starter utplukk av ordre
      *
     c     d94tag1       tag
     c                   read      fohelo                                 90
     c     *in90         cabeq     *on           xny_oty4
     c     footyp        cabne     fohelo_otyp   xny_oty4
      *
      * Valg på avdeling
      *
     c                   if        d94avde <> 0 and
     c                             foavde <> 0 and
     c                             d94avde <> foavde
     c                   goto      d94tag1
     c                   endif
      *
      * Ta med avdeling 0 ?
      *
     c                   if        d94avde <> 0 and
     c                             foavde =  0 and
     c                             d94avd0 =  0
     c                   goto      d94tag1
     c                   endif
      *
     c                   if        d94avde =  0 and
     c                             foavde <> 0 and
     c                             d94avd0 =  1
     c                   goto      d94tag1
     c                   endif
      *
      * Er kundenummer oppgitt
      *
     c                   if        d94kund <> 0
     c                   eval      rkunl1_kund = d94kund
     c     rkunl1_key    chain     rkunl1r                            92
      *
      * Kunde ikke funnet
      *
     c                   if        *in92 = *on
     c                   goto      d94tag1
     c                   endif
      *
      * Uaktuell kunde
      *
     c                   if        d94kund <> fokund
     c                   goto      d94tag1
     c                   endif
     c                   endif
      *
      * Er kundeprosjekt oppgitt
      *
     c                   if        d94kpro <> 0
     c                   eval      fkprl1_kund = d94kund
     c                   eval      fkprl1_kpro = d94kpro
     c     fkprl1_key    chain     fkprl1r                            93
      *
      * Kundeprosjekt ikke funnet
      *
     c                   if        *in93 = *on
     c                   goto      d94tag1
     c                   endif
      *
      * Uaktuelt kundeprosjekt
      *
     c                   if        d94kpro <> fokpro
     c                   goto      d94tag1
     c                   endif
     c                   endif
      *
      * Er infokode oppgitt
      *
     c                   if        d94ityp <> *blank
      *
      * Uaktuell infokode
      *
     c                   if        d94ityp <> foityp
     c                   goto      d94tag1
     c                   endif
     c                   endif
      *
      * Ingen valg er foretatt
      *
     c                   if        d94avde = 0 and
     c                             d94kund = 0 and
     c                             d94kpro = 0 and
     c                             d94ityp = *blank
     c                   goto      d94tag1
     c                   endif
      *
   1  * Aktuell post funnet,
      * oppdater:
      *
     c                   exsr      oppord9
      *
     c                   goto      d94tag1
      *
     c     xny_oty4      tag
      *
     c                   endif
     c                   enddo
      *
     c                   if        w_utpl = *on
     c                   eval      w_ftor = *blanks
     c                   eval      w_numm = *zero
     c                   eval      w_suff = *zero
     c                   eval      w_pdir = *zero
     c                   eval      w_type = *blanks
     c                   eval      w_outq = *blanks
     c                   call      'FO605R'
     c                   parm                    w_ftor
     c                   parm                    w_firm
     c                   parm                    w_numm
     c                   parm                    w_suff
     c                   parm                    w_type
     c                   parm                    w_pdir
     c                   parm                    w_outq
     c                   endif
      *
     c                   goto      xslutt
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Behandler oppdatering av registre etter kontroll-utvalg
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppord9       begsr
      *
      *  Sjekk, er denne ordren allerede under behandling
      *
     c     fokode        cabne     *zero         oppend9
      *
      *  Sjekk, har denne ordren en ordretype som er valgt (fra)
      *
     c                   if        %lookup(footyp:oty) = 0
     c                   goto      oppend9
     c                   endif
      *
      * Sjekk om ordren har ordrelinjer - hvis ikke skal den slettes
      *
     c                   eval      b_slet = *on
     c                   eval      fodtlr_numm = fonumm
     c                   eval      fodtlr_suff = fosuff
     c                   eval      fodtlr_line = 0
     c     fodtlr_key    setll     fodtlr
     c     fodtlr_key2   reade     fodtlr
     c                   dow       not %eof
     c                   eval      b_slet = *off
     c     fodtlr_key2   reade     fodtlr
     c                   enddo
      * Hvis ingen linjer, slettes ordre.
     c                   if        b_slet = *on
      *
     c                   eval      p_type = '*AUT'
      *
     c                   eval      p_kom1 = 'MANGLER VARELINJER'
     c                   eval      p_kom2 = *blanks
      *
     c                   call      'FO410R'
     c                   parm                    w_firm
     c                   parm                    fonumm
     c                   parm                    fosuff
     c                   parm                    p_type
     c                   parm                    p_kom1
     c                   parm                    p_kom2
     c                   parm                    p_opdt
      *
     c                   goto      oppend9
      *
     c                   endif
      *
      * Hent inn ordre-info-kode i inforegister
      *
     c                   eval      vinfl1_ityp = foityp
     c     vinfl1_key    chain     vinfl1r                            98
     c                   if        *in98  = *on
     c                   eval      vaifak = *blank
     c                   endif
      *
      *  Dersom ordre har en infokode, og dette er fakturering,
      *  sjekkes det om fakturering skal stoppes.
      *
     c                   if        foityp <> *blank
     c                   if        vaoakk =  3
     c                   if        vaifak = '1'
     c                   goto      oppend9
     c                   endif
     c                   endif
     c                   endif
      *
      *  Kontroll om bruker har lov til å sette igang fakturering.
      *
     c                   if        fbko08 <> 1
     c                   if        vaoakk =  3
     c                   goto      oppend9
     c                   endif
     c                   endif
      *
      *  Dersom dette er en pakkseddel, sjekk om den
      *  allerede skulle være skrevet ut.
      *
     c**                 if        fopaks = 1
     c**                 if        vaoakk = 2
     c**                 goto      oppend9
     c**                 endif
     c**                 endif
      *
      *  Kontroll om korttrans./alt.fakt. og annet utvalg enn type 5
      *
     c                   if        d9svar <> 5
     c                   eval      fntrl1_numm = fonumm
     c                   eval      fntrl1_suff = fosuff
     c     fntrl1_key    chain     fntrl1r
     c                   if        %found
     c                   goto      oppend9
     c                   endif
     c                   endif
      *
      * sjekke depositum
      *
     c                   exsr      sjekk_depo
     c                   if        b_depo = *on
     c                   goto      oppend9
     c                   endif
      *
      *  Oppdaterer ORDRE-HODE-REGISTER med merke, ordren er til behandl.
      *
     c                   call      'FO709R'
     c                   parm                    fonumm
     c                   parm                    fosuff
      *
     c                   eval      fohel1_numm = fonumm
     c                   eval      fohel1_suff = fosuff
     c     fohel1_key    chain     fohelur                            94
     c                   if        *in94  = *off
     c*                  if        w_toty = *blank
     c*                  eval      fokode = 2
     c*                  else
     c                   eval      fokode = 3
     c*                  endif
     c                   time                    foedat
     c                   time                    foetim
     c                   eval      foeusr = l_user
     c                   update    fohelur
     c                   endif
      *
      *  Oppdater UTPLUKK-PARAM-REGISTER med ny ordre
      *
     c                   eval      fplolu_numm = fonumm
     c                   eval      fplolu_suff = fosuff
     c     fplolu_key    chain     fplolur                            96
     c                   if        *in96  = *on
     c                   eval      fkpfir = w_firm
     c                   eval      fkponr = fplolu_numm
     c                   eval      fkpsuf = fplolu_suff
     c                   eval      fkpoty = w_foty
     c                   eval      fkpwsd = l_wsid
     c                   eval      fkpusr = l_user
     c                   eval      fkpalt = w_palt
     c                   eval      fkpdir = *zero
     c                   eval      fkpres = *zero
     c                   eval      fkptxt = d9ptxt
     c                   eval      fkpkol = *zero
     c                   eval      fkpnet = *zero
     c                   eval      fkpbru = *zero
     c                   eval      fkplmt = *blank
     c                   eval      fkpfpr = *zero
     c                   eval      fkpfte = *blank
     c                   eval      fkpepr = *zero
     c                   eval      fkpete = *blank
     c                   eval      fkplag = folage
     c                   write     fplolur
     c                   eval      w_utpl = *on
     c                   endif
      *
     c     oppend9       endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av spørring
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     spØrring      begsr
      *
      * Avdeling
      *
     c                   if        w_afld = 'D94AVDE'
     c                   call      'RA107R'
     c                   parm                    w_firm
     c                   parm                    d94avde
     c                   parm                    w_atxt
     c                   goto      end_spØrr
     c                   endif
      *
      * Kunde
      *
     c                   if        w_afld = 'D94KUND'
     c                   call      'RK500R'
     c                   parm                    w_firm
     c                   parm                    d94kund
     c                   parm                    w_knav
     c                   goto      end_spØrr
     c                   endif
      *
      * Kundeprosjekt
      *
     c                   if        w_afld = 'D94KPRO'
     c                   call      'FL500R'
     c                   parm                    w_firm
     c                   parm                    d94kund
     c                   parm                    d94kpro
     c                   parm                    w_knav
     c                   parm                    w_pnav
     c                   goto      end_spØrr
     c                   endif
      *
      * Spørring på ordre-info-type
      *
     c                   if        w_afld = 'D94ITYP'
     c                   call      'VA540R'
     c                   parm                    w_firm
     c                   parm                    d94ityp
     c                   parm                    w_itxt
     c                   goto      end_spØrr
     c                   endif
      *
      * Spørring på ordretyper
      *
     c                   if        w_afld = 'D9OTY1'
8.03 c                   call      'VA551R'
     c                   parm                    w_firm
     c                   parm                    d9oty1
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'D9OTY2'
8.03 c                   call      'VA551R'
     c                   parm                    w_firm
     c                   parm                    d9oty2
     c                   goto      end_spØrr
     c                   endif
      *
8.03 c                   if        w_afld = 'D9OTY3'
8.03 c                   call      'VA551R'
8.03 c                   parm                    w_firm
8.03 c                   parm                    d9oty3
8.03 c                   goto      end_spØrr
8.03 c                   endif
      *
8.03 c                   if        w_afld = 'D9OTY4'
8.03 c                   call      'VA551R'
8.03 c                   parm                    w_firm
8.03 c                   parm                    d9oty4
8.03 c                   goto      end_spØrr
8.03 c                   endif
      *
8.03 c                   if        w_afld = 'D9OTY5'
8.03 c                   call      'VA551R'
8.03 c                   parm                    w_firm
8.03 c                   parm                    d9oty5
8.03 c                   goto      end_spØrr
8.03 c                   endif
      *
8.03 c                   if        w_afld = 'D9OTY6'
8.03 c                   call      'VA551R'
8.03 c                   parm                    w_firm
8.03 c                   parm                    d9oty6
8.03 c                   goto      end_spØrr
8.03 c                   endif
      *
     c*                  if        w_afld = 'D9TOT1'
     c*                  call      'VA550R'
     c*                  parm                    w_firm
     c*                  parm                    d9tot1
     c*                  goto      end_spØrr
     c*                  endif
      *
     c*                  if        w_afld = 'D9TOT2'
     c*                  call      'VA550R'
     c*                  parm                    w_firm
     c*                  parm                    d9tot2
     c*                  goto      end_spØrr
     c*                  endif
      *
     c     end_spØrr     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å sjekke om linje har ubetalt depositumskrav
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_depo    begsr
      *
     c                   eval      b_depo = *off
     c                   eval      sdepl1_numm = fonumm
     c                   eval      sdepl1_kund = fokund
     c                   eval      sdepl1_tell = 0
     c     sdepl1_key    chain     sdepl1r
     c                   if        %found(sdepl1) and
     c                             skdepb < skdepo
     c                   eval      b_depo = *on
     c                   endif
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      *  Key for file : KUNDE-REGISTER
      *
     c     rkunl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl1_kund
      *
      *  Key for file : KUNDE-PROSJEKT
      *
     c     fkprl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fkprl1_kund
     c                   kfld                    fkprl1_kpro
      *
      * Key for file : ORDRE-TYPE-REGISTER
      *
     c     votyl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    votyl1_otyp
      *
      * Key for file : ORDRE-HODE-REGISTER
      *
     c     fohel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fohel1_numm
     c                   kfld                    fohel1_suff
      *
      *  Key for file : ORDRE-HODE-ORDRETYPE-REGISTER
      *
     c     fohelo_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fohelo_otyp
     c                   kfld                    fohelo_numm
     c                   kfld                    fohelo_suff
      *
      * Key for file : UTPLUKK-PARAM-REGISTER
      *
     c     fplolu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fplolu_numm
     c                   kfld                    fplolu_suff
      *
      * Key for oppslag på ordre-info-type
      *
     c     vinfl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vinfl1_ityp
      *
      * Key for brukerregister
      *
     c     fusrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fusrl1_user
      *
      * Key for ofak kode-register
      *
     c     fstsl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for kort/fakt trans - type
      *
     c     fntrl2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fntrl2_kftp
      *
      * Key for kort/fakt trans/numm
      *
     c     fntrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fntrl1_numm
     c                   kfld                    fntrl1_suff
      *
      *  Key for file : ORDRE-LINJE-REGISTER
      *
     c     fodtlr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fodtlr_numm
     c                   kfld                    fodtlr_suff
     c                   kfld                    fodtlr_line
      *
      *  Key for file : ORDRE-LINJE-REGISTER
      *
     c     fodtlr_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    fodtlr_numm
     c                   kfld                    fodtlr_suff
      *
      * Key for oppslag på depositum-fil
      *
     c     sdepl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    sdepl1_numm
     c                   kfld                    sdepl1_kund
     c                   kfld                    sdepl1_tell
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Tar inn parameter fra forrige program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *entry        plist
     c                   parm                    p_ftor
     c                   parm                    p_firm
8.03 c                   parm                    p_stat
      *
      *  Legger inn firmanummer i nøkklene
      *
     c                   eval      w_firm     = p_firm
     c                   eval      d_firm_til = p_firm
      *
      * Hente inn brukerregister
      *
     c                   eval      fusrl1_user = l_user
     c     fusrl1_key    chain     fusrl1r                            90
      *
      * Hente inn ofak kode-register
      *
     c     fstsl1_key    chain     fstsl1r                            90
      *
     c                   endsr
