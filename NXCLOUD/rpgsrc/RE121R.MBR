     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *                                                                       *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RE121R                                              *
      * Beskrivelse . . : Tilrettelegger trans fra PC systemer                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
      * V5.00     181103  Timstampfeil rettet, firma kundefil rettet.    HFL  *
6.20  *  6.20     011210  Prosjekt er alfa                               NHO  *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     fre0ipf    ip  ae           k disk
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
     fraa3l1    if   e           k disk    rename(raa3pfr:raa3l1r)
     fraa4l1    if   e           k disk    rename(raa4pfr:raa4l1r)
     fre0tpf    o    e           k disk
     fre0kpf    o    e           k disk
      *
     d wrec            s              1    dim(768)
     d wflt            s              1    dim(768)
     d per             s              2  0 dim(13)
     d txt             s             20    dim(5) ctdata perrcd(1)
      *
      * LOCAL DATA
      *
     d                uds
     d pfirm                 300    302  0
     d pnavn                         30
     d puser                         10
     d pdato                          6  0
     d praar                          4  0
     d pperf                          2  0
     d ppert                          2  0
     d psyst                 471    472  0
      *
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
     d pdatx           s              8  0
     d wbelØp          s             14
     d wfelt           s                   like(rpcin1)
T5.00d wfelt6          s              6  0
     d w_raar          s              4  0
     d wkfakr          s              4
     d wkore           s              2  0
     d wkp             s              2  0
     d wkper           s              8  0
     d wkrone          s             11  0
     d wkron9          s              8  0
     d wlinje          s              8  0
6.NU d wnota           s              8  0
     d wnxbun          s                   like(rtbunt)
     d wtbdat          s              6  0
     d wtpre           s             10  2
     d wxxxx1          s              2
     d wxxxx2          s              3
     d wxxxx3          s             11
     d wxxxx4          s             14
     d wxxxx5          s              6
     d wxxxx6          s             10
     d wxxxx7          s             11
     d wxxxx8          s             25
     d wxxxx9          s              6
     d xxxx10          s              6
     d xxxx11          s              3
     d xxxx12          s              4
     d xxxx13          s              2
     d xxxx14          s              2
     d xxxx15          s              2
     d xxxx16          s              2
     d xxxx17          s              2
      *
     d x               s              3  0
     d y               s              3  0
      *
     d w_firm          s                   like(l_firm)
      *
     d raa4l1_4aar     s                   like(ra4aar)
      *
      *  Statusopplysninger - avvikende perioder
      *
     iraa3l1r
     i              ra3p01                      per(01)
     i              ra3p02                      per(02)
     i              ra3p03                      per(03)
     i              ra3p04                      per(04)
     i              ra3p05                      per(05)
     i              ra3p06                      per(06)
     i              ra3p07                      per(07)
     i              ra3p08                      per(08)
     i              ra3p09                      per(09)
     i              ra3p10                      per(10)
     i              ra3p11                      per(11)
     i              ra3p12                      per(12)
     i              ra3p13                      per(13)
      *
B001 c                   if        *in15 = *off
 001 c                   eval      rtraar = praar
 001 c                   eval      rtrper = ppert
 001 c                   move      *on           *in15
E001 c                   endif
      *
     c     start         tag
      *
      * Flytt inputfelt
      *
     c                   z-add     257           x
     c                   movea     rpcin1        wrec(1)
     c                   movea     rpcin2        wrec(x)
     c                   z-add     513           x
     c                   movea     rpcin3        wrec(x)
 001  *
 001  * Bilagskode
 001  *
     c                   z-add     1             x
     c                   z-add     1             y
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rtbilk
 001  *
 001  * Ordredato
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wtbdat
 001  *
 001  * Bilagsnummer
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rtbiln
 001  *
 001  * Bilagsdato
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
E5.00c                   movel     wfelt         wfelt6
T5.00c     *dmy          move      wfelt6        rtbdat
 001  *
 001  * Faktura/Kreditnota
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wkfakr
 001  *
 001  * Bilagstekst
 001  *
     c                   z-add     1             y
     c                   add       2             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = '"'
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rttext
 001  *
 001  * Bilagskode
      *
B001 c                   if        wkfakr = '9860'
 001 c                   eval      rtbilk = 01
E001 c                   endif
 001  *
B001 c                   if        wkfakr = '9861'
 001 c                   eval      rtbilk = 03
E001 c                   endif
 001  *
B001 c                   if        wkfakr = '9864'
 001 c                   eval      rtbilk = 01
 001 c                   move      txt(4)        rttext
E001 c                   endif
 001  *
B001 c                   if        wkfakr = '9866'
 001 c                   eval      rtbilk = 01
 001 c                   move      txt(5)        rttext
E001 c                   endif
 001  *
B001 c                   if        wkfakr = '9867'
 001 c                   eval      rtbilk = 03
 001 c                   move      txt(3)        rttext
E001 c                   endif
      *
      * Debet avdeling
      *
     c                   z-add     1             y
     c                   add       2             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rtdavd
 001  *
 001  * Kredit avdeling
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rtcavd
 001  *
 001  * Debet konto
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rtdkto
 001  *
 001  * Kredit konto
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rtckto
 001  *
 001  * Felt 1
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wxxxx1
 001  *
 001  * Felt 2
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wxxxx2
 001  *
 001  * Felt 3
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wxxxx3
 001  *
 001  * Felt 4
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wxxxx4
 001  *
 001  * Beløp
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wbelØp
     c                   movel     wbelØp        wkrone
     c                   move      wbelØp        wkore
     c                   z-add     wkrone        wkron9
     c                   movel     wkron9        rtbelØ
     c                   eval      rtbelØ = wkore
 001  *
 001  * Felt 5
 001  *
     c                   z-add     1             y
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wxxxx5
 001  *
 001  * Forfallsdato
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
E5.00c                   movel     wfelt         wfelt6
T5.00c                   if        wfelt6 = *zeros
T5.00c                   eval      rtfdat = *loval
T5.00c                   else
T5.00c     *dmy          move      wfelt6        rtfdat
T5.00c                   endif
 001  *
 001  * Felt 6
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wxxxx6
 001  *
 001  * Felt 7
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wxxxx7
 001  *
 001  * Felt 8
 001  *
     c                   z-add     1             y
     c                   add       2             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = '"'
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wxxxx8
 001  *
 001  * Kundenummer
 001  *
     c                   z-add     1             y
     c                   add       2             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rkkund
 001  *
 001  * Felt 9
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         wxxxx9
 001  *
 001  * Kundenavn
 001  *
     c                   z-add     1             y
     c                   add       2             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = '"'
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rknavn
 001  *
 001  * Gateadresse
 001  *
     c                   z-add     1             y
     c                   add       3             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = '"'
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rkgate
 001  *
 001  * Adresse 2
 001  *
     c                   z-add     1             y
     c                   add       3             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = '"'
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rkadr2
 001  *
 001  * Postnummer
 001  *
     c                   z-add     1             y
     c                   add       3             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = '"'
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         xxxx10
     c                   move      xxxx10        rkponr
 001  *
 001  * Poststed
 001  *
     c                   z-add     1             y
     c                   add       3             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = '"'
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         rksted
 001  *
 001  * Felt 11
 001  *
     c                   z-add     1             y
     c                   add       2             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         xxxx11
 001  *
 001  * Felt 12
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         xxxx12
 001  *
 001  * Felt 13
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         xxxx13
 001  *
 001  * Felt 14
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         xxxx14
 001  *
 001  * Felt 15
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         xxxx15
 001  *
 001  * Felt 16
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         xxxx16
 001  *
 001  * Felt 17
 001  *
     c                   z-add     1             y
     c                   add       1             x
     c                   eval      wflt = *blank
     c                   eval      wfelt = *blank
 001  *
B001 c                   dou       wrec(x) = ','
 001 c                   move      wrec(x)       wflt(y)
 001 c                   add       1             y
 001 c                   add       1             x
E001 c                   enddo
 001  *
     c                   movea     wflt          wfelt
     c                   movel     wfelt         xxxx17
      *
      * Legg ut transaksjoner
      *
     c                   add       rtbelØ        wtpre
     c                   add       1             wlinje
     c                   eval      rtreid = 'T'
     c                   eval      rtfirm = l_firm
     c                   eval      rtbunt = wnxbun
     c                   eval      rtlinj = wlinje
     c                   eval      rtstat = *blank
     c                   eval      rtdsps = *zero
     c                   eval      rtdmva = '3'
     c                   eval      rtcsps = *zero
     c                   eval      rtcmva = '3'
6.20 c**                 eval      rtpros = *zero
6.20 c                   eval      rtpros = *blank
     c                   eval      rtrefn = *zero
     c                   eval      rtkrab = *zero
     c                   eval      rtvalk = *blank
     c                   eval      rtvalb = *zero
     c                   eval      rtakti = *blank
     c                   eval      rtmngd = *zero
     c                   eval      rtmngk = *zero
     c                   eval      rtresn = *zero
     c                   eval      rtvirk = *blank
     c                   eval      rtatte = *zero
     c                   eval      rtautx = *blank
     c                   eval      rtkrys = *blank
     c                   eval      rtkidi = *blank
     c                   eval      rtbetb = *zero
     c                   eval      rtbref = *blank
 001  *
     c                   write     re0tpfr
      *
T5.00c                   eval      rkfirm = l_firm
     c                   write     re0kpfr
 001  *
     c     slutt         tag
 001  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
 001  *
     c     *inzsr        begsr
      *
     c                   eval      w_firm = l_firm
      *
     c                   eval      wkp = *zeros
     c                   eval      x = 0
 001  *
     c                   z-add     1             wnxbun
     c     uyear         sub       1             w_raar
 001  *
     c     afirl1_key    chain     afirl1                             10
 001  *
     c     raa3l1_key    chain     raa3l1                             10
 001  *
     c                   eval      raa4l1_4aar = *year
     c     raa4l1_key    chain     raa4l1
 001  *
B001 c                   if        %found
 001 c                   z-add     ra4sgb        wnota
E001 c                   else
 001 c                   z-add     0             wnota
E001 c                   endif
 001  *
     c     afirl1_key    klist
     c                   kfld                    w_firm
 001  *
     c     raa3l1_key    klist
     c                   kfld                    w_firm
 001  *
     c     raa4l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    raa4l1_4aar
      *
     c                   endsr
      * ----------------------------------------
**   Bilagstekster
Faktura
Kreditnota
Øreavrunding
Gebyr
Utg. MVA
