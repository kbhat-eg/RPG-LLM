```markdown
# RPG Program Explanation: LI725R

## Overview

This RPG program (`LI725R`) is designed to check the status of automatic EDI (Electronic Data Interchange) updates for a business (in this case, specifically tailored for "Mestergruppen"). If something is wrong with the update, it flags the deviation by sending an email notification to specified recipients.

## Structure

- **File Definition**
    - `gedgl1`: Input file, keyed, renamed from `gedgpfr` to `gedgl1r`.
- **LDA (Local Data Area) Usage**
    - Extracts user, firm, and some navigation info from the LDA.
- **Work Variables and Constants**
    - Several variables for holding parameter values, date/time info, and text for emails.
- **Display Feedback Data Structure**
    - Tracks some display feedback variables (likely from panel group or display file).
- **Initialization Subroutine**
    - Gets the current date, time, year, and firm from LDA and parameters.
- **Main Logic**
    - Attempts to chain (lookup) a record for the current firm in the `gedgl1` file.
    - If the record is not found or has a bad status (`ggstat = 0`), program ends.
    - If today’s date (`w_date`) is greater than the EDI update date (`ggsdat`), triggers notification subroutine.
- **Notification Subroutine (`sub_varsle`)**
    - Checks if at least one recipient email is present.
    - Loads email content and recipient addresses.
    - Calls another program (`AF726R`) to perform the actual email sending.
    - Message text is constructed dynamically based on the issue and database fields.
- **Termination**
    - Programs sets last record indicator (`*INLR = *ON`) and returns.

## Detailed Breakdown

### 1. File Definition

```rpg
fgedgl1    if   e           k disk    rename(gedgpfr:gedgl1r)
```
- Defines an input-capable, keyed disk file. The external file `gedgpfr` is known internally as `gedgl1r`.

---

### 2. LDA Fields

```rpg
d                uds
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980
```
- Reads user, firm, and navigation fields from specific positions in the LDA.

---

### 3. Parameters/Work Variables

- **Email/Notification-related:**  
  `p_stat`, `p_mot1`, `p_mot2`, `p_mot3`, `p_send`, `p_subj`, `p_txt1`, `p_txt2`, `p_txt3`, `p_txt4`, `p_avsl`
- **Date/Time:**  
  `w_date`, `w_time`, `w_year`
- **Other:**  
  `w_firm` (company number), `c_sfil` (constant, likely unused in main logic)

---

### 4. Initialization Subroutine (`*INZSR`)

- Loads firm number from LDA.
- Gets the current date and time.
- Prepares the key for file lookup.

---

### 5. Main Program Logic

- **Lookup EDI Update Record:**
    ```rpg
    c     gedgl1_key    chain     gedgl1
    ```
    - Retrieves (chains) the record for the current firm.
- **Validation:**
    ```rpg
    c                   if        not %found or
    c                             ggstat = 0
    c                   goto      avslutt
    c                   endif
    ```
    - If not found or status field (`ggstat`) is zero (inactive/bad), skip to end.
- **Check for EDI Update Date:**
    ```rpg
    c                   if        w_date > ggsdat
    c                   exsr      sub_varsle
    c                   endif
    ```
    - If today (`w_date`) is after the date on the record (`ggsdat`), trigger notification.
- **End/Close:**
    ```rpg
    c     avslutt       tag
    c                   eval      *inlr = *on
    c                   return
    ```

---

### 6. Notification Subroutine (`sub_varsle`)

- **Check for at least one email address:**
    ```rpg
    c                   if        %trim(ggmai1) = *blanks  and
    c                             %trim(ggmai2) = *blanks  and
    c                             %trim(ggmai3) = *blanks
    c                   goto      end_varsle
    c                   endif
    ```
    - If all email fields are blank, skip notification.
- **Populate Notification Variables:**
    ```rpg
    c                   eval      p_mot1 = ggmai1
    c                   eval      p_mot2 = ggmai2
    c                   eval      p_mot3 = ggmai3
    c                   eval      p_send = 'bsaethe@online.no'
    c                   eval      p_subj = 'Feil med automatisk overf�ring av +
    c                                      EDI meldinger hos Mestergruppen' +
    c                                      %char(w_date)
    c                   eval      p_txt1 = ggtxt1 + ggtxt2
    c                   movel     ggtxt3        p_txt3
    c                   eval      p_txt4 = *blanks
    c                   eval      p_avsl = 'Sendt av automatisk kontrollrutine'
    ```
- **Call Email Program:**
    ```rpg
    c                   call      'AF726R'
    c                   parm                    p_mot1
    ...
    ```
    - Calls the email program with the recipient and message details.

---

### 7. Comments and Documentation

- The program is well-commented in Norwegian, describing purpose, references, and change log.
- Key terms:
    - "Sjekker status p� automatisk oppdatering av EDI - flagger avvik": Checks status of automatic EDI update - flags deviations.
    - "Behandle åpningsopplysninger": Handle opening info.
    - "Er automatisk oppdatering kjørt i dag": Has automatic update run today?
    - "Sjekk at innlesing er kjørt i dag, og at den er avsluttet korrekt": Check that import ran today and finished correctly.

---

## Summary

**Purpose:**  
Checks if the daily automatic EDI update has run and completed correctly for the current firm. If the update is missing or not correct, the program sends an email alert to up to three recipients.

**Customizable points for onboarding:**
- Update file and field names to match your environment.
- Adjust email sending logic or recipient handling as needed.
- Integrate with your existing control frameworks or job scheduling.

**Good onboarding tip:**  
Follow the logic from initialization (`*INZSR`), to file lookup and validation, to possible notification, and finally, clean exit. Study how the notification content is built and handed off to the `AF726R` mail program.
```