# SX905R â€“ Maintenance of Status Log/Transfer to Cobuilder

## Overview

This program, SX905R, is part of the ASSTAT system. Its primary function is to maintain the status log related to data transfers to Cobuilder. It allows users to view, update, and maintain status records, including email notification settings and related metadata. The program also provides functionality to initiate a printout and supports record creation and update tracking.

## File Definitions

- **scobl1**: Input keyed physical file (renamed from `scobpfr` to `scobl1r`). Used to read status records.
- **scoblu**: Update keyed physical file (renamed from `scobpfr` to `scoblur`). Used to update or write new status records.
- **sx905d**: Display file (workstation device). Used for user interaction.

## Data Area and Variables

- **Local Data Area (LDA)**:  
  - `l_user`: User ID (positions 911-920).
  - `l_firm`: Firm number (positions 944-946).
  - `l_fnav`: Firm name (positions 951-980).

- **Working Variables**:  
  - `w_firm`: Firm number (used as key in file operations).
  - `w_dato`: Date variable (for printout routines).
  - `w_inkl`: Inclusion flag (single character, for printout routines).
  - `p_stat`: Status parameter (not used in main logic, possibly for future extension).

## Main Program Flow

### 1. Initialization (`*inzsr`)

- Sets up key lists for both `scobl1` and `scoblu` files, using `w_firm` as the key field.
- Initializes `w_firm` from the local data area (`l_firm`), ensuring all file operations are scoped to the current firm.

### 2. Main Screen Handling (`A1BLD`)

- **Data Retrieval**:  
  Attempts to retrieve the status record for the current firm. If found, fields are loaded into the display buffer (e.g., status, email addresses, subject, text blocks, send flag, creation and update dates/times/user). If not found, display fields are initialized to blanks or zeroes.

- **Display and User Input**:  
  Displays the maintenance screen (`a1bld`). User can:
    - Exit (F3, F12): Sets LR and returns.
    - Start printout (F6): Calls subroutine `xb6win`.
    - Save changes: Proceeds with validation and update logic.

- **Validation**:  
  - Ensures status is either 0 or 1; otherwise, sets error indicator 32.
  - Ensures primary email address is not blank; otherwise, sets error indicator 30.

- **Update Logic**:  
  - Attempts to chain the record in `scoblu` (update file).
  - Updates fields from the display buffer.
  - If record exists:  
    - Updates change date/time/user.
  - If record does not exist:  
    - Initializes firm number, creation date/time/user, and change date/time/user.
    - Writes new record.

### 3. Printout Subroutine (`xb6win`)

- Presents a printout window (`f6win`) for the user to specify a date and inclusion flag.
- Validates date input (indicator 31).
- Calls external program `SX903R` with the specified date and inclusion flag as parameters. This program handles the actual printout of updated and/or marked-for-deletion messages.

### 4. Program Exit (`xslutt`)

- Sets LR indicator to turn off the program and returns.

## Design and Business Logic Notes

- **Firm-Scoped Data**:  
  All status records are handled per firm, as determined by the current session's LDA. This ensures multi-firm support.

- **Audit Trail**:  
  Both creation and last change timestamps and user IDs are maintained for each record, supporting traceability.

- **Display File Conventions**:  
  Error indicators (`*in30`, `*in32`, etc.) are used to provide user feedback for validation errors.

- **External Interactions**:  
  - Calls program `SX903R` for printout functionality, passing date and inclusion flag.
  - No direct Cobuilder API interaction in this program; it only maintains the status/log records that other processes may use for integration.

- **Record Existence Logic**:  
  Uses a dual file approach (`scobl1` for read, `scoblu` for update/write) against the same physical file, a common pattern for separating read-only and update operations in legacy RPG applications.

- **Subroutines**:  
  - `xb6win`: Handles printout window logic and calls printout program.
  - `*inzsr`: Handles program initialization and key setup.

## Key Indicators and Error Handling

- `*inkc`, `*inkl`: Function keys for exit.
- `*inkf`: F6 for printout.
- `*in30`: Error indicator for missing email address.
- `*in32`: Error indicator for invalid status.
- `*in31`: Error indicator for invalid date in printout.

## Summary

SX905R is a maintenance utility for status records related to Cobuilder data transfers, scoped by firm. It provides user-driven updates, validation, and audit tracking, and integrates with a printout routine for message management. The program follows established patterns for file handling, error management, and user interaction within this codebase.