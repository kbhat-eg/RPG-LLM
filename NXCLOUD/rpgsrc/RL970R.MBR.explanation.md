# Overview

This RPG program, titled **"Oppdaterer saldo/kjøp i år"**, is designed to update account balances and purchase data for a specified year. It appears to be part of a financial or inventory system, given the context of saldo (balance) and kjøp (purchase). The program is structured with comments, definitions, and routines, following IBM ILE RPG conventions.

---

# Program Metadata

- **Title**: "Oppdaterer saldo/kjøp i år" (Updates balance/purchase for the year)
- **System**: ASOKON
- **Program ID**: RL970R
- **Description**: Updates account balance and purchase data for a specific year.
- **Version info**: Created in October 1997.
- **Debugging**: `option(*nodebugio)` disables debug I/O, optimizing performance.

---

# Developer Notes & Specialities

- Contains detailed comments about system conventions, including indicator usage (e.g., `KA`, `KC`, `LR`, etc.).
- Indicates the use of function keys:
  - **F1 (KA)**: Select company
  - **F3 (KC)**: Exit
- Indicates other indicators used for various program functions like termination (`LR`), field protection, error handling, and file operations.

---

# Data Definitions

The program defines several data structures and files:

### Workstation and Input Data:
```rpg
frl970d    cf   e             workstn
```
- `frl970d`: The file or device, possibly the output device or screen.
- `cf`: Control specification.
- `e`: End-only indicator.
- `workstn`: The display device or workstation.

### Data Structures:
```rpg
d                uds
d rpraar                300    303  0
d rpsald                         1
d rpkjøp                         1
d rpkjøf                         1
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980
d p_in03          s              1
```
- `rpraar`: Year (possibly a 4-digit string starting at position 300).
- `rpsald`, `rpkjøp`, `rpkjøf`: Related to balances and purchases (likely flags or counters).
- `l_user`, `l_firm`, `l_fnav`: Likely user, firm, or filename references.
- `p_in03`: Parameter input (single character, probably a flag).

---

# Indicator and Screen Management

The program uses screen handling with overlays:

```rpg
/cf   e             workstn
```
- The `e` indicates a screen or format overlay, defining displays and user interaction.

### Screen Formats:

- **`A2BLD`**: Screen for parameter selection, likely a menu or input form.
- **`A2BLD`**: A secondary screen for handling print criteria or detailed options.

### Screen processing:
```rpg
c     a2taga        tag
```
- `a2taga`: Tag for the first screen.
- `a2tagb`: Tag for the second screen.

The screens are cleared or initialized with:

```rpg
c                   eval      *in31 = *off
c                   eval      *in32 = *off
c                   eval      *in33 = *off
```
Disabling protected fields before displaying.

Handling input formats:
```rpg
c                   exfmt     a2bld
```
This awaits user input on the screen `a2bld`.

---

# Main Program Logic

### Initialization:
```rpg
c     *inzsr        begsr
c                   eval      p_in03 = ' '
c                   move      *year         a2raar
c                   move      'N'           a2sald
c                   move      'N'           a2kjøp
c                   move      'N'           a2kjøf
c     *entry        plist
c                   parm                    p_in03
c     *endsr
```
- The subroutine `*inzsr` initializes:
  - Clears the input flag `p_in03`.
  - Sets parameters to default values:
    - `a2raar` (year) is set to current year (`*year` is a system variable).
    - Purchase and balance flags set to `'N'` (possibly "No" or "Not done").

- The main routine takes `p_in03` as a parameter, allowing external control or input.

### Screen Processing:
- The program displays the parameter selection screen with `exfmt`. Based on user input or conditions, it may:
  - Set `*inkc` indicator to on, which triggers immediate exit:
    ```rpg
    if        *inkc = *on
    move      '1'           p_in03
    goto      xslutt
    endif
    ```
  - Otherwise, it proceeds to assign parameters (`a2raar`, `a2sald`, `a2kjøp`, `a2kjøf`) to local variables for processing.

---

# Termination:
```rpg
c     xslutt        tag
c                   eval      *inlr = *on
c                   return
```
- Marks the end of the program (`inlr = *on` turns off the program's scope, releases resources).

---

# Summary

This RPG program is designed to update or manage balance and purchase data for a specific year. It includes a structured user interface with screens for input and selection, and employs indicators for flow control and error handling. The program initializes parameters, displays input screens, handles user responses, and terminates cleanly. Further logic (not shown here) would likely perform the actual update operations based on the input parameters and selected options.
