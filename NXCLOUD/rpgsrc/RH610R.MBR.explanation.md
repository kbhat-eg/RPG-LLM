# RPG Program Explanation: Print Chart of Accounts - Parameter Selection

This RPG program (`RH610R`) is designed to manage the parameter entry screen for printing a chart of accounts ("kontoplan"). It provides a user interface for parameter selection and writes selected values into the LDA (Local Data Area) for use by subsequent processes. The code is written in the traditional, fixed-format ILE RPG style.

---

## 1. Header and Documentation

- **/TITLE**: Title indicating "Print Chart of Accounts - parameter".
- **Program & System Info**: Name, system, description, customization notes.
- **Modification History**: Documented changes with date, description, and author initials.
- **Indicator Usage**: Extensive inline documentation shows which *INxx indicators are reserved for what purposes (e.g., file, subroutines, errors).

---

## 2. File Declarations

```rpg
fausrl1    if   e           k disk        // User file (indexed, external)
frh610d    cf   e             workstn     // Display file (workstation I/O)
```
- `ausrl1`: User master file (used for user-level security/parameters).
- `rh610d`: Display file for user interaction (screen format).

---

## 3. Data Declarations

### From/To Fields for Report Selection

```rpg
d rhpavf                300    303  0     // From department
d rhpavt                         4  0     // To department
d rhpb�f                         4  0     // From cost bearer
d rhpb�t                         4  0     // To cost bearer
d rhpktf                         5  0     // From account number
d rhpktt                         5  0     // To account number
d rhpksp                         1        // Unspecified, probably a flag
d rhpkgs                         1        // Unspecified, probably a flag
d rhpkks                         1        // Unspecified, probably a flag
d rhpsrt                         1        // Sort option
```

### User and Firm Info

```rpg
d l_user                911    920        // User name or ID
d l_firm                944    946  0     // Firm number
d l_fnav                951    980        // Firm name
```

### Working Variables

```rpg
d wpakod          s              2  0     // Utility code, work variable
d p_in03          s              1        // Return code for F3/Exit

d w_firm          s                   like(l_firm)
d w_user          s                   like(l_user)
```

---

## 4. Main Program Flow

The logic is largely implemented via tags and GOTO/IF statements.

### Entry (default control flow branch)

- **dummy tag**: Initial program control point, mainly for clarity or legacy reasons.

#### 4.1 Display Parameter Entry Screen

```rpg
exfmt a2bld
```
- Shows the parameter entry screen (`A2BLD`) to the user for input.

#### 4.2 Function Key Handling

- `*INKC` = *ON (Indicator for F3/Exit):
    - Moves '1' to `p_in03`.
    - GOTO `xslutt` (exit program).

#### 4.3 Parameter Validation

- Checks if "from" values are greater than "to" values for:
    - Department (`a2pavf` > `a2pavt`)
    - Cost bearer (`a2pb�f` > `a2pb�t`)
    - Account number (`a2pktf` > `a2pktt`)
- If invalid, sets the corresponding error indicator (`*IN31`, `*IN33`, `*IN32`), and loops back to the entry screen.

#### 4.4 Write Valid Parameters to LDA

- Moves the entered/adjusted parameter fields to their respective LDA locations for later retrieval.

---

## 5. Program Termination

```rpg
xslutt tag
eval *inlr = *on
return
```
- `*INLR = *ON` signals RPG to close files and exit the program.

---

## 6. Subroutine: Program Initialization (`*INZSR`)

Executed once at program start.

- Initializes working variables and default parameter ranges (from 0 to max, flags set to defaults).
- Reads the user record from `ausrl1` using the current user ID.
    - If user is restricted to a specific department, sets the parameters accordingly and flags input fields as protected (`*IN30 = *ON`).
- Sets up the parameter list for program call (e.g., `p_in03`).

### Key List for User File Read

```rpg
ausrl1_key klist
    kfld w_user
```
Used for indexed access to the user file.

---

## 7. Screen and Display File

- The screen `A2BLD` (`a2bld` record format) allows entry/selection of print criteria.
- The EXFMT operation reads/writes the fields defined in this record format.

---

# Summary

**In Essence**:  
This program mediates user entry of report selection criteria for printing the chart of accounts, ensures values are in valid ranges, and saves the parameters for downstream use. It includes robust field validation, firm/user initialization, key handling (especially for F3/Exit), and error indicator signaling to guide user correction of invalid input.

**Key Takeaways:**
- Uses indicators for error and control handling.
- Moves validated parameters into LDA.
- Leverages a display file for user entry and feedback.
- Has clear inline documentation for maintainability.
- Implements program initialization logic to pre-load and protect values based on user profile.

This program is typical of tightly-coupled, screen-driven RPG applications that rely on *INxx indicators, physical display files, and parameter passing via LDA or PLIST.