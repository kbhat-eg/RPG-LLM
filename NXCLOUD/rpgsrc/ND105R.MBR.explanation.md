## Overview
This RPG program (ND105R) verifies the validity of an external order line based on several business rules regarding item, quantity, unit of measure, delivery type, and delivery date. If there is a violation of any rule, a status code (p_stat) is assigned and control is passed back to the caller. If all validation checks pass, p_stat remains 0. The program is closely tied to the business concept of “lagerstyring” (warehouse management) as well as references to external systems such as “Winner” (detected by p_fsys = 'WIN').

## Purpose
1. **Validate external order lines** against:
   - Item existence.
   - Non-zero quantity.
   - Valid unit of measure.
   - Valid delivery type.
   - Delivery date not in the past.
   - Warehouse item requirements (when system uses warehouse management).

2. **Set an error status code** (p_stat) if a rule fails, or keep it at zero if the order line is valid.

3. **Integrate with multiple files** to cross-check details:
   - VVARL1 (items)
   - VVENL1 (item-unit of measure mappings)
   - VLTPL1 (delivery types)
   - VLAGL1 (warehouse items)
   - FSTSL1 (additional code register, if needed)

## Program Flow
1. **Initialize** (p_stat = 0).
2. **Check optional text-only line**:  
   - If p_vare (item) is blank but p_tek1 (item text) is not, skip the rest of checks and end.
3. **Check for required item number (p_vare)**:  
   - If blank or not found in VVARL1, set p_stat = 1 and exit.
4. **Check quantity (p_anta)**:  
   - Must be greater than zero; otherwise p_stat = 2.
5. **Check unit of measure (p_enhe)**:  
   - Must exist in VVENL1 for the given item and must be flagged as a valid sales unit (vesaen ≠ 0). Otherwise p_stat = 3.
6. **Check delivery type (p_lety)**:  
   - If present (p_lety ≠ 0), verify it exists in VLTPL1. Otherwise p_stat = 5.
7. **Check delivery date (p_ldat)**:  
   - If provided (p_ldat <> *loval), it cannot be earlier than the current date. Otherwise p_stat = 6.
8. **Warehouse Item Logic** (only if necessary):  
   - If the system is not “WIN” (p_fsys <> 'WIN') and the company has “lagerstyring” (faalag = 1):
     1. Chain to VLAGL1.  
     2. Reject the item if it is not of a proper type (L, S, T). Otherwise p_stat = 8.  
   - If “lagerstyring” is off, verify the base item type (vvvtyp) is valid (again L, S, T). Otherwise p_stat = 8.
9. **End**:  
   - If no failures, p_stat remains 0.  
   - The program returns to the caller with *INLR = *ON.

## File Interactions
1. **VVARL1** (via vvarl1):  
   - Confirms the existence or definition of the item.  
   - Accessed using a key list (vvarl1_key) that includes the firm (w_firm) and item (vvarl1_vare).
2. **VVENL1** (via vvenl1):  
   - Validates the combination of item and unit of measure.  
   - Key list (vvenl1_key) includes firm, item, and unit.
3. **VLTPL1** (via vltpl1):  
   - Confirms the delivery type is valid.  
   - Key list (vltpl1_key) includes firm and delivery type (vltpl1_lety).
4. **VLAGL1** (via vlagl1):  
   - Checks warehouse details, item type, and whether an item is properly flagged for this warehouse.  
   - Key list (vlagl1_key) includes firm, item, and warehouse (p_lage).
5. **FSTSL1** (via fstsl1):  
   - Potentially retrieves additional code-related information based on the firm.

## Parameter List
- p_firm (company ID)
- p_stat (status code returned by the program; 0 if no error)
- p_lage (warehouse code, used if warehouse management is active)
- p_vare (item number)
- p_tek1 (item text or description)
- p_anta (quantity)
- p_enhe (unit of measure)
- p_lety (delivery type)
- p_ldat (delivery date)
- p_fsys (system type or source, e.g. 'WIN' for Winner)

## Notable Details
- The program uses a series of “chain” operations to validate keyed records in the respective files.  
- The code uses version-marked enhancements (e.g., 6.31, 6.32, 7.01) to reflect added logic, especially around warehouse checks and external system overrides (p_fsys = 'WIN').  
- Items are considered valid warehouse items if their types are among L, S, or T.  
- The code strictly enforces date validation only if p_ldat is provided (not *loval).  
- The user area at the top (l_user, l_fnav) is not directly used in this logic but is reserved for potential external references.  
- Setting *INLR = *ON ends the program and frees resources.

## Summary
ND105R centralizes the validation for external order lines in the ASOFAK system. It checks multiple data points—item existence, quantity, unit of measure, delivery type, date validity, and warehouse status—to ensure that only valid and consistent order lines enter downstream processes. If any of the validation checks fail, an appropriate error code is set (through p_stat) to inform the calling application about the issue. This design separates data validation from other business logic, allowing standardized checks that can be updated and maintained independently in one place.