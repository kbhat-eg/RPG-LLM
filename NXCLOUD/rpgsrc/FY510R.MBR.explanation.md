# Explanation of the RPG Program: FY510R

---

## Overview

This RPG program (FY510R) is designed to **display details for deleted orders** ("Slettede ordre, vise") within a system called ASOFAK. The program retrieves information about deleted orders from an 'ordre-slettet' (deleted orders) table and customer information from a customer table, then displays it on a workstation screen.

---

## File Declarations

```rpg
ffdell1    if   e           k disk    rename(fdelpfr:fdell1r)
frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
ffy510d    cf   e             workstn
```
- **fdell1**: Deleted Orders table (physical file)
- **rkunl1**: Customer table (physical file)
- **fy510d**: Workstation display file for user interaction

---

## Variable Declarations

### Local Data Area (LDA)
These variables extract fields from LDA:
- `l_wsid`: Workstation ID
- `l_user`: User ID
- `l_firm`: Firm number

### Program Parameters (from previous program)
- `p_firm`, `p_aarr`, `p_numm`, `p_suff`: Firm, year, order number, suffix

### Key Variables
- Used for chaining to fdell1 and rkunl1:
    - `fdell1_aarr`, `fdell1_numm`, `fdell1_suff`
    - `rkunl1_kund`

### Other Variables
- `w_firm`: Current firm (from LDA)

---

## Main Program Logic

### 1. Initialize Display Fields

```rpg
c                   eval      a1kund = 0
c                   eval      a1dumy = *blank
... (etc.) ...
```
All display fields are initialized (customer, address, name, etc.).

---

### 2. Retrieve Deleted Order Details

- The program sets up the composite key (`fdell1_aarr`, `fdell1_numm`, `fdell1_suff`) from program parameters.
- It chains into **fdell1r** (deleted orders record format).

```rpg
c     fdell1_key    chain     fdell1r                            90
```
- If record found (`*in90 = *off`), retrieves order details (date, time, customer, sales, reference, etc.), and loads them into display variables.
- Date and time fields are validated against 'low value' before moving.

---

### 3. Retrieve Customer Details

- Sets up the key (`rkunl1_kund`) and chains into **rkunl1r** (customer record format):

```rpg
c     rkunl1_key    chain     rkunl1r                            91
```
- If found (`*in91 = *off`), loads customer name, address, and location into display fields.

---

### 4. Display Screen and Handle Exit

- The program displays the screen, then checks if the exit key was pressed (`*INKC`). If so, it exits the program.

```rpg
c                   exfmt     a1bld    // Display and accept from screen
c                   if        *inkc    // If exit function key pressed
c                   goto      xslutt
c                   endif
```

---

### 5. Program End

- Sets LR (last record) indicator to on, causing program end and cleanup.

---

## Subroutines

### *INZSR â€” Initialization Subroutine

- Defines key lists for chaining:
    - **fdell1_key**: for deleted order (firm, year, number, suffix)
    - **rkunl1_key**: for customer (firm, customer number)

- Loads parameters from the previous program and LDA.

```rpg
c     *entry        plist
c                   parm                    p_firm
c                   parm                    p_aarr
c                   parm                    p_numm
c                   parm                    p_suff
c                   eval      w_firm      = l_firm
```

---

## Use of Indicators

From the comments:
- `LR`: End program
- `30`: Protect fields on view
- `31-79`: Error messages and screen indicators
- `80-89`: Work indicators
- `90-99`: File indicators (e.g., after chain operations)

---

## Summary of Flow

1. **Parameter & LDA initialization** (via *INZSR).
2. **Read deleted order** from fdell1 using composite key.
3. **If order found**, load details to screen variables.
4. **Read customer** from rkunl1 if customer number found.
5. **Display results** on workstation.
6. **Exit** gracefully on user request.

---

## Key Points

- The program is *inquiry only*: it presents data, does not update.
- It is modular, with clear separation of data retrieval and display.
- Data integrity is checked (e.g., only move dates/times if they're valid).
- The code uses Norwegian business terminology (`slettede`, `kunde`, `ordre`).

---

### If you need further details about a specific section or variable, just ask!