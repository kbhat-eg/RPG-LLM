     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASVADM
      * Program . . . . : JV750R
      * Beskrivelse . . : Vare, henter priser og DG
      *
      * NB! NB! NB! NB!  Hardkodet moms på 25 %
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       220197 HKO  Nytt program
      *       130697 HKO  Lagt inn PSSR-rutine for feilhåndtering. Dersom
      *                   denne slår til settes P_OSTS til 9
      *       081297 HKO  Lagt inn avrunding av salgspris inkl. mva
      *                   Endret program i.h.t. ny standard
      *       300398 HKO  Prisgivende leverandør som input-parameter.
      *       030698 HKO  Databaseendring:
      *                   Utvidet omregningsfaktorer fra 7:4 til 10:4
      *       170698 HKO  Tilpasset ny datamodell for betingelser
      *       251098 HKO  Beregner kostpris og innkjøpspris i.h.t.
      *                   omregningsfaktor volum og ikke -pris.
      *                   Returnerer omregningsfaktor pris for alle enheter
      *                   i forhold til omregningsfaktor enhet-1.
      *                   Fortsetter å hente informasjon selv om betingelse
      *                   eller påslagsfaktorer mangler.
      *       090399 HKO  Setter statuskode til 8 dersom vare er valgt
      *                   utelatt fra oppdatering i EVR
      *       191299 HKO  Lagt inn test på at statistikkenhet og lagerenhet
      *                   finnes på varen
      *       161100 HKO  Lagt inn test på at varegruppe finnes
      *       171202 HKO  Benytter rekkefølgen på enhetene i Nobb/LVR dersom
      *                   varepakning ikke er valgt
      *       110202 HKO  Tar hensyn til aktivisering av rabattelement
      *       101202 HKO  Lagt inn grossistløsning
      *       060903 HKO  Henter innkjøpsenheter og prisbokenheter
      *       181003 HKO  Lagt inn modul som nivå under påslag, og tillatt
      *                   leverandør uten varegruppe som et nivå
      *       161103 HKO  Fjernet behandling av rabattgruppe
      *                   Endret feilstatus 7 til 6
      *       070504 HKO  Fjernet logikken som leter etter betingelse på
      *                   vareeier dersom betingelse ikke ble funnet på
      *                   prisgiver
      *       010704 HKO  Dersom prisbokenhet ikke er valgt returneres
      *                   prisbokenhet som første salgsenhet og ikke som
      *                   Nobb prisenhet.
      *       100605 HKO  Utvidet parameterlisten med leveringstype,
      *                   priskode og skaffekode (varetype) som
      *                   input-parameter og med varetype og leveringstype
      *                   fra påslag og betingelse som output-parameter.
      *                   Fjernet priskode og skaffekode fra output-
      *                   paramteter.
      *                   Endret logikk for å finne påslag og betingelse.
      *       090805 HKO  Fjernet vekt og volum fra parameterlisten
      *       100805 HKO  Lagt inn omregningsfaktor for innkjøpsenheter
      *                   i forhold til salgsenhet-1 inn i parameterlisten
      *       130905 HKO  Fjernet holde-kode som paramter
      *       150905 HKO  Lagt inn kalkulering av salgspris fra Nobbpris
      *       180406 HKO  Rettet feil ved oppslag på påslag
      *       290208 bof  utvidet nøkkel på jforpf
      *       280508 bof  Henter gml.Nobbpris hvis dette er bedt om i param.
5.60  *       200808 bof  Ny sts. 7 - hvis dekn <= 0
5.70  * PRGR  171108 bof  Utvidet med prisgruppe
6.10  *       250809 bof  Fjernet 000 fra pakning, ligger på vvarpf
      *                   Endret status til Alfa-num, 2 ny status
6.11  *       280909 bof  henter best.bar fra jvpppf istf. jvpkpf
6.12  *       241109 bof  Lagt inn ny status, hvis gtin finnes på annen vare
6.13  *       241109 bof  Ny status O, hvis omr.fakt på enhet forskj.VA/EVR
6.14  *       120510 bof  Utvidet omr.faktor. Hvis den er over 999999,99 så gis
6.14  *                   det status. Vi tar vare på slik store omr.faktorer fra
6.14  *                   nobb, men behandler foreløbig ikke videre i EVR
6.15  *       200810 bof  justert feil vedr. kalkyle fra nobb
6.16  *       211110 bof  Hvis skaffevare,sjekk EVR om vtype = 'L' feilm.
6.17  *       201210 bof  Skal kun bli sts=U hvis utg.dato har passert
6.18  *       090811 bof  Feilretting vedr. status lik E
6.19  *       140212 bof  Hvis lev.varenr blank på pris så brukes varens
6.21  *       040511 bof  Valg på enhetsrekkefølge, nytt Nobb enhetsrekkef.
6.22  *       050511 bof  Utvidet med Salgspris skal hentes fra hoved.lev.
6.23  *       030112 bof  vedr.6.21 pris.s.enhet må takles.
6.24  *       290513 bof  Ekstra sjekk at ikke det flere like enh1-3
6.25  *       191113 bof  NOBB enhetsrekkf. men også pakningsreg.-sjekk.
6.26  *       260914 bof  Hvis pris har passert til dato, så status 4
6.30  * 6.30  110214 sst  Psykologiske priser for Byggmakker 'PSY'
6.31  * 6.30  120214 bof  Justering vedr. å trekke ut mva. + variabl.i parm
6.32  * 6.30  140214 bof  Ikke psyk pris når lev. kalkurerer fra nobbpris
6.33  * 6.30  050414 bof  Utvidet nøkkel i vare-pris med leverandør
6.34  * 6.30  050414 bof  Fjernet jvpppf
6.35  * 6.30  140314 bof  Lagt inn test på fra /til dato på pakning
6.36  * 6.30  270314 bof  test om varepris VA er utgått
6.37  * 6.30  220414 sst  Endret leverandør vedr psyk. priser
6.38  * 6.30  140714 bof  Utvidet parm. prisdato og "ta med utg.priser"
6.38a *       240315 bof  Nye parametre på avrunding.
6.39a *       170415 bof  feilretting vedr. nye parm. avrunding
6.39  * 6.30  160714 bof  Lev.varenr fra JLLEPF istedet for JVPRPF
6.3a  * 6.30  170714 bof  Fraktpåslag beregning, på prisenhet
6.3x  * 6.30  310515 bof  Utvidet med prisgruppe
6.3y  * 6.30  310515 bof  Utvidet med prisgruppe, forskjellig behandling
6.3y  *                   ved oppdatering og visning.
6.3b  * 6.30  201015 bof  Rettelser vedr. frakt og omregningsfaktor
6.3c  * 6.30  281015 bof  Mer rettelse på frakt og omregning
6.3d  * 6.30  080116 bof  Feilretting vedr. innk.enh rekkefølge
6.3e  * 6.30  260216 bof  Feilretting vedr. frakt og omregning II
6.3f  * 6.30  020316 bof  Feilretting vedr. avrund (spes.små beløp)
6.3g  * 6.30  240616 bof  Feilretting vedr. innkj.enhet 2 og 3
6.3h  * 6.30  010816 bof  Sjekker at betingelse er innenfor fra/til dato
6.3i  * 6.30  020816 bof  Feilretting vedr. test på til prisdato.
6.3j  * 6.30  241116 bof  Stat H kan bare gis hvis vare i EVR
6.3k  * 6.30  241116 bof  Endret på test negativ dekning, godkj. 0 i db
6.3l  * 6.30  310317 bof  Feilretting vedr. tildato på pris
6.3m  * 6.30  071117 bof  Ny status, test mot enhet i best./ordre
6.3n  * 6.30  191117 bof  Stat Y, kun hvis vare er i EVR
6.3o  * 6.30  150318 bof  Feilretting vedr. beholde salgspris
6.3p  * 6.30  220518 bof  Ta hensyn til Valuta ved beregning av pris
6.3q  * 6.30  140918 bof  Utvidet med logistikk-vare
6.3r  * 6.30  191118 bof  Feilreting påslag vedr. tls
6.3s  * 6.30  201218 bkv  Henter utgår fra JVLE (var JVAR)
6.3t  * 6.30  250319 bof  Hvis salgspris hentes fra hovedlev.ikke avrund
      *
7.01  *       090919 bof  Fjernet status Y (6.3n)
7.02  *K00    290420 bof  Endret på prisbokrekkefølge NXS-1061
7.03  *K00    250820 bof  Endringsønsker - nytt nivå + TPAK
7.04  *       190421 bof  Utvidet bruk av JCSPHL - også kostpris fra h.lev (swit
7.02b *       310521 bof  hoved.lev . pris bruk dato inn.
7.05  *       280521 bof  Feil ved setting av pben2 og 3
7.06  *       120821 bof  Hvis log.vare og ikke hovedpr.g så ikke sjekk stat.enh
7.07  *       270921 bof  Hvis påslag JCSPHL =1el.2, så bruke samme logikk
      *
8.01  *       130223 bof  Feilretting vedr. frakt fra /til dato
8.02  *PRG2   150622 bof  Utvidet prisgruppe fra 1 til 2 posisjoner
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fjvarl1    if   e           k disk    rename(jvarpfr:jvarl1r)
     fjvprl1    if   e           k disk    rename(jvprpfr:jvprl1r)
     fjvpkl1    if   e           k disk    rename(jvpkpfr:jvpkl1r)
     fjvpglr    if   e           k disk    rename(jvpgpfr:jvpglrr)
     fjforl5    if   e           k disk    rename(jforpfr:jforl5r)
     fjforl1    if   e           k disk    rename(jforpfr:jforl1r)
     fjbetlb    if   e           k disk    rename(jbetpfr:jbetlbr)
     fjbetlc    if   e           k disk    rename(jbetpfr:jbetlcr)
     fjbetl1    if   e           k disk    rename(jbetpfr:jbetl1r)
     fjrael1    if   e           k disk    rename(jraepfr:jrael1r)
     fjrael4    if   e           k disk    rename(jraepfr:jrael4r)
     fjpfala    if   e           k disk    rename(jpfapfr:jpfalar)
     fjpfalb    if   e           k disk    rename(jpfapfr:jpfalbr)
     fjpfal1    if   e           k disk    rename(jpfapfr:jpfal1r)
     fjwprl1    if   e           k disk    rename(jwprpfr:jwprl1r)
     fjlevl1    if   e           k disk    rename(jlevpfr:jlevl1r)
6.15 fjlevlr    if   e           k disk    rename(jlevpfr:jlevlrr)
6.15 f                                     prefix(yl:2)
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fvvenl1    if   e           k disk    rename(vvenpfr:vvenl1r)
     fvugrl1    if   e           k disk    rename(vugrpfr:vugrl1r)
6.16 fvlagl1    if   e           k disk    rename(vlagpfr:vlagl1r)
6.16 fjvdtl1    if   e           k disk    rename(jvdtpfr:jvdtl1r)
6.21 fjstsl1    if   e           k disk    rename(jstspfr:jstsl1r)
6.39 fjvlelr    if   e           k disk    rename(jvlepfr:jvlelrr)
6.3a fjfbelb    if   e           k disk    rename(jfbepfr:jfbelbr)
6.3a fjfbelc    if   e           k disk    rename(jfbepfr:jfbelcr)
6.3a fjfbel1    if   e           k disk    rename(jfbepfr:jfbel1r)
6.3m ffodtlv    if   e           k disk    rename(fodtpfr:fodtlvr)
6.3m flodtlv    if   e           k disk    rename(lodtpfr:lodtlvr)
6.3p fra16l1    if   e           k disk    rename(ra16pfr:ra16l1r)
      *
      * Definering av Local data area
      *
     d lda            uds
7.00 d l_filg                931    933
      *
      * Definering av parametre
      *
     d p_pkod          s              1
     d p_skod          s              1  0
6.10 d p_osts          s              1
     d p_ntpr          s              9  2
     d p_ifak          s              8  6
     d p_midl          s              1  0
     d p_inpr          s              9  2
     d p_kopr          s              9  2
     d p_s1pr          s              9  2
     d p_s1im          s              9  2
     d p_s2pr          s              9  2
     d p_s2im          s              9  2
     d p_s3pr          s              9  2
     d p_s3im          s              9  2
     d p_dekn          s              5  2
     d p_eldo          s              6  0
     d p_ofp1          s             12  6
     d p_ofp2          s             12  6
     d p_ofp3          s             12  6
     d p_ofv2          s             12  6
     d p_ofv3          s             12  6
     d p_ofi1          s             12  6
     d p_ofi2          s             12  6
     d p_ofi3          s             12  6
      *
     d p_firm          s              3  0
     d p_vare          s                   like(jvvare)
     d p_pgiv          s                   like(jxldor)
     d p_lety          s                   like(jclety)
5.70 d p_prgr          s                   like(jcprgr)
     d p_gprk          s              1  0
6.38 d p_dato          s               d   datfmt(*iso)
6.38 d p_utgp          s              1  0
     d p_ldor          s                   like(jxldor)
6.39 d p_lvar          s                   like(jvllva)
     d p_nopr          s                   like(jxpris)
     d p_gdat          s                   like(jxgdat)
     d p_enhe          s                   like(jwenhe)
     d p_enh1          s                   like(jzenh1)
     d p_enh2          s                   like(jzenh2)
     d p_enh3          s                   like(jzenh3)
     d p_eni1          s                   like(jzeni1)
     d p_eni2          s                   like(jzeni2)
     d p_eni3          s                   like(jzeni3)
     d p_enp1          s                   like(jzenp1)
     d p_enp2          s                   like(jzenp2)
     d p_enp3          s                   like(jzenp3)
     d p_bldo          s                   like(jpldor)
     d p_bogr          s                   like(jpogrp)
     d p_bhgr          s                   like(jphgrp)
     d p_bugr          s                   like(jpugrp)
     d p_bmod          s                   like(jpmodn)
     d p_bvar          s                   like(jpvare)
     d p_bvty          s                   like(jpvtyp)
     d p_blet          s                   like(jplety)
     d p_bbet          s                   like(jpbeti)
     d p_pogr          s                   like(jcogrp)
     d p_phgr          s                   like(jchgrp)
     d p_pugr          s                   like(jcugrp)
     d p_pldo          s                   like(jcldor)
     d p_pmod          s                   like(jcmodn)
     d p_pvar          s                   like(jcvare)
     d p_ppko          s                   like(jckpri)
     d p_pvty          s                   like(jcvtyp)
     d p_plet          s                   like(jclety)
     d p_kfak          s                   like(jckofa)
     d p_kbel          s                   like(jckobe)
     d p_sfak          s                   like(jcsafa)
5.70 d p_prut          s                   like(jcprgr)
6.3x d p_pgbe          s                   like(jcprgr)
6.3y d p_pgfr          s                   like(jcprgr)
6.3y d p_oppd          s              1
s.ss d p_avrund        s              3
6.38ad p_type          s              1  0
6.3a d p_ffak          s              8  6
6.3a d p_inp2          s              9  2
6.3y d w_osts          s              1
      *
      * Definering av variabler i nøkler
      *
     d jvarl1_vare     s                   like(jvvare)
     d jvprl1_vare     s                   like(jxvare)
     d jvprl1_ldor     s                   like(jxldor)
     d jvpkl1_vare     s                   like(jwvare)
6.33 d jvpkl1_ldor     s                   like(jwldor)
     d jvpglr_vare     s                   like(jwgvar)
     d jforl5_vare     s                   like(jzvare)
     d jforl1_ogrp     s                   like(jzogrp)
     d jforl1_hgrp     s                   like(jzhgrp)
     d jforl1_ugrp     s                   like(jzugrp)
     d jforl1_ldor     s                   like(jzldor)
     d jforl1_modn     s                   like(jzmodn)
     d jforl1_vare     s                   like(jzvare)
     d jbetlb_ldor     s                   like(jpldor)
     d jbetlb_vare     s                   like(jpvare)
6.3x d jbetlb_prgr     s                   like(jpprgr)
     d jbetlb_vtyp     s                   like(jpvtyp)
     d jbetlb_lety     s                   like(jplety)
     d jbetlc_ldor     s                   like(jpldor)
     d jbetlc_modn     s                   like(jpmodn)
     d jbetlc_vare     s                   like(jpvare)
6.3x d jbetlc_prgr     s                   like(jpprgr)
     d jbetlc_vtyp     s                   like(jpvtyp)
     d jbetlc_lety     s                   like(jplety)
     d jbetl1_ldor     s                   like(jpldor)
6.3x d jbetl1_prgr     s                   like(jpprgr)
     d jbetl1_ogrp     s                   like(jpogrp)
     d jbetl1_hgrp     s                   like(jphgrp)
     d jbetl1_ugrp     s                   like(jpugrp)
     d jbetl1_modn     s                   like(jpmodn)
     d jbetl1_vare     s                   like(jpvare)
     d jbetl1_vtyp     s                   like(jpvtyp)
     d jbetl1_lety     s                   like(jplety)
     d jrael1_eldo     s                   like(jpeldo)
6.3x d jrael1_eprg     s                   like(jpeprg)
     d jrael1_eogr     s                   like(jpeogr)
     d jrael1_ehgr     s                   like(jpehgr)
     d jrael1_eugr     s                   like(jpeugr)
     d jrael1_emod     s                   like(jpemod)
     d jrael1_evar     s                   like(jpevar)
     d jrael1_evty     s                   like(jpevty)
     d jrael1_elet     s                   like(jpelet)
     d jrael1_ebrs     s                   like(jpebrs)
     d jrael1_ebli     s                   like(jpebli)
     d jrael4_eldo     s                   like(jpeldo)
     d jrael4_eprg     s                   like(jpeprg)
     d jrael4_eogr     s                   like(jpeogr)
     d jrael4_ehgr     s                   like(jpehgr)
     d jrael4_eugr     s                   like(jpeugr)
     d jrael4_emod     s                   like(jpemod)
     d jrael4_evar     s                   like(jpevar)
     d jrael4_evty     s                   like(jpevty)
     d jrael4_elet     s                   like(jpelet)
     d jrael4_ebrs     s                   like(jpebrs)
     d jrael4_ebli     s                   like(jpebli)
     d jrael4_eakt     s                   like(jpeakt)
6.3a d jfbelb_fldo     s                   like(jpfldo)
6.3a d jfbelb_fvar     s                   like(jpfvar)
6.3x d jfbelb_fprg     s                   like(jpfprg)
6.3a d jfbelb_fvty     s                   like(jpfvty)
6.3a d jfbelb_flet     s                   like(jpflet)
6.3a d jfbelc_fldo     s                   like(jpfldo)
6.3a d jfbelc_fmod     s                   like(jpfmod)
6.3a d jfbelc_fvar     s                   like(jpfvar)
6.3x d jfbelc_fprg     s                   like(jpfprg)
6.3a d jfbelc_fvty     s                   like(jpfvty)
6.3a d jfbelc_flet     s                   like(jpflet)
6.3a d jfbel1_fldo     s                   like(jpfldo)
6.3x d jfbel1_fprg     s                   like(jpfprg)
6.3a d jfbel1_fogr     s                   like(jpfogr)
6.3a d jfbel1_fhgr     s                   like(jpfhgr)
6.3a d jfbel1_fugr     s                   like(jpfugr)
6.3a d jfbel1_fmod     s                   like(jpfmod)
6.3a d jfbel1_fvar     s                   like(jpfvar)
6.3a d jfbel1_fvty     s                   like(jpfvty)
6.3a d jfbel1_flet     s                   like(jpflet)
     d jpfala_vare     s                   like(jcvare)
5.70 d jpfala_prgr     s                   like(jcprgr)
     d jpfala_ldor     s                   like(jcldor)
     d jpfala_kpri     s                   like(jckpri)
     d jpfala_vtyp     s                   like(jcvtyp)
     d jpfala_lety     s                   like(jclety)
     d jpfalb_modn     s                   like(jcmodn)
     d jpfalb_ldor     s                   like(jcldor)
     d jpfalb_vare     s                   like(jcvare)
5.70 d jpfalb_prgr     s                   like(jcprgr)
     d jpfalb_kpri     s                   like(jckpri)
     d jpfalb_vtyp     s                   like(jcvtyp)
     d jpfalb_lety     s                   like(jclety)
5.70 d jpfal1_prgr     s                   like(jcprgr)
     d jpfal1_ogrp     s                   like(jcogrp)
     d jpfal1_hgrp     s                   like(jchgrp)
     d jpfal1_ugrp     s                   like(jcugrp)
     d jpfal1_ldor     s                   like(jcldor)
     d jpfal1_modn     s                   like(jcmodn)
     d jpfal1_vare     s                   like(jcvare)
     d jpfal1_kpri     s                   like(jckpri)
     d jpfal1_vtyp     s                   like(jcvtyp)
     d jpfal1_lety     s                   like(jclety)
     d jwprl1_vare     s                   like(jbvare)
     d jlevl1_ldor     s                   like(jlldor)
6.15 d jlevlr_ldor     s                   like(jlldor)
     d vvarl1_vare     s                   like(vvvare)
     d vvenl1_vare     s                   like(vevare)
     d vvenl1_enhe     s                   like(veenhe)
     d vugrl1_uogr     s                   like(vguogr)
     d vugrl1_uhgr     s                   like(vguhgr)
     d vugrl1_uugr     s                   like(vguugr)
6.16 d vlagl1_vare     s                   like(vlvare)
6.16 d jvdtl1_dvar     s                   like(jvdvar)
6.39 d jvlelr_lldo     s                   like(jvlldo)
6.39 d jvlelr_lvnr     s                   like(jvlvnr)
6.3m d fodtlv_vare     s                   like(fdvare)
6.3m d lodtlv_vare     s                   like(fdvare)
6.3p d ra16l1_pkod     s                   like(rapkod)
      *
      * Definering av variable
      *
     d b_akti          s              1    inz(*off)
5.70 d b_pasl          s              1    inz(*off)
6.21 d b_penh          s              1    inz(*off)
6.21 d b_peok          s              1    inz(*off)
6.23 d b_psen          s              1    inz(*off)
6.35 d b_pakn          s              1    inz(*off)
6.3x d b_beti          s              1    inz(*off)
6.3x d b_frak          s              1    inz(*off)
6.3h d b_bdat          s              1    inz(*off)
6.3m d b_orbe          s              1    inz(*off)
6.3q d b_logv          s              1    inz(*off)
7.02 d b_prib          s              1    inz(*off)
7.04 d b_inlr          s              1    inz(*off)
      *
     d w_firm          s              3  0
     d w_mva           s              2  0
     d w_kode          s              1  0
     d w_tell          s              3  0
     d w_vtyp          s              1
6.12 d w_gvar          s                   like(jvvare)
6.12 d w_genh          s                   like(jvpenh)
6.12 d w_gsta          s              1
6.17 d w_udat          s                   like(jvudat)
      *
     d w_ofp1          s                   like(jwofap)
     d w_ofp2          s                   like(jwofap)
     d w_ofp3          s                   like(jwofap)
     d w_ofv1          s                   like(jwofak)
     d w_ofv2          s                   like(jwofak)
     d w_ofv3          s                   like(jwofak)
     d w_ofi1          s                   like(jwofak)
     d w_ofi2          s                   like(jwofak)
     d w_ofi3          s                   like(jwofak)
6.38ad w_ofx1          s                   like(jwofap)
6.38ad w_ofx2          s                   like(jwofap)
6.38ad w_ofx3          s                   like(jwofap)
6.3y d w_ofz1          s                   like(jwofak)
      *
6.21 d w_enh1          s                   like(jwenhe)
6.21 d w_enh2          s                   like(jwenhe)
6.21 d w_enh3          s                   like(jwenhe)
6.21 d w_eni1          s                   like(jwenhe)
6.21 d w_eni2          s                   like(jwenhe)
6.21 d w_eni3          s                   like(jwenhe)
6.21 d w_enh4          s                   like(jwenhe)
6.21 d w_enh5          s                   like(jwenhe)
6.21 d w_pak1          s                   like(jwpakn)
6.21 d w_pak2          s                   like(jwpakn)
6.21 d w_pak3          s                   like(jwpakn)
6.21 d w_pak4          s                   like(jwpakn)
6.21 d w_pak5          s                   like(jwpakn)
6.21 d w_pakp          s                   like(jwpakn)
6.21 d w_penh          s                   like(jwenhe)
6.21 d w_pakn          s                   like(jwpakn)
6.23 d w_psen          s                   like(jwenhe)
6.23 d w_pspa          s                   like(jwpakn)
7.02 d w_psenx         s                   like(jwenhe)
7.02 d w_pklaf         s                   like(jwenhe)
7.02 d w_pklad         s                   like(jwenhe)
7.02 d w_pklat         s                   like(jwenhe)
7.03 d w_m2enh         s                   like(jwenhe)
      *
6.22 d w_enhe          s                   like(jwenhe)
6.22 d w_dato          s                   like(vvedat)
6.22 d w_s1pr          s              9  2
6.22 d w_retk          s              1
6.31 d w_mvap          s              6  2
6.31 d w_mvat          s              5  4
6.31 d w_mvaf          s             10  9
6.31 d w_ogrp          s                   like(jpogrp)
6.31 d w_hgrp          s                   like(jphgrp)
6.31 d w_ugrp          s                   like(jpugrp)
6.31 d w_ldor          s                   like(jpldor)
6.31 d w_modn          s                   like(jpmodn)
6.3a d w_fkrt          s                   like(jpfkrt)
6.3a d w_fprt          s                   like(jpfprt)
6.3a d w_fton          s                   like(jpfton)
6.3a d w_fkub          s                   like(jpfkub)
6.3a d w_vekt          s             15  6
6.3a d w_volu          s             11  7
6.3a d w_vekx          s                   like(jwvekt)
6.3a d w_volx          s                   like(jwvolu)
6.3p d w_kurs          s                   like(rapmku)
6.3q d w_vare          s                   like(jvvare)
6.3q d w_modnx         s                   like(jvmodn)
6.3q d w_lv_vare       s                   like(jvvare)
6.3q d w_lv_modn       s                   like(jvmodn)
6.3q d w_lv_kldo       s                   like(jvldor)
6.3q d w_lv_nobb       s                   like(jvnobb)
6.3q d w_lv_ofak       s                   like(jwofak)
7.04 d w_hlev          s              1  0
7.04 d w_bupr          s              9  2
7.04 d w_inpr          s              9  2
7.04 d w_inpr2         s              9  2
7.04 d w_kopr          s              9  2
      *
7.00   dcl-s co402_verdi1  char(1);
7.00   dcl-s co402_verdi2  char(2048);
7.00   DCL-PR CO402R EXTPGM('CO402R');
7.00     p_filgrp            char(3)     const;
7.00     p_firm              packed(3:0) const;
7.00     p_lager             packed(2:0) const;
7.00     p_nokkel            char(50)    const;
7.00     p_verdi1            char(1);
7.00     p_verdi2            char(2048);
7.00   END-PR;
7.01 d u_701           s              1    inz(*off)
      *
6.3q C/Exec SQL
6.3q C+  Set Option DatFmt=*ISO, DlyPrp=*YES, SRTSEQ=*LANGIDUNQ, LANGID=NOR
6.3q C/End-Exec
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedrutine
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   eval      jvarl1_vare = p_vare
     c     jvarl1_key    chain     jvarl1
      *
      * Vare ble ikke funnet
      *
     c                   if        not %found
6.10 c                   eval      p_osts = '9'
     c                   goto      avslutt
     c                   endif
      *
      * Sjekker varegruppe
      *
     c                   if        jvogrp = 0 or
     c                             jvhgrp = 0 or
     c                             jvugrp = 0
6.10 c                   eval      p_osts = '1'
     c                   goto      avslutt
     c                   endif
      *
     c                   eval      vugrl1_uogr = jvogrp
     c                   eval      vugrl1_uhgr = jvhgrp
     c                   eval      vugrl1_uugr = jvugrp
     c     vugrl1_key    chain     vugrl1
     c                   if        not %found
6.10 c                   eval      p_osts = '1'
     c                   goto      avslutt
     c                   endif
      *
      * Henter prisgivende leverandør
      *
     c                   exsr      hent_lev
6.10 c                   if        p_osts = '4'
     c                   goto      avslutt
     c                   endif
      *
      * Henter betingelser
      *
6.3x c                   eval      b_beti = *off
6.3x c                   eval      jbetlb_prgr = p_prgr
6.3x c                   eval      jbetlc_prgr = p_prgr
6.3x c                   eval      jbetl1_prgr = p_prgr
5.70 c                   exsr      hent_beti
5.70  *
6.3x c                   if        b_beti = *off and
6.3x c                             p_prgr <> *blank
6.3x c                   eval      p_pgbe = *blank
6.3x c                   endif
6.3y  *
6.3y  * Hvis prisgruppe og oppdatering, men ikke tilslag, prøver med
6.3y  * prisgruppe blank. Når ikke oppd.så gis feilmelding fra 1. oppslag
6.3y  *
6.3y c                   if        p_prgr <> *blank and
6.3y c                             p_pgbe = *blank
6.3y c                   eval      w_osts = p_osts
6.3y c                   eval      p_osts = *blank
6.3y c                   eval      jbetlb_prgr = *blank
6.3y c                   eval      jbetlc_prgr = *blank
6.3y c                   eval      jbetl1_prgr = *blank
6.3y c                   exsr      hent_beti
6.3y c                   if        p_oppd = *blank
6.3y c                   eval      p_osts = w_osts
6.3y c                   endif
6.3y c                   endif
      *
      * Henter påslagsfaktorer
      *
5.70 c                   eval      b_pasl = *off
5.70 c                   eval      jpfala_prgr = p_prgr
5.70 c                   eval      jpfalb_prgr = p_prgr
5.70 c                   eval      jpfal1_prgr = p_prgr
5.70 c                   exsr      hent_pasl
5.70  *
5.70 c                   if        b_pasl = *off and
5.70 c                             p_prgr <> *blank
5.70 c                   eval      p_prut = *blank
5.70 c                   endif
6.3y  *
6.3y  * Hvis prisgruppe og oppdatering, men ikke tilslag, prøver med
6.3y  * prisgruppe blank. Når ikke oppd.så gis feilmelding fra 1. oppslag
6.3y  *
6.3y c                   if        p_prgr <> *blank and
6.3y c                             p_prut = *blank
6.3y c                   eval      w_osts = p_osts
6.3y c                   eval      p_osts = *blank
5.3y c                   eval      jpfala_prgr = *blank
5.3y c                   eval      jpfalb_prgr = *blank
5.3y c                   eval      jpfal1_prgr = *blank
5.3y c                   exsr      hent_pasl
6.3y c                   if        p_oppd = *blank
6.3y c                   eval      p_osts = w_osts
6.3y c                   endif
6.3y c                   endif
      *
      * Henter leverandørnummer i eget vareregister
      *
     c                   exsr      hent_elev
      *
      * Henter enhet
      *
6.21 c                   if        jaaerf = 1
6.21 c                   exsr      hent_enh_nobb
6.21 c                   else
     c                   exsr      hent_enhet
6.21 c                   endif
6.3m  * sjekk om det finnes andre enheter på best. /ordre
6.3m  * enn p_enh1-3 og p_eni1-3
6.3m  *
7.01 c                   if        u_701 = *off
6.3m c                   exsr      sjekk_orbe
6.3m c                   if        b_orbe = *on
6.3m c                   eval      p_osts = 'Y'
6.3m c                   endif
7.01 c                   endif
6.3a  *
6.3a  * Henter fraktbetingelse
6.3a  *
6.3y c                   eval      b_frak = *off
6.3y c                   eval      jfbelb_fprg = p_prgr
6.3y c                   eval      jfbelc_fprg = p_prgr
6.3y c                   eval      jfbel1_fprg = p_prgr
6.3a c                   exsr      hent_frakt
6.3y  *
6.3y c                   if        b_frak = *off and
6.3y c                             p_prgr <> *blank
6.3y c                   eval      p_pgfr = *blank
6.3y c                   endif
6.3y  *
6.3y  * Hvis prisgruppe og oppdatering, men ikke tilslag, prøver med
6.3y  * prisgruppe blank. Når ikke oppd.så gis feilmelding fra 1. oppslag
6.3y  *
6.3y  *
6.3y c                   if        p_prgr <> *blank and
6.3y c                             p_pgfr = *blank
6.3y c                   eval      w_osts = p_osts
6.3y c                   eval      p_osts = *blank
6.3y c                   eval      jfbelb_fprg = *blank
6.3y c                   eval      jfbelc_fprg = *blank
6.3y c                   eval      jfbel1_fprg = *blank
6.3y c                   exsr      hent_frakt
6.3y c                   if        p_oppd = *blank
6.3y c                   eval      p_osts = w_osts
6.3y c                   endif
6.3y c                   endif
6.22  *
6.22  * Hvis påslag sier at "salgspris skal være lik hovedleverandørs", så
6.22  * hentes den her og ser at ret.kode = ok
6.3j c                   eval      vvarl1_vare = p_vare
6.3j c     vvarl1_key    chain     vvarl1
6.3j c                   if        %found(vvarl1)
7.02bc*                  time                    w_dato
7.02bc                   eval      w_dato = p_dato
7.07 c                   if        jcsphl = 1 or
7.07 c                             jcsphl = 2
7.07 c*                   select
7.07 c*                   when      jcsphl = 1
7.07 c*                   call      'VP711R '
7.07 c*                   parm                    w_firm
7.07 c*                   parm                    p_vare
7.07 c*                   parm                    p_prgr
7.07 c*                   parm                    p_lety
7.07 c*                   parm                    w_dato
7.07 c*                   parm                    w_enhe
7.07 c*                   parm                    w_s1pr
7.07 c*                   parm                    w_retk
7.07 c*                   if        w_retk <> *blank or
7.07 c*                             w_enhe <> p_enh1
7.07 c*                   eval      p_osts = 'H'
7.07 c*                   goto      avslutt
7.07 c*                   endif
7.07 c*samme program for JCPSHL 1 og 2
7.07 c*                   when      jcsphl = 2
7.04 c                   eval      w_hlev = 1
7.04 c                   call      'VP712R '
7.04 c                   parm                    w_firm
7.04 c                   parm                    p_vare
7.04 c                   parm                    vvldor
7.04 c                   parm                    p_prgr
7.04 c                   parm                    p_enh1
7.04 c                   parm                    p_lety
7.04 c                   parm                    w_dato
7.04 c                   parm                    b_inlr
7.04 c                   parm                    w_s1pr
7.04 c                   parm                    w_bupr
7.04 c                   parm                    w_kopr
7.04 c                   parm                    w_inpr
7.04 c                   parm                    w_inpr2
7.04 c                   parm                    w_hlev
7.07 c*                   endsl
6.3j c                   endif
7.07 c                   endif
6.10  *
6.10  * hvis status 3 - sjekker om denne kan gjøres om til status U eller E
6.10  * dvs. vare utgått eller at enhet kan endres ved overføring.
6.10  *
6.10 c                   if        p_osts = '3'
6.10 c                   exsr      sjekk_sts3
6.10 c                   endif
6.10  *
6.10  * sjekker status U
6.38  * skal ikke gi feil, hvis man har parm. som sier "ta med utgåtte priser!
6.38 c                   if        p_utgp  = 0
     c                   if        p_osts = *blank and
6.3s c                             jvluda <> *loval  and
6.3s c                             jvluda <= w_udat
6.3s c*                             jvudat <> *loval  and
6.3s c*                             jvudat <= w_udat
6.10 c                   eval      p_osts = 'U'
6.10 c                   endif
6.38 c                   endif
      *
6.10 c                   if        p_osts = '3'  or
6.10 c                             p_osts = 'U'  or
6.10 c                             p_osts = 'S'  or
6.10 c                             p_osts = 'E'
     c                   goto      avslutt
     c                   endif
6.12  *
6.12  * Sjekk status G -  gtin-nr finnes på andre varenr
6.12  *
6.12 c                   exsr      sjekk_gtin
6.13  *
6.13  * Sjekk status O -  omregn.faktor ikke lik på EVR/VA for enhet
6.13  *
6.13 c                   exsr      sjekk_omre
      *
      * Sjekker om vare er valgt utelatt fra oppdatering i EVR
      *
6.10 c                   if        p_osts = *blank
     c                   eval      vvarl1_vare = p_vare
     c     vvarl1_key    chain     vvarl1
     c                   if        %found and
     c                             vvkjus = 1
6.10 c                   eval      p_osts = '8'
     c                   endif
     c                   endif
6.16  *
6.16  * Hvis skaffevare - sjekk at vare ikke finnes med varetyp=L
6.16  * på minst 1 lager
6.16  *
6.16 c
6.16 c                   if        p_osts = *blank
6.16 c                   eval      jvdtl1_dvar = p_vare
6.16 c     jvdtl1_key    chain     jvdtl1
6.16 c                   if        %found (jvdtl1) and
6.16 c                             jvdsko = 1
6.16 c                   eval      vlagl1_vare = p_vare
6.16 c     vlagl1_key    setll     vlagl1
6.16 c     vlagl1_key    reade     vlagl1
6.16 c                   dow       not %eof(vlagl1)
6.16 c                   if        vlvtyp = 'L'
6.16 c                   eval      p_osts = 'L'
6.16 c                   endif
6.16 c     vlagl1_key    reade     vlagl1
6.16 c                   enddo
6.16 c                   endif
6.16 c                   endif
      *
      * Henter pris
      *
     c                   exsr      hent_pris
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å hente prisgivende leverandør
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_lev      begsr
      *
     c                   eval      w_tell = 0
      *
     c                   if        p_pgiv <> 0
     c                   eval      p_ldor = p_pgiv
     c                   else
     c                   eval      p_ldor = jvldor
     c                   endif
      *
6.3q c                   exsr      finn_logivar
      *
6.38  * regel : hvis pris har passert utg.dato skal den ikke vises
6.38  * untak : parameter som sier at den skal vises
6.38  * tester også på om riktig pris brukes, ut fra dato
      *
6.3q  * hvis Logistikk-vare så settes modulnr til logistikkvarens modulnr
6.3q  *
6.3q c                   eval      w_vare = p_vare
6.3q c                   eval      w_modnx = jvmodn
6.3q c                   if        b_logv = *on
6.3q c                   eval      w_modnx  = w_lv_modn
6.3q c                   movel     w_lv_nobb     w_vare
6.3q c                   endif
     c                   eval      jvprl1_vare = p_vare
     c                   eval      jvprl1_ldor = p_ldor
     c     jvprl1_key    setll     jvprl1
     c     jvprl1_key    reade     jvprl1
     c                   dow       not %eof
6.38 c                   if        p_dato >= jxgdat
      *
6.38 c                   if        p_utgp  = 0
6.36 c                   if        (jxtdat =  *loval) or
6.36 c                             (jxtdat <> *loval and
6.3i c                             jxtdat >= w_udat)
     c                   eval      w_tell = w_tell + 1
     c                   eval      p_nopr = jxpris
     c                   eval      p_gdat = jxgdat
     c                   endif
6.38 c                   else
6.38 c                   eval      w_tell = w_tell + 1
6.38 c                   eval      p_nopr = jxpris
6.38 c                   eval      p_gdat = jxgdat
6.38 c                   endif
6.3q  *
6.3q  * hvis logistikkvare og omregn.faktor <> 1
6.3q  * Dette skjer direkte på prisen på logistikkvaren. 251018
6.3q c*                  if        b_logv  = *on and
6.3q c*                            w_lv_ofak <>  1
6.3q c*                  eval(h)   p_nopr = p_nopr * w_lv_ofak
6.3q c*                  endif
6.3q  *
6.3p  * sjekker om valuta på nobbpris
6.3p  *
6.3p c                   if        jxvalu <> *blank and
6.3p c                             jxvalu <> 'NOK'
6.3p c                   eval      w_kurs = 1
6.3p c                   exsr      valuta
6.3p c                   eval(h)   p_nopr = p_nopr * w_kurs
6.3p c                   endif
6.39  *
6.39  * finner lev.varenr på nytt vare-leverandør
6.39 c                   eval      jvlelr_lvnr = jxvare
6.39 c                   eval      jvlelr_lldo = jxldor
6.39 c     jvlelr_key    chain     jvlelr
6.39 c                   if        %found(jvlelr)
6.39 c                   eval      p_lvar = jvllva
6.39 c                   else
6.39 c                   eval      p_lvar = *blank
6.39 c                   endif
     c                   if        p_lvar = *blank and
     c                             p_ldor = jvldor
6.19 c                   eval      p_lvar = jvlvar
     c                   endif
6.28 c                   leave
6.38 c                   endif
     c     jvprl1_key    reade     jvprl1
     c                   enddo
      *
6.26  *
6.26  * Sjekk om tildato er passert
6.26  *
6.26 c                   if        jxtdat <> *loval and
6.3l c                             jxtdat <  w_udat
6.26 c                   eval      p_osts = '4'
6.26 c                   leavesr
6.26 c                   endif
      *
      * Sjekk om prisindeks er funnet.
      *
     c                   if        w_tell > 1 or
     c                             p_nopr = 0
6.10 c                   eval      p_osts = '4'
     c                   leavesr
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å hente betingelse
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_beti     begsr
      *
      * Leter etter betingelser knyttet opp mot prisgivende leverandør
      * etter følgende rekkefølge:
      *
      * Overgruppe
      * | Hovedgruppe
      * | | Undergruppe
      * | | | Modul
      * | | | | Vare
      * | | | | | Varetype
      * | | | | | | Leveringstype
      * | | | | | | |
      * _________________
      * - - - - x x x    1. vare,vt,lt
      * - - - - x x 0    2. vare,vt,lt=0
      * - - - - x - x    3. vare,lt
      * - - - - x - 0    4. vare,lt=0
      * - - - x - x x    5. modul,vt,lt
      * - - - x - x 0    6. modul,vt,lt=0
      * - - - x - - x    7. modul,lt
      * - - - x - - 0    8. modul,lt=0
      * x x x - - x x    9. ogr,hgr,ugr,vt,lt
      * x x x - - x 0   10. ogr,hgr,ugr,vt,lt=0
      * x x x - - - x   11. ogr,hgr,ugr,lt
      * x x x - - - 0   12. ogr,hgr,ugr,lt=0
      * x x - - - x x   13. ogr,hgr,vt,lt
      * x x - - - x 0   14. ogr,hgr,vt,lt=0
      * x x - - - - x   15. ogr,hgr,lt
      * x x - - - - 0   16. ogr,hgr,lt=0
      * x - - - - x x   17. ogr,vt,lt
      * x - - - - x 0   18. ogr,vt,lt=0
      * x - - - - - x   19. ogr,lt
      * x - - - - - 0   20. ogr,lt=0
      * - - - - - x x   21. ogr,vt,lt
      * - - - - - x 0   22. ogr,vt,lt=0
      * - - - - - - x   23. ogr,lt
      * - - - - - - 0   24. ogr,lt=0
      *
      * Vare
      *
     c                   eval      jbetlb_ldor = p_ldor
6.3q c                   eval      jbetlb_vare = w_vare
     c                   eval      jbetlb_vtyp = w_vtyp
     c                   eval      jbetlb_lety = p_lety
      *
     c     jbetlb_key    setll     jbetlb
     c     jbetlb_key    reade     jbetlb
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetlb_key    reade     jbetlb
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetlb_lety = 0
     c     jbetlb_key    setll     jbetlb
     c     jbetlb_key    reade     jbetlb
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetlb_key    reade     jbetlb
     c                   enddo
     c                   endif
      *
     c                   if        w_vtyp <> *blank
      *
     c                   eval      jbetlb_vtyp = *blank
     c                   eval      jbetlb_lety = p_lety
     c     jbetlb_key    setll     jbetlb
     c     jbetlb_key    reade     jbetlb
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetlb_key    reade     jbetlb
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetlb_vtyp = *blank
     c                   eval      jbetlb_lety = 0
     c     jbetlb_key    setll     jbetlb
     c     jbetlb_key    reade     jbetlb
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetlb_key    reade     jbetlb
     c                   enddo
     c                   endif
      *
     c                   endif
      *
      * Modul
      *
6.3q c                   if        w_modnx <> 0
      *
     c                   eval      jbetlc_ldor = p_ldor
6.3q c                   eval      jbetlc_modn = w_modnx
     c                   eval      jbetlc_vare = *blank
     c                   eval      jbetlc_vtyp = w_vtyp
     c                   eval      jbetlc_lety = p_lety
      *
     c     jbetlc_key    setll     jbetlc
     c     jbetlc_key    reade     jbetlc
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetlc_key    reade     jbetlc
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetlc_lety = 0
     c     jbetlc_key    setll     jbetlc
     c     jbetlc_key    reade     jbetlc
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetlc_key    reade     jbetlc
     c                   enddo
     c                   endif
      *
     c                   if        w_vtyp <> *blank
      *
     c                   eval      jbetlc_vtyp = *blank
     c                   eval      jbetlc_lety = p_lety
     c     jbetlc_key    setll     jbetlc
     c     jbetlc_key    reade     jbetlc
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetlc_key    reade     jbetlc
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetlc_vtyp = *blank
     c                   eval      jbetlc_lety = 0
     c     jbetlc_key    setll     jbetlc
     c     jbetlc_key    reade     jbetlc
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetlc_key    reade     jbetlc
     c                   enddo
     c                   endif
      *
     c                   endif
      *
     c                   endif
      *
      * Overgruppe/hovedgruppe/undergruppe
      *
     c                   eval      jbetl1_ldor = p_ldor
     c                   eval      jbetl1_ogrp = jvogrp
     c                   eval      jbetl1_hgrp = jvhgrp
     c                   eval      jbetl1_ugrp = jvugrp
     c                   eval      jbetl1_modn = 0
     c                   eval      jbetl1_vare = *blank
     c                   eval      jbetl1_vtyp = w_vtyp
     c                   eval      jbetl1_lety = p_lety
      *
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetl1_lety = 0
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
     c                   endif
      *
     c                   if        w_vtyp <> *blank
      *
     c                   eval      jbetl1_vtyp = *blank
     c                   eval      jbetl1_lety = p_lety
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetl1_vtyp = *blank
     c                   eval      jbetl1_lety = 0
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
     c                   endif
      *
     c                   endif
      *
      * Overgruppe/hovedgruppe
      *
     c                   eval      jbetl1_ugrp = 0
     c                   eval      jbetl1_vtyp = w_vtyp
     c                   eval      jbetl1_lety = p_lety
      *
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetl1_lety = 0
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
     c                   endif
      *
     c                   if        w_vtyp <> *blank
      *
     c                   eval      jbetl1_vtyp = *blank
     c                   eval      jbetl1_lety = p_lety
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetl1_vtyp = *blank
     c                   eval      jbetl1_lety = 0
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
     c                   endif
      *
     c                   endif
      *
      * Overgruppe
      *
     c                   eval      jbetl1_hgrp = 0
     c                   eval      jbetl1_vtyp = w_vtyp
     c                   eval      jbetl1_lety = p_lety
      *
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetl1_lety = 0
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
     c                   endif
      *
     c                   if        w_vtyp <> *blank
      *
     c                   eval      jbetl1_vtyp = *blank
     c                   eval      jbetl1_lety = p_lety
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetl1_vtyp = *blank
     c                   eval      jbetl1_lety = 0
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
     c                   endif
      *
     c                   endif
      *
      * Generell (på leverandør)
      *
     c                   eval      jbetl1_ogrp = 0
     c                   eval      jbetl1_vtyp = w_vtyp
     c                   eval      jbetl1_lety = p_lety
      *
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetl1_lety = 0
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
     c                   endif
      *
     c                   if        w_vtyp <> *blank
      *
     c                   eval      jbetl1_vtyp = *blank
     c                   eval      jbetl1_lety = p_lety
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
      *
     c                   if        p_lety <> 0
     c                   eval      jbetl1_vtyp = *blank
     c                   eval      jbetl1_lety = 0
     c     jbetl1_key    setll     jbetl1
     c     jbetl1_key    reade     jbetl1
     c                   dow       not %eof
     c                   if        jpakti = 1
6.3h c                   exsr      sjekk_dato
6.3h c                   if        b_bdat = *on
     c                   goto      end_beti
6.3h c                   endif
     c                   endif
     c     jbetl1_key    reade     jbetl1
     c                   enddo
     c                   endif
      *
     c                   endif
      *
      * Dersom ingen betingelse ble funnet, settes status til 5, og
      * innkjøpsprisfaktor defaultes til 1
      *
6.10 c                   eval      p_osts = '5'
     c                   eval      p_ifak = 1
      *
     c                   leavesr
      *
     c     end_beti      tag
      *
      * Henter verdier fra funnet betingelse
      *
     c                   eval      p_bldo = jpldor
     c                   eval      p_bogr = jpogrp
     c                   eval      p_bhgr = jphgrp
     c                   eval      p_bugr = jpugrp
     c                   eval      p_bmod = jpmodn
     c                   eval      p_bvar = jpvare
     c                   eval      p_bvty = jpvtyp
     c                   eval      p_blet = jplety
     c                   eval      p_bbet = jpbeti
      *
      * Dersom det finnes aktiviserte rabattelement under betingelsen er
      * det kun disse som skal benyttes.
      *
     c                   eval      jrael4_eldo = jpldor
6.3x c                   eval      jrael4_eprg = jpprgr
     c                   eval      jrael4_eogr = jpogrp
     c                   eval      jrael4_ehgr = jphgrp
     c                   eval      jrael4_eugr = jpugrp
     c                   eval      jrael4_emod = jpmodn
     c                   eval      jrael4_evar = jpvare
     c                   eval      jrael4_evty = jpvtyp
     c                   eval      jrael4_elet = jplety
     c                   eval      jrael4_ebrs = jprsts
     c                   eval      jrael4_ebli = jpline
     c                   eval      jrael4_eakt = 1
     c     jrael4_key    chain     jrael4
     c                   if        %found
     c                   eval      b_akti = *on
     c                   endif
      *
      * Kalkulerer nettopris og innkjøpsprisfaktor fra rabattelementene
      *
     c                   eval      p_ntpr = 0
     c                   eval      p_ifak = 1
      *
     c                   eval      jrael1_eldo = jpldor
6.3x c                   eval      jrael1_eprg = jpprgr
     c                   eval      jrael1_eogr = jpogrp
     c                   eval      jrael1_ehgr = jphgrp
     c                   eval      jrael1_eugr = jpugrp
     c                   eval      jrael1_emod = jpmodn
     c                   eval      jrael1_evar = jpvare
     c                   eval      jrael1_evty = jpvtyp
     c                   eval      jrael1_elet = jplety
     c                   eval      jrael1_ebrs = jprsts
     c                   eval      jrael1_ebli = jpline
     c     jrael1_key    setll     jrael1
     c     jrael1_key    reade     jrael1
     c                   dow       not %eof
     c                   if        b_akti = *off or
     c                             b_akti = *on and
     c                             jpeakt = 1
     c                   select
     c                   when      jpereg = '1'
     c                   eval(h)   p_ifak = p_ifak - (jpever / 100 * p_ifak)
     c                   when      jpereg = '2'
     c                   eval(h)   p_ifak = p_ifak - (jpever / 100)
     c                   when      jpereg = 'N'
     c                   eval      p_ntpr = p_ntpr + jpever
     c                   endsl
     c                   endif
     c     jrael1_key    reade     jrael1
     c                   enddo
      *
     c                   eval      b_beti = *on
      *
     c                   endsr
      *
6.3a  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3a  * Subrutine for å hente frakt betingelse
6.3a  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3a  *
6.3a c     hent_frakt    begsr
6.3a  *
6.3a  * Leter etter betingelser knyttet opp mot prisgivende leverandør
6.3a  * etter følgende rekkefølge:
6.3a  *
6.3a  * Overgruppe
6.3a  * | Hovedgruppe
6.3a  * | | Undergruppe
6.3a  * | | | Modul
6.3a  * | | | | Vare
6.3a  * | | | | | Varetype
6.3a  * | | | | | | Leveringstype
6.3a  * | | | | | | |
6.3a  * _________________
6.3a  * - - - - x x x    1. vare,vt,lt
6.3a  * - - - - x x 0    2. vare,vt,lt=0
6.3a  * - - - - x - x    3. vare,lt
6.3a  * - - - - x - 0    4. vare,lt=0
6.3a  * - - - x - x x    5. modul,vt,lt
6.3a  * - - - x - x 0    6. modul,vt,lt=0
6.3a  * - - - x - - x    7. modul,lt
6.3a  * - - - x - - 0    8. modul,lt=0
6.3a  * x x x - - x x    9. ogr,hgr,ugr,vt,lt
6.3a  * x x x - - x 0   10. ogr,hgr,ugr,vt,lt=0
6.3a  * x x x - - - x   11. ogr,hgr,ugr,lt
6.3a  * x x x - - - 0   12. ogr,hgr,ugr,lt=0
6.3a  * x x - - - x x   13. ogr,hgr,vt,lt
6.3a  * x x - - - x 0   14. ogr,hgr,vt,lt=0
6.3a  * x x - - - - x   15. ogr,hgr,lt
6.3a  * x x - - - - 0   16. ogr,hgr,lt=0
6.3a  * x - - - - x x   17. ogr,vt,lt
6.3a  * x - - - - x 0   18. ogr,vt,lt=0
6.3a  * x - - - - - x   19. ogr,lt
6.3a  * x - - - - - 0   20. ogr,lt=0
6.3a  * - - - - - x x   21. ogr,vt,lt
6.3a  * - - - - - x 0   22. ogr,vt,lt=0
6.3a  * - - - - - - x   23. ogr,lt
6.3a  * - - - - - - 0   24. ogr,lt=0
6.3a  *
6.3a c                   eval      w_fkrt = 0
6.3a c                   eval      w_fprt = 0
6.3a c                   eval      w_fton = 0
6.3a c                   eval      w_fkub = 0
6.3a  *
6.3a  * vare
6.3a  *
6.3a c                   eval      jfbelb_fldo = p_ldor
6.3a c                   eval      jfbelb_fvar = p_vare
6.3a c                   eval      jfbelb_fvty = w_vtyp
6.3a c                   eval      jfbelb_flet = p_lety
6.3a  *
6.3a c     jfbelb_key    setll     jfbelb
6.3a c     jfbelb_key    reade     jfbelb
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbelb_key    reade     jfbelb
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbelb_flet = 0
6.3a c     jfbelb_key    setll     jfbelb
6.3a c     jfbelb_key    reade     jfbelb
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbelb_key    reade     jfbelb
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   if        w_vtyp <> *blank
6.3a  *
6.3a c                   eval      jfbelb_fvty = *blank
6.3a c                   eval      jfbelb_flet = p_lety
6.3a c     jfbelb_key    setll     jfbelb
6.3a c     jfbelb_key    reade     jfbelb
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbelb_key    reade     jfbelb
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbelb_fvty = *blank
6.3a c                   eval      jfbelb_flet = 0
6.3a c     jfbelb_key    setll     jfbelb
6.3a c     jfbelb_key    reade     jfbelb
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbelb_key    reade     jfbelb
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   endif
6.3a  *
6.3a  * Modul
6.3a  *
6.3q c                   if        w_modnx <> 0
6.3a  *
6.3a c                   eval      jfbelc_fldo = p_ldor
6.3q c                   eval      jfbelc_fmod = w_modnx
6.3a c                   eval      jfbelc_fvar = *blank
6.3a c                   eval      jfbelc_fvty = w_vtyp
6.3a c                   eval      jfbelc_flet = p_lety
6.3a  *
6.3a c     jfbelc_key    setll     jfbelc
6.3a c     jfbelc_key    reade     jfbelc
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbelc_key    reade     jfbelc
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbelc_flet = 0
6.3a c     jfbelc_key    setll     jfbelc
6.3a c     jfbelc_key    reade     jfbelc
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbelc_key    reade     jfbelc
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   if        w_vtyp <> *blank
6.3a  *
6.3a c                   eval      jfbelc_fvty = *blank
6.3a c                   eval      jfbelc_flet = p_lety
6.3a c     jfbelc_key    setll     jfbelc
6.3a c     jfbelc_key    reade     jfbelc
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbelc_key    reade     jfbelc
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbelc_fvty = *blank
6.3a c                   eval      jfbelc_flet = 0
6.3a c     jfbelc_key    setll     jfbelc
6.3a c     jfbelc_key    reade     jfbelc
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbelc_key    reade     jfbelc
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   endif
6.3a  *
6.3a c                   endif
6.3a  *
6.3a  * Overgruppe/hovedgruppe/undergruppe
6.3a  *
6.3a c                   eval      jfbel1_fldo = p_ldor
6.3a c                   eval      jfbel1_fogr = jvogrp
6.3a c                   eval      jfbel1_fhgr = jvhgrp
6.3a c                   eval      jfbel1_fugr = jvugrp
6.3a c                   eval      jfbel1_fmod = 0
6.3a c                   eval      jfbel1_fvar = *blank
6.3a c                   eval      jfbel1_fvty = w_vtyp
6.3a c                   eval      jfbel1_flet = p_lety
6.3a  *
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbel1_flet = 0
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   if        w_vtyp <> *blank
6.3a  *
6.3a c                   eval      jfbel1_fvty = *blank
6.3a c                   eval      jfbel1_flet = p_lety
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbel1_fvty = *blank
6.3a c                   eval      jfbel1_flet = 0
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   endif
6.3a  *
6.3a  * Overgruppe/hovedgruppe
6.3a  *
6.3a c                   eval      jfbel1_fugr = 0
6.3a c                   eval      jfbel1_fvty = w_vtyp
6.3a c                   eval      jfbel1_flet = p_lety
6.3a  *
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbel1_flet = 0
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   if        w_vtyp <> *blank
6.3a  *
6.3a c                   eval      jfbel1_fvty = *blank
6.3a c                   eval      jfbel1_flet = p_lety
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbel1_fvty = *blank
6.3a c                   eval      jfbel1_flet = 0
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   endif
6.3a  *
6.3a  * Overgruppe
6.3a  *
6.3a c                   eval      jfbel1_fhgr = 0
6.3a c                   eval      jfbel1_fvty = w_vtyp
6.3a c                   eval      jfbel1_flet = p_lety
6.3a  *
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbel1_flet = 0
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   if        w_vtyp <> *blank
6.3a  *
6.3a c                   eval      jfbel1_fvty = *blank
6.3a c                   eval      jfbel1_flet = p_lety
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbel1_fvty = *blank
6.3a c                   eval      jfbel1_flet = 0
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   endif
6.3a  *
6.3a  * Generell (på leverandør)
6.3a  *
6.3a c                   eval      jfbel1_fogr = 0
6.3a c                   eval      jfbel1_fvty = w_vtyp
6.3a c                   eval      jfbel1_flet = p_lety
6.3a  *
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbel1_flet = 0
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   if        w_vtyp <> *blank
6.3a  *
6.3a c                   eval      jfbel1_fvty = *blank
6.3a c                   eval      jfbel1_flet = p_lety
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a  *
6.3a c                   if        p_lety <> 0
6.3a c                   eval      jfbel1_fvty = *blank
6.3a c                   eval      jfbel1_flet = 0
6.3a c     jfbel1_key    setll     jfbel1
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   dow       not %eof
6.3a c                   if        jpakti = 1
6.3a c                   goto      end_frakt
6.3a c                   endif
6.3a c     jfbel1_key    reade     jfbel1
6.3a c                   enddo
6.3a c                   endif
6.3a  *
6.3a c                   endif
6.3a  *
6.3a  * Dersom ingen frakt betingelse
6.3a  *
6.3a c                   leavesr
6.3a  *
6.3a c     end_frakt     tag
6.3a  *
6.3a  * Henter verdier fra funnet frakt
6.3a  *
6.3a  *
     c                   if        (jpffda = *loval and
     c                             jpftda = *loval) or
6.3a c                             (w_udat >= jpffda and
8.01 c                             w_udat <= jpftda) or
8.01 c                             (w_udat >= jpffda and
8.01 c                             jpftda = *loval)
6.3a  *
6.3c c                   eval      w_fkrt = jpfkrt
6.3a c                   eval(h)   w_fprt = jpfprt
6.3c c                   eval      w_fton = jpfton
6.3c c                   eval      w_fkub = jpfkub
6.3y c                   eval      b_frak = *on
6.3a c
6.3a c                   endif
6.3a c                   endsr
6.3a  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å hente påslagsfaktorer - bruker først funnet
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_pasl     begsr
      *
      * Leter etter påslag etter følgende rekkefølge:
      *
      * Overgruppe
      * | Hovedgruppe
      * | | Undergruppe
      * | | | Leverandør
      * | | | | Modul
      * | | | | | Vare
      * | | | | | | Priskode
      * | | | | | | | Varetype
      * | | | | | | | | Leveringstype
      * | | | | | | | | |
      * _________________
      * - - - x - x x x x    1. lev,vare,pk,vt,lt
      * - - - x - x x x 0    2. lev,vare,pk,vt,lt=0
      * - - - x - x x - x    3. lev,vare,pk,lt
      * - - - x - x x - 0    4. lev,vare,pk,lt=0
      * - - - x - x - x x    5. lev,vare,vt,lt
      * - - - x - x - x 0    6. lev,vare,vt,lt=0
      * - - - x - x - - x    7. lev,vare,lt
      * - - - x - x - - 0    8. lev,vare,lt=0
      * - - - - - x x x x    9. vare,pk,vt,lt
      * - - - - - x x x 0   10. vare,pk,vt,lt=0
      * - - - - - x x - x   11. vare,pk,lt
      * - - - - - x x - 0   12. vare,pk,lt=0
      * - - - - - x - x x   13. vare,vt,lt
      * - - - - - x - x 0   14. vare,vt,lt=0
      * - - - - - x - - x   15. vare,lt
      * - - - - - x - - 0   16. vare,lt=0
      * - - - x x - x x x   17. lev,modul,pk,vt,lt
      * - - - x x - x x 0   18. lev,modul,pk,vt,lt=0
      * - - - x x - x - x   19. lev,modul,pk,lt
      * - - - x x - x - 0   20. lev,modul,pk,lt=0
      * - - - x x - - x x   21. lev,modul,vt,lt
      * - - - x x - - x 0   22. lev,modul,vt,lt=0
      * - - - x x - - - x   23. lev,modul,lt
      * - - - x x - - - 0   24. lev,modul,lt=0
      * - - - - x - x x x   25. modul,pk,vt,lt
      * - - - - x - x x 0   26. modul,pk,vt,lt=0
      * - - - - x - x - x   27. modul,pk,lt
      * - - - - x - x - 0   28. modul,pk,lt=0
      * - - - - x - - x x   29. modul,vt,lt
      * - - - - x - - x 0   30. modul,vt,lt=0
      * - - - - x - - - x   31. modul,lt
      * - - - - x - - - 0   32. modul,lt=0
      * x x x x - - x x x   33. ogr,hgr,ugr,lev,pk,vt,lt
      * x x x x - - x x 0   34. ogr,hgr,ugr,lev,pk,vt,lt=0
      * x x x x - - x - x   35. ogr,hgr,ugr,lev,pk,lt
      * x x x x - - x - 0   36. ogr,hgr,ugr,lev,pk,lt=0
      * x x x x - - - x x   37. ogr,hgr,ugr,lev,vt,lt
      * x x x x - - - x 0   38. ogr,hgr,ugr,lev,vt,lt=0
      * x x x x - - - - x   39. ogr,hgr,ugr,lev,lt
      * x x x x - - - - 0   40. ogr,hgr,ugr,lev,lt=0
      * x x - x - - x x x   41. ogr,hgr,lev,pk,vt,lt
      * x x - x - - x x 0   42. ogr,hgr,lev,pk,vt,lt=0
      * x x - x - - x - x   43. ogr,hgr,lev,pk,lt
      * x x - x - - x - 0   44. ogr,hgr,lev,pk,lt=0
      * x x - x - - - x x   45. ogr,hgr,lev,vt,lt
      * x x - x - - - x 0   46. ogr,hgr,lev,vt,lt=0
      * x x - x - - - - x   47. ogr,hgr,lev,lt
      * x x - x - - - - 0   48. ogr,hgr,lev,lt=0
      * x - - x - - x x x   49. ogr,lev,pk,vt,lt
      * x - - x - - x x 0   50. ogr,lev,pk,vt,lt=0
      * x - - x - - x - x   51. ogr,lev,pk,lt
      * x - - x - - x - 0   52. ogr,lev,pk,lt=0
      * x - - x - - - x x   53. ogr,lev,vt,lt
      * x - - x - - - x 0   54. ogr,lev,vt,lt=0
      * x - - x - - - - x   55. ogr,lev,lt
      * x - - x - - - - 0   56. ogr,lev,lt=0
      * - - - x - - x x x   57. lev,pk,vt,lt
      * - - - x - - x x 0   58. lev,pk,vt,lt=0
      * - - - x - - x - x   59. lev,pk,lt
      * - - - x - - x - 0   60. lev,pk,lt=0
      * - - - x - - - x x   61. lev,vt,lt
      * - - - x - - - x 0   62. lev,vt,lt=0
      * - - - x - - - - x   63. lev,lt
      * - - - x - - - - 0   64. lev,lt=0
      * x x x - - - x x x   65. ogr,hgr,ugr,pk,vt,lt
      * x x x - - - x x 0   66. ogr,hgr,ugr,pk,vt,lt=0
      * x x x - - - x - x   67. ogr,hgr,ugr,pk,lt
      * x x x - - - x - 0   68. ogr,hgr,ugr,pk,lt=0
      * x x x - - - - x x   69. ogr,hgr,ugr,vt,lt
      * x x x - - - - x 0   70. ogr,hgr,ugr,vt,lt=0
      * x x x - - - - - x   71. ogr,hgr,ugr,lt
      * x x x - - - - - 0   72. ogr,hgr,ugr,lt=0
      * x x - - - - x x x   73. ogr,hgr,pk,vt,lt
      * x x - - - - x x 0   74. ogr,hgr,pk,vt,lt=0
      * x x - - - - x - x   75. ogr,hgr,pk,lt
      * x x - - - - x - 0   76. ogr,hgr,pk,lt=0
      * x x - - - - - x x   77. ogr,hgr,vt,lt
      * x x - - - - - x 0   78. ogr,hgr,vt,lt=0
      * x x - - - - - - x   79. ogr,hgr,lt
      * x x - - - - - - 0   80. ogr,hgr,lt=0
      * x - - - - - x x x   81. ogr,pk,vt,lt
      * x - - - - - x x 0   82. ogr,pk,vt,lt=0
      * x - - - - - x - x   83. ogr,pk,lt
      * x - - - - - x - 0   84. ogr,pk,lt=0
      * x - - - - - - x x   85. ogr,vt,lt
      * x - - - - - - x 0   86. ogr,vt,lt=0
      * x - - - - - - - x   87. ogr,lt
      * x - - - - - - - 0   88. ogr,lt=0
      * - - - - - - x x x   89. pk,vt,lt
      * - - - - - - x x 0   90. pk,vt,lt=0
      * - - - - - - x - x   91. pk,lt
      * - - - - - - x - 0   92. pk,lt=0
      * - - - - - - - x x   93. vt,lt
      * - - - - - - - x 0   94. vt,lt=0
      * - - - - - - - - x   95. lt
      * - - - - - - - - 0   96. lt=0
      *
6.3r c                   eval      jpfala_vare = w_vare
     c                   eval      jpfala_ldor = p_ldor
     c                   eval      jpfala_kpri = p_pkod
     c                   eval      jpfala_vtyp = w_vtyp
     c                   eval      jpfala_lety = p_lety
      *
6.3q c                   eval      jpfalb_modn = w_modnx
     c                   eval      jpfalb_ldor = p_ldor
     c                   eval      jpfalb_vare = *blank
     c                   eval      jpfalb_kpri = p_pkod
     c                   eval      jpfalb_vtyp = w_vtyp
     c                   eval      jpfalb_lety = p_lety
      *
     c                   eval      jpfal1_ogrp = jvogrp
     c                   eval      jpfal1_hgrp = jvhgrp
     c                   eval      jpfal1_ugrp = jvugrp
     c                   eval      jpfal1_ldor = p_ldor
     c                   eval      jpfal1_modn = 0
     c                   eval      jpfal1_vare = *blank
     c                   eval      jpfal1_kpri = p_pkod
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
      *
      * Leverandør/vare
      *
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_lety = 0
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_vtyp = *blank
     c                   eval      jpfala_lety = p_lety
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_lety = 0
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_kpri = *blank
     c                   eval      jpfala_vtyp = w_vtyp
     c                   eval      jpfala_lety = p_lety
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_lety = 0
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_vtyp = *blank
     c                   eval      jpfala_lety = p_lety
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_lety = 0
     c     jpfala_key    chain     jpfala
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfala)
     c                   goto      end_paslag
     c                   endif
      *
      * Vare
      *
     c                   eval      jpfala_ldor = 0
     c                   eval      jpfala_kpri = p_pkod
     c                   eval      jpfala_vtyp = w_vtyp
     c                   eval      jpfala_lety = p_lety
      *
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_lety = 0
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_vtyp = *blank
     c                   eval      jpfala_lety = p_lety
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_lety = 0
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_kpri = *blank
     c                   eval      jpfala_vtyp = w_vtyp
     c                   eval      jpfala_lety = p_lety
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_lety = 0
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_vtyp = *blank
     c                   eval      jpfala_lety = p_lety
     c     jpfala_key    chain     jpfala
     c                   if        not %found
     c                   eval      jpfala_lety = 0
     c     jpfala_key    chain     jpfala
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfala)
     c                   goto      end_paslag
     c                   endif
      *
      * Leverandør/modul
      *
6.3r c                   if        w_modnx <> 0
      *
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_lety = 0
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_vtyp = *blank
     c                   eval      jpfalb_lety = p_lety
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_lety = 0
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_kpri = *blank
     c                   eval      jpfalb_vtyp = w_vtyp
     c                   eval      jpfalb_lety = p_lety
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_lety = 0
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_vtyp = *blank
     c                   eval      jpfalb_lety = p_lety
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_lety = 0
     c     jpfalb_key    chain     jpfalb
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfalb)
     c                   goto      end_paslag
     c                   endif
      *
      * Modul
      *
     c                   eval      jpfalb_ldor = 0
     c                   eval      jpfalb_kpri = p_pkod
     c                   eval      jpfalb_vtyp = w_vtyp
     c                   eval      jpfalb_lety = p_lety
      *
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_lety = 0
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_vtyp = *blank
     c                   eval      jpfalb_lety = p_lety
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_lety = 0
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_kpri = *blank
     c                   eval      jpfalb_vtyp = w_vtyp
     c                   eval      jpfalb_lety = p_lety
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_lety = 0
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_vtyp = *blank
     c                   eval      jpfalb_lety = p_lety
     c     jpfalb_key    chain     jpfalb
     c                   if        not %found
     c                   eval      jpfalb_lety = 0
     c     jpfalb_key    chain     jpfalb
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfalb)
     c                   goto      end_paslag
     c                   endif
      *
     c                   endif
      *
      * Overgruppe/hovedgruppe/undergruppe/leverandør
      *
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_kpri = *blank
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfal1)
     c                   goto      end_paslag
     c                   endif
      *
      * Overgruppe/hovedgruppe/leverandør
      *
     c                   eval      jpfal1_ugrp = 0
     c                   eval      jpfal1_kpri = p_pkod
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
      *
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_kpri = *blank
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfal1)
     c                   goto      end_paslag
     c                   endif
      *
      * Overgruppe/leverandør
      *
     c                   eval      jpfal1_hgrp = 0
     c                   eval      jpfal1_kpri = p_pkod
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
      *
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_kpri = *blank
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfal1)
     c                   goto      end_paslag
     c                   endif
      *
      * Leverandør
      *
     c                   eval      jpfal1_ogrp = 0
     c                   eval      jpfal1_kpri = p_pkod
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
      *
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_kpri = *blank
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfal1)
     c                   goto      end_paslag
     c                   endif
      *
      * Overgruppe/hovedgruppe/undergruppe
      *
     c                   eval      jpfal1_ogrp = jvogrp
     c                   eval      jpfal1_hgrp = jvhgrp
     c                   eval      jpfal1_ugrp = jvugrp
     c                   eval      jpfal1_ldor = 0
     c                   eval      jpfal1_modn = 0
     c                   eval      jpfal1_vare = *blank
     c                   eval      jpfal1_kpri = p_pkod
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
      *
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_kpri = *blank
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfal1)
     c                   goto      end_paslag
     c                   endif
      *
      * Overgruppe/hovedgruppe
      *
     c                   eval      jpfal1_ugrp = 0
     c                   eval      jpfal1_kpri = p_pkod
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
      *
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_kpri = *blank
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfal1)
     c                   goto      end_paslag
     c                   endif
      *
      * Overgruppe
      *
     c                   eval      jpfal1_hgrp = 0
     c                   eval      jpfal1_kpri = p_pkod
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
      *
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_kpri = *blank
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfal1)
     c                   goto      end_paslag
     c                   endif
      *
      * Generell
      *
     c                   eval      jpfal1_ogrp = 0
     c                   eval      jpfal1_kpri = p_pkod
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
      *
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_kpri = *blank
     c                   eval      jpfal1_vtyp = w_vtyp
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_vtyp = *blank
     c                   eval      jpfal1_lety = p_lety
     c     jpfal1_key    chain     jpfal1
     c                   if        not %found
     c                   eval      jpfal1_lety = 0
     c     jpfal1_key    chain     jpfal1
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        %found(jpfal1)
     c                   goto      end_paslag
     c                   endif
      *
      * Ingen gyldige påslagsfaktorer funnet.
      * Status settes til 6, dersom status for betingelse ikke allerede er
      * satt. Kostprisfaktor og salgprisfaktor defaultes til 1.
      *
6.10 c                   if        p_osts <> '5'
6.10 c                   eval      p_osts = '6'
     c                   endif
      *
     c                   eval      p_kfak = 1
     c                   eval      p_sfak = 1
     c                   leavesr
      *
      * Tar vare på påslagsfaktor data.
      *
     c     end_paslag    tag
      *
     c                   eval      p_pogr = jcogrp
     c                   eval      p_phgr = jchgrp
     c                   eval      p_pugr = jcugrp
     c                   eval      p_pldo = jcldor
     c                   eval      p_pmod = jcmodn
     c                   eval      p_pvar = jcvare
     c                   eval      p_ppko = jckpri
     c                   eval      p_pvty = jcvtyp
     c                   eval      p_plet = jclety
     c                   eval      p_kfak = jckofa
     c                   eval      p_kbel = jckobe
     c                   eval      p_sfak = jcsafa
      *
5.70 c                   eval      b_pasl = *on
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å hente leverandørinformasjon og for å sjekke om
      * knytning mot leverandør i EVR er lagt inn
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_elev     begsr
      *
     c                   eval      jlevl1_ldor = p_ldor
     c     jlevl1_key    chain     jlevl1
     c                   if        not %found
6.10 c                   eval      p_osts = '2'
     c                   leavesr
     c                   endif
      *
     c                   if        jlenum = 0 and
6.10 c                             p_osts = *blank
6.10 c                   eval      p_osts = '2'
     c                   leavesr
     c                   endif
      *
     c                   eval      p_eldo = jlenum
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for henting av enheter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_enhet    begsr
6.3a  *
6.3a c                   eval       w_vekt = 0
6.3a c                   eval       w_volu = 0
6.3a c                   eval       w_vekx = 0
6.3a c                   eval       w_volx = 0
6.3y c                   eval       w_ofz1 = 0
      *
      * Leter etter enhet på varenivå.
      *
     c                   eval      jforl5_vare = p_vare
     c     jforl5_key    chain     jforl5
      *
      * Dersom enhet ikke ble funnet på vare, letes det etter enheter på
      * varegruppe og leverandør (hvor leverandør er vareeier).
      * Dersom forpakning ikke finnes benyttes rekkefølgen fra vare-pakning.
      *
     c                   if        not %found
      *
     c                   eval      jforl1_ogrp = jvogrp
     c                   eval      jforl1_hgrp = jvhgrp
     c                   eval      jforl1_ugrp = jvugrp
     c                   eval      jforl1_ldor = jvldor
     c                   eval      jforl1_modn = jvmodn
     c                   eval      jforl1_vare = *blank
      *
     c     jforl1_key    chain     jforl1
     c                   if        not %found
     c                   eval      jforl1_modn = 0
     c     jforl1_key    chain     jforl1
     c                   if        not %found
     c                   eval      jforl1_ldor = 0
     c     jforl1_key    chain     jforl1
     c                   if        not %found
     c                   eval      jforl1_ugrp = 0
     c     jforl1_key    chain     jforl1
     c                   if        not %found
     c                   eval      jforl1_hgrp = 0
     c     jforl1_key    chain     jforl1
     c                   if        not %found
      *
     c                   eval      jzenh1 = *blank
     c                   eval      jzenh2 = *blank
     c                   eval      jzenh3 = *blank
     c                   eval      jzeni1 = *blank
     c                   eval      jzeni2 = *blank
     c                   eval      jzeni3 = *blank
     c                   eval      jzenp1 = *blank
     c                   eval      jzenp2 = *blank
     c                   eval      jzenp3 = *blank
7.02 c                   eval      w_psenx = *Blank
7.02 c                   eval      w_pklaf = *Blank
7.02 c                   eval      w_pklad = *Blank
7.02 c                   eval      w_pklat = *Blank
7.03 c                   eval      w_m2enh = *Blank
      *
     c                   eval      jvpkl1_vare = p_vare
6.33 c                   eval      jvpkl1_ldor = p_ldor
     c     jvpkl1_key    setll     jvpkl1
     c     jvpkl1_key    reade     jvpkl1
     c                   dow       not %eof
6.35  *
6.35  * sjekker fra / tildato
6.35 c                   exsr      sjekk_pkdato
6.35 c                   if        b_pakn = *on
6.3y  *
7.02 c                   select
7.02 c                   when      jwpsen = 1
7.02 c                   eval      w_psenx  = jwenhe
7.02 c                   when      jwpkla  = 'F'
7.02 c                   eval      w_pklaf = jwenhe
7.02 c                   when      jwpkla  = 'D'
7.02 c                   eval      w_pklad = jwenhe
7.02 c                   when      jwpkla  = 'T'
7.02 c                   eval      w_pklat = jwenhe
7.02 c                   endsl
7.03 c                   if        jwenhe = 'M2'
7.03 c                   eval      w_m2enh = jwenhe
7.03 c                   endif
7.02  *
     c                   select
     c                   when      jzenh1 = *blank
     c                   eval      jzenh1 = jwenhe
7.02 c*                   eval      jzenp1 = jwenhe
     c                   when      jzenh2 = *blank and
     c                             jwenhe <> jzenh1
     c                   eval      jzenh2 = jwenhe
     c                   when      jzenh3 = *blank and
     c                             jwenhe <> jzenh1 and
     c                             jwenhe <> jzenh2
     c                   eval      jzenh3 = jwenhe
     c                   endsl
6.11  *
6.34 c                   if        jwbest = 1
     c                   select
     c                   when      jzeni1 = *blank
     c                   eval      jzeni1 = jwenhe
     c                   when      jzeni2 = *blank and
     c                             jwenhe <> jzeni1
     c                   eval      jzeni2 = jwenhe
     c                   when      jzeni3 = *blank and
     c                             jwenhe <> jzeni1 and
     c                             jwenhe <> jzeni2
     c                   eval      jzeni3 = jwenhe
     c                   endsl
     c                   endif
      *
6.35 c                   endif
      *
     c     jvpkl1_key    reade     jvpkl1
     c                   enddo
      *
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
     c                   endif
7.02  *
7.02  * hvis prisenhet ikke satt på forpakning så settes de her
7.02  *
7.02 c                   if        jzenp1 = *blank
7.02 c                   if        w_psenx <> *blank
7.02 c                   eval      jzenp1 = w_psenx
7.05 c                   if        w_pklaf <> *blank
7.02 c                   eval      jzenp2 = w_pklaf
7.05 c                   eval      jzenp3 = w_pklad
7.05 c                   else
7.05 c                   eval      jzenp2 = w_pklad
7.05 c                   eval      jzenp3 = w_pklat
7.05 c                   endif
7.05 c                   if        jzenp2 = *blank
7.05 c                   eval      jzenp2 = w_pklat
7.05 c                   else
7.05 c                   if        jzenp3 = *blank
7.03 c                   eval      jzenp3 = w_pklat
7.03 c                   endif
7.05 c                   endif
7.02 c                   else
7.03 c                   if        w_m2enh <> *blank
7.03 c                   eval      jzenp1 = w_m2enh
7.05 c                   if        w_pklaf <> *blank
7.05 c                   eval      jzenp2 = w_pklaf
7.05 c                   eval      jzenp3 = w_pklad
7.05 c                   else
7.05 c                   eval      jzenp2 = w_pklad
7.05 c                   eval      jzenp3 = w_pklat
7.05 c                   endif
7.05 c                   if        jzenp2 = *blank
7.05 c                   eval      jzenp2 = w_pklat
7.05 c                   else
7.05 c                   if        jzenp3 = *blank
7.03 c                   eval      jzenp3 = w_pklat
7.03 c                   endif
7.05 c                   endif
7.03 c                   else
7.02 c                   if        w_pklaf <> *Blank
7.02 c                   eval      jzenp1 = w_pklaf
7.05 c                   if        w_pklad <> *blank
7.02 c                   eval      jzenp2 = w_pklad
7.05 c                   eval      jzenp3 = w_pklat
7.05 c                   else
7.05 c                   eval      jzenp2 = w_pklat
7.03 c                   eval      jzenp3 = *blank
7.03 c                   endif
7.03 c                   else
7.02 c                   eval      p_enp1 = jzenp1
7.02 c                   eval      p_enp2 = jzenp2
7.02 c                   eval      p_enp3 = jzenp3
7.02 c                   endif
7.03 c                   endif
7.03 c                   endif
7.03 c                   endif
      * Avbryter dersom enhet-1 ikke fylt ut på forpakningen
      *
     c                   if        jzenh1 = *blank
6.10 c                   eval      p_osts = '3'
     c                   leavesr
     c                   endif
6.24  *
6.24  * Hvis jzenh1-3 er like, så blankes noe
6.24  *
6.24  * alle like
6.24 c                   if        jzenh1 = jzenh2 and
6.24 c                             jzenh1 = jzenh3
6.24 c                   eval      jzenh2 = *blank
6.24 c                   eval      jzenh3 = *blank
6.24 c                   endif
6.24  * 1 og 2 er like
6.24 c                   if        jzenh1 = jzenh2
6.24 c                   if        jzenh3 = *blank
6.24 c                   eval      jzenh2 = *blank
6.24 c                   else
6.24 c                   eval      jzenh2 = jzenh3
6.24 c                   eval      jzenh3 = *blank
6.24 c                   endif
6.24 c                   endif
6.24  * 1 og 3 er like
6.24 c                   if        jzenh1 = jzenh3
6.24 c                   eval      jzenh3 = *blank
6.24 c                   endif
      *
      * Leser vare-pakning for å finne enhet-1 med omregningsfaktorer.
      *
     c                   eval      jvpkl1_vare = p_vare
6.33 c                   eval      jvpkl1_ldor = p_ldor
     c     jvpkl1_key    setll     jvpkl1
     c     jvpkl1_key    reade     jvpkl1
     c                   dow       not %eof
6.35  *
6.35  * sjekker fra / tildato
6.35 c                   exsr      sjekk_pkdato
6.35 c                   if        b_pakn = *on
      *
     c                   if        jzenh1 = jwenhe
      *
     c                   eval      p_enh1 = jwenhe
      *
6.14 c                   if        jwofak < 1000000
     c                   eval      w_ofv1 = jwofak
6.14 c                   else
6.14 c                   eval      w_ofv1 = 999999,999999
6.14 c                   eval      p_osts = 'P'
6.14 c                   leavesr
6.14 c                   endif
     c                   eval      w_ofp1 = jwofap
      *
     c                   if        w_ofv1 = 0
     c                   eval      w_ofv1 = 1
     c                   endif
     c                   if        w_ofp1 = 0
     c                   eval      w_ofp1 = w_ofv1
     c                   endif
      *
     c                   endif
6.35 c                   endif
      *
     c     jvpkl1_key    reade     jvpkl1
     c                   enddo
      *
      * Avbryter dersom enhet-1 ikke ble funnet
      *
     c                   if        p_enh1 = *blank
6.10 c                   eval      p_osts = '3'
     c                   leavesr
     c                   endif
6.10  *
6.10  * Finner pris enhet
6.10  *
6.10 c                   eval      p_enhe = jvpenh
      *
      * Leser vare-pakning for å finne prisenhet, enhet-2 og enhet-3
      * med omregningsfaktorer samt innkjøpsenheter og prisbokenheter
      *
     c     jvpkl1_key    setll     jvpkl1
     c     jvpkl1_key    reade     jvpkl1
     c                   dow       not %eof
6.35  *
6.35  * sjekker fra / tildato
6.35 c                   exsr      sjekk_pkdato
6.35 c                   if        b_pakn = *on
      *
6.3a  * tar var på vekt og m3 for. evt fraktbetingelse
6.3a c                   if        p_enhe = jwenhe  and
     c                             jwpakn <> '000'
6.3a c                   eval      w_vekt = jwvekt
6.3a c                   eval      w_volu = jwvolu
6.3a c                   endif
      *
      * *tar vare på vekt/volum/omregning for sikkerhets skyld på F-pak
6.3y c                   if        jwpakn = '001'
6.3y c                   eval      w_ofz1 = jwofak
6.3a c                   eval      w_vekx = jwvekt
6.3a c                   eval      w_volx = jwvolu
6.3y c                   endif
      *
6.10 c                   if        p_enhe <> *blank
     c                   if        jzeni1 = *blank
6.10 c                   eval      jzeni1 = p_enhe
     c                   endif
     c                   endif
      *
     c                   if        jwenhe = jzenh2
     c                   eval      p_enh2 = jwenhe
6.14 c                   if        jwofak < 1000000
     c                   eval      w_ofv2 = jwofak
6.14 c                   else
6.14 c                   eval      w_ofv2 = 999999,999999
6.14 c                   eval      p_osts = 'P'
6.14 c                   leavesr
6.14 c                   endif
     c                   eval      w_ofp2 = jwofap
     c                   if        w_ofv2 = 0
     c                   eval      w_ofv2 = 1
     c                   endif
     c                   if        w_ofp2 = 0
     c                   eval      w_ofp2 = w_ofv2
     c                   endif
     c                   endif
      *
     c                   if        jwenhe = jzenh3
     c                   eval      p_enh3 = jwenhe
6.14 c                   if        jwofak < 1000000
     c                   eval      w_ofv3 = jwofak
6.14 c                   else
6.14 c                   eval      w_ofv3 = 999999,999999
6.14 c                   eval      p_osts = 'P'
6.14 c                   leavesr
6.14 c                   endif
     c                   eval      w_ofp3 = jwofap
     c                   if        w_ofv3 = 0
     c                   eval      w_ofv3 = 1
     c                   endif
     c                   if        w_ofp3 = 0
     c                   eval      w_ofp3 = w_ofv3
     c                   endif
     c                   endif
      *
     c                   if        jwenhe = jzeni1
     c                   eval      p_eni1 = jwenhe
6.14 c                   if        jwofak < 1000000
     c                   eval      w_ofi1 = jwofak
6.14 c                   else
6.14 c                   eval      w_ofi1 = 999999,999999
6.14 c                   eval      p_osts = 'P'
6.14 c                   leavesr
6.14 c                   endif
     c                   if        w_ofi1 = 0
     c                   eval      w_ofi1 = 1
     c                   endif
     c                   endif
      *
     c                   if        jwenhe = jzeni2
     c                   eval      p_eni2 = jwenhe
6.14 c                   if        jwofak < 1000000
     c                   eval      w_ofi2 = jwofak
6.14 c                   else
6.14 c                   eval      w_ofi2 = 999999,999999
6.14 c                   eval      p_osts = 'P'
6.14 c                   leavesr
6.14 c                   endif
     c                   if        w_ofi2 = 0
     c                   eval      w_ofi2 = 1
     c                   endif
     c                   endif
      *
     c                   if        jwenhe = jzeni3
     c                   eval      p_eni3 = jwenhe
6.14 c                   if        jwofak < 1000000
     c                   eval      w_ofi3 = jwofak
6.14 c                   else
6.14 c                   eval      w_ofi3 = 999999,999999
6.14 c                   eval      p_osts = 'P'
6.14 c                   leavesr
6.14 c                   endif
     c                   if        w_ofi3 = 0
     c                   eval      w_ofi3 = 1
     c                   endif
     c                   endif
      *
     c                   select
     c                   when      jwenhe = jzenp1
     c                   eval      p_enp1 = jwenhe
     c                   when      jwenhe = jzenp2
     c                   eval      p_enp2 = jwenhe
     c                   when      jwenhe = jzenp3
     c                   eval      p_enp3 = jwenhe
     c                   endsl
      *
6.35 c                   endif
      *
     c     jvpkl1_key    reade     jvpkl1
     c                   enddo
      *
      * Avbryter dersom prisenhet ikke ble funnet
      *
     c                   if        p_enhe = *blank
6.10 c                   eval      p_osts = '3'
     c                   leavesr
     c                   endif
      *
      * Setter prisbokenhet lik første salgsenhet dersom prisbokenhet ikke
      * er valgt
      *
     c                   if        p_enp1 = *blank
     c                   eval      p_enp1 = p_enh1
7.02 c                   eval      p_enp2 = p_enh2
7.02 c                   eval      p_enp3 = p_enh3
     c                   endif
      *
      * Hvis vekt/volum ikke finnes på prisenhet, sjekk F-pak
     c                   if        w_vekt = 0 and
     c                             w_vekx <> 0 and
     c                             w_ofz1 <> 0
     c                   eval(h)   w_vekt = w_vekx * (1/w_ofz1)
     c                   endif
     c                   if        w_volu = 0 and
     c                             w_volx <> 0 and
     c                             w_ofz1 <> 0
     c                   eval(h)   w_volu = w_volx * (1/w_ofz1)
     c                   endif
      *
      * Finner omregningsfaktorer i forhold til enhet-1.
      * Omregningsfaktor pris enhet-1 beregnes som et forhold mellom
      * pris og volum på enhet-1. Omregningsfaktor pris enhet-2 og
      * enhet-3 beregnes i forhold til omregningsfaktor pris enhet-1
      *
     c                   eval(h)   p_ofp1 = w_ofp1 / w_ofv1
      *
     c                   eval(h)   p_ofv2 = w_ofv2 / w_ofv1
     c                   eval(h)   p_ofp2 = w_ofp2 / w_ofp1
      *
     c                   eval(h)   p_ofv3 = w_ofv3 / w_ofv1
     c                   eval(h)   p_ofp3 = w_ofp3 / w_ofp1
      *
     c                   eval(h)   p_ofi1 = w_ofi1 / w_ofv1
     c                   eval(h)   p_ofi2 = w_ofi2 / w_ofv1
     c                   eval(h)   p_ofi3 = w_ofi3 / w_ofv1
      *
      * Statistikkenhet og lagerenhet fra EVR må finnes som enhet på varen
      *
     c                   eval      vvarl1_vare = p_vare
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
      *
     c                   if        vvenhs = *blank or
     c                             vvenhl = *blank
6.10 c                   eval      p_osts = '3'
     c                   leavesr
     c                   endif
      *
7.06  * hvis logistikk-vare og det ikke er hovedlev, så ikke sjekk stat.enhet
      *
7.06 c                   if        (b_logv = *off) or
7.06 c                             (b_logv = *on and
7.06 c                              p_ldor = vvnlev)
      *
     c                   if        vvenhs <> p_enh1 and
     c                             vvenhs <> p_enh2 and
     c                             vvenhs <> p_enh3 and
     c                             vvenhs <> p_eni1 and
     c                             vvenhs <> p_eni2 and
     c                             vvenhs <> p_eni3
6.10 c                   eval      p_osts = '3'
     c                   leavesr
     c                   endif
      *
     c                   if        vvenhl <> p_enh1 and
     c                             vvenhl <> p_enh2 and
     c                             vvenhl <> p_enh3 and
     c                             vvenhl <> p_eni1 and
     c                             vvenhl <> p_eni2 and
     c                             vvenhl <> p_eni3
6.10 c                   eval      p_osts = '3'
     c                   leavesr
     c                   endif
7.06 c                   endif
      *
     c                   endif
      *
      *
     c                   endsr
      *
6.21  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.21  * Subrutine for henting av enheter - bruker nobb-rekkefølge
6.21  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.21  *
6.21 c     hent_enh_nobb begsr
6.21  *
6.3a c                   eval      w_vekt = 0
6.3a c                   eval      w_volu = 0
6.3y c                   eval      w_ofz1 = 0
6.3a c                   eval       w_vekx = 0
6.3a c                   eval       w_volx = 0
7.02 c                   eval      b_prib = *off
7.02 c                   eval      w_psenx = *Blank
7.02 c                   eval      w_pklaf = *Blank
7.02 c                   eval      w_pklad = *Blank
7.02 c                   eval      w_pklat = *Blank
7.03 c                   eval      w_m2enh = *Blank
6.25  *
6.25  * Prøver først å finne avvik på pakningsregister. da brukes dette.
6.25  * Leter etter enhet på varenivå.
6.25  *
6.25 c                   eval      jforl5_vare = p_vare
6.25 c     jforl5_key    chain     jforl5
6.25  *
6.25  * Dersom enhet ikke ble funnet på vare, letes det etter enheter på
6.25  * varegruppe og leverandør (hvor leverandør er vareeier).
6.25  * Dersom forpakning ikke finnes benyttes rekkefølgen fra vare-pakning.
6.25  *
6.25 c                   if        not %found
6.25  *
6.25 c                   eval      jforl1_ogrp = jvogrp
6.25 c                   eval      jforl1_hgrp = jvhgrp
6.25 c                   eval      jforl1_ugrp = jvugrp
6.25 c                   eval      jforl1_ldor = jvldor
6.25 c                   eval      jforl1_modn = jvmodn
6.25 c                   eval      jforl1_vare = *blank
6.25  *
6.25 c     jforl1_key    chain     jforl1
6.25 c                   if        not %found
6.25 c                   eval      jforl1_modn = 0
6.25 c     jforl1_key    chain     jforl1
6.25 c                   if        not %found
6.25 c                   eval      jforl1_ldor = 0
6.25 c     jforl1_key    chain     jforl1
6.25 c                   if        not %found
6.25 c                   eval      jforl1_ugrp = 0
6.25 c     jforl1_key    chain     jforl1
6.25 c                   if        not %found
6.25 c                   eval      jforl1_hgrp = 0
6.25 c     jforl1_key    chain     jforl1
6.25 c                   if        not %found
6.25 c                   goto      nobb_rekkef
6.25 c                   endif
6.25 c                   endif
6.25 c                   endif
6.25 c                   endif
6.25 c                   endif
6.25 c                   endif
     c                   if        jzenp1 <> *blank
     c                   eval      b_prib = *on
     c                   endif
6.25 c                   goto      ferdig_enh
6.21  *
6.25 c     nobb_rekkef   tag
6.21 c                   eval      jzenh1 = *blank
6.21 c                   eval      jzenh2 = *blank
6.21 c                   eval      jzenh3 = *blank
6.21 c                   eval      jzeni1 = *blank
6.21 c                   eval      jzeni2 = *blank
6.21 c                   eval      jzeni3 = *blank
6.21 c                   eval      jzenp1 = *blank
6.21 c                   eval      jzenp2 = *blank
6.21 c                   eval      jzenp3 = *blank
6.21 c                   eval      w_enh1 = *blank
6.21 c                   eval      w_enh2 = *blank
6.21 c                   eval      w_enh3 = *blank
6.3d c                   eval      w_eni1 = *blank
6.3d c                   eval      w_eni2 = *blank
6.3d c                   eval      w_eni3 = *blank
6.21 c                   eval      w_pak1 = *blank
6.21 c                   eval      w_pak2 = *blank
6.21 c                   eval      w_pak3 = *blank
6.21 c                   eval      w_penh = *blank
6.21 c                   eval      w_pakn = *blank
6.21 c                   eval      b_penh = *off
6.23 c                   eval      b_psen = *off
7.02 c*                   eval      w_psenx = *Blank
7.02 c*                   eval      w_pklaf = *Blank
7.02 c*                   eval      w_pklad = *Blank
7.02 c*                   eval      w_pklat = *Blank
6.21  *
6.21 c                   eval      jvpkl1_vare = p_vare
6.33 c                   eval      jvpkl1_ldor = p_ldor
6.21 c     jvpkl1_key    setll     jvpkl1
6.21 c     jvpkl1_key    reade     jvpkl1
6.21 c                   dow       not %eof(jvpkl1)
6.35  *
6.35  * sjekker fra / tildato
6.35 c                   exsr      sjekk_pkdato
6.35 c                   if        b_pakn = *on
6.21  *
6.21 c                   if        jwpakn = '000'
6.21 c                   eval      w_penh = jwenhe
6.21 c                   eval      w_pakn = jwpakn
6.21 c                   eval      w_pakp = jwpakn
6.21 c                   endif
6.21  *
6.21 c                   if        jwpakn <> '000'
7.02  ** behandle prisbokenhet
7.02 c*                   select
7.02 c*                   when      jwpsen = 1
7.02 c*                   eval      w_psenx  = jwenhe
7.02 c*                   when      jwpkla  = 'F'
7.02 c*                   eval      w_pklaf = jwenhe
7.02 c*                   when      jwpkla  = 'D'
7.02 c*                   eval      w_pklad = jwenhe
7.02 c*                   when      jwpkla  = 'T'
7.02 c*                   eval      w_pklat = jwenhe
7.02 c*                   endsl
7.02  **
6.21  *
6.21 c                   if        w_penh = jwenhe
6.21 c                   eval      w_pakp = jwpakn
6.21 c                   eval      b_penh = *on
6.21 c                   endif
6.23 c                   if        jwpsen = 1
6.22 c                   eval      w_psen = jwenhe
6.23 c                   eval      w_pspa = jwpakn
6.23 c                   eval      b_psen = *on
6.23 c                   endif
6.21  *
6.21 c                   select
6.21 c                   when      w_enh1 = *blank
6.21 c                   eval      w_enh1 = jwenhe
6.21 c                   eval      w_pak1 = jwpakn
6.21 c                   when      w_enh2 = *blank and
6.21 c                             jwenhe <> w_enh1
6.21 c                   eval      w_enh2 = jwenhe
6.21 c                   eval      w_pak2 = jwpakn
6.21 c                   when      w_enh3 = *blank and
6.21 c                             jwenhe <> w_enh1 and
6.21 c                             jwenhe <> w_enh2
6.21 c                   eval      w_enh3 = jwenhe
6.21 c                   eval      w_pak3 = jwpakn
6.21 c                   endsl
6.21  *
6.21  * innkjøpsenhet
6.34 c                   if        jwbest = 1
6.21 c                   select
6.21 c                   when      w_eni1 = *blank
6.21 c                   eval      w_eni1 = jwenhe
6.21 c                   when      w_eni2 = *blank and
6.3g c                             jwenhe <> w_eni1
6.21 c                   eval      w_eni2 = jwenhe
6.21 c                   when      w_eni3 = *blank and
6.3g c                             jwenhe <> w_eni1 and
6.3g c                             jwenhe <> w_eni2
6.21 c                   eval      w_eni3 = jwenhe
6.21 c                   endsl
6.21 c                   endif
6.21  *
6.21 c                   endif
6.35 c                   endif
6.21  *
6.21 c     jvpkl1_key    reade     jvpkl1
6.21 c                   enddo
6.21  *
6.22  * her testes om prisenhet ikke en del av de andre enhetene
6.22  * finner hvilken plass prisenhet skal få
6.23  * sjekker først om prisenhet er en av enh1-3
6.23 c                   if        w_penh <> *blank
6.23  *
6.23 c                   if        w_penh = w_enh1 or
6.23 c                             w_penh = w_Enh2 or
6.23 c                             w_penh = w_enh3
6.23 c                   goto      pse_enhet
6.23 c                   endif
6.23  * sjekker hvilken enhet skal byttes ut.
6.23 c                   if        w_enh1 = *blank
6.23 c                   eval      w_enh1 = w_penh
6.23 c                   eval      w_pak1 = w_pakn
6.23 c                   goto      pse_enhet
6.23 c                   endif
6.23 c                   if        w_enh2 = *blank
6.23 c                   eval      w_enh2 = w_penh
6.23 c                   eval      w_pak2 = w_pakn
6.23 c                   goto      pse_enhet
6.23 c                   endif
6.23 c                   if        w_enh3 = *blank
6.23 c                   eval      w_enh3 = w_penh
6.23 c                   eval      w_pak3 = w_pakn
6.23 c                   goto      pse_enhet
6.23 c                   endif
6.23  * ingen ledig plass
6.23  * her må man legge prisenhet i enht 3
6.23 c                   eval      w_enh3 = w_penh
6.23 c                   eval      w_pak3 = w_pakn
6.23  *
6.23 c                   endif
6.23  *
6.23 c     pse_enhet     tag
6.23  *
6.23  * sjekker først om pris.sammenl.enhet er en av enh1-3
6.23 c                   if        w_psen <> *blank
6.23  *
6.23 c                   if        w_psen = w_enh1 or
6.23 c                             w_psen = w_enh2 or
6.23 c                             w_psen = w_enh3
6.23 c                   goto      enh_videre
6.23 c                   endif
6.23  * sjekker hvilken enhet skal byttes ut.
6.23 c                   if        w_enh1 = *blank
6.23 c                   eval      w_enh1 = w_psen
6.23 c                   eval      w_pak1 = w_pspa
6.23 c                   goto      enh_videre
6.23 c                   endif
6.23 c                   if        w_enh2 = *blank
6.23 c                   eval      w_enh2 = w_psen
6.23 c                   eval      w_pak2 = w_pspa
6.23 c                   goto      enh_videre
6.23 c                   endif
6.23 c                   if        w_enh3 = *blank
6.23 c                   eval      w_enh3 = w_psen
6.23 c                   eval      w_pak3 = w_pspa
6.23 c                   goto      enh_videre
6.23 c                   endif
6.23  * ingen ledig plass
6.23  * her må man legge prisenhet i enht 3 hvis ikke
6.23  * prisenhet har blitt fylt ut her.
     c                   if        w_enh3 <> w_penh
6.23 c                   eval      w_enh3 = w_psen
6.23 c                   eval      w_pak3 = w_pspa
     c                   endif
6.23  *
6.23 c                   endif
6.23  *
6.23 c     enh_videre    tag
7.02  **
7.02  ** hvis prisenhet ikke satt på forpakning så settes de her
7.02  **
7.02 c*                   if        jzenp1 = *blank
7.02 c*                   if        w_psenx <> *blank
7.02 c*                   eval      jzenp1 = w_psenx
7.02 c*                   eval      jzenp2 = w_pklaf
7.02 c*                   eval      jzenp3 = w_pklad
7.02 c*                   else
7.02 c*                   if        w_pklaf <> *Blank
7.02 c*                   eval      jzenp1 = w_pklaf
7.02 c*                   eval      jzenp2 = w_pklad
7.02 c*                   eval      jzenp3 = w_pklat
7.02 c*                   endif
7.02 c*                   endif
7.02 c*                   eval      p_enp1 = jzenp1
7.02 c*                   eval      p_enp2 = jzenp2
7.02 c*                   eval      p_enp3 = jzenp3
7.02 c*                   endif
6.21  *
6.21  * her settes enhetene inn i variabler og det behandles videre
6.21  *
6.21 c                   eval      jzenh1 = w_enh1
6.21 c                   eval      jzenh2 = w_enh2
6.21 c                   eval      jzenh3 = w_enh3
6.21 c                   eval      jzeni1 = w_eni1
6.21 c                   eval      jzeni2 = w_eni2
6.21 c                   eval      jzeni3 = w_eni3
6.21  *
6.21  * her brukes enhets-rekkefølge, men uten behandling av prisenhet
6.21  *
6.21 c                   eval      jvpkl1_vare = p_vare
6.33 c                   eval      jvpkl1_ldor = p_ldor
6.21 c     jvpkl1_key    setll     jvpkl1
6.21 c     jvpkl1_key    reade     jvpkl1
6.21 c                   dow       not %eof
6.35  *
6.35  * sjekker fra / tildato
6.35 c                   exsr      sjekk_pkdato
6.35 c                   if        b_pakn = *on
6.21  *
6.21 c                   select
6.21 c                   when      jzenh1 = *blank
6.21 c                   eval      jzenh1 = jwenhe
6.21 c*                   eval      jzenp1 = jwenhe
6.21 c                   when      jzenh2 = *blank and
6.21 c                             jwenhe <> jzenh1
6.21 c                   eval      jzenh2 = jwenhe
6.21 c                   when      jzenh3 = *blank and
6.21 c                             jwenhe <> jzenh1 and
6.21 c                             jwenhe <> jzenh2
6.21 c                   eval      jzenh3 = jwenhe
6.21 c                   endsl
6.35 c                   endif
6.21  *
6.21 c     jvpkl1_key    reade     jvpkl1
6.21 c                   enddo
6.25  *
6.25 c     ferdig_enh    tag
6.21  *
6.21  * Avbryter dersom enhet-1 ikke fylt ut på forpakningen
6.21  *
6.21 c                   if        jzenh1 = *blank
6.21 c                   eval      p_osts = '3'
6.21 c                   leavesr
6.21 c                   endif
6.21  *
6.21  * Leser vare-pakning for å finne enhet-1 med omregningsfaktorer.
6.21  *
6.21 c                   eval      jvpkl1_vare = p_vare
6.33 c                   eval      jvpkl1_ldor = p_ldor
6.21 c     jvpkl1_key    setll     jvpkl1
6.21 c     jvpkl1_key    reade     jvpkl1
6.21 c                   dow       not %eof
6.35  *
6.35  * sjekker fra / tildato
6.35 c                   exsr      sjekk_pkdato
6.35 c                   if        b_pakn = *on
6.21  *
7.02 c                   if        jwpakn <> '000' and
     c                             b_prib = *off
7.02  * behandle prisbokenhet
7.02 c                   select
7.02 c                   when      jwpsen = 1
7.02 c                   eval      w_psenx  = jwenhe
7.02 c                   when      jwpkla  = 'F'
7.02 c                   eval      w_pklaf = jwenhe
7.02 c                   when      jwpkla  = 'D'
7.02 c                   eval      w_pklad = jwenhe
7.02 c                   when      jwpkla  = 'T'
7.02 c                   eval      w_pklat = jwenhe
7.02 c                   endsl
7.02 c                   endif
7.03 c                   if        jwenhe = 'M2'
7.03 c                   eval      w_m2enh = jwenhe
7.03 c                   endif
      *
6.21 c                   if        jzenh1 = jwenhe
6.21  *
6.21 c                   eval      p_enh1 = jwenhe
6.21  *
6.21 c                   if        jwofak < 1000000
6.21 c                   eval      w_ofv1 = jwofak
6.21 c                   else
6.21 c                   eval      w_ofv1 = 999999,999999
6.21 c                   eval      p_osts = 'P'
6.21 c                   leavesr
6.21 c                   endif
6.21 c                   eval      w_ofp1 = jwofap
6.21  *
6.21 c                   if        w_ofv1 = 0
6.21 c                   eval      w_ofv1 = 1
6.21 c                   endif
6.21 c                   if        w_ofp1 = 0
6.21 c                   eval      w_ofp1 = w_ofv1
6.21 c                   endif
6.21  *
6.21 c                   endif
6.35 c                   endif
6.21  *
6.21 c     jvpkl1_key    reade     jvpkl1
6.21 c                   enddo
7.02  *
7.02  * hvis prisenhet ikke satt på forpakning så settes de her
7.02  *
7.02 c                   if        jzenp1 = *blank
      *
7.02 c                   if        w_psenx <> *blank
      * start prisenhet  --------------
7.02 c                   eval      jzenp1 = w_psenx
      * enh2
7.05 c                   if        w_pklaf <> *blank and
7.05 c                             w_pklaf <> jzenp1
7.02 c                   eval      jzenp2 = w_pklaf
7.05 c                   else
7.05 c                   if        w_pklad <> *blank and
7.05 c                             w_pklad <> jzenp1
7.05 c                   eval      jzenp2 = w_pklad
7.05 c                   else
7.05 c                   if        w_pklat <> *blank and
7.05 c                             w_pklat <> jzenp1
7.05 c                   eval      jzenp2 = w_pklat
     c                   endif
7.05 c                   endif
7.05 c                   endif
7.05  * enh 3
7.05 c                   if        jzenp2 <> *blank
7.05 c                   if        jzenp3 = *blank  and
7.05 c                             w_pklad <> jzenp1 and
7.05 c                             w_pklad <> jzenp2
7.05 c                   eval      jzenp3 = w_pklad
7.05 c                   else
7.05 c                   if        w_pklat <> jzenp1 and
7.05 c                             w_pklat <> jzenp2
7.05 c                   eval      jzenp3 = w_pklat
7.05 c                   endif
7.03 c                   endif
7.05 c                   endif
7.05  *
7.02 c                   eval      p_enp1 = jzenp1
7.02 c                   eval      p_enp2 = jzenp2
7.02 c                   eval      p_enp3 = jzenp3
7.05  *--- slutt prisenhet ---------------------------
7.05 c                   else
7.03 c                   if        w_m2enh <> *blank
7.05  * start m2 ------------------------------------
7.03 c                   eval      jzenp1 = w_m2enh
7.05  * enh2
7.05 c                   if        w_pklaf <> *blank and
7.05 c                             w_pklaf <> jzenp1
7.05 c                   eval      jzenp2 = w_pklaf
7.05 c                   else
7.05 c                   if        w_pklad <> *blank and
7.05 c                             w_pklad <> jzenp1
7.05 c                   eval      jzenp2 = w_pklad
7.05 c                   else
7.05 c                   if        w_pklat <> *blank and
7.05 c                             w_pklat <> jzenp1
7.05 c                   eval      jzenp2 = w_pklat
7.05 c                   endif
7.05 c                   endif
7.05 c                   endif
7.05  * enh 3
7.05 c                   if        jzenp2 <> *blank
7.05 c                   if        jzenp3 = *blank  and
7.05 c                             w_pklad <> jzenp1 and
7.05 c                             w_pklad <> jzenp2
7.05 c                   eval      jzenp3 = w_pklad
7.05 c                   else
7.05 c                   if        w_pklat <> jzenp1 and
7.05 c                             w_pklat <> jzenp2
7.05 c                   eval      jzenp3 = w_pklat
7.05 c                   endif
7.05 c                   endif
7.05 c                   endif
7.05  *
7.02 c                   eval      p_enp1 = jzenp1
7.02 c                   eval      p_enp2 = jzenp2
7.02 c                   eval      p_enp3 = jzenp3
7.05  * slutt m2 ---------------------------------------------
7.03 c                   else
7.02 c                   if        w_pklaf <> *Blank
7.05  * start pklaf ------------------------------------------
7.02 c                   eval      jzenp1 = w_pklaf
      *
7.05 c                   if        w_pklad <> *blank
7.05 c                   eval      jzenp2 = w_pklad
7.05 c                   eval      jzenp3 = w_pklat
7.05 c                   else
7.05 c                   eval      jzenp2 = w_pklat
7.05 c                   eval      jzenp3 = *blank
7.03 c                   endif
7.05  * enh2
7.05 c                   if        w_pklad <> *blank and
7.05 c                             w_pklad <> jzenp1
7.05 c                   eval      jzenp2 = w_pklad
7.05 c                   else
7.05 c                   if        w_pklat <> *blank and
7.05 c                             w_pklat <> jzenp1
7.05 c                   eval      jzenp2 = w_pklat
7.05 c                   endif
7.05 c                   endif
7.05  * enh 3
7.05 c                   if        jzenp2 <> *blank
7.05 c                   if        jzenp3 = *blank  and
7.05 c                             w_pklad <> jzenp1 and
7.05 c                             w_pklad <> jzenp2
7.05 c                   eval      jzenp3 = w_pklad
7.05 c                   else
7.05 c                   if        w_pklat <> jzenp1 and
7.05 c                             w_pklat <> jzenp2
7.05 c                   eval      jzenp3 = w_pklat
7.05 c                   endif
7.05 c                   endif
7.05 c                   endif
7.05  *
7.05 c                   eval      p_enp1 = jzenp1
7.05 c                   eval      p_enp2 = jzenp2
7.05 c                   eval      p_enp3 = jzenp3
7.05  * slutt pklaf
      *
7.03 c                   else
7.02 c                   eval      p_enp1 = jzenp1
7.02 c                   eval      p_enp2 = jzenp2
7.02 c                   eval      p_enp3 = jzenp3
7.02 c                   endif
7.02 c                   endif
7.05 c                   endif
7.05 c                   else
7.02 c                   eval      p_enp1 = jzenp1
7.02 c                   eval      p_enp2 = jzenp2
7.02 c                   eval      p_enp3 = jzenp3
7.02 c                   endif
7.05  *
6.21  * Avbryter dersom enhet-1 ikke ble funnet
6.21  *
6.21 c                   if        p_enh1 = *blank
6.21 c                   eval      p_osts = '3'
6.21 c                   leavesr
6.21 c                   endif
6.21  *
6.21  * Finner pris enhet
6.21  *
6.21 c                   eval      p_enhe = jvpenh
6.21  *
6.21  * Leser vare-pakning for å finne prisenhet, enhet-2 og enhet-3
6.21  * med omregningsfaktorer samt innkjøpsenheter og prisbokenheter
6.21  *
6.21 c     jvpkl1_key    setll     jvpkl1
6.21 c     jvpkl1_key    reade     jvpkl1
6.21 c                   dow       not %eof
      *
6.3a  * tar var på vekt og m3 for. evt fraktbetingelse
6.3a c                   if        p_enhe = jwenhe
6.3a c                   eval      w_vekt = jwvekt
6.3a c                   eval      w_volu = jwvolu
6.3a c                   endif
      *
      * *tar vare på vekt/volum/omregning for sikkerhets skyld på F-pak
6.3y c                   if        jwpakn = '001'
6.3y c                   eval      w_ofz1 = jwofak
6.3a c                   eval      w_vekx = jwvekt
6.3a c                   eval      w_volx = jwvolu
6.3y c                   endif
6.35  *
6.35  * sjekker fra / tildato
6.35 c                   exsr      sjekk_pkdato
6.35 c                   if        b_pakn = *on
6.21  *
6.21 c                   if        p_enhe <> *blank
6.21 c                   if        jzeni1 = *blank
6.21 c                   eval      jzeni1 = p_enhe
6.21 c                   endif
6.21 c                   endif
6.21  *
6.21 c                   if        jwenhe = jzenh2
6.21 c                   eval      p_enh2 = jwenhe
6.21 c                   if        jwofak < 1000000
6.21 c                   eval      w_ofv2 = jwofak
6.21 c                   else
6.21 c                   eval      w_ofv2 = 999999,999999
6.21 c                   eval      p_osts = 'P'
6.21 c                   leavesr
6.21 c                   endif
6.21 c                   eval      w_ofp2 = jwofap
6.21 c                   if        w_ofv2 = 0
6.21 c                   eval      w_ofv2 = 1
6.21 c                   endif
6.21 c                   if        w_ofp2 = 0
6.21 c                   eval      w_ofp2 = w_ofv2
6.21 c                   endif
6.21 c                   endif
6.21  *
6.21 c                   if        jwenhe = jzenh3
6.21 c                   eval      p_enh3 = jwenhe
6.21 c                   if        jwofak < 1000000
6.21 c                   eval      w_ofv3 = jwofak
6.21 c                   else
6.21 c                   eval      w_ofv3 = 999999,999999
6.21 c                   eval      p_osts = 'P'
6.21 c                   leavesr
6.21 c                   endif
6.21 c                   eval      w_ofp3 = jwofap
6.21 c                   if        w_ofv3 = 0
6.21 c                   eval      w_ofv3 = 1
6.21 c                   endif
6.21 c                   if        w_ofp3 = 0
6.21 c                   eval      w_ofp3 = w_ofv3
6.21 c                   endif
6.21 c                   endif
6.21  *
6.21 c                   if        jwenhe = jzeni1
6.21 c                   eval      p_eni1 = jwenhe
6.21 c                   if        jwofak < 1000000
6.21 c                   eval      w_ofi1 = jwofak
6.21 c                   else
6.21 c                   eval      w_ofi1 = 999999,999999
6.21 c                   eval      p_osts = 'P'
6.21 c                   leavesr
6.21 c                   endif
6.21 c                   if        w_ofi1 = 0
6.21 c                   eval      w_ofi1 = 1
6.21 c                   endif
6.21 c                   endif
6.21  *
6.21 c                   if        jwenhe = jzeni2
6.21 c                   eval      p_eni2 = jwenhe
6.21 c                   if        jwofak < 1000000
6.21 c                   eval      w_ofi2 = jwofak
6.21 c                   else
6.21 c                   eval      w_ofi2 = 999999,999999
6.21 c                   eval      p_osts = 'P'
6.21 c                   leavesr
6.21 c                   endif
6.21 c                   if        w_ofi2 = 0
6.21 c                   eval      w_ofi2 = 1
6.21 c                   endif
6.21 c                   endif
6.21  *
6.21 c                   if        jwenhe = jzeni3
6.21 c                   eval      p_eni3 = jwenhe
6.21 c                   if        jwofak < 1000000
6.21 c                   eval      w_ofi3 = jwofak
6.21 c                   else
6.21 c                   eval      w_ofi3 = 999999,999999
6.21 c                   eval      p_osts = 'P'
6.21 c                   leavesr
6.21 c                   endif
6.21 c                   if        w_ofi3 = 0
6.21 c                   eval      w_ofi3 = 1
6.21 c                   endif
6.21 c                   endif
6.21  *
6.21 c*                   select
6.21 c*                   when      jwenhe = jzenp1
6.21 c*                   eval      p_enp1 = jwenhe
6.21 c*                   when      jwenhe = jzenp2
6.21 c*                   eval      p_enp2 = jwenhe
6.21 c*                   when      jwenhe = jzenp3
6.21 c*                   eval      p_enp3 = jwenhe
6.21 c*                   endsl
6.35 c                   endif
6.21  *
6.21 c     jvpkl1_key    reade     jvpkl1
6.21 c                   enddo
6.21  *
6.21  * Avbryter dersom prisenhet ikke ble funnet
6.21  *
6.21 c                   if        p_enhe = *blank
6.21 c                   eval      p_osts = '3'
6.21 c                   leavesr
6.21 c                   endif
7.02  * hvis ikke prisbokenhet satt, sett det lik salgsenhet
7.02 c                   if        p_enp1 = *blank
7.02 c                   eval      p_enp1 = p_enh1
7.02 c                   eval      p_enp2 = p_enh2
7.02 c                   eval      p_enp3 = p_enh3
7.02 c                   endif

6.21  *
      * Hvis vekt/volum ikke finnes på prisenhet, sjekk F-pak
     c                   if        w_vekt = 0 and
     c                             w_vekx <> 0  and
     c                             w_ofz1 <> 0
     c                   eval(h)   w_vekt = w_vekx * (1/ w_ofz1)
     c                   endif
     c                   if        w_volu = 0 and
     c                             w_volx <> 0 and
     c                             w_ofz1 <> 0
     c                   eval(h)   w_volu = w_volx * (1/w_ofz1)
     c                   endif
6.21  *
6.21  * Setter prisbokenhet lik første salgsenhet dersom prisbokenhet ikke
6.21  * er valgt
6.21  *
6.21 c                   if        p_enp1 = *blank
6.21 c                   eval      p_enp1 = p_enh1
6.21 c                   endif
6.21  *
6.21  * Finner omregningsfaktorer i forhold til enhet-1.
6.21  * Omregningsfaktor pris enhet-1 beregnes som et forhold mellom
6.21  * pris og volum på enhet-1. Omregningsfaktor pris enhet-2 og
6.21  * enhet-3 beregnes i forhold til omregningsfaktor pris enhet-1
6.21  *
6.21 c                   eval(h)   p_ofp1 = w_ofp1 / w_ofv1
6.21  *
6.21 c                   eval(h)   p_ofv2 = w_ofv2 / w_ofv1
6.21 c                   eval(h)   p_ofp2 = w_ofp2 / w_ofp1
6.21  *
6.21 c                   eval(h)   p_ofv3 = w_ofv3 / w_ofv1
6.21 c                   eval(h)   p_ofp3 = w_ofp3 / w_ofp1
6.21  *
6.21 c                   eval(h)   p_ofi1 = w_ofi1 / w_ofv1
6.21 c                   eval(h)   p_ofi2 = w_ofi2 / w_ofv1
6.21 c                   eval(h)   p_ofi3 = w_ofi3 / w_ofv1
6.21  *
6.21  * Statistikkenhet og lagerenhet fra EVR må finnes som enhet på varen
6.21  *
6.21 c                   eval      vvarl1_vare = p_vare
6.21 c     vvarl1_key    chain     vvarl1
6.21 c                   if        %found
6.21  *
6.21 c                   if        vvenhs = *blank or
6.21 c                             vvenhl = *blank
6.21 c                   eval      p_osts = '3'
6.21 c                   leavesr
6.21 c                   endif
6.21  *
7.06  * hvis logistikk-vare og det ikke er hovedlev, så ikke sjekk stat.enhet
      *
7.06 c                   if        (b_logv = *off) or
7.06 c                             (b_logv = *on and
7.06 c                              p_ldor = vvnlev)
      *
6.21 c                   if        vvenhs <> p_enh1 and
6.21 c                             vvenhs <> p_enh2 and
6.21 c                             vvenhs <> p_enh3 and
6.21 c                             vvenhs <> p_eni1 and
6.21 c                             vvenhs <> p_eni2 and
6.21 c                             vvenhs <> p_eni3
6.21 c                   eval      p_osts = '3'
6.21 c                   leavesr
6.21 c                   endif
6.21  *
6.21 c                   if        vvenhl <> p_enh1 and
6.21 c                             vvenhl <> p_enh2 and
6.21 c                             vvenhl <> p_enh3 and
6.21 c                             vvenhl <> p_eni1 and
6.21 c                             vvenhl <> p_eni2 and
6.21 c                             vvenhl <> p_eni3
6.21 c                   eval      p_osts = '3'
6.21 c                   leavesr
6.21 c                   endif
7.06 c                   endif
6.21  *
6.21 c                   endif
6.21  *
6.21 c                   endsr
6.10  *
6.10  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.10  * Sjekker om status 3 kan gjøres om til status U eller E
6.10  * U = vare utgått
6.10  * E = endring av enhet skje i overføringsrutinen
6.10  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.10  *
6.10 c     sjekk_sts3    begsr
6.10  *
6.10  * sjekker status S
6.10  *
6.10 c                   if        jvstat = 4
6.10 c                   eval      p_osts = 'S'
6.10 c                   leavesr
6.10 c                   endif
6.10 c
6.10 c                   eval      jvpglr_vare = p_vare
6.10 c     jvpglr_key    setll     jvpglr
6.10 c     jvpglr_key    reade     jvpglr
6.10 c                   dow       not %eof
6.10  *
6.10 c                   if        jwgenh = vvenhe
6.10  * finner om denne er salgsenhet 1
6.10 c                   eval      vvenl1_vare = p_vare
6.18 c                   eval      vvenl1_enhe = vvenhe
6.18 c     vvenl1_key2   chain     vvenl1
6.10 c                   if        not %found(vvenl1)
6.10 c                   leavesr
6.10 c                   endif
6.10 c                   if        vesaen > 1
6.10 c                   leavesr
6.10 c                   endif
6.10  * sjekker om omregningsfaktor på gml.pakn. er lik ny pakning
6.10 c
6.10 c                   eval      jvpkl1_vare = p_vare
6.33 c                   eval      jvpkl1_ldor = p_ldor
6.10 c     jvpkl1_key    setll     jvpkl1
6.10 c     jvpkl1_key    reade     jvpkl1
6.10 c                   dow       not %eof(jvpkl1)
6.35  *
6.35  * sjekker fra / tildato
6.35 c                   exsr      sjekk_pkdato
6.35 c                   if        b_pakn = *on
      *
6.10 c                   if        jwpakn = jwgpak and
6.10 c                             jwofak=  jwgofa
6.10  * status settes til E
6.10 c                   eval      p_osts = 'E'
6.10 c                   leavesr
6.10 c                   endif
6.35 c                   endif
6.10 c     jvpkl1_key    reade     jvpkl1
6.10 c                   enddo
6.10  *
6.10 c                   endif
6.10  *
6.10 c     jvpglr_key    reade     jvpglr
6.10 c                   enddo
6.10  *
6.10 c                   endsr
6.12  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.12  * Sjekker om status G oppstår
6.12  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.12  *
6.12 c     sjekk_gtin    begsr
6.12  *
6.12  * finner pakninger til enheter
6.12 c                   eval      jvpkl1_vare = p_vare
6.33 c                   eval      jvpkl1_ldor = p_ldor
6.12 c     jvpkl1_key    setll     jvpkl1
6.12 c     jvpkl1_key    reade     jvpkl1
6.12 c                   dow       not %eof
6.35  *
6.35  * sjekker fra / tildato
6.35 c                   exsr      sjekk_pkdato
6.35 c                   if        b_pakn = *on
      *
6.15 c                   eval      jlevlr_ldor = jwldor
6.15 c     jlevlr_key    chain     jlevlr
6.15 c                   if        %found(jlevlr) and
6.15 c                             ylenum <> 0 and
6.12 c                             jwgtin <> 0
6.12  *
6.12 c                   call      'VE710R  '
6.12 c                   parm                    w_firm
6.12 c                   parm                    jwgtin
6.12 c                   parm                    w_gvar
6.12 c                   parm                    w_genh
6.12 c                   parm                    w_gsta
6.12  *
6.12 c                   if        w_gvar <> *blank and
6.12 c                             w_gvar <> p_vare
6.12 c                   eval      p_osts = 'G'
6.12 c                   leavesr
6.12 c                   endif
6.12 c                   endif
6.12  *
6.35 c                   endif
6.12 c     jvpkl1_key    reade     jvpkl1
6.12 c                   enddo
6.12  *
6.12 c                   endsr
6.13  *
6.13  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.13  * Sjekker om status O - forskjellig omregningsfaktor i EVR /VA
6.13  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.13  *
6.13 c     sjekk_omre    begsr
6.13  * enh 1
     c                   if        p_enh1 <> *blank
6.13 c                   eval      vvenl1_vare = p_vare
6.13 c                   eval      vvenl1_enhe = p_enh1
6.13 c     vvenl1_key2   chain     vvenl1
6.13 c                   if        %found(vvenl1)  and
6.13 c                             veomre <> p_ofp1
6.13 c                   eval      p_osts = 'O'
6.13 c                   leavesr
6.13 c                   endif
6.13 c                   endif
6.13  * enh 2
     c                   if        p_enh2 <> *blank
6.13 c                   eval      vvenl1_vare = p_vare
6.13 c                   eval      vvenl1_enhe = p_enh2
6.13 c     vvenl1_key2   chain     vvenl1
6.13 c                   if        %found(vvenl1)  and
6.13 c                             veomre <> p_ofp2
6.13 c                   eval      p_osts = 'O'
6.13 c                   leavesr
6.13 c                   endif
6.13 c                   endif
6.13  * enh 3
     c                   if        p_enh3 <> *blank
6.13 c                   eval      vvenl1_vare = p_vare
6.13 c                   eval      vvenl1_enhe = p_enh3
6.13 c     vvenl1_key2   chain     vvenl1
6.13 c                   if        %found(vvenl1)  and
6.13 c                             veomre <> p_ofp3
6.13 c                   eval      p_osts = 'O'
6.13 c                   leavesr
6.13 c                   endif
6.13 c                   endif
6.13  *
6.13 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for henting av pris
      * Sjekker om priser er overstyrt i midlertidig prisregister eller
      * beregner priser ut i fra leste verdier.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_pris     begsr
      *
      * Beregner Nobb-pris, nettopris og kostpris påslagsbeløp
      * i.h.t. enhet-1
      *
     c                   eval(h)   p_nopr = p_nopr * w_ofv1
     c                   eval(h)   p_ntpr = p_ntpr * w_ofv1
     c                   eval(h)   p_kbel = p_kbel * w_ofv1
6.3e  * må også omregnes
6.3e c                   eval(h)   w_fkrt = w_fkrt  * w_ofv1
6.3e c*                  eval(h)   w_fkrt = w_fkrt
      *
6.3c c                   eval(h)   w_fprt = w_fprt
      * tonn og vekt påslag omregnes hvis prisenhet <> enhet1
6.3c c                   eval(h)   w_fton = w_fton * w_ofv1
6.3c c                   eval(h)   w_fkub = w_fkub * w_ofv1
      *
      * Henter eventuelle priser fra midlertidig pris-register
      *
     c                   eval      jwprl1_vare = p_vare
     c     jwprl1_key    chain     jwprl1
     c                   if        %found
     c                   eval      p_midl = 1
     c                   eval      p_inpr = jbinpr
     c                   eval      p_kopr = jbkopr
     c                   eval      p_s1pr = jbs1pr
     c                   eval      p_s2pr = jbs2pr
     c                   eval      p_s3pr = jbs3pr
     c                   goto      beregn
     c                   endif
      *
      * Innkjøpspris (betingelse) for enhet-1
      *
     c                   if        p_ntpr <> 0
     c                   eval      p_inpr = p_ntpr
     c                   else
     c                   eval(h)   p_inpr = p_nopr * p_ifak
     c                   endif
6.3a  *
6.3a  * Innkjøpspris2 (frakt)
6.3a  * Sendes som eget felt til kallende program, kallende program
6.3a  * beregner den endelige innkjøpsprisen. Frakt-faktor sendes også
6.3a  *
6.3a c                   eval      p_inp2 = p_inpr
6.3a c                   select
6.3a c                   when      w_fkrt <> 0
6.3a c                   eval      p_inp2 = p_inpr + w_fkrt
6.3a c                   when      w_fprt <> 0
6.3a c                   eval(h)   p_inp2 = p_inpr + p_inpr * (w_fprt/100)
6.3a c                   when      w_fton <> 0 and w_vekt <> 0
6.3a c                   eval(h)   p_inp2 = p_inpr +
6.3a c                                      w_fton * (w_vekt /1000000)
6.3a c                   when      w_fkub <> 0
6.3a c                   eval(h)   p_inp2 = p_inpr +
6.3a c                                      w_fkub * w_volu
6.3a c                   endsl
6.3a c                   eval(h)   p_ffak = p_inp2 / p_inpr
      *
      * Kostpris for enhet-1
      *
6.3a c                   eval(h)   p_kopr = (p_inp2 * p_kfak) + p_kbel
6.22  *
6.22  * Hvis påslag sier at "salgspris skal være lik hovedleverandørs", så
6.22  * behandles det her.
6.3o c                   if        jcsphl = 1  and
6.3o c                             w_s1pr <> 0
6.22 c                   eval(h)   p_s1pr = w_s1pr
6.22 c                   else
7.04 c                   if        jcsphl = 2  and
7.04 c                             w_s1pr <> 0 and
7.04 c                             w_kopr <> 0
7.04 c                   eval(h)   p_s1pr = w_s1pr
7.04 c                   eval(h)   p_kopr = w_kopr
7.04 c                   else
      *
      * Salgspris enhet-1, enhet-2 og enhet-3
      * Dersom kalkylekode = 1 regnes salspris fra nobbpris ellers regnes
      * salgspris fra kostpris
      *
     c                   if        jlkkal = 1
     c                   eval(h)   p_s1pr = p_nopr * p_sfak * p_ofp1
     c                   else
     c                   eval(h)   p_s1pr = p_kopr * p_sfak * p_ofp1
     c                   endif
6.22  *
6.22 c                   endif
7.04 c                   endif
      *
6.38a * her bergnes salgspris 2 og 3 ut fra salgpris 1
6.38a *
6.38ac                   eval(h)   p_s2pr = p_s1pr * p_ofp2
6.38ac                   eval(h)   p_s3pr = p_s1pr * p_ofp3
6.38a *
      * hvis BMP avrunding
6.3t c                   if        jcsphl = 0 and
6.3t c                             p_avrund = 'BMP'
6.38ac**                           jlkkal = 0
6.31 c                   eval      w_ogrp = jvogrp
6.31 c                   eval      w_hgrp = jvhgrp
6.31 c                   eval      w_ugrp = jvugrp
6.37 c*                  eval      w_ldor = jvldor
6.37 c                   eval      w_ldor = p_ldor
6.31 c                   eval      w_modn = jvmodn
6.31  * her beregnes pris innkl. mva
6.3f c                   eval(h)   p_s1im = p_s1pr + (p_s1pr * w_mvap/100)
6.3f c                   eval(h)   p_s2im = p_s2pr + (p_s2pr * w_mvap/100)
6.3f c                   eval(h)   p_s3im = p_s3pr + (p_s3pr * w_mvap/100)
6.30 c                   call      'FA911R'
6.30 c                   parm                    w_firm
6.30 c                   parm                    w_ogrp
6.30 c                   parm                    w_hgrp
6.30 c                   parm                    w_ugrp
6.30 c                   parm                    w_ldor
6.30 c                   parm                    w_modn
6.30 c                   parm                    p_vare
6.30 c                   parm                    p_s1im
6.38 c                   parm                    p_s2im
6.38 c                   parm                    p_s3im
6.38 c                   parm                    p_enh1
6.38 c                   parm                    p_enh2
6.38 c                   parm                    p_enh3
6.38 c                   parm                    p_type
6.30  *
6.30  * her trekkes mva ut fra avrundede pris (en av de er avrundet)
6.30  *
6.38 c                   select
6.38 c                   when      p_type = 1
6.31 c                   eval      p_s1pr = p_s1im * w_mvaf
6.38 c                   eval(h)   p_s2pr = p_s1pr * p_ofp2
6.38 c                   eval(h)   p_s3pr = p_s1pr * p_ofp3
6.38  *
6.38 c                   when      p_type = 2
6.31 c                   eval      p_s2pr = p_s2im * w_mvaf
6.38 c                   eval(h)   w_ofx1 = w_ofv1 / w_ofv2
6.38 c                   eval(h)   w_ofx3 = w_ofv3 / w_ofv2
6.38 c                   eval(h)   p_s1pr = p_s2pr * w_ofx1
6.38 c                   eval(h)   p_s3pr = p_s2pr * w_ofx3
6.38  *
6.38 c                   when      p_type = 3
6.31 c                   eval      p_s3pr = p_s3im * w_mvaf
6.38 c                   eval(h)   w_ofx1 = w_ofv1 / w_ofv3
6.38 c                   eval(h)   w_ofx2 = w_ofv2 / w_ofv3
6.38 c                   eval(h)   p_s1pr = p_s3pr * w_ofx1
6.38 c                   eval(h)   p_s2pr = p_s3pr * w_ofx2
6.39 c*                  other
6.39 c*                  eval      p_s1pr = p_s1im * w_mvaf
6.39 c*                  eval(h)   p_s2pr = p_s1pr * w_ofp2
6.39 c*                  eval(h)   p_s3pr = p_s1pr * w_ofp3
6.38 c                   endsl
6.30  *
6.30 c                   endif
      *
     c     beregn        tag
      *
      *
      * Salgspris enhet-1 inkl. moms
      *
     c                   eval      p_s1im = p_s1pr + (p_s1pr * w_mva / 100)
      *
6.30 c                   if        p_s1im <> 0  and
6.30 c                             p_avrund <> 'BMP'
     c                   eval      w_kode = 4
     c                   call      'FA909R'
     c                   parm                    w_firm
     c                   parm                    p_vare
     c                   parm                    w_kode
     c                   parm                    p_s1im
     c                   endif
      *
      * Salgspris enhet-2 inkl. moms
      *
     c                   eval      p_s2im = p_s2pr + (p_s2pr * w_mva / 100)
      *
6.30 c                   if        p_s2im <> 0 and
6.30 c                             p_avrund <> 'BMP'
     c                   eval      w_kode = 4
     c                   call      'FA909R'
     c                   parm                    w_firm
     c                   parm                    p_vare
     c                   parm                    w_kode
     c                   parm                    p_s2im
     c                   endif
      *
      * Salgspris enhet-3 inkl. moms
      *
     c                   eval      p_s3im = p_s3pr + (p_s3pr * w_mva / 100)
      *
6.30 c                   if        p_s3im <> 0 and
6.30 c                             p_avrund <> 'BMP'
     c                   eval      w_kode = 4
     c                   call      'FA909R'
     c                   parm                    w_firm
     c                   parm                    p_vare
     c                   parm                    w_kode
     c                   parm                    p_s3im
     c                   endif
      *
      * Dekningsgrad (DG)
      *
     c                   if        p_kopr <> 0
     c                   eval(h)   p_dekn = 100 - ((p_kopr * 100) / p_s1pr)
     c                   endif
5.60  *
6.10 c                   if        p_osts = *blank
6.3k c                   if        p_dekn <  0
6.10 c                   eval      p_osts = '7'
5.60 c                   endif
5.60 c                   endif
      *
     c                   endsr
6.35  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.35  * Subrutine for å sjekke om dato er innenfor fra /til dato
6.35  * hvis *loval i begge datoer = ok
6.35  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.35  *
6.35 c     sjekk_pkdato  begsr
6.35  *
6.35 c                   eval      b_pakn = *on
6.35  *
6.35 c                   if        jwfdat = *loval and
6.35 c                             jwtdat = *loval
6.35 c                   leavesr
6.35 c                   endif
6.35  *
6.35 c                   if        jwfdat <= w_udat and
6.35 c                             jwtdat >  w_udat
6.35 c                   leavesr
6.35 c                   endif
6.35  *
6.35 c                   if        jwfdat = *loval  and
6.35 c                             jwtdat >  w_udat
6.35 c                   leavesr
6.35 c                   endif
6.35  *
6.35 c                   if        jwfdat <= w_udat and
6.35 c                             jwtdat =  *loval
6.35 c                   leavesr
6.35 c                   endif
6.35  *
6.35 c                   eval      b_pakn = *off
6.35  *
6.35 c                   endsr
6.35  *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ERROR-rutine
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *pssr         begsr
      *
6.10 c                   eval      p_osts = '9'
     c                   goto      avslutt
      *
     c                   endsr
      *
      *
6.3h  *
6.3h  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3h  * Subrutine for å sjekke at lest betingelser er innenfor evt. dato
6.3h  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3h  *
6.3h c     sjekk_dato    begsr
6.3h  *
6.3h c                   eval      b_bdat = *off
6.3h c                   if        (jpfdat = *loval and
6.3h c                             jptdat = *loval) or
6.3h c                             (w_udat >= jpfdat and
6.3h c                             w_udat <= jptdat) or
6.3h c                             (jpfdat = *loval  and
6.3h c                             w_udat <= jptdat) or
6.3h c                             (w_udat >= jpfdat and
6.3h c                             jptdat = *loval)
6.3h c                   eval      b_bdat = *on
6.3h c                   endif
6.3h  *
6.3h c                   endsr
6.3m  *
6.3m  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3m  * Subrutine for å om det finnes enheter på best/ordre som ikke   o
6.3m  * ligger i enhet 1-3
6.3m  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3m  *
6.3m c     sjekk_orbe    begsr
6.3m  *
6.3n c                   eval      vvarl1_vare = p_vare
6.3n c     vvarl1_key    chain     vvarl1
6.3n c                   if        not %found(vvarl1)
6.3n c                   leavesr
6.3n c                   endif
      *
6.3m c                   eval      b_orbe = *off
6.3m c                   eval      fodtlv_vare = p_vare
6.3m c     fodtlv_key    setll     fodtlv
6.3m c     fodtlv_key    reade     fodtlv
6.3m c                   dow       not %eof(fodtlv)
6.3m c                   if        fdenh1 <> p_enh1 and
6.3m c                             fdenh1 <> p_enh2 and
6.3m c                             fdenh1 <> p_enh3
6.3m c                   eval      b_orbe = *on
6.3m c                   leavesr
6.3m c                   endif
6.3m c     fodtlv_key    reade     fodtlv
6.3m c                   enddo
6.3m  *
6.3m c                   eval      lodtlv_vare = p_vare
6.3m c     lodtlv_key    setll     lodtlv
6.3m c     lodtlv_key    reade     lodtlv
6.3m c                   dow       not %eof(lodtlv)
     c                   if        ldldor = jlenum
6.3m c                   if        ldenh1 <> p_eni1 and
6.3m c                             ldenh1 <> p_eni2 and
6.3m c                             ldenh1 <> p_eni3
6.3m c                   eval      b_orbe = *on
6.3m c                   leavesr
6.3m c                   endif
6.3m c                   endif
6.3m c     lodtlv_key    reade     lodtlv
6.3m c                   enddo
6.3m  *
6.3m c                   endsr
6.3p  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3p  * Henter valuta for kode
6.3p  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3p  *
6.3p c     valuta        begsr
6.3p c                   move      jxvalu        ra16l1_pkod
6.3p c     ra16l1_key    chain     ra16l1
6.3p  *
6.3p c                   if        %found(ra16l1)
6.3p  *
6.3p c                   if        w_udat > rapkda
6.3p c                   eval      w_kurs = rapmku
6.3p c                   else
6.3p c                   eval      w_kurs = rapmkg
6.3p c                   endif
6.3p c                   endif
6.3p c                   endsr
6.3q  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3q  * Finn info om logistikkvare for riktig prisgiver
6.3q  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3q  *
6.3q c     finn_logivar  begsr
6.3q  *
6.3q c                   eval      b_logv = *off
6.3q c/exec sql
6.3q c+ select a.jvvare,
6.3q c+        b.jvkldo,
6.3q c+        c.jvquno,
6.3q c+        c.jvqofa,
6.3q c+    (select d.jvmodn from jvarpf d where d.jvnobb = c.jvquno)
6.3q c+ into   :w_lv_vare,
6.3q c+        :w_lv_kldo,
6.3q c+        :w_lv_nobb,
6.3q c+        :w_lv_ofak,
6.3q c+        :w_lv_modn
6.3q c+ from   jvarpf a
6.3q c+ inner join jvkhpf b on jvkvnr = jvvare and jvkfir = :w_firm
6.3q c+ inner join jvklpf c on jvqvnr = jvvare and jvqfir = :w_firm
6.3q c+ where  jvqvnr = :jvvare
6.3q c+    and jvqldo = :p_ldor fetch first 1 rows only
6.3q c/end-exec
6.3q  *
6.3q c                   if        sqlcod = 100 or sqlstt = '02000'
6.3q c                   leavesr
6.3q c                   endif
6.3q c                   if        sqlcod <> 0
6.3q c                   leavesr
6.3q c                   endif
6.3q  *
6.3q c                   eval      b_logv = *on
6.3q  *
6.3q c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_firm
     c                   parm                    p_vare
5.70 c                   parm                    p_prgr
     c                   parm                    p_pgiv
     c                   parm                    p_pkod
     c                   parm                    p_skod
     c                   parm                    p_lety
     c                   parm                    p_gprk
6.38 c                   parm                    p_dato
6.38 c                   parm                    p_utgp
      *
     c                   parm                    p_osts
      *
     c                   parm                    p_ldor
     c                   parm                    p_lvar
     c                   parm                    p_eldo
     c                   parm                    p_nopr
     c                   parm                    p_gdat
      *
     c                   parm                    p_enhe
     c                   parm                    p_enh1
     c                   parm                    p_enh2
     c                   parm                    p_enh3
     c                   parm                    p_eni1
     c                   parm                    p_eni2
     c                   parm                    p_eni3
     c                   parm                    p_enp1
     c                   parm                    p_enp2
     c                   parm                    p_enp3
     c                   parm                    p_ofp1
     c                   parm                    p_ofp2
     c                   parm                    p_ofp3
     c                   parm                    p_ofv2
     c                   parm                    p_ofv3
     c                   parm                    p_ofi1
     c                   parm                    p_ofi2
     c                   parm                    p_ofi3
      *
     c                   parm                    p_bldo
     c                   parm                    p_bogr
     c                   parm                    p_bhgr
     c                   parm                    p_bugr
     c                   parm                    p_bmod
     c                   parm                    p_bvar
     c                   parm                    p_bvty
     c                   parm                    p_blet
     c                   parm                    p_bbet
     c                   parm                    p_ntpr
     c                   parm                    p_ifak
      *
     c                   parm                    p_pogr
     c                   parm                    p_phgr
     c                   parm                    p_pugr
     c                   parm                    p_pldo
     c                   parm                    p_pmod
     c                   parm                    p_pvar
     c                   parm                    p_ppko
     c                   parm                    p_pvty
     c                   parm                    p_plet
     c                   parm                    p_kfak
     c                   parm                    p_kbel
     c                   parm                    p_sfak
      *
     c                   parm                    p_midl
     c                   parm                    p_inpr
     c                   parm                    p_kopr
     c                   parm                    p_s1pr
     c                   parm                    p_s1im
     c                   parm                    p_s2pr
     c                   parm                    p_s2im
     c                   parm                    p_s3pr
     c                   parm                    p_s3im
     c                   parm                    p_dekn
     c                   parm                    p_prut
6.3a c                   parm                    p_ffak
6.3a c                   parm                    p_inp2
6.3x c                   parm                    p_pgbe
6.3y c                   parm                    p_pgfr
6.3y c                   parm                    p_oppd
      *
     c     *dtaara       define    *lda          lda
      *
      *
      * Key for oppslag på vare
      *
     c     jvarl1_key    klist
     c                   kfld                    jvarl1_vare
      *
      * Key for oppslag på vare-pris
      *
     c     jvprl1_key    klist
     c                   kfld                    jvprl1_vare
     c                   kfld                    jvprl1_ldor
      *
      * Key for oppslag på vare-pakning
      *
     c     jvpkl1_key    klist
     c                   kfld                    jvpkl1_vare
6.33 c                   kfld                    jvpkl1_ldor
      *
      * Key for oppslag på vare-pakning - gammel
      *
     c     jvpglr_key    klist
     c                   kfld                    jvpglr_vare
      *
      * Key for oppslag på forpakning m/varenummer
      *
     c     jforl5_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jforl5_vare
      *
      * Key for oppslag på forpakning
      *
     c     jforl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jforl1_ogrp
     c                   kfld                    jforl1_hgrp
     c                   kfld                    jforl1_ugrp
     c                   kfld                    jforl1_ldor
     c                   kfld                    jforl1_modn
     c                   kfld                    jforl1_vare
      *
      * Key for oppslag på betingelse
      *
     c     jbetlb_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jbetlb_ldor
     c                   kfld                    jbetlb_vare
6.3x c                   kfld                    jbetlb_prgr
     c                   kfld                    jbetlb_vtyp
     c                   kfld                    jbetlb_lety
      *
     c     jbetlc_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jbetlc_ldor
     c                   kfld                    jbetlc_modn
     c                   kfld                    jbetlc_vare
6.3x c                   kfld                    jbetlc_prgr
     c                   kfld                    jbetlc_vtyp
     c                   kfld                    jbetlc_lety
      *
     c     jbetl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jbetl1_ldor
6.3x c                   kfld                    jbetl1_prgr
     c                   kfld                    jbetl1_ogrp
     c                   kfld                    jbetl1_hgrp
     c                   kfld                    jbetl1_ugrp
     c                   kfld                    jbetl1_modn
     c                   kfld                    jbetl1_vare
     c                   kfld                    jbetl1_vtyp
     c                   kfld                    jbetl1_lety
      *
      * Key for les på rabattelement
      *
     c     jrael1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jrael1_eldo
6.3x c                   kfld                    jrael1_eprg
     c                   kfld                    jrael1_eogr
     c                   kfld                    jrael1_ehgr
     c                   kfld                    jrael1_eugr
     c                   kfld                    jrael1_emod
     c                   kfld                    jrael1_evar
     c                   kfld                    jrael1_evty
     c                   kfld                    jrael1_elet
     c                   kfld                    jrael1_ebrs
     c                   kfld                    jrael1_ebli
      *
     c     jrael4_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jrael4_eldo
6.3x c                   kfld                    jrael4_eprg
     c                   kfld                    jrael4_eogr
     c                   kfld                    jrael4_ehgr
     c                   kfld                    jrael4_eugr
     c                   kfld                    jrael4_emod
     c                   kfld                    jrael4_evar
     c                   kfld                    jrael4_evty
     c                   kfld                    jrael4_elet
     c                   kfld                    jrael4_ebrs
     c                   kfld                    jrael4_ebli
     c                   kfld                    jrael4_eakt
6.3a  *
6.3a  * Key for oppslag på frakt
6.3a  *
6.3a c     jfbelb_key    klist
6.3a c                   kfld                    w_firm
6.3a c                   kfld                    jfbelb_fldo
6.3a c                   kfld                    jfbelb_fvar
6.3x c                   kfld                    jfbelb_fprg
6.3a c                   kfld                    jfbelb_fvty
6.3a c                   kfld                    jfbelb_flet
6.3a  *
6.3a c     jfbelc_key    klist
6.3a c                   kfld                    w_firm
6.3a c                   kfld                    jfbelc_fldo
6.3a c                   kfld                    jfbelc_fmod
6.3a c                   kfld                    jfbelc_fvar
6.3x c                   kfld                    jfbelc_fprg
6.3a c                   kfld                    jfbelc_fvty
6.3a c                   kfld                    jfbelc_flet
6.3a  *
6.3a c     jfbel1_key    klist
6.3a c                   kfld                    w_firm
6.3a c                   kfld                    jfbel1_fldo
6.3x c                   kfld                    jfbel1_fprg
6.3a c                   kfld                    jfbel1_fogr
6.3a c                   kfld                    jfbel1_fhgr
6.3a c                   kfld                    jfbel1_fugr
6.3a c                   kfld                    jfbel1_fmod
6.3a c                   kfld                    jfbel1_fvar
6.3a c                   kfld                    jfbel1_fvty
6.3a c                   kfld                    jfbel1_flet
      *
      * Key for oppslag på påslagsfaktor
      *
     c     jpfala_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jpfala_vare
5.70 c                   kfld                    jpfala_prgr
     c                   kfld                    jpfala_ldor
     c                   kfld                    jpfala_kpri
     c                   kfld                    jpfala_vtyp
     c                   kfld                    jpfala_lety
      *
     c     jpfalb_key    klist
     c                   kfld                    w_firm
5.70 c                   kfld                    jpfalb_prgr
     c                   kfld                    jpfalb_modn
     c                   kfld                    jpfalb_ldor
     c                   kfld                    jpfalb_vare
     c                   kfld                    jpfalb_kpri
     c                   kfld                    jpfalb_vtyp
     c                   kfld                    jpfalb_lety
      *
     c     jpfal1_key    klist
     c                   kfld                    w_firm
5.70 c                   kfld                    jpfal1_prgr
     c                   kfld                    jpfal1_ogrp
     c                   kfld                    jpfal1_hgrp
     c                   kfld                    jpfal1_ugrp
     c                   kfld                    jpfal1_ldor
     c                   kfld                    jpfal1_modn
     c                   kfld                    jpfal1_vare
     c                   kfld                    jpfal1_kpri
     c                   kfld                    jpfal1_vtyp
     c                   kfld                    jpfal1_lety
      *
      * Key for oppslag på midlertidig pris
      *
     c     jwprl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jwprl1_vare
      *
      * Key for oppslag på leverandør
      *
     c     jlevl1_key    klist
     c                   kfld                    jlevl1_ldor
6.15  *
6.15  * Key for oppslag på leverandør
6.15  *
6.15 c     jlevlr_key    klist
6.15 c                   kfld                    jlevlr_ldor
      *
      * Key for oppslag på EVR-vare
      *
     c     vvarl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl1_vare
      *
      * Key for oppslag på EVR-vare-enhet
      *
     c     vvenl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvenl1_vare
6.13  *
6.13  * Key for oppslag på EVR-vare-enhet
6.13  *
6.13 c     vvenl1_key2   klist
6.13 c                   kfld                    w_firm
6.13 c                   kfld                    vvenl1_vare
6.13 c                   kfld                    vvenl1_enhe
      *
      * Key for oppslag på undergruppe
      *
     c     vugrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vugrl1_uogr
     c                   kfld                    vugrl1_uhgr
     c                   kfld                    vugrl1_uugr
6.16  *
6.16  * Key for oppslag på EVR-lager
6.16  *
6.16 c     vlagl1_key    klist
6.16 c                   kfld                    w_firm
6.16 c                   kfld                    vlagl1_vare
6.16  *
6.16  * Key for oppslag på JVDTPF
6.16  *
6.16 c     jvdtl1_key    klist
6.16 c                   kfld                    w_firm
6.16 c                   kfld                    jvdtl1_dvar
6.21  *
6.21  * Key for oppslag på status
6.21  *
6.21 c     jstsl1_key    klist
6.21 c                   kfld                    w_firm
6.39  *
6.39  * Key for les på vare-leverandør
6.39  *
6.39 c     jvlelr_key    klist
6.39 c                   kfld                    jvlelr_lvnr
6.39 c                   kfld                    jvlelr_lldo
6.3m  *
6.3m  * Key for oppslag på ordre
6.3m  *
6.3m c     fodtlv_key    klist
6.3m c                   kfld                    w_firm
6.3m c                   kfld                    fodtlv_vare
6.3m  *
6.3m  * Key for oppslag på bestilling
6.3m  *
6.3m c     lodtlv_key    klist
6.3m c                   kfld                    w_firm
6.3m c                   kfld                    lodtlv_vare
6.3p  *
6.3p  * Key for valutakoder
6.3p  *
6.3p c     ra16l1_key    klist
6.3p c                   kfld                    w_firm
6.3p c                   kfld                    ra16l1_pkod
      *
      *
      * Henter firma fra parameter
      *
     c                   eval      w_firm = p_firm
      *
      * Nullstiller resultatparametre før behandling.
      *
6.10 c                   eval      p_osts = *blank
      *
     c                   eval      p_ldor = 0
     c                   eval      p_lvar = *blank
     c                   eval      p_eldo = 0
     c                   eval      p_nopr = 0
     c                   eval      p_gdat = *loval
      *
     c                   eval      p_enhe = *blank
     c                   eval      p_enh1 = *blank
     c                   eval      p_enh2 = *blank
     c                   eval      p_enh3 = *blank
     c                   eval      p_eni1 = *blank
     c                   eval      p_eni2 = *blank
     c                   eval      p_eni3 = *blank
     c                   eval      p_enp1 = *blank
     c                   eval      p_enp2 = *blank
     c                   eval      p_enp3 = *blank
     c                   eval      p_ofp1 = 0
     c                   eval      p_ofp2 = 0
     c                   eval      p_ofp3 = 0
     c                   eval      p_ofv2 = 0
     c                   eval      p_ofv3 = 0
     c                   eval      p_ofi1 = 0
     c                   eval      p_ofi2 = 0
     c                   eval      p_ofi3 = 0
      *
     c                   eval      p_bldo = 0
     c                   eval      p_bogr = 0
     c                   eval      p_bhgr = 0
     c                   eval      p_bugr = 0
     c                   eval      p_bmod = 0
     c                   eval      p_bvar = *blank
     c                   eval      p_bvty = *blank
     c                   eval      p_blet = 0
     c                   eval      p_bbet = *blank
     c                   eval      p_ntpr = 0
     c                   eval      p_ifak = 0
      *
     c                   eval      p_pogr = 0
     c                   eval      p_phgr = 0
     c                   eval      p_pugr = 0
     c                   eval      p_pldo = 0
     c                   eval      p_pmod = 0
     c                   eval      p_pvar = *blank
     c                   eval      p_ppko = *blank
     c                   eval      p_pvty = *blank
     c                   eval      p_plet = 0
     c                   eval      p_kfak = 0
     c                   eval      p_kbel = 0
     c                   eval      p_sfak = 0
      *
     c                   eval      p_midl = 0
     c                   eval      p_inpr = 0
6.3a c                   eval      p_inp2 = 0
     c                   eval      p_kopr = 0
     c                   eval      p_s1pr = 0
     c                   eval      p_s1im = 0
     c                   eval      p_s2pr = 0
     c                   eval      p_s2im = 0
     c                   eval      p_s3pr = 0
     c                   eval      p_s3im = 0
     c                   eval      p_dekn = 0
5.70 c                   eval      p_prut = p_prgr
5.70 c                   eval      p_pgbe = p_prgr
5.3y c                   eval      p_pgfr = p_prgr
6.3a c                   eval      p_ffak = 1
6.3p c                   eval      w_kurs = 1
7.01  *
7.01  * Endring 7.01
7.01  *
7.01   CallP CO402R(l_filg:w_firm:0:'JV750R_701':
7.01                    co402_verdi1:co402_verdi2);
7.01   if co402_verdi1 = '1';
7.01     u_701 = *on;
7.01   endif;
      *
      * Bestemmer varetype utifra skaffekode
      *
     c                   if        p_skod = 1
     c                   eval      w_vtyp = 'S'
     c                   else
     c                   eval      w_vtyp = *blank
     c                   endif
6.17 c                   time                    w_udat
      *
      * Hardkodet mva-faktoer
      *
     c                   eval      w_mva = 25
6.21  *
6.21  * Leser statuskode
6.21  *
6.21 c     jstsl1_key    chain     jstsl1
6.31  *
6.31  * Finner mva-sats
6.31  *
6.31 c                   call      'FÅ705R'
6.31 c                   parm                    w_firm
6.31 c                   parm                    w_udat
6.31 c                   parm                    w_mvap
6.31 c                   parm                    w_mvat
6.31 c                   parm                    w_mvaf
s.ss  *
s.ss  * Finn ut hvilken avrundingsregel som skal brukes
s.ss  *
s.ss c                   call      'JA209C'
s.ss c                   parm                    p_avrund
      *
     c                   endsr
