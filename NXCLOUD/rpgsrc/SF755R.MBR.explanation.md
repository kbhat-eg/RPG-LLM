## Program Overview

**Program Name:** SF755R  
**System:** ASSTAT  
**Purpose:**  
This program updates the unit names associated with a product (item) in both the sales and purchasing statistics files. Specifically, it replaces an "old" unit name with a "new" unit name for a specified company and item.

The program is written in RPG IV (fixed-format) and is part of the statistics subsystem, likely used for data corrections or migrations when unit codes are renamed.

---

## Business/Domain Context

- **Company (Firma):** The business entity to which the item belongs.
- **Item (Vare):** The product whose unit names are to be updated.
- **Unit (Enhet):** The measurement unit code (e.g., pieces, boxes) to be changed.
- **Sales and Purchasing Statistics:** The program updates both sales (`sstal2`) and purchasing (`sistl2`) statistics files, ensuring consistency in unit naming across the system.

---

## File Definitions

- **SSTAL2** (renamed as `sstal2r`): Sales statistics file, keyed access.
- **SISTL2** (renamed as `sistl2r`): Purchasing statistics file, keyed access.

Both files are updated in place.

---

## Parameters

The program expects four parameters at entry:

1. **p_firm:** Company code (like `sffirm`)
2. **p_vare:** Item code (like `sfvare`)
3. **p_enhg:** Old unit code to be replaced (like `sfenhe`)
4. **p_enhn:** New unit code to use (like `sfenhe`)

These are mapped into working variables for use in file keying and logic.

---

## Key Structure

A key list (`key01`) is defined and used for both files:

- **w_firm:** Company code
- **w_vare:** Item code

This ensures that only records for the specified company and item are processed.

---

## Main Logic

### 1. Sales Statistics Update (`sstal2`)

- The program positions to the first matching record using `setll` and `reade` with `key01`.
- Iterates over all records for the specified company and item.
- For each record:
    - If the main unit (`sfenho`) matches the old unit (`p_enhg`), it is replaced with the new unit (`p_enhn`).
    - If the secondary unit (`sfenhe`) matches the old unit, it is also replaced.
    - The record is then updated in the file.
- Continues until all relevant records are processed.

### 2. Purchasing Statistics Update (`sistl2`)

- The same process is repeated for the purchasing statistics file.
- Checks and updates both `sivenh` and `sioenh` fields (main and secondary unit codes).
- Updates the record if any change was made.

---

## Program Flow

1. **Initialization (`*inzsr`):**
    - Entry parameters are loaded into working variables.
    - The key list is populated for subsequent file operations.

2. **Processing:**
    - Sales statistics are updated first.
    - Then, purchasing statistics are updated.

3. **Termination:**
    - The program sets the last record indicator (`*inlr`) and returns.

---

## Noteworthy Implementation Details

- **No Debug IO (`*nodebugio`):** The program is optimized for batch or background processing, with no interactive debugging.
- **Date Edit (`*dmy`):** Date fields (if any) are expected in day/month/year format.
- **File Renaming:** The physical files are renamed to record formats (`sstal2r`, `sistl2r`) for clarity and to avoid naming conflicts.
- **Parameter Passing:** The program expects all parameters to be passed in the correct order and type.
- **No Error Handling:** There is no explicit error handling or logging; it is assumed that the calling process manages this.
- **Update-in-Place:** The records are updated directly in the statistics files, so data integrity is crucial.

---

## Integration and Dependencies

- **File Dependencies:** The program directly updates the `sstal2` and `sistl2` files. Any downstream processes or reports relying on these files will see the updated unit codes after execution.
- **Parameter Source:** Typically, this program would be called from a batch process or correction utility, with parameters supplied by an administrator or automated script.

---

## Conventions and Patterns

- **Key List Usage:** Consistent use of key lists for keyed file access, ensuring only relevant records are processed.
- **Record Format Naming:** Use of record format renaming to distinguish between physical files and their record formats.
- **Separation of Concerns:** The program is focused solely on the unit code update logic, with initialization and parameter handling segregated into the `*inzsr` subroutine.

---

## Summary

SF755R is a specialized utility for batch-updating unit codes on item statistics records for a specified company and item. It ensures that both sales and purchasing statistics reflect the new unit code, supporting data consistency after unit renaming or corrections. The program is tightly scoped, expects precise input, and operates directly on core statistics files.