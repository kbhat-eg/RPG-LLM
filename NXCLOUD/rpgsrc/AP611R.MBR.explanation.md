# AP611R â€“ Documentation

## Purpose

AP611R is a utility program designed to retrieve information about "skuffer" (drawers) from the routine register (rutine-register). It acts as a lookup service, returning specific drawer-related fields based on supplied keys. This program is typically invoked by other programs or modules that require details about drawer configurations for a given form and printer combination.

## Structure Overview

- **File Declaration**
  - The program uses the `afppl1` physical file, which is a renamed version of `afpppfr`, referenced in the code as `afppl1r`.
- **Parameter Interface**
  - The program is called with four parameters:
    - `p_filg`: Form identifier (like `afvfil`)
    - `p_vprt`: Printer identifier (like `afvprt`)
    - `p_draw1`: Output parameter for the first drawer code (like `afvstd`)
    - `p_draw2`: Output parameter for the second drawer code (like `afvgir`)
- **Key Handling**
  - The lookup is performed using a composite key of form and printer.
- **Main Logic**
  - If a matching record is found in `afppl1r`, the drawer codes are returned.
  - If not, the drawer outputs are blanked.

## Detailed Flow

### 1. Initialization (*INZSR)

- The program begins in the initialization subroutine (`*INZSR`).
- The parameter list is defined and mapped to local variables. This establishes the interface for external callers.
- The key list for the file lookup is defined, using `afppl1_filg` and `afppl1_vprt` as the key fields.

### 2. Main Processing

- The supplied parameters `p_filg` and `p_vprt` are assigned to the key variables.
- A `CHAIN` operation is performed against `afppl1r` using the composite key.
- If a record is found (`%found`):
    - The output parameters `p_draw1` and `p_draw2` are set to the corresponding fields (`afvstd`, `afvgir`) from the found record.
- If no record is found:
    - Both output parameters are set to blank.
- The program then sets LR (`*INLR`) to on, signaling program end and resource release, and returns.

### 3. File and Field Relationships

- **afppl1r**: This is the renamed data structure for the physical file `afpppfr`, representing the routine register.
- **Key Fields**: The lookup is based on form (`afvfil`) and printer (`afvprt`) identifiers.
- **Returned Fields**: If found, the program returns the standard and alternate drawer codes (`afvstd`, `afvgir`).

## Business/Domain Logic

- The program is a simple lookup utility, abstracting the details of the underlying routine register.
- "Skuffer" (drawers) likely refer to physical paper drawers in printers, and the returned codes are used for printer configuration or job setup.
- The calling program is responsible for supplying valid form and printer IDs; this program does not perform any validation beyond the file lookup.

## Conventions and Design Decisions

- **Parameter Passing by Reference:** The program expects all parameters to be passed by reference, allowing it to return output values directly.
- **Blanking Outputs on Miss:** If the lookup fails, output parameters are explicitly blanked to prevent stale data propagation.
- **Key Handling:** Explicit key variable assignment is used to allow for possible manipulation or extension in future versions.
- **No Error Handling:** The program assumes that not finding a record is not an exceptional event and simply returns blanks.

## External Interactions

- **afpppfr (Routine Register):** The only external data source. There are no APIs or additional modules invoked.
- **Calling Programs:** This program is designed as a subroutine or utility to be called from other application modules requiring drawer information.

## Summary Table

| Parameter   | Direction | Description                              |
|-------------|-----------|------------------------------------------|
| p_filg      | Input     | Form identifier                          |
| p_vprt      | Input     | Printer identifier                       |
| p_draw1     | Output    | Standard drawer code (from afvstd)       |
| p_draw2     | Output    | Alternate drawer code (from afvgir)      |

## Notes

- The program is straightforward and stateless, making it safe for repeated and concurrent use.
- All field and file names follow the legacy naming conventions from the business domain.
- This utility is easy to extend if new drawer-related fields need to be returned in future versions.

---

**In summary:**  
AP611R is a focused, reliable utility for retrieving printer drawer codes based on form and printer IDs from the routine register. It is intended as a backend service for other business processes that require drawer configuration data.