# RPG Program Explanation

This RPG program (RR634R) is designed for IBM i (AS/400) systems and its primary purpose is **the automated creation of result reports** ("Automatisk bygging av resultatrapporter"). The program has user interface interaction and works with both display (workstation) and database files.

---

## 1. **Header and Options**

```rpg
h option(*nodebugio) datedit(*dmy)
```
- `*NODEBUGIO`: Disables debug I/O routines for performance.
- `datedit(*dmy)`: Dates are shown/handled in Day-Month-Year format.

---

## 2. **File Declarations**

```rpg
frr634d    cf   e             workstn
frrf0l1    if   e           k disk    rename(rrf0pfr:rrf0l1r)
```
- **rr634d**: Display file for user interface (screen I/O).
- **rrf0l1**: Database file, keyed, input-only. Renames record format `rrf0pfr` to `rrf0l1r`.

---

## 3. **LDA (Local Data Area) Variables**

```rpg
d                uds
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980
```
- This defines overlays into the LDA. For example, `l_user` uses bytes 911-920, `l_firm` bytes 944-946, etc. These are used for things like firm ID and user information.

---

## 4. **Parameter List Data Structure**

```rpg
d                 ds
d d_list                        64
d  d_firm                        3  0 overlay(d_list)
d  d_rapp                        2  0 overlay(d_list:4)
d  d_type                        1  0 overlay(d_list:6)
d  d_linj                        1  0 overlay(d_list:7)
```
- Data structure `d_list` (64 bytes), with overlays for passing parameters to other programs:
  - `d_firm`: Company number (first 3 bytes)
  - `d_rapp`: Report number (bytes 4-5)
  - `d_type`: Report type (byte 6)
  - `d_linj`: Line number (byte 7)

---

## 5. **Variable Definitions**

- `b_feil`: (Boolean) Indicates input error (*on/*off)
- `w_firm`: Working variable for firm number
- `rrf0l1_0rap`: Report number for reading the key
- `w_mld1`, `w_mld2`: Constant strings for messages
- `wactli`, `wactpo`: Work variables for controlling message positioning
- `wmld01`, `wmld02`: Message text variables

---

## 6. **Main Program Logic**

#### a. **Opening Screen and Input Handling**

- **Tag `b1taga`:** Marks the start of the main loop.
- `exfmt b1bld`: Writes/reads the main display screen.

```rpg
c                   if        *inkc or *inkl
c                   goto      avslutt
c                   endif
```
- If F3 (Exit) or F12 (Cancel) is pressed, go to program end (`avslutt`).

- **Input Validation:**
  - Calls subroutine `sjekk_input` to validate user entries.
  - If errors found, re-displays the screen.

- **Move input fields to the parameter data structure (`flytt_par`).**

#### b. **Display Wait Message**

- Sets action line/position and message texts, then calls a program (`AA006C`) to display a waiting message ("Please wait... Building report...").

#### c. **Call Report Generation Program**

- Calls report generation program `RR635R`, passing the parameter structure (`d_list`).

---

## 7. **Program Exit**

- **Tag `avslutt`:** End of program.
- Sets *INLR (Last Record Indicator) to *on, ending the RPG cycle.

---

## 8. **Subroutines**

### a. **sjekk_input** — Input Validation

- Sets error indicator `b_feil` off.
- Checks if a report number (`b10rap`) is entered.
- If so, attempts to `chain` (read by key) the report from file `rrf0l1`.
- If not found (`*IN90` = *on), sets error indicators and skips further processing.

### b. **flytt_par** — Move Input Fields to Parameters

- Copies working variables (`w_firm`, `b10rap`, `b1type`, `b1linj`) to appropriate members in the `d_list` parameter structure.

### c. **\*inzsr** — Initialization

- Runs at program start.
- Initializes firm number, action line/position variables.
- Defines a KLIST (key list) for chaining into the report file, using `w_firm` and `rrf0l1_0rap`.

---

## 9. **Key List**

- Defines a composite key for the report file, using firm number and report number.

---

# **Summary**

This program:

- Displays a screen for the user to enter report selection criteria.
- Validates that the specified report exists.
- Prepares a parameter list with input data.
- Shows a status message to the user while processing.
- Calls another program to actually build (generate) the report.
- Handles clean exit.

**Main Concepts Demonstrated:**

- Use of display and database files.
- Data structure overlays for parameter passing.
- LDA access.
- Modular subroutine design for validation and parameter management.
- Message display to the user.
- Integration and delegation to subprograms.

---

**Note:** Many Norwegian comments and variable names relate specifically to the context (reporting, company numbers, line, etc.). Feel free to ask about any specific portion or for diagrams!