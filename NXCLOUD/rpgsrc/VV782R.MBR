     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : VV782R
      * Beskrivelse . . : Vare, kopiering til annen filgruppe
      *
      * NB!  Oppdateringsindeksene og indekser mot statusregister og lager
      *      er overtyrt mot databasen det skal kopieres TIL !
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       171199 HKO  Nytt program
      *       180500 HKO  Ved kopiering av eksisterende varer beholdes
      *                   lagerplass og varetype på varen i filgruppen det
      *                   kopieres til
      *       220600 HKO  Lagt inn test på at kampanjer som begynner med
      *                   'L' ikke behandles ved sletting og kopiering
      *                   av tilbudspriser på vare.
      *       240101 HKO  Lagt inn logikk for behandling av varesortiment,
      *                   påslagstabell og beholde varetype
      *       030402 HKO  Legger inn enhet ved oppretting av vare i lager
      *       100402 HKO  Lagt inn behandling av nye parametre
      *       040703 HKO  Beholder ABC-kode
      *       270803 HKO  Utvidet påslagstabell med salgspris
      *       131003 HKO  Bytter varenr på EAN-nummer det kopieres til
      *                   dersom dette er knyttet mot en annen vare
      *       100504 HKO  Lagt inn DG i påslag samt varegruppe uten lev.
      *       240107 HKO  Utgår-dato skrives ikke over dersom allerede
      *                   utfyllt
      *                   Lagt inn behandling av valg av opprettet dato
      *       260107 HKO  Lagt inn justering av kostpris i.h.t.
      *                   påslagstabell ved kopiering av tilbudspris
      *       080207 HKO  Nye varer opprettes med d.d. som opprettelsesdato
      *                   og endringsdato
      *                   Datoen skrives ikke over ved endring av vare
      *                   Kode for godkjent innkjøp skrives ikke over
      *       120407 HKO  Lagt inn overstyring av varetype
5.70  * PRGR  171208 bof  Varetype på Lager
5.61  *       110209 bof  Fjernet kopiering av VSOKPF - egne søketekste
      * 6.10  260609 BSA  Oppdatert med sporingsinformasjon
6.11  * 6.10  070110 bof  Utvidet med vveppf
6.12  * 6.10  110311 bof  Feilretting kopiering til lager
6.13  * 6.10  080611 bof  Sjekker om virkelig endring før filkopiering
6.14  * 6.10  280611 bof  Sjekker også om det har vært endring på m.påslag
6.15  * 6.10  080413 bof  Skal alltid rydde tilbud
6.20  * 6.20  051110 bof  Utvidet med lager på sortiment
6.21  * 6.20  040511 bof  Utvidet med varegr./lev.nr på vtilpf
6.22  * 6.20  060213 bof  Hindre kopiering tilbud hvis lokalt tilbud finnes
6.23  * 6.20  120413 bof  Rydder tilbud for alltid, selv om ny vare
6.24  * 6.20  150713 bof  Tilbud på lev. eller varegruppe, feilretting
6.25  * 6.20  090114 bof  Enda en sjekk at ikke tilbud på til-fgr finnes
6.31  * 6.30  250417 bof  Hvis endring på vare,så kopieres også tilbud
6.32  * 6.30  040718 bof  Filekopiere med csv fil som input
6.33  * 6.30  231118 bof  Utvidet med vvlepf
6.34  * 6.30  230419 bof  Rydder for sikkerhets skyld vvlepf også v/ny
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Kopiers fra...
      *
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fvvarlr    if   e           k disk    rename(vvarpfr:vvarlrr)
     fvvarl5    if   e           k disk    rename(vvarpfr:vvarl5r)
     fvvenl1    if   e           k disk    rename(vvenpfr:vvenl1r)
     fvvepl1    if   e           k disk    rename(vveppfr:vvepl1r)
     fvvprl1    if   e           k disk    rename(vvprpfr:vvprl1r)
     fvtill1    if   e           k disk    rename(vtilpfr:vtill1r)
     fvvsol1    if   e           k disk    rename(vvsopfr:vvsol1r)
6.33 fvvlel1    if   e           k disk    rename(vvlepfr:vvlel1r)
5.61 f*sokl1    if   e           k disk    rename(vsokpfr:vsokl1r)
     fveanl2    if   e           k disk    rename(veanpfr:veanl2r)
     fvpdtl1    if   e           k disk    rename(vpdtpfr:vpdtl1r)
     fvpdtl8    if   e           k disk    rename(vpdtpfr:vpdtl8r)
     fvpdtl9    if   e           k disk    rename(vpdtpfr:vpdtl9r)
6.13 facpll1    if   e           k disk    rename(acplpfr:acpll1r)
6.13 facpllu    uf   e           k disk    rename(acplpfr:acpllur)
     fvvawpf    if   e           k disk
5.70 fra10l1    if   e           k disk    rename(ra10pfr:ra10l1r)
6.32 fvwexpf    if   e           k disk
      *
      * Kopieres til...
      *
     fvvarlu    uf a e           k disk    rename(vvarpfr:vvarlur)
     fvvenlu    uf a e           k disk    rename(vvenpfr:vvenlur)
     fvveplu    uf a e           k disk    rename(vveppfr:vveplur)
     fvvprlu    uf a e           k disk    rename(vvprpfr:vvprlur)
     fvtillu    uf a e           k disk    rename(vtilpfr:vtillur)
     fvvsolu    uf a e           k disk    rename(vvsopfr:vvsolur)
6.33 fvvlelu    uf a e           k disk    rename(vvlepfr:vvlelur)
5.61 f*soklu    uf a e           k disk    rename(vsokpfr:vsoklur)
     fveanlu    uf a e           k disk    rename(veanpfr:veanlur)
     ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
     fvlagl1    if   e           k disk    rename(vlagpfr:vlagl1r)
     fvlaglu    uf a e           k disk    rename(vlagpfr:vlaglur)
6.25 fvtillr    if   e           k disk    rename(vtilpfr:vtillrr)
6.25 f                                     prefix(xt:2)
6.10  *
6.10 d                uds
6.10 d l_user                911    920
      *
      * Datastruktur for parameterliste -inn
      *
     d                 ds
     d d_list                       260
     d  d_fgrp                        3    overlay(d_list:1)
     d  d_firm                        3  0 overlay(d_list:4)
     d  d_ldor                        6  0 overlay(d_list:7)
     d  d_ogrp                        2  0 overlay(d_list:13)
     d  d_hgrp                        2  0 overlay(d_list:15)
     d  d_ugrp                        3  0 overlay(d_list:17)
     d  d_var0                       15    overlay(d_list:20)
     d  d_var1                       15    overlay(d_list:35)
     d  d_var2                       15    overlay(d_list:50)
     d  d_var3                       15    overlay(d_list:65)
     d  d_var4                       15    overlay(d_list:80)
     d  d_var5                       15    overlay(d_list:95)
     d  d_var6                       15    overlay(d_list:110)
     d  d_var7                       15    overlay(d_list:125)
     d  d_var8                       15    overlay(d_list:140)
     d  d_var9                       15    overlay(d_list:155)
     d  d_odat                         d   overlay(d_list:170) datfmt(*iso)
     d  d_vtyp                        1    overlay(d_list:180)
6.32 d  d_file                        1    overlay(d_list:241)
      *
      * Datastruktur for parameterliste -inn/-ut
      *
     d                 ds
     d d_list2                       40
     d  d_fgrt                        3    overlay(d_list2:1)
     d  d_firt                        3  0 overlay(d_list2:4)
     d  d_vsor                       10    overlay(d_list2:7)
     d  d_pasl                       10    overlay(d_list2:17)
     d  d_bvty                        1  0 overlay(d_list2:27)
     d  d_bpko                        1  0 overlay(d_list2:28)
      *
      * Definering av parametre
      *
     d p_list          s            260
     d p_list2         s             40
      *
      * Definering av variable i nøkler
      *
     d vvarl1_vare     s                   like(vvvare)
     d vvarl5_ldor     s                   like(vvldor)
     d vvenl1_vare     s                   like(vevare)
     d vvenl1_enhe     s                   like(veenhe)
     d vvepl1_pvar     s                   like(vepvar)
     d vvprl1_vare     s                   like(vpvare)
6.21 d vtill1_ogrp     s                   like(vtogrp)
6.21 d vtill1_hgrp     s                   like(vthgrp)
6.21 d vtill1_ugrp     s                   like(vtugrp)
6.21 d vtill1_ldor     s                   like(vtldor)
     d vtill1_vare     s                   like(vtvare)
6.25 d vtillr_ogrp     s                   like(vtogrp)
6.25 d vtillr_hgrp     s                   like(vthgrp)
6.25 d vtillr_ugrp     s                   like(vtugrp)
6.25 d vtillr_ldor     s                   like(vtldor)
6.25 d vtillr_vare     s                   like(vtvare)
6.25 d vtillr_prgr     s                   like(vtprgr)
6.25 d vtillr_lety     s                   like(vtlety)
6.25 d vtillr_fdat     s                   like(vtfdat)
6.25 d vtillr_ftim     s                   like(vtftim)
6.25 d vtillr_tdat     s                   like(vttdat)
6.25 d vtillr_ttim     s                   like(vtttim)
     d vvsol1_svar     s                   like(vvsvar)
6.33 d vvlel1_lvnr     s                   like(vvlvnr)
5.61 d*vsokl1_vare     s                   like(vsvare)
     d veanl2_vare     s                   like(vxvare)
     d vpdtl1_pasl     s                   like(vjpasl)
     d vpdtl1_ldor     s                   like(vjldor)
     d vpdtl1_ogrp     s                   like(vjogrp)
     d vpdtl1_hgrp     s                   like(vjhgrp)
     d vpdtl1_ugrp     s                   like(vjugrp)
     d vpdtl1_kpri     s                   like(vjkpri)
     d vpdtl1_vare     s                   like(vjvare)
     d vpdtl1_lety     s                   like(vjlety)
     d vpdtl8_pasl     s                   like(vjpasl)
     d vpdtl8_vare     s                   like(vjvare)
     d vpdtl8_lety     s                   like(vjlety)
     d vpdtl9_pasl     s                   like(vjpasl)
     d vpdtl9_ldor     s                   like(vjldor)
     d vpdtl9_ogrp     s                   like(vjogrp)
     d vpdtl9_hgrp     s                   like(vjhgrp)
     d vpdtl9_ugrp     s                   like(vjugrp)
     d vpdtl9_kpri     s                   like(vjkpri)
     d vpdtl9_lety     s                   like(vjlety)
     d vpdtl9_vare     s                   like(vjvare)
6.13 d acpll1_lfgr     s                   like(aclfgr)
6.13 d acpll1_lfir     s                   like(aclfir)
6.13 d acpll1_lfgt     s                   like(aclfgr)
6.13 d acpll1_lfit     s                   like(aclfir)
6.13 d acpllu_lfgr     s                   like(aclfgr)
6.13 d acpllu_lfir     s                   like(aclfir)
6.13 d acpllu_lfgt     s                   like(aclfgr)
6.13 d acpllu_lfit     s                   like(aclfir)
      *
     d vvarlu_vare     s                   like(vvvare)
     d vvenlu_vare     s                   like(vevare)
     d vveplu_pvar     s                   like(vepvar)
     d vvprlu_vare     s                   like(vpvare)
6.21 d vtillu_ogrp     s                   like(vtogrp)
6.21 d vtillu_hgrp     s                   like(vthgrp)
6.21 d vtillu_ugrp     s                   like(vtugrp)
6.21 d vtillu_ldor     s                   like(vtldor)
     d vtillu_vare     s                   like(vtvare)
     d vvsolu_svar     s                   like(vvsvar)
6.33 d vvlelu_lvnr     s                   like(vvlvnr)
5.61 d*vsoklu_vare     s                   like(vsvare)
     d veanlu_eann     s                   like(vxeann)
     d vlagl1_vare     s                   like(vlvare)
5.70 d vlagl1_lage     s                   like(vllage)
      *
      * Definering av variable
      *
     d b_svgr          s              1
     d b_sldo          s              1
     d b_stek          s              1
     d b_pasl          s              1    inz(*off)
     d b_just          s              1    inz(*off)
6.13 d b_vvar          s              1    inz(*on)
6.13 d b_vean          s              1    inz(*on)
6.13 d b_vvpr          s              1    inz(*on)
6.13 d b_vven          s              1    inz(*on)
6.13 d b_vtil          s              1    inz(*on)
6.14 d b_vpdt          s              1    inz(*on)
6.13 d b_vvax          s              1    inz(*off)
6.13 d b_veax          s              1    inz(*off)
6.13 d b_vvpx          s              1    inz(*off)
6.13 d b_vvex          s              1    inz(*off)
6.13 d b_vtix          s              1    inz(*off)
6.21 d b_tilb          s              1    inz(*off)
      *
     d w_dato          s               d   datfmt(*iso)
6.13 d w_var_tims      s               z
6.13 d w_vpr_tims      s               z
6.13 d w_ven_tims      s               z
6.13 d w_vti_tims      s               z
6.13 d w_vea_tims      s               z
6.13 d w_til_tims      s               z
      *
     d w_firm          s                   like(vvfirm)
     d w_firt          s                   like(vvfirm)
6.20 d w_lage          s                   like(vllage)
      *
6.32 d w_varx          s                   like(vvvare)
6.32 d w_posi          s              4  0
     d w_vare          s                   like(vvvare)
     d w_gvar          s                   like(vvvare)
      *
     d w_inpa          s                   like(vjinpa)
     d w_inbe          s                   like(vjinbe)
     d w_kopa          s                   like(vjkopa)
     d w_kobe          s                   like(vjkobe)
     d w_sapa          s                   like(vjsapa)
     d w_sabe          s                   like(vjsabe)
     d w_sapr          s                   like(vjsapr)
     d w_dekn          s                   like(vjdekn)
     d w_inpa_gen      s                   like(vjinpa)
     d w_inbe_gen      s                   like(vjinbe)
     d w_kopa_gen      s                   like(vjkopa)
     d w_kobe_gen      s                   like(vjkobe)
     d w_sapa_gen      s                   like(vjsapa)
     d w_sabe_gen      s                   like(vjsabe)
     d w_sapr_gen      s                   like(vjsapr)
     d w_dekn_gen      s                   like(vjdekn)
      *
     d s_vtyp          s                   like(vvvtyp)
     d s_kpri          s                   like(vvkpri)
     d s_plas          s                   like(vvplas)
     d s_kabc          s                   like(vvkabc)
     d s_godj          s                   like(vvgodj)
     d s_udat          s                   like(vvudat)
     d s_odat          s                   like(vvodat)
     d s_edat          s                   like(vvedat)
     d s_etim          s                   like(vvetim)
      *
     d w_vare_gml      s                   like(vvvare)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Sjekker om det er påslag knyttet mot kopieringen, og henter
      * eventuelt generelt påslag
      *
     c                   if        d_pasl <> *blank
      *
     c                   eval      vpdtl1_pasl = d_pasl
     c     vpdtl1_key2   chain     vpdtl1                             90
     c                   if        *in90 = *off
     c                   eval      b_pasl = *on
     c                   endif
      *
     c                   eval      vpdtl1_ldor = 0
     c                   eval      vpdtl1_ogrp = 0
     c                   eval      vpdtl1_hgrp = 0
     c                   eval      vpdtl1_ugrp = 0
     c                   eval      vpdtl1_kpri = *blank
     c                   eval      vpdtl1_vare = *blank
     c                   eval      vpdtl1_lety = 0
     c     vpdtl1_key    chain     vpdtl1                             90
     c                   if        *in90 = *off
     c                   eval      w_inpa_gen = vjinpa
     c                   eval      w_inbe_gen = vjinbe
     c                   eval      w_kopa_gen = vjkopa
     c                   eval      w_kobe_gen = vjkobe
     c                   eval      w_sapa_gen = vjsapa
     c                   eval      w_sabe_gen = vjsabe
     c                   eval      w_sapr_gen = vjsapr
     c                   eval      w_dekn_gen = vjdekn
     c                   endif
      *
     c                   endif
      *
      * Behandling av hele vareregisteret
      *
     c                   if        d_ldor = 0 and
     c                             d_var0 = *blank and
     c                             d_var1 = *blank and
     c                             d_var2 = *blank and
     c                             d_var3 = *blank and
     c                             d_var4 = *blank and
     c                             d_var5 = *blank and
     c                             d_var6 = *blank and
     c                             d_var7 = *blank and
     c                             d_var8 = *blank and
     c                             d_var9 = *blank and
6.32 c                             d_odat = *loval and
6.32 c                             d_file = *blank
     c                   exsr      total
     c                   goto      avslutt
     c                   endif
      *
      * Behandling dersom vare er valgt
      *
     c                   if        d_var0 <> *blank or
     c                             d_var1 <> *blank or
     c                             d_var2 <> *blank or
     c                             d_var3 <> *blank or
     c                             d_var4 <> *blank or
     c                             d_var5 <> *blank or
     c                             d_var6 <> *blank or
     c                             d_var7 <> *blank or
     c                             d_var8 <> *blank or
     c                             d_var9 <> *blank
      *
     c                   if        d_var0 <> *blank
     c                   eval      vvarl1_vare = d_var0
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
     c                   exsr      behandling
     c                   endif
     c                   endif
      *
     c                   if        d_var1 <> *blank
     c                   eval      vvarl1_vare = d_var1
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
     c                   exsr      behandling
     c                   endif
     c                   endif
      *
     c                   if        d_var2 <> *blank
     c                   eval      vvarl1_vare = d_var2
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
     c                   exsr      behandling
     c                   endif
     c                   endif
      *
     c                   if        d_var3 <> *blank
     c                   eval      vvarl1_vare = d_var3
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
     c                   exsr      behandling
     c                   endif
     c                   endif
      *
     c                   if        d_var4 <> *blank
     c                   eval      vvarl1_vare = d_var4
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
     c                   exsr      behandling
     c                   endif
     c                   endif
      *
     c                   if        d_var5 <> *blank
     c                   eval      vvarl1_vare = d_var5
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
     c                   exsr      behandling
     c                   endif
     c                   endif
      *
     c                   if        d_var6 <> *blank
     c                   eval      vvarl1_vare = d_var6
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
     c                   exsr      behandling
     c                   endif
     c                   endif
      *
     c                   if        d_var7 <> *blank
     c                   eval      vvarl1_vare = d_var7
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
     c                   exsr      behandling
     c                   endif
     c                   endif
      *
     c                   if        d_var8 <> *blank
     c                   eval      vvarl1_vare = d_var8
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
     c                   exsr      behandling
     c                   endif
     c                   endif
      *
     c                   if        d_var9 <> *blank
     c                   eval      vvarl1_vare = d_var9
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
     c                   exsr      behandling
     c                   endif
     c                   endif
      *
     c                   goto      avslutt
      *
     c                   endif
      *
      * Behandling dersom leverandør er valgt
      *
     c                   if        d_ldor <> 0
      *
     c                   eval      vvarl5_ldor = d_ldor
     c     vvarl5_key    setll     vvarl5
     c     vvarl5_key    reade     vvarl5                                 90
     c                   dow       *in90 = *off
      *
     c                   if        d_ogrp <> 0 and
     c                             d_ogrp <> vvogrp
     c                   goto      neste_vare
     c                   endif
      *
     c                   if        d_hgrp <> 0 and
     c                             d_hgrp <> vvhgrp
     c                   goto      neste_vare
     c                   endif
      *
     c                   if        d_ugrp <> 0 and
     c                             d_ugrp <> vvugrp
     c                   goto      neste_vare
     c                   endif
      *
     c                   if        d_odat <> *loval and
     c                             d_odat <> vvodat
     c                   goto      neste_vare
     c                   endif
      *
     c                   exsr      behandling
      *
     c     neste_vare    tag
      *
     c     vvarl5_key    reade     vvarl5                                 90
     c                   enddo
      *
     c                   goto      avslutt
     c                   endif
      *
      * Behandling dersom opprettet dato er valgt uavhengig av leverandør
      *
     c                   if        d_ldor = 0 and
     c                             d_odat <> *loval
      *
     c     vvarlr_key    setll     vvarlr
     c     vvarlr_key    reade     vvarlr
     c                   dow       not %eof
      *
     c                   if        vvodat = d_odat
     c                   exsr      behandling
     c                   endif
      *
     c     vvarlr_key    reade     vvarlr
     c                   enddo
      *
     c                   endif
6.32  *
6.32  * Behandling dersom file er valgt (leser fra csv-file )
6.32  *
6.32 c                   if        d_file = '1'
6.32  *
6.32 c                   read      vwexpf
6.32 c                   dow       not %eof
6.32  *
6.32 c                   eval      w_posi = %scan(';':exclin)
6.32 c                   eval      w_varx = %trim(%subst(exclin:1:w_posi-1))
6.32 c                   eval      vvarl1_vare = w_varx
6.32 c     vvarl1_key    chain     vvarl1
6.32 c                   if        %found
6.32 c                   exsr      behandling
6.32 c                   endif
6.32  *
6.32 c                   read      vwexpf
6.32 c                   enddo
6.32  *
6.32 c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandler kopiering av hele vareregisteret
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     total         begsr
      *
      * Henter varer fra varesortiment
      *
     c                   if        d_vsor <> *blank
      *
     c                   eval      b_svgr = *off
     c                   eval      b_sldo = *off
     c                   eval      b_stek = *off
      *
6.20 c                   eval      w_lage = 0
     c                   call      'VD700R'
     c                   parm                    w_firm
     c                   parm                    d_vsor
     c                   parm                    b_svgr
     c                   parm                    b_sldo
     c                   parm                    b_stek
     c                   parm                    w_lage
      *
     c                   eval      w_vare_gml = *blank
      *
     c                   read      vvawpf                                 90
     c                   dow       *in90 = *off
     c                   if        vvvare <> w_vare_gml
6.13 c                   exsr      sjekk_endr
6.13 c                   if        b_vvar = *on or
6.13 c                             b_vvpr = *on or
6.13 c                             b_vven = *on or
6.13 c                             b_vean = *on or
6.13 c                             b_vtil = *on
     c                   exsr      behandling
6.13 c                   endif
     c                   endif
     c                   eval      w_vare_gml = vvvare
     c                   read      vvawpf                                 90
     c                   enddo
      *
     c                   else
      *
     c     vvarlr_key    setll     vvarlr
     c     vvarlr_key    reade     vvarlr
     c                   dow       not %eof(vvarlr)
6.13 c                   exsr      sjekk_endr
6.13 c                   if        b_vvar = *on or
6.13 c                             b_vvpr = *on or
6.13 c                             b_vven = *on or
6.13 c                             b_vean = *on or
6.13 c                             b_vtil = *on
     c                   exsr      behandling
6.13 c                   endif
     c     vvarlr_key    reade     vvarlr
     c                   enddo
      *
     c                   endif
      *
6.24  * kopier tilbud som ikke er pr. varenr.
6.24  *
6.24 c                   exsr      kopi_tilb
      *
6.13 c                   exsr      upd_acpl
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av vare som skal kopieres
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandling    begsr
      *
     c                   eval      w_vare = vvvare
      *
     c                   eval      vvarlu_vare = w_vare
     c     vvarlu_key    chain     vvarlur                            91
      *
      * Endret vare
      *
     c                   if        *in91 = *off
     c                   exsr      endr_vare
     c                   goto      end_behandl
     c                   endif
      *
      * Behandling avhengig om varen er en matchet vare som har byttet
      * varenummer, eller om den er en ny vare
      *
     c                   eval      w_gvar = *blank
      *
     c                   call      'FO710C'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   parm                    w_gvar
      *
     c                   if        w_gvar <> *blank
     c                   eval      vvarlu_vare = w_gvar
     c     vvarlu_key    chain     vvarlur                            91
     c                   if        *in91 = *off
     c                   exsr      match_vare
     c                   goto      end_behandl
     c                   endif
     c                   endif
      *
     c                   exsr      ny_vare
      *
     c     end_behandl   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for endring av eksisterende vare
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     endr_vare     begsr
      *
      * Vare
      *
6.13 c                   if        b_vvar = *on
      *
     c                   eval      vvarlu_vare = w_vare
     c     vvarlu_key    chain     vvarlur                            91
      *
     c                   eval      s_vtyp = vvvtyp
     c                   eval      s_kpri = vvkpri
     c                   eval      s_plas = vvplas
     c                   eval      s_kabc = vvkabc
     c                   eval      s_godj = vvgodj
     c                   eval      s_udat = vvudat
     c                   eval      s_odat = vvodat
     c                   eval      s_edat = vvedat
     c                   eval      s_etim = vvetim
      *
     c                   eval      vvarl1_vare = w_vare
     c     vvarl1_key    chain     vvarl1                             91
      *
     c                   eval      vvfirm = w_firt
     c                   eval      vvplas = s_plas
     c                   eval      vvkabc = s_kabc
     c                   eval      vvgodj = s_godj
      *
     c                   if        vvudat = *loval
     c                   eval      vvudat = s_udat
     c                   endif
      *
     c                   if        s_odat > vvodat
     c                   eval      vvodat = s_odat
     c                   endif
      *
     c                   if        s_edat > vvedat
     c                   eval      vvedat = s_edat
     c                   eval      vvetim = s_etim
     c                   endif
      *
     c                   if        d_bvty = 1
     c                   eval      vvvtyp = s_vtyp
     c                   endif
      *
     c                   if        d_bpko = 1
     c                   eval      vvkpri = s_kpri
     c                   endif
      *
6.10 c                   time                    vvedat
6.10 c                   time                    vvetim
6.10 c                   eval      vveusr = l_user
     c                   update    vvarlur
      *
6.13 c                   endif
      *
      * Enheter
      *
6.13 c                   if        b_vven = *on
      *
     c                   eval      vvenlu_vare = w_vare
     c     vvenlu_key    setll     vvenlu
     c     vvenlu_key    reade     vvenlur                                91
     c                   dow       *in91 = *off
     c                   delete    vvenlur
     c     vvenlu_key    reade     vvenlur                                91
     c                   enddo
      *
     c                   eval      vvenl1_vare = w_vare
     c     vvenl1_key    setll     vvenl1
     c     vvenl1_key    reade     vvenl1                                 91
     c                   dow       *in91 = *off
      *
     c                   eval      vefirm = w_firt
6.10 c                   time                    veodat
6.10 c                   time                    veotim
6.10 c                   eval      veousr = l_user
6.10 c                   time                    veedat
6.10 c                   time                    veetim
6.10 c                   eval      veeusr = l_user
     c                   write     vvenlur
      *
     c     vvenl1_key    reade     vvenl1                                 91
     c                   enddo
6.11  *
6.11  * Enheter pr. prisgiver
6.11  *
6.11 c                   eval      vveplu_pvar = w_vare
6.11 c     vveplu_key    setll     vveplu
6.11 c     vveplu_key    reade     vveplur                                91
6.11 c                   dow       *in91 = *off
6.11 c                   delete    vveplur
6.11 c     vveplu_key    reade     vveplur                                91
6.11 c                   enddo
6.11  *
6.11 c                   eval      vvepl1_pvar = w_vare
6.11 c     vvepl1_key    setll     vvepl1
6.11 c     vvepl1_key    reade     vvepl1                                 91
6.11 c                   dow       *in91 = *off
6.11  *
6.11 c                   eval      vepfir = w_firt
6.11 c                   time                    vepoda
6.11 c                   time                    vepoti
6.11 c                   eval      vepous = l_user
6.11 c                   time                    vepeda
6.11 c                   time                    vepeti
6.11 c                   eval      vepeus = l_user
6.11 c                   write     vveplur
6.11  *
6.11 c     vvepl1_key    reade     vvepl1                                 91
6.11 c                   enddo
      *
6.13 c                   endif
      *
      * Priser
      *
6.13 c                   if        b_vvpr = *on
      *
     c                   eval      b_just = *off
      *
     c                   eval      vvprlu_vare = w_vare
     c     vvprlu_key    setll     vvprlu
     c     vvprlu_key    reade     vvprlur                                91
     c                   dow       *in91 = *off
     c                   delete    vvprlur
     c     vvprlu_key    reade     vvprlur                                91
     c                   enddo
      *
     c                   eval      vvprl1_vare = w_vare
     c     vvprl1_key    setll     vvprl1
     c     vvprl1_key    reade     vvprl1                                 91
     c                   dow       *in91 = *off
      *
     c                   if        b_pasl = *on
     c                   exsr      pÅslag
     c                   if        b_just = *on
     c                   exsr      just_pris
     c                   endif
     c                   endif
      *
     c                   eval      vpfirm = w_firt
6.10 c                   time                    vpodat
6.10 c                   time                    vpotim
6.10 c                   eval      vpousr = l_user
6.10 c                   time                    vpedat
6.10 c                   time                    vpetim
6.10 c                   eval      vpeusr = l_user
     c                   write     vvprlur
      *
     c     vvprl1_key    reade     vvprl1                                 91
     c                   enddo
      *
6.13 c                   endif
      *
      * Tilbud   - varenr
      *
6.15 c****               if        b_vtil = *on
      *
6.21 c                   eval      vtillu_ogrp = 0
6.21 c                   eval      vtillu_hgrp = 0
6.21 c                   eval      vtillu_ugrp = 0
6.21 c                   eval      vtillu_ldor = 0
     c                   eval      vtillu_vare = w_vare
     c     vtillu_key    setll     vtillu
     c     vtillu_key    reade     vtillur                                91
     c                   dow       *in91 = *off
     c                   if        %subst(vtkamp:1:1) <> 'L'
     c                   delete    vtillur
     c                   endif
     c     vtillu_key    reade     vtillur                                91
     c                   enddo
      *
6.21 c                   eval      vtill1_ogrp = 0
6.21 c                   eval      vtill1_hgrp = 0
6.21 c                   eval      vtill1_ugrp = 0
6.21 c                   eval      vtill1_ldor = 0
     c                   eval      vtill1_vare = w_vare
     c     vtill1_key    setll     vtill1
     c     vtill1_key    reade     vtill1                                 91
     c                   dow       *in91 = *off
      *
     c                   if        %subst(vtkamp:1:1) <> 'L'
      *
     c                   eval      vtfirm = w_firt
      *
     c                   if        b_pasl = *on and
     c                             b_just = *on
     c                   exsr      just_tilb
     c                   endif
6.25  *
6.25  * sjekker for sikkerhets skyld om at kamp. ikke finnes
6.25  *
6.25 c                   eval      vtillr_ogrp = vtogrp
6.25 c                   eval      vtillr_hgrp = vthgrp
6.25 c                   eval      vtillr_ugrp = vtugrp
6.25 c                   eval      vtillr_ldor = vtldor
6.25 c                   eval      vtillr_vare = vtvare
6.25 c                   eval      vtillr_prgr = vtprgr
6.25 c                   eval      vtillr_lety = vtlety
6.25 c                   eval      vtillr_fdat = vtfdat
6.25 c                   eval      vtillr_ftim = vtftim
6.25 c                   eval      vtillr_tdat = vttdat
6.25 c                   eval      vtillr_ttim = vtttim
6.25 c     vtillr_key    chain     vtillr
6.25 c                   if        not %found(vtillr)
      *
6.10 c                   time                    vtodat
6.10 c                   time                    vtotim
6.10 c                   eval      vtousr = l_user
6.10 c                   time                    vtedat
6.10 c                   time                    vtetim
6.10 c                   eval      vteusr = l_user
     c                   write     vtillur
6.25  *
6.25 c                   endif
      *
     c                   endif
      *
     c     vtill1_key    reade     vtill1                                 91
     c                   enddo
6.21  *
6.21  * Tilbud   - varegruppe / leverandør
6.21  * Leser gjennom alle tilbud som ikke ligger pr. vare og disse behandles
6.24  **** Dette er flyttet ***********
      *
6.15 c****               endif
6.33  *
6.33  * Vare-leverandør
6.33  *
6.33 c                   eval      vvlelu_lvnr = w_vare
6.33 c     vvlelu_key    setll     vvlelur
6.33 c     vvlelu_key    reade     vvlelur
6.33 c                   dow       not %eof(vvlelu)
6.33 c                   delete    vvlelur
6.33 c     vvlelu_key    reade     vvlelur
6.33 c                   enddo
6.33  *
6.33 c                   eval      vvlel1_lvnr = w_vare
6.33 c     vvlel1_key    setll     vvlel1
6.33 c     vvlel1_key    reade     vvlel1
6.33 c                   dow       not %eof(vvlel1)
6.33 c                   eval      vvlfir = w_firt
6.33 c                   write     vvlelur
6.33 c     vvlel1_key    reade     vvlel1
6.33 c                   enddo
6.33  *
      * Vare-søketekst
      *
     c                   eval      vvsolu_svar = w_vare
     c     vvsolu_key    chain     vvsolur                            91
     c                   if        *in91 = *off
     c                   delete    vvsolur
     c                   endif
      *
     c                   eval      vvsol1_svar = w_vare
     c     vvsol1_key    chain     vvsol1                             91
     c                   if        *in91 = *off
     c                   eval      vvsfir = w_firt
     c                   write     vvsolur
     c                   endif
      *
      * Søketekster
      *
5.61 c*                  eval      vsoklu_vare = w_vare
5.61 c*    vsoklu_key    setll     vsoklu
5.61 c*    vsoklu_key    reade     vsoklur                                91
5.61 c*                  dow       *in91 = *off
5.61 c*                  delete    vsoklur
5.61 c*    vsoklu_key    reade     vsoklur                                91
5.61 c*                  enddo
5.61  *
5.61 c*                  eval      vsokl1_vare = w_vare
5.61 c*    vsokl1_key    setll     vsokl1
5.61 c*    vsokl1_key    reade     vsokl1                                 91
5.61 c*                  dow       *in91 = *off
5.61  *
5.61 c*                  eval      vsfirm = w_firt
5.61 c*                  write     vsoklur
5.61  *
5.61 c*    vsokl1_key    reade     vsokl1                                 91
5.61 c*                  enddo
      *
      * EAN-nummer
      *
6.13 c                   if        b_vean = *on
      *
     c                   eval      veanl2_vare = w_vare
     c     veanl2_key    setll     veanl2
     c     veanl2_key    reade     veanl2
     c                   dow       not %eof
      *
     c                   eval      veanlu_eann = vxeann
     c     veanlu_key    chain     veanlur
     c                   if        %found
     c                   if        vxvare <> w_vare
     c                   eval      vxvare = w_vare
     c                   update    veanlur
     c                   endif
     c                   else
     c                   eval      vxfirm = w_firt
     c                   write     veanlur
     c                   endif
      *
     c     veanl2_key    reade     veanl2
     c                   enddo
      *
6.13 c                   endif
      *
5.70  * Oppretter vare i alle lager dersom det er lagervare, og varen ikke
5.70  * finnes fra før
      *
5.70 c                   if        vvvtyp = 'L'  or
5.70 c                             vvvtyp = 'S'
     c     fstsl1_key    chain     fstsl1                             91
     c                   if        *in91 = *off and
     c                             faalag = 1
5.70  *
5.70 c     ra10l1_key    setll     ra10l1
5.70 c     ra10l1_key    reade     ra10l1
5.70 c                   dow       not %eof(ra10l1)
      *
     c                   clear                   vlagl1r
     c                   clear                   vlaglur
     c                   eval      vlagl1_vare = w_vare
5.70 c                   eval      vlagl1_lage = rajkod
6.12 c     vlagl1_key    chain     vlagl1
6.12 c                   if        not %found(vlagl1)
     c                   eval      vlfirm = w_firt
     c                   eval      vlvare = w_vare
     c                   eval      vllage = rajkod
     c                   eval      vlenhl = vvenhl
5.70 c                   eval      vlvtyp = vvvtyp
     c                   time                    vltrda
6.10 c                   time                    vlodat
6.10 c                   time                    vlotim
6.10 c                   eval      vlousr = l_user
6.10 c                   time                    vledat
6.10 c                   time                    vletim
6.10 c                   eval      vleusr = l_user
     c                   write     vlaglur
     c                   endif
5.70 c     ra10l1_key    reade     ra10l1
5.70 c                   enddo
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppretting av ny vare
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ny_vare       begsr
      *
      * Vare
      *
     c                   eval      vvarl1_vare = w_vare
     c     vvarl1_key    chain     vvarl1                             91
      *
     c                   if        d_vtyp <> *blank
     c                   eval      vvvtyp = d_vtyp
     c                   endif
      *
     c                   eval      vvfirm = w_firt
     c                   eval      vvodat = %date
6.10 c                   time                    vvotim
6.10 c                   eval      vvousr = l_user
     c                   eval      vvedat = %date
     c                   eval      vvetim = %time
6.10 c                   eval      vveusr = l_user
      *
     c                   write     vvarlur
      *
      * Enheter
      *
     c                   eval      vvenl1_vare = w_vare
     c     vvenl1_key    setll     vvenl1
     c     vvenl1_key    reade     vvenl1
     c                   dow       not %eof
      *
     c                   eval      vefirm = w_firt
6.10 c                   time                    veodat
6.10 c                   time                    veotim
6.10 c                   eval      veousr = l_user
6.10 c                   time                    veedat
6.10 c                   time                    veetim
6.10 c                   eval      veeusr = l_user
     c                   write     vvenlur
      *
     c     vvenl1_key    reade     vvenl1
     c                   enddo
6.11  *
6.11  * Enheter pr. prisgiver
6.11  *
6.11 c                   eval      vvepl1_pvar = w_vare
6.11 c     vvepl1_key    setll     vvepl1
6.11 c     vvepl1_key    reade     vvepl1
6.11 c                   dow       not %eof
6.11  *
6.11 c                   eval      vepfir = w_firt
6.11 c                   time                    vepoda
6.11 c                   time                    vepoti
6.11 c                   eval      vepous = l_user
6.11 c                   time                    vepeda
6.11 c                   time                    vepeti
6.11 c                   eval      vepeus = l_user
6.11 c                   write     vveplur
6.11  *
6.11 c     vvepl1_key    reade     vvepl1
6.11 c                   enddo
      *
      * Priser
      *
     c                   eval      b_just = *off
      *
     c                   eval      vvprl1_vare = w_vare
     c     vvprl1_key    setll     vvprl1
     c     vvprl1_key    reade     vvprl1
     c                   dow       not %eof
      *
     c                   if        b_pasl = *on
     c                   exsr      pÅslag
     c                   if        b_just = *on
     c                   exsr      just_pris
     c                   endif
     c                   endif
      *
     c                   eval      vpfirm = w_firt
6.10 c                   time                    vpodat
6.10 c                   time                    vpotim
6.10 c                   eval      vpousr = l_user
6.10 c                   time                    vpedat
6.10 c                   time                    vpetim
6.10 c                   eval      vpeusr = l_user
     c                   write     vvprlur
      *
     c     vvprl1_key    reade     vvprl1
     c                   enddo
      *
      * Tilbud
      *
6.23 c                   eval      vtillu_ogrp = 0
6.23 c                   eval      vtillu_hgrp = 0
6.23 c                   eval      vtillu_ugrp = 0
6.23 c                   eval      vtillu_ldor = 0
6.23 c                   eval      vtillu_vare = w_vare
6.23 c     vtillu_key    setll     vtillu
6.23 c     vtillu_key    reade     vtillur                                91
6.23 c                   dow       *in91 = *off
6.23 c                   if        %subst(vtkamp:1:1) <> 'L'
6.23 c                   delete    vtillur
6.23 c                   endif
6.23 c     vtillu_key    reade     vtillur                                91
6.23 c                   enddo
      *
6.23 c                   eval      vtill1_ogrp = 0
6.23 c                   eval      vtill1_hgrp = 0
6.23 c                   eval      vtill1_ugrp = 0
6.23 c                   eval      vtill1_ldor = 0
     c                   eval      vtill1_vare = w_vare
     c     vtill1_key    setll     vtill1
     c     vtill1_key    reade     vtill1
     c                   dow       not %eof
      *
     c                   if        %subst(vtkamp:1:1) <> 'L'
      *
     c                   eval      vtfirm = w_firt
      *
     c                   if        b_pasl = *on and
     c                             b_just = *on
     c                   exsr      just_tilb
     c                   endif
      *
6.10 c                   time                    vtodat
6.10 c                   time                    vtotim
6.10 c                   eval      vtousr = l_user
6.10 c                   time                    vtedat
6.10 c                   time                    vtetim
6.10 c                   eval      vteusr = l_user
     c                   write     vtillur
      *
     c                   endif
      *
     c     vtill1_key    reade     vtill1
     c                   enddo
6.33  *
6.33  * Vare-leverandør
6.33  *
6.34 c                   eval      vvlelu_lvnr = w_vare
6.34 c     vvlelu_key    setll     vvlelur
6.34 c     vvlelu_key    reade     vvlelur
6.34 c                   dow       not %eof(vvlelu)
6.34 c                   delete    vvlelur
6.34 c     vvlelu_key    reade     vvlelur
6.34 c                   enddo
6.33  *
6.33 c                   eval      vvlel1_lvnr = w_vare
6.33 c     vvlel1_key    setll     vvlel1
6.33 c     vvlel1_key    reade     vvlel1
6.33 c                   dow       not %eof(vvlel1)
6.33 c                   eval      vvlfir = w_firt
6.33 c                   write     vvlelur
6.33 c     vvlel1_key    reade     vvlel1
6.33 c                   enddo
6.33  *
      * Vare-søketekst
      *
     c                   eval      vvsol1_svar = w_vare
     c     vvsol1_key    chain     vvsol1
     c                   if        %found
     c                   eval      vvsfir = w_firt
     c                   write     vvsolur
     c                   endif
      *
      * Søketekster
      *
5.61 c*                  eval      vsokl1_vare = w_vare
5.61 c*    vsokl1_key    setll     vsokl1
5.61 c*    vsokl1_key    reade     vsokl1
5.61 c*                  dow       not %eof
5.61  *
5.61 c*                  eval      vsfirm = w_firt
5.61 c*                  write     vsoklur
5.61  *
5.61 c*    vsokl1_key    reade     vsokl1
5.61 c*                  enddo
      *
      * EAN-nummer
      *
     c                   eval      veanl2_vare = w_vare
     c     veanl2_key    setll     veanl2
     c     veanl2_key    reade     veanl2
     c                   dow       not %eof
      *
     c                   eval      veanlu_eann = vxeann
     c     veanlu_key    chain     veanlur
     c                   if        %found
     c                   if        vxvare <> w_vare
     c                   eval      vxvare = w_vare
6.10 c                   time                    vxedat
6.10 c                   time                    vxetim
6.10 c                   eval      vxeusr = l_user
     c                   update    veanlur
     c                   endif
     c                   else
     c                   eval      vxfirm = w_firt
6.10 c                   time                    vxodat
6.10 c                   time                    vxotim
6.10 c                   eval      vxousr = l_user
6.10 c                   time                    vxedat
6.10 c                   time                    vxetim
6.10 c                   eval      vxeusr = l_user
     c                   write     veanlur
     c                   endif
      *
     c     veanl2_key    reade     veanl2
     c                   enddo
      *
5.70  * Oppretter vare i alle lager dersom det er lagervare
      *
5.70 c                   if        vvvtyp = 'L'  or
5.70 c                             vvvtyp = 'S'
     c     fstsl1_key    chain     fstsl1                             91
     c                   if        *in91 = *off and
     c                             faalag = 1
5.70  *
5.70 c     ra10l1_key    setll     ra10l1
5.70 c     ra10l1_key    reade     ra10l1
5.70 c                   dow       not %eof(ra10l1)
     c                   clear                   vlagl1r
     c                   clear                   vlaglur
     c                   eval      vlagl1_vare = w_vare
5.70 c                   eval      vlagl1_lage = rajkod
6.12 c     vlagl1_key    chain     vlagl1
6.12 c                   if        not %found(vlagl1)
     c                   eval      vlfirm = w_firt
     c                   eval      vlvare = w_vare
     c                   eval      vllage = rajkod
     c                   eval      vlenhl = vvenhl
5.70 c                   eval      vlvtyp = vvvtyp
6.12 c*                  eval      vllage = faahla
     c                   time                    vltrda
6.10 c                   time                    vlodat
6.10 c                   time                    vlotim
6.10 c                   eval      vlousr = l_user
6.10 c                   time                    vledat
6.10 c                   time                    vletim
6.10 c                   eval      vleusr = l_user
     c                   write     vlaglur
     c                   endif
5.70 c     ra10l1_key    reade     ra10l1
5.70 c                   enddo
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av matchet vare som har byttet varenummer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     match_vare    begsr
      *
      * Kaller program for bytting av varenummer på alle tabeller
      *
     c                   call      'VV783C'
     c                   parm                    d_list2
     c                   parm                    w_gvar
     c                   parm                    w_vare
      *
      * Bytter varenummer på vare
      *
     c                   eval      vvarlu_vare = w_gvar
     c     vvarlu_key    chain     vvarlur                            91
      *
     c                   eval      vvvare = w_vare
      *
6.10 c                   time                    vvedat
6.10 c                   time                    vvetim
6.10 c                   eval      vveusr = l_user
     c                   update    vvarlur
      *
      * Kaller subrutine for endring av vareinformasjon på vare
      *
     c                   exsr      endr_vare
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av påslag på pris
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     pÅslag        begsr
      *
     c                   eval      b_just = *off
      *
      * Generelle påslag
      *
     c                   eval      w_inpa = w_inpa_gen
     c                   eval      w_inbe = w_inbe_gen
     c                   eval      w_kopa = w_kopa_gen
     c                   eval      w_kobe = w_kobe_gen
     c                   eval      w_sapa = w_sapa_gen
     c                   eval      w_sabe = w_sabe_gen
     c                   eval      w_sapr = w_sapr_gen
     c                   eval      w_dekn = w_dekn_gen
      *
      * Påslag på vare-nivå
      *
     c                   eval      vpdtl8_pasl = d_pasl
     c                   eval      vpdtl8_vare = vvvare
     c                   eval      vpdtl8_lety = vplety
     c     vpdtl8_key    chain     vpdtl8                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl8_lety = 0
     c     vpdtl8_key    chain     vpdtl8                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
      * Avbryter dersom leverandør eller overgruppe ikke finnes på varen
      *
     c                   if        vvldor = 0 and
     c                             vvogrp = 0
     c                   goto      kalk_pÅslag
     c                   endif
      *
      * Leverandør - varegruppe
      *
     c                   if        vvldor <> 0
      *
      * Initierering for påslag på høyere nivå
      *
     c                   eval      vpdtl9_pasl = d_pasl
     c                   eval      vpdtl9_ldor = vvldor
     c                   eval      vpdtl9_ogrp = vvogrp
     c                   eval      vpdtl9_hgrp = vvhgrp
     c                   eval      vpdtl9_ugrp = vvugrp
     c                   eval      vpdtl9_kpri = vvkpri
     c                   eval      vpdtl9_lety = vplety
     c                   eval      vpdtl9_vare = *blank
      *
      * Påslag på undergruppe-nivå
      *
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   if        vvkpri <> *blank
      *
     c                   eval      vpdtl9_kpri = *blank
     c                   eval      vpdtl9_lety = vplety
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   endif
      *
      * Påslag på hovedgruppe-nivå
      *
     c                   eval      vpdtl9_ugrp = 0
     c                   eval      vpdtl9_kpri = vvkpri
     c                   eval      vpdtl9_lety = vplety
      *
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   if        vvkpri <> *blank
      *
     c                   eval      vpdtl9_kpri = *blank
     c                   eval      vpdtl9_lety = vplety
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   endif
      *
      * Påslag på overgruppe-nivå
      *
     c                   eval      vpdtl9_hgrp = 0
     c                   eval      vpdtl9_kpri = vvkpri
     c                   eval      vpdtl9_lety = vplety
      *
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   if        vvkpri <> *blank
      *
     c                   eval      vpdtl9_kpri = *blank
     c                   eval      vpdtl9_lety = vplety
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   endif
      *
      * Påslag på leverandør-nivå
      *
     c                   eval      vpdtl9_ogrp = 0
     c                   eval      vpdtl9_kpri = vvkpri
     c                   eval      vpdtl9_lety = vplety
      *
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   if        vvkpri <> *blank
      *
     c                   eval      vpdtl9_kpri = *blank
     c                   eval      vpdtl9_lety = vplety
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   endif
      *
     c                   endif
      *
      * Varegruppe
      *
      * Initierering for påslag på høyere nivå
      *
     c                   eval      vpdtl9_pasl = d_pasl
     c                   eval      vpdtl9_ldor = 0
     c                   eval      vpdtl9_ogrp = vvogrp
     c                   eval      vpdtl9_hgrp = vvhgrp
     c                   eval      vpdtl9_ugrp = vvugrp
     c                   eval      vpdtl9_kpri = vvkpri
     c                   eval      vpdtl9_lety = vplety
     c                   eval      vpdtl9_vare = *blank
      *
      * Påslag på undergruppe-nivå
      *
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   if        vvkpri <> *blank
      *
     c                   eval      vpdtl9_kpri = *blank
     c                   eval      vpdtl9_lety = vplety
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   endif
      *
      * Påslag på hovedgruppe-nivå
      *
     c                   eval      vpdtl9_ugrp = 0
     c                   eval      vpdtl9_kpri = vvkpri
     c                   eval      vpdtl9_lety = vplety
      *
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   if        vvkpri <> *blank
      *
     c                   eval      vpdtl9_kpri = *blank
     c                   eval      vpdtl9_lety = vplety
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   endif
      *
      * Påslag på overgruppe-nivå
      *
     c                   eval      vpdtl9_hgrp = 0
     c                   eval      vpdtl9_kpri = vvkpri
     c                   eval      vpdtl9_lety = vplety
      *
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   if        vvkpri <> *blank
      *
     c                   eval      vpdtl9_kpri = *blank
     c                   eval      vpdtl9_lety = vplety
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
      *
     c                   if        vplety <> 0
     c                   eval      vpdtl9_lety = 0
     c     vpdtl9_key    chain     vpdtl9                             92
     c                   if        *in92 = *off
     c                   goto      hent_pÅslag
     c                   endif
     c                   endif
      *
     c                   endif
      *
     c                   goto      kalk_pÅslag
      *
     c     hent_pÅslag   tag
      *
     c                   eval      w_inpa = vjinpa
     c                   eval      w_inbe = vjinbe
     c                   eval      w_kopa = vjkopa
     c                   eval      w_kobe = vjkobe
     c                   eval      w_sapa = vjsapa
     c                   eval      w_sabe = vjsabe
     c                   eval      w_sapr = vjsapr
     c                   eval      w_dekn = vjdekn
      *
     c     kalk_pÅslag   tag
      *
     c                   if        w_inpa <> 0 or
     c                             w_inbe <> 0 or
     c                             w_kopa <> 0 or
     c                             w_kobe <> 0 or
     c                             w_sapa <> 0 or
     c                             w_sabe <> 0 or
     c                             w_sapr <> 0 or
     c                             w_dekn <> 0
     c                   eval      b_just = *on
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Kalkuler priser etter påslagsjustering
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     just_pris     begsr
      *
      * Prosentvis påslag
      *
     c                   if        w_inpa <> 0
     c                   eval(h)   vpinpr = vpinpr + (vpinpr * w_inpa / 100)
     c                   endif
      *
     c                   if        w_kopa <> 0
     c                   eval(h)   vpkopr = vpkopr + (vpkopr * w_kopa / 100)
     c                   endif
      *
     c                   if        w_sapa <> 0
     c                   eval(h)   vpsapr = vpsapr + (vpsapr * w_sapa / 100)
     c                   endif
      *
      * Påslag i kroner
      * Påslaget regnes om i forhold til omregningsfaktor for volum
      *
     c                   if        w_inbe <> 0 or
     c                             w_kobe <> 0 or
     c                             w_sabe <> 0
      *
     c                   eval      vvenl1_vare = vvvare
     c                   eval      vvenl1_enhe = vpenhe
     c     vvenl1_key2   chain     vvenl1                             92
     c                   if        *in92 = *off
      *
     c                   if        w_inbe <> 0 and
     c                             vpinpr <> 0
     c                   eval(h)   vpinpr = vpinpr + (w_inbe * veomre)
     c                   endif
      *
     c                   if        w_kobe <> 0 and
     c                             vpkopr <> 0
     c                   eval(h)   vpkopr = vpkopr + (w_kobe * veomre)
     c                   endif
      *
     c                   if        w_sabe <> 0 and
     c                             vpsapr <> 0
     c                   eval(h)   vpsapr = vpsapr + (w_sabe * veomre)
     c                   endif
      *
     c                   endif
      *
     c                   endif
      *
      * Salgspris
      * Salgspris regnes om i forhold til omregningsfaktor for volum
      *
     c                   if        w_sapr <> 0
      *
     c                   eval      vvenl1_vare = vvvare
     c                   eval      vvenl1_enhe = vpenhe
     c     vvenl1_key2   chain     vvenl1
     c                   if        %found
     c                   eval(h)   vpsapr = w_sapr * veomre
     c                   endif
      *
     c                   endif
      *
      * Dekning
      *
     c                   if        w_dekn <> 0
      *
     c                   if        vpkopr = 0
     c                   eval      vpkopr = vpinpr
     c                   endif
      *
     c                   if        vpkopr <> 0
     c                   eval(h)   vpsapr = (100 * vpkopr) / (100 - w_dekn)
     c                   endif
      *
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Kalkuler kostpris i tibudet på bakgrunn av påslagstaabell
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     just_tilb     begsr
      *
     c                   if        w_kopa = 0 and
     c                             w_kobe = 0
     c                   leavesr
     c                   endif
      *
      * Prosentvis påslag
      *
     c                   if        w_kopa <> 0
     c                   eval(h)   vtkop1 = vtkop1 + (vtkop1 * w_kopa / 100)
     c                   eval(h)   vtkop2 = vtkop2 + (vtkop2 * w_kopa / 100)
     c                   eval(h)   vtkop3 = vtkop3 + (vtkop3 * w_kopa / 100)
     c                   endif
      *
      * Påslag i kroner
      * Påslaget regnes om i forhold til omregningsfaktor for volum
      *
     c                   if        w_kobe <> 0
      *
     c                   if        vtenh1 <> *blank and
     c                             vtkop1 <> 0
     c                   eval      vvenl1_vare = vvvare
     c                   eval      vvenl1_enhe = vtenh1
     c     vvenl1_key2   chain     vvenl1
     c                   if        %found
     c                   eval(h)   vtkop1 = vtkop1 + (w_kobe * veomre)
     c                   endif
     c                   endif
      *
     c                   if        vtenh2 <> *blank and
     c                             vtkop2 <> 0
     c                   eval      vvenl1_vare = vvvare
     c                   eval      vvenl1_enhe = vtenh2
     c     vvenl1_key2   chain     vvenl1
     c                   if        %found
     c                   eval(h)   vtkop2 = vtkop2 + (w_kobe * veomre)
     c                   endif
     c                   endif
      *
     c                   if        vtenh3 <> *blank and
     c                             vtkop3 <> 0
     c                   eval      vvenl1_vare = vvvare
     c                   eval      vvenl1_enhe = vtenh3
     c     vvenl1_key2   chain     vvenl1
     c                   if        %found
     c                   eval(h)   vtkop3 = vtkop3 + (w_kobe * veomre)
     c                   endif
     c                   endif
      *
     c                   endif
      *
     c                   endsr
      *
6.13  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.13  * Subrutine for å sjekke om det er reelle endring på master
6.13  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.13  *
6.13 c     sjekk_endr    begsr
6.13  *
6.13 c                   eval      b_vvar = *off
6.13 c                   eval      b_vvpr = *off
6.13 c                   eval      b_vven = *off
6.13 c                   eval      b_vtil = *off
6.13 c                   eval      b_vean = *off
6.13  *
6.13 c                   eval      vvarl1_vare = vvvare
6.13 c     vvarl1_key    chain     vvarl1
6.13 c                   if        %found(vvarl1)
6.13 c                   move      vvedat        w_til_tims
6.13 c                   move      vvetim        w_til_tims
6.13 c                   if        w_til_tims > w_var_tims
6.13 c                   eval      b_vvar = *on
6.13 c                   eval      b_vvax = *on
6.31 c                   eval      b_vtil = *on
6.13 c                   endif
6.13 c                   endif
6.13  *
6.13 c                   eval      vvprl1_vare = vvvare
6.13 c     vvprl1_key    setll     vvprl1
6.13 c     vvprl1_key    reade     vvprl1
6.13 c                   dow       not %eof(vvprl1)
6.13 c                   move      vpedat        w_til_tims
6.13 c                   move      vpetim        w_til_tims
6.13 c                   if        w_til_tims > w_vpr_tims
6.13 c                   eval      b_vvpr = *on
6.13 c                   eval      b_vvpx = *on
6.13 c                   endif
6.13 c     vvprl1_key    reade     vvprl1
6.13 c                   enddo
6.14  *
6.14 c                   if        b_pasl = *on
6.14 c                   exsr      sjekk_paslag
6.14 c                   if        b_vpdt = *on
6.14 c                   eval      b_vvpr = *on
6.14 c                   eval      b_vvpx = *on
6.14 c                   endif
6.14 c                   endif
6.13  *
6.13 c                   eval      vvenl1_vare = vvvare
6.13 c     vvenl1_key    setll     vvenl1
6.13 c     vvenl1_key    reade     vvenl1
6.13 c                   dow       not %eof(vvenl1)
6.13 c                   move      veedat        w_til_tims
6.13 c                   move      veetim        w_til_tims
6.13 c                   if        w_til_tims > w_ven_tims
6.13 c                   eval      b_vven = *on
6.13 c                   eval      b_vvex = *on
6.13 c                   endif
6.13 c     vvenl1_key    reade     vvenl1
6.13 c                   enddo
6.13  *
6.13 c                   eval      vvepl1_pvar = vvvare
6.13 c     vvepl1_key    setll     vvepl1
6.13 c     vvepl1_key    reade     vvepl1
6.13 c                   dow       not %eof(vvepl1)
6.13 c                   move      vepeda        w_til_tims
6.13 c                   move      vepeti        w_til_tims
6.13 c                   if        w_til_tims > w_ven_tims
6.13 c                   eval      b_vven = *on
6.13 c                   eval      b_vvex = *on
6.13 c                   endif
6.13 c     vvepl1_key    reade     vvepl1
6.13 c                   enddo
6.13  *
6.13 c                   eval      vtill1_vare = vvvare
6.13 c     vtill1_key    setll     vtill1
6.13 c     vtill1_key    reade     vtill1
6.13 c                   dow       not %eof(vtill1)
6.13 c                   move      vtedat        w_til_tims
6.13 c                   move      vtetim        w_til_tims
6.13 c                   if        w_til_tims > w_vti_tims
6.13 c                   eval      b_vtil = *on
6.13 c                   eval      b_vtix = *on
6.13 c                   endif
6.13 c     vtill1_key    reade     vtill1
6.13 c                   enddo
6.13  *
6.13 c                   eval      veanl2_vare = vvvare
6.13 c     veanl2_key    setll     veanl2
6.13 c     veanl2_key    reade     veanl2
6.13 c                   dow       not %eof(veanl2)
6.13 c                   move      vxedat        w_til_tims
6.13 c                   move      vxetim        w_til_tims
6.13 c                   if        w_til_tims > w_vea_tims
6.13 c                   eval      b_vean = *on
6.13 c                   eval      b_veax = *on
6.13 c                   endif
6.13 c     veanl2_key    reade     veanl2
6.13 c                   enddo
6.13  *
6.13 c                   endsr
6.14  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.14  * Subrutine for å sjekke om det har vært endring på mellompåslagsregister
6.14  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.14 c     sjekk_paslag  begsr
6.14  *
6.14 c                   eval      b_vpdt = *off
6.14  *
6.14  * Påslag på vare-nivå  endret ?
6.14  *
6.14 c                   eval      vpdtl8_pasl = d_pasl
6.14 c                   eval      vpdtl8_vare = vvvare
6.14 c     vpdtl8_key2   setll     vpdtl8
6.14 c     vpdtl8_key2   reade     vpdtl8
6.14 c                   dow       not %eof(vpdtl8)
6.14 c                   move      vjedat        w_til_tims
6.14 c                   move      vjetim        w_til_tims
6.14 c                   if        w_til_tims > w_vpr_tims
6.14 c                   eval      b_vpdt = *on
6.14 c                   leavesr
6.14 c                   endif
6.14 c     vpdtl8_key2   reade     vpdtl8
6.14 c                   enddo
6.14  *
6.14  * Avbryter dersom leverandør eller overgruppe ikke finnes på varen
6.14  *
6.14 c                   if        vvldor = 0 and
6.14 c                             vvogrp = 0
6.14 c                   leavesr
6.14 c                   endif
6.14  *
6.14  * Leverandør - varegruppe
6.14  *
6.14 c                   if        vvldor <> 0
6.14  *
6.14  * Initierering for påslag på høyere nivå
6.14  *
6.14 c                   eval      vpdtl9_pasl = d_pasl
6.14 c                   eval      vpdtl9_ldor = vvldor
6.14 c                   eval      vpdtl9_ogrp = vvogrp
6.14 c                   eval      vpdtl9_hgrp = vvhgrp
6.14 c                   eval      vpdtl9_ugrp = vvugrp
6.14  *
6.14  * Påslag på undergruppe-nivå  endret ?
6.14  *
6.14 c     vpdtl9_key2   setll     vpdtl9
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   dow       not %eof(vpdtl9)
6.14 c                   move      vjedat        w_til_tims
6.14 c                   move      vjetim        w_til_tims
6.14 c                   if        w_til_tims > w_vpr_tims
6.14 c                   eval      b_vpdt = *on
6.14 c                   leavesr
6.14 c                   endif
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   enddo
6.14  *
6.14  * Påslag på hovedgruppe-nivå
6.14  *
6.14 c                   eval      vpdtl9_ugrp = 0
6.14  *
6.14 c     vpdtl9_key2   setll     vpdtl9
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   dow       not %eof(vpdtl9)
6.14 c                   move      vjedat        w_til_tims
6.14 c                   move      vjetim        w_til_tims
6.14 c                   if        w_til_tims > w_vpr_tims
6.14 c                   eval      b_vpdt = *on
6.14 c                   leavesr
6.14 c                   endif
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   enddo
6.14  *
6.14  * Påslag på overgruppe-nivå
6.14  *
6.14 c                   eval      vpdtl9_hgrp = 0
6.14  *
6.14 c     vpdtl9_key2   setll     vpdtl9
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   dow       not %eof(vpdtl9)
6.14 c                   move      vjedat        w_til_tims
6.14 c                   move      vjetim        w_til_tims
6.14 c                   if        w_til_tims > w_vpr_tims
6.14 c                   eval      b_vpdt = *on
6.14 c                   leavesr
6.14 c                   endif
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   enddo
      *
6.14  *
6.14  * Påslag på leverandør-nivå
6.14  *
6.14 c                   eval      vpdtl9_ogrp = 0
6.14  *
6.14 c     vpdtl9_key2   setll     vpdtl9
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   dow       not %eof(vpdtl9)
6.14 c                   move      vjedat        w_til_tims
6.14 c                   move      vjetim        w_til_tims
6.14 c                   if        w_til_tims > w_vpr_tims
6.14 c                   eval      b_vpdt = *on
6.14 c                   leavesr
6.14 c                   endif
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   enddo
6.14  *
     c                   endif
6.14  *
6.14  * Varegruppe
6.14  *
6.14  * Initierering for påslag på høyere nivå
6.14  *
6.14 c                   eval      vpdtl9_pasl = d_pasl
6.14 c                   eval      vpdtl9_ldor = 0
6.14 c                   eval      vpdtl9_ogrp = vvogrp
6.14 c                   eval      vpdtl9_hgrp = vvhgrp
6.14 c                   eval      vpdtl9_ugrp = vvugrp
6.14  *
6.14  * Påslag på undergruppe-nivå  endret ?
6.14  *
6.14 c     vpdtl9_key2   setll     vpdtl9
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   dow       not %eof(vpdtl9)
6.14 c                   move      vjedat        w_til_tims
6.14 c                   move      vjetim        w_til_tims
6.14 c                   if        w_til_tims > w_vpr_tims
6.14 c                   eval      b_vpdt = *on
6.14 c                   leavesr
6.14 c                   endif
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   enddo
6.14  *
6.14  * Påslag på hovedgruppe-nivå
6.14  *
6.14 c                   eval      vpdtl9_ugrp = 0
6.14  *
6.14 c     vpdtl9_key2   setll     vpdtl9
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   dow       not %eof(vpdtl9)
6.14 c                   move      vjedat        w_til_tims
6.14 c                   move      vjetim        w_til_tims
6.14 c                   if        w_til_tims > w_vpr_tims
6.14 c                   eval      b_vpdt = *on
6.14 c                   leavesr
6.14 c                   endif
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   enddo
6.14  *
6.14  * Påslag på overgruppe-nivå
6.14  *
6.14 c                   eval      vpdtl9_hgrp = 0
6.14  *
6.14 c     vpdtl9_key2   setll     vpdtl9
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   dow       not %eof(vpdtl9)
6.14 c                   move      vjedat        w_til_tims
6.14 c                   move      vjetim        w_til_tims
6.14 c                   if        w_til_tims > w_vpr_tims
6.14 c                   eval      b_vpdt = *on
6.14 c                   leavesr
6.14 c                   endif
6.14 c     vpdtl9_key2   reade     vpdtl9
6.14 c                   enddo
6.14  *
6.14 c                   endsr
6.13  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.13  * Subrutine for å oppdatere endringsdatoer hvis det har vært endringer
6.13  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.13 c     upd_acpl      begsr
6.13  *
6.13 c                   if        b_vvax = *on or
6.13 c                             b_vvpx = *on or
6.13 c                             b_vvex = *on or
6.13 c                             b_veax = *on or
6.13 c                             b_vtix = *on
6.13 c                   eval      acpllu_lfgr = d_fgrp
6.13 c                   eval      acpllu_lfir = d_firm
6.13 c                   eval      acpllu_lfgt = d_fgrt
6.13 c                   eval      acpllu_lfit = d_firt
6.13 c     acpllu_key    chain     acpllu
6.13 c                   if        %found(acpllu)
6.13 c                   if        b_vvax = *on
6.13 c                   time                    aclvvd
6.13 c                   time                    aclvvt
6.13 c                   endif
6.13 c                   if        b_vvpx = *on
6.13 c                   time                    aclvpd
6.13 c                   time                    aclvpt
6.13 c                   endif
6.13 c                   if        b_vvex = *on
6.13 c                   time                    aclved
6.13 c                   time                    aclvet
6.13 c                   endif
6.13 c                   if        b_veax = *on
6.13 c                   time                    aclvxd
6.13 c                   time                    aclvxt
6.13 c                   endif
6.13 c                   if        b_vtix = *on
6.13 c                   time                    aclvtd
6.13 c                   time                    aclvtt
6.13 c                   endif
6.13 c                   update    acpllur
6.13 c                   endif
6.13  *
6.13 c                   endif
6.13  *
6.13 c                   endsr
6.24  *
6.24  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.24  * Subrutine for å kopiere tilbud som ikke er pr. varenr
6.24  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.24 c     kopi_tilb     begsr
6.24  *
6.24 c                   eval      vtillu_ogrp = 0
6.24 c                   eval      vtillu_hgrp = 0
6.24 c                   eval      vtillu_ugrp = 0
6.24 c                   eval      vtillu_ldor = 0
6.24 c                   eval      vtillu_vare = *blank
6.24 c     vtillu_key    setll     vtillu
6.24 c                   read      vtillur
6.24 c                   dow       not %eof(vtillu)   and
6.24 c                             vtfirm = w_firt
6.24  *
6.24 c                   if        %subst(vtkamp:1:1) <> 'L' and
6.24 c                             vtvare = *blank
6.24 c                   delete    vtillur
6.24 c                   endif
6.24 c                   read      vtillur
6.24 c                   enddo
6.24  *
6.24 c                   eval      vtill1_ogrp = 0
6.24 c                   eval      vtill1_hgrp = 0
6.24 c                   eval      vtill1_ugrp = 0
6.24 c                   eval      vtill1_ldor = 0
6.24 c                   eval      vtill1_vare = *blank
6.24 c     vtill1_key    setll     vtill1
6.24 c                   read      vtill1
6.24 c                   dow       not %eof(vtill1) and
6.24 c                             vtfirm = w_firm
6.24  *
6.24 c                   if        %subst(vtkamp:1:1) <> 'L' and
6.24 c                             vtvare = *blank
6.24  *
6.24 c                   eval      vtfirm = w_firt
6.24  *
6.24  *
6.24 c                   time                    vtodat
6.24 c                   time                    vtotim
6.24 c                   eval      vtousr = l_user
6.24 c                   time                    vtedat
6.24 c                   time                    vtetim
6.24 c                   eval      vteusr = l_user
6.24 c                   write     vtillur
6.24  *
6.24 c                   endif
6.24  *
6.24 c                   read      vtill1
6.24 c                   enddo
6.24  *
6.24 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_list
     c                   parm                    p_list2
      *
      * Kopierer fra .....
      *
      * Key for oppslag på vare
      *
     c     vvarl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl1_vare
      *
      * Key les på vare
      *
     c     vvarlr_key    klist
     c                   kfld                    w_firm
      *
      * Key les på vare med leverandør
      *
     c     vvarl5_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl5_ldor
      *
      * Key for les på vare-enhet
      *
     c     vvenl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvenl1_vare
      *
     c     vvenl1_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    vvenl1_vare
     c                   kfld                    vvenl1_enhe
6.11  *
6.11  * Key for les på vare-enhet-prisgiver
6.11  *
6.11 c     vvepl1_key    klist
6.11 c                   kfld                    w_firm
6.11 c                   kfld                    vvepl1_pvar
      *
      * Key for les på vare-pris
      *
     c     vvprl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvprl1_vare
      *
      * Key for les på tilbud
      *
     c     vtill1_key    klist
     c                   kfld                    w_firm
6.21 c                   kfld                    vtill1_ogrp
6.21 c                   kfld                    vtill1_hgrp
6.21 c                   kfld                    vtill1_ugrp
6.21 c                   kfld                    vtill1_ldor
     c                   kfld                    vtill1_vare
6.25  *
6.25  * Key for les på tilbud  (ekstra les)
6.25  *
6.25 c     vtillr_key    klist
6.25 c                   kfld                    w_firm
6.25 c                   kfld                    vtillr_ogrp
6.25 c                   kfld                    vtillr_hgrp
6.25 c                   kfld                    vtillr_ugrp
6.25 c                   kfld                    vtillr_ldor
6.25 c                   kfld                    vtillr_vare
6.25 c                   kfld                    vtillr_prgr
6.25 c                   kfld                    vtillr_lety
6.25 c                   kfld                    vtillr_fdat
6.25 c                   kfld                    vtillr_ftim
6.25 c                   kfld                    vtillr_tdat
6.25 c                   kfld                    vtillr_ttim
6.33  *
6.33  * Key for les på vare-leverandør
6.33  *
6.33 c     vvlel1_key    klist
6.33 c                   kfld                    w_firm
6.33 c                   kfld                    vvlel1_lvnr
6.33  *
6.33  * Key for les på vare-leverandør
6.33  *
6.33 c     vvlelu_key    klist
6.33 c                   kfld                    w_firm
6.33 c                   kfld                    vvlelu_lvnr
6.33  *

      * Key for les på vare-søketekst
      *
     c     vvsol1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvsol1_svar
      *
      * Key for les på søketekst
      *
5.61 c*    vsokl1_key    klist
5.61 c*                  kfld                    w_firm
5.61 c*                  kfld                    vsokl1_vare
      *
      * Key for les på EAN
      *
     c     veanl2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    veanl2_vare
      *
      * Key for oppslag på påslag-linje
      *
     c     vpdtl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vpdtl1_pasl
     c                   kfld                    vpdtl1_ldor
     c                   kfld                    vpdtl1_ogrp
     c                   kfld                    vpdtl1_hgrp
     c                   kfld                    vpdtl1_ugrp
     c                   kfld                    vpdtl1_kpri
     c                   kfld                    vpdtl1_vare
     c                   kfld                    vpdtl1_lety
      *
     c     vpdtl1_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    vpdtl1_pasl
      *
     c     vpdtl8_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vpdtl8_pasl
     c                   kfld                    vpdtl8_vare
     c                   kfld                    vpdtl8_lety
6.14  *
6.14 c     vpdtl8_key2   klist
6.14 c                   kfld                    w_firm
6.14 c                   kfld                    vpdtl8_pasl
6.14 c                   kfld                    vpdtl8_vare
      *
     c     vpdtl9_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vpdtl9_pasl
     c                   kfld                    vpdtl9_ldor
     c                   kfld                    vpdtl9_ogrp
     c                   kfld                    vpdtl9_hgrp
     c                   kfld                    vpdtl9_ugrp
     c                   kfld                    vpdtl9_kpri
     c                   kfld                    vpdtl9_lety
     c                   kfld                    vpdtl9_vare
6.14  *
6.14 c     vpdtl9_key2   klist
6.14 c                   kfld                    w_firm
6.14 c                   kfld                    vpdtl9_pasl
6.14 c                   kfld                    vpdtl9_ldor
6.14 c                   kfld                    vpdtl9_ogrp
6.14 c                   kfld                    vpdtl9_hgrp
6.14 c                   kfld                    vpdtl9_ugrp
5.70  *
5.70  * Key for les av alle lager
5.70  *
5.70 c     ra10l1_key    klist
5.70 c                   kfld                    w_firm
      *
      * Kopierer til .....
      *
      * Key for oppdatering av vare (til)
      *
     c     vvarlu_key    klist
     c                   kfld                    w_firt
     c                   kfld                    vvarlu_vare
      *
      * Key for oppdatering av vare-enhet (til)
      *
     c     vvenlu_key    klist
     c                   kfld                    w_firt
     c                   kfld                    vvenlu_vare
6.11  *
6.11  * Key for oppdatering av vare-enhet-prisgiver (til)
6.11  *
6.11 c     vveplu_key    klist
6.11 c                   kfld                    w_firt
6.11 c                   kfld                    vveplu_pvar
      *
      * Key for oppdatering av vare-pris (til)
      *
     c     vvprlu_key    klist
     c                   kfld                    w_firt
     c                   kfld                    vvprlu_vare
      *
      * Key for oppdatering av tilbud (til)
      *
     c     vtillu_key    klist
     c                   kfld                    w_firt
6.21 c                   kfld                    vtillu_ogrp
6.21 c                   kfld                    vtillu_hgrp
6.21 c                   kfld                    vtillu_ugrp
6.21 c                   kfld                    vtillu_ldor
     c                   kfld                    vtillu_vare
      *
      * Key for oppdatering av vare-søketekst (til)
      *
     c     vvsolu_key    klist
     c                   kfld                    w_firt
     c                   kfld                    vvsolu_svar
      *
      * Key for oppdatering av søketekst (til)
      *
5.61 c*    vsoklu_key    klist
5.61 c*                  kfld                    w_firt
5.61 c*                  kfld                    vsoklu_vare
      *
      * Key for oppdatering av EAN (til)
      *
     c     veanlu_key    klist
     c                   kfld                    w_firt
     c                   kfld                    veanlu_eann
      *
      * Key for oppslag på OFAK-kode (til)
      *
     c     fstsl1_key    klist
     c                   kfld                    w_firt
      *
      * Key for oppslag på lager (til)
      *
     c     vlagl1_key    klist
     c                   kfld                    w_firt
     c                   kfld                    vlagl1_vare
6.12 c                   kfld                    vlagl1_lage
6.13  *
6.13  * Key for oppslag på filkopieringsregister
6.13  *
6.13 c     acpll1_key    klist
6.13 c                   kfld                    acpll1_lfgr
6.13 c                   kfld                    acpll1_lfir
6.13 c                   kfld                    acpll1_lfgt
6.13 c                   kfld                    acpll1_lfit
6.13  *
6.13  * Key for oppslag på filkopieringsregister
6.13  *
6.13 c     acpllu_key    klist
6.13 c                   kfld                    acpllu_lfgr
6.13 c                   kfld                    acpllu_lfir
6.13 c                   kfld                    acpllu_lfgt
6.13 c                   kfld                    acpllu_lfit
      *
      * Kopiering av parameterliste til datastruktur og enkelt-parametre
      *
     c                   eval      d_list = p_list
     c                   eval      d_list2 = p_list2
      *
     c                   eval      w_firm = d_firm
     c                   eval      w_firt = d_firt
6.13  *
6.13  * leser filkopieringsregister
6.13 c                   eval      acpll1_lfgr = d_fgrp
6.13 c                   eval      acpll1_lfir = d_firm
6.13 c                   eval      acpll1_lfgt = d_fgrt
6.13 c                   eval      acpll1_lfit = d_firt
6.13 c     acpll1_key    chain     acpll1
     c                   move      aclvvd        w_var_tims
     c                   move      aclvvt        w_var_tims
     c                   move      aclvpd        w_vpr_tims
     c                   move      aclvpt        w_vpr_tims
     c                   move      aclved        w_ven_tims
     c                   move      aclvet        w_ven_tims
     c                   move      aclvtd        w_vti_tims
     c                   move      aclvtt        w_vti_tims
     c                   move      aclvxd        w_vea_tims
     c                   move      aclvxt        w_vea_tims
6.13  *
6.13 c                   eval      b_vvar = *on
6.13 c                   eval      b_vvpr = *on
6.13 c                   eval      b_vven = *on
6.13 c                   eval      b_vtil = *on
6.13 c                   eval      b_vean = *on
      *
     c                   endsr
