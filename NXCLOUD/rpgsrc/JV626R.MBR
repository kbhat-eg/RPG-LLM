6.37 h option(*nodebugio) datedit(*dmy-) decedit('0.')
6.37 h DftActgrp(*No) BndDir('CGIDEV2/CGIDEV2')
6.37  /copy hspecsbnd
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASVADM
      * Program . . . . : JV626R
      * Beskrivelse . . : Batch program som oppdaterer priser og
      *                   vareinformasjon på varer som passer
      *                   til utvalgsmasken til eget vareregister.
      *                   Programmet skriver ut kontroll- og journalliste.
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       250899 HKO  Nytt program
      *       090200 HKO  Rettet feil med at pris ble satt til 0 dersom den
      *                   ikke skulle oppdateres
      *       090101 HKO  Lagt inn oppdatering av butikkpris med samme
      *                   prosentvis oppdatering som salgspris
      *       250803 HKO  Lagt inn logikk for kun å vise varer hvor
      *                   prisgiver sammefaller med leverandør i EVR
      *       060903 HKO  Lagt inn logikk for merking av innkjøpsenhet og
      *                   prisbokenhet i EVR
      *       300505 HKO  Dersom prisdato ikke er utfylt benyttes Nobb
      *                   prisdato
      *       170605 HKO  Behandler priser på leveringstyper med aktive
      *                   betingelser eller påslagskalkyle
      *       090805 HKO  Håndterer individuell rekkefølge på salgsenheter,
      *                   innkjøpsenheter og prisbokenheter.
      *                   Skriver lengde, bredde, høyde, vekt og volum til
      *                   vare-enhet i EVR
      *       121105 HKO  Lagt inn valg for å utelate varer utgått på dato
      *                   i EVR
      *       280508 bof  Utvidet parm. til JV750R
5.70  * PRGR  191108 bof  Utvidet med prisgruppe
6.10  *       260809 bof  Endret statuskode fra num. til alfa.
6.11  *       260809 bof  Ryddet i epic, upcn mm.  (fjernet fra JVARPF)
6.12  *       030909 bof  Utvidet med sortimentskode
6.13  *       100909 bof  Lagt ut pakningsklasse
6.14  *       240909 bof  Utvidet med pakn.info pr. lev +++
6.15  *       240909 bof  Utvidet med tvangsoverføring av en vare
6.16  *       110510 bof  Hvis GTIN ikke ligger på prisgiver,tas produsent
6.16  *                   sin GTIN.
6.17  *       130910 bof  Liten feilrett. vedr. chain
6.18  *       211010 bof  GTIN. hvis gtin finnes på annen vare,så blankes dette
6.18  *                   + justering av reade jvppl1
6.19  *       021110 bof  Vil ikke oppd.priser på lev.type > 0
6.1a  *       051110 bof  Justering oppd.levtype>0 og det er status O
6.1b  *       101110 bof  Hvis prisgiver ikke har gtin på enhet,så overf.
      *                   vareeiers.
os71  * os71  151210 bsa  Lagt inn korreksjoner på SQL pga. OS/400 feil
os71  *                   Det er også lagt inn endring på SQL,
os71  *                   som er nødvendig ved overgang til v6.1
6.1c  *       030211 bof  Justert oppdat gtin, hopper over pakn 000
6.1d  *       150311 bof  Justering oppd.levtype>0 - blanke prisgruppe
6.1d  *       250310 bof  korreksjon av prisgiver på oppd. vveppf
6.1e  *       250310 bof  Rydde i vveppf hver gang, evt. legge gtin i veanpf
6.1f  *       050811 bof  Rettet feil på lengde på vare på paramter + dummy
6.20  * 6.20  280111 bof  Henter utg.dato fra lager
6.21  * 6.20  120411 bof  Utvidet med leverandørstyrte priser
6.22  * 6.20  040112 bof  Henter EVR-priser fra en bestemt leverandør
6.23  * 6.20  150112 bof  Feilr. 6.21 + fjerne priser hvis lev.byttes
6.24  * 6.20  030314 bof  Kun overføre gtin for gjeldende prisgiver
6.24a *       080114 bof  Hvis bytte av hovedlev.,så hentes prisforskjell
6.25  *       090114 bof  Justering vedr.endre lev.nr pga. 2dp
6.26  * 6.20  030314 bof  Kun overføre gtin for gjeldende prisgiver
6.28  * 6.20  140616 bsa  Selv om sjansen er svært liten har vi fått
6.28  *                   overflow i beregning.
6.30  *       240214 bof  Utvidet nøkkel med lev.nr i JVPKPF
6.30  *                   Fjernet JVPPPF (data er flyttet JVPKPF)
6.32  *       140314 bof  Lagt inn test på fra /til dato på pakning
6.33  *       270314 bof  Hvis pris har utgått, skal den ikke brukes
6.34  *       010414 bof  Rettelse vedr. oppd. av vveppf
6.35  *       140714 bof  Utvidet med flere priser pr. dato, velg pris ut
6.35  *                   fra dato i parameter. også parm. for utg.priser
6.36  *       060814 bof  Utvidelse med fraktbetingelse
6.37  * 6.30  210814 bsa  Innført PDF og excel på listevalg
6.38  * R6.30 120914 bsa  Utvidet parameterliste til FO798R.
6.39  * 6.20  271014 bkv  Henter utg.dato fra vare, ikke fra lager
6.3a  * 6.30  280115 bsa  Skriver til datakø for å trigge java sniffer
6.3b  * 6.30  150415 bsa  Feil i parameterliste til FÅ707R
6.3c  * 6.30  150415 bsa  Legger ut fra-dato for pris i excel
6.3d  * 6.30  060514 bof  Tester om dato er loval
6.3e  * 6.30  050615 Bsa  Nullstiller minne før utlegging av xml file
6.3q  *       260515 bof  Datoformat sql
6.3f  * 6.30  260615 bof  Test slik at man får prisoppdatert underlev.
6.3g  * 6.30  020715 bof  feilretting vedr. oppd. av gtin
      *
6.3x  * 6.30  040615 bof  utvidet parm i forb. med prgr. på betingelse
6.3y  * 6.30  050815 bof  utv. parm i forb. med prgr. på frakt + oppdat.
6.3h  * 6.30  220915 bof  Feilretting vedr. pris fram i tid, bruke valgt
6.3h  *                   pris sin prisdato
6.3i  * 6.30  261015 bof  Hvis endr. av resk.nr,så må pris oppdateres.
6.3j  * 6.30  260616 bof  Feilretting, for mange linjer på lista og oppd.
6.3k  * 6.30  250716 bsa  Skriver kun ei linje, ikke repeter samme info.
6.3l  * 6.30  020816 bof  Feilretting vedr. test på til prisdato.
6.3m  * R6.30 180816 bsa  Rokkert på rekkefølge av close printerfile
6.3n  *       160916 bof  Ny datostyring på prisdato i EVR og prisdato l.dor
6.3o  *       121216 bof  Oppdatering av nobb. utgårdato på varekortet l.dor
6.3p  * R6.30 180317 bof  Feilretting vedr. utskrift excel overfl.
6.3q  * 6.30  140918 bof  Utvidet med trelast sortiment
6.3r  * R6.30 100119 bkv  Utvide verdi variabel
6.3s  * R6.30 150119 bof  Nullstiller variabler.
6.3t  * R6.30 040219 bof  Feilretting vedr. oppd.av vvlepf ved bytte resk.nr.
6.3u  * R6.30 170419 bkv  Fyller variabler.
6.3v  * R6.30 170419 bkv  Retter feil i logivare sjekk
6.3w  * R6.30 060819 bof  Ikke dann pris på PG hvis pris ikke dann PG=blank (6.3q)
6.3x  * R6.30 260319 bof  Sjekk om ny prisgr.pris har tidl.prisgr
6.3z  * R6.30 130819 bof  Omregning av nobbpris i vvprpf
6.3y  * R6.30 230320 bof  Kun hov.lev får endre enheter, under.lev skal kun
6.3y  *                   ha pris på gyldige enheter i VA.
7.01  *K00    270820 bof  Hvis ikke hovedprisgiver, så må alikevel enhetsinfo oppdateres
8.01  *PRG2   150622 bof  Utvidet prisgruppe fra 1 til 2 posisjoner
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fjvprpf    if   e           k disk
6.3j fjvlepf    if   e           k disk
      *
     fjvarl5    if   e           k disk    rename(jvarpfr:jvarl5r)
     fjvarl1    if   e           k disk    rename(jvarpfr:jvarl1r)
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fjvdtl1    if   e           k disk    rename(jvdtpfr:jvdtl1r)
     fjvpkl2    if   e           k disk    rename(jvpkpfr:jvpkl2r)
6.33 fjvprl1    if   e           k disk    rename(jvprpfr:jvprl1r)
6.14 f*vppl1    if   e           k disk    rename(jvpppfr:jvppl1r)
6.16 f*vpplr    if   e           k disk    rename(jvpppfr:jvpplrr)
     fvvarlu    uf   e           k disk    rename(vvarpfr:vvarlur)
     fvvprlu    uf a e           k disk    rename(vvprpfr:vvprlur)
6.14 fveanlu    uf a e           k disk    rename(veanpfr:veanlur)
     fvvenl1    if   e           k disk    rename(vvenpfr:vvenl1r)
6.14 fvvepl1    if   e           k disk    rename(vveppfr:vvepl1r)
6.18 fvvepl2    uf   e           k disk    rename(vveppfr:vvepl2r)
     fvvenlu    uf a e           k disk    rename(vvenpfr:vvenlur)
6.14 fvveplu    uf a e           k disk    rename(vveppfr:vveplur)
6.3q fvvlelu    uf a e           k disk    rename(vvlepfr:vvlelur)
     fjwprlu    uf   e           k disk    rename(jwprpfr:jwprlur)
     fjvdtlu    uf a e           k disk    rename(jvdtpfr:jvdtlur)
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
     fjlevl1    if   e           k disk    rename(jlevpfr:jlevl1r)
     fvogrl1    if   e           k disk    rename(vogrpfr:vogrl1r)
     fvhgrl1    if   e           k disk    rename(vhgrpfr:vhgrl1r)
     fvugrl1    if   e           k disk    rename(vugrpfr:vugrl1r)
     fvltpl1    if   e           k disk    rename(vltppfr:vltpl1r)
5.70 fra30l1    if   e           k disk    rename(ra30pfr:ra30l1r)
6.14 fjsorl1    if   e           k disk    rename(jsorpfr:jsorl1r)
6.23 fvlaglu    uf   e           k disk    rename(vlagpfr:vlaglur)
6.37 faforl1    if   e           k disk    rename(aforpfr:aforl1r)
6.3j fjvlelr    if   e           k disk    rename(jvlepfr:jvlelrr)
6.3q fjvkhl1    if   e           k disk    rename(jvkhpfr:jvkhl1r)
6.3x fvvprl1    if   e           k disk    rename(vvprpfr:vvprl1r)
      *
     fjv626p    o    e             printer
6.37 f                                     usropn
      *
      * Definering av parametre
      *
6.3h d p_parm          s             78
      *
     d p_firm          s              3  0
     d p_otyp          s              1  0
6.3h d p_edat          s               d   datfmt(*iso)
6.3h d p_pdat          s               d   datfmt(*iso)
     d p_sams          s              1  0
     d p_utgd          s              1  0
     d p_inio          s              1  0
     d p_koio          s              1  0
     d p_saio          s              1  0
     d p_kntr          s              1  0
      *
     d p_ldor          s                   like(jvldor)
     d p_ogrp          s                   like(jvogrp)
     d p_hgrp          s                   like(jvhgrp)
     d p_ugrp          s                   like(jvugrp)
     d p_pgiv          s                   like(jvldor)
6.15 d p_vare          s                   like(jvvare)
6.21 d p_flpr          s              1  0
      *
     d w_enum          s                   like(jlenum)
      *
      * Definering av Local data area
      *
     d                uds
6.37 d l_poff                584    584
6.37 d l_utqm                585    594
6.37 d l_bach                595    635
6.37 d l_arch                636    636  0
6.37 d l_skje                637    637  0
6.37 d l_exlp                639    639  0
6.37 d l_mail                640    640  0
6.37 d l_prfi                750    750  0
6.37 d l_outq                810    819
6.37 d l_copy                838    843  0
6.37 d l_ruti                800    809
     d l_wsid                901    910
     d l_user                911    920
6.37 d l_filg                931    933
6.37 d l_firm                944    946  0
6.37 d l_avde                947    950  0
6.37 d l_fnav                951    980
6.20 d l_lage               1001   1002  0
      *
      * Datastruktur for parameterliste -inn
      *
     d                 ds
8.01 d d_list                        79
     d  d_firm                        3  0 overlay(d_list)
     d  d_otyp                        1  0 overlay(d_list:4)
6.3n d  d_edat                         d   overlay(d_list:5)  datfmt(*iso)
     d  d_ldor                        6  0 overlay(d_list:15)
     d  d_ogrp                        2  0 overlay(d_list:21)
     d  d_hgrp                        2  0 overlay(d_list:23)
     d  d_ugrp                        3  0 overlay(d_list:25)
     d  d_pgiv                        6  0 overlay(d_list:28)
     d  d_sams                        1  0 overlay(d_list:34)
     d  d_utgd                        1  0 overlay(d_list:35)
     d  d_inio                        1  0 overlay(d_list:36)
     d  d_koio                        1  0 overlay(d_list:37)
     d  d_saio                        1  0 overlay(d_list:38)
     d  d_kntr                        1  0 overlay(d_list:39)
8.01 d  d_prgr                        2    overlay(d_list:40)
8.01 d  d_osor                       10    overlay(d_list:42)
8.01 d  d_vare                       15    overlay(d_list:52)
8.01 d  d_flpr                        1  0 overlay(d_list:67)
8.01 d  d_utgp                        1  0 overlay(d_list:68)
8.01 d  d_pdat                         d   overlay(d_list:69) datfmt(*iso)
8.01 d  d_dumm                        1    overlay(d_list:79)
      *
      * Definering av variabler i nøkler
      *
     d jvarl5_ldor     s                   like(jvldor)
     d jvarl1_vare     s                   like(jvvare)
     d vvarl1_vare     s                   like(vvvare)
     d jvdtl1_dvar     s                   like(jvdvar)
     d jvpkl2_vare     s                   like(jwvare)
6.30 d jvpkl2_ldor     s                   like(jwldor)
     d jvpkl2_enhe     s                   like(jwenhe)
6.14 d*jvppl1_pvar     s                   like(jwpvar)
6.18 d*jvppl1_ppak     s                   like(jwppak)
6.16 d*jvpplr_pvar     s                   like(jwpvar)
6.16 d*jvpplr_ppak     s                   like(jwppak)
6.16 d*jvpplr_pldo     s                   like(jwpldo)
6.33 d jvprl1_vare     s                   like(jxvare)
6.33 d jvprl1_ldor     s                   like(jxldor)
     d vvarlu_vare     s                   like(vvvare)
     d vvprlu_vare     s                   like(vpvare)
6.21 d vvprlu_ldor     s                   like(vpldor)
5.70 d vvprlu_prgr     s                   like(vpprgr)
     d vvprlu_enhe     s                   like(vpenhe)
     d vvprlu_lety     s                   like(vplety)
     d vvprlu_pdat     s                   like(vppdat)
6.14 d veanlu_eann     s                   like(vxeann)
     d vvenl1_vare     s                   like(vevare)
6.14 d vvepl1_pvar     s                   like(vepvar)
6.18 d vvepl2_pgti     s                   like(vepgti)
     d vvenlu_vare     s                   like(vevare)
     d vvenlu_enhe     s                   like(veenhe)
6.14 d vveplu_pvar     s                   like(vepvar)
6.14 d vveplu_penh     s                   like(vepenh)
6.14 d vveplu_pldo     s                   like(vepldo)
     d jwprlu_vare     s                   like(jbvare)
     d jvdtlu_dvar     s                   like(jvdvar)
     d jlevl1_ldor     s                   like(jlldor)
     d vogrl1_oogr     s                   like(vgoogr)
     d vhgrl1_hogr     s                   like(vghogr)
     d vhgrl1_hhgr     s                   like(vghhgr)
     d vugrl1_uogr     s                   like(vguogr)
     d vugrl1_uhgr     s                   like(vguhgr)
     d vugrl1_uugr     s                   like(vguugr)
6.14 d jsorl1_osor     s                   like(jsosor)
6.23 d vlaglu_vare     s                   like(vlvare)
6.37 d aforl1_ruti     s                   like(afruti)
6.3j d jvlelr_lldo     s                   like(jvlldo)
6.3j d jvlelr_lvnr     s                   like(jvlvnr)
6.3q d vvlelu_lvnr     s                   like(vvlvnr)
6.3q d vvlelu_lldo     s                   like(vvlldo)
6.3q d jvkhl1_kvnr     s                   like(jvkvnr)
6.3x d vvprl1_vare     s                   like(vpvare)
6.3x d vvprl1_ldor     s                   like(vpldor)
6.3x d vvprl1_prgr     s                   like(vpprgr)
6.3x d vvprl1_enhe     s                   like(vpenhe)
6.3x d vvprl1_lety     s                   like(vplety)
      *
      * Definering av variable
      *
     d b_EOF           s              1    inz(*off)
5.70 d b_lety          s              1    inz(*off)
6.20 d b_inlr          s              1    inz(*off)
6.1b d b_gtin          s              1    inz(*off)
6.23 d b_pris          s              1    inz(*off)
6.32 d b_pakn          s              1    inz(*off)
6.3q d b_logv          s              1    inz(*off)
6.3w d b_dann          s              1    inz(*off)
6.3w d b_enhe          s              1    inz(*off)
      *
     d w_firm          s              3  0
6.10 d w_osts          s              1
     d w_midl          s              1  0
     d w_bvty          s              1
     d w_blet          s              1  0
     d w_bbet          s             35
     d w_dekn          s              5  2
     d w_enh           s              3
6.3x d w_pgenh         s              3
6.3y d w_enhx          s              3
     d w_enh1          s              3
     d w_enh2          s              3
     d w_enh3          s              3
     d w_eni1          s              3
     d w_eni2          s              3
     d w_eni3          s              3
     d w_enp1          s              3
     d w_enp2          s              3
     d w_enp3          s              3
     d w_gdat          s               d   datfmt(*iso)
     d w_grpr          s              9  2
     d w_ifak          s              8  6
     d w_inpr          s              9  2
6.36 d w_inpr2         s              9  2
     d w_kbel          s              7  2
     d w_kfak          s              8  6
     d w_kopr          s              9  2
     d w_ntpr          s              8  2
     d w_ofp1          s             12  6
     d w_ofp2          s             12  6
     d w_ofp3          s             12  6
     d w_ofv2          s             12  6
     d w_ofv3          s             12  6
     d w_ofi1          s             12  6
     d w_ofi2          s             12  6
     d w_ofi3          s             12  6
     d w_ppko          s              1
     d w_pvty          s              1
     d w_plet          s              1  0
     d w_sfak          s              8  6
     d w_s1im          s              9  2
     d w_s1pr          s              9  2
     d w_s2im          s              9  2
     d w_s2pr          s              9  2
     d w_s3im          s              9  2
     d w_s3pr          s              9  2
     d w_k2pr          s              9  2
     d w_i2pr          s              9  2
6.36 d w_i2pr2         s              9  2
     d w_k3pr          s              9  2
     d w_i3pr          s              9  2
6.36 d w_i3pr2         s              9  2
     d w_inlr          s              1
8.01 d w_prut          s                   like(vpprgr)
8.01 d w_pgbe          s                   like(vpprgr)
8.01 d w_prgr          s                   like(vpprgr)
6.39 d*w_lage          s              2  0
6.36 d w_ffak          s              8  6
6.36 d w_inp2          s              9  2
6.36 d w_pdat          s                   like(jwodat)
6.36 d w_utgp          s              1  0
6.3b d w_mail          s                   like(aamail)
6.3b d w_weba          s                   like(aaweba)
8.01 d w_pgfr          s                   like(vpprgr)
6.3y d w_oppd          s              1
6.28 d w_calc          s             15  5
6.3k d ds2prg          s                   like(d3prgr)
6.3k d ds2lty          s                   like(d3lety)
6.3k d ds2enh          s                   like(vepenh)
6.3k d ds2sag          s                   like(d3sagm)
6.3k d ds2sap          s                   like(d3sapr)
6.3k d ds2sai          s                   like(d3saim)
6.3k d ds2end          s                   like(d3endr)
6.3k d ds3prg          s                   like(d3prgr)
6.3k d ds3lty          s                   like(d3lety)
6.3k d ds3enh          s                   like(vepenh)
6.3k d ds3sag          s                   like(d3sagm)
6.3k d ds3sap          s                   like(d3sapr)
6.3k d ds3sai          s                   like(d3saim)
6.3k d ds3end          s                   like(d3endr)
6.3k d di1prg          s                   like(d4prgr)
6.3k d di1lty          s                   like(d4lety)
6.3k d di1enh          s                   like(vepenh)
6.3k d di1ing          s                   like(d4ingm)
6.3k d di1inp          s                   like(d4inpr)
6.3k d di1kog          s                   like(d4kogm)
6.3k d di1kop          s                   like(d4kopr)
6.3k d di1end          s                   like(d4endr)
6.3k d di2prg          s                   like(d4prgr)
6.3k d di2lty          s                   like(d4lety)
6.3k d di2enh          s                   like(vepenh)
6.3k d di2ing          s                   like(d4ingm)
6.3k d di2inp          s                   like(d4inpr)
6.3k d di2kog          s                   like(d4kogm)
6.3k d di2kop          s                   like(d4kopr)
6.3k d di2end          s                   like(d4endr)
6.3k d di3prg          s                   like(d4prgr)
6.3k d di3lty          s                   like(d4lety)
6.3k d di3enh          s                   like(vepenh)
6.3k d di3ing          s                   like(d4ingm)
6.3k d di3inp          s                   like(d4inpr)
6.3k d di3kog          s                   like(d4kogm)
6.3k d di3kop          s                   like(d4kopr)
6.3k d di3end          s                   like(d4endr)
      *
     d w_udat          s               d   datfmt(*iso)
6.20 d w_utda          s               d   datfmt(*iso)
     d w_utim          s               t   timfmt(*iso)
6.3h d w_edat          s               d   datfmt(*iso)
     d w_dato          s               d   datfmt(*iso)
     d w_dato_wrk      s               d   datfmt(*iso)
      *
     d w_gprk          s              1  0
     d w_bldo          s                   like(jvldor)
     d w_bogr          s                   like(jvogrp)
     d w_bhgr          s                   like(jvhgrp)
     d w_bugr          s                   like(jvugrp)
     d w_bmod          s                   like(jvmodn)
     d w_bvar          s                   like(jvvare)
     d w_eldo          s                   like(jvldor)
     d w_ldor          s                   like(jvldor)
     d w_lvar          s                   like(jvlvar)
     d w_pogr          s                   like(jvogrp)
     d w_phgr          s                   like(jvhgrp)
     d w_pugr          s                   like(jvugrp)
     d w_pldo          s                   like(jvldor)
     d w_pmod          s                   like(jvmodn)
     d w_pvar          s                   like(jvvare)
     d w_lety          s                   like(vplety)
     d w_b1gm          s                   like(vpbupr)
     d w_b2gm          s                   like(vpbupr)
     d w_s2gm          s                   like(vpsapr)
     d w_k2gm          s                   like(vpkopr)
     d w_i2gm          s                   like(vpinpr)
6.36 d w_i2gm2         s                   like(vpinpr)
     d w_b3gm          s                   like(vpbupr)
     d w_s3gm          s                   like(vpsapr)
     d w_k3gm          s                   like(vpkopr)
     d w_i3gm          s                   like(vpinpr)
6.36 d w_i3gm2         s                   like(vpinpr)
      *
     d w_bugm          s                   like(vpbupr)
     d w_sagm          s                   like(vpsapr)
     d w_k1pr_i        s                   like(vpkopr)
     d w_i1pr_i        s                   like(vpinpr)
6.36 d w_i1pr_i2       s                   like(vpinpr)
     d w_k2pr_i        s                   like(vpkopr)
     d w_i2pr_i        s                   like(vpinpr)
6.36 d w_i2pr_i2       s                   like(vpinpr)
     d w_k3pr_i        s                   like(vpkopr)
     d w_i3pr_i        s                   like(vpinpr)
6.36 d w_i3pr_i2       s                   like(vpinpr)
     d w_k1gm_i        s                   like(vpkopr)
     d w_i1gm_i        s                   like(vpinpr)
6.36 d w_i1gm_i2       s                   like(vpinpr)
     d w_k2gm_i        s                   like(vpkopr)
     d w_i2gm_i        s                   like(vpinpr)
6.36 d w_i2gm_i2       s                   like(vpinpr)
     d w_k3gm_i        s                   like(vpkopr)
     d w_i3gm_i        s                   like(vpinpr)
6.36 d w_i3gm_i2       s                   like(vpinpr)
6.16 d w_gtin          s                   like(jwgtin)
6.34 d w_pkla          s                   like(jwpkla)
6.34 d w_best          s                   like(jwbest)
6.24 d wwppkl          s                   like(jwpkla)
6.18 d wwpvar          s                   like(vepvar)
6.18 d wwpenh          s                   like(vepenh)
6.18 d wwpldo          s                   like(vepldo)
6.18 d wwpgti          s                   like(vepgti)
6.24ad w_hlev          s              1  0
6.3c d w_prdt          s              6  0
6.3q d w_lv_vare       s                   like(jvvare)
6.3q d w_lv_modn       s                   like(jvmodn)
6.3q d w_lv_nobb       s                   like(jvnobb)
6.3q d w_lv_lldo       s                   like(jvlldo)
6.3q d w_lv_llva       s                   like(jvllva)
6.3q d w_lv_luda       s                   like(jvluda)
6.3q d w_lv_enum       s                   like(jlenum)
6.3t d w_lldo          s                   like(vvlldo)
6.18  *
6.37 d p_mail          s              1
6.37 d p_kund          s              6  0
6.37 d p_kpro          s              6  0
6.37 d p_numm          s              6  0
6.38 d p_suff          s              2  0
6.37 d p_selg          s              4  0
6.37 d p_serv          s             35
6.37 d p_stat          s              1
6.37 d p_kule          s              1
6.37 d p_navn          s             30
6.37 d p_emal          s             50
6.37 d p_ema2          s             50
6.38 d p_ema3          s             50
6.38 d p_kopi          s             50
6.37 d p_emne          s             50
6.37 d p_txt1          s             50
6.37 d p_txt2          s             50
6.37 d p_txt3          s             50
6.37 d p_txt4          s             50
6.37 d p_pers          s             50
6.37 d p_inif          s             40
6.37 d p_in03          s              1
6.37 d p_btyp          s            100
6.37 d p_ok            s              1
6.37 d p_lr            s              1
6.37 d p_str_in        s            512
6.37 d p_str_out       s            512
6.3a d p_filg          s             10
6.3a d p_xmlf          s            256
6.37 d w_tek1          s             75
6.37 d w_lnav          s             50
6.37 d w_mvak          s              3
6.37 d w_dspl          s            100
6.37 d w_jkey          s             41
6.37 d w_jstat         s              2  0
6.37 d w_jtext         s            200
6.37 d w_pdf           s              1  0
6.37 d w_pdf_ds        s            512
6.37 d w_rtyp          s             50
6.37 d w_dato2         s             12  0
6.37 d w_ddmy          s              6  0
6.37 d w_tids          s              6  0
6.37 d w_ruti          s             10
6.37 d w_txt1          s             75
6.37 d w_mime          s             24
6.37 d w_date          s               d   datfmt(*iso)
6.37 d w_1fnav         s             50
6.37 d w_1fad1         s             50
6.37 d w_1fad2         s             50
6.37 d w_prfi          s              1  0
6.37 d w_ffir          s              3  0
6.37 d w_fnav          s             30
6.37 d w_fad1          s             30
6.37 d w_fad2          s             30
6.37 d w_fste          s             30
6.37 d w_fftx          s             30
6.37 d w_tfax          s              8
6.37 d w_ftlf          s             11
6.37 d w_ffax          s             11
6.37 d w_pemne         s             75
6.37 d w_ptxt1         s             75
6.37 d w_ptxt2         s             75
6.37 d w_ptxt3         s             75
6.37 d w_ptxt4         s             75
6.37 d w_ppers         s             75
6.37 d w_avde          s              4  0
6.37 d w_mtxt          s            300
6.37 d h_valu          s             20
6.3r d d_valu          s            200
6.37 d d_type          s             10
      *
6.37 d b_excl          s              1    inz(*off)
      *
6.37 d splfname2       s             10a
6.37 d jobname2        s             10a
6.37 d username2       s             10a
6.37 d jobnbr2         s              6a
6.37 d splfnbr2        s             10i 0
6.37 d splfname3       s             10a
6.37 d jobname3        s             10a
6.37 d username3       s             10a
6.37 d jobnbr3         s              6a
6.37 d splfnbr3        s             10i 0
6.37 d p_tagg0         s             20
6.37 d p_tagg0val      s             50
6.37 d p_tagg1         s             20
6.37 d p_tagg1val      s             50
6.37 d p_tagg2         s             20
6.37 d p_tagg2val      s             50
6.37 d p_tagg3         s             20
6.37 d p_tagg3val      s             50
6.37 d p_tagg4         s             20
6.37 d p_tagg4val      s             50
6.37 d p_tagg5         s             20
6.37 d p_tagg5val      s             50
6.37 d p_tagg6         s             20
6.37 d p_tagg6val      s             50
6.37 d p_tagg7         s             20
6.37 d p_tagg7val      s             50
6.37 d p_tagg8         s             20
6.37 d p_tagg8val      s             50
6.37 d p_tagg9         s             20
6.37 d p_tagg9val      s             50
6.37 d p_refn          s             50
6.37 d p_dspl          s            100
6.37  *
6.37 d qsprilsp        pr                  extpgm('QSPRILSP')
6.37 d rcvvar                     32767a   options(*varsize)
6.37 d rcvvarlen                     10i 0 const
6.37 d format                         8a   const
6.37 d errorcode                  32767a   options(*varsize)
6.37  *
6.37 d sprl0100        ds
6.37 d  bytesrtn                     10i 0
6.37 d  bytesavl                     10i 0
6.37 d  splfname                     10a
6.37 d  jobname                      10a
6.37 d  username                     10a
6.37 d  jobnbr                        6a
6.37 d  splfnbr                      10i 0
6.37 d  systemname                    8a
6.37 d  createdate                    7a
6.37 d                                1a
6.37 d  createtime                    6a
6.37  *
6.37 d errorcode       ds
6.37 d  bytesprov                    10i 0 inz(0)
6.37 d  byteavail                    10i 0 inz(0)
      *
6.37  *
6.37 d XML_Output      s            256a   Varying
6.37 d XML_path        s            256a   Varying
6.37 d                                     Inz('/home/asp/print/adb')
6.37 d jasper_mal      s            256a
6.37 d jasper_logo     s            256a   varying
6.37 d tmpdate         s               D
6.37 d tmptime         s               T
6.37 d crlf            c                   const(X'0d25')
6.37  *
6.37 d d_pdf_ds        ds
6.37 d  d_xmlm                       75
6.37 d  d_jasm                       75
6.37 d  d_logo                       75
6.37 d  d_path                      100
6.37 d  d_emal                       50
6.37 d  d_fifo                       75
6.37 d  d_fkop                        1
6.3a d  d_dtaq                        1
6.3a d  d_sign                        1
6.37  /copy prototypeb
6.37  /copy usec
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.3q C/Exec SQL
6.3q C+  Set Option DatFmt=*ISO
6.3q C/End-Exec
      *
      * Utskrift av header
      *
     c                   exsr      hode
      *
      * Behandling av kontrolliste/journalliste, og utskrift av deltajlinjer
      *
     c                   exsr      behandling
6.37  * Generer xml for videre utskrift
6.37 c                   if        l_poff = '1' and
6.37 c                             b_excl = *off
6.37 c                   exsr      spoolnbr
6.3m c                   close     jv626p
6.3m c                   exsr      xml_create
6.37 c                   exsr      pdf_preview
6.37 c                   endif
6.37  * Excel rapport
6.37 c                   if        l_poff = '1' and
6.37 c                             b_excl = *on
6.37 c                   exsr      xml_end
6.37  * Hvis EXCEL må vi forhåndsvise linken, slik at vi får den opp i browser
6.37 c                   exsr      pdf_preview
6.37 c                   endif
6.37  * Avslutt jobbiden
6.37 c                   if        l_poff = '1'
6.37 c                   call      'AB710R'
6.37 c                   parm                    l_bach
6.37 c                   endif
      *
      * Avslutt
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering og utskrift av hode-opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hode          begsr
      *
      * Legger inn arb.stasjon og bruker i faste felter
      *
     c                   eval      a1firm = w_firm
     c                   eval      a1user = l_user
     c                   eval      a1wsid = l_wsid
     c     *dmy          move      w_udat        a1date
     c     *hms          move      w_utim        a1time
     c                   if        p_kntr = 1
     c                   eval      a1otxt = 'Kontrolliste'
     c                   else
     c                   eval      a1otxt = 'Journalliste'
     c                   endif
      *
      * Henter firmaopplysninger
      *
     c     afirl1_key    chain     afirl1r
     c                   eval      a1fnav = aafnav
      *
      * Henter parametre med beskrivelse og reskontronummer på prisgiver
      *
     c                   eval      a2ldor = p_ldor
     c                   eval      a2pgiv = p_pgiv
     c                   eval      a2ogrp = p_ogrp
     c                   eval      a2hgrp = p_hgrp
     c                   eval      a2ugrp = p_ugrp
     c                   eval      a2otyp = p_otyp
     c                   eval      a2sams = p_sams
     c                   eval      a2utgd = p_utgd
     c                   eval      a2inio = p_inio
     c                   eval      a2koio = p_koio
     c                   eval      a2s1io = p_saio
5.70 c                   eval      a2prgr = d_prgr
6.12 c                   eval      a2osor = d_osor
6.12 c                   eval      jsorl1_osor = d_osor
6.12 c     jsorl1_key    chain     jsorl1                             38
6.12 c                   if        %found(jsorl1)
6.12 c                   eval      a2stxt = jsotxt
6.12 c                   endif
      *
     c                   if        p_ldor <> 0
     c                   eval      jlevl1_ldor = p_ldor
     c     jlevl1_key    chain     jlevl1
     c                   if        %found
     c                   eval      a2lnav = jlnavn
     c                   eval      w_enum = jlenum
     c                   endif
     c                   endif
      *
     c                   if        p_pgiv <> 0
     c                   eval      jlevl1_ldor = p_pgiv
     c     jlevl1_key    chain     jlevl1
     c                   if        %found
     c                   eval      a2pnav = jlnavn
     c                   eval      w_enum = jlenum
     c                   endif
     c                   endif
      *
     c                   if        p_ugrp <> 0
     c                   eval      vugrl1_uogr = p_ogrp
     c                   eval      vugrl1_uhgr = p_hgrp
     c                   eval      vugrl1_uugr = p_ugrp
     c     vugrl1_key    chain     vugrl1
     c                   if        %found
     c                   eval      a2utxt = vgutxt
     c                   endif
     c                   endif
      *
     c                   if        p_hgrp <> 0 and
     c                             p_ugrp =  0
     c                   eval      vhgrl1_hogr = p_ogrp
     c                   eval      vhgrl1_hhgr = p_hgrp
     c     vhgrl1_key    chain     vhgrl1
     c                   if        %found
     c                   eval      a2utxt = vghtxt
     c                   endif
     c                   endif
      *
     c                   if        p_ogrp <> 0 and
     c                             p_hgrp =  0
     c                   eval      vogrl1_oogr = p_ogrp
     c     vogrl1_key    chain     vogrl1
     c                   if        %found
     c                   eval      a2utxt = vgotxt
     c                   endif
     c                   endif
      *
6.3h c                   if        p_pdat <> *loval
6.3h c     *dmy          move      p_pdat        a2dato
6.3h c                   endif
      *
      * Skriver heading
      *
6.37 c                   if        b_excl = *off
     c                   write     a1hdr
     c                   write     a2hdr
     c                   write     a3hdr
6.37 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for lesing og behandling varer for leverandør eller
      * prisgiver
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandling    begsr
      *
6.15 c                   if        p_vare <> *blank
6.15  * en vare
6.15  *
6.17 c                   eval      jvdtlu_dvar = p_vare
6.17 c     jvdtlu_key    chain     jvdtlu
6.15 c                   if        %found(jvdtlu)
6.15 c                   eval      jvdhko = 0
6.17 c                   update    jvdtlur
6.15 c                   endif
6.15 c                   eval      jvarl1_vare = p_vare
6.15 c     jvarl1_key    chain     jvarl1
6.15 c                   if        %found(jvarl1)
6.15 c                   exsr      behandl_vare
6.15 c                   endif
6.15  *
6.15 c                   else
     c                   if        p_ldor = 0
     c/exec sql
     c+ declare prisfil cursor for
     c+ select v.jvldor,
     c+        v.jvogrp,
     c+        v.jvhgrp,
     c+        v.jvugrp,
     c+        v.jvtek1,
     c+        v.jvvare,
6.3j c+        p.jvlvnr,
6.3j c+        p.jvlldo,
6.3t c+        p.jvllva,
6.3o c+        p.jvluda
6.3j c+ from   jvarpf as v inner join jvlepf as p on
6.3j c+        v.jvvare = p.jvlvnr
os71 c+        inner join jvdtpf as d on
os71 c+        v.jvvare = d.jvdvar
6.3j c+ where  p.jvlldo = :p_pgiv and
     c+        d.jvdhko = 0
     c+ order by v.jvldor, v.jvogrp, v.jvhgrp, v.jvugrp, v.jvtek1
     c+ for read only
     c/end-exec
     c/exec sql
     c+ open prisfil
     c/end-exec
     c                   endif
      *
     c                   if        p_ldor = 0
      *
     c                   dow       b_EOF = *off
      *
     c/exec sql
     c+ fetch prisfil
     c+ into  :jvldor,
     c+       :jvogrp,
     c+       :jvhgrp,
     c+       :jvugrp,
     c+       :jvtek1,
     c+       :jvvare,
6.3j c+       :jvlvnr,
6.3j c+       :jvlldo,
6.3t c+       :jvllva,
6.3o c+       :jvluda
     c/end-exec
      *
     c                   if        sqlcod = 100 or sqlstt = '02000'
     c                   leave
     c                   endif
      *
6.3j c                   eval      jvarl1_vare = jvlvnr
     c     jvarl1_key    chain     jvarl1
     c                   if        %found
     c                   exsr      behandl_vare
     c                   endif
      *
     c                   enddo
      *
     c                   else
      *
     c                   eval      jvarl5_ldor = p_ldor
     c     jvarl5_key    setll     jvarl5
     c     jvarl5_key    reade     jvarl5
     c                   dow       not %eof
      *
6.3j c                   eval      jvlelr_lvnr = jvvare
6.3j c                   eval      jvlelr_lldo = p_ldor
6.3j c     jvlelr_key    chain     jvlelr
6.3j c                   if        %found(jvlelr)
     c                   exsr      behandl_vare
6.3j c                   endif
      *
     c     jvarl5_key    reade     jvarl5
     c                   enddo
      *
     c                   endif
      *
6.15 c                   endif
      *
     c                   if        p_ldor = 0
     c/exec sql
     c+ close prisfil
     c/end-exec
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av varer som mather utplukkskriteriene
      * Behandler utskrift av detaljlinje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandl_vare  begsr
      *
      * Sjekker om varene skal være med på utplukket
      *
     c                   if        p_ogrp <> 0 and
     c                             p_ogrp <> jvogrp
     c                   leavesr
     c                   endif
      *
     c                   if        p_hgrp <> 0 and
     c                             p_hgrp <> jvhgrp
     c                   leavesr
     c                   endif
      *
     c                   if        p_ugrp <> 0 and
     c                             p_ugrp <> jvugrp
     c                   leavesr
     c                   endif
6.33  *
6.33  * hvis pris har utgått skal den ikke vises
6.33  *
6.33 c                   eval      jvprl1_vare = jvvare
6.3j c                   eval      jvprl1_ldor = jvlldo
6.35 c     jvprl1_key    setll     jvprl1
6.35 c     jvprl1_key    reade     jvprl1
6.35 c                   dow       not %eof(jvprl1)
6.3h c                   if        d_pdat >= jxgdat
6.35 c                   if        d_utgp =  0      and
6.35 c                             jxtdat <> *loval and
6.3l c                             jxtdat <= w_udat
6.33 c                   leavesr
6.33 c                   endif
6.33 c                   endif
6.35 c     jvprl1_key    reade     jvprl1
6.35 c                   enddo
      *
     c                   eval      vvarl1_vare = jvvare
     c     vvarl1_key    chain     vvarl1
     c                   if        not %found
     c                   leavesr
     c                   endif
      *
6.3f  * test mot vvarpf hvis samsvarende og ikke flere prisgr.
6.3f  *
     c                   if        p_sams = 1 and
6.3f c                             p_flpr = 0 and
     c                             vvldor <> w_enum
     c                   leavesr
     c                   endif
6.3c  * Ta vare på prisdato
6.3d c                   if        jxgdat <> *loval
6.3c c     *dmy          move      jxgdat        w_prdt
6.3d c                   else
6.3d c                   eval      w_prdt = 0
6.3d c                   endif
      *
6.20  *   Hent utg.dato fra subprogram
6.39 c*                  call      'VL720R'
6.39 c*                  parm                    w_firm
6.39 c*                  parm                    vvvare
6.39 c*                  parm                    w_lage
6.39 c*                  parm                    w_utda
6.39 c*                  parm                    b_inlr
      *
     c                   if        p_utgd = 1 and
6.39 c                             vvudat <> *loval and
6.39 c                             vvudat <= w_udat
6.39 c*                            w_utda <> *loval and
6.39 c*                            w_utda <= w_udat
     c                   leavesr
     c                   endif
      *
     c                   eval      jvdtl1_dvar = jvvare
     c     jvdtl1_key    chain     jvdtl1
     c                   if        not %found or
     c                             jvdhko = 1
     c                   leavesr
     c                   endif
      *
      * Kaller sub-program for å sjekke status og hente data
      *
     c                   eval      w_lety = 0
5.70 c                   eval      w_prgr = *blank
      *
     c                   exsr      hent_data
      *
      * Finner prisdato
      *
6.3h c                   eval      w_dato = *loval
      *
6.3h  *
6.3n c                   if        w_edat >= w_udat
6.3n c                   eval      w_dato = w_edat
6.3h c                   endif
6.3n c                   if        w_edat = *loval
6.3n c                   eval      w_dato = w_udat
     c                   endif
6.3h c                   if        w_pdat <> *loval and
6.3h c                             w_edat = w_udat and
6.3h c                             w_gdat > w_udat
6.3h c                   eval      w_dato = w_gdat
6.3h c                   endif
      *
      * Skriver detaljlinje på kvittering/journalliste.
      *
     c                   exsr      detalj
      *
      * Oppdaterer eget- og lokalt vareregister dersom journalliste
      *
     c                   if        p_kntr = 0
     c                   exsr      oppdater
     c                   endif
      *
      * Behandler priser/kalkyler på andre leveringstyper
      *
     c     vltpl1_key    setll     vltpl1
     c     vltpl1_key    reade     vltpl1
     c                   dow       not %eof
     c                   if        vylety <> 0
     c                   exsr      leveringstype
     c                   endif
     c     vltpl1_key    reade     vltpl1
     c                   enddo
5.70  *
5.70  * Behandler priser/kalkyler på andre prisgrupper
5.70  * med leveringstype = 0
5.70  *
5.70 c     ra30l1_key    setll     ra30l1
5.70 c     ra30l1_key    reade     ra30l1
5.70 c                   dow       not %eof
5.70 c                   eval      w_lety = 0
5.70 c                   eval      b_lety = *off
5.70 c                   if        redkod <> *blank
5.70 c                   exsr      prisgruppe
5.70 c                   endif
5.70 c     ra30l1_key    reade     ra30l1
5.70 c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å hente data/kalkyle og status på vare/leveringstype
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_data     begsr
      *
     c                   eval      w_gprk = 0
6.3y c                   eval      w_oppd = '1'
      *
     c                   call      'JV750R'
      *
     c                   parm                    w_firm
     c                   parm                    jvvare
5.70 c                   parm                    w_prgr
     c                   parm                    p_pgiv
     c                   parm                    jvdpko
     c                   parm                    jvdsko
     c                   parm                    w_lety
     c                   parm                    w_gprk
6.35 c                   parm                    w_pdat
6.35 c                   parm                    w_utgp
      *
     c                   parm                    w_osts
      *
     c                   parm                    w_ldor
     c                   parm                    w_lvar
     c                   parm                    w_eldo
     c                   parm                    w_grpr
     c                   parm                    w_gdat
      *
     c                   parm                    w_enh
     c                   parm                    w_enh1
     c                   parm                    w_enh2
     c                   parm                    w_enh3
     c                   parm                    w_eni1
     c                   parm                    w_eni2
     c                   parm                    w_eni3
     c                   parm                    w_enp1
     c                   parm                    w_enp2
     c                   parm                    w_enp3
     c                   parm                    w_ofp1
     c                   parm                    w_ofp2
     c                   parm                    w_ofp3
     c                   parm                    w_ofv2
     c                   parm                    w_ofv3
     c                   parm                    w_ofi1
     c                   parm                    w_ofi2
     c                   parm                    w_ofi3
      *
     c                   parm                    w_bldo
     c                   parm                    w_bogr
     c                   parm                    w_bhgr
     c                   parm                    w_bugr
     c                   parm                    w_bmod
     c                   parm                    w_bvar
     c                   parm                    w_bvty
     c                   parm                    w_blet
     c                   parm                    w_bbet
     c                   parm                    w_ntpr
     c                   parm                    w_ifak
      *
     c                   parm                    w_pogr
     c                   parm                    w_phgr
     c                   parm                    w_pugr
     c                   parm                    w_pldo
     c                   parm                    w_pmod
     c                   parm                    w_pvar
     c                   parm                    w_ppko
     c                   parm                    w_pvty
     c                   parm                    w_plet
     c                   parm                    w_kfak
     c                   parm                    w_kbel
     c                   parm                    w_sfak
      *
     c                   parm                    w_midl
     c                   parm                    w_inpr
     c                   parm                    w_kopr
     c                   parm                    w_s1pr
     c                   parm                    w_s1im
     c                   parm                    w_s2pr
     c                   parm                    w_s2im
     c                   parm                    w_s3pr
     c                   parm                    w_s3im
     c                   parm                    w_dekn
     c                   parm                    w_prut
6.36 c                   parm                    w_ffak
6.36 c                   parm                    w_inp2
6.3x c                   parm                    w_pgbe
6.3y c                   parm                    w_pgfr
6.3y c                   parm                    w_oppd
      *
6.36 c                   eval(h)   w_inp2 = w_inpr * w_ffak
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift av detaljlinje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     detalj        begsr
6.37  * Nullstiller alle "gamle" verdier, så de ikke skal ligge igjen i regneark
6.37 c                   if        b_excl = *on
6.37 c                   exsr      exc_clear
6.37 c                   endif
6.37  *
      *
      * Initierer variable for salgsenhet-2, salgsenhet-3 og for alle
      * spesifikke innkjøpsenheter
      *
     c                   eval      w_s2gm = 0
     c                   eval      w_k2gm = 0
     c                   eval      w_i2gm = 0
     c                   eval      w_s3gm = 0
     c                   eval      w_k3gm = 0
     c                   eval      w_i3gm = 0
     c                   eval      w_s2gm = 0
      *
      * Flytter felter til kvitteringsvariable
      *
     c                   eval      d1osts = w_osts
     c                   eval      d1tek1 = jvtek1
     c                   eval      d1vare = jvvare
     c                   eval      d1nobb = jvnobb
     c                   eval      d1lvar = w_lvar
     c                   eval      d1lety = w_lety
     c                   eval      d1enh1 = w_enh1
     c                   eval      d1inpr = w_inpr
     c                   eval      d1kopr = w_kopr
     c                   eval      d1s1pr = w_s1pr
     c                   eval      d1s1im = w_s1im
     c                   eval      d1dekn = w_dekn
     c                   eval      d1pkod = jvdpko
     c                   eval      d1vtyp = *blank
6.12 c                   eval      d1sort = jvsort
      *
     c                   if        jvete1 <> *blank
     c                   eval      d1tek1 = jvete1
     c                   endif
      *
     c                   if        jvdsko = 1
     c                   eval      d1vtyp = 'S'
     c                   endif
      *
      * Henter eksisterende priser fra EVR
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_enh1
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    d1s1gm
     c                   parm                    w_b1gm
     c                   parm                    d1kogm
     c                   parm                    d1ingm
6.36 c                   parm                    w_inpr2
6.24ac                   parm                    w_hlev
      *
      * Beregner prosentvis endring av salgspris
      *
     c                   eval      d1endr = 0
      *
     c                   if        d1s1gm <> 0
6.28 c                   eval(h)   w_calc = (100 * d1s1pr / d1s1gm) - 100
6.28 c**                 if        (100 * d1s1pr / d1s1gm) - 100 > 9999,99
6.28 c                   if        w_calc > 9999,99
     c                   eval      d1endr = 9999,99
     c                   else
     c                   eval(h)   d1endr = (100 * d1s1pr / d1s1gm) - 100
     c                   endif
     c                   endif
      *
      * Henter navn på prisgivende leverandør
      *
     c                   eval      d1lnav = *blank
     c                   eval      jlevl1_ldor = w_ldor
     c     jlevl1_key    chain     jlevl1
     c                   if        %found
     c                   eval      d1lnav = jlnavn
     c                   endif
      *
      * Skriv detaljlinje
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
     c                   write     d1dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
      * Salgsenhet-2
      *
     c                   if        w_enh2 <> *blank
      *
     c                   eval      d3lety = w_lety
     c                   eval      d3enhe = w_enh2
     c                   eval      d3sapr = w_s2pr
     c                   eval      d3saim = w_s2im
     c                   eval      d3endr = 0
      *
6.3k c                   eval      ds2lty = w_lety
6.3k c                   eval      ds2enh = w_enh2
6.3k c                   eval      ds2sap = w_s2pr
6.3k c                   eval      ds2sai = w_s2im
6.3k c                   eval      ds2end = 0
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_enh2
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    w_s2gm
     c                   parm                    w_b2gm
     c                   parm                    w_k2gm
     c                   parm                    w_i2gm
6.36 c                   parm                    w_i2gm2
6.24ac                   parm                    w_hlev
      *
     c                   if        w_s2gm <> 0
     c                   if        (100 * d3sapr / w_s2gm) - 100 > 9999,99
     c                   eval      d3endr = 9999,99
     c                   else
     c                   eval(h)   d3endr = (100 * d3sapr / w_s2gm) - 100
     c                   endif
     c                   endif
6.3k c                   eval      ds2end = d3endr
      *
     c                   eval      d3sagm = w_s2gm
6.3k c                   eval      ds2sag = w_s2gm
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
     c                   write     d3dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
     c                   endif
      *
      * Salgsenhet-3
      *
     c                   if        w_enh3 <> *blank
      *
     c                   eval      d3lety = w_lety
     c                   eval      d3enhe = w_enh3
     c                   eval      d3sapr = w_s3pr
     c                   eval      d3saim = w_s3im
     c                   eval      d3endr = 0
      *
6.3k c                   eval      ds3lty = w_lety
6.3k c                   eval      ds3enh = w_enh3
6.3k c                   eval      ds3sap = w_s3pr
6.3k c                   eval      ds3sai = w_s3im
6.3k c                   eval      ds3end = 0
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_enh3
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    w_s3gm
     c                   parm                    w_b3gm
     c                   parm                    w_k3gm
     c                   parm                    w_i3gm
6.36 c                   parm                    w_i3gm2
6.24ac                   parm                    w_hlev
      *
     c                   if        w_s3gm <> 0
     c                   if        (100 * d3sapr / w_s3gm) - 100 > 9999,99
     c                   eval      d3endr = 9999,99
     c                   else
     c                   eval(h)   d3endr = (100 * d3sapr / w_s3gm) - 100
     c                   endif
     c                   endif
6.3k c                   eval      ds3end = d3endr
      *
     c                   eval      d3sagm = w_s3gm
6.3k c                   eval      ds3sag = w_s3gm
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
     c                   write     d3dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
     c                   endif
      *
      * Innkjøpsenhet-1
      *
     c                   if        w_eni1 <> *blank and
     c                             w_eni1 <> w_enh1 and
     c                             w_eni1 <> w_enh2 and
     c                             w_eni1 <> w_enh3
      *
     c                   eval(h)   w_k1pr_i = w_kopr * w_ofi1
     c                   eval(h)   w_i1pr_i = w_inpr * w_ofi1
6.36 c                   eval(h)   w_i1pr_i2 = w_inp2 * w_ofi1
      *
     c                   eval      d4lety = w_lety
     c                   eval      d4enhe = w_eni1
     c                   eval      d4inpr = w_i1pr_i
     c                   eval      d4kopr = w_k1pr_i
     c                   eval      d4endr = 0
6.3k  *
6.3k c                   eval      di1lty = w_lety
6.3k c                   eval      di1enh = w_eni1
6.3k c                   eval      di1inp = w_i1pr_i
6.3k c                   eval      di1kop = w_k1pr_i
6.3k c                   eval      di1end = 0
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_eni1
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    w_sagm
     c                   parm                    w_bugm
     c                   parm                    w_k1gm_i
     c                   parm                    w_i1gm_i
6.36 c                   parm                    w_i1gm_i2
6.24ac                   parm                    w_hlev
      *
     c                   if        w_k1gm_i <> 0
     c                   if        (100 * d4kopr / w_k1gm_i) - 100 > 9999,99
     c                   eval      d4endr = 9999,99
     c                   else
     c                   eval(h)   d4endr = (100 * d4kopr / w_k1gm_i) - 100
     c                   endif
     c                   endif
6.3k c                   eval      di1end = d4endr
      *
     c                   eval      d4ingm = w_i1gm_i
6.3k c                   eval      di1ing = w_i1gm_i
     c                   eval      d4kogm = w_k1gm_i
6.3k c                   eval      di1kog = w_k1gm_i
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
     c                   endif
      *
      * Innkjøpsenhet-2
      *
     c                   if        w_eni2 <> *blank and
     c                             w_eni2 <> w_enh1 and
     c                             w_eni2 <> w_enh2 and
     c                             w_eni2 <> w_enh3
      *
     c                   eval(h)   w_k2pr_i = w_kopr * w_ofi2
     c                   eval(h)   w_i2pr_i = w_inpr * w_ofi2
6.36 c                   eval(h)   w_i2pr_i2 = w_inp2 * w_ofi2
      *
     c                   eval      d4lety = w_lety
     c                   eval      d4enhe = w_eni2
     c                   eval      d4inpr = w_i2pr_i
     c                   eval      d4kopr = w_k2pr_i
     c                   eval      d4endr = 0
6.3k  *
6.3k c                   eval      di2lty = w_lety
6.3k c                   eval      di2enh = w_eni2
6.3k c                   eval      di2inp = w_i2pr_i
6.3k c                   eval      di2kop = w_k2pr_i
6.3k c                   eval      di2end = 0
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_eni2
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    w_sagm
     c                   parm                    w_bugm
     c                   parm                    w_k2gm_i
     c                   parm                    w_i2gm_i
6.36 c                   parm                    w_i2gm_i2
6.24ac                   parm                    w_hlev
      *
     c                   if        w_k2gm_i <> 0
     c                   if        (100 * d4kopr / w_k2gm_i) - 100 > 9999,99
     c                   eval      d4endr = 9999,99
     c                   else
     c                   eval(h)   d4endr = (100 * d4kopr / w_k2gm_i) - 100
     c                   endif
     c                   endif
6.3k c                   eval      di2end = d4endr
      *
     c                   eval      d4ingm = w_i2gm_i
6.3k c                   eval      di2ing = w_i2gm_i
     c                   eval      d4kogm = w_k2gm_i
6.3k c                   eval      di2kog = w_k2gm_i
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3p c                   if        b_excl = *off
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
     c                   endif
      *
      * Innkjøpsenhet-3
      *
     c                   if        w_eni3 <> *blank and
     c                             w_eni3 <> w_enh1 and
     c                             w_eni3 <> w_enh2 and
     c                             w_eni3 <> w_enh3
      *
     c                   eval(h)   w_k3pr_i = w_kopr * w_ofi3
     c                   eval(h)   w_i3pr_i = w_inpr * w_ofi3
6.36 c                   eval(h)   w_i3pr_i2 = w_inp2 * w_ofi3
      *
     c                   eval      d4lety = w_lety
     c                   eval      d4enhe = w_eni3
     c                   eval      d4inpr = w_i3pr_i
     c                   eval      d4kopr = w_k3pr_i
     c                   eval      d4endr = 0
6.3k  *
6.3k c                   eval      di3lty = w_lety
6.3k c                   eval      di3enh = w_eni3
6.3k c                   eval      di3inp = w_i3pr_i
6.3k c                   eval      di3kop = w_k3pr_i
6.3k c                   eval      di3end = 0
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_eni3
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    w_sagm
     c                   parm                    w_bugm
     c                   parm                    w_k3gm_i
     c                   parm                    w_i3gm_i
6.36 c                   parm                    w_i3gm_i2
6.24ac                   parm                    w_hlev
      *
     c                   if        w_k3gm_i <> 0
     c                   if        (100 * d4kopr / w_k3gm_i) - 100 > 9999,99
     c                   eval      d4endr = 9999,99
     c                   else
     c                   eval(h)   d4endr = (100 * d4kopr / w_k3gm_i) - 100
     c                   endif
     c                   endif
6.3k c                   eval      di3end = d4endr
      *
     c                   eval      d4ingm = w_i3gm_i
6.3k c                   eval      di3ing = w_i3gm_i
     c                   eval      d4kogm = w_k3gm_i
6.3k c                   eval      di3kog = w_k3gm_i
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
     c                   endif
6.3k  *
6.3k c                   if        b_excl = *on
6.3k c                   exsr      xml_detal
6.3k c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppdatering av EVR og VA dersom journalliste
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppdater      begsr
      *
6.3w c                   eval      b_dann = *on
6.15 c                   if        w_osts <> *blank and
     c
6.15 c                             w_osts <> 'G'    and
6.15 c                             w_osts <> 'O'    and
6.15 c                             p_vare =  *blank
6.3w c                   eval      b_dann = *off
     c                   leavesr
     c                   endif
6.3q  *
6.3q  * sjekk om det er logistikkvare
6.3v c                   eval      b_logv = *off
6.3v c                   eval      w_lv_vare  = *blank
6.3v c                   eval      w_lv_modn  = 0
6.3v c                   eval      w_lv_nobb  = 0
6.3v c                   eval      w_lv_lldo  = 0
6.3v c                   eval      w_lv_llva  = *blank
6.3v c                   eval      w_lv_luda  = *loval
6.3v c                   eval      w_lv_enum  = 0
6.3q c                   eval      jvkhl1_kvnr = jvvare
6.3q c     jvkhl1_key    chain     jvkhl1
6.3q c                   if        %found(jvkhl1)
6.3q c                   exsr      finn_logivar
6.3q c                   endif
      *
      * Oppdaterer EVR vare
      *
     c                   clear                   vvarlur
      *
     c                   eval      vvarlu_vare = jvvare
     c     vvarlu_key    chain     vvarlur
      *
6.21  * hvis flere prisgivere er valgt skal ikke vvldor oppdateres
6.21  *
6.21 c                   if        p_flpr = 0
6.23 c                   if        w_eldo <> vvldor
6.23 c                   exsr      rydd_pris
5.23 c                   endif
6.25  * oppdat. av vvldor flyttet til etter pris er dannet
6.25 c*                  eval      vvldor = w_eldo
6.21 c                   endif
6.3q c                   if        b_logv = *on
6.3q c                   eval      vvlvar = *blank
6.3q c                   else
     c                   eval      vvlvar = w_lvar
6.3q c                   endif
6.3o c*                  eval      vvnlev = w_ldor
     c                   eval      vvkpri = jvdpko
     c                   eval      vvenhe = w_enh1
     c                   eval      vveusr = l_user
      *
     c                   time                    vvedat
     c                   time                    vvetim
      *
     c                   update    vvarlur
      *
6.3q  * Oppretter Vare-leverandør EVR
6.3q  *
6.3q c                   exsr      oppr_vare_lev
      *
6.3y  * rydder kun hvis prisgiver er hovedleverandør
6.3y c                   if        vvldor = w_eldo
      *
      * Sletter "utgåtte" enheter og tilhørende priser
      *
     c                   eval      vvenl1_vare = jvvare
     c     vvenl1_key    setll     vvenl1
     c     vvenl1_key    reade     vvenl1
     c                   dow       not %eof
6.1e  * Rydder i alle vare-enhet-prisg. hver gang - legger evt. spes.
6.3g  * gtin - nr i veanpf
6.1e  * kun pr. prisgiver som overføres
6.1e c                   eval      vveplu_pvar = vevare
6.1e c                   eval      vveplu_penh = veenhe
6.1e c     vveplu_key2   setll     vveplu
6.1e c     vveplu_key2   reade     vveplur
6.1e c                   dow       not %eof
6.3g c                   if        vepldo = w_eldo
6.1e c                   delete    vveplur
6.1e c                   exsr      upd_eann
6.3g c                   endif
6.1e c     vveplu_key2   reade     vveplur
6.1e c                   enddo
      *
     c                   if        veenhe <> w_enh1 and
     c                             veenhe <> w_enh2 and
     c                             veenhe <> w_enh3 and
     c                             veenhe <> w_eni1 and
     c                             veenhe <> w_eni2 and
     c                             veenhe <> w_eni3
      *
     c                   eval      vvenlu_vare = vevare
     c                   eval      vvenlu_enhe = veenhe
     c     vvenlu_key    chain     vvenlur
     c                   delete    vvenlur
      *
6.3g c*                  eval      vveplu_pvar = vevare
6.3g c*                  eval      vveplu_penh = veenhe
6.3g c*    vveplu_key2   setll     vveplu
6.3g c*    vveplu_key2   reade     vveplur
6.3g c*                  dow       not %eof
6.3g c*                  if        vepldo = w_eldo
6.3g c*                  delete    vveplur
6.3g c*                  endif
6.3g c*    vveplu_key2   reade     vveplur
6.3g c*                  enddo
      *
6.21  *  fjerner bestemt enhet for alle prisgrupper og prisg.leverendører
     c                   eval      vvprlu_vare = vevare
     c     vvprlu_key3   setll     vvprlu
     c     vvprlu_key3   reade     vvprlur
     c                   dow       not %eof
6.21 c                   if        vpenhe = veenhe
     c                   delete    vvprlur
6.21 c                   endif
     c     vvprlu_key3   reade     vvprlur
     c                   enddo
      *
     c                   endif
     c     vvenl1_key    reade     vvenl1
     c                   enddo
      *
      * Oppdaterer EVR enheter
      *
     c                   exsr      oppd_enhet
      *
6.3y c                   endif
7.01  * hvis ikke hovedprisgiver, så oppdater vveppf likevel
7.01 c                   if        vvldor <> w_eldo
7.01 c                   exsr      upd_vvep
7.01 c                   endif
      *
      * Oppdaterer EVR priser
      *
     c                   exsr      oppd_pris
6.25 c                   exsr      upd_vvldor
      *
      * Dersom pris og vareinformasjonsoppdatering, kalles fellesprogram
      * for oppdatering av vareinformasjon i EVR
      *
     c                   if        p_otyp = 1
     c                   call      'JV755R'
     c                   parm                    w_firm
     c                   parm                    jvvare
     c                   endif
      *
      * Fjerner rad fra midlertidig prisendrings-register
      *
     c                   eval      jwprlu_vare = jvvare
     c     jwprlu_key    chain     jwprlur
     c                   if        %found
     c                   delete    jwprlur
     c                   endif
      *
      * Legger varen i Hold
      *
     c                   clear                   jvdtlur
      *
     c                   eval      jvdtlu_dvar = jvvare
     c     jvdtlu_key    chain     jvdtlur
     c                   eval      jvdhko = 1
     c                   if        %found
     c                   update    jvdtlur
     c                   else
     c                   eval      jvdfir = w_firm
     c                   eval      jvdvar = jvvare
     c                   write     jvdtlur
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av overflow
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     overflow      begsr
      *
     c                   if        *in30 = *on
     c                   write     a1hdr
     c                   write     a3hdr
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppretting/oppdatering av enheter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppd_enhet    begsr
      *
     c                   clear                   vvenlur
      *
      * Salgenhet-1
      *
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_enh1
     c     vvenlu_key    chain     vvenlur
      *
6.24  * nullstiller rekkefølge før ny blir satt
6.24 c                   eval      vesaen = 0
6.24 c                   eval      veinen = 0
6.24 c                   eval      vepben = 0
      *
     c                   eval      vesaen = 1
     c                   eval      veinen = 0
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
     c                   eval      veeusr = l_user
      *
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   select
     c                   when      veenhe = w_eni1
     c                   eval      veinen = 1
     c                   when      veenhe = w_eni2
     c                   eval      veinen = 2
     c                   when      veenhe = w_eni3
     c                   eval      veinen = 3
     c                   endsl
      *
     c                   select
     c                   when      veenhe = w_enp1
     c                   eval      vepben = 1
     c                   when      veenhe = w_enp2
     c                   eval      vepben = 2
     c                   when      veenhe = w_enp3
     c                   eval      vepben = 3
     c                   endsl
      *
     c                   eval      jvpkl2_vare = jvvare
6.30 c                   eval      jvpkl2_ldor = p_pgiv
     c                   eval      jvpkl2_enhe = w_enh1
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
6.32  *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
6.32 c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      vefirm = w_firm
     c                   eval      vevare = jvvare
     c                   eval      veenhe = w_enh1
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
6.14  *
6.14  * oppretter vare-pakning-prisgiver
6.14 c                   exsr      oppr_vep
      *
      * Salgsenhet-2
      *
     c                   if        w_enh2 <> *blank
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
      *
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_enh2
     c     vvenlu_key    chain     vvenlur
6.24  *
6.24  * nullstiller rekkefølge før ny blir satt
6.24 c                   eval      vesaen = 0
6.24 c                   eval      veinen = 0
6.24 c                   eval      vepben = 0
      *
     c                   eval      vesaen = 2
     c                   eval      veinen = 0
     c                   eval      vepben = 0
     c                   eval      veomre = w_ofv2
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
     c                   eval      veeusr = l_user
      *
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   select
     c                   when      veenhe = w_eni1
     c                   eval      veinen = 1
     c                   when      veenhe = w_eni2
     c                   eval      veinen = 2
     c                   when      veenhe = w_eni3
     c                   eval      veinen = 3
     c                   endsl
      *
     c                   select
     c                   when      veenhe = w_enp1
     c                   eval      vepben = 1
     c                   when      veenhe = w_enp2
     c                   eval      vepben = 2
     c                   when      veenhe = w_enp3
     c                   eval      vepben = 3
     c                   endsl
      *
     c                   eval      jvpkl2_vare = jvvare
     c                   eval      jvpkl2_enhe = w_enh2
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
6.32  *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      vefirm = w_firm
     c                   eval      vevare = jvvare
     c                   eval      veenhe = w_enh2
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
6.14  *
6.14  * oppretter vare-pakning-prisgiver
6.14 c                   exsr      oppr_vep
      *
     c                   endif
      *
      * Salgsenhet-3
      *
     c                   if        w_enh3 <> *blank
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_enh3
     c     vvenlu_key    chain     vvenlur
6.24  *
6.24  * nullstiller rekkefølge før ny blir satt
6.24 c                   eval      vesaen = 0
6.24 c                   eval      veinen = 0
6.24 c                   eval      vepben = 0
      *
     c                   eval      vesaen = 3
     c                   eval      veinen = 0
     c                   eval      vepben = 0
     c                   eval      veomre = w_ofv3
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
     c                   eval      veeusr = l_user
      *
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   select
     c                   when      veenhe = w_eni1
     c                   eval      veinen = 1
     c                   when      veenhe = w_eni2
     c                   eval      veinen = 2
     c                   when      veenhe = w_eni3
     c                   eval      veinen = 3
     c                   endsl
      *
     c                   select
     c                   when      veenhe = w_enp1
     c                   eval      vepben = 1
     c                   when      veenhe = w_enp2
     c                   eval      vepben = 2
     c                   when      veenhe = w_enp3
     c                   eval      vepben = 3
     c                   endsl
      *
     c                   eval      jvpkl2_vare = jvvare
     c                   eval      jvpkl2_enhe = w_enh3
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
6.32  *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      vefirm = w_firm
     c                   eval      vevare = jvvare
     c                   eval      veenhe = w_enh3
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
6.14  *
6.14  * oppretter vare-pakning-prisgiver
6.14 c                   exsr      oppr_vep
      *
     c                   endif
      *
      * Innkjøpsenhet-1
      *
     c                   if        w_eni1 <> *blank and
     c                             w_eni1 <> w_enh1 and
     c                             w_eni1 <> w_enh2 and
     c                             w_eni1 <> w_enh3
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_eni1
     c     vvenlu_key    chain     vvenlur
6.24  *
6.24  * nullstiller rekkefølge før ny blir satt
6.24 c                   eval      vesaen = 0
6.24 c                   eval      veinen = 0
6.24 c                   eval      vepben = 0
      *
     c                   eval      vesaen = 0
     c                   eval      veinen = 1
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
     c                   eval      veeusr = l_user
      *
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   eval      jvpkl2_vare = jvvare
     c                   eval      jvpkl2_enhe = w_eni1
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
6.32  *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      veomre = w_ofi1
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      vefirm = w_firm
     c                   eval      vevare = jvvare
     c                   eval      veenhe = w_eni1
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
6.14  *
6.14  * oppretter vare-pakning-prisgiver
6.14 c                   exsr      oppr_vep
      *
     c                   endif
      *
      * Innkjøpsenhet-2
      *
     c                   if        w_eni2 <> *blank and
     c                             w_eni2 <> w_enh1 and
     c                             w_eni2 <> w_enh2 and
     c                             w_eni2 <> w_enh3
      *
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_eni2
     c     vvenlu_key    chain     vvenlur
6.24  *
6.24  * nullstiller rekkefølge før ny blir satt
6.24 c                   eval      vesaen = 0
6.24 c                   eval      veinen = 0
6.24 c                   eval      vepben = 0
      *
     c                   eval      vesaen = 0
     c                   eval      veinen = 2
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
     c                   eval      veeusr = l_user
      *
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   eval      jvpkl2_vare = jvvare
     c                   eval      jvpkl2_enhe = w_eni2
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
6.32  *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      veomre = w_ofi2
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      vefirm = w_firm
     c                   eval      vevare = jvvare
     c                   eval      veenhe = w_eni2
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
6.14  *
6.14  * oppretter vare-pakning-prisgiver
6.14 c                   exsr      oppr_vep
      *
     c                   endif
      *
      * Innkjøpsenhet-3
      *
     c                   if        w_eni3 <> *blank and
     c                             w_eni3 <> w_enh1 and
     c                             w_eni3 <> w_enh2 and
     c                             w_eni3 <> w_enh3
      *
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_eni3
     c     vvenlu_key    chain     vvenlur
6.24  *
6.24  * nullstiller rekkefølge før ny blir satt
6.24 c                   eval      vesaen = 0
6.24 c                   eval      veinen = 0
6.24 c                   eval      vepben = 0
      *
     c                   eval      vesaen = 0
     c                   eval      veinen = 3
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
     c                   eval      veeusr = l_user
      *
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   eval      jvpkl2_vare = jvvare
     c                   eval      jvpkl2_enhe = w_eni3
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
6.32  *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      veomre = w_ofi3
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      vefirm = w_firm
     c                   eval      vevare = jvvare
     c                   eval      veenhe = w_eni3
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
6.14  *
6.14  * oppretter vare-pakning-prisgiver
6.14 c                   exsr      oppr_vep
      *
     c                   endif
      *
     c                   endsr
      *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.01  * Subrutine for å opprette vare-enh-pris for prisgiver
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.01  *
7.01 c     upd_vvep      begsr
7.01 c                   eval      vvenl1_vare = jvvare
7.01 c     vvenl1_key    setll     vvenl1
7.01 c     vvenl1_key    reade     vvenl1
7.01 c                   dow       not %eof(vvenl1)
7.01 c                   eval      jvpkl2_vare = vevare
7.01 c                   eval      jvpkl2_ldor = p_pgiv
7.01 c                   eval      jvpkl2_enhe = veenhe
7.01 c     jvpkl2_key    setll     jvpkl2
7.01 c     jvpkl2_key    reade     jvpkl2
7.01 c                   dow       not %eof
7.01  *
7.01  * sjekker fra / tildato
7.01 c                   exsr      sjekk_pkdato
7.01 c                   if        b_pakn = *on  and
7.01 c                             jwpakn <> '000'
7.01 c                   clear                   vveplur
7.01 c                   eval      vveplu_pvar = vevare
7.01 c                   eval      vveplu_penh = veenhe
7.01 c                   eval      vveplu_pldo = w_eldo
7.01 c     vveplu_key    chain     vveplu
7.01 c                   eval      vepkla = jwpkla
7.01 c                   eval      vepbes = jwbest
7.01 c                   eval      vepgti = jwgtin
7.01 c                   if        %found(vveplu)
7.01 c                   eval      vepeus = l_user
7.01 c                   time                    vepeti
7.01 c                   time                    vepeda
7.01 c                   update    vveplur
7.01 c                   else
7.01 c                   eval      vepfir = w_firm
7.01 c                   eval      vepvar = vveplu_pvar
7.01 c                   eval      vepenh = vveplu_penh
7.01 c                   eval      vepldo = vveplu_pldo
7.01 c                   eval      vepeus = l_user
7.01 c                   time                    vepeti
7.01 c                   time                    vepeda
7.01 c                   eval      vepous = l_user
7.01 c                   time                    vepoti
7.01 c                   time                    vepoda
7.01 c                   write     vveplur
7.01 c                   endif
7.01 c                   endif
7.01 c                   leave
7.01 c                   enddo
7.01 c     vvenl1_key    reade     vvenl1
7.01 c                   enddo
7.01  *
7.01 c                   endsr
7.01
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppretting/oppdatering av pris
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppd_pris     begsr
      *
     c                   clear                   vvprlur
      *
      * Salgsenhet-1
      *
6.3i c                   if        w_hlev =  1 or
6.3i c                             (p_saio =  0 and
     c                             w_s1pr <> d1s1gm or
     c                             p_koio =  0 and
     c                             w_kopr <> d1kogm or
     c                             p_inio =  0 and
6.3i c                             w_inpr <> d1ingm)
      *
     c     w_dato        adddur    1:*d          w_dato_wrk
      *
6.3y c                   eval      w_enhx = w_enh1
6.3y c                   exsr      sjk_enh_pgiv
6.3y c                   if        b_enhe = *on
      *
     c                   eval      vvprlu_vare = jvvare
6.23 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_enh1
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato_wrk
     c     vvprlu_key    setll     vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   dow       not %eof
     c                   delete    vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   enddo
      *
     c                   eval      vvprlu_vare = jvvare
6.21 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_enh1
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato
     c     vvprlu_key    chain     vvprlur
      *
     c                   eval      vpsapr = d1s1gm
     c                   eval      vpbupr = w_b1gm
     c                   eval      vpkopr = d1kogm
     c                   eval      vpinpr = d1ingm
6.36 c                   eval      vpinp2 = w_inp2
6.14 c                   eval      vpnopr = w_grpr
6.21 c                   eval      vpnlev = w_ldor
      *
     c                   if        p_saio = 0
     c                   eval      vpsapr = w_s1pr
     c                   endif
      *
     c                   if        p_saio = 0 and
     c                             w_b1gm <> 0 and
     c                             w_s1pr <> 0 and
     c                             d1s1gm <> 0
     c                   eval(h)   vpbupr = vpbupr * w_s1pr / d1s1gm
     c                   endif
      *
     c                   if        p_koio = 0
     c                   eval      vpkopr = w_kopr
     c                   endif
      *
     c                   if        p_inio = 0
     c                   eval      vpinpr = w_inpr
6.36 c                   eval      vpinp2 = w_inp2
     c                   endif
      *
     c                   eval      vppdat = w_dato
     c                   eval      vpeusr = l_user
     c                   time                    vpedat
     c                   time                    vpetim
      *
     c                   if        %found(vvprlu)
     c                   update    vvprlur
     c                   else
     c                   eval      vpfirm = w_firm
     c                   eval      vpvare = jvvare
6.20 c                   eval      vpldor = w_eldo
5.70 c                   eval      vpprgr = w_prgr
     c                   eval      vpenhe = w_enh1
     c                   eval      vplety = w_lety
6.3x c                   eval      vpousr = l_user
6.3x c                   time                    vpodat
6.3x c                   time                    vpotim
     c                   write     vvprlur
     c                   endif
6.3x c                   eval      w_pgenh = w_enh1
6.3x c                   exsr      sjekk_prg2
      *
6.3y c                   endif
     c                   endif
      *
      * Salgsenhet-2
      *
     c                   eval(h)   w_k2pr = w_kopr * w_ofv2
     c                   eval(h)   w_i2pr = w_inpr * w_ofv2
6.36 c                   eval(h)   w_i2pr2 = w_inp2 * w_ofv2
      *
     c                   if        w_s2pr <> 0
6.3i c                   if        w_hlev =  1 or
6.3i c                             (p_saio =  0 and
     c                             w_s2pr <> w_s2gm or
     c                             p_koio =  0 and
     c                             w_k2pr <> w_k2gm or
     c                             p_inio =  0 and
6.3i c                             w_i2pr <> w_i2gm)
      *
     c     w_dato        adddur    1:*d          w_dato_wrk
      *
6.3y c                   eval      w_enhx = w_enh2
6.3y c                   exsr      sjk_enh_pgiv
6.3y c                   if        b_enhe = *on
      *
     c                   eval      vvprlu_vare = jvvare
6.21 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_enh2
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato_wrk
     c     vvprlu_key    setll     vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   dow       not %eof
     c                   delete    vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   enddo
      *
     c                   eval      vvprlu_vare = jvvare
6.21 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_enh2
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato
     c     vvprlu_key    chain     vvprlur
      *
     c                   eval      vpsapr = w_s2gm
     c                   eval      vpbupr = w_b2gm
     c                   eval      vpkopr = w_k2gm
     c                   eval      vpinpr = w_i2gm
6.36 c                   eval      vpinp2 = w_i2gm2
6.3z c                   eval(h)   vpnopr = w_grpr * w_ofv2
      *
     c                   if        p_saio = 0
     c                   eval      vpsapr = w_s2pr
     c                   endif
      *
     c                   if        p_saio = 0 and
     c                             w_b2gm <> 0 and
     c                             w_s2pr <> 0 and
     c                             w_s2gm <> 0
     c                   eval(h)   vpbupr = vpbupr * w_s2pr / w_s2gm
     c                   endif
      *
     c                   if        p_koio = 0
     c                   eval      vpkopr = w_k2pr
     c                   endif
      *
     c                   if        p_inio = 0
     c                   eval      vpinpr = w_i2pr
6.36 c                   eval      vpinp2 = w_i2pr2
     c                   endif
      *
     c                   eval      vppdat = w_dato
     c                   eval      vpeusr = l_user
     c                   time                    vpedat
     c                   time                    vpetim
      *
     c                   if        %found(vvprlu)
     c                   update    vvprlur
     c                   else
     c                   eval      vpfirm = w_firm
     c                   eval      vpvare = jvvare
6.21 c                   eval      vpldor = w_eldo
5.70 c                   eval      vpprgr = w_prgr
     c                   eval      vpenhe = w_enh2
     c                   eval      vplety = w_lety
6.3x c                   eval      vpousr = l_user
6.3x c                   time                    vpodat
6.3x c                   time                    vpotim
     c                   write     vvprlur
     c                   endif
6.3x c                   eval      w_pgenh = w_enh2
6.3x c                   exsr      sjekk_prg2
      *
6.3y c                   endif
      *
     c                   endif
     c                   endif
      *
      * Salgsenhet-3
      *
     c                   eval(h)   w_k3pr = w_kopr * w_ofv3
     c                   eval(h)   w_i3pr = w_inpr * w_ofv3
6.36 c                   eval(h)   w_i3pr2 = w_inp2 * w_ofv3
      *
     c                   if        w_s3pr <> 0
6.3i c                   if        w_hlev =  1 or
6.3i c                             (p_saio =  0 and
     c                             w_s3pr <> w_s3gm or
     c                             p_koio =  0 and
     c                             w_k3pr <> w_k3gm or
     c                             p_inio =  0 and
6.3i c                             w_i3pr <> w_i3gm)
      *
     c     w_dato        adddur    1:*d          w_dato_wrk
      *
6.3y c                   eval      w_enhx = w_enh3
6.3y c                   exsr      sjk_enh_pgiv
6.3y c                   if        b_enhe = *on
      *
     c                   eval      vvprlu_vare = jvvare
6.21 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_enh3
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato_wrk
     c     vvprlu_key    setll     vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   dow       not %eof
     c                   delete    vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   enddo
      *
     c                   eval      vvprlu_vare = jvvare
6.21 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_enh3
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato
     c     vvprlu_key    chain     vvprlur
      *
     c                   eval      vpsapr = w_s3gm
     c                   eval      vpbupr = w_b3gm
     c                   eval      vpkopr = w_k3gm
     c                   eval      vpinpr = w_i3gm
6.36 c                   eval      vpinp2 = w_i3gm2
6.14 c                   eval      vpnlev = w_ldor
6.3z c                   eval(h)   vpnopr = w_grpr * w_ofv3

      *
     c                   if        p_saio = 0
     c                   eval      vpsapr = w_s3pr
     c                   endif
      *
     c                   if        p_saio = 0 and
     c                             w_b3gm <> 0 and
     c                             w_s3pr <> 0 and
     c                             w_s3gm <> 0
     c                   eval(h)   vpbupr = vpbupr * w_s3pr / w_s3gm
     c                   endif
      *
     c                   if        p_koio = 0
     c                   eval      vpkopr = w_k3pr
     c                   endif
      *
     c                   if        p_inio = 0
     c                   eval      vpinpr = w_i3pr
6.36 c                   eval      vpinp2 = w_i3pr2
     c                   endif
      *
     c                   eval      vppdat = w_dato
     c                   eval      vpeusr = l_user
     c                   time                    vpedat
     c                   time                    vpetim
      *
     c                   if        %found(vvprlu)
     c                   update    vvprlur
     c                   else
     c                   eval      vpfirm = w_firm
     c                   eval      vpvare = jvvare
6.21 c                   eval      vpldor = w_eldo
5.70 c                   eval      vpprgr = w_prgr
     c                   eval      vpenhe = w_enh3
     c                   eval      vplety = w_lety
6.3x c                   eval      vpousr = l_user
6.3x c                   time                    vpodat
6.3x c                   time                    vpotim
     c                   write     vvprlur
     c                   endif
6.3x c                   eval      w_pgenh = w_enh3
6.3x c                   exsr      sjekk_prg2
      *
6.3y c                   endif
      *
     c                   endif
     c                   endif
      *
      * Avbryter behandling av rene innkjøpsenheter dersom kostpris og
      * innkjøpspris ikke er valgt oppdatert
      *
     c                   if        p_koio = 1 and
     c                             p_inio = 1
     c                   leavesr
     c                   endif
      *
      * Innkjøpsenhet-1
      *
     c                   if        w_eni1 <> *blank and
     c                             w_eni1 <> w_enh1 and
     c                             w_eni1 <> w_enh2 and
     c                             w_eni1 <> w_enh3
      *
     c                   if        p_koio =  0 and
     c                             w_k1pr_i <> w_k1gm_i or
     c                             p_inio =  0 and
     c                             w_i1pr_i <> w_i1gm_i
      *
     c     w_dato        adddur    1:*d          w_dato_wrk
      *
6.3y c                   eval      w_enhx = w_eni1
6.3y c                   exsr      sjk_enh_pgiv
6.3y c                   if        b_enhe = *on
      *
     c                   eval      vvprlu_vare = jvvare
6.21 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_eni1
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato_wrk
     c     vvprlu_key    setll     vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   dow       not %eof
     c                   delete    vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   enddo
      *
     c                   eval      vvprlu_vare = jvvare
6.21 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_eni1
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato
     c     vvprlu_key    chain     vvprlur
      *
     c                   eval      vpsapr = 0
     c                   eval      vpbupr = 0
     c                   eval      vpkopr = w_k1gm_i
     c                   eval      vpinpr = w_i1gm_i
6.36 c                   eval      vpinp2 = w_i1gm_i2
6.3z c                   eval(h)   vpnopr = w_grpr * w_ofi1
      *
     c                   if        p_koio = 0
     c                   eval      vpkopr = w_k1pr_i
     c                   endif
      *
     c                   if        p_inio = 0
     c                   eval      vpinpr = w_i1pr_i
6.36 c                   eval      vpinp2 = w_i1pr_i2
     c                   endif
      *
6.21 c                   eval      vpnlev = w_ldor
     c                   eval      vppdat = w_dato
     c                   eval      vpeusr = l_user
     c                   time                    vpedat
     c                   time                    vpetim
      *
     c                   if        %found(vvprlu)
     c                   update    vvprlur
     c                   else
     c                   eval      vpfirm = w_firm
     c                   eval      vpvare = jvvare
6.21 c                   eval      vpldor = w_eldo
5.70 c                   eval      vpprgr = w_prgr
     c                   eval      vpenhe = w_eni1
     c                   eval      vplety = w_lety
6.3x c                   eval      vpousr = l_user
6.3x c                   time                    vpodat
6.3x c                   time                    vpotim
     c                   write     vvprlur
     c                   endif
6.3x c                   eval      w_pgenh = w_eni1
6.3x c                   exsr      sjekk_prg2
      *
6.3y c                   endif
      *
     c                   endif
     c                   endif
      *
      * Innkjøpsenhet-2
      *
     c                   if        w_eni2 <> *blank and
     c                             w_eni2 <> w_enh1 and
     c                             w_eni2 <> w_enh2 and
     c                             w_eni2 <> w_enh3
      *
     c                   if        p_koio =  0 and
     c                             w_k2pr_i <> w_k2gm_i or
     c                             p_inio =  0 and
     c                             w_i2pr_i <> w_i2gm_i
      *
     c     w_dato        adddur    1:*d          w_dato_wrk
      *
6.3y c                   eval      w_enhx = w_eni2
6.3y c                   exsr      sjk_enh_pgiv
6.3y c                   if        b_enhe = *on
      *
     c                   eval      vvprlu_vare = jvvare
6.21 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_eni2
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato_wrk
     c     vvprlu_key    setll     vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   dow       not %eof
     c                   delete    vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   enddo
      *
     c                   eval      vvprlu_vare = jvvare
6.21 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_eni2
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato
     c     vvprlu_key    chain     vvprlur
      *
     c                   eval      vpsapr = 0
     c                   eval      vpbupr = 0
     c                   eval      vpkopr = w_k2gm_i
     c                   eval      vpinpr = w_i2gm_i
6.36 c                   eval      vpinp2 = w_i2gm_i2
6.3z c                   eval(h)   vpnopr = w_grpr * w_ofi2
      *
     c                   if        p_koio = 0
     c                   eval      vpkopr = w_k2pr_i
     c                   endif
      *
     c                   if        p_inio = 0
     c                   eval      vpinpr = w_i2pr_i
6.36 c                   eval      vpinp2 = w_i2pr_i2
     c                   endif
6.21 c                   eval      vpnlev = w_ldor
      *
     c                   eval      vppdat = w_dato
     c                   eval      vpeusr = l_user
     c                   time                    vpedat
     c                   time                    vpetim
      *
     c                   if        %found(vvprlu)
     c                   update    vvprlur
     c                   else
     c                   eval      vpfirm = w_firm
     c                   eval      vpvare = jvvare
6.21 c                   eval      vpldor = w_eldo
5.70 c                   eval      vpprgr = w_prgr
     c                   eval      vpenhe = w_eni2
     c                   eval      vplety = w_lety
6.3x c                   eval      vpousr = l_user
6.3x c                   time                    vpodat
6.3x c                   time                    vpotim
     c                   write     vvprlur
     c                   endif
6.3x c                   eval      w_pgenh = w_eni2
6.3x c                   exsr      sjekk_prg2
      *
6.3y c                   endif
      *
     c                   endif
     c                   endif
      *
      * Innkjøpsenhet-3
      *
     c                   if        w_eni3 <> *blank and
     c                             w_eni3 <> w_enh1 and
     c                             w_eni3 <> w_enh2 and
     c                             w_eni3 <> w_enh3
      *
     c                   if        p_koio =  0 and
     c                             w_k3pr_i <> w_k3gm_i or
     c                             p_inio =  0 and
     c                             w_i3pr_i <> w_i3gm_i
      *
     c     w_dato        adddur    1:*d          w_dato_wrk
      *
6.3y c                   eval      w_enhx = w_enh3
6.3y c                   exsr      sjk_enh_pgiv
6.3y c                   if        b_enhe = *on
      *
     c                   eval      vvprlu_vare = jvvare
6.21 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_eni3
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato_wrk
     c     vvprlu_key    setll     vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   dow       not %eof
     c                   delete    vvprlur
     c     vvprlu_key2   reade     vvprlur
     c                   enddo
      *
     c                   eval      vvprlu_vare = jvvare
6.21 c                   eval      vvprlu_ldor = w_eldo
5.70 c                   eval      vvprlu_prgr = w_prgr
     c                   eval      vvprlu_enhe = w_eni3
     c                   eval      vvprlu_lety = w_lety
     c                   eval      vvprlu_pdat = w_dato
     c     vvprlu_key    chain     vvprlur
      *
     c                   eval      vpsapr = 0
     c                   eval      vpbupr = 0
     c                   eval      vpkopr = w_k3gm_i
     c                   eval      vpinpr = w_i3gm_i
6.36 c                   eval      vpinp2 = w_i3gm_i2
6.3z c                   eval(h)   vpnopr = w_grpr * w_ofi3
      *
     c                   if        p_koio = 0
     c                   eval      vpkopr = w_k3pr_i
     c                   endif
      *
     c                   if        p_inio = 0
     c                   eval      vpinpr = w_i3pr_i
6.36 c                   eval      vpinp2 = w_i3pr_i2
     c                   endif
      *
6.21 c                   eval      vpnlev = w_ldor
     c                   eval      vppdat = w_dato
     c                   eval      vpeusr = l_user
     c                   time                    vpedat
     c                   time                    vpetim
      *
     c                   if        %found(vvprlu)
     c                   update    vvprlur
     c                   else
     c                   eval      vpfirm = w_firm
     c                   eval      vpvare = jvvare
6.21 c                   eval      vpldor = w_eldo
5.70 c                   eval      vpprgr = w_prgr
     c                   eval      vpenhe = w_eni3
     c                   eval      vplety = w_lety
6.3x c                   eval      vpousr = l_user
6.3x c                   time                    vpodat
6.3x c                   time                    vpotim
     c                   write     vvprlur
     c                   endif
6.3x c                   eval      w_pgenh = w_eni3
6.3x c                   exsr      sjekk_prg2
      *
6.3y c                   endif
      *
     c                   endif
     c                   endif
      *
     c                   endsr
6.3x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3x  * Subrutine for å sjekke om prisgr har hatt pris før
6.3x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3x  *
6.3x c     sjekk_prg2    begsr
6.3x  *--------------------------------------------------------------------------------
6.3x c
6.3x  * hvis prisgruppe ikke angitt eller pris dato er mindre eller lik idag
6.3x  * skal det ikke lages spesial pris
6.3x c                   if        w_prgr = *blank or
6.3x c                             w_dato <= w_udat
6.3x c                   leavesr
6.3x c                   endif
6.3x c
6.3x  * valgt leverandør
6.3x c                   eval      vvprl1_vare = jvvare
6.3x c                   eval      vvprl1_prgr = w_prgr
6.3x c                   eval      vvprl1_ldor = w_eldo
6.3x c                   eval      vvprl1_enhe = w_pgenh
6.3x c                   eval      vvprl1_lety = w_lety
6.3x c     vvprl1_key    setll     vvprl1
6.3x c     vvprl1_key    reade     vvprl1
6.3x c                   dow       not %eof
6.3x c                   if        w_udat >= vppdat
6.3x  * det finnes en pg som har gyldig pris
6.3x c                   leavesr
6.3x c                   endif
6.3x c     vvprl1_key    reade     vvprl1
6.3x c                   enddo
6.3x  * varens leverandør
6.3x c                   eval      vvprl1_vare = jvvare
6.3x c                   eval      vvprl1_ldor = vvldor
6.3x c                   eval      vvprl1_prgr = w_prgr
6.3x c                   eval      vvprl1_enhe = w_pgenh
6.3x c                   eval      vvprl1_lety = w_lety
6.3x c     vvprl1_key    setll     vvprl1
6.3x c     vvprl1_key    reade     vvprl1
6.3x c                   dow       not %eof
6.3x c                   if        w_udat >= vppdat
6.3x  * det finnes en pg som har gyldig pris
6.3x c                   leavesr
6.3x c                   endif
6.3x c     vvprl1_key    reade     vvprl1
6.3x c                   enddo
6.3x  * valgt leverandør
6.3x c                   eval      vvprl1_vare = jvvare
6.3x c                   eval      vvprl1_ldor = w_eldo
6.3x c                   eval      vvprl1_prgr = *blank
6.3x c                   eval      vvprl1_enhe = w_pgenh
6.3x c                   eval      vvprl1_lety = w_lety
6.3x c     vvprl1_key    setll     vvprl1
6.3x c     vvprl1_key    reade     vvprl1
6.3x c                   dow       not %eof
6.3x c                   if        w_udat >= vppdat
6.3x c                   eval      vpprgr = w_prgr
6.3x c                   time                    vppdat
6.3x c                   time                    vpodat
6.3x c                   time                    vpotim
6.3x c                   time                    vpedat
6.3x c                   time                    vpetim
6.3x c                   eval      vpeusr = %trim(l_user)
6.3x c                   eval      vpousr = 'EG_PG_SPES'
6.3x c                   write     vvprlur
6.3x c                   leavesr
6.3x c                   endif
6.3x c     vvprl1_key    reade     vvprl1
6.3x c                   enddo
6.3x  * varens leverandør
6.3x c                   eval      vvprl1_ldor = vvldor
6.3x c     vvprl1_key    setll     vvprl1
6.3x c     vvprl1_key    reade     vvprl1
6.3x c                   dow       not %eof
6.3x c                   if        w_udat >= vppdat
6.3x c                   eval      vpprgr = w_prgr
6.3x c                   time                    vppdat
6.3x c                   time                    vpodat
6.3x c                   time                    vpotim
6.3x c                   time                    vpedat
6.3x c                   time                    vpetim
6.3x c                   eval      vpeusr = %trim(l_user)
6.3x c                   eval      vpousr = 'EG_PG_SPES'
6.3x c                   write     vvprlur
6.3x c                   leavesr
6.3x c                   endif
6.3x c     vvprl1_key    reade     vvprl1
6.3x c                   enddo
6.3x  *
6.3x c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av priser/kalkyler på andre leveringstyper
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     leveringstype begsr
5.70  *
5.70  * Behandler priser/kalkyler på andre prisgrupper
5.70  * med valgt leveringstype
5.70  *
5.70 c     ra30l1_key    setll     ra30l1
5.70 c     ra30l1_key    reade     ra30l1
5.70 c                   dow       not %eof
5.70 c                   if        redkod <> *blank
5.70 c                   eval      w_lety = vylety
5.70 c                   eval      b_lety = *on
5.70 c                   exsr      prisgruppe
5.70 c                   endif
5.70 c     ra30l1_key    reade     ra30l1
5.70 c                   enddo
      *
      * Henter kalkulerte verdier for leveringstype
      *
     c                   eval      w_lety = vylety
6.1d c                   eval      w_prgr = *blank
      *
     c                   exsr      hent_data
      *
      * Avbryter dersom det ikke ble funnet kalkyle på valgt
      * leveringstype
      *
6.10 c                   if        w_osts <> *blank and
6.15 c                             w_osts <> 'G'    and
6.15 c                             w_osts <> 'O'    and
6.15 c                             p_vare =  *blank
     c                   leavesr
     c                   endif
      *
     c                   if        w_blet = 0 and
     c                             w_plet = 0
     c                   leavesr
     c                   endif
6.37  * Nullstiller "gamle" verdier, så de ikke skal ligge igjen i regneark
6.37 c                   if        b_excl = *on
6.37 c                   exsr      exc_clear2
6.37 c                   endif
6.37  *
      *
      * Skriv til detaljlinje
      *
      * Initierer variable for enhet-2 og enhet-3
      *
     c                   eval      w_s2gm = 0
     c                   eval      w_k2gm = 0
     c                   eval      w_i2gm = 0
     c                   eval      w_s3gm = 0
     c                   eval      w_k3gm = 0
     c                   eval      w_i3gm = 0
      *
      * Flytter felter til kvitteringsvariable
      *
     c                   eval      d2lety = w_lety
5.70 c                   eval      d2prgr = w_prgr
     c                   eval      d2enh1 = w_enh1
     c                   eval      d2inpr = w_inpr
     c                   eval      d2kopr = w_kopr
     c                   eval      d2s1pr = w_s1pr
     c                   eval      d2s1im = w_s1im
     c                   eval      d2dekn = w_dekn
      *
      * Henter eksisterende priser fra EVR
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_enh1
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    d2s1gm
     c                   parm                    w_b1gm
     c                   parm                    d2kogm
     c                   parm                    d2ingm
6.36 c                   parm                    w_inpr2
6.24ac                   parm                    w_hlev
      *
      * Beregner prosentvis endring av salgspris
      *
     c                   eval      d2endr = 0
      *
     c                   if        d2s1gm <> 0
     c                   if        (100 * d2s1pr / d2s1gm) - 100 > 9999,99
     c                   eval      d2endr = 9999,99
     c                   else
     c                   eval(h)   d2endr = (100 * d2s1pr / d2s1gm) - 100
     c                   endif
     c                   endif
      *
      * Skriv detaljlinje
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
     c                   write     d2dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
      * Salgsenhet-2
      *
     c                   if        w_enh2 <> *blank
      *
     c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
     c                   eval      d3enhe = w_enh2
     c                   eval      d3sapr = w_s2pr
     c                   eval      d3saim = w_s2im
     c                   eval      d3endr = 0
      *
6.3k c                   eval      ds2lty = w_lety
6.3k c                   eval      ds2prg = w_prgr
6.3k c                   eval      ds2enh = w_enh2
6.3k c                   eval      ds2sap = w_s2pr
6.3k c                   eval      ds2sai = w_s2im
6.3k c                   eval      ds2end = 0
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_enh2
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    w_s2gm
     c                   parm                    w_b2gm
     c                   parm                    w_k2gm
     c                   parm                    w_i2gm
6.36 c                   parm                    w_i2gm2
6.24ac                   parm                    w_hlev
      *
     c                   if        w_s2gm <> 0
     c                   if        (100 * d3sapr / w_s2gm) - 100 > 9999,99
     c                   eval      d3endr = 9999,99
     c                   else
     c                   eval(h)   d3endr = (100 * d3sapr / w_s2gm) - 100
     c                   endif
     c                   endif
6.3k c                   eval      ds2end = d3endr
      *
     c                   eval      d3sagm = w_s2gm
6.3k c                   eval      ds2sag = w_s2gm
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
     c                   write     d3dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
     c                   endif
      *
      * Salgsenhet-3
      *
     c                   if        w_enh3 <> *blank
      *
     c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
     c                   eval      d3enhe = w_enh3
     c                   eval      d3sapr = w_s3pr
     c                   eval      d3saim = w_s3im
     c                   eval      d3endr = 0
6.3k  *
6.3k c                   eval      ds3lty = w_lety
6.3k c                   eval      ds3prg = w_prgr
6.3k c                   eval      ds3enh = w_enh3
6.3k c                   eval      ds3sap = w_s3pr
6.3k c                   eval      ds3sai = w_s3im
6.3k c                   eval      ds3end = 0
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_enh3
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    w_s3gm
     c                   parm                    w_b3gm
     c                   parm                    w_k3gm
     c                   parm                    w_i3gm
6.36 c                   parm                    w_i3gm2
6.24ac                   parm                    w_hlev
      *
     c                   if        w_s3gm <> 0
     c                   if        (100 * d3sapr / w_s3gm) - 100 > 9999,99
     c                   eval      d3endr = 9999,99
     c                   else
     c                   eval(h)   d3endr = (100 * d3sapr / w_s3gm) - 100
     c                   endif
     c                   endif
6.3k c                   eval      ds3end = d3endr
      *
     c                   eval      d3sagm = w_s3gm
6.3k c                   eval      ds3sag = w_s3gm
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
     c                   write     d3dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
     c                   endif
      *
      * Innkjøpsenhet-1
      *
     c                   if        w_eni1 <> *blank and
     c                             w_eni1 <> w_enh1 and
     c                             w_eni1 <> w_enh2 and
     c                             w_eni1 <> w_enh3
      *
     c                   eval(h)   w_k1pr_i = w_kopr * w_ofi1
     c                   eval(h)   w_i1pr_i = w_inpr * w_ofi1
6.36 c                   eval(h)   w_i1pr_i2 = w_inp2 * w_ofi1
      *
     c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4enhe = w_eni1
     c                   eval      d4inpr = w_i1pr_i
     c                   eval      d4kopr = w_k1pr_i
     c                   eval      d4endr = 0
6.3k  *
6.3k c                   eval      di1lty = w_lety
6.3k c                   eval      di1prg = w_prgr
6.3k c                   eval      di1enh = w_eni1
6.3k c                   eval      di1inp = w_i1pr_i
6.3k c                   eval      di1kop = w_k1pr_i
6.3k c                   eval      di1end = 0
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_eni1
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    w_sagm
     c                   parm                    w_bugm
     c                   parm                    w_k1gm_i
     c                   parm                    w_i1gm_i
6.36 c                   parm                    w_i1gm_i2
6.24ac                   parm                    w_hlev
      *
     c                   if        w_k1gm_i <> 0
     c                   if        (100 * d4kopr / w_k1gm_i) - 100 > 9999,99
     c                   eval      d4endr = 9999,99
     c                   else
     c                   eval(h)   d4endr = (100 * d4kopr / w_k1gm_i) - 100
     c                   endif
     c                   endif
6.3k c                   eval      di1end = d4endr
      *
     c                   eval      d4ingm = w_i1gm_i
6.3k c                   eval      di1ing = w_i1gm_i
     c                   eval      d4kogm = w_k1gm_i
6.3k c                   eval      di1kog = w_k1gm_i
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
     c                   endif
      *
      * Innkjøpsenhet-2
      *
     c                   if        w_eni2 <> *blank and
     c                             w_eni2 <> w_enh1 and
     c                             w_eni2 <> w_enh2 and
     c                             w_eni2 <> w_enh3
      *
     c                   eval(h)   w_k2pr_i = w_kopr * w_ofi2
     c                   eval(h)   w_i2pr_i = w_inpr * w_ofi2
6.36 c                   eval(h)   w_i2pr_i2 = w_inp2 * w_ofi2
      *
     c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4enhe = w_eni2
     c                   eval      d4inpr = w_i2pr_i
     c                   eval      d4kopr = w_k2pr_i
     c                   eval      d4endr = 0
6.3k  *
6.3k c                   eval      di2lty = w_lety
6.3k c                   eval      di2prg = w_prgr
6.3k c                   eval      di2enh = w_eni2
6.3k c                   eval      di2inp = w_i2pr_i
6.3k c                   eval      di2kop = w_k2pr_i
6.3k c                   eval      di2end = 0
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_eni2
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    w_sagm
     c                   parm                    w_bugm
     c                   parm                    w_k2gm_i
     c                   parm                    w_i2gm_i
6.36 c                   parm                    w_i2gm_i2
6.24ac                   parm                    w_hlev
      *
     c                   if        w_k2gm_i <> 0
     c                   if        (100 * d4kopr / w_k2gm_i) - 100 > 9999,99
     c                   eval      d4endr = 9999,99
     c                   else
     c                   eval(h)   d4endr = (100 * d4kopr / w_k2gm_i) - 100
     c                   endif
     c                   endif
6.3k c                   eval      di2end = d4endr
      *
     c                   eval      d4ingm = w_i2gm_i
6.3k c                   eval      di2ing = w_i2gm_i
     c                   eval      d4kogm = w_k2gm_i
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
     c                   endif
      *
      * Innkjøpsenhet-3
      *
     c                   if        w_eni3 <> *blank and
     c                             w_eni3 <> w_enh1 and
     c                             w_eni3 <> w_enh2 and
     c                             w_eni3 <> w_enh3
      *
     c                   eval(h)   w_k3pr_i = w_kopr * w_ofi3
     c                   eval(h)   w_i3pr_i = w_inpr * w_ofi3
6.36 c                   eval(h)   w_i3pr_i2 = w_inp2 * w_ofi3
      *
     c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4enhe = w_eni3
     c                   eval      d4inpr = w_i3pr_i
     c                   eval      d4kopr = w_k3pr_i
     c                   eval      d4endr = 0
6.3k  *
6.3k c                   eval      di3lty = w_lety
6.3k c                   eval      di3prg = w_prgr
6.3k c                   eval      di3enh = w_eni3
6.3k c                   eval      di3inp = w_i3pr_i
6.3k c                   eval      di3kop = w_k3pr_i
6.3k c                   eval      di3end = 0
      *
6.22 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
     c                   parm                    w_eni3
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    w_inlr
     c                   parm                    w_sagm
     c                   parm                    w_bugm
     c                   parm                    w_k3gm_i
     c                   parm                    w_i3gm_i
6.36 c                   parm                    w_i3gm_i2
6.24ac                   parm                    w_hlev
      *
     c                   if        w_k3gm_i <> 0
     c                   if        (100 * d4kopr / w_k3gm_i) - 100 > 9999,99
     c                   eval      d4endr = 9999,99
     c                   else
     c                   eval(h)   d4endr = (100 * d4kopr / w_k3gm_i) - 100
     c                   endif
     c                   endif
6.3k c                   eval      di3end = d4endr
      *
     c                   eval      d4ingm = w_i3gm_i
6.3k c                   eval      di3ing = w_i3gm_i
     c                   eval      d4kogm = w_k3gm_i
6.3k c                   eval      di3kog = w_k3gm_i
      *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
     c                   endif
6.3k  *
6.3k c                   if        b_excl = *on
6.3k c                   exsr      xml_detal
6.3k c                   endif
      *
      * Oppdaterer/oppretter priser på leveringstype
      *
     c                   if        p_kntr = 0
     c                   eval      d1s1gm = d2s1gm
     c                   eval      d1kogm = d2kogm
     c                   eval      d1ingm = d2ingm
     c                   exsr      oppd_pris
     c                   endif
      *
     c                   endsr
      *
5.70  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.70  * Subrutine for behandling av priser/kalkyler på andre leveringstyper
5.70  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.70  *
5.70 c     prisgruppe    begsr
5.70  *
5.70  * Henter kalkulerte verdier for leveringstype
5.70  *
5.70 c                   eval      w_prgr = redkod
5.70  *
5.70 c                   exsr      hent_data
6.3w  *
6.3w  * Avbryter dersom det ikke er dannet pris på prisgr. blank
6.3w  *
6.3w c                   if        b_dann = *off
6.3w c                   leavesr
6.3w c                   endif
5.70  *
5.70  * Avbryter dersom det ikke ble funnet kalkyle på valgt
5.70  * leveringstype
5.70  *
6.10 c                   if        w_osts <> *blank and
6.15 c                             w_osts <> 'G'    and
6.15 c                             w_osts <> 'O'    and
6.15 c                             p_vare =  *blank
5.70 c                   leavesr
5.70 c                   endif
5.70  *
6.3x c                   if        w_prut = *blank  and
6.3x c                             w_pgbe = *blank  and
6.3x c                             w_pgfr = *blank
5.70 c                   leavesr
5.70 c                   endif
5.70  *
5.70 c                   if        b_lety = *on and
5.70 c                             w_blet = 0 and
5.70 c                             w_plet = 0
5.70 c                   leavesr
5.70 c                   endif
6.37  * Nullstiller "gamle" verdier, så de ikke skal ligge igjen i regneark
6.37 c                   if        b_excl = *on
6.37 c                   exsr      exc_clear2
6.37 c                   endif
6.37  *
5.70  *
5.70  * Skriv til detaljlinje
5.70  *
5.70  * Initierer variable for enhet-2 og enhet-3
5.70  *
5.70 c                   eval      w_s2gm = 0
5.70 c                   eval      w_k2gm = 0
5.70 c                   eval      w_i2gm = 0
5.70 c                   eval      w_s3gm = 0
5.70 c                   eval      w_k3gm = 0
5.70 c                   eval      w_i3gm = 0
5.70  *
5.70  * Flytter felter til kvitteringsvariable
5.70  *
5.70 c                   eval      d2lety = w_lety
5.70 c                   eval      d2prgr = w_prgr
5.70 c                   eval      d2enh1 = w_enh1
5.70 c                   eval      d2inpr = w_inpr
5.70 c                   eval      d2kopr = w_kopr
5.70 c                   eval      d2s1pr = w_s1pr
5.70 c                   eval      d2s1im = w_s1im
5.70 c                   eval      d2dekn = w_dekn
5.70  *
5.70  * Henter eksisterende priser fra EVR
5.70  *
6.22 c                   call      'VP712R'
5.70 c                   parm                    w_firm
5.70 c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
5.70 c                   parm                    w_enh1
5.70 c                   parm                    w_lety
5.70 c                   parm                    w_udat
5.70 c                   parm                    w_inlr
5.70 c                   parm                    d2s1gm
5.70 c                   parm                    w_b1gm
5.70 c                   parm                    d2kogm
5.70 c                   parm                    d2ingm
6.36 c                   parm                    w_inpr2
6.24ac                   parm                    w_hlev
5.70  *
5.70  * Beregner prosentvis endring av salgspris
5.70  *
5.70 c                   eval      d2endr = 0
5.70  *
5.70 c                   if        d2s1gm <> 0
5.70 c                   if        (100 * d2s1pr / d2s1gm) - 100 > 9999,99
5.70 c                   eval      d2endr = 9999,99
5.70 c                   else
5.70 c                   eval(h)   d2endr = (100 * d2s1pr / d2s1gm) - 100
5.70 c                   endif
5.70 c                   endif
5.70  *
5.70  * Skriv detaljlinje
5.70  *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
5.70 c                   write     d2dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70  *
5.70  * Salgsenhet-2
5.70  *
5.70 c                   if        w_enh2 <> *blank
5.70  *
5.70 c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
5.70 c                   eval      d3enhe = w_enh2
5.70 c                   eval      d3sapr = w_s2pr
5.70 c                   eval      d3saim = w_s2im
5.70 c                   eval      d3endr = 0
6.3k  *
6.3k c                   eval      ds2lty = w_lety
6.3k c                   eval      ds2prg = w_prgr
6.3k c                   eval      ds2enh = w_enh2
6.3k c                   eval      ds2sap = w_s2pr
6.3k c                   eval      ds2sai = w_s2im
6.3k c                   eval      ds2end = 0
5.70  *
6.22 c                   call      'VP712R'
5.70 c                   parm                    w_firm
5.70 c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
5.70 c                   parm                    w_enh2
5.70 c                   parm                    w_lety
5.70 c                   parm                    w_udat
5.70 c                   parm                    w_inlr
5.70 c                   parm                    w_s2gm
5.70 c                   parm                    w_b2gm
5.70 c                   parm                    w_k2gm
5.70 c                   parm                    w_i2gm
6.36 c                   parm                    w_i2gm2
6.24ac                   parm                    w_hlev
5.70  *
5.70 c                   if        w_s2gm <> 0
5.70 c                   if        (100 * d3sapr / w_s2gm) - 100 > 9999,99
5.70 c                   eval      d3endr = 9999,99
5.70 c                   else
5.70 c                   eval(h)   d3endr = (100 * d3sapr / w_s2gm) - 100
5.70 c                   endif
5.70 c                   endif
6.3k c                   eval      ds2end = d3endr
5.70  *
5.70 c                   eval      d3sagm = w_s2gm
6.3k c                   eval      ds2sag = w_s2gm
5.70  *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
5.70 c                   write     d3dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70  *
5.70 c                   endif
5.70  *
5.70  * Salgsenhet-3
5.70  *
5.70 c                   if        w_enh3 <> *blank
5.70  *
5.70 c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
5.70 c                   eval      d3enhe = w_enh3
5.70 c                   eval      d3sapr = w_s3pr
5.70 c                   eval      d3saim = w_s3im
5.70 c                   eval      d3endr = 0
6.3k  *
6.3k c                   eval      ds3lty = w_lety
6.3k c                   eval      ds3prg = w_prgr
6.3k c                   eval      ds3enh = w_enh3
6.3k c                   eval      ds3sap = w_s3pr
6.3k c                   eval      ds3sai = w_s3im
6.3k c                   eval      ds3end = 0
6.3k  *
6.22 c                   call      'VP712R'
5.70 c                   parm                    w_firm
5.70 c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
5.70 c                   parm                    w_enh3
5.70 c                   parm                    w_lety
5.70 c                   parm                    w_udat
5.70 c                   parm                    w_inlr
5.70 c                   parm                    w_s3gm
5.70 c                   parm                    w_b3gm
5.70 c                   parm                    w_k3gm
5.70 c                   parm                    w_i3gm
6.36 c                   parm                    w_i3gm2
6.24ac                   parm                    w_hlev
5.70  *
5.70 c                   if        w_s3gm <> 0
5.70 c                   if        (100 * d3sapr / w_s3gm) - 100 > 9999,99
5.70 c                   eval      d3endr = 9999,99
5.70 c                   else
5.70 c                   eval(h)   d3endr = (100 * d3sapr / w_s3gm) - 100
5.70 c                   endif
5.70 c                   endif
6.3k c                   eval      ds3end = d3endr
5.70  *
5.70 c                   eval      d3sagm = w_s3gm
6.3k c                   eval      ds3sag = w_s3gm
5.70  *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
5.70 c                   write     d3dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70  *
5.70 c                   endif
5.70  *
5.70  * Innkjøpsenhet-1
5.70  *
5.70 c                   if        w_eni1 <> *blank and
5.70 c                             w_eni1 <> w_enh1 and
5.70 c                             w_eni1 <> w_enh2 and
5.70 c                             w_eni1 <> w_enh3
5.70  *
5.70 c                   eval(h)   w_k1pr_i = w_kopr * w_ofi1
5.70 c                   eval(h)   w_i1pr_i = w_inpr * w_ofi1
6.36 c                   eval(h)   w_i1pr_i2 = w_inp2 * w_ofi1
5.70  *
5.70 c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
5.70 c                   eval      d4enhe = w_eni1
5.70 c                   eval      d4inpr = w_i1pr_i
5.70 c                   eval      d4kopr = w_k1pr_i
5.70 c                   eval      d4endr = 0
6.3k  *
6.3k c                   eval      di1lty = w_lety
6.3k c                   eval      di1prg = w_prgr
6.3k c                   eval      di1enh = w_eni1
6.3k c                   eval      di1inp = w_i1pr_i
6.3k c                   eval      di1kop = w_k1pr_i
6.3k c                   eval      di1end = 0
5.70  *
6.22 c                   call      'VP712R'
5.70 c                   parm                    w_firm
5.70 c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
5.70 c                   parm                    w_eni1
5.70 c                   parm                    w_lety
5.70 c                   parm                    w_udat
5.70 c                   parm                    w_inlr
5.70 c                   parm                    w_sagm
5.70 c                   parm                    w_bugm
5.70 c                   parm                    w_k1gm_i
5.70 c                   parm                    w_i1gm_i
6.36 c                   parm                    w_i1gm_i2
6.24ac                   parm                    w_hlev
5.70  *
5.70 c                   if        w_k1gm_i <> 0
5.70 c                   if        (100 * d4kopr / w_k1gm_i) - 100 > 9999,99
5.70 c                   eval      d4endr = 9999,99
5.70 c                   else
5.70 c                   eval(h)   d4endr = (100 * d4kopr / w_k1gm_i) - 100
5.70 c                   endif
5.70 c                   endif
6.3k c                   eval      di1end = d4endr
5.70  *
5.70 c                   eval      d4ingm = w_i1gm_i
6.3k c                   eval      di1ing = w_i1gm_i
5.70 c                   eval      d4kogm = w_k1gm_i
6.3k c                   eval      di1kog = w_k1gm_i
5.70  *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
5.70 c                   write     d4dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70  *
5.70 c                   endif
5.70  *
5.70  * Innkjøpsenhet-2
5.70  *
5.70 c                   if        w_eni2 <> *blank and
5.70 c                             w_eni2 <> w_enh1 and
5.70 c                             w_eni2 <> w_enh2 and
5.70 c                             w_eni2 <> w_enh3
5.70  *
5.70 c                   eval(h)   w_k2pr_i = w_kopr * w_ofi2
5.70 c                   eval(h)   w_i2pr_i = w_inpr * w_ofi2
6.36 c                   eval(h)   w_i2pr_i2 = w_inp2 * w_ofi2
5.70  *
5.70 c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
5.70 c                   eval      d4enhe = w_eni2
5.70 c                   eval      d4inpr = w_i2pr_i
5.70 c                   eval      d4kopr = w_k2pr_i
5.70 c                   eval      d4endr = 0
6.3k  *
6.3k c                   eval      di2lty = w_lety
6.3k c                   eval      di2prg = w_prgr
6.3k c                   eval      di2enh = w_eni2
6.3k c                   eval      di2inp = w_i2pr_i
6.3k c                   eval      di2kop = w_k2pr_i
6.3k c                   eval      di2end = 0
6.3k  *
6.22 c                   call      'VP712R'
5.70 c                   parm                    w_firm
5.70 c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
5.70 c                   parm                    w_eni2
5.70 c                   parm                    w_lety
5.70 c                   parm                    w_udat
5.70 c                   parm                    w_inlr
5.70 c                   parm                    w_sagm
5.70 c                   parm                    w_bugm
5.70 c                   parm                    w_k2gm_i
5.70 c                   parm                    w_i2gm_i
6.36 c                   parm                    w_i2gm_i2
6.24ac                   parm                    w_hlev
5.70  *
5.70 c                   if        w_k2gm_i <> 0
5.70 c                   if        (100 * d4kopr / w_k2gm_i) - 100 > 9999,99
5.70 c                   eval      d4endr = 9999,99
5.70 c                   else
5.70 c                   eval(h)   d4endr = (100 * d4kopr / w_k2gm_i) - 100
5.70 c                   endif
5.70 c                   endif
6.3k c                   eval      di2end = d4endr
5.70  *
5.70 c                   eval      d4ingm = w_i2gm_i
6.3k c                   eval      di2ing = w_i2gm_i
5.70 c                   eval      d4kogm = w_k2gm_i
6.3k c                   eval      di2kog = w_k2gm_i
5.70  *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
5.70 c                   write     d4dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70  *
5.70 c                   endif
5.70  *
5.70  * Innkjøpsenhet-3
5.70  *
5.70 c                   if        w_eni3 <> *blank and
5.70 c                             w_eni3 <> w_enh1 and
5.70 c                             w_eni3 <> w_enh2 and
5.70 c                             w_eni3 <> w_enh3
5.70  *
5.70 c                   eval(h)   w_k3pr_i = w_kopr * w_ofi3
5.70 c                   eval(h)   w_i3pr_i = w_inpr * w_ofi3
6.36 c                   eval(h)   w_i3pr_i2 = w_inp2 * w_ofi3
5.70  *
5.70 c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
5.70 c                   eval      d4enhe = w_eni3
5.70 c                   eval      d4inpr = w_i3pr_i
5.70 c                   eval      d4kopr = w_k3pr_i
5.70 c                   eval      d4endr = 0
6.3k  *
6.3k c                   eval      di3lty = w_lety
6.3k c                   eval      di3prg = w_prgr
6.3k c                   eval      di3enh = w_eni3
6.3k c                   eval      di3inp = w_i3pr_i
6.3k c                   eval      di3kop = w_k3pr_i
6.3k c                   eval      di3end = 0
5.70  *
6.22 c                   call      'VP712R'
5.70 c                   parm                    w_firm
5.70 c                   parm                    jvvare
6.22 c                   parm                    w_enum
5.70 c                   parm                    w_prgr
5.70 c                   parm                    w_eni3
5.70 c                   parm                    w_lety
5.70 c                   parm                    w_udat
5.70 c                   parm                    w_inlr
5.70 c                   parm                    w_sagm
5.70 c                   parm                    w_bugm
5.70 c                   parm                    w_k3gm_i
5.70 c                   parm                    w_i3gm_i
6.36 c                   parm                    w_i3gm_i2
6.24ac                   parm                    w_hlev
5.70  *
5.70 c                   if        w_k3gm_i <> 0
5.70 c                   if        (100 * d4kopr / w_k3gm_i) - 100 > 9999,99
5.70 c                   eval      d4endr = 9999,99
5.70 c                   else
5.70 c                   eval(h)   d4endr = (100 * d4kopr / w_k3gm_i) - 100
5.70 c                   endif
5.70 c                   endif
6.3k c                   eval      di3end = d4endr
5.70  *
5.70 c                   eval      d4ingm = w_i3gm_i
6.3k c                   eval      di3ing = w_i3gm_i
5.70 c                   eval      d4kogm = w_k3gm_i
6.3k c                   eval      di3kog = w_k3gm_i
5.70  *
6.3k c**                 if        b_excl = *on
6.3k c**                 exsr      xml_detal
6.3k c**                 else
6.3k c                   if        b_excl = *off
5.70 c                   write     d4dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70  *
5.70 c                   endif
6.3k  *
6.3k c                   if        b_excl = *on
6.3k c                   exsr      xml_detal
6.3k c                   endif
5.70  *
5.70  * Oppdaterer/oppretter priser på leveringstype
5.70  *
5.70 c                   if        p_kntr = 0
     c                   eval      d1s1gm = d2s1gm
     c                   eval      d1kogm = d2kogm
     c                   eval      d1ingm = d2ingm
5.70 c                   exsr      oppd_pris
5.70 c                   endif
5.70  *
5.70 c                   endsr
      *
6.14  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.14  * Subrutine for å dann vare-enhet-prisgiver
6.30  * Riktig JVPKPF er lest, så det skal bare være å skrive til vveppf
6.30  * Skriver kun til den valgte prisgiver
6.14  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.14  *
6.14 c     oppr_vep      begsr
6.30  *
6.34 c                   eval      wwpgti = w_gtin
6.30  *
6.18 c                   eval      wwpvar      = vevare
6.18 c                   eval      wwpenh      = veenhe
6.18 c                   exsr      rydd_ean
6.14  *
6.30 c                   clear                   vveplur
6.14 c                   eval      vveplu_pvar = vevare
6.14 c                   eval      vveplu_penh = veenhe
6.30 c                   eval      vveplu_pldo = w_eldo
6.14 c     vveplu_key    chain     vveplu
6.34 c                   eval      vepkla = w_pkla
6.34 c                   eval      vepbes = w_best
6.34 c                   eval      vepgti = w_gtin
6.14 c                   if        %found(vveplu)
6.14 c                   eval      vepeus = l_user
6.14 c                   time                    vepeti
6.14 c                   time                    vepeda
6.14 c                   update    vveplur
6.14 c                   else
6.14 c                   eval      vepfir = w_firm
6.14 c                   eval      vepvar = vveplu_pvar
6.14 c                   eval      vepenh = vveplu_penh
6.14 c                   eval      vepldo = vveplu_pldo
6.14 c                   eval      vepeus = l_user
6.14 c                   time                    vepeti
6.14 c                   time                    vepeda
6.14 c                   eval      vepous = l_user
6.14 c                   time                    vepoti
6.14 c                   time                    vepoda
6.14 c                   write     vveplur
6.14 c                   endif
6.16  *
6.14 c                   endsr
6.3q  *
6.3q  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3q  * Subrutine for oppretting av vare-leverandør
6.3q  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3q  *
6.3q c     oppr_vare_lev begsr
6.3t  *
6.3t  * sjekker om varenr + nobb.lev ligger fra før, i såfall rydd denne
6.3t  *
     c                   eval      w_lldo = 0
6.3v c                   if        b_logv = *on
6.3t c/exec sql
6.3t c+ select vvlldo
6.3t c+ into   :w_lldo
6.3t c+ from   vvlepf
6.3t c+ where  vvlvnr = :jvvare and
6.3t c+        vvlnle = :w_lv_lldo
6.3t c/end-exec
6.3v c                   else
6.3v c/exec sql
6.3v c+ select vvlldo
6.3v c+ into   :w_lldo
6.3v c+ from   vvlepf
6.3v c+ where  vvlvnr = :jvvare and
6.3v c+        vvlnle = :jvlldo
6.3v c/end-exec
6.3v c                   endif
6.3t c                   if        w_lldo <> 0  and
6.3t c                             w_lldo <> w_eldo
6.3t c                   eval      vvlelu_lvnr = jvvare
6.3t c                   eval      vvlelu_lldo = w_lldo
6.3t c     vvlelu_key    chain     vvlelu
6.3t c                   if        %found(vvlelu)
6.3t c                   delete    vvlelur
6.3t c                   endif
6.3t c                   endif
      *
6.3q c                   clear                   vvlelur
6.3q  *
6.3q c                   eval      vvlelu_lvnr = jvvare
6.3q c                   eval      vvlelu_lldo = w_eldo
6.3q c     vvlelu_key    chain     vvlelu
6.3q c                   if        b_logv = *on
6.3q c                   eval      vvlnob = w_lv_nobb
6.3q c                   eval      vvlmod = w_lv_modn
6.3q c                   eval      vvllva = w_lv_llva
6.3q c                   eval      vvluda = w_lv_luda
6.3q c                   eval      vvlnle = w_lv_lldo
6.3q c                   else
6.3q c                   eval      vvlnob = jvnobb
6.3q c                   eval      vvlmod = jvmodn
6.3q c                   eval      vvllva = jvllva
6.3q c                   eval      vvluda = jvluda
6.3q c                   eval      vvlnle = jvlldo
6.3q c                   endif
6.3q c                   eval      vvleus = l_user
6.3q c                   time                    vvleda
6.3q c                   time                    vvleti
6.3q c                   if        %found(vvlelu)
6.3q c                   update    vvlelur
6.3q c                   else
6.3u c                   eval      vvlous = l_user
6.3u c                   time                    vvloda
6.3u c                   time                    vvloti
6.3q c                   eval      vvlfir = l_firm
6.3q c                   eval      vvlvnr = vvlelu_lvnr
6.3q c                   eval      vvlldo = vvlelu_lldo
6.3q c                   write     vvlelur
6.3q c                   endif
6.3q  *
6.3q c                   endsr
6.3q  *
6.3q  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3q  * Finn info om logistikkvare for riktig prisgiver
6.3q  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3q  *
6.3q c     finn_logivar  begsr
6.3q  *
6.3v c*                   eval      b_logv = *off
6.3v c*                   eval      w_lv_vare  = *blank
6.3v c*                   eval      w_lv_modn  = 0
6.3v c*                   eval      w_lv_nobb  = 0
6.3v c*                   eval      w_lv_lldo  = 0
6.3v c*                   eval      w_lv_llva  = *blank
6.3v c*                   eval      w_lv_luda  = *loval
6.3v c*                   eval      w_lv_enum  = 0
6.3q c/exec sql
6.3q c+ select jvvare,
6.3q c+        jvmodn,
6.3q c+        jvnobb,
6.3q c+        jvlldo,
6.3q c+        jvllva,
6.3q c+        jvluda,
6.3q c+        jlenum
6.3q c+ into   :w_lv_vare,
6.3q c+        :w_lv_modn,
6.3q c+        :w_lv_nobb,
6.3q c+        :w_lv_lldo,
6.3q c+        :w_lv_llva,
6.3q c+        :w_lv_luda,
6.3q c+        :w_lv_enum
6.3q c+ from   jvlepf
6.3q c+ inner join jvarpf on jvlvnr = jvvare
6.3q c+ inner join jlevpf on jlldor = jvlldo
6.3q c+ where  jvlldo = :w_ldor and
6.3q c+        jvlvnr =
6.3q c+ (select jvquno from jvklpf where jvqvnr = :jvvare
6.3q c+                              and jvqfir = :w_firm
6.3q c+         and jvqldo = :w_ldor fetch first 1 rows only)
6.3q c/end-exec
6.3q c
6.3q  *
6.3q c                   if        sqlcod = 100 or sqlstt = '02000'
6.3q c                   leavesr
6.3q c                   endif
6.3q c                   if        sqlcod <> 0
6.3q c                   leavesr
6.3q c                   endif
6.3q  *
6.3q c                   eval      b_logv = *on
6.3q  *
6.3q c                   endsr
6.3q  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  * Subrutine for å dann vare-enhet-prisgiver
6.30  * Leser vare pakning og legger ut info pr. lev. på vare-enhet
6.30  * gtin, pakningsklasse, best.bar enhet på de lev. som knyttet
6.30  * til reskontro.
6.30  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  * SKAL IKKE BEHØVE DENNE LOGIKKEN LENGER - TAR VARE PÅ FOR SIKKERHET
6.30  * SKYLD
6.30 c*    oppr_vep      begsr
6.30  *
6.30  * finner pakning til valgt enhet
6.30 c*                  eval      jvpkl2_vare = vevare
6.30 c*    jvpkl2_key2   setll     jvpkl2
6.30 c*    jvpkl2_key2   reade     jvpkl2
6.30 c*                  dow       not %eof
6.30  *
6.30 c*                  if        jwenhe = veenhe and
6.30 c*                            jwpakn <> '000'
6.30  *
6.30  * finner GTIN for produsent for denne enheten
6.30  *
6.30 c*                  eval      b_gtin = *off
6.30 c*                  eval      w_gtin = 0
6.30 c*                  eval      wwppkl = *blank
6.30 c*                  eval      jvpplr_pvar = vevare
6.30 c*                  eval      jvpplr_ppak = jwpakn
6.30 c*                  eval      jvpplr_pldo = jvldor
6.30 c*    jvpplr_key    chain     jvpplr
6.30 c*                  if        %found(jvpplr)
6.30 c*                  eval      w_gtin = jwpgti
6.30 c*                  eval      wwppkl = jwppkl
6.30 c*                  endif
6.30  *
6.30  * leser vare-pakning pr. pakning
6.30  *
6.30 c*                  eval      jvppl1_pvar = jwvare
6.30 c*                  eval      jvppl1_ppak = jwpakn
6.30 c*    jvppl1_key    setll     jvppl1
6.30 c*    jvppl1_key    reade     jvppl1
6.30 c*                  dow       not %eof (jvppl1)
6.30 c*                  eval      jlevl1_ldor = jwpldo
6.30 c*    jlevl1_key    chain     jlevl1
6.30 c*                  if        %found(jlevl1) and
6.30 c*                            jlenum <> 0
6.30  *
6.30 c*                  if        jwpgti = 0
6.30 c*                  eval      wwpgti = w_gtin
6.30 c*                  else
6.30 c*                  eval      wwpgti = jwpgti
6.30 c*                  endif
6.30 c*                  eval      wwpvar      = vevare
6.30 c*                  eval      wwpenh      = veenhe
6.30 c*                  eval      wwpldo      = jlenum
6.30 c*                  exsr      rydd_ean
6.30  *
6.30 c*                  eval      vveplu_pvar = vevare
6.30 c*                  eval      vveplu_penh = veenhe
6.30 c*                  eval      vveplu_pldo = jlenum
6.30 c*    vveplu_key    chain     vveplu
6.30 c*                  eval      vepkla = jwppkl
6.30 c*                  eval      vepbes = jwpbes
6.30 c*                  eval      vepgti = wwpgti
6.30 c*                  if        jlenum = w_eldo
6.30  * settes hvis prisgiver har fått gtin
6.30 c*                  eval      b_gtin = *on
6.30 c*                  endif
6.30 c*                  if        %found(vveplu)
6.30 c*                  eval      vepeus = l_user
6.30 c*                  time                    vepeti
6.30 c*                  time                    vepeda
6.30 c*                  update    vveplur
6.30 c*                  else
6.30 c*                  eval      vepfir = w_firm
6.30 c*                  eval      vepvar = vveplu_pvar
6.30 c*                  eval      vepenh = vveplu_penh
6.30 c*                  eval      vepldo = vveplu_pldo
6.30 c*                  eval      vepeus = l_user
6.30 c*                  time                    vepeti
6.30 c*                  time                    vepeda
6.30 c*                  eval      vepous = l_user
6.30 c*                  time                    vepoti
6.30 c*                  time                    vepoda
6.30 c*                  write     vveplur
6.30 c*                  endif
6.30  *
6.30 c*                  endif
6.30  *
6.30 c*    jvppl1_key    reade     jvppl1
6.30 c*                  enddo
6.30  * etter at alle prisgivere på enhet er lest...
6.30  * sjekker om gtin er dannet for enhet, hvis ikke så legges
6.30  * vareeiers gtin på prisgiver som overfører
6.30 c*                  if        b_gtin = *off and
6.30 c*                            w_gtin <> 0   and
6.30 c*                            w_eldo <> 0
6.30 c*                  eval      vveplu_pvar = vevare
6.30 c*                  eval      vveplu_penh = veenhe
6.30 c*                  eval      vveplu_pldo = w_eldo
6.30 c*    vveplu_key    chain     vveplu
6.30 c*                  eval      vepgti = w_gtin
6.30 c*                  if        %found(vveplu)
6.30 c*                  eval      vepeus = l_user
6.30 c*                  time                    vepeti
6.30 c*                  time                    vepeda
6.30 c*                  update    vveplur
6.30 c*                  else
6.30 c*                  eval      vepfir = w_firm
6.30 c*                  eval      vepvar = vveplu_pvar
6.30 c*                  eval      vepenh = vveplu_penh
6.30 c*                  eval      vepldo = vveplu_pldo
6.30 c*                  eval      vepeus = l_user
6.30 c*                  time                    vepeti
6.30 c*                  time                    vepeda
6.30 c*                  eval      vepous = l_user
6.30 c*                  time                    vepoti
6.30 c*                  time                    vepoda
6.30 c*                  write     vveplur
6.30 c*                  endif
6.30 c*                  endif
6.30  *
6.30 c*                  endif
6.30  *
6.30 c*    jvpkl2_key2   reade     jvpkl2
6.30 c*                  enddo
6.30  *
6.30 c*                  endsr
6.14  *
6.14  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.14  * Subrutine for å rydde ean-nr på veanpf som ligger på vvenpf
6.14  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.14  *
6.14 c     rydd_ean      begsr
6.14  *
6.18 c                   if        wwpgti = 0
6.18 c                   leavesr
6.18 c                   endif
6.18 c                   eval      veanlu_eann = wwpgti
6.14 c     veanlu_key    chain     veanlu
6.14 c                   if        %found(veanlu)
6.14 c                   delete    veanlur
6.14 c                   endif
6.18  *
6.18  * sjekker om gtin ligger på annen vare-sletter denne
6.18  * eller at det ligger på samme vare, men forskj. enhet.
6.18  *
6.18 c                   eval      vvepl2_pgti = wwpgti
6.18 c     vvepl2_key    setll     vvepl2
6.18 c     vvepl2_key    reade     vvepl2
6.18 c                   dow       not %eof(vvepl2)
6.18 c                   if        vepvar <> wwpvar
6.18 c                   eval      vepgti = 0
6.18 c                   endif
6.18 c                   if        vepvar = wwpvar and
6.18 c                             vepenh <> wwpenh
6.18 c                   eval      vepgti = 0
6.18 c                   endif
     c                   update    vvepl2r
6.14 c     vvepl2_key    reade     vvepl2
6.14 c                   enddo
6.14  *
6.14 c                   endsr
6.1e  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.1e  * Subrutine for å legge ut gammel gtin  til veanpf
6.1e  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.1e  *
6.1e c     upd_eann      begsr
6.1e  *
6.1e c                   clear                   veanlur
6.1e c                   eval      veanlu_eann = vepgti
6.1e c     veanlu_key    chain     veanlu
6.1e c                   if        not %found(veanlu)
6.1e c                   eval      vxvare = vepvar
6.1e c                   eval      vxenhe = vepenh
6.1e c                   time                    vxtime
6.1e c                   time                    vxedat
6.1e c                   time                    vxetim
6.1e c                   eval      vxeusr = l_user
6.1e c                   eval      vxfirm = w_firm
6.1e c                   eval      vxeann = vepgti
6.1e c                   time                    vxodat
6.1e c                   time                    vxotim
6.1e c                   eval      vxousr = l_user
6.1e c                   write     veanlur
6.1e c                   endif
6.1e  *
6.1e c                   endsr
6.23  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.23  * Hvis hovedleverandør byttes, ryddes gml.leverandørs priser
6.23  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.23  *
6.23 c     rydd_pris     begsr
6.23  *
6.23 c                   eval      b_pris = *off
6.23 c                   eval      vvprlu_vare = vvvare
6.23 c                   eval      vvprlu_ldor = vvldor
6.23 c     vvprlu_key4   setll     vvprlu
6.23 c     vvprlu_key4   reade     vvprlur
6.23 c                   dow       not %eof
6.23 c                   eval      b_pris = *on
6.23 c                   delete    vvprlur
6.23 c     vvprlu_key4   reade     vvprlur
6.23 c                   enddo
6.23  *
6.23  * Fjerner evt. lev.nr fra lager hvis det ikke finnes priser lenger
6.23  * på leverandør
6.23 c                   if        b_pris = *on
6.23  *
     c                   eval      vlaglu_vare = vvvare
6.23 c     vlaglu_key    setll     vlaglu
6.23 c     vlaglu_key    reade     vlaglu
6.23 c                   dow       not %eof(vlaglu)
6.23 c                   if        vlbldo = vvldor
6.23 c                   eval      vlbldo = 0
6.23 c                   time                    vledat
6.23 c                   time                    vletim
6.23 c                   eval      vleusr = l_user
6.23 c                   update    vlaglur
6.23 c                   endif
6.23 c     vlaglu_key    reade     vlaglu
6.23 c                   enddo
6.23 c                   endif
6.23  *
6.23 c                   endsr
6.25  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.25  * Hvis hovedleverandør byttes, oppd. hoved.lev etter at priser er dannet
6.25  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.25  *
6.25 c     upd_vvldor    begsr
6.25  *
6.25 c                   if        p_flpr = 0
6.25 c                   eval      vvarlu_vare = jvvare
6.25 c     vvarlu_key    chain     vvarlur
6.25 c                   if        %found(vvarlu)
6.25 c                   eval      vvldor = w_eldo
6.3o c                   eval      vvnlev = w_ldor
6.3o c                   eval      vvnuda = jvluda
6.25 c                   time                    vvedat
6.25 c                   time                    vvetim
6.25 c                   update    vvarlur
6.25 c                   endif
6.25 c                   endif
6.25 c                   endsr
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  * Subrutine for å sjekke om dato er innenfor fra /til dato
6.32  * hvis *loval i begge datoer = ok
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  *
6.32 c     sjekk_pkdato  begsr
6.32  *
6.32 c                   eval      b_pakn = *on
6.32  *
6.32 c                   if        jwfdat = *loval and
6.32 c                             jwtdat = *loval
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.32 c                   if        jwfdat <= w_udat and
6.32 c                             jwtdat >  w_udat
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.32 c                   if        jwfdat = *loval  and
6.32 c                             jwtdat >  w_udat
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.32 c                   if        jwfdat <= w_udat and
6.32 c                             jwtdat =  *loval
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.32 c                   eval      b_pakn = *off
6.32  *
6.32 c                   endsr
6.32  *
6.3y  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3y  * Sjekker om prisgiver har enhet på vare, før man danner pris på den
6.3y  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3y  *
6.3y c     sjk_enh_pgiv  begsr
6.3y c                   eval      b_enhe = *off
6.3y c                   eval      jvpkl2_vare = jvvare
6.3y c                   eval      jvpkl2_ldor = p_pgiv
6.3y c                   eval      jvpkl2_enhe = w_enhx
6.3y c     jvpkl2_key    setll     jvpkl2
6.3y c     jvpkl2_key    reade     jvpkl2
6.3y c                   dow       not %eof(jvpkl2)
6.3y c                   exsr      sjekk_pkdato
6.3y c                   if        b_pakn = *on
6.3y c                   eval      b_enhe = *on
6.3y c                   leavesr
6.3y c                   endif
6.3y c     jvpkl2_key    reade     jvpkl2
6.3y c                   enddo
6.3y c                   endsr
6.3y  *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Nullst. alle var., så det ikke blir liggende "gamle" verdier    *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     exc_clear     begsr
6.37  * D1DTL
6.37 c                   eval      d1osts = *blanks
6.37 c                   eval      d1tek1 = *blanks
6.37 c                   eval      d1sort = *blanks
6.37 c                   eval      d1vare = *blanks
6.37 c                   eval      d1nobb = 0
6.37 c                   eval      d1lvar = *blanks
6.37 c                   eval      d1lnav = *blanks
6.37 c                   eval      d1prgr = *blanks
6.37 c                   eval      d1lety = 0
6.37 c                   eval      d1enh1 = *blanks
6.37 c                   eval      d1ingm = 0
6.37 c                   eval      d1inpr = 0
6.37 c                   eval      d1kogm = 0
6.37 c                   eval      d1kopr = 0
6.37 c                   eval      d1s1gm = 0
6.37 c                   eval      d1s1pr = 0
6.37 c                   eval      d1s1im = 0
6.37 c                   eval      d1endr = 0
6.37 c                   eval      d1dekn = 0
6.37 c                   eval      d1pkod = *blanks
6.37 c                   eval      d1vtyp = *blank
6.37  * D2DTL
6.3k c                   eval      d2prgr = *blanks
6.3k c                   eval      d2lety = 0
6.3k c                   eval      d2enh1 = *blanks
6.3k c                   eval      d2ingm = 0
6.3k c                   eval      d2inpr = 0
6.3k c                   eval      d2kogm = 0
6.3k c                   eval      d2kopr = 0
6.3k c                   eval      d2s1gm = 0
6.3k c                   eval      d2s1pr = 0
6.3k c                   eval      d2s1im = 0
6.3k c                   eval      d2endr = 0
6.3k c                   eval      d2dekn = 0
6.37  * D3DTL
6.3k c                   eval      ds2prg = *blanks
6.3k c                   eval      ds2lty = 0
6.3k c                   eval      ds2enh = *blanks
6.3k c                   eval      ds2sag = 0
6.3k c                   eval      ds2sap = 0
6.3k c                   eval      ds2sai = 0
6.3k c                   eval      ds2end = 0
6.3k  *
6.3k c                   eval      ds3prg = *blanks
6.3k c                   eval      ds3lty = 0
6.3k c                   eval      ds3enh = *blanks
6.3k c                   eval      ds3sag = 0
6.3k c                   eval      ds3sap = 0
6.3k c                   eval      ds3sai = 0
6.3k c                   eval      ds3end = 0
6.37  * D4DTL
6.3k c                   eval      di1prg = *blanks
6.3k c                   eval      di1lty = 0
6.3k c                   eval      di1enh = *blanks
6.3k c                   eval      di1ing = 0
6.3k c                   eval      di1inp = 0
6.3k c                   eval      di1kog = 0
6.3k c                   eval      di1kop = 0
6.3k c                   eval      di1end = 0
6.37  *
6.3k c                   eval      di2prg = *blanks
6.3k c                   eval      di2lty = 0
6.3k c                   eval      di2enh = *blanks
6.3k c                   eval      di2ing = 0
6.3k c                   eval      di2inp = 0
6.3k c                   eval      di2kog = 0
6.3k c                   eval      di2kop = 0
6.3k c                   eval      di2end = 0
6.37  *
6.3k c                   eval      di3prg = *blanks
6.3k c                   eval      di3lty = 0
6.3k c                   eval      di3enh = *blanks
6.3k c                   eval      di3ing = 0
6.3k c                   eval      di3inp = 0
6.3k c                   eval      di3kog = 0
6.3k c                   eval      di3kop = 0
6.3k c                   eval      di3end = 0
6.37  *
6.37 c                   endsr
6.3k  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.3k  * Nullst. alle var., så det ikke blir liggende "gamle" verdier    *
6.3k  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.3k c     exc_clear2    begsr
6.3k  * D2DTL
6.3k c                   eval      d2prgr = *blanks
6.3k c                   eval      d2lety = 0
6.3k c                   eval      d2enh1 = *blanks
6.3k c                   eval      d2ingm = 0
6.3k c                   eval      d2inpr = 0
6.3k c                   eval      d2kogm = 0
6.3k c                   eval      d2kopr = 0
6.3k c                   eval      d2s1gm = 0
6.3k c                   eval      d2s1pr = 0
6.3k c                   eval      d2s1im = 0
6.3k c                   eval      d2endr = 0
6.3k c                   eval      d2dekn = 0
6.3k  * D3DTL
6.3k c                   eval      ds2prg = *blanks
6.3k c                   eval      ds2lty = 0
6.3k c                   eval      ds2enh = *blanks
6.3k c                   eval      ds2sag = 0
6.3k c                   eval      ds2sap = 0
6.3k c                   eval      ds2sai = 0
6.3k c                   eval      ds2end = 0
6.3k  *
6.3k c                   eval      ds3prg = *blanks
6.3k c                   eval      ds3lty = 0
6.3k c                   eval      ds3enh = *blanks
6.3k c                   eval      ds3sag = 0
6.3k c                   eval      ds3sap = 0
6.3k c                   eval      ds3sai = 0
6.3k c                   eval      ds3end = 0
6.3k  * D4DTL
6.3k c                   eval      di1prg = *blanks
6.3k c                   eval      di1lty = 0
6.3k c                   eval      di1enh = *blanks
6.3k c                   eval      di1ing = 0
6.3k c                   eval      di1inp = 0
6.3k c                   eval      di1kog = 0
6.3k c                   eval      di1kop = 0
6.3k c                   eval      di1end = 0
6.3k  *
6.3k c                   eval      di2prg = *blanks
6.3k c                   eval      di2lty = 0
6.3k c                   eval      di2enh = *blanks
6.3k c                   eval      di2ing = 0
6.3k c                   eval      di2inp = 0
6.3k c                   eval      di2kog = 0
6.3k c                   eval      di2kop = 0
6.3k c                   eval      di2end = 0
6.3k  *
6.3k c                   eval      di3prg = *blanks
6.3k c                   eval      di3lty = 0
6.3k c                   eval      di3enh = *blanks
6.3k c                   eval      di3ing = 0
6.3k c                   eval      di3inp = 0
6.3k c                   eval      di3kog = 0
6.3k c                   eval      di3kop = 0
6.3k c                   eval      di3end = 0
6.3k  *
6.3k c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Finner spool som er generert av jobben
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     spoolnbr      begsr
6.37  /Free
6.37
6.37           QSPRILSP( SPRL0100
6.37                   : %size(SPRL0100)
6.37                   : 'SPRL0100'
6.37                   : errorcode );
6.37  /End-free
6.37 c*
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Kaller eget program for generering av xml fil. Eget pgm         *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_create    begsr
6.37  *
6.37 c                   eval      splfname2 = *blanks
6.37 c                   eval      splfname3 = *blanks
6.37 c                   eval      jobname2 = *blanks
6.37 c                   eval      jobname3 = *blanks
6.37 c                   eval      username2 = *blanks
6.37 c                   eval      username3 = *blanks
6.37 c                   eval      jobnbr2 = *blanks
6.37 c                   eval      jobnbr3 = *blanks
6.37 c                   eval      splfnbr2 = *zeros
6.37 c                   eval      splfnbr3 = *zeros
6.37 c                   eval      p_btyp = 'DELVARE'
6.37 c                   eval      p_dspl = 'Oppdatering av pris og +
6.37 c                                       vareinformasjon - kjørt +
6.37 c                                       dato: '+ %char(udate)
6.37 c                   eval      p_refn = 'EVR-' + %char(udate)
6.37 c                   eval      p_tagg0 = *blanks
6.37 c                   eval      p_tagg0val = *blanks
6.37 c                   eval      p_tagg1 = *blanks
6.37 c                   eval      p_tagg1val = *blanks
6.37 c                   eval      p_tagg2 = *blanks
6.37 c                   eval      p_tagg2val = *blanks
6.37 c                   eval      p_tagg3 = *blanks
6.37 c                   eval      p_tagg3val = *blanks
6.37 c                   eval      p_tagg4 = *blanks
6.37 c                   eval      p_tagg4val = *blanks
6.37 c                   eval      p_tagg5 = *blanks
6.37 c                   eval      p_tagg5val = *blanks
6.37 c                   eval      p_tagg6 = *blanks
6.37 c                   eval      p_tagg6val = *blanks
6.37 c                   eval      p_tagg7 = *blanks
6.37 c                   eval      p_tagg7val = *blanks
6.37 c                   eval      p_tagg8 = *blanks
6.37 c                   eval      p_tagg8val = *blanks
6.37 c                   eval      p_tagg9 = *blanks
6.37 c                   eval      p_tagg9val = *blanks
6.37  *
6.37 c                   call      'AP627R'
6.37 c                   PARM                    splfname
6.37 c                   PARM                    jobname
6.37 c                   PARM                    username
6.37 c                   PARM                    jobnbr
6.37 c                   PARM                    splfnbr
6.37 c                   PARM                    splfname2
6.37 c                   PARM                    jobname2
6.37 c                   PARM                    username2
6.37 c                   PARM                    jobnbr2
6.37 c                   PARM                    splfnbr2
6.37 c                   PARM                    splfname3
6.37 c                   PARM                    jobname3
6.37 c                   PARM                    username3
6.37 c                   PARM                    jobnbr3
6.37 c                   PARM                    splfnbr3
6.37 c                   parm                    p_tagg0
6.37 c                   parm                    p_tagg0val
6.37 c                   parm                    p_tagg1
6.37 c                   parm                    p_tagg1val
6.37 c                   parm                    p_tagg2
6.37 c                   parm                    p_tagg2val
6.37 c                   parm                    p_tagg3
6.37 c                   parm                    p_tagg3val
6.37 c                   parm                    p_tagg4
6.37 c                   parm                    p_tagg4val
6.37 c                   parm                    p_tagg5
6.37 c                   parm                    p_tagg5val
6.37 c                   parm                    p_tagg6
6.37 c                   parm                    p_tagg6val
6.37 c                   parm                    p_tagg7
6.37 c                   parm                    p_tagg7val
6.37 c                   parm                    p_tagg8
6.37 c                   parm                    p_tagg8val
6.37 c                   parm                    p_tagg9
6.37 c                   parm                    p_tagg9val
6.37 c                   PARM                    l_bach
6.37 c                   PARM                    p_btyp
6.37 c                   PARM                    p_refn
6.37 c                   PARM                    p_dspl
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML/jasper integrasjon - Skjermvisning           *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     pdf_preview   begsr
6.37 c                   if        l_skje = 1 or
6.37 c                             b_excl = *on
6.37  * Vi kaller program for launch av PDF i browser
6.37 c                   call      'AP621R'
6.37 c                   parm                    l_bach
6.37  *
6.37 c                   endif
6.37  *
6.37 c                   endsr
6.37  *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML/jasper integrasjon - Miljø variabler         *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_envm      begsr
6.37  *
6.37 c                   eval      w_rtyp = 'XsltCommand'
6.37 c                   eval      w_mime = 'application/vnd.ms-excel'
6.37 c                   eval      d_jasm = *blank
6.37  *
6.37  /Free
6.37       // Finne nytt batch nummer
6.37           UpdHTMLVar('BatchNo':               w_jkey);
6.37           UpdHTMLVar('Batchtype':            'EXCEL');
6.37           UpdHTMLVar('Username':              l_user);
6.37           WrtSection('Topp');
6.37       // Finn report command variabler
6.37           UpdHTMLVar('User':                l_user);
6.37           UpdHTMLVar('PW':                     ' ');
6.37           UpdHTMLVar('IPAdr':                  ' ');
6.37           UpdHTMLVar('Schema':        'ADB'+l_filg);
6.37           UpdHTMLVar('Companyno':    %char(l_firm));
6.37           WrtSection('Credential');
6.37       // Finn report command variabler
6.37           UpdHTMLVar('Reportcommandtype':   w_rtyp);
6.37       //  UpdHTMLVar('Jaspertemplate':      d_jasm);
6.37           UpdHTMLVar('Logo':                   ' ');
6.37           UpdHTMLVar('Keepspool':           'true');
6.37           UpdHTMLVar('Xsltschemapath':         ' ');
6.37           UpdHTMLVar('Mimetype':            w_mime);
6.37           WrtSection('ReportCommand');
6.37  /End-free
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML integrasjon - Heading                        *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_head      begsr
6.37  *
6.37 c                   eval      aforl1_ruti = l_ruti
6.37 c     aforl1_key    chain     aforl1r
6.37  * Hvis mail skal skrives, må vi hente mail informasjon
6.37  *
6.37 c                   if        l_mail = 1
6.37 c                   eval      p_kule = 'L'
6.37 c                   eval      p_kund = vvldor
6.37 c                   eval      p_kpro = *zeros
6.37 c                   eval      p_numm = *zeros
6.38 c                   eval      p_suff = *zeros
6.37 c                   eval      p_selg = *zeros
6.37 c                   eval      p_in03 = *off
6.37  * Henter ut mailserver
6.37 c                   eval      p_serv = *blank
6.37 c                   eval      p_stat = *blank
6.37 c                   call      'AM705C'
6.37 c                   parm                    p_serv
6.37 c                   parm                    p_stat
6.37  *
6.37 c                   call      'FO798R'
6.37 c                   parm                    p_kule
6.37 c                   parm                    p_kund
6.37 c                   parm                    p_kpro
6.37 c                   parm                    p_numm
6.38 c                   parm                    p_suff
6.37 c                   parm                    p_selg
6.37 c                   parm                    p_navn
6.37 c                   parm                    p_emal
6.38 c                   parm                    p_ema2
6.38 c                   parm                    p_ema3
6.37 c                   parm                    p_emne
6.37 c                   parm                    p_txt1
6.37 c                   parm                    p_txt2
6.37 c                   parm                    p_txt3
6.37 c                   parm                    p_txt4
6.37 c                   parm                    p_pers
6.38 c                   parm                    p_kopi
6.37 c                   parm                    p_inif
6.37 c                   parm                    p_in03
6.37  * Scann av strenger
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_emne        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_pemne
6.37  * Scann av strenger
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_txt1        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_ptxt1
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_txt2        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_ptxt2
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_txt3        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_ptxt3
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_txt4        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_ptxt4
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_pers        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_ppers
6.37  *
6.37 c                   eval      w_mtxt = %trim(w_ptxt1) + crlf +
6.37 c                                      %trim(w_ptxt2) + crlf +
6.37 c                                      %trim(w_ptxt3) + crlf +
6.37 c                                      %trim(w_ptxt4) + crlf +
6.37 c                                      %trim(w_ppers)
6.37  *
6.38 c                   if        p_kopi = *blanks
6.38 c                   eval      p_kopi = d_emal
6.37 c                   endif
6.37  *
6.37 c                   if        p_in03 = *off
6.37  *
6.37  /Free
6.37       // Skriv mailinformasjon
6.38           WrtSection('MailCommandStart');
6.38      //   UpdHTMLVar('Receivers':           p_emal);
6.38           if %Trim(p_emal)<> *blanks;
6.38           UpdHTMLVar('Receivers':           p_emal);
6.38           WrtSection('MailReceiver');
6.38           endif;
6.30           if %Trim(p_ema2)<> *blanks;
6.38           UpdHTMLVar('Receivers':           p_ema2);
6.38           WrtSection('MailReceiver');
6.38           endif;
6.38           if %Trim(p_ema3)<> *blanks;
6.38           UpdHTMLVar('Receivers':           p_ema3);
6.38           WrtSection('MailReceiver');
6.38           endif;
6.37           UpdHTMLVar('CC':                     ' ');
6.38           UpdHTMLVar('BCC':                 p_kopi);
6.38           UpdHTMLVar('Sender':              p_kopi);
6.37           UpdHTMLVar('Subject':             w_pemne);
6.37           UpdHTMLVar('Message':             w_mtxt);
6.37           UpdHTMLVar('SMTPServer':          p_serv);
6.37           UPDHTMLVar('SMTPUser':               ' ');
6.37           UPDHTMLVar('SMTPPw':                 ' ');
6.38      //   WrtSection('MailCommand');
6.38           WrtSection('MailCommandEnd');
6.37  /End-free
6.37 c                   endif
6.37 c                   endif
6.37  * Scann av strenger
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     aftxt1        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_txt1
6.37  *
6.37  * Vi må oversette aktuelle tekster til "xml" tegn - Firma
6.37 c                   eval      w_1fnav = *blank
6.37 c                   eval      w_1fad1 = *blank
6.37 c                   eval      w_1fad2 = *blank
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     w_fnav        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_1fnav
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     w_fad1        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_1fad1
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     w_fad2        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_1fad2
6.37  *
6.37  /Free
6.37
6.37       // Skriv firmavariabler
6.37           UpdHTMLVar('Reporttext':            w_txt1);
6.37           UpdHTMLVar('Subheader':                ' ');
6.37           UpdHTMLVar('CompanyName':          w_1fnav);
6.37           UpdHTMLVar('Companyadress1':       w_1fad1);
6.37           UpdHTMLVar('Companyadress2':       w_1fad2);
6.37           UpdHTMLVar('Companypostalcode':        ' ');
6.37           UpdHTMLVar('Companypostoffice':     w_fste);
6.37           UpdHTMLVar('Companyphone':          w_ftlf);
6.37           UpdHTMLVar('Companyfax':            w_ffax);
6.37           UpdHTMLVar('Companyorgno':   %char(aafftn));
6.37           UpdHTMLVar('Companygiro':    %char(aafbgi));
6.37           UpdHTMLVar('Companyemail':          aamail);
6.37           UpdHTMLVar('Companywebpage': %trim(aaweba));
6.37
6.37           test(de) *dmy w_ddmy;
6.37           if %error;
6.37           tmpdate = *loval;
6.37           else;
6.37           tmpdate = %date(w_ddmy : *dmy);
6.37           endif;
6.37           UpdHTMLVar('Creationdate':   %char(tmpdate : *iso));
6.37
6.37           test(te) *hms w_tids;
6.37           if %error;
6.37           tmptime = *loval;
6.37           else;
6.37           tmptime = %time(w_tids : *hms);
6.37           endif;
6.37           UpdHTMLVar('Creationtime': %char(tmptime : *hms));
6.37           WrtSection('DocumentInformation');
6.37
6.37           WrtSection('FreedefHeader');
6.37
6.37  /End-free
6.37  *
6.37  * D1DTL
6.37 c                   eval      h_valu='Status'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Varetekst'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Sort'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Varenr'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Nobb-nr'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Lev.varenr'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Leverandør'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Prisgrp'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Lev.type'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Enhet'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Gammel innkj.pris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Ny innkj.pris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Gammel kostpris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Ny kostpris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Gammel salgspris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Ny salgspris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Salgspris inkl.mva'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Endr %'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='DG'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='P'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Varetype'
6.37 c                   exsr      xml_head_val
6.3c c                   eval      h_valu='Prisdato'
6.3c c                   exsr      xml_head_val
6.37  * D2DTL
6.37 c                   eval      h_valu='Prisgrp'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Lev.type'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Enhet'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Gammel innkj.pris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Ny innkj.pris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Gammel kostpris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Ny kostpris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Gammel salgspris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Ny salgspris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Salgspris inkl.mva'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Endr %'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='DG'
6.37 c                   exsr      xml_head_val
6.3k  * D3DTL - salgsenhet 2
6.37 c                   eval      h_valu='Prisgrp'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Lev.type'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Enhet (S2)'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Gammel salgspris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Ny salgspris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Salgspris ink.mva'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Endr %'
6.37 c                   exsr      xml_head_val
6.3k  * D3DTL - salgsenhet 3
6.3k c                   eval      h_valu='Prisgrp'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Lev.type'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Enhet (S3)'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Gammel salgspris'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Ny salgspris'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Salgspris ink.mva'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Endr %'
6.3k c                   exsr      xml_head_val
6.3k  * D4DTL - innkjøpsenhet 1
6.37 c                   eval      h_valu='Prisgrp'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Lev.type'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Enhet (I1)'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Gammel innkj.pris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Ny innkj.pris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Gammel kostpris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Ny kostpris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Endr %'
6.37 c                   exsr      xml_head_val
6.3k  * D4DTL - innkjøpsenhet 2
6.3k c                   eval      h_valu='Prisgrp'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Lev.type'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Enhet (I2)'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Gammel innkj.pris'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Ny innkj.pris'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Gammel kostpris'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Ny kostpris'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Endr %'
6.3k c                   exsr      xml_head_val
6.3k  * D4DTL - innkjøpsenhet 3
6.3k c                   eval      h_valu='Prisgrp'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Lev.type'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Enhet (I3)'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Gammel innkj.pris'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Ny innkj.pris'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Gammel kostpris'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Ny kostpris'
6.3k c                   exsr      xml_head_val
6.3k c                   eval      h_valu='Endr %'
6.3k c                   exsr      xml_head_val
6.37  *
6.37  /Free
6.37
6.37       // Avslutt headervalues
6.37           WrtSection('HeaderLineEnd');
6.37
6.37  /End-free
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML integrasjon - Heading                        *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_head_val  begsr
6.37  *
6.37  /Free
6.37
6.37       // Skriv headervalue
6.37           UpdHTMLVar('Headervalue':  %trim(h_valu));
6.37           WrtSection('HeaderLineValue');
6.37
6.37  /End-free
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML integrasjon - detaljlinjer                   *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_detal     begsr
6.37  *
6.37  /Free
6.37
6.37       // Skriv detaljer
6.37           WrtSection('DetailLineStart');
6.37
6.37           WrtSection('FreedefLine');
6.37
6.37  /End-free
6.37  *
6.37  * D1DTL
6.37  *
6.37  * Varetekst
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     d1tek1        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_tek1
6.37  * Leverandørnavn
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     d1lnav        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_lnav
6.37  *
6.37  * Så skriver vi de forskjellige linjene
6.37  *
6.37  * Status
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1osts)
6.37 c                   exsr      xml_line_val
6.37  * Varetekst
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(w_tek1)
6.37 c                   exsr      xml_line_val
6.37  * Sort
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1sort)
6.37 c                   exsr      xml_line_val
6.37  * Varenummer
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1vare)
6.37 c                   exsr      xml_line_val
6.37  * Nobbnummer
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1nobb)
6.37 c                   exsr      xml_line_val
6.37  * Leverandørens varenummer
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1lvar)
6.37 c                   exsr      xml_line_val
6.37  * Leverandørnavn
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(w_lnav)
6.37 c                   exsr      xml_line_val
6.37  * Prisgruppe
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1prgr)
6.37 c                   exsr      xml_line_val
6.37  * Leveringstype
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1lety)
6.37 c                   exsr      xml_line_val
6.37  * Enhet
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1enh1)
6.37 c                   exsr      xml_line_val
6.37  * Gammle innkjøpspris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1ingm)
6.37 c                   exsr      xml_line_val
6.37  * Ny innkjøpspris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1inpr)
6.37 c                   exsr      xml_line_val
6.37  * Gammel kostpris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1kogm)
6.37 c                   exsr      xml_line_val
6.37  * Ny kostpris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1kopr)
6.37 c                   exsr      xml_line_val
6.37  * Gammel salgspris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1s1gm)
6.37 c                   exsr      xml_line_val
6.37  * Ny salgspris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1s1pr)
6.37 c                   exsr      xml_line_val
6.37  * Salgspris inkl.mva
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1s1im)
6.37 c                   exsr      xml_line_val
6.37  * Endring
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1endr)
6.37 c                   exsr      xml_line_val
6.37  * Dekningsgrad
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1dekn)
6.37 c                   exsr      xml_line_val
6.37  * Priskode ?
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1pkod)
6.37 c                   exsr      xml_line_val
6.37  * Varetype
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1vtyp)
6.37 c                   exsr      xml_line_val
6.3c  * Prisdato
6.3c c                   eval      d_type='Date'
6.3c  /Free
6.3c
6.3c           UpdHTMLVar('type':         %trim(d_type));
6.3c           test(de) *dmy w_prdt;
6.3c           if %error;
6.3c           tmpdate = *loval;
6.3c           else;
6.3c           tmpdate = %date(w_prdt : *dmy);
6.3c           endif;
6.3c           UpdHTMLVar('Linevalue':   %char(tmpdate : *iso));
6.3c           WrtSection('DetailLineValue');
6.3c
6.3c  /End-free
6.3c  *
6.37  * D2DTL
6.37  *
6.37  * Prisgruppe
6.37  *
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d2prgr)
6.37 c                   exsr      xml_line_val
6.37  * Leveringstype
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d2lety)
6.37 c                   exsr      xml_line_val
6.37  * Enhet
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d2enh1)
6.37 c                   exsr      xml_line_val
6.37  * Gammel innkjøpspris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d2ingm)
6.37 c                   exsr      xml_line_val
6.37  * Ny innkjøpspris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d2inpr)
6.37 c                   exsr      xml_line_val
6.37  * Gammel kostpris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d2kogm)
6.37 c                   exsr      xml_line_val
6.37  * Ny kostpris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d2kopr)
6.37 c                   exsr      xml_line_val
6.37  * Gammel salgspris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d2s1gm)
6.37 c                   exsr      xml_line_val
6.37  * Ny salgspris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d2s1pr)
6.37 c                   exsr      xml_line_val
6.37  * Salgspris ink mva
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d2s1im)
6.37 c                   exsr      xml_line_val
6.37  * Endring
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d2endr)
6.37 c                   exsr      xml_line_val
6.37  * Dekningsgrad
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d2dekn)
6.37 c                   exsr      xml_line_val
6.37  *
6.37  * D3DTL - salgsenhet 2
6.37  *
6.37  * Prisgruppe
6.37  *
6.37 c                   eval      d_type='Char'
6.3k c                   eval      d_valu=%trim(ds2prg)
6.37 c                   exsr      xml_line_val
6.37  * Leveringstype
6.37 c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(ds2lty)
6.37 c                   exsr      xml_line_val
6.37  * Enhet
6.37 c                   eval      d_type='Char'
6.3k c                   eval      d_valu=%trim(ds2enh)
6.37 c                   exsr      xml_line_val
6.37  * Gammel salgspris
6.37 c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(ds2sag)
6.37 c                   exsr      xml_line_val
6.37  * Ny salgspris
6.37 c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(ds2sap)
6.37 c                   exsr      xml_line_val
6.37  * Salgspris ink mva
6.37 c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(ds2sai)
6.37 c                   exsr      xml_line_val
6.37  * Endring
6.37 c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(ds2end)
6.37 c                   exsr      xml_line_val
6.3k  *
6.3k  * D3DTL - salgsenhet 3
6.3k  *
6.3k  * Prisgruppe
6.3k  *
6.3k c                   eval      d_type='Char'
6.3k c                   eval      d_valu=%trim(ds3prg)
6.3k c                   exsr      xml_line_val
6.3k  * Leveringstype
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(ds3lty)
6.3k c                   exsr      xml_line_val
6.3k  * Enhet
6.3k c                   eval      d_type='Char'
6.3k c                   eval      d_valu=%trim(ds3enh)
6.3k c                   exsr      xml_line_val
6.3k  * Gammel salgspris
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(ds3sag)
6.3k c                   exsr      xml_line_val
6.3k  * Ny salgspris
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(ds3sap)
6.3k c                   exsr      xml_line_val
6.3k  * Salgspris ink mva
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(ds3sai)
6.3k c                   exsr      xml_line_val
6.3k  * Endring
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(ds3end)
6.3k c                   exsr      xml_line_val
6.37  *
6.3k  * D4DTL - innkjøpsenhet 1
6.37  *
6.37  * Prisgruppe
6.37  *
6.37 c                   eval      d_type='Char'
6.3k c                   eval      d_valu=%trim(di1prg)
6.37 c                   exsr      xml_line_val
6.37  * Leveringstype
6.37 c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di1lty)
6.37 c                   exsr      xml_line_val
6.37  * Enhet
6.37 c                   eval      d_type='Char'
6.3k c                   eval      d_valu=%trim(di1enh)
6.37 c                   exsr      xml_line_val
6.37  * Gammel innkjøpspris
6.37 c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di1ing)
6.37 c                   exsr      xml_line_val
6.37  * Ny innkjøpspris
6.37 c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di1inp)
6.37 c                   exsr      xml_line_val
6.37  * Gammel kostpris
6.37 c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di1kog)
6.37 c                   exsr      xml_line_val
6.37  * Ny kostpris
6.37 c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di1kop)
6.37 c                   exsr      xml_line_val
6.37  * Endring
6.37 c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di1end)
6.37 c                   exsr      xml_line_val
6.3k  *
6.3k  * D4DTL - innkjøpsenhet 2
6.3k  *
6.3k  * Prisgruppe
6.3k  *
6.3k c                   eval      d_type='Char'
6.3k c                   eval      d_valu=%trim(di2prg)
6.3k c                   exsr      xml_line_val
6.3k  * Leveringstype
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di2lty)
6.3k c                   exsr      xml_line_val
6.3k  * Enhet
6.3k c                   eval      d_type='Char'
6.3k c                   eval      d_valu=%trim(di2enh)
6.3k c                   exsr      xml_line_val
6.3k  * Gammel innkjøpspris
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di2ing)
6.3k c                   exsr      xml_line_val
6.3k  * Ny innkjøpspris
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di2inp)
6.3k c                   exsr      xml_line_val
6.3k  * Gammel kostpris
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di2kog)
6.3k c                   exsr      xml_line_val
6.3k  * Ny kostpris
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di2kop)
6.3k c                   exsr      xml_line_val
6.3k  * Endring
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di2end)
6.3k c                   exsr      xml_line_val
6.3k  *
6.3k  * D4DTL - innkjøpsenhet 3
6.3k  *
6.3k  * Prisgruppe
6.3k  *
6.3k c                   eval      d_type='Char'
6.3k c                   eval      d_valu=%trim(di3prg)
6.3k c                   exsr      xml_line_val
6.3k  * Leveringstype
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di3lty)
6.3k c                   exsr      xml_line_val
6.3k  * Enhet
6.3k c                   eval      d_type='Char'
6.3k c                   eval      d_valu=%trim(di3enh)
6.3k c                   exsr      xml_line_val
6.3k  * Gammel innkjøpspris
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di3ing)
6.3k c                   exsr      xml_line_val
6.3k  * Ny innkjøpspris
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di3inp)
6.3k c                   exsr      xml_line_val
6.3k  * Gammel kostpris
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di3kog)
6.3k c                   exsr      xml_line_val
6.3k  * Ny kostpris
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di3kop)
6.3k c                   exsr      xml_line_val
6.3k  * Endring
6.3k c                   eval      d_type='Numeric'
6.3k c                   eval      d_valu=%char(di3end)
6.3k c                   exsr      xml_line_val
6.37  *
6.37  /Free
6.37
6.37       // Skriv avslutning
6.37
6.37           WrtSection('DetailLineEnd');
6.37
6.37  /End-free
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML integrasjon - Linjer                         *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_line_val  begsr
6.37  *
6.37  /Free
6.37
6.37       // Skriv linevalue
6.37           UpdHTMLVar('type':         %trim(d_type));
6.37           UpdHTMLVar('Linevalue':    %trim(d_valu));
6.37           WrtSection('DetailLineValue');
6.37
6.37  /End-free
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML integrasjon - Slutt                          *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_end       begsr
6.37  *
6.37  /Free
6.37           WrtSection('EndExcelLines');
6.37  /End-free
6.37  *
6.37  * Hvis denne ikke skal arkiveres, lages ikke archive tagg.
6.37  *
6.37 c                   if        l_arch = 1
6.37  * Lag tag for vising i arkivklienten
6.37 c                   eval      w_dspl = *blank
6.37 c                   eval      w_dspl = 'Oppdatering av pris og vareinfor+
6.37 c                                      masjon'
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     w_dspl        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_dspl
6.37  /Free
6.37       // Skriv metattags
6.37
6.37           UpdHTMLVar('Displaytag':     %trim(w_dspl));
6.37           WrtSection('ArchiveCommandStart');
6.37
6.37           UpdHTMLVar('Metavalue':                ' ');
6.37           UpdHTMLVar('Metakey':              'EXCEL');
6.37           WrtSection('MetaTag');
6.37
6.37           UpdHTMLVar('Metavalue':             l_user);
6.37           UpdHTMLVar('Metakey':             'BRUKER');
6.37           WrtSection('MetaTag');
6.37
6.37           UpdHTMLVar('Metavalue': %char(w_date:*iso));
6.37           UpdHTMLVar('Metakey':               'DATO');
6.37           WrtSection('MetaTag');
6.37
6.37           UpdHTMLVar('Metavalue':             w_txt1);
6.37           UpdHTMLVar('Metakey':         'RUTINETEKST');
6.37           WrtSection('MetaTag');
6.37
6.37           WrtSection('ArchiveCommandEnd');
6.37  /End-free
6.37  *
6.37 c                   endif
6.37  *
6.37  /Free
6.37           WrtSection('Footer');
6.37  /End-free
6.37  *
6.37 c                   eval      XML_Output = XML_path + l_filg +'/'+
6.37 c                             'JV626_'+ %trim(w_jkey) + '.xml'
6.37  *
6.37 c                   callp     WrtHtmlToStmf(XML_Output: 819)
6.3a  * Skriver til datakø for å aktivere sniffer, hvis dataq er aktiv
6.3a c                   if        d_dtaq = '1'
6.3a c                   eval      p_xmlf = xml_output
6.3a c                   eval      p_filg = 'ADB'+l_filg
6.3a c                   call      'AP629C'
6.3a c                   parm                    p_filg
6.3a c                   parm                    p_xmlf
6.3a c                   endif
6.37  *
6.37 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_parm
      *
      * Key for les på vare
      *
     c     jvarl5_key    klist
     c                   kfld                    jvarl5_ldor
      *
      * Key for oppslag på vare
      *
     c     jvarl1_key    klist
     c                   kfld                    jvarl1_vare
      *
      * Key for opplag på EVR-vare
      *
     c     vvarl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl1_vare
      *
      * Key for oppslag på vare-detalj
      *
     c     jvdtl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jvdtl1_dvar
      *
      * Key for oppslag på vare-pakning
      *
     c     jvpkl2_key    klist
     c                   kfld                    jvpkl2_vare
6.30 c                   kfld                    jvpkl2_ldor
     c                   kfld                    jvpkl2_enhe
      *
      * Key for oppslag på vare-pakning vare
      *
     c     jvpkl2_key2   klist
     c                   kfld                    jvpkl2_vare
6.30 c                   kfld                    jvpkl2_ldor
6.14  *
6.14  * Key for les på vare-pakning-prisgiver
6.14  *
6.14 c*    jvppl1_key    klist
6.14 c*                  kfld                    jvppl1_pvar
6.18 c*                  kfld                    jvppl1_ppak
6.16  *
6.16  * Key for les på vare-pakning-prisgiver
6.16  *
6.16 c*    jvpplr_key    klist
6.16 c*                  kfld                    jvpplr_pvar
6.16 c*                  kfld                    jvpplr_ppak
6.16 c*                  kfld                    jvpplr_pldo
6.33  *
6.33  * Key for oppslag på vare-pris
6.33  *
6.33 c     jvprl1_key    klist
6.33 c                   kfld                    jvprl1_vare
6.33 c                   kfld                    jvprl1_ldor
      *
      * Key for oppdatering av EVR-vare
      *
     c     vvarlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarlu_vare
      *
      * Key for oppdatering av EVR-vare-pris
      *
     c     vvprlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvprlu_vare
6.21 c                   kfld                    vvprlu_ldor
5.70 c                   kfld                    vvprlu_prgr
     c                   kfld                    vvprlu_enhe
     c                   kfld                    vvprlu_lety
     c                   kfld                    vvprlu_pdat
      *
     c     vvprlu_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    vvprlu_vare
6.21 c                   kfld                    vvprlu_ldor
5.70 c                   kfld                    vvprlu_prgr
     c                   kfld                    vvprlu_enhe
     c                   kfld                    vvprlu_lety
      *
     c     vvprlu_key3   klist
     c                   kfld                    w_firm
     c                   kfld                    vvprlu_vare
6.23  *
6.23 c     vvprlu_key4   klist
6.23 c                   kfld                    w_firm
6.23 c                   kfld                    vvprlu_vare
6.23 c                   kfld                    vvprlu_ldor
      *
      * Key for les på EVR-vare-enhet
      *
     c     vvenl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvenl1_vare
6.14  *
6.14  * Key for les på EVR-vare-enhet-prisgiver
6.14  *
6.14 c     vvepl1_key    klist
6.14 c                   kfld                    w_firm
6.14 c                   kfld                    vvepl1_pvar
6.14  *
6.14  * Key for les på EVR-vare-enhet-prisgiver pr. gtin nr
6.14  *
6.14 c     vvepl2_key    klist
6.14 c                   kfld                    w_firm
6.14 c                   kfld                    vvepl2_pgti
      *
      * Key for oppdatering av EVR-vare-enhet
      *
     c     vvenlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvenlu_vare
     c                   kfld                    vvenlu_enhe
6.14  *
6.14  * Key for oppdatering av EVR-vare-enhet-prisgiver
6.14  *
6.14 c     vveplu_key    klist
6.14 c                   kfld                    w_firm
6.14 c                   kfld                    vveplu_pvar
6.14 c                   kfld                    vveplu_penh
6.14 c                   kfld                    vveplu_pldo
6.14  *
6.14  * Key for slett av EVR-vare-enhet-prisgiver
6.14  *
6.14 c     vveplu_key2   klist
6.14 c                   kfld                    w_firm
6.14 c                   kfld                    vveplu_pvar
6.14 c                   kfld                    vveplu_penh
6.14  *
6.14  * Key for slett  på EAN
6.14  *
6.14 c     veanlu_key    klist
6.14 c                   kfld                    w_firm
6.14 c                   kfld                    veanlu_eann
      *
      * Key for oppdatering av vare-detalj
      *
     c     jvdtlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jvdtlu_dvar
      *
      * Key for oppdatering av midlertidig pris
      *
     c     jwprlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jwprlu_vare
      *
      * Key for oppslag på firma
      *
     c     afirl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på leverandør
      *
     c     jlevl1_key    klist
     c                   kfld                    jlevl1_ldor
      *
      * Key for oppslag på overgruppe
      *
     c     vogrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vogrl1_oogr
      *
      * Key for oppslag på hovedgruppe
      *
     c     vhgrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vhgrl1_hogr
     c                   kfld                    vhgrl1_hhgr
      *
      * Key for oppslag på undergruppe
      *
     c     vugrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vugrl1_uogr
     c                   kfld                    vugrl1_uhgr
     c                   kfld                    vugrl1_uugr
      *
      * Key for les på leveringstype
      *
     c     vltpl1_key    klist
     c                   kfld                    w_firm
5.70  *
5.70  * Key for les på prisgruppe
5.70  *
5.70 c     ra30l1_key    klist
5.70 c                   kfld                    w_firm
6.12  *
6.12  * Key for oppslag på sortimentskode
6.12  *
6.12 c     jsorl1_key    klist
6.12 c                   kfld                    jsorl1_osor
6.23  *
6.23  * Key for oppdatering av leveranør på lagerregister
6.23  *
6.23 c     vlaglu_key    klist
6.23 c                   kfld                    w_firm
6.23 c                   kfld                    vlaglu_vare
6.37  *
6.37  * Key for rutineregisteret
6.37  *
6.37 c     aforl1_key    klist
6.37 c                   kfld                    aforl1_ruti
6.3j  *
6.3j  * Key for les på vare-leverandør
6.3j  *
6.3j c     jvlelr_key    klist
6.3j c                   kfld                    jvlelr_lvnr
6.3j c                   kfld                    jvlelr_lldo
6.3q  * Key for oppdatering av vare-leverandør i EVR
6.3q  *
6.3q c     vvlelu_key    klist
6.3q c                   kfld                    w_firm
6.3q c                   kfld                    vvlelu_lvnr
6.3q c                   kfld                    vvlelu_lldo
6.3q  *
6.3q  * Key for les av logistikkvare
6.3q  *
6.3q c     jvkhl1_key    klist
6.3q c                   kfld                    w_firm
6.3q c                   kfld                    jvkhl1_kvnr
6.3x  *
6.3x  * Key for les på vare-pris
6.3x  *
6.3x c     vvprl1_key    klist
6.3x c                   kfld                    w_firm
6.3x c                   kfld                    vvprl1_vare
6.3x c                   kfld                    vvprl1_ldor
6.3x c                   kfld                    vvprl1_prgr
6.3x c                   kfld                    vvprl1_enhe
6.3x c                   kfld                    vvprl1_lety
6.3x  *
      * Splitter datastruktur i enkelt-parametre
      *
     c                   eval      d_list = p_parm
     c                   eval      p_firm = d_firm
     c                   eval      p_otyp = d_otyp
6.3h c                   eval      p_edat = d_edat
6.3h c                   eval      p_pdat = d_pdat
     c                   eval      p_ldor = d_ldor
     c                   eval      p_ogrp = d_ogrp
     c                   eval      p_hgrp = d_hgrp
     c                   eval      p_ugrp = d_ugrp
     c                   eval      p_pgiv = d_pgiv
     c                   eval      p_sams = d_sams
     c                   eval      p_utgd = d_utgd
     c                   eval      p_inio = d_inio
     c                   eval      p_koio = d_koio
     c                   eval      p_saio = d_saio
     c                   eval      p_kntr = d_kntr
6.15 c                   eval      p_vare = d_vare
6.21 c                   eval      p_flpr = d_flpr
      *
     c                   eval      w_firm = p_firm
6.39 c*                  eval      w_lage = l_lage
      *
6.3h c                   eval      w_pdat = d_pdat
6.3h c                   eval      w_edat = d_edat
6.36 c                   eval      w_utgp = d_utgp
6.24a *
6.24a * hvis bytte av hovedlev., så vil det hentes %vis endring fra h.lev.
6.24a *
6.24ac                   eval      w_hlev = 0
6.24ac                   if        p_sams = 0 and
6.24ac                             p_flpr = 0
6.24ac                   eval      w_hlev = 1
6.24ac                   endif
      *
      * Henter dagens dato og klokkelslett
      *
     c                   time                    w_udat
     c                   time                    w_utim
6.37  * Sjekk om vi skal bruke XML generering av dokumenter
6.37  * NB KUN hvis EXCEL rapport. Hvis ikke skal det dannes PDF av spoolfile
6.37  *
6.37 c                   if        l_poff = '1' and
6.37 c                             l_exlp = 1
6.37 c                   eval      b_excl = *off
6.37 c                   eval      w_pdf = 0
6.37 c                   eval      w_pdf_ds = *blanks
6.37 c                   eval      w_ruti = l_ruti
6.37  *
6.37 c                   call      'AP609R'
6.37 c                   parm                    w_ruti
6.37 c                   parm                    w_pdf
6.37 c                   parm                    w_pdf_ds
6.37 c                   eval      d_pdf_ds = w_pdf_ds
6.37  * PROA er aktivert
6.37 c                   if        w_pdf = 1 and
6.37 c                             %trim(d_xmlm) <> *blanks
6.37 c                   eval      w_jkey = l_bach
6.37  *
6.37  * Hent inn xml templaten
6.37  *
6.37 c                   callp     GetHTMLIFS(d_xmlm :'<AS400>')
6.3e c                   callp     ClrHtmlBuffer
6.37  *
6.37  * Finn hvor xml'en skal legges
6.37  *
6.37 c                   eval      XML_path = *blanks
6.37 c                   eval      XML_path = %trim(d_path)
6.37  *
6.37  * Jobbnummer er allerede generert i AP600R. Overføres i *lda
6.37  *
6.37 c                   time                    w_date
6.37 c                   time                    w_dato2
6.37 c                   movel     w_dato2       w_tids
6.37 c                   move      w_dato2       w_ddmy
6.37  * Vi logger at utskriftprogrammet har startet
6.37 c                   eval      w_jstat = 10
6.37 c                   eval      w_jtext = 'Excel - oppdatering av pris +
6.37 c                                        og vareinformasjon har startet'
6.37 c                   call      'AB705R'
6.37 c                   parm                    l_bach
6.37 c                   parm                    w_jstat
6.37 c                   parm                    w_jtext
6.37  * Vi skriver xml for miljø formater
6.37 c                   exsr      xml_envm
6.37 c                   exsr      xml_head
6.37 c                   eval      b_excl = *on
6.37 c                   else
6.37  * Vi logger at noe er galt med parametrene
6.37 c                   eval      w_jstat = 20
6.37 c                   eval      w_jtext = 'Finner ikke path til xml !!! +
6.37 c                             Sjekk rutineregister !'
6.37 c                   call      'AB705R'
6.37 c                   parm                    l_bach
6.37 c                   parm                    w_jstat
6.37 c                   parm                    w_jtext
6.37 c                   endif
6.37  *
6.37  *  Hent inn firma/avd. opplysninger dersom
6.37  *  kode for det er satt i rutineregister
6.37  *
6.37 c                   if        l_prfi = 1 or
6.37 c                             l_prfi = 2
6.37 c                   eval      w_prfi = l_prfi
6.37 c                   eval      w_ffir = w_firm
6.37 c                   eval      w_avde = l_avde
6.37  *
6.37 c                   call      'FÅ707R'
6.37 c                   parm                    w_prfi
6.37 c                   parm                    w_ffir
6.37 c                   parm                    w_avde
6.37 c                   parm                    w_fnav
6.37 c                   parm                    w_fad1
6.37 c                   parm                    w_fad2
6.37 c                   parm                    w_fste
6.37 c                   parm                    w_fftx
6.37 c                   parm                    w_tfax
6.37 c                   parm                    w_ftlf
6.37 c                   parm                    w_ffax
6.3b c                   parm                    w_mail
6.3b c                   parm                    w_weba
6.37 c                   endif
6.37  *
6.37 c                   else
6.37 c                   eval      b_excl = *off
6.37 c                   endif
6.37  *
6.37 c                   if        b_excl = *off
6.37 c                   open      jv626p
6.37 c                   endif
      *
     c                   endsr
