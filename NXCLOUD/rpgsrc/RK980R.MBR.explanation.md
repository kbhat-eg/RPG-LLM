# RPG Program Explanation: Notatblokk - Renumbering

This ILE RPG program performs "renumbering" of note blocks from an input file to an output file, possibly for bookkeeping or ERP purposes. Here’s a breakdown of its major components and logic:

---

## **1. Program Metadata (Header)**
- **/TITLE**: Sets the title for the listing ("Notatblokk - renummerering" = "Notebook - renumbering").
- **h datedit(*dmy) option(*nodebugio)**: Specifies date format (day/month/year) and disables debugging for I/O operations.
- **Comments Block**: Describes program name (RK980R), system, description, and a version/change history (with initials of authors/editors).

---

## **2. File Declarations**

### **Input File**
```rpg
frklwlu    if   e           k disk    rename(rklwpfr:rklwlur)
f                                     prefix(w:1)
```
- Input file: `rklwlu`, externally described, keyed, disk file.
- Renames record format `rklwpfr` to `rklwlur`.
- All field names from this file will get prefix `w` (e.g., `wxsyst`).

### **Output File**
```rpg
frklalu    uf a e           k disk    rename(rklapfr:rklalur)
```
- Output/update file: `rklalu`, add, externally described, keyed, disk file.
- Renames record format `rklapfr` to `rklalur`.

---

## **3. Data Area / Field Definitions**
```rpg
d l_wsid                901    910                                         Bruker
d l_user                911    920                                         Bruker
d l_firm                944    946  0                                      Firma
d l_fnav                951    980                                         Navn
```
- `l_*` variables map to user/session/company information (probably set from a user data area).

```rpg
d w_nylin         s                   like(rxlinj)
d w_systs         s                   like(rxsyst)
d w_konts         s                   like(rxkont)
```
- Work variables for the new line number, and last seen code/account.

---

## **4. Main Logic**

### **Read and Process Input File**
```rpg
E5.40c                   read      rklwlu
c                   dou       %eof
c                   exsr      renumm
E5.40c                   read      rklwlu
c                   enddo
```
- Reads records from the input file (`rklwlu`) in a loop until end-of-file.
- For each record, executes the subroutine `renumm`.

### **Program End**
```rpg
c     slutt         tag
c                   eval      *inlr = *on
```
- Sets last-record indicator on (`*inlr = *on`) to close files and end program.

---

## **5. SUBROUTINE: `renumm` ("renumber")**

### **Purpose**
- Renumbers the line numbers in the notes, starting over for each change in code or account, and writes updated records to the output file.

### **Logic**
```rpg
c     renumm        begsr
* Brudd på kode/konto? (Break on code/account?)
c                   if        wxsyst <> w_systs or
c                             wxkont <> w_konts
c                   eval      w_nylin = *zeros      // Reset numbering
c                   endif
c                   eval      w_nylin = w_nylin + 10   // Increment by 10
c                   eval      w_systs  = wxsyst        // Save current values
c                   eval      w_konts  = wxkont
```
- If the system code (`wxsyst`) or account (`wxkont`) change, reset line number (`w_nylin`).
- Otherwise, increment line number by 10.
- Store the current system code/account for next iteration.

```rpg
c                   eval      rxfirm  = wxfirm
c                   eval      rxsyst  = wxsyst
c                   eval      rxpros  = wxpros
c                   eval      rxakti  = wxakti
c                   eval      rxkont  = wxkont
c                   eval      rxspes  = wxspes
c                   eval      rxavde  = wxavde
c                   eval      rxlinj  = w_nylin
c                   eval      rxtgrp  = wxtgrp
c                   eval      rxtext  = wxtext
```
- Transfers values (company, code, project, etc.) from input fields (`wx*`) to output record fields (`rx*`).
- Sets the new line number (`rxlinj`) to the current value of `w_nylin`.

#### **Tracking Fields (Audit/Traceability)**
```rpg
T5.40c                   eval      rxtist  = wxtist
6.10 c                   time                    rxodat
6.10 c                   time                    rxotim
6.10 c                   eval      rxousr = l_user
6.10 c                   time                    rxedat
6.10 c                   time                    rxetim
6.10 c                   eval      rxeusr = l_user
```
- Sets audit fields: creation and edit date/time, user name, etc.

```rpg
c                   write     rklalur
c                   endsr
```
- Writes the newly constructed output record to the output file.

---

## **6. Subroutine: *Inzsr (Initialization)**
```rpg
c     *inzsr        begsr
c                   endsr
```
- This is a placeholder for program initialization. Currently does nothing.

---

# **Summary**

- The program reads "notebook" records from an input file.
- As it processes each record, it assigns new line numbers that increment by 10 for each note line.
- If either the coded system or account changes, line numbering restarts at 0.
- All relevant fields are copied over to a new output file, along with updated audit (tracking) fields.
- Used in contexts where notes or records need to be renumbered sequentially by group (system/account).

**This is a typical data conversion or restructuring utility, commonly used during system migrations, upgrades, or for data integrity purposes in IBM i environments.**