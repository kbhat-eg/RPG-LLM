     h option(*nodebugio : *srcstmt) datedit(*dmy)

      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOFAK
      * Program . . . . : VV823R
      * Beskrivelse . . : Oppdater fra SOLVE modul
      *
      *                   Oppdaterer modul   SOLVE  (XML-format)
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       290519 BKV
8.01  *       020622 bof Skal ikke endre vvldor, men vvnlev og test på modul = 0
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fnlmopf    uf   e           k disk
     fjmodlu    uf a e           k disk    rename(jmodpfr:jmodlur)
     fjmstlu    uf a e           k disk    rename(jmstpfr:jmstlur)
     fjmsdlu    uf a e           k disk    rename(jmsdpfr:jmsdlur)
     fjmtxlu    uf a e           k disk    rename(jmtxpfr:jmtxlur)
     fvvarlb    uf a e           k disk    rename(vvarpfr:vvarlbr)
     fjstsl1    if   e           k disk    rename(jstspfr:jstsl1r)
      *
      * Definering av variable i nøkler
      *
     d jmodlu_modn     s                   like(jumodn)
     d jmstlu_smod     s                   like(jusmod)
     d jmsdlu_umod     s                   like(juumod)
     d jmtxlu_tmod     s                   like(jutmod)
     d vvarlb_nmod     s                   like(vvnmod)
      *
      * Brukes som parametre til jobblogging
     d p_jbid          s             41
     d p_jsts          s              2  0
     d p_jmld          s            200
      *
      * Definering av Local Data Area
      *
     d                uds
     d l_user                911    920
     d l_firm                944    946  0
      *
     d w_firm          s              3  0
      *
      * Definering av parametre
      *
     D p_filNavn       s            255a
     D p_lengde        s              3p 0
     d p_sistDato      s             10a
     d p_stat          s              1
      *
      *  Dataelementer modul
      *
      * Definering av variable
      *
     d w_modn          s              8
     d w_mte1          s             35
     d w_mte2          s             35
     d w_merk          s             30
     d w_ldor          s              6
     d w_prod          s              6
     d w_vgrp          s              7
     d w_ord1          s             35
     d w_ord2          s             35
     d w_ord3          s             35
     d w_ord4          s             35
     d w_ord5          s             35
     d w_ord6          s             35
     d w_ord7          s             35
     d w_ord8          s             35
     d w_ord9          s             35
     d w_ord10         s             35
     d w_ord11         s             35
     d w_ord12         s             35
     d w_ord13         s             35
     d w_ord14         s             35
     d w_ord15         s             35
     d w_ord16         s             35
     d w_ord17         s             35
     d w_ord18         s             35
     d w_ord19         s             35
     d w_ord20         s             35
     d w_ord21         s             35
     d w_ord22         s             35
     d w_ord23         s             35
     d w_ord24         s             35
     d w_ord25         s             35
     d w_ord26         s             35
     d w_ord27         s             35
     d w_ord28         s             35
     d w_ord29         s             35
     d w_ord30         s             35
     d w_ord31         s             35
     d w_ord32         s             35
     d w_ord33         s             35
     d w_ord34         s             35
     d w_ord35         s             35
     d w_ord36         s             35
     d w_ord37         s             35
     d w_ord38         s             35
     d w_ord39         s             35
     d w_ord40         s             35
     d w_ord41         s             35
     d w_ord42         s             35
     d w_ord43         s             35
     d w_ord44         s             35
     d w_ord45         s             35
     d w_ord46         s             35
     d w_ord47         s             35
     d w_ord48         s             35
     d w_ord49         s             35
     d w_ord50         s             35
      *
     d w_tel           s              2  0
      *
      *  Dataelementer stikkord
      *
     d                 ds
     d d_skrc                        40
     d  d_sord                       35    overlay(d_skrc:1)
     d                 ds
     d w_skrc                        40    Dim(50)
     d  w_sord                       35    overlay(w_skrc:1)
      *
      * Definering av konstanter
      *
     d c_digi          s             10    inz('0123456789')
      *
     D   navnet        s            100a   varying
6.33 D   len           s              3i 0
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
       len = p_lengde;
       navnet = %trim(%subst(p_filNavn:1:len));

       // setter navn på XML fil
       exec sql SET MODUL_SOLVE_XML_V = :navnet;

       // bruk view til å lese XML fil
       exec sql
         declare c1 cursor for
            select
                NOBBMODULNR
                ,DELTAKERNR
                ,VAREGRUPPENR
                ,MERKENAVN
                ,MODULTEKST1
                ,MODULTEKST2
                ,STIKKORD1
                ,STIKKORD2
                ,STIKKORD3
                ,STIKKORD4
                ,STIKKORD5
                ,STIKKORD6
                ,STIKKORD7
                ,STIKKORD8
                ,STIKKORD9
                ,STIKKORD10
                ,STIKKORD11
                ,STIKKORD12
                ,STIKKORD13
                ,STIKKORD14
                ,STIKKORD15
                ,STIKKORD16
                ,STIKKORD17
                ,STIKKORD18
                ,STIKKORD19
                ,STIKKORD20
                ,STIKKORD21
                ,STIKKORD22
                ,STIKKORD23
                ,STIKKORD24
                ,STIKKORD25
                ,STIKKORD26
                ,STIKKORD27
                ,STIKKORD28
                ,STIKKORD29
                ,STIKKORD30
                ,STIKKORD31
                ,STIKKORD32
                ,STIKKORD33
                ,STIKKORD34
                ,STIKKORD35
                ,STIKKORD36
                ,STIKKORD37
                ,STIKKORD38
                ,STIKKORD39
                ,STIKKORD40
                ,STIKKORD41
                ,STIKKORD42
                ,STIKKORD43
                ,STIKKORD44
                ,STIKKORD45
                ,STIKKORD46
                ,STIKKORD47
                ,STIKKORD48
                ,STIKKORD49
                ,STIKKORD50
             from MODUL_XML_SOLVE_VIEW
                for read only;

       exec sql
         Open c1;

       doW (1 = 1);

         w_skrc = *blanks;
         exec sql
           Fetch c1 INTO :w_modn, :w_ldor, :w_vgrp, :w_merk, :w_mte1, :w_mte2,
             :w_ord1 ,:w_ord2 ,:w_ord3 ,:w_ord4 ,:w_ord5 ,:w_ord6 ,
             :w_ord7 ,:w_ord8 ,:w_ord9 ,:w_ord10,:w_ord11,:w_ord12,
             :w_ord13,:w_ord14,:w_ord15,:w_ord16,:w_ord17,:w_ord18,
             :w_ord19,:w_ord20,:w_ord21,:w_ord22,:w_ord23,:w_ord24,
             :w_ord25,:w_ord26,:w_ord27,:w_ord28,:w_ord29,:w_ord30,
             :w_ord31,:w_ord32,:w_ord33,:w_ord34,:w_ord35,:w_ord36,
             :w_ord37,:w_ord38,:w_ord39,:w_ord40,:w_ord41,:w_ord42,
             :w_ord43,:w_ord44,:w_ord45,:w_ord46,:w_ord47,:w_ord48,
             :w_ord49,:w_ord50
             ;

         if ((SQLCode < 0) or (SQLCode = 100));
           leave;
         endif;

         exsr skr_modul;

       enddo;

       exec sql close c1;

       p_sistDato = %char(%date(): *iso);  // OK

      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     c     avslutt       tag

     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Oppdaterer modul
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     skr_modul     begsr
      *
8.01 c                   if        %TRIM(w_modn) = '' or
8.01 c                             w_modn = '00000000'
     c                   leavesr
     c                   endif
      *
     c                   clear                   jmodlur
      *
     c                   eval      jmodlu_modn = %dec(%trim(w_modn):8:0)
     c     jmodlu_key    chain     jmodlur
     c                   eval      jumte1 = w_mte1
     c                   eval      jumte2 = w_mte2
     c                   eval      jumerk = w_merk
     c*                   eval      jumint = d_imnr
         if w_ldor<> *blank and %check(c_digi : %trim(w_ldor)) = 0;
           juldor = %dec(%trim(w_ldor):6:0);
         endif;
         if w_prod<> *blank and %check(c_digi : %trim(w_prod)) = 0;
           juprod = %dec(%trim(w_prod):6:0);
         endif;
         if %check(c_digi : %trim(w_vgrp)) = 0;
           juogrp = %dec(%subst(w_vgrp:1:2):2:0);
           juhgrp = %dec(%subst(w_vgrp:3:2):2:0);
           juugrp = %dec(%subst(w_vgrp:5:3):3:0);
         endif;
     c*                   eval      junoda = d_crea_iso
     c*                   eval      juneda = d_upda_iso
     c*                   eval      junsda = d_dele_iso
     c                   eval      jueusr = l_user
      *
     c                   time                    juedat
     c                   time                    juetim
      *
     c                   if        %found(jmodlu)
     c                   update    jmodlur
     c                   else
     c                   eval      jumodn = %dec(%trim(w_modn):8:0)
     c                   time                    juodat
     c                   time                    junoda
     c                   time                    juneda
     c*                   eval      w_jmod = w_jmod + 1
     c                   write     jmodlur
     c                   endif
      *
      * Oppdaterer alle varer med endret modulinformasjon
      *
     c                   eval      vvarlb_nmod = %dec(%trim(w_modn):8:0)
     c     vvarlb_key    setll     vvarlb
     c     vvarlb_key    reade     vvarlbr
     c                   dow       not %eof
      *
8.01 c                   if        vvnlev <> juldor or
     c                             vvogrp <> juogrp or
     c                             vvhgrp <> juhgrp or
     c                             vvugrp <> juugrp
8.01 c                   eval      vvnlev = juldor
     c                   eval      vvogrp = juogrp
     c                   eval      vvhgrp = juhgrp
     c                   eval      vvugrp = juugrp
     c                   eval      vveusr = l_user
     c                   time                    vvedat
     c                   time                    vvetim
     c                   update    vvarlbr
     c                   else
     c                   unlock    vvarlb
     c                   endif
      *
     c     vvarlb_key    reade     vvarlbr
     c                   enddo
      *
     c                   exsr      beh_stikkord
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av stikkord-informasjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     beh_stikkord  begsr
      *
       jmstlu_smod = %dec(%trim(w_modn):8:0);
       setll jmstlu_key jmstlu;
       reade jmstlu_key jmstlur;
       dow not %eof;
         delete jmstlur;
         reade jmstlu_key jmstlur;
       enddo;

       for w_tel = 1 to 50;
         d_sord = *blank;
         if w_tel = 1  and w_ord1  <> *blank;
           d_sord = w_ord1 ;
         endif;
         if w_tel = 2  and w_ord2  <> *blank;
           d_sord = w_ord2 ;
         endif;
         if w_tel = 3  and w_ord3  <> *blank;
           d_sord = w_ord3 ;
         endif;
         if w_tel = 4  and w_ord4  <> *blank;
           d_sord = w_ord4 ;
         endif;
         if w_tel = 5  and w_ord5  <> *blank;
           d_sord = w_ord5 ;
         endif;
         if w_tel = 6  and w_ord6  <> *blank;
           d_sord = w_ord6 ;
         endif;
         if w_tel = 7  and w_ord7  <> *blank;
           d_sord = w_ord7 ;
         endif;
         if w_tel = 8  and w_ord8  <> *blank;
           d_sord = w_ord8 ;
         endif;
         if w_tel = 9  and w_ord9  <> *blank;
           d_sord = w_ord9 ;
         endif;
         if w_tel = 10 and w_ord10 <> *blank;
           d_sord = w_ord10;
         endif;
         if w_tel = 11 and w_ord11 <> *blank;
           d_sord = w_ord11;
         endif;
         if w_tel = 12 and w_ord12 <> *blank;
           d_sord = w_ord12;
         endif;
         if w_tel = 13 and w_ord13 <> *blank;
           d_sord = w_ord13;
         endif;
         if w_tel = 14 and w_ord14 <> *blank;
           d_sord = w_ord14;
         endif;
         if w_tel = 15 and w_ord15 <> *blank;
           d_sord = w_ord15;
         endif;
         if w_tel = 16 and w_ord16 <> *blank;
           d_sord = w_ord16;
         endif;
         if w_tel = 17 and w_ord17 <> *blank;
           d_sord = w_ord17;
         endif;
         if w_tel = 18 and w_ord18 <> *blank;
           d_sord = w_ord18;
         endif;
         if w_tel = 19 and w_ord19 <> *blank;
           d_sord = w_ord19;
         endif;
         if w_tel = 20 and w_ord20 <> *blank;
           d_sord = w_ord20;
         endif;
         if w_tel = 21 and w_ord21 <> *blank;
           d_sord = w_ord21;
         endif;
         if w_tel = 22 and w_ord22 <> *blank;
           d_sord = w_ord22;
         endif;
         if w_tel = 23 and w_ord23 <> *blank;
           d_sord = w_ord23;
         endif;
         if w_tel = 24 and w_ord24 <> *blank;
           d_sord = w_ord24;
         endif;
         if w_tel = 25 and w_ord25 <> *blank;
           d_sord = w_ord25;
         endif;
         if w_tel = 26 and w_ord26 <> *blank;
           d_sord = w_ord26;
         endif;
         if w_tel = 27 and w_ord27 <> *blank;
           d_sord = w_ord27;
         endif;
         if w_tel = 28 and w_ord28 <> *blank;
           d_sord = w_ord28;
         endif;
         if w_tel = 29 and w_ord29 <> *blank;
           d_sord = w_ord29;
         endif;
         if w_tel = 30 and w_ord30 <> *blank;
           d_sord = w_ord30;
         endif;
         if w_tel = 31 and w_ord31 <> *blank;
           d_sord = w_ord31;
         endif;
         if w_tel = 32 and w_ord32 <> *blank;
           d_sord = w_ord32;
         endif;
         if w_tel = 33 and w_ord33 <> *blank;
           d_sord = w_ord33;
         endif;
         if w_tel = 34 and w_ord34 <> *blank;
           d_sord = w_ord34;
         endif;
         if w_tel = 35 and w_ord35 <> *blank;
           d_sord = w_ord35;
         endif;
         if w_tel = 36 and w_ord36 <> *blank;
           d_sord = w_ord36;
         endif;
         if w_tel = 37 and w_ord37 <> *blank;
           d_sord = w_ord37;
         endif;
         if w_tel = 38 and w_ord38 <> *blank;
           d_sord = w_ord38;
         endif;
         if w_tel = 39 and w_ord39 <> *blank;
           d_sord = w_ord39;
         endif;
         if w_tel = 40 and w_ord40 <> *blank;
           d_sord = w_ord40;
         endif;
         if w_tel = 41 and w_ord41 <> *blank;
           d_sord = w_ord41;
         endif;
         if w_tel = 42 and w_ord42 <> *blank;
           d_sord = w_ord42;
         endif;
         if w_tel = 43 and w_ord43 <> *blank;
           d_sord = w_ord43;
         endif;
         if w_tel = 44 and w_ord44 <> *blank;
           d_sord = w_ord44;
         endif;
         if w_tel = 45 and w_ord45 <> *blank;
           d_sord = w_ord45;
         endif;
         if w_tel = 46 and w_ord46 <> *blank;
           d_sord = w_ord46;
         endif;
         if w_tel = 47 and w_ord47 <> *blank;
           d_sord = w_ord47;
         endif;
         if w_tel = 48 and w_ord48 <> *blank;
           d_sord = w_ord48;
         endif;
         if w_tel = 49 and w_ord49 <> *blank;
           d_sord = w_ord49;
         endif;
         if w_tel = 50 and w_ord50 <> *blank;
           d_sord = w_ord50;
         endif;

         if d_sord <> *blank;
           exsr oppd_stikkord;
         else;
           leavesr;
         endif;
       endfor;
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Oppdaterer modulstikkord
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppd_stikkord begsr
      *
       clear jmstlur;
       jusmod = %dec(%trim(w_modn):8:0);
       jusord = d_sord;
       jusnod = *loval;
       jusned = *loval;
       jusnsd = *loval;
       juseus = l_user;
     c                   time                    jusoda
     c                   time                    juseda
     c                   time                    juseti
     c                   write     jmstlur
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_filNavn
     c                   parm                    p_lengde
     c                   parm                    p_sistDato
     c                   parm                    p_stat
      *
      * Key for oppdatering av modul
      *
     c     jmodlu_key    klist
     c                   kfld                    jmodlu_modn
      *
      * Key for oppdatering av modul-stikkord
      *
     c     jmstlu_key    klist
     c                   kfld                    jmstlu_smod
      *
      * Key for oppdatering av modul-standard
      *
     c     jmsdlu_key    klist
     c                   kfld                    jmsdlu_umod
      *
      * Key for oppdatering av modul-tekst
      *
     c     jmtxlu_key    klist
     c                   kfld                    jmtxlu_tmod
      *
      * Key for les på vare med modulnr
      *
     c     vvarlb_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarlb_nmod
      *
      * Key for oppslag på status
      *
     c     jstsl1_key    klist
     c                   kfld                    w_firm
      *
      *
      * Henter firma fra parameter
      *
     c                   eval      w_firm = l_firm
      *
     c     jstsl1_key    chain     jstsl1
      *
     c                   endsr
