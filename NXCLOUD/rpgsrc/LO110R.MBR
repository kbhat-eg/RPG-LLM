     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      *  System. . . . . : ASLAGR                                       *
      *  Program . . . . : LO110R                                       *
      *  Beskrivelse . . : Registrering av bestilling/innkjøp           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      *  Spesialversjon. :                                              *
      *  Tilpasset for . :                                              *
      *                                                                 *
      *  Referanse  Dato   Endringsbeskrivelse                     Sign.*
      *  --------- ------  ---------------------------------------------*
      *    R2.02   120397  Ved snuing av dato var det ikke tatt hensyn  *
      *                    til 0 i dato. (Dato ble da 20000000)         *
      *    R2.02   200397  Bygget inn opphenting av leveringsadresser   *
      *                    fra det nye leveringsadresse-registeret      *
      *                                                                 *
      *    R2.04   230299  Fjernet spørring mot leveringsadresse-reg.,  *
      *                    har aldri blitt aktivisert.                  *
      *                                                                 *
      *    6.10    180609  Oppdatert med sporingsinformasjon       BSA  *
      *                                                                 *
6.10  * R6.10 250809 BSA  Utvidet ref. felter fra 20 til 30 posisjoner  *
6.11  * R6.10 221010 BSA  Lagt inn søk etter kontaktpersoner.           *
6.12  * 6.10  040810 BSA  Problemer med lengden på alfafelt, levnavn og *
6.12  *                   midlertidig variabel for leverandørnavn.      *
6.13  * 6.10  310311 bof  Utvidet parm. til RL503R                     *
6.20  * 6.20  261110 bof  Ordretype hentes fra lev. hvis denne er spesifisert
6.20  *                   Feltet ligger på lev.distribsjon pr. lager
6.20  * 6.20  161210 bof  Alltid sjekk om leveringsdato er utfylt
6.21  * 6.20  040511 bsa  Setter LDA verdier som brukes i senere sekvens
6.22  * 6.20  300511 bsa  Feil farge på skjermbilde
6.23  * 6.20  310511 bsa  Lagt inn felt for kampanje
6.24  * 6.20  060312 bof  Justert logikk vedr. hente ordretype
6.25  * 6.20  130312 bsa  Frislipper ordre ved retur
6.26  * 6.20  070213 bof  Styring av ordretype
6.27  * 6.20  070213 bof  Fjernet noe av styring ordretype (OT fra fstspf)
6.28  * 6.20  051213 bof  Nullstilt best.felter før bestilling begynner
6.29  * 6.20  301213 bof  Legger validering (AVALPF) på leveringsdato
6.29  * 6.20              Hvis ikke feltet finnes i AVALPF, behand.som før
6.2a  * 6.20  310114 nho  Lagt inn F4 på ordretype
6.2b  * 6.20  110214 bof  Justert 6.28 rett, slik at den returnerer korrekt
6.30  * 6.30  160214 bof  Nå legges denne som en normal AVALPF test. (ref.6.29)
6.31  * 6.30  260214 bof  Viser virkelig leveringsdato i bildet
6.32  * 6.30  110414 bsa  Justert i skjermbilder pga identifisering av
6.32  *                   datofelter i jacada.
6.nu  * 6.30  280514 bof  Endring vedr. nummerutvidelse
6.33  * 6.30  280814 bof  Sjekk om leverandør er pasiv/sperret
6.34  * 6.30  110914 bsa  Skal ikke være mulig å legge inn manuelle
6.34  *                   ordrenummer som er brukt tidligere.
6.35  * 6.30  220914 bsa  Legger ut kontaktpersonnr
6.36  * 6.30  300515 bsa  Prosjeknummer er aølfanumerisk
6.37  * 6.30  050216 bof  Fjernet 6.34 v/sak 67946
6.38  * 6.30  230916 bof  Hvis avd = 0, så hentes avd. fra lager
6.39  * 6.30  231116 bsa  Setter mvakode basert på avgiftstypen på
6.39  *                   leverandøren og landkode.
7.xx  * 7.00  030316 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
7.01  * 7.00  090519 bsa  Ved utfylling av bekreftet leveringsdato,
7.01  *                   oppdateres tilhørende ordre.
7.02  *       090419 bsa  Ta med kode om nyopprettet eller endring til
7.02  *                   vedlikehold av "faste opplysninger".
      *
8.01  * 8.xx  010922 bsa  Ikke endre leveringsdato hvis leveringsdato er satt
8.01  * 8.xx              på ordren, og bekreftet leveringsdato er *loval på
8.01  * 8.xx              bestillingen.
8.05  *K000   310123 bsa  Hvis vi endrer levering/bekreftetlevering  dato, endres
8.05  *K000               linjer med samme dato eller dato ikke satt. NB Hvis
8.05  *K000               loggkode 4 er satt, slutter automatikken.
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     FLO110D    CF   E             WORKSTN
      *
     FAUSRL1    IF   E           K DISK    RENAME(AUSRPFR:AUSRL1R)
     FLUSRL1    IF   E           K DISK    RENAME(LUSRPFR:LUSRL1R)
     Frlevl1    IF   E           K DISK    RENAME(RLEVPFR:rlevl1R)
     Frkunl1    IF   E           K DISK    RENAME(RKUNPFR:rkunl1R)
     FVOTYL1    IF   E           K DISK    RENAME(VOTYPFR:VOTYL1R)
     FLSTSL1    IF   E           K DISK    RENAME(LSTSPFR:LSTSL1R)
     FLOHELU    UF A E           K DISK    RENAME(LOHEPFR:LOHELUR)
     FLOHEL1    IF   E           K DISK    RENAME(LOHEPFR:LOHEL1R)
6.37 f*ohelr    if   e           k disk    rename(lohepfr:lohelrr)
6.37 f*                                    prefix(lx:2)
     ffusrl1    if   e           k disk    rename(fusrpfr:fusrl1r)
6.20 flldil1    if   e           k disk    rename(lldipfr:lldil1r)
6.29 favall1    if   e           k disk    rename(avalpfr:avall1r)
6.38 fra10l1    if   e           k disk    rename(ra10pfr:ra10l1r)
7.01 ffohelu    uf   e           k disk    rename(fohepfr:fohelur)
8.05 fllogl1    if   e           k disk    rename(llogpfr:llogl1r)
8.05 flodtlu    uf   e           k disk    rename(lodtpfr:lodtlur)
      *
      * Datastruktur
      *
     d                 ds
     d d_urec                        80
     d  d_firm                        3  0 overlay(d_urec)
6.nu d  d_numm                        8  0 overlay(d_urec:4)
6.nu d  d_suff                        2  0 overlay(d_urec:12)
6.nu d  d_kode                        1    overlay(d_urec:14)
6.nu d  d_date                         d   overlay(d_urec:15) datfmt(*iso)
6.nu d  d_time                         t   overlay(d_urec:25) timfmt(*iso)
6.nu d  d_user                       10    overlay(d_urec:33)
6.nu d  d_wsid                       10    overlay(d_urec:43)
      *
     D                 DS
     D  LDSPER                 1      1  0
      *
     D                 DS
6.12 D**DSLENA               101    112
6.18 D  DSLENA               101    118
     D  DSLAGE               119    120  0
     D  DSBETB               169    170  0
     D  DSINNK               171    174
     D  DSDIST               175    176  0
     D  DSLMAT               177    178  0
     D  DSLBET               178    180  0
     D  DSVALK               181    183
     D  DSRKAT               184    186  0
     D  DSSPED               187    189  0
     D  DSKJOR               190    191  0
     D  DSMKOD               192    192  0
      *
      *
      *
     D  DSLMTX               282    301
     D  DSLBTX               302    376
     D  DSRABP               497    501  2
      *
      * Definering av variable
      *
     d wwdate          s               d   datfmt(*iso)
     d w_bdat          s               d   datfmt(*iso)
     d wwtime          s               t   timfmt(*iso)
6.2b d w_numm          s                   like(lonumm)
6.2b d w_suff          s                   like(losuff)
     d p_valg          s              2  0
     d p_numm          s                   like(lonumm)
     d p_suff          s                   like(losuff)
     d p_navn          s                   like(rlnavn)
6.11 d w_lref          s             30
6.13 d w_emal          s             50
6.35 d w_kpnr          s                   like(lokpnr)
8.05 d w_ldat          s               d   datfmt(*iso)
      *
6.20 d lldil1_ldor     s                   like(lpldor)
6.20 d lldil1_lage     s                   like(lplage)
6.29 d avall1_apgm     s                   like(avapgm)
6.37 d*lohelr_numm     s                   like(lonumm)
6.37 d*lohelr_suff     s                   like(losuff)
6.38 d ra10l1_jkod     s                   like(rajkod)
7.01 d fohelu_numm     s                   like(fonumm)
7.01 d fohelu_suff     s                   like(fosuff)
8.05 d llogl1_numm     s                   like(lmnumm)
8.05 d llogl1_suff     s                   like(lmsuff)
8.05 d llogl1_kode     s                   like(lmkode)
8.05 d lodtlu_numm     s                   like(ldnumm)
8.05 d lodtlu_suff     s                   like(ldsuff)
8.05 d lodtlu_line     s                   like(ldline)
      *
8.05 d s_ldat          s               d   datfmt(*iso)
      *
6.29  * Firmastyrt validering av felt
6.29  *
6.29 d u_ldat          s              1    inz(*off)
6.30 d*u_spes          s              1    inz(*off)
6.37 d*b_mbes          s              1    inz(*off)
      *
7.00   dcl-s co402_verdi1  char(1);
7.00   dcl-s co402_verdi2  char(2048);
7.00   DCL-PR CO402R EXTPGM('CO402R');
7.00     p_filgrp            char(3)     const;
7.00     p_firm              packed(3:0) const;
7.00     p_lager             packed(2:0) const;
7.00     p_nokkel            char(50)    const;
7.00     p_verdi1            char(1);
7.00     p_verdi2            char(2048);
7.00   END-PR;
7.01 d u_701           s              1    inz(*off)
7.02 d b_nybe          s              1    inz(*off)
      *
      * Konstanter
      *
     d Lo              c                   'abcdefghijklmnopqrstuvwxyzæøåäö'
     d Up              c                   'ABCDEFGHIJKLMNOPQRSTUVWXYZÆØÅÄÖ'
      *
     D/EJECT
      * - - - - - - - - - - - - - - - - - - *
      *   Definisjon av gjenngangere        *
      * - - - - - - - - - - - - - - - - - - *
      *
     D                 DS
     D  DSCBES               100    100  0
     D  DSBIND               101    101
     D  DSOTYP               102    103
     D  DSODAT               104    109  0
     D  DSAORD               110    110  0
     D  DSLDOR               111    116  0
6.10 D  DSVREF               117    146
6.10 D  DSAVDE               147    150  0
      *
      *
     D                UDS
6.21 d l_arch                636    636  0
6.21 d l_skje                637    637  0
6.21 d l_mail                640    640  0
     D  l_wsid               901    910
     D  l_user               911    920
7.00 d l_filg                931    933
     D  l_firm               944    946  0
     D  l_fnav               951    980
     D  l_syst               999    999
     D  l_lage              1001   1002  0
      *
      * Definering av øvrige variable
      *
     d w_firm          s                   like(lofirm)
     d w_latx          s             20
     d w_adrs          s             30
     d w_ponr          s              4  0
     d w_pste          s             30
     d w_avde          s              4  0
     d w_vise          s                   like(lbvise)
     d w_stat          s              1
     d w_parm          s             80
      *
     d b_feil          s              1    inz(*off)
6.24 d b_otyp          s              1    inz(*off)
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Behandling av bestilling/innkjøp                               *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *  Sjekk om kode for endring eller gjennomsyn er brukt i
      *  kallende program
      *
     c     p_valg        ifeq      2
     c                   eval      b1onum = p_numm
     c                   eval      b1osuf = p_suff
7.02 c                   eval      b_nybe = *off
     c                   goto      b1tag0
     c                   endif
      *
      *  Forklaring til statuskoder
      *
      *       WRETUR  Benyttes ved retur fra ett annet program
      *       WSTATA  Dersom best finnes =1, ellers =0
      *       WSTATL  Retur-kode, fra varelinjer  (=1, dersom vedl.)
      *       WB1KOD  A=Feil leverandørnr, B=Feil adresseleverandør
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  B1 Behandler åpningsbildet samt funksjonstaster                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     B1TAG         TAG
      *
      *  Returner til spørring dersom vedlikehold
      *
     c     p_valg        ifeq      2
     c                   exsr      mrkbes
     c                   goto      xslutt
     c                   endif
      *
      *  Legger inn faste felter som gjentaes for neste bilde
      *
     C                   MOVE      DSBIND        B1BIND
     C                   MOVE      DSOTYP        B1OTYP
     C                   MOVE      DSODAT        B1BDAT
     C                   MOVE      DSVREF        B1VREF
      *
      *  Nullstiller/Blanker felter som skal benyttes
      *
     C                   MOVE      *ZERO         B1ONUM
     C                   MOVE      *ZERO         B1OSUF
     C                   MOVE      *ZERO         B1LELE
     C                   MOVE      *ZERO         B1LDOR
     C                   MOVE      *BLANK        B1NAVN
     C                   MOVE      *BLANK        B1ADR1
     C                   MOVE      *BLANK        B1ADR2
     C                   MOVE      *BLANK        B1STED
     C                   MOVE      *BLANK        B1DREF
     C                   MOVE      *BLANK        B1REKV
     C                   MOVE      *BLANK        B1SORN
     C                   MOVE      *ZERO         B1LDAT
6.23 C                   eval      b1kamp = *blank
      *
     C                   MOVE      *BLANK        B2NAVN
     C                   MOVE      *BLANK        B2GATE
     C                   MOVE      *BLANK        B2ADR2
     C                   MOVE      *BLANK        B2STED
     C                   MOVE      *BLANK        B2AVTS
      *
     C                   MOVE      *ZERO         WSTATA
     C                   MOVE      *BLANK        WSTATL
     C                   MOVE      *ZERO         WWONUM
     C                   MOVE      *ZERO         WWLDOR
     C                   MOVE      HEDNUM        WVISNR
      *
     C                   MOVE      *ZERO         HEDNUM
     C                   MOVE      *ZERO         SALADR
     C                   MOVE      *ZERO         SARKAT
6.36 c                   move      *blanks       saproj
      *
     C     B1TAGA        TAG
     C                   MOVE      *BLANK        WRETUR
     C                   MOVE      *ZERO         SWTCH1
     C     DSCBES        COMP      1                                      23
     C  N23              SETON                                        26
      *
     C     B1TAGB        TAG
     C     WKAVTS        COMP      *BLANK                             2828
      *
      *  Send Alt
      *
     C                   EXFMT     B1BLD
     C                   SETOFF                                       2325
     C                   SETOFF                                       2728
      *
      *  F3=Avslutt program
      *
     C     *INKC         IFEQ      *ON
     C                   EXSR      MRKBES
6.2b C                   EVAL      P_NUMM = w_numm
6.2b C                   EVAL      P_SUFF = w_sufF
     C                   GOTO      XSLUTT
     C                   END
      *
      *  F4=Spørring
      *
     C     *INKD         IFEQ      *ON
      *
6.2a  * Spørring på ordretyper
6.2a  *
6.2a c     wactfe        ifeq      'B1OTYP'
6.2a c                   call      'VA550R'
6.2a c                   parm                    w_firm
6.2a c                   parm                    b1otyp
6.2a c                   goto      B1TAGB
6.2a c                   endif
      *
     C     WACTRE        IFEQ      'B1BLD'
      * Leverandør
     C     WACTFE        IFEQ      'B1LDOR'
     C                   EXSR      SPLEV
     C                   EXSR      HNTLEV
     C                   SETOFF                                       26
     C                   SETON                                        25
     C     WRETUR        IFEQ      *BLANK
     C                   GOTO      B1TAGB
     C                   END
     C                   END
6.11  * Deres ref (kontaktpersonregister)
6.11 c     wactfe        ifeq      'B1DREF'
6.11 c                   eval      w_lref = *blanks
6.11  *
6.11 c                   call      'RL503R'
6.11 c                   parm                    w_firm
6.11 c                   parm                    b1ldor
6.11 c                   parm                    w_lref
6.35 c                   parm                    w_kpnr
6.13 c                   parm                    w_emal
6.11 c                   eval      b1dref = w_lref
6.11  *
6.11 c                   goto      b1tagb
6.11 c                   endif
      *
     C                   END
     C                   END
      *
      *  F10=Vedlikehold av faste opplsyninger i BESTILLINGS-HODE-REGISTER
      *
     C     *INKJ         IFEQ      *ON
     C     HEDNUM        IFNE      *ZERO
     C                   CALL      'LO101R'
     C                   PARM                    WRETUR
     C                   PARM                    HEDFIR
     C                   PARM                    HEDNUM
     C                   PARM                    HEDSUF
7.02 C                   parm                    b_nybe
     C                   END
      *
     C                   GOTO      B1TAGA
     C                   END
      *
      *  F11=Vedlikehold av frie tekster i BESTILLINGS-TEKST-REGISTER
      *
     C     *INKK         IFEQ      *ON
     C     HEDNUM        IFNE      *ZERO
     C                   CALL      'LO104R'
     C                   PARM                    WRETUR
     C                   PARM                    HEDFIR
     C                   PARM                    HEDNUM
     C                   PARM                    HEDSUF
     C                   END
      *
     C                   GOTO      B1TAGA
     C                   END
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Sjekker de innslåtte opplysninger                              *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  *
6.37  *  Sjekk, om innlagt bestillingsnummer finnes fra før
6.37  *
6.37 c*                  if        wstata = 0 and
6.37 c*                            b1onum > 0
6.37 c*                  exsr      sjk_bes
6.37 c*                  if        b_mbes = *on
6.37 c*                  eval      *in43 = *on
6.37 c*                  goto      b1tagb
6.37 c*                  endif
6.37 c*                  endif
      *
      *  Sjekk,  Finnes ordretype i ORDRE_TYPE_REGISTER
      *
     C                   MOVE      B1OTYP        OTYTYP
     C     OTYKEY        CHAIN     VOTYL1R                            62
     C   62              DO
     C                   SETON                                        31
     C                   GOTO      B1TAGB
     C                   END
      *
     c                   if        vaosys <> 1
     c                   eval      *in42 = *on
     c                   goto      b1tagb
     c                   endif
      *
      *  Sjekk,  Er ordretype endret
      *
     C     WSTATA        IFEQ      1
     C     B1OTYP        IFNE      LOOTYP
     C                   SETON                                        43
     C                   GOTO      B1TAGB
     C                   END
     C                   END
      *
      *  Sjekk,  Er leverandørnummer endret
      *
     C     WSTATA        IFEQ      1
     C     B1LDOR        IFNE      LOLDOR
     C                   SETON                                        44
     C                   GOTO      B1TAGB
     C                   END
     C                   END
      *
      *  Sjekk,  Er bestillingsdato en gyldig dato
      *
     c     *dmy          test(d)                 b1bdat                 32
     c                   if        *in32 = *on
     c                   goto      b1tagb
     c                   endif
      *
      *  Sjekk,  Er leveringsdato en gyldig dato
      *
6.29  * hvis LDAT er def. i AVALPF, så vanlig behandling ellers
6.29  * skal det alltid testes.
6.29  *
6.30 c*                  if        u_spes = *off or
6.30 c                   if        u_ldat = *on
     c     *dmy          test(d)                 b1ldat                 33
     c                   if        *in33 = *on
     c                   goto      b1tagb
     c                   endif
6.29 c                   endif
      *
      *  Sjekk,  Er leveringsdato større en/lik bestillingsdato
      *
     C     B1LDAT        IFNE      *ZERO
     c     *dmy          move      b1ldat        wwldat
     c                   eval      wwbdat = *loval
     c                   if        b1bdat <> 0
     c     *dmy          move      b1bdat        wwbdat
     c                   endif
     C     WWLDAT        IFLT      WWBDAT
     C                   SETON                                        34
     C                   GOTO      B1TAGB
     C                   END
     C                   END
      *
      *  Sjekk,  er bekreftet leveringsdato en gyldig dato
      *
     c                   if        b1moda <> 0
     c     *dmy          test(d)                 b1moda                 35
     c                   if        *in35 = *on
     c                   goto      b1tagb
     c                   endif
     c                   endif
      *
      *  Sjekk,  Er bekreftet leveringsdato større en/lik bestillingsdato
      *
     C     B1MODA        IFNE      *ZERO
     c     *dmy          move      b1moda        wwldat
     c                   eval      wwbdat = *loval
     c                   if        b1bdat <> 0
     c     *dmy          move      b1bdat        wwbdat
     c                   endif
     C     WWLDAT        IFLT      WWBDAT
     C                   SETON                                        36
     C                   GOTO      B1TAGB
     C                   END
     C                   END
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Best_nummer er tastet inn direkte, dette kan være en endring   *
      *  eller nyregistrering med bruk av direkte bestillingsnummer     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     B1TAG0        TAG
      *
     C     B1ONUM        IFNE      WWONUM
      *
      *  Legger inn bestillingsnummer og suffix i nøkklene
      *
     C                   MOVE      B1ONUM        HEDNUM
     C                   MOVE      B1OSUF        HEDSUF
      *
      *  Henter opp opplysninger fra BESTILLINGS-HODE-REGISTER
      *
     C                   EXSR      HNTBES
      *
      *  Sjekk,  Blir bestilllingen allerde behandlet
      *
     C     LOKODE        IFNE      *ZERO
     C                   MOVE      *ZERO         HEDNUM
     C                   MOVE      *ZERO         HEDSUF
     C                   MOVE      *ON           *IN37
     C                   GOTO      B1TAGB
     C                   END
      *
      *  Sjekk,  Ved ny bestilling skal alltid suffix være null
      *
     C     WSTATA        IFEQ      *ZERO
     C     B1OSUF        IFNE      *ZERO
     C                   SETON                                        38
     C                   GOTO      B1TAGB
     C                   END
     C                   END
      *
      *  Dersom bestilllingen finnes fra før gjør klar opplysninger
      *
     C     WSTATA        IFEQ      1
      *
      *  Merk av at bestilllingen er til behandling som vedlikehold
      *
     C                   CALL      'LO709R'
     C                   PARM                    HEDNUM
     C                   PARM                    HEDSUF
      *
     C     HEDKEY        CHAIN     LOHELUR                            64
     C                   Z-ADD     1             LOKODE
6.10 c                   time                    loedat
6.10 c                   time                    loetim
6.10 c                   eval      loeusr = l_user
     C                   UPDATE    LOHELUR
      *
      *  Legg tilside valgt bestillingsnummer, suffix og leverandørnummer
      *
     C                   MOVE      B1ONUM        WWONUM
     C                   MOVE      B1OSUF        WWOSUF
     C                   MOVE      B1LDOR        WWLDOR
      *
     C     DSCBES        COMP      1                                      23
     C  N23              SETON                                        25
     C                   GOTO      B1TAGB
     C                   END
      *
     C                   END
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Behandler opplsyninger for registrering/vedlikehold av best.   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
      *  Sjekk  leverandør / Hent leverandøropplysninger
      *
     C                   EXSR      HNTLEV
      *
      *  Adresseleverandør finnes ikke i leverandør-register
      *
     C     WB1KOD        IFEQ      'A'
     C                   MOVE      *ON           *IN39
     C                   MOVE      *ON           *IN26
     C                   GOTO      B1TAGB
     C                   END
      *
      *  Leverandørnummer finnes ikke i leverandør-register
      *
     C     WB1KOD        IFEQ      'B'
     C                   MOVE      *ON           *IN40
     C                   MOVE      *ON           *IN26
     C                   GOTO      B1TAGB
     C                   END
      *
6.33 c                   if        *in46 = *on
6.33 c                   goto      b1tagb
6.33 c                   endif
      *
      *  Dersom forrige leverandør ikke er lik nyregistrert send bilde pånytt
      *
     C     B1LDOR        IFNE      WWLDOR
      *
     C                   MOVE      *ON           *IN27
     C                   MOVE      B1LDOR        WWLDOR
     C                   GOTO      B1TAGB
     C                   END
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Behandler registrete bestillingsverdier                        *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
      *  Tar vare på de sist brukte opplysninger for noen utvalgte felter
      *  Disse verdiene blir lagt ut neste gang ny bestilling skal registres
      *
     C     WSTATA        IFEQ      0
     C                   MOVE      B1BIND        DSBIND
     C                   MOVE      B1OTYP        DSOTYP
     C                   MOVE      B1BDAT        DSODAT
     C                   MOVE      B1VREF        DSVREF
     C                   END
      *
      *  Kaller opp subrutine for oppdatering av BESTILLINGS-HODE-REGISTER
      *
     C                   EXSR      OPPBES
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Behandler BESTILLINGS-LINJE-REGISTER                           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
      *  Sjekker om bestilling er sendt EDI
      *
     C                   IF        LOBSEN <> 0
     C                   EXFMT     M1WIN
      *
     C     *INKC         IFEQ      *ON
     C                   EXSR      MRKBES
     C                   GOTO      XSLUTT
     C                   ENDIF
     C                   ENDIF
      *
      *  Kaller opp subprogram for registering av faste opplysninger
      *
     c                   eval      w_vise = lbvise
      *
     c     vise_tag      tag
      *
     C     w_vise        IFNE      *ZERO
      *
     C     w_vise        IFEQ      1
     C                   CALL      'LO101R'
     C                   PARM                    WRETUR
     C                   PARM                    HEDFIR
     C                   PARM                    HEDNUM
     C                   PARM                    HEDSUF
7.02 C                   parm                    b_nybe
     C                   END
      *
     C     w_vise        IFEQ      2
     C                   CALL      'LO102R'
     C                   PARM                    WRETUR
     C                   PARM                    HEDFIR
     C                   PARM                    HEDNUM
     C                   PARM                    HEDSUF
     C                   END
      *
     C                   if        w_vise = 3  and
     C                             vaoakk = 3
     C                   CALL      'LO103R'
     C                   PARM                    WRETUR
     C                   PARM                    HEDFIR
     C                   PARM                    HEDNUM
     C                   PARM                    HEDSUF
     C                   endif
      *
      *  F3=Trykket i subprogram
      *
     C     WRETUR        IFEQ      '9'
     C     HEDKEY        CHAIN     LOHELUR                            64
     C                   Z-ADD     0             LOKODE
     C                   MOVE      *loval        LOKOTI
     C                   MOVE      *loval        LOKODA
     C                   MOVE      *BLANK        LOKOUS
     C                   MOVE      *BLANK        LOKOWS
6.10 c                   time                    loedat
6.10 c                   time                    loetim
6.10 c                   eval      loeusr = l_user
     C                   UPDATE    LOHELUR
     C                   GOTO      B1TAG
     C                   END
     C                   END
      *
      * Sjekker om gyldig lager er brukt dersom ikke lager er
      * kontrollert i ekstra-bilder.
      *
     C     HEDKEY        CHAIN     LOHEL1R                            64
     C     *IN64         IFEQ      *OFF
     c                   exsr      sjekk_lager
     c                   if        b_feil = *on
     c                   eval      w_vise = 2
     c                   goto      vise_tag
     c                   endif
     C                   ENDIF
      *
      *  Kaller opp subprogram for registrering/vedlikehold
      *  av varelinjer/tekstlinjer i BESTILLINGS-LINJE-REGISTER
      *
     C                   CALL      'LD100R'
     C                   PARM                    WSTATL
     C                   PARM                    HEDFIR
     C                   PARM                    HEDNUM
     C                   PARM                    HEDSUF
7.02 C                   parm                    b_nybe
      *
      *  Dersom ingen varelinjer er registrtert skal bestillling, slettes
      *  og sist brukte bestillingsnummer settes tilbake med 1 i STATUS-KODER
      *
     C     WSTATL        IFEQ      *BLANK
      *
      *  Oppdater NUMMER-REGISTER, bare hvis automatisk tildeling av nummer
      *
     C     DSAORD        IFEQ      1
     C                   MOVE      '1'           WSKODE
     C                   MOVE      HEDNUM        WSNUMM
     C                   EXSR      HNTNUM
     C                   END
      *
      *  Kaller opp subprogram for sletting av bestilling
      *
     C                   MOVE      *BLANK        WPTYPE
     C     HEDNUM        IFEQ      WSNUMM
     C                   MOVE      'UTEN'        WPTYPE
     C                   END
      *
     C                   MOVE      *BLANK        WSTATL
     C                   CALL      'LO400R'
     C                   PARM                    WSTATL
     C                   PARM                    HEDFIR
     C                   PARM                    HEDNUM
     C                   PARM                    HEDSUF
     C                   PARM                    WPTYPE
     C                   PARM                    WPKOM1
     C                   PARM                    WPKOM2
      *
     C                   MOVE      *ZERO         HEDNUM
     C                   MOVE      *ZERO         DSAORD
      *
     C                   END
6.25  *
6.25 c     p_valg        ifeq      0
6.25 c                   exsr      mrkbes
6.25 c                   endif
      *
6.28  * tar en clear på alle ordrehodefelter, så ingenting skal henge igjen
6.28  *
6.2b c                   eval      w_numm = lonumm
6.2b c                   eval      w_suff = losuff
6.28 c                   clear                   lohelur
      *
     C                   GOTO      B1TAG
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Avslutt program                                                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     XSLUTT        TAG
      *
     C                   SETON                                        LR
     C                   RETURN
      *
     C/EJECT
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  *  Sjekker om bestillingsnummer. Manuelt nummer er angitt i       *
6.37  *  skjermbildet.                                                  *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  *
6.37 c*    sjk_bes       begsr
6.37  *
6.37 c*                  eval      b_mbes = *on
6.37 c*                  eval      lohelr_numm = b1onum
6.37 c*                  eval      lohelr_suff = 0
6.37  *
6.37 c*    lohelr_key    setll     lohelr
6.37 c*    lohelr_key2   reade     lohelr
6.37 c*                  dow       not %eof
6.37 c*                  if        lxotyp = b1otyp and
6.37 c*                            lxsuff = b1osuf
6.37 c*                  eval      b_mbes = *off
6.37 c*                  endif
6.37 c*    lohelr_key2   reade     lohelr
6.37 c*                  enddo
6.37  *
6.37 c*                  endsr
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Merker bestilllingen med at den ikke lenger er til behandling  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Dersom bestilling er merket for utplukk eller utkrift,
      * skal ikke merking fjernes.
      *
     C     MRKBES        BEGSR
      *
     C     HEDKEY        CHAIN     LOHELUR                            64
     C     *IN64         IFEQ      *OFF
     c                   if        lokode <> 2 and
     c                             lokode <> 3
     C                   MOVE      *ZERO         LOKODE
     C                   MOVE      *loval        LOKOTI
     C                   MOVE      *loval        LOKODA
     C                   MOVE      *BLANK        LOKOUS
     C                   MOVE      *BLANK        LOKOWS
     c                   endif
6.10 c                   time                    loedat
6.10 c                   time                    loetim
6.10 c                   eval      loeusr = l_user
     C                   UPDATE    LOHELUR
     C                   END
      *
     C                   ENDSR
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Hent inn leverandøropplysninger                                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     HNTLEV        BEGSR
      *
      *  Nullstiller/Blanker variable
      *
     C                   MOVE      *ZERO         LDSPER
      *
      *
     C                   MOVE      *BLANK        WB1KOD
      *
      *  Sjekk,  Finnes vareadressekundenummer i KUNDE-REGISTER
      *
     C*          B1LELE    IFNE *ZERO
     C*                    MOVE B1LELE    LEVNUM
     C*          LEVKEY    CHAINrlevl1R              66
     C*          *IN66     IFEQ *ON
     C*                    MOVE 'A'       WB1KOD
     C*                    GOTO HNLK99
     C*                    ENDIF
      *
      *  Sjekk,  Finnes fakturakundenummer i KUNDE-REGISTER
      *
     C*          B1LDOR    IFEQ *ZERO
     C*          RLLEVR    IFNE *ZERO
     C*                    MOVE RLLEVR    B1LDOR
     C*                    ELSE
     C*                    MOVE B1LELE    B1LDOR
     C*                    MOVE *ZERO     B1LELE
     C*                    END
     C*                    END
      *
     C*                    END
      *
      *  Flytt adresseleverandør til leverandør-nummer
      *
     C*          B1LDOR    IFEQ *ZERO
     C*          B1NAVN    IFNE *BLANK
     C*                    MOVE DSLDOR    B1LDOR
     C*                    END
     C*                    END
      *
      *  Henter inn leverandøropplysninger
      *
     C                   MOVE      B1LDOR        LEVNUM
     C     LEVKEY        CHAIN     rlevl1R                            66
     C     *IN66         IFEQ      *ON
     C     B1LDOR        IFEQ      *ZERO
     C                   MOVE      'A'           WB1KOD
     C                   GOTO      HNTL99
     C                   END
     C                   END
6.20  *
6.20  * sjekker om det er lagt alt. ordretype på leverandøren (distr)
6.20  *
6.24 c                   if        p_valg <> 2  and
6.24 c                             b_otyp = *off
6.20 c                   eval      lldil1_ldor = b1ldor
6.20 c                   move      l_lage        lldil1_lage
6.20 c     lldil1_key    chain     lldil1
6.26 c                   if        %found(lldil1)
6.26 c                   if        lpotyp <> *blank
6.20 c                   eval      b1otyp = lpotyp
6.27 c*                  else
6.27 c*                  eval      b1otyp =  faaot7
6.26 c                   endif
6.24 c                   eval      b_otyp = *on
6.27 c*                  else
6.27 c*                  eval      b1otyp =  faaot7
6.26 c                   endif
6.20 c                   endif
      *
     C     *IN66         IFEQ      *ON
     C     B1LDOR        IFNE      *ZERO
     C                   MOVE      'B'           WB1KOD
     C                   GOTO      HNTL99
     C                   END
     C                   END
6.33  *
6.33  * sjekke om leverandør er sperret eller passiv
6.33  *
6.33 c                   if        rlsprk = 'J' or
6.33 c                             rlpass = 'J'
6.33 c                   eval      *in46 = *on
6.33 c                   endif
      *
     C**>                  Z-ADDRLKRES    LDSPER
      *
      *
      *
     C                   MOVE      *BLANK        WB1KOD
     C                   MOVEL     RLALFA        DSLENA
     C                   MOVE      RLNAVN        B2NAVN
     C                   MOVE      RLGATE        B2GATE
     C                   MOVE      RLADR2        B2ADR2
     C                   MOVE      RLSTED        B2STED
     C                   MOVE      RLAVTS        B2AVTS
      *
      *  Legger tilside leverandøropplysninger dersom ny bestilling
      *
     C     WSTATA        IFEQ      *ZERO
      *
      *  Legger inn leverandøropplysninger fra leverandørnummer
      *
     C                   MOVE      RLBETB        DSBETB
     C                   MOVE      RLDIST        DSDIST
     C                   MOVE      RLFORM        DSLMAT
     C                   MOVE      RLLBET        DSLBET
     C                   MOVE      RLVALK        DSVALK
     C                   MOVE      RLRABK        DSRKAT
      *
     C                   MOVE      *ZERO         DSKJOR
     C                   MOVE      RLMKOD        DSMKOD
6.39  * Sjekk om det er utenlandsk import.
6.39 c                   if        rlmkod = 1 and
6.39 c                             rlland <>  *blanks and
6.39 c                             rlland <>  'NO'
6.39 c                   eval      dsmkod = 2
6.39 c                   endif
      *
      *
     C**>        RLSLGR    IFNE *ZERO
     C**>                  MOVE RLSLGR    DSINNK
     C**>                  END
      *
     C*          B1LELE    IFNE *ZERO
     C*                    MOVE B1LELE    LEVNUM
     C*          LEVKEY    CHAINrlevl1R              66
      *
      *  Legger inn leverandøropplysninger fra adresseleverandør
      *
     C*                    MOVE RLNAVN    B1NAVN
     C*                    MOVE RLGATE    B1ADR1
     C*                    MOVE RLADR2    B1ADR2
     C*                    MOVE RLSTED    B1STED
      *
     C*                    MOVE RLLAGR    DSLAGE
     C*                    MOVE RLDIST    DSDIST
     C*                    MOVE RLFORM    DSLMAT
     C*                    MOVE RLLBET    DSLBET
     C*                    MOVE RLRABK    DSRKAT
      *
      *
      *
     C**>        RLSLGR    IFNE *ZERO
     C**>                  MOVE RLSLGR    DSINNK
     C**>                  END
      *
     C*                    END
     C                   END
      *
      *
      *
      *
      *
      *
      *
     C     HNTL99        ENDSR
      *
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Hent inn kundeopplysninger for evt. leveringsadresse           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     HNTKUN        BEGSR
      *
     C     B1LELE        IFNE      *ZERO
     C                   MOVE      B1LELE        KUNNUM
     C     KUNKEY        CHAIN     rkunl1R                            66
      *
      *  Legger inn kundeopplysninger fra vareadressekundenummer
      *
     C                   MOVE      RKNAVN        B1NAVN
     C                   MOVE      RKGATE        B1ADR1
     C                   MOVE      RKADR2        B1ADR2
     C                   MOVE      RKSTED        B1STED
      *
     C                   ENDIF
      *
     C     HNTK99        ENDSR
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Hent opplsyninger fra BESTILLINGS-HODE-REGISTER                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     HNTBES        BEGSR
      *
     C     HEDKEY        CHAIN     LOHEL1R                            64
     C     *IN64         IFEQ      *ON
     C                   MOVE      *ZERO         WSTATA
     C                   MOVE      *ZERO         LOKODE
     C                   ENDIF
      *
     C     *IN64         IFEQ      *OFF
     C                   MOVE      1             WSTATA
     C                   MOVE      LONUMM        B1ONUM
     C                   MOVE      LOSUFF        B1OSUF
     C                   MOVE      LOOTYP        B1OTYP
     C                   MOVE      LOBIND        B1BIND
     C                   MOVE      *ZERO         B1BDAT
     C                   MOVE      LOLELE        B1LELE
     C                   MOVE      LOLDOR        B1LDOR
     C                   MOVE      LONAVN        B1NAVN
     C                   MOVE      LOADR1        B1ADR1
     C                   MOVE      LOADR2        B1ADR2
     C                   MOVE      LOSTED        B1STED
     C                   MOVE      LOVREF        B1VREF
     C                   MOVE      LODREF        B1DREF
     C                   MOVE      LOREKV        B1REKV
     C                   MOVE      LOSORN        B1SORN
     C                   MOVE      *ZERO         B1LDAT
     C                   MOVE      *ZERO         B1MODA
6.30 C                   eval      b1vida = 0
6.23 C                   eval      b1kamp = lokamp
      *
     c                   eval      *in45 = *on
     c                   if        loornr <> 0
     c                   eval      *in45 = *off
     C                   MOVE      LOORNR        B1ORNR
     C                   MOVE      LOORSU        B1ORSU
     c                   endif
      *
     c                   if        lobdat <> *loval
     c     *dmy          move      lobdat        b1bdat
     c                   endif
      *
     c                   if        loldat <> *loval
     c     *dmy          move      loldat        b1ldat
8.05 c                   eval      s_ldat = loldat
     c                   endif
      *
     c                   if        lomoda <> *loval
     c     *dmy          move      lomoda        b1moda
     c                   eval      w_bdat = lomoda
8.05 c                   eval      s_ldat = lomoda
     c                   endif
6.30  *
6.30 c                   if        lovida <> *loval
6.30 c     *dmy          move      lovida        b1vida
6.30 c                   endif
      *
     C                   MOVE      LOLDOR        LEVNUM
      *
      *  Hent leverandøropplysninger
      *
     C                   EXSR      HNTLEV
     C                   ENDIF
      *
     C                   ENDSR
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Oppdatering av BESTILLINGS-HODE-REGISTER  (60-On, Ny best)     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     OPPBES        BEGSR
      *
     C                   MOVE      B1ONUM        HEDNUM
     C                   MOVE      B1OSUF        HEDSUF
     C     HEDKEY        CHAIN     LOHEL1R                            64
     C  N64              MOVE      '1'           WSTATL
     C   64              EXSR      HNTNYT
      *
     C     HEDKEY        CHAIN     LOHELUR                            64
      *
     C     *INKE         IFEQ      *ON
     C                   MOVE      *ZERO         LOKODE
     C                   MOVE      *LOVAL        LOKOTI
     C                   MOVE      *LOVAL        LOKODA
     C                   MOVE      *BLANK        LOKOUS
     C                   MOVE      *BLANK        LOKOWS
     C                   ENDIF
      *
      * Konvertere alfafelt
      * til store bokataver
      *
     C     LAAHOY        IFEQ      1
     c     Lo:Up         xlate     b1navn        b1navn
     c     Lo:Up         xlate     b1adr1        b1adr1
     c     Lo:Up         xlate     b1adr2        b1adr2
     c     Lo:Up         xlate     b1sted        b1sted
     C                   END
      *
     C                   MOVE      B1OTYP        LOOTYP
     C                   MOVE      B1BIND        LOBIND
     C                   MOVE      B1LELE        LOLELE
     C                   MOVE      B1LDOR        LOLDOR
     C                   MOVEL     DSLENA        LOLENA
     C                   MOVE      B1NAVN        LONAVN
     C                   MOVE      B1ADR1        LOADR1
     C                   MOVE      B1ADR2        LOADR2
     C                   MOVE      B1STED        LOSTED
     C                   MOVE      B1VREF        LOVREF
     C                   MOVE      B1DREF        LODREF
6.35 c                   eval      lokpnr = w_kpnr
6.32 c                   if        %trim(b1dref) = *blanks
6.32 c                   eval      lokpnr = 0
6.32 c                   endif
     C                   MOVE      B1REKV        LOREKV
     C                   MOVE      B1SORN        LOSORN
6.23 C                   eval      lokamp = b1kamp
      *
      *
      * Er leveringsadresse endret ?
      *
     C     SALADR        IFNE      *ZERO
     C                   MOVE      SALADR        LOLADR
     C     SARKAT        IFNE      *ZERO
     C                   MOVE      SARKAT        LORKAT
     C                   ENDIF
6.36 C**   SAPROJ        IFNE      *ZERO
6.36 c     saproj        ifne      *blanks
     C                   MOVE      SAPROJ        LOPROJ
     C                   ENDIF
     C                   ENDIF
      *
     c                   eval      lobdat = *loval
     c                   eval      loldat = *loval
     c                   eval      lomoda = *loval
      *
     c                   if        b1bdat <> 0
     c     *dmy          move      b1bdat        lobdat
     c                   endif
      *
     c                   if        b1ldat <> 0
     c     *dmy          move      b1ldat        loldat
     c                   endif
      *
      * Oppdaterer bekreftet leveringsdato og logger hvis endring
      *
     c                   if        b1moda <> 0
     c     *dmy          move      b1moda        lomoda
     c                   if        lomoda <> w_bdat
     c                   eval      d_firm = w_firm
     c                   eval      d_numm = lonumm
     c                   eval      d_suff = losuff
     c                   eval      d_kode = '3'
     c                   eval      d_date = wwdate
     c                   eval      d_time = wwtime
     c                   eval      d_user = l_user
     c                   eval      d_wsid = l_wsid
     c                   eval      w_parm = d_urec
      *
5.51 c                   call      'LM900R'
5.51 c                   parm                    w_stat
5.51 c                   parm                    w_parm
     c                   endif
     c                   endif
7.01  * Oppdaterer tilhørende kundeordre
7.01 c                   if        u_701 = *on
7.01 c                   if        loornr <> 0
7.01 c                   eval      fohelu_numm = loornr
7.01 c                   eval      fohelu_suff = loorsu
7.01 c     fohelu_key    chain     fohelu
7.01 c                   if        %found
8.01 c                   if        lomoda <> *loval
7.01 c                   eval      foldat = lomoda
7.01 c                   time                    foedat
7.01 c                   time                    foetim
7.01 c                   eval      foeusr = l_user
7.01 c                   update    fohelur
8.01 c                   else
8.01 c                   unlock    fohelu
8.01 c                   endif
7.01 c                   endif
7.01 c                   endif
7.01 c                   endif
5.01  *
5.01  * Dersom dette er en bestilling med behandlingskode
5.01  * 2 eller 3, skal kode for at beholdning er
5.01  * oppdatert settes = 1,  i motsatt fall = 0
5.01  *
5.01 c                   if        vaoakk = 2 or
5.01 c                             vaoakk = 3
5.01 c                   eval      lolopp = 1
5.01 c                   else
5.01 c                   eval      lolopp = 0
5.01 c                   endif
      *
     C     *IN64         IFEQ      *OFF
6.10 c                   time                    loedat
6.10 c                   time                    loetim
6.10 c                   eval      loeusr = l_user
     C                   UPDATE    LOHELUR
     C                   ELSE
     C                   MOVE      HEDFIR        LOFIRM
     C                   MOVE      HEDNUM        LONUMM
     C                   MOVE      HEDSUF        LOSUFF
6.10 c                   time                    lodate
6.10 c                   time                    lotime
6.10 c                   eval      louser = l_user
6.10 c                   time                    loedat
6.10 c                   time                    loetim
6.10 c                   eval      loeusr = l_user
     C                   WRITE     LOHELUR
     C                   END
8.05  *
8.05  * Oppdater linjer på bestillingen, med leveringsdato/bekreftet leveringsdato,
8.05  * hvis loggkode ikke er 4. Sjekker kun hvis "gammel" bestilling.
8.05  *
8.05 c                   if        *in64 = *off
8.05 c                   eval      w_ldat = loldat
8.05 c                   if        lomoda <> *loval
8.05 c                   eval      w_ldat = lomoda
8.05 c                   endif
8.05  * Leveringsdato må være endret
8.05 c                   if        s_ldat <> w_ldat and
8.05 c                             w_ldat <> *loval
8.05 c                   eval      llogl1_numm = lonumm
8.05 c                   eval      llogl1_suff = losuff
8.05 c                   eval      llogl1_kode = '4'
8.05 c     llogl1_key    chain     llogl1
8.05 c                   if        not %found
8.05  * Loggkoden kan ikke være 4, da den allerede er bekreftet.
8.05 c                   eval      lodtlu_numm = lonumm
8.05 c                   eval      lodtlu_suff = losuff
8.05 c                   eval      lodtlu_line = 0
8.05 c     lodtlu_key    setll     lodtlu
8.05 c     lodtlu_key2   reade     lodtlu
8.05 c                   dow       not %eof
8.05 c                   if        %trim(ldvare) <> *blanks and
8.05 c                             ldldat = s_ldat or
8.05 c                             %trim(ldvare) <> *blanks and
8.05 c                             ldldat < wwdate
8.05 c                   eval      ldldat = w_ldat
8.05 c                   time                    ldedat
8.05 c                   time                    ldetim
8.05 c                   eval      ldeusr = l_user
8.05 c                   update    lodtlur
8.05 c                   else
8.05 c                   unlock    lodtlu
8.05 c                   endif
8.05 c     lodtlu_key2   reade     lodtlu
8.05 c                   enddo
8.05 c                   endif
8.05 c                   endif
8.05 c                   endif
      *
     C     *IN64         IFEQ      *ON
     C                   CALL      'LO709R'
     C                   PARM                    HEDNUM
     C                   PARM                    HEDSUF
     C                   END
      *
     C                   ENDSR
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Oppdatering av BESTILLINGS-HODE-REGISTER  Ny bestilling        *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     HNTNYT        BEGSR
     C                   MOVE      *ZERO         DSAORD
      *
      *  Henter inn neste ledige bestillingsnummer fra STATUS-KODER
      *
     C     ORDSTR        TAG
     C     HEDNUM        IFEQ      *ZERO
     C                   MOVE      1             DSAORD
      *
     C                   MOVE      '0'           WSKODE
     C                   MOVE      *ZERO         WSNUMM
     C                   EXSR      HNTNUM
     C                   MOVE      WSNUMM        HEDNUM
     C                   END
      *
     C     HEDKEY        CHAIN     LOHEL1R                            64
      *
     C  N64              DO
     C                   MOVE      *ZERO         HEDNUM
     C                   GOTO      ORDSTR
     C                   END
6.38  *
6.38  *  sjekker om avdeling = 0, i såfall hent fra lager
6.38  *
6.38 c                   if        dsavde = 0
     c                   move      l_lage        ra10l1_jkod
6.38 c     ra10l1_key    chain     ra10l1
6.38 c                   if        %found(ra10l1) and
6.38 c                             rajavd <> 0
6.38 c                   eval      dsavde = rajavd
6.38 c                   endif
6.38 c                   endif
      *
      *  Legger inn opplysninger i BESTILLINGS-HODE-REGISTER felter
      *
     C                   MOVE      l_lage        LOLAGE
     C                   MOVE      *ZERO         LOBINR
     C                   MOVE      *ZERO         LOKREF
     C                   MOVE      *LOVAL        LOFKDA
     C                   MOVE      *LOVAL        LOFFDA
     C                   MOVE      *ZERO         LOORNR
     C                   MOVE      DSBETB        LOBETB
     C                   MOVE      DSINNK        LOINNK
     C                   MOVE      DSDIST        LODIST
     C                   MOVE      DSLMAT        LOLMAT
     C                   MOVE      DSLBET        LOLBET
     C                   MOVE      DSVALK        LOVALK
     C                   MOVE      DSRKAT        LORKAT
      *
     C                   MOVE      DSMKOD        LOMKOD
     C                   MOVE      DSAVDE        LOAVDE
     C                   MOVE      *ZERO         LOKONT
     C                   MOVE      *ZERO         LOSPES
6.36 C                   eval      loproj = *blanks
     C                   MOVE      *BLANK        LOAKTI
      *
     C                   MOVE      DSLMTX        LOLMTX
     C                   MOVE      DSLBTX        LOLBTX
     C                   MOVE      DSRABP        LORABP
      *
      *
      *
     C                   MOVE      *ZERO         LONETT
     C                   MOVE      *ZERO         LOBRUT
     C                   MOVE      *ZERO         LOKOLI
     C                   MOVE      SALADR        LOLADR
      *
      *  Legg inn kode som sier at
      *  ordre er opptatt
      *
     C                   MOVE      1             LOKODE
      *
     C                   MOVE      l_wsid        LOWSID
     C                   MOVE      l_user        LOUSER
      *
     C                   MOVE      *ZERO         LOTOTI
     C                   MOVE      *ZERO         LOTOTR
     C                   MOVE      *ZERO         LOTOTK
      *
      *  Legger inn dagens dato
      *
     c                   time                    lodate
     c                   time                    lotime
      *
     C                   ENDSR
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Spørring mot LEVERANDØR-REGISTER                               *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     SPLEV         BEGSR
      *
      *  Kaller opp subprogram for spørring mot LEVERANDØR-REG.
      *
     C                   CALL      'RL500R'
     C                   PARM                    HEDFIR
     C                   PARM                    B1LDOR
     C                   parm                    p_navn
     C                   MOVE      B1LDOR        WWLDOR
      *
      *
     C                   ENDSR
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Oppretter leverandør i LEVERANDØR-REGISTER                     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     OPLEV         BEGSR
      *
      *  Dersom ASOKON benyttes kalles program fra ASOKON istedet
      *
     C     l_syst        IFEQ      'A'
     C                   CALL      'FL012R'
     C                   PARM                    WRETUR
     C                   PARM                    HEDFIR
     C                   PARM                    B1NAVN
     C                   PARM                    B1ADR1
     C                   PARM                    B1ADR2
     C                   PARM                    B1STED
     C                   PARM                    B1LELE
     C                   GOTO      OPKUN1
     C                   ENDIF
      *
      *  Kaller opp subprogram for oppretting av ny leverandør
      *
     C                   CALL      'LROPLR'
     C                   PARM                    WRETUR
     C                   PARM                    HEDFIR
     C                   PARM                    B1NAVN
     C                   PARM                    B1ADR1
     C                   PARM                    B1ADR2
     C                   PARM                    B1STED
     C                   PARM                    B1LELE
      *
     C     OPKUN1        TAG
      *
      *  Blanker leverandøropplysninger dersom leverandør er funnet
      *
     C     WRETUR        IFEQ      *BLANK
     C                   MOVE      *ZERO         B1LDOR
     C                   MOVE      *BLANK        B1NAVN
     C                   MOVE      *BLANK        B1ADR1
     C                   MOVE      *BLANK        B1ADR2
     C                   MOVE      *BLANK        B1STED
     C                   MOVE      *ZERO         WWLDOR
     C                   END
      *
     C                   ENDSR
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Henter/Oppdatering av NUMMER-REGISTER                          *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     HNTNUM        BEGSR
      *
     C                   MOVE      LAABRK        WSFELL
     C                   MOVE      B1OTYP        WSTYPE
     C                   MOVE      l_wsid        WSFAST
      *
      *  Kaller opp subprogram for henting av nummer fra NUMMER-REGISTER
      *
     C                   CALL      'AS100R'
     C                   PARM                    WSKODE
     C                   PARM                    HEDFIR
     C                   PARM                    WSFELL
     C                   PARM                    WSTYPE
     C                   PARM                    WSFAST
     C                   PARM                    WSNUMM
      *
     C                   ENDSR
      *
      *---------------------------------------------------------------------
      * Subrutine for å sjekke gyldig lager
      *---------------------------------------------------------------------
      *
     c     Sjekk_lager   begsr
      *
     c                   call      'FÅ720R'
     c                   parm                    w_firm
     c                   parm                    lolage
     c                   parm                    w_latx
     c                   parm                    w_adrs
     c                   parm                    w_ponr
     c                   parm                    w_pste
     c                   parm                    w_avde
     c                   parm                    b_feil
      *
     c                   endsr
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Subrutine for initiering av program                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     C     *INZSR        BEGSR
      *
      *  Nullstilling av felter som ikke kan redefineres
      *
     C                   MOVE      *BLANK        WB1KOD            1
     C                   MOVE      *BLANK        WPTYPE            4
      *
     C                   MOVE      *ZERO         WSTATA            1 0
     C                   MOVE      *ZERO         WWKODE            1 0
     C                   MOVE      *ZERO         C                 1 0
     C                   MOVE      *BLANK        WRETUR            1
     C                   MOVE      *BLANK        WSTATL            1
      *
     C                   MOVE      *BLANK        WPQMEM            1
     C                   MOVE      *ZERO         WPSALD           11 2
      *
     C                   MOVE      *BLANK        WSKODE            1
     C                   MOVE      *BLANK        WSFELL            6
     C                   MOVE      *BLANK        WSTYPE            2
     C                   MOVE      *BLANK        WSFAST           10
6.nu C                   MOVE      *ZERO         WSNUMM            8 0
      *
     C                   MOVE      *BLANK        WPKOM1           30
     C                   MOVE      *BLANK        WPKOM2           30
     C                   MOVE      *BLANK        WPVARE           15
      *
     C                   MOVE      *ZERO         SWTCH1            1 0
     C                   Z-ADD     1             WPSWTC            1 0
     C                   MOVE      *BLANK        WPKOKO            1
     C                   MOVE      *BLANK        WPXSPO            1
     C                   MOVE      *BLANK        WPXVLG            1
      *
      *  Redefinering av felter
      *
     C     *LIKE         DEFINE    LOBDAT        WWBDAT
     C     *LIKE         DEFINE    LOLDAT        WWLDAT
     C     *LIKE         DEFINE    WSNUMM        WVISNR
      *
     C     *LIKE         DEFINE    RLAVTS        WKAVTS
      *
     C     *LIKE         DEFINE    B1ONUM        WWONUM
     C     *LIKE         DEFINE    B1OSUF        WWOSUF
     C     *LIKE         DEFINE    B1LDOR        WWLDOR
      *
      *
      *
     C     *LIKE         DEFINE    LOFIRM        WPSFIR
     C     *LIKE         DEFINE    LOLDOR        WPLDOR
     C     *LIKE         DEFINE    LOLADR        WPLADR
     C     *LIKE         DEFINE    LONAVN        WPLNAV
     C     *LIKE         DEFINE    LOADR1        WPLAD1
     C     *LIKE         DEFINE    LOADR2        WPLAD2
     C     *LIKE         DEFINE    LOSTED        WPLSTE
     C     *LIKE         DEFINE    LORKAT        WPRKAT
     C     *LIKE         DEFINE    LOPROJ        WPPROJ
     C     *LIKE         DEFINE    LOLADR        SALADR
     C     *LIKE         DEFINE    LORKAT        SARKAT
     C     *LIKE         DEFINE    LOPROJ        SAPROJ
      *
      *  Redefinering av parameterfeltene
      *
     C     *LIKE         DEFINE    LOOTYP        WPXOTY
     C     *LIKE         DEFINE    LOUSER        WPXUSE
     C     *LIKE         DEFINE    LOLDOR        WPXLDO
      *
      *
      *  Redefinering av nøkler
      *
     C     *LIKE         DEFINE    ABUSER        WWUSER
      *
     C     *LIKE         DEFINE    LBFIRM        USRFIR
     C     *LIKE         DEFINE    LBUSER        USRNUM
     C     *LIKE         DEFINE    LBUSER        usrfnu
      *
     C     *LIKE         DEFINE    RLFIRM        LEVFIR
     C     *LIKE         DEFINE    RLLEVR        LEVNUM
      *
     C     *LIKE         DEFINE    RKFIRM        KUNFIR
     C     *LIKE         DEFINE    RKKUND        KUNNUM
      *
     C     *LIKE         DEFINE    LAAFIR        STSFIR
      *
     C     *LIKE         DEFINE    VAOFIR        OTYFIR
     C     *LIKE         DEFINE    VAOTYP        OTYTYP
      *
     C     *LIKE         DEFINE    LOFIRM        HEDFIR
     C     *LIKE         DEFINE    LONUMM        HEDNUM
     C     *LIKE         DEFINE    LOSUFF        HEDSUF
      *
      *
      *
      *
      *
     C     *LIKE         DEFINE    LOFIRM        KLAFIR
     C     *LIKE         DEFINE    LOLDOR        KLAKUN
     C     *LIKE         DEFINE    LOLDOR        KLAKOD
      *
      *  Key for file : GPL-BRUKER-REGISTER
      *
     C     USERKK        KLIST
     C                   KFLD                    WWUSER
      *
      *  Key for file : GPL-BRUKER-REGISTER
      *
     C     USRKEY        KLIST
     C                   KFLD                    USRFIR
     C                   KFLD                    USRNUM
      *
      *  Key for file : LEVERANDØR-REGISTER
      *
     C     LEVKEY        KLIST
     C                   KFLD                    LEVFIR
     C                   KFLD                    LEVNUM
      *
      *  Key for file : KUNDE-REGISTER
      *
     C     KUNKEY        KLIST
     C                   KFLD                    KUNFIR
     C                   KFLD                    KUNNUM
      *
      *  Key for file : STATUS-KODER
      *
     C     STSKEY        KLIST
     C                   KFLD                    STSFIR
      *
      *  Key for file : ORDRE-TYPE-REGISTER
      *
     C     OTYKEY        KLIST
     C                   KFLD                    OTYFIR
     C                   KFLD                    OTYTYP
      *
      *  Key for file : BESTILLINGS-HODE-REGISTER
      *
     C     HEDKEY        KLIST
     C                   KFLD                    HEDFIR
     C                   KFLD                    HEDNUM
     C                   KFLD                    HEDSUF
      *
      * Key for file : GPL-BRUKER-REGISTER
      *
     c     fusrl1_key    klist
     c                   kfld                    usrfir
     c                   kfld                    usrfnu
6.20  *
6.20  * Key for les av leverandør distribusjon
6.20  *
6.20 c     lldil1_key    klist
6.20 c                   kfld                    w_firm
6.20 c                   kfld                    lldil1_ldor
6.20 c                   kfld                    lldil1_lage
6.29  *
6.29  * Key for file : Firmastyrt validering
6.29  *
6.29 c     avall1_key    klist
6.29 c                   kfld                    w_firm
6.29 c                   kfld                    avall1_apgm
6.37  *
6.37  * Key for les av bestillinger
6.37  *
6.37 c*    lohelr_key    klist
6.37 c*                  kfld                    w_firm
6.37 c*                  kfld                    lohelr_numm
6.37 c*                  kfld                    lohelr_suff
6.37  *
6.37  * Key for les av bestillinger
6.37  *
6.37 c*    lohelr_key2   klist
6.37 c*                  kfld                    w_firm
6.37 c*                  kfld                    lohelr_numm
6.38  *
6.38  * Key for les av lager
6.38  *
6.38 c     ra10l1_key    klist
6.38 c                   kfld                    w_firm
6.38 c                   kfld                    ra10l1_jkod
7.01  *
7.01  *  Key for file : Ordrehodet
7.01  *
7.01 c     fohelu_key    klist
7.01 c                   kfld                    w_firm
7.01 c                   kfld                    fohelu_numm
7.01 c                   kfld                    fohelu_suff
8.05  *
8.05  *  Key for file : Logg
8.05  *
8.05 c     llogl1_key    klist
8.05 c                   kfld                    w_firm
8.05 c                   kfld                    llogl1_numm
8.05 c                   kfld                    llogl1_suff
8.05 c                   kfld                    llogl1_kode
8.05  *
8.05  *  Key for file : Bestillingslinjer
8.05  *
8.05 c     lodtlu_key    klist
8.05 c                   kfld                    w_firm
8.05 c                   kfld                    lodtlu_numm
8.05 c                   kfld                    lodtlu_suff
8.05 c                   kfld                    lodtlu_line
8.05  *
8.05  *  Key for file : Bestillingslinjer
8.05  *
8.05 c     lodtlu_key2   klist
8.05 c                   kfld                    w_firm
8.05 c                   kfld                    lodtlu_numm
8.05 c                   kfld                    lodtlu_suff
      *
      *  Legger inn firmanummer i nøkklene
      *
     C                   MOVE      l_firm        USRFIR
     C                   MOVE      l_firm        LEVFIR
     C                   MOVE      l_firm        KUNFIR
     C                   MOVE      l_firm        STSFIR
     C                   MOVE      l_firm        OTYFIR
     C                   MOVE      l_firm        HEDFIR
     C                   MOVE      l_firm        WPSFIR
     c                   eval      w_firm = l_firm
      *
      *  Nullstiller/blanker hjelpe-felter
      *
     C                   MOVE      *ZERO         DSLAGE
     C                   MOVE      *ZERO         DSBETB
     C                   MOVE      *ZERO         DSDIST
     C                   MOVE      *ZERO         DSLMAT
     C                   MOVE      *ZERO         DSLBET
     C                   MOVE      *BLANK        DSVALK
     C                   MOVE      *ZERO         DSRKAT
      *
      *
     C                   MOVE      *ZERO         DSMKOD
      *
7.02 c                   eval      b_nybe = *on
7.01  *
7.01  * Endring 7.01
7.01  *
7.01   CallP CO402R(l_filg:w_firm:0:'LO110R_701':
7.01                    co402_verdi1:co402_verdi2);
7.01   if co402_verdi1 = '1';
7.01     u_701 = *on;
7.01   endif;
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Tar inn parameter fra forrige program                          *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     *entry        plist
     C                   parm                    p_valg
     C                   parm                    p_numm
     C                   PARM                    p_suff
      *
      *
      *
     C                   MOVE      *BLANK        DSLMTX
     C                   MOVE      *BLANK        DSLBTX
     C                   MOVE      *ZERO         DSRABP
      *
      *  Henter statusopplysninger fra STATUS-REGISTER
      *
     C     STSKEY        CHAIN     LSTSL1R                            60
     C     *IN60         IFEQ      *OFF
     C                   MOVEL     LAABND        DSBIND
     C                   MOVE      LAAOTY        DSOTYP
     C                   MOVEL     1             DSAORD
     C                   MOVEL     LAALEV        DSLDOR
     C                   ELSE
     C                   MOVE      'N'           DSBIND
     C                   MOVE      *BLANK        DSOTYP
     C                   MOVEL     1             DSAORD
     C                   MOVE      *ZERO         DSLDOR
     C                   END
      *
      *  Henter statusopplysninger fra BRUKER-REGISTERENE
      *
     C                   MOVE      l_user        WWUSER
     C     USERKK        CHAIN     AUSRL1                             60
     C     *IN60         IFEQ      *OFF
     C                   MOVE      ABSAVD        DSAVDE
     C                   ELSE
     C                   MOVE      *ZERO         DSAVDE
     C                   END
      *
     C                   MOVE      l_user        USRNUM
     C     USRKEY        CHAIN     LUSRL1                             60
     C     *IN60         IFEQ      *OFF
     C                   MOVE      LBBIND        DSBIND
     C     LBOTYP        IFNE      *BLANK
     C                   MOVE      LBOTYP        DSOTYP
     C                   END
     C                   MOVE      LBCBES        DSCBES
     C                   ELSE
     C                   MOVE      *ZERO         DSCBES
     C                   END
      *
     c                   eval      usrfnu = l_user
     c     fusrl1_key    chain     fusrl1                             60
     c                   if        *in60 = *off
6.10 c**                 eval      dsvref = fbvref
6.10 c                   movel     fbvref        dsvref
     c                   move      fbselg        dsinnk
     c                   else
     c                   eval      dsvref = *blank
     c                   eval      dsinnk = '00'
     c                   endif
      *
      *  Legger inn dagens dato
      *
     c                   time                    wwdate
     c                   time                    wwtime
      *
     c     *dmy          move      wwdate        dsodat
      *
6.29  * Firmastyrt validering av utvalgte felter
6.29  *
6.29  *
6.29 c                   eval      avall1_apgm = 'LO110R'
6.29 c     avall1_key    setll     avall1
6.29 c     avall1_key    reade     avall1
6.29 c                   dow       not %eof(avall1)
6.30 c*                  if        avaflt = 'LOLDAT'
6.30 c*                  eval      u_spes = *on
6.30 c*                  endif
6.29 c                   if        avaflt = 'LOLDAT'  and
6.29 c                             avaval = 1
6.29 c                   eval      u_ldat = *on
6.29 c                   endif
6.29 c     avall1_key    reade     avall1
6.29 c                   enddo
6.29  *
      *
     C                   ENDSR
      *
