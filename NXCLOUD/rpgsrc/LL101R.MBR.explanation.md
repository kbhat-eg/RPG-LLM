# Program Overview  
This RPG ILE program (LL101R) provides inventory maintenance (create/update/display) for the ASLAGR system. It uses subfiles for list display and a detail screen (C2BLD) for editing individual warehouse‐item records.  

# H-Specification  
• `option(*nodebugio)` – disables debug I/O routines  
• `datedit(*dmy)` – date format DD.MM.YYYY  

# Version History  
Comments in header show evolution (e.g. added supplier handling, status lookups, type‐change warnings, logging).  

# Indicator Usage  
• LR = End program  
• 10/11 = Roll up/down pages  
• 12/13 = Subfile display/controls  
• 14 = Clear subfile  
• 15 = Subfile end  
• 21 = Home key  
• 22 = Cursor positioning  
• 31–79 = Error/message flags  
• 80–99 = Work indicators  

# File Declarations  
• `FVLAGLR`, `FVLAGLU` – Inventory master file (read/update)  
• `FVVARL1` – Item master file (read only)  
• `FFSTSL1`, `FRLEVL1` – Status/supplier lookups (conditional)  
• `FLL101D` – Workstation display file  

# Data Structures & Variables  

## Arrays  
- `A_TXT(4)` (32-char) – Holds text labels for bestillingspunkt/menge depending on special cases  

## Local Data Area  
- `L_USER` – Current user ID  
- `L_FIRM`, `L_NAV` – Company and navigation data  

## Information DS (dspfbk)  
- `D_FCRN` – Feedback record number  

## Inventory‐History Record DS  
Overlayed 128-byte record with fields (`HLVARE`, `HLLAGE`, `HLDATO`, `HLTIME`, …) used when logging changes  

## Key Variables  
- `VLAGLR_VARE`, `VLAGLR_LAGE` – Keys for read chain on inventory  
- `VLAGLU_VARE`, `VLAGLU_LAGE` – Keys for update chain  
- `VVARL1_VARE` – Key for item master chain  
- `RLEVL1_LEVR` – Key for supplier chain  

## Working Variables  
• `W_FIRM`, `W_LAGE`, `W_VARE` – Current firm, warehouse, item  
• `W_TEK1` – Item description  
• `W_SEQE`, `B_OPPR`, `B_FEIL` – Control flags  
• `C2*` – Fields shown on C2BLD screen (e.g. `C2PLAS`, `C2MINI`, `C2BMIN`, etc.)  

# Entry & Initialization (`*INZSR`)  
1. **Parameters**: `P_VARE`, `P_LAGE` passed in.  
2. **Set up key lists** for file chains.  
3. **Load LDA** into `W_FIRM`, `W_VARE`, `W_LAGE`, and initialize `C1VARE`, `C1LAGE`.  
4. **Retrieve dynamic labels** via `CO402R` for “Bestillingspunkt” and “Bestillingsmengde” if needed.  

# Main Processing: B2CTL Screen Loop  
- Tag `B2TAGA` invokes subroutine `XC2BLD` to display the detail screen.  
- After `EXSR XC2BLD`, program returns here until end.  
- Tag `AVSLUTT` sets `*INLR = *ON` to end.  

# Subroutine XC2BLD (Detail Screen C2BLD)  

## Screen Setup  
- Clear row/col, previous type (`S_VTYP`).  
- Choose labels from `A_TXT(1–4)` based on `U_BPKT`.  

## Read Current Inventory Record  
- `CHAIN` on `VLAGLR` using `W_FIRM`, `W_VARE`, `W_LAGE`.  
- If found: populate `C2...` fields from file (min/max, reorder, qty, type, dates, supplier).  
- If not found: clear or zero all screen fields.  

## Load Item Description  
- `EXSR LES_VARE`: chains on `VVARL1` to fetch `VVTEK1` into `W_TEK1` (and optionally main supplier).  
- Places result in `C2TEK1`.  

## Display & Wait  
- `EXFMT C2BLD` shows the screen, returns on Enter, Function keys, or PF30.  
- If PF30 or PF-key for exit or scroll, branch accordingly.  

## Validation & Lookups  
- On field‐level help (PF4), calls external routines (e.g. MD510R, RL500R) to validate warehouse, location, supplier.  
- Date fields tested for valid ISO dates.  
- If any validation error: set corresponding indicator (31–36) and loop back.  

## Product‐Type Change Confirmation  
- If changing `C2VTYP` between ‘L’ (stocked) and ‘S’ (service) under certain conditions:  
  - Call `XC3MSG` or `XC4MSG` to display a confirm window.  
  - If user cancels, revert `C2VTYP` and return to screen.  
  - On confirm, set `B_ENDR_VTYP = *ON` and, for S->L, run `LOGG_LAGER`.  

## Update Inventory File  
1. Clear update record buffer (`V LAGLUR`).  
2. `CHAIN` on `VLAGLU` to see if an existing record.  
3. Move all `C2...` fields back into file variables (`VLPLAS`, `VLMINI`, ..., `VLTYP`, dates, supplier).  
4. Set audit fields (`VLEDAT`, `VLETIM`, `VLEUSR`, etc.).  
5. If found: `UPDATE VLAGLUR`; else: set key, write new record.  

# Subroutine XC3MSG / XC4MSG (Confirm Type Change)  
• Display a small message screen (`C3MSG` or `C4MSG`).  
• On Enter (PF3/4) = cancel → leave subroutine.  
• On PF12/X = confirm → call logging (if S->L), set flag, leave.  

# Subroutine LOGG_LAGER  
• Builds a history record (`HLREC`) with item, warehouse, date/time, description “Vtyp endret S-->L”.  
• Calls `VL001R` to write to history file.  
• Updates order and purchase accumulators via `FO761R`, `LA921R`.  

# Subroutine LES_VARE  
• `CHAIN` on item master `VVARL1` using `W_FIRM`/`W_VARE`.  
• If found: load description `VVTEK1` into `W_TEK1`, optionally main supplier.  
• Else: flag error `B_FEIL = *ON`.  

# Screen Definitions Used  
• B1SFL – Subfile record format  
• B2CTL – Subfile control format (open list)  
• C2BLD – Detail entry/edit format  
• C1BLD/C1MSG – New‐record key screen with message  
• D1WIN/K1WIN – Windows for delete/copy confirmations  

---

This structure should help onboard developers by explaining program flow, data structures, subfile handling, validation lookups, type‐change confirmations, and file update logic.