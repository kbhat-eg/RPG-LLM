# GL231R â€“ Conversion Routine Documentation

## Overview

This program, **GL231R**, is a batch conversion routine within the ASTELE system. Its primary function is to update specific fields (`SONEKONTONR`, `SONEKODE`, `SONELOKASJON`) in records of the `gavtl2` file. The program reads through all records in `gavtl2`, performs field updates, and writes the changes back to the file.

The code follows standard IBM RPG III/400 conventions and is designed for a one-time or periodic data conversion/update, likely as part of a larger data migration or correction process.

---

## Key Components

### File Declaration

```rpg
fgavtl2    uf   e           k disk
```
- **gavtl2**: Update-capable, externally described, keyed disk file. This is the main data source and target for the program.

---

### Data Structures

```rpg
d dsfgrp          s              3
d dsfirm          s              3  0
```
- **dsfgrp**: 3-character field, used as part of the key list for record selection.
- **dsfirm**: 3-digit packed decimal, also used in the key list.

---

### Main Processing Routine

#### Initialization

```rpg
*inzsr begsr
  eval dsfgrp = *blank
  eval dsfirm = 0
  ...
endsr
```
- The *INZSR subroutine zeroes out the key fields before processing begins.

#### Record Selection & Update Loop

```rpg
key00 setll gavtl2
      read  gavtl2 60
      dow   *in60 = *off
        eval   gcskto = gcbgir
        movel  gcfilg    gcskod
        movel  '*Mangler' gcslok
        update gavtpfr
        read   gavtl2 60
      enddo
```
- **key00 setll gavtl2**: Positions the file pointer at the start of the file (or a specific key if the key fields are set).
- **read gavtl2 60**: Reads the first record. Indicator 60 is set on end-of-file.
- **dow *in60 = *off**: Loop continues until the end of file.
- **eval gcskto = gcbgir**: Updates the field `gcskto` with the value of `gcbgir` (business logic: likely copying a group/account number).
- **movel gcfilg gcskod**: Moves the contents of `gcfilg` to `gcskod` (business logic: copying a code value).
- **movel '*Mangler' gcslok**: Sets `gcslok` to the literal `*Mangler` (Norwegian for "Missing" or "Not set"; used as a placeholder for missing location).
- **update gavtpfr**: Writes the modified record back to the file.
- **read gavtl2 60**: Reads the next record.

#### Program Termination

```rpg
eval *inlr = *on
return
```
- Sets the last record indicator, ensuring program cleanup and closure of files.

---

### Key List Definition

```rpg
key00 klist
      kfld dsfgrp
      kfld dsfirm
```
- Defines a key list for file positioning. In this program, the key list is initialized to blanks/zero, so the processing starts from the beginning of the file.

---

## Business/Domain-Specific Logic

- **Field Updates**: The program updates three fields in each record:
    - `gcskto` (zone account number): Set to the value of `gcbgir` (possibly a business unit or group number).
    - `gcskod` (zone code): Set to the value of `gcfilg` (likely an existing code).
    - `gcslok` (zone location): Set to the literal `*Mangler`, indicating the location is missing or not applicable.

- **Usage Context**: This routine is likely used during data migration, correction, or as part of a system upgrade where certain fields need to be populated or reset according to new business rules.

---

## Design Decisions & Conventions

- **Batch-Oriented**: The program processes all records in a single pass, suitable for off-hours or maintenance windows.
- **Field Naming**: Field names (`gcskto`, `gcbgir`, etc.) follow a business-specific convention; consult the data dictionary for precise definitions.
- **Error Handling**: Minimal; relies on RPG indicators for EOF. No explicit error logging or exception handling is present.
- **Hardcoded Values**: The use of `*Mangler` as a literal may require review if localization or different handling for missing data is needed in the future.

---

## External Interactions

- **gavtl2**: The only file accessed. No calls to APIs or other modules.
- **No External APIs**: This program is self-contained regarding business logic, operating solely on the `gavtl2` file.

---

## Summary

GL231R is a focused, batch conversion program for updating specific fields in the `gavtl2` file as per new or corrected business rules. It is designed for use by system administrators or during data maintenance tasks. The logic is straightforward but relies heavily on field naming conventions and business understanding of the underlying data. Review and adapt the hardcoded values and field assignments as business requirements evolve.