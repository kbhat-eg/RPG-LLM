# RPG Source Code Explanation

This program, `RC400R`, is written for IBM i (AS/400) in ILE RPG (Report Program Generator) and is related to **"Inkasso - sletting av saker - parameter"** (debt collection - deletion of cases - parameters). It interacts with a display file and handles user inputs for selecting deletion criteria.

---

## 1. Header & Metadata

- `h option(*nodebugio) datedit(*dmy)`
  - `*nodebugio`: Disables some debug capabilities for I/O.
  - `datedit(*dmy)`: Sets the default date format to day-month-year.

The large header block describes:
- Program name: `RC400R`
- Purpose: Deletion of debt collection cases, parameter handling
- Revision history, versioning, and indicator usage conventions.

---

## 2. File Declarations

```rpg
fausrl1    if   e           k disk
frc400d    cf   e             workstn
```

- `fausrl1`: Input file, keyed, external description, disk file.
- `frc400d`: Workstation file (display), for screen interaction.

---

## 3. Data Definitions

### Local Data Area (LDA) Mappings

```rpg
d                uds
d w_type                300    300
d w_edat                          d   datfmt(*iso)
```

- `uds`: Usage of the User Data Space (implicit LDA mapping).
- `w_type`, `w_edat`: Fields mapped to specific LDA positions.
    - `w_type`: Character type, position 300.
    - `w_edat`: Date field, ISO format.

### LDA Fields Continued

```rpg
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980
```
- Further mappings into the local data area for user, firm number, etc.

### Standalone Fields

```rpg
d s               s              1  0
d w_firm          s              3  0
d w_in03          s              1
```
- `s`: 1-digit numeric variable.
- `w_firm`: 3-digit numeric, working variable for firm number.
- `w_in03`: 1-char, used as a status/indicator variable.

---

## 4. Indicators

The header documents indicator usage, e.g.:
- `KA`/`KC` (F1/F3): function keys for "select company"/Exit
- `*INLR`: Last record indicatorâ€”program end.
- `*IN31-32`: Error/validation indicator for screen fields.

---

## 5. Main Logic Flow

### Initialization

```rpg
c     *inzsr        begsr
c                   move      l_firm        w_firm
c                   move      'J'           a2type
E5.50c               eval      w_in03 = ' '
c                   endsr
```
- At program start, moves firm number from `l_firm` to `w_firm`.
- Initializes `a2type` to 'J' (possibly "journal" or a default selection).
- Resets `w_in03` to blank.

---

### Main Program Section

#### Screen Display (A2BLD)

```rpg
c     a2taga        tag
c                   exfmt     a2bld
c                   eval      *in31 = *off
c                   eval      *in32 = *off
```
- Show format `a2bld` (parameter selection screen).
- Clear error indicators 31 & 32.

#### Exit Handling

```rpg
c                   if        *inkc = *on
c                   move      '1'           w_in03
c                   goto      xslutt
c                   endif
```
- If F3 (Exit, `*INKC`) is pressed, set `w_in03` to '1', then jump to program end (`xslutt`).

#### Validation: "Eldre enn dato" (Older Than Date)

```rpg
c     *dmy          test(d)                 a2edat                 31
c                   if        *in31 = *on
c                   goto      a2taga
c                   endif
c     *dmy          move      a2edat        w_edat
```
- Validates `a2edat` (input date field), using DMY format, sets *IN31 on error.
- If invalid, redisplay the format (`goto a2taga`).
- Else, move input date to working variable.

#### Validation: Output Type

```rpg
c                   if        a2type <> 'J'
c                             and a2type <> 'N'
c                   move      *on           *in32
c                   goto      a2taga
c                   endif
c                   move      a2type        w_type
```
- Checks if output type is either 'J' or 'N'.
- Otherwise, sets *IN32 (invalid type) and redisplays screen.
- If valid, moves to working variable.

#### Call Deletion Routine

```rpg
E5.50c                   call      'RC400C'
c                   parm                    w_in03
c                   parm                    w_type
c                   parm                    w_edat
```
- Calls program `RC400C` (the actual deletion engine), passing:
    - `w_in03`: Status code (e.g., exit or continue)
    - `w_type`: Type of output/operation
    - `w_edat`: Date criterion (delete cases older than this)

---

## 6. Program Exit

```rpg
c     xslutt        tag
c                   eval      *inlr = *on
c                   return
```
- Sets last record indicator (`*INLR`) to end the job/activation group.
- Returns to caller.

---

## 7. Summary

**In short:**  
This program presents a screen for parameters regarding deletion of debt collection cases, validates the user inputs (date, type), calls the deletion sub-program if the inputs are valid, and cleanly ends if the user exits or after the operation is completed. Indicator variables and LDA fields are used to pass session-specific information and control flow, following IBM i RPG standards.

---

### **Key Concepts for Onboarding**

- **Files:** One input file (`fausrl1`), one display file (`rc400d`).
- **LDA Usage:** LDA is used as a data area for passing session/user data.
- **Indicators:** Used for screen, error feedback, and control flow, as per IBM i RPG conventions.
- **Screen Processing:** All user interaction is handled through `a2bld` display format.
- **Validation:** Both date and type are validated, with feedback via screen indicators.
- **Delegation:** The deletion logic itself is encapsulated in a separate program (`RC400C`).
- **Program Flow:** Uses classic RPG C-specs (`c ...`) and tags for flow control, with `goto` for some loops.

---

**Familiarity with IBM i RPG, screen files (DSPF), and classic indicator handling is essential for further development or maintenance of this program.**