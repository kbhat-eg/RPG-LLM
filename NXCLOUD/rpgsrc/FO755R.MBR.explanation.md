## Program Overview

This program, `fo755R`, is part of the ASOFAK system. Its main purpose is to check if a deposit exists for a given customer and invoice, and to return an appropriate voucher code (`bilagskode`). The program is designed as a subroutine (likely called from other modules) and interacts with several database files specific to the business domain.

---

## High-Level Flow

1. **Initialization**: The program receives three parameters: company (`firm`), KID (customer identification, often used for payments), and a voucher code (`bkod`).
2. **Key Parsing**: The KID is parsed into its respective sub-components to extract customer and invoice information.
3. **Deposit Check**: The program attempts to locate a deposit record for the given customer/invoice.
4. **Voucher Code Assignment**: If an alternative voucher code is found in the deposit record, it is returned to the caller.
5. **Program Exit**: The program sets the LR indicator and exits.

---

## File Usage

- **fst2l1 (STATUS-KODER OFAK)**: Used for status codes related to the company.
- **fohel1**: Not directly referenced in the logic shown, but available for potential extension.
- **sdepl1 (depositum-fil)**: The main deposit file checked to determine if a deposit exists for the provided customer/invoice.
- **fo753d**: Workstation file, likely for display or debugging, but not actively used in this logic.

All files use `RENAME` to map to local record formats, which is a local convention for clarity and to avoid naming conflicts.

---

## Data Structures and Variables

- **Parameters**:
  - `p_firm`: Input company number.
  - `p_kidi`: Input KID (customer/invoice identifier).
  - `p_bkod`: Output voucher code.

- **KID Parsing Data Structure**:
  - `d_kkid`: Full KID (21 chars).
  - Overlays extract subfields:
    - `d_kkun`: Customer number (6 digits).
    - `d_kfak`: Invoice number (8 digits).
    - Other overlays extract various codes and flags as needed.

- **Deposit File Key**:
  - `sdepl1_kund`: Customer number.
  - `sdepl1_numm`: Invoice number.
  - `sdepl1_tell`: Always initialized to 0 (possibly a sequence or line number).

---

## Key Logic Points

### 1. Initialization (`*inzsr` subroutine)

- **Parameter Handling**: The program receives parameters via the `*entry` PLIST.
- **Key Preparation**: The KID is moved into the parsing data structure, extracting customer and invoice numbers for use as keys.
- **Status Code File Lookup**: A chain operation is performed on the status code file (`fst2l1r`) using the company number. The result is not directly used, but failure is flagged as indicator 90 (not checked in the main logic).

### 2. Deposit Check

- **Key Assignment**: The customer and invoice numbers extracted from the KID are set as the key fields for the deposit file.
- **Chain Operation**: The program attempts to locate a deposit record for the customer/invoice in `sdepl1`.
- **Early Exit**: If no record is found, the program exits immediately (label `avslutt`).

### 3. Voucher Code Handling

- **Alternative Code**: If the field `faafbk` (alternative voucher code) in the found deposit record is non-zero, it is assigned to the output parameter `p_bkod`.

---

## Indicators and Conventions

- **Indicator Usage**:
  - `LR`: End of program.
  - 31-79: For warnings and error messages.
  - 80-99: Working indicators.

- **Key Lists (`klist`)**:
  - Used to define composite keys for file operations, a standard practice in this codebase.

- **Overlay Data Structures**:
  - Heavily used to parse complex keys (like KID) into meaningful subfields, a common pattern for handling packed identifiers in this system.

---

## Business/Domain-Specific Logic

- **Deposit Validation**: The primary business rule is to check for the existence of a deposit for a customer/invoice combination, using data parsed from the KID.
- **Voucher Code Assignment**: If a special voucher code is present in the deposit record, it is returned; otherwise, the original value is retained.
- **KID Parsing**: The structure and overlays for KID reflect a domain-specific encoding scheme for customer and invoice identification.

---

## External Relationships

- **Called by Other Programs**: Designed as a callable routine, likely used by other payment or accounting modules to validate deposits and assign voucher codes.
- **Database Integration**: Relies on the integrity and structure of the deposit and status code files; changes to these files would require updates to the key logic.

---

## Notable Design Decisions

- **Goto for Early Exit**: The use of `goto avslutt` is a legacy convention for early returns in this codebase.
- **Overlay Data Structures**: Used for efficient parsing of packed identifiers, minimizing manual substring operations.
- **Parameter Passing**: All outputs are via parameters, supporting integration with other RPG or external programs.

---

## Summary

`fo755R` is a utility program for checking deposit records based on a parsed KID and returning a potentially updated voucher code. It leverages overlay data structures for efficient key parsing and uses standard file access patterns. The program is tightly coupled to the business rules around deposits and voucher codes in the ASOFAK system.