     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOFAK
      * Program . . . . : FV102R
      * Beskrivelse . . : Vedlikehold av status-koder, Spesielle koder
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
3.31  * R3.31 070301 AMD  Lagt inn kode for kontroll av neste ordretype
      *       281105 HKO  Lagt inn valg for å vise spesialavtale som
      *                   popup-vindu ved oppretting av ordre
      *       030407 AMD  Midlertidig fjernet (lå kun i dette progr.)
5.70  *       181208 bof  Std. varetype for lager
      * 6.10  250609 BSA  Oppdatert med sporingsinformasjon
6.11  * R6.10 120810 AMD  Lagt på kode for kontroll mot beholdning
6.20  * R6.20 090311 NHO  Lagt på kode for kontroll mot skaffevare
6.21  * R6.20 100511 NHO  Lagt på div. koder for 6.20 + endret i skjerm.b.
6.22  * R6.20 020312 BOF  Lagt på parameter for Selgers mobil på lister
6.23  * R6.20 230412 BOF  Lagt på parameter for SMS ved varemottak
6.24  * R6.20 110912 BOF  Lagt på parameter for valg Økonomi system
6.25  * R6.20 250214 Bsa  Endringer i skjermbildet pga Jacadaproblemer.
6.25  *                   Kan ikke ha overlappende felt.
6.31  * R6.30 280514 ASK  Valg om Nesxtep økonomi skal oppdateres
7.xx  * 7.00  110316 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
Q.01  * 7.00  020419 bsa  Større skjerm
Q.02  * 7.00  020419 bsa  Nye koder for leveringsdato
7.00  * 7.00  020419 nho  Rekompilert pga endring av bildet Mamut
7.01  * 7.00  070220 nho  CMD4 til vedlikehold av konv.bilagskoder
7.01  *                   vedr Visma
7.02  *K0000  110920 bsa  Valg 2 for bestillingsforslag pr leverandør.
7.03  *K0000  160920 sst  Utvidet med parameter for overføring av saldo
7.04  *K00    031120 sst  Integrasjon mot UniMicro
7.05  *K00    190221 bsa  Enter fra bilde 2 og 3, gir ingen avslutning.
      *
7.fb  * R6.40 011216 bof  Utvidet med bilde for Kode forskuddbet.
7.f1  * K000  300920 bsa  Fargevalg på ordre med depositumskrav.
7.f2  * K000  021120 bsa  Fjernet fanen for hurtigoppretting, da dette er
7.f2  * K000              erstattet av andre funksjoner i NX.
7.f3  * K000  300621 bsa  Rettelser på visning av skjermbilde med
7.f3  * K000              forskuddsbetaling.
      *
7.06  *K00    100321 sst  Eget program for spørring/vlg på økonomisuystem
7.07  *K00    270421 sst  Utvidet ekst. Øksystem til 2 siffer ved å benytte
7.07  *                   FAAK08 som 1. skiffer og FAAK03 som 2. siffer
7.08  *       281021 mst  Ny kode 12 = Visma NET
7.09 A*       070922 MST  Kode for økonomisystem er lagt ut i fil XTILPF
7.09 A*                   Ingen endring i DDS, endring skjer i RPG program
      *
8.01  *800    281122 ask  Lagt inn ny løsning for valg av økonomisystem
8.01  *                   Gammel løsning slettet uten merking for oversiktlighet
8.02  *800    300124 bsa  Fjernet test på modul ved forskudd/depositum
8.03  *800    290125 ask  Fjrenet løsning for valg av økonomisystem fra 8.01
8.03  *                   Gått tilbake til løsning med bruk av to felter i FSTSPF
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
     ffstslu    uf a e           k disk    rename(fstspfr:fstslur)
7.03 frscdl1    if   e           k disk    rename(rscdpfr:rscdl1r)
7.03 frscdlu    uf a e           k disk    rename(rscdpfr:rscdlur)
7.03 faftpl1    if   e           k disk    rename(aftppfr:aftpl1r)
7.fb ffst2l1    if   e           k disk    rename(fst2pfr:fst2l1r)
7.fb ffst2lu    uf a e           k disk    rename(fst2pfr:fst2lur)
7.fb famodl1    if   e           k disk    rename(amodpfr:amodl1r)
7.06 frb00l1    if   e           k disk    rename(rb00pfr:rb00l1r)
7.06 frb00lu    uf a e           k disk    rename(rb00pfr:rb00lur)
      *
     ffv102d    cf   e             workstn
      *
7.fb d b_for           s              1    inz(*off)
7.fb d amodl1_modu     s                   like(axmodu)
     d w_firm          s                   like(l_firm)
      *
     d                uds
6.10 d l_user                911    920
7.03 d l_filg                931    933
7.06 d  l_firm               944    946  0
     d  l_fnav               951    980
      *
7.03 d w3stop          s              8
7.03 d w_m50           s             50
7.03 d aftpl1_firm     s                   like(affirm)
7.03 d aftpl1_navn     s                   like(afnavn)
7.06 d rb00l1_fir      s                   like(r00fir)
7.06 d rb00l1_typ      s                   like(r00typ)
7.06 d rb00l1_kod      s                   like(r00kod)
7.03 d w_kod           s              2  0
8.03 d w_a2ak03        s              2
8.03 d w_faak03a       s              1
8.03 d w_faak08a       s              1
8.03 d w_faak03        s              1  0
8.03 d w_faak08        s              1  0
7.06  *
7.06 d p_valg          s              2
7.06 d p_text          s             15
8.03
8.03 C/Exec SQL
8.03 C+  Set Option DatFmt=*ISO, commit=*none, DlyPrp=*YES
8.03 C+  , SRTSEQ=*LANGIDSHR, LANGID=NOR
8.03 C/End-Exec
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  a1bld behandle bildet for valg                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     a1taga        tag
      *
      *  hent opplysninger fra ofak-kode-register
      *
     c     stskey        chain     fstsl1                             90
     c     *in90         ifeq      *off
     c                   move      faabnd        a1abnd
     c                   move      faamva        a1amva
     c                   move      faades        a1ades
     c                   move      faahoy        a1ahoy
     c                   move      faaman        a1aman
3.31 c                   move      faanxt        a1anxt
6.11 c                   move      faabeh        a1abeh
6.20 c                   move      faalbe        a1albe
6.21 c                   move      faalds        a1alds
6.21 c                   move      faabfs        a1abfs
3.31  *                  move      faapop        a1apop
     c                   move      faalag        a1alag
     c                   move      faahla        a1ahla
5,70 c                   move      faavty        a1avty
6.21 c                   move      faasak        a2asak
6.21 c                   move      faasa1        a2asa1
6.21 c                   move      faasa2        a2asa2
6.21 c                   move      faasao        a2asao
6.21 c                   move      faafsl        a2afsl
6.21 c                   move      faassv        a2assv
6.22 c                   move      faamsa        a2amsa
6.23 c                   move      faak01        a2ak01
6.31 c                   move      faak04        a2nxut
q.02 c                   move      faak06        a1ak06
q.02 c                   move      faak07        a1ak07
7.06  *
7.fb c     stskey        chain     fst2l1
7.fb c                   if        %found(fst2l1)
7.fb c                   eval      a4ak11 = faak11
7.fb c                   eval      a4ak12 = faak12
7.fb c                   eval      a4amap = faamap
7.fb c                   eval      a4akbs = faakbs
7.fb c                   eval      a4atjp = faatjp
7.fb c                   eval      a4atjb = faatjb
7.fb c                   eval      a4afbk = faafbk
7.f1 c                   eval      a4aprp = faaprp
7.f1 c                   eval      a4aprn = faaprn
7.fb c                   endif
     c                   else
     c                   move      *blank        a1abnd
     c                   move      *zero         a1amva
     c                   move      *zero         a1ades
     c                   move      *zero         a1ahoy
     c                   move      *zero         a1aman
3.31 c                   move      *zero         a1anxt
6.11 c                   move      *zero         a1abeh
6.20 c                   move      *zero         a1albe
6.21 c                   move      *zero         a1alds
6.21 c                   move      *zero         a1abfs
3.31 c*                  move      *zero         a1apop
     c                   move      *zero         a1alag
     c                   move      *zero         a1ahla
5,70 c                   move      *blank        a1avty
6.21 c                   move      *zero         a2asak
6.21 c                   move      *zero         a2asa1
6.21 c                   move      *zero         a2asa2
6.21 c                   move      *zero         a2asao
6.21 c                   move      *zero         a2afsl
6.21 c                   move      *zero         a2assv
6.22 c                   move      *zero         a2amsa
6.23 c                   eval      a2ak01 = 0
6.24 c                   eval      a2ak03 = 0
6.31 c                   eval      a2nxut = 0
q.02 c                   eval      a1ak06 = 0
q.02 c                   eval      a1ak07 = 0
7.fb c                   eval      a4ak11 = 0
7.fb c                   eval      a4ak12 = 0
7.fb c                   eval      a4amap = 0
7.fb c                   eval      a4akbs = 0
7.fb c                   eval      a4atjp = 0
7.fb c                   eval      a4atjb = 0
7.fb c                   eval      a4afbk = 0
7.f1 c                   eval      a4aprp = *blanks
7.f1 c                   eval      a4aprn = *blanks
     c                   endif
8.03  *
8.03  * Henter økonomisystem fra to felter i FSTSPF
8.03  *
8.03 c                   eval      a2ak03 = (faak08 * 10) + faak03
8.03 c                   eval      a2ak03txt = 'Ikke funnet'
8.03       exec sql
8.03          select r00txt
8.03            into :a2ak03txt
8.03           from rbokpf
8.03            where r00kod = :a2ak03;
      *
7.fb  *  vis bilde  1:4
      *
     c                   exfmt     a1bld
      *
      *  f3=avslutt
      *
     c     *inkc         cabeq     *on           xslutt
      *
      *
7.fb  *  vis bilde 2:4
6.21  *
     c     starta2       tag
6.21 c                   exfmt     a2bld
7.01  *
7.01 c                   if        *inkg = '1'
7.01 c                   call      'RB100R'
7.06 c                   goto      starta2
7.01 c                   endif
7.01  *
7.04 c                   if        *inke = '1'
7.04 c                   call      'RB101R'
7.06 c                   goto      starta2
7.04 c                   endif
7.06  *  spørring på økonomisystem
7.06 c                   if        *inkd = '1'
     c                   move      a2ak03        p_valg
7.06 c                   call      'FV106R'
7.06 c                   parm                    p_valg
7.06 c                   parm                    p_text
7.06 c                   eval      a2ak03    = %dec(p_valg:2:0)
7.06 c                   eval      a2ak03txt = p_text
7.06 c                   goto      starta2
7.06 c                   endif
7.04  *
7.03 c                   if        *inkf = '1'
7.03 c                   goto      starta3
7.03 c                   endif
7.01  *
6.21  *
6.21  *  f3=avslutt
6.21  *
6.21 c     *inkc         cabeq     *on           xslutt
6.21  *
8.02 c**                 if        b_for = *on
7.f3  *  vis bilde 4:4
7.f3  *
7.f3 c                   exfmt     a4bld
7.f3  *
7.f3  *  f3=avslutt
7.f3  *
7.f3 c     *inkc         cabeq     *on           xslutt
8.02 c**                 endif
6.21  *
      *  oppdater ofak-kode-register
      *
     c     stskey        chain     fstslur                            90
      *
     c                   move      a1abnd        faabnd
     c                   move      a1amva        faamva
     c                   move      a1ades        faades
     c                   move      a1ahoy        faahoy
     c                   move      a1aman        faaman
3.31 c                   move      a1anxt        faanxt
6.11 c                   move      a1abeh        faabeh
6.20 c                   move      a1albe        faalbe
6.21 c                   move      a1alds        faalds
6.21 c                   move      a1abfs        faabfs
3.31  *                  move      a1apop        faapop
     c                   move      a1alag        faalag
     c                   move      a1ahla        faahla
5.70 c                   move      a1avty        faavty
6.21 c                   move      a2asak        faasak
6.21 c                   move      a2asa1        faasa1
6.21 c                   move      a2asa2        faasa2
6.21 c                   move      a2asao        faasao
6.21 c                   move      a2afsl        faafsl
6.21 c                   move      a2assv        faassv
6.22 c                   move      a2amsa        faamsa
6.23 c                   move      a2ak01        faak01
7.09 c*                  move      a2ak03        faak03
6.31 c                   move      a2nxut        faak04
q.02 c                   move      a1ak06        faak06
q.02 c                   move      a1ak07        faak07
7.09 c*                  movel     a2ak03        faak08
7.09 c*                  z-add     a2ak03        xtnumm
7.09 c*                  move      a2nxut        fatnex
      *
     c     *in90         ifeq      *off
6.10 c                   time                    faaeda
6.10 c                   time                    faaeti
6.10 c                   eval      faaeus = l_user
     c                   update    fstslur
     c                   else
     c                   move      l_firm        faafir
6.10 c                   time                    faaoda
6.10 c                   time                    faaoti
6.10 c                   eval      faaous = l_user
6.10 c                   time                    faaeda
6.10 c                   time                    faaeti
6.10 c                   eval      faaeus = l_user
     c                   write     fstslur
     c                   endif
7.f3  *
7.f3 c     stskey        chain     fst2lu
7.f3  *
7.f3 c                   eval      faak11 = a4ak11
7.f3 c                   eval      faak12 = a4ak12
7.f3 c                   eval      faamap = a4amap
7.f3 c                   eval      faakbs = a4akbs
7.f3 c                   eval      faatjp = a4atjp
7.f3 c                   eval      faatjb = a4atjb
7.f3 c                   eval      faafbk = a4afbk
7.f3 c                   eval      faaprp = a4aprp
7.f3 c                   eval      faaprn = a4aprn
7.f3 c                   if        %found(fst2lu)
7.f3 c                   time                    faaeda
7.f3 c                   time                    faaeti
7.f3 c                   eval      faaeus = l_user
7.f3 c                   update    fst2lur
7.f3 c                   else
7.f3 c                   time                    faaoda
7.f3 c                   time                    faaoti
7.f3 c                   eval      faaous = l_user
7.f3 c                   time                    faaeda
7.f3 c                   time                    faaeti
7.f3 c                   eval      faaeus = l_user
7.f3 c                   write     fst2lur
7.f3 c                   endif
8.03  *
8.03  * Oppdaterer valg av økonomisystem med to felter i FSTSPF
8.03  *
8.03 c                   eval      w_a2ak03  = %editc(a2ak03:'X')
8.03 c                   eval      w_faak03a = %subst(w_a2ak03:2:1)
8.03 c                   eval      w_faak08a = %subst(w_a2ak03:1:1)
8.03 c                   eval      w_faak03  = %dec(w_faak03a:1:0)
8.03 c                   eval      w_faak08  = %dec(w_faak08a:1:0)
8.03       exec sql
8.03          update fstspf
8.03            set faak03 = :w_faak03, faak08 = :w_faak08
8.03            where faafir = :w_firm;
8.03       exec sql commit;
8.03
7.05 c                   goto      xslutt
7.03  *
7.fb  *  vis bilde 3:4
7.03 c     starta3       tag
7.03  *
7.03  *  hent opplysninger fra ofak-kode-register-2
7.03  *
7.03 c     stskey        chain     rscdl1
7.03 c                   if        %found(rscdl1)
7.03 c                   move      rcfaa         a3faa
7.03 c                   move      rchent        a3hent
7.03 c                   move      rcftpa        a3ftpa
7.03 c                   move      rcjnav        a3jnav
7.03 c                   move      rcdagl        a3dagl
7.03 c                   move      rcdag1        a3dag1
7.03 c                   move      rcdag2        a3dag2
7.03 c                   move      rcdag3        a3dag3
7.03 c                   move      rcdag4        a3dag4
7.03 c                   move      rcdag5        a3dag5
7.03 c                   move      rcdag6        a3dag6
7.03 c                   move      rcstov        a3stov
7.03 c                   move      rcstop        a3stop
7.03 c                   move      rcslut        a3slut
7.03 c                   move      rcrepp        a3repp
7.03 c                   move      rcmdag        a3mdag
7.03 c                   move      rcmdan        a3mdan
7.03 c                   move      rcamnd        a3amnd
7.03 c                   move      rcadag        a3adag
7.03 c                   move      rcadan        a3adan
7.03 c                   move      rcedat        a3edat
7.03 c                   move      rcetim        a3etim
7.03 c                   move      rceusr        a3eusr
7.03 c                   else
7.03 c                   move      *blank        a3faa
7.03 c                   move      *blank        a3hent
7.03 c                   move      *blank        a3ftpa
7.03 c                   move      *blank        a3jnav
7.03 c                   move      *blank        a3stat
7.03 c                   move      *blank        a3stat
7.03 c                   move      *blank        a3dagl
7.03 c                   move      *blank        a3dag1
7.03 c                   move      *blank        a3dag2
7.03 c                   move      *blank        a3dag3
7.03 c                   move      *blank        a3dag4
7.03 c                   move      *blank        a3dag5
7.03 c                   move      *blank        a3dag6
7.03 c                   move      *blank        a3stov
7.03 c                   move      *blank        a3stop
7.03 c                   move      *blank        a3repp
7.03 c                   move      *blank        a3mdag
7.03 c                   move      *blank        a3mdan
7.03 c                   move      *blank        a3amnd
7.03 c                   move      *blank        a3adag
7.03 c                   move      *blank        a3adan
7.03 c                   endif
7.03 c                   exfmt     a3bld
7.03  *
7.03 c                   if        *inkc = '1'
7.03 c                   goto      xslutt
7.03 c                   endif
7.03  *    se på ftp-anmodninger
7.03 c                   if        *inkd = '1'
7.03 c                   call      'AF100C'
7.03 c                   endif
7.03  *    sette opp oppdateringsjobb i jobsceduler
7.03 c                   if        *inkf
7.03 c                   if        a3stop = '      '
7.03 c                             or a3stop = '000000'
7.03 c                   eval      w_m50 = 'startklokkeslett for oppdatering +
7.03 c                                     mangler'
7.03 c                   call      'AA005R'
7.03 c                   parm                    w_m50
7.03 c                   else
7.03 c                   eval      aftpl1_firm = faafir
7.03 c                   eval      aftpl1_navn = a3ftpa
7.03 c     aftpl1_key    chain     aftpl1
7.03 c                   if        not %found(aftpl1)
7.03 c                             or  aflocd = ' '
7.03 c                   eval      w_m50 = 'lokal bane mangler i ftp-prameter'
7.03 c                   call      'AA005R'
7.03 c                   parm                    w_m50
7.03 c                   else
7.03  *
7.03 c                   eval      w3stop = %subst(a3stop:1:2) + '.' +
7.03 c                                      %subst(a3stop:3:2) + '.' +
7.03 c                                      %subst(a3stop:5:2)
7.03 c                   call      'FV102C'
7.03 c                   parm                    a3jnav
7.03 c                   parm                    l_filg
7.03 c                   parm                    w3stop
7.03 c                   parm                    aflocd
7.03 c                   endif
7.03 c                   endif
7.03 c                   endif
7.03  *
7.03 c                   if        *inkg = '1'
7.03 c                   call      'FV102C2'
7.03 c                   parm                    l_filg
7.03 c                   endif
7.03  *
7.03  *  oppdater ofak-kode-register
7.03  *
7.03 c     stskey        chain     rscdlur
7.03  *
7.03 c                   move      a3faa         rcfaa
7.03 c                   move      a3hent        rchent
7.03 c                   move      a3ftpa        rcftpa
7.03 c                   move      a3jnav        rcjnav
7.03 c                   move      a3stat        rcstat
7.03 c                   move      a3dagl        rcdagl
7.03 c                   move      a3dag1        rcdag1
7.03 c                   move      a3dag2        rcdag2
7.03 c                   move      a3dag3        rcdag3
7.03 c                   move      a3dag4        rcdag4
7.03 c                   move      a3dag5        rcdag5
7.03 c                   move      a3dag6        rcdag6
7.03 c                   move      a3stov        rcstov
7.03 c                   move      a3stop        rcstop
7.03 c                   move      a3slut        rcslut
7.03 c                   move      a3repp        rcrepp
7.03 c                   move      a3mdag        rcmdag
7.03 c                   move      a3mdan        rcmdan
7.03 c                   move      a3amnd        rcamnd
7.03 c                   move      a3adag        rcadag
7.03 c                   move      a3adan        rcadan
7.03  *
7.03 c                   time                    rcedat
7.03 c                   time                    rcetim
7.03 c                   eval      rceusr = l_user
7.03 c                   if        %found(rscdlu)
7.03 c                   update    rscdlur
7.03 c                   else
7.06 c                   move      l_firm        rcafir
7.03 c                   write     rscdlur
7.03 c                   endif
7.03  *
7.05 c**                 goto      starta3
7.fb  *
8.02 c*                  if        b_for = *on
7.fb  *  vis bilde 4:4
7.fb  *
7.fb c                   exfmt     a4bld
7.fb  *
7.fb  *  f3=avslutt
7.fb  *
7.fb c     *inkc         cabeq     *on           xslutt
8.02 c*                  endif
7.fb  *
7.fb c     stskey        chain     fst2lu
7.fb  *
7.fb c                   eval      faak11 = a4ak11
7.fb c                   eval      faak12 = a4ak12
7.fb c                   eval      faamap = a4amap
7.fb c                   eval      faakbs = a4akbs
7.fb c                   eval      faatjp = a4atjp
7.fb c                   eval      faatjb = a4atjb
7.fb c                   eval      faafbk = a4afbk
7.f1 c                   eval      faaprp = a4aprp
7.f1 c                   eval      faaprn = a4aprn
7.fb c                   if        %found(fst2lu)
7.fb c                   time                    faaeda
7.fb c                   time                    faaeti
7.fb c                   eval      faaeus = l_user
7.fb c                   update    fst2lur
7.fb c                   else
7.fb c                   time                    faaoda
7.fb c                   time                    faaoti
7.fb c                   eval      faaous = l_user
7.fb c                   time                    faaeda
7.fb c                   time                    faaeti
7.fb c                   eval      faaeus = l_user
7.fb c                   write     fst2lur
7.fb c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  avslutt program                                                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c     xslutt        tag
      *
     c                   seton                                        lr
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  subrutine for initiering av program                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c     *inzsr        begsr
      *
      *  redefinering av nøkler
      *
     c     *like         define    faafir        stsfir
      *
      *  key for file : ofak-kode-register
      *
     c     stskey        klist
     c                   kfld                    stsfir
7.fb  *
7.fb  * key for les av moduler nexstep
7.fb  *
7.fb c     amodl1_key    klist
7.fb c                   kfld                    amodl1_modu
7.03  *
7.03 c     aftpl1_key    klist
7.03 c                   kfld                    aftpl1_firm
7.03 c                   kfld                    aftpl1_navn
7.06  *
7.06 c     rb00l1_key    klist
7.06 c                   kfld                    rb00l1_fir
7.06 c                   kfld                    rb00l1_typ
7.06 c                   kfld                    rb00l1_kod
7.06  *
7.06 c     rb00lx_key    klist
7.06 c                   kfld                    rb00l1_fir
7.06 c                   kfld                    rb00l1_typ
      *
      *  legger inn firmanummer i nøkklene
      *
7.06 c                   move      l_firm        stsfir
7.09 c                   move      l_firm        w_firm
7.fb  *
7.fb c                   eval      b_for  = *off
7.fb c                   eval      amodl1_modu = 'forskudd'
7.fb c     amodl1_key    chain     amodl1
7.fb c                   if        %found(amodl1)
7.fb c                   eval      b_for = *on
7.fb c                   endif
      *
     c                   endsr
