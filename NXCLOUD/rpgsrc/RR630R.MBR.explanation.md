# RR630R â€“ Documentation

## Overview

**Program:** RR630R  
**System:** ASOKON  
**Description:** Printing of Result Reports ("Utlisting av resultatrapporter")

This program is a legacy RPG application responsible for facilitating the selection and printing of result reports. It interacts with the user through a display file, validates input, coordinates with several subprograms, and ultimately triggers the print process for a selected report.

---

## Structure and Flow

### 1. File and Data Declarations

- **Display File:**  
  `rr630d` is defined as a workstation (workstn) file for user interaction.

- **Database File:**  
  `rrf0l1` refers to the report register file, accessed via keyed disk access. It is renamed locally for clarity.

- **LDA (Local Data Area) Fields:**  
  Fields (`l_firm`, `l_fnav`) are mapped to specific positions in the LDA, typically for company identification.

- **Working Variables:**  
  - `b_feil`: Error flag for input validation.
  - `w_firm`: Current company number.
  - `p_0rap`, `rrf0l1_0rap`: Report number (used in parameter passing and file access).
  - `w_mld1`, `w_mld2`: Constant messages for user feedback.
  - Other variables (`wactli`, `wactpo`, etc.) are used for message display and inter-program communication.

---

### 2. Main Processing Logic

#### **Opening Screen**

- **Tag: `b1taga`**
  - The initial display (`exfmt b1bld`) solicits user input.
  - If the user presses F3 (exit) or F12 (cancel), the program branches to termination (`goto avslutt`).
  - Otherwise, input validation is performed (`exsr sjekk_input`). Any errors cause the screen to be re-displayed.

#### **Input Validation**

- **Subroutine: `sjekk_input`**
  - Checks if the report number (`b10rap`) is provided.
  - If so, attempts to chain (keyed read) into the report register file (`rrf0l1`) using the company and report number.
  - If not found, sets error indicators and flags for the display file.

#### **Parameter Transfer**

- **Subroutine: `flytt_par`**
  - Copies the input report number (`b10rap`) into the parameter variable (`p_0rap`).

#### **User Feedback**

- Displays a "please wait" message using program `AA006C`, passing position and message text for display.

#### **Inter-Program Coordination**

- **Routine Register Setup**
  - Prepares call parameters to `AP600R` (routine register) and `AP601C` (print control), using fixed values and fields set from the display.

- **Report Printing**
  - Calls `RR631R` with the selected report number to initiate the actual print process.

#### **Program Termination**

- **Tag: `avslutt`**
  - Sets LR (`*INLR`) and returns, ending the program.

---

### 3. Subroutines

#### **`sjekk_input`**  
Validates the report number entered by the user:
- If the field is non-zero, attempts to chain into the report register.
- If not found, sets error indicators for the display (usually to highlight the field and show an error).

#### **`flytt_par`**  
Transfers the selected report number to the parameter variable for use in subsequent calls.

#### **`*inzsr` (Initialization Subroutine)**  
- Receives the report number as an entry parameter.
- Initializes screen fields and working variables.
- Sets up the key list (`klist`) for accessing the report register file.

---

## Interactions and Dependencies

- **Display File (rr630d):**  
  Used for all user interaction.

- **Report Register File (rrf0l1):**  
  Used to validate report numbers and fetch associated data.

- **LDA (Local Data Area):**  
  Used for company context, which is critical for multi-company environments.

- **External Programs:**
  - `AA006C`: Displays a "please wait" message.
  - `AP600R`: Sets up the routine register for the report.
  - `AP601C`: Handles print control tasks.
  - `RR631R`: Performs the actual report printing.

  These programs are likely standard modules in the ASOKON system for workflow and print management.

---

## Business and Domain-Specific Logic

- **Company Context:**  
  The program is company-aware (via `l_firm`), ensuring that all operations are scoped to the current company.

- **Report Selection:**  
  User must enter a valid report number. The program enforces this by checking against the report register.

- **Batch and Print Controls:**  
  The program sets up batch and print parameters, indicating flexibility for background or controlled printing.

- **User Experience:**  
  The program provides real-time feedback (wait messages) and clear error handling, reflecting an emphasis on usability.

---

## Design Notes and Conventions

- **Error Handling:**  
  Uses a combination of flags (`b_feil`, display indicators) for robust input validation and user guidance.

- **Parameter Passing:**  
  Makes extensive use of parameter lists (`parm`) for inter-program communication, a common pattern in legacy RPG applications.

- **Key Lists (`klist`):**  
  Key lists are used for file access, ensuring consistent keyed reads throughout the program.

- **Modularization:**  
  Business logic is separated into subroutines for maintainability.

- **Naming Conventions:**  
  - Prefixes (`w_`, `b_`, `p_`, etc.) denote the purpose and scope of variables.
  - Program and file names are system-standard and may be referenced elsewhere in the application suite.

---

## Summary

RR630R is a user-driven report selection and printing utility within the ASOKON system. It validates user input, manages company context, coordinates with other modules for routine and print setup, and initiates the print process for selected reports. The program emphasizes robust validation, clear user feedback, and modular interaction with other system components.