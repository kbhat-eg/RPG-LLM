# RPG Program VV100R - Explanation and Onboarding Guide

---

## 1. **Program Overview**

- **Purpose**: 
  - Maintenance and management of product (item) master data in an interactive, subfile-driven green screen application.
  - Supports item searching, viewing, creation, editing, copying, and deletion of items.
  - Replaces program `C2BLD` and delegates detail maintenance to subprogram `VV101R`.

- **Typical Usage**: 
  - Operated by end-users (e.g. warehouse/product administrators) to manage items.
  - Integrates with related programs for suppliers, stock, NOBB (Norwegian building product database), language texts, EAN, and more.

- **Features**:
  - Subfile display of items with search/filter and paging.
  - Search by item number, text, NOBB number, or supplier number.
  - Special handling for deleted items and items with warehouse or order connections.
  - Calls various maintenance or inquiry programs for related data.

---

## 2. **File Declarations & Data Structures**

- **Physical/Logical Files**: 
  - `vvsopf`, `vvarlr`, `vvarl1`, ... (representing various views or indexes on item master file)
  - Files for supplier (`rlevl1`), notes (`anotl1`), status (`fstsl1`), etc.

- **Display File**: 
  - `vv100d` (workstation file, subfiles defined for interactive paging).

- **Local Data Area (LDA)**: 
  - Used for company and warehouse context.

- **Variables**: 
  - Used for holding keys, working fields, subfile positions, flags, etc.
  - Many variables are named with a `w_` prefix for "work".

- **Indicators**: 
  - RPG classic indicators (`*IN01-*IN99`) are used for controlling flow, user interface, error signaling, etc.

---

## 3. **Main Control Flow**

- **Initial Screen Loop**:
  - Main interface presents a subfile list of items.
  - Loop handles user function keys for paging, searching, editing, creating, copying, viewing, etc.
  - Special tags (e.g., `b2taga`, `b2tagb`, `avslutt`) and subroutines segment logic.

- **Function Key Handling (`select ... endsl`)**:
  - Each function key (e.g. F3, F4, F5, F9, F13, F21, F23, etc.) is mapped to a subroutine or specific function.
  - Example: F13 triggers `scanning` (search by EAN), F21 toggles "show only deleted items", F23 cycles between search modes.

- **Saving and Restoring Search/Position**:
  - Search and positioning variables hold the user's current view, search, and cursor position.

---

## 4. **Key Subroutines**

- **forny**: 
  - Re-positions subfile view depending on current sequence (sort/order).
  - Calls `clr_subfile` then `crt_subfile` to refresh the display.

- **søk**: 
  - Handles item searching—by group, main group, subgroup, or text.
  - Validates search parameters, calls supporting program(s), and refreshes the subfile.

- **posisjoner**: 
  - Handles positioning (scrolling or jumping to a specific item via text, number, NOBB, or supplier nr).

- **subfile**: 
  - Main subfile handler for displaying and interacting with the list.
  - Responds to edit, copy, delete, view, maintain language/EAN, and other actions per subfile row.

- **xc1bld**: 
  - Handles creation of a new item, with duplicate detection.

- **xc2bld**: 
  - Handles item maintain/view logic.
  - Calls `VV101R` for item detail maintenance.
  - Updates subfile row with latest info from item master.

- **xd1win / xd1msg**: 
  - Handles deletion of an item with checks for warehouse/order dependencies.
  - Prompts user for confirmation if inventory exists; otherwise calls `VV400R` for delete operation.

- **xk1win**: 
  - Handles item copy function.
  - Validates new item number, checks for existing items, and invokes creation logic.

- **clr_subfile, crt_subfile**: 
  - Clears and rebuilds the subfile content, based on the current sequence/search mode.

- **bck_subfile**: 
  - Handles subfile page-back (i.e., scrolling up/back a page).

- **dsp_subfile**: 
  - Handles displaying the subfile and processing user corrections.

- **spørring**: 
  - Interactive "inquiry" popups for selecting or looking up item groups.

- **scanning**: 
  - Initiates item search/maintenance by EAN number (barcode handling).

- **sjekk_vsor**: 
  - Checks if item is a central warehouse item (for color/formatting).

- **vis_nobb**: 
  - Calls program to show NOBB information for the item.

- **finn_logivar**: 
  - Finds logistics information for correct price provider.

---

## 5. **Subfile and Paging Logic**

- **Subfile Fields**:
  - Uses variables such as `w_srrn`, `w_sfrn`, `w_ssrn`, etc., to control subfile paging.
  - Typical paginated interface (`c_sfil` = page size, e.g. 10).

- **Search and Positioning Modes**:
  - Different search and scrolling methods are supported and remembered per user.

- **Write and Read of Subfiles**: 
  - Data is loaded in pages to the subfile; on each interaction, changes can be written back.
  - Clear and rebuild subfile on new search/position.

---

## 6. **Integration With Other Programs**

- **Item maintenance/details**: 
  - `VV101R` (create/update/maintain items)
- **Delete routines**: 
  - `VV400R` (delete item and its relationships)
  - `VV490R` (check if item can be deleted)
- **Note maintenance**: 
  - `VS100R`, `VV126R` (notes, language texts)
- **EAN maintenance**: 
  - `VE515R`, `VE710R` (EAN code lookup, maintenance)
- **NOBB**: 
  - `AP633R` (view NOBB info)
- **Warehouse/stock**: 
  - `LL100R`, `LL502R`, `VL720R` (warehouse details, stock, out-of-date check, etc.)

---

## 7. **Special Field Logic**

- **Deleted Items**:
  - Items marked with out-of-date dates are shown with "** UTGÅTT **" or "**NOBB.UTG**" in item text.
  - F21 toggles "show only deleted".

- **Indicators**:
  - E.g., `*IN80-*IN82` for search/positioning mode, `*IN83` for "note exists" indicator, `*IN50` for central warehouse, etc.

- **Central Warehouse and Pricing**:
  - Additional checks and indicators for central warehouse items (color formatting, price provider).

---

## 8. **SQL Integration**

- **Embedded SQL**:
  - Used for advanced search in subfile (when searching by text).
  - SQL cursors for different group levels, using declared and opened/closed cursors as needed.

- **Set SQL Options**:
  - `datfmt=*ISO`, `dlyprp=*YES`, etc.

---

## 9. **Extensibility and Customization**

- **Change History**:
  - Extensive in-code changelog shows how the program has been adapted over time (e.g. new searches, field expansions, NOBB integration, GUI changes).

- **Modular Design**:
  - Use of subroutines and external calls makes it relatively easy to patch in new maintenance or inquiry programs.

---

## 10. **Tips for New Developers**

- Familiarize yourself with RPG indicators and subfile pattern.
- Each user interface screen is controlled by an "exfmt" or "write" operation within a subroutine—track navigation through TAG and GOTO statements.
- Key lists (`klist`) are essential for file access and searching; see the *inzsr subroutine for their setup.
- Cross-program interactions are many; when debugging or enhancing, check which external program is being called for a function.
- Business logic around deleted items, warehouse inventory, and central warehouse status is critical for correct operation.
- For paging/searching, understand that subfile is (re)built and refreshed on nearly every navigation or search.

---

## 11. **Key Abbreviations and Codes**

- `vvarl*` = Different logical views/index over item file.
- `b1sfl` = Subfile record.
- `b2ctl`, `b2cmd` = Subfile control / command records.
- `*ink*`, `*in10`, etc = Standard RPG indicators for function keys and UI status.
- `*on`, `*off` = Boolean values for flags.

---

## 12. **Summary**

This program is a classic IBM i subfile-based item management interface. It’s highly integrated with other programs and relies on classic RPG techniques (indicators, tags, subfile paging). Understanding its navigation, subfile management, and modular maintenance logic is key for onboarding and extending its functionality.

> **For new developers:**  
> Start by tracing a user scenario (such as searching for and editing an item) in the source code. Notice the subroutines called on each action and how the display/subfile is refreshed.  
>  
> Next, study indicator usage and how external program calls supply or validate the data.  
>  
> Using the change history and in-line comments, you can get a sense of living history and frequent points of extension.  
>  
> When in doubt, run it in debug mode and step through the main screen loop!

---

This explanation should give you a solid orientation to start working confidently with the VV100R source code.