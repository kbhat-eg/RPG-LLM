```markdown
# Program LX710R – “Flytter lagerinformasjon mellom lagre”

## 1. Header-specifikasjoner
- `option(*nodebugio)`: Slår av debug-IO for bedre ytelse.  
- `datedit(*dmy)`: Datoformat dag-måned-år.

## 2. Files og eksterne strukturer
- **fvlagl2**  
  – Fil i ekstern bibliotek (disk), lesbar med primærnøkkel.  
  – Originalt navn `vlagpfr`, gir lokal alias `vlagl2r`.  
- **fvlaglu**  
  – Oppdaterbar fil i samme bibliotek, skriver til `vlagpfr`, alias `vlaglur`.

## 3. Lokale dataområder
- **Local data area (uds)**  
  – `l_user` (posisjon 911–920): Brukerident for sporing.

## 4. Feltvariabler
- **Nøkkelvariabler**  
  – `vlagl2_lage`, `vlaglu_vare`, `vlaglu_lage`: speiler felter i lagerfilene.  
- **Globale hjelpevariabler (prefikset `w_`)**  
  – w_firm, w_mini, w_maks, w_ltid, w_bpun, w_bmin, w_bmen, w_sikl,  
    w_vare, w_enhl: midlertidig kopiering av kildeverdier.

## 5. Hovedprogramflow
1. Kall på `EXSR flytt_lager`  
2. Sett `*INLR = *ON` og return.

## 6. Subrutine FLYTT_LAGER
1. Initialiser kildelagernøkkel:  
   ```rpg
   eval vlagl2_lage = 99
   setll vlagl2
   reade vlagl2
   ```
2. Løkke gjennom alle poster (DO … ENDDO) inntil EOF.
3. **Filtrering**  
   - Hopper over hvis alle kvantiteter (`vlmini`, `vlmaks`, …, `vlsikl`) er null.
4. **Snapshot av kildedata**  
   - Kopierer kildeverdier til `w_`-variabler for senere bruk.
5. **Oppdatering/ny oppføring i destinasjonslager (lage = ‘02’)**  
   a. Sett opp søkenøkkel:
      ```rpg
      eval vlaglu_vare = vlvare
      eval vlaglu_lage = 02
      chain vlaglu
      ```
   b. Hvis post finnes (`%FOUND`):
      - Gjenopprett alle ikke-null felt fra `w_`-kopien.
      - Oppdater tid og bruker:
        - Versjon 6.10: `time vledat`, `time vletim`, `eval vleusr = l_user`
        - Versjon 6.20: tillegg `vlfeda`, `vlfeti`, `eval vlfeus = l_user`
      - `UPDATE vlaglur`
   c. Hvis post ikke finnes:
      - `CLEAR vlaglur`
      - Populer alle felter (firma, lager, vare, enhet, kvantiteter, tid/sporingsfelt).
      - `WRITE vlaglur`
6. Les neste post i kildefilen med `READE vlagl2` og fortsett til EOF.

## 7. Nøkkeldefinisjoner (under *inzsr)
- **vlagl2_key** (for lesing):  
  – Felter: `w_firm`, `vlagl2_lage`
- **vlaglu_key** (for oppdatering):  
  – Felter: `w_firm`, `vlaglu_vare`, `vlaglu_lage`
- Initialisering av `w_firm = 000`.

---

**Oppsummert:** Programmet leser alle poster fra lager 99, filtrerer ut de med alle nullverdier, og “flytter” eller “kopierer” lagerdata over i lager 02 ved å oppdatere eksisterende eller opprette nye poster, samtidig som det håndterer tidsstempler og brukersporing.