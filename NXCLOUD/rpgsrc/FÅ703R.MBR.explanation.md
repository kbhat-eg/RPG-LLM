# Documentation: ASOFAK - Common Routine for Retrieving Payment Terms

## Overview

This program serves as a shared routine (`fellesprogram`) within the ASOFAK system, responsible for retrieving payment term details—specifically, the due date and descriptive text—based on a given date and payment terms code. The program acts as a wrapper that delegates the core business logic to another program in the financial system (`RS203R`), standardizing the interface for other applications/modules.

## Purpose

- **Input:** Company, payment terms code, and a reference date.
- **Output:** Payment status, due date, descriptive texts, and up to three reminder dates.
- **Delegation:** Calls `RS203R` in the financial subsystem to perform the actual calculation and retrieval of payment term information, ensuring that all business logic remains centralized and consistent.

## Structure

### Parameter Definitions

The program uses several parameters, most of which are passed both to and from the called program:

| Parameter | Type                  | Description                                            |
|-----------|-----------------------|--------------------------------------------------------|
| `p_firm`  | Packed(3,0)           | Company identifier (not passed to RS203R; see below)   |
| `p_betb`  | Packed(2,0)           | Payment terms code                                     |
| `p_dato`  | Date (*ISO)           | Reference date for calculation                         |
| `p_stat`  | Char(1)               | Status code (output)                                   |
| `p_ffda`  | Date (*ISO)           | Due date (output)                                      |
| `p_txt1`  | Char(20)              | Payment terms description 1 (output)                   |
| `p_txt2`  | Char(20)              | Payment terms description 2 (output)                   |
| `p_rda1`  | Date (*ISO)           | Reminder date 1 (output)                               |
| `p_rda2`  | Date (*ISO)           | Reminder date 2 (output)                               |
| `p_rda3`  | Date (*ISO)           | Reminder date 3 (output)                               |

> **Note:** `p_firm` is part of the entry parameter list but is not passed to `RS203R`. This suggests company context is managed elsewhere or not needed by `RS203R`.

### Main Logic

1. **Initialization (`*INZSR` Subroutine):**
   - Receives all input parameters via the entry parameter list (`*ENTRY PLIST`).
   - Initializes output parameters:
     - Sets status to off (`*OFF`), text fields to blank, and due date to lowest value (`*LOVAL`).
   - Ensures a clean state before any business logic executes.

2. **Delegation to Financial System:**
   - Calls external program `RS203R` with relevant parameters (except `p_firm`).
   - `RS203R` is responsible for:
     - Calculating the due date based on the payment terms code and reference date.
     - Returning payment status, descriptive texts, and up to three reminder dates.
   - This call encapsulates all business rules and ensures consistency across the system.

3. **Program Termination:**
   - Sets LR indicator (`*INLR = *ON`) to end the program.
   - Returns control to the caller.

### Program Flow

1. **On program entry:** Parameters are received and output fields are initialized.
2. **Delegation:** The core logic is performed by `RS203R`.
3. **Output:** The results from `RS203R` are returned to the caller via the parameter list.

## Design Decisions & Conventions

- **Wrapper Pattern:** This program acts as a thin wrapper, abstracting the call to `RS203R` and providing a stable interface for consumers.
- **Initialization:** Output parameters are explicitly initialized to safe defaults before the external call, preventing propagation of stale or garbage values.
- **Parameter Passing:** All data is passed via the parameter list, following a strict order to ensure compatibility with external programs.
- **Date Format:** All date fields use *ISO format, aligning with modern standards and simplifying date arithmetic and interoperability.
- **Extensibility:** By not embedding business logic here, any changes in payment term calculation only require updates to `RS203R`, not this wrapper.

## Interactions with Other Modules

- **RS203R:** The only external dependency. All business rules regarding payment terms reside there. Any changes in payment logic must be coordinated with the maintainers of `RS203R`.
- **Consumers:** Any module needing payment term calculations should use this program as the standard interface.

## Business/Domain Context

- **Payment Terms Management:** This routine standardizes how payment terms are looked up and communicated throughout the ASOFAK system, supporting consistent financial processing.
- **Multi-language/Localization:** The presence of two text fields for descriptions suggests support for multiple languages or extended descriptions.
- **Reminder Dates:** The inclusion of up to three reminder dates reflects business processes around payment reminders and collections.

## Summary

- **ASOFAK:** Shared routine for payment terms lookup.
- **Delegates logic** to `RS203R` in the financial system.
- **Initializes outputs** to safe defaults.
- **Returns** due date, status, descriptions, and reminder dates based on payment terms code and reference date.
- **Centralizes business logic** for maintainability and consistency.

For any enhancements or troubleshooting, changes should typically be made in `RS203R`, not this wrapper. Always ensure parameter order and data formats remain consistent with the contract established here.