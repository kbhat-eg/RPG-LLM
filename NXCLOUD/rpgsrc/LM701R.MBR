     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : LM701R
      * Beskrivelse . . : Henter inn høyste status fra loggfilen
      *
      * Spesialversjon. :
9.01  * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       180412 bof  Nytt program
6.nu  * R6.30 110614 bof  Sjekket mtp. nummerutvidelse
7.01  *       020217 bof  kode 5 skal ikke telles her.
7.01  *                   Var i spes hos N50, inn i std.
7.02  *       170321 bof  skrevet om til sql
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
3.32 fllogl1    if   e           k disk    rename(llogpfr:llogl1r)
      *
      * Definering av parametre
      *
     d p_numm          s                   like(lmnumm)
     d p_suff          s                   like(lmsuff)
     d p_kode          s                   like(lmkode)
      *
      * Definering av Local data area (LDA)
      *
     d                uds
     d l_wsid                901    910
     d l_user                911    920
     d l_firm                944    946  0
      *
      * Definering av variable i nøkler
      *
     d llogl1_numm     s                   like(lmnumm)
     d llogl1_suff     s                   like(lmsuff)
     d llogl1_kode     s                   like(lmkode)
      *
      * Definering av variable
      *
     d w_firm          s                   like(lmfirm)
7.02 d w_numm          s                   like(lmnumm)
7.02 d w_suff          s                   like(lmsuff)
7.02 d w_kode          s                   like(lmkode)
7.02 d b_eof           s              1    inz(*off)
      *
     C/Exec SQL
     C+  Set Option DatFmt=*ISO
     C/End-Exec
      *
      * Hoved - logikk
      * --------------------------------------------------------------------
      *
      * Finner siste transaksjon i loggfilen
      * og returnerer tilhørende statuskode
      *
7.02 c                   exsr      hent_logg2
      *
     c                   goto      avslutt
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     avslutt       tag
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for henting av siste transaksjon i logg - file
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
7.02 c     hent_logg2    begsr
7.02  *
7.02 c                   eval      w_kode = *blank
7.02 c                   eval      w_suff = 0
7.02 c                   eval      w_numm = 0
7.02 c/exec sql
7.02 c+ close logg
7.02 c/end-exec
7.02  *
7.02 c/exec sql
7.02 c+ declare logg  cursor for
7.02 c+ select lmnumm,
7.02 c+        lmsuff,
7.02 c+        lmkode
7.02 c+       from   llogpf
7.02 c+        where  lmfirm = :w_firm and
7.02 c+               lmnumm = :p_numm and
7.02 c+               lmsuff = :p_suff
7.02 c+ order by   lmfirm, lmnumm, lmsuff, lmkode desc
7.02 c+ for read only
7.02 c+
7.02 c/end-exec
7.02 c/exec sql
7.02 c+ open logg
7.02 c/end-exec
7.02  *
7.02 c                   eval      b_eof = *off
7.02  *
7.02 c                   dow       b_EOF = *off
7.02  *
7.02 c/exec sql
7.02 c+ fetch logg
7.02 c+ into  :w_numm,
7.02 c+       :w_suff,
7.022c+       :w_kode
7.02 c/end-exec
7.02  *
7.02 c                   if        sqlcod = 100 or sqlstt = '02000'
7.02 c/exec sql
7.02 c+  close logg
7.02 c/end-exec
7.02 c                   leave
7.02 c                   endif
7.02  *
7.02 c                   if        w_kode <> '5'
7.02 c                   eval      p_kode = w_kode
7.02 c                   leavesr
7.02 c                   endif
7.02  *
7.02 c                   enddo
7.02 c                   if        w_numm = p_numm and
7.02 c                             w_suff = p_suff
7.02 c                   eval      p_kode = w_kode
7.02 c                   endif
7.02 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_numm
     c                   parm                    p_suff
     c                   parm                    p_kode
      *
      * Key for logg - filen
      *
     c     llogl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    llogl1_numm
     c                   kfld                    llogl1_suff
     c                   kfld                    llogl1_kode
      *
     c                   eval      w_firm = l_firm
      *
     c                   endsr
