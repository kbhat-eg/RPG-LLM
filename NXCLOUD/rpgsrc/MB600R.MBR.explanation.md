```markdown
## Overview

This RPG/400 program (`LL600R`) is designed for handling and validating the selection criteria for printing an ABC analysis. It displays a selection screen to the user, validates their input, supports "lookup" (lookup/call other programs for further information), and prepares a parameter structure for the actual print process. If the user chooses to exit or completes valid input, the program returns control and parameters back to the caller.

---

### File Definitions

- **Physical/Logical Files:**
  - `rlevl1` and `vshel1`: Database files accessed with keys, renamed for internal use.
  - `mb600d`: Workstation (display file) for user interaction.

---

### Data Structures

- **Local Data Area (LDA) Fields:**  
  - `l_firm`: Company's firm number.
  - `l_fnav`: Company's name.

- **Parameter Record (`p_prec`):**  
  - 128-character field with overlays for various selection criteria such as ABC class, group ranges, supplier number, assortment, etc.
    - `p_fabc`/`p_tabc`: From/To ABC classification.
    - `p_fogr`/`p_togr`: From/To overgroup.
    - `p_fhgr`/`p_thgr`: From/To main group.
    - `p_fugr`/`p_tugr`: From/To subgroup.
    - `p_levn`: Supplier number.
    - `p_vsor`: Assortment.
    - etc.

- **Work Variables:**  
  - Used for key values, status flags, temporary texts, etc.

---

### Indicators

Commented documentation explains the indicator conventions:
- KC (F3): Exit.
- LR: Program end indicator.
- 30+: Various error/protection indicators.
- 70-99: Work/file indicators.

---

### Main Processing (`A1BLD` Section)

1. **Display Selection Mask:**  
   - `EXFMT a1bld` displays the screen and waits for user input.

2. **Handle User Actions:**
   - **F3 (Exit):**  
     If F3 pressed (`*INKC`), set exit flag and end the program.
   - **F4 (Lookup):**  
     If F4 pressed (`*INKD`), run subroutine `SP_INPUT` for lookup and re-display selection mask.
   - **Input Validations:**  
     - From values must not be greater than To values (ABC, Overgroup, Main group, Subgroup).
     - ABC from-value must be one of a set of valid codes (AX, AY, AZ, etc.).
     - Supplier entered must exist in the `rlevl1` file.
     - Assortment entered must exist in the `vshel1` file (potentially dependent on warehouse selection).

3. **On Error:**  
   - Set the appropriate *IN indicator (30, 32, 33, etc.), and re-display the mask for user correction.

4. **Valid Input:**  
   - Copy user selections into the parameter data structure (`p_*` fields) and store in `w_parm` to be returned to caller.

---

### End Program

- The `end_pgm` tag sets the last record indicator (`*INLR`) and returns.

---

### Subroutine: `sp_input`

Handles F4 "lookup" requests for each field:
- Calls out to other programs (`VG510R`, `VG511R`, `VG512R`, `RL500R`, `VC500R`, `RA510R`) depending on which field the cursor was at (field identifier in `wactfe`).
  - These programs are typically selection lists or lookups for code/value validation.
  - Pass required parameters and update the corresponding fields based on return values.

---

### Subroutine: `*inzsr`

Initialization routine:
- Builds key lists used later for database lookups.
- Sets up input and output parameter lists for the program.
- Sets default values for the selection mask fields (ABC, group ranges, etc.)—these are the values the user sees when the screen appears the first time.

---

### Comments/Revision History

- The comments at the top provide a long revision history with notes about functional enhancements and adaptations.

---

## Summary Flow

1. **Initialization:** Set up keys/defaults and accept parameters.
2. **User Input:** Display selection criteria mask.
3. **Validation:** Check every selection for logical validity and existence in underlying files.
4. **Lookups:** Support for value lookup via F4 (field-specific).
5. **Prepare Parameters:** Bundle validated selections for print program.
6. **Program End:** Return results/parameters to the caller.

---

## Notable Points

- **Overlay Technique:**  
  The parameter structure uses overlays to map subfields onto a single 128-byte area, making passing/receiving parameters efficient.
- **Modular Validation:**  
  Each selection can be checked for validity or detailed via external programs, using structured field IDs.
- **Error Handling:**  
  Indicators and GOTO patterns route the user back to correct erroneous input.
- **Scandinavian/Norwegian variable names:**  
  Field names and comments are in Norwegian, e.g., `lager` (warehouse), `leverandør` (supplier), `varesortiment` (assortment).

---

## Onboarding for Developers

- **User Interface:**  
  All interaction is via a display file (`mb600d`), presenting a selection mask that the user fills in.
- **Extending Validation or Fields:**  
  To add new validation, extend checks under the `A1BLD` section. To add new fields, extend the parameter DS and mask.
- **External Program Calls:**  
  Lookups are done via CALL/PARM to other RPG programs, which return additional info or allow the user to select values.
- **Indicator Management:**  
  Proper use of indicators is crucial for controlling screen flow and error messages.

---
```