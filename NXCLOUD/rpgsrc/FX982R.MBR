      /TITLE  Fix : konv. noen spes. tegn på vvarpf
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  System  . . . . : ASVADM
      *  Program . . . . : jv981R
      *  Beskrivelse . . : Leser hele vvarPF og konv. spes.tegn som
      *                    skaper problemer
      *                    Denne leter først etter tegn før den oppdatere
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
      *  Referanse  Dato   Endringsbeskrivelse                     Sign.
      * --------- ------  --------------------------------------------------
      *           081111  Nytt program                             BOF
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fvvarlu    uf   e           k disk    rename(vvarpfr:vvarlur)
      *
     d w_firm          s                   like(vvfirm)
     d vvarlu_vare     s                   like(vvvare)
     d w_tek1          s                   like(vvtek1)
     d w_tek2          s                   like(vvtek2)
     d pos1            s              4  0
     d pos2            s              4  0
     d b_sokfl         s              1    inz(*off)
      *
      *  UDS Local Data Area
      *
     d                uds
     d l_firm                944    946  0
      *
      *  Definering av variable i nøkler
      *
      *
      *  Definering av variable
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
      *  Lese file
      *
     c                   read      vvarl1                                 90
     c                   dow       *in90 = *off
      *
      * søker er "
      *
     c     sok_fler1     tag
     c                   eval      pos1 = %scan('&hy':vvtek1)
     c                   eval      pos2 = %scan('&hy':vvtek2)
     c                   if        pos1 > 0 or
     c                             pos2 > 0
     c                   eval      vvarlu_vare = vvvare
     c     vvarlu_key    chain     vvarlu
     c                   if        %found(vvarlu)
     c                   if        pos1 > 0
     c                   eval      w_tek1 = *blank
     c                   if        pos1 < 30
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"' +
     c                                      %subst(vvtek1:pos1+6)
     c                   else
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"'
     c                   endif
     c                   eval      vvtek1 = w_tek1
     c                   endif
     c                   if        pos2 > 0
     c                   eval      w_tek2 = *blank
     c                   if        pos2 < 30
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"' +
     c                                      %subst(vvtek2:pos2+6)
     c                   else
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"'
     c                   endif
     c                   eval      vvtek2 = w_tek2
     c                   endif
     c                   update    vvarlur
     c                   goto      sok_fler1
     c                   endif
     c                   endif
      *
      *søker etter "
      *
     c     sok_fler2     tag
     c                   eval      pos1 = %scan('&quot;':vvtek1)
     c                   eval      pos2 = %scan('&quot;':vvtek2)
     c                   if        pos1 > 0 or
     c                             pos2 > 0
     c                   eval      vvarlu_vare = vvvare
     c     vvarlu_key    chain     vvarlu
     c                   if        %found(vvarlu)
     c                   if        pos1 > 0
     c                   eval      w_tek1 = *blank
     c                   if        pos1 < 30
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"' +
     c                                      %subst(vvtek1:pos1+6)
     c                   else
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"'
     c                   endif
     c                   eval      vvtek1 = w_tek1
     c                   endif
     c                   if        pos2 > 0
     c                   eval      w_tek2 = *blank
     c                   if        pos2 < 30
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"' +
     c                                      %subst(vvtek2:pos2+6)
     c                   else
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"'
     c                   endif
     c                   eval      vvtek2 = w_tek2
     c                   endif
     c                   update    vvarlur
     c                   goto      sok_fler2
     c                   endif
     c                   endif
      *
      *søker etter '
      *
     c     sok_fler3     tag
     c                   eval      pos1 = %scan('&apos;':vvtek1)
     c                   eval      pos2 = %scan('&apos;':vvtek2)
     c                   if        pos1 > 0 or
     c                             pos2 > 0
     c                   eval      vvarlu_vare = vvvare
     c     vvarlu_key    chain     vvarlu
     c                   if        %found(vvarlu)
     c                   if        pos1 > 0
     c                   eval      w_tek1 = *blank
     c                   if        pos1 < 30
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"' +
     c                                      %subst(vvtek1:pos1+6)
     c                   else
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"'
     c                   endif
     c                   eval      vvtek1 = w_tek1
     c                   endif
     c                   if        pos2 > 0
     c                   eval      w_tek2 = *blank
     c                   if        pos2 < 30
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"' +
     c                                      %subst(vvtek2:pos2+6)
     c                   else
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"'
     c                   endif
     c                   eval      vvtek2 = w_tek2
     c                   endif
     c                   update    vvarlur
     c                   goto      sok_fler3
     c                   endif
     c                   endif
      *
      *søker etter <
      *
     c     sok_fler4     tag
     c                   eval      pos1 = %scan('&lt;':vvtek1)
     c                   eval      pos2 = %scan('&lt;':vvtek2)
     c                   if        pos1 > 0 or
     c                             pos2 > 0
     c                   eval      vvarlu_vare = vvvare
     c     vvarlu_key    chain     vvarlu
     c                   if        %found(vvarlu)
     c                   if        pos1 > 0
     c                   eval      w_tek1 = *blank
     c                   if        pos1 < 32
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"' +
     c                                      %subst(vvtek1:pos1+4)
     c                   else
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"'
     c                   endif
     c                   eval      vvtek1 = w_tek1
     c                   endif
     c                   if        pos2 > 0
     c                   eval      w_tek2 = *blank
     c                   if        pos2 < 32
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"' +
     c                                      %subst(vvtek2:pos2+4)
     c                   else
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"'
     c                   endif
     c                   eval      vvtek2 = w_tek2
     c                   endif
     c                   update    vvarlur
     c                   goto      sok_fler4
     c                   endif
     c                   endif
      *
      *søker etter >
      *
     c     sok_fler5     tag
     c                   eval      pos1 = %scan('&gt;':vvtek1)
     c                   eval      pos2 = %scan('&gt;':vvtek2)
     c                   if        pos1 > 0 or
     c                             pos2 > 0
     c                   eval      vvarlu_vare = vvvare
     c     vvarlu_key    chain     vvarlu
     c                   if        %found(vvarlu)
     c                   if        pos1 > 0
     c                   eval      w_tek1 = *blank
     c                   if        pos1 < 32
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"' +
     c                                      %subst(vvtek1:pos1+4)
     c                   else
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"'
     c                   endif
     c                   eval      vvtek1 = w_tek1
     c                   endif
     c                   if        pos2 > 0
     c                   eval      w_tek2 = *blank
     c                   if        pos2 < 32
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"' +
     c                                      %subst(vvtek2:pos2+4)
     c                   else
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"'
     c                   endif
     c                   eval      vvtek2 = w_tek2
     c                   endif
     c                   update    vvarlur
     c                   goto      sok_fler5
     c                   endif
     c                   endif
      *
      *søker etter &
      *
     c     sok_fler6     tag
     c                   eval      pos1 = %scan('&amp;':vvtek1)
     c                   eval      pos2 = %scan('&amp;':vvtek2)
     c                   if        pos1 > 0 or
     c                             pos2 > 0
     c                   eval      vvarlu_vare = vvvare
     c     vvarlu_key    chain     vvarlu
     c                   if        %found(vvarlu)
     c                   if        pos1 > 0
     c                   eval      w_tek1 = *blank
     c                   if        pos1 < 31
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"' +
     c                                      %subst(vvtek1:pos1+5)
     c                   else
     c                   eval      w_tek1 = %subst(vvtek1:1:pos1-1) + '"'
     c                   endif
     c                   eval      vvtek1 = w_tek1
     c                   endif
     c                   if        pos2 > 0
     c                   eval      w_tek2 = *blank
     c                   if        pos2 < 31
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"' +
     c                                      %subst(vvtek2:pos2+5)
     c                   else
     c                   eval      w_tek2 = %subst(vvtek2:1:pos2-1) + '"'
     c                   endif
     c                   eval      vvtek2 = w_tek2
     c                   endif
     c                   update    vvarlur
     c                   goto      sok_fler6
     c                   endif
     c                   endif
      *
      *
     c                   read      vvarl1                                 90
     c                   enddo
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for oppdatering av vare
      *
     c     vvarlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarlu_vare
      *
      *
      *  Legge inn opplysninger i nøklene
      *
     c                   eval      w_firm = l_firm
      *
     c                   endsr
