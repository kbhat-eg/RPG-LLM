# Documentation: RK625R – Quality Report Printout for Customer Register

## Overview

**Program Name:** RK625R  
**System:** ASOKON  
**Purpose:**  
This program generates a quality report for the customer register (kunderegister). It evaluates customer records based on several quality criteria (such as missing address, contact information, etc.) and prints a report highlighting customers with incomplete or missing key data fields.

---

## File Definitions

- **rkunl1** – Customer master file (disk, keyed, externally described, renamed as rkunl1r).
- **rk625p** – Printer file for quality report output (printer, overflow indicator *IN30).

---

## Key Data Structures and Fields

- **Selection and Control Fields**  
  These fields are used to define the range of customer categories to process and which quality checks to apply:
  - `l_katf`, `l_katt`: From/To customer category (filter range).
  - `l_kadr`, `l_kstd`, `l_kkat`, `l_korg`, `l_kpnr`, `l_kkpe`, `l_kema`, `l_ktlf`, `l_kfax`: Flags ('J' = check enabled) for respective data fields (address, site, category, org#, person#, contact person, email, phone, fax).
- **User and Firm Context**
  - `l_user`, `l_firm`, `l_fnav`: User, firm, and firm name.
  - `w_user`, `w_firm`: Working copies.
- **Internal Work Fields**
  - `w_feil`: Single-character flag indicating if a quality error was found for a record.

---

## Indicator Usage Conventions

- **Function Key Indicators**
  - `KA` = F1 (Select firm)
  - `KC` = F3 (Exit)
- **File and Control Indicators**
  - `LR`: End of program
  - `30`: Field protection/display (used for page overflow)
  - `31-59`: Warnings/messages
  - `60-69`: File indicators (e.g., EOF)
  - `70-99`: Subroutine/working indicators

---

## Main Processing Logic

### Initialization (`*INZSR` Subroutine)

- Initializes working fields (`w_firm`, `w_user`) from input fields.
- Sets the file pointer to the first relevant customer record (`SETLL`).
- Writes the report heading (`head1`).
- Prepares the customer key list (`rkunl1_key`) using `w_firm`.

### Main Loop

1. **Read Next Customer Record**
   - Uses `READE` with key (`rkunl1_key`) and file indicator `*IN60`.
   - Continues while not EOF (`*IN60 = *OFF`).

2. **Category Range Filter**
   - Skips records outside the selected customer category range (`l_katf` to `l_katt`).

3. **Quality Checks**
   - For each enabled field (`l_kadr`, `l_kstd`, etc. set to 'J'), checks if the corresponding customer field is missing or blank.
   - If a field fails its check, marks it with 'X' (e.g., `a1kadr = 'X'`) and sets `w_feil = '1'`.

4. **Report Output**
   - If any quality error is found (`w_feil = '1'`), writes the record to the report (`skriv`).

5. **Page Overflow Handling**
   - If the overflow indicator (`*IN30`) is set, writes a new heading (`head1`) and resets the indicator.

6. **Continue Loop**
   - Reads the next record.

7. **Program End**
   - Sets `*INLR = *ON` to end the program.

---

## Business/Domain-Specific Logic

- **Customer Quality Criteria:**  
  The fields checked correspond to essential customer master data. The program supports configuration of which fields are required for the report by toggling the `l_kxxx` flags.
- **Category Filtering:**  
  Only customers within a specified category range are included, allowing targeted quality audits.
- **Reporting:**  
  Only customers with at least one missing or incomplete required field are printed, focusing the report on actionable data quality issues.

---

## Design Decisions & Conventions

- **Field-Driven Checks:**  
  The use of `l_kxxx` flags allows flexible, parameterized execution, making the program adaptable to different quality requirements without code changes.
- **Indicator Usage:**  
  Follows a strict convention for indicator assignment, aiding maintainability and reducing risk of indicator conflicts.
- **File Access:**  
  Uses keyed access (`READE`, `SETLL`) for efficient processing of large customer files, especially when filtered by firm and category.
- **Output Structure:**  
  The report is designed for exception-based output (only records with errors), optimizing usability for data cleansing tasks.

---

## External Relationships

- **Customer Master File (`rkunl1`)**:  
  Central data source for customer information; likely shared with other modules.
- **Printer File (`rk625p`)**:  
  Output is formatted for printing, suggesting integration into periodic reporting or audit processes.
- **Integration Points:**  
  The program is typically invoked as part of a quality control workflow, possibly from a menu or batch process.

---

## Maintenance Notes

- **Adding New Checks:**  
  To add new quality criteria, extend the `l_kxxx` parameter set and corresponding check logic.
- **Field Definitions:**  
  Ensure that any changes to the customer master file layout are reflected in this program (especially field positions/names).
- **Localization:**  
  The program is designed for Norwegian business context (e.g., field names, comments).

---

## Summary

RK625R is a configurable, exception-driven report program for identifying data quality issues in the customer master. It is parameterized for flexibility, adheres to internal indicator conventions, and is tightly integrated with the customer file and reporting infrastructure. It is intended for use by data stewards or administrators responsible for maintaining high-quality customer data.