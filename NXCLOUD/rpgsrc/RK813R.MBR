     h/TITLE  Utskrift av autogiro - kontroll
     h option(*nodebugio)
     h decedit(',') datedit(*dmy.)
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RK813R                                              *
      * Beskrivelse . . : Utskrift av autogiro-kontroll                       *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
6.10  * V6.10     220909  Lagt inn sporingsfelter                        BSA  *
      *                                                                       *
      *                                                                       *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     frkw4pf    if   e           k disk
     frkunpf    if   e           k disk
     fafirl1    if   e           k disk
     f                                     rename(afirpfr:afirl1r)
     fraa7l1    if   e           k disk    rename(raa7pfr:raa7l1r)
     frkwapf    uf a e           k disk
     frkwcpf    o  a e           k disk
     f                                     rename(rktrpfr:rkwcpfr)
     frk813p    o    e             printer oflind(*in30)
      *
     d kun             s              6  0 dim(10)                              ENKELTKUNDER
     d sub             s              3  0 dim(13)
      *
     d                 ds
     d d_parm                       120
     d  pfirm                         3  0 overlay(d_parm)
     d  pnavn                        30    overlay(d_parm:4)
     d  puser                        10    overlay(d_parm:34)
     d  pkdat                         6  0 overlay(d_parm:44)
     d  praar                         4  0 overlay(d_parm:50)
     d  prper                         2  0 overlay(d_parm:54)
     d  pavdf                         4  0 overlay(d_parm:56)
     d  pavdt                         4  0 overlay(d_parm:60)
     d  pkatf                         4  0 overlay(d_parm:64)
     d  pkatt                         4  0 overlay(d_parm:68)
     d  pself                         4  0 overlay(d_parm:72)
     d  pselt                         4  0 overlay(d_parm:76)
     d  pknrf                         6  0 overlay(d_parm:80)
     d  pknrt                         6  0 overlay(d_parm:86)
     d  pbilf                         6  0 overlay(d_parm:92)
     d  pbilt                         6  0 overlay(d_parm:98)
     d  pfdat                         6  0 overlay(d_parm:104)
     d  palfa                         1    overlay(d_parm:110)
      *
     d w_parm          s            120
     d Åtte0           s              8  0
     d en              s              1
     d fir0            s              4  0
     d kÅrmnd          s                   like(seks0)
     d n               s              3  0
     d pÅrmnd          s                   like(seks0)
     d pdatx           s                   like(Åtte0)
     d prdagx          s                   like(en)
     d seks0           s              6  0
     d to0             s              2  0
     d wÅÅÅÅ           s              4  0
     d warb1           s              4  0
     d wbforp          s             11  2
     d wbfort          s             11  2
     d wbilda          s              6  0
     d wffdat          s              6  0
     d wkjdat          s              6  0
     d wpÅr            s              2  0
     d wpÅr4           s              4  0
     d wpdag           s              2  0
     d wsummr          s                   like(rnbelØ)
     d wtomÅ           s                   like(fir0)
     d wtomd           s                   like(to0)
     d wtomm           s                   like(to0)
     d xiforf          s              6  0
      *
      * Boolske variable til erstatning for *INxx-variable
      *
     d b_firm          s              1    inz(*off)
     d b_kund          s              1    inz(*off)
     d b_bel0          s              1    inz(*off)
     d b_bneg          s              1    inz(*off)
     d b_bilk          s              1    inz(*off)
     d b_saln          s              1    inz(*off)
     d b_rekl          s              1    inz(*off)
     d b_ok            s              1    inz(*off)
      *
     d s_firm          s                   like(rnfirm) inz(999)
     d s_kund          s                   like(rnkund) inz(999999)
      *
6.10 d                uds
6.10 d l_user                911    920
      *
      *  Kundeposteringer
      *
     i*rkw4pfr       02
     i*                                          rnfirm        l4
     i*                                          rnkund        l2
      *
      *  HENT FREM OPPLYSNINGER FRA KODE-REGISTER M.M.
      *
     c     kwakey        setll     rkw4pf
     c                   read      rkw4pf
      *
      *
     c                   if        rnfirm <> s_firm
     c                   eval      aaffir = rnfirm                              FIRMA
     c     keyfir        chain     afirl1
      *
      *  Tar vare på parameter for autogiro
      *
     c                   eval      rwkkey = *blanks
     c                   movel     rnfirm        rwkkey
     c     kwakey        chain     rkwapf
      *
     c                   eval      rwkrec = d_parm
      *
     c                   if        %found
     c                   update    rkwapfr
     c                   else
     c                   write     rkwapfr
     c                   endif
      *
      *  SJEKK OM FIRMAET  SKAL BEHANDLES
      *
     c                   if        rnfirm = pfirm
     c                   eval      b_firm = *on
     c                   else
     c                   eval      b_firm = *off
     c                   endif
     c                   eval      s_firm = rnfirm
     c                   endif
      *
      *  FIRMAET  SKAL IKKE BEHANDLES
      *
     c                   if        b_firm = *off
     c                   goto      slutt
     c                   endif
      *
      *  Finner faste opplysninger - Autogiro
      *
     c     raa7l1_key    chain     raa7l1
      *
     c                   if        %found
     c     ra7anr        add       1             ra7anr
     c                   else
     c                   z-add     1             ra7anr
     c                   endif
      *
     c                   eval      l_nbr = ra7anr
     c                   eval      l_firm = pfirm
     c                   eval      l_navn = aafnav
     c                   write     a1hdr                                30
      *
      *  SNU KJØREDATO FOR KONTROLL AV FORFALLDATO
      *
     c                   eval      wkjdat = pkdat
     c                   move      pkdat         warb1
     c                   movel     pkdat         wpdag
     c                   move      pkdat         wpÅr
     c                   movel     wpÅr          wkjdat
     c                   eval      wkjdat = wpdag
      *
     c                   if        wpÅr > 80
     c     wpÅr          add       1900          wpÅr4
     c                   else
     c     wpÅr          add       2000          wpÅr4
     c                   endif
      *
     c                   dow       not %eof
      *
     c                   if        rnbelØ = 0
     c                   eval      b_bel0 = *on
     c                   endif
      *
      *  SJEKK BRUDD PÅ KUNDE
      *
     c                   if        rnkund <> s_kund
     c                   eval      b_bilk = *off
     c                   eval      b_kund = *off
     c                   if        wbforp > 0
     c                   eval      t1forp = wbforp
     c                   write     t1tot                                30
     c                   if        *in30 = *on
     c                   write     a1hdr                                30
     c                   endif
     c                   endif
      *
      *  BLANK UT DE FELTER SOM LISTES PÅ L2
      *
     c                   z-add     0             wbforp
      *
     c                   endif
      *
      *  SPLITT BILAGSDATO OG FORFALLSDATO
      *
     c                   if        rnbelØ < 0
     c                   eval      b_bneg = *on
     c                   else
     c                   eval      b_bneg = *off
     c                   endif
      *
      *  NULLSTILL AUTOGBELØP - LES KUNDERGISTER
      *
     c                   if        rnkund <> s_kund
     c                   eval      rkkund = rnkund
     c                   movel     rnfirm        rkfirm
     c     rkkey         chain     rkunpf
      *
     c                   if        rksald <= 0
     c                   eval      b_saln = *on
     c                   else
     c                   eval      b_saln = *off
     c                   endif
     c                   eval      s_kund = rnkund
     c                   write     d1det                                30
     c                   if        *in30 = *on
     c                   write     a1hdr                                30
     c                   endif
     c                   endif
      *
     c*                  if        b_saln = *off
     c*                  if        rkf003 = 'N'
     c*                  eval      b_saln = *on
     c*                  endif
     c*                  endif
      *
      *  SJEKK OM REKLAMASJON ELLER 0 I RESTBELØP
      *
     c                   if        rnbilk = 89
     c                   eval      b_rekl = *on
     c                   else
     c                   eval      b_rekl = *off
     c                   endif
      *
     c                   if        b_rekl = *on
     c                   goto      slutt
     c                   endif
      *
     c                   if        b_bel0 = *on
     c                   goto      ut6                                          BELØP NULL
     c                   endif
      *
     c                   eval      b_ok = *on
      *
      *  HVIS SALDO NULL ELLER NEGATIV SKRIVES IKKE AUTOGIRO
      *
     c                   if        b_saln = *on
     c                   eval      b_ok = *off
     c                   endif
      *
      *  AKK.TOTALT FORFALT OG AUTOGIROGRUNNLAG
      *
     c                   if        b_ok = *on
     c                   add       rnvalr        wbforp                         FORFALT SALDO
     c                   add       rnvalr        wbfort                         TOTALLT
     c                   endif
      *
     c     ut6           tag
      *
     c                   if        b_firm = *on
6.10 c*                  time                    rnodat
6.10 c*                  time                    rnotim
6.10 c*                  eval      rnousr = l_user
6.10 c*                  time                    rnedat
6.10 c*                  time                    rnetim
6.10 c*                  eval      rneusr = l_user
     c                   write     rkwcpfr
     c                   endif
      *
     c                   if        b_ok = *on
     c     *dmy          move      rnbdat        d2bdat
     c     *dmy          move      rnfdat        d2fdat
     c                   write     d2det                                30
     c                   if        *in30 = *on
     c                   write     a1hdr                                30
     c                   endif
     c                   endif
      *
     c                   read      rkw4pf
     c                   enddo
      *
     c     slutt         tag
      *
     c                   if        wbforp > 0
     c                   eval      t1forp = wbforp
     c                   write     t1tot                                30
     c                   endif
     c                   eval      t2fort = wbfort
     c                   write     t2tot                                30
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      * Parameterliste
      *
     c     *entry        plist
     c                   parm                    w_parm
     c                   eval      d_parm = w_parm
      *
      *  DEFINISJON AV ARBEIDSFELT
      *
     c                   eval      n = *zeros
     c     999999999     mult      100           wsummr
     c                   eval      wsummr = 99
      *
     c     rnkey         klist
     c                   kfld                    rnfirm
     c                   kfld                    rnkund
     c                   kfld                    rnbdat
     c                   kfld                    rntist
      *
     c     rkkey         klist
     c                   kfld                    rkfirm
     c                   kfld                    rkkund
      *
     c     keyfir        klist
     c                   kfld                    aaffir
      *
     c     kwakey        klist
     c                   kfld                    rwkkey
      *
     c     raa7l1_key    klist
     c                   kfld                    rkfirm
      *
     c                   eval      rkfirm = pfirm
     c                   eval      rnfirm = pfirm
      *
     c                   endsr
      *
