     H DATEDIT(*DMY)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      *  System. . . . . : ASLAGR                                       *
      *  Program . . . . : LI302R                                       *
      *  Beskrivelse . . : Start utkjøring av pakkseddel papirer        *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      *  Spesialversjon. :                                              *
      *  Tilpasset for . :                                              *
      *                                                                 *
      *  Referanse  Dato   Endringsbeskrivelse                     Sign.*
      *  --------- ------  ---------------------------------------------*
7.01  *  7.00 bsa  110919  Nytt program
7.02  *  7.00 bsa  291119  Nytt program som håndteres utskrift/plukking
7.xx  *  K000 bsa  140520  Innfører logging pga feilsøk                 *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
     flstsl1    if   e           k disk    rename(lstspfr:lstsl1r)
     fraa1l1    if   e           k disk    rename(raa1pfr:raa1l1r)
     flpm1lu    uf a e           k disk    rename(lpm1pfr:lpm1lur)
      *
     d                 DS
     d  ldambr                 1     10
     d  ldabok                 1      1
     d  ldafir                 2      4  0
     d  ldalst                 5     10  0
      *
      *
     d                uds
     d  l_wsid               901    910
     d  l_user               911    920
     d  l_firm               944    946  0
      *
      * Definering av nøkler
      *
     d votyl1_otyp     s                   like(vaotyp)
     d lpm1lu_1fir     s                   like(lk1fir)
     d lpm1lu_1wsd     s                   like(lk1wsd)
     d lpm1lu_1usr     s                   like(lk1usr)
     d lpm1lu_1lst     s                   like(lk1lst)
      *
      * Definering av variable
      *
     d wwdato_6        s              6  0
     d wwdato          s               d   datfmt(*iso)
     d WWPERI          s              4  0
     d WWPERI_ALF      s              8
     d w_sp_aar        s                   like(ra1aar)
     d w_sp_mnd        s                   like(ra1per)
     d w_sp_per        s              6  0
     d w_peri          s              6  0
     d w_mnd1          s              2  0
     d w_aar1          s              4  0
     d w_ot02          s                   like(laaot2)
     d w_ot03          s                   like(laaot3)
     d w_ot04          s                   like(laaot4)
     d w_ot05          s                   like(laaot5)
     d w_firm          s              3  0
     d w_numm          s              8  0
     d w_suff          s              2  0
     d w_otyp          s                   like(vaotyp)
     d w_skor          s              1
     d w_dirk          s              1  0
     d w_valg          s              1  0
     d w_outq          s             10
     d wcnumm          s              6  0
     d wcqnnn          s              1
7.xx d w_jnav          s             15
7.xx d w_jkey          s             41
7.xx d w_jtxt          s             35
7.xx d w_jstat         s              2  0
7.xx d w_jtext         s            200
7.xx d w_debg          s              1    inz(*off)
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Velg om det skal kjøres direkte utskrift                       *
      *  Direkte utskrift kjøres dersom bestillingsnummer er utfylt     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c                   if        w_numm <> 0
     c                   goto      f2taga
     c                   endif
      *
     c                   eval      w_dirk = 0
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  F2 Innlegging av periode og faktura-dato                       *
      *     Bildet vises bare dersom akk.type=3                         *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     f2taga        tag
      *
      *  Hent opplysninger fra ORDRETYPE-REGISTER
      *
     c                   eval      votyl1_otyp = w_otyp
     c     votyl1_key    chain     votyl1
      *
      *  Sjekk, Er ikke dette pakkseddel, må vi avslutte
      *
     c                   if        vaoakk <> 2
     c                   goto      xslutt
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  START Behandler danning av parameter før utskrift              *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c     start         tag
      *
      *  Kaller opp subrutine for utlegging av parameter, for
      *  start av utskrift (W_VALG=Internt listenummer fra 0 til 3)
      *
     c                   eval      w_valg = 0
     c                   exsr      param
      *
      *  Hopp ut og start utkjøring, dersom kun en bestilling er valgt
      *
     c                   if        w_numm <> 0
     c                   goto      neste
     c                   endif
      *
      *  PAKKSEDDEL : Subrutinen skal ikke kjøres
      *
     C     VAOAKK        IFEQ      2
     C                   GOTO      NESTE
     C                   END
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  NESTE Kaller opp 'CL'-programmet for å starte utskriften       *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c     nestE         tag
7.xx  *
7.xx  * Vi logger at neste program skal kjøres
7.xx  *
7.xx c                   if        w_debg = *on
7.xx c                   eval      w_jstat = 10
7.xx c                   eval      w_jtext = 'EDI Pakkseddel-call-302C'
7.xx c                   call      'AB705R'
7.xx c                   parm                    w_jkey
7.xx c                   parm                    w_jstat
7.xx c                   parm                    w_jtext
7.xx c                   endif
      *
7.02 c                   call      'LI302C'
     c                   parm                    ldambr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Avslutt program                                                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c     xslutt        tag
      *
7.xx c                   if        w_debg = *on
7.xx  * Avslutt debug - dette programmet
7.xx c                   call      'AB710R'
7.xx c                   parm                    w_jkey
7.xx c                   endif
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Oppdaterer  BESTILLING-PLUKK-PARAM1-REGISTER                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c     param         begsr
      *
     c                   eval      lpm1lu_1lst = w_valg
     c     lpm1lu_key    chain     lpm1lu
      *
     c                   eval      lk1utq = w_outq
     c                   eval      lk1oty = w_otyp
     c                   eval      lk1onr = w_numm
     c                   eval      lk1suf = w_suff
     c                   eval      lk1vg0 = w_dirk
     c                   eval      lk1vg1 = w_valg
     c                   eval      lk1vg2 = 1
     c                   eval      lk1vg3 = 0
      *
     c                   eval      lk1per = *loval
     c                   eval      lk1dat = *loval
      *
     c                   if        %found
     c                   update    lpm1lur
     c                   else
     c                   eval      lk1fir = w_firm
     c                   eval      lk1wsd = l_wsid
     c                   eval      lk1usr = l_user
     c                   eval      lk1lst = w_valg
     c                   write     lpm1lur
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Subrutine for initiering av program                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      *  Nullstilling av felter som ikke kan redefineres
      *
     c                   eval      wcqnnn = *blanks
     c                   eval      wcnumm = 0
      *
      * Key for file : LAGER-STATUS-KODE-REGISTER
      *
     c     lstsl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for file : ORDRETYPE-REGISTER
      *
     c     votyl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    votyl1_otyp
      *
      * Key for file : PLUKK-1-LINJE-REGISTER
      *
     c     lpm1lu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lpm1lu_1wsd
     c                   kfld                    lpm1lu_1usr
     c                   kfld                    lpm1lu_1lst
      *
      * Key for file : Kode - status 1
      *
     c     raa1l1_key    klist
     c                   kfld                    w_firm
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Tar inn parameter fra forrige program                          *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c     *entry        plist
     c                   parm                    w_skor            1
     c                   parm                    w_firm
     c                   parm                    w_numm
     c                   parm                    w_suff
     c                   parm                    w_otyp
     c                   parm                    w_dirk            1 0
     c                   parm                    w_outq
      *
      *  Legger inn opplysninger i nøkklene
      *
     c                   eval      lpm1lu_1wsd = l_wsid
     c                   eval      lpm1lu_1usr = l_user
     c                   eval      ldafir = w_firm
      *
      *  Hent opplysninger fra LAGER-STATUS-KODE-REGISTER
      *
     c     lstsl1_key    chain     lstsl1
     c                   if        %found
     c                   eval      w_ot02 = laaot2
     c                   eval      w_ot03 = laaot3
     c                   eval      w_ot04 = laaot4
     c                   eval      w_ot05 = laaot5
     c                   endif
      *
      *
      *  Henter siste nummer for File-member
      *
     c                   call      'LÅ900R'
     c                   parm                    wcqnnn
     c                   parm                    wcnumm
      *
     C                   eval      ldabok = 'A'
     C                   eval      ldalst = wcnumm
     c     raa1l1_key    chain     raa1l1r
      *
     c                   if        %found(raa1l1)
     c                   eval      W_sp_mnd = ra1per
     c                   eval      w_sp_aar = ra1aar
     c                   eval      w_sp_per = w_sp_aar * 100 + w_sp_mnd
     c                   else
     c                   eval      w_sp_per = *zero
     c                   endif
7.xx  *
7.xx  * Logging av EDI Pakkseddel mottak
7.xx  *
7.xx c                   if        w_debg = *on
7.xx c                   eval      w_jnav = 'EDI Pakkseddel motttak'
7.xx c                   eval      w_jtxt = 'Scanning av SSCC koder på PDA-302'
7.xx c                   eval      w_jkey = *blanks
7.xx c                   call      'AB700R'
7.xx c                   parm                    w_jnav
7.xx c                   parm                    w_jkey
7.xx c                   parm                    w_jtxt
7.xx  *
7.xx  * Vi logger at utskriftprogrammet har startet
7.xx  *
7.xx c                   eval      w_jstat = 10
7.xx c                   eval      w_jtext = 'EDI Pakkseddel-LI302-inzsr'
7.xx c                   call      'AB705R'
7.xx c                   parm                    w_jkey
7.xx c                   parm                    w_jstat
7.xx c                   parm                    w_jtext
7.xx  *
7.xx c                   endif
      *
     c                   ENDSR
