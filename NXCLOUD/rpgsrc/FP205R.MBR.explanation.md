# RPG Program FP205R: Explanation

This program is written in RPG/400 (RPG III or RPG IV/ILE RPG with Fixed Format) for the IBM i platform (AS/400). Its purpose is to select which print routine (program) should be used, based on the type of printer and label selected. The comments and variable names are in Norwegian, and the logic is straightforward. Here’s a breakdown for easy onboarding:

---

## 1. **Header / Comments Section**

- **Program Name:** FP205R
- **System:** ASOFAK
- **Purpose:** Selects (valgs) the appropriate print routine (utskriftsrutine) based on printer and label choices.
- **Printer Types:** Coded in `LCSKTY` (0-6), e.g., various Meto, Zebra, Datamax models.
- **Label Choices:** Coded in `LCVALG` (1–9), each representing a specific label size/type.
- **Output:** The selected print program name is written to field `LCPROG`.

---

## 2. **File Specification (`F`)**

```rpg
Fvfaspf    if   e           k disk
```
- **File Name:** `vfaspf`
- **Usage:** Input/Output, Full procedural, Externally described, Keyed access, Disk file.

---

## 3. **D-Specs (Definition of Variables / Data structure)**

Here, fields from a data area or buffer are mapped to RPG variables. These are character positions in a structure (commonly from a user space (UDS) or data area).

Typical fields:
- **lcvalg, lcetpr, lcken1, lcken2, lcdato:** Label selection and related information.
- **lctype:** Printer type.
- **lcruti:** Name of the print routine.
- **lcuser, lcfirm, l_fnav:** User, firm, and other info.
- **faskey:** Key for file access.

---

## 4. **C-Specs (Calculation Specifications) — Logic**

### a. **Initialize and Retrieve Printer Info**
```rpg
C                   eval      faskey = *zero
C                   move      lcfirm        faskey
C     faskey        chain     vfaspf                             60
```
- Sets up the key (`faskey`) from `lcfirm` (firm number).
- `chain` instruction fetches the printer info from file `vfaspf` using `faskey`.
- If not found (`*in60 = *on`), set `lctype` to zero (no printer type).
- If found, move `vnskty` (printer type from file) to `lctype`.

### b. **Clear label status fields**
```rpg
C                   eval      lcetpr = *zero
C                   eval      lcken1 = *zero
C                   eval      lcken2 = *zero
```
- Resets label-related status fields.

### c. **Select Print Routine Based on Label Type**
Checks the value of `vnetyp` (label selection) and sets `lcruti` (print routine name) accordingly:

| `vnetyp` | Label Type                              | Print Routine (`lcruti`) |
|----------|-----------------------------------------|--------------------------|
| 1        | Prisetiketter (Price labels)            | 'FP213 '                 |
| 2        | Hylle-etikett 75x28 mm                  | 'FP214 '                 |
| 3        | Hylle-etikett 100x28 mm                 | 'FP215 '                 |
| 4        | Reol-etikett 202x60 mm                  | 'FP216 '                 |
| 5        | Hylle-etikett 76x39 mm                  | 'FP217 '                 |
| 6        | Hylle-etikett 48x38 mm                  | 'FP218 '                 |
| 7        | Hylle-etikett 100x38 mm                 | 'FP219 '                 |
| 8        | Reol-etikett 210x60 mm                  | 'FP220 '                 |
| 9        | Hylle-etikett 76x39 mm Laser/Interform  | 'FP221 '                 |

Example:
```rpg
C                   if        vnetyp = 1
C                   movel     'FP213 '      lcruti
C                   endif
```
This pattern repeats for each label type (1–9).

### d. **End of Job**

```rpg
C                   eval      *inlr = *on
```
- Sets the last record indicator, which ends the program and closes files properly.

---

## 5. **Summary of Processing Flow**

1. **Fetch printer and label choices** from input data.
2. **Look up the printer type** in the `vfaspf` file.
3. **Select the print program** (`lcruti`) based on the label selection (`vnetyp`).
4. **Output the program name** for use by subsequent processing.
5. **Clean up and exit.**

---

## 6. **Key Points for Onboarding**

- **Label choice (`vnetyp` or `lcvalg`) and printer type (`lctype`)** are the primary decision points.
- **The print routine program name is always six characters long, padded with spaces.**
- **If the key for the printer is invalid, a default printer type (zero) is used.**
- **Easy to extend:** To add new label types or printers, expand the IF/ELSE logic and the documentation.

---

## 7. **Potential Enhancements**

- **Convert to free-format RPG** for easier maintenance.
- **Replace repetitive IFs with a LOOKUP or CASE statement**.
- **Add comments or logging** to clarify decisions in production.

---

**In short:**  
This program reads the user's choice of label and printer, finds the appropriate print routine (program) based on a simple mapping, and outputs the program name to be called for the actual print operation. It is well-documented (in Norwegian) and follows standard RPG logic.