```markdown
# RPG Program Explanation: GL710R

This RPG/400 program, named **GL710R**, is designed to prepare and transfer bank transactions via FTP. It retrieves input parameters, processes data from multiple files, and writes output in a specific layout format. The program is structured to be easily maintainable and makes use of RPG indicators and subroutines.

---

## **High-Level Overview**

- **Purpose:**  
  Prepare transaction data for FTP transfer by reading input parameters and data files, then composing and outputting records in a required format.

- **Key Functions:**  
  - Reads a parameter value from an entry parameter (likely from a calling program).
  - Retrieves account-related fields.
  - Constructs a communication line (FMS line) for IBM communication.
  - Reads multiple records from an input file and outputs each of them.
  - Gracefully terminates the program.

---

## **File Declarations**

```rpg
fdirpie    if a e           k disk
fdirrem    if   e           k disk
fdiruie    o  a e           k disk
```
- **dirpie:** Input file, keyed, for reading account parameter data.
- **dirrem:** Input file, keyed, for reading transaction or remittance data.
- **diruie:** Output file, keyed, for writing the composed output records.

---

## **Data Structures & Variables**

### **Communication Line (FMS Line)**
```rpg
d                 ds
d d_fmsl                        80
d  d_fmsr                        5    overlay(d_fmsl)     inz('FMS01')
d  d_avsn                        8    overlay(d_fmsl:6)
d  d_skil                        4    overlay(d_fmsl:14)  inz('    ')
d  d_mott                        8    overlay(d_fmsl:18)
```
- **d_fmsl (80 chars):** Main line for IBM communication.
  - **d_fmsr (5 chars):** Record type, initialized to 'FMS01', overlays first 5 characters.
  - **d_avsn (8 chars):** Account sender, overlays position 6-13.
  - **d_skil (4 chars):** Separator, initialized as blanks, overlays position 14-17.
  - **d_mott (8 chars):** Account receiver, overlays position 18-25.

### **Other Variables**
```rpg
d w_parm          s              2
```
- **w_parm:** 2-character variable to receive the program's input parameter.

---

## **Main Program Logic**

### **1. Entry Parameter Handling**
```rpg
c     *entry        plist
c                   parm                    w_parm
```
- The program expects a parameter (`w_parm`) from the calling environment, which is used for further file operations.

---

### **2. Parameter File Lookup and FMS Line Writing**
```rpg
c     w_parm        chain     dirpie
c                   if        not %found
c                   goto      end_pgm
c                   endif
c                   eval      d_avsn = iesacc
c                   eval      d_mott = iemacc
c                   eval      ierec = d_fmsl
c                   write     ieutrec
```
- **CHAIN dirpie with w_parm:**
  - Searches for a record in `dirpie` keyed by `w_parm`.
- **If not found:** Jumps to program end.
- **If found:** Assigns sender (`iesacc`) and receiver (`iemacc`) from `dirpie` record to `d_avsn` and `d_mott`.
- **Prepares full FMS line:** Assigns `d_fmsl` to output record buffer (`ierec`).
- **Writes FMS line:** Outputs this as the first output record (`ieutrec`).

---

### **3. Data Record Output Loop**
```rpg
c                   read      dirrem
c                   dow       not %eof
c                   eval      ierec = gdqrem
c                   write     ieutrec
c                   read      dirrem
c                   enddo
```
- **Reads first record from `dirrem`.**
- **Loop:** For each record in `dirrem` until end of file:
  - Assigns the contents of the record (`gdqrem`) to the output buffer (`ierec`).
  - Writes the output buffer to `ieutrec`.
  - Reads the next record.
- **Purpose:** Output every remittance/transaction record after the initial FMS header.

---

### **4. Program Termination**
```rpg
c     end_pgm       tag
c                   eval      *inlr = *on
c                   return
```
- Ensures last record indicator (`*inlr`) is set to end program and release resources.

---

### **5. Initialization Subroutine**
```rpg
c     *inzsr        begsr
...
c                   endsr
```
- The `*inzsr` subroutine is executed automatically once at program start.
- Handles input parameter passing.

---

## **Indicators and Coding Standards**

- **Indicators:**  
  - `LR` (last record) for program end.
  - Ranges 31-99 reserved for various notifications and file operations, as documented.

- **Comments & Structure:**  
  - The program uses well-documented sections, making it maintainable and aiding in onboarding.

---

## **Summary Table**

| File     | Usage        | Description                                                   |
|----------|-------------|---------------------------------------------------------------|
| dirpie   | Input (keyed)| Parameter file; lookup for account information using w_parm   |
| dirrem   | Input (keyed)| Data/Remittance file; contains transaction details            |
| diruie   | Output (keyed)| Output file; receives FMS communication and transaction lines|

---

## **Typical Execution Flow**

1. **Gets input parameter** (`w_parm`).
2. **Looks up account info** in `dirpie`.
   - If not found, simply ends.
   - If found, builds and outputs a header line (`FMS01...`).
3. **Reads and outputs all detail records** from `dirrem`, one by one, to `diruie`.
4. **Terminates gracefully.**

---

## **Onboarding Tips**

- Familiarize yourself with the layout and expected content of the `dirpie` and `dirrem` files.
- Understand the structure of the 80-character FMS line and how its fields are mapped.
- The output file will always begin with one FMS record, followed by zero or more data records.

---
```