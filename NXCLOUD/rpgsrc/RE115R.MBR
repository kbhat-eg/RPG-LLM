     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *                                                                       *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RE115R                                              *
      * Beskrivelse . . : Tilrettelegger trans fra Externe systemer           *
      *                   Avvikende periode i følge koderegister dersom null  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
      * R5.40     290906  Feil i opphenting av buntnr. og år rettet      HFL  *
      *                                                                       *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     fre0tpf    ip  ae           k disk
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
     fraa3l1    if   e           k disk    rename(raa3pfr:raa3l1r)
     fraa4l1    if   e           k disk    rename(raa4pfr:raa4l1r)
     frbunlu    uf a e           k disk    rename(rbunpfr:rbunlur)
     frtrapf    o    e           k disk
      *
610  d                uds
610  d l_user                911    920
     d per             s              2  0 dim(13)                              Perioder
      *
     d pdatx           s              8  0
610  d rbunl1_nivo     s                   like(rsnivo)
610  d rbunl1_memb     s                   like(rsmemb)
610  d w_memb          s                   like(rsmemb)
     d w_raar          s              4  0
     d wkp             s              2  0
     d wkper           s              8  0
     d wkraar          s              2  0
     d wlinje          s              8  0
6.NU d wnota           s              8  0
     d wnxbun          s                   like(rtbunt)
     d wraar           s              4  0
     d wtpre           s             10  2
     d w_firm          s                   like(rtfirm)
      *
     d raa4l1_4aar     s                   like(ra4aar)
     d rbunlu_bunt     s                   like(rtbunt)
      *
      *  Posteringer - EXTERNE SYSTEMER
      *
     ire0TPFR
     i                                          rtfirm        l6
     i                                          rtrper        l3
      *
      *  Statusopplysninger - avvikende perioder
      *
     iraa3l1r
     i              ra3p01                      per(01)
     i              ra3p02                      per(02)
     i              ra3p03                      per(03)
     i              ra3p04                      per(04)
     i              ra3p05                      per(05)
     i              ra3p06                      per(06)
     i              ra3p07                      per(07)
     i              ra3p08                      per(08)
     i              ra3p09                      per(09)
     i              ra3p10                      per(10)
     i              ra3p11                      per(11)
     i              ra3p12                      per(12)
     i              ra3p13                      per(13)
      *
     c                   if        *inl6 = *on
     c     afirl1_key    chain     afirl1                             10
     c                   endif
      *
     c                   if        *inl6 = *on
     c     raa3l1_key    chain     raa3l1                             10         Avvikende perioder
     c                   endif
      *
     c                   if        *inl6 = *on
      *
     c                   move      rtrper        wkraar
      *
     c                   if        wkraar > 80
     c                   eval      wraar = 1900
     c                   else
     c                   eval      wraar = 2000
     c                   endif
      *
     c                   eval      wraar = wkraar
     c                   eval      ra4fir = rtfirm                              Firma
     c                   eval      ra4aar = wraar
     c     raa4l1_key    chain     raa4l1
      *
     c                   if        %found
     c                   z-add     ra4sgb        wnota
     c                   else
     c                   z-add     0             wnota
     c                   endif
      *
     c                   endif
      *
      * BRUDD PERIODE/ÅR
      * Finn ledig buntnr. for Fakt-poster
      *
     c                   if        *inl3 = *on
610  c                   eval      rbunl1_nivo = *blank
610  c                   eval      rbunl1_memb = w_memb
S5.40c*                  eval      rsfirm = rtfirm                              Firma
E5.40c                   eval      rbunlu_bunt = 99999                          Type
     c     rbunlu_key    setgt     rbunlu
E5.40c                   readp     rbunlu                                 91
      *
E5.40c                   if        *in91 = *on
     c                   z-add     1             wnxbun
     c                   else
     c     rsbunt        add       1             wnxbun
     c                   endif
      *
     c                   endif
      *
     c                   add       rtbelØ        wtpre
     c                   add       1             wlinje                         Linjenr.
     c                   eval      rtbunt = wnxbun                              Bunt-nr.
      *
     c                   eval      rtautx = ' '                                 Avkryssing
      *
     c                   if        rtkrys = 'K'                                 Avkryssing
     c                   eval      rtautx = rtkrys                              Avkryssing
     c                   endif                                                  Avkryssing
      *                                                                         Avkryssing
     c                   eval      rtbetb = 0                                   Avkryssing
     c                   eval      rtbref = ' '                                 Avkryssing
      *                                                                         Avkryssing
610  c                   eval      rtnivo = *blank
610  c                   eval      rtmemb = w_memb
610  c                   time                    rtedat
610  c                   time                    rtetim
610  c                   eval      rteusr = l_user
     c                   write     rtrapfr                                      Skriv post
      *
     c     slutt         tag
      *
      *    LES STATUSREC FOR OPPDATERING AV GENERERT BILAG
      *
     cl6                 eval      ra4fir = rtfirm                              Firma
     cl6                 eval      ra4aar = wraar
     cl6                 eval      ra4sgb = wnota                                sist brukt
     cl6                 add       1             ra4sgb                           generert
      *
     cl3                 eval      wkper = %xfoot(per)                          Tabell finne
     cl3                 movel     rtrper        wkp                            Per på trans
      *
     cl3                 if        ra3stp > 01 and                              Start r.år
     c                             wkper > *zero                                 tab.utfyllt
     cl3                 movel     per(wkp)      rtrper                           bruk p.fra tab.
      *
     cl3                 if        wkp < ra3stp                                 og fjorår
     cl3                 eval      rtrper = w_raar                               bruk fjorår
     cl3                 endif
      *
     cl3                 endif
      *
     cl3                 z-add     wtpre         rtbelØ                         Beløp
     cl3                 eval      rsfirm = rtfirm                              Firma
     cl3                 eval      rsbunt = rtbunt                              Bunt-nr.
     cl3                 eval      rsstat = *blank                              Buntstatus
     cl3                 eval      rsrper = rtrper                              Periode/År
T5.40cl3                 eval      rsraar = rtraar                              Periode/År
     cl3                 z-add     1             rsfØrs                         Første linje
     cl3                 move      wlinje        rssist                         Siste linje
     cl3                 move      udate         rspdat                         Postert dato
     cl3                 eval      rsbsum = wtpre                               Beløp
     cl3                 eval      rspsum = wtpre                               Beløp
     cl3                 eval      rspdeb = wtpre                               Beløp
     cl3                 eval      rspkre = wtpre                               Beløp
      *
610  cl3                 eval      rsnivo = *blank
610  cl3                 eval      rsmemb = w_memb
610  cl3                 time                    rsedat
610  cl3                 time                    rsetim
610  cl3                 eval      rseusr = l_user
     cl3                 write     rbunlur                                      Skriv post
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
610  c     *entry        plist
610  c                   parm                    w_memb                         user
      *
     c                   eval      wtpre = *zeros
     c                   eval      wkp = *zeros
      *
     c     uyear         sub       1             w_raar
      *
     c     afirl1_key    chain     afirl1                             10
 001  *
     c     raa3l1_key    chain     raa3l1                             10         Avvikende perioder
 001  *
     c                   eval      raa4l1_4aar = *year
     c     raa4l1_key    chain     raa4l1
 001  *
B001 c                   if        %found
 001 c                   z-add     ra4sgb        wnota
E001 c                   else
 001 c                   z-add     0             wnota
E001 c                   endif
 001  *
     c     afirl1_key    klist
     c                   kfld                    w_firm
 001  *
     c     raa3l1_key    klist
     c                   kfld                    w_firm
 001  *
     c     raa4l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    raa4l1_4aar
      *
     c     rbunlu_key    klist
610  c                   kfld                    rbunl1_nivo
610  c                   kfld                    rbunl1_memb
     c                   kfld                    w_firm
     c                   kfld                    rbunlu_bunt
      *
     c                   endsr
