      /TITLE  ASSTAT Oppdatering av kjøp i år almenning
     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASSTAT
      * Program . . . . : SF523R
      * Beskrivelse . . : Oppdatering av kjøp i år almenning
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       090607 KOB  Nytt program
      *       050408 KOB  Endret slik at programmet henter data fra statistikk
6.10  * V6.10 230909 BSA  Lagt inn sporingsfelter
6.11  * V6.10 070510 BSA  Endret i sporingsfelter
6.30  * 6.30  090114 bsa  Felt flyttet fra RKUN til RKME (rkkjal)
8.01  *PRG2   220622 BOF  Utvidet prisgruppe fra 1 til 2 posisjoner - COMP
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fsstal3    if   e           k disk    rename(sstapfr:sstal3r)
6.30 f*rkunl1    uf   e           k disk    rename(rkunpfr:rkunl1r)
6.30 f*rkunlu    uf   e           k disk    rename(rkunpfr:rkunlur)
6.30 frkmel1    uf   e           k disk    rename(rkmepfr:rkmel1r)
6.30 frkmelu    uf   e           k disk    rename(rkmepfr:rkmelur)
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av variabler i nøkler
      *
     d sstal3_paar     s                   like(sfpaar)
     d rkunl1_kund     s                   like(rkkund)
      *
      * Definering av variable
      *
     d w_firm          s                   like(sffirm)
     d w_paar          s                   like(sfpaar)
     d w_alme          s                   like(sfalme)
     d w_kjal          s                   like(rkkjal)
      *
     c                   eval      sstal3_paar = w_paar
     c     sstal3_key    setll     sstal3                                 61
     c     sstal3_key    reade     sstal3                                 61
     c                   dow       *in61 = *off
      *
      * Oppdater kjøp i år almenning
      *
     c                   eval      rkunl1_kund = sfvkun
6.30 c**   rkunl1_key    chain     rkunl1                             60
6.30 c     rkunl1_key    chain     rkmel1                             60
     c                   if        *in60 = *off
     c                   eval      rkkjal = rkkjal + sfbrk1 + sfbrk2
6.10 c*                  time                    rkedat
6.10 c*                  time                    rketim
6.10 c*                  eval      rkesig = l_user
6.30 c                   time                    rkmeda
6.30 c                   time                    rkmeti
6.30 c                   eval      rkmeus = l_user
6.30 c**                 time                    rk2dpt
6.30 c**                 eval      rkepgm = 'SF523R    '
6.30 c**                 update    rkunl1r
6.30 c                   update    rkmel1r
     c                   endif
      *
     c     neste         tag
      *
     c     sstal3_key    reade     sstal3                                 61
     c                   enddo
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for les av statistikk-register
      *
     c     sstal3_key    klist
     c                   kfld                    w_firm
     c                   kfld                    sstal3_paar
      *
      * Key for oppslag på kunde
      *
     c     rkunl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl1_kund
      *
      * Key for nullstilling av kunde
      *
     c     rkunlu_key    klist
     c                   kfld                    w_firm
      *
      * Henter firmakode fra local
      *
     c                   eval      w_firm = l_firm
      *
     c                   eval      w_paar = *year
      *
      * Nullstill kjøp i år almenning
      *
6.30 c*    rkunlu_key    setll     rkunlu                                 60
6.30 c*    rkunlu_key    reade     rkunlu                                 60
6.30 c     rkunlu_key    setll     rkmelu                                 60
6.30 c     rkunlu_key    reade     rkmelu                                 60
     c                   dow       *in60 = *off
     c                   if        rkkjal <> 0
     c                   eval      rkkjal = 0
6.30 c                   time                    rkmeda
6.30 c                   time                    rkmeti
6.30 c                   eval      rkmeus = l_user
6.30 c**                 time                    rkedat
6.30 c**                 time                    rketim
6.30 c**                 eval      rkesig = l_user
6.30 c**                 time                    rk2dpt
6.30 c**                 eval      rkepgm = 'SF523R    '
6.30 c**                 update    rkunlur
6.30 c                   update    rkmelur
     c                   endif
      *
6.30 c     rkunlu_key    reade     rkmelu                                 60
6.30 c**   rkunlu_key    reade     rkunlu                                 60
     c                   enddo
      *
     c                   endsr
