# Documentation: Program LL820R (ASLAGR)

## Overview

**Program Name:** LL820R  
**System:** ASLAGR  
**Purpose:** This program handles the parameter entry phase for deleting items from inventory ("Sletter varer i Lager, Parameterinntasting"). It is a user-interactive module that collects and validates parameters before initiating the actual deletion process or queuing the job for batch execution.

## Structure and Main Flow

The program is structured as a classic interactive RPG application, using a workstation file (LL820D) for screen handling and calling subprograms for additional logic and parameter input. The code is organized into labeled sections (tags) that manage various phases of the parameter entry and validation process.

### Data Definitions

- **Display File:**  
  `FLL820D    CF   E             WORKSTN`  
  The program uses a display file for user interaction.

- **Data Structures:**  
  - **Parameter Collection (`DS`):**  
    - `DSPREC`: Stores the entire parameter string (1-64).
    - `DSBATC`: Stores the batch number (1-10).
    - `DSVAL1`, `DSVAL2`: Numeric fields for parameter values.
  - **User Data Section (`UDS`):**  
    - `l_firm`: Company number.
    - `l_fnav`: Company name.

### Initialization (*INZSR)

- Local variables are initialized:
  - `A1BATC`, `WRETUR`: Cleared to blanks.
  - `WWVALG`: Set to zero.

### Main Logic

#### 1. Batch Number Entry (`A1TAG`)

- **Purpose:**  
  Prompts the user (via subprogram `LC500R`) to enter a batch number.
- **Process:**
  - Calls `LC500R` with a return code (`WRETUR`) and batch number (`A1BATC`).
  - If `WRETUR` is not blank, the program exits (`XSLUTT`).
  - The batch number is moved into `DSBATC` for further processing.

#### 2. Parameter Entry Screen 1 (`B1TAG`)

- **Purpose:**  
  Collects the first parameter from the user (e.g., item number, quantity, or similar).
- **Process:**
  - Resets `B1VAL1` to zero.
  - Displays the input screen (`EXFMT B1BLD`).
  - If F3 (function key indicator *INKC) is pressed, exits.
  - If the entered value is zero, exits.
  - Otherwise, stores the value in `DSVAL1`.

#### 3. Parameter Entry Screen 2 (`C1TAG`)

- **Purpose:**  
  Collects a second parameter, possibly a confirmation or related value.
- **Process:**
  - Resets `C1VALG` to zero.
  - Displays the input screen (`EXFMT C1BLD`).
  - If F3 is pressed, returns to the previous screen (`B1TAG`).
  - If the entered value is zero, exits.
  - Otherwise, stores the value in `DSVAL2`.

#### 4. Job Submission or Next Step

- **Purpose:**  
  After parameter entry, the program either queues the job (if F4 is pressed) or continues to the next processing step.
- **Process:**
  - If F4 (indicator *INKD) is on, sets `WWVALG` to '1' (signals job queue submission).
  - Calls subprogram `LL822C`, passing the collected parameters (`DSPREC`) and job option (`WWVALG`).

#### 5. Program Exit (`XSLUTT`)

- **Purpose:**  
  Ends the program and sets LR (Last Record) for RPG cycle termination.

## Subprograms and External Calls

- **LC500R:**  
  Handles batch number entry. Returns a code in `WRETUR` and the batch number in `A1BATC`.

- **LL822C:**  
  Receives the parameter record and job option. Responsible for executing the deletion logic or queuing the job.

## User Interaction and Screen Handling

- **EXFMT B1BLD / C1BLD:**  
  These are display file formats for parameter entry.  
  - **F3 (Exit):** Allows the user to cancel or return.
  - **F4 (Job Queue):** Allows the user to submit the job to a queue instead of immediate execution.

## Business/Domain-Specific Logic

- The program enforces the entry of a batch number before proceeding.
- Parameter screens are used to validate that the user provides non-zero values, ensuring meaningful input before deletion occurs.
- Supports both immediate execution and job queue submission, accommodating different operational workflows.

## Design Decisions and Conventions

- **Tag-Based Control Flow:**  
  Uses RPG `TAG` and branching for screen control and process flow, rather than structured subroutines or procedures.
- **Parameter Passing:**  
  Data structures are used to collect and pass parameters between the main program and subprograms.
- **Indicator-Based Function Key Handling:**  
  Uses classic function key indicators (*INKC for F3, *INKD for F4) for user navigation and job control.

## Integration Points

- **Display File (LL820D):**  
  All user interaction is handled via this display file.
- **Subprograms:**  
  - `LC500R` for batch number entry.
  - `LL822C` for executing or queuing the deletion process.
- **Data Area:**  
  Uses User Data Section (UDS) for company-specific information, which may be used in downstream processing.

## Summary

LL820R is the initial parameter entry program for the inventory deletion process in the ASLAGR system. It ensures that all necessary parameters are entered and validated before passing control to the next processing stage or submitting the job for batch execution. The program is designed for robustness in user input and flexibility in job handling, integrating closely with other modules in the system.