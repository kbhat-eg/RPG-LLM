# RPG Program RC401R – Case Deletion for Collection System

This program is written in ILE RPG (RPG IV) and looks like a batch job for processing and possibly deleting records related to collection ("inkasso") cases. The program uses a printer file to produce a report of what has been processed.

Below is an explanation of the structure and logic, including relevant comments provided in the code.

---

## 1. **Header and Documentation**

```
h option(*nodebugio) datedit(*dmy)
```
- `option(*nodebugio)`: Disables some debug IO features (often for production).
- `datedit(*dmy)`: Specifies DD/MM/YY date editing.

The commented section at the top provides standard program metadata (system, program name, description, change history, indicator usage). For example:
- `KA = F1` is for firm selection
- `KC = F3` is for exit
- Indicators 30, 31–59, etc., have specific purposes (field protection, warnings, file, work, subroutine indicators).

---

## 2. **File Declarations**

```rpg
frcnfl1    if   e           k disk    rename(rcnfpfr:rcnfl1r)
frcnflu    uf   e           k disk    rename(rcnfpfr:rcnflur)
frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
frc401p    o    e             printer oflind(*in30)
```

- **rcnfl1 (Cases File)**: Input, keyed, renamed record format
- **rcnflu (Cases File Update)**: Update, keyed, renamed record format
- **rkunl1 (Customer File)**: Input, keyed, renamed record format
- **rc401p (Printer File)**: For output report, with overflow indication using indicator 30

---

## 3. **Variable Declarations**

- Key fields for files (customer, reference, case)
- Local Data Area (LDA) fields for user, firm, etc.
- Work variables: types, counters (`w_type`, `w_edat`, `w_tota`, `w_anta`, etc.)

---

## 4. **Main Processing Loop**

### Initialization

- The program starts by positioning (`setll`) and reading (`reade`) the cases file (`rcnfl1`).

### Main Loop

- Loops until EOF (file indicator 90 is on):

```rpg
dow *in90 = *off
```

#### a) **Record Validity Check**

- Skips records where `rcnsta` (status) is blank.

#### b) **Customer Existence Check**

- Copies customer key from `rcnask` to `rkunl1_kund`.
- Looks up the customer (`chain`) in `rkunl1` (indicator 60 set if not found).

#### c) **Control Subroutine**

- Calls `kontroll` subroutine:
  - Increments total counter (`w_tota`).
  - Checks if the case closing date is after a specified date (`rcndat > w_edat`). If so, doesn't mark for deletion (`w_slett` = 'X').

#### d) **Write Report and Delete Record**

- If not marked for deletion (`w_slett` = ' '):
  - Calls `utskrift` subroutine (increments eligible counter, writes detail line).
  - For records of type 'N', attempts to delete the corresponding updated record in `rcnflu` if found.

#### e) **Loop Control**

- Reads next record by key, repeats.

---

## 5. **End of Program**

- Sets LR indicator (`*inlr`) to finish job.
- Writes final totals to output.

---

## 6. **Subroutines**

### a) **KONTROLL**

- Adds 1 to the total cases.
- Checks if the case's closing date is after the given date; if so, sets `w_slett` to 'X' (do not delete).

### b) **UTSKRIFT**

- Adds 1 to the eligible delete count.
- If printer page overflow (`*in30`), writes report header and resets overflow indicator.
- Writes the detail line to the report.

### c) **INITIALIZATION (*inzsr)**

- Receives entry parameters (`w_type`, `w_edat`).
- Sets up the keys for each file.
- Sets firm value from LDA.
- Sets indicator 11 depending on type.
- Writes the initial report header.

---

## 7. **Indicator and Key Management**

- Indicators are used for both RPG logic and screen/file operations—these are explained in the comments and set/reset at relevant points.
- Keys for chained file access (`klist`, `kfld`) are dynamically populated.

---

## 8. **Summary of Program Flow**

1. **Initialization**: Read parameters, initialize keys, write report header.
2. **Process Cases**:
    - For each case, skip blanks, verify customer, perform control checks.
    - For eligible cases, print and attempt deletion as appropriate.
3. **Report**: Calculate and print totals at end.
4. **Subroutines**: Used for modular logic: control, print, and initialization.

---

## 9. **Key Takeaways**

- The program is a batch job for scanning and possibly deleting collection cases, based on dates and types.
- It maintains full reporting of actions taken (and totals).
- Uses standard RPG techniques for keyed file access, indicators, and subroutines.

---

**If you are new to RPG, pay special attention to:**
- How indicators control flow, file IO, and even print output.
- The use of subroutines for modularity.
- Explicit management of keys for files.
- The distinction between input, update, and output files.

This is a typical administrative/maintenance batch program you might find in an IBM i (AS/400) legacy environment.