```markdown
# LE623R (ASLAGR) – Diversevarer Utskrift og Telling

## 1. Programoversikt
LE623R leser records fra en lager-/varefil, beregner summer per varenummer (L2), per lager (L7) og per firma (L8), og skriver ut detalj- og totalrader til en skriver.

---

## 2. Filspesifikasjoner
- **sorl2** (input, keyed disk, renavnet til lsorl2r)  
  Inneholder lager-, vare- og antallopplysninger.  
- **e623p** (output, skriver)  
  Produserer detaljer og totaler.

---

## 3. Lokal Data Area (LDA)
Definerer felt for å motta parameter-inndata fra forrige programkall:
- `d_prec` (128 bytes) – overlegg for underfelt:
  - `d_batc` (0–9) batchnummer
  - `d_fogr`, `d_togr` (2 siffer) område for ordregruppe
  - `d_fhgr`, `d_thgr` (2 siffer) område for hovedgruppe
  - `d_fugr`, `d_tugr` (3 siffer) område for undergruppe
  - `d_fvar`, `d_tvar` (15 tegn) område for varenummer
  - `d_flag`, `d_tlag` (2 siffer) flagg
  - `d_sort` (1 siffer) sorteringsvalg

- `w_parm` (128 bytes) – mottar rå parameterstrengen.

---

## 4. Datastruktur for SORL2R
Overlay på innlesing av poster:
- `lwfirm` (8): firma
- `lwlage` (7): lager
- `lwvare` (2): varenummer
… pluss antall, priser, enhet, tekster.

---

## 5. Hovedløype
1. **Innlesing** av hver record fra `lsorl2r`.  
2. **Bryt- og subrutine-kontroll**  
   - Dersom *brytfelt* endrer verdi:
     - Skifte firma → *inL8* → `l8inn`
     - Skifte lager → *inL7* → `l7inn`
     - Skifte varenummer → *inL2* → `l2inn`
3. **Kalkulasjon av felt**  
   - `d1tots = lwspny * lwantt` (sum antall i kr)
   - `d1totk = lwkpny * lwantt` (sum kostpris)
   - Nullstille enhet hvis antall = 0  
4. **Akkumulering**  
   - `l2antt`, `l2tots`, `l2totk` (varenivå)
   - `l7tots`, `l7totk` (lagernivå)
   - `l8tots`, `l8totk` (firmanivå)
5. **Skrive detaljlinje** (`write d1det`)  
   - Håndtere sidetall og rubrikk-overskrift på overflow (*in30*).

---

## 6. Brytbehandling (Subrutiner)

### 6.1 l2inn (Varenummer-bryt)
- Nullstiller totalsummer for nytt varenummer:
  - `l2antt = 0`, `l2tots = 0`, `l2totk = 0`

### 6.2 l7inn (Lager-bryt)
- Nullstiller totalsummer for nytt lager:
  - `l7tots = 0`, `l7totk = 0`
- Skriver en ny lageroverskrift (`write a1hdr`)

### 6.3 l8inn (Firma-bryt)
- Nullstiller totalsummer for nytt firma:
  - `l8tots = 0`, `l8totk = 0`

---

## 7. Utskrift av totaler (Ved ut-bryting)

### 7.1 l2ut (Varenummer-avslutning)
- Hvis `l2antt`, `l2tots` eller `l2totk` ≠ 0:
  - `write l2tot`
  - Håndter overflow på samme måte som detalj.

### 7.2 l7ut (Lager-avslutning)
- Setter opp `l7lage = lwlage`  
- `write l7tot` for lagertotal  
- Håndterer overflow.

### 7.3 l8ut (Firma-avslutning)
- Setter opp `l8firm = lwfirm`  
- `write l8tot` for firmatotal  
- Håndterer overflow.

---

## 8. Overflow-håndtering (ovflow)
- Skriver ny overskrift (`a1hdr`) når sidetall ruller over.

---

## 9. Init-subrutine (*inzsr* / *entry*)
- Mottar `w_parm` med parameterdata
- Kopierer LDA-verdier til utskriftsoverskrift:
  - `a1wsid`, `a1user`, `a1firm`, `a1fnav`
  - Dato (`a1date`) og tidspunkt (`a1time`)

```  
```