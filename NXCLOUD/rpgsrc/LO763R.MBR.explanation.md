# Program Documentation: LO763R â€“ Unique Filename Generator

## Overview

**Program Name:** LO763R  
**System:** ASLAGR  
**Description:**  
This program generates a unique filename based on the current date and time. It is primarily designed for batch processes related to "butikkposter/Visma" (shop transactions/Visma integration), where unique file naming is critical for traceability and to avoid overwriting files.

## Purpose and Business Context

The main purpose of LO763R is to construct a filename that encodes the current date and time, ensuring uniqueness for each generated file. This is particularly important in the context of file exchanges with external systems (such as Visma) or when storing transaction batches, where duplicate filenames could cause data loss or processing errors.

## Structural Overview

### Data Structures

#### Filename Construction Data Structure

```rpg
d                 ds
d d_fnav                        20
d  d_fnav01                      1    overlay(d_fnav)     inz('B')
d  d_fnav02                      6  0 overlay(d_fnav:2)
d  d_fnav03                      2    overlay(d_fnav:8)   inz('.T')
d  d_fnav04                      6  0 overlay(d_fnav:10)
```

- `d_fnav` (20A): The complete filename as a 20-character string.
- `d_fnav01` (1A, overlay at 1): File prefix, always 'B'.
- `d_fnav02` (6P0, overlay at 2): Date part (YYMMDD), populated dynamically.
- `d_fnav03` (2A, overlay at 8): Static separator, always '.T'.
- `d_fnav04` (6P0, overlay at 10): Time part (HHMMSS), populated dynamically.

**Filename Format Example:**  
`B220131.T153045`  
Where:
- `B` = Prefix
- `220131` = Date (31-Jan-2022)
- `.T` = Separator
- `153045` = Time (15:30:45)

### Variables

- `p_fnav` (20A): Output parameter, receives the generated filename.
- `w_dato` (D, *ISO): Work variable for the current date.
- `w_time` (T, *ISO): Work variable for the current time.
- `w_dato_6` (6P0): Date in numeric format (YYMMDD).
- `w_time_6` (6P0): Time in numeric format (HHMMSS).

### Parameter Interface

The program is designed to be called from another program, receiving `p_fnav` as a parameter to return the generated filename.

## Main Logic Flow

1. **Initialization and Parameter Handling**
   - The program begins in the `*inzsr` subroutine, where it defines the parameter list and receives the address of the output variable `p_fnav`.

2. **Timestamp Acquisition**
   - The current date and time are fetched using the `time` operation code, populating `w_dato` and `w_time`.

3. **Date and Time Formatting**
   - `w_dato` is converted to a 6-digit numeric format (`w_dato_6`) using the `*ymd` format (YYMMDD).
   - `w_time` is converted to a 6-digit numeric format (`w_time_6`) using the `*hms` format (HHMMSS).

4. **Filename Assembly**
   - The overlays within the `d_fnav` data structure are populated:
     - `d_fnav01` is already initialized to 'B'.
     - `d_fnav02` is set to the formatted date.
     - `d_fnav03` is already initialized to '.T'.
     - `d_fnav04` is set to the formatted time.
   - The composite `d_fnav` now contains the fully constructed filename.

5. **Output Assignment**
   - The assembled filename is assigned to the output parameter `p_fnav`.

6. **Program Termination**
   - The program sets the LR indicator (`*INLR = *ON`) to signal end-of-program and returns control to the caller.

## Design Decisions and Conventions

- **Overlay Data Structure:**  
  The use of overlays allows efficient assembly of the filename without string manipulation routines. Each component occupies a fixed position, simplifying parsing and ensuring consistent formatting.

- **Fixed Prefix and Separator:**  
  The prefix 'B' and separator '.T' are hardcoded, likely to comply with external or legacy system requirements.

- **Date and Time Numeric Formats:**  
  By storing date and time as packed numerics (6P0), the program ensures leading zeros are preserved and the components are always six digits, which is important for filename sorting and uniqueness.

- **No Debug I/O:**  
  The `h option(*nodebugio)` directive suppresses debug I/O, indicating this program is intended for batch or production use with no user interaction.

- **Parameter Passing:**  
  The program is designed to be used as a subprocedure or called program, returning the generated filename via a parameter rather than, for example, writing it to a file or displaying it.

## External Interactions

- **Calling Program:**  
  LO763R expects to be called by another program in the batch process, which will receive the generated filename via the `p_fnav` parameter for subsequent use (e.g., creating or naming output files for Visma integration).

- **No Direct Database or API Calls:**  
  This program is self-contained and does not interact with external files, databases, or APIs. Its sole responsibility is filename generation.

## Maintenance and Extension

- **Filename Format Changes:**  
  If filename conventions change (e.g., different prefix, separator, or date/time format), adjustments will be required in the data structure overlays and initialization values.

- **Localization:**  
  The code uses Norwegian comments and variable names, which is standard in this codebase. Maintain this convention for consistency.

- **Reusability:**  
  The parameter-based design makes this routine easy to reuse in other batch processes that require unique, timestamped filenames.

## Summary

LO763R is a utility program that generates a unique, timestamp-based filename for use in batch processing, particularly for shop transaction exports to Visma. It uses structured overlays for efficient assembly of the filename and is designed for integration into larger batch workflows via parameter passing. The code is robust, simple, and adheres to conventions suitable for high-volume, automated environments.