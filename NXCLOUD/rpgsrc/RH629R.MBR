      /TITLE  Utskrift av hovedbok -  Notatblokk
     h datedit(*dmy) option(*nodebugio)
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RH629R                                        *
      * Beskrivelse . . : Utskrift av hovedbok -  Notatblokk            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                               *
      * Tilpasset for . :                                               *
      *                                                                 *
      * Referanse  Dato   Endringsbeskrivelse                      Sign.*
      * --------- ------  ----------------------------------------------*
      * R5.30     200704  Nytt program.                                  HFL
6.10  * R6.10     280911  Går ikke til slutt derom rxsyst ikke er 'H'
      *                   (Flere firma)
6.20  * R6.20     100414  Lagt inn nøkkel på fil RKLALU            nho
6.21  * R6.20     231014  Feil i nøkkel og prosjekt                nho
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      *  BRUK AV INDIKATORER                                            *
      *                                                                 *
      *       KA = F1  = Valg av firma                                  *
      *       KC = F3  = Exit                                           *
      *                                                                 *
      *       LR = Avslutt program                                      *
      *       30 = Protect av felter ved vise                           *
      *    31-59 = Varsle m/feilmeldinger/skjermindikatorer             *
      *    60-69 = Fileindikatorer chain etc.                           *
      *    70-79 = Arbeidsindikatorer i sub-rutiner                     *
      *    80-89 = Arbeidsindikatorer ordinære                          *
      *    90-99 = Benyttes ved std. sub-rutiner                        *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     frklalu    if   e           k disk    rename(rklapfr:rklalur)
     frhovl1    if   e           k disk    rename(rhovpfr:rhovl1r)
     frp1pl1    if   e           k disk    rename(rp1ppfr:rp1pl1r)
     frh629p    o    e             printer oflind(*in30)
      *
      *************************  T A B E L L E R  ************************
      *
     d f               s              1    dim(30)
      *
     d                 ds
     d w_tdat                         8  0
     d  w_taar                        4  0 overlay(w_tdat)
     d  w_tmnd                        2  0 overlay(w_tdat:5)
     d  w_tdag                        2  0 overlay(w_tdat:7)
      *
     d w_xdat          s             10d   datfmt(*iso)
      *
      *RESKONTRO - Datastruktur for parameter
     d                uds
     d pdato                 300    305  0
     d paarf                          4  0
     d paart                          4  0
     d pperf                          2  0
     d ppert                          2  0
     d pknrf                          5  0
     d pknrt                          5  0
     d pavdf                          4  0
     d pavdt                          4  0
     d pspef                          4  0
     d pspet                          4  0
     d pprof                          6
     d pprot                          6
     d kun                            6  0 dim(10)
     d paktf                          6
     d paktt                          6
     d plagf                          2  0
     d plagt                          2  0
     d psagr                          1
     d psabe                          7  0
     d pktid                          1
     d pktdg                          5  0
     d pkgrn                          1
     d pedat                         10d   datfmt(*iso)
      *
      *  Hva skal skrives på liste                                Valg: J/N=Ja/N
EAS01d pnota                          1
     d pkper                          1
     d ptlf                           1
     d pkomp                          1
     d psald                          1
     d pkjop                          1
      *
      *  Hvordan skal liste sorteres                              Valg: J/N=Ja/N
     d pkats                          1
     d pavds                          1
     d psels                          1
     d psort                          1
     d petik                          1  0
     d ptype                          1
     d prabk                          1
     d ppsla                          1
     d pssal                          1
      *
     d l_wsid                901    910
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
     d antpos          s              3  0
     d wakjli          s              5  0
     d wakjre          s              5  0
     d wantli          s              5  0
     d wantre          s              5  0
     d wdebli          s              5  0
     d wdebre          s              5  0
     d wdsali          s             13  2
     d wdsare          s             13  2
     d wkjoli          s             13  2
     d wkjore          s             13  2
     d wkreli          s              5  0
     d wkrere          s              5  0
     d wksali          s             13  2
     d wksare          s             13  2
     d wsalli          s             13  2
     d wsalre          s             13  2
     d*w_alfa          s                   like(rkalfa)
     d w_firm          s                   like(rhfirm)
     d w_kont          s                   like(rhkont)
     d w_spes          s                   like(rhspes)
     d w_avde          s                   like(rhavde)
      *
     d w_syst          s                   like(rxsyst)
     d w_pros          s                   like(rxpros)
     d w_akti          s                   like(rxakti)
      *
     d z_kont          s                   like(rxkont)
     d z_pros          s                   like(rxpros)
6.20 d rklalu_syst     s                   like(rxsyst)
6.20 d rklalu_pros     s                   like(rxpros)
6.20 d rklalu_akti     s                   like(rxakti)
6.20 d rklalu_kund     s                   like(rxkont)
     d rp1pl1_frm      s                   like(rp1frm)
     d rp1pl1_pro      s                   like(rp1pro)
      *
      * Les notatblokk
      *
     c     lesn          tag
      *
     c                   read      rklalu                                 10
      *
     c                   if        rxfirm > l_firm
     c                   eval      *in10 = *on
     c                   endif
      *
     c                   if        *in10 = *on
     c                   goto      slutt
     c                   endif
      *
     c                   if        rxsyst <> 'H'
6.10 c*                  goto      slutt
6.10 c                   goto      lesn                                         FERDIG
     c                   endif
      *
      * Sjekk kontonr. fra/til
      *
     c                   if        rxkont < pknrf or
     c                             rxkont > pknrt
     c                   goto      alle
     c                   endif
      *
      * Sjekk avdeling fra/til
      *
     c                   if        rxavde < pavdf or
     c                             rxavde > pavdt
     c                   goto      alle
     c                   endif
      *
      * Sjekk spes. fra/til
      *
     c                   if        rxspes < pspef or
     c                             rxspes > pspet
     c                   goto      alle
     c                   endif
      *
      * Sjekk prosjekt fra/til
      *
     c                   if        rxpros < pprof or
     c                             rxpros > pprot
     c                   goto      alle
     c                   endif
      *
      * Sjekk aktivitet fra/til
      *
     c                   if        rxakti < paktf or
     c                             rxakti > paktt
     c                   goto      alle
     c                   endif
      *
      * Hent prosjektnavn ved brudd
      *
     c                   if        rxpros <> z_pros
     c                   eval      z_pros = rxpros
      *
     c                   eval      w_pros = rxpros
     c                   eval      w_akti = *blanks
     c                   eval      w_spes = *zeros
     c                   eval      w_avde = *zeros
     c                   eval      w_kont = *zeros
     c                   eval      rp1pl1_frm = w_firm
     c                   eval      rp1pl1_pro = rxpros
     c     rp1pl1_key    chain     rp1pl1
     c                   if        not %found
     c                   eval      rp1txt = 'Ukjent prosjekt'
     c                   endif
     c                   endif
      *
      * Hent kontonavn ved brudd
      *
     c                   if        rxkont <> z_kont
     c                   eval      z_kont = rxkont
      *
     c                   eval      w_kont = rxkont
     c                   eval      w_spes = *zeros
     c                   eval      w_avde = *zeros
     c     keykto        chain     rhovl1
      *
     c                   if        not %found
     c                   eval      rhtext = 'Ukjent konto'
     c                   endif
      *
     c                   exsr      skrive
     c                   endif
      *
     c                   eval      wnotat = rxtext
     c                   write     notatb
      *
     c     alle          tag
      *
     c                   goto      lesn
      *
     c     slutt         tag
      *
     c                   eval      *inlr = *on
      *
     clr                 write     total
      *
      /eject
      ****************************************************************
      *   SUBRUTINE FOR Å SKRIVE KUNDE - HEADING (ENKEL LISTE)       *
      ****************************************************************
     c     skrive        begsr
      *
      * Sjekker om overflow
      *
     c                   if        *in30 = *on
     c                   do
     c                   write     head1
     c                   write     head2
     c                   write     head2e
     c                   eval      *in30 = *off
     c                   enddo
     c                   endif
      *
     c                   write     kund1
      *
     c*                  if        rkadr2 <> *blank
     c*                  write     kund1a
     c*                  endif
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      * Sette startverdier
      *
     c                   move      l_firm        w_firm
6.21 c*                  eval      rklalu_syst = 'K'                                         .
6.21 c                   eval      rklalu_syst = 'H'                                         .
6.21 c*                  eval      rklalu_pros = *zeros                                      .
6.21 c                   eval      rklalu_pros = *blanks                                     .
6.20 c                   eval      rklalu_akti = *blanks                                     .
6.20 c                   eval      rklalu_kund = *zeros                                      .
6.20  *
6.20 c     rklalu_key    setll     rklalu                                 94
      *
      * Skriv heading på første side
      *
     c                   write     head1
     c                   write     headku
      *
     c                   if        pavdt > *zero
     c                   write     headav
     c                   endif
      *
     c                   if        pspet > *zero
     c                   write     headdi
     c                   endif
      *
     c                   if        pprot > *zero
     c                   write     headse
     c                   endif
      *
     c                   if        paktt > *blank
     c                   write     headkk
     c                   endif
      *
     c*                  if        pedat > *loval
     c*    *dmy          move      pedat         wpedat
     c*                  move      pnota         wpnota
     c*                  write     headda
     c*                  endif
      *
     c                   write     head1
     c                   write     head2
      * Sjekk om enkel heading
     c                   eval      *in11 = *on
     c                   if        *in11 = *on
     c                   write     head2e
     c                   endif
      *
      * Key for kontoplan
      *
     c     keykto        klist
     c                   kfld                    w_firm
     c                   kfld                    w_kont
     c                   kfld                    w_spes
     c                   kfld                    w_avde
      *
      * Key for prosjekt
      *
     c     rp1pl1_key    klist
     c                   kfld                    rp1pl1_frm
     c                   kfld                    rp1pl1_pro
6.20 c     rklalu_key    klist
6.20 c                   kfld                    w_firm
6.20 c                   kfld                    rklalu_syst
6.20 c                   kfld                    rklalu_pros
6.20 c                   kfld                    rklalu_akti
6.20 c                   kfld                    rklalu_kund
     c                   endsr
