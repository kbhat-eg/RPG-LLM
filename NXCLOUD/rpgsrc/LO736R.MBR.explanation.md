# RPG Program LO736R - Explanation and Developer Onboarding

---

## Context and Purpose

This program is an ILE RPG application (`LO736R`) that handles the order picking ("plukke bestillinger") and display of orders ("vise bestillinger") within an ERP system. It interacts with various files (physical files and display files), manages order headers, order lines, and picking parameters, and provides user interfaces for picking, viewing, and maintaining order-related information. The application is in Norwegian, and variable names/comments reflect this.

---

## 1. **File Declarations**

Files are defined using the F-specs. They include order headers, order lines, picking parameters, and display/workstation files. Notable points:
- `IF`/`UF` = Input/Update file, `E` = externally described, `K` = keyed access, `A` = Add, `DISK` = disk file, `WORKSTN` = workstation (screen).
- Files are renamed to internal record formats for clarity and separation of concerns.

**Example:**
```rpg
FVOTYL1 IF E K DISK RENAME(VOTYPFR:VOTYL1R)
...
FLO736D CF E WORKSTN SFILE(B1SFL:SRRN01)
F                                      SFILE(D1SFL:SRRN02)
```

---

## 2. **Variable Definitions**

- `d`-specs define variables: for parameters, keys, and working storage. Some use `like()` to ensure they match database field definitions.

**Examples:**
```rpg
d p_firm s 3 0
d lohel1_numm s like(lonumm)
d w_datf s like(lofkda)
```

---

## 3. **Structures and Subroutines**

- Multiple custom subroutines (labelled with tags and `BEGSR`/`ENDSR`).
- `KLIST`/`KFLD` defines key lists for chained/read operations.
- Uses subfiles for displaying lists of orders/lines.

---

## 4. **Main Program Logic**

### **Initial Processing and Parameter Handling**

- Receives parameters from a calling program (order type, company, order number, suffix).
- Sets up company in key fields.
- Resets working variables (counters, working fields, etc.).
- Populates the initial subfile for the first screen.

### **Order Picking or Display (Menu Switch)**

- If an order number is provided, process as a picking scenario (`A1` branch).
- Otherwise, present opening screen with a list of orders (`B2` branch).

---

## 5. **Screen Flows and User Interactions**

### **A1: Picking Handler**

1. **Fetch Order Header**: Looks up the order header.
2. **Fetch Order Type**: Retrieves information on the order type.
3. **Load Next Order Type Info**: Stores for subsequent checks.
4. **Populate Screen Fields**: Prepares information for the display file.
5. **Special Checks**:
    - Permission to pick
    - Valid order type
    - Valid warehouse code (calls subroutine `SBLAGR`)
    - Order type business logic (e.g., 'internal' types skip some checks)
6. **Update Status**: Writes updates to the order header and picking parameter files when appropriate.
7. **Call Subfile Programs**: For picking lines or entering additional information as needed.
8. **Handles function keys**: F3 (Exit), F4 (search), etc.

### **B2: Opening Screen & Subfile Handling**

- Presents a subfile (list) of orders for the user (with function keys F1, F3, etc.).
- Processes user actions on subfile entries (pick, delete, edit orders).
- Handles rolling/refreshing subfile (paging).

---

## 6. **Subfile Management**

- **Subfiles (`B1SFL` for order headers, `D1SFL` for order lines) are loaded, cleared, and displayed using specific subroutines:**
    - `XCLR01`/`XCLR02` : Clears (empties) subfile.
    - `XCRT01`/`XCRT02` : Loads subfile with new data.
    - `XDSP01`/`XDSP02` : Displays subfile (EXFMT).
    - `XLSP01`/`XLSP02` : Refreshes subfile.
- Used to provide paged lists of orders and order lines for selection/maintenance.

---

## 7. **Order Line Picking (D1)**

- **Picking lines for an order:** (`XD1BLD` subroutine)
    - Fetches all lines for an order.
    - Shows them in a subfile.
    - Lets the user pick lines and updates/maintains the corresponding records.

---

## 8. **Supporting Functions & Subroutines**

- **SBLAGR**: Fetches and displays warehouse (lager) text information.
- **XB4WIN**: Handles deletion of a pick/selection.
- **XB7WIN**: Handles display and updating of additional line info.
- **XD7WIN**: Updates the pick register for order lines.
- **XH1WIN**: Handles the file list/lookup options.
- **xf7bld**: Handles "invoice picks" for a date range (with input validation).
- **oppd_utpl**: Updates the picking parameter file as instructed.

---

## 9. **Validation and Business Logic**

- Extensive use of conditional logic (`IFEQ`, `IFNE`, `IF`, `ENDIF`) to enforce business rules:
    - Only certain users/order types can be picked.
    - Warehouse codes must be valid.
    - Cannot change orders that are in print process.

---

## 10. **Function Key Handling**

- Function keys are checked by evaluating their indicators (e.g. `*INKC`, `*INKD` etc.).
- Often, several function keys are relevant at each interface and have their own logic.

---

## 11. **Comments and History**

- The source is richly commented (in Norwegian) with a change log at the top detailing functionality additions and modifications, including reasons and sign-offs.

---

## 12. **Onboarding Tips**

- **Main program flow**: Is controlled by tags and branching (`TAG`/`GOTO`), not a linear top-to-bottom structure.
- **Subfiles**: Critical for understanding display and update logic. Learn how RPG manages these with SFLCTL, SFLFMT, indicators, and paging variables.
- **Key lists (KLIST/KFLD)**: Used for all random-access file operations, essential for understanding data retrieval and updates.
- **Integration**: Calls other programs for order type info (`VA550R`), warehouse info (`RA510R`), and more. Be aware of these dependencies.
- **User/warehouse permissions**: Controlled via special files and fields, especially for recent modifications.

---

## 13. **Key Takeaways**

- This is a classic, menu-driven RPG application using display files and subfiles for interactive order management.
- Business logic is split between display logic (screens, user choices), validation, and updates to multiple related files.
- Extensive use of subroutines to separate flow for each "screen" or operation.
- Change history shows that the program has been steadily enhanced for new requirements over several years. Check the latest version for your changes.
- Many variable and field names are Norwegian; get familiar with business terms (e.g., "lager" = warehouse, "bestilling" = order, "plukk" = pick, etc.).

---

### **Glossary of Norwegian Terms**

| Term        | Meaning          |
|-------------|-----------------|
| Bestilling  | Order           |
| Lager       | Warehouse       |
| Plukk       | Picking         |
| Tekst       | Text            |
| Suffix      | Suffix          |
| Firma       | Company         |
| Linje       | Line            |
| Vare        | Article/Product |
| Opplysning  | Information     |
| Slett       | Delete          |

---

## **Summary**

This program forms a central part of a legacy RPG order picking and management solution, integrating with a set of related data files and other programs, providing rich subfile-based user interfaces, and enforcing detailed business logic for order handling and picking scenarios. Mastery of file layouts, subfile logic, and indicator-controlled branching is essential for maintaining or extending this code.

---

If onboarding, start by running the program in debug with sample data and stepping through the flows for both "pick an order" and "view/search orders" to see the interaction between screens, files, and logic.