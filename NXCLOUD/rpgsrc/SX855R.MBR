     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  System. . . . . : ASSTAT
      *  Program . . . . : SX855R
      *  Beskrivelse . . : Oppdaterer statistikken med nye felter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Spesialversjon. :
      *  Tilpasset for . :
      *
      *  Referanse  Dato   Endringsbeskrivelse                     Sign
      * --------- ------  --------------------------------------------------
      *           191214  Nytt program                              BOF
6.3q  *       260515 bof  Datoformat sql
6.nu  *           180218  Endret ihht. nummerutvidelse              bsa
      *
8.01  *PRG2   160622 bsa  Utvidet prisgruppe fra 1 til 2 posisjoner
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fsstal1    if   e           k disk    rename(sstapfr:sstal1r)
     frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
6.34 fbokkl1    if   e           k disk    rename(bokkpfr:bokkl1r)
     fsstalu    uf   e           k disk    rename(sstapfr:sstalur)
      *
      * Definering av array
      *
     d a_ordr          s              6  0 dim(1000)
     d a_suff          s              2  0 dim(1000)
      *
      *
      *  Local Data Area
      *
     d                uds
     d l_wsid                901    910
     d l_user                        10
     d l_firm                944    946  0
      *
      * Definering av variable i nøkler
      *
     d sstal1_paar     s                   like(sfpaar)
     d rkunl1_kund     s                   like(rkkund)
     d vvarl1_vare     s                   like(vvvare)
     d votyl1_otyp     s                   like(vaotyp)
6.34 d bokkl1_bong     s                   like(brbong)
     d sstalu_paar     s                   like(sfpaar)
     d sstalu_binr     s                   like(sfbinr)
     d sstalu_ornr     s                   like(sfornr)
     d sstalu_orsu     s                   like(sforsu)
     d sstalu_orli     s                   like(sforli)
     d sstalu_bong     s                   like(sfbong)
     d sstalu_vare     s                   like(sfvare)
     d sstalu_enhe     s                   like(sfenhe)
     d sstalu_anta     s                   like(sfanta)
     d sstalu_date     s                   like(sfdate)
     d sstalu_time     s                   like(sftime)

      *
      * Definering av variable
      *
5.32 d w_saar          s              4  0
5.32 d w_suke          s              2  0
     d w_firm          s                   like(sffirm)
3.10 d w_vlin          s              1
6.34 d i               s              4  0
      *
5.20 d w_lety          s                   like(sflety)
5.39 d w_pran          s              4
5.62 d w_trek          s             11  2
5.63 d w_akm3          s             11  3
5.63 d w_nom3          s             11  3
      *
6.34 d w_raba          s                   like(sfsumb)
6.34 d w_sumr          s                   like(sfsumb)
6.34 d w_pkon          s              3
6.34 d w_sumn          s             11  2
6.34 d w_suno          s             11  2
6.34 d w_ntpr          s             11  2
6.34 d w_sumi          s             11  2
6.34 d w_sumo          s             11  2
6.34 d w_suoi          s             11  2
6.34 d w_sumk          s             11  2
6.34 d w_suok          s             11  2
6.34 d w_diff          s             11  2
6.34 d w_pkns          s              3
6.34 d w_pkko          s              3
6.34 d w_pkok          s              3
6.34 d w_pkin          s              3
6.34 d w_pkoi          s              3
6.34 d w_kofa          s              1
6.34 d w_card          s              2
6.34 d w_fcar          s              2
6.34 d w_kild          s              3
6.34 d w_soda          s                   like(sfsoda)
6.34 d w_soti          s                   like(sfsoti)
6.28 d w_udat          s               d   datfmt(*iso)
6.28 d w_ddat          s               d   datfmt(*iso)
6.28 d w_ldor          s                   like(vvldor)
     d w_belb          s             11  2
     d w_beln          s             12  3
     d w_belo          s             11  2
     d w_belw          s             11  2
5.30 d w_belx          s             11  2
5.30 d w_bely          s             11  2
     d w_bels          s             11  2
6.34 d w_belk          s             11  2
     d w_kost          s             11  2
     d w_rkro          s             11  2
     d w_rkro_stk      s             11  2
     d w_rkr1          s             11  2
     d w_rkr2          s             11  2
5.31 d w_brk1          s             11  2
5.31 d w_brk2          s             11  2
6.13 d w_mgrl          s             11  2
6.13 d w_moms          s             11  2
     d w_fkda          s              6  0
     d w_peri          s              4  0
     d w_fast          s             10
     d w_fell          s              6
     d w_kode          s              1
     d w_numm          s              6  0
     d w_type          s              2
5.40 d w_mvag          s             11  2
     d w_dbkr          s              1
     d w_valg          s              1  0
     d w_gebm          s             13  4
     d w_geby          s             11  2
     d w_geb0          s             11  2
     d w_geb1          s             11  2
     d w_geb2          s             11  2
     d w_geb3          s             11  2
     d w_anta          s                   like(sfanta)
      *
     d w_eaar          s              2  0
     d w_emnd          s              2  0
5.20 d w_hele          s            128
     d w_hgrp          s              2  0
     d w_ogrp          s              2  0
     d w_otyp          s              2
     d w_qmem          s              1
     d w_sald          s             11  2
     d w_retk          s              1
     d w_ugrp          s              3  0
     d w_vare          s             15
     d w_atxt          s             20
5.04 d w_kidr          s              6  0
5.04 d w_ksif          s              1  0
5.04 d w_kkus          s             24
5.04 d w_kkid          s             25
5.05 d w_line          s              4  0
5.49 d w_kki2          s             25
5.32 d w_latx          s             20
5.32 d w_adrs          s             30
5.32 d w_ponr          s              4  0
5.32 d w_pste          s             30
5.32 d w_avde          s              4  0
      *
5.31 d w_stat          s              1
5.31 d w_mvak          s              1
5.31 d w_mvtx          s             30
5.31 d w_bpro          s              5  2
5.31 d w_dato          s              6  0
5.31 d w_date          s                   like(sfdate)
5.31 d w_mvap          s              6  2
5.31 d w_mvat          s              5  4
5.31 d w_mvaf          s             10  9
5.70 d p_vtyp          s                   like(vvvtyp)
5.70 d p_paar          s                   like(sfpaar)
6.28 d b_inlr          s              1    inz(*off)
6.28 d b_frst          s              1    inz(*off)
5.32 d b_feil          s              1    inz(*off)
6.34  *
6.34  * Datastruktur parameterliste -inn
6.34  *
6.34 d                 ds
6.34 d hirec                        120
6.34 d  hifirm                        3  0 overlay(hirec)
6.34 d  hirkat                        3  0 overlay(hirec:4)
6.34 d  hikund                        6  0 overlay(hirec:7)
6.34 d  hikpro                        6  0 overlay(hirec:13)
6.34 d  hivare                       15    overlay(hirec:19)
6.34 d  hilety                        1  0 overlay(hirec:34)
6.34 d  hienhe                        3    overlay(hirec:35)
6.34 d  hidato                         d   overlay(hirec:38) datfmt(*iso)
6.34 d  hitime                         t   overlay(hirec:48) timfmt(*iso)
6.nu d  hinumm                        8  0 overlay(hirec:56)
6.nu d  hikode                        1    overlay(hirec:64)
6.nu d  hidekn                        5  2 overlay(hirec:65)
6.nu d  hiavgf                        1  0 overlay(hirec:70)
6.nu d  hipriv                        1  0 overlay(hirec:71)
6.nu d  hitilb                        1    overlay(hirec:72)
6.nu d  hiskaf                        1    overlay(hirec:73)
6.nu d  hildor                        6  0 overlay(hirec:74)
6.nu d  hisapr                        9  2 overlay(hirec:80)
6.nu d  hikopr                        9  2 overlay(hirec:89)
8.01 d  hiprgr                        2    overlay(hirec:98)
8.01 d  hiinpr                        9  2 overlay(hirec:100)
6.34 d  hiinlr                        1    overlay(hirec:120)
6.34  *
6.34  * Datastruktur parameterliste -ut
6.34  *
6.34 d                 ds
6.34 d horec                        100
6.34 d  holety                        1  0 overlay(horec)
6.34 d  hokpri                        1    overlay(horec:2)
6.34 d  hooppr                        9  2 overlay(horec:3)
6.34 d  hosapr                        9  2 overlay(horec:12)
6.34 d  hokopr                        9  2 overlay(horec:21)
6.34 d  horab1                        5  2 overlay(horec:30)
6.34 d  horab2                        5  2 overlay(horec:35)
6.34 d  hodekn                        5  2 overlay(horec:40)
6.34 d  hopros                        5  2 overlay(horec:45)
6.34 d  hokamp                        5    overlay(horec:50)
6.34 d  hoalme                        4  0 overlay(horec:55)
6.34 d  hobrty                        1  0 overlay(horec:59)
6.34 d  hobrr1                        5  2 overlay(horec:60)
6.34 d  hobrr2                        5  2 overlay(horec:65)
6.34 d  hoomva                        1    overlay(horec:70)
8.01 d  hoprgr                        2    overlay(horec:71)
8.01 d  hoinpr                        9  2 overlay(horec:73)
8.01 d  hopkon                        3    overlay(horec:82)
8.01 d  hopkns                        3    overlay(horec:85)
8.01 d  hopkko                        3    overlay(horec:88)
8.01 d  hopkok                        3    overlay(horec:91)
8.01 d  hopkoi                        3    overlay(horec:94)
6.34  *
      *
      * Datastruktur for kontoinformasjon
      *
     d                 ds
5.20 d d_hele                       128
     d  d_kav1                        4  0 overlay(d_hele)
     d  d_kko1                        6  0 overlay(d_hele:5)
4.02 d  d_ksp1                        4  0 overlay(d_hele:11)
4.02 d  d_kav2                        4  0 overlay(d_hele:15)
4.02 d  d_kko2                        6  0 overlay(d_hele:19)
4.02 d  d_ksp2                        4  0 overlay(d_hele:25)
4.02 d  d_kav3                        4  0 overlay(d_hele:29)
4.02 d  d_kko3                        6  0 overlay(d_hele:33)
4.02 d  d_ksp3                        4  0 overlay(d_hele:39)
4.02 d  d_kav4                        4  0 overlay(d_hele:43)
4.02 d  d_kko4                        6  0 overlay(d_hele:47)
4.02 d  d_ksp4                        4  0 overlay(d_hele:53)
4.02 d  d_kav5                        4  0 overlay(d_hele:57)
4.02 d  d_kko5                        6  0 overlay(d_hele:61)
4.02 d  d_ksp5                        4  0 overlay(d_hele:67)
4.02 d  d_kav6                        4  0 overlay(d_hele:71)
4.02 d  d_kko6                        6  0 overlay(d_hele:75)
4.02 d  d_ksp6                        4  0 overlay(d_hele:81)
4.02 d  d_kav7                        4  0 overlay(d_hele:85)
4.02 d  d_kko7                        6  0 overlay(d_hele:89)
4.02 d  d_ksp7                        4  0 overlay(d_hele:95)
4.02 d  d_khnv                        4    overlay(d_hele:99)
5.20 d  d_nivo                        1    overlay(d_hele:103)
      *
      *
6.3q C/Exec SQL
6.3q C+  Set Option DatFmt=*ISO
6.3q C/End-Exec
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Behandle utplukk, Setter inn riktige parameterverdier
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     c                   time                    w_ddat
     c                   eval      w_dato = 161214
     c     *dmy          move      w_dato        w_date
     c                   eval      b_frst = *off
5.24  *
     c                   exsr      dann_total
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     end_pgm       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å å lese all stat for ett år
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     dann_total    begsr
      *
     c                   eval      sstal1_paar = p_paar
     c     sstal1_key    setll     sstal1
     c     sstal1_key    reade     sstal1
     c                   dow       not %eof(sstal1)
     c                   if        sfdate < w_date and
     c                             sfpkon = *blank
6.34  *
     c                   eval      rkunl1_kund = sfvkun
     c     rkunl1_key    chain     rkunl1r
      *
     c                   eval      vvarl1_vare = sfvare
     c     vvarl1_key    chain     vvarl1r
      *
     c                   eval      votyl1_otyp = sfotyp
     c     votyl1_key    chain     votyl1r
      *
     c                   exsr      utvid_stat
      *
     c                   endif
      *
     c     sstal1_key    reade     sstal1
     c                   enddo
      *
     c                   endsr
      *
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  * Henter utvidet statstikk-data
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  *
6.34 csr   utvid_stat    begsr
6.34  *
     c                   exsr      stat_null
6.34  *
      * legger først ut fra kassedato /time
     c                   eval      w_soda = sfkoda
     c                   eval      w_soti = sfkoti
      * hvis ikke kassedato utfylt, så ordredato
     c                   if        w_soda = *loval
     c                   eval      w_soda = sforda
     c                   endif
6.34  *
6.34 c                   eval      hifirm = w_firm
6.34 c                   eval      hirkat = 0
6.34  *
6.34 c                   eval      hikund = sfvkun
6.34 c                   if        sfvkun <> 0
6.34 c                   eval      hikund = sfvkun
6.34 c                   endif
6.34  *
6.34 c                   eval      hikpro = sfkpro
6.34 c                   eval      hivare = sfvare
     c                   eval      hienhe = sfenho
     c                   eval      hilety = sflety
     c                   eval      hidekn = 0
     c                   eval      hidekn = 0
     c                   eval      hiavgf = sfkmva
     c                   eval      hipriv = 0
6.34 c                   eval      hidato = sforda
6.34 c                   eval      hitime = *loval
6.34 c                   eval      hinumm = 0
6.34 c                   eval      hinumm = 0
6.34 c                   eval      hikode = *blank
6.34 c                   eval      hikode = *blank
6.34 c                   eval      hiskaf = *off
6.34 c                   eval      hildor = sfldor
6.34 c                   eval      hisapr = 0
6.34 c                   eval      hikopr = 0
6.34 c                   eval      hiinpr = 0
6.34 c                   eval      hiinpr = 0
     c                   if        sflvre = 1
     c                   eval      hiskaf = *on
     c                   else
     c                   eval      hiskaf = *off
     c                   endif
6.34  *
6.34 c                   call      'VP905R'
6.34 c                   parm                    hirec
6.34 c                   parm                    horec
6.34  *
6.34  * Koder fra VP905
6.34  *
6.34 c                   eval      w_pkon = hopkon
6.34 c                   eval      w_pkns = hopkns
6.34 c                   eval      w_pkko = hopkko
6.34 c                   eval      w_pkok = hopkok
6.34 c                   eval      w_pkoi = hopkoi
      *
      * Skaffevare får vi ikke beregnet ettersom vi ikke vet hvilken
      * betingelse som ble valgt ved ordreregistrering
     c*                  if        sflvre  = 1
      * her må det testes mer for å sette PK-koder
     c*                  if        w_bels <> 0
     c*                  if        w_pkon = *blank
     c*                  eval      w_pkon = 'VEI'
     c*                  endif
     c*                  if        w_pkns = *blank
     c*                  eval      w_pkns = 'VEI'
     c*                  endif
     c*                  endif
      *
     c*                  if        w_belk <> 0
     c*                  if        w_pkko = *blank
     c*                  eval      w_pkko = 'VEI'
     c*                  endif
     c*                  if        w_pkok = *blank
     c*                  eval      w_pkok = 'VEI'
     c*                  endif
     c*                  endif
      *
     c*                  endif
6.34  *
6.34  * Sum opprinnelig netto salgspris (SFSUMO) ---------------------------
6.34  *
     c*                  if        sflvre = 1
     c*                  eval      w_ntpr = w_bels
     c*                  eval      hokopr = w_belk
     c*                  else
     c*                  endif
6.34  *
6.34 c                   eval      w_ntpr = hosapr
6.34  *
6.34 c                   if        horab1 > 0
6.34 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
6.34 c                   endif
6.34 c                   if        horab2 > 0
6.34 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
6.34 c                   endif
      *
      * Varelinjens andel av ordrerabatt (pr. stk)
      *
     c                   if        vvkord = 0   and
     c                             rkorab <> 0
     c                   eval(h)   w_rkro_stk = (w_ntpr * rkorab) / 100
     c                   endif
      * trekkker fra ordrerabatt
     c                   eval      w_ntpr = w_ntpr - w_rkro_stk
      *
     c                   if        sflvre = 0
6.34 c                   eval(h)   w_suno = w_ntpr * sfanto
     c                   else
     c                   eval      w_suno = 0
     c                   endif
6.34  *
6.34  * sjekk negativ fortegn på ordretype -----------------------------
     c                   if        vaokre = '-'
     c                   eval      w_suno = w_suno * -1
     c                   endif
6.34  *
6.34  *
6.34  * Sum netto salg salgspris (SFSUMN) --------------------------------
6.34  *
6.34 c                   exsr      beregn_rabatt
6.34  *
6.34 c                   eval(h)   w_sumn = sfsumb - w_sumr
6.34  *
6.34  * Priskode netto salgspris  (SFPKNS)
6.34  *
     c                   if        w_suno <> 0 and
     c                             w_sumn <> 0
6.34 c                   eval      w_diff  = %abs(w_suno - w_sumn)
6.34 c                   if        w_diff > 1
6.34 c                   eval      w_pkns  = 'MAN'
6.34 c                   endif
6.34 c                   endif
6.34  *
6.34  * Sum  kostpris (SFSUMK)
6.34  *
6.34 c                   eval      w_sumk = sfsumk
6.34  *
6.34  * Sum opprinnelig kostpris (SFSUOK)
6.34  *
     c                   if        sflvre = 0
6.34 c                   eval      w_suok = hokopr * sfanta
     c                   else
     c                   eval      w_suok = 0
     c                   endif
6.34  *
6.34  * Priskode netto kostpris  (SFPKKO)
6.34  *
     c                   if        w_sumk <> 0  and
     c                             w_suok <> 0
6.34 c                   eval      w_diff  = %abs(w_sumk - w_suok)
6.34 c                   if        w_diff > 1
6.34 c                   eval      w_pkko  = 'MAN'
6.34 c                   endif
6.34 c                   endif
6.34  *
6.34  * Sum  innkjøps (SFSUMI)
6.34  *
6.34 c*                  eval      w_sumi = fdinpr * sfanta
6.34  *
6.34  * Sum  opprinnelig innkjøps (SFSUOI)
6.34  *
6.34 c*                  eval      w_suoi = hoinpr * sfanta
6.34  *
6.34  * Priskode netto kostpris  (SFPKIN)
6.34  *
6.34 c*                  if        fdinpr <> 0 and
     c*                            hoinpr <> 0
6.34 c*                  eval      w_diff  = %abs(w_sumi - w_suoi)
6.34 c*                  if        w_diff > 1
6.34 c*                  eval      w_pkin  = 'XXX'
6.34 c*                  endif
6.34 c*                  endif
      *
6.34  *
6.34  * Kilde  (SFKILD)
6.34  *
     c                   if        sffsys <> *blank
     c                   eval      w_kild = sffsys
     c                   else
     c                   if        sfotyp = 'CD' or
     c                             sfotyp = 'CK'
     c                   eval      w_kild = 'KAS'
     c                   else
     c                   eval      w_kild = 'ORD'
     c                   endif
     c                   endif
6.34  *
6.34  * Kontakt/fakturert (SFKOFA)
6.34  *
6.34 c                   if        sfotyp = 'CD' or
6.34 c                             sfotyp = 'CK'
6.34 c                   eval      w_kofa = 'K'
6.34 c                   else
6.34 c                   eval      w_kofa = 'F'
6.34 c                   endif
6.34  *
6.34  * Behandle diverse vare
6.34  *
     c                   if        %found(vvarl1) and
     c                             vvvtyp = 'D'
     c                   eval      w_suno = 0
     c                   eval      w_pkon = *blank
     c                   eval      w_pkns = 'DIV'
     c                   eval      w_suok = 0
     c                   eval      w_pkok = *blank
     c                   eval      w_pkko = 'DIV'
     c                   endif
6.34  *
6.34  * BM Card (SFCARD)
6.34  *
     c                   if        sfbong <> *blank
6.34 c                   eval      bokkl1_bong = sfbong
6.34 c     bokkl1_key    setll     bokkl1
6.34 c     bokkl1_key    reade     bokkl1
6.34 c                   dow       not %eof(bokkl1)
6.34 c                   if        brktyp <> 0 and
6.34 c                             brktyp =  5
6.34 c                   eval      w_card = '05'
6.34 c                   endif
6.34 c                   if        brktyp <> 0 and
6.34 c                             brktyp =  6
6.34 c                   eval      w_fcar = '06'
6.34 c                   endif
6.23 c     bokkl1_key    reade     bokkl1
6.34 c                   enddo
     c                   endif
6.34  *
6.34  *
6.34  *
      ***
      * hvis skaffevare så settes alle priskilder = blank
      ***
     c                   if        sflvre = 1
6.34 c                   eval      w_pkon = *blank
6.34 c                   eval      w_pkns = *blank
6.34 c                   eval      w_pkko = *blank
6.34 c                   eval      w_pkok = *blank
6.34 c                   eval      w_pkoi = *blank
     c                   endif
      ***
      * oppdaterer statistikk
     c                   eval      sstalu_paar  = sfpaar
     c                   eval      sstalu_binr  = sfbinr
     c                   eval      sstalu_ornr  = sfornr
     c                   eval      sstalu_orsu  = sforsu
     c                   eval      sstalu_orli  = sforli
     c                   eval      sstalu_bong  = sfbong
     c                   eval      sstalu_vare  = sfvare
     c                   eval      sstalu_enhe  = sfenhe
     c                   eval      sstalu_anta  = sfanta
     c                   eval      sstalu_date  = sfdate
     c                   eval      sstalu_time  = sftime
     c     sstalu_key    setll     sstalu
     c     sstalu_key    reade     sstalu
     c                   dow       not %eof(sstalu)
6.34  *
6.34  * utvidet statistikk
6.34  *
6.34  * dato / tid opprettet
6.34 c                   eval      sfsoda = w_soda
6.34 c                   eval      sfsoti = w_soti
6.34  *
6.34 c                   eval      sfpkon = w_pkon
6.34 c                   eval      sfpkns = w_pkns
6.34 c                   eval      sfpkko = w_pkko
6.34 c                   eval      sfpkok = w_pkok
6.34 c                   eval      sfpkoi = w_pkoi
6.34 c                   eval      sfkofa = w_kofa
6.34 c                   eval      sfcard = w_card
6.34 c                   eval      sffcar = w_fcar
6.34 c                   eval      sfkild = w_kild
6.34 c                   eval      sfsuno = w_suno
6.34 c                   eval      sfsuok = w_suok
6.34 c                   eval      sfsumn = w_sumn
6.34 c                   eval      sfsumi = w_sumi
6.34 c                   eval      sfsuoi = w_suoi
     c                   update    sstalur
     c     sstalu_key    reade     sstalu
     c                   enddo
6.34  *
6.34 csr                 endsr
      *------------------------------------------------------------------------------
      * Subrutine for å nullstille før utvidet stat.beregning
      *------------------------------------------------------------------------------
      * nullstiller
     c     stat_null     begsr
     c                   eval      w_bels = 0
     c                   eval      w_belk = 0
     c                   eval      w_beln = 0
     c                   eval      w_belo = 0
     c                   eval      w_belb = 0
6.34 c                   eval      w_pkon = *blank
6.34 c                   eval      w_pkns = *blank
6.34 c                   eval      w_pkko = *blank
6.34 c                   eval      w_pkok = *blank
6.34 c                   eval      w_pkin = *blank
6.34 c                   eval      w_pkoi = *blank
6.34 c                   eval      w_kofa = *blank
6.34 c                   eval      w_card = *blank
6.34 c                   eval      w_fcar = *blank
6.34 c                   eval      w_kild = *blank
6.34 c                   eval      w_sumn = 0
6.34 c                   eval      w_sumi = 0
6.34 c                   eval      w_suoi = 0
6.34 c                   eval      w_sumo = 0
6.34 c                   eval      w_suno = 0
6.34 c                   eval      w_suok = 0
6.34 c                   eval      w_suoi = 0
6.34 c                   eval      w_ntpr = 0
6.34 c                   eval      w_rkro_stk = 0
6.34 c                   eval      w_rkro = 0
     c                   eval      w_soda = *loval
     c                   eval      w_soti = *loval
6.34 c                   endsr
      *
6.2A  *
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  * Subrutine for å beregne rabatt
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  *
6.34 c     beregn_rabatt begsr
6.34  *
6.34 c                   eval      w_sumr = 0
6.34  *
her   * hente forabp fra sohepf (slå opp).
6.34  *
6.34  * Rabatt
6.34  *
6.34 c                   if        vvkord = 0
6.34 c                   eval(h)   w_raba = sfrabo
6.34 c                   eval      w_sumr = w_raba
6.34 c                   endif
6.34  *
6.34 c                   if        sfrab1 <> 0
6.34 c*                  eval(h)   w_raba = (sfsumb - w_sumr) * sfrab1 / 100
6.34 c                   eval      w_sumr = w_sumr + sfrab1
6.34 c                   endif
6.34  *
6.34 c                   if        sfrab2 <> 0
6.34 c*                  eval(h)   w_raba = (sfsumb - w_sumr) * sfrab2 / 100
6.34 c                   eval      w_sumr = w_sumr + sfrab2
6.34 c                   endif
6.34  *
6.34 c                   endsr
6.34  *
6.34  *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
     c     *entry        plist
     c                   parm                    p_paar
      *
      *  Key for les av VARE
      *
     c     vvarl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl1_vare
      *
      *  Key for les av ordretype
      *
     c     votyl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    votyl1_otyp
      *
      * Key for file : KUNDE-REGISTER
      *
     c     rkunl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl1_kund
6.34  *
6.34  * Key for lesing av kort-trans
6.34  *
6.34 c     bokkl1_key    klist
6.34 c                   kfld                    w_firm
6.34 c                   kfld                    bokkl1_bong
      *
      * Key for file : statliner
      *
     c     sstal1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    sstal1_paar
      *
      * Key for file : oppdatering av statistikk
      *
     c     sstalu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    sstalu_paar
     c                   kfld                    sstalu_binr
     c                   kfld                    sstalu_ornr
     c                   kfld                    sstalu_orsu
     c                   kfld                    sstalu_orli
     c                   kfld                    sstalu_bong
     c                   kfld                    sstalu_vare
     c                   kfld                    sstalu_enhe
     c                   kfld                    sstalu_anta
     c                   kfld                    sstalu_date
     c                   kfld                    sstalu_time
      *
      *
      *  Legge inn firmanummer i nøklene
      *
     c                   eval      w_firm = l_firm
      *
      *
     c                   endsr
