# Program Documentation: RA009R – Maintenance of Status Codes (Statuskode 9)

## Overview

**Program:** RA009R  
**System:** ASOKON  
**Purpose:** Maintenance of status codes, specifically status code 9.  
**Language:** RPG IV  
**Primary Function:** This program provides interactive maintenance (view, update, and creation) of status code 9 records for customers, including integration with external systems for customer data and factoring status.  
**Main Screen:** `A2BLD` – Maintenance screen for status code 9.

---

## File Definitions

- **RAA9L1**  
  *File:* raa9pfr (renamed to raa9l1r)  
  *Type:* Physical file, keyed access  
  *Purpose:* Main status code 9 master file

- **RAA9LU**  
  *File:* raa9pfr (renamed to raa9lur)  
  *Type:* Physical file, keyed update  
  *Purpose:* Update file for status code 9

- **RA009D**  
  *Type:* Workstation file  
  *Purpose:* Display device for interactive user interface

---

## Key Data Structures & Variables

- **User and Context**
  - `l_user` – User ID from job/session
  - `l_firm` – Company number (from LDA)
  - `l_filg` – File group
  - `l_fnav` – Company name

- **Record Fields (Status Code 9)**
  - `ra9knr`, `a29knr` – Customer number
  - `ra9fmt`, `a29fmt` – Format/type
  - `ra9kli`, `a29kli` – Client
  - `ra9kun`, `a29kun` – Customer
  - `ra9reg`, `a29reg` – Registration
  - `ra9bil`, `a29bil` – Invoice
  - `ra9usr`, `a29usr` – Last user
  - `ra9dat`, `a29dat` – Date

- **Factoring via IIZY**
  - `co402_verdi1`, `co402_verdi2` – Return values from CO402R (external factoring check)
  - `u_iizy` – Internal indicator: factoring via IIZY enabled

- **Parameters for Subprograms**
  - `p_firm`, `p_kund`, `p_navn`, `p_retk` – Company, customer, name, return code

---

## Key External Interfaces

- **CO402R**  
  *Purpose:* Checks if factoring via IIZY is enabled for the company  
  *Parameters:* File group, company, warehouse, key, return values

- **RS750R**  
  *Purpose:* Retrieves customer name for given customer number

- **RK500R**  
  *Purpose:* Customer register lookup (used in inquiry subroutine)

- **RA134R**  
  *Purpose:* Factoring-related processing, called if factoring via IIZY is enabled

---

## Program Flow

### Initialization (`*inzsr`)

- Loads company number and name from LDA into local fields.
- Sets up key lists for file access.
- Calls `CO402R` to determine if factoring via IIZY is enabled for this company. If so, sets `u_iizy` indicator.

### Main Processing

#### 1. Fetch and Display Status Code 9

- Chains to `raa9l1` to retrieve status code 9 for the company.
- If found, moves database fields into screen fields.
- Calls `RS750R` to get customer name for display.
- If factoring via IIZY is enabled, sets error indicator 31 for the display.

#### 2. Main Screen Loop (`A2BLD`)

- Displays the maintenance screen (`exfmt a2bld`).
- Processes function keys:
    - **F3/Exit:** Ends the program.
    - **F12/Cancel:** Ends the program.
    - **F6/Inquiry:** Calls inquiry subroutine (`spørr`), then redisplays screen.
    - **F9/Factoring:** If factoring via IIZY is enabled, calls `RA134R`, then ends the program.

#### 3. Update/Create Status Code 9

- Chains to `raa9lu` to check if a record exists.
- Moves screen fields back to database fields.
- Updates timestamp and user fields.
- If record exists: updates it.  
  If not: writes a new record, also setting audit fields (`ra9oda`, `ra9oti`, `ra9ous`).

#### 4. Program End

- Sets LR indicator and returns, ending the program.

---

## Subroutines

### Inquiry (`spørr`)

- If the active field is customer number (`A29KNR`), calls `RK500R` to look up customer details.
- Updates screen fields with returned customer number and name.

### Initialization (`*inzsr`)

- Loads company number from LDA.
- Sets up key lists for main and update files.
- Checks factoring status via IIZY by calling `CO402R` and sets internal indicator accordingly.

---

## Indicators and Conventions

- **Indicator Usage**
    - `*INKA` (F1): Company selection
    - `*INKC` (F3): Exit
    - `*INLR`: End program
    - `*IN31`-`*IN59`: Error/warning indicators for screen
    - `*IN60`-`*IN69`: File operation indicators
    - `*IN80`-`*IN89`: General work indicators
    - `*IN90`-`*IN99`: Standard subroutine indicators

- **Screen Field Prefixes**
    - `a2*`: Screen fields for status code 9
    - `p_*`: Parameters for subprograms

---

## Business/Domain-Specific Logic

- **Status Code 9**: Represents a specific customer status, maintained per company. The program allows for display, update, and creation of these records.
- **Factoring via IIZY**: If enabled for the company (determined by `CO402R`), certain options (F9) and error indicators are activated, and additional processing (`RA134R`) can be triggered.
- **Customer Data Integration**: Customer names are always fetched from the master customer register (via `RS750R`/`RK500R`), ensuring up-to-date information.

---

## Design Notes

- **File Renaming**: Both main and update files are logicals over the same physical (`raa9pfr`) but are renamed for clarity and to separate read/update logic.
- **External Calls**: All business logic not directly related to status code 9 maintenance (customer lookup, factoring check) is delegated to external programs, promoting modularity.
- **Audit Fields**: On creation, audit fields (`ra9oda`, `ra9oti`, `ra9ous`) are set, supporting traceability.
- **Factoring Option**: The factoring logic is versioned (8.01) and can be toggled per company, making the code adaptable to different client configurations.

---

## Related Modules

- **CO402R**: Factoring configuration (IIZY)
- **RS750R**: Customer name lookup
- **RK500R**: Customer register inquiry
- **RA134R**: Factoring processing

---

## Summary

RA009R is the central maintenance program for status code 9 records, supporting interactive updates, integration with customer and factoring systems, and company-specific configuration. Its design emphasizes modularity, traceability, and adaptability to business requirements. New developers should familiarize themselves with the external program interfaces and the specific conventions for indicator usage and file keying in this codebase.