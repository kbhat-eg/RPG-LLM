# ASLAGR (LE710R) RPG Program â€“ Explanation

## Overview

This RPG program, named **LE710R**, is part of the ASLAGR (Lagertelling, i.e., Stock Counting) system. Its main responsibility is to manage parameter input for updating the warehouse register, serving as an interface between the user and the inventory update process.

The program is designed to collect parameter values, including handling batch numbers (sometimes from the Local Data Area, sometimes via user input), and then hand over control/data to another program (`LE710C`) which performs the actual update.

---

## Program Sections

### 1. Header and Change Log

- The comments at the top describe the program, its purpose, and its revision history (with details on changes and features).
- The program uses `h datedit(*dmy)`, meaning dates are formatted as day-month-year.

---

### 2. File and Variables Declarations

#### Display File

```rpg
fle710d    cf   e             workstn
```
- Declares the display file for interactive workstation input.

#### Batch Parameter Variable

```rpg
d p_batc          s             10
```
- A 10-character variable defined for batch processing.

#### Parameter Data Structure

```rpg
d                 ds
d d_prec                        64
d  d_batc                       10    overlay(d_prec)
d  d_val1                        1  0 overlay(d_prec:11)
d  d_val2                        1  0 overlay(d_prec:12)
d  d_val3                        1  0 overlay(d_prec:13)
d  d_val4                        1  0 overlay(d_prec:14)
d  d_val5                        1  0 overlay(d_prec:15)
```
- `d_prec` is a 64-byte area holding all parameters to be passed to the next program.
- `d_batc` (batch number), `d_val1`..`d_val5` are overlays within this structure, representing specific input parameters.

#### Local Data Area (LDA)

```rpg
d lda            uds
d l_firm                944    946  0
d l_fnav                951    980
d l_batc               1006   1015
```
- The LDA is used to fetch company and batch information pre-populated elsewhere.

#### Working Variables

```rpg
d w_batc          s             10
d w_retu          s              1
d w_valg          s              1
```
- `w_batc`: batch number in work area.
- `w_retu`: return flag from called programs.
- `w_valg`: selection variable (set to '1' for batch operation).

---

### 3. Main Logic Flow

#### Batch Number Input

```rpg
c     a1tag         tag
c                   if        l_batc <> ' '
c                   eval      w_batc = l_batc
c                   else
c                   eval      w_retu = 'O'
c                   call      'LC500R'
c                   parm                    w_retu
c                   parm                    w_batc
c                   if        w_retu <> *blank
c                   goto      end_pgm
c                   endif
c                   endif
c                   eval      d_batc = w_batc
```

- If `l_batc` (batch number from LDA) is not blank, use it.
- Otherwise, prompt the user for a batch number via call to subprogram `LC500R`.
    - If user quits or doesn't provide a valid number, the program exits.
- The batch number is stored in `d_batc` for parameter passing.

---

#### Parameter Input and Display

```rpg
c     b1tag         tag
...
c                   eval      b1val1 = 1
c                   eval      b1val2 = 1
c                   eval      b1val3 = 0
c                   eval      b1val4 = 0
...
c                   exfmt     b1bld
```

- Default values are set for parameter fields (these would correspond to display/input fields in the display file).
- `exfmt b1bld`: Shows the parameter entry screen.

#### Special Keys and Validation

```rpg
c                   if        *inkc = *on
c                   goto      end_pgm
c                   endif
...
c                   if        b1val1 = 0
c                   goto      end_pgm
c                   endif
```
- If the user presses F3 (usually mapped to `*inkc`), exit program.
- If the first parameter entered is 0, exit as well.

---

#### Store Values and Call Update Program

```rpg
c                   eval      d_val1 = b1val1
c                   eval      d_val2 = b1val2
c                   eval      d_val3 = b1val3
c                   eval      d_val4 = b1val4
c                   eval      d_val5 = b1val5
c                   call      'LE710C'
c                   parm                    d_prec
c                   parm                    w_valg
```
- Copy entered values into the parameter data structure.
- Call the next program (`LE710C`) with all parameters.
- `w_valg` seems to indicate batch/manual selection or similar control.

---

#### Program End

```rpg
c     end_pgm       tag
c                   eval      *inlr = *on
c                   return
```
- Sets last record indicator for program closure and returns.

---

### 4. Initialization Subroutine

```rpg
c     *inzsr        begsr
c     *dtaara       define    *lda          lda
c                   eval      w_valg = '1'
c                   endsr
```

- On program start, defines the `lda` data structure as the LDA for output.
- Sets `w_valg` to '1' (indicating batch processing as default).

---

## Summary

**LE710R** is an interactive RPG program that:

- Obtains the batch number (either from LDA or user).
- Presents a screen for additional parameter input.
- Validates input/handles user-exit requests.
- Packs input parameters into a data structure.
- Calls an external program (`LE710C`) to perform the update.
- Handles both interactive and batch operation.

The program uses standard RPGIII/IV (fixed format), employs overlays in data structures to pass tightly-packed parameters, and makes extensive use of tags and `goto` for control flow. 

This code is typical for legacy IBM iSeries (AS/400) applications dealing with user input, batch integration, and parameterized program handoff.