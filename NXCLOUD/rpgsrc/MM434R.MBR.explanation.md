# RPG Program MM401R – Explanation

This RPG IV (ILE RPG/400) program is named `MM401R`. Its primary purpose is to **delete simulated purchase forecast records** (*sletter prognose innkjøpstall*). Below is a structured breakdown of its source code and logic.

---

## 1. Control and Header Specifications

```rpg
h option(*nodebugio) datedit(*dmy)
```
- **H-Spec**: 
  - `*nodebugio`: Disables debugging of file I/O operations.
  - `datedit(*dmy)`: Sets the default date format as day-month-year.

---

## 2. File Definition

```rpg
fmprolu    uf   e           k disk    rename(mpropfr:mprolur)
```
- **File Declaration:**  
  - File `MPROLU` is defined for update (`uf`), externally described (`e`), keyed (`k`), and on disk (`disk`).
  - The record format in the file is renamed from `MPROPFR` to `MPROLUR` in the program.

---

## 3. Variable and Data Structure Definitions

### Key Fields

```rpg
d mprolu_firm     s                   like(mofirm)
```
- Declares a standalone field `mprolu_firm` with the same type as `MOFIRM` (firm field).

### Local Data Area

```rpg
d                uds

d l_firm                944    946  0
```
- **UDS**: Declares the use of the User Data Space for program variables.
- `l_firm`: Located in the LDA (Local Data Area), positions 944-946.

### Working Variables

```rpg
d w_firm          s                   like(mofirm)
```
- `w_firm`: Working copy of the firm key field.

---

## 4. Mainline Program

```rpg
c                   exsr      slett_sim
```
- Calls subroutine `SLETT_SIM` to carry out the simulated deletion process.

---

## 5. Program Termination

```rpg
c     avslutt       tag

c                   eval      *inlr = *on

c                   return
```
- `*INLR = *ON` indicates end of program and releases resources.
- `return` exits the program.

---

## 6. Subroutine: SLETT_SIM

**Deletes all simulated purchase forecast records for a specific firm.**

```rpg
c     slett_sim     begsr

c     mprolu_key    setll     mprolu
c     mprolu_key    reade     mprolu
c                   dow       not %eof
c                   delete    mprolur
c     mprolu_key    reade     mprolu
c                   enddo

c                   endsr
```

- **SETLL (`mprolu_key`)**: Positions file to the first record matching the key.
- **READE (`mprolu_key`)**: Reads the next record with the matching key.
- **DOW NOT %EOF**: Loop begins. `%EOF` is true if the end of file is reached.
- **DELETE (`mprolur`)**: Deletes the current record.
- The loop continues for all records with the key, deleting as it goes.

---

## 7. Subroutine: *INZSR

**Program initialization. Sets up the key for deleting forecasts for a specific firm.**

```rpg
c     *inzsr        begsr

c     mprolu_key    klist
c                   kfld                    w_firm

c                   eval      w_firm = l_firm

c                   endsr
```

- **KLIST (`mprolu_key`)**: Declares a key list for I/O operations.
- **KFLD (`w_firm`)**: Key field used in file operations.
- **EVAL**: Sets `w_firm` (working firm) to value from `l_firm` (from LDA).

---

## 8. What does the program do?

1. **Initialization (`*INZSR`):**
    - Sets up the key for firm to process, based on the Local Data Area.
2. **Processing (`SLETT_SIM`):**
    - Loops over all records in the `MPROLU` file for the given firm and deletes them.
3. **Terminating:**
    - Cleans up and exits the program.

---

## 9. Usage Scenario

Typically, this program would be run to clear out all simulated forecast data for a particular firm, as specified in the LDA, likely as part of a nightly or on-demand batch process. 

---

### Notes

- Much of the code is written in fixed-format RPG IV (pre-free format).
- "b�" is likely the initials of the developer who made modifications.
- Comments are in Norwegian.

---

### Summary Table

| Section            | Purpose                                                    |
|--------------------|------------------------------------------------------------|
| H-Spec             | Control options, date format                               |
| File Declaration   | Declares main file to process                              |
| Variable Defs      | Allocates variables for keys, working, and LDA fields      |
| Mainline           | Calls deletion subroutine                                  |
| Termination        | Ensures proper program end state                           |
| SLETT_SIM subr     | Loops and deletes forecast records for one firm            |
| *INZSR subr        | Reads firm from LDA, builds key for record selection       |

---

This program is a utility for batch deletion of simulated purchase forecast records for a specific firm/company, determined at runtime via the LDA.