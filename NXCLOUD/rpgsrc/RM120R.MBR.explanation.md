```markdown
# Overview
This program, named **RM120R**, is written in traditional (fixed-format) ILE RPG and is intended for maintaining property associations (`Eiendomsknytning, vedlikehold`). The source contains extensive comments and is well-structured around the use of subfiles for interactive screen-based (DSPF/DDS) maintenance operations on a database, likely part of a Customer/Property relationship system.

## Structure

The code has the following major components:
- **File Declarations:** Declares database and display files (DSPF), along with renaming records for easier reference.
- **Data Definitions:** Variables and data structures for fields, working variables, constants, keys, and the Local Data Area (LDA).
- **Subroutines:** Each subroutine (`begsr`/`endsr`) encapsulates a functional block, e.g., editing, copying, positioning, etc.
- **Main Logic Flow:** Utilizes tags, subfile record selection, navigation, and display interaction to process user actions.

---

## Key Sections Explained

### 1. File Declarations

```rpg
frmknl1    if   e           k disk    rename(rmknpfr:rmknl1r)
frmeil2    if   e           k disk    rename(rmeipfr:rmeil2r)
frmknlr    if   e           k disk    rename(rmknpfr:rmknlrr)
frmknlu    uf a e           k disk    rename(rmknpfr:rmknlur)

frm120d    cf   e             workstn sfile(b1sfl:w_srrn)
f                                     infds(dspfbk)
```
- **Database files** for master/lookup are renamed for clarity.
- **Display file** (workstn, i.e., DSPF) has a subfile (`b1sfl`) and an info data structure for display feedback.

---

### 2. Data Definitions & Usage

#### Local Data Area and Info Data Structure:

```rpg
d                uds
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980

d dspfbk          ds
d  d_fcrn               378    379I 0
```
- Fields mapped from the LDA for user, firm, etc.
- `dspfbk` is a display feedback structure (e.g., current record number).

#### Work Variables

- Numerous work variables to track subfile position, state, and navigation (`w_srrn`, `w_ssrn` etc.).
- Flags (`b_oppr`, `b_forn`, etc.) to indicate operation mode/status.

---

### 3. Main Program Logic

#### Initial Program Flow

The main interactive loop alternates between:
- Displaying a subfile or command screen
- Accepting function key input (handled via indicators)
- Branching to subroutines for add, edit, copy, delete, or navigation actions

#### Function Key Usage

Standardized indicator assignments, e.g.:
- `*IN10` = Roll up (page forward)
- `*IN11` = Roll down (page backward)
- `*INKC`/`*INKL` = F3/F12 keys, exit/cancel

---

### 4. Subroutines & Processing

#### `forny` — Refresh Subfile
Refreshes the subfile data after certain operations or when navigation requires it.

#### `posisjoner` — Positioning
Positions the subfile based on criteria (group number or description).

#### `subfile` — Main Subfile Handling
Processes user actions on subfile records (Edit, Copy, Delete, View). For each record selected:
- Edit (2): invokes editing subroutine.
- Copy (3): invokes copy subroutine.
- Delete (4): confirmation and then delete.
- View (5): view details.

#### `xc1bld` — Add New Row
Handles the display and processing for adding a new record. Checks for duplicates and validates inputs.

#### `xc2bld` — Edit/View Row
Handles editing/viewing a record, including calling external maintenance programs (`RM720R`).

#### `xd1win`, `xk1win` — Delete/Copy Windows
Handles the windows/dialogs for delete and copy actions.

#### `clr_subfile`, `crt_subfile`, `bck_subfile`
Manage subfile pagination: clearing, repopulating, and paging backwards.

#### `dsp_subfile`
Handles display of the subfile and related indicators.

#### `*inzsr` — Initial Program Setup
Sets up parameter lists, key lists for file access, initializes working variables, and loads the initial subfile contents.

---

## Design Patterns

- **Subfile Paging:** Uses work variables and subfile indicators to manage large lists via pages.
- **Global Indicators:** Function key and subfile state are managed via indicator variables.
- **Modular Subroutines:** Each functional area is in its own subroutine, following classic RPG patterns.

---

## Interaction with Other Programs

- **Calls `RM510R`** for property search
- **Calls `RM720R`** for external property maintenance/view
- **Uses Local Data Area (LDA)** for context (user, company)

---

## Key Concepts for Onboarding

- **Subfile Processing**: Core user interaction revolves around DSPF subfiles for record lists and details.
- **Indicators**: Program logic and navigation are heavily tied to the use of numbered indicators and their RPG conventions.
- **File Structure**: Knowledge of the physical and logical files (`rmknpfr`, `rmeipfr`, etc.) is needed to understand the data domain.
- **Legacy Patterns**: The program uses fixed-format RPG (not free-form), so familiarity with column-based RPG and legacy conventions is helpful.

---

## Summary of Screen Flow

1. **Startup**: Load subfile with records for the given customer/property context.
2. **Display and Navigation**: User can page through, search, and select records.
3. **Record Actions**: Edit, copy, delete, view via function keys or subfile options.
4. **Subfile/Screen Refresh**: After each action, screen is refreshed and subfile is reloaded if necessary.
5. **Exit**: User can exit via function keys; program ensures cleanup via indicator LR.

---

## Notes

- **Comments are in Norwegian**, which may require translation for non-Norwegian speakers.
- **Error Handling and Validation**: Is handled via indicators (e.g., *IN31 for warning/error).
- **Expansion**: The structure allows for adding additional subfile-based actions or screens with minimal impact.

---

## To Get Started

- Understand the subfile mechanism in RPG.
- Review the file layouts (`rmknpfr`, `rmeipfr`, etc).
- Work through the process for adding, editing, and deleting records using the subfile options.
- Pay attention to how indicators handle screen flow and function keys.
- Review the display file (DSPF) definitions for subfile and control records.
```