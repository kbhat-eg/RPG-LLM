      /TITLE  ASOKON Arbeid med returfiler
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      * System  . . . . : ASOKON                                        *
      * Program . . . . : GL118R                                        *
      * Beskrivelse . . : Arbeid med returfiler - Velger ut Telegiro-   *
      *                   og OCR-returer som skal oppdateres.           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      * Spesialversjon. :                                               *
      * Tilpasset for . :                                               *
      *                                                                 *
      * Referanse  Dato   Endringsbeskrivelse                      Sign.*
      * --------- ------  ----------------------------------------------*
      *           180195  Nytt program januar-1995                 RH   *
      *                                                                 *
      * 06108     061098  Bygger unikt membernavn.  Før bestod     RH   *
      *                   membernavn av TELE + firmanummer, men         *
      *                   vil nå bestå av GL + unik teller.             *
      *                                                                 *
      * 11108     111098  Lagt inn behandling av inkassoreturer.   RH   *
      *                                                                 *
      * 03010     030100  Feil i ÅR2000 test.  Tatt bort test mot  RH   *
      *                   om post tilhører 1900.                        *
      *                                                                 *
      * 08060     080600  Lagt inn mulighet for å slette BATCH.    RH   *
      *                                                                 *
      * 09060     090600  Tar kopi av BATCH ut på file GBTRPF.     RH   *
      *                                                                 *
      * 02080     020800  Tømmer GTRTPF før kontroll-/journal-     RH   *
      *                   kjøring.                                      *
      *                                                                 *
      * 03080     030800  Sletter kopier på GBTRPF som er eldre    RH   *
      *                   enn tre måneder.                         RH   *
      *                                                                 *
      * 12100     121000  Lagt inn parameter ved kall av RC120C,   RH   *
      *                   i forbindelse med Lindorf.               RH   *
      *                                                                 *
      * 04011     040101  Legger ut filgruppe, firma og sonekode   RH   *
      *                   i bildet som viser returene.             RH   *
      *                                                                 *
      * 17011     170101  Filgruppe og firma hentes i fra GATRPF,  RH   *
      *                   før ble de hentet fra GAVTPF. Sonekode   RH   *
      *                   hentes i fra GAVTPF.                     RH   *
      *                                                                 *
      * 19011     190101  Legger ut SONEKONTONUMMER (GCSKTO) fra   RH   *
      *                   faste data i feltet WPGIRO, i steden for RH   *
      *                   å legge ut BANKKONTONUMMER (GCBGIR).     RH   *
      *                                                                 *
      * 31011     310101  Filen GBTRPF (kopifil) har nå to nye     RH   *
      *                   felter, d.v.s. filgruppe og firma.       RH   *
      *                   Feltene må oppdateres med verdier fra    RH   *
      *                   GATRPF.                                       *
      *                                                                 *
      * 05021     050201  Ettar at det er innført historikk (F12)  RH   *
      *                   på returer, så kan gml. historikk (F9)   RH   *
      *                   fjernes, d.v.s. ikke behov for "null"-   RH   *
      *                   posten.                                       *
      *                                                                 *
      * 23081     230801  Ettar at sonekontonummer ble innført, så RH   *
      *                   vil det ikke være behov for å teste på   RH   *
      *                   om det finnes flere linjer i avtalereg.  RH   *
      *                   med likt filgrp og firma.  Alle linjer   RH   *
      *                   med likt sonekontonummer er allerede     RH   *
      *                   tatt med, og løser derfor dette. Er det  RH   *
      *                   flere avtaler for filgrp og firma, med   RH   *
      *                   ulikt kontonummer, så SKAL likevel sone- RH   *
      *                   kontonummer være likt.                   RH   *
      *                                                                 *
      * 27024     270204  Lagt inn kontroll på om TF2 er mottatt   RH   *
      *                   og bokført tidligere.  Program GL210R    RH   *
      *                   utfører denne kontrollen.                RH   *
      *                                                                 *
      * 27044     270404  Lagt inn mbrnavn på 10 pos for regnskap  AS   *
      *                                                                 *
      * 30044     300404  Blanker membernavn dersom feil innhold.  RH   *
      *                                                                 *
      * 08074     080704  Utvidet kontrollen mhp TF2 (27024)       RH   *
      *                                                                 *
      * 12105     121005  Avviser ikke lenger hele batchen når det RH   *
      *                   mottas dobbel retur for en post, dvs det      *
      *                   er brukeren selv som må slette post via       *
      *                   "Jusering".                                   *
      *                                                                 *
      * 26037     260307  Kontroll på om det finnes poster(member) RH   *
      *                   i file RTRAPF. I såfall er det poster    RH   *
      *                   til regnskap, som først må oppdateres    RH   *
      *                   slettes.                                 RH   *
6.10  *           011010  Blanker member etter test om oppdatering NHO  *
      *                   er OCR, hang igjen fra tidligere kjøring NHO  *
      *                   dersom det ikke var gått ut av utvalgs-  NHO  *
      *                   bildet                                        *
      * 6.11      200511  Lagt inn kontroll mot sperrefil          ASK  *
7.xx  * 7.xx      120618  Endringer reltart til ny GUI.            BKV  *
7.xx  * K000      220620  Takler brede skjermbilder.               bsa  *
7.nx  * K000      171120  Endringer relatert til One Nexstep       bsa  *
      *                                                                 *
7.fb  *       080217  Utvidelse av parm til RF120C             bof
      *                                                                 *
8.01  *K0000  220424 bsa  Leser inn SEPA format. De betyr at vi hopper  *
8.01  *K0000              over endel tester som skjer i gammelt NX      *
8.02  *K0000  060524 bsa  Tar høyde for OCR type                        *
8.03  *K0000  130524 bsa  Hvis koden er ACTC, flagg info melding        *
8.04  *K0000  150524 bsa  SP2 koden er den samme som TF2. Må gjennom    *
8.04  *K0000              samme sjekker, og legges ut i samme format    *
8.04  *K0000              som om det var gammel TF2.                    *
8.05  *K0000  220524 bsa  Merker at det er poster til oppdatering.      *
8.06  *K0000  180924 bsa  Endret tagger for å identifisere betalingen   *
8.07  *K0000  210225 bsa  Må kjøre oppdateringer om retur.             *
      *                                                                 *
      *                                                                 *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      *  BRUK AV INDIKATORER                                            *
      *                                                                 *
      *       KC = F3  = Exit                                           *
      *       KE = F5  = Forny                                          *
      *       KL = F12 = Annuller                                       *
      *                                                                 *
      *       LR = Avslutt program                                      *
      *   SUBFILE-1:                                                    *
      *       10 = Roll                                                 *
      *       12 = Sfldsp                                               *
      *       13 = Sfldspctl                                            *
      *       14 = Sflclr                                               *
      *       15 = Sflend                                               *
      *       16 = Readc 16 on, no more records                         *
      *   SUBFILE-2:                                                    *
      *       20 = Roll                                                 *
      *       22 = Sfldsp                                               *
      *       23 = Sfldspctl                                            *
      *       24 = Sflclr                                               *
      *       25 = Sflend                                               *
      *       26 = Readc 26 on, no more records                         *
      *                                                                 *
      *   SUBFILE-3:                                                    *
      *       30 = Roll                                                 *
      *       32 = Sfldsp                                               *
      *       33 = Sfldspctl                                            *
      *       34 = Sflclr                                               *
      *       35 = Sflend                                               *
      *       36 = Readc 36 on, no more records                         *
      *                                                                 *
      *    40-50 = Varsle m/feilmeldinger/skjermindikatorer             *
      *    44    = Viser periodefelt i skjrmebildet:                    *
      *    60-69 = Fileindikatorer chain etc.                           *
      *    70-79 = Arbeidsindikatorer i sub-rutiner                     *
      *    80-89 = Arbeidsindikatorer ordinære                          *
      *    90-99 = Benyttes ved std. sub-rutiner                        *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     fgl118d    cf   e             workstn
     f                                     sfile(b1sfl:srrn01)
     f                                     sfile(c1sfl:srrn02)
     f                                     sfile(d1wsf:srrn03)
     fgatrl1    if   e           k disk    rename(gatrpfr:gatrpf1)
     fgatrlu    uf   e           k disk    rename(gatrpfr:gatrpfu)
8.01 fgubflu    uf   e           k disk    rename(gabfpfr:gubflur)
8.04 fgubfl8    if   e           k disk    rename(gabfpfr:gubfl8r)
8.04 frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
8.07 frltrlu    uf   e           k disk    rename(rltrpfr:rltrlur)
     fgavtl2    if   e           k disk
09060fgbtrpf    o  a e           k disk
     fgtrtpf    o  a e             disk
     fgortpf    o  a e             disk
11108frcnrpf    o  a e             disk
8.04 fgur2pf    o  a e             disk
      *
8.01 d gubflu_bfnr     s                   like(gabfnr)
8.01 d gubflu_bfli     s                   like(gabfli)
8.04 d gubfl8_bfnr     s                   like(gabfnr)
8.04 d gubfl8_bfli     s                   like(gabfli)
8.04 d rlevl1_levr     s                   like(rllevr)
8.07 d rltrlu_levr     s                   like(rllevr)
8.07 d rltrlu_bdat     s                   like(robdat)
8.07 d rltrlu_tist     s                   like(rotist)
      *
     d giro            s             11  0 dim(999)
     d lØpn            s              5  0 dim(999)
     d type            s              3    dim(999)
     d oppd            s              7  0 dim(999)
     d dato            s              8  0 dim(999)
     d klok            s              6  0 dim(999)
04011d skod            s              3    dim(999)
     d filg            s              3    dim(999)
     d firm            s              3  0 dim(999)
      *
     d txt             s             44    dim(5) ctdata perrcd(1)
      *
8.01 d b_sepa          s              1    inz(*off)
8.01 d b_betf          s              1    inz(*off)
8.01 d b_start         s              1    inz(*off)
8.03 d b_actc          s              1    inz(*off)
8.04 d b_sp2p          s              1    inz(*off)
8.04 d b_sp2d          s              1    inz(*off)
      *
8.01 d w_ref           s             80
8.01 d w_kode          s             80
8.01 d w_kode2         s             80
8.01 d w_posi          s              2  0
8.01 d w_bref          s              5
8.01 d w_lin1          s             10
8.01 d w_lin2          s             10
8.01 d w_lin3          s             10
8.01 d w_lin4          s             10
8.01 d w_lin5          s             10
8.03 d w_mld1          s             50
8.03 d w_mld2          s             50
8.03 d w_mld3          s             50
8.03 d w_line          s              4  0
8.03 d w_accp          s              4
8.04 d w_fdat          s             10
      *
8.01 d c_data_start    c                   'OrgnlPmtInfAndSts'
8.01 d c_data_slutt    c                   '/OrgnlPmtInfAndSts'
8.01 d c_ref           c                   'OrgnlPmtInfId'
8.01 d c_ref_kode      c                   'PmtInfSts'
8.01 d c_ref_kode2     c                   'TxSts'
8.03 d c_accp_kode     c                   'GrpSts'
8.06 d*c_sp2_sNtry     c                   'Ntry>'
8.06 d c_sp2_sNtry     c                   'TxDtls>'
8.06 d*c_sp2_eNtry     c                   '/Ntry>'
8.06 d c_sp2_eNtry     c                   '/TxDtls>'
8.04 d c_sp2_sBdto     c                   'BookgDt'
8.04 d c_sp2_sDt       c                   'Dt'
8.04 d c_sp2_eDt       c                   '/Dt'
8.04 d c_sp2_sPmtId    c                   'PmtInfId'
8.04 d c_sp2_ePmtId    c                   '/PmtInfId'
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Definering av felter                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      *     nn - er 01 for subfile 01,
      *             02 for subfile 02,
      *             03 for subfile 03, o.s.v.
      * SRRNnn - Relativt recordnummer i subfile
      * SPGEnn - Sidestørrelse i subfile (page)
      * SFRNnn - Første recordnummer på siden
      * SSRNnn - Siste  recordnummer på siden
      * SVRNnn - Vis den side som inneholder denne record.
      *
      * Forklaring på spesielle felter
      * som benyttes ved windows.
      * - - - - - - - - - - - - - - - - -
      *
      * w_arow - Actual line, angir startlinje for vindu.
      * w_acol - Actual posision, angir startposisjon for vindu.
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      *
      * B1SFL  - B1 Subfile - record
      * B2CTL  - B2 Subfile - control record - Mottatte transaksjoner
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      * C1SFL  - C1 Subfile - record
      * C2CTL  - C2 Subfile - control record - Viser RECORD ("rådump").
      * C2CMD  - C2 Eget skjermbilde for CMD-taster
      * D1WSF  - C1 Subfile window - record
      * D2WCT  - C2 Subfile window - control record - Til oppdatering.
      * D2CMD  - C2 Eget skjermbilde for CMD-taster - Window definisjon
      *
      /eject
      *
      * Henter firmanavn.
      *
     d lda            uds
     d l_prtf                800    809
     d l_chgv                844    844
     d l_user                911    920
     d l_filg                931    933
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Datastruktur for dato:
      *
     d                 ds
     d wpdato                         8  0
     d  wpdatÅ                        4  0 overlay(wpdato)
     d  wpdatm                        2  0 overlay(wpdato:5)
     d  wpdatd                        2  0 overlay(wpdato:7)
      *
      * Datastruktur for dato:
      *
     d                 ds
     d dsdato                         8  0
     d  dsdatd                        2  0 overlay(dsdato)
     d  dsdatm                        2  0 overlay(dsdato:3)
     d  dsdatÅ                        4  0 overlay(dsdato:5)
      *
      * Datastruktur for å "pakke" record fra 80x4 til 320x1:
      *
     d                 ds
     d dstota                       160
     d  dsa                          80    overlay(dstota)
     d  dsb                          80    overlay(dstota:81)
     d dstotb                       160
     d  dsc                          80    overlay(dstotb)
     d  dsd                          80    overlay(dstotb:81)
      *
      * Generell datastruktur for GTRTPF-record:
      *
     d                 ds
     d dsa00a                       160
     d  dsbetf                        8    overlay(dsa00a:41)
     d dsa00b                       160
      *
      * Datastruktur som GTRTPF legges over i dersom BETFOR01:
      *
     d                 ds
     d dsb00a                       160
     d  dsbfgr                        3    overlay(dsb00a:95)
     d  dsbfir                        3  0 overlay(dsb00a:108)
     d dsb00b                       160
      *
      * Datastruktur som GTRTPF legges over i dersom BETFOR21:
      *
     d                 ds
     d dsc00a                       160
     d  dscfgr                        3    overlay(dsc00a:95)
     d  dscfir                        3  0 overlay(dsc00a:108)
     d dsc00b                       160
      *
      * Datastruktur som GTRTPF legges over i dersom BETFOR04:
      *
     d                 ds
     d dsd00a                       160
     d  dsdfgr                        3    overlay(dsd00a:131)
     d  dsdfir                        3  0 overlay(dsd00a:134)
     d dsd00b                       160
      *
      * Datastruktur som GTRTPF legges over i dersom BETFOR23:
      *
     d                 ds
     d dse00a                       160
     d dse00b                       160
     d  dsefgr                        3    overlay(dse00b:83)
     d  dsefir                        3  0 overlay(dse00b:86)
      *
      * Datastruktur for test på periode:
      *
     d                 ds
     d dsperi                         6  0
     d  dspemÅ                        2  0 overlay(dsperi)
     d  dspeÅr                        4  0 overlay(dsperi:3)
8.04  *
8.04  * Datastruktur for forfallsdato - sepa
8.04  *
8.04 d                 ds
8.04 d d_dato                        10
8.04 d  d_aar                         4  0 overlay(d_dato)
8.04 d  d_mnd                         2  0 overlay(d_dato:6)
8.04 d  d_dag                         2  0 overlay(d_dato:9)
8.04  *
8.04  * Datastruktur for forfallsdato - sepa
8.04  *
8.04 d                 ds
8.04 d x_dato                         8  0
8.04 d  x_aar                         4  0 overlay(x_dato)
8.04 d  x_mnd                         2  0 overlay(x_dato:5)
8.04 d  x_dag                         2  0 overlay(x_dato:7)
      *
     d d2peri          s              4  0
     d i               s              3  0
     d sfrn01          s                   like(srrn01)
     d sfrn02          s                   like(srrn02)
     d sfrn03          s                   like(srrn03)
     d spge01          s              3  0
     d spge02          s              3  0
     d spge03          s              3  0
     d srrn01          s              4  0
     d srrn02          s              4  0
     d srrn03          s              4  0
     d ssrn01          s                   like(srrn01)
     d ssrn02          s                   like(srrn02)
     d ssrn03          s                   like(srrn03)
     d w_arow          s              2  0
     d w_acol          s              3  0
     d wpgiro          s                   like(gbgiro)
     d wpink           s              2
     d wpin03          s              1  0
     d wpin09          s              2
     d wpin12          s              1  0
27024d wxlØpn          s                   like(gblØpn)
27024d wxtype          s                   like(gbtype)
27024d wxgiro          s                   like(gbgiro)
27024d wxfeil          s              1
27024d wxfilg          s              3
27024d wxfirm          s              3  0
27024d wxbfnr          s              3  0
27024d wxbfli          s              5  0
08074d wxlevr          s              6  0
08074d wxleva          s             15
08074d wxbelp          s             15  2
     d wplØpn          s                   like(gblØpn)
     d wpmber          s              7
6.10 d wxmber          s              7
30044d wpnumm          s              1
27044d wpmb10          s             10
     d wpsyst          s              4
     d wpocr           s              2
     d wpoppd          s              2
     d wppeÅr          s              4  0
     d wppemÅ          s              2  0
     d wpperi          s              6
     d wpregn          s              2
     d wptele          s              2
     d wptell          s                   like(gbtell)
     d wptype          s                   like(gbtype)
     d xxgiro          s                   like(gbgiro)
     d xxlØpn          s                   like(gblØpn)
      *
27037d wpvalg          s              1
     d w_info          s              1
     d w_mbr7          s              7
6.11 d w_mber          s             10
6.11 d w_fira          s              3
7.fb d w_joko          s              1
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * B2CTL Behandle åpningsbildet med subfile                        *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Send Alt
      *
     c     b2taga        tag
     c     wpin12        cabeq     1             xslutt
      *
     c                   write     b2cmd
      *
      * Bare data
      *
     c     b2tagb        tag
      *
     c                   exsr      xdsp01
      *
      * F3=Avslutt program i fra subfile program.
      * *IN40=*ON -> Record på avtaleregister finnes ikke
      *              for pålogget bruker-id:
      *
     c     *inkc         cabeq     *on           xslutt
      *
      *  ****************
      *  HISTORIKK (F14):
      *  ****************
      *
09060c                   if        *inkn = *on
      *                                                        .
     c                   call      'GL228R'
      *                                                        .
      * Henter gironummer ut i fra filgruppe/firmanummer:      .
      *                                                        .
     c     key03         setll     gavtl2
     c     key03         reade     gavtl2                                 60
      *                                                        .
     c                   eval      wpgiro = 0
      *                                                        .
     c                   if        gcbgir <> 0
     c                   eval      wpgiro = gcbgir
     c                   else
     c                   eval      wpgiro = gcpgir
     c                   endif
      *                                                        .
      * Bruker SONEKONTONUMMER (GCSKTO) i fra faste data,      .
      * i steden for BANKKONTONUMMER (GCBGIR).                 .
      *                                                        .
19011c                   eval      wpgiro = gcskto
      *                                                        .
     c                   exsr      xinke
     c                   if        sfrn01 <> *zero
     c                   goto      b2tagb
     c                   else
     c                   goto      b2taga
     c                   endif
      *                                                        .
09060c                   endif
      *
      * Forny
      *
     c                   if        *inke = *on
      *                                                        .
27024c     tagf5         tag
      *                                                        .
      * Henter gironummer ut i fra filgruppe/firmanummer:      .
      *                                                        .
     c     key03         setll     gavtl2
     c     key03         reade     gavtl2                                 60
      *                                                        .
     c                   eval      wpgiro = 0
      *                                                        .
     c                   if        gcbgir <> 0
     c                   eval      wpgiro = gcbgir
     c                   else
     c                   eval      wpgiro = gcpgir
     c                   endif
      *                                                        .
      * Bruker SONEKONTONUMMER (GCSKTO) i fra faste data,      .
      * i steden for BANKKONTONUMMER (GCBGIR).                 .
      *                                                        .
19011c                   eval      wpgiro = gcskto
      *                                                        .
     c                   exsr      xinke
     c                   if        sfrn01 <> *zero
     c                   goto      b2tagb
     c                   else
     c                   goto      b2taga
     c                   endif
     c                   endif
      *
      * Roll
      *
     c                   if        *in10 = *on
     c                   exsr      xcrt01
     c                   goto      b2tagb
     c                   endif
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Behandling av subfile                                           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Sjekk om valg
      * er foretatt i
      * subfile
      *
     c                   do        ssrn01
     c                   readc     b1sfl                                  16
      *                                                                 .
     c                   if        *in16 = *on
     c                   leave
     c                   endif
      *                                                                 .
      * Velge for oppdatering:                                          .
      *                                                                 .
     c                   if        b1valg = '1'
      *                                                        .        .
      * Tester at post i subfile ikke allerede er valgt via    .        .
      * feltene B2VALG/B2LØPN.  I såfall vil første element    .        .
      * i tabellen inneholde denne verdien:                    .        .
      *                                                        .        .
     c                   if        b1lØpn = lØpn(1)
     c                   eval      b1valg = *blank
     c                   update    b1sfl
     c                   iter
     c                   endif
      *                                                        .        .
      * Må lagre innhold av WPGIRO og WPLØPN, slik at          .        .
      * posisjonering i subfile-1 opprettholdes:               .        .
      *                                                        .        .
     c                   eval      xxlØpn = wplØpn
     c                   eval      xxgiro = wpgiro
      *                                                        .        .
      * Fyller opp tabell med informasjon om batch som skal    .        .
      * oppdateres.  NB! Det vil ikke være tillatt å kjøre     .        .
      * dobbel oppdatering på OCR-returen, d.v.s. tellerfelt   .        .
      * GBTELL må være ulik null:                              .        .
      *                                                        .        .
     c                   if        b1tell = 0
     c                   eval      b1valg = *blank
     c                   update    b1sfl
     c                   iter
     c                   endif
      *                                                        .        .
      * Setter status for å fortelle at det er valgt ut        .        .
      * returer for oppdatering:                               .        .
      *                                                        .        .
     c                   movel     'JA'          wpoppd
     c                   eval      wpin12 = 0
      *                                                        .        .
      * Legger over verdier til tabellelementer:               .        .
      *                                                        .        .
     c                   eval      i = i + 1
      *                                                        .        .
     c                   eval      giro(i) = b1bgir
     c                   eval      lØpn(i) = b1lØpn
     c                   movel     b1type        type(i)
     c                   eval      dato(i) = b1dato
     c                   eval      klok(i) = b1klok
     c                   eval      oppd(i) = b1oppd
     c                   eval      firm(i) = b1firm
     c                   movel     b1filg        filg(i)
04011c                   movel     b1skod        skod(i)
      *                                                        .        .
     c                   move      srrn01        svrn01
     c                   eval      b1valg = *blank
     c                   update    b1sfl
      *                                                        .        .
     c                   iter
     c                   endif
      *
      * Tester på om linjenr. er valgt for sletting:                    .
      *                                                                 .
     c                   if        b1valg = '4'
      *                                                          .      .
     c                   if        wpin09 <> 'JA'
      *                                                        . .      .
      * Sender opp "angrebilde":                               . .      .
      *                                                        . .      .
08060c                   eval      w_arow = 4
08060c                   eval      w_acol = 39
08060c                   exfmt     c1win
      *                                                        . .      .
08060c                   if        *inkc <> *on
08060c                   exsr      xslett
08060c                   eval      b1valg = *blank
08060c                   update    b1sfl
08060c                   exsr      xinke
      *                                                      . . .      .
08060c                   if        sfrn01 <> *zero
08060c                   goto      b2tagb
08060c                   else
08060c                   goto      b2taga
08060c                   endif
      *                                                      . . .      .
08060c                   endif
      *                                                        . .      .
     c                   move      *on           *in45
     c                   eval      b1valg = *blank
     c                   update    b1sfl
      *                                                        . .      .
     c                   iter
      *                                                        . .      .
     c                   else
      *                                                        . .      .
      * Må lagre innhold av WPGIRO og EPLØPN for å opprettholde. .      .
      * posisjonering i Subfile-1:                             . .      .
      *                                                        . .      .
     c                   eval      xxlØpn = wplØpn
     c                   eval      xxgiro = wpgiro
      *                                                        . .      .
      * Bygger nøkkel:                                         . .      .
      *                                                        . .      .
     c                   eval      wplØpn = b1lØpn
     c                   if        b1bgir <> 0
     c                   eval      wpgiro = b1bgir
     c                   else
     c                   eval      wpgiro = b1pgir
     c                   endif
      *                                                        . .      .
     c                   eval      wpin12 = 0
     c     key01         chain     gatrlu                             60
      *                                                        . .      .
      * Sletter post v/bekreftelse:                            . .      .
      *                                                        . .      .
     c                   if        *in60 = *off
      *                                                      . . .      .
     c                   eval      w_arow = 4
     c                   eval      w_acol = 39
      * Legger over data i felter:                           . . .      .
     c                   movel     l_filg        d1filg
     c                   eval      d1firm = l_firm
     c                   eval      d1lØpn = gblØpn
     c                   movel     gbtype        d1type
      * Bekrefte sletting:                                   . . .      .
     c                   exfmt     d1win
      *                                                      . . .      .
      * Sletter post:                                        . . .      .
      *                                                      . . .      .
     c                   if        *inkc <> *on
     c                   delete    gatrpfu
     c                   movel     'Slettet'     b1kode
     c                   endif
      *                                                      . . .      .
     c                   endif
      *                                                        . .      .
      * Legger tilbake innhold av løpenummer til subfile-1,    . .      .
      * for å komme tilbake til riktig posisjon som det ble    . .      .
      * gått ut i fra:                                         . .      .
      *                                                        . .      .
     c                   eval      wpgiro = xxgiro
     c                   eval      wplØpn = xxlØpn
     c                   eval      b1valg = *blank
     c                   update    b1sfl
      *                                                        . .      .
     c                   iter
      *                                                        . .      .
     c                   endif
     c                   endif
      *                                                                 .
      * Vise post (går over i subfile-2):                               .
      *                                                                 .
     c                   if        b1valg = '5'
      *                                                        .        .
      * Må lagre innhold av WPGIRO og WPLØPN for å opprettholde.        .
      * posisjonering av Subfile-1:                            .        .
      *                                                        .        .
     c                   eval      xxgiro = wpgiro
     c                   eval      xxlØpn = wplØpn
      *                                                        .        .
      * Må lagre innhold av WPLØPN, slik at posisjonering i    .        .
      * subfile 1 opprettholdes:                               .        .
      *                                                        .        .
     c                   eval      wpin12 = 0
      *                                                        .        .
      * Bygger nøkkel:                                         .        .
      *                                                        .        .
     c                   eval      wplØpn = b1lØpn
     c                   if        b1bgir <> 0
     c                   eval      wpgiro = b1bgir
     c                   else
     c                   eval      wpgiro = b1pgir
     c                   endif
      *                                                        .        .
     c                   eval      c2lØpn = b1lØpn
     c                   eval      c2dato = b1dato
     c                   eval      c2klok = b1klok
     c     key01         setll     gatrl1
      * Fyll opp subfile:                                      .        .
     c                   exsr      xclr02
     c                   exsr      xcrt02
     c                   exsr      xc5bld
      *                                                        .        .
      * Legger tilbake innhold av Giro og Løpenummer for       .        .
      * Subfile-1, for å komme "tilbake" til riktig posisjon:  .        .
      *                                                        .        .
     c                   eval      wpgiro = xxgiro
     c                   eval      wplØpn = xxlØpn
      *                                                        .        .
     c                   iter
     c                   endif
      *                                                                 .
     c                   enddo
      *
      * Sender opp vindu for å vise de poster som er valgt
      * til oppdatering.  Feltet "WPREGN" vil senere bli
      * "flagget" til "JA" dersom det er poster som skal
      * videre til regnskapsoppdatering.  Det samme gjelder
      * *IN44, som vil bli satt PÅ dersom regnskapsperiode
      * skal utfylles:
      *
     c                   if        wpoppd = 'JA'
      *                                                      .
     c                   move      *off          *in44
     c                   eval      wpregn = *blanks
     c                   exsr      xsbf3
      * Forny:                                               .
      *                                                      .
      * Henter gironummer ut i fra filgruppe/firmanummer:    .
      *                                                      .
     c     key03         setll     gavtl2
     c     key03         reade     gavtl2                                 60
      *                                                      .
     c                   eval      wpgiro = 0
      *                                                      .
     c                   if        gcbgir <> 0
     c                   eval      wpgiro = gcbgir
     c                   else
     c                   eval      wpgiro = gcpgir
     c                   endif
      *                                                      .
      * Bruker SONEKONTONUMMER (GCSKTO) i fra faste data,    .
      * i steden for BANKKONTONUMMER (GCBGIR).               .
      *                                                      .
19011c                   eval      wpgiro = gcskto
      *                                                      .
     c                   exsr      xinke
      *                                                      .
     c                   endif
      *
     c                   goto      b2taga
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Avslutt program                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xslutt        tag
      *
      * Sletter poster fra historikkregisteret dersom eldre enn
      * 1 mnd:
      *
03080c***                call      'GL229R'
      *
     c                   eval      *inlr = *on
     c                   return
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * C2BLD Behandle bilde for å vise batch:                          *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xc5bld        begsr
      *
     c     c2taga        tag
      *
     c                   write     c2cmd
      *
      * Bare data
      *
     c     c2tagb        tag
      *
     c                   exsr      xdsp02
      *
      * F3 =Avslutt program i fra subfile program.
      *
     c     *inkc         cabeq     *on           xutc2b
      *
      * Roll
      *
     c                   if        *in20 = *on
     c                   exsr      xcrt02
     c                   goto      c2tagb
     c                   endif
      *
     c     xutc2b        tag
      *
     c                   if        b1valg = '5'
     c                   move      srrn01        svrn01
     c                   eval      b1valg = *blank
     c                   update    b1sfl
     c                   endif
      *
     c                   eval      b2valg = *blank
     c                   eval      b2lØpn = 0
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * C3BLD Behandle bilde for å oppdatere batcher:                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xc1bld        begsr
      *
      * Legger inn dagens periode som forslag til regnskapsperiode:
      *
     c                   eval      d2peri = uyear
     c                   movel     umonth        d2peri
      *
      * Legger inn verdi "K" for Kontrolliste:
      *
     c                   movel     'K'           d2joko
      *
      * Send Alt
      *
     c     d2taga        tag
      *
      * Posisjonerer vindu:
      *
     c                   eval      w_arow = 4
     c                   eval      w_acol = 29
      *
     c                   write     d2cmd
      *
      * Bare data
      *
     c     d2tagb        tag
      *
     c                   exsr      xdsp03
      * F3=Avslutt vindu:
     c     *inkc         cabeq     *on           xutc1
      *
      * Dersom det er valgt ut poster som også skal videre til
      * regnskapsoppdatering, så må det testes på at perioden
      * er riktig:
      *
     c                   eval      wpperi = *blanks
     c                   eval      dsperi = 0
      *
     c                   if        wpregn = 'JA'
      *                                                          .
      * Tester periode:                                          .
      *                                                          .
      * Legger periode over i fra MM.ÅÅ til MM.ÅÅÅÅ:             .
      *                                                          .
     c                   movel     d2peri        dspemÅ
     c                   move      d2peri        dspeÅr
     c                   movel     '00'          dspeÅr
      *                                                          .
     c                   move      d2peri        dspeÅr
     c                   movel     '20'          dspeÅr
      *                                                          .
      * Null i mnd eller år:                                     .
      *                                                          .
     c                   if        dspemÅ = 0
     c                             or dspeÅr = 0
     c                   move      *on           *in43
     c                   endif
      * Ugyldig måned:                                           .
     c                   if        dspemÅ > 13
     c                   move      *on           *in43
     c                   endif
      * Tester årstall:                                          .
     c                   move      uyear         wppeÅr
     c                   if        uyear > 80
     c                   movel     '19'          wppeÅr
     c                   else
     c                   movel     '20'          wppeÅr
     c                   endif
      * Kan ikke være > inneværende år:                          .
     c                   move      umonth        wppemÅ
     c                   if        dspeÅr >= wppeÅr
     c                             and dspemÅ > wppemÅ
     c                   move      *on           *in43
     c                   endif
      * Kan ikke være < foregående år:                           .
     c                   eval      wppeÅr = wppeÅr - 1
     c                   if        dspeÅr < wppeÅr
     c                   move      *on           *in43
     c                   endif
      *                                                          .
     c     *in43         cabeq     *on           d2taga
      *                                                          .
     c                   endif
      *
      * F6=Oppdatere:
      *
     c                   if        *inkf = *on
8.01  * Sjekker om det er kun er SEPA formater som skal behandles.
8.01 c                   eval      b_sepa = *off
8.01 c                   eval      b_betf = *off
8.01 c                   eval      i = 1
8.01 c                   dow       i < 999
8.01  *
8.02 c                   if        type(i) <> *blanks
8.01  *
8.01 c                   if        type(i) = 'SP1' or
8.01 c                             type(i) = 'SP2'
8.01 c                   eval      b_sepa = *on
8.01 c                   endif
8.01  *
8.01 c                   if        type(i) = 'TF1' or
8.02 c                             type(i) = 'TF2' or
8.02 c                             type(i) = 'OCR'
8.01 c                   eval      b_betf = *on
8.01 c                   endif
8.01  *                                                              .
8.01 c                   endif
8.01  *                                                              .
8.01 c                   eval      i = i +1
8.01 c                   enddo
      *
8.01  * Hvis ikke "gammelt" format, skal ikke dette kjøres.
8.04 c**                 if        b_betf = *on
      *
27037 *  Kontrol på om det finnes poster til regnskap. Dersom
      *  dette er tilfelle, må de først oppdateres, ev slettes.
      *
27037c     c000          tag
27037c                   movel     *blank        wpvalg
27037c                   call      'GL126C'
27037c                   parm                    wpvalg
      *
      *  Dersom WPVALG er "1", så indikerer dette at det finnes
      *  poster til regnskap, dvs et MEMBER i filen RTRAPF:
      *
27037c                   if        wpvalg= '1'
      *
27037c                   eval      w_arow = 4
27037c                   eval      w_acol = 20
27037c                   exfmt     k1win
      *                                                                 .
      * Sletter MEMBER. Tar deretter den samme testen, for              .
      * kontrollerer om memberet virkelig er slettet!                   .
      *                                                                 .
27037c                   if        *inkd = *on
27037c                   call      'GL127C'
27037c                   goto      c000
27037c                   endif
      *                                                                 .
      * Dersom det IKKE er valgt å slette Member, så skal               .
      * videre oppdatering avsluttes, og hovedbildet blir               .
      * sendt opp på nytt:                                              .
      *                                                                 .
27037c                   if        *inkd <> *on
27037c                   goto      xutc1
27037c                   endif
      *                                                                 .
27037c                   endif
6.11  *
6.11  * Sjekker om jobb allerede er i gang, dersom den er det
6.11  * hoppes det ut av jobben med varsel i eget skjermbilde
6.11  *
6.11 c                   eval      w_mber = *blanks
6.11 c                   move      l_firm        w_fira
6.11 c                   eval      w_mber = 'TELE' + w_fira
6.11 c                   call      'RJ001R'
6.11 c                   parm                    w_mber
6.11 c                   parm                    w_info
6.11  *                                                                 .
6.11 c                   if        w_info = '2'
6.11 c                   exfmt     m1win
6.11 c                   goto      xutc1
6.11 c                   endif
      *
      *  Tømmer GTRTPF før kontroll-/journalkjøring:
      *
02080c                   call      'GL208R'
      *                                                        .
8.04 c**                 endif
      *                                                        .
     c                   eval      i = 0
     c                   exsr      xoppd
      *                                                        .
8.01  * Hvis ikke "gammelt" format, skal ikke dette kjøres.
      *                                                        .
8.04 c**                 if        b_betf = *on
      *                                                        .
      * Posisjonerer vindu:                                    .
      *                                                        .
     c                   eval      w_arow = 4
     c                   eval      w_acol = 39
      *                                                        .
      * Oppdatering av registre v/TELEGIRO-retur:              .
      *                                                        .
     c                   if        wptele = 'JA'
      *                                                      . .
      * Sender infor melding for Telegiro:                   . .
      *                                                      . .
     c                   eval      w_arow = w_arow + 2
     c                   eval      w_acol = w_acol - 4
     c                   write     a1win
      *                                                      . .
      * Skriver mottakskvittering/splitter data:             . .
      *                                                      . .
8.05  * Skal ikke kjøre GL110C på SEPA - SP2 returer         . .
8.05 c                   if        type(i) <> 'SP2'
     c                   call      'GL110C'
8.05 c                   endif
      *                                                      . .
      * Skriver kvitteringslister pr. retur:                 . .
      *                                                      . .
     c                   movel     dsperi        wpperi
     c                   call      'GL115C'
     c                   parm                    wpregn
06108c                   parm                    wpmber
      *                                                      . .
     c                   endif
      *                                                        .
      * Oppdatering av registre v/OCR-retur:                   .
      *                                                        .
     c                   if        wpocr = 'JA'
6.10 c                   eval      wpmber = *blanks
      *                                                      . .
      * Tester på om membernavn er OK:                       . .
      *                                                      . .
30044c                   movel     wpmber        wpnumm
30044c                   if        wpnumm = '0'
30044c                             or wpnumm = '1'
30044c                             or wpnumm = '2'
30044c                             or wpnumm = '3'
30044c                             or wpnumm = '4'
30044c                             or wpnumm = '5'
30044c                             or wpnumm = '6'
30044c                             or wpnumm = '7'
30044c                             or wpnumm = '8'
30044c                             or wpnumm = '9'
30044c                   movel     *blanks       wpmber
30044c                   endif
      *                                                      . .
      * Oppdatere OCR-returer:                               . .
      *                                                      . .
      * Verdien " " i l_chgv forteller at formularparametre  . .
      * kun skal hentes opp, men ikke vedlikeholdes.         . .
      *                                                      . .
     c                   eval      l_prtf = *blanks
     c                   movel     'RF102C'      l_prtf
     c                   movel     ' '           l_chgv
     c                   out       *dtaara
      *                                                      . .
7.fb c                   eval      w_joko = d2joko
     c                   call      'RF120C'
     c                   parm                    wpmber
7.fb c                   parm                    w_joko
      *                                                      . .
     c                   endif
      *                                                        .
      * Oppdatering av registre v/INKASSO-retur:               .
      *                                                        .
11108c                   if        wpink = 'JA'
      *                                                      . .
      * Oppdatere INKASSO-returer:                           . .
      *                                                      . .
      * Verdien " " i l_chgv forteller at formularparametre  . .
      * kun skal hentes opp, men ikke vedlikeholdes.         . .
      *                                                      . .
11108c                   eval      l_prtf = *blanks
11108c                   movel     'RCNRPF'      l_prtf
11108c                   movel     ' '           l_chgv
11108c                   out       *dtaara
      *                                                      . .
11108c                   call      'RC120C'
12100c                   parm                    wpmber
      *                                                      . .
11108c                   endif
      *                                                        .
      * Oppdaterer regnskap dersom det er valgt poster for     .
      * oppdatering, d.v.s. 2.gangsretur eller OCR-retur:      .
      * (I såfall WPREGN = JA)                                 .
      *                                                        .
     c                   if        wpregn = 'JA'
      *                                                      . .
     c                   if        srrn01 <> 0
     c                   move      *on           *in12
     c                   endif
      *                                                      . .
     c                   move      *on           *in13
     c                   write     b2ctl
     c                   move      *off          *in12
     c                   move      *off          *in13
      *                                                      . .
      * Verdien " " i l_chgv forteller at formularparametre  . .
      * kun skal hentes opp, men ikke vedlikeholdes.         . .
      *                                                      . .
     c                   eval      l_prtf = *blanks
     c                   movel     'RF1JOURN'    l_prtf
     c                   movel     ' '           l_chgv
     c                   out       *dtaara
      *                                                      . .
      * Kontrolliste:                                        . .
      *                                                      . .
27044c                   movel     wpmber        wpmb10
6.10 C                   if        wptele = 'JA'
6.10 c                   movel     'TELE'        wxmber
6.10 c                   move      l_firm        wxmber
6.10 c                   movel     wxmber        wpmb10
6.10 C                   ENDIF
     C*
      *                                                      . .
     c                   if        d2joko = 'J'
     c                   call      'RF1VALJO'
27044c                   parm                    wpmb10
     c                   else
     c                   call      'RF1VALKO'
27044c                   parm                    wpmb10
     c                   endif
      *                                                    o . .
      * Tester på om kjøringen er kontrolliste.  I såfall  o . .
      * må membernavn endres til TELExxx (hvor xxx=firma)  o . .
      * dersom member ikke finnes fra før:                 o . .
      *                                                    o . .
06108c                   call      'GL888C'
06108c                   parm                    wpmber
      *                                                    o . .
      *                                                      . .
     c                   endif
      *                                                        .
     c                   exsr      xinke
     c                   goto      xutc1
     c                   endif
      *
      * Roll
      *
     c                   if        *in30 = *on
     c                   exsr      xcrt03
     c                   goto      d2tagb
     c                   endif
      *
     c                   goto      d2taga
      *
     c     xutc1         tag
6.11  *
6.11  * Prøver å fjerne jobbmerking ved avslutning, gjelder
6.11  * dersom feilliste eller 1.gangsretur er kjørt.
6.11  *
6.11 c                   eval      w_info = 'S'
6.11 c                   call      'RJ001R'
6.11 c                   parm                    w_mber
6.11 c                   parm                    w_info
      *
8.04 c**                 endif
      *
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Tøm subfile - 1                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xclr01        begsr
     c                   move      *on           *in14
     c                   write     b2ctl
     c                   move      *off          *in14
      *
     c                   move      *off          *in15
     c                   eval      srrn01 = 0
     c                   eval      sfrn01 = 0
     c                   eval      ssrn01 = 0
     c                   eval      spge01 = 0
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Fyll opp subfile - 1                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xcrt01        begsr
     c                   eval      spge01 = spge01 + 12
     c                   eval      srrn01 = ssrn01
      *
     c                   dou       srrn01 = spge01
      *                                                                 .
     c     xnyles        tag
      *                                                                 .
      * Leser på giro-/løpenummer:                                      .
      *                                                                 .
     c                   eval      wplØpn = wplØpn + 1
     c     key01         setll     gatrl1
     c     key01         reade     gatrl1                                 15
      *                                                                 .
      * *IN15 indikerer at det ikke finnes flere poster pr.             .
      * GIRONUMMER/LØPENUMMER.  Det må likevel testes på om             .
      * det er huller i LØPENUMMER-serien på filen.  Ny les på          .
      * kun GIRONUMMER må derfor foretas:                               .
      *                                                                 .
     c                   if        *in15 = *on
     c     key01         setll     gatrl1
     c     wpgiro        reade     gatrl1                                 15
      *                                                          .      .
      * Dersom det ikke finnes flere poster for firmaet på       .      .
      * gjeldende kontonummer, så må det testes på om det        .      .
      * finnes poster for firmaet på et annet kontonummer:       .      .
      *                                                          .      .
23081c     *in15         cabeq     *on           xend01
      *                                                          .      .
     c                   if        *in15 = *on
      *                                                        . .      .
     c     key03         reade     gavtl2                                 60
     c     *in60         cabeq     *on           xend01
      * Initierer les av nye poster for nytt kontonummer:      . .      .
     c                   if        gcbgir <> 0
     c                   eval      wpgiro = gcbgir
     c                   else
     c                   eval      wpgiro = gcpgir
     c                   endif
      *                                                        . .
      * Bruker SONEKONTONUMMER (GCSKTO) i fra faste data,      . .
      * i steden for BANKKONTONUMMER (GCBGIR).                 . .
      *                                                        . .
19011c                   eval      wpgiro = gcskto
      *                                                        . .
     c                   exsr      xfØrst
     c                   goto      xnyles
     c                   endif
      *                                                          .      .
      * Det er huller i løpenummer serien...                     .      .
      *                                                          .      .
     c                   eval      wplØpn = gblØpn
     c     key01         setll     gatrl1
     c     key01         reade     gatrl1                                 15
     c     *in15         cabeq     *on           xend01
     c                   endif
      *                                                                 .
      * Dersom det er valgt F9 for kun å vise oppdaterte poster,        .
      * så skal kun returer som har "0" i teller vises:                 .
      *                                                                 .
     c                   if        wpin09 = 'JA'
     c                             and gbtell <> 0
     c                   goto      xnyles
     c                   endif
      *                                                                 .
      * Dersom det er valgt F9 for kun å vise poster som ikke er        .
      * oppdatert, så skal kun returer som ikke har teller lik          .
      * "0" vises:                                                      .
      *                                                                 .
     c                   if        wpin09 = *blanks
     c                             and gbtell = 0
     c                   goto      xnyles
     c                   endif
      * Snur dato:                                                      .
     c                   eval      wpdato = gbdato
     c                   eval      dsdatÅ = wpdatÅ
     c                   eval      dsdatm = wpdatm
     c                   eval      dsdatd = wpdatd
      * Display felter:                                                 .
     c                   eval      srrn01 = srrn01 + 1
04011c                   movel     gcskod        b1skod
      *                                                                 .
17011c                   movel     gbfgrp        b1filg
17011c                   eval      b1firm = gbfirm
      *                                                                 .
     c                   eval      b1dato = dsdato
     c                   eval      b1klok = gbklok
     c                   eval      b1oppd = gboppd
     c                   eval      b1lØpn = gblØpn
     c                   movel     gbtype        b1type
      *Skjulte-felter                                                   .
     c                   eval      b1bgir = gbgiro
     c                   eval      b1tell = gbtell
      *                                                                 .
      * GBTELL er null dersom batch allerede er oppdatert:              .
      *                                                                 .
     c                   eval      b1kode = *blank
      *                                                                 .
     c                   if        b1tell = 0
     c                   eval      b1kode = *blanks
     c                   movel     '*'           b1kode
     c                   endif
      *                                                                 .
     c                   write     b1sfl
     c                   enddo
      *
     c     xend01        tag
      *
     c                   if        srrn01 > ssrn01
     c                   eval      sfrn01 = ssrn01 + 1
     c                   endif
      *
     c                   eval      ssrn01 = srrn01
     c                   eval      svrn01 = sfrn01
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Display subfile - 1                                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xdsp01        begsr
      *
     c     xdstag        tag
      *
     c                   if        srrn01 <> 0
     c                   move      *on           *in12
     c                   endif
      *
     c                   move      *on           *in13
     c                   exfmt     b2ctl
      *
     c                   move      *off          *in12
     c                   move      *off          *in13
      *
      * Dersom det er brukt F9 i skjermbildet indikerer dette at
      * det ønskes å vises kun oppdaterte returer ELLER kun returer
      * som ikke er oppdatert (default):
      *
     c                   if        *inki = *on
      *                                                        .
     c                   if        wpin09 = *blanks
     c                   movel     'JA'          wpin09
     c                   movel     txt(1)        a1retu
     c                   movel     txt(3)        b2cmd9
     c                   movel     txt(5)        a1valg
     c                   else
     c                   eval      wpin09 = *blanks
     c                   eval      a1retu = *blanks
     c                   movel     txt(2)        b2cmd9
     c                   movel     txt(4)        a1valg
     c                   endif
      *                                                        .
      * Henter første kontonummer for filgruppe/firma:         .
      *                                                        .
     c     key03         setll     gavtl2
     c     key03         reade     gavtl2                                 60
      *                                                        .
     c                   if        gcbgir <> 0
     c                   eval      wpgiro = gcbgir
     c                   else
     c                   eval      wpgiro = gcpgir
     c                   endif
      *                                                        .
      * Bruker SONEKONTONUMMER (GCSKTO) i fra faste data,      .
      * i steden for BANKKONTONUMMER (GCBGIR).                 .
      *                                                        .
19011c                   eval      wpgiro = gcskto
      *                                                        .
      * Initierer hjelpefelt, tabell o.l. og sender deretter   .
      * opp subfile på nytt:                                   .
      *                                                        .
     c                   exsr      xinke
     c                   write     b2cmd
     c                   goto      xdstag
      *                                                        .
     c                   endif
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Tøm subfile - 2                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xclr02        begsr
     c                   move      *on           *in24
     c                   write     c2ctl
     c                   move      *off          *in24
      *
     c                   move      *off          *in25
     c                   eval      srrn02 = 0
     c                   eval      sfrn02 = 0
     c                   eval      ssrn02 = 0
     c                   eval      spge02 = 0
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Fyll opp subfile - 2                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xcrt02        begsr
     c                   eval      spge02 = spge02 + 15
     c                   eval      srrn02 = ssrn02
      *
     c                   dou       srrn02 = spge02
      * Leser på giro-/løpenummer:                                      .
     c     key01         reade     gatrl1                                 25
     c     *in25         cabeq     *on           xend02
      *
     c                   movel     gbreco        c2reco
     c                   eval      srrn02 = srrn02 + 1
      *                                                                 .
     c                   write     c1sfl
     c                   enddo
      *
     c     xend02        tag
      *
     c                   if        srrn02 > ssrn02
     c                   eval      sfrn02 = ssrn02 + 1
     c                   endif
      *
     c                   eval      ssrn02 = srrn02
     c                   eval      svrn02 = sfrn02
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Display subfile - 2                                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xdsp02        begsr
      *
     c                   if        srrn02 <> 0
     c                   move      *on           *in22
     c                   endif
      *
     c                   move      *on           *in23
     c                   exfmt     c2ctl
     c                   move      *off          *in22
     c                   move      *off          *in23
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Tøm subfile - 3                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xclr03        begsr
     c                   move      *on           *in34
     c                   write     d2wct
     c                   move      *off          *in34
      *
     c                   move      *off          *in35
     c                   eval      srrn03 = 0
     c                   eval      sfrn03 = 0
     c                   eval      ssrn03 = 0
     c                   eval      spge03 = 0
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Fyll opp subfile - 3                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xcrt03        begsr
     c                   eval      spge03 = spge03 + 6
     c                   eval      srrn03 = ssrn03
      *
     c                   dou       srrn03 = spge03
      * Leser tabell:                                                   .
     c                   eval      i = i + 1
      * Tom tabell eller max. teller:                                   .
     c                   if        giro(i) = 0
     c                             or i = 999
     c                   eval      i = i - 1
     c                   goto      xend03
     c                   endif
      *                                                                 .
     c                   eval      d1lØpn = lØpn(i)
     c                   movel     type(i)       d1type
     c                   eval      d1dato = dato(i)
     c                   eval      d1klok = klok(i)
     c                   eval      d1oppd = oppd(i)
     c                   eval      d1firm = firm(i)
     c                   movel     filg(i)       d1filg
      *                                                                 .
      * Tester på om det er valgt TF2 til oppdatering.  I såfall        .
      * må det varsel om dette:                                         .
      *                                                                 .
27024c                   if        type(i) = 'TF2'
27024c                   eval      wxgiro = giro(i)
27024c                   movel     filg(i)       wxfilg
27024c                   eval      wxtype = type(i)
27024c                   eval      wxfirm = firm(i)
27024c                   eval      wxlØpn = lØpn(i)
27024c                   eval      wxfeil = *blanks
      *                                                                 .
27024c                   call      'GL210R'
27024c                   parm                    wxgiro
27024c                   parm                    wxlØpn
27024c                   parm                    wxtype
27024c                   parm                    wxfirm
27024c                   parm                    wxbfnr
27024c                   parm                    wxbfli
08074c                   parm                    wxlevr
08074c                   parm                    wxleva
08074c                   parm                    wxbelp
27024c                   parm                    wxfeil
      *                                                                 .
      * Sender opp ADVARSEL om at TF2 allerede er bokført:              .
      *                                                                 .
27024c                   if        wxfeil <> *blanks
12105c                   movel     'K'           d2joko
27024c                   endif
      *                                                                 .
27024c                   endif
      *                                                                 .
      * Setter "Flagg" for å indikere at det finnes transaksjoner       .
      * som skal videre til regnskap, d.v.s. ved 2.gangsretur og        .
      * OCR-retur.  *IN44 åpner feltet for regnskapsperiode i           .
      * skjermbildet:                                                   .
      *                                                                 .
     c                   if        type(i) = 'TF2'
     c                             or type(i) = 'OCR'
     c                   move      'JA'          wpregn
     c                   endif
      *                                                                 .
     c                   eval      srrn03 = srrn03 + 1
      *Skjulte-felter                                                   .
     c                   eval      d1bgir = giro(i)
      *                                                                 .
     c                   write     d1wsf
     c                   enddo
      *
     c     xend03        tag
      *
     c                   if        srrn03 > ssrn03
     c                   eval      sfrn03 = ssrn03 + 1
     c                   endif
      *
     c                   eval      ssrn03 = srrn03
     c                   eval      svrn03 = sfrn03
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Display subfile - 3                                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xdsp03        begsr
      *
     c                   if        srrn03 <> 0
     c                   move      *on           *in32
     c                   endif
      *
     c                   move      *on           *in33
     c                   exfmt     d2wct
     c                   move      *off          *in32
     c                   move      *off          *in33
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Fyll opp file GTRTPF med Telegiro-returer, eller                *
      * file GORTPF med OCR-returer:                                    *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xoppd         begsr
      *
      * Initierer hjelpefelt som senere blir brukt til å teste
      * om det skal startes opp oppdateringer for Telegiro- og/
      * eller OCR-returer:
      *
     c                   eval      wptele = *blanks
     c                   eval      wpocr = *blanks
11108c                   eval      wpink = *blanks
      *
     c                   eval      i = i + 1
      * Leser tabell:
     c                   dow       i <> 0
      * Tom tabell eller max. teller:                                .
     c                   if        giro(i) = 0
     c                             or lØpn(i) = 0
     c                             or i = 999
     c                   eval      i = i - 1
     c                   goto      xendop
     c                   endif
      *                                                              .
     c                   eval      wpgiro = giro(i)
     c                   eval      wplØpn = lØpn(i)
     c                   movel     type(i)       wptype
      *                                                              .
      * Tar kopi av batcher som er valgt til oppdatering:            .
      *                                                              .
09060c                   exsr      xcopy
      *                                                              .
      * TELEGIRO                                                     .
      *                                                              .
      * Oppdaterer GTRTPF dersom mottatte poster er 1.gangs-,        .
      * 2. gangs- eller feilretur FAKTURA (TFx) eller LØNN (TLx):    .
      *                                                              .
     c                   if        type(i) = 'TFF'
     c                             or type(i) = 'TF1'
     c                             or type(i) = 'TF2'
     c                             or type(i) = 'TLF'
     c                             or type(i) = 'TL1'
8.01 c                             or type(i) = 'SP1'
8.01 c                             or type(i) = 'SP2'
      *                                                            . .
      * "FLAGG" settes for å indikerer retur fra Telegiro:         . .
      *                                                            . .
     c                   movel     'JA'          wptele
      *                                                            . .
     c     key01         setll     gatrlu
     c     key01         reade     gatrlu                                 60
      *                                                            . .
      * Leser 4 poster i fra GATRPF og legger de ut som en post    . .
      * på GTRTPF, samtidig som leste poster slettes i fra         . .
      * GATRPF:                                                    . .
      *                                                            . .
     c                   dow       *in60 = *off
8.01  * Ikke for Sepa
8.01 c                   if        gbtype <> 'SP1' and
8.01 c                             gbtype <> 'SP2'
      *                                                        .   . .
      * Det skal ved oppdatering av Telegiro retur             .   . .
      * ligge igjen en "null-post", som informasjon            .   . .
      * til bruker at forslag er oppdatert:                    .   . .
      *                                                        .   . .
      * 1 av 4:                                                .   . .
     c                   movel     gbreco        dsa
      *                                                        .   . .
05021 *****      GBTELL    IFEQ 1                          ... .   . .
05021 *****                Z-ADD0         GBTELL             . .   . .
05021 *****                UPDATGATRPFU                      . .   . .
05021 *****                ELSE                              . .   . .
05021c                   delete    gatrpfu
05021 *****                ENDIF                           ... .   . .
      * 2 av 4:                                                .   . .
     c     key01         reade     gatrlu                                 60
     c                   if        *in60 = *off
     c                   movel     gbreco        dsb
     c                   delete    gatrpfu
     c                   endif
      * 3 av 4:                                                .   . .
     c     key01         reade     gatrlu                                 60
     c                   if        *in60 = *off
     c                   movel     gbreco        dsc
     c                   delete    gatrpfu
     c                   endif
      * 4 av 4:                                                .   . .
     c     key01         reade     gatrlu                                 60
     c                   if        *in60 = *off
     c                   movel     gbreco        dsd
     c                   eval      gdqdat = gbdato
     c                   eval      gdqtim = gbklok
      *
     c                   exsr      xoverf
      *
     c                   movel     dstota        gdqbet
     c                   move      dstotb        gdqbet
     c                   write     gtrtpfr
      *
     c                   delete    gatrpfu
     c                   endif
8.01  * Dette er SEPA format, finn første betalingsinformasjon
8.01 c                   else
8.04  * 1 gangsretur
8.04 c                   if        gbtype = 'SP1'
8.01 c*                  select
8.01 c                   if        %scan(c_data_slutt:gbreco) > 1
8.01  * Oppdater betalingsforslag
8.01 c                   if        b_start = *on
8.01  *
8.01 c                   eval      gubflu_bfnr = %dec(%trim(w_bref):3:0)
8.01 c                   if        w_lin1 <> *blanks
8.01 c                   eval      gubflu_bfli = %dec(%trim(w_lin1):5:0)
8.01 c     gubflu_key    chain     gubflu
8.01 c                   if        %found
8.01 c                   if        %trim(w_kode) = 'ACCP' or
8.01 c                             %trim(w_kode2) = 'ACCP'
8.01 c                   eval      gareko = '1'
8.03 c                   eval      w_line = w_line + 1
8.01 c                   endif
8.01 c                   if        %trim(w_kode) = 'RJCT' or
8.01 c                             %trim(w_kode2) = 'RJCT'
8.01 c                   eval      gareko = 'F'
8.03 c                   eval      w_line = w_line + 1
8.01 c                   endif
8.01  *
8.01 c                   update    gubflur
8.07  * Oppdater også med 1 retur på lev.transen.
8.07 c                   if        gareko = '1'
8.07 c                   eval      rltrlu_levr = galevr
8.07 c                   eval      rltrlu_bdat = gabdat
8.07 c                   eval      rltrlu_tist = gatist
8.07 c     rltrlu_key    chain     rltrlu
8.07 c                   if        %found
8.07 c                   eval      robetk = '1'
8.07 c                   update    rltrlur
8.07 c                   endif
8.07 c                   endif
8.07  *
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   if        w_lin2 <> *blanks
8.01 c                   eval      gubflu_bfli = %dec(%trim(w_lin2):5:0)
8.01 c     gubflu_key    chain     gubflu
8.01 c                   if        %found
8.01 c                   if        %trim(w_kode) = 'ACCP' or
8.01 c                             %trim(w_kode2) = 'ACCP'
8.01 c                   eval      gareko = '1'
8.03 c                   eval      w_line = w_line + 1
8.01 c                   endif
8.01 c                   if        %trim(w_kode) = 'RJCT' or
8.01 c                             %trim(w_kode2) = 'RJCT'
8.01 c                   eval      gareko = 'F'
8.03 c                   eval      w_line = w_line + 1
8.01 c                   endif
8.01  *
8.01 c                   update    gubflur
8.07  * Oppdater også med 1 retur på lev.transen.
8.07 c                   if        gareko = '1'
8.07 c                   eval      rltrlu_levr = galevr
8.07 c                   eval      rltrlu_bdat = gabdat
8.07 c                   eval      rltrlu_tist = gatist
8.07 c     rltrlu_key    chain     rltrlu
8.07 c                   if        %found
8.07 c                   eval      robetk = '1'
8.07 c                   update    rltrlur
8.07 c                   endif
8.07 c                   endif
8.07  *
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   if        w_lin3 <> *blanks
8.01 c                   eval      gubflu_bfli = %dec(%trim(w_lin3):5:0)
8.01 c     gubflu_key    chain     gubflu
8.01 c                   if        %found
8.01 c                   if        %trim(w_kode) = 'ACCP' or
8.01 c                             %trim(w_kode2) = 'ACCP'
8.01 c                   eval      gareko = '1'
8.03 c                   eval      w_line = w_line + 1
8.01 c                   endif
8.01 c                   if        %trim(w_kode) = 'RJCT' or
8.01 c                             %trim(w_kode2) = 'RJCT'
8.01 c                   eval      gareko = 'F'
8.03 c                   eval      w_line = w_line + 1
8.01 c                   endif
8.01  *
8.01 c                   update    gubflur
8.07  * Oppdater også med 1 retur på lev.transen.
8.07 c                   if        gareko = '1'
8.07 c                   eval      rltrlu_levr = galevr
8.07 c                   eval      rltrlu_bdat = gabdat
8.07 c                   eval      rltrlu_tist = gatist
8.07 c     rltrlu_key    chain     rltrlu
8.07 c                   if        %found
8.07 c                   eval      robetk = '1'
8.07 c                   update    rltrlur
8.07 c                   endif
8.07 c                   endif
8.01  *
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   if        w_lin4 <> *blanks
8.01 c                   eval      gubflu_bfli = %dec(%trim(w_lin4):5:0)
8.01 c     gubflu_key    chain     gubflu
8.01 c                   if        %found
8.01 c                   if        %trim(w_kode) = 'ACCP' or
8.01 c                             %trim(w_kode2) = 'ACCP'
8.01 c                   eval      gareko = '1'
8.03 c                   eval      w_line = w_line + 1
8.01 c                   endif
8.01 c                   if        %trim(w_kode) = 'RJCT' or
8.01 c                             %trim(w_kode2) = 'RJCT'
8.01 c                   eval      gareko = 'F'
8.03 c                   eval      w_line = w_line + 1
8.01 c                   endif
8.01  *
8.01 c                   update    gubflur
8.07  * Oppdater også med 1 retur på lev.transen.
8.07 c                   if        gareko = '1'
8.07 c                   eval      rltrlu_levr = galevr
8.07 c                   eval      rltrlu_bdat = gabdat
8.07 c                   eval      rltrlu_tist = gatist
8.07 c     rltrlu_key    chain     rltrlu
8.07 c                   if        %found
8.07 c                   eval      robetk = '1'
8.07 c                   update    rltrlur
8.07 c                   endif
8.07 c                   endif
8.01  *
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   if        w_lin5 <> *blanks
8.01 c                   eval      gubflu_bfli = %dec(%trim(w_lin5):5:0)
8.01 c     gubflu_key    chain     gubflu
8.01 c                   if        %found
8.01 c                   if        %trim(w_kode) = 'ACCP' or
8.01 c                             %trim(w_kode2) = 'ACCP'
8.01 c                   eval      gareko = '1'
8.03 c                   eval      w_line = w_line + 1
8.01 c                   endif
8.01  *
8.01 c                   update    gubflur
8.07  * Oppdater også med 1 retur på lev.transen.
8.07 c                   if        gareko = '1'
8.07 c                   eval      rltrlu_levr = galevr
8.07 c                   eval      rltrlu_bdat = gabdat
8.07 c                   eval      rltrlu_tist = gatist
8.07 c     rltrlu_key    chain     rltrlu
8.07 c                   if        %found
8.07 c                   eval      robetk = '1'
8.07 c                   update    rltrlur
8.07 c                   endif
8.07 c                   endif
8.01  *
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   eval      w_kode2 = *blanks
8.01 c                   eval      w_kode = *blanks
8.01 c                   eval      w_ref = *blanks
8.01 c                   eval      w_lin1 = *blanks
8.01 c                   eval      w_lin2 = *blanks
8.01 c                   eval      w_lin3 = *blanks
8.01 c                   eval      w_lin4 = *blanks
8.01 c                   eval      w_lin5 = *blanks
8.01 c                   eval      b_start = *off
8.01  *
8.01 c                   endif
8.01  *
8.01 c                   elseif    %scan(c_data_start:gbreco) > 1
8.01 c                   eval      b_start = *on
8.03  *
8.03 c                   elseif    %scan(c_accp_kode:gbreco) > 1
8.03 c                   if        b_actc = *off
8.03 c                   eval      w_posi = %scan(c_accp_kode:gbreco)
8.03 c                   if        w_posi > 0
8.03 c                   eval      w_kode = %subst(gbreco:w_posi+7)
8.03 c                   eval      w_posi = %scan(c_accp_kode:w_kode)
8.03 c                   if        w_posi > 0
8.03 c                   eval      w_accp = %trim(%subst(w_kode:1:w_posi-3))
8.03 c                   if        %trim(w_accp) = 'ACTC'
8.03 c                   eval      b_actc = *on
8.03 c                   endif
8.03 c                   endif
8.03 c                   endif
8.03 c                   endif
8.01  *
8.01 c                   elseif    %scan(c_ref:gbreco) > 1
8.01 c                   eval      w_posi = %scan(c_ref:gbreco)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_ref = %subst(gbreco:w_posi+14)
8.01 c                   eval      w_posi = %scan(c_ref:w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_ref = %trim(%subst(w_ref:1:w_posi-3))
8.01  *
8.01  * Utled alle linjenummer: 0961/00010/00020/........
8.01  *
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_bref = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_lin1 = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   else
8.01 c                   eval      w_lin1 = w_ref
8.01 c                   eval      w_ref = *blanks
8.01 c                   endif
8.01  *
8.01 c                   if        %trim(w_ref) <> *blanks
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_lin2 = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   else
8.01 c                   eval      w_lin2 = w_ref
8.01 c                   eval      w_ref = *blanks
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   if        %trim(w_ref) <> *blanks
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_lin3 = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   else
8.01 c                   eval      w_lin3 = w_ref
8.01 c                   eval      w_ref = *blanks
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   if        %trim(w_ref) <> *blanks
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_lin4 = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   else
8.01 c                   eval      w_lin4 = w_ref
8.01 c                   eval      w_ref = *blanks
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   if        %trim(w_ref) <> *blanks
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_lin5 = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   else
8.01 c                   eval      w_lin5 = w_ref
8.01 c                   eval      w_ref = *blanks
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   endif
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   elseif    %scan(c_ref_kode:gbreco) > 1
8.01 c                   eval      w_posi = %scan(c_ref_kode:gbreco)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_kode = %subst(gbreco:w_posi+10)
8.01 c                   eval      w_posi = %scan(c_ref_kode:w_kode)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_kode = %trim(%subst(w_kode:1:w_posi-3))
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   elseif    %scan(c_Ref_kode2:gbreco) > 1
8.01 c                   eval      w_posi = %scan(c_Ref_kode2:gbreco)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_kode2 = %subst(gbreco:w_posi+6)
8.01 c                   eval      w_posi = %scan(c_ref_kode2:w_kode2)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_kode2 = %trim(%subst(w_kode2:1:w_posi-3))
8.01 c                   endif
8.01 c                   endif
     c                   endif
8.04 c                   else
8.04  *
8.04  * 2 gangsretur - skriv til GUR2PF - skjer normalt i GL112C/R
8.04  *
8.04 c                   if        %scan(c_sp2_entry:gbreco) > 1
8.04  *
8.04  * Da har vi slutten på betalingen, legg ut post
8.04  *
8.04 c                   if        b_sp2p = *on
8.04  *
8.04  * Hent inn informasjon fra betalingsforslag og skriv til GUR2
8.04  *
8.04 c                   eval      gubfl8_bfnr = %dec(%trim(w_bref):3:0)
8.04 c                   if        w_lin1 <> *blanks
8.04 c                   eval      gubfl8_bfli = %dec(%trim(w_lin1):5:0)
8.04 c                   exsr      skriv_gur2
8.04 c                   endif
8.04  *
8.04 c                   if        w_lin2 <> *blanks
8.04 c                   eval      gubfl8_bfli = %dec(%trim(w_lin2):5:0)
8.04 c                   exsr      skriv_gur2
8.04 c                   endif
8.04  *
8.04 c                   if        w_lin3 <> *blanks
8.04 c                   eval      gubfl8_bfli = %dec(%trim(w_lin3):5:0)
8.04 c                   exsr      skriv_gur2
8.04 c                   endif
8.04  *
8.04 c                   if        w_lin4 <> *blanks
8.04 c                   eval      gubfl8_bfli = %dec(%trim(w_lin4):5:0)
8.04 c                   exsr      skriv_gur2
8.04 c                   endif
8.04  *
8.04 c                   if        w_lin5 <> *blanks
8.04 c                   eval      gubfl8_bfli = %dec(%trim(w_lin5):5:0)
8.04 c                   exsr      skriv_gur2
8.04 c                   endif
8.04  *
8.04  * Null ut alle variabler
8.04  *
8.04 c                   eval      b_sp2p = *off
8.04 c                   eval      b_sp2d = *off
8.04 c                   eval      w_kode = *blanks
8.04 c                   eval      w_fdat = *blanks
8.04 c                   eval      w_ref = *blanks
8.04 c                   eval      w_bref = *blanks
8.04 c                   eval      w_lin1 = *blanks
8.04 c                   eval      w_lin2 = *blanks
8.04 c                   eval      w_lin3 = *blanks
8.04 c                   eval      w_lin4 = *blanks
8.04 c                   eval      w_lin5 = *blanks
8.04  *
8.04 c                   endif
8.04  *
8.04 c                   elseif    %scan(c_sp2_sntry:gbreco) > 1
8.04  * Vi er i starten på en betaling
8.04 c                   eval      b_sp2p = *on
8.04 c                   elseif    %scan(c_sp2_sBdto:gbreco) > 1
8.04  * Forfallsdato
8.04 c                   eval      b_sp2d = *on
8.04 c                   elseif    %scan(c_sp2_sDt:gbreco) > 1
8.04  * Hent ut forfallsdato
8.04 c                   if        b_sp2d = *on and
8.04 c                             w_fdat = *blanks
8.04 c                   eval      w_posi = %scan(c_sp2_sDt:gbreco)
8.04 c                   if        w_posi > 0
8.04 c                   eval      w_kode = %subst(gbreco:w_posi+3)
8.04 c                   eval      w_posi = %scan(c_sp2_edt:w_kode)
8.04 c                   if        w_posi > 0
8.04 c                   eval      w_fdat = %trim(%subst(w_kode:1:w_posi-2))
8.04 c                   eval      d_dato = w_fdat
8.04 c                   eval      x_aar = d_aar
8.04 c                   eval      x_mnd = d_mnd
8.04 c                   eval      x_dag = d_dag
8.04 c                   endif
8.04 c                   endif
8.04 c                   endif
8.04  * Hent ut linjer som skal oppdateres.
8.01 c                   elseif    %scan(c_sp2_sPmtId:gbreco) > 1
8.01 c                   eval      w_posi = %scan(c_sp2_sPmtId:gbreco)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_ref = %subst(gbreco:w_posi+9)
8.01 c                   eval      w_posi = %scan(c_sp2_sPmtId:w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_ref = %trim(%subst(w_ref:1:w_posi-3))
8.01  *
8.01  * Utled alle linjenummer: 0961/00010/00020/........
8.01  *
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_bref = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_lin1 = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   else
8.01 c                   eval      w_lin1 = w_ref
8.01 c                   eval      w_ref = *blanks
8.01 c                   endif
8.01  *
8.01 c                   if        %trim(w_ref) <> *blanks
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_lin2 = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   else
8.01 c                   eval      w_lin2 = w_ref
8.01 c                   eval      w_ref = *blanks
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   if        %trim(w_ref) <> *blanks
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_lin3 = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   else
8.01 c                   eval      w_lin3 = w_ref
8.01 c                   eval      w_ref = *blanks
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   if        %trim(w_ref) <> *blanks
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_lin4 = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   else
8.01 c                   eval      w_lin4 = w_ref
8.01 c                   eval      w_ref = *blanks
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   if        %trim(w_ref) <> *blanks
8.01 c                   eval      w_posi = %scan('/':w_ref)
8.01 c                   if        w_posi > 0
8.01 c                   eval      w_lin5 = %trim(%subst(w_ref:1:w_posi-1))
8.01 c                   eval      w_ref = %trim(%subst(w_ref:w_posi+1))
8.01 c                   else
8.01 c                   eval      w_lin5 = w_ref
8.01 c                   eval      w_ref = *blanks
8.01 c                   endif
8.01 c                   endif
8.01  *
8.01 c                   endif
8.01 c                   endif
8.01 c                   endif
8.04 c                   endif
8.04 c                   endif
8.01 c*                  endsl
      *
9.xx c                   delete    gatrpfu
      *
8.01 c                   endif
      *
     c     key01         reade     gatrlu                                 60
     c                   enddo
      *
     c                   endif
      *
      * OCR FRA POST ELLER BANK.                                     .
      *                                                              .
      * Oppdaterer GORTPF dersom mottatte poster er OCR-retur:       .
      *                                                              .
     c                   if        type(i) = 'OCR'
      *                                                            . .
      * "FLAGG" settes for å indikerer retur fra OCR:              . .
      *                                                            . .
     c                   movel     'JA'          wpocr
      *                                                            . .
     c     key01         setll     gatrlu
     c     key01         reade     gatrlu                                 61
      *                                                            . .
      * Leser post i fra GATRPF, og legger den ut på GORTPF.       . .
      * Samtidig slettes post i fra GATRPF:                        . .
      *                                                            . .
     c                   dow       *in61 = *off
      *                                                        .   . .
     c                   movel     gbreco        gdqoco
     c                   eval      gdqofi = l_firm
     c                   write     gortpfr
      *                                                        .   . .
      * Det skal ved oppdatering av OCR-returer alltid         .   . .
      * ligge igjen en "null-post".  Den vil senere bli        .   . .
      * brukt i forbindelse med kontroll på at det ikke        .   . .
      * kjøres dobbel oppdatering:                             .   . .
      *                                                        .   . .
05021 ****       GBTELL    IFEQ 1                          ... .   . .
05021 ****                 Z-ADD0         GBTELL             . .   . .
05021 ****                 UPDATGATRPFU                      . .   . .
05021 ****                 ELSE                              . .   . .
     c                   delete    gatrpfu
05021 ****                 ENDIF                           ... .   . .
      *                                                        .   . .
     c     key01         reade     gatrlu                                 61
     c                   enddo
      *                                                            . .
     c                   endif
      *                                                              .
      * Oppdaterer RCNRPF dersom mottatte poster er INKASSO-         .
      * poster:                                                      .
      *                                                              .
11108c                   if        type(i) = 'CN1'
11108c                             or type(i) = 'CN2'
11108c                             or type(i) = 'CN3'
      *                                                            . .
      * "FLAGG" settes for å indikerer INKASSO-retur:              . .
      *                                                            . .
11108c                   movel     'JA'          wpink
      *                                                            . .
11108c     key01         setll     gatrlu
11108c     key01         reade     gatrlu                                 62
      *                                                            . .
      * Leser post i fra GATRPF, og legger den ut på RCNRPF.       . .
      * Samtidig slettes post i fra GATRPF:                        . .
      *                                                            . .
11108c                   dow       *in62 = *off
      *                                                        .   . .
7.nx c**                 movel     gbreco        rcns80
7.nx c                   movel     gbreco        rcn130
11108c                   write     rcnrpfr
      *                                                        .   . .
05021c                   delete    gatrpfu
      *                                                        .   . .
11108c     key01         reade     gatrlu                                 62
11108c                   enddo
      *                                                            . .
11108c                   endif
      *                                                              .
     c                   eval      i = i + 1
8.03  *
8.03  * Varsel om at lest "retur" er godkjent teknisk men ikke akseptert.
8.03  *
8.03 c                   if        b_actc = *on
8.03 c                   eval      w_mld1 = 'Innlesning av mottaksretur +
8.03 c                                     = OK'
8.03 c                   eval      w_mld2 = 'Teknisk validering av fil +
8.03 c                                     = OK'
8.03 c                   eval      w_mld3 = 'Antall opdaterte linjer +
8.03 c                                     = ' + %char(w_line)
8.03 c                   call      'AA031R'
8.03 c                   parm                    w_mld1
8.03 c                   parm                    w_mld2
8.03 c                   parm                    w_mld3
8.03  *
8.03 c                   eval      b_actc = *off
8.03 c                   eval      w_line = 0
8.03 c                   eval      w_accp = *blanks
8.03 c                   endif
8.03  *
     c                   enddo
      *
     c     xendop        tag
      *
      * File GTRTPF "closes" for å få tømt "Records in memory",
      * ut på file, p.g.a. bufring:
      *
     c                   if        *in60 = *on
     c                   close     gtrtpf
     c                   open      gtrtpf
     c                   move      *off          *in60
     c                   endif
      *
      * File GORTPF "closes" for å få tømt "Records in memory",
      * ut på file, p.g.a. bufring:
      *
     c                   if        *in61 = *on
     c                   close     gortpf
     c                   open      gortpf
     c                   move      *off          *in61
     c                   endif
      *
      * File RCNRPF "closes" for å få tømt "Records in memory",
      * ut på file, p.g.a. bufring:
      *
     c                   if        *in62 = *on
     c                   close     rcnrpf
     c                   open      rcnrpf
     c                   move      *off          *in62
     c                   endif
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering første løpenummer det skal leses på.   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xfØrst        begsr
     c     key00         setll     gatrl1
     c     key00         reade     gatrl1                                 60
     c                   if        *in60 = *off
     c                   eval      wplØpn = gblØpn
     c                   else
     c                   eval      wplØpn = 0
     c                   endif
     c                   if        wplØpn >= 1
     c                   eval      wplØpn = wplØpn - 1
     c                   endif
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for "forny" -> F5:                                    *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     xinke         begsr
      * Nullstiller tabell:
     c                   eval      i = 0
     c                   eval      wpoppd = *blanks
     c                   movea     *zeros        giro
     c                   movea     *zeros        lØpn
     c                   movea     *blanks       type
     c                   movea     *zeros        oppd
     c                   movea     *zeros        dato
     c                   movea     *zeros        klok
     c                   movea     *zeros        firm
     c                   movea     *blanks       filg
      * Henter løpenummer til første post i filen:
     c                   exsr      xfØrst
      * Nullstiller felt:
     c                   eval      b1valg = *blanks
     c                   eval      b2valg = *blanks
     c                   eval      b2lØpn = 0
      *
     c                   if        sfrn01 <> *zero
     c     sfrn01        chain     b1sfl                              60
     c                   endif
      *
      * Nøkkel på file er primært Bankgironummer dersom dette er
      * utfylt:
      *
     c                   if        gcbgir <> 0
     c                   eval      wpgiro = gcbgir
     c                   else
     c                   eval      wpgiro = gcpgir
     c                   endif
      *
      * Bruker SONEKONTONUMMER (GCSKTO) i fra faste data,
      * i steden for BANKKONTONUMMER (GCBGIR).
      *
19011c                   eval      wpgiro = gcskto
      *
     c                   eval      wplØpn = 0
      *
     c                   exsr      xclr01
     c                   exsr      xcrt01
     c                   endsr
      *                                                              .
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Legger BETFOR-transakjson over i datastruktur, for å oppdatere
      * ev. ny filgruppe og firmanummer på hver enkelt transaksjon:
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     xoverf        begsr
      *
      * Generell datastruktur, d.v.s. noen felter har lik posisjon
      * uavhengig av recordtype, og kan derfor testes på.  Dette
      * gjelder feltet for recordtype DSBETF:
      *
     c                   movel     dstota        dsa00a
     c                   move      dstotb        dsa00b
      *
      * Datastruktur ved BETFOR01:
      *
     c                   if        dsbetf = 'BETFOR01'
     c                   movel     dstota        dsb00a
     c                   move      dstotb        dsb00b
     c                   movel     b1filg        dsbfgr
     c                   eval      dsbfir = b1firm
     c                   movel     dsb00a        dstota
     c                   move      dsb00b        dstotb
     c                   endif
      *
      * Datastruktur ved BETFOR04:
      *
     c                   if        dsbetf = 'BETFOR04'
     c                   movel     dstota        dsd00a
     c                   move      dstotb        dsd00b
     c                   movel     b1filg        dsdfgr
     c                   eval      dsdfir = b1firm
     c                   movel     dsd00a        dstota
     c                   move      dsd00b        dstotb
     c                   endif
      *
      * Datastruktur ved BETFOR21:
      *
     c                   if        dsbetf = 'BETFOR21'
     c                   movel     dstota        dsc00a
     c                   move      dstotb        dsc00b
     c                   movel     b1filg        dscfgr
     c                   eval      dscfir = b1firm
     c                   movel     dsc00a        dstota
     c                   move      dsc00b        dstotb
     c                   endif
      *
      * Datastruktur ved BETFOR23:
      *
     c                   if        dsbetf = 'BETFOR23'
     c                   movel     dstota        dse00a
     c                   move      dstotb        dse00b
     c                   movel     b1filg        dsefgr
     c                   eval      dsefir = b1firm
     c                   movel     dse00a        dstota
     c                   move      dse00b        dstotb
     c                   endif
      *
     c                   endsr
      /eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Vise poster som er valgt til oppdatering:                       *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xsbf3         begsr
      * Fyll opp subfile:                                               .
     c                   eval      i = 0
     c                   exsr      xclr03
     c                   exsr      xcrt03
     c                   exsr      xc1bld
     c                   eval      wpoppd = *blanks
     c                   movea     *zeros        giro
     c                   movea     *zeros        lØpn
     c                   movea     *blanks       type
     c                   movea     *zeros        oppd
     c                   movea     *zeros        dato
     c                   movea     *zeros        klok
     c                   movea     *zeros        firm
     c                   movea     *blanks       filg
     c                   eval      wplØpn = xxlØpn
     c                   eval      i = 0
     c                   endsr
      /eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Sletter bacth:                                                  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xslett        begsr
      *
     c                   eval      wpgiro = b1bgir
     c                   eval      wplØpn = b1lØpn
     c     key01         setll     gatrlu
     c     key01         reade     gatrlu                                 60
      *
     c                   dow       *in60 = *off
     c                   delete    gatrpfu
     c     key01         reade     gatrlu                                 60
     c                   enddo
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for å ta kopi av batcher som er valgt til oppdatering *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
09060c     xcopy         begsr
      *
     c     key01         setll     gatrl1
     c     key01         reade     gatrl1                                 63
      *
     c                   dow       *in63 = *off
     c                   movel     gbreco        gfreco
     c                   eval      gfgiro = gbgiro
     c                   eval      gflØpn = gblØpn
     c                   movel     gbtype        gftype
     c                   eval      gftell = gbtell
     c                   eval      gfoppd = gboppd
     c                   eval      gfdato = gbdato
     c                   eval      gfklok = gbklok
31011c                   movel     gbfgrp        gffgrp
31011c                   eval      gffirm = gbfirm
     c                   write     gbtrpfr
     c     key01         reade     gatrl1                                 63
     c                   enddo
      *
09060c                   endsr
      *
      /eject
      *
8.04  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
8.04  * Skriv til GUF2PF                                                *
8.04  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
8.04  *
8.04 c     skriv_gur2    begsr
8.04  *
8.04 c     gubfl8_key    chain     gubfl8
8.04 c                   if        %found
8.04  *
8.04 c                   eval      rlevl1_levr = galevr
8.04 c     rlevl1_key    chain     rlevl1
8.04 c                   if        not %found
8.04 c                   eval      rlfact = 0
8.04 c                   endif
8.04  *
8.04 c                   eval      gdofir = gafirm
8.04 c                   eval      gdofor = x_dato
8.04 c                   eval      gdolev = galevr
8.04 c                   eval      gdofac = rlfact
8.04 c                   eval      gdoval = rlvalk
8.04 c                   eval      gdoref = *blanks
8.04 c                   eval      gdobnr = gabiln
8.04 c                   eval      gdobel = gabelØ
8.04 c                   eval      gdovbe = gavalb
8.04 c                   eval      gdotki = 0
8.04 c                   eval      gdofki = 0
8.04 c                   eval      gdotku = *blanks
8.04 c                   eval      gdofku = *blanks
8.04 c                   eval      gdokid = gakidi
8.04 c                   eval      gdoubf = gabfnr
8.04 c                   eval      gdobfl = gabfli
8.04 c                   eval      gdokno = 0
8.04 c                   eval      gdoopp = 0
8.04 c                   eval      gdopro = 0
8.03 c                   write     gur2pfr
8.05 c                   eval      wpregn = 'JA'
8.01 c                   endif
8.04  *
8.04 c                   endsr
8.04  /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      * Hjelpefeltet WPMBER inneholder navn på member regnskaps-
      * post skal overføres til:
      *
06108c                   eval      wpmber = *blanks
      *
     c     *dtaara       define    *lda          lda
      *
      * D2PERI = Regnskapsperiode:'
      *
     c                   eval      d2peri = 0
      *
      * D2PERI="K" ved kontrolliste og "J" ved journalliste:
      *
     c                   movel     'K'           d2joko
      *
      * Hjelpefeltet WPREGN er "JA" dersom det finnes poster
      * som skal til regnskap:
      *
     c                   eval      wpregn = *blanks
      *
      * Type system (til regnskap):
      *
     c                   eval      wpsyst = 'TELE'
      *
      * Hjelpefelt WPIN09 er "JA" dersom det kun skal vises
      * returer som er oppdatert:
      *
     c                   eval      wpin09 = *blanks
      *
      * Legger ut tekst i F9-feltet + Linjevalg:
      *
     c                   movel     txt(2)        b2cmd9
     c                   movel     txt(4)        a1valg
      *
      * Initierer hjelpefelt:
      *
     c                   eval      spge01 = 0
     c                   eval      srrn01 = 0
     c                   eval      spge02 = 0
     c                   eval      srrn02 = 0
     c                   eval      spge03 = 0
     c                   eval      srrn03 = 0
     c                   eval      w_arow = 4
     c                   eval      w_acol = 29
     c                   eval      wpin12 = 0
06108c                   eval      wpin03 = 0
     c                   eval      wpperi = *blanks
     c                   eval      wppeÅr = 0
     c                   eval      wppemÅ = 0
      *
      * Hjelpefelt for å indikerer at det er mottatt returposter
      * for telegiro og eller OCR:
      *
     c                   eval      wptele = *blanks
     c                   eval      wpocr = *blanks
11108c                   eval      wpink = *blanks
      *
      * Dersom det er valgt oppdatering av transaksjoner, så
      * vil WPOPPD inneholde 'JA'.  "I" er elementtellr i tabellen.
      *
     c                   eval      wpoppd = *blanks
     c                   eval      i = 0
      *
     c                   movel     l_filg        a1fgrp
     c                   eval      a1firm = l_firm
     c                   movel     l_fnav        a1fnav
      *
      * Initirer felten for filgruppe og firma, som skal
      * legges ut på file GTRTPF:
      *
     c                   movel     l_filg        gdqfgr
     c                   eval      gdqfir = l_firm
      *
      *
      * Key til bruk på returfiler - GATRL1, lese på gironummer:
      *
     c     key00         klist
     c                   kfld                    wpgiro
      *
      * Key til bruk på returfiler - GATRL1, leses på giro-/løpenummer:
      *
     c     key01         klist
     c                   kfld                    wpgiro
     c                   kfld                    wplØpn
      *
      * Key til bruk på returfiler - GATRLU, behandler hver linje:
      *
     c     key02         klist
     c                   kfld                    wpgiro
     c                   kfld                    wplØpn
     c                   kfld                    wptype
     c                   kfld                    wptell
      *
      * Key til bruk på avtaleregister - GAVTL2, hente gironummer:
      *
     c     key03         klist
     c                   kfld                    l_filg
     c                   kfld                    l_firm
8.01  *
8.01  * Key til bruk på utbetalingsforslag
8.01  *
8.01 c     gubflu_key    klist
8.01 c                   kfld                    l_firm
8.01 c                   kfld                    gubflu_bfnr
8.01 c                   kfld                    gubflu_bfli
8.04  *
8.04  * Key til bruk på utbetalingsforslag
8.04  *
8.04 c     gubfl8_key    klist
8.04 c                   kfld                    l_firm
8.04 c                   kfld                    gubfl8_bfnr
8.04 c                   kfld                    gubfl8_bfli
8.04  *
8.04  * Key til bruk på leverandør
8.04  *
8.04 c     rlevl1_key    klist
8.04 c                   kfld                    l_firm
8.04 c                   kfld                    rlevl1_levr
8.07  *
8.07  * Key til bruk på leverandør
8.07  *
8.07 c     rltrlu_key    klist
8.07 c                   kfld                    l_firm
8.07 c                   kfld                    rltrlu_levr
8.07 c                   kfld                    rltrlu_bdat
8.07 c                   kfld                    rltrlu_tist
      *
      * Henter gironummer ut i fra pålogget filgruppe/firmanummer.
      * Ved IKKE TILSLAG settes *IN40 *ON for å indikere at pgm.
      * må avsluttes.  Dersom bankgironummer IKKE finnes brukes
      * postgironummer.  Den samme logikken brukes i program
      * GL109R, som legger ut data på file GATRPF, d.v.s. post-
      * gironummer brukes i nøkkel feltet KUN dersom bankgironr.
      * IKKE er utfylt:
      *
     c     key03         setll     gavtl2
     c     key03         reade     gavtl2                                 60
      *
     c                   if        *in60 = *on
     c                   move      *on           *in40
     c                   eval      wpgiro = 0
     c                   goto      xutinz
     c                   endif
      *
     c                   if        gcbgir <> 0
     c                   eval      wpgiro = gcbgir
     c                   else
     c                   eval      wpgiro = gcpgir
     c                   endif
      *
      * Bruker SONEKONTONUMMER (GCSKTO) i fra faste data, i steden
      * for BANKKONTONUMMER (GCBGIR).
      *
     c                   eval      wpgiro = gcskto
      *
      * Starter les av transaksjonsfilen, på nivå filgruppe/firma,
      * d.v.s. alle poster må ha likt gironummer.  Først posisjoneres
      * det på gironummer for å hente inn 1. post, og deretter leses
      * det på løpenummer innenfor dette gironummeret:
      *
     c     xutinz        tag
      *
      * Henter løpenummer til første post i filen:
      *
     c                   exsr      xfØrst
      *
      * Fyll opp subfile:
      *
     c                   exsr      xcrt01
      *
     c                   endsr
      *
**
* Retur er oppdatert *
F9=Vise oppdaterte returer
F9=Returer til oppdatering
1=Oppdatere  4=Slette  5=Vise
4=Slette
