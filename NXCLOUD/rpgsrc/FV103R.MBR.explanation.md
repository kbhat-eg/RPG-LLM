# RPG Program Explanation: FV103R - Maintenance of Status Codes and Order Types

## Overview

This program (`FV103R`) is designed to maintain status codes and order types, as part of the system `ASOFAK`. The code is written in traditional (fixed-format) ILE RPG. Its main functionality relates to viewing and updating records in a code register, specifically dealing with status and order types.

## File Definitions

- **FV103D**: A display file (`WORKSTN`) used for communicating with the user through a screen.
- **FSTSL1**: A keyed disk file, input only, with records renamed as `FSTSL1R`.
- **FSTSLU**: An update-capable keyed disk file (user open, add, update, delete), with records renamed as `FSTSLUR`.

## Data Structures and Fields

- **UDS**: User Data Space, used for storing program variables.
- **l_user [911-920]**: Likely stores the user ID.
- **DSSFIR [944-946]**: Probably holds company number or something similar.
- **l_fnav [951-980]**: Additional user-related info.

## Main Logic

### 1. Display Handling (A1BLD)

This section is the main "screen" logic:

#### Retrieve Record

- Use the key (`STSKEY`) to CHAIN (fetch) a record from file `FSTSL1`.
- If found (`*IN90 = *OFF`):  
  - Move contents of FAAOT1..FAAOT8 to screen fields A1OT01..A1OT08.
  - Moves for order type fields A1OTYA to A1OTYE are commented out in some versions.
- If not found:
  - Set A1OT01..A1OT08 and other order type fields to blanks.

#### User Edits

- The screen `A1BLD` is displayed using `EXFMT` (show and wait for user input).

#### Exit Handling

- If F3 pressed (`*INKC`), branch to `XSLUTT` (exit routine).

#### Record Update

- CHAIN on `FSTSLUR` (the updatable file) using the same key.
- Move screen fields back to file fields.
- If record exists:
  - Update timestamps (`FAAEDA`, `FAAETI`) with current time.
  - Update user field (`FAAEUS`).
  - `UPDATE` the record.
- If record does not exist:
  - Initialize `FAAFIR` from `DSSFIR` and fill other fields.
  - Set timestamps and user fields.
  - `WRITE` a new record.

### 2. Program Exit

- At label `XSLUTT`, the program sets on LR (last record indicator for cleanup) and returns.

### 3. Initialization Subroutine (`*INZSR`)

Executed at program start:

- Redefines key fields as required.
- Initializes the key for the code register file.
- Moves the company number (`DSSFIR`) into the key field (`STSFIR`) for later file access.

---

## Key Concepts and Takeaways

- **CHAIN** is used to fetch records based on a key; `*IN90` is used to determine if the record was found.
- **MOVE** is used throughout to shuttle data between data structures and fields, reflecting the classic RPG fixed-format style.
- **Order Types** (A1OT01..A1OT08, A1OTYA..A1OTYE) are central: the user can view/edit them as part of a specific status code.
- **File Updates**: If a record exists, it is updated; if not, a new record is created.
- **User and Timestamp Tracking**: Each change/update logs the user and time for audit purposes.
- **Screen Handling**: The user interacts with the application via a display file, and F3 exits the maintenance.

---

## Notes on RPG Terminology

- **EXFMT**: Show the screen and wait for user input.
- **TAG** and **CABEQ**: Control flow statements for branching/goto.
- **UF** (Update file with user control) and **IF** (Input file) indicate file opening modes.
- The code uses release-specific comments (e.g., 5.01, 5.51, 6.10) to document when certain fields were added or removed.

---

## Summary Flow

1. **Initialize** program, key fields.
2. User selects a status code for maintenance.
3. Fetches and displays order types for that code.
4. User can update order type fields.
5. On save, updates or creates the corresponding record in the code register, logging the user/time.
6. On F3, returns and ends.

---

## Typical Use Case

- Used by administrators or clerks to maintain or correct order type assignments to various status codes within the company's workflow or order management module. Audit trails (timestamps/user) are maintained with every change.

---

**This program is a classic RPG maintenance (CRUD) routine, adapted with some audit features and supporting several releases of the underlying file structure.**