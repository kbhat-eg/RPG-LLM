# RPG Program Explanation: RH514R – Inquiry on Summary Database

This RPG (Report Program Generator) program, named `RH514R`, is part of the ASOKON system and is designed for inquiry into a summary database, with several features around subfile handling and integration with other modules (factoring, invoice, and archive). Below is a detailed walkthrough for onboarding developers.

---

## 1. **Program Title and Maintenance Log**

At the top, the code includes a `/TITLE` statement, followed by:
- System, program name, and description.
- A change log with version numbers, dates, authors, and descriptions of changes.

### **Key Points From Comments**
- The program has undergone many versions, adding features like detailed views, vendor invoices, archive display, and adaptations for new GUI.

---

## 2. **Indicator Usage**

A detailed comment explains how indicators (`*INnn`) are used:
- LR: Last record (program end)
- 10, 12, 13, 14, 15, 16, 21, 22, 30, 31–79, 80–89, 90–99: For various UI, logic, error, and file handling functions.
- E.g., 12/13 for subfile display, 14/15 for clearing/ending subfile, etc.

---

## 3. **File Declarations**

Files used by the program:
- `rzuml1`, `rzuml2`, `raa1l1`: Database files, all keyed disk files with logical record format renames.
- `rh514d`: Display file (workstation), SFILE keyword for subfile handling.
- All files are externally described (using DDS).

---

## 4. **Variables and Data Structures**

### **Local Data Area (LDA)**
Portions of the program’s local data area are mapped to named fields (e.g., `l_user`, `l_filg`, `l_firm`).

### **Display File Feedback (INFDS)**
Structure for screen cursor location, used for cursor positioning.

### **Parameters**
- For storing program entry parameters and working values (account, department, invoice number, text, amount, etc.).

### **Key Variables**
- Used for building keys to access database records.

### **Working Variables**
- Subfile counters (`w_spge`, `w_srrn`, etc.), control flags (`b_forn`, `b_anul`, etc.), and display info.

### **External Program Declarations**
- From version 7.00, procedures and external programs (e.g., `CO402R`) are declared in free format (RPG IV style).

---

## 5. **Constants**

Values like `c_sfil` are used to control subfile page size.

---

## 6. **Subfile Field Explanations**

- `w_srrn`: Current subfile relative record number.
- `w_spge`: Page size for subfile.
- `w_sfrn`/`w_ssrn`: First/last record number in current page.
- `w_virn`: Record number currently being viewed.

---

## 7. **Screen Layouts**

Names of display (DDS) records used for subfiles and messages (e.g., `B1SFL`, `B2CTL`, `C1MSG`).

---

## 8. **Main Program Flow**

### **Initialization**
- Entry parameters are loaded.
- Retrieves company number from LDA.
- Calls external programs for new GUI features.
- Chains to a status record for the company.
- Populates screen headings with parameter values.
- Sets up key lists for records.
- Positions database to the correct place and fills the subfile.

### **Main Loop Tag: `b2taga`**
- Writes the command screen.
- Calls subfile routines.

### **Function Key Handling**
- Function keys cause actions like rolling the subfile, repositioning the cursor, or ending the program.

### **Subfile Handling Loop**
- Toggles cursor indicator.
- Reads subfile entries in a loop, processing special selection actions for each row based on user actions:
    - **View details**
    - **View transaction**
    - **View invoice (customer or vendor)**
    - **View archive**
- Calls appropriate external programs for each action, passing required data.

---

## 9. **Subroutines**

### **subfile**
- Handles reading and processing of each subfile record, checking selection and calling corresponding routines or programs.

### **xc2bld**
- Handles viewing of a summary posting with extra details, fetching additional information, and formatting data for the screen.

### **hent_text**
- Fetches supplemental description fields (account, department, cost center, customer/vendor name) by calling other programs.
- Handles blanks and formatting if data is not present.

### **clr_subfile**
- Clears and resets subfile and related variables.

### **crt_subfile**
- Fills the subfile with more records until the subfile page is full.
- Transfers data from the summary to the subfile.

### **dsp_subfile**
- Displays the subfile or command screen depending on record count.

### **\*inzsr**
- Sets up initial values, receives entry parameters, initializes heading fields, and positions the database for subfile loading.

---

## 10. **External Calls**

- The program integrates tightly with other ASOKON modules, calling programs like `RF512R`, `RK110C`, `RL110C`, `AX700R`, `AP622C`, etc., to fetch transactions, invoices, or archive info.

---

## 11. **Archive Handling**

- There is logic for determining which archive (ASP, Multiarkiv, BSA) to show, as well as customizable behavior depending on which "variant" of the program is running, controlled partly via `CO402R`.

---

## 12. **Notes on Version Differences**

- Several code sections are marked with version numbers and notes, showing where logic changed depending on which release is active.

---

# **Summary for New Developers**

- The program is a **display/inquiry program on summary records** ("sumpostering") using subfiles for paging and selection.
- It is highly modular, using external programs for fetching information and for handling viewing of details, invoices, and archives.
- Subfile logic is central: database records are loaded into subfiles, users select lines, and actions are performed based on selection.
- There is robust handling for additional descriptive information (account names, cost centers, etc.).
- Frequent reliance on indicators, parameters, and external calls is standard for this codebase.
- The code includes thorough comments regarding indicator usage, file/field purposes, and subfile mechanics.

---

### **Key onboarding tips:**
- **Familiarize yourself with the subfile handling pattern** in RPG, as it is central to this and many similar programs.
- **Understand indicator usage**—it drives UI feedback, program state, and processing logic.
- **Learn the interaction with external programs**, as much of the business logic and data lookup happens outside this program.
- **Refer to display file (DDS) layouts** to understand how the subfiles and command screens look and behave.
- **Review maintenance comments** to see why certain logic is present or differing between releases.

---

**In summary**, RH514R is a well-documented, classic ILE RPG inquiry program with multi-line subfile functionality, modular integration, and legacy indicator-based control. Understanding its subfile and external call patterns is essential for effective maintenance and extension.