# RPG Program Explanation

This RPG (Report Program Generator) program is a classic (fixed-format) ILE RPG code, named `LO642R`, running on IBM i (AS/400) system. Its main purpose is to print a report of order statuses ("bestilling-status-liste"). Below is a structured walkthrough of its components and logic.

---

## 1. **Header and Documentation**

The **H/TITLE** and following comments document the program:
- **System**: ASLAGR
- **Program Name**: LO642R
- **Description**: Prints an ordering status list (bestilling-status-liste)
- **Change Log**: Shows modification history, e.g., code review for number expansion.

---

## 2. **File Declarations**

This section specifies all the files the program uses and their relationships.

```rpg
Frlevl1    IF   E           K DISK    RENAME(RLEVPFR:rlevl1R)
FLSTSL1    IF   E           K DISK    RENAME(LSTSPFR:LSTSL1R)
FLOHEL1    IF   E           K DISK    RENAME(LOHEPFR:LOHEL1R)
FLO642P    O    E             PRINTER
```

- **Frlevl1**: Input file, keyed, external, renamed record format.
- **FLSTSL1**: Input file, keyed, external, renamed record format.
- **FLOHEL1**: Input file, keyed, external, renamed record format.
- **FLO642P**: Output file dedicated to the printer (the report output).

---

## 3. **Data Structures and Variables**

### Parameter and Company Info

```rpg
D                 DS
D  LDPREC                 1     64
D  LDVAL1                 1      1  0
D                UDS
D  DSFIRM               944    946  0
D  DSFNAV               951    980
```

- **LDPREC**: 64-byte field (parameter input buffer).
- **LDVAL1**: 1-digit numeric variable (purpose unclear).
- **DSFIRM**: Company number (3 digits at specific positions in the user space).
- **DSFNAV**: Company name.

---

## 4. **Report Format Definitions**

Commented explanations mention the three formats used in the printer file:
- **A1HDR**: Report heading
- **D1DET**: Detail line
- **T1TOT**: Total line

---

## 5. **Report Heading (A1HDR)**

```rpg
C                   WRITE     A1HDR
```
- Prints the report heading at the start.

---

## 6. **Processing Order Headers (Main Logic Loop)**

```rpg
C     HEDKEY        SETLL     LOHEL1
C                   READ      LOHEL1                                 15
C     *IN15         DOWEQ     '0'
  ... (processing logic)
C                   READ      LOHEL1                                 15
C                   ENDDO
```

- **SETLL HEDKEY LOHEL1**: Positions file at key.
- **READ LOHEL1 15**: Reads next record; indicator 15 shows EOF.
- **Loop** (`DOWEQ '0'`): While not EOF, process each order header.

### Inside the Loop:

- **Supplier Fetch**: Fetch supplier info from supplier master (`rlevl1R`) using key from current order.
- **Supplier Name**: If found, copy to print line, otherwise blank.
- **Date Fields**: Copies and initializes dates (`d1bdat`, `d1ldat`), ensures they’re valid (not *loval/null).
- **Counter**: Increments the number of records processed (`T1POST`).
- **Print Detail**: Writes detail line (`D1DET`) to printer file.
- **Overflow**: Checks for page overflow (`*IN30`), writes heading if needed to new page.

---

## 7. **Totals and Program End**

```rpg
C                   WRITE     T1TOT                                30
C                   GOTO      XSLUTT
...
C     XSLUTT        TAG
C                   SETON                                        LR
```
- **Writes total line** (`T1TOT`) to report if finished.
- **Jumps to end** (tag `XSLUTT`) and ends the program, setting LR (Last Record) on to signal end of job.

---

## 8. **Initialization Subroutine (*INZSR)**

```rpg
C     *INZSR        BEGSR
  ... (initialization logic)
C                   ENDSR
```

- **Field Initialization and Redefinition**: Some fields are initialized or redefined for compatibility.
- **Key Lists** for files (leverandørregister/supplier, statusregister, bestilling-hode-register/order header).
- **Parameter Transfer**: Receives parameters from the calling program (`*ENTRY`), processes them, and stores relevant fields for further use.
- **Company/Status Information**: Moves company number/name to relevant fields, sets up keys for file access.

---

## 9. **Parameter Handling**

```rpg
C     *ENTRY        PLIST
C                   PARM                    WWPARM           64
C                   MOVE      WWPARM        LDPREC
```
- The program can be called by another program, receiving a 64-byte parameter block.

---

## 10. **Lookup of Status Information**

```rpg
C     STSKEY        CHAIN     LSTSL1R                            69
```
- Looks up status codes via `STSKEY` in `LSTSL1R`.

---

# **Summary Table**

| Section          | Purpose                                                            |
|------------------|--------------------------------------------------------------------|
| File Specs       | Declares logical/physical files, output                          |
| Data Structures  | Parameter, company information, etc.                             |
| Formats          | Defines layout for report header, detail, and totals             |
| Main Logic       | Reads order headers, fetches supplier data, prints details       |
| Totals           | Prints totals at end                                             |
| Initialization   | Sets up variables, key lists, handles incoming parameters        |
| Parameter Logic  | Accepts input from calling program                               |
| Lookup           | Fetches status code information                                  |

---

# **Process Overview**

1. **Initialization**: Receives company and parameter info, sets up all necessary variables and keys.
2. **Prints Report Heading**.
3. **Main Loop**: For each order header:
    - Fetches supplier details.
    - Prepares print detail line.
    - Checks for page overflow.
4. **Prints Totals** at the end.
5. **Exits Program** gracefully.

---

# **Onboarding Tips**

- The program is written in old-style fixed-format RPG IV, with heavy reliance on indicators and explicit moves.
- It expects data and keys to be structured at specific positions, often using large user spaces and substringed fields.
- All file accesses are based on explicit key lists (`KLIST`), so understanding the database structure is important.
- The logic is linear and report-oriented, with little abstraction; pay special attention to how indicators (e.g., *IN15, *IN30) are used for flow control.
- Look for the printer file definitions (A1HDR, D1DET, T1TOT) in the external definition for FLO642P for the actual report layout.

---

This explanation should help any developer quickly get acquainted with the structure, flow, and purpose of the program!