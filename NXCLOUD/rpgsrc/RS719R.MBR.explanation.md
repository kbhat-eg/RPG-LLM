# Program Documentation: RS719R – Kontroll av gyldig kontoklasse

## Overview

**Program:** RS719R  
**System:** ASOKON  
**Purpose:**  
This program validates whether a given account class code ("kontoklasse") is valid for a specified company ("firma"). It is typically used as a called validation routine, returning a status code and description indicating whether the provided code exists in the relevant master file.

## Structure and Flow

### File Definition

```rpg
fra19l1    if   e           k disk    rename(ra19pfr:ra19l1r)
```
- The program uses the logical file `ra19l1r`, which is a renamed version of the physical file `ra19pfr`. This file contains the valid account class codes.
- The file is accessed with keyed operations, supporting random access by key.

### Data Structures and Variables

- **w_firm**: Holds the company number, based on the field `rasfir` from the file.
- **p_stat**: Single-character status code returned to the caller; 'N' means not found/invalid.
- **p_skod**: Account class code to be validated (input/output parameter).
- **p_stxt**: Account class description (output parameter).
- **ra19l1_skod**: Internal variable for the code to be validated.
- **l_user, l_firm, l_fnav**: Fields from the user space or parameter list, containing user, company, and name info, respectively.

### Parameter List

The program expects three parameters (by reference):
1. **p_stat** (status flag, output)
2. **p_skod** (account class code, input)
3. **p_stxt** (description, output)

### Main Logic

1. **Initialization**:
    - The *INZSR subroutine assigns the company number (`l_firm`) to the working variable `w_firm`.
    - The key list for file access is constructed using `w_firm` and `ra19l1_skod`.

2. **Validation**:
    - The account class code to be validated is assigned from the parameter to the working variable.
    - A CHAIN operation is performed against `ra19l1r` using the key (company + code).
    - Indicator 60 is used to determine if the record was found.
        - **If not found** (`*IN60 = *ON`):  
          - `p_stat` is set to 'N'.
          - `p_stxt` is set to a fixed message: "Koden er ugyldig" ("The code is invalid").
        - **If found**:  
          - `p_stat` is set to blank.
          - `p_stxt` is set to the description from the file (`rastxt`).

3. **Program Termination**:
    - The program sets the LR (last record) indicator and returns.

### Subroutine: *INZSR

- Handles initialization at program start.
- Sets up the working company number (`w_firm`).
- Prepares the parameter list and the key list for file access.

## Business and Domain Logic

- The program enforces that account class codes are valid within the context of a specific company. This is typical in multi-company accounting systems.
- The code expects the company number to be passed in the parameter list area (specifically in `l_firm`), which is mapped from the user space or calling program’s data structure.
- The logic for determining validity is strictly based on existence in the master file; there is no additional business rule or transformation.

## Design Notes and Conventions

- **File Indicator Usage**:  
  Indicator 60 is reserved for the result of the CHAIN operation. This is a common convention in this codebase for file access indicators.
- **Status Flag Convention**:  
  The status flag (`p_stat`) uses 'N' to indicate "not found" and blank for "found/valid". This is documented in the comments and should be followed in interfacing code.
- **Parameter Passing**:  
  The program is designed for use as a called routine, not a standalone application. It relies on parameters for both input and output, and expects specific fields (user, company, etc.) to be mapped correctly by the caller.
- **Field Naming**:  
  Field and variable names closely follow the naming conventions of the underlying physical file, making cross-reference easier but requiring familiarity with the data model.

## Interactions with Other Modules

- **File ra19pfr/ra19l1r**:  
  The master file for account class codes. Any changes to its structure or contents will directly affect this program.
- **Calling Programs**:  
  This routine is intended to be called by other programs (e.g., data entry, validation, or import routines) that need to verify account class codes.

## Error Handling

- The only error condition handled is "not found"; there is no explicit handling for file errors, data corruption, or other unexpected conditions. The program assumes the file is available and accessible.

## Localization

- All status messages are in Norwegian, consistent with the rest of the system.

## Summary

RS719R is a straightforward, reusable validation routine for checking the existence of an account class code within a company. It is tightly coupled to the structure and conventions of the ASOKON system, and relies on proper upstream parameter mapping and file maintenance. The code is cleanly structured, with clear separation of initialization and validation logic, and adheres to established indicator and parameter conventions in this codebase.