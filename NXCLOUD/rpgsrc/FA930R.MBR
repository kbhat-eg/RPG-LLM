     h option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOFAK
      * Program . . . . : FA930R
      * Beskrivelse . . : Oppretter kunder ved hjelp av F6
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
3.31  * R3.31 150601      Lagt inn vedlikehold av mobiltelefon
3.32  * R3.32 021101      Lagt inn vedlikehold av e-mail-adresse
      *       021101      Hele programmet lagt om til ny standard
T5.40 * V5.40 260505 KOB  Henter standardverdier fra kundekategori
T5.40 * V5.40 310505 KOB  Lagt inn overgang til kontaktperson
T5.40 * V5.40 310505 KOB  Lagt inn overgang til kort
T5.40 * V5.40 150605 HFL  Leser RKLAL2 i stedet for RKLALU.
T5.40 * V5.40 030605 KOB  Lagt inn kontroll mot foretaknummer
T5.40 * V5.40 030705 KOB  Lagt inn kontroll mot bankgironr.
T5.40 * V5.40 030705 KOB  Lagt inn kontroll mot telefonnr.
T5.40 * V5.40 030705 KOB  Lagt inn kontroll mot e-mailadresse
T5.40 * V5.40 200705 KOB  Lagt inn kontroll mot mobiltelefonnr.
T5.40 * V5.41 261005 KOB  Lagt inn kontroll slik at data fra kopi-kunde
      *              KOB  beholdes hvis kode for standardverdier er 0
T5.40 * V5.42 311005 KOB  Lagt inn kontroll mot mobiloperatør
T5.40 * V5.50 191105 KOB  Lagt inn utskrift av kundeinformasjon
 5.42 * V5.50 241105 KOB  Editering av kundens tlfnr. (nn nn nn nn)
 5.42 * V5.50 241105 KOB  Editering av kundens tlfx.. (nn nn nn nn)
 5.42 * V5.50 241105 KOB  Editering av kundens mobil. (nn nn nn nn)
      *       011205 HKO  Returnerer p_retu='1' dersom opprettingen
      *                   avbrytes
5.60  * R5.60 271107 AMD  Lagt inn løsning for kontroll av grense for
      *                   almenningsrabatter
6.10  * V6.10 220909 BSA  Lagt inn sporingsfelter
6.11  * V6.10 070510 BSA  Endret sporingsmåte
6.20  * V6.20 260411 AMD  Flere muligheter rundt kredit-alternativer
6.21  * V6.20 140611 bsa  Memosaldo lagt ut på egen file
6.22  * V6.20 130112 bof  hente div. fra std. kunde
6.23  * V6.20 150312 amd  Justeringer i hvilken kode som skal legges ut
6.23  *                   for kreditttype avhengig av brukerrettigheter
6.24  * V6.20 300315 nho  Tar ikke med saldo/kjøp felter og passiv
6.30  * V6.30 230514 bsa  Endret i skjermbildet pga overlapping
6.30  *                   av felter.
6.31  * V6.30 100914 bsa  Felt flyttet fra RKUN til RKME (RKKJAL)
6.32  *      110515  bof  Feltet RAKFAX skal styre mobil (fra ra11pf)
6.33  *      030516  nho  Feil feilmelding på avdeling
7.xx  * 7.00  160216 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
7.01  *       260320 ask  Lagt inn søk mot 1881 og utvidet parameterliste
7.02  *      090920  ask  Tar også med kredittype fra kopieringskunde (6.22)
7.03  *      101220  ask  Lagt inn støtte for oppslag mot Bisnode
      *
7.fb  *      021216  bof  Endringer i hht. forskuddsbetalingsløsning
7.fb  *      010117  bof  Skal ikke vise F5, F6, F7 og F10 før etter <enter>
      *
8.01  * 800  291121  ask  Gjort endringer/opprydding i skjermbilde for ny  std.
8.02  * 800  011221  ask  Sjekker kodeoppsett for Bisnode før visning av bilde.
8.03  * 800  021221  ask  Styrer kreditgrenser fra Bisnode
8.04  * 800  100522  ask  Tar inn fornavn ved manuell registrering
8.05  * 800   230125 ask  Endret kontroll på registrering av postnummer
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
     frkunlu    uf a e           k disk    rename(rkunpfr:rkunlur)
6.21 frkmelu    uf a e           k disk    rename(rkmepfr:rkmelur)
     frkunl2    if   e           k disk    rename(rkunpfr:rkunl2r)
T5.40f                                     prefix(x:1)
     frkunl4    if   e           k disk    rename(rkunpfr:rkunl4r)
T5.40f                                     prefix(x:1)
     frkunl7    if   e           k disk    rename(rkunpfr:rkunl7r)
T5.40f                                     prefix(x:1)
     frkunl8    if   e           k disk    rename(rkunpfr:rkunl8r)
T5.40f                                     prefix(x:1)
     frkunl9    if   e           k disk    rename(rkunpfr:rkunl9r)
T5.40f                                     prefix(x:1)
     frkunla    if   e           k disk    rename(rkunpfr:rkunlar)
T5.40f                                     prefix(x:1)
     frksal1    if   e           k disk    rename(rksapfr:rksal1r)
     frksalu    uf a e           k disk    rename(rksapfr:rksalur)
     fraa1pf    if   e           k disk    rename(raa1pfr:raa1pfr)
     fraa3l1    if   e           k disk    rename(raa3pfr:raa3l1r)
     fra11l1    if   e           k disk    rename(ra11pfr:ra11l1r)
     fapospf    if   e           k disk    rename(apospfr:apospfr)
     ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
7.fb ffst2l1    if   e           k disk    rename(fst2pfr:fst2l1r)
6.20 ffusrl1    if   e           k disk    rename(fusrpfr:fusrl1r)
     ffa930d    cf   e             workstn
      *
      * Definering av local data area
      *
     d                uds
     d l_user                911    920
7.01 d l_filg                931    933
     d l_firm                944    946  0
7.fb d l_avde                947    950  0
     d l_fnav                951    980
      *
      * Definering av parametere
      *
     d p_retu          s              1
     d p_firm          s                   like(rkfirm)
     d p_navn          s                   like(rknavn)
     d p_adr1          s                   like(rkgate)
     d p_adr2          s                   like(rkadr2)
     d p_sted          s                   like(rksted)
     d p_lkun          s                   like(rkkund)
7.01 d p_mobn          s                   like(rkmobn)
7.01 d p_ponr          s                   like(rkponr)
      *
      * Definering av variabler i nøkler
      *
     d rkunl1_kund     s                   like(rkkund)
     d rkunl2_alfa     s                   like(rkalfa)
     d rkunl4_ftnr     s                   like(rkftnr)
     d rkunl5_eank     s                   like(rkeank)
8.01 d*rkunl7_bgir     s                   like(rkbgir)
     d rkunl8_tlfn     s                   like(rktlfn)
     d rkunl9_emal     s                   like(rkemal)
     d rkunla_mobn     s                   like(rkmobn)
     d rksal1_saku     s                   like(rksaku)
     d rksalu_saku     s                   like(rksaku)
     d ra11l1_katg     s                   like(rkkatg)
     d apospf_ponr     s                   like(rkponr)
6.20 d fusrl1_firm     s                   like(fbfirm)
6.20 d fusrl1_user     s                   like(fbuser)
      *
      * Definering av variabler
      *
     d wactli          s              2  0
     d wactpo          s              3  0
     d werror          s              1  0
     d w_firm          s                   like(faafir)
     d w_stat          s              1
6.20 d w_ko12          s              1  0
6.20 d w_gkod          s              4  0
     d w_hkod          s              4  0
     d w_kkod          s              4  0
6.20 d w_gtxt          s                   like(c2gtxt)
     d w_htxt          s                   like(c2htxt)
     d w_ktxt          s                   like(c2ktxt)
     d w_kund          s                   like(rkkund)
     d w_ponr          s                   like(rkponr)
     d w_1bkk          s                   like(ra1bkk)
     d w_udat_iso      s               d   datfmt(*iso)
     d w_udat_alf      s              8
     d w_udat          s              8  0
serv d w_levr          s              6  0 inz(0)
     d w_feil          s              1  0
     d w_3mfe          s                   like(ra3mfe)
     d w_3kbr          s                   like(ra3kbr)
8.01 d*w_mobo          s                   like(rkmobo)
     d w_mtxt          s             30
serv d w_tlfn          s             15
7.03 d w_enav          s             30
7.03 d w_fnav          s             30
7.03 d w_adr1          s             30
7.03 d w_adr2          s             30
7.03 d w_pnum          s              4  0
7.03 d w_pste          s             30
7.03 d w_tele          s             11
7.03 d w_mobi          s             11
7.03 d w_kgre          s              8  0
7.03 d w_rati          s              5
7.03 d w_fdat          s             10
8.02 d w_type          s              6
7.fb d w_kpro          s              6  0
7.fb d w_vedl          s              1
      *
7.fb d b_ok            s              1    inz(*off)
      *
      * Definering av save-variable
      *
     d s_dist          s                   like(rkdist)
     d s_katg          s                   like(rkkatg)
     d s_ponr          s                   like(rkponr)
     d s_sat1          s                   like(rksat1)
     d s_sat2          s                   like(rksat2)
     d s_sat3          s                   like(rksat3)
     d s_spav          s                   like(rkspav)
8.01 d*s_mobo          s                   like(rkmobo)
6.20 d s_avde          s                   like(rkavde)
6.20 d s_kres          s                   like(rkkres)
6.22 d s_betb          s                   like(rkbetb)
6.22 d s_rabk          s                   like(rkrabk)
6.22 d s_betm          s                   like(rkbetm)
7.fb d s_grns          s                   like(rkgrns)
7.01  *
7.01  * Firmastyrt validering av felt
7.01  *
7.01 d u_1881          s              1    inz(*off)
7.03 d u_bisn          s              1    inz(*off)
7.01  *
7.01   dcl-s co402_verdi1  char(1);
7.01   dcl-s co402_verdi2  char(2048);
7.01   DCL-PR CO402R EXTPGM('CO402R');
7.01     p_filgrp            char(3)     const;
7.01     p_firm              packed(3:0) const;
7.01     p_lager             packed(2:0) const;
7.01     p_nokkel            char(50)    const;
7.01     p_verdi1            char(1);
7.01     p_verdi2            char(2048);
7.01   END-PR;
      *
      * Definering av konstanter
      *
     d lo              c                   'abcdefghijklmnopqrstuvwxyzæøå'
     d up              c                   'ABCDEFGHIJKLMNOPQRSTUVWXYZÆØÅ'
8.02
8.02 C/Exec SQL
8.02 C+  Set Option DatFmt=*ISO, DlyPrp=*YES, SRTSEQ=*LANGIDUNQ, LANGID=NOR
8.02 C/End-Exec
8.02
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Oppretting av ny kunde
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Hent neste ledige kundenummer
      *
     c                   eval      w_stat = *blank
      *
     c                   call      'RS001R'
     c                   parm                    w_stat
     c                   parm                    p_firm
     c                   parm                    w_kund
      *
      *  Hent opplysninger fra KUNDE-REGISTER - kopieringskunde
      *
     c                   eval      rkunl1_kund = faaknr
     c     rkunl1_key    chain     rkunl1
     c                   if        %found(rkunl1)
     c                   eval      s_spav = rkspav
6.22 c                   eval      s_betb = rkbetb
6.22 c                   eval      s_rabk = rkrabk
6.22 c                   eval      s_betm = rkbetm
7.02 c                   eval      s_kres = rkkres
      *
      *  Hent opplysninger fra avtale-spesifiksajon
      *
     c                   eval      rksal1_saku = faaknr
     c     rksal1_key    chain     rksal1
     c                   if        %found(rksal1)
     c                   eval      s_sat1 = rksat1
     c                   eval      s_sat2 = rksat2
     c                   eval      s_sat3 = rksat3
     c                   endif
     c                   endif
      *
7.fb c                   if        faak14 = 1
7.fb c                   eval      c2avde = l_avde
7.fb c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * C2BLD Behandle vindu for ny post
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     c2taga        tag
     c                   eval      c2kund = w_kund
     c                   eval      c2navn = p_navn
     c                   eval      c2gate = p_adr1
     c                   eval      c2adr2 = p_adr2
     c                   eval      c2sted = p_sted
7.01 c                   eval      c2tlfn = p_mobn
7.01 c                   eval      c2mobn = p_mobn
     c                   eval      c2katg = rkkatg
     c                   eval      c2dist = rkdist
8.01 c*                  eval      c2mobo = rkmobo
6.20 c                   eval      c2avde = rkavde
6.23 c                   if        w_ko12 = 2
6.20 c                   eval      c2kres = 2
6.23 c                   else
7.02 c                   eval      c2kres = s_kres
6.23 c                   endif
     c                   eval      rkunl1_kund = c2kund
     c                   movel     p_navn        c2alfa
      *
      * Konvertere alfafelt til store bokstaver
      *
     c                   exsr      konverter
      *
      * Ta vare på postnummer distrikt og kundekategori
      *
     c                   eval      s_ponr = c2ponr
     c                   eval      s_dist = c2dist
     c                   eval      s_katg = c2katg
6.20 c                   eval      s_avde = c2avde
6.20 c                   eval      s_kres = c2kres
      *
     c     c2tagb        tag
     c                   eval      werror = *zero
      *
     c                   exfmt     c2win
      *
      * Behandling av funksjonstaster
      *
     c                   select
     c                   when      *inkc or *inkl
     c                   eval      p_retu = '1'
     c                   goto      xslutt
     c                   when      *inkd = *on
     c                   exsr      spØrring
     c                   goto      c2tagb
7.01 c                   when      *inkh
7.01 c                   exsr      ekst_1881
7.01 c                   goto      c2tagb
7.01 c                   when      *inki
7.03 c                   exsr      ekst_bisnode
7.03 c                   goto      c2tagb
7.03 c                   endsl
      *
7.fb  * Viser ikke funksjonstastene før feilmeldinger i selve inntastingen
7.fb  * er ok, dvs. minst 1 enter.
      *
      * Call program for Besøksadresse
      *
     c                   if        *inke = *on
     c                   exsr      xe2win
     c                   goto      c2tagb
     c                   endif
5.31  *
5.31  * Call program for kontaktperson
5.31  *
5.31 c                   if        *inkg = *on
      *
5.31 c                   call      'RF210R'
5.31 c                   parm                    w_firm
5.31 c                   parm                    w_kund
5.31 c                   parm                    w_levr
      *
5.31 c                   goto      c2tagb
5.31 c                   endif
5.31  *
5.31  * Call program for kort
5.31  *
7.fb c                   if        *inkf = *on and
7.fb c                             *in50 = *on
      *
7.fb c                   eval      w_kpro = 0
7.fb c                   eval      w_vedl = '2'
7.fb c**                 call      'RF220R'
7.fb c                   call      'RF222R'
5.31 c                   parm                    w_firm
5.31 c                   parm                    w_kund
7.fb c                   parm                    w_kpro
      *
5.31 c                   goto      c2tagb
5.31 c                   endif
7.fb  *
7.fb  * Call program for Spesialavtale
7.fb  *
7.fb c                   if        *inkj = *on   and
7.fb c                             *in51 = *on
7.fb c                   exsr      xj2win
7.fb  *
7.fb c                   goto      c2tagb
7.fb c                   endif
      *
      * Kontroll av skjermbildet
5.42  *
5.42 c                   movel     c2tlfn        w_tlfn
5.42 c                   call      'RÅ950R'
5.42 c                   parm                    w_tlfn
     c                   movel     w_tlfn        c2tlfn
      *
5.42 c                   movel     c2mobn        w_tlfn
5.42 c                   call      'RÅ950R'
5.42 c                   parm                    w_tlfn
     c                   movel     w_tlfn        c2mobn
      *
8.01 c*                  movel     c2tlfx        w_tlfn
8.01 c*                  call      'RÅ950R'
8.01 c*                  parm                    w_tlfn
8.01 c*                  movel     w_tlfn        c2tlfx
      *
     c                   exsr      sjekk_input
      *
     c                   if        werror <> 0
     c                   goto      c2tagb
     c                   endif
      *
      * Dersom noen felt med tekst er endret,
      * sende bildet på nytt.
      *
     c                   if        c2ponr <> s_ponr or
     c                             c2dist <> s_dist or
     c                             c2katg <> s_katg or
6.20 c                             c2avde <> s_avde or
8.01 c                             c2kres <> s_kres
8.01 c*                            c2mobo <> s_mobo
     c                   eval      s_ponr = c2ponr
     c                   eval      s_dist = c2dist
     c                   eval      s_katg = c2katg
8.01 c*                  eval      s_mobo = c2mobo
6.20 c                   eval      s_avde = c2avde
6.20 c                   eval      s_kres = c2kres
     c                   goto      c2tagb
     c                   endif
      *
      * Kontroller kundenummer mot grenseverdier
      * hvis utfylt i bildet
      *
     c                   if        c2kund <> *zero
     c                   if        c2kund <= ra1hkt
     c                   eval      *in30 = *on                                  Error
     c                   goto      c2tagb
     c                   else
     c                   if        c2kund >= ra1hrs
     c                   eval      *in30 = *on                                  Error
     c                   goto      c2tagb
     c                   endif
     c                   endif
     c                   endif
6.20  *
6.20  * Kontroller kode for kreditt opp mot bruker
6.20  * og hvilke tilganger denne har.
6.20  *
6.20 c                   if        w_ko12 =  2 and
6.20 c                             c2kres <> 2
6.20 c                   eval      c2kres =  2                                  Error
6.20 c                   goto      c2tagb
6.20 c                   endif
      *
      * Konvertere alfafelt til store bokstaver
      *
     c                   exsr      konverter
      *
     c     rkunl1_key    chain     rkunlur                            60
      *
     c                   eval      rkalfa = c2alfa
8.04 c                   if        c2fnav <> '   '
8.04 c                   eval      rknavn = %trim(c2navn) + ', ' + %trim(c2fnav)
8.04 c                   else
8.04 c                   eval      rknavn = c2navn
8.04 c                   endif
     c                   eval      rkgate = c2gate
     c                   eval      rkadr2 = c2adr2
     c                   eval      rksted = c2sted
     c                   eval      rkponr = c2ponr
5.42  *
5.42 c                   movel     c2tlfn        w_tlfn
5.42 c                   call      'RÅ950R'
5.42 c                   parm                    w_tlfn
     c                   movel     w_tlfn        rktlfn
      *
5.42 c                   movel     c2mobn        w_tlfn
5.42 c                   call      'RÅ950R'
5.42 c                   parm                    w_tlfn
     c                   movel     w_tlfn        rkmobn
      *
8.01 c*                  movel     c2tlfx        w_tlfn
8.01 c                   call      'RÅ950R'
8.01 c                   parm                    w_tlfn
8.01 c                   movel     w_tlfn        rktlfx
      *
8.01 c*                  eval      rkbgir = c2bgir
3.31 c                   eval      rkftnr = c2ftnr
3.32 c                   eval      rkemal = c2emal
     c                   eval      rkkatg = c2katg
     c                   eval      rkdist = c2dist
6.20 c                   eval      rkavde = c2avde
6.20 c                   eval      rkkres = c2kres
6.22 c                   eval      rkbetb = s_betb
6.22 c                   eval      rkrabk = s_rabk
6.22 c                   eval      rkbetm = s_betm
7.02 c                   eval      rkkres = s_kres
      *
      * Hente standardverdier fra kundekategori
      *
     c                   if        w_3mfe = '1'
      *
     c                   eval      ra11l1_katg = c2katg
     c     ra11l1_key    chain     ra11l1
     c                   if        %found(ra11l1)
6.22 c                   if        rkbetb = 0
     c                   eval      rkbetb = rakbeb
6.22 c                   endif
6.22 c                   if        rkbetm = 0
     c                   eval      rkbetm = rakbem
6.22 c                   endif
     c                   eval      rkprpa = rakppa
     c                   eval      rkneto = raknto
     c                   eval      rksamf = raksam
     c                   eval      rksekv = raksek
     c                   eval      rkpbok = rakbok
     c                   endif
      *
     c                   eval      rkbgat = e2bgat
     c                   eval      rkbadr = e2badr
     c                   eval      rkbpnr = e2bpnr
     c                   eval      rkweba = e2weba
      *
     c                   endif
      *
      * Nullstille saldo og memosaldo
      *
     c                   eval      rksald = *zero
6.24 c                   eval      rksaif = *zero
6.24 c                   eval      rkkjØp = *zero
6.24 c                   eval      rkkjØf = *zero
6.24 c                   eval      rkkjal = *zero
6.24 c                   eval      rkpass = *blank
6.21 c**                 eval      rkmems = *zero
6.21 c**                 eval      rkmema = *zero
      *
     c                   if        *in60 = *on
     c                   eval      rkfirm = w_firm
     c                   eval      rkkund = rkunl1_kund
     c                   eval      p_lkun = rkunl1_kund
     c                   eval      p_navn = c2navn
     c                   eval      p_adr1 = c2gate
     c                   eval      p_adr2 = c2adr2
     c                   eval      p_sted = c2sted
     c                   eval      rknsig = l_user
     c                   eval      rkesig = l_user
     c                   time                    rkndat
     c                   time                    rkedat
     c                   time                    rkntim
     c                   time                    rketim
6.11 c                   time                    rk2dpt
6.11 c                   eval      rkepgm = 'FA930R    '
     c                   write     rkunlur
6.21  * Oppretter file med memosaldo informasjon
6.21 c     rkunl1_key    chain     rkmelur                            61
6.21 c                   if        *in61 = *on
6.21 c                   eval      rkfirm = w_firm
6.21 c                   eval      rkkund = rkunl1_kund
6.21 c                   eval      rkmems = *zeros
6.21 c                   eval      rkmema = *zeros
6.31 c                   eval      rkkjal = *zeros
6.21 c                   eval      rkmeus = l_user
6.21 c                   time                    rkmoda
6.21 c                   time                    rkmeda
6.21 c                   time                    rkmoti
6.21 c                   time                    rkmeti
6.21 c                   write     rkmelur
6.21 c                   endif
      *
      * Oppdatering av kunde-avtale-tekst
      *
     c                   if        s_spav = 1
     c                   eval      rksalu_saku = rkkund
     c     rksalu_key    chain     rksalur                            63
     c                   eval      rksat1 = s_sat1
     c                   eval      rksat2 = s_sat2
     c                   eval      rksat3 = s_sat3
      *
6.10 c                   time                    rkenda
6.10 c                   time                    rkenti
6.10 c                   eval      rkeusr = l_user
      *
     c                   if        *in63 = *off
     c                   update    rksalur
     c                   else
     c                   eval      rksaku = rkkund
     c                   eval      rksafi = w_firm
6.10 c                   time                    rkodat
6.10 c                   time                    rkotim
6.10 c                   eval      rkousr = l_user
     c                   write     rksalur
     c                   endif
     c                   endif
      *
      * Oppdatering av søketekst
      *
     c                   call      'RK750R'
     c                   parm                    w_firm
     c                   parm                    rkkund
      *
     c                   endif
      *
      * Utskrift av kundeinformasjon
      *
     c                   if        w_3kbr = 1
      *
     c                   eval      w_alin = 10
     c                   eval      w_acol = 5
     c                   exfmt     f2win
      *
     c                   if        f2valg = '1'
     c                   call      'RK644C'
     c                   parm                    rkkund
     c                   parm                    f2valg
     c                   parm                    f2mail
     c                   endif
      *
     c                   endif
      *
     c                   if        w_3kbr = 2
      *
     c                   call      'RK644C'
     c                   parm                    rkkund
     c                   parm                    f2valg
     c                   parm                    f2mail
      *
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xslutt        tag
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for spøring
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     spØrring      begsr
      *
      * Call program for poststed
      *
     c                   if        w_arcd = 'C2WIN'
     c                   if        w_afld = 'C2PONR'
     c                   call      'AF010R'
     c                   parm                    w_ponr
      *
     c                   eval      c2ponr = w_ponr
     c                   goto      end_spØrr
     c                   endif
     c                   endif
      *
      * Call program for distrikt
      *
     c                   if        w_arcd = 'C2WIN'
     c                   if        w_afld = 'C2DIST'
     c                   call      'RA508R'
     c                   parm                    p_firm
     c                   parm                    w_hkod
     c                   parm                    w_htxt
      *
     c                   eval      c2dist = w_hkod
     c                   eval      c2htxt = w_htxt
     c                   goto      end_spØrr
     c                   endif
     c                   endif
      *
      * Call program for kundekategori
      *
     c                   if        w_arcd = 'C2WIN'
     c                   if        w_afld = 'C2KATG'
     c                   call      'RA511R'
     c                   parm                    p_firm
     c                   parm                    w_kkod
     c                   parm                    w_ktxt
      *
     c                   eval      c2katg = w_kkod
     c                   eval      c2ktxt = w_ktxt
     c                   goto      end_spØrr
     c                   endif
     c                   endif
6.20  *
6.20  * Call program for avdeling
6.20  *
6.20 c                   if        w_arcd = 'C2WIN'
6.20 c                   if        w_afld = 'C2AVDE'
6.20 c                   call      'RA507R'
6.20 c                   parm                    p_firm
6.20 c                   parm                    w_gkod
6.20 c                   parm                    w_gtxt
6.20  *
6.20 c                   eval      c2avde = w_gkod
6.20 c                   eval      c2gtxt = w_gtxt
6.20 c                   goto      end_spØrr
6.20 c                   endif
6.20 c                   endif
8.01  *
8.01  * Call program for MOBILOPERATØR
8.01  *
8.01 c*                  if        w_arcd = 'C2WIN'
8.01 c*                  if        w_afld = 'C2MOBO'
8.01 c*                  call      'RA529R'
8.01 c*                  parm                    p_firm
8.01 c*                  parm                    w_mobo
8.01 c*                  parm                    w_mtxt
8.01  *
8.01 c*                  eval      c2mobo = w_mobo
8.01 c*                  eval      c2mtxt = w_mtxt
8.01 c*                  goto      end_spØrr
8.01 c*                  endif
8.01 c*                  endif
      *
     c     end_spØrr     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for konvertering av alfafelt til store bokstaver
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     konverter     begsr
      *
      * Konvertere alfafelt til store bokstaver
      *
     c                   if        c2alfa = *blank
     c                   movel     c2navn        c2alfa
     c                   endif
     c     lo:up         xlate     c2alfa        c2alfa
      *
      * Konvertere navn/adresse til store bokstaver,
      * hvis statuskode = 0
      *
     c                   if        w_1bkk = *zero
     c     lo:up         xlate     c2navn        c2navn
     c     lo:up         xlate     c2gate        c2gate
     c     lo:up         xlate     c2adr2        c2adr2
     c     lo:up         xlate     c2sted        c2sted
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Kontroll  C2 bilde
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_input   begsr
      *
7.fb c                   eval      *in31 = *off                                 Error
     c                   eval      *in49 = *off                                 Error
     c                   eval      *in65 = *off                                 Error
     c                   eval      *in66 = *off                                 Error
     c                   eval      *in67 = *off                                 Error
     c                   eval      *in68 = *off                                 Error
     c                   eval      *in69 = *off                                 Error
     c                   eval      *in70 = *off                                 Error
     c                   eval      *in71 = *off                                 Error
      *
      * Sjekke om navn er utfyllt
      *
     c                   if        c2navn = *blank
     c                   eval      *in31 = *on                                  Error
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
      * Krav til utfylling av standardfelter på kunde
      *
     c                   if        w_3mfe = '1'
      *
      * Sjekke om adresse er utfyllt
      *
     c                   if        c2gate = *blank
     c                   move      *on           *in65
     c                   move      *on           *in81
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
      * Sjekke om postnr./poststed er utfyllt
      *
8.05 c                   if        c2ponr = 0
8.05 c                   eval      *in66 = *on
8.05 c                   eval      *in81 = *on
8.05 c                   eval      werror = 1
8.05 c                   goto      end_sjekk
8.05 c                   endif
      *
      * Sjekke om postnummer er gyldig
      *
     c                   if        c2ponr <> *zero
     c                   eval      apospf_ponr = c2ponr
     c     apospf_key    chain     apospfr                            62
      *
     c                   if        *in62 = *on
     c                   eval      *in33 = *on                                  Error
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   else
     c                   eval      c2sted = *blank
     c                   movel     apponr        c2sted
     c                   move      apsted        c2sted
     c                   endif
     c                   endif
      *
      * Sjekke om kundekategori er utfyllt
      *
     c                   if        c2katg = *zeros
     c                   move      *on           *in71
     c                   move      *on           *in81
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
     c                   endif
      *
      * Sjekke om distrikt er gyldig
      *
     c                   if        c2dist <> *zero
     c                   eval      w_hkod = c2dist
     c                   call      'RS708R'                                      distrikt-
     c                   parm                    w_stat                           kode
     c                   parm                    w_hkod                           kode
     c                   parm                    w_htxt                           kode
     c                   if        w_stat = 'N'                                 Kode
     c                   eval      *in34 = *on                                  Error
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   else
     c                   eval      c2htxt = w_htxt
     c                   endif
     c                   endif
6.20  *
6.20  * Sjekke om avdeling er gyldig
6.20  *
7.fb c                   if        c2avde <> *zero or
7.fb c                             faak14 = 1
6.20 c                   eval      w_gkod = c2avde
6.20 c                   call      'RS707R'                                      distrikt-
6.20 c                   parm                    w_stat                           kode
6.20 c                   parm                    w_gkod                           kode
6.20 c                   parm                    w_gtxt                           kode
6.20 c                   if        w_stat = 'N'                                 Kode
6.33 c***                eval      *in34 = *on                                  Error
6.33 c                   eval      *in36 = *on                                  Error
6.20 c                   eval      werror = 1
6.20 c                   goto      end_sjekk
6.20 c                   else
6.20 c                   eval      c2gtxt = w_gtxt
6.20 c                   endif
6.20 c                   endif
      *
      * Sjekke om kundekategori er gyldig
      *
     c                   if        c2katg <> *zero
     c                   eval      w_kkod = c2katg
     c                   call      'RS711R'                                      kundekategori-
     c                   parm                    w_stat                           kode
     c                   parm                    w_kkod                           kode
     c                   parm                    w_ktxt                           kode
     c                   if        w_stat = 'N'                                 Kode
     c                   eval      *in35 = *on                                  Error
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   else
     c                   eval      c2ktxt = w_ktxt
     c                   endif
     c                   endif
      *
      * Sjekke om foretaksnummer finnes fra før
      *
     c                   if        c2ftnr <> *zeros
     c                   eval      rkunl4_ftnr = c2ftnr
     c     rkunl4_key    setll     rkunl4                                 63
     c     rkunl4_key    reade     rkunl4                                 63
     c                   dow       *in63 = *off
     c                   if        xkkund <> c2kund
     c                   eval      v2kund = xkkund
     c                   eval      v2navn = xknavn
      *
     c                   eval      w_alin = 6
     c                   eval      w_acol = 25
      *
     c                   exfmt     v2msg
      *
     c                   if        *inkc = *on
     c                   move      *on           *in48
     c                   move      *on           *in81
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
     c                   endif
     c     rkunl4_key    reade     rkunl4                                 63
     c                   enddo
      *
     c                   endif
      *
      * Sjekke om alfaindex finnes fra før på samme postnr.
      *
     c                   if        c2alfa <> *blank
     c                   eval      rkunl2_alfa = c2alfa
     c     rkunl2_key    setll     rkunl2                                 64
     c     rkunl2_key    reade     rkunl2                                 64
     c                   dow       *in64 = *off
     c                   if        xkalfa = c2alfa and
     c                             xkponr = c2ponr and
     c                             xkkund <> rkkund
     c                   eval      v2kund = xkkund
     c                   eval      v2navn = xknavn
      *
     c                   eval      w_alin = 6
     c                   eval      w_acol = 25
      *
     c                   exfmt     w2msg
      *
     c                   if        *inkc = *on
     c                   move      *on           *in81
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
     c                   endif
     c     rkunl2_key    reade     rkunl2                                 64
     c                   enddo
      *
     c                   endif
8.01  *
8.01  * Sjekke om bankgironummer finnes fra før
8.01  *
8.01 c*                  if        c2bgir <> *zeros
8.01 c*                  eval      rkunl7_bgir = c2bgir
8.01 c*    rkunl7_key    setll     rkunl7                                 63
8.01 c*    rkunl7_key    reade     rkunl7                                 63
8.01 c*                  dow       *in63 = *off
8.01 c*                  if        xkkund <> rkkund
8.01 c*                  eval      x2kund = xkkund
8.01 c*                  eval      x2navn = xknavn
8.01  *
8.01 c*                  eval      w_alin = 6
8.01 c*                  eval      w_acol = 25
8.01  *
8.01 c*                  exfmt     x2msg
8.01  *
8.01 c*                  if        *inkc = *on
8.01 c*                  move      *on           *in48
8.01 c*                  move      *on           *in81
8.01 c*                  eval      werror = 1
8.01 c*                  goto      end_sjekk
8.01 c*                  endif
8.01  *
8.01 c*                  endif
8.01 c*    rkunl7_key    reade     rkunl7                                 63
8.01 c*                  enddo
8.01  *
8.01 c*                  endif
      *
      * Sjekke om telefonnummer finnes fra før
      *
     c                   if        c2tlfn <> *blank
     c                   eval      rkunl8_tlfn = c2tlfn
     c     rkunl8_key    setll     rkunl8                                 63
     c     rkunl8_key    reade     rkunl8                                 63
     c                   dow       *in63 = *off
     c                   if        xkkund <> rkkund
     c                   eval      y2kund = xkkund
     c                   eval      y2navn = xknavn
      *
     c                   eval      w_alin = 6
     c                   eval      w_acol = 25
      *
     c                   exfmt     y2msg
      *
     c                   if        *inkc = *on
     c                   move      *on           *in48
     c                   move      *on           *in81
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
     c                   endif
     c     rkunl8_key    reade     rkunl8                                 63
     c                   enddo
      *
     c                   endif
      *
      * Sjekke om emailadresse finnes fra før
      *
     c                   if        c2emal <> *blank
     c                   eval      rkunl9_emal = c2emal
     c     rkunl9_key    setll     rkunl9                                 63
     c     rkunl9_key    reade     rkunl9                                 63
     c                   dow       *in63 = *off
     c                   if        xkkund <> rkkund
     c                   eval      z2kund = xkkund
     c                   eval      z2navn = xknavn
      *
     c                   eval      w_alin = 6
     c                   eval      w_acol = 25
      *
     c                   exfmt     z2msg
      *
     c                   if        *inkc = *on
     c                   move      *on           *in48
     c                   move      *on           *in81
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
     c                   endif
      *
     c     rkunl9_key    reade     rkunl9                                 63
     c                   enddo
     c                   endif
      *
      * Sjekke om mobiltelefonnummer finnes fra før
      *
     c                   if        c2mobn <> *blank
     c                   eval      rkunla_mobn = c2mobn
     c     rkunla_key    setll     rkunla                                 63
     c     rkunla_key    reade     rkunla                                 63
     c                   dow       *in63 = *off
     c                   if        xkkund <> rkkund
     c                   eval      s2kund = xkkund
     c                   eval      s2navn = xknavn
      *
     c                   eval      w_alin = 6
     c                   eval      w_acol = 25
      *
     c                   exfmt     s2msg
      *
     c                   if        *inkc = *on
     c                   move      *on           *in48
     c                   move      *on           *in81
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
     c                   endif
      *
     c     rkunla_key    reade     rkunla                                 63
     c                   enddo
      *
     c                   endif
      *
      * Krav til utfylling av standardfelter på kunde
      *
     c                   if        w_3mfe = '1'
      *
      * Hent inn kontrollfelt fra kundekategori
      *
     c                   eval      ra11l1_katg = c2katg
     c     ra11l1_key    chain     ra11l1
      *
      * Sjekke om foretaksnummer skal være utfylt
      *
     c                   if        rakorg = 'J' and
     c                             c2ftnr = *zeros
     c                   move      *on           *in49
     c                   move      *on           *in81
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
      * Sjekke om telefon/mobil er utfylt
      *
     c                   if        raktlf = 'J' and
6.32 c                             c2tlfn = *blank
6.32 c*                            c2mobn = *blank
     c                   move      *on           *in68
     c                   move      *on           *in81
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
6.32  * Sjekke om mobilnr.  er utfylt
      *
     c                   if        rakfax = 'J' and
6.32 c                             c2mobn = *blank
     c                   move      *on           *in69
     c                   move      *on           *in81
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
      * Sjekke om e-mail adresse er utfylt
      *
     c                   if        rakema = 'J' and
     c                             c2emal = *blank
     c                   move      *on           *in70
     c                   move      *on           *in81
     c                   eval      werror = 1
     c                   goto      end_sjekk
     c                   endif
      *
     c                   endif
      *
     c     end_sjekk     endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * E2WIN Behandle bilde for vedlikehold av besøksadresse           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xe2win        begsr
      *
     c     e2tagb        tag
      *
     c                   exfmt     e2win
      *
     c     *inkc         cabeq     *on           e2tag1
     c     *inkl         cabeq     *on           e2tag1
      *
      * Call program for post-sted
      *
     c                   if        *inkd = *on and
     c                             w_afld = 'E2BPNR'
     c                   call      'AF010R'
     c                   parm                    w_ponr
      *
     c                   if        w_ponr <> *zero
     c                   move      w_ponr        e2bpnr
     c                   endif
      *
     c                   goto      e2tagb
     c                   endif
      *
     c     e2tag1        tag
      *
     c                   endsr
      *
7.fb  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.fb  * J2WIN Behandle bilde for vedlikehold av avtalespesifikasjon     *
7.fb  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.fb  *
7.fb c     xj2win        begsr
7.fb  *
7.fb c                   eval      w_alin = 6
7.fb c                   eval      w_acol = 23
7.fb  *
7.fb c                   eval      rksal1_saku = w_kund
7.fb c     rksal1_key    chain     rksal1                             93
7.fb  *
7.fb c                   if        *in93 = *off
7.fb c                   eval      j2sat1 = rksat1
7.fb c                   eval      j2sat2 = rksat2
7.fb c                   eval      j2sat3 = rksat3
7.fb c                   else
7.fb c                   eval      j2sat1 = *blanks
7.fb c                   eval      j2sat2 = *blanks
7.fb c                   eval      j2sat3 = *blanks
7.fb c                   endif
7.fb  *
7.fb c                   exfmt     j2win
7.fb c                   if        *inkc = *on or
7.fb c                             *inkl = *on
7.fb c                   leavesr
7.fb c                   endif
7.fb  *
7.fb c                   eval      rksalu_saku = w_kund
7.fb c     rksalu_key    chain     rksalu                             93
7.fb  *
7.fb c                   if        j2sat2 = *blank
7.fb c                   eval      j2sat2 = j2sat3
7.fb c                   eval      j2sat3 = *blank
7.fb c                   endif
7.fb  *
7.fb c                   if        j2sat1 = *blank
7.fb c                   eval      j2sat1 = j2sat2
7.fb c                   eval      j2sat2 = *blank
7.fb c                   eval      j2sat2 = j2sat3
7.fb c                   eval      j2sat3 = *blank
7.fb c                   endif
7.fb  *
7.fb c                   eval      rksat1 = j2sat1
7.fb c                   eval      rksat2 = j2sat2
7.fb c                   eval      rksat3 = j2sat3
7.fb  *
7.fb c                   if        %found(rksalu)
7.fb  *
7.fb  * Tom record slettes og kode settes til 0
7.fb c                   if        rksat1 = *blank and
7.fb c                             rksat2 = *blank and
7.fb c                             rksat3 = *blank
7.fb c                   delete    rksalur
7.fb c                   eval      rkunl1_kund = w_kund
7.fb c     rkunl1_key    chain     rkunlur                            60
7.fb c                   if        %found
7.fb c                   eval      rkspav = *zero
7.fb c                   time                    rkedat
7.fb c                   time                    rketim
7.fb c                   eval      rkesig = l_user
7.fb c                   time                    rk2dpt
7.fb c                   eval      rkepgm = 'FA930R    '
7.fb c                   update    rkunlur
7.fb c                   endif
7.fb c                   goto      j2tag1
7.fb c                   endif
7.fb  *
7.fb c                   time                    rkenda
7.fb c                   time                    rkenti
7.fb c                   eval      rkeusr = l_user
7.fb c                   update    rksalur
7.fb c                   else
7.fb  *
7.fb  * Skriver ikke tom record
7.fb c                   if        rksat1 = *blank and
7.fb c                             rksat2 = *blank and
7.fb c                             rksat3 = *blank
7.fb c                   eval      rkunl1_kund = w_kund
7.fb c     rkunl1_key    chain     rkunlur                            60
7.fb c                   if        %found
7.fb c                   eval      rkspav = *zero
7.fb c                   time                    rkedat
7.fb c                   time                    rketim
7.fb c                   eval      rkesig = l_user
7.fb c                   time                    rk2dpt
7.fb c                   eval      rkepgm = 'FA930R    '
7.fb c                   update    rkunlur
7.fb c                   endif
7.fb c                   goto      j2tag1
7.fb c                   endif
7.fb  *
7.fb c                   eval      rksafi = w_firm
7.fb c                   eval      rksaku = w_kund
7.fb c                   time                    rkodat
7.fb c                   time                    rkotim
7.fb c                   eval      rkousr = l_user
7.fb c                   time                    rkenda
7.fb c                   time                    rkenti
7.fb c                   eval      rkeusr = l_user
7.fb c                   write     rksalur
7.fb c                   endif
7.fb  *
7.fb c     j2tag1        tag
7.fb  *
7.fb c                   endsr
7.fb  *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.01  * EKST_SOK  Subrutine for eksternt kundesøk
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.01  *
7.01 c     ekst_1881     begsr
7.01  *
7.01  * Søk på 1881
7.01  *
7.01 c                   if        u_1881 = *on
7.01 c                   eval      w_alin = 10
7.01 c                   eval      w_acol = 5
7.01 c                   exfmt     g2win
7.01 c     *inkc         cabeq     *on           end_1881
7.01 c     *inkl         cabeq     *on           end_1881
7.01  *
7.01 c                   eval      c2mobn = g2tlfn
7.01 c                   call      'FA933R'
7.01 c                   parm                    w_firm
7.01 c                   parm                    c2navn
7.01 c                   parm                    c2gate
7.01 c                   parm                    c2adr2
7.01 c                   parm                    c2sted
7.01 c                   parm                    c2mobn
7.01 c                   parm                    c2ponr
7.01 c                   parm                    c2ftnr
7.01 c                   eval      c2tlfn = c2mobn
7.01 c                   endif
7.01  *
7.01 c     end_1881      endsr
7.03  *
7.03  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.03  * Subrutiner for kundesøk i Bisnode og behandling av mottatt informasjon
7.03  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.03  *
7.03 c     ekst_bisnode  begsr
7.03  *
7.03  * Oppslag mot Bisnode
7.03  *
8.02 c                   if        u_bisn = *off
8.02 c                   goto      end_bisnode
8.02 c                   endif
7.03 c                   eval      w_alin = 10
7.03 c                   eval      w_acol = 5

8.02  /FREE
8.02
8.02  // Sjekker om bisnode parametre er satt i koderegister
8.02
8.02       exec sql
8.02       select rkktyp
8.02         into :w_type
8.02        from ra33st
8.02         where rkktyp = ' ';
8.02           if sqlcod = 100
8.02           or sqlcod = 100;
8.02             exfmt g3msg1;
8.02             leavesr;
8.02           endif;
8.02
8.02  // Sjekker om bisnode pivat skal brukes
8.02
8.02       exec sql
8.02       select rkktyp
8.02         into :w_type
8.02        from ra33st
8.02         where rkktyp = 'PRIVAT';
8.02           if sqlcod = 100;
8.02             *in63 = *on;
8.02            else;
8.02             *in63 = *off;
8.02           endif;
8.02  /END-FREE
7.03 c                   exfmt     g3win
7.03 c     *inkc         cabeq     *on           end_bisnode
7.03 c     *inkl         cabeq     *on           end_bisnode
7.03  *
7.03  * Call program for oppslag mot Bisnode firma
7.03  *
7.03 c                   if        g3fnum <> *blank
7.03 c                   call      'FA932R'
7.03 c                   parm                    g3fnum
7.03 c                   parm                    w_enav
7.03 c                   parm                    w_adr1
7.03 c                   parm                    w_adr2
7.03 c                   parm                    w_pnum
7.03 c                   parm                    w_pste
7.03 c                   parm                    w_tele
7.03 c                   parm                    w_mobi
7.03 c                   parm                    w_kgre
7.03 c                   parm                    w_rati
7.03  *
7.03 c                   eval      c2alfa = %trim(w_enav)
7.03 c                   eval      c2navn = w_enav
7.03 c                   eval      c2fnav = *blank
7.03 c                   eval      c2gate = w_adr1
7.03 c                   eval      c2adr2 = w_adr2
7.03 c                   eval      c2ponr = w_pnum
7.03 c                   eval      c2sted = w_pste
7.03 c                   eval      c2tlfn = w_tele
7.03 c                   eval      c2mobn = w_mobi
7.03  *
8.03 c                   if        w_kgre > 0
8.03 c                   eval      c2kres = 0
8.03 c                   eval      c2kgre = w_kgre
8.03 c                   else
8.03 c                   eval      c2kres = 2
8.03 c                   eval      c2kgre = 0
8.03 c                   endif
      *
7.03 c                   endif
7.03  *
7.03  * Call program for oppslag mot Bisnode privat
7.03  *
7.03 c                   if        g3pnum <> *blank
7.03 c                   call      'FA931R'
7.03 c                   parm                    g3pnum
7.03 c                   parm                    w_enav
7.03 c                   parm                    w_adr1
7.03 c                   parm                    w_adr2
7.03 c                   parm                    w_pnum
7.03 c                   parm                    w_pste
7.03 c                   parm                    w_tele
7.03 c                   parm                    w_mobi
7.03 c                   parm                    w_kgre
7.03 c                   parm                    w_fdat
7.03  *
7.03 c                   eval      c2alfa = %trim(w_enav) + ' ' +
7.03 c                                      %trim(w_fnav)
7.03 c                   eval      c2navn = w_enav
7.03 c                   eval      c2fnav = '  '
7.03 c                   eval      c2gate = w_adr1
7.03 c                   eval      c2adr2 = w_adr2
7.03 c                   eval      c2ponr = w_pnum
7.03 c                   eval      c2sted = w_pste
7.03 c                   eval      c2tlfn = w_tele
7.03 c                   eval      c2mobn = w_mobi
7.03 c                   if        w_kgre > 0
7.03 c                   eval      c2kres = 0
8.03 c                   eval      c2kgre = w_kgre
7.03 c                   else
7.03 c                   eval      c2kres = 2
8.03 c                   eval      c2kgre = 0
7.03 c                   endif
7.03 c                   endif
7.03  *
7.03 c     end_bisnode   endsr
7.03  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
     c                   eval      wactli = 2
7.fb c**                 eval      wactpo = 20
7.fb c                   eval      wactpo = 5
     c                   eval      werror = 0
      *
     c                   eval      f2valg = '1'
     c                   eval      f2mail = ' '
      *
      * Parameterliste
      *
     c     *entry        plist
     c                   parm                    p_retu
     c                   parm                    p_firm
     c                   parm                    p_navn
     c                   parm                    p_adr1
     c                   parm                    p_adr2
     c                   parm                    p_sted
     c                   parm                    p_lkun
7.01 c                   parm                    p_mobn
      *
      * Legge inn firmanummer
      *
     c                   eval      w_firm = p_firm
      *
      * Hent statuskode 1
      *
     c     raa1pf_key    chain     raa1pf                             61
      *
     c                   if        *in61 = *off
     c                   eval      w_1bkk = ra1bkk
     c                   else
     c                   eval      w_1bkk = 0
     c                   endif
      *
      * Key for kunderegister via kundenummer
      *
     c     rkunl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl1_kund
      *
      * Key for kunderegister via alfaindex
      *
     c     rkunl2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl2_alfa
      *
      * Key for kunderegister via foretaksnummer
      *
     c     rkunl4_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl4_ftnr
8.01  *
8.01  * Key for kunderegister via bankgironummer
8.01  *
8.01 c*    rkunl7_key    klist
8.01 c*                  kfld                    w_firm
8.01 c*                  kfld                    rkunl7_bgir
      *
      * Key for kunderegister via telefonnummer
      *
     c     rkunl8_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl8_tlfn
      *
      * Key for kunderegister via e-postadresse
      *
     c     rkunl9_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl9_emal
      *
      * Key for kunderegister via mobiltelefonnummer
      *
     c     rkunla_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunla_mobn
      *
      * Key for oppslag på avtale-register les
      *
     c     rksal1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rksal1_saku
      *
      * Key for oppslag på avtale-register update
      *
     c     rksalu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rksalu_saku
      *
      * Key for statuskode 1
      *
     c     raa1pf_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på kundekategori
      *
     c     ra11l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ra11l1_katg
      *
      * Key for postnummer-register
      *
     c     apospf_key    klist
     c                   kfld                    apospf_ponr
      *
      *  Key for file : OFAK-KODE-REGISTER
      *
     c     fstsl1_key    klist
     c                   kfld                    w_firm
6.20  *
6.20  * Key for oppslag på bruker tabell
6.20  *
6.20 c     fusrl1_key    klist
6.20 c                   kfld                    w_firm
6.20 c                   kfld                    fusrl1_user
      *
      * Key for oppslag på statuskode 3
      *
     c     raa3l1_key    klist
     c                   kfld                    w_firm
5.41  *
      *
      *  Hent opplysninger fra OFAK-KODE-REGISTER
      *
     c     fstsl1_key    chain     fstsl1r                            90
7.fb c     fstsl1_key    chain     fst2l1r                            90
      *
      * Henter dagens dato
      *
     c                   time                    w_udat_iso
     c     *iso0         move      w_udat_iso    w_udat_alf
     c                   move      w_udat_alf    w_udat
      *
      * Blank felt i eBilde
      *
     c                   eval      e2bgat = *blank
     c                   eval      e2badr = *blank
     c                   eval      e2bpnr = *zero
     c                   eval      e2weba = *blank
      *
     c                   eval      s_dist = 0
     c                   eval      s_katg = 0
     c                   eval      s_spav = 0
     c                   eval      s_sat1 = *blank
     c                   eval      s_sat2 = *blank
     c                   eval      s_sat3 = *blank
7.fb  *
7.fb  * Hent statuskode 13
7.fb  *
7.fb c                   if        faak13 = 1
7.fb c                   eval      *in50 = *on
7.fb c                   endif
7.fb c                   if        faak15 = 1
7.fb c                   eval      *in51 = *on
7.fb c                   endif
      *
      * Hent statuskode 3
      *
     c                   eval      w_3mfe = ' '
     c                   eval      w_3kbr = 0
      *
     c     raa3l1_key    chain     raa3l1
      *
     c                   if        %found(raa3l1)
     c                   eval      w_3mfe = ra3mfe
     c                   eval      w_3kbr = ra3kbr
     c                   endif
6.20  *
6.20  * Hent inn brukerregister
6.20  *
6.20 c                   eval      fusrl1_user = l_user
6.20  *
6.20 c     fusrl1_key    chain     fusrl1
6.20  *
6.20 c                   if        %found(fusrl1)
6.20 c                   eval      w_ko12 = fbko12
6.20 c                   else
6.20 c                   eval      w_ko12 = 0
6.20 c                   endif
7.01  *
7.01  * Eksternt kundesøk  - vrdi2 styrer type søk
7.01  *
7.01   CallP CO402R(l_filg:w_firm:0:'1881 - EKSTERNT_KUNDESØK':
7.01                   co402_verdi1:co402_verdi2);
7.01     if co402_verdi1 = '1';
7.01         u_1881 = *on;
7.01         *in61 = *on;
7.01     endif;

7.03   CallP CO402R(l_filg:w_firm:0:'BISNODE - EKSTERNT_KUNDESØK ':
7.03                   co402_verdi1:co402_verdi2);
7.03   if co402_verdi1 = '1';
7.03         u_bisn = *on;
7.03         *in62 = *on;
7.03   endif;
      *
     c                   endsr
