      /TITLE  Avkryssingsrutine kunder/leverandører
     h datedit(*dmy.) option(*nodebugio)
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RF107R                                              *
      * Beskrivelse . . : Avkryssing / saldering  kunder/leverandører         *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
      * V5.00     301102  Tidl. RF108R                                   KOB  *
      * V5.00     301102  Fjernet bruk av U4 for å styre oppdatering     KOB  *
      *                   rutinen kjøres nå bare ved journalkjøring      KOB  *
      * V5.10     230603  Lagt ut saldo på konto i skjermbildet          KOB  *
      * V5.10     280603  Lagt inn nye kontroller for å bedre dialogen   KOB  *
      *                   ved manuell avkryssing alle kunder/leverandørerKOB  *
      * V5.20     030703  Korrigert feil vedr. positiv kontantrabatt     KOB  *
      * V5.20     201003  Lagt ut samlefakturanr. i referansefeltet      KOB  *
      * V5.20     261003  Lagt ut test for å unngå at A/K-kode vises     KOB  *
      *                   når programmet kalles ved manuell avkryssing   KOB  *
      * V5.40     230305  Sjekker om kunde/lever. er avgiftsfrie-mvakode KOB  *
      * V5.40     020405  Fjernet feilkonti                              KOB  *
      * V5.40     100605  Lagt inn visning av lev.fakturanr. i tekstfelt KOB  *
      * V5.50     100707  Lagt inn samme for kreditnota                  KOB  *
      * V5.50     150807  Lagt inn visning av faktura fra avkryssing     KOB  *
      * V5.50     160807  Kan også føre differanse til omkostn.konto     KOB  *
      * V5.50     151007  Antall poster for avkryssing utvidet til 999.  HFL  *
6.11  * R6.10     250909  Lagt in n sporingsinformasjon.                 NHO  *
6.12  * R6.12     251109  Lagt inn avkrysningsref på kunde/leverandør    NHO  *
pdf   * R6.10     041010  Henter fra ASP arkiv. Mulighet for valg mellom BSA  *
pdf   *                   ASP og Multiarkiv gjøres i AP622C. Det finnes  BSA  *
pdf   *                   to varianter av dette programmet.              BSA  *
6.13  * R6.10     210711  Legger ut firmanummer i skjultfelt for         bsa  *
6.13  *                   spørring mot ASP-arkiv fra Jacada              bsa  *
6.20  * R6.20     281112  Legger Refnr.                                  nho  *
6.21  * R6.20     041212  Endret metode for oppslag mot arkiv            bsa  *
6.22  * R6.20     040113  Endret oppbygging av refn mot arkiv            bsa  *
6.23  * R6.20     220113  Tester på firma vedr. les av transaksjoner     nho  *
6.nu  * R6.20     150814  Endring pga utvidelse av felter                     *
6.30  * R6.20     190815  Byttet ut RKTRL2 med RKTRLD                    nho  *
6.30  * R6.20     190815  Byttet ut RLTRL2 med RLTRLG                    nho  *
6.31  * R6.30     130618  Utvidet avkryssing 9999                        nho  *
6.32  * R6.30     210618  Flere tabeller                                 nho  *
7.xx  * 7.00  020216 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
7.01  *           301116  Aut. kryssing ved innbet <> faktura                 *
7.02  *K00 sst 201204 NXS-____  Aut. kryssing også fra Shop vedr Forskuddsbet.
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *                                                                 *
      *  BRUK AV INDIKATORER                                            *
      *                                                                 *
      *       KC = F3  = Exit                                           *
      *       KE = F5  = Forny                                          *
      *       KL = F12 = Annuller                                       *
      *                                                                 *
      *       LR = Avslutt program                                      *
      *       10 = Roll                                                 *
      *       12 = Sfldsp                                               *
      *       13 = Sfldspctl                                            *
      *       14 = Sflclr                                               *
      *       15 = Sflend                                               *
      *       16 = Readc 16 on, no more records                         *
      *       30 = Protect av felter ved vise                           *
      *    31-59 = Varsle m/feilmeldinger/skjermindikatorer             *
      *    60-69 = Fileindikatorer chain etc.                           *
      *    70-79 = Arbeidsindikatorer i sub-rutiner                     *
      *    80-89 = Arbeidsindikatorer ordinære                          *
      *    90-99 = Benyttes ved std. sub-rutiner                        *
      *       94 = Kundereskontro                                       *
      *       95 = Leverandørreskontro                                  *
      *                                                                 *
      *    Bruke av felter som switcher:                                *
      *    -----------------------------                                *
      *    SWTCH1 = Dersom på, avkryssing er foretatt                   *
      *    SWTCH2 = Dersom på, avkryssing er ikke godkjent              *
      *    SWTCH3 = Dersom på, avkryssing for tilbakeføring restbeløp   *
      *    SWTCH4 = Dersom på, droppes kreditposter som ikke er krysset *
      *    SWTCH5 = Dersom på, automatisk saldert v/referansenummer     *
      *                                                                 *
      *                                                                 *
      *                                                                 *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
610  frjoupf    if   e           k disk    rename(rjoupfr:rjoupfr)
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
     frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
     frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
7.02 frktrl8    uf   e           k disk    rename(rktrpfr:rktrl8r)
7.02 frktrlc    uf   e           k disk    rename(rktrpfr:rktrlcr)
6.30 frktrld    if   e           k disk    rename(rktrpfr:rktrldr)
     frktrlu    uf   e           k disk    rename(rktrpfr:rktrlur)
6.30 f*rltrl2    if   e           k disk    rename(rltrpfr:rltrl2r)
6.30 frltrlg    if   e           k disk    rename(rltrpfr:rltrlgr)
     frltrlu    uf   e           k disk    rename(rltrpfr:rltrlur)
     frhovl1    if   e           k disk    rename(rhovpfr:rhovl1r)
     fraa1l1    if   e           k disk    rename(raa1pfr:raa1l1r)
     fraa3l1    if   e           k disk    rename(raa3pfr:raa3l1r)
     fra04l1    if   e           k disk    rename(ra04pfr:ra04l1r)
     frjoulu    uf a e           k disk    rename(rjoupfr:rjoulur)
     frf107d    cf   e             workstn
      *
      * ------------------------
      * Array's for meldinger
      * ------------------------
      *
E5.50d mld             s             70    dim(25) ctdata perrcd(1)
     d var             s             50    dim(10) ctdata perrcd(1)
      *
      * ------------------------
      * Array's for debet poster
      * ------------------------
      *
6.31 d*dtx             s             20    dim(999)
6.31 d*dbi             s              8  0 dim(999)
6.31 d*dfd             s               d   dim(999)
6.31 d*                                    datfmt(*iso)
6.31 d*dbe             s             11  2 dim(999)
6.31 d*dre             s             11  2 dim(999)
6.31 d*dvb             s             11  2 dim(999)
6.31 d*dvr             s             11  2 dim(999)
6.31 d*dvk             s              3    dim(999)
6.31 d*dsr             s              8  0 dim(999)
6.31 d*dky             s             45    dim(999)
6.31 d*dar             s              4  0 dim(999)
      *
6.31 d dtx             s             20    dim(9999)
6.31 d dbi             s              8  0 dim(9999)
6.31 d dfd             s               d   dim(9999)
6.31 d                                     datfmt(*iso)
6.31 d dbe             s             11  2 dim(9999)
6.31 d dre             s             11  2 dim(9999)
6.31 d dvb             s             11  2 dim(9999)
6.31 d dvr             s             11  2 dim(9999)
6.31 d dvk             s              3    dim(9999)
6.31 d dsr             s              8  0 dim(9999)
6.31 d dky             s             45    dim(9999)
6.31 d dar             s              4  0 dim(9999)
      *
      * -------------------------
      * Array's for kredit poster
      * -------------------------
      *
6.31 d*ktx             s             20    dim(999)
6.31 d*kbi             s              8  0 dim(999)
6.31 d*kfd             s               d   dim(999)
6.31 d*                                    datfmt(*iso)
6.31 d*kbe             s             11  2 dim(999)
6.31 d*kre             s             11  2 dim(999)
6.31 d*kvb             s             11  2 dim(999)
6.31 d*kvr             s             11  2 dim(999)
6.31 d*kvk             s              3    dim(999)
6.31 d*ksr             s              8  0 dim(999)
6.31 d*kky             s             45    dim(999)
6.31 d*kar             s              4  0 dim(999)
      *
6.31 d ktx             s             20    dim(9999)
6.31 d kbi             s              8  0 dim(9999)
6.31 d kfd             s               d   dim(9999)
6.31 d                                     datfmt(*iso)
6.31 d kbe             s             11  2 dim(9999)
6.31 d kre             s             11  2 dim(9999)
6.31 d kvb             s             11  2 dim(9999)
6.31 d kvr             s             11  2 dim(9999)
6.31 d kvk             s              3    dim(9999)
6.31 d ksr             s              8  0 dim(9999)
6.31 d kky             s             45    dim(9999)
6.31 d kar             s              4  0 dim(9999)
      *
      * -------------------------
      * Array's som er felles
      * -------------------------
      *
6.31 d*lin             s              3  0 dim(2000)
6.31 d*tix             s              3  0 dim(2000)
6.31 d*tdk             s              1    dim(2000)
6.31 d*tkr             s              1    dim(2000)
6.31 d*tky             s             45    dim(2000)
      *
6.31 d lin             s              4  0 dim(9000)
6.31 d tix             s              4  0 dim(9000)
6.31 d tdk             s              1    dim(9000)
6.31 d tkr             s              1    dim(9000)
6.31 d tky             s             45    dim(9000)
     d chk             s              1    dim(12)
      *
      *-----------------------
      * Data struktur
      *-----------------------
      *
     d                 ds
     d dppkey                        45
     d  dpfirm                        3  0 overlay(dppkey)
     d  dpkont                        6  0 overlay(dppkey:4)
     d  dpbdat                         d   overlay(dppkey:10)
     d  dptist                         z   overlay(dppkey:20)
      *
     d                 ds
     d djsort                  2     43
     d  djfirm                        3  0 overlay(djsort)
     d  djraar                        4  0 overlay(djsort:4)
     d  djrper                        2  0 overlay(djsort:8)
     d  djtype                        1  0 overlay(djsort:10)
     d  djbunt                        5  0 overlay(djsort:11)
     d  djlinj                        5  0 overlay(djsort:16)
     d  djsequ                        1    overlay(djsort:21)
6.NU d  djbiln                        8  0 overlay(djsort:22)
6.NU d  djbdat                         d   overlay(djsort:30)
6.NU d  djdbkr                        1    overlay(djsort:40)
      *
     d                uds
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
7.01 d l_filg                931    933
      *
      * Definering av variable
      *
E5.50d d               s              5  0
E5.50d k               s              5  0
6.32 d*l               s              2  0
6.32 d l               s              4  0
     d t               s              4  0
     d w               s              4  0
      *
     d sakont          s                   like(rnkund)
     d sfrn01          s                   like(srrn01)
     d spge01          s              3  0
     d srrn01          s              4  0
     d ssrn01          s                   like(srrn01)
     d swtch1          s              1  0
     d swtch2          s              1  0
     d swtch3          s              1  0
     d swtch4          s              1  0
     d swtch5          s              1  0
     d wantdb          s              4  0
     d wantkr          s              4  0
     d wdrest          s                   like(rnrest)
     d wkrest          s                   like(rnrest)
     d wrefdb          s                   like(rnrefn)
     d wrefkr          s                   like(rnrefn)
     d wsavet          s              4  0
     d wsrest          s                   like(rnrest)
     d wstest          s                   like(rnrest)
      *
     d wdatkr          s                   like(rnodat)
6.12  *
6.12 d p_aar           s                   like(rnraar)
6.12 d p_avkr          s                   like(rnavkr)
6.12 d p_spor          s                   like(rnspor)
7.01  *p_adra = J betyr at poster krysses aut selv om beløp < rest.
7.01  *           når postene kommer fra 'TELE'   (bank/Adra)
7.01 d p_adra          s              1    inz(' ')
      *
     d p_call          s              1  0
     d p_firm          s                   like(rnfirm)
     d p_knav          s                   like(rknavn)
     d p_kont          s                   like(rnkund)
     d p_kund          s                   like(rnkund)
     d p_levr          s                   like(rnkund)
     d p_lnav          s                   like(rlnavn)
      *
pdf50d*w_modu          s             10    inz('MSA     ')
pdf  d w_modu          s             10    inz('PROA    ')
T5.50d w_disp          s              1    inz('1')
T5.50d w_tilg          s              1
T5.50d w_path          s             50
T5.50d w_kund          s                   like(rnkund)
T5.50d w_biln          s                   like(rnbiln)
T5.50d w_aar2          s              2  0
T5.50d w_raar          s                   like(rnraar)
610  d w_tell          s              1  0
6.21 d w_type          s             50
6.21 d w_refn          s             50
      *
T5.50 * Definering av parametre MultiArcive
      *
T5.50d w_pgrp          s              2
T5.50d w_afir          s              3
T5.50d w_aara          s              4
T5.50d w_bila          s              6
      *
     d dsbdat          s               d   datfmt(*iso)
     d w_firm          s                   like(rnfirm)
     d w_bdat          s                   like(rnbdat)
     d w_fnav          s                   like(l_fnav)
     d w_kont          s                   like(rnkund)
     d w_mvak          s                   like(rhmvak)
610  d w_nivo          s                   like(rjnivo)
610  d w_memb          s                   like(rjmemb)
610  d w_mem1          s                   like(rjmemb)
     d w_sort          s                   like(rjsort)
     d w_tist          s                   like(rntist)
7.02 d w_saldo         s             15  2
7.02 d w_nkund         s                   like(rnkund)
      *
     d rhovl1_kont     s                   like(rhkont)
     d rhovl1_spes     s                   like(rhspes)
     d rhovl1_avde     s                   like(rhavde)
      *
     d rktrl8_kund     s                   like(rnkund)
     d rktrl8_biln     s                   like(rnbiln)
      *
     d x               s              4  0
     d xfodre          s                   like(rnrest)
     d xfodvr          s                   like(rnrest)
     d xfokre          s                   like(rnrest)
     d xfokvr          s                   like(rnrest)
     d xfores          s                   like(rnrest)
     d xforev          s                   like(rnrest)
     d xfosum          s                   like(rnrest)
     d xfosuv          s                   like(rnrest)
     d x1valg          s              1
      *
     d a5pdeb_gml      s                   like(a5pdeb)
      *
7.xx  *
7.xx  * Definering av konstanter
7.xx  *
7.xx d lo              c                   'abcdefghijklmnopqrstuvwxyzæøå'
7.xx d up              c                   'ABCDEFGHIJKLMNOPQRSTUVWXYZÆØÅ'
      /eject
7.01  *
7.01 d u_s701          s              1    inz(*off)                            Avvik innbetaling
7.02 d u_Null_Bilag_S  s              1    inz(*off)                            Nulle bilag fra shop
7.01  *
7.01  * Definering av eksterne prg
7.01  *
7.01   dcl-s co402_verdi1  char(1);
7.01   dcl-s co402_verdi2  char(2048);
7.01   DCL-PR CO402R EXTPGM('CO402R');
7.01     p_filgrp            char(3)     const;
7.01     p_firm              packed(3:0) const;
7.01     p_lager             packed(2:0) const;
7.01     p_nokkel            char(50)    const;
7.01     p_verdi1            char(1);
7.01     p_verdi2            char(2048);
7.01   END-PR;
7.01  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Definering av felter                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      *     nn - er 01 for subfile 01,
      *             02 for subfile 02,
      *             03 for subfile 03, o.s.v.
      * SRRNnn - Relativt recordnummer i subfile
      * SPGEnn - Sidestørrelse i subfile (page)
      * SFRNnn - Første recordnummer på siden
      * SSRNnn - Siste  recordnummer på siden
      * SVRNnn - Vis den side som inneholder denne record.
      *
      * Forklaring på spesielle felter
      * som benyttes ved windows.
      * - - - - - - - - - - - - - - - - -
      *
      * W_AROW - Actual line, angir startlinje for vindu.
      * W_ACOL - Actual posision, angir startposisjon for vindu.
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      *
      * A2BLD  - A2 Skjermbilde for ny konto
      * A5BLD  - A5 Skjermbilde for avkryssing
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * A2BLD Skjermbilde for ny konto                                  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     a2taga        tag
      *
     c                   eval      swtch3 = *zero
     c                   eval      a5info = *blank
      *
      * Gå til A2TAGF dersom transaksjonsfile skal behandles.
      *
     c     p_call        cabeq     1             a2tagf
      *
      * Gå til A2TAGF dersom avkryssing av åpne poster
      *
     c     p_call        cabeq     2             a2tagx
      *
      * Legge ut A2BLD
      *
     c     a2tagb        tag
      *
     c                   exfmt     a2bld
      *
      * Avslutte program
      *
     c     *inkc         cabeq     *on           xslutt
      *
      * Call program for konto
      *
     c                   if        *inkd = *on and
     c                             w_afld = 'A2KONT'
      *
      * Vindu for valg av kontotype
      *
     c                   exsr      xx1win
      *
     c     x1valg        cabeq     *blank        a2tagb
      *
      * Call kunder
      *
     c                   if        x1valg = '1'
     c                   call      'RK500R'
     c                   parm                    p_firm
     c                   parm                    p_kund
     c                   parm                    p_knav
      *
     c                   move      p_kund        a2kont
     c                   goto      a2tagb
     c                   endif
      *
      * Call leverandører
      *
     c                   if        x1valg = '2'
     c                   call      'RL500R'
     c                   parm                    p_firm
     c                   parm                    p_levr
     c                   parm                    p_lnav
      *
     c                   move      p_levr        a2kont
     c                   goto      a2tagb
     c                   endif
      *
     c                   endif
      *
      * Legge ut A2BLD
      *
     c     a2tagx        tag
      *
      * Sjekke om konto, er det kunde eller leverandør
      *
     c                   move      *off          *in94
     c                   move      *off          *in95
      *
     c                   if        a2kont > ra1hkt and
     c                             a2kont < ra1hrs
     c                   move      *on           *in94
     c                   endif
      *
     c                   if        a2kont > ra1hrs
     c                   move      *on           *in95
     c                   endif
      *
      * Funksjon som overfører opprinnelig beløp til
      * restbeløp på den konto som står i bildet
      *
     c                   if        *inkm = *on
     c                   exsr      xr1win
      *
     c     r1hele        cabeq     'A'           a2tage
      *
     c                   move      '1'           swtch3
      *
     c     r1hele        cabeq     'N'           a2tagf
      *
     c                   move      a2kont        w_kont
     c                   eval      w_bdat = *loval
     c                   eval      w_tist = *loval
      *
      * Kundeposteringer
      *
     c                   if        *in94 = *on
      *
     c     rktrlx_key    setll     rktrlu
     c                   read      rktrlu                                 15
      *
     c                   dow       rnkund = a2kont
      *
     c     *in15         cabeq     *on           a2tage
      *
     c                   if        rnfirm <> w_firm
     c                   goto      a2tage
     c                   endif
      *
     c                   move      rnbelØ        rnrest
     c                   move      rnvalb        rnvalr
      *
     c                   if        r1refr = 'J'
     c                   eval      rnrefn = *zero
     c                   endif
      *
6.11 c                   time                    rnedat
6.11 c                   time                    rnetim
6.11 c                   eval      rneusr = l_user
     c                   update    rktrlur
      *
     c                   read      rktrlu                                 15
     c                   enddo
     c                   endif
      *
      * Leverandørposteringer
      *
     c                   if        *in95 = *on
     c     rltrlx_key    setll     rltrlu
     c                   read      rltrlu                                 15
      *
     c                   dow       rolevr = a2kont
      *
     c     *in15         cabeq     *on           a2tage
      *
     c                   if        rofirm <> w_firm
     c                   goto      a2tage
     c                   endif
      *
     c                   move      robelØ        rorest
     c                   move      rovalb        rovalr
      *
     c                   if        r1refr = 'J'
     c                   eval      rorefn = *zero
     c                   endif
      *
6.11 c                   time                    roedat
6.11 c                   time                    roetim
6.11 c                   eval      roeusr = l_user
     c                   update    rltrlur
     c                   read      rltrlu                                 15
     c                   enddo
     c                   endif
      *
     c                   eval      swtch3 = *zero
      *
     c     a2tage        tag
      *
     c                   goto      a2taga
      *
     c                   endif
      *
     c     a2tagf        tag
      *
      * Søke opp transaksjon for avkryssing dersom journalkjøring.
      *
     c     p_call        caseq     1             xtrans
     c                   endcs
      *
      * Ingen flere poster (EOF.)
      *
     c     p_call        cabeq     9             xslutt
      *
      * Dersom referansenummer er oppgitt, forsøkes det med
      * automatisk saldering.
      *
     c                   eval      swtch5 = 0
     c     rjrefn        casne     *zero         xsaldr
     c                   endcs
      *
      * Saldering utført, les neste postering
      *
     c     swtch5        cabeq     1             a2taga
      *
      * Hente Kunde/Leverandør
      *
     c                   move      a2kont        w_kont
     c                   eval      a5navn = *blank
      *
     c                   if        *in94 = *on
     c     rkunl1_key    chain     rkunl1r                            61
     c                   movel     rknavn        a5navn
     c                   eval      a5sald = rksald
     c                   endif
      *
     c                   if        *in95 = *on
     c     rlevl1_key    chain     rlevl1r                            61
     c                   movel     rlnavn        a5navn
     c                   eval      a5sald = rlsald
     c                   endif
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * A5BLD Skjermbilde for avkryssing                                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     a5taga        tag
      *
     c                   eval      tdk = *blank
     c                   eval      tkr = *blank
     c                   eval      tky = *blank
     c                   eval      tix = *zero
     c                   eval      a5pdeb = *zero
     c                   eval      a5pkre = *zero
     c                   eval      a5pdif = *zero
     c                   eval      swtch4 = *zero
     c                   eval      t = *zero
      *
      * Oppdatering fra avkryssingsfile
      *
     c                   if        b0rest > *zero
     c                   eval      a5pdeb = a5pdeb + b0rest
     c                   else
     c                   eval      a5pkre = a5pkre + b0rest
     c                   endif
      *
     c                   eval      a5pdif = a5pdeb + a5pkre
      *
     c                   move      a2kont        w_kont
     c                   eval      w_bdat = *loval
     c                   eval      w_tist = *loval
      *
     c                   if        swtch3 = 1
     c     *dmy          move      r1fdat        w_bdat
     c                   endif
      *
     c                   if        *in94 = *on
6.30 c*    rktrlx_key    setll     rktrl2
6.30 c     rktrlx_key    setll     rktrld
     c                   endif
      *
     c                   if        *in95 = *on
6.30 c*    rltrlx_key    setll     rltrl2
6.30 c     rltrlx_key    setll     rltrlg
     c                   endif
      *
     c                   exsr      xcrt01
     c                   exsr      xclr01
     c                   exsr      xmov01
      *
     c     a5tagb        tag
      *
     c                   if        swtch4 = 1
     c                   exsr      xclr01
     c                   exsr      xmov01
     c                   endif
      *
     c     a5tagc        tag
      *
     c                   exfmt     a5bld
     c                   eval      a5meld = *blank
      *
      * Bla framover
      *
     c                   if        *in10 = *on
      *
     c                   if        l < 12
     c                   move      mld(2)        a5meld
     c                   goto      a5tagc
     c                   endif
      *
     c                   exsr      xclr01
     c                   exsr      xrollf
     c                   goto      a5tagc
     c                   endif
      *
      * Bla bakover
      *
     c                   if        *in11 = *on
      *
     c                   if        wsavet <= 12
     c                   move      mld(1)        a5meld
     c                   goto      a5tagc
     c                   endif
      *
     c                   exsr      xclr01
     c                   exsr      xrollb
     c                   goto      a5tagc
     c                   endif
      *
      * Gå tilbake
      *
     c                   if        p_call = 0 and
     c                             *inkc = *on
     c                   goto      a2taga
     c                   endif
      *
     c                   if        p_call = 1 and
     c                             *inkc = *on
     c                   goto      a2taga
     c                   endif
      *
      * Avslutt
      *
     c                   if        p_call = 2 and
     c                             *inkc = *on
     c                   goto      xslutt
     c                   endif
      *
      * Automatisk godkjenning ved andre enter
      *
     c                   if        a5pdif = 0 and
     c                             a5pdeb <> 0 and
     c                             a5pdeb = a5pdeb_gml
     c                   eval      *inka  = *on
     c                   endif
      *
      * Godkjenn avkryssing
      *
     c                   if        *inka = *on
     c                   exsr      xgodkj
      *
     c                   if        swtch2 = 1
     c                   goto      a5tagc
     c                   endif
      *
     c                   if        swtch3 = 0
     c                   goto      e1taga
     c                   endif
      *
     c                   if        swtch3 = 1
     c                   goto      e2taga
     c                   endif
      *
     c                   endif
      *
      * Velg avkryssingsmetode
      *
     c     *inkf         cabeq     *on           f1taga
      *
      * Skifte mellom norske kroner og valuta
      *
     c                   if        *inkj = *on
      *
     c                   if        *in92 = *on
     c                   move      *on           *in91
     c                   move      *off          *in92
     c                   movel     mld(4)        a5f010
     c                   movel     mld(5)        a5hed1
     c                   movel     mld(6)        a5hed2
     c                   else
      *
     c                   move      *off          *in91
     c                   move      *on           *in92
     c                   movel     mld(3)        a5f010
     c                   movel     mld(7)        a5hed1
     c                   movel     mld(8)        a5hed2
     c                   endif
      *
     c                   if        swtch3 = 1
     c                   if        *in91 = *on
     c                   movel     mld(6)        a5hed1
     c                   movel     mld(5)        a5hed2
     c                   endif
     c                   endif
      *
     c                   if        swtch3 = 1
     c                   if        *in92 = *on
     c                   movel     mld(8)        a5hed1
     c                   movel     mld(7)        a5hed2
     c                   endif
     c                   endif
      *
     c                   goto      a5tagc
     c                   endif
7.xx  *
7.xx  * Pga potensiell små bokstaver ved input fra web, konverteres disse tiol store bokstaver
7.xx  *
7.xx c     lo:up         xlate     b1akry        b1akry
7.xx c     lo:up         xlate     b2akry        b2akry
7.xx c     lo:up         xlate     b3akry        b3akry
7.xx c     lo:up         xlate     b4akry        b4akry
7.xx c     lo:up         xlate     b5akry        b5akry
7.xx c     lo:up         xlate     b6akry        b6akry
7.xx c     lo:up         xlate     c1akry        c1akry
7.xx c     lo:up         xlate     c2akry        c2akry
7.xx c     lo:up         xlate     c3akry        c3akry
7.xx c     lo:up         xlate     c4akry        c4akry
7.xx c     lo:up         xlate     c5akry        c5akry
7.xx c     lo:up         xlate     c6akry        c6akry
      *
      * Sjekke om avkryssing er gyldig, X eller S
      *
     c                   move      b1akry        chk(1)
     c                   move      b2akry        chk(2)
     c                   move      b3akry        chk(3)
     c                   move      b4akry        chk(4)
     c                   move      b5akry        chk(5)
     c                   move      b6akry        chk(6)
     c                   move      c1akry        chk(7)
     c                   move      c2akry        chk(8)
     c                   move      c3akry        chk(9)
     c                   move      c4akry        chk(10)
     c                   move      c5akry        chk(11)
     c                   move      c6akry        chk(12)
      *
     c     1             do        12            w
     c                   if        chk(w) = *blank
     c                   iter
     c                   endif
      *
     c                   if        chk(w) <> 'X' and
     c                             chk(w) <> 'S' and
E5.50c                             chk(w) <> 'R' and
T5.50c                             chk(w) <> '8' and
T5.50c                             chk(w) <> '9'
     c                   movel     mld(24)       a5meld
     c                   endif
      *
T5.50 * Vis faktura/arkiv
      *
T5.50c                   if        chk(w) = '8' or
T5.50c                             chk(w) = '9'
T5.50c                   exsr      xvisfa
      *
T5.50 * Blank avkryssningsfelt
T5.50 *
T5.50c                   select
T5.50c                   when      w = 1
T5.50c                   eval      b1akry = ' '
T5.50c                   when      w = 2
T5.50c                   eval      b2akry = ' '
T5.50c                   when      w = 3
T5.50c                   eval      b3akry = ' '
T5.50c                   when      w = 4
T5.50c                   eval      b4akry = ' '
T5.50c                   when      w = 5
T5.50c                   eval      b5akry = ' '
T5.50c                   when      w = 6
T5.50c                   eval      b6akry = ' '
T5.50c                   when      w = 7
T5.50c                   eval      c1akry = ' '
T5.50c                   when      w = 8
T5.50c                   eval      c2akry = ' '
T5.50c                   when      w = 9
T5.50c                   eval      c3akry = ' '
T5.50c                   when      w = 10
T5.50c                   eval      c4akry = ' '
T5.50c                   when      w = 11
T5.50c                   eval      c5akry = ' '
T5.50c                   when      w = 12
T5.50c                   eval      c6akry = ' '
T5.50c                   endsl
T5.50 *
T5.50c                   eval      chk(w) = ' '

T5.50c                   endif
     c                   enddo
      *
     c                   if        a5meld <> *blank
     c                   goto      a5tagc
     c                   endif
      *
      * Sjekke om avkryssing er foretatt
      *
     c                   if        b1linj > *zero
     c                   move      b1linj        w
     c                   move      b1akry        tkr(w)
     c                   endif
      *
     c                   if        b2linj > *zero
     c                   move      b2linj        w
     c                   move      b2akry        tkr(w)
     c                   endif
      *
     c                   if        b3linj > *zero
     c                   move      b3linj        w
     c                   move      b3akry        tkr(w)
     c                   endif
      *
     c                   if        b4linj > *zero
     c                   move      b4linj        w
     c                   move      b4akry        tkr(w)
     c                   endif
      *
     c                   if        b5linj > *zero
     c                   move      b5linj        w
     c                   move      b5akry        tkr(w)
     c                   endif
      *
     c                   if        b6linj > *zero
     c                   move      b6linj        w
     c                   move      b6akry        tkr(w)
     c                   endif
      *
     c                   if        c1linj > *zero
     c                   move      c1linj        w
     c                   move      c1akry        tkr(w)
     c                   endif
      *
     c                   if        c2linj > *zero
     c                   move      c2linj        w
     c                   move      c2akry        tkr(w)
     c                   endif
      *
     c                   if        c3linj > *zero
     c                   move      c3linj        w
     c                   move      c3akry        tkr(w)
     c                   endif
      *
     c                   if        c4linj > *zero
     c                   move      c4linj        w
     c                   move      c4akry        tkr(w)
     c                   endif
      *
     c                   if        c5linj > *zero
     c                   move      c5linj        w
     c                   move      c5akry        tkr(w)
     c                   endif
      *
     c                   if        c6linj > *zero
     c                   move      c6linj        w
     c                   move      c6akry        tkr(w)
     c                   endif
      *
      * Ajourføre debet og kredit i bildet
      *
     c                   eval      a5pdeb = 0
     c                   eval      a5pkre = 0
     c                   eval      a5pdif = 0
     c                   eval      swtch4 = 0
      *
6.32 c*    1             do        2000          w
6.32 c     1             do        8000          w
      *
     c                   if        tdk(w) = *blank
     c                   leave
     c                   endif
      *
     c                   if        tkr(w) <> *blank
      *
     c   94              if        tdk(w) = 'K'
     c                   move      tix(w)        k
     c                   eval      a5pkre = a5pkre + kre(k)
     c                   move      1             swtch4
     c                   endif
      *
     c   95              if        tdk(w) = 'D'
     c                   move      tix(w)        d
     c                   eval      a5pdeb = a5pdeb + dre(d)
     c                   move      1             swtch4
     c                   endif
      *
     c                   endif
      *
     c                   if        tkr(w) = 'S'
     c                   exsr      xscann
     c                   endif
      *
     c                   if        tkr(w) <> *blank
      *
     c   94              if        tdk(w) = 'D'
     c                   move      tix(w)        d
     c                   eval      a5pdeb = a5pdeb + dre(d)
     c                   endif
      *
     c   95              if        tdk(w) = 'K'
     c                   move      tix(w)        k
     c                   eval      a5pkre = a5pkre + kre(k)
     c                   endif
      *
     c                   endif
      *
     c                   enddo
      *
      * Oppdatering fra avkryssingsfile
      *
     c                   if        b0rest > *zero
     c                   eval      a5pdeb = a5pdeb + b0rest
     c                   else
     c                   eval      a5pkre = a5pkre + b0rest
     c                   endif
      *
     c                   eval      a5pdif = a5pdeb + a5pkre
      *
     c                   if        b1linj > *zero
     c                   move      b1linj        w
      *
     c   94              if        tdk(w) = 'D'
     c                   goto      a5tagc
     c                   endif
      *
     c   95              if        tdk(w) = 'K'
     c                   goto      a5tagc
     c                   endif
      *
     c                   endif
      *
      * Ta vare på verdier for sammenligning
      *
     c                   eval      a5pdeb_gml = a5pdeb
      *
     c                   goto      a5tagb
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * E1WIN Godkjenne ved avkryssing                                  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     e1taga        tag
      *
     c                   eval      e1txt1 = *blank
     c                   eval      e1txt2 = *blank
     c                   eval      e1txt3 = *blank
     c                   eval      e1txt4 = *blank
     c                   eval      e1kode = *blank
     c                   eval      e1linj = *zero
     c                   move      *on           *in29
     c                   move      *on           *in30
      *
      * Varsle ved differanse, oppgi referansenummer
      *
     c                   if        a5pdif > *zero
     c                   movel     mld(12)       e1txt1
     c                   movel     mld(13)       e1txt2
     c                   move      *off          *in29
     c                   move      *off          *in30
     c                   endif
      *
     c                   if        a5pdif < *zero
     c                   movel     mld(12)       e1txt1
     c                   movel     mld(14)       e1txt2
     c                   move      *off          *in29
     c                   move      *off          *in30
     c                   endif
      *
     c                   if        a5pdif <> *zero
     c                   movel     mld(17)       e1txt3
     c                   movel     mld(18)       e1txt4
     c                   endif
      *
     c                   if        a5pdif = *zero
     c                   movel     mld(15)       e1txt1
     c                   movel     mld(16)       e1txt2
     c                   move      *on           *in29
     c                   move      *on           *in30
     c                   endif
      *
     c                   if        p_call = 0 or
     c                             p_call = 2
     c                   eval      e1txt3 = *blank
     c                   eval      e1txt4 = *blank
     c                   move      *on           *in30
     c                   endif
      *
      * Legge ut E1WIN
      *
     c                   eval      w_arow = 4
     c                   eval      w_acol = 2
      *
     c     e1tagb        tag
      *
     c                   exfmt     e1win
      *
      * Gå tilbake
      *
     c     *inkc         cabeq     *on           a5tagc
      *
      * Kontroll av referansenummer
      *
     c                   if        a5pdif <> *zero
     c                   if        e1kode = *blank
      *
      * Referanse er ikke oppgitt
      *
     c                   if        e1linj = *zero
     c                   move      *on           *in31
     c                   goto      e1tagb
     c                   endif
      *
     c                   move      e1linj        w
      *
      * Referanse på linje som ikke er krysset
      *
     c                   if        tkr(w) = *blank
     c                   move      *on           *in32
     c                   goto      e1tagb
     c                   endif
      *
      * Referanse må settes på debet-post
      *
     c                   if        a5pdif > *zero and
     c                             tdk(w) = 'K'
     c                   move      *on           *in33
     c                   goto      e1tagb
     c                   endif
      *
      * Referanse må settes på kredit-post
      *
     c                   if        a5pdif < *zero and
     c                             tdk(w) = 'D'
     c                   move      *on           *in34
     c                   goto      e1tagb
     c                   endif
      *
     c                   move      tix(w)        d
      *
      * Differanse er større enn restbeløp
      *
     c                   if        a5pdif > *zero and
     c                             a5pdif > dre(d)
     c                   move      *on           *in35
     c                   goto      e1tagb
     c                   endif
      *
     c                   move      tix(w)        k
      *
      * Differanse er større enn restbeløp
      *
     c                   if        a5pdif < *zero and
     c                             a5pdif < kre(k)
     c                   move      *on           *in35
     c                   goto      e1tagb
     c                   endif
      *
      * Ta vare på nytt debet restbeløp
      *
     c                   if        a5pdif > *zero
     c                   eval      wdrest = a5pdif
     c                   endif
      *
      * Ta vare på nytt kredit restbeløp
      *
     c                   if        a5pdif < *zero
     c                   eval      wkrest = a5pdif
     c                   endif
      *
     c                   endif
     c                   endif
      *
      * Kontroll av oppgitt kode
      *
     c                   if        e1kode <> *blank and
     c                             e1kode <> 'A' and
T5.50c                             e1kode <> 'O' and
     c                             e1kode <> 'K'
     c                   move      *on           *in36
     c                   goto      e1tagb
     c                   endif
      *
      * Er det oppgitt både kode og referansenr.
      *
     c                   if        e1kode <> *blank and
     c                             e1linj <> *zero
     c                   move      *on           *in37
     c                   goto      e1tagb
     c                   endif
      *
      * Nullstilling av restbeløp, samt oppdatering av
      * referanser dersom det er valgt.
      *
6.32 c*    1             do        2000          w
6.32 c     1             do        8000          w
      *
     c                   if        tkr(w) <> *blank
     c                   move      tky(w)        dppkey
     c                   move      dpkont        w_kont
     c                   move      dpbdat        w_bdat
     c                   move      dptist        w_tist
      *
     c                   if        *in94 = *on
     c     rktrlx_key    chain     rktrlur                            60
     c                   endif
      *
     c                   if        *in95 = *on
     c     rltrlx_key    chain     rltrlur                            60
     c                   endif
      *
     c     *in60         cabeq     *on           e1tagc
      *
     c                   if        *in90 = *on
      *
     c                   if        tdk(w) = 'D'
     c                   if        *in94 = *on
     c                   move      wrefkr        rnrefn
      *
     c                   if        wdatkr > rnodat
     c                   move      wdatkr        rnodat
     c                   endif
      *
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      wrefkr        rorefn
     c                   endif
     c                   endif
      *
     c                   if        tdk(w) = 'K'
     c                   if        *in94 = *on
     c                   move      wrefdb        rnrefn
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      wrefdb        rorefn
     c                   endif
     c                   endif
      *
     c                   endif
      *
     c                   if        *in94 = *on
     c                   eval      rnrest = *zero
     c                   eval      rnvalr = *zero
      *
     c                   if        rjbdat > rnodat
     c                   eval      rnodat = rjbdat
     c                   endif
      *
6.11 c                   time                    rnedat
6.11 c                   time                    rnetim
6.11 c                   eval      rneusr = l_user
     c                   update    rktrlur
     c                   endif
      *
     c                   if        *in95 = *on
     c                   eval      rorest = *zero
     c                   eval      rovalr = *zero
6.11 c                   time                    roedat
6.11 c                   time                    roetim
6.11 c                   eval      roeusr = l_user
     c                   update    rltrlur
     c                   endif
      *
     c     e1tagc        tag
      *
     c                   endif
      *
     c                   enddo
      *
      * Nullstilling av restbeløp, samt oppdatering av
      * referanse på file fra journalkjøring
      *
     c                   if        p_call = 1
     c                   move      rjsort        w_sort
610  c                   move      rjmemb        w_memb
610  c                   move      *blank        w_nivo
     c     rjoulu_key    chain     rjoulur                            60
      *
     c                   if        *in90 = *on
     c                   if        b0rest > 0
     c                   move      wrefkr        rjrefn
     c                   endif
      *
     c                   if        b0rest < 0
     c                   move      wrefdb        rjrefn
     c                   endif
     c                   endif
      *
     c                   eval      rjrstb = *zero
     c                   eval      rjrstv = *zero
     c                   eval      rjkrys = *blank
     c                   move      'K'           rjopdt
610  c                   time                    rjedat
610  c                   time                    rjetim
610  c                   eval      rjeusr = l_user
      *
     c                   if        *in60 = *off
610  c                   time                    rjedat
610  c                   time                    rjetim
     c                   update    rjoulur
     c                   endif
     c                   endif
      *
      * Kjøre subrutine for agio / disagio
      *
     c                   if        e1kode = 'A'
     c                   exsr      xdagio
     c                   goto      e1tagd
     c                   endif
      *
      * Kjøre subrutine for kontantrabatt
      *
     c                   if        e1kode = 'K'
     c                   exsr      xrabat
     c                   goto      e1tagd
     c                   endif
      *
T5.50 * Kjøre subrutine for omkostninger
      *
T5.50c                   if        e1kode = 'O'
T5.50c                   exsr      xomkost
T5.50c                   goto      e1tagd
T5.50c                   endif
      *
      * Oppdatering av nytt restbeløp dersom avkryssing ikke går i null
      *
     c                   if        a5pdif <> *zero
     c                   if        e1linj <> *zero
      *
     c                   move      e1linj        w
     c                   move      tky(w)        dppkey
     c                   move      dpkont        w_kont
     c                   move      dpbdat        w_bdat
     c                   move      dptist        w_tist
      *
     c                   if        *in94 = *on
     c     rktrlx_key    chain     rktrlur                            60
     c                   endif
      *
     c                   if        *in95 = *on
     c     rltrlx_key    chain     rltrlur                            60
     c                   endif
      *
     c     *in60         cabeq     *on           e1tagd
     c                   endif
      *
     c                   endif
      *
      * Debet-post
      *
     c                   if        a5pdif > *zero
     c                   if        *in90 = *on
      *
     c                   if        *in94 = *on
     c                   move      wrefkr        rnrefn
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      wrefkr        rorefn
     c                   endif
      *
     c                   endif
      *
     c                   if        *in94 = *on
     c                   move      wdrest        rnrest
      *
     c                   if        rjbdat > rnodat
     c                   eval      rnodat = rjbdat
     c                   endif
      *
6.11 c                   time                    rnedat
6.11 c                   time                    rnetim
6.11 c                   eval      rneusr = l_user
     c                   update    rktrlur
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      wdrest        rorest
6.11 c                   time                    roedat
6.11 c                   time                    roetim
6.11 c                   eval      roeusr = l_user
     c                   update    rltrlur
     c                   endif
      *
     c                   endif
      *
      * Kredit-post
      *
     c                   if        a5pdif < *zero
     c                   if        *in90 = *on
      *
     c                   if        *in94 = *on
     c                   move      wrefdb        rnrefn
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      wrefdb        rorefn
     c                   endif
      *
     c                   endif
      *
     c                   if        *in94 = *on
     c                   move      wkrest        rnrest
6.11 c                   time                    rnedat
6.11 c                   time                    rnetim
6.11 c                   eval      rneusr = l_user
     c                   update    rktrlur
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      wkrest        rorest
6.11 c                   time                    roedat
6.11 c                   time                    roetim
6.11 c                   eval      roeusr = l_user
     c                   update    rltrlur
     c                   endif
      *
     c                   endif
      *
     c     e1tagd        tag
      *
     c                   if        p_call = 1
     c                   goto      a2taga
     c                   endif
      *
     c                   goto      a5taga
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * E2WIN Godkjenne ved tilbakeføring av restbeløp                  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     e2taga        tag
      *
      * Legge ut E2WIN
      *
     c                   eval      w_arow = 4
     c                   eval      w_acol = 2
      *
     c     e2tagb        tag
      *
     c                   exfmt     e2win
      *
      * Gå tilbake
      *
     c     *inkc         cabeq     *on           a5tagc
      *
      * Varsle dersom differanse
      *
     c                   if        a5pdif <> *zero
     c                   move      var(1)        m1mld1
     c                   move      var(2)        m1mld2
     c                   exsr      xm1win
     c     m1svar        cabeq     'N'           a5tagc
     c                   endif
      *
      * Overføring av opprinnelig beløp til restbeløp, og
      * nullstillig av referanser dersom det er valgt.
      *
6.32 c*    1             do        2000          w
6.32 c     1             do        8000          w
      *
     c                   if        tkr(w) = 'R'
     c                   move      tky(w)        dppkey
     c                   move      dpkont        w_kont
     c                   move      dpbdat        w_bdat
     c                   move      dptist        w_tist
      *
     c                   if        *in94 = *on
     c     rktrlx_key    chain     rktrlur                            60
     c                   endif
      *
     c                   if        *in95 = *on
     c     rltrlx_key    chain     rltrlur                            60
     c                   endif
      *
     c     *in60         cabeq     *on           e2tagc
      *
     c                   if        r1refr = 'J'
      *
     c                   if        *in94 = *on
     c                   eval      rnrefn = *zero
     c                   endif
      *
     c                   if        *in95 = *on
     c                   eval      rorefn = *zero
     c                   endif
      *
     c                   endif
      *
     c                   if        *in94 = *on
     c                   move      rnbelØ        rnrest
     c                   move      rnvalb        rnvalr
6.11 c                   time                    rnedat
6.11 c                   time                    rnetim
6.11 c                   eval      rneusr = l_user
     c                   update    rktrlur
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      robelØ        rorest
     c                   move      rovalb        rovalr
6.11 c                   time                    roedat
6.11 c                   time                    roetim
6.11 c                   eval      roeusr = l_user
     c                   update    rltrlur
     c                   endif
      *
     c     e2tagc        tag
      *
     c                   endif
      *
     c                   enddo
      *
     c                   goto      a5taga
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * F1WIN Velge avkryssingsmetode                                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     f1taga        tag
      *
      * Legge ut F1WIN
      *
     c                   eval      f1vmre = *blank
     c                   eval      f1vure = *blank
     c                   eval      w_arow = 4
     c                   eval      w_acol = 2
     c                   exfmt     f1win
      *
      * Gå tilbake
      *
     c     *inkc         cabeq     *on           a5tagc
      *
      * Velge
      *
     c                   if        f1vmre = '1'
     c                   move      *on           *in90
     c                   movel     mld(9)        e1head
     c                   movel     mld(11)       f1smre
     c                   eval      f1sure = *blank
     c                   endif
      *
     c                   if        f1vure = '1'
     c                   move      *off          *in90
     c                   movel     mld(10)       e1head
     c                   movel     mld(11)       f1sure
     c                   eval      f1smre = *blank
     c                   endif
      *
     c                   goto      f1taga
      /space 3
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Avslutt program                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xslutt        tag
7.02  *
7.02  *  Nullstille restbeløp på posteringer på kunder fra SHOP
7.02 c                   if        %subst(w_mem1:4:4) = 'SHOP'
7.02 c                             and U_Null_Bilag_s = *on
7.02 c                   exsr      Null_Bilag
7.02 c                   endif
      *
     c                   eval      *inlr = *on
     c                   return
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Fyll opp array's for debet og kredit poster                     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Nb! Denne rutine håndterer ikke subfile, da det i dette
      *     program er benyttet en annen teknikk.  Denne subrutine
      *     fyller opp et array for detbetposter og et array for
      *     kreditposter.  Bare poster som ikke er null i restbeløp
      *     tas med her.
      *
      *     Denne rutine benyttes også for å kunne overføre opprinnelig
      *     beløp på valgte poster til restbeløp igjen.  Nb!  I arrayet
      *     for restbeløp ligger da opprinnelig beløp...   Det må da
      *     benyttes kode 'R' for at oppdatering skal finne sted. Dersom
      *     SWTCH3 er på, er denne funksjon aktivisert.
      *
      *
     c     xcrt01        begsr
      *
     c                   eval      d = 0
     c                   eval      k = 0
      *
     c                   eval      dtx = *blank
     c                   eval      dbi = *zero
     c                   eval      dbe = *zero
     c                   eval      dre = *zero
     c                   eval      dvb = *zero
     c                   eval      dvr = *zero
     c                   eval      dvk = *blank
     c                   eval      dfd = *loval
     c                   eval      dsr = *zero
     c                   eval      dky = *blank
T5.50c                   eval      dar = *zero
      *
     c                   eval      ktx = *blank
     c                   eval      kbi = *zero
     c                   eval      kbe = *zero
     c                   eval      kre = *zero
     c                   eval      kvb = *zero
     c                   eval      kvr = *zero
     c                   eval      kvk = *blank
     c                   eval      kfd = *loval
     c                   eval      ksr = *zero
     c                   eval      kky = *blank
T5.50c                   eval      kar = *zero
      *
     c                   eval      lin = *zero
     c                   eval      tix = *zero
     c                   eval      tdk = *blank
     c                   eval      tky = *blank
      *
     c                   if        *in94 = *on
6.30 c*                  read      rktrl2                                 15
6.30 c                   read      rktrld                                 15
     c                   move      rnkund        sakont
     c                   endif
      *
     c                   if        *in95 = *on
6.30 c*                  read      rltrl2                                 15
6.30 c                   read      rltrlg                                 15
     c                   move      rolevr        sakont
     c                   endif
      *
     c                   dow       sakont = a2kont
      *
     c     *in15         cabeq     *on           xend01
      *
     c                   if        *in94 = *on
     c                   move      rnfirm        dpfirm
     c                   move      rnkund        dpkont
     c                   move      rnbdat        dpbdat
     c                   move      rntist        dptist
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      rofirm        dpfirm
     c                   move      rolevr        dpkont
     c                   move      robdat        dpbdat
     c                   move      rotist        dptist
     c                   endif
      *
      * Ordinær avkryssing
      *
     c                   if        swtch3 = 0
     c                   movel     mld(5)        a5hed1
     c                   movel     mld(6)        a5hed2
      *
     c                   if        *in94 = *on
     c     rnrest        cabeq     *zero         xneste
6.23 c     rnfirm        cabne     w_firm        xneste
     c     rnrest        cabgt     *zero         xdebet
     c     rnrest        cablt     *zero         xkredi
     c                   endif
      *
     c                   if        *in95 = *on
     c     rorest        cabeq     *zero         xneste
6.23 c     rofirm        cabne     w_firm        xneste
     c     rorest        cabgt     *zero         xdebet
     c     rorest        cablt     *zero         xkredi
     c                   endif
      *
     c                   endif
      *
      * Avkryssing for tilbakeføring av opprinnelig beløp
      *
     c                   if        swtch3 = 1
     c                   movel     mld(23)       a5info
     c                   movel     mld(6)        a5hed1
     c                   movel     mld(5)        a5hed2
      *
     c                   if        *in94 = *on
     c     rnbelØ        cabeq     *zero         xneste
     c     rnbelØ        cabgt     *zero         xdebet
     c     rnbelØ        cablt     *zero         xkredi
     c                   endif
      *
     c                   if        *in95 = *on
     c     robelØ        cabeq     *zero         xneste
     c     robelØ        cabgt     *zero         xdebet
     c     robelØ        cablt     *zero         xkredi
     c                   endif
      *
     c                   endif
      *
      * Debetpost
      *
     c     xdebet        tag
      *
     c                   eval      d = d + 1
6.32 c**   d             cabgt     998           xneste
6.32 c     d             cabgt     9999          xneste
      *
     c                   if        *in94 = *on
     c                   move      rnbdat        dsbdat
     c                   move      rntext        dtx(d)
     c                   move      rnbiln        dbi(d)
T5.50c                   move      rnraar        dar(d)
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      robdat        dsbdat
V5.50c***                move      rotext        dtx(d)
V5.50 *
V5.50c                   if        rolfak = *blank
V5.50c                   eval      dtx(d) = rotext
V5.50c                   else
V5.50c                   eval      dtx(d) = %trim(rolfak) + '/' +
V5.50c                                      %trim(rotext)
V5.50c                   endif
V5.50 *
     c                   move      robiln        dbi(d)
T5.50c                   move      roraar        dar(d)
     c                   endif
      *
     c                   if        swtch3 = 0
     c                   if        *in94 = *on
     c                   move      rnbelØ        dbe(d)
     c                   move      rnrest        dre(d)
     c                   move      rnvalb        dvb(d)
     c                   move      rnvalr        dvr(d)
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      robelØ        dbe(d)
     c                   move      rorest        dre(d)
     c                   move      rovalb        dvb(d)
     c                   move      rovalr        dvr(d)
     c                   endif
     c                   endif
      *
     c                   if        swtch3 = 1
     c                   if        *in94 = *on
     c                   move      rnbelØ        dre(d)
     c                   move      rnrest        dbe(d)
     c                   move      rnvalb        dvr(d)
     c                   move      rnvalr        dvb(d)
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      robelØ        dre(d)
     c                   move      rorest        dbe(d)
     c                   move      rovalb        dvr(d)
     c                   move      rovalr        dvb(d)
     c                   endif
     c                   endif
      *
     c                   if        *in94 = *on
     c                   move      rnvalk        dvk(d)
     c                   if        rnsamf <> 0
     c                   move      rnsamf        dsr(d)
     c                   else
     c                   move      rnrefn        dsr(d)
     c                   endif
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      rovalk        dvk(d)
     c                   move      rorefn        dsr(d)
     c                   endif
      *
     c                   move      dsbdat        dfd(d)
      *
     c                   move      dppkey        dky(d)
     c                   goto      xneste
      *
      * Kreditpost
      *
     c     xkredi        tag
      *
     c                   eval      k = k + 1
6.31 c**   k             cabgt     998           xneste
6.31 c     k             cabgt     9999          xneste
      *
     c                   if        *in94 = *on
     c                   move      rnbdat        dsbdat
     c                   move      rntext        ktx(k)
     c                   move      rnbiln        kbi(k)
T5.50c                   move      rnraar        kar(k)
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      robdat        dsbdat
      *
     c                   if        rolfak = *blank
     c                   eval      ktx(k) = rotext
     c                   else
     c                   eval      ktx(k) = %trim(rolfak) + '/' +
     c                                      %trim(rotext)
     c                   endif
      *
     c                   move      robiln        kbi(k)
T5.50c                   move      roraar        kar(k)
     c                   endif
      *
     c                   if        swtch3 = 0
     c                   if        *in94 = *on
     c                   move      rnbelØ        kbe(k)
     c                   move      rnrest        kre(k)
     c                   move      rnvalb        kvb(k)
     c                   move      rnvalr        kvr(k)
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      robelØ        kbe(k)
     c                   move      rorest        kre(k)
     c                   move      rovalb        kvb(k)
     c                   move      rovalr        kvr(k)
     c                   endif
     c                   endif
      *
     c                   if        swtch3 = 1
     c                   if        *in94 = *on
     c                   move      rnbelØ        kre(k)
     c                   move      rnrest        kbe(k)
     c                   move      rnvalb        kvr(k)
     c                   move      rnvalr        kvb(k)
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      robelØ        kre(k)
     c                   move      rorest        kbe(k)
     c                   move      rovalb        kvr(k)
     c                   move      rovalr        kvb(k)
     c                   endif
     c                   endif
      *
     c                   if        *in94 = *on
     c                   move      rnvalk        kvk(k)
     c                   if        rnsamf <> 0
     c                   move      rnsamf        ksr(k)
     c                   else
     c                   if        rnsamf <> 0
     c                   move      rnsamf        ksr(k)
     c                   else
     c                   move      rnrefn        ksr(k)
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      rovalk        kvk(k)
     c                   move      rorefn        ksr(k)
     c                   endif
      *
     c                   move      dsbdat        kfd(k)
     c                   move      dppkey        kky(k)
      *
     c     xneste        tag
      *
6.31 c*
6.31 c                   if        d > 9999 or
6.31 c                             k > 9999
6.31 c                   leave
6.31 c                   endif
6.31 c*
     c                   if        *in94 = *on
6.30 c*                  read      rktrl2                                 15
6.30 c                   read      rktrld                                 15
     c                   move      rnkund        sakont
     c                   endif
      *
     c                   if        *in95 = *on
6.30 c*                  read      rltrl2                                 15
6.30 c                   read      rltrlg                                 15
     c                   move      rolevr        sakont
     c                   endif
      *
     c                   enddo
      *
     c     xend01        tag
      *
      * Løpe igjennom: først kredit deretter debet dersom kunder
      *                først debet deretter kredit dersom leverandører
      *
     c                   eval      t = 0
     c                   eval      d = 0
     c                   eval      k = 0
      *
6.31 c** 941             do        999           k
6.31 c   941             do        9999          k
      *
     c     kre(k)        cabeq     *zero         xtag01
      *
     c                   eval      t = t + 1
     c                   move      k             tix(t)
     c                   move      'K'           tdk(t)
     c                   move      kky(k)        tky(t)
      *
     c                   enddo
      *
6.32 c*  951             do        999           d
6.32 c   951             do        9999          d
      *
     c     dre(d)        cabeq     *zero         xtag01
      *
     c                   eval      t = t + 1
     c                   move      d             tix(t)
     c                   move      'D'           tdk(t)
     c                   move      dky(d)        tky(t)
      *
     c                   enddo
      *
     c     xtag01        tag
      *
6.32 c** 941             do        999           d
6.32 c   941             do        9999          d
      *
     c     dre(d)        cabeq     *zero         xtag02
      *
     c                   eval      t = t + 1
     c                   move      d             tix(t)
     c                   move      'D'           tdk(t)
     c                   move      dky(d)        tky(t)
      *
     c                   enddo
      *
6.31 c*  951             do        999           k
6.31 c   951             do        9999          k
      *
     c     kre(k)        cabeq     *zero         xtag02
      *
     c                   eval      t = t + 1
     c                   move      k             tix(t)
     c                   move      'K'           tdk(t)
     c                   move      kky(k)        tky(t)
      *
     c                   enddo
      *
     c     xtag02        tag
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Nullstille felter i skjermbildet                                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xclr01        begsr
      *
     c                   eval      b1text = *blank
     c                   eval      b1biln = *zero
     c                   eval      b1rest = *zero
     c                   eval      b1belØ = *zero
     c                   eval      b1valr = *zero
     c                   eval      b1valb = *zero
     c                   eval      b1valk = *blank
     c                   eval      b1dato = *zero
     c                   eval      b1linj = *zero
     c                   eval      b1sref = *zero
     c                   eval      b1akry = *blank
      *
     c                   eval      b2text = *blank
     c                   eval      b2biln = *zero
     c                   eval      b2rest = *zero
     c                   eval      b2belØ = *zero
     c                   eval      b2valr = *zero
     c                   eval      b2valb = *zero
     c                   eval      b2valk = *blank
     c                   eval      b2dato = *zero
     c                   eval      b2linj = *zero
     c                   eval      b2sref = *zero
     c                   eval      b2akry = *blank
      *
     c                   eval      b3text = *blank
     c                   eval      b3biln = *zero
     c                   eval      b3rest = *zero
     c                   eval      b3belØ = *zero
     c                   eval      b3valr = *zero
     c                   eval      b3valb = *zero
     c                   eval      b3valk = *blank
     c                   eval      b3dato = *zero
     c                   eval      b3linj = *zero
     c                   eval      b3sref = *zero
     c                   eval      b3akry = *blank
      *
     c                   eval      b4text = *blank
     c                   eval      b4biln = *zero
     c                   eval      b4rest = *zero
     c                   eval      b4belØ = *zero
     c                   eval      b4valr = *zero
     c                   eval      b4valb = *zero
     c                   eval      b4valk = *blank
     c                   eval      b4dato = *zero
     c                   eval      b4linj = *zero
     c                   eval      b4sref = *zero
     c                   eval      b4akry = *blank
      *
     c                   eval      b5text = *blank
     c                   eval      b5biln = *zero
     c                   eval      b5rest = *zero
     c                   eval      b5belØ = *zero
     c                   eval      b5valr = *zero
     c                   eval      b5valb = *zero
     c                   eval      b5valk = *blank
     c                   eval      b5dato = *zero
     c                   eval      b5linj = *zero
     c                   eval      b5sref = *zero
     c                   eval      b5akry = *blank
      *
     c                   eval      b6text = *blank
     c                   eval      b6biln = *zero
     c                   eval      b6rest = *zero
     c                   eval      b6belØ = *zero
     c                   eval      b6valr = *zero
     c                   eval      b6valb = *zero
     c                   eval      b6valk = *blank
     c                   eval      b6dato = *zero
     c                   eval      b6linj = *zero
     c                   eval      b6sref = *zero
     c                   eval      b6akry = *blank
      *
     c                   eval      c1text = *blank
     c                   eval      c1biln = *zero
     c                   eval      c1rest = *zero
     c                   eval      c1belØ = *zero
     c                   eval      c1valr = *zero
     c                   eval      c1valb = *zero
     c                   eval      c1valk = *blank
     c                   eval      c1dato = *zero
     c                   eval      c1linj = *zero
     c                   eval      c1sref = *zero
     c                   eval      c1akry = *blank
      *
     c                   eval      c2text = *blank
     c                   eval      c2biln = *zero
     c                   eval      c2rest = *zero
     c                   eval      c2belØ = *zero
     c                   eval      c2valr = *zero
     c                   eval      c2valb = *zero
     c                   eval      c2valk = *blank
     c                   eval      c2dato = *zero
     c                   eval      c2linj = *zero
     c                   eval      c2sref = *zero
     c                   eval      c2akry = *blank
      *
     c                   eval      c3text = *blank
     c                   eval      c3biln = *zero
     c                   eval      c3rest = *zero
     c                   eval      c3belØ = *zero
     c                   eval      c3valr = *zero
     c                   eval      c3valb = *zero
     c                   eval      c3valk = *blank
     c                   eval      c3dato = *zero
     c                   eval      c3linj = *zero
     c                   eval      c3sref = *zero
     c                   eval      c3akry = *blank
      *
     c                   eval      c4text = *blank
     c                   eval      c4biln = *zero
     c                   eval      c4rest = *zero
     c                   eval      c4belØ = *zero
     c                   eval      c4valr = *zero
     c                   eval      c4valb = *zero
     c                   eval      c4valk = *blank
     c                   eval      c4dato = *zero
     c                   eval      c4linj = *zero
     c                   eval      c4sref = *zero
     c                   eval      c4akry = *blank
      *
     c                   eval      c5text = *blank
     c                   eval      c5biln = *zero
     c                   eval      c5rest = *zero
     c                   eval      c5belØ = *zero
     c                   eval      c5valr = *zero
     c                   eval      c5valb = *zero
     c                   eval      c5valk = *blank
     c                   eval      c5dato = *zero
     c                   eval      c5linj = *zero
     c                   eval      c5sref = *zero
     c                   eval      c5akry = *blank
      *
     c                   eval      c6text = *blank
     c                   eval      c6biln = *zero
     c                   eval      c6rest = *zero
     c                   eval      c6belØ = *zero
     c                   eval      c6valr = *zero
     c                   eval      c6valb = *zero
     c                   eval      c6valk = *blank
     c                   eval      c6dato = *zero
     c                   eval      c6linj = *zero
     c                   eval      c6sref = *zero
     c                   eval      c6akry = *blank
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Flytte felter til skjermbilde                                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xmov01        begsr
      *
      * NB! Det benyttes ikke subfile-teknikk i dette program.
      *     I denne rutine flyttes data over fra adskilte array's
      *     for debet / kredit poster, til array for visning av
      *     skjermbildet d.v.s. inntil 12 linjer.
      *
     c                   eval      t = 0
     c                   eval      d = 0
     c                   eval      k = 0
     c                   eval      l = 0
      *
      * Flytte inn i skjermbilde
      *
     c     1             do        12
      *
     c     xtag10        tag
      *
     c                   eval      t = t + 1
     c     tdk(t)        cabeq     *blank        xtag11
      *
      * Droppe kreditposter som ikke er krysset
      * dersom SWTCH4 er 1. (dersom kunder)
      *
     c                   if        swtch4 = 1 and
     c                             tdk(t) = 'K' and
     c                             tkr(t) = *blank and
     c                             *in94 = *on
     c                   goto      xtag10
     c                   endif
      *
      * Droppe debetposter som ikke er krysset
      * dersom SWTCH4 er 1. (dersom leverandører)
      *
     c                   if        swtch4 = 1 and
     c                             tdk(t) = 'D' and
     c                             tkr(t) = *blank and
     c                             *in95 = *on
     c                   goto      xtag10
     c                   endif
      *
     c                   eval      l = l + 1
     c                   move      t             lin(l)
     c                   move      t             wsavet
      *
     c                   if        tdk(t) = 'K'
     c                   move      tix(t)        k
     c                   exsr      xmovkr
     c                   endif
      *
     c                   if        tdk(t) = 'D'
     c                   move      tix(t)        d
     c                   exsr      xmovdb
     c                   endif
      *
     c                   enddo
      *
     c     xtag11        tag
      *
     c                   if        l = 12
     c                   move      '+'           a5more
     c                   else
     c                   move      ' '           a5more
     c                   endif
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Roll, Bla framover                                              *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xrollf        begsr
      *
     c                   eval      t = wsavet
     c                   eval      l = 0
      *
      * Flytte inn i skjermbilde
      *
     c     1             do        12
     c                   eval      t = t + 1
     c     tdk(t)        cabeq     *blank        xtag21
      *
     c                   eval      l = l + 1
     c                   move      t             lin(l)
     c                   move      t             wsavet
      *
     c                   if        tdk(t) = 'K'
     c                   move      tix(t)        k
     c                   exsr      xmovkr
     c                   endif
      *
     c                   if        tdk(t) = 'D'
     c                   move      tix(t)        d
     c                   exsr      xmovdb
     c                   endif
      *
     c                   enddo
      *
     c     xtag21        tag
      *
     c                   if        l = 12
     c                   move      '+'           a5more
     c                   else
     c                   move      ' '           a5more
     c                   endif
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Roll, Bla bakover                                               *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xrollb        begsr
      *
     c                   eval      t = wsavet - l
     c                   eval      t = t - 12
      *
     c                   if        t < 0
     c                   eval      t = 0
     c                   endif
      *
     c                   eval      l = 0
      *
      * Flytte inn i skjermbilde
      *
     c     1             do        12
     c                   eval      t = t + 1
     c     tdk(t)        cabeq     *blank        xtag31
      *
     c                   eval      l = l + 1
     c                   move      t             lin(l)
     c                   move      t             wsavet
      *
     c                   if        tdk(t) = 'K'
     c                   move      tix(t)        k
     c                   exsr      xmovkr
     c                   endif
      *
     c                   if        tdk(t) = 'D'
     c                   move      tix(t)        d
     c                   exsr      xmovdb
     c                   endif
      *
     c                   enddo
      *
     c     xtag31        tag
      *
     c                   if        l = 12
     c                   move      '+'           a5more
     c                   else
     c                   move      ' '           a5more
     c                   endif
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Flytting av kreditposter                                        *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xmovkr        begsr
      *
     c                   if        l = 1
6.nu c                   movel     ktx(k)        b1text
     c                   move      kbi(k)        b1biln
     c                   move      kre(k)        b1rest
     c                   move      kbe(k)        b1belØ
     c                   move      kvr(k)        b1valr
     c                   move      kvb(k)        b1valb
     c                   move      kvk(k)        b1valk
     c     *dmy          move      kfd(k)        b1dato
     c                   move      ksr(k)        b1sref
     c                   move      t             b1linj
     c                   move      tkr(t)        b1akry
     c                   endif
      *
     c                   if        l = 2
6.nu c                   movel     ktx(k)        b2text
     c                   move      kbi(k)        b2biln
     c                   move      kre(k)        b2rest
     c                   move      kbe(k)        b2belØ
     c                   move      kvr(k)        b2valr
     c                   move      kvb(k)        b2valb
     c                   move      kvk(k)        b2valk
     c     *dmy          move      kfd(k)        b2dato
     c                   move      ksr(k)        b2sref
     c                   move      t             b2linj
     c                   move      tkr(t)        b2akry
     c                   endif
      *
     c                   if        l = 3
6.nu c                   movel     ktx(k)        b3text
     c                   move      kbi(k)        b3biln
     c                   move      kre(k)        b3rest
     c                   move      kbe(k)        b3belØ
     c                   move      kvr(k)        b3valr
     c                   move      kvb(k)        b3valb
     c                   move      kvk(k)        b3valk
     c     *dmy          move      kfd(k)        b3dato
     c                   move      ksr(k)        b3sref
     c                   move      t             b3linj
     c                   move      tkr(t)        b3akry
     c                   endif
      *
     c                   if        l = 4
6.nu c                   movel     ktx(k)        b4text
     c                   move      kbi(k)        b4biln
     c                   move      kre(k)        b4rest
     c                   move      kbe(k)        b4belØ
     c                   move      kvr(k)        b4valr
     c                   move      kvb(k)        b4valb
     c                   move      kvk(k)        b4valk
     c     *dmy          move      kfd(k)        b4dato
     c                   move      ksr(k)        b4sref
     c                   move      t             b4linj
     c                   move      tkr(t)        b4akry
     c                   endif
      *
     c                   if        l = 5
6.nu c                   movel     ktx(k)        b5text
     c                   move      kbi(k)        b5biln
     c                   move      kre(k)        b5rest
     c                   move      kbe(k)        b5belØ
     c                   move      kvr(k)        b5valr
     c                   move      kvb(k)        b5valb
     c                   move      kvk(k)        b5valk
     c     *dmy          move      kfd(k)        b5dato
     c                   move      ksr(k)        b5sref
     c                   move      t             b5linj
     c                   move      tkr(t)        b5akry
     c                   endif
      *
     c                   if        l = 6
6.nu c                   movel     ktx(k)        b6text
     c                   move      kbi(k)        b6biln
     c                   move      kre(k)        b6rest
     c                   move      kbe(k)        b6belØ
     c                   move      kvr(k)        b6valr
     c                   move      kvb(k)        b6valb
     c                   move      kvk(k)        b6valk
     c     *dmy          move      kfd(k)        b6dato
     c                   move      ksr(k)        b6sref
     c                   move      t             b6linj
     c                   move      tkr(t)        b6akry
     c                   endif
      *
     c                   if        l = 7
6.nu c                   movel     ktx(k)        c1text
     c                   move      kbi(k)        c1biln
     c                   move      kre(k)        c1rest
     c                   move      kbe(k)        c1belØ
     c                   move      kvr(k)        c1valr
     c                   move      kvb(k)        c1valb
     c                   move      kvk(k)        c1valk
     c     *dmy          move      kfd(k)        c1dato
     c                   move      ksr(k)        c1sref
     c                   move      t             c1linj
     c                   move      tkr(t)        c1akry
     c                   endif
      *
     c                   if        l = 8
6.nu c                   movel     ktx(k)        c2text
     c                   move      kbi(k)        c2biln
     c                   move      kre(k)        c2rest
     c                   move      kbe(k)        c2belØ
     c                   move      kvr(k)        c2valr
     c                   move      kvb(k)        c2valb
     c                   move      kvk(k)        c2valk
     c     *dmy          move      kfd(k)        c2dato
     c                   move      ksr(k)        c2sref
     c                   move      t             c2linj
     c                   move      tkr(t)        c2akry
     c                   endif
      *
     c                   if        l = 9
6.nu c                   movel     ktx(k)        c3text
     c                   move      kbi(k)        c3biln
     c                   move      kre(k)        c3rest
     c                   move      kbe(k)        c3belØ
     c                   move      kvr(k)        c3valr
     c                   move      kvb(k)        c3valb
     c                   move      kvk(k)        c3valk
     c     *dmy          move      kfd(k)        c3dato
     c                   move      ksr(k)        c3sref
     c                   move      t             c3linj
     c                   move      tkr(t)        c3akry
     c                   endif
      *
     c                   if        l = 10
6.nu c                   movel     ktx(k)        c4text
     c                   move      kbi(k)        c4biln
     c                   move      kre(k)        c4rest
     c                   move      kbe(k)        c4belØ
     c                   move      kvr(k)        c4valr
     c                   move      kvb(k)        c4valb
     c                   move      kvk(k)        c4valk
     c     *dmy          move      kfd(k)        c4dato
     c                   move      ksr(k)        c4sref
     c                   move      t             c4linj
     c                   move      tkr(t)        c4akry
     c                   endif
      *
     c                   if        l = 11
6.nu c                   movel     ktx(k)        c5text
     c                   move      kbi(k)        c5biln
     c                   move      kre(k)        c5rest
     c                   move      kbe(k)        c5belØ
     c                   move      kvr(k)        c5valr
     c                   move      kvb(k)        c5valb
     c                   move      kvk(k)        c5valk
     c     *dmy          move      kfd(k)        c5dato
     c                   move      ksr(k)        c5sref
     c                   move      t             c5linj
     c                   move      tkr(t)        c5akry
     c                   endif
      *
     c                   if        l = 12
6.nu c                   movel     ktx(k)        c6text
     c                   move      kbi(k)        c6biln
     c                   move      kre(k)        c6rest
     c                   move      kbe(k)        c6belØ
     c                   move      kvr(k)        c6valr
     c                   move      kvb(k)        c6valb
     c                   move      kvk(k)        c6valk
     c     *dmy          move      kfd(k)        c6dato
     c                   move      ksr(k)        c6sref
     c                   move      t             c6linj
     c                   move      tkr(t)        c6akry
     c                   endif
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Flytting av debetposter                                         *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xmovdb        begsr
      *
     c                   if        l = 1
6.nu c                   movel     dtx(d)        b1text
     c                   move      dbi(d)        b1biln
     c                   move      dre(d)        b1rest
     c                   move      dbe(d)        b1belØ
     c                   move      dvr(d)        b1valr
     c                   move      dvb(d)        b1valb
     c                   move      dvk(d)        b1valk
     c     *dmy          move      dfd(d)        b1dato
     c                   move      dsr(d)        b1sref
     c                   move      t             b1linj
     c                   move      tkr(t)        b1akry
     c                   endif
      *
     c                   if        l = 2
6.nu c                   movel     dtx(d)        b2text
     c                   move      dbi(d)        b2biln
     c                   move      dre(d)        b2rest
     c                   move      dbe(d)        b2belØ
     c                   move      dvr(d)        b2valr
     c                   move      dvb(d)        b2valb
     c                   move      dvk(d)        b2valk
     c     *dmy          move      dfd(d)        b2dato
     c                   move      dsr(d)        b2sref
     c                   move      t             b2linj
     c                   move      tkr(t)        b2akry
     c                   endif
      *
     c                   if        l = 3
6.nu c                   movel     dtx(d)        b3text
     c                   move      dbi(d)        b3biln
     c                   move      dre(d)        b3rest
     c                   move      dbe(d)        b3belØ
     c                   move      dvr(d)        b3valr
     c                   move      dvb(d)        b3valb
     c                   move      dvk(d)        b3valk
     c     *dmy          move      dfd(d)        b3dato
     c                   move      dsr(d)        b3sref
     c                   move      t             b3linj
     c                   move      tkr(t)        b3akry
     c                   endif
      *
     c                   if        l = 4
6.nu c                   movel     dtx(d)        b4text
     c                   move      dbi(d)        b4biln
     c                   move      dre(d)        b4rest
     c                   move      dbe(d)        b4belØ
     c                   move      dvr(d)        b4valr
     c                   move      dvb(d)        b4valb
     c                   move      dvk(d)        b4valk
     c     *dmy          move      dfd(d)        b4dato
     c                   move      dsr(d)        b4sref
     c                   move      t             b4linj
     c                   move      tkr(t)        b4akry
     c                   endif
      *
     c                   if        l = 5
6.nu c                   movel     dtx(d)        b5text
     c                   move      dbi(d)        b5biln
     c                   move      dre(d)        b5rest
     c                   move      dbe(d)        b5belØ
     c                   move      dvr(d)        b5valr
     c                   move      dvb(d)        b5valb
     c                   move      dvk(d)        b5valk
     c     *dmy          move      dfd(d)        b5dato
     c                   move      dsr(d)        b5sref
     c                   move      t             b5linj
     c                   move      tkr(t)        b5akry
     c                   endif
      *
     c                   if        l = 6
6.nu c                   movel     dtx(d)        b6text
     c                   move      dbi(d)        b6biln
     c                   move      dre(d)        b6rest
     c                   move      dbe(d)        b6belØ
     c                   move      dvr(d)        b6valr
     c                   move      dvb(d)        b6valb
     c                   move      dvk(d)        b6valk
     c     *dmy          move      dfd(d)        b6dato
     c                   move      dsr(d)        b6sref
     c                   move      t             b6linj
     c                   move      tkr(t)        b6akry
     c                   endif
      *
     c                   if        l = 7
6.nu c                   movel     dtx(d)        c1text
     c                   move      dbi(d)        c1biln
     c                   move      dre(d)        c1rest
     c                   move      dbe(d)        c1belØ
     c                   move      dvr(d)        c1valr
     c                   move      dvb(d)        c1valb
     c                   move      dvk(d)        c1valk
     c     *dmy          move      dfd(d)        c1dato
     c                   move      dsr(d)        c1sref
     c                   move      t             c1linj
     c                   move      tkr(t)        c1akry
     c                   endif
      *
     c                   if        l = 8
6.nu c                   movel     dtx(d)        c2text
     c                   move      dbi(d)        c2biln
     c                   move      dre(d)        c2rest
     c                   move      dbe(d)        c2belØ
     c                   move      dvr(d)        c2valr
     c                   move      dvb(d)        c2valb
     c                   move      dvk(d)        c2valk
     c     *dmy          move      dfd(d)        c2dato
     c                   move      dsr(d)        c2sref
     c                   move      t             c2linj
     c                   move      tkr(t)        c2akry
     c                   endif
      *
     c                   if        l = 9
6.nu c                   movel     dtx(d)        c3text
     c                   move      dbi(d)        c3biln
     c                   move      dre(d)        c3rest
     c                   move      dbe(d)        c3belØ
     c                   move      dvr(d)        c3valr
     c                   move      dvb(d)        c3valb
     c                   move      dvk(d)        c3valk
     c     *dmy          move      dfd(d)        c3dato
     c                   move      dsr(d)        c3sref
     c                   move      t             c3linj
     c                   move      tkr(t)        c3akry
     c                   endif
      *
     c                   if        l = 10
6.nu c                   movel     dtx(d)        c4text
     c                   move      dbi(d)        c4biln
     c                   move      dre(d)        c4rest
     c                   move      dbe(d)        c4belØ
     c                   move      dvr(d)        c4valr
     c                   move      dvb(d)        c4valb
     c                   move      dvk(d)        c4valk
     c     *dmy          move      dfd(d)        c4dato
     c                   move      dsr(d)        c4sref
     c                   move      t             c4linj
     c                   move      tkr(t)        c4akry
     c                   endif
      *
     c                   if        l = 11
6.nu c                   movel     dtx(d)        c5text
     c                   move      dbi(d)        c5biln
     c                   move      dre(d)        c5rest
     c                   move      dbe(d)        c5belØ
     c                   move      dvr(d)        c5valr
     c                   move      dvb(d)        c5valb
     c                   move      dvk(d)        c5valk
     c     *dmy          move      dfd(d)        c5dato
     c                   move      dsr(d)        c5sref
     c                   move      t             c5linj
     c                   move      tkr(t)        c5akry
     c                   endif
      *
     c                   if        l = 12
6.nu c                   movel     dtx(d)        c6text
     c                   move      dbi(d)        c6biln
     c                   move      dre(d)        c6rest
     c                   move      dbe(d)        c6belØ
     c                   move      dvr(d)        c6valr
     c                   move      dvb(d)        c6valb
     c                   move      dvk(d)        c6valk
     c     *dmy          move      dfd(d)        c6dato
     c                   move      dsr(d)        c6sref
     c                   move      t             c6linj
     c                   move      tkr(t)        c6akry
     c                   endif
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for kontroll av avkryssing                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xgodkj        begsr
      *
      * Kontroll av avkryssing
      *
     c                   eval      a5pdeb_gml = 0
     c                   eval      swtch1 = *zero
     c                   eval      swtch2 = *zero
     c                   eval      wantdb = *zero
     c                   eval      wantkr = *zero
     c                   eval      wrefdb = *zero
     c                   eval      wrefkr = *zero
      *
6.32 c*    1             do        2000          w
6.32 c     1             do        8000          w
     c                   if        tkr(w) <> *blank
     c                   move      1             swtch1
      *
     c                   if        tdk(w) = 'D'
     c                   eval      wantdb = wantdb + 1
     c                   move      tix(w)        d
     c                   move      dbi(d)        wrefdb
     c                   endif
      *
     c                   if        tdk(w) = 'K'
     c                   eval      wantkr = wantkr + 1
     c                   move      tix(w)        k
     c                   move      kbi(k)        wrefkr
     c                   move      kfd(k)        wdatkr
     c                   endif
      *
     c                   endif
     c                   enddo
      *
      * Oppdatering av status når det er posteringsfile fra journalkjøring.
      *
     c                   if        b0rest > 0
     c                   move      1             swtch1
     c                   eval      wantdb = wantdb + 1
     c                   move      b0biln        wrefdb
     c                   endif
      *
     c                   if        b0rest < 0
     c                   move      1             swtch1
     c                   eval      wantkr = wantkr + 1
     c                   move      b0biln        wrefkr
     c                   endif
      *
      * Ingen avkryssing er foretatt
      *
     c                   if        swtch1 = 0
     c                   move      1             swtch2
     c                   move      var(3)        n1mld1
     c                   move      var(4)        n1mld2
     c                   exsr      xn1win
     c                   goto      xgod99
     c                   endif
      *
      * Kun avkrysset for debeteposter
      *
     c                   if        wantdb > 0 and
     c                             wantkr = 0
     c                   move      1             swtch2
     c                   move      var(5)        n1mld1
     c                   move      var(6)        n1mld2
     c                   exsr      xn1win
     c                   goto      xgod99
     c                   endif
      *
      * Kun avkrysset for kreditposter
      *
     c                   if        wantkr > 0 and
     c                             wantdb = 0
     c                   move      1             swtch2
     c                   move      var(7)        n1mld1
     c                   move      var(8)        n1mld2
     c                   exsr      xn1win
     c                   goto      xgod99
     c                   endif
      *
      * Avkryssing med referanse-setting
      * men flere debet og kreditposter krysset
      *
     c                   if        wantkr > 1 and
     c                             wantdb > 1 and
     c                             *in90 = *on
     c                   move      1             swtch2
     c                   move      var(9)        n1mld1
     c                   move      var(10)       n1mld2
     c                   exsr      xn1win
     c                   goto      xgod99
     c                   endif
      *
     c     xgod99        endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Automatisk avkryssing på like beløp                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xscann        begsr
      *
     c                   move      w             x
     c                   move      'X'           tkr(w)
      *
     c                   if        *in94 = *on
     c                   move      tix(w)        k
     c                   eval      wsrest = kre(k)
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      tix(w)        d
     c                   eval      wsrest = dre(d)
     c                   endif
      *
6.32 c*    x             do        2000          x
6.32 c     x             do        8000          x
      *
     c   94              if        tdk(x) = 'D'
     c                   move      tix(x)        d
     c                   eval      wstest = dre(d) + wsrest
      *
     c                   if        tkr(x) = *blank
     c                   if        wstest = *zero
     c                   move      'X'           tkr(x)
     c                   goto      xscane
     c                   endif
     c                   endif
      *
     c                   endif
      *
     c   95              if        tdk(x) = 'K'
     c                   move      tix(x)        k
     c                   eval      wstest = kre(k) + wsrest
      *
     c                   if        tkr(x) = *blank
     c                   if        wstest = *zero
     c                   move      'X'           tkr(x)
     c                   goto      xscane
     c                   endif
     c                   endif
      *
     c                   endif
      *
     c                   enddo
      *
     c     xscane        endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Lete opp transaksjoner for avkryssing                           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xtrans        begsr
      *
     c     xtag40        tag
      *
610  c                   if        w_tell = 0
610  c                   eval      w_tell = 1
610  c                   move      *blank        w_nivo
610  c                   eval      w_memb = w_mem1
610  c     rjoupf_key    setll     rjoupf
610  c                   endif
610   *
     c                   read      rjoupf                                 60
      *
     c                   move      rjfirm        w_firm
      *
      * End of file ?
      *
     c                   if        *in60 = *on
     c                   move      9             p_call
     c                   goto      xtag42
     c                   endif
      *
610  c                   if        rjmemb <> w_mem1
610  c                   move      9             p_call
610  c                   goto      xtag42
610  c                   endif
      *
      * Rabatt (RTKRAB<>0) salderes i oppdatering (RF110R) ??????????????
      *
     c                   if        rjopdt = 'R'
     c                   goto      xtag40
     c                   endif
      *
      * Ikke Reskontropostering ?
      *
     c                   if        rjreid <> 'K'
     c                   if        rjreid <> 'L'
     c                   goto      xtag40
     c                   endif
     c                   endif
      *
      * Skal post krysses ?
      *
     c     rjkrys        cabne     *blank        xtag41
     c     rjrefn        cabne     *zero         xtag41
      *
     c                   goto      xtag40
      *
      * Poster til avkryssing
      *
     c     xtag41        tag
      *
     c                   movel     mld(19)       a5info
     c                   move      rjkont        a2kont
6.20 c                   movel     rjtext        b0text
     c                   move      rjbiln        b0biln
6.20 c                   move      rjrefn        b0sref
     c     *dmy          move      rjbdat        b0bdat
      *
     c                   eval      b0rest = rjrstb
     c                   eval      b0valr = rjrstv
      *
      * Sett indikator for kunde/leverandørpost
      * 94 = Kundepostering
      * 95 = Leverandørpost
      *
     c                   move      *off          *in94
     c                   move      *off          *in95
      *
     c                   if        rjreid = 'K'
     c                   move      *on           *in94
     c                   endif
      *
     c                   if        rjreid = 'L'
     c                   move      *on           *in95
     c                   endif
      *
     c     xtag42        endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine som forsøker automatisk saldering                     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xsaldr        begsr
      *
     c                   eval      d = 0
     c                   eval      k = 0
     c                   eval      t = 0
      *
     c                   eval      dre = *zero
     c                   eval      dvr = *zero
     c                   eval      kre = *zero
     c                   eval      kvr = *zero
     c                   eval      tky = *blank
      *
     c                   move      rjfirm        w_firm
     c                   move      a2kont        w_kont
     c                   eval      w_bdat = *loval
     c                   eval      w_tist = *loval
      *
     c                   if        *in94 = *on
6.30 c*    rktrlx_key    setll     rktrl2
6.30 c*                  read      rktrl2                                 15
6.30 c     rktrlx_key    setll     rktrld
6.30 c                   read      rktrld                                 15
     c                   move      rnkund        sakont
     c                   endif
      *
     c                   if        *in95 = *on
6.30 c*    rltrlx_key    setll     rltrl2
6.30 c*                  read      rltrl2                                 15
6.30 c     rltrlx_key    setll     rltrlg
6.30 c                   read      rltrlg                                 15
     c                   move      rolevr        sakont
     c                   endif
      *
     c                   dow       sakont = a2kont
     c     *in15         cabeq     *on           xend02
      *
     c                   if        *in94 = *on
     c                   move      rnfirm        dpfirm
     c                   move      rnkund        dpkont
     c                   move      rnbdat        dpbdat
     c                   move      rntist        dptist
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      rofirm        dpfirm
     c                   move      rolevr        dpkont
     c                   move      robdat        dpbdat
     c                   move      rotist        dptist
     c                   endif
      *
      * Samme bilagsnummer ?
      *
     c                   if        rjkrys <> 'S'
      *
     c   94              if        rjrefn <> rnbiln
     c                   goto      xnest2
     c                   endif
      *
     c   95              if        rjrefn <> robiln
     c                   goto      xnest2
     c                   endif
     4*
     c                   endif
      *
      * Samme generalnotanummer ?
      *
     c                   if        rjkrys = 'S'
      *
     c   94              if        rjrefn <> rnsamf
     c                   goto      xnest2
     c                   endif
      *
     c   95              if        rjrefn <> rosamb
     c                   goto      xnest2
     c                   endif
      *
     c                   endif
      *
      * Gå til summering
      *
     c                   if        *in94 = *on
     c     rnrest        cabeq     *zero         xnest2
     c     rnrest        cabgt     *zero         xdebe2
     c     rnrest        cablt     *zero         xkred2
     c                   endif
     c                   if        *in95 = *on
     c     rorest        cabeq     *zero         xnest2
     c     rorest        cabgt     *zero         xdebe2
     c     rorest        cablt     *zero         xkred2
     c                   endif
      *
      * Debetpost
      *
     c     xdebe2        tag
      *
     c                   eval      d = d + 1
     c                   eval      t = t + 1
      *
6.32 c*    d             cabgt     998           xnest2
6.32 c     d             cabgt     9999          xnest2
      *
     c                   if        *in94 = *on
     c                   move      rnrest        dre(d)
     c                   move      rnvalr        dvr(d)
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      rorest        dre(d)
     c                   move      rovalr        dvr(d)
     c                   endif
      *
     c                   move      dppkey        tky(t)
     c                   goto      xnest2
      *
      * Kreditpost
      *
     c     xkred2        tag
      *
     c                   eval      k = k + 1
     c                   eval      t = t + 1
      *
6.32 c*    k             cabgt     998           xnest2
6.32 c     k             cabgt     9999          xnest2
      *
     c                   if        *in94 = *on
     c                   move      rnrest        kre(k)
     c                   move      rnvalr        kvr(k)
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      rorest        kre(k)
     c                   move      rovalr        kvr(k)
     c                   endif
      *
     c                   move      dppkey        tky(t)
      *
     c     xnest2        tag
      *
     c                   if        *in94 = *on
6.30 c*                  read      rktrl2                                 15
6.30 c                   read      rktrld                                 15
     c                   move      rnkund        sakont
     c                   endif
      *
     c                   if        *in95 = *on
6.30 c*                  read      rltrl2                                 15
6.30 c                   read      rltrlg                                 15
     c                   move      rolevr        sakont
     c                   endif
      *
     c                   enddo
      *
     c     xend02        tag
      *
      * Summere motposter
      *
     c                   xfoot     dre           xfodre
     c                   xfoot     kre           xfokre
     c                   xfoot     dvr           xfodvr
     c                   xfoot     kvr           xfokvr
     c                   eval      xfosum = xfodre + xfokre
     c                   eval      xfosuv = xfodvr + xfokvr
      *
      * Sjekke om bilag går i null
      *
     c                   eval      xfores = b0rest + xfosum
     c                   eval      xforev = b0valr + xfosuv
      *
     c                   if        xfores = *zero
     c                   move      '1'           swtch5
     c                   endif
      *
7.01 c                   if        p_adra = 'J'   and
7.01 c                             xfores <> *zero
7.01 c                   move      '1'           swtch5
7.01 c                   endif
      *
      * Oppdatere kun post fra journalkjøring
      *
     c                   move      rjsort        w_sort
610  c                   move      rjmemb        w_memb
610  c                   move      *blank        w_nivo
     c     rjoulu_key    chain     rjoulur                            60
      *
     c                   if        swtch5 = *zero
     c                   eval      rjkrys = *blank
      *
     c                   if        *in60 = *off
610  c                   time                    rjedat
610  c                   time                    rjetim
     c                   update    rjoulur
     c                   endif
      *
     c                   goto      xend04
     c                   endif
      *
      * Nullstilling av restbeløp, samt oppdatering av
      * referanse på file fra journalkjøring
      *
     c                   eval      rjrstb = *zero
     c                   eval      rjrstv = *zero
     c                   eval      rjkrys = *blank
     c                   move      'K'           rjopdt
      *
     c                   if        *in60 = *off
610  c                   time                    rjedat
610  c                   time                    rjetim
     c                   update    rjoulur
     c                   endif
      *
      * Nullstilling av restbeløp, samt oppdatering av referanser
      *
6.32 c**   1             do        2000          t
6.32 c     1             do        8000          t
      *
     c     tky(t)        cabeq     *blank        xend04
      *
     c                   move      tky(t)        dppkey
     c                   move      dpkont        w_kont
     c                   move      dpbdat        w_bdat
     c                   move      dptist        w_tist
      *
     c                   if        *in94 = *on
     c     rktrlx_key    chain     rktrlur                            60
     c                   endif
      *
     c                   if        *in95 = *on
     c     rltrlx_key    chain     rltrlur                            60
     c                   endif
      *
     c     *in60         cabeq     *on           xend03
      *
      * Sjekk oppgjørsdato
      *
     c                   if        *in94 = *on and
     c                             rjbdat > rnodat
     c                   eval      rnodat = rjbdat
     c                   endif
      *
     c                   if        *in94 = *on
7.01 c                   if        p_adra = 'J'
7.01 c                   eval      rnrest = xfores
7.01 c                   eval      rnvalr = xforev
7.01 c                   else
     c                   eval      rnrest = *zero
     c                   eval      rnvalr = *zero
7.01 c                   endif
     c                   move      rjbiln        rnrefn
6.11 c                   time                    rnedat
6.11 c                   time                    rnetim
6.11 c                   eval      rneusr = l_user
6.12  *
6.12  * Henter program for avkr. ref.
6.12 c                   eval      p_firm = rnfirm
6.12 c                   eval      p_aar = rnraar
6.12 c                   call      'RF118R'
6.12 c                   parm                    p_firm
6.12 c                   parm                    p_aar
6.12 c                   parm                    p_avkr
6.12 c                   parm                    p_spor
6.12  *
6.12 c                   eval      rnavkr = p_avkr
6.12  *
     c                   update    rktrlur
     c                   endif
      *
     c                   if        *in95 = *on
     c                   eval      rorest = *zero
     c                   eval      rovalr = *zero
     c                   move      rjbiln        rorefn
6.11 c                   time                    roedat
6.11 c                   time                    roetim
6.11 c                   eval      roeusr = l_user
6.12  *
6.12  * Henter program for avkr. ref.
6.12 c                   eval      p_firm = rofirm
6.12 c                   eval      p_aar = roraar
6.12 c                   call      'RF118R'
6.12 c                   parm                    p_firm
6.12 c                   parm                    p_aar
6.12 c                   parm                    p_avkr
6.12 c                   parm                    p_spor
6.12  *
6.12  *
     c                   update    rltrlur
     c                   endif
      *
     c     xend03        tag
      *
     c                   enddo
      *
     c     xend04        tag
      *
     c                   endsr
      * eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for agio / disagio                                    *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xdagio        begsr
      *
      * Legger ut differanse som agio / disagio
      *
      * -------------------
      * Reskontropostering
      * -------------------
      *
     c                   move      rjsort        djsort
     c                   move      '1'           djsequ
     c                   move      djsort        w_sort
610  c                   move      rjmemb        w_memb
610  c                   move      *blank        w_nivo
     c     rjoulu_key    chain     rjoulur                            60
      *
      * Flytte felt til transaksjon
      *
     c                   if        *in94 = *on
     c                   move      'K'           rjreid
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      'L'           rjreid
     c                   endif
      *
     c                   move      w_sort        rjsort
     c                   eval      rjrstb = *zero
     c                   eval      rjvalb = *zero
     c                   eval      rjrstv = *zero
     c                   eval      rjrefn = *zero
     c                   eval      rjkrys = *blank
     c                   eval      rjvalk = *blank
      *
      * Kundepost
      *
     c                   if        *in94 = *on
     c                   if        a5pdif > 0
     c                   eval      rjneto = a5pdif * -1
     c                   eval      rjtext = 'DISAGIO'
     c                   else
     c                   eval      rjneto = a5pdif * -1
     c                   eval      rjtext = 'AGIO'
     c                   endif
     c                   endif
      *
      * Leverandør
      *
     c                   if        *in95 = *on
     c                   if        a5pdif > 0
     c                   eval      rjneto = a5pdif * -1
     c                   eval      rjtext = 'DISAGIO'
     c                   else
     c                   eval      rjneto = a5pdif * -1
     c                   eval      rjtext = 'AGIO'
     c                   endif
     c                   endif
      *
     c                   if        *in60 = *on
610  c                   eval      rjmemb = w_mem1
610  c                   time                    rjedat
610  c                   time                    rjetim
610  c                   eval      rjeusr = l_user
     c                   write     rjoulur
     c                   endif
      *
      * -------------------
      * Hovedbokspostering
      * -------------------
      *
      * Snu fortegn i forhold til reskontropost
      *
     c                   eval      rjneto = rjneto * -1
      *
     c                   move      '2'           djsequ
     c                   move      djsort        w_sort
610  c                   move      w_mem1        w_memb
610  c                   move      *blank        w_nivo
     c     rjoulu_key    chain     rjoulur                            60
      *
      * Hente inn faste konti
      *
     c     ra04l1_key    chain     ra04l1
      *
      * Konto for agio - Kunder
      *
     c   94              if        rjneto < 0 and
     c                             radk12 > 0
     c                   eval      rjkont = radk12
     c                   eval      rjspes = rads12
     c                   eval      rjavde = rada12
     c                   eval      rjtext = 'AGIO'
     c                   move      rnkund        rjtext
     c                   endif
      *
      * Konto for disagio - Kunder
      *
     c   94              if        rjneto > 0 and
     c                             radk13 > 0
     c                   eval      rjkont = radk13
     c                   eval      rjspes = rads13
     c                   eval      rjavde = rada13
     c                   eval      rjtext = 'DISAGIO'
     c                   move      rnkund        rjtext
     c                   endif
      *
      * Konto for agio - Leverandører
      *
     c   95              if        rjneto < 0 and
     c                             radk12 > 0
     c                   eval      rjkont = radk12
     c                   eval      rjspes = rads12
     c                   eval      rjavde = rada12
     c                   eval      rjtext = 'AGIO'
     c                   move      rolevr        rjtext
     c                   endif
      *
      * Konto for disagio - Leverandører
      *
     c   95              if        rjneto > 0 and
     c                             radk13 > 0
     c                   eval      rjkont = radk13
     c                   eval      rjspes = rads13
     c                   eval      rjavde = rada13
     c                   eval      rjtext = 'DISAGIO'
     c                   move      rolevr        rjtext
     c                   endif
      *
      * Hente momskode fra kontoregister
      *
     c                   exsr      xkonto
      *
      * Flytte over øvrige felt
      *
     c                   move      'H'           rjreid
     c                   move      w_sort        rjsort
     c                   eval      rjrstb = *zero
     c                   eval      rjvalb = *zero
     c                   eval      rjrstv = *zero
     c                   eval      rjkrys = *blank
     c                   eval      rjvalk = *blank
     c                   move      w_mvak        rjmvak
      *
     c                   if        *in60 = *on
610  c                   eval      rjmemb = w_memb
610  c                   time                    rjedat
610  c                   time                    rjetim
610  c                   eval      rjeusr = l_user
     c                   write     rjoulur
     c                   endif
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for kontantrabatt                                     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xrabat        begsr
      *
      * Legger ut differanse som rabattpostering
      *
      * -------------------
      * Reskontropostering
      * -------------------
      *
     c                   move      rjsort        djsort
     c                   move      '1'           djsequ
     c                   move      djsort        w_sort
610  c                   move      rjmemb        w_memb
610  c                   move      *blank        w_nivo
     c     rjoulu_key    chain     rjoulur                            60
      *
      * Beløp skal ha motsatt fortegn med kode for debet/kredit
      *
     c                   eval      a5pdif = a5pdif * -1
      *
      * Flytte over øvrige felt
      *
     c                   if        *in94 = *on
     c                   move      'K'           rjreid
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      'L'           rjreid
     c                   endif
      *
     c                   move      w_sort        rjsort
     c                   eval      rjrstb = *zero
     c                   eval      rjneto = a5pdif
     c                   eval      rjvalb = *zero
     c                   eval      rjrstv = *zero
     c                   eval      rjkrys = *blank
     c                   movel     mld(20)       rjtext
      *
     c                   if        *in60 = *on
610  c                   eval      rjmemb = w_mem1
610  c                   time                    rjedat
610  c                   time                    rjetim
610  c                   eval      rjeusr = l_user
     c                   write     rjoulur
     c                   endif
      *
      * -------------------
      * Hovedbokspostering
      * -------------------
      *
     c                   move      '2'           djsequ
     c                   move      djsort        w_sort
610  c                   move      w_mem1        w_memb
610  c                   move      *blank        w_nivo
     c     rjoulu_key    chain     rjoulur                            60
      *
      * Hente inn faste konti
      *
     c     ra04l1_key    chain     ra04l1
      *
      * Dummy konto
      *
     c                   move      '009999'      rjkont
     c                   move      '00'          rjspes
     c                   move      '0000'        rjavde
      *
      * Konto kontantrabatt - Kunder
      *
     c   94              if        radk07 > 0
     c                   move      radk07        rjkont
     c                   move      rads07        rjspes
     c                   move      rada07        rjavde
     c                   endif
      *
      * Konto kontantrabatt - Leverandører
      *
     c   95              if        radk16 > 0
     c                   move      radk16        rjkont
     c                   move      rads16        rjspes
     c                   move      rada16        rjavde
     c                   endif
      *
      * Hente momskode fra kontoregister
      *
     c                   exsr      xkonto
      *
      * Kunden avgiftsfri
      *
     c   94              if        rkmkod = 1
     c                   eval      w_mvak = '0'
     c                   endif
      *
      * Leverandør avgiftsfri
      *
     c   95              if        rlmkod = 1
     c                   eval      w_mvak = '0'
     c                   endif
      *
      * Flytte over øvrige felt
      *
     c                   move      'H'           rjreid
     c                   move      w_sort        rjsort
     c                   eval      rjneto = a5pdif * -1
     c                   eval      rjrstb = rjneto
     c                   eval      rjvalb = *zero
     c                   eval      rjrstv = *zero
     c                   eval      rjkrys = *blank
     c                   move      w_mvak        rjmvak
     c                   eval      rjtext = 'KONTANTRABATT'
      *
     c                   if        *in60 = *on
610  c                   eval      rjmemb = w_mem1
610  c                   time                    rjedat
610  c                   time                    rjetim
610  c                   eval      rjeusr = l_user
     c                   write     rjoulur
     c                   endif
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
T5.50 * Subrutine for omkostninger                                      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xomkost       begsr
      *
      * Legger ut differanse som omkostningspostering
      *
      * -------------------
      * Reskontropostering
      * -------------------
      *
     c                   move      rjsort        djsort
     c                   move      '1'           djsequ
     c                   move      djsort        w_sort
610  c                   move      rjmemb        w_memb
610  c                   move      *blank        w_nivo
     c     rjoulu_key    chain     rjoulur                            60
      *
      * Beløp skal ha motsatt fortegn med kode for debet/kredit
      *
     c                   eval      a5pdif = a5pdif * -1
      *
      * Flytte over øvrige felt
      *
     c                   if        *in94 = *on
     c                   move      'K'           rjreid
     c                   endif
      *
     c                   if        *in95 = *on
     c                   move      'L'           rjreid
     c                   endif
      *
     c                   move      w_sort        rjsort
     c                   eval      rjrstb = *zero
     c                   eval      rjneto = a5pdif
     c                   eval      rjvalb = *zero
     c                   eval      rjrstv = *zero
     c                   eval      rjkrys = *blank
     c                   movel     mld(25)       rjtext
      *
     c                   if        *in60 = *on
610  c                   eval      rjmemb = w_memb
610  c                   time                    rjedat
610  c                   time                    rjetim
610  c                   eval      rjeusr = l_user
     c                   write     rjoulur
     c                   endif
      *
      * -------------------
      * Hovedbokspostering
      * -------------------
      *
     c                   move      '2'           djsequ
     c                   move      djsort        w_sort
610  c                   move      w_mem1        w_memb
610  c                   move      *blank        w_nivo
     c     rjoulu_key    chain     rjoulur                            60
      *
      * Hente inn faste konti
      *
     c     ra04l1_key    chain     ra04l1
      *
      * Dummy konto
      *
     c                   move      '009999'      rjkont
     c                   move      '00'          rjspes
     c                   move      '0000'        rjavde
      *
      * Konto inkasso-provisjon - Kunder
      *
     c   94              if        radk19 > 0
     c                   move      radk19        rjkont
     c                   move      rads19        rjspes
     c                   move      rada19        rjavde
     c                   endif
      *
      * Konto kontantrabatt - Leverandører
      *
     c   95              if        radk16 > 0
     c                   move      radk16        rjkont
     c                   move      rads16        rjspes
     c                   move      rada16        rjavde
     c                   endif
      *
      * Hente momskode fra kontoregister
      *
     c                   exsr      xkonto
      *
      * Kunden avgiftsfri
      *
     c   94              if        rkmkod = 1
     c                   eval      w_mvak = '0'
     c                   endif
      *
      * Leverandør avgiftsfri
      *
     c   95              if        rlmkod = 1
     c                   eval      w_mvak = '0'
     c                   endif
      *
      * Flytte over øvrige felt
      *
     c                   move      'H'           rjreid
     c                   move      w_sort        rjsort
     c                   eval      rjneto = a5pdif * -1
     c                   eval      rjrstb = rjneto
     c                   eval      rjvalb = *zero
     c                   eval      rjrstv = *zero
     c                   eval      rjkrys = *blank
     c                   move      w_mvak        rjmvak
     c                   eval      rjtext = 'KONTANTRABATT'
      *
     c                   if        *in60 = *on
610  c                   eval      rjmemb = w_mem1
610  c                   time                    rjedat
610  c                   time                    rjetim
610  c                   eval      rjeusr = l_user
     c                   write     rjoulur
     c                   endif
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for kontroll av hovedbokskonto                        *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xkonto        begsr
      *
      * Konto-spes-avd
      *
     c                   move      rjkont        rhovl1_kont
     c                   move      rjspes        rhovl1_spes
     c                   move      rjavde        rhovl1_avde
     c     rhovl1_key    chain     rhovl1                             62
      *
     c                   if        *in62 = *on
     c                   move      *zero         rhovl1_avde
     c     rhovl1_key    chain     rhovl1                             62
     c                   endif
      *
     c                   if        *in62 = *on
     c                   move      *zero         rhovl1_spes
     c     rhovl1_key    chain     rhovl1                             62
     c                   endif
      *
     c                   move      rhmvak        w_mvak
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * M1WIN Behandle bilde for melding med svar                       *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xm1win        begsr
      *
     c                   eval      w_arow = 8
     c                   eval      w_acol = 12
     c                   move      'N'           m1svar
      *
     c                   exfmt     m1win
      *
     c                   if        *inkl = *on
     c                   move      'N'           m1svar
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * N1WIN Behandle bilde for melding uten svar                      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xn1win        begsr
      *
     c                   eval      w_arow = 8
     c                   eval      w_acol = 12
      *
     c                   exfmt     n1win
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * R1WIN Behandle bilde for overføring av restbeløp                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xr1win        begsr
      *
     c                   eval      w_arow = 4
     c                   eval      w_acol = 2
     c                   move      'J'           r1refr
     c                   move      'N'           r1hele
      *
     c     r1tagb        tag
      *
     c                   exfmt     r1win
      *
     c                   if        *inkc = *on
     c                   move      'A'           r1hele
     c                   goto      r1tage
     c                   endif
      *
      * Hele kontoen skal oppdateres, men fradato er oppgitt
      *
     c                   if        r1hele = 'J' and
     c                             r1fdat <> *zero
     c                   move      *on           *in31
     c                   goto      r1tagb
     c                   endif
      *
      * Bare enkeltposter skal oppdateres, men fradato mangler
      *
     c                   if        r1hele = 'N' and
     c                             r1fdat = *zero
     c                   move      *on           *in32
     c                   goto      r1tagb
     c                   endif
      *
     c     r1tage        tag
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * X1WIN Behandle bilde for valg av kontotype (Kun Lev)            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xx1win        begsr
      *
     c                   eval      x1valg = *blank
     c                   eval      w_arow = 6
     c                   eval      w_acol = 34
      *
     c                   write     x1win
      *
     c                   exfmt     x1win
      *
     c     *inkc         cabeq     *on           x1tag1
      *
      * Valg av kontotype
      *
     c                   if        x1vlg1 = '1'
     c                   move      '1'           x1valg
     c                   goto      x1tag1
     c                   endif
      *
     c                   if        x1vlg2 = '1'
     c                   move      '2'           x1valg
     c                   goto      x1tag1
     c                   endif
      *
     c     x1tag1        tag
      *
     c                   eval      x1vlg1 = *blank
     c                   eval      x1vlg2 = *blank
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
T5.50 * XVISFA Vis Faktura eller Arkiv                                  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xvisfa        begsr
      *
T5.50 * Henter data fra valgt linje
      *
T5.50c                   select
T5.50c                   when      w = 1
T5.50c                   eval      w_biln = b1biln
T5.50c                   move      b1dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   when      w = 2
T5.50c                   eval      w_biln = b2biln
T5.50c                   move      b2dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   when      w = 3
T5.50c                   eval      w_biln = b3biln
T5.50c                   move      b3dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   when      w = 4
T5.50c                   eval      w_biln = b4biln
T5.50c                   move      b4dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   when      w = 5
T5.50c                   eval      w_biln = b5biln
T5.50c                   move      b5dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   when      w = 6
T5.50c                   eval      w_biln = b6biln
T5.50c                   move      b6dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   when      w = 7
T5.50c                   eval      w_biln = c1biln
T5.50c                   move      c1dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   when      w = 8
T5.50c                   eval      w_biln = c2biln
T5.50c                   move      c2dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   when      w = 9
T5.50c                   eval      w_biln = c3biln
T5.50c                   move      c3dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   when      w = 10
T5.50c                   eval      w_biln = c4biln
T5.50c                   move      c4dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   when      w = 11
T5.50c                   eval      w_biln = c5biln
T5.50c                   move      c5dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   when      w = 12
T5.50c                   eval      w_biln = c6biln
T5.50c                   move      c6dato        w_aar2
T5.50c                   if        w_aar2 > 90
T5.50c                   eval      w_raar = 1900 + w_aar2
T5.50c                   else
T5.50c                   eval      w_raar = 2000 + w_aar2
T5.50c                   endif
      *
T5.50c                   endsl
      *
      * Vise faktura
      *
     c                   if        chk(w) = '8'
      *
     c                   eval      w_kund = a2kont
     c                   call      'RK110C'
     c                   parm                    w_firm
     c                   parm                    w_raar
     c                   parm                    w_kund
     c                   parm                    w_biln
     c                   endif
      *
      * Vis arkiv
      *
     c                   if        chk(w) = '9'
      *
      * Kontrollerer gyldig tilgang
      *
     c                   call      'AX700R'
     c                   parm                    w_modu
     c                   parm                    w_disp
     c                   parm                    w_tilg
      *
     c                   if        w_tilg = '0'
      *
T5.50c                   move      w_firm        w_afir
T5.50c                   eval      w_pgrp = '10'
pdf  c                   eval      w_type = 'FAKTURA'
E5.50c                   eval      w_aara = %char(w_raar)
E5.50c                   eval      w_bila = %char(w_biln)
6.22 c*                  eval      w_refn = 'FA-'+%trim(%char(w_biln))+'-'+
6.22 c*                                     %char(w_raar)
6.22 c                   eval      w_refn = %char(w_raar) +
6.22 c                                      %trim(%char(w_biln))
      *
pdf  c                   call      'AP622C'
pdf  c                   parm                    w_type
6.21 c                   parm                    w_refn
6.21 c**                 parm                    w_aara
6.21 c**                 parm                    w_bila
6.21 c**                 parm                    w_pgrp
pdf  c**pdf              call      'AH720C'
E5.50c**pdf              parm                    w_pgrp
E5.50c**pdf              parm                    w_afir
E5.50c**pdf              parm                    w_aara
E5.50c**pdf              parm                    w_bila
      *
     c                   endif
      *
     c                   endif
      *
     c                   eval      chk(w) = ' '
      *
     c                   endsr
      *
7.02  * __________________________________________________________________
7.02  *  Nullstilling av bilag som gpr i 0 fra shop
7.02  * __________________________________________________________________
7.02 c     Null_Bilag    begsr
7.02  *    Her skal man starte på RJOU på nytt
7.02 c                   move      *blank        w_nivo
7.02 c                   eval      w_memb = w_mem1
7.02 c                   eval      w_sort = *blank
7.02 c     rjoupf_key    setll     rjoupf
7.02 c                   read      rjoupf
7.02  *    Finn første bilagsnr med kundenr entetn debet eller kredit
7.02 c                   dou       %eof(rjoupf)
7.02 c                   eval      rktrl8_kund = *zero
7.02 c                   if        rjkont > ra1hkt
7.02 c                             and rjkont <= ra1hrs
7.02 c                   eval      rktrl8_kund = rjkont
7.02 c                   endif
7.02 c                   if        rktrl8_kund = w_nkund
7.02 c                             or rktrl8_kund = *zero
7.02 c                   goto      nxt_rjou
7.02 c                   endif
7.02 c                   eval      w_nkund = rktrl8_kund
7.02  *
7.02 c                   eval      w_saldo = *zero
7.02  *
7.02  *    Les alle rktr på bnr på dette bilagsnr, kunde og år.
7.02 c                   eval      rktrl8_biln = rjbiln
7.02 c     rktrl8_key    setll     rktrl8
7.02 c     rktrl8_key    reade     rktrl8
7.02 c                   dow       not %eof(rktrl8)
7.02 c                   if        rnraar = rjraar
7.02 c                   eval      w_saldo = w_saldo + rnbelØ
7.02 c                   endif
7.02 c     rktrl8_key    reade     rktrl8
7.02 c                   enddo
7.02 c
7.02  *    Les alle rktr på ref på dette bilagsnr, kunde og år
7.02 c     rktrl8_key    setll     rktrlc
7.02 c     rktrl8_key    reade     rktrlc
7.02 c                   dow       not %eof(rktrlc)
7.02 c                   if        rnraar = rjraar
7.02 c                   eval      w_saldo = w_saldo + rnbelØ
7.02 c                   endif
7.02 c     rktrl8_key    reade     rktrlc
7.02 c                   enddo
7.02  *    Dersom sum oppr.beløp nullstilles restbeløp på disse bilag og ref.
7.02 c                   if        w_saldo = 0
7.02  *
7.02  *    Les alle rktr på bnr på dette bilagsnr, kunde og år og nullstill restbeløp
7.02 c                   eval      rktrl8_biln = rjbiln
7.02 c     rktrl8_key    setll     rktrl8
7.02 c     rktrl8_key    reade     rktrl8
7.02 c                   dow       not %eof(rktrl8)
7.02 c                   if        rnraar = rjraar
7.02 c                   eval      rnrest = *zero
7.02 c                   time                    rnedat
7.02 c                   time                    rnetim
7.02 c                   update    rktrl8r
7.02 c                   endif
7.02 c     rktrl8_key    reade     rktrl8
7.02 c                   enddo
7.02 c
7.02  *    Les alle rktr på ref på dette bilagsnr, kunde og år
7.02 c     rktrl8_key    setll     rktrlc
7.02 c     rktrl8_key    reade     rktrlc
7.02 c                   dow       not %eof(rktrlc)
7.02 c                   if        rnraar = rjraar
7.02 c                   eval      rnrest = *zero
7.02 c                   time                    rnedat
7.02 c                   time                    rnetim
7.02 c                   update    rktrlcr
7.02 c                   endif
7.02 c     rktrl8_key    reade     rktrlc
7.02 c                   enddo
7.02  *
7.02 c                   endif
7.02  *
7.02 c     nxt_rjou      tag
7.02 c                   read      rjoupf
7.02 c                   enddo
7.02  *
7.02 c                   endsr
7.02  * __________________________________________________________________
7.02  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
610   * Parameterliste
     c                   eval      t = 0
     c                   eval      d = 0
     c                   eval      k = 0
     c                   eval      l = 0
     c                   eval      w = 0
     c                   eval      x = 0
     c                   eval      wsavet = 0
     c                   eval      spge01 = 0
     c                   eval      srrn01 = 0
     c                   eval      w_arow = 0
     c                   eval      w_acol = 0
     c                   eval      swtch1 = 0
     c                   eval      swtch2 = 0
     c                   eval      swtch3 = 0
     c                   eval      swtch4 = 0
     c                   eval      swtch5 = 0
     c                   eval      wantdb = 0
     c                   eval      wantkr = 0
      *
      * Kontotype
      *
     c                   eval      x1valg = *blank
      *
      * Parameterliste
      *
     c     *entry        plist
     c                   parm                    p_kont
     c                   parm                    p_call
610  c                   parm                    w_mem1
      *
      * Legge inn firmanummer og navn
      *
     c                   if        p_call = 0 or
     c                             p_call = 2
     c                   move      l_firm        w_firm
     c                   move      l_firm        p_firm
     c                   move      l_fnav        w_fnav
     c                   move      p_kont        a2kont
     c                   else
     c                   move      rjfirm        w_firm
     c                   move      rjfirm        p_firm
     c                   move      rjfirm        aaffir
     c     afirl1_key    chain     afirl1
      *
     c                   if        %found
     c                   move      aafnav        w_fnav
     c                   endif
      *
     c                   endif
      *
6.13 c                   eval      b2firm = w_firm
      *
      * Sette opp norske kroner som standard ved åpning av programmet
      *
     c                   move      *on           *in91
     c                   move      *off          *in92
     c                   movel     mld(4)        a5f010
     c                   movel     mld(5)        a5hed1
     c                   movel     mld(6)        a5hed2
      *
      * Hente inn status-records
      *
     c     raa1l1_key    chain     raa1l1r                            69
      *
     c     raa3l1_key    chain     raa3l1r                            69
      *
      * Avkryssing med referansesetting som standard
      *
     c                   if        ra3sak = '1'
     c                   move      *off          *in90
     c                   movel     mld(10)       e1head
     c                   movel     mld(11)       f1sure
     c                   eval      f1smre = *blank
     c                   else
     c                   move      *on           *in90
     c                   movel     mld(9)        e1head
     c                   movel     mld(11)       f1smre
     c                   eval      f1sure = *blank
     c                   endif
      *
      * Key for firma
      *
     c     afirl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for kunder
      *
     c     rkunl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_kont
      *
      * Key for leverandører
      *
     c     rlevl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_kont
      *
      * Key for kunde-posteringer
      *
     c     rktrlx_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_kont
     c                   kfld                    w_bdat
     c                   kfld                    w_tist
      *
     c     rktrl8_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rktrl8_kund
     c                   kfld                    rktrl8_biln
      *
      * Key for leverandør-posteringer
      *
     c     rltrlx_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_kont
     c                   kfld                    w_bdat
     c                   kfld                    w_tist
      *
      * Key for transaksjonsfile
      *
     c     rjoulu_key    klist
610  c                   kfld                    w_nivo
610  c                   kfld                    w_memb
     c                   kfld                    w_sort
      *
     c     rjoupf_key    klist
610  c                   kfld                    w_nivo
610  c                   kfld                    w_memb
     c                   kfld                    w_sort
      * Key for hovedbok
      *
     c     rhovl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rhovl1_kont
     c                   kfld                    rhovl1_spes
     c                   kfld                    rhovl1_avde
      *
      * Key for statusrecord
      *
     c     raa1l1_key    klist
     c                   kfld                    w_firm
      *
     c     raa3l1_key    klist
     c                   kfld                    w_firm
      *
      * Key for faste konti
      *
     c     ra04l1_key    klist
     c                   kfld                    w_firm
7.01  *
7.01  * Sjekk mot avkrysing av poster med avvik
7.01  *
7.01   CallP CO402R(l_filg:w_firm:0:'RF107_701':
7.01   co402_verdi1:co402_verdi2);
7.01   if co402_verdi1 = '1';
7.01     u_s701 = *on;
7.01   endif;
7.01  *
7.01  *  Aut kryssing av poster kun når det hentes fra Adra/Tele
7.01  *
7.01 c                   if        u_s701 = *on and
7.02 c                             (   %subst(w_mem1:4:4) = 'TELE'
7.02 c                              or %subst(w_mem1:4:4) = 'SHOP')
7.01 c                   eval      p_adra = 'J'
7.01 c                   endif
7.01  *
7.02  *
7.02  * Sjekk om nullstilling av bilag fra Shop
7.02  *
7.02   CallP CO402R(l_filg:w_firm:0:'NULL_BILAG_S':
7.02   co402_verdi1:co402_verdi2);
7.02   if co402_verdi1 = '1';
7.02     u_Null_Bilag_S = *on;
7.02   endif;
7.02  *
      *
     c                   endsr
      *
**
Du er allerede på begynnelsen av området                              1
Du er allerede på slutten av området                                  2
F10=Norske kroner                                                     3
F10=Valuta beløp                                                      4
  Rest Beløp                                                          5
  Oppr Beløp                                                          6
 Rest Valuta                                                          7
 Oppr Valuta                                                          8
Avkryssing m/referanse-setting                                        9
Avkryssing u/referanse-setting                                       10
Valgt                                                                11
Oppgi linjenummer for                                                12
DEBET restbeløp. . . . .:                                            13
KREDIT restbeløp . . . .:                                            14
Trykk enter                                                          15
for oppdatering                                                      16
eller oppgi kode                                                     17
A=Agio K=Kont.rab. O=Omk.                                            18
Post til avkryssing:                                                 19
Kontantrabatt                                                        20
Agio                                                                 21
Disagio                                                              22
Tilbakef. restbeløp:                                                 23
Ugyldig avkryssing,  X=Avkryssing,  S=Søking automatisk              24
Innbetaling                                                          25
**
NB! Valgte poster går ikke i null...                                  1
Er du sikker på at oppdatering skal startes ?                         2
Det er ikke foretatt noen avkryssing.                                 3
Ingen saldering kan derfor utføres.                                   4
Det er bare krysset av for debetposter,                               5
det var vel ikke meningen...                                          6
Det er bare krysset av for kreditposter,                              7
det var vel ikke meningen...                                          8
Avkryssing med referanse-setting er valgt, men det                    9
det er krysset for flere debet og kreditposter                       10
