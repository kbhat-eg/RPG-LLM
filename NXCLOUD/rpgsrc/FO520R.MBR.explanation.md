**Overview**  
This program (FO520R) displays and processes product information (“vare-opplysninger”) in the ASOFAK system. It uses a workstation file (FFO520D) and a disk file (FVVARL1, referencing VVARPFR) to retrieve data about products, then display or pass them along to other programs. The code is organized around two main display areas (“B1” and “B2”), which prompt for input, validate the product number, and branch to subprograms for further inquiries.  

---  

## Structure and Flow

1. **Initialization (*INZSR)**  
   - Clears and initializes key variables (e.g., `WRETUR`, `WDIREK`) to default values.  
   - Sets firm number (`VARFIR`) using `DSSFIR`.  
   - Moves an incoming product number into a working field (`B1VAR0`).  
   - Calls `FLSTSC` to retrieve a date for the last known stock-information register update.

2. **Parameter and File Setup**  
   - The program receives parameters (`WPEROR`, `WPFIRM`, `WPVARE`) from a previous program.  
   - The disk file `VVARL1` is keyed by `VARFIR` (firm) and `VARNUM` (product).  

3. **B1 Section (Initial Product Check)**  
   - If a product number is passed in (parameter `B1VAR0` ≠ zero), the code sets an internal flag (`WDIREK = '1'`) to indicate a direct call. It then jumps to label `B1TAG0` to bypass the normal product entry prompt.  
   - Otherwise, the program displays screen B1, prompting the user to enter a product number (or press F3/F4).  

   **Key logic in B1**  
   - Pressing F3 sets exit to the program.  
   - Pressing F4 calls `VV500R`, a product inquiry program, populates product fields, and returns control here.  
   - Once a product number is entered, the program performs a `CHAIN` to `VVARL1R`. If the product is not found, an indicator is set for the display, and the user is returned to the B1 screen. If found, it proceeds to set up the product text for the next screen (B2).  

4. **B2 Section (Inquiry Options)**  
   - Screen B2 shows details about the selected product and allows the user to choose different inquiries (by setting `B2VALG` to 01, 02, 03, etc.).  
   - Pressing F3 at B2:  
     - If `WDIREK = '1'`, the program exits immediately.  
     - Otherwise, the program returns to screen B1 logic.  

   **Inquiry Options**  
   - **01**: Calls `VA556R`, then conditionally calls `FO514R`. This sequence appears to display order lines (VA556R) and then possibly additional details (FO514R).  
   - **02**: Similar to 01, but indicates purchase lines for the product. It calls `VA556R` with `WRETUR = '1'`, then calls `LO520R` if `WRETUR` is blank afterward.  
   - **03**: Calls `LL502R` to show inventory/stock details for the product.  

5. **Exiting the Program**  
   - Label `XSLUTT` sets on the LR indicator and returns control, ending the program.

---

## Notable Details

- **Direct-Call Flag**: The variable `WDIREK` is set to `'1'` when the program is invoked with a product number already known (bypassing normal entry). This controls the logic flow for exiting (F3) from the second screen without returning to the first screen.  
- **Return Flag (`WRETUR`)**: Used to track whether a subprogram has returned control or passed it on to another program. For example, subprograms like `VA556R`, `FO514R`, or `LO520R` may update `WRETUR` to either prompt the user further or loop back to the same screen.  
- **Functional Keys**:  
  - F3 is used both to exit the program completely or backtrack depending on the context and the `WDIREK` flag.  
  - F4 triggers a call to the “product register inquiry” (`VV500R`), letting the user search for a product number.  

- **Subprogram Calls**:  
  - **VV500R**: Product register inquiry, typically used for searching a valid product.  
  - **VA556R**: Show lines for either orders or requests (depending on `WRETUR`).  
  - **FO514R**: Further order-detail program, called right after VA556R if no return flag is set.  
  - **LO520R**: Shows purchase-line details for the product.  
  - **LL502R**: Displays inventory (stock) details.  
  - **FLSTSC**: Looks up the last update date from “Lagerinformasjons-dato-register.” If the stock library (ASLAGR) was unavailable, the program sets an error code.

- **Business Context**:  
  - Each product is identified by a firm number (`VARFIR`) plus a product number (`VARNUM`).  
  - The system supports multiple inquiries: orders, purchases, and stock.  
  - The program is designed to cascade into more specialized inquiry programs and return control to the same display once subprograms complete.

---

**Key Takeaways for New Developers**  
- This program orchestrates a multi-screen inquiry for product information and calls other inquiry modules as needed.  
- Be aware of how `WRETUR` and `WDIREK` influence program flow in combination with function keys.  
- The existence of multiple tags (`B1TAG`, `B2TAG`, etc.) reflects a convention of branching to different “screens” or “phases” of user interaction.  
- Any changes to product-handling (e.g., new fields, new product statuses) often require updates in both the main program (FO520R) and the related subprograms that it invokes.