## Program Overview

**Program Name:** JV730R  
**System:** ASVADM  
**Description:**  
This batch program updates product information in the EVR (likely an inventory or product registry) for items matching a set of selection criteria. The program reads records from the JVARL5 file, applies filtering logic based on input parameters, and for each qualifying item, invokes a common subprogram (JV755R) to perform the actual update in EVR.

---

## File Definitions and Relationships

- **JVARL5**  
  - Physical file, renamed to `jvarl5r` in this program.
  - Represents the main source of item records to be evaluated and potentially updated.

- **VVARL1**  
  - Physical file, renamed to `vvarl1r`.
  - Used to validate the existence of the item (via a keyed lookup) before attempting an update.

---

## Parameters and Key Variables

- **Input Parameters** (received via *ENTRY plist):
  - `p_firm` (3,0): Company/firm identifier.
  - `p_ldor`: Selection parameter, likely a date or code (structure matches `jvldor`).
  - `p_ogrp`, `p_hgrp`, `p_ugrp`: Optional group selection parameters (match `jvogrp`, `jvhgrp`, `jvugrp`).

- **Key Variables:**
  - `jvarl5_ldor`: Used in the key list for JVARL5 file access.
  - `vvarl1_vare`: Used in the key list for VVARL1 file access.
  - `w_firm`: Local copy of the firm id for use in key lists and subprogram calls.

---

## Main Program Flow

1. **Initialization (`*INZSR`):**
   - Reads program parameters.
   - Sets up key lists for file access:
     - `jvarl5_key`: Based on `jvarl5_ldor`.
     - `vvarl1_key`: Based on `w_firm` and `vvarl1_vare`.
   - Copies the firm parameter to `w_firm`.

2. **Processing (`behandling` subroutine):**
   - Positions to the first record in JVARL5 using the provided selection key (`p_ldor`).
   - Iterates through JVARL5 records matching the key.
   - For each record:
     - Applies selection criteria for groups (`p_ogrp`, `p_hgrp`, `p_ugrp`). If any parameter is non-zero and does not match the corresponding field in the record, the item is skipped.
     - Checks if the item exists in VVARL1 (using `w_firm` and item number as key). If not found, the item is skipped.
     - Calls the common update program (JV755R) with the firm and item number as parameters.
   - Continues to the next record until all matching records are processed.

3. **Program End:**
   - Sets *INLR to *ON to indicate end of program and release resources.

---

## Business/Domain-Specific Logic

- **Selection Criteria:**
  - The program allows filtering by three group parameters. If a group parameter is set (non-zero), only items matching that group in JVARL5 are processed.
  - The main selection key (`p_ldor`) is used to limit the scope of the batch.

- **Update Logic:**
  - The actual update to EVR is not performed in this program but is delegated to a shared subprogram (`JV755R`). This is likely done for consistency and maintainability, centralizing the update logic.

- **Data Integrity:**
  - Before calling the update routine, the program verifies the existence of the item in VVARL1. This prevents unnecessary or invalid update attempts.

---

## Patterns, Conventions, and Design Decisions

- **Separation of Concerns:**
  - The program only handles selection and orchestration; the update logic is encapsulated in a separate, reusable subprogram (JV755R).
  
- **Use of Key Lists:**
  - Key lists (`klist`) are used for both JVARL5 and VVARL1, promoting clarity and maintainability in keyed file operations.

- **Parameter Passing:**
  - The program uses a parameter list for both entry parameters and for calling the update subprogram, following typical RPG batch processing conventions.

- **Error/Skip Handling:**
  - Skipping logic is handled via `goto les_neste`â€”a convention in older RPG code to avoid deep nesting when records do not meet criteria.

- **Language/Comments:**
  - Comments are in Norwegian, reflecting the likely primary user base and development team.

---

## External Dependencies

- **JV755R:**  
  - This external program is called for each qualifying item. It is responsible for updating the item information in the EVR system. You should familiarize yourself with JV755R to understand the full update process.

- **Files:**  
  - JVARL5 and VVARL1 must be defined and available in the library list. Their structures must match the field references in this program.

---

## Summary

**JV730R** is a batch driver that selects items from JVARL5 based on flexible criteria, verifies their existence in VVARL1, and delegates the update of each qualifying item to the JV755R routine. The program is structured for clarity, maintainability, and reusability, with domain logic centered on product group filtering and EVR update orchestration.