      /title  ASOFAK Utvelgelse fra vareregisteret
     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : FP212R
      * Beskrivelse . . : Velg transer, til utskrift av etiketter             *
      *
      *                   Rutinen leser vare-register og henter inn enheter,
      *                   salgspris og eventuelt tilbudspris på aktuelle
      *                   salgsenheter.
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       160699 KOB  Nytt program
      *       220200 HKO  Rettet logikk rundt utskrift av tilbudspris
      *       010900 KOB  Lagt inn logikk for data fra lageregister
      *       051003 KOB  Korrigert utskrift av priskode og lagerplass
      *       071103 KOB  Lagt ut varekode
      *       101103 KOB  Lagt inn selektering på pris fra/til dato
      *       101103 KOB  Kampanjevarer skrives uansett varetype
      *       151103 KOB  Lagt in lager i etikettregister
      * V5.30 080304 KOB  Feltet pris på etikett ble ikke lagt ut i param.
      * V5.30 130504 KOB  Ved angivelse av ordinær pris ble tilbudspris lagt ut.
      * V5.30 280904 KOB  Lagerplass fra vare hvis ikke utfylt på lager
      * V5.30 170105 KOB  Dersom "Utgårdato"er utfylt legges U i varetype
      * V5.40 230305 KOB  Lagt inn en spesialtegntabell pr skrivertype
      * V5.40 100306 KOB  Lagt inn kontroll på firma ved utvalg fra - til
      * V5.40 210406 KOB  Lagt inn kontroll av mva
      * V5.40 070606 KOB  Fjernet test mot lager midlertidig
      * V5.50 030507 KOB  Utvidet lagerplass til 8 poisjoner
      * V5.50 030507 KOB  Lagerplass hentes bare fra lagerregister
5.70  * PRGR  231008 sst  Prisgruppe
      * 6.10  260609 BSA  Oppdatert med sporingsinformasjon
5.70  * PRGR  070909 BSA  Gjeninnført innhenting av varetype fra lager.
6.11  * 6.11  021009 BSA  Skriver ut eankode tilknyttet valgte enheter
6.12  * 6.10  051109 bof  Fjernet oppslag på lagerparametere fra vare
6.13  * 6.10  010210 bof  standard kall for å hente gtin-nr
6.14  * 6.10  110310 bsa  Henter varetype også ved utv. på salgsdato
6.15  * 6.10  150310 BSA  Oppdaterer med siste utskrevne prisdato og gtin.
6.16  * 6.10  160710 BSA  Legger til sortering på leverandør og varegruppe
6.17  * 6.10  121010 BSA  Feil lengde på kalkulering av GTIN nummer hvis dette
6.17  *                   skjer ut fra varenummer.
6.18  * 6.10  291010 BSA  Kaller nytt program for retur av GTIN nummer
6.19  * 6.10  171210 BSA  Hvis ikke GTIN nummer finnes skrives 0 i feltet
6.1A  * 6.10  250512 bsa  Hvis tilbudspris benyttes, må vi regne om pris
6.1A  *                   på PSE enheten.
6.1B  * 6.10  010703 BSA  Legg inn klokkeslett på kjøretidspunkt
6.20  * 6.20  021110 bof  Utvidet med utg.dato pr. lager
6.21  * 6.20  190511 bof  Utvidet vl710r med utg.dato og lev.nr
6.22  * 6.20  080312 bof  Utvidet parm. til vp716r
6.30  * 6.30  280514 BKV  LVAR økt fra 15 til 20
6.31  * 6.30  170918 bkv  Utvidet med trelast sortiment
7.01  * 7.00  180719 bsa  Utvidet parameterliste til VP720R
7.02  * 7.00  210120 bkv  Utvidet parameterliste til VP720R
7.03  *K00    230420 bof  Parameterstyring om min/max ønskes istf.bpun/bmen
      *
8.01  *K000   181021 bsa  Hvis tilbduspris må vi justere PSE ihh.
8.02  *PRG2   090622 BOF  Utvidet prisgruppe fra 1 til 2 posisjoner
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fparam     ip   f  128        disk
     fvvarlr    if   e           k disk    rename(vvarpfr:vvarlrr)
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fvlagl1    if   e           k disk    rename(vlagpfr:vlagl1r)
     fvtill5    if   e           k disk    rename(vtilpfr:vtill5r)
     fvvprl1    if   e           k disk    rename(vvprpfr:vvprl1r)
     fvfaspf    if   e           k disk    rename(vfaspfr:vfaspfr)
     fvetil1    if   e           k disk    rename(vetipfr:vetil1r)
     fvetilu    uf a e           k disk    rename(vetipfr:vetilur)
     fvpkol1    if   e           k disk    rename(vpkopfr:vpkol1r)
     frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
6.31 fvvlel1    if   e           k disk    rename(vvlepfr:vvlel1r)
      *
     fetikett   o    f  512        disk
      *
      * Definering av variable i nøkler
      *
     d vtill5_kamp     s                   like(vtkamp)
     d rlevl1_levr     s                   like(rllevr)
     d vpkol1_pkod     s                   like(vapkod)
     d vvarlr_vare     s                   like(vvvare)
     d vlagl1_vare     s                   like(vlvare)
     d vlagl1_lage     s                   like(vllage)
     d vetil1_lage     s                   like(vmlage)
     d vetil1_vare     s                   like(vmvare)
      *
      * Definering av konstanter
      *
     d s0              c                   '&'
     d s1              c                   '\'
     d s2              c                   '"'
     d s3              c                   '"'
     d s4              c                   ' '
     d bl              c                   ' '
      *
      * Definering av variable
      *
     d w_firm          s                   like(vvfirm)
     d w_vare          s                   like(vvvare)
     d w_vare_s        s                   like(vvvare)
     d g_vare          s                   like(vvvare)
     d w_lvar          s                   like(vvlvar)
     d w_nobb          s                   like(vvnobb)
     d w_tek1          s                   like(vvtek1)
     d w_tek2          s                   like(vvtek2)
     d w_kpri          s                   like(vvkpri)
     d w_plas          s                   like(vlplas)
     d w_plas_s        s                   like(vlplas)
     d w_lage          s                   like(vmlage)
6.20 d w_udat          s               d   datfmt(*iso)
6.21 d w_bldo          s                   like(vvldor)
6.31 d w_lv_nobb       s                   like(vvlnob)
6.31 d w_lv_modn       s                   like(vvlmod)
6.31 d w_lv_lldo       s                   like(vvlnle)
6.31 d w_lv_llva       s                   like(vvllva)
      *
8.02 d w_prgr          s              2
      *
6.13 d w_eann          s             14  0
     d w_hyle          s                   like(rlhyle)
     d w_lvko          s                   like(rllvko)
     d w_pkod          s                   like(vapkod)
     d w_ptxt          s                   like(vaptxt)
     d w_sort          s                   like(vnsort)
     d w_vtxt          s                   like(vnvtxt)
     d w_etyp          s                   like(vnetyp)
     d w_etpr          s                   like(vmetpr)
     d w_vtyp          s                   like(vvvtyp)
      *
     d w_fen1          s              1  0
     d w_fen2          s              1  0
      *
     d w_edat          s               d   datfmt(*iso)
     d w_pdat          s               d   datfmt(*iso)
      *
     d w_lety          s              1  0
     d w_dato          s               d   datfmt(*iso)
     d w_time          s               t   timfmt(*iso)
6.1B d w_time2         s               t   timfmt(*iso)
     d w_enh1          s              3
     d w_sap1          s              9  2
8.01 d w_pris          s              9  2
8.01 d w_omrf          s             12  6
     d w_bup1          s              9  2
     d w_kop1          s              9  2
     d w_inp1          s              9  2
     d w_pda1          s               d   datfmt(*iso)
      *
     d w_enh2          s              3
     d w_sap2          s              9  2
     d w_bup2          s              9  2
     d w_omr2          s             12  6
     d w_pda2          s               d   datfmt(*iso)
     d w_enh3          s              3
     d w_sap3          s              9  2
     d w_bup3          s              9  2
     d w_omr3          s             12  6
     d w_pda3          s               d   datfmt(*iso)
     d w_fdat          s               d   datfmt(*iso)
     d w_ftid          s               t   timfmt(*iso)
     d w_tdat          s               d   datfmt(*iso)
     d w_ttid          s               t   timfmt(*iso)
     d w_kamp          s              5
     d w_tip1          s              9  2
     d w_tkp1          s              9  2
     d w_tip2          s              9  2
     d w_tip3          s              9  2
      *
     d w_sae1          s              3
     d w_sad1          s               d   datfmt(*iso)
     d w_sae2          s              3
     d w_sad2          s               d   datfmt(*iso)
     d w_sae3          s              3
     d w_sad3          s               d   datfmt(*iso)
     d w_tfda          s               d   datfmt(*iso)
     *
     d w_bmen          s              4  1
     d w_bpun          s              4  1
     d w_mini          s              3  0
     d w_maks          s              3  0
     d w_anta          s              4  0
     d w_tlbn          s              1  0
     d w_tlbg          s              1  0
     d wantdg          s              5  0
     d w_hnte          s              1  0
     d k               s              2  0
     d w_pri1          s              9  2
     d w_pri2          s              9  2
     d w_pri1_u        s              7  2
     d w_pri2_u        s              7  2
     d w_enin          s              3
     d w_enps          s              3
     d w_pspr          s              9  2
     d w_pspr_u        s              7  2
     d wpbel1          s             11  2
     d wpkode          s              1  0
     *
     d w_tvar          s              6
     d w_tpri          s              7
     *
     d w_mvap          s              6  2
     d w_mvat          s              5  4
     d w_mvaf          s             10  9
     *
5.70 d p_vtyp          s                   like(vvvtyp)
6.11 d b_eann          s              1    inz(*off)
6.20 d b_inlr          s              1    inz(*off)
8.01 d b_kamp          s              1    inz(*off)
7.03 d u_703           s              1    inz(*off)                            Endring 7.10
     *
     d wwvar8          s              8  0
6.17 d weannr          s             13  0
6.17 d weanna          s             13
     d weanop          s              1  0
     d weansf          s              1  0
     d wean00          s              3  0
     d wean01          s              3  0
     d wean02          s              3  0
     *
     d eana            s              1    dim(12)
     d ean             s              1  0 dim(12)
6.16  *
6.16  * Datastruktur
6.16  *
6.16 d                 ds
6.16 d d_vgrp                         7
6.16 d  d_ogrp                        2  0 overlay(d_vgrp:1)
6.16 d  d_hgrp                        2  0 overlay(d_vgrp:3)
6.16 d  d_ugrp                        3  0 overlay(d_vgrp:5)
     *
7.03  *
7.03  * Definering av eksterne prg
7.03  * BKV
7.03   dcl-s co402_verdi1  char(1);
7.03   dcl-s co402_verdi2  char(2048);
7.03   DCL-PR CO402R EXTPGM('CO402R');
7.03     p_filgrp            char(3)     const;
7.03     p_firm              packed(3:0) const;
7.03     p_lager             packed(2:0) const;
7.03     p_nokkel            char(50)    const;
7.03     p_verdi1            char(1);
7.03     p_verdi2            char(2048);
7.03   END-PR;
7.03 *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *               :  LOCAL DATA AREA                                 +
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *
     d                uds
     d l_etyp                111    111  0
     d l_etpr                112    112  0
     d l_ken1                113    113  0
     d l_ken2                114    114  0
     d l_dato                115    120  0
     d l_sort                121    121  0
     *
     d l_skty                891    891  0
6.10 d l_user                911    920
7.03 d l_filg                931    933
     d l_firm                944    946  0
     d l_lage               1001   1002  0
      *
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *                     I   N   P   U   T                            +
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *
     * Fra-til nummer
     *
     iparam     ns  01    1 cA
     i                                  2    4 0wpfirm
     i                                  5   10 0wpldor
     i                                 11   18 0wpfvnr
     i                                 26   33 0wptvnr
     i                                 41   42 0wpfogr
     i                                 43   44 0wptogr
     i                                 45   46 0wpfhgr
     i                                 47   48 0wpthgr
     i                                 49   51 0wpfugr
     i                                 52   54 0wptugr
     i                                 55   60  wpfpls
     i                                 61   66  wptpls
     i                             d   67   76  wpfdat
     i                             d   77   86  wptdat
     i                                103  106 0wpanta
     i                                107  108 0wplage
     *
     * Enkelt varenummer
     *
     i          ns  02    1 cB
     i                                  2    4 0wpfirm
     i                                 11   25  wpvare
     i                                103  106 0wpanta
     i                                107  108 0wplage
     *
     * Kampanje
     *
     i          ns  03    1 cC
     i                                  2    4 0wpfirm
     i                                  5    9  wpkamp
     i                                103  106 0wpanta
     i                                107  108 0wplage
     *
     * Salgsdato
     *
     i          ns  04    1 cD
     i                                  2    4 0wpfirm
     i                                  5   10 0wplevr
     i                             d   11   20  wpfdat
     i                             d   21   30  wptdat
     i                                103  106 0wpanta
     i                                107  108 0wplage
     *
     i          ns  99
     *
     c     dummy         tag
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     *
     * Fra til nummer
     *
     c                   if        *in01 = *on
     c                   exsr      beh_fratil
     c                   endif
     *
     * Enkeltvarer
     *
     c                   if        *in02 = *on
     c                   exsr      beh_varer
     c                   endif
     *
     * Kampanje
     *
     c                   if        *in03 = *on
     c                   exsr      beh_kampanje
     c                   endif
     *
     * Salgsdato
     *
     c                   if        *in04 = *on
     c                   exsr      beh_salgsdato
     c                   endif
      *
     c                   goto      slutt
     *
     *++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *  END OF JOB                                                     +
     *++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *
     c     slutt         tag
      *
     c/eject
     *
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *  Subrutine for utplukk fra - til                                 +
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *
     c     beh_fratil    begsr
      *
      * Leser vareregister
      *
     c                   movel     wpfvnr        vvarlr_vare
     c     vvarlr_key    setll     vvarlr
     c                   read      vvarlr                                 90
      *
     c                   dow       *in90 = *off
      *
     *  Sjekk, firma
     *
     c                   if        vvfirm <> l_firm
     c                   goto      neste
     c                   endif
5.70  *
5.70  * Kaller program for henting av varetype
5.70  *
5.70 c                   call      'VL710R'
5.70 c                   parm                    w_firm
5.70 c                   parm                    vvvare
5.70 c                   parm                    w_lage
5.70 c                   parm                    p_vtyp
6.21 c                   parm                    w_udat
6.21 c                   parm                    w_bldo
6.21 c                   parm                    b_inlr
6.31 c                   parm                    w_lv_nobb
6.31 c                   parm                    w_lv_modn
6.31 c                   parm                    w_lv_lldo
6.31 c                   parm                    w_lv_llva
     *
     * Sjekk om lagervare/ikke etikett
     *
5.70 c                   if        p_vtyp <> 'L' or
     c                             vvketi <> *zeros
     c                   goto      neste
     c                   endif
      *
     *  Sjekk, Leverandør
     *
     c                   if        wpldor <> *zero and
     c                             vvldor <> wpldor
     c                   goto      neste
     c                   endif
     *
     *  Sjekk, Varenummer
     *
     c                   if        wpfvnr <> *zeros or
     c                             wptvnr <> *zeros
     *
     c                   movel     vvvare        wwvar8
     c                   if        wwvar8 < wpfvnr or
     c                             wwvar8 > wptvnr
     c                   goto      neste
     c                   endif
     *
     c                   endif
     *
     *  Sjekk, Overgruppe
     *
     c                   if        wpfogr <> *zero or
     c                             wptogr <> *zero
     *
     c                   if        vvogrp < wpfogr or
     c                             vvogrp > wptogr
     c                   goto      neste
     c                   endif
     *
     c                   endif
     *
     *  Sjekk, Hovedgruppe
     *
     c                   if        wpfhgr <> *zero or
     c                             wpthgr <> *zero
     *                                                                 .
     c                   if        vvhgrp < wpfhgr or
     c                             vvhgrp > wpthgr
     c                   goto      neste
     c                   endif
     *                                                                 .
     c                   endif
     *
     *  Sjekk, Undergruppe
     *
     c                   if        wpfugr <> *zero or
     c                             wptugr <> *zero
     *
     c                   if        vvugrp < wpfugr or
     c                             vvugrp > wptugr
     c                   goto      neste
     c                   endif
     *
     c                   endif
      *
      * Leser lagerregister
      *
     c                   if        wplage <> w_lage
     c                   eval      w_lage = wplage
     c                   endif
      *
     c                   move      vvvare        vlagl1_vare
     c                   eval      vlagl1_lage = w_lage
     c     vlagl1_key    chain     vlagl1
     *
     c                   if        not%found
     c***                goto      neste
     c                   endif
     *
     *  Sjekk, Lagerplass
     *
     c                   eval      w_plas = vlplas
      *
     c                   if        wpfpls <> *blank and
     c                             w_plas <  wpfpls or
     c                             wptpls <> *blank and
     c                             w_plas  > wptpls
     c                   goto      neste
     c                   endif
      *
     c                   eval      w_vare = vvvare
      *
     c                   move      vvkpri        w_kpri
      *
     c                   exsr      hent_pris
      *
     c                   exsr      klar_pris
      *
     c                   exsr      klar_rest
      *
     c                   exsr      oppd_etikett
      *
     c                   except    skriv
     *
     c     neste         tag
      *
     c                   read      vvarlr                                 90
     c                   enddo
     *
     c                   endsr
     c/eject
     *
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *  Subrutine for utplukk av enkeltvarer                            +
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *
     c     beh_varer     begsr
     *
     c                   eval      w_vare = wpvare
     c     vvarl1_key    chain     vvarl1                             90
     *
     c                   if        *in90 = *off
      *
      * Leser lagerregister
      *
     c                   move      wpvare        vlagl1_vare
     c                   eval      vlagl1_lage = w_lage
     c     vlagl1_key    chain     vlagl1
     *
     *  Sjekk, Lagerplass
     *
6.12 c                   eval      w_plas = *blank
     *
     c                   if        %found(vlagl1) and
     c                             vlplas <> *blank
     c                   eval      w_plas = vlplas
     c                   endif
      *
     c                   move      vvkpri        w_kpri
      *
     c                   exsr      hent_pris
      *
     c                   exsr      klar_pris
      *
     c                   exsr      klar_rest
      *
     c                   exsr      oppd_etikett
      *
     c                   except    skriv
     *
     c                   goto      slutt
      *
     c                   endif
     *
     c                   endsr
     c/eject
     *
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *  Subrutine for utplukk på kampanje                               +
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *
     c     beh_kampanje  begsr
      *
      * Leser tilbudsregister (kampanje)
      *
     c                   eval      l_etpr = 3
     c                   eval      g_vare = *blank
      *
     c                   eval      vtill5_kamp = wpkamp
     c     vtill5_key    setll     vtill5
     c     vtill5_key    reade     vtill5                                 90
      *
     c                   dow       *in90 = *off
     *
     c                   eval      w_vare = vtvare
     c     vvarl1_key    chain     vvarl1                             90
     *
     * Sjekk om etikett skrevet før på samme vare
     *
     c                   if        w_vare = g_vare
     c                   goto      neste3
     c                   endif
      *
      * Leser lagerregister
      *
     c                   if        wplage <> w_lage
     c                   eval      w_lage = wplage
     c                   endif
      *
     c                   move      vvvare        vlagl1_vare
     c                   eval      vlagl1_lage = w_lage
     c     vlagl1_key    chain     vlagl1
     *
     c                   if        not%found
     c***                goto      neste3
     c                   endif
     *
     *  Sjekk, Lagerplass
     *
     c                   eval      w_plas = vlplas
      *
     c                   move      vvkpri        w_kpri
      *
     c                   exsr      hent_pris
      *
     c                   exsr      klar_pris
      *
     c                   exsr      klar_rest
      *
     c                   exsr      oppd_etikett
      *
     c                   except    skriv
      *
     c                   eval      g_vare = w_vare
     *
     c     neste3        tag
      *
     c     vtill5_key    reade     vtill5                                 90
     c                   enddo
     *
     c                   endsr
     c/eject
     *
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *  Subrutine for utplukk på salgsdato                              +
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *
     c     beh_salgsdato begsr
      *
     c                   eval      g_vare = *blank
      *
      * Leser prisregister
      *
     c     vvprl1_key    setll     vvprl1
     c     vvprl1_key    reade     vvprl1                                 90
      *
     c                   dow       *in90 = *off
      *
     c                   eval      w_vare = vpvare
     *
     * Sjekk om etikett skrevet før på samme vare
     *
     c                   if        w_vare = g_vare
     c                   goto      neste4
     c                   endif
     *
     * Sjekk om prisdato
     *
     c                   if        vppdat <  wpfdat or
     c                             vppdat  > wptdat
     c                   goto      neste4
     c                   endif
     *
     c     vvarl1_key    chain     vvarl1                             90
     *
     * Sjekk om lagervare/ikke etikett
     *
6.14  *
6.14  * Kaller program for henting av varetype
6.14  *
6.14 c                   call      'VL710R'
6.14 c                   parm                    w_firm
6.14 c                   parm                    vvvare
6.14 c                   parm                    w_lage
6.14 c                   parm                    p_vtyp
6.21 c                   parm                    w_udat
6.21 c                   parm                    w_bldo
6.21 c                   parm                    b_inlr
6.31 c                   parm                    w_lv_nobb
6.31 c                   parm                    w_lv_modn
6.31 c                   parm                    w_lv_lldo
6.31 c                   parm                    w_lv_llva
6.14  *
6.14 c                   if        p_vtyp <> 'L' or
     c                             vvketi <> *zeros
     c                   goto      neste4
     c                   endif
     *
     * Sjekk om riktig leverandør
     *
     c                   if        wplevr > 0 and
     c                             vvldor <> wplevr
     c                   goto      neste4
     c                   endif
      *
      * Leser lagerregister
      *
     c                   if        wplage <> w_lage
     c                   eval      w_lage = wplage
     c                   endif
      *
     c                   move      vvvare        vlagl1_vare
     c                   eval      vlagl1_lage = w_lage
     c     vlagl1_key    chain     vlagl1
     *
     c                   if        not%found
     c***                goto      neste4
     c                   endif
     *
     *  Sjekk, Lagerplass
     *
     c                   eval      w_plas = vlplas
      *
     c                   move      vvkpri        w_kpri
     c                   eval      w_dato = wptdat
     c                   eval      w_time = *loval
      *
     c                   exsr      hent_pris
      *
     c                   exsr      klar_pris
      *
     c                   exsr      klar_rest
      *
     c                   exsr      oppd_etikett
      *
     c                   except    skriv
      *
     c                   eval      g_vare = w_vare
     *
     c     neste4        tag
      *
     c     vvprl1_key    reade     vvprl1                                 90
     c                   enddo
     *
     c                   endsr
     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for henting av prisinformasjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_pris     begsr
      *
      * Kaller program for henting av pris-informasjon på tre enheter
      *
     c                   call      'VP716R'
     c                   parm                    w_firm
     c                   parm                    w_vare
5.70 c                   parm                    w_prgr
6.22 c                   parm                    w_lage
     c                   parm                    w_lety
     c                   parm                    w_dato
     c                   parm                    w_time
     c                   parm                    w_sae1
     c                   parm                    w_sap1
     c                   parm                    w_bup1
     c                   parm                    w_kop1
     c                   parm                    w_inp1
     c                   parm                    w_pda1
     c                   parm                    w_sae2
     c                   parm                    w_sap2
     c                   parm                    w_bup2
     c                   parm                    w_omr2
     c                   parm                    w_pda2
     c                   parm                    w_sae3
     c                   parm                    w_sap3
     c                   parm                    w_bup3
     c                   parm                    w_omr3
     c                   parm                    w_pda3
     c                   parm                    w_fdat
     c                   parm                    w_ftid
     c                   parm                    w_tdat
     c                   parm                    w_ttid
     c                   parm                    w_kamp
     c                   parm                    w_tip1
     c                   parm                    w_tkp1
     c                   parm                    w_tip2
     c                   parm                    w_tip3
     c                   parm                    w_enin
     c                   parm                    w_enps
     c                   parm                    w_pspr
      ******
      *                   Output: Prissammenligningsenhet og salgpris i
      *                           forhold til prissammenligningsenhet
      *
      * Finn prissammenligningsenhet enhet 1
      *
     c                   call      'VP720R'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   parm                    w_sae1
     c                   parm                    w_sap1
     c                   parm                    w_enps
     c                   parm                    w_pspr
7.01 c                   parm                    w_prgr
      ******
     c                   eval      w_tlbn = 0
     c                   eval      w_tlbg = 0
      *
     c                   eval      wantdg = *zeros
6.1B  * Sjekk tidspunkt opp mot kjøretidspunkt
6.1B c                   time                    w_time2
      *
     c                   if        w_dato >= w_fdat and
     c                             w_dato <= w_tdat
     c                   if        w_dato <> w_fdat or
     c                             w_dato =  w_fdat and
6.1B c**                           w_time >= w_ftid
6.1B c                             w_time2 >= w_ftid
     c                   if        w_dato <> w_tdat or
     c                             w_dato =  w_tdat and
6.1B c**                           w_time <= w_ttid
6.1B c                             w_time2 <= w_ttid
      *
     c                   eval      w_tlbn = 1
      *
     c                   endif
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     * Klargjør priser for etikett
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     *
     c     klar_pris     begsr
     *
     * Blanker pris/enhet
     *
8.01 c                   eval      w_pris = *zero
8.01 c                   eval      b_kamp = *off
     c                   eval      w_pri1 = *zero
     c                   eval      w_enh1 = *blank
     c                   eval      w_pri2 = *zero
     c                   eval      w_enh2 = *blank
     *
     * Pris skal ikke skrives
     *
     c                   if        l_etpr = 1
     c                   goto      klar_pris_end
     c                   endif
     *
     * Bruk vanlig pris
     *
     c                   if        l_etpr = 2
     c                   eval      w_tlbn = 0
     c                   endif
     *
     *  Legger inn riktig pris avhengig av enhet
     *
     C                   select
     *
     C                   when      w_fen1 = 3
     c                   if        w_bup3 > 0
     c                   eval      w_pri1 = w_bup3
8.01 c                   eval      w_pris = w_bup3
     c                   else
     C                   eval      w_pri1 = w_sap3
8.01 c                   eval      w_pris = w_sap3
     c                   endif
     C                   eval      w_enh1 = w_sae3
     C                   eval      w_edat = w_sad3
     c                   if        w_tlbn = 1 and
     c                             w_tip3 > 0
     c                   eval      w_kpri = 'T'
     c                   eval      w_pri1 = w_tip3
8.01 c                   eval      b_kamp = *on
     c                   endif
     *
     C                   when      w_fen1 = 2
     c                   if        w_bup2 > 0
     C                   eval      w_pri1 = w_bup2
8.01 c                   eval      w_pris = w_bup2
     c                   else
     C                   eval      w_pri1 = w_sap2
8.01 c                   eval      w_pris = w_sap2
     c                   endif
     C                   eval      w_enh1 = w_sae2
     C                   eval      w_edat = w_sad2
     c                   if        w_tlbn = 1 and
     c                             w_tip2 > 0
     c                   eval      w_kpri = 'T'
     c                   eval      w_pri1 = w_tip2
8.01 c                   eval      b_kamp = *on
     c                   endif
     *
     C                   when      w_fen1 = 1
     c                   if        w_bup1 > 0
     C                   eval      w_pri1 = w_bup1
8.01 c                   eval      w_pris = w_bup1
     c                   else
     C                   eval      w_pri1 = w_sap1
8.01 c                   eval      w_pris = w_sap1
     c                   endif
     C                   eval      w_enh1 = w_sae1
     C                   eval      w_edat = w_sad1
     c                   if        w_tlbn = 1 and
     c                             w_tip1 > 0
     c                   eval      w_kpri = 'T'
     c                   eval      w_pri1 = w_tip1
8.01 c                   eval      b_kamp = *on
     C                   eval      w_edat = w_fdat
     c                   endif
     *
     C                   endsl
     *
     C                   select
     *
     C                   when      w_fen2 = 3
     c                   if        w_bup3 > 0
     C                   eval      w_pri2 = w_bup3
     c                   else
     C                   eval      w_pri2 = w_sap3
     c                   endif
     C                   eval      w_enh2 = w_sae3
     c                   if        w_tlbn = 1 and
     c                             w_tip3 > 0
     c                   eval      w_pri2 = w_tip3
     c                   endif
     *
     C                   when      w_fen2 = 2
     c                   if        w_bup2 > 0
     C                   eval      w_pri2 = w_bup2
     c                   else
     C                   eval      w_pri2 = w_sap2
     c                   endif
     C                   eval      w_enh2 = w_sae2
     c                   if        w_tlbn = 1 and
     c                             w_tip2 > 0
     c                   eval      w_pri2 = w_tip2
     c                   endif
     *
     C                   when      w_fen2 = 1
     c                   if        w_bup1 > 0
     C                   eval      w_pri2 = w_bup1
     c                   else
     C                   eval      w_pri2 = w_sap1
     c                   endif
     C                   eval      w_enh2 = w_sae1
     c                   if        w_tlbn = 1 and
     c                             w_tip1 > 0
     c                   eval      w_pri2 = w_tip1
     c                   endif
     *
     C                   endsl
6.1A  *
6.1A  * Hvis tilbudspris skal det være ny pris på PSE
8.01  * Justert da den ikke fungerer optimalt
8.01 c                   if        b_kamp = *on
8.01 c                   eval      w_omrf = w_pris/w_pri1
8.01 c                   eval(h)   w_pspr = w_pspr/w_omrf
8.01 c                   endif
8.01  * Erstattes av kode over
8.01 c                   if        1 = 2
6.1A c                   if        w_kpri = 'T'
6.1A c                   call      'VP720R'
6.1A c                   parm                    w_firm
6.1A c                   parm                    w_vare
6.1A c                   parm                    w_enh1
6.1A c                   parm                    w_pri1
6.1A c                   parm                    w_enps
6.1A c                   parm                    w_pspr
7.02 c                   parm                    w_prgr
6.1A c                   endif
8.01 c                   endif
      *
      * Hent mva-sats
      *
      * Ordinær sats
      *
     c                   if        vvkmva = 0
      *
     c                   call      'FÅ705R'
     c                   parm                    w_firm
     c                   parm                    w_dato
     c                   parm                    w_mvap
     c                   parm                    w_mvat
     c                   parm                    w_mvaf
     *
     c                   endif
      *
      * Avgiftsfritt
      *
     c                   if        vvkmva = 1
     C                   eval      w_mvat = 1
     c                   endif
      *
      * Halv mva
      *
     c                   if        vvkmva = 2
      *
     c                   call      'FÅ706R'
     c                   parm                    w_firm
     c                   parm                    w_dato
     c                   parm                    w_mvap
     c                   parm                    w_mvat
     c                   parm                    w_mvaf
     *
     c                   endif
     *
     *  Beregner pris med MVA
     *
     C                   eval(h)   w_pri1 = w_pri1 * w_mvat
     C                   eval(h)   w_pri2 = w_pri2 * w_mvat
     C                   eval(h)   w_pspr = w_pspr * w_mvat
     *
     *  Øreavrunding  pris 1
     *
     c                   move      4             wpkode
     c                   eval      wpbel1 = w_pri1
     c                   call      'FA910R'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   parm                    wpkode
     c                   parm                    wpbel1
     *
     c                   if        wpbel1 > 99999
     c                   eval      w_pri1_u = 99999
     c                   else
     c                   eval      w_pri1_u = wpbel1
     c                   endif
     *
     *  Øreavrunding  pris 2
     *
     c                   eval      wpbel1 = w_pri2
     c                   call      'FA910R'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   parm                    wpkode
     c                   parm                    wpbel1
     *
     c                   if        wpbel1 > 99999
     c                   eval      w_pri2_u = 99999
     c                   else
     c                   eval      w_pri2_u = wpbel1
     c                   endif
     *
     *  Øreavrunding  sammenligningspris
     *
     c                   eval      wpbel1 = w_pspr
     c                   call      'FA910R'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   parm                    wpkode
     c                   parm                    wpbel1
     *
     c                   if        wpbel1 > 99999
     c                   eval      w_pspr_u = 99999
     c                   else
     c                   eval      w_pspr_u = wpbel1
     c                   endif
     *
     * Hvis pris1 er null
     *
     c                   eval      *in71  = *off
     c                   if        w_pri1_u <> *zeros
     c                   eval      *in71  = *on
     c                   endif
     *
     * Hvis pris2 er null
     *
     c                   eval      *in72  = *off
     c                   if        w_pri2_u <> *zeros
     c                   eval      *in72  = *on
     c                   endif
     *
     * Hvis sammenligningspris er null
     *
     c                   eval      *in73  = *off
     c                   if        w_pspr_u <> *zeros
     c                   eval      *in73  = *on
     c                   endif
      *
     c     klar_pris_end endsr
     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     * Klargjør felter for etikett
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     *
     c     klar_rest     begsr
     *
     * Henter EAN-kode fra EAN-register
     *
     c                   exsr      hntean
     *
     * Legger eget varenummer i EAN-kode
     * dersom EAN-kode ikke utfylt
     *
6.19  * Skal ikke konstruere NOBBnr hvis det ikke finnes på VVEP eller VEAN.
6.19  * Legger inn dummy test, slik at GTIN nummer ikke kalkuleres
6.19 c                   if        1 = 2
     c                   if        w_eann = *zero
     c                   movel     vvvare        wwvar8
     c                   eval      weannr = wwvar8
     c                   exsr      eansjk
     c                   movel     weannr        w_eann
     c                   move      weansf        w_eann
     c                   endif
6.19 c                   endif
     *
     *   Henter leverandøropplysninger
     *
     c                   eval      w_lvko = *zeros
     c                   eval      w_hyle = *zeros
     c                   eval      w_lvar = *blank
     *
     c                   if        vvldor <> *zero
     *
     c                   move      vvldor        rlevl1_levr
     c     rlevl1_key    chain     rlevl1                             86
     *
     c                   if        *in86 = *off
     c                   eval      w_lvko = rllvko
     c                   eval      w_hyle = rlhyle
6.31 c                   if        w_lv_nobb > 0
6.31 c                   move      w_lv_llva     w_lvar
6.31 c                   else
     c                   move      vvlvar        w_lvar
6.31 c                   endif
     c                   endif
     *
     c                   endif
7.03  *
7.03 c                   if        u_703 = *on
7.03 *
7.03 *  Legger inn mini
7.03 *
7.03 c                   if        vlmini <> *zero
7.03 c                   if        vlmini <= 999,9
7.03 c                   eval      w_bpun = vlmini
7.03 c                   else
7.03 c                   eval      w_bpun = 999,9
7.03 c                   endif
7.03 c                   endif
7.03 *
7.03 *
7.03 *  Legger inn max
7.03 *
7.03 c                   if        vlmaks <> *zero
7.03 c                   if        vlmaks <= 999,9
7.03 c                   eval      w_bmen = vlmaks
7.03 c                   else
7.03 c                   eval      w_bmen = 999,9
7.03 c                   endif
7.03 c                   endif
7.03 c                   else
     *
     *  Legger inn bestillingspunkt
     *
     c                   if        vlbpun <> *zero
     c                   if        vlbpun <= 999,9
     c                   eval      w_bpun = vlbpun
     c                   else
     c                   eval      w_bpun = 999,9
     c                   endif
     *
6.12 c                   endif
     *
     *
     *  Legger inn bestillingsmengde
     *
     c                   if        vlbmen <> *zero
     c                   if        vlbmen <= 999,9
     c                   eval      w_bmen = vlbmen
     c                   else
     c                   eval      w_bmen = 999,9
     c                   endif
     *
6.12 c                   endif
7.03 c                   endif
     *
     *
     *  Legger inn minimumsbeholdning
     *
     c                   if        vlmini <> *zero
     c                   if        vlmini <= 999
     c                   eval      w_mini = vlmini
     c                   else
     c                   eval      w_mini = 999
     c                   endif
     *
6.12 c                   endif
     *
     *  Legger inn maksimumsbeholdning
     *
     c                   if        vlmaks <> *zero
     c                   if        vlmaks <= 999
     c                   eval      w_maks = vlmaks
     c                   else
     c                   eval      w_maks = 999
     c                   endif
     *
6.12 c                   endif
     *
     *
     *  Hent tekst for priskode
     *
     c                   move      *blanks       w_ptxt
     *
     c                   if        w_kpri <> ' '
     c                   eval      vpkol1_pkod = w_kpri
     c     vpkol1_key    chain     vpkol1r
     c                   if        %found
     c                   move      vaptxt        w_ptxt
     c                   endif
     c                   endif
     *
     * Kontroller tekstfelt for ugyldige karakterer
     *
     c                   eval      w_tek1 = *blank
     c                   select
     c                   when      l_skty = 0
     c     s0:bl         xlate     vvtek1        w_tek1
     c                   when      l_skty = 1
     c     s0:bl         xlate     vvtek1        w_tek1
     c     s1:bl         xlate     vvtek1        w_tek1
     c                   when      l_skty = 2
     c     s2:bl         xlate     vvtek1        w_tek1
     c                   when      l_skty = 3
     c     s3:bl         xlate     vvtek1        w_tek1
     c                   when      l_skty = 4
     c     s4:bl         xlate     vvtek1        w_tek1
     c                   other
     c                   movel     vvtek1        w_tek1
     c                   endsl
     *
     c                   eval      w_tek2 = *blank
     c                   select
     c                   when      l_skty = 0
     c     s0:bl         xlate     vvtek2        w_tek2
     c                   when      l_skty = 1
     c     s1:bl         xlate     vvtek2        w_tek2
     c                   when      l_skty = 2
     c     s2:bl         xlate     vvtek2        w_tek2
     c                   when      l_skty = 3
     c     s3:bl         xlate     vvtek2        w_tek2
     c                   when      l_skty = 4
     c     s4:bl         xlate     vvtek2        w_tek2
     c                   other
     c                   movel     vvtek2        w_tek2
     c                   endsl
     *
     * Sortering på varenummer/lagerplass
     *
6.16 c                   if        w_sort = 0
     c                   eval      w_plas_s = *blank
     c                   eval      w_vare_s = w_vare
6.16 c                   endif
6.16 c                   if        w_sort = 1
     c                   eval      w_plas_s = w_plas
     c                   eval      w_vare_s = w_vare
     c                   endif
6.16  * Sortering på leverandør og lagerplass/varenummer
6.16 c                   if        w_sort = 2
6.16 c                   movel     vvldor        w_plas_s
6.16 c                   if        w_plas <> *blank
6.16 c                   movel     w_plas        w_vare_s
6.16 c                   else
6.16 c                   eval      w_vare_s = w_vare
6.16 c                   endif
6.16 c                   endif
6.16  * Sortering på varegruppe og leverandør
6.16 c                   if        w_sort = 3
6.16 c                   eval      d_ogrp = vvogrp
6.16 c                   eval      d_hgrp = vvhgrp
6.16 c                   eval      d_ugrp = vvugrp
6.16 c                   movel     d_vgrp        w_plas_s
6.16 c                   movel     vvldor        w_vare_s
6.16 c                   endif
     *
6.31 c                   if        w_lv_nobb > 0
6.31 c                   move      w_lv_nobb     w_nobb
6.31 c                   else
     c                   move      vvnobb        w_nobb
6.31 c                   endif
     *
     * Antall min=1, max=500
     *
     c                   if        wpanta = 0
     c                             or wpanta > 500
     c                   eval      w_anta = 1
     c                   else
     c                   eval      w_anta = wpanta
     c                   endif
     *
     *  Legg ut etikettype
     *
     c                   eval      w_etyp = l_etyp
     *
     *  Legg ut varetype - U dersom varen har utgårdato
6.20  *
6.20 c                   if        w_udat <> *loval
     c                   eval      w_vtyp = 'U'
     c                   else
5.70 c                   eval      w_vtyp = p_vtyp
     c                   endif
     *
     c                   endsr
      *
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *   Henter ean-nr
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *
     c     hntean        begsr
     *
6.13 c                   eval      w_eann = *zeros
6.13 c                   eval      b_eann = *off
6.13  *
6.18 c**                 call      'VE712R'
6.18 c                   call      'VE716R'
6.13 c                   parm                    w_firm
6.13 c                   parm                    w_vare
6.13 c                   parm                    w_eann
6.13 c                   parm                    b_eann
     *
     c                   endsr
      *
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *   Sjekk om siste siffer i EAN-koden er riktig (Mod10)            +
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *
     c     eansjk        begsr
     *
     c                   eval      wean00 = *zero
     c                   eval      wean02 = *zero
     c                   eval      weansf = *zero
     *
     c                   move      weannr        weanna
     c                   movea     weanna        eana
     c                   move      eana          ean
     *
     c                   eval      wean00 = ean(02) + ean(04)
     c                   eval      wean00 = wean00 + ean(06)
     c                   eval      wean00 = wean00 + ean(08)
     c                   eval      wean00 = wean00 + ean(10)
     c                   eval      wean00 = wean00 + ean(12)
     c                   eval      wean00 = wean00 * 3
     *
     c                   eval      wean00 = wean00 + ean(01)
     c                   eval      wean00 = wean00 + ean(03)
     c                   eval      wean00 = wean00 + ean(05)
     c                   eval      wean00 = wean00 + ean(07)
     c                   eval      wean00 = wean00 + ean(09)
     c                   eval      wean00 = wean00 + ean(11)
     *
     c                   move      wean00        wean02
     c                   move      '0'           wean02
     c                   eval      wean02 = wean02 + 10
     *
     c                   eval      wean01 = wean02 - wean00
     c                   move      wean01        weansf
     *
     c                   endsr
     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     * Oppdater etikett-register
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     *
     c     Oppd_etikett  begsr
     *
     c                   eval      vetil1_lage = w_lage
     c                   move      vvvare        vetil1_vare
     c     vetil1_key    chain     vetilu
     *
     c                   if        %found
     *
     c                   eval      vmsdat = w_dato
     c                   eval      vmetyp = w_etyp
6.15 c                   eval      vmsapr = w_pri1_u
6.15 c                   eval      vmgtin = w_eann
     *
     c                   if        w_tlbn = 1
     c                   eval      vmtdat = w_fdat
     c                   endif
     *
6.10 c                   time                    vmetim
6.10 c                   time                    vmedat
6.10 c                   eval      vmeusr = l_user
     *
     c                   update    vetilur
     *
     c                   else
     *
     c                   eval      vmfirm = w_firm
     c                   eval      vmlage = w_lage
     c                   eval      vmvare = w_vare
     c                   eval      vmenhe = w_enh1
     c                   eval      vmetyp = w_etyp
     c                   eval      vmetpr = w_etpr
     c                   eval      vmfen1 = w_fen1
     c                   eval      vmfen2 = w_fen2
     c                   eval      vmsdat = w_dato
     c                   eval      vmtdat = w_tdat
6.15 c                   eval      vmsapr = w_pri1_u
6.15 c                   eval      vmgtin = w_eann
     *
6.10 c                   time                    vmotim
6.10 c                   time                    vmodat
6.10 c                   eval      vmousr = l_user
6.10 c                   time                    vmetim
6.10 c                   time                    vmedat
6.10 c                   eval      vmeusr = l_user
     c                   write     vetilur
     *
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for les av vare-register
      *
     c     vvarlr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarlr_vare
      *
      * Key for les av tilbuds-register
      *
     c     vtill5_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vtill5_kamp
      *
      * Key for les av pris-register
      *
     c     vvprl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på vare-register
      *
     c     vvarl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_vare
      *
      * Key for oppslag på lagerregister
      *
     c     vlagl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vlagl1_vare
     c                   kfld                    vlagl1_lage
      *
      * Key for oppslag på leverandør-register
      *
     c     rlevl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl1_levr
      *
      * Key for oppslag på fastregister-etiketter
      *
     c     vfaspf_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på priskoder
      *
     c     vpkol1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vpkol1_pkod
      *
      * Key for oppslag på etikett-register
      *
     c     vetil1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vetil1_vare
     c                   kfld                    vetil1_lage
      *
      * Henter firma fra parameter
      *
     c                   eval      w_firm = l_firm
     c                   eval      w_lage = l_lage
     *
     * Henter koder fra fast-register
     *
     c                   eval      w_fen1 = l_ken1
     c                   eval      w_fen2 = l_ken2
     c                   eval      w_sort = l_sort
     c                   eval      w_etpr = l_etpr
     *
     c     vfaspf_key    chain     vfaspf
     c                   if        %found
     c                   eval      w_vtxt = vnvtxt
     c                   endif
      *
      * Initierer parametre
      *
     c                   eval      w_sae1 = *blank
     c                   eval      w_sap1 = 0
     c                   eval      w_kop1 = 0
     c                   eval      w_inp1 = 0
     c                   eval      w_bup1 = 0
     c                   eval      w_sae2 = *blank
     c                   eval      w_sap2 = 0
     c                   eval      w_bup2 = 0
     c                   eval      w_omr2 = 0
     c                   eval      w_sae3 = *blank
     c                   eval      w_sap3 = 0
     c                   eval      w_bup3 = 0
     c                   eval      w_omr3 = 0
     c                   eval      w_fdat = *loval
     c                   eval      w_ftid = *loval
     c                   eval      w_tdat = *loval
     c                   eval      w_ttid = *loval
     c                   eval      w_kamp = *blank
     c                   eval      w_tip1 = 0
     c                   eval      w_tkp1 = 0
     c                   eval      w_tip2 = 0
     c                   eval      w_tip3 = 0
      *
     c                   eval      w_tvar = 'Varenr'
     c                   eval      w_tpri = 'Pris   '
      *
     c                   eval      w_etyp = l_etyp
     c                   eval      w_anta = 1
      *
     c     *dmy          move      l_dato        w_dato
     c                   eval      w_time = *loval
      *
     c                   call      'FÅ705R'
     c                   parm                    w_firm
     c                   parm                    w_dato
     c                   parm                    w_mvap
     c                   parm                    w_mvat
     c                   parm                    w_mvaf
5.70  *
5.70  * Henter prisgruppe
5.70  *
5.70 c                   call      'VL711R   '
5.70 c                   parm                    w_prgr
      *
7.03  *
7.03  * Endring 7.03
7.03  *
7.03   CallP CO402R(l_filg:w_firm:0:'FP212R_703':
7.03                    co402_verdi1:co402_verdi2);
7.03   if co402_verdi1 = '1';
7.03     u_703 = *on;
7.03   endif;

      *
     c                   endsr
      *
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *                   O   U   T   P   U   T                          +
     *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     *
     oetikett   e            skriv
     o                       w_anta               4
     o                       w_vtxt              19
     o                       w_tvar              25
     o                       w_tpri              32
     o                       w_dato              45
     o                       w_nobb              53
     o                       w_vare              73
     o                       w_eann              86
6.30 O                       w_lvar             106
6.30 O                       w_tek1             141
6.30 O                       w_tek2             176
6.30 O                       w_enh1             179
6.30 O               71      w_pri1_u           187 '   0 ,  '
6.30 O                       w_enh2             190
6.30 O               72      w_pri2_u           198 '   0 ,  '
6.30 O                       w_ptxt             203
6.30 o                       w_bpun             208
6.30 o                       w_bmen             213
6.30 o                       w_hyle             214
6.30 o                       w_lvko             215
6.30 o                       w_plas             223
6.30 o                       w_etyp             224
6.30 o                       w_mini             227 '   '
6.30 o                       w_maks             230 '   '
6.30 o                       w_vtyp             231
6.30 o                       w_enin             234
6.30 o                       w_enps             237
6.30 o               73      w_pspr_u           245 '   0 ,  '
      *
      * Sorteringsrekkefølge
      *
     o                       w_plas_s           457
     o                       w_vare_s           472
