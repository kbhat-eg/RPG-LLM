# Program RA005R â€“ Maintenance of Status Codes

## Purpose and Overview

This program (RA005R) is part of the ASOKON system and is responsible for the maintenance of status code 5. The business context appears to be related to company (firma) management, with specific emphasis on updating and maintaining a set of fields associated with a particular status code. The code is written in traditional (fixed-format) RPG IV and interacts mainly with two physical files: `raa5pfr` (using two logical views: `raa5l1` and `raa5lu`).

## File Usage and Data Flow

- **raa5l1**: Logical file used for reading existing status code 5 records.
- **raa5lu**: Logical file used for updating or writing status code 5 records.
- Both files are based on the same physical file (`raa5pfr`) but are used with different access paths (keyed access).
- **ra005d**: Workstation file for screen interaction (display file).

## Key Data Structures

- **l_user, l_firm, l_fnav**: User, firm number, and firm name, likely passed in from the environment or display file.
- **p_stat, p_ckod, p_ctxt, p_ctx2**: Work variables for status code manipulation.
- **w_firm**: Local firm number, set at program initialization.
- **a25xxx / ra5xxx**: Field naming convention for status code 5 data. Prefix `a25` is used for screen/work variables, `ra5` for database fields.

## Indicator Usage

- **Function Key Indicators**:
    - `KA` (F1): Select company.
    - `KC` (F3): Exit program.
- **LR**: End of program.
- **30**: Protect fields when displaying.
- **31-59**: Error/warning indicators.
- **60-69**: File operation indicators (chain, etc.).
- **70-79**: Subroutine work indicators.
- **80-89**: General work indicators.
- **90-99**: Standard subroutine indicators.

## Screen Handling

- The program uses a single display format, `A2BLD`, for maintenance of status code 5.
- The main interaction loop is built around the `exfmt a2bld` operation, which displays the screen and waits for user input.

## Main Processing Logic

### Initialization (`*inzsr` Subroutine)

- Sets up the local firm number (`w_firm`) from the input field (`l_firm`).
- Attempts to read the existing status code 5 record for the firm (`raa5l1_key chain raa5l1`).
    - If found, moves all relevant fields from the database (`ra5xxx`) to the screen/work variables (`a25xxx`).
    - Handles a special case for the `ra5ida` field: if it is at its lowest value, sets `a25pda` to 0.
- Prepares key lists for both logical files, using `w_firm` as the key.

### Main Screen Loop

- After initialization, the program enters a label-based control flow (`a2taga`, `a2tagb`).
- Displays the maintenance screen (`exfmt a2bld`).
- Resets error indicators (`*in31` to `*in36`).
- Checks for exit function keys (`F3` or `Exit`), and jumps to program end if pressed.
- Validates the `a25rpg` field (Bankgiro type):
    - Only allows values 'G', 'S', or 'R'.
    - If not valid, sets error indicator `*in36` and redisplays the screen.
- Updates or creates the status code 5 record:
    - Attempts to chain the record in the update file (`raa5lu`).
    - Moves data from screen/work variables (`a25xxx`) to database fields (`ra5xxx`).
    - Updates `ra5dat`, `ra5tim`, and `ra5usr` with current date, time, and user.
    - If the record is found, updates it; otherwise, writes a new record (ensuring `ra5fir` is set).

### Program Termination

- On exit, sets `*inlr` to `*on` and returns, ending the program.

## Business/Domain-Specific Logic

- **Status Code 5**: The code is focused on this particular status code, which is likely significant in your business process (e.g., a specific customer or company status).
- **Bankgiro Type Validation**: Only certain values are allowed for the bankgiro type, enforced at the UI level before any database update.
- **Audit Fields**: The program updates audit fields (`ra5dat`, `ra5tim`, `ra5usr`) on every change.
- **Firm-Specific Data**: All maintenance is performed per firm; the firm number is central to all file accesses.

## Design Decisions and Conventions

- **Field Naming**: Consistent use of prefixes (`a25` for screen/work, `ra5` for database) facilitates mapping and maintenance.
- **Error Handling**: Uses indicator variables to signal errors and redisplay the screen.
- **Screen Loop**: Relies on RPG's classic tag/goto structure for main interaction, which is typical for legacy green-screen applications.
- **Key Lists**: Uses key lists (`klist`) for file access, which is standard for handling multi-field keys.

## Integration Points

- **Display File**: Interacts with a display file (presumably DDS-based) for user input and output, specifically the `A2BLD` format.
- **Physical Files**: All data persistence is handled via the `raa5pfr` physical file, with logical views for reading and updating.

## Notable Change History

- Telephone number and e-mail fields were added in version 5.50.
- There are notes about GUI-related changes, but these only affect the DDS (display file), not this RPG logic.

## Summary

This program is a focused maintenance utility for status code 5 records, operating on a per-firm basis. It provides controlled screen-based editing, validates critical fields, and maintains audit information. The code adheres to established conventions for indicator usage, field naming, and file access, making it consistent with other modules in this system. New developers should familiarize themselves with the business meaning of status code 5 and the structure of `raa5pfr` to fully understand the impact of changes made by this program.