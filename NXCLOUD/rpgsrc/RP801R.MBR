      /TITLE  ASOKON Utskrift av prosjektrapport  (ny løsning 2013)
     H datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOKON
      * Program . . . . : RP801R
      * Beskrivelse . . : Utskrift av prosjekt rapport
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       230913 sst  Nytt program
      *       011013 sst  xml utlegging til Proa
6.20  *       081113 sst  Endringer vedr parameter fra til prosjekt
6.21  *       310314 sst  Justeringer vedr lage standardrapporter
6.30  *       181115 sst  Valg om hittil i prosjektet eller i år
6.31  *       231115 sst  Skille på aktive og aktive m/posteringer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     frprrl1    if   e           k disk    rename(rprrpfr:rprrl1r)
     frhtrlc    if   e           k disk    rename(rhtrpfr:rhtrlcr)
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
     frp1pl1    if   e           k disk    rename(rp1ppfr:rp1pl1r)
     frp1plr    if   e           k disk    rename(rp1ppfr:rp1plrr)
     filonl1    if   e           k disk    rename(ilonpfr:ilonl1r)
     frhovl1    if   e           k disk    rename(rhovpfr:rhovl1r)
     f**wsumpf    uf a e           k disk    rename(wsumpfr:wsumpfr)
      *
     frp801p    o    e             printer
      *
     d t               s             11  2 dim(10000)
     d h               s             13  2 dim(10000)
      *
      * Definering av Local data area
      *
     d                uds
     d l_ruti                800    809
     d l_alin                856    858  0
     d l_wsid                901    910
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
     d XML_Output      s            256a   Varying
     d XML_path        s            256a
     d Out_path        s            256a
      *
     d tmpdate         s               d
      *
     d w_dtaq          s              1a
      *
      * Definering av arbeidsfelterr
      *
     d w_timestamp     s             12  0
     d w_pretk         s              1
     d w_pfper         s              4  0
     d w_ptper         s              4  0
     d w_firm          s              3  0
     d w_sumt          s             11  2
     d w_sumh          s             13  2
     d w_tkto          s             11  2
     d w_hkto          s             11  2
     d w_plin          s              4  0
     d w_ltxt          s             30
     d w_lin           s              3  0
     d wcurkto         s              6  0
     d wcursps         s              4  0
     d wcuravd         s              4  0
     d wlin            s                   like(rphlin)
     d i               s              5  0
     d w_f             s              6
     d w_t             s              6
     d w_p             s              6
     d w_bfper         s              6  0
      *
     d afirl1_fir      s                   like(aaffir)
     d rhtrlc_fir      s                   like(rbfirm)
     d rhtrlc_pro      s                   like(rbhpro)
     d rhtrlc_kon      s                   like(rbkont)
     d rhtrlc_aar      s                   like(rbraar)
     d rhtrlc_per      s                   like(rbrper)
     d rhtrlc_bda      s                   like(rbbdat)
     d rprrl1_fir      s                   like(rphfir)
     d rprrl1_rap      s                   like(rphrap)
     d rprrl1_lin      s                   like(rphlin)
     d rprrl1_uli      s                   like(rphuli)
     d rp1pl1_fir      s                   like(rp1frm)
     d rp1pl1_pro      s                   like(rp1pro)
     d rp1plr_fir      s                   like(rp1frm)
     d rp1plr_pro      s                   like(rp1pro)
     d ilonl1_kli      s                   like(ilrkli)
     d ilonl1_lnr      s                   like(ilrlnr)
     d rhovl1_fir      s                   like(rhfirm)
     d rhovl1_kto      s                   like(rhkont)
     d rhovl1_sps      s                   like(rhspes)
     d rhovl1_avd      s                   like(rhavde)
      *
      *
      * Definering av parameter
      *
     d p_dpf           s              6
     d p_dpt           s              6
     d p_rapp          s              4
     d p_pro           s              6
     d p_prof          s              6
     d p_prot          s              6
     d p_avdx          s              4
     d p_prox          s              5
     d p_sts           s              1
      *  p_sts    ' '=Alle,  '1'=Aktive,  '2'=Avsluttede
     d dpf             s              6  0
     d dpt             s              6  0
6.30 d w_hitfx         s              6
6.30 d w_hitf          s              6  0
     d p_rap           s              4  0
     d p_avd           s              4  0
     d p_prol          s              5  0
6.30 d p_hit           s              1
      *
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    Dersom prosjekt ikke valgt men avdeling og/eller prosjektleder
      *     Kjøres følgende loop for å få fram alle prosjekter som er valgt
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     c     loop          tag
     c                   if        (p_prof <> *blank and
     c                              p_prot <> *blank) or
     c                             (p_avd <> *zero or
     c                              p_prol <> *zero)
     c                   eval      rp1plr_fir = w_firm
     c                   eval      rp1plr_pro = *blank
     c     rp1plr_key    setll     rp1plr
     c                   read      rp1plr
     c                   dow       not %eof(rp1plr)
     c                   if        rp1pro = 'A150' or
     c                             rp1pro = '10002'
     c                   eval      rp1pro = rp1pro
     c                   endif
      *   Test på firma
     c                   if        rp1frm <> l_firm
     c                   goto      p_ikkeMed
     c                   endif
      *   Bare aktive prosjekter?
     c                   if        p_sts = '1' and
     c                             rp1sts = 'A'
     c                   goto      p_ikkeMed
     c                   endif
      *   Bare avsluttede prosjekter?
     c                   if        p_sts = '2' and
     c                             rp1sts <> 'A'
     c                   goto      p_ikkeMed
     c                   endif
      *    Valg på Avdeling?
     c                   if        p_avd <> 0 and
     c                             rp1avd <> p_avd
     c                   goto      p_IkkeMed
     c                   endif
      *    Konvertere tegn på prosjekt for test
     c                   eval      w_p = rp1pro
     c                   exsr      knvAscii
      *    Test på fra - til Prosjekt
     c                   if        w_f <> *blank and
     c                             w_t <> *blank and
     c                             (w_p < w_f or
     c                              w_p > w_t)
     c                   goto      p_IkkeMed
     c                   endif
      *
6.31  * Test om det finnes poster før skriv
6.31 c                   if        p_sts = '3'
6.31 c                   eval      rhtrlc_fir = w_firm
6.31 c                   eval      rhtrlc_pro = rp1pro
6.31 c                   eval      rhtrlc_kon = *zero
6.31 c                   eval      rhtrlc_aar = *zero
6.31 c                   eval      rhtrlc_per = *zero
6.31 c                   eval      rhtrlc_bda = *loval
6.31 c     rhtrlc_key    setll     rhtrlc
6.31 c                   read      rhtrlc
6.31 c                   if        not %eof(rhtrlc)
6.31 c                   dow       rbfirm = w_firm and
6.31 c                             rbhpro = rp1pro
     c                   eval      w_bfper = rbraar * 100 + rbrper
6.31 c                   if        w_bfper >= w_hitf  and
     c                             w_bfper <= dpt
6.31 c                   goto      p_Med_per
6.31 c                   endif
     c                   read      rhtrlc
     c                   enddo
     c                   goto      p_IkkeMed
     c                   else
     c                   goto      p_IkkeMed
6.31 c                   endif
6.31 c                   endif
6.31  *
     c     p_Med_Per     tag
     c                   eval      p_pro = rp1pro
     c                   eval      t = *zero
     c                   eval      h = *zero
     c                   exsr      behpro
     c     p_IkkeMed     tag
     c                   read      rp1plr
     c                   enddo
      *
     c                   else
     c                   exsr      behpro
     c                   endif
      *
      *
      * Avslutt
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandling av et prosjekt
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behpro        begsr
      *
     c                   eval      rprrl1_fir = w_firm
     c                   eval      rprrl1_rap = p_rap
     c                   eval      rprrl1_lin = *zero
     c                   eval      rprrl1_uli = *zero
     c     rprrl1_key    setll     rprrl1
     c     rprrl1_key    reade     rprrl1
     c                   exsr      hode
     c                   dow       rphrap = p_rap  and
     c                             not %eof(rprrl1)
     c                   exsr      raplin
     c     rprrl1_key    reade     rprrl1
     c                   enddo
      *
      * Avslutt
      *
     c                   exsr      avslutt
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandle en linje fra rapportdefinisjon RPRRPF
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     raplin        begsr
      *
     c                   if        rphlin = 40
     c                   eval      rphlin = rphlin
     c                   endif
      *
     c                   eval      w_ltxt = rphtxt
     c                   eval      w_plin = rphlin
      *
     c                   if        rphktf > *zero and
     c                             rphktt = *zero
     c                   eval      rphktt = rphktf
     c                   endif
      *
     c                   if        rphbef > *zero and
     c                             rphbet = *zero
     c                   eval      rphbet = rphbef
     c                   endif
      *
     c                   select
     c                   when      rphktf > 0
     c                   exsr      Poster
     c                   if        rphskr = 'J'
      *                  Skriv     rapportlinje
     c                   exsr      nylin
     c                   eval      d1linj = *blank
     c                   eval      %subst(d1linj:1:4) = %char(w_plin)
     c                   eval      %subst(d1linj:7:30) = w_ltxt
     c                   eval      d1tal = t(w_plin)
     c                   eval      d1hit = h(w_plin)
     c                   write     d1dtl                                30
     c                   endif
     c                   goto      lrapp
      *
     c                   when      rphfun = '-'
     c                   eval      w_sumt = t(rphli1) - t(rphli2)
     c                   eval      w_sumh = h(rphli1) - h(rphli2)
      *
     c                   when      rphfun = '+'
     c                   if        rphfrt <> 'J'
     c                   eval      w_sumt = t(rphli1) + t(rphli2)
     c                   eval      w_sumh = h(rphli1) + h(rphli2)
     c                   else
     c                   eval      w_sumt = *zero
     c                   eval      w_sumh = *zero
     c                   for       i = rphli1 to rphli2
     c                   eval      w_sumt = w_sumt + t(i)
     c                   eval      w_sumh = w_sumh + h(i)
     c                   endfor
     c                   endif
      *
     c                   when      rphfun = '%'
     c                   if        rphpro > 0
     c                   eval      w_sumt = t(rphli1) * rphpro / 100
     c                   eval      w_sumh = h(rphli1) * rphpro / 100
     c                   endif
      * debug
     c                   if        rbhpro = '11105' or
     c                             rbhpro = '11106'
     c                   eval      rbhpro = rbhpro
     c                   endif
     c                   if        rphli2 > 0
     c                   if        t(rphli2) <> 0
     c                   select
     c                   when      (100 / t(rphli2) * t(rphli1)) >999999999
     c                   eval      w_sumt = 999999999
     c                   when      (100 / t(rphli2) * t(rphli1)) < -999999999
     c                   eval      w_sumt = -999999999
     c                   other
     c                   eval      w_sumt = 100 / t(rphli2) * t(rphli1)
     c                   endsl
     c                   else
     c                   eval      w_sumt = *zero
     c                   endif
     c                   if        h(rphli2) <> 0
     c                   eval      w_sumh = 100 / h(rphli2) * h(rphli1)
     c                   else
     c                   eval      w_sumh = *zero
     c                   endif
     c                   endif
      *
     c                   endsl
      *
     c                   if        w_plin > 0
     c                   eval      t(w_plin) = w_sumt
     c                   eval      h(w_plin) = w_sumh
     c                   endif
      *
      *    Skriver ut linje for rapportlinje
     c                   if        rphskr = 'J'
     c                   exsr      nylin
     c                   eval      d1linj = *blank
     c                   eval      %subst(d1linj:1:4) = %char(w_plin)
     c                   eval      %subst(d1linj:7:30) = w_ltxt
     c                   eval      d1tal = w_sumt
     c                   eval      d1hit = w_sumh
     c                   write     d1dtl                                30
     c                   endif
      *
      *   Oppdater hjelperegister
     c*                  if        rphlin > 0
     c*                  eval      wlin = rphlin
     c*                  eval      wtal = w_sumt
     c*                  eval      whit = w_sumh
     c*                  write     wsumpfr
     c*                  endif
     c     lrapp         tag
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandle posteringer til en linje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     Poster        begsr
      *
     c                   eval      rhtrlc_fir = w_firm
     c                   eval      rhtrlc_pro = p_pro
     c                   eval      rhtrlc_kon = rphktf
     c                   eval      rhtrlc_aar = *zero
     c                   eval      rhtrlc_per = *zero
     c                   eval      rhtrlc_bda = *loval
     c     rhtrlc_key    setll     rhtrlc
     c                   read      rhtrlc
     c                   dow       rbhpro = p_pro   and
     c                             rbkont <= rphktt and
     c                             not %eof(rhtrlc)
     c                   eval      wcurkto = rbkont
     c                   eval      wcursps = rbspes
     c                   eval      wcuravd = rbavde
      *    do_konto
     c                   eval      w_tkto = *zero
     c                   eval      w_hkto = *zero
     c                   dow       rbhpro = p_pro   and
     c                             rbkont = wcurkto and
     c                             not %eof(rhtrlc)
      *  Dersom fra til bærer testes dette for hver konto/transaksjon
     c                   if        rphbef > *zero   and
     c                             (rbspes < rphbef  or
     c                              rbspes > rphbet)
     c                   goto      LesNeste
     c                   endif
      *
6.30  *  Dersom hittil gjelder bare i år så hoppes over dersom eldre trans
6.30 c                   if        p_hit = 'J' and
6.30 c                             (rbrper + rbraar*100) < w_hitf
6.30 c                   goto      LesNeste
6.30 c                   endif
      *
      *    Snu fortegn dersom funksjon i rapportmal tilsier det
     c                   if        rphfun = '-'
     c                   eval      rbneto = rbneto * -1
     c                   endif
     c                   eval      wlin = rphlin
     c*    wlin          chain     wsumpf
     c*                  if        %found(wsumpf)
     c                   if        (rbrper+rbraar*100) <= dpt
     c*                  eval      whit = whit + rbneto
     c                   eval      w_hkto = w_hkto + rbneto
     c                   eval      h(wlin) = h(wlin) + rbneto
     c                   endif
     c                   if        (rbrper+rbraar*100) >= dpf and
     c                             (rbrper+rbraar*100) <= dpt
     c*                  eval      wtal = wtal + rbneto
     c                   eval      w_tkto = w_tkto + rbneto
     c                   eval      t(wlin) = t(wlin) + rbneto
     c                   endif
     c*                  update    wsumpfr
     c*                  else
     c*                  if        (rbrper+rbraar*100) <= dpt
     c*                  eval      whit = rbneto
     c*                  eval      w_hkto = w_hkto + rbneto
     c*                  eval      h(wlin) = rbneto
     c*                  endif
     c*                  if        (rbrper+rbraar*100) >= dpf and
     c*                            (rbrper+rbraar*100) <= dpt
     c*                  eval      wtal = rbneto
     c*                  eval      w_tkto = w_tkto + rbneto
     c*                  eval      t(wlin) = rbneto
     c*                  endif
     c*                  write     wsumpfr
     c*                  endif
     c                   if        rphlpo = 'J' and
     c                             (rbrper+rbraar*100) >= dpf and
     c                             (rbrper+rbraar*100) <= dpt
     c*                  skriv postering
     c                   exsr      nylin
     c                   eval      d1linj = *blank
     c                   eval      %subst(d1linj:1:4)   = %char(w_plin)
     c                   eval      %subst(d1linj:7:5)   = %char(rbkont)
     c                   eval      %subst(d1linj:13:10) = %char(rbbdat)
     c                   eval      %subst(d1linj:24:4)  = %char(rbraar)
     c                   eval      %subst(d1linj:28:1)  = '-'
     c                   eval      %subst(d1linj:29:2)  = %char(rbrper)
     c                   eval      %subst(d1linj:32:17) = rbtext
     c                   eval      d1tal = rbneto
     c                   eval      d1hit = *zero
     c                   write     d1dtl                                30
     c                   endif
      *    Les neste postering
     c     LesNeste      tag
     c                   read      rhtrlc
      *    enddo_postering
     c                   enddo
      *    Skrive konto?
     c                   if        rphlkt = 'J'
     c*                  skriv konto_sum
     c                   exsr      nylin
     c                   eval      d1linj = *blank
     c                   eval      %subst(d1linj:1:4) = %char(wlin)
     c                   eval      %subst(d1linj:7:5) = %char(wcurkto)
     c                   eval      rhovl1_fir = w_firm
     c                   eval      rhovl1_kto = wcurkto
     c                   eval      rhovl1_sps = wcursps
     c                   eval      rhovl1_avd = wcuravd
     c     rhovl1_key    chain     rhovl1
     c                   if        not %found(rhovl1)
     c                   eval      rhovl1_avd = *zero
     c     rhovl1_key    chain     rhovl1
     c                   endif
     c                   if        not %found(rhovl1)
     c                   eval      rhovl1_sps = *zero
     c     rhovl1_key    chain     rhovl1
     c                   endif
     c                   if        %found(rhovl1)
     c                   eval      %subst(d1linj:13:20) = rhtext
     c                   else
     c                   eval      %subst(d1linj:13:20) = 'Ukjent konto'
     c                   endif
     c                   eval      d1tal = w_tkto
     c                   eval      d1hit = w_hkto
     c                   write     d1dtl                                30
     c                   endif
      *    enddo_rapportlinje
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av hode-opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hode          begsr
      *
      * Skriver header
      *
     c                   eval      a1side = a1side + 1
     c                   eval      a1firm = l_firm
     c                   eval      a1fnav = l_fnav
     c                   eval      a1rapp = rphtxt
     c                   write     a1hdr
     c*                  if        w_forste = *on
     c                   eval      a2pro = p_pro
     c                   eval      rp1pl1_fir = w_firm
     c                   eval      rp1pl1_pro = p_pro
     c     rp1pl1_key    chain     rp1pl1
     c                   if        %found(rp1pl1)
     c                   eval      a2nav  = rp1txt
     c                   eval      ilonl1_kli = l_firm
     c                   eval      ilonl1_lnr = rp1prl
     c                   eval      a2sbn      = rp1prl
     c     ilonl1_key    chain     ilonl1
     c                   if        %found(ilonl1)
     c                   eval      a2sbh  = ilrnav
     c                   else
     c                   eval      a2sbh  = 'Ukjent'
     c                   endif
     c                   else
     c                   eval      a2nav  = 'Ukjent'
     c                   endif
     c                   eval      a2fper = p_dpf
     c                   eval      a2tper = p_dpt
     c                   write     a2hdr1
     c*                  endif
     c                   eval      w_lin = 10
      *
     c                   eval      *in61 = *off
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å telle linjer samt skrive ny heading
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     nylin         begsr
      *
     c                   eval      w_lin = w_lin + 1
     c                   if        w_lin > 47
     c                   exsr      hode
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for avslutte rapport
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     avslutt       begsr
      *
      * Skriver header
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for konvertering fra Hex til ????  Ascii
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     KnvAscii      begsr
      *
     c     ' ':X'00'     xlate     w_p           w_p
     c     '0':X'01'     xlate     w_p           w_p
     c     '1':X'02'     xlate     w_p           w_p
     c     '2':X'03'     xlate     w_p           w_p
     c     '3':X'04'     xlate     w_p           w_p
     c     '4':X'05'     xlate     w_p           w_p
     c     '5':X'06'     xlate     w_p           w_p
     c     '6':X'07'     xlate     w_p           w_p
     c     '7':X'08'     xlate     w_p           w_p
     c     '8':X'09'     xlate     w_p           w_p
     c     '9':X'10'     xlate     w_p           w_p
     c     'A':X'11'     xlate     w_p           w_p
     c     'a':X'11'     xlate     w_p           w_p
     c     'B':X'12'     xlate     w_p           w_p
     c     'b':X'12'     xlate     w_p           w_p
     c     'C':X'13'     xlate     w_p           w_p
     c     'c':X'13'     xlate     w_p           w_p
     c     'D':X'14'     xlate     w_p           w_p
     c     'd':X'14'     xlate     w_p           w_p
     c     'E':X'15'     xlate     w_p           w_p
     c     'e':X'15'     xlate     w_p           w_p
     c     'F':X'16'     xlate     w_p           w_p
     c     'f':X'16'     xlate     w_p           w_p
     c     'G':X'17'     xlate     w_p           w_p
     c     'g':X'17'     xlate     w_p           w_p
     c     'H':X'18'     xlate     w_p           w_p
     c     'h':X'18'     xlate     w_p           w_p
     c     'I':X'19'     xlate     w_p           w_p
     c     'i':X'19'     xlate     w_p           w_p
     c     'J':X'20'     xlate     w_p           w_p
     c     'j':X'20'     xlate     w_p           w_p
     c     'K':X'21'     xlate     w_p           w_p
     c     'k':X'21'     xlate     w_p           w_p
     c     'L':X'22'     xlate     w_p           w_p
     c     'l':X'22'     xlate     w_p           w_p
     c     'M':X'23'     xlate     w_p           w_p
     c     'm':X'23'     xlate     w_p           w_p
     c     'N':X'24'     xlate     w_p           w_p
     c     'n':X'24'     xlate     w_p           w_p
     c     'O':X'25'     xlate     w_p           w_p
     c     'o':X'25'     xlate     w_p           w_p
     c     'P':X'26'     xlate     w_p           w_p
     c     'p':X'26'     xlate     w_p           w_p
     c     'Q':X'27'     xlate     w_p           w_p
     c     'q':X'27'     xlate     w_p           w_p
     c     'R':X'28'     xlate     w_p           w_p
     c     'r':X'28'     xlate     w_p           w_p
     c     'S':X'29'     xlate     w_p           w_p
     c     's':X'29'     xlate     w_p           w_p
     c     'T':X'30'     xlate     w_p           w_p
     c     't':X'30'     xlate     w_p           w_p
     c     'U':X'31'     xlate     w_p           w_p
     c     'u':X'31'     xlate     w_p           w_p
     c     'V':X'32'     xlate     w_p           w_p
     c     'v':X'32'     xlate     w_p           w_p
     c     'W':X'33'     xlate     w_p           w_p
     c     'w':X'33'     xlate     w_p           w_p
     c     'X':X'34'     xlate     w_p           w_p
     c     'x':X'34'     xlate     w_p           w_p
     c     'y':X'35'     xlate     w_p           w_p
     c     'y':X'35'     xlate     w_p           w_p
     c     'Z':X'36'     xlate     w_p           w_p
     c     'z':X'36'     xlate     w_p           w_p
     c     'Æ':X'37'     xlate     w_p           w_p
     c     'æ':X'37'     xlate     w_p           w_p
     c     'Ø':X'38'     xlate     w_p           w_p
     c     'ø':X'38'     xlate     w_p           w_p
     c     'Å':X'39'     xlate     w_p           w_p
     c     'å':X'39'     xlate     w_p           w_p
      *
     c                   endsr
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for les på koderegister
      *
     c     afirl1_key    klist
     c                   kfld                    afirl1_fir
      *
      * Key for les på rapportoppsett
      *
     c     rprrl1_key    klist
     c                   kfld                    rprrl1_fir
     c                   kfld                    rprrl1_rap
     c*                  kfld                    rprrl1_lin
     c*                  kfld                    rprrl1_uli
      *
      * Key for les på posteringer
      *
     c     rhtrlc_key    klist
     c                   kfld                    rhtrlc_fir
     c                   kfld                    rhtrlc_pro
     c                   kfld                    rhtrlc_kon
     c                   kfld                    rhtrlc_aar
     c                   kfld                    rhtrlc_per
     c                   kfld                    rhtrlc_bda
      *
      * Key for les på rProsjekt
      *
     c     rp1pl1_key    klist
     c                   kfld                    rp1pl1_fir
     c                   kfld                    rp1pl1_pro
      *
      * Key for les flere Prosjekt
      *
     c     rp1plr_key    klist
     c                   kfld                    rp1plr_fir
     c                   kfld                    rp1plr_pro
      *
      * Key for oppslag på Prosjektleder
      *
     c     ilonl1_key    klist
     c                   kfld                    ilonl1_kli
     c                   kfld                    ilonl1_lnr
      *
      * Key for oppslag på Kontoplan
      *
     c     rhovl1_key    klist
     c                   kfld                    rhovl1_fir
     c                   kfld                    rhovl1_kto
     c                   kfld                    rhovl1_sps
     c                   kfld                    rhovl1_avd
      *
      *
     C     *ENTRY        PLIST
     c                   parm                    p_dpf
     c                   parm                    p_dpt
     c                   parm                    p_prof
     c                   parm                    p_prot
     c                   parm                    p_rapp
     c                   parm                    p_avdx
     c                   parm                    p_prox
     c                   parm                    p_sts
6.30 c                   parm                    p_hit
     *
     * Legge inn firmanr.
     *
     c                   eval      w_firm = l_firm
     c                   move      p_dpf         dpf
     c                   move      p_dpt         dpt
6.30  *  Bruker fra periode som grunnlag for hittil i år.
6.30 c                   move      p_dpf         w_hitfx
6.30 c                   move      '01'          w_hitfx
6.30 c                   move      w_hitfx       w_hitf
     c                   move      p_rapp        p_rap
     c                   move      p_avdx        p_avd
     c                   move      p_prox        p_prol
     c                   if        dpt = *zero
     c                   eval      dpt = dpf
     c                   endif
6.30 c                   if        p_hit = 'J'
6.30 c                   eval      a2hit = 'Hittil i år'
6.30 c                   else
6.30 c                   eval      a2hit = '     Hittil'
     c                   eval      w_hitf = *zero
6.30 c                   endif
     *
     c                   eval      w_p = p_prof
     c                   exsr      knvAscii
     c                   eval      w_f = w_p
     c                   eval      w_p = p_prot
     c                   exsr      knvAscii
     c                   eval      w_t = w_p
     *
4.51 c                   eval      afirl1_fir  = w_firm
     c     afirl1_key    chain     afirl1                             60
     *
     c                   eval      a1user = l_user
     c                   eval      a1wsid = l_wsid
      *
      * Legger inn arb.stasjon og bruker i faste felter
      *
     c                   time                    w_timestamp
      *
     c                   endsr
