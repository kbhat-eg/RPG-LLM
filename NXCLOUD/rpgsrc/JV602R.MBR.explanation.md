# Documentation for JV602R – Print Item Register with Item and Search Texts

## Overview

**Program:** JV602R  
**System:** ASVARE  
**Purpose:**  
JV602R is a report program that prints a detailed item register, including item texts and associated search texts. The printout is filtered and grouped according to a comprehensive set of parameters, such as supplier, user signature, item groupings, item numbers, and change dates. The report is primarily used for auditing or reviewing the item master data, with special focus on descriptive and search texts tied to each item.

## File Interactions

- **JVARPFR (jvarl9):** Main item master file. Each record represents an item with associated fields (groups, supplier, texts, etc.).
- **JSOKPFR (JSOKL1):** Search text file. Contains search texts for items, filtered by item number and type.
- **AFIRPFR (AFIRL1):** Company register. Used to retrieve company information for the header.
- **JLEVPFR (JLEVL1):** Supplier register. Used to retrieve supplier names for grouping in the report.
- **AUSRPFR (AUSRL1):** User register. Used to retrieve user names for the report header.

## Parameter Handling

The program receives a parameter list (`p_parm`, 120 bytes) containing all filter and context data. This is unpacked into the `d_list` data structure, with overlays for each individual parameter:

- **Company, supplier, user, groupings, item number ranges, and date ranges** are all parsed from this structure.
- **Dates** are handled in *ISO format*.

## Program Flow

### Initialization (`*INZSR`)

- Sets up work variables and flags.
- Defines key lists for file access.
- Copies the entry parameter into the working data structure (`d_list`).
- Initializes the supplier group break field (`A4LDOR`) to a high value.

### Main Execution

1. **Header Section (`HODE` subroutine):**
    - Populates header fields with company, user, workstation, and date/time information.
    - Retrieves company and user names for display.
    - Fetches and displays parameter descriptions (supplier, user, groupings, item numbers, dates).
    - Writes three header lines to the report.

2. **Detail Section (`DETALJ` subroutine):**
    - Initializes filter work fields from parameters.
    - Reads the item master file (JVARPFR) in key order.
    - For each item, applies a series of filters:
        - **Supplier:** Skips items not matching the supplier filter.
        - **User signature:** Skips items not matching user filter.
        - **Main/under group:** Skips items outside group filter range.
        - **Item number:** Skips items outside item number range.
        - **Change date:** Skips items outside date range.
    - On a supplier break, fetches and prints a sub-header for the new supplier group.
    - Gathers item details and up to three search texts (`L` type) from JSOKPFR.
    - Writes a detail line for each qualifying item.
    - Handles page overflow by writing header lines again.

3. **Overflow Section (`OVERFLOW` subroutine):**
    - Reprints header lines when page overflow occurs.

### End of Program

- Sets LR indicator (`*INLR`) to release resources and ends the program.

## Business/Domain Logic

- **Supplier Grouping:**  
  The report is grouped by supplier. On a supplier change, a new sub-header is printed with supplier details.
- **Filtering:**  
  The report can be filtered by supplier, user, groupings (main/under), item number range, and change date range.
- **Search Texts:**  
  For each item, up to three search texts (type `L`) are fetched and printed in the detail line.
- **Parameterization:**  
  The use of a packed parameter structure allows the program to be called flexibly from other programs or job streams, passing in all necessary context in a single block.

## Notable Design Decisions and Conventions

- **Data Structure Overlays:**  
  The use of overlays on the parameter data structure (`d_list`) is a convention in this codebase to efficiently unpack parameter lists.
- **Key Lists (`KLIST`):**  
  All file access is done via keyed access, with keys defined by `KLIST` for clarity and maintainability.
- **Group Break Handling:**  
  Supplier group breaks are detected and handled inline, with the relevant sub-header printed on each break.
- **Overflow Management:**  
  The program manages print page overflow explicitly, reprinting headers as needed.
- **Localization:**  
  Some comments and variable names are in Norwegian, reflecting the program's origin and business context.

## Interactions with Other Modules

- **Parameter Passing:**  
  JV602R is designed to be called from other programs, passing in its entire filter context as a parameter block.
- **Master Data Dependency:**  
  Relies on up-to-date master data in the item, supplier, user, and company files.
- **Output:**  
  The report is written to a printer file (`JV602P`), which should be defined externally.

## Summary Table – Key Parameters

| Parameter   | Purpose                          | Overlay Field | Type/Length |
|-------------|----------------------------------|--------------|-------------|
| Company     | Company number                   | `wpfirm`     | 3,0         |
| Supplier    | Supplier number                  | `wpldor`     | 6,0         |
| User        | User signature                   | `wpeusr`     | 10A         |
| Main Group  | Main group (from/to)             | `wpogrf`, `wphgrf`, `wpugrf` | 2,0/3,0 |
| Under Group | Under group (from/to)            | `wpogrt`, `wphgrt`, `wpugrt` | 2,0/3,0 |
| Item No.    | Item number (from/to)            | `wpvarf`, `wpvart` | 15A    |
| Date        | Change date (from/to)            | `wpedaf`, `wpedat` | Date  |

## Key Points for New Developers

- **Parameter unpacking** is central to how this program is controlled.
- **Group breaks and overflow** are managed manually for precise report formatting.
- **Business logic** is tightly coupled to Norwegian master data conventions and naming.
- **Search text logic** is limited to three lines per item and only includes texts of type `L`.
- **All record access is keyed**; understand the key structures for each file.

---

**For further onboarding:**  
Familiarize yourself with the master files (JVARPFR, JSOKPFR, AFIRPFR, JLEVPFR, AUSRPFR), their keys, and the conventions for parameter passing in this application suite. This will help you maintain, extend, or integrate JV602R into other business processes.