```markdown
# IBM ILE RPG Program: RL910R - Supplier Saldering (Vendor Saldo)

This RPG/400 program manages a supplier saldo (balance) display with search and paging functionality, using subfiles for user interaction. It's a good example of classic interactive RPG/400 code that combines display files, indexed database file access, and embedded SQL.

---

## **1. Header, History, and Indicators**

- **Header**:
  - `h option(*nodebugio) datedit(*dmy)`
    - Disables debug input/output.
    - Date format day/month/year.
- **Commentary**:
  - Explains the program purpose ("Leverandør, saldering" = "Supplier, saldering"), author, change log, and indicator usage.
- **Indicators**:
  - Lists standard meanings for indicators (LR: program end, 10: rollup, 11: rolldown, etc.)
  - 31–79: error messages/screen flags; 80–99: work indicators.

---

## **2. File Declarations**

- **Physical Files**:
  - `frlevlr`, `frlevl1`, `frlevl2`, `frltrl1`: Keyed-disk files, renamed for record format clarity.
  - `frlsopf`: Keyed-disk file, likely for search results.
- **Display File**:
  - `frl910d`: Workstation file with subfile `b1sfl` (using `w_srrn` as the relative record number).

---

## **3. Data Definitions**

### **From the Data Area (LDA)**
  - User, firm, and name fields are obtained.

### **Key Variables**
  - Used for file positioning: `rlevlr_levr`, `rlevl1_levr`, `rlevl2_alfa`, `rltrl1_levr`.

### **Working Variables**
  - Subfile counters: `w_stel`, `w_spge`, `w_srrn`, `w_sfrn`, `w_ssrn`
  - Search text: `w_ste1` to `w_ste5`, `b2stek`, etc.
  - Other: opening/search states (`w_seqe`, `b_open_sok`), dates, selection variables, position info, etc.

### **Constants**
  - `c_sfil`: Page size for the subfile (default 12).

### **Screen & Subfile Documentation**
  - Explains the use of variables to track subfile paging, search fields, etc.

---

## **4. SQL Option Setting (for embedded SQL usage)**
```rpg
C/Exec SQL
C+  Set Option DatFmt=*ISO, DlyPrp=*YES, SRTSEQ=*LANGIDUNQ, LANGID=NOR
C/End-Exec
```
- Ensures all SQL date fields use ISO format, delayed preparation, proper sort sequence, and language Norwegian.

---

## **5. Main Program Flow**

### **Main Display Loop**
- Tags (`b2taga`, `b2tagb`) organize the workflow.
- `write b2cmd`: Write command screen.
- `exsr dsp_subfile`: Show subfile.
- **Function key handling** (using classic `select`):
    - *inkc, *inkl*: Exit
    - *inke*: Refresh subfile (`exsr forny`)
    - *in10*: Create subfile page (`exsr crt_subfile`)
    - *in11*: Go back a page (`exsr bck_subfile`)
    - *in21*: Home key (set cursor)
- **Additional logic** for search repeat (F9), searching, positioning, and subfile processing.

### **Exit**
- At `avslutt` tag, set *inlr (last record) indicator to end the program and return.

---

## **6. Subroutines**

### **forny** (Refresh Subfile)
- Repositions the file pointer for the current subfile page and sequence.
- Selects whether to use search sequence (`S`), alpha sequence (`A`), or by vendor number.

### **søk** (Search Subfile)
- Sets up subfile for search mode (`w_seqe='S'`).
- Calls program `AS700R` to parse search text into up to 5 search terms.
- Clears and refills the subfile with search results.
- Clears the search field post-search.

### **posisjoner** (Position in Subfile)
- Repositions subfile to a given vendor number or alphabetic key.
- Clears and refills the subfile as appropriate.

### **subfile** (Process Subfile Rows)
- Toggles display flags for subfile.
- Loops through the subfile rows using `readc` to process user selections:
    - If the user marks selection (e.g., with value 8), it calls another program (`RF107R`) for saldo handling.
- Triggers a subfile refresh if necessary.

### **xc2bld** (Show Details Screen - C2BLD)
- Calls another program `RK502R` to show/detail vendor info. Updates state indicators for screen protection.

### **clr_subfile** (Clear Subfile)
- Sets SFLCLR indicator, writes a control record to clear the subfile, and resets counters.

### **crt_subfile** (Create/Fill Subfile Page)
- Calculates page range for the subfile.
- If searching: declares/opens SQL cursor, fetches matching records (with LIKE for search terms).
- If not searching: walks the traditional files (by alpha or by vendor).
- Applies multiple search term filtering using `%scan`.
- Only includes vendors with positive outstanding balance (`rorest > 0`) by scanning detail file (`rltrl1`).
- Fills subfile screen rows with vendor info and saldo sum (`exsr sum_poster`).
- Updates paging variables.

### **bck_subfile** (Back One Page in Subfile)
- Navigates the files backwards by page size, sets pointers for next read.

### **dsp_subfile** (Display Subfile)
- If subfile has records, sets display indicator; otherwise, shows command screen.
- Shows subfile control screen with expected input.

### **sum_poster** (Sum Postings)
- Sums all positive balances (`rorest > 0`) for a given vendor and returns the subtotal.

### **\*inzsr** (Initialization Subroutine)
- Sets up keylists for various file access patterns.
- Gets current date, retrieves user/firm data from LDA.
- Initializes paging and positions database for the first subfile page.

---

## **7. Keylists for Indexed File Access**

Defined inside `*inzsr`, they set up reusable keylists for chaining and setting lower limits (`SETLL`) for each file, usually by firm and vendor number or alpha key.

---

## **8. Special Notes**

- **External Calls**: Program uses external calls to other programs for parsing search text (`AS700R`), detailed vendor screen (`RK502R`), and saldo posting processing (`RF107R`).
- **Indicator Use**: The program relies heavily on classic RPG indicators for screen control and logic branching.
- **Subfile Handling**: Paging, searching, and navigation are all implemented manually with subfile counters and read pointers, a hallmark of traditional RPG subfile programming.
- **SQL and Classic Access**: Both embedded SQL (for search) and native RPG file processing (for sequential/alpha browsing) are used depending on the search mode.

---

## **Summary Table: Core Components**

| Routine       | Purpose                                              |
|---------------|------------------------------------------------------|
| forny         | Refreshes subfile with current sequence              |
| søk           | Processes user search and refills subfile            |
| posisjoner    | Positions list by vendor number or alpha reference   |
| subfile       | Handles row-by-row user selection in the subfile     |
| xc2bld        | Shows vendor detail, calls external program          |
| clr_subfile   | Clears the current subfile page                      |
| crt_subfile   | Populates a page of subfile with vendors             |
| bck_subfile   | Navigates back a page in the subfile list            |
| dsp_subfile   | Displays the current subfile page                    |
| sum_poster    | Calculates and returns vendor saldo                  |
| \*inzsr       | Program initialization                               |


---

## **General Process Flow**

1. **Initialization**: Loads firm/user info, positions for first page.
2. **Display Loop**: Shows subfile contents, processes function keys (exit, search, page up/down, etc.).
3. **Search/Position**: User can search by name/word or position by vendor number.
4. **Result Paging**: Handles multiple subfile pages, including forward/backward paging.
5. **User Selection**: Allows direct selection for saldo processing via keystroke, then calls external programs as needed.

---

## **Best Practices Reflected**

- Use of keylists to centralize key-field logic.
- Clear separation of logic into named subroutines, with control passing via `exsr`.
- Comments and indicator documentation for future maintenance.
- Proper initialization and cleanup (including *inlr usage for program end).

---

## **Onboarding Tips**

- **Subfiles**: Understand RPG subfile concepts—this code is a classic example with manual counters/paging.
- **Indicators**: Familiarize yourself with the indicator-driven logic for screen and function key control.
- **Mixed Access**: Note how both embedded SQL and direct file access are used, depending on user mode.
- **External Programs**: Know how and when program calls (`CALL`) are made for business logic outside this module.

---
```