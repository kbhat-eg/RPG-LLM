# ASLAGR: Lagertelling (Inventory Counting)

## Overview

This program, **LE620R**, is part of the ASLAGR (Warehouse/Inventory) system. Its main function is to manage and print inventory counts for miscellaneous goods, allowing the user to select ranges and criteria for the count. The program is interactive, utilizing a workstation display file (`LE620D`) for parameter entry and inquiry, and supports integration with batch processing via batch IDs.

The code is written in traditional RPG IV (fixed-format), with some business logic and conventions specific to warehouse management.

---

## Structure and Key Components

### File Declarations

- **LE620D**: Display file (`WORKSTN`) used for interactive data entry and inquiries.

### Data Structures

#### File Member Data Structure

- **d_lmbr**: 10-character field, overlays:
  - **d_lbok**: 1-character (book code)
  - **d_firm**: 3-digit (company/firm identifier)
  - **d_llst**: 6-digit (list number)

#### Parameter Input Data Structure

- **d_prec**: 128-character parameter area, overlays:
  - **d_batc**: Batch number
  - **d_fogr**, **d_togr**: From/To Overgroup
  - **d_fhgr**, **d_thgr**: From/To Main group
  - **d_fugr**, **d_tugr**: From/To Subgroup
  - **d_fvar**, **d_tvar**: From/To Item number
  - **d_flag**, **d_tlag**: From/To Warehouse
  - **d_sort**: Sorting parameter

#### Local Data Area (LDA)

- Used for cross-program data persistence (e.g., firm number, firm name, batch number).

#### Working Variables

- **w_parm**: Parameter area for subprogram communication.
- **w_batc**: Batch number.
- **w_firm**: Current firm.
- **w_in03**: Return code for function key 3 (Exit).
- **w_vare**, **w_vtxt**, etc.: Item and text fields for inquiries.

---

## Program Flow & Logic

### 1. Initialization (`*inzsr`)

- Reads the LDA to initialize local variables (firm, batch number, etc.).
- Clears working variables and sets default values.
- Sets up the parameter list for entry.

### 2. Batch Number Entry (Tag `a1tag`)

- If `l_batc` (batch number from LDA) is present, use it.
- Otherwise, calls subprogram **LC500R** to prompt user for batch number.
  - If the user cancels, the program exits.
- Sets the batch number in the parameter structure.

### 3. Parameter Registration (Tag `b1tag`)

- Clears all parameter fields to defaults.
- Enters a loop (`b1tagb`) where the display file format `b1bld` is presented for user input.
- Handles function keys:
  - **F3 (Exit)**: Sets return code and exits.
  - **F4 (Inquiry/Lookup)**: Triggers context-sensitive lookups depending on the field in focus.

#### Inquiry Subprograms

- **VV500R**: Item register inquiry (for item number fields).
- **RA510R**: Warehouse register inquiry (for warehouse fields).
- **VG510R**: Overgroup register inquiry.
- **VG511R**: Main group register inquiry.
- **VG512R**: Subgroup register inquiry.

  Each call passes the current firm and relevant field values, and updates the input field with the selected value.

### 4. Parameter Finalization

- After data entry, the input values are moved into the parameter data structure (`d_prec` overlays).
- Special handling for "to" fields:
  - If "to" values are zero or blank, they're set to maximum values to indicate "all" (e.g., all overgroups, all main groups, all items).
- The sorting parameter is set.
- The parameter area is prepared for use in subsequent processing or by other programs.

### 5. Program Termination (Tag `slutt`)

- Sets LR indicator (`*INLR`) to end the program.

---

## Business/Domain-Specific Logic

- **Batch Handling**: The program is designed to allow batch-based processing, supporting both interactive and batch-driven workflows.
- **Flexible Selection**: The parameter screen allows users to select ranges for overgroup, main group, subgroup, item number, and warehouse, supporting granular or broad queries.
- **Inquiry Integration**: The use of several inquiry subprograms (VG510R, VG511R, VG512R, RA510R, VV500R) reflects a modular design for lookup functionality, reducing duplication and centralizing register maintenance.
- **"All" Selection**: Setting "to" fields to their maximum values when zero/blank is a convention in this system to mean "select all" in that category.

---

## Design Decisions & Conventions

- **Overlay Data Structures**: Used extensively for memory efficiency and to map parameter lists for subprogram calls.
- **Use of LDA**: LDA is used for passing persistent values (e.g., firm, batch) between programs in the same job/session.
- **Display File-Driven UI**: The interactive parameter entry is handled via a display file with function key support for navigation and inquiry.
- **Exit Handling**: Function key F3 is the standard for exit/cancel.
- **Subprogram Modularity**: Inquiry and batch entry are handled by separate subprograms, promoting code reuse and separation of concerns.

---

## External Interactions

- **Subprograms Called**:
  - `LC500R`: Batch number entry dialog.
  - `VV500R`: Item register inquiry.
  - `RA510R`: Warehouse register inquiry.
  - `VG510R`: Overgroup inquiry.
  - `VG511R`: Main group inquiry.
  - `VG512R`: Subgroup inquiry.

- **Data Area**:
  - `*LDA`: Used for input/output of firm and batch info.

---

## Summary

This program is a parameter entry and inquiry front-end for inventory counting in the ASLAGR warehouse system. It provides a flexible, interactive interface for users to specify selection criteria for inventory counting, supports batch processing, and integrates with several core register inquiry modules. The codebase relies on overlays, modular subprograms, and a convention of using maximum values to indicate "all" in selection ranges.