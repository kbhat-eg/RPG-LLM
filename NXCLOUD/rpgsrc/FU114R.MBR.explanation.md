# Overview

This program, FU114R, is responsible for mass-deletion of certain offers (“tilbud”) in the order header register, based on a specified order type and date. It reads entries from the FOHEL1 file, checks if each entry meets the deletion criteria, and then calls routines to perform and log the deletion. The program ends after processing all qualifying entries.

# Purpose and Domain Logic

• The main function is to purge “tilbud” records (offers) from the system once they have passed a certain date.  
• It requires an order type (d_otyp) and a threshold date (d_dato). Entries whose type matches d_otyp and whose date is less or equal to d_dato are deleted.  
• The deletion logic is tied to one of the system’s domain processes: removing outdated or invalidated offers from the system’s “ordre” (order) register.  
• Post-deletion, the program optionally logs mass deletions if the order type is identified as “T ” (an offer).

# File and Field Usage

1. FOHEL1 (disk)  
   - RENAME(FOHEPFR : FOHEL1R) indicates this file is renamed internally when read.  
   - The key fields (HEDKEY) are HEDFIR, HEDNUM, and HEDSUF, which are mapped to FOFIRM, FONUMM, and FOSUFF. This structure points to the record format used to identify each order header.  

2. Fields Relevant to Deletion and Logging  
   - FOOTYP: The order type, used here to filter offers (e.g., “T ”) or other order categories.  
   - FOTDAT: The date of the offer. The program checks if it is either *LOVAL (lowest possible date) or greater than the input parameter d_dato and decides whether to proceed with deletion.  
   - d_otyp: Incoming parameter representing the targeted order type for this mass operation.  
   - d_dato: Incoming parameter representing the cutoff date for deletion.  
   - w_opdt: A flag or indicator carried into the deletion program (FO410R), apparently controlling or recording the operation type.  
   - w_aktp, w_slko, w_kkko, w_sgru: Additional fields for describing and logging the deletion in another routine (XL700R).

# Program Flow

1. Initialization  
   - The program begins with *INZSR, where various local fields are set to blank or zero.  
   - The system’s firm number (l_firm) is moved into HEDFIR, building part of the key for reading FOHEL1.

2. Main Loop  
   - A label (START) is used to control reading the file FOHEL1 in a loop.  
   - For each record read, the program checks:  
     1) If the order type (FOOTYP) equals the requested parameter (d_otyp).  
     2) If the offer date (FOTDAT) is valid and not greater than the parameter date (d_dato).  
   - If these conditions are not met, the program continues reading the next record.

3. Deletion Call: FO410R  
   - When a record meets the criteria, the program sets WTYPED = 'TILB' and calls FO410R with parameters FOFIRM, FONUMM, FOSUFF, WTYPED, WPKOM1, WPKOM2, and w_opdt.  
   - FO410R presumably handles the actual removal of the offer from the order register.

4. Logging Call: XL700R  
   - If FOOTYP = 'T ', the program also calls XL700R to record a entry describing that a “Masse sletting” (mass deletion) was performed.  
   - The text “Masse sletting pr. [date]” is stored in w_sgru, and w_aktp is labeled “SLETTET.”  
   - slko (w_slko) and kkko (w_kkko) seem to be internal codes set to zero, possibly placeholders for additional logging data.

5. Loop Continuation  
   - After deleting (and possibly logging), the program branches back to START to read the next entry.  
   - Once the end of file is reached (indicator *IN90), the program goes to SLUTT, sets on LR, and returns.

# External Routines

• FO410R – The subprogram that performs the actual deletion of the specified order.  
• XL700R – The logging program that keeps track of mass deletions.

# Notable Implementation Details

• The code uses a GOTO-based loop, a common approach in older RPG code. A label (START) is used to branch back for reading subsequent records.  
• Moving the parameter values into data structure or standalone fields is done manually (MOVE statements), reflecting standard RPG IV techniques.  
• The param list in *ENTRY is used so other programs can pass in the selection criteria (list or date). The “rename” of FOHEPFR to FOHEL1R helps maintain naming consistency when referencing the file’s format.  
• The date checks and type checks reflect the domain-specific logic of when an offer is considered eligible for deletion.

# Summary

FU114R orchestrates mass offer deletion for a defined order type and cutoff date:  
• Reads order headers from FOHEL1.  
• Confirms each is a matching order type and date.  
• Calls FO410R to perform the actual data removal.  
• If the offer type is “T ,” logs the operation via XL700R.  
• Continues until all matching records have been processed.  

This ensures that outdated or irrelevant offers are purged from the system in a controlled, logged manner.