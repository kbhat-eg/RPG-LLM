```markdown
# Program VC701R – “Sortiment”: Beregning av dato(er) ut fra ukeintervall

## 1. Programheader (kommentarer)
- System: ASOFAK  
- Programnavn: VC701R  
- Formål: hente ‘fra’- og ‘til’-dato basert på uketall (p_fuke, p_tuke)  
- Output: p_fdat (fra‐dato), p_tdat (til‐dato)  
- P_INLR-flagg: om satt til ‘1’ underkjennes automatisk *INLR

## 2. Filspesifikasjon
```
F VSHEL1   IF   E           K DISK   RENAME(VSHEPFR:VSHEL1R)
```
- Filen åpnes for “update” (E) med nøkkeldefinisjon (K).  
- Internt omdøpt til `VSHEL1R` for å unngå navnekollisjon.

## 3. Parameter‐ og variabeldefinisjoner

### 3.1. Parametre (dynamisk parameterliste)
- `p_fuke` – input: fra‐uketall  
- `p_tuke` – input: til‐uketall  
- `p_fdat` – output: fra‐dato (format som `VCFDAT`)  
- `p_tdat` – output: til‐dato (format som `VCFDAT`)  
- `p_inlr` – styrer om *INLR skal settes automatisk (1 = inhibit)

### 3.2. Arbeidsfelt (working‐storage)
- `w_udat, w_uaar, w_uuke, w_stat` – nåværende systemdato, år, uke, status  
- `w_fuke, w_tuke` – kopi av p_fuke/tuke for intern bearbeiding  
- `w_faar, w_taar` – beregnede årstall for ‘fra’ og ‘til’  
- `w_fdaf, w_tdaf` – midlertidige fra-/til‐datoer før formatering  
- Diverse andre nøkkelfelt/temporære filer

## 4. Hovedbehandling

1. **Initialisering av arbeidsfelt**  
   ```rpg
      EVAL w_fuke = p_fuke
      EVAL w_tuke = p_tuke
      EVAL p_fdat = *LOVAL
      EVAL p_tdat = *LOVAL
   ```
2. **Hente gjeldende systemdato/år/uke**  
   ```rpg
      TIME    w_udat
      CALL 'AS711R' PARM(w_udat w_uaar w_uuke w_stat p_inlr)
   ```
   ‑ Subprogram AS711R returnerer dag, år, uke og status.

3. **Bestemme ‘fra‐år’ (w_faar) og ‘til‐år’ (w_taar)**  
   Scenario A: `fra‐uke > til‐uke` → ukeintervallet krysser årsskille.  
   ```rpg
   IF w_fuke > w_tuke;
     IF w_uuke <= w_fuke AND w_uuke > w_tuke;
       w_faar = w_uaar;
       w_taar = w_uaar + 1;
     ELSE;
       w_faar = w_uaar - 1;
       w_taar = w_uaar;
     ENDIF;
   ELSE;
     /* Samme år */
     IF w_uuke > w_fuke;
       w_faar += 1;
       w_taar += 1;
     ELSE;
       w_faar = w_uaar;
       w_taar = w_uaar;
     ENDIF;
   ENDIF;
   ```
   - Dersom `fra‐uke` > `til‐uke`, har vi et årsskille.
   - Ellers forblir både fra‐år og til‐år likt systemår, med eventuell forskyvning hvis vi allerede er forbi “fra‐uke”.

4. **Konvertere uke+år til dato**  
   - **Fra‐dato**:  
     ```rpg
     CALL 'AS710R' PARM(w_faar w_fuke w_fdaf w_fdat w_stat p_inlr)
     ```
   - **Til‐dato**:  
     ```rpg
     CALL 'AS710R' PARM(w_taar w_tuke w_tdaf w_tdat w_stat p_inlr)
     ```
   - AS710R returnerer første (eller siste) dag i angitt uke.

5. **Returnere resultat**  
   ```rpg
   EVAL p_fdat = w_fdaf
   EVAL p_tdat = w_tdat
   ```
6. **Avslutning**  
   Dersom `p_inlr <> *ON`, settes `*INLR = *ON` (LR‐flagg) før return.

## 5. Init‐subrutine (INZSR)
- Plassholder for eventuell initialisering ved programstart, men er ikke aktivert i denne versjonen.

---

**Oppsummering:**  
VC701R tar to uketall som input, henter gjeldende år/uke fra systemet, beregner korrekt årsskifte og kaller et hjelpe‐subprogram for å konvertere uke+år til datoer. Resultatet returneres i p_fdat og p_tdat. P_INLR‐parameteren styrer om programmet skal avslutte med *INLR = *ON automatisk.