# RS714R – Kontroll av gyldig leverandørkategori

## Purpose

This program, RS714R, is responsible for validating whether a given supplier category code (leverandørkategori) is valid for a specified company (firma). It is typically called as a subroutine or service program to check the existence and validity of a supplier category code in the `RA14PFR` (renamed as `RA14L1R`) file.

## Business/Domain Context

- **Supplier Category Validation**: The main business logic is to verify if a supplier category code exists for a particular company. If the code does not exist, the program returns a status indicating the code is invalid and provides a corresponding message.
- **Return Codes**: The program uses a single-character status code (`p_stat`). If the code is not found, `p_stat` is set to `'N'` and a message is returned. If found, `p_stat` is blank and the description from the file is returned.

## Structure Overview

### File Declarations

- **fra14l1**: File definition for the supplier category master file, `RA14PFR`, renamed as `RA14L1R`. The file is accessed by key (`k disk`).

### Key Variables

- **w_firm**: Holds the company number, based on the field `ranfir` from the file.
- **p_stat**: Return status (1 char) – `'N'` if not found, blank if valid.
- **p_nkod**: Input/output parameter for the category code, matching `rankod`.
- **p_ntxt**: Output parameter for the category text/description, matching `rantxt`.
- **ra14l1_nkod**: Local variable for the category code, used for keying.

### User Data Structure

- **l_user, l_firm, l_fnav**: These are fields mapped to specific positions in the program’s user space, likely populated by the calling environment. `l_firm` contains the current company number.

### Main Logic

1. **Parameter Initialization**
   - The program expects three parameters: `p_stat`, `p_nkod`, and `p_ntxt`.
   - The initialization subroutine (`*inzsr`) sets up the key fields and parameters.

2. **Key Construction**
   - The key for the file lookup consists of the company number (`w_firm`) and the supplied category code (`ra14l1_nkod`).

3. **Validation**
   - The program attempts to chain (lookup) the `RA14L1R` file using the constructed key.
   - If the record is not found (`*IN60 = *ON`), it sets `p_stat` to `'N'` and `p_ntxt` to a fixed message ("Koden er ugyldig").
   - If found, it sets `p_stat` to blank and `p_ntxt` to the description from the file (`rantxt`).

4. **Program End**
   - Sets the LR indicator (`*INLR = *ON`) and returns.

### Subroutine: *INZSR

- **Purpose**: Initialization.
- **Actions**:
    - Sets `w_firm` from `l_firm` (likely passed in from the calling environment).
    - Defines the parameter list (`plist`) for the program’s entry.
    - Defines the key list (`klist`) for the file lookup.

## Design Decisions & Conventions

- **File Keying**: File access is always by key, using both company and category code. This ensures company-specific category validation.
- **Indicator Usage**: Indicators 60–61 are reserved for file operations (chain, etc.), per codebase convention.
- **Return Status**: A single-character status code is used to indicate success or failure, which is a common pattern in this codebase.
- **Parameter Passing**: The program expects parameters in a fixed order, which must be observed by the caller.
- **Message Handling**: Error messages are hardcoded in the program. No message file or externalization is used.

## Interactions

- **File `RA14PFR` (`RA14L1R`)**: The only external data source. No other modules or APIs are called.
- **Calling Program**: Relies on the caller to provide the correct company number in `l_firm` and to handle the returned status and message.

## Summary Table

| Parameter | Direction | Description                                   |
|-----------|-----------|-----------------------------------------------|
| p_stat    | Out       | Status: blank=valid, 'N'=not found/invalid    |
| p_nkod    | In        | Supplier category code to validate            |
| p_ntxt    | Out       | Description or error message                  |

## Error Handling

- Only a simple not-found check is performed. No advanced error handling or logging.
- The error message is always "Koden er ugyldig" ("The code is invalid") if the category is not found.

## Modifiability

- To change error messages or add more status codes, adjust the logic in the main validation section.
- If new fields are added to the key, update both the key list and the parameter initialization.

---

**In summary:**  
RS714R is a utility program for validating supplier category codes for a given company, using a file lookup and returning a status and message. It is designed for integration into larger business processes that require supplier code validation. The code adheres to common file and indicator conventions in this codebase, with minimal dependencies and straightforward logic.