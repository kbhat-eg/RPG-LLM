## Overview

This ILE RPG program is part of the ASSYST system and is named `AD100R`. It is described as handling administration and setup (“Administrasjon/oppsett”) for what appears to be function/factura (likely a menu of system functions). The code is written in old-style RPG IV (fixed format). It features extensive use of subfiles for screen handling, subroutines for code modularity, and traditional IBM i indicator handling.

Below, you’ll find key explanations about the structure and workings of this program.

---

## File Declarations

```rpg
fasyoiu    uf a e           k disk    rename(asyost:asyoiur)
fasyoir    if   e           k disk    rename(asyost:asyoirr)
fasyoi1    if   e           k disk    rename(asyost:asyoi1r)
fad100d    cf   e             workstn sfile(b1sfl:w_srrn)
f                                     infds(dspfbk)
```

- **asyoiu, asyoir, asyoi1**: Logical and physical files (asyo...) used for data storage. The files are renamed on input for record format usage.
- **ad100d**: Display file, with a subfile (`b1sfl`) and subfile record number variable (`w_srrn`). The internal feedback data structure (`infds`) is declared for function key/status feedback.

---

## Data Definitions

### Parameters and Key Variables

Variables like `p_nsys`, `asyoiu_nsys`, `asyoiu_nfun`, etc., are used to hold keys for file access and pass parameters.

### Data Structures

`dspfbk` is an information data structure for getting feedback from the display file (such as which key was pressed and the cursor position).

### Local Data Area

`l_user`, `l_firm`, `l_fnav` reference IBM i's User Data Area for user identity and context.

### Subfile Control Variables

Variables such as `w_fcrn`, `w_stel`, `w_spge`, `w_srrn`, etc., manage subfile row/page counting, positioning, and navigation.

### Control/Status Flags

Flags like `b_feil`, `b_forn`, and `b_oppr` are used as program switches (error, renewal, update mode).

### Indicator Usage

Extensive use of classic RPG indicators (`*inxx`) for function key detection, subfile display, field protection, error state, etc.

---

## Main Program Flow

The main logic is implemented around tags and structured control statements (`tag`, `goto`, `select`). The program repeatedly presents a menu/subfile, processes function keys, and updates the display/subfile contents.

- **b2taga / b2tagb**: Key entry points for switching between the main function key menu and data-only update mode.

### Function Key Handling

- **F1** (*inka*): Opens a filter/search window.
- **F3/F12** (*inkc/inkl*): Exits the program.
- **F5** (*inke*): Refresh/renew display (calls `forny`).
- **F6** (*inkf*): Opens the new record (add) screen.
- **ROLL UP/DOWN, HOME, Cursor**: Handled via indicators 10/11/21/22 for subfile navigation.
- **Other indicators**: Control subfile status, error notification, working flags.

---

## Subroutines

The program is modularized with labeled subroutines, each handling a specific aspect of subfile or screen processing.

### Filter Window (`xf1win`)
Displays a filter/search screen, captures the cursor position, then returns.

### Subfile Refresh (`forny`)
Clears and rebuilds the subfile from the corresponding file, setting file position as required.

### Subfile Positioning (`posisjoner`)
Positions the display at the requested system code and re-populates subfile accordingly.

### Subfile Processing (`subfile`)
Iterates over visible subfile records, checks for user-selected actions (change, view, "work with function"), and executes the requested operation.

### Add/New Record Screen (`xc1bld`)
Displays the screen for creating a new record; checks if the record exists before adding, invokes the editing routine as needed, and handles duplicates.

### Display Message for Existing Record (`xc1msg`)
If the user tries to add a record that already exists, shows a message screen and waits for exit key.

### Edit/View Record Screen (`xc2bld`)
Shows the screen for viewing/editing a record. Validates input. On save, updates or inserts the record as appropriate, including timestamping and user tracking.

### Execute Function Program (`exc_func`)
Finds the selected function and calls another program (`AD100C`) with a link parameter.

### Subfile Clearing (`clr_subfile`)
Clears the subfile display and resets the relevant subfile counters and indicators.

### Subfile (Re-)Populate (`crt_subfile`)
Reads from file and populates the subfile buffer with up to a page’s worth of records.

### Subfile Page Backward (`bck_subfile`)
Enables backward paging in the subfile; adjusts file pointer and repopulates the subfile.

### Subfile Display (`dsp_subfile`)
Handles subfile display screen formatting and manages control indicators.

### Program Initialization (`*inzsr`)
Handles parameter input, initializes all keys, subfile position, and loads the initial subfile page.

---

## Subfile Handling

The subfile (`b1sfl`) is at the core of the UI, showing a list of functions (likely per system). Users can scroll, position, add, change, or execute an entry from the list. The RPG code manages which records are displayed, updates the subfile based on user input, and ensures the display is refreshed with any changes.

---

## User/Field Explanations

Explanatory comments (in Norwegian) clarify the role of fields/variables, the mapping to subfile display, and screen controls (e.g., `w_fcrn` is "first record number on the page", `w_stel` is subfile counter, etc.).

---

## Error and Status Indicators

The program uses a block of indicators (31-99) for error and status notification, toggling them in response to invalid input or system errors.

---

## Summary

- **Presentation logic**: Through subfiles, users can view, navigate, add, and update records for system functions.
- **Modular structure**: Subroutines encapsulate common tasks: subfile fill, clear, position, edit, view, add, etc.
- **Classic RPG IV**: Leverages fixed-format code, indicators, subfile mechanisms, and direct screen-to-file mapping.
- **Interactive**: Intended for 5250-style green screen operation, with considerable reliance on IBM i interactive features.

---

## Onboarding Tips

- **Understand subfiles**: Key to how the program interacts with users.
- **Indicator mapping**: Learn which indicators map to which screen and program states.
- **File keys**: Know the key structures and which fields are used for file access/navigation.
- **Screen layouts**: Review the display file (`ad100d`) definitions, as the RPG code references many screens and fields.
- **Program calls**: The code can invoke other programs (see `exc_func`).

This program is a classic example of IBM i RPG subfile-based menu/maintenance logic, well-commented and relatively easy to follow once you’re familiar with RPG IV conventions.