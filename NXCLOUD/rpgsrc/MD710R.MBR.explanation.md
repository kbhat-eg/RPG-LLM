# Program: MD710R â€“ Kontroll av gyldig lagerlokasjon (Control of Valid Warehouse Location)

## Overview
This RPG III/ILE program validates whether a given warehouse location code exists in the master location file (`mdlol1`). It receives parameters for firm, warehouse, location, and returns a status code and location description.  
The program is intended to be called from another program or process.

---

## 1. File Specifications

```rpg
fmdlol1    if   e           k disk    rename(mdlopfr:mdlol1r)
```
- Defines a keyed physical file (`mdlol1`) for input (I), using external (E) description.
- It is renamed in the program from `mdlopfr` to `mdlol1r` for local reference.

---

## 2. Data Definitions

```rpg
d w_firm          s                   like(mdfirm)
d p_stat          s              1
d p_lage          s                   like(mdlage)
d p_loka          s                   like(mdloka)
d p_lbes          s                   like(mdlbes)
d mdlol1_lage     s                   like(mdlage)
d mdlol1_loka     s                   like(mdloka)
```
- `w_firm`: Local work variable for the firm, same type as `mdfirm`.
- `p_stat`: Return status code (1 character).
- `p_lage`: Warehouse code parameter.
- `p_loka`: Location code parameter.
- `p_lbes`: Location description parameter.
- `mdlol1_lage`, `mdlol1_loka`: Work fields for key-building, same types as respective fields in the file.

#### User Space (UDS) Fields
```rpg
d                uds
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980
```
- Fields extracted from the User Data Space (UDS) -- likely for session/user context (these are not actively used outside `*inzsr`).

---

## 3. Main Control Flow

### a) Parameter List

```rpg
c     *entry        plist
c                   parm                    p_stat
c                   parm                    p_lage
c                   parm                    p_loka
c                   parm                    p_lbes
```
- The program receives four parameters by reference: status (`p_stat`), warehouse (`p_lage`), location (`p_loka`), and description (`p_lbes`).

### b) Initialization Subroutine (*INZSR)

```rpg
c     *inzsr        begsr
...
c                   eval      w_firm = l_firm
...
c     mdlol1_key    klist
c                   kfld                    w_firm
c                   kfld                    mdlol1_lage
c                   kfld                    mdlol1_loka
c                   endsr
```
- Sets working firm from the user data space field.
- Builds the key list for file access: composed of firm, warehouse, and location.

### c) Main Logic

#### 1) Copy parameters to key fields:

```rpg
c                   eval      mdlol1_lage = p_lage
c                   eval      mdlol1_loka = p_loka
```
- Assign input parameters to key fields for the file lookup.

#### 2) File Lookup

```rpg
c     mdlol1_key    chain     mdlol1r
```
- Looks up the location record in the file using the composite key (`w_firm`, `mdlol1_lage`, `mdlol1_loka`).

#### 3) If Not Found

```rpg
c                   if        not %found
c                   eval      p_stat = 'N'
c                   eval      p_lbes = 'Koden er ugyldig  '
```
- If the record is not found:
  - Sets status (`p_stat`) to 'N' ("Not found").
  - Sets the return description (`p_lbes`) to "Koden er ugyldig  " ("Code is invalid").

#### 4) If Found

```rpg
c                   else
c                   eval      p_stat = *blank
c                   eval      p_lbes = mdlbes
c                   endif
```
- If the record is found:
  - Sets status to blank (indicating success).
  - Sets the description parameter to the file's description (`mdlbes`).

### d) Program End

```rpg
c     slutt         tag
c                   eval      *inlr = *on
c                   return
```
- Sets on LR (Last Record) to end the program and releases resources.
- Returns to the caller.

---

## 4. Summary of Functionality

- **Purpose:** To validate if a warehouse/location code is valid for a specific firm.
- **Input:** Receives firm (via user space), warehouse, and location code.
- **Output:** Returns a status ('N' for not found, blank for found) and a location description.
- **File Access:** Uses a composite key (firm, warehouse, location) to lookup in file `mdlol1`.
- **Usage:** Called as a subroutine from other programs or CL to check code validity.

---

## 5. Key Takeaways for Onboarding

- **Modular:** Parameters are passed in/out for status, codes, and description.
- **File-Driven:** Central logic is a keyed lookup in `mdlol1`.
- **Return Convention:** Status is 'N' for not found, blank for found; description gives reason or retrieved text.
- **Initialization:** Uses *INZSR for setting up keys and initial context (firm).
- **Typical Use Case:** Called to validate warehouse locations before performing inventory or movement transactions.