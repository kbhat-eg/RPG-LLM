```markdown
## Overview

This RPG program (BB700R) is designed for the IBM i platform (AS/400 family). It checks user access rights for specific functions, typically called as a utility from other programs. The access rights are sourced from a user register file called `BUSRI1`. The program uses passed-in parameters to determine what access code to check (e.g., code 01, 02), and returns a status (0, 1, or 2) indicating the user's access level for the requested function.

---

## Header and Description

- `h option(*nodebugio) datedit(*dmy)`: Sets program compile options  
  - `*nodebugio`: Disables input/output debug support.
  - `datedit(*dmy)`: Sets the date format to day/month/year.
- Detailed comment block describes the program as "Kontroll av tilganger for bruker" ("Check user access"), with reference and change log.

---

## File Declarations

```rpg
fbusri1    if   e           k disk    rename(busrst:busri1r)
```
- Declares file `BUSRI1` as an input file (`i`), externally described (`e`), keyed (`k`), on disk. The record format `BUSRST` is renamed to `BUSRI1R` for internal usage.

---

## Local Data Area (LDA)

```rpg
d                uds
d l_wsid                901    910
d l_user                911    920
d l_firm                944    946  0
```
- This structure reads from the standard system Local Data Area (LDA).
  - `l_wsid`: Position 901–910 (Workstation ID)
  - `l_user`: Position 911–920 (Current user)
  - `l_firm`: Position 944–946 (Firm/company number)

---

## Parameter Definitions

```rpg
d p_kode          s              2  0
d p_onof          s                   like(bbkret)
```
- `p_kode`: Input parameter. 2-digit code to specify which access right to check.
- `p_onof`: Output parameter. Will be set to the access value (0, 1, or 2). Its type is like field `bbkret` in the database file.

---

## Variables for Keys

```rpg
d w_firm          s                   like(bbfirm)
d busri1_user     s                   like(bbuser)
```
- Temporary variables to build the key for the file lookup, matching the types of fields in the database file.

---

## Main Routine Logic

### 1. Initialize Return Value

```rpg
c                   eval      p_onof = 0
```
- Default the output parameter to `0` (no access) in case no other value is found.

---

### 2. File Lookup (CHAIN)

```rpg
c     busri1_key    chain     busri1
```
- Uses the key list `busri1_key` (set up in *INZSR) to chain/read the user record from `BUSRI1`.

---

### 3. If User Found

```rpg
c                   if        %found
```
- Only proceed if the user record was found.

#### a. Check Requested Access Code

```rpg
c                   if        p_kode = 01
c                   eval      p_onof = bbkret
c                   endif

c                   if        p_kode = 02
c                   eval      p_onof = bbkopg
c                   endif
```
- If the incoming code (`p_kode`) is `01`, set the return value to the contents of field `bbkret` (presumably a right/flag in the user file).
- If `p_kode` is `02`, set it to `bbkopg` (another right/flag).
- Other codes would be ignored (return remains 0).

---

### 4. Program End

```rpg
c     xslutt        tag
c                   eval      *inlr = *on
c                   return
```
- Standard ILE RPG method to end the program, set Last Record Indicator `*INLR` to on (release resources), and return to caller.

---

## Initialization Subroutine (*INZSR)

This is run automatically on the first entry to the program.

### 1. Key List Setup

```rpg
c     busri1_key    klist
c                   kfld                    w_firm
c                   kfld                    busri1_user
```
- Defines `busri1_key` as a composite key with firm and user for file access.

### 2. Receive Parameters

```rpg
c     *entry        plist
c                   parm                    p_kode
c                   parm                    p_onof
```
- Declares the parameter list (order must match the caller's).

### 3. Set Up Key Variables

```rpg
c                   eval      w_firm = l_firm
c                   eval      busri1_user = l_user
```
- Copies company number and user from LDA to the temporary variables used as file key.

---

## Summary Flow

1. **On program start**:
    - Receives which code to check (`p_kode`) and a variable to return result (`p_onof`).
    - Reads firm number and user from the LDA.
    - Prepares the key for the user access file.

2. **Main logic**:
    - Sets result to 0 (no access).
    - Looks up the user record (using firm and user as key).
    - If found:
        - If `p_kode` is 01, return the value of access field `bbkret`.
        - If `p_kode` is 02, return the value of access field `bbkopg`.
    - Ends program, returning the result.

---

## Usage

- Called from another program with two parameters:
    1. Access code to check (2 digits, e.g., '01' or '02')
    2. Return value, which will be set to access indicator (0=no, 1=limited, 2=full, as typically defined)

- The file `BUSRI1` must have entries for firm and user, with fields `bbkret` and `bbkopg` for possible access codes.

---

## Key Takeaways

- **Generic, parameter-driven access check utility.**
- **Leverages LDA for context (firm/user info).**
- **Expandable by adding more code checks against more fields if required.**
- **Minimal error handling — returns `0` if user not found or code not recognized.**

---
```