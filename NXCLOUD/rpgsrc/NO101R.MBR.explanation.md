## Program Documentation: NO101R â€“ External Order Header, Message Handling

### Overview

This program, **NO101R**, is part of the ASOFAK system and is responsible for handling messages associated with external order headers. The main function is to retrieve order header data based on provided key parameters and present associated messages on a workstation display. The code is primarily oriented around inquiry and display functionality, without update or maintenance logic.

---

### File Declarations

- **nohel1**: Externally-described file, keyed, renamed from `nohepfr` to `nohel1r`. This is the primary data source for order header information.
    - The keys for this file (as of version 5.10) are `nofirm`, `nofsys`, and `notell`.
- **no101d**: Workstation display file, used for interactive screen presentation.

---

### Parameters and Key Variables

- **p_firm**: Input parameter, company identifier (like `nofirm`).
- **p_fsys**: Input parameter, system identifier (like `nofsys`).
- **p_tell**: Input parameter, order number or similar (like `notell`).

These parameters are passed into the program and used to build the key for retrieving the order header.

- **nohel1_fsys**, **nohel1_tell**: Local variables used to store the system and order number for key construction.
- **w_firm**: Local variable for the company identifier, also used in key construction.

---

### Program Flow

#### 1. Initialization (`*inzsr` subroutine)

- The program starts by initializing parameters from the program call interface.
- It sets up the key list (`nohel1_key`) for the order header file using the provided parameters.
- The company parameter (`p_firm`) is assigned to the working variable `w_firm`.

#### 2. Main Logic

- The key fields (`nohel1_fsys`, `nohel1_tell`) are assigned from the input parameters.
- A `CHAIN` operation retrieves the order header record from `nohel1` using the constructed key.
- The message field (`nomeld`) from the retrieved record is split into 8 segments of 32 characters each (`b1mld1` through `b1mld8`). This allows for displaying a potentially long message over multiple lines on the screen.

#### 3. Display Handling

- The program enters a display loop, using `EXFMT` on the `b1bld` format of the workstation file. This presents the message segments to the user.
- The loop listens for function keys F3 (`*INKC`) or F12 (`*INKL`) to exit.

#### 4. Program Exit

- Upon exit, the program sets on LR (`*INLR`) and returns control to the caller.

---

### Notable Design and Business Logic

- **Key Construction Convention**: The key for the order header file is always constructed from company, system, and order number. This is a common pattern in this application for all order-related files.
- **Message Segmentation**: The message field (`nomeld`) is segmented into fixed 32-character lines for display. This is a system convention for handling long text fields in display files.
- **Read-Only Inquiry**: The program does not update any data; it is strictly for inquiry and message display.
- **Display File Standardization**: The use of `b1bld` as the display format and `b1mld1`-`b1mld8` as message fields is standardized across similar programs for consistent user experience.
- **Exit Handling**: F3 and F12 are reserved for program exit. This is a UI convention throughout the system.

---

### External Relationships

- **File Dependencies**: The program is tightly coupled to the structure of `nohepfr` (renamed as `nohel1r`). Any changes to the key structure or message field in this file will require corresponding changes in this program.
- **Display File**: The display file `no101d` must define the `b1bld` format and the segmented message fields. Consistency between the RPG program and the display file is essential.

---

### Version History

- **Initial Version**: Created by HKO on 2021-10-02.
- **Key Change**: On 2003-09-29 (v5.10), MHA updated the key structure to match `NOHEPF`.

---

### Summary

This program is a standard inquiry utility for external order header messages, following established conventions for key construction, message segmentation, and display handling within the ASOFAK system. It interacts only with the order header file and a display file, and is intended for read-only, user-interactive message viewing. Any enhancements or changes should maintain the current conventions for compatibility and user familiarity.