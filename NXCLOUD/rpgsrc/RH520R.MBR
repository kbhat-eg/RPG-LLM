     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOKON
      * Program . . . . : RH520R
      * Beskrivelse . . : Hovedbok - saldi, spørring
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       070402 KOB  Nytt program
      *       110602 KOB  Fjernet periode 13 pga plassmangel i skjermbildet
      * 5.10  110603 KOB  Siste konto ble ikke lagt ut ved summering
T5.20 * V5.00 221003 HFL  Rettet slik at notatblokk virker.
T5.20 * V5.30 100304 KOB  Endret slik at hvis konto og enten bærer eller
      *                   avdeling er utfylt vises detaljert spørrebilde
T5.20 * V5.30 030904 KOB  Tar med periode i parameterliste til RH512R
T5.20 * V5.30 241104 KOB  Endret i parameterliste til RH512R
T5.20 * V5.40 190505 KOB  Endret i parameterliste til RH512R tilbake
T5.40 * V5.40 040805 HFL  Utvidet parameterliste for RF020R
T5.40 * V5.40 160306 HFL  Siste konto ble ikke vist når summert
T5.40 *                   Viste en tom linje når året ikke hadde poster
T5.40 * V5.40 270306 HFL  Endret i parameterliste til RH512R et sted
T5.40 * V5.40 030406 HFL  Utvidet beløp til 12.2.
T5.40 * V5.41 141006 KOB  Enret tester i beregn-rutinen
6.30  * V6.30     040719  Utvidet saldofelter                            BSA
7.xx  * 7.xx  030516 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = Avslutt program
      *       10 = Roll
      *       11 = Rolldown
      *       12 = Sfldsp
      *       13 = Sfldspctl
      *       14 = Sflclr
      *       15 = Sflend
      *       21 = Home-key
      *       22 = Plassering av cursor
      *       30 = Protect av felter ved vise
      *    31-79 = Varsle m/feilmeldinger/skjermindikatorer
      *    80-99 = Arbeidsindikatorer
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     frhsal1    if   e           k disk    rename(rhsapfr:rhsal1r)
     frhsal2    if   e           k disk    rename(rhsapfr:rhsal2r)
     frhsal3    if   e           k disk    rename(rhsapfr:rhsal3r)
T5.40frklal2    if   e           k disk    rename(rklapfr:rklal2r)
     frh520d    cf   e             workstn sfile(b1sfl:w_srrn)
      *
      * Definering av arrays
      *
6.30 d isa             s             15  2 dim(14)
     d wrk             s             11  2 dim(13)
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av variabler i nøkler
      *
     d rhsal1_kont     s                   like(rikont)
     d rhsal1_avde     s                   like(riavde)
     d rhsal1_spes     s                   like(rispes)
     d rhsal1_raar     s                   like(riraar)
     d rhsal1_type     s                   like(ritype)
      *
     d rhsal2_kont     s                   like(rikont)
     d rhsal2_avde     s                   like(riavde)
     d rhsal2_spes     s                   like(rispes)
      *
     d rhsal3_kont     s                   like(rikont)
     d rhsal3_avde     s                   like(riavde)
     d rhsal3_spes     s                   like(rispes)
      *
T5.40d rklal2_syst     s                   like(rxsyst)
T5.40d rklal2_pros     s                   like(rxpros)
T5.40d rklal2_akti     s                   like(rxakti)
T5.40d rklal2_kont     s                   like(rxkont)
T5.40d rklal2_spes     s                   like(rxspes)
T5.40d rklal2_avde     s                   like(rxavde)
      *
      * Parameter - program RF020R
6.20 i/COPY QCPYLESRC,RF020PAR
6.20 d*                ds
6.20 d*rxulda                       175
6.20 d* rxstat                        1    overlay(rxulda)
6.20 d* rxfirm                        3  0 overlay(rxulda:2)
6.20 d* rxsyst                        1    overlay(rxulda:5)
6.20 d* rxpros                        6  0 overlay(rxulda:6)
6.20 d* rxakti                        3    overlay(rxulda:12)
6.20 d* rxf001                        3    overlay(rxulda:15)
6.20 d* rxkont                        6  0 overlay(rxulda:18)
6.20 d* rxspes                        4  0 overlay(rxulda:24)
6.20 d* rxavde                        4  0 overlay(rxulda:28)
6.20 d* rxlinj                        4  0 overlay(rxulda:32)
6.20 d* rxtgrp                        3    overlay(rxulda:36)
6.20 d* rxtext                       78    overlay(rxulda:39)
6.20 d* rxf002                       13    overlay(rxulda:117)
6.20 d* rxvalg                        1  0 overlay(rxulda:130)
6.20 d* rxtist                         z   overlay(rxulda:131)
6.20 d* rxbiln                        6  0 overlay(rxulda:158)
6.20 d* rxrper                        2  0 overlay(rxulda:164)
6.20 d* rxraar                        4  0 overlay(rxulda:166)
6.20 d* rxonr                         6  0 overlay(rxulda:170)
     d rxupar          s                   like(rxulda)
      *
      * Definering av variable
      *
     d w_stel          s              4  0
     d w_spge          s              4  0
     d w_srrn          s              4  0
     d w_sfrn          s                   like(w_srrn)
     d w_ssrn          s                   like(w_srrn)
      *
     d w_seqe          s              1
     d b_eof           s              1    inz(*off)
     d b_valg_ok       s              1    inz(*off)
      *
     d s_kont          s                   like(rikont)
     d s_type          s                   like(ritype)
     d s_raar          s                   like(b2raar)
     d s_rper          s                   like(b2rper)
      *
     d wk1hlp          s              5
     d wk1typ          s              1  0
     d wk2hlp          s              5
     d wk2typ          s              1  0
     d wk3typ          s              1  0
     d wk4typ          s              1  0
      *
     d wpkont          s                   like(rikont)
     d wprper          s                   like(b2rper)
      *
E5.40d saml            s             12  2
%5.40d diff            s             12  2
     d pros            s              5  1
     d m               s              2  0
     d n               s              2  0
      *
     d w_firm          s                   like(rifirm)
     d w_kont          s                   like(rikont)
     d w_text          s             30
     d w_sabe          s              1  0
     d w_sude          s              1
     d w_dper          s                   like(b1dper)
     d w_hitt          s                   like(b1hitt)
      *
     d p_bkod          s                   like(rispes)
     d p_btxt          s             30
     d p_gkod          s                   like(riavde)
     d p_gtxt          s             20
     d p_Ækod          s                   like(rispes)
     d p_tx20          s             20
     d p_stat          s              1
     d p_avde          s                   like(riavde)
     d p_kont          s                   like(rikont)
     d p_spes          s                   like(rispes)
     d p_text          s             30
      *
E5.40d w2k100          s             12  2
E5.40d w2k101          s             12  2
E5.40d w2k102          s             12  2
E5.40d w2k103          s             12  2
E5.40d w2k104          s             12  2
E5.40d w2k105          s             12  2
E5.40d w2k106          s             12  2
E5.40d w2k107          s             12  2
E5.40d w2k108          s             12  2
E5.40d w2k109          s             12  2
E5.40d w2k110          s             12  2
E5.40d w2k111          s             12  2
E5.40d w2k112          s             12  2
E5.40d w2k113          s             12  2
E5.40d w2k114          s             12  2
E5.40d w2k200          s             12  2
E5.40d w2k201          s             12  2
E5.40d w2k202          s             12  2
E5.40d w2k203          s             12  2
E5.40d w2k204          s             12  2
E5.40d w2k205          s             12  2
E5.40d w2k206          s             12  2
E5.40d w2k207          s             12  2
E5.40d w2k208          s             12  2
E5.40d w2k209          s             12  2
E5.40d w2k210          s             12  2
E5.40d w2k211          s             12  2
E5.40d w2k212          s             12  2
E5.40d w2k213          s             12  2
E5.40d w2k214          s             12  2
      *
      * Definering av konstanter
      *
     d c_sfil          s              2  0 inz(12)
      *
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      * w_stel - Subfile-teller
      * w_spge - Sidestørrelse i subfile (page)
      * w_srrn - Relativt recordnummer i subfile
      * w_sfrn - Første recordnummer på siden
      * w_ssrn - Siste  recordnummer på siden
      * w_curn - Current recordnummer på siden
      * w_virn - Vis den side som inneholder denne record.
      * w_afld - Aktivt feltnavn
      * w_arow - Aktiv rad for cursor
      * w_acol - Aktiv kolonne for cursor
      *
      * Benyttede skjermbilder.
      *
      * - - - - - - - - - - - - - - - - -
      * B1SFL  - B1 Subfile - record
      * B2CTL  - B2 Subfile - control record
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      *
      * Redefinering til array's
      *
     irhsal1r
     i              risa01                      isa(1)
     i              risa02                      isa(2)
     i              risa03                      isa(3)
     i              risa04                      isa(4)
     i              risa05                      isa(5)
     i              risa06                      isa(6)
     i              risa07                      isa(7)
     i              risa08                      isa(8)
     i              risa09                      isa(9)
     i              risa10                      isa(10)
     i              risa11                      isa(11)
     i              risa12                      isa(12)
     i              risa13                      isa(13)
     i              risa00                      isa(14)
      *
      * Redefinering til array's
      *
     irhsal2r
     i              risa01                      isa(1)
     i              risa02                      isa(2)
     i              risa03                      isa(3)
     i              risa04                      isa(4)
     i              risa05                      isa(5)
     i              risa06                      isa(6)
     i              risa07                      isa(7)
     i              risa08                      isa(8)
     i              risa09                      isa(9)
     i              risa10                      isa(10)
     i              risa11                      isa(11)
     i              risa12                      isa(12)
     i              risa13                      isa(13)
     i              risa00                      isa(14)
      *
      * Redefinering til array's
      *
     irhsal3r
     i              risa01                      isa(1)
     i              risa02                      isa(2)
     i              risa03                      isa(3)
     i              risa04                      isa(4)
     i              risa05                      isa(5)
     i              risa06                      isa(6)
     i              risa07                      isa(7)
     i              risa08                      isa(8)
     i              risa09                      isa(9)
     i              risa10                      isa(10)
     i              risa11                      isa(11)
     i              risa12                      isa(12)
     i              risa13                      isa(13)
     i              risa00                      isa(14)
      *
     c     dummy         tag
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B2CTL Behandle åpningsbildet med subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Send Alt
      *
     c     b2taga        tag
      *
     c                   write     b2cmd
      *
      * Bare data
      *
     c     b2tagb        tag
      *
     c                   exsr      dsp_subfile
      *
      * Behandling av funksjonstaster
      *
     c                   select
     c                   when      *inkc or *inkl
     c                   goto      avslutt
      *
     c                   when      *inkd = *on
     c                   if        w_afld = 'B2KONT'
      *                                                                 .
     c                   call      'RH500R'
T400 c                   parm                    w_firm
     c                   parm                    p_kont
     c                   parm                    p_spes
     c                   parm                    p_avde
     c                   parm                    p_text
      *                                                                 .
     c                   if        p_kont <> *zero
     c                   move      p_kont        b2kont
     c                   move      p_spes        b2spes
     c                   move      p_avde        b2avde
     c                   goto      b2taga
     c                   endif
      *                                                                 .
     c                   endif
      *
     c                   if        w_afld = 'B2SPES'
      *
     c                   call      'RA528R'
     c                   parm                    w_firm
     c                   parm                    p_bkod
     c                   parm                    p_btxt
      *                                                                 .
     c                   if        p_bkod <> *zero
     c                   move      p_bkod        b2spes
     c                   goto      b2taga
     c                   endif
      *                                                                 .
     c                   endif
      *
     c                   if        w_afld = 'B2AVDE'
      *
     c                   call      'RA507R'
     c                   parm                    w_firm
     c                   parm                    p_gkod
     c                   parm                    p_gtxt
      *                                                                 .
     c                   if        p_gkod <> *zero
     c                   move      p_gkod        b2avde
     c                   goto      b2taga
     c                   endif
      *                                                                 .
     c                   endif
      *                                                                 .
     c                   when      *inke
     c                   exsr      forny
     c                   goto      b2tagb
      *                                                                 .
     c                   when      *inkf
     c                   if        w_seqe = 'K'
     c                   if        w_sude = 'S'
     c                   eval      w_sude = 'D'
     c                   else
     c                   eval      w_sude = 'S'
     c                   endif
     c                   endif
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *in10
     c                   exsr      crt_subfile
     c                   goto      b2tagb
     c                   when      *in11
     c                   exsr      bck_subfile
     c                   goto      b2tagb
     c                   when      *in21
     c                   eval      *in22 = *on
     c                   goto      b2taga
     c                   endsl
      *
      * Poster
      *
     c                   if        *inkh
     c                   call      'RH510R'
     c                   goto      b2tagb
     c                   endif
      *
      * Posisjonering
      *
     c                   if        b2kont <> 0 or
     c                             b2spes <> 0 or
     c                             b2avde <> 0
     c                   exsr      posisjoner
     c                   goto      b2tagb
     c                   endif
      *
      * Nytt år/periode
      *
     c                   if        b2raar <> s_raar or
     c                             b2rper <> s_rper
     c                   exsr      forny
     c                   eval      s_rper = b2rper
     c                   eval      s_raar = b2raar
     c                   eval      v1aar1 = b2raar
     c                   eval      v1aar2 = b2raar
     c                   goto      b2tagb
     c                   endif
      *
      * Behandling av subfile
      *
     c                   exsr      subfile
      *
     c                   if        b_valg_ok = *on
     c                   goto      avslutt
     c                   endif
      *
     c                   goto      b2taga
      *
      * Avslutt program
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for fornying av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     forny         begsr
      *
     c                   if        w_sfrn <> 0
     c     w_sfrn        chain     b1sfl
     c                   endif
      *
     c                   eval      s_kont = b1kont
     c                   eval      w_dper = 0
     c                   eval      w_hitt = 0
      *
     c                   select
     c                   when      w_seqe = 'K'
     c                   eval      rhsal1_kont = b1kont
     c     rhsal1_key    setll     rhsal1
     c                   when      w_seqe = 'A'
     c     rhsal2_key    setll     rhsal2
     c                   when      w_seqe = 'B'
     c     rhsal3_key    setll     rhsal3
     c                   endsl
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c     end_forny     endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for posisjonering i subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     posisjoner    begsr
      *
     c                   eval      w_kont = b2kont
     c                   eval      s_kont = 0
      *
      * Posisjoner startverdi på konto
      *
     c                   if        b2kont <> 0
     c                   eval      w_seqe = 'K'
      *
     c                   if        b2spes <> 0 or
     c                             b2avde <> 0
     c                   eval      w_sude = 'D'
     c                   endif
      *
     c                   eval      rhsal1_kont = b2kont
     c                   eval      rhsal1_spes = b2spes
     c                   eval      rhsal1_avde = b2avde
     c     rhsal1_key    setll     rhsal1
     c                   goto      end_pos
     c                   endif
      *
      * Posisjoner startverdi på avdeling
      *
     c                   if        b2avde <> 0
     c                   eval      w_seqe = 'A'
     c                   eval      w_sude = 'D'
     c                   eval      rhsal2_avde = b2avde
     c                   eval      rhsal2_kont = b2kont
     c                   eval      rhsal2_spes = b2spes
     c     rhsal2_key    setll     rhsal2
     c                   goto      end_pos
     c                   endif
      *
      * Posisjoner startverdi på kostnadsbærer
      *
     c                   if        b2spes <> 0
     c                   eval      w_seqe = 'B'
     c                   eval      w_sude = 'D'
     c                   eval      rhsal3_spes = b2spes
     c                   eval      rhsal3_kont = b2kont
     c                   eval      rhsal3_avde = b2avde
     c     rhsal3_key    setll     rhsal3
     c                   goto      end_pos
     c                   endif
      *
     c     end_pos       tag
      *
      * Blanker subfile, og fyller opp i.h.t. posisjonering
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
      * Blanker posisjoneringsfelter
      *
     c                   eval      b2kont = 0
     c                   eval      b2spes = 0
     c                   eval      b2avde = 0
      *
     c                   endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     subfile       begsr
      *
     c                   if        *in22 = *off
     c                   eval      *in22 = *on
     c                   else
     c                   eval      *in22 = *off
     c                   endif
      *
     c                   if        w_curn > 0
     c                   eval      w_virn = w_curn
     c                   endif
      *
      * Leser og behandler subfile
      *
     c                   do        w_ssrn
     c                   readc     b1sfl
      *
     c                   if        %eof
     c                   leave
     c                   endif
      *
     c                   eval      *in22 = *off
     c                   eval      w_virn = w_srrn
      *
      * Vise post
      *
     c                   if        b1valg = 5
     c                   eval      c1kont = b1kont
     c                   eval      c1spes = b1spes
     c                   eval      c1avde = b1avde
     c                   exsr      xc2bld
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
      *                                                                 .
      * Vise posteringer
      *                                                                 .
     c                   if        b1valg = 8
     c                   eval      p_kont = b1kont
     c                   eval      p_spes = b1spes
     c                   eval      p_avde = b1avde
      *
     c                   call      'RH512R'
     c                   parm                    w_sude
     c                   parm                    b2raar
S5.40c*                  parm                    b2rper
     c                   parm                    p_kont
     c                   parm                    p_spes
     c                   parm                    p_avde
      *
     c                   eval      b1valg = 0
     c                   update    b1sfl
      *
     c                   iter
     c                   endif
      *
     c                   enddo
      *
     c     end_subfile   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * C2BLD Behandle bilde for vise                                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xc2bld        begsr
      *
     c     c2tagb        tag
      *
     c                   exsr      nullstill
      *
     c                   exsr      xc2les
      *
     c     c2tagc        tag
      *
T5.40 * Finnes notatark på kontoen?
      *
T5.40c                   eval      rklal2_syst = 'H'
T5.40c                   eval      rklal2_pros = *blank
T5.40c                   eval      rklal2_akti = *blanks
T5.40c                   eval      rklal2_kont = c1kont
T5.40c                   eval      rklal2_spes = *zero
T5.40c                   eval      rklal2_avde = *zero
T5.40c     rklal2_key    setll     rklal2                                 94
      *
T5.40c                   if        *in94 = *on
T5.40c                   eval      C2notb = 'NOTATARK'
T5.40c                   endif
      *
     c                   exfmt     c2bld
      *
      * Endre kolonne
      *
     c                   if        *inki = *on
     c                   exsr      xv1win
     c                   goto      c2tagb
     c                   endif
      *
      * Forrige år
      *
     c                   if        *inke = *on
     c                   eval      v1aar1 = v1aar1 - 1
     c                   eval      v1aar2 = v1aar2 - 1
     c                   goto      c2tagb
     c                   endif
      *
      * Neste år
      *
     c                   if        *inkf = *on
     c                   eval      v1aar1 = v1aar1 + 1
     c                   eval      v1aar2 = v1aar2 + 1
     c                   goto      c2tagb
     c                   endif
      *
      * Saldo/bevegelse
      *
     c                   if        *inkg = *on
      *
     c                   if        w_sabe = 1
     c                   eval      w_sabe = 2
     c                   goto      c2tagb
     c                   else
     c                   eval      w_sabe = 1
     c                   goto      c2tagb
     c                   endif
     c                   endif
      *
      * Call til program for
      * hovedboksposteringer
      *
     c                   if        *inkh = *on
     c                   move      w_firm        w_firm
     c                   eval      p_kont = c1kont
     c                   eval      p_spes = c1spes
     c                   eval      p_avde = c1avde
      *
     c                   call      'RH512R'
     c                   parm                    w_sude
     c                   parm                    b2raar
E5.40c*                  parm                    b2rper
     c                   parm                    p_kont
     c                   parm                    p_spes
     c                   parm                    p_avde
      *
     c                   goto      c2tagb
     c                   endif
      *
      * Oppkall av notatark.
      *
     c                   if        *inkb = *on
     c                   move      w_firm        rxfirm
     c                   move      'H'           rxsyst
E5.40c                   move      *blank        rxpros
     c                   move      *blank        rxakti
T5.20c                   move      *zeros        rxkont
     c                   move      c1kont        rxkont
     c                   move      b1spes        rxspes
     c                   move      b1avde        rxavde
     c                   eval      rxlinj = *zeros
     c                   eval      rxtext = *blank
     c                   move      b1valg        rxvalg
T5.40c                   move      *loval        rxtist
T5.40c                   eval      rxbiln = *zero
T5.40c                   eval      rxrper = *zero
T5.40c                   eval      rxraar = *zero
T5.40c                   eval      rxonr  = *zero
     c                   move      rxulda        rxupar
      *
     c                   call      'RF020R'
     c                   parm                    rxupar
      *
     c                   move      rxupar        rxulda
     c                   goto      c2tagb
     c                   endif
      *
     c     *inkc         cabeq     *on           c2tag1
     c     *inkl         cabeq     *on           c2tag1
     c     *in30         cabeq     *on           c2tag1
      *
      * Oppdater subfile
      *
     c     c2tag1        tag
      *
     c                   eval      b2kont = *zero
     c                   eval      b2spes = *zero
     c                   eval      b2avde = *zero
     c                   move      *off          *in30
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * V1WIN Behandle bilde for endring av kolonne                     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xv1win        begsr
      *
     c                   eval      wactli = 9
     c                   eval      wactpo = 40
     c                   exfmt     v1win
      *
     c     *inkc         cabeq     *on           v1tag1
     c     *inkl         cabeq     *on           v1tag1
      *
     c     v1tag1        tag
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * XC2LES Leser file og flytter felter til C2BLD                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xc2les        begsr
      *
     c                   move      c1kont        s_kont
      *
      * Hente inn kontotekst
      *
     c                   move      c1kont        p_kont
     c                   move      c1spes        p_spes
     c                   move      c1avde        p_avde
      *
     c                   exsr      hent_kto
      *
     c                   move      p_text        c2text
      *
      * Hente inn kostnadsbærertekst
      *
     c                   if        c1spes <> 0
     c                   eval      p_bkod = c1spes
     c                   exsr      hent_sps
     c                   eval      c2btxt = p_btxt
     c                   else
     c                   eval      c2btxt = *blank
     c                   endif
      *
      * Legger opp heading
      * over to første kolonner
      *
     C                   select
     c                   when      v1inh1 = 'R'
     c                   eval      c2hed1 = ' Regnskap'
     c                   move      1             wk1typ
     c                   when      v1inh1 = 'B'
     c                   eval      c2hed1 = ' Budsjett'
     c                   move      3             wk1typ
     c                   when      v1inh1 = 'A'
     c                   eval      c2hed1 = ' Alt.buds'
     c                   move      4             wk1typ
     c                   endsl
      *
     C                   select
     c                   when      v1inh2 = 'R'
     c                   eval      c2hed2 = ' Regnskap'
     c                   move      1             wk2typ
     c                   when      v1inh2 = 'B'
     c                   eval      c2hed2 = ' Budsjett'
     c                   move      3             wk2typ
     c                   when      v1inh2 = 'A'
     c                   eval      c2hed2 = ' Alt.buds'
     c                   move      4             wk2typ
     c                   endsl
      *
     c                   eval      c2hed3 = ' Differanse'
     c                   eval      c2hed4 = 'Brukt/oppnådd'
      *
      * Legger opp årstall
      * i de to første kolonner
      *
     c                   movel     v1aar1        wk1hlp
     c                   movel     v1aar2        wk2hlp
     c                   move      wk1hlp        c2hed1
     c                   move      wk2hlp        c2hed2
      *
      * Henter data inn fra saldomatrise og
      * plasserer i skjermbilde
      *
     c                   eval      rhsal1_kont = c1kont
     c                   eval      rhsal1_spes = c1spes
     c                   eval      rhsal1_avde = c1avde
      *
     c/eject
      *
      * Summert
      *
     c                   if        w_sude = 'S'
      *
     c     rhsal1_keya   setll     rhsal1
     c     rhsal1_keya   reade     rhsal1                                 16
      *
     c                   dow       *in16 = *off
      *
     c                   select
     c                   when      ritype = wk1typ and riraar = v1aar1
     c                   goto      xkol1s
      *
     c                   when      ritype = wk2typ and riraar = v1aar2
     c                   goto      xkol2s
      *
     c                   other
     c                   goto      neste
     c                   endsl
      *
      * Kolonne 1
      *
     c     xkol1s        tag
      *
     c                   eval      w2k100 = w2k100 + isa(14)
     c                   eval      w2k101 = w2k101 + isa(1)
     c                   eval      w2k102 = w2k102 + isa(2)
     c                   eval      w2k103 = w2k103 + isa(3)
     c                   eval      w2k104 = w2k104 + isa(4)
     c                   eval      w2k105 = w2k105 + isa(5)
     c                   eval      w2k106 = w2k106 + isa(6)
     c                   eval      w2k107 = w2k107 + isa(7)
     c                   eval      w2k108 = w2k108 + isa(8)
     c                   eval      w2k109 = w2k109 + isa(9)
     c                   eval      w2k110 = w2k110 + isa(10)
     c                   eval      w2k111 = w2k111 + isa(11)
     c                   eval      w2k112 = w2k112 + isa(12)
     c                   eval      w2k113 = w2k113 + isa(13)
     c                   xfoot     isa           c2k114
     c                   eval      w2k114 = w2k114 + c2k114
      *
     c                   goto      neste
      *
     c     xkol2s        tag
      *
      * Kolonne 2
      *
     c                   eval      w2k200 = w2k200 + isa(14)
     c                   eval      w2k201 = w2k201 + isa(1)
     c                   eval      w2k202 = w2k202 + isa(2)
     c                   eval      w2k203 = w2k203 + isa(3)
     c                   eval      w2k204 = w2k204 + isa(4)
     c                   eval      w2k205 = w2k205 + isa(5)
     c                   eval      w2k206 = w2k206 + isa(6)
     c                   eval      w2k207 = w2k207 + isa(7)
     c                   eval      w2k208 = w2k208 + isa(8)
     c                   eval      w2k209 = w2k209 + isa(9)
     c                   eval      w2k210 = w2k210 + isa(10)
     c                   eval      w2k211 = w2k211 + isa(11)
     c                   eval      w2k212 = w2k212 + isa(12)
     c                   eval      w2k213 = w2k213 + isa(13)
     c                   xfoot     isa           c2k214
     c                   eval      w2k214 = w2k214 + c2k214
      *
     c     neste         tag
      *
     c     rhsal1_keya   reade     rhsal1                                 16
     c                   enddo
      *
      * Hente inn avdelingstekst
      *
     c                   eval      c1avde = *zero
     c                   eval      c2gtxt = 'Sum alle avdelinger'
      *
     c                   endif
      *
     c                   if        w_sabe = 1
     c                   eval      c2k100 = w2k100
     c                   eval      c2k101 = w2k101
     c                   eval      c2k102 = w2k102
     c                   eval      c2k103 = w2k103
     c                   eval      c2k104 = w2k104
     c                   eval      c2k105 = w2k105
     c                   eval      c2k106 = w2k106
     c                   eval      c2k107 = w2k107
     c                   eval      c2k108 = w2k108
     c                   eval      c2k109 = w2k109
     c                   eval      c2k110 = w2k110
     c                   eval      c2k111 = w2k111
     c                   eval      c2k112 = w2k112
     c                   eval      c2k114 = w2k113 + w2k114
      *
     c                   eval      c2k200 = w2k200
     c                   eval      c2k201 = w2k201
     c                   eval      c2k202 = w2k202
     c                   eval      c2k203 = w2k203
     c                   eval      c2k204 = w2k204
     c                   eval      c2k205 = w2k205
     c                   eval      c2k206 = w2k206
     c                   eval      c2k207 = w2k207
     c                   eval      c2k208 = w2k208
     c                   eval      c2k209 = w2k209
     c                   eval      c2k210 = w2k210
     c                   eval      c2k211 = w2k211
     c                   eval      c2k212 = w2k212
     c                   eval      c2k214 = w2k213 + w2k214
     c                   endif
      *
     c                   if        w_sabe = 2
     c                   eval      c2k100 = w2k100
     c                   eval      c2k101 = c2k100 + w2k101
     c                   eval      c2k102 = c2k101 + w2k102
     c                   eval      c2k103 = c2k102 + w2k103
     c                   eval      c2k104 = c2k103 + w2k104
     c                   eval      c2k105 = c2k104 + w2k105
     c                   eval      c2k106 = c2k105 + w2k106
     c                   eval      c2k107 = c2k106 + w2k107
     c                   eval      c2k108 = c2k107 + w2k108
     c                   eval      c2k109 = c2k108 + w2k109
     c                   eval      c2k110 = c2k109 + w2k110
     c                   eval      c2k111 = c2k110 + w2k111
     c                   eval      c2k112 = c2k111 + w2k112
     c                   eval      c2k114 = c2k112 + w2k113
      *
     c                   eval      c2k200 = w2k200
     c                   eval      c2k201 = c2k200 + w2k201
     c                   eval      c2k202 = c2k201 + w2k202
     c                   eval      c2k203 = c2k202 + w2k203
     c                   eval      c2k204 = c2k203 + w2k204
     c                   eval      c2k205 = c2k204 + w2k205
     c                   eval      c2k206 = c2k205 + w2k206
     c                   eval      c2k207 = c2k206 + w2k207
     c                   eval      c2k208 = c2k207 + w2k208
     c                   eval      c2k209 = c2k208 + w2k209
     c                   eval      c2k210 = c2k209 + w2k210
     c                   eval      c2k211 = c2k210 + w2k211
     c                   eval      c2k212 = c2k211 + w2k212
     c                   eval      c2k214 = c2k212 + w2k213
     c                   endif
      *
     c/eject
      *
      * Detaljert
      *
     c                   if        w_sude = 'D'
      *
     c                   eval      rhsal1_kont = c1kont
     c                   eval      rhsal1_type = wk1typ
     c                   eval      rhsal1_raar = v1aar1
     c     rhsal1_key    chain     rhsal1                             60
      *
     c                   if        w_sabe = 1
     c                             and *in60 = *off
     c                   eval      c2k100 = isa(14)
     c                   eval      c2k101 = isa(1)
     c                   eval      c2k102 = isa(2)
     c                   eval      c2k103 = isa(3)
     c                   eval      c2k104 = isa(4)
     c                   eval      c2k105 = isa(5)
     c                   eval      c2k106 = isa(6)
     c                   eval      c2k107 = isa(7)
     c                   eval      c2k108 = isa(8)
     c                   eval      c2k109 = isa(9)
     c                   eval      c2k110 = isa(10)
     c                   eval      c2k111 = isa(11)
     c                   eval      c2k112 = isa(12)
     c                   xfoot     isa           c2k114
     c                   endif
      *
     c                   if        w_sabe = 2
     c                             and *in60 = *off
     c                   eval      c2k100 = isa(14)
     c                   eval      c2k101 = c2k100 + isa(1)
     c                   eval      c2k102 = c2k101 + isa(2)
     c                   eval      c2k103 = c2k102 + isa(3)
     c                   eval      c2k104 = c2k103 + isa(4)
     c                   eval      c2k105 = c2k104 + isa(5)
     c                   eval      c2k106 = c2k105 + isa(6)
     c                   eval      c2k107 = c2k106 + isa(7)
     c                   eval      c2k108 = c2k107 + isa(8)
     c                   eval      c2k109 = c2k108 + isa(9)
     c                   eval      c2k110 = c2k109 + isa(10)
     c                   eval      c2k111 = c2k110 + isa(11)
     c                   eval      c2k112 = c2k111 + isa(12)
     c                   eval      c2k114 = c2k112
     c                   endif
      *
      * Kolonne 2
      *
     c                   eval      rhsal1_type = wk2typ
     c                   eval      rhsal1_raar = v1aar2
     c     rhsal1_key    chain     rhsal1                             60
      *
     c                   if        w_sabe = 1
     c                             and *in60 = *off
     c                   eval      c2k200 = isa(14)
     c                   eval      c2k201 = isa(1)
     c                   eval      c2k202 = isa(2)
     c                   eval      c2k203 = isa(3)
     c                   eval      c2k204 = isa(4)
     c                   eval      c2k205 = isa(5)
     c                   eval      c2k206 = isa(6)
     c                   eval      c2k207 = isa(7)
     c                   eval      c2k208 = isa(8)
     c                   eval      c2k209 = isa(9)
     c                   eval      c2k210 = isa(10)
     c                   eval      c2k211 = isa(11)
     c                   eval      c2k212 = isa(12)
     c                   xfoot     isa           c2k214
     c                   endif
      *
     c                   if        w_sabe = 2
     c                             and *in60 = *off
     c                   eval      c2k200 = isa(14)
     c                   eval      c2k201 = c2k200 + isa(1)
     c                   eval      c2k202 = c2k201 + isa(2)
     c                   eval      c2k203 = c2k202 + isa(3)
     c                   eval      c2k204 = c2k203 + isa(4)
     c                   eval      c2k205 = c2k204 + isa(5)
     c                   eval      c2k206 = c2k205 + isa(6)
     c                   eval      c2k207 = c2k206 + isa(7)
     c                   eval      c2k208 = c2k207 + isa(8)
     c                   eval      c2k209 = c2k208 + isa(9)
     c                   eval      c2k210 = c2k209 + isa(10)
     c                   eval      c2k211 = c2k210 + isa(11)
     c                   eval      c2k212 = c2k211 + isa(12)
     c                   eval      c2k214 = c2k212
     c                   endif
      *
      * Hente inn avdelingstekst
      *
     c                   move      b1avde        p_gkod
     c                   call      'RS707R'
     c                   parm                    p_stat
     c                   parm                    p_gkod
     c                   parm                    p_tx20
      *
     c                   move      p_gkod        c1avde
     c                   movel     p_tx20        c2gtxt
      *
     c                   endif
      *
      * Kolonne 3
      *
     c                   eval      c2k300 = c2k100 - c2k200
     c                   eval      c2k301 = c2k101 - c2k201
     c                   eval      c2k302 = c2k102 - c2k202
     c                   eval      c2k303 = c2k103 - c2k203
     c                   eval      c2k304 = c2k104 - c2k204
     c                   eval      c2k305 = c2k105 - c2k205
     c                   eval      c2k306 = c2k106 - c2k206
     c                   eval      c2k307 = c2k107 - c2k207
     c                   eval      c2k308 = c2k108 - c2k208
     c                   eval      c2k309 = c2k109 - c2k209
     c                   eval      c2k310 = c2k110 - c2k210
     c                   eval      c2k311 = c2k111 - c2k211
     c                   eval      c2k312 = c2k112 - c2k212
     c                   eval      c2k314 = c2k114 - c2k214
      *
      * Kolonne 4
      *
     c                   eval      diff = c2k300
     c                   eval      saml = c2k200
     c                   exsr      brukt
     c                   eval      c2k400 = pros
      *
     c                   eval      diff = c2k301
     c                   eval      saml = c2k201
     c                   exsr      brukt
     c                   eval      c2k401 = pros
      *
     c                   eval      diff = c2k302
     c                   eval      saml = c2k202
     c                   exsr      brukt
     c                   eval      c2k402 = pros
      *
     c                   eval      diff = c2k303
     c                   eval      saml = c2k203
     c                   exsr      brukt
     c                   eval      c2k403 = pros
      *
     c                   eval      diff = c2k304
     c                   eval      saml = c2k204
     c                   exsr      brukt
     c                   eval      c2k404 = pros
      *
     c                   eval      diff = c2k305
     c                   eval      saml = c2k205
     c                   exsr      brukt
     c                   eval      c2k405 = pros
      *
     c                   eval      diff = c2k306
     c                   eval      saml = c2k206
     c                   exsr      brukt
     c                   eval      c2k406 = pros
      *
     c                   eval      diff = c2k307
     c                   eval      saml = c2k207
     c                   exsr      brukt
     c                   eval      c2k407 = pros
      *
     c                   eval      diff = c2k308
     c                   eval      saml = c2k208
     c                   exsr      brukt
     c                   eval      c2k408 = pros
      *
     c                   eval      diff = c2k309
     c                   eval      saml = c2k209
     c                   exsr      brukt
     c                   eval      c2k409 = pros
      *
     c                   eval      diff = c2k310
     c                   eval      saml = c2k210
     c                   exsr      brukt
     c                   eval      c2k410 = pros
      *
     c                   eval      diff = c2k311
     c                   eval      saml = c2k211
     c                   exsr      brukt
     c                   eval      c2k411 = pros
      *
     c                   eval      diff = c2k312
     c                   eval      saml = c2k212
     c                   exsr      brukt
     c                   eval      c2k412 = pros
      *
     c                   eval      diff = c2k314
     c                   eval      saml = c2k214
     c                   exsr      brukt
     c                   eval      c2k414 = pros
      *
     c                   endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for tømming av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     clr_subfile   begsr
      *
     c                   eval      *in14 = *on
     c                   write     b2ctl
     c                   eval      *in14 = *off
      *
     c                   eval      *in15 = *off
     c                   eval      w_srrn = 0
     c                   eval      w_sfrn = 0
     c                   eval      w_ssrn = 0
     c                   eval      w_spge = 0
      *
     c                   eval      w_dper = 0
     c                   eval      w_hitt = 0
      *
     c                   endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å fylle opp subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     crt_subfile   begsr
      *
     c                   eval      w_spge = w_spge + c_sfil
     c                   eval      w_srrn = w_ssrn
T5.40c                   eval      *in88  = *off
      *
     c                   dou       w_srrn = w_spge
      *
     c                   select
     c                   when      w_seqe = 'K'
     c                   read      rhsal1
     c                   when      w_seqe = 'A'
     c                   read      rhsal2
     c                   when      w_seqe = 'B'
     c                   read      rhsal3
     c                   endsl
      *
     c                   if        %eof and
     c                             w_sude = 'D'
     c                   leave
     c                   endif
      *
     c                   if        %eof and
     c                             w_sude = 'S'
     c                   leave
     c                   endif
      *
     c                   if        %eof or
     c                             rifirm <> w_firm
     c                   eval      *in15 = *on
     c                   iter
     c                   endif
      *
      * Aktuelt år ?
      *
     c                   if        riraar <> b2raar
     c                   iter
     c                   endif
      *
      * Aktuell record-type ?
      *
     c                   if        ritype <> s_type
     c                   iter
     c                   endif
      *
      * Detaljert
      *
     c                   if        w_sude = 'D'
      *
     c                   eval      b1valg = *zeros
     c                   eval      b1kont = rikont
     c                   eval      b1spes = rispes
     c                   eval      b1avde = riavde
      *
     c                   eval      p_kont = rikont
     c                   eval      p_spes = rispes
     c                   eval      p_avde = riavde
     c                   exsr      hent_kto
     c                   movel     p_text        b1text
      *
     c                   exsr      beregn_sum
      *
     c                   eval      b1dper = w_dper
     c                   eval      b1hitt = w_hitt
      *
     c                   eval      w_srrn = w_srrn + 1
      *
     c                   write     b1sfl
      *
     c                   eval      w_dper = 0
     c                   eval      w_hitt = 0
      *
     c                   endif
      *
      * Summert
      *
     c                   if        w_sude = 'S'
      *
     c                   if        rikont <> s_kont and
     c                             s_kont <> 0
      *
     c                   eval      b1valg = *zeros
     c                   eval      b1kont = s_kont
     c                   eval      b1spes = *zero
     c                   eval      b1avde = *zero
      *
     c                   eval      p_kont = b1kont
     c                   eval      p_spes = 0
     c                   eval      p_avde = 0
     c                   exsr      hent_kto
     c                   eval      b1text = p_text
      *
     c                   eval      b1dper = w_dper
     c                   eval      b1hitt = w_hitt
      *
     c                   eval      w_srrn = w_srrn + 1
      *
     c                   write     b1sfl
      *
     c                   eval      w_dper = 0
     c                   eval      w_hitt = 0
      *
     c                   endif
      *
     c                   eval      s_kont = rikont
     c                   exsr      beregn_sum
T5.40c                   eval      *in88  = *on
      *
     c                   endif
      *
     c                   enddo
      *
      * Legg ut siste konto når summert
      *
     c                   if        %eof and
     c                             w_sude = 'S' and
T5.40c                             *in88 = *on
S5.40c*                            *in10 = *off
      *
     c                   eval      b1valg = *zeros
     c                   eval      b1kont = s_kont
     c                   eval      b1spes = *zero
     c                   eval      b1avde = *zero
      *
     c                   eval      p_kont = b1kont
     c                   eval      p_spes = 0
     c                   eval      p_avde = 0
     c                   exsr      hent_kto
     c                   eval      b1text = p_text
      *
     c                   eval      b1dper = w_dper
     c                   eval      b1hitt = w_hitt
      *
     c                   eval      w_srrn = w_srrn + 1
      *
     c                   write     b1sfl
     c                   endif
      *
     c                   if        w_srrn > w_ssrn
     c                   eval      w_sfrn = w_ssrn + 1
     c                   endif
      *
     c                   eval      w_ssrn = w_srrn
     c                   eval      w_virn = w_sfrn
      *
     c                   endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å bla tilbake en side i subfilen
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     bck_subfile   begsr
      *
     c                   if        *in15
     c                   select
     c                   when      w_seqe = 'K'
     c     rhsal1_key    setgt     rhsal1
     c                   readp     rhsal1
     c                   when      w_seqe = 'A'
     c     rhsal2_key    setgt     rhsal2
     c                   readp     rhsal2
     c                   when      w_seqe = 'B'
     c     rhsal3_key    setgt     rhsal3
     c                   readp     rhsal3
     c                   endsl
     c                   endif
      *
      * Leser tilbake en side
      *
     c                   eval      s_kont = 0
     c                   eval      w_stel = 0
      *
     c                   dou       w_stel = w_ssrn + c_sfil
      *
     c                   select
     c                   when      w_seqe = 'K'
     c                   readp     rhsal1
     c                   when      w_seqe = 'A'
     c                   readp     rhsal2
     c                   when      w_seqe = 'B'
     c                   readp     rhsal3
     c                   endsl
      *
     c                   if        %eof or
     c                             rifirm <> w_firm
     c                   leave
     c                   endif
      *
      * Ta bare med verdier > 0
      *
     c                   select
     c                   when      w_seqe = 'A' and
     c                             riavde = 0
     c                   iter
     c                   when      w_seqe = 'B' and
     c                             rispes = 0
     c                   iter
     c                   endsl
      *
      * Aktuelt år ?
      *
     c                   if        riraar <> b2raar
     c                   iter
     c                   endif
      *
      * Aktuell record-type ?
      *
     c                   if        ritype <> s_type
     c                   iter
     c                   endif
      *
      * Detaljert
      *
     c                   if        w_sude = 'D'
     c                   eval      w_stel = w_stel + 1
     c                   endif
      *
      * Summert
      *
     c                   if        w_sude = 'S'
      *
     c                   if        rikont <> s_kont and
     c                             s_kont <> 0
      *
     c                   eval      w_stel = w_stel + 1
     c                   endif
      *
     c                   eval      s_kont = rikont
     c                   endif
      *
     c                   select
     c                   when      w_seqe = 'K'
     c                   eval      rhsal1_kont = rikont
     c                   when      w_seqe = 'A'
     c                   eval      rhsal2_avde = riavde
     c                   when      w_seqe = 'B'
     c                   eval      rhsal3_spes = rispes
     c                   endsl
      *
     c                   enddo
      *
     c                   if        %eof
     c                   select
     c                   when      w_seqe = 'K'
     c     rhsal1_key    setll     rhsal1
     c                   when      w_seqe = 'A'
     c     rhsal2_key    setll     rhsal2
     c                   when      w_seqe = 'B'
     c     rhsal3_key    setll     rhsal3
     c                   endsl
     c                   endif
      *
      * Blanker og fyller opp subfile
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c                   endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for display av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     dsp_subfile   begsr
      *
     c                   if        w_srrn <> 0
     c                   eval      *in12 = *on
     c                   else
     c                   write     b2cmd
     c                   endif
      *
     c                   eval      *in13 = *on
     c                   exfmt     b2ctl
      *
     c                   eval      *in12 = *off
     c                   eval      *in13 = *off
      *
     c                   endsr
      *
      /eject
      *
      * Subrutine for å hente kontotekst
      *
     c     hent_kto      begsr
      *
     c                   call      'RS740R'
     c                   parm                    p_stat
     c                   parm                    p_kont
     c                   parm                    p_spes
     c                   parm                    p_avde
     c                   parm                    p_text
      *
     c                   endsr
      *
      *
      /eject
      *
      * Subrutine for å hente kostnadsbærertekst
      *
     c     hent_sps      begsr
      *
     c                   call      'RS728R'
     c                   parm                    p_stat
     c                   parm                    p_bkod
     c                   parm                    p_btxt
      *
     c                   endsr
      *
      /eject
      *
      * Subrutine for beregning av differanse i %
      *
     c     brukt         begsr
      *
     c                   if        saml <> *zero
      *
     c                   select
     c                   when      diff / saml * 100 > 9999
     c                   eval      pros = 9999
     c                   when      diff / saml * 100 < -9999
     c                   eval      pros = -9999
     c                   other
     c                   eval(h)   pros  = diff / saml * 100
     c                   eval      pros = pros + 100
     c                   endsl
      *
     c                   else
      *
     c                   if        diff <> *zero
     c                   eval      pros = *zeros
     c                   else
     c                   eval      pros = 100
     c                   endif
      *
     c                   endif
      *
     c                   endsr
      *
      *
      /eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Beregn sum denne periode og hittil i år                         *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     beregn_sum    begsr
      *
     c                   if        b2rper = *zero
     c                   eval      w_hitt = w_hitt + isa(14)
      *
     c                   else
      *
     c                   eval      m = b2rper
      *
     c                   eval      w_dper = w_dper + isa(m)
      *
     c                   eval      w_hitt = w_hitt + isa(14)
      *
     c     1             do        b2rper        n
     c                   eval      w_hitt = w_hitt + isa(n)
     c                   enddo
      *
     c                   endif
      *
     c                   endsr
      *
     c/eject
      *
      * Subrutine for nullstilling av  akkumulatorer
      *
     c     nullstill     begsr
      *
     c                   eval      c2k100 = *zeros
     c                   eval      c2k101 = *zeros
     c                   eval      c2k102 = *zeros
     c                   eval      c2k103 = *zeros
     c                   eval      c2k104 = *zeros
     c                   eval      c2k105 = *zeros
     c                   eval      c2k106 = *zeros
     c                   eval      c2k107 = *zeros
     c                   eval      c2k108 = *zeros
     c                   eval      c2k109 = *zeros
     c                   eval      c2k110 = *zeros
     c                   eval      c2k111 = *zeros
     c                   eval      c2k112 = *zeros
     c                   eval      c2k114 = *zeros
      *
     c                   eval      c2k200 = *zeros
     c                   eval      c2k201 = *zeros
     c                   eval      c2k202 = *zeros
     c                   eval      c2k203 = *zeros
     c                   eval      c2k204 = *zeros
     c                   eval      c2k205 = *zeros
     c                   eval      c2k206 = *zeros
     c                   eval      c2k207 = *zeros
     c                   eval      c2k208 = *zeros
     c                   eval      c2k209 = *zeros
     c                   eval      c2k210 = *zeros
     c                   eval      c2k211 = *zeros
     c                   eval      c2k212 = *zeros
     c                   eval      c2k214 = *zeros
      *
     c                   eval      w2k100 = *zeros
     c                   eval      w2k101 = *zeros
     c                   eval      w2k102 = *zeros
     c                   eval      w2k103 = *zeros
     c                   eval      w2k104 = *zeros
     c                   eval      w2k105 = *zeros
     c                   eval      w2k106 = *zeros
     c                   eval      w2k107 = *zeros
     c                   eval      w2k108 = *zeros
     c                   eval      w2k109 = *zeros
     c                   eval      w2k110 = *zeros
     c                   eval      w2k111 = *zeros
     c                   eval      w2k112 = *zeros
     c                   eval      w2k113 = *zeros
     c                   eval      w2k114 = *zeros
      *
     c                   eval      w2k200 = *zeros
     c                   eval      w2k201 = *zeros
     c                   eval      w2k202 = *zeros
     c                   eval      w2k203 = *zeros
     c                   eval      w2k204 = *zeros
     c                   eval      w2k205 = *zeros
     c                   eval      w2k206 = *zeros
     c                   eval      w2k207 = *zeros
     c                   eval      w2k208 = *zeros
     c                   eval      w2k209 = *zeros
     c                   eval      w2k210 = *zeros
     c                   eval      w2k211 = *zeros
     c                   eval      w2k212 = *zeros
     c                   eval      w2k213 = *zeros
     c                   eval      w2k214 = *zeros
      *
     c                   endsr
      /eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for posisjonering på konto
      *
     c     rhsal1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rhsal1_kont
     c                   kfld                    rhsal1_spes
     c                   kfld                    rhsal1_avde
     c                   kfld                    rhsal1_raar
     c                   kfld                    rhsal1_type
      *
      * Key for les av konto
      *
     c     rhsal1_keya   klist
     c                   kfld                    w_firm
     c                   kfld                    rhsal1_kont
      *
      * Key for posisjonering på avdeling
      *
     c     rhsal2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rhsal2_avde
     c                   kfld                    rhsal2_kont
     c                   kfld                    rhsal2_spes
      *
      * Key for posisjonering på kosnadsbærer
      *
     c     rhsal3_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rhsal3_spes
     c                   kfld                    rhsal3_kont
     c                   kfld                    rhsal3_avde
      *
T5.40 * Key for notatark
      *
T5.40c     rklal2_key    klist
T5.40c                   kfld                    w_firm
T5.40c                   kfld                    rklal2_syst
T5.40c                   kfld                    rklal2_pros
T5.40c                   kfld                    rklal2_akti
T5.40c                   kfld                    rklal2_kont
T5.40c                   kfld                    rklal2_spes
T5.40c                   kfld                    rklal2_avde
      *
      * Henter firmanummer fra LDA
      *
     c                   eval      w_firm = l_firm
      *
     c                   eval      *in22 = *on
      *
      * Posisjonerer databasen, og fyller opp subfile
      *
     c                   eval      wk1typ = *zero
     c                   eval      wk2typ = *zero
     c                   eval      wk3typ = *zero
     c                   eval      wk4typ = *zero
     c                   eval      n = *zero
     c                   eval      wk1hlp = *blank
     c                   eval      wk2hlp = *blank
      *
      * Legge inn år/periode
      *
     c                   move      *month        b2rper
     c                   move      *year         b2raar
      *
     c                   move      b2raar        s_raar
     c                   move      b2rper        s_rper
      *
      * Legge inn record-type
      *
     c                   move      1             s_type
      *
      * Legge inn standard valg for kolonner
      *
     c                   move      'R'           v1inh1
     c                   move      'B'           v1inh2
     c                   move      b2raar        v1aar1
     c                   move      b2raar        v1aar2
      *
      * Legge inn kode som viser første sett av kommandotaster
      *
      * Legge inn kode for saldo/bevegelse
      *
     c                   eval      w_sabe = 1
      *
      * Legge inn kode for sum/detalj
      *
     c                   move      'S'           w_sude
      *
     c                   eval      w_seqe = 'K'
     c                   eval      rhsal1_kont = 0
     c                   eval      rhsal1_spes = 0
     c                   eval      rhsal1_avde = 0
     c     rhsal1_key    setll     rhsal1
     c                   exsr      crt_subfile
      *
     c                   endsr
