     h option(*nodebugio : *srcstmt) datedit(*dmy)
      // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      //
      // System. . . . . : NXCLOUD
      // Program . . . . : IT124R
      // Beskrivelse . . : Logger feilmeldinger på msterdata overføringer
      //
      // Spesialversjon. :
      // Tilpasset for . :
      //
      // Ref.   Dato  Sign Endringsbeskrivelse
      // ----- ------ ---- -------------------------------------------------
      //       011222 ask  Nytt program
8.01  // 800   091024 ask  Justert meldingstyper til 20 pos
      // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      //
      //
      // Parameter-inn
      //
     d p_firm          s              3  0
     d p_comd          s             20
     d p_date          s               d   datfmt(*iso)
     d p_time          s               t   timfmt(*iso)
     d p_parm          s           2048
     d p_user          s             10
     d p_stat          s              1
     d p_inlr          s              1
      //
      // Definering av variable
      //
     d w_serv          s             30
     d w_abid          s             10
     d w_feil          s            200
     d w_type          s             25
     d w_num1          s              6  0
     d w_num2          s              6  0
     d w_alf1          s              1
     d w_alf2          s              6

       Exec SQL
         Set Option DatFmt=*ISO, DlyPrp=*YES, SRTSEQ=*LANGIDUNQ, LANGID=NOR,
                    commit=*none;

       // Hovedprogram - oppdaterer informasjon på loggfil, setter statusflagg

       // -------------------------------------------------------
       // Sjekk om det er "siste runde" for å lukke tabeller
       // -------------------------------------------------------

         if        p_inlr = ' ';
            exsr red_flt;
          else;
            *inlr = *on;
         endif;

         return;

      // -------------------------------------------------------
      // Redigerer felter fra parameter streng
      // -------------------------------------------------------

       begsr red_flt;

      // Felles felter

         w_num1 = 0;
         w_num2 = 0;
         w_alf1 = ' ';
         w_alf2 = ' ';

         w_serv = %subst(p_parm:1:30);
         w_abid = %subst(p_parm:31:10);
         w_feil = %subst(p_parm:41:200);

      // Type avhengige felter

         if p_comd = 'CUSTOMER_EXP_FAILURE';
           w_type = 'KUND';
           w_num1 = %dec(%trim(%subst(p_parm:241:6)):6:0);
           exsr upd_log;
           p_stat='1';
         endif;

         if p_comd = 'VENDOR_EXP_FAILURE';
           w_type = 'LEVR';
           w_num1 = %dec(%trim(%subst(p_parm:241:6)):6:0);
           exsr upd_log;
           p_stat='1';
         endif;

         if p_comd = 'CONTACT_EXP_FAILURE';
           w_type = 'KONT';
           w_alf1 = %subst(p_parm:241:1);
           w_num1 = %dec(%trim(%subst(p_parm:242:6)):6:0);
           w_num2 = %dec(%trim(%subst(p_parm:248:6)):6:0);
           exsr upd_log;
           p_stat='1';
         endif;

         if p_comd = 'PROJECT_EXP_FAILURE';
           w_type = 'PROS';
           w_alf2 = %subst(p_parm:241:6);
           exsr upd_log;
           p_stat='1';
         endif;

8.01     if p_comd = 'ARICLE_PRICE_EXP_FAI';
           w_type = 'PRIS';
           exsr upd_log;
           p_stat='1';
         endif;

         if p_comd = 'CAMPAIGN_EXP_FAILURE';
           w_type = 'KAMP';
           exsr upd_log;
           p_stat='1';
         endif;

8.01     if p_comd = 'CAMPAIGN_PRICE_EXP_F';
           w_type = 'KPRI';
           exsr upd_log;
           p_stat='1';
         endif;

8.01     if p_comd = 'CASH_RECEIPT_EXP_FAI';
           w_type = 'BONG';
           exsr upd_log;
           p_stat='1';
         endif;

8.01     if p_comd = 'CUSTOMER_ORDER_EXP_F';
           w_type = 'KORD';
           exsr upd_log;
           p_stat='1';
         endif;

8.01     if p_comd = 'INVENTORY_EXP_FAILUR';
           w_type = 'LAGE';
           exsr upd_log;
           p_stat='1';
         endif;

         if p_comd = 'PRICE_UNIT_FAILURE';
           w_type = 'PENH';
           exsr upd_log;
           p_stat='1';
         endif;

8.01     if p_comd = 'CUST_BAL_IMP_FAILURE';
           w_type = 'SALD';
           p_stat='1';
         endif;

       endsr;

      // ---------------------------------------
      // Oppdatere logg med melding
      // ---------------------------------------

       begsr upd_log;

       exec sql
         insert into mlogst
           (mlofir, mlotyp, mlodat, mlotim, mlota1, mlotn1,
            mlotn2, mlota2, mloerr, mlosrv, mloaid, mlooda,
            mlooti, mloous)
          values(:p_firm, :w_type, :p_date, :p_time, :w_alf1, :w_num1,
                 :w_num2, :w_alf2, :w_feil, :w_serv, :w_abid, :p_date,
                 :p_time, :p_user);
        if sqlcod <> 0;
        endif;
       endsr;

      //
      // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      // ERROR-rutine
      // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      //
       begsr *pssr;

         p_stat = '5';
         *inlr = *on;
        return;

       endsr;
      //
      // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      //  Subrutine for initiering av program
      // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      //
       begsr *inzsr;
         //
     c     *entry        plist
     c                   parm                    p_firm
     c                   parm                    p_comd
     c                   parm                    p_date
     c                   parm                    p_time
     c                   parm                    p_parm
     c                   parm                    p_user
     c                   parm                    p_stat
     c                   parm                    p_inlr
      //
       endsr;
