     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * System. . . . . : ASOKON                                        *     *
      * Program . . . . : RH634R                                        *
      * Beskrivelse . . : Hovedbok, utvelgelse av poster                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      * Spesialversjon. :                                               *
      * Tilpasset for . :                                               *
      *                                                                 *
      * Referanse  Dato   Endringsbeskrivelse                      Sign.*
      * --------- ------  ----------------------------------------------*
      *                   Nytt program jaunuar 2004                 KOB *
T5.30 * 5.30      210704  Unntatt fungerte ikke                     HFL *
T5.30 * 5.30      141104  Utskrift av enkeltkonti fungerte ikke     KOB *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      *  BRUK AV INDIKATORER                                            *
      *                                                                 *
      *       KA = F1  = Valg av firma                                  *
      *       KC = F3  = Exit                                           *
      *                                                                 *
      *       LR = Avslutt program                                      *
      *       30 = Protect av felter ved vise                           *
      *    31-59 = Varsle m/feilmeldinger/skjermindikatorer             *
      *    60-69 = Fileindikatorer chain etc.                           *
      *    70-79 = Arbeidsindikatorer i sub-rutiner                     *
      *    80-89 = Arbeidsindikatorer ordinære                          *
      *    90-99 = Benyttes ved std. sub-rutiner                        *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     frhtrl1    if   e           k disk    rename(rhtrpfr:rhtrl1r)
     frhw1pf    o  a e           k disk    rename(rhw1pfr:rhw1pfr)
      *
     d bkt             s              5  0 dim(40)
      *
     d                uds
     d rhpkda                300    305  0
     d rhprÅr                         4  0
     d rhpper                         2  0
     d rhppef                         2  0
     d rhppet                         2  0
     d rhpavf                         4  0
     d rhpavt                         4  0
     d rhpspf                         4  0
     d rhpspt                         4  0
     d rhpktf                         5  0
     d rhpktt                         5  0
     d rhpsrt                         1
     d rhpsml                         1
     d rhpavv                         1
     d rhpkgs                         1
     d rhpkks                         1
     d rhpsps                         1
     d rhpktu                         1
     d rhpk01                         5  0
     d rhpk02                         5  0
     d rhpk03                         5  0
     d rhpk04                         5  0
     d rhpk05                         5  0
     d rhpk06                         5  0
     d rhpk07                         5  0
     d rhpk08                         5  0
     d rhpk09                         5  0
     d rhpk10                         5  0
     d rhpk11                         5  0
     d rhpk12                         5  0
     d rhpk13                         5  0
     d rhpk14                         5  0
     d rhpk15                         5  0
     d rhpk16                         5  0
     d rhpk17                         5  0
     d rhpk18                         5  0
     d rhpk19                         5  0
     d rhpk20                         5  0
     d rhpk21                         5  0
     d rhpk22                         5  0
     d rhpk23                         5  0
     d rhpk24                         5  0
     d rhpk25                         5  0
     d rhpk26                         5  0
     d rhpk27                         5  0
     d rhpk28                         5  0
     d rhpk29                         5  0
     d rhpk30                         5  0
     d rhpk31                         5  0
     d rhpk32                         5  0
     d rhpk33                         5  0
     d rhpk34                         5  0
     d rhpk35                         5  0
     d rhpk36                         5  0
     d rhpk37                         5  0
     d rhpk38                         5  0
     d rhpk39                         5  0
     d rhpk40                         5  0
      *
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av variabler i nøkler
      *
     d rhtrl1_firm     s                   like(rbfirm)
     d rhtrl1_raar     s                   like(rbraar)
      *
      * Sorteringsbegrep
      *
     d
     d wksort          ds
     d  wkfirm                        3  0                                      Firma
     d  wkraar                        4  0                                      Kunde
     d  wkkon1                        6  0                                      Bilags
     d  wkrper                        2  0                                      Bilags
     d  wkkon2                        6  0                                      Bilags
     d  wkkon3                        6  0                                      Bilags
     d  wkbdat                         d   datfmt(*iso)                         Bilags
6.NU d  wkbiln                        8  0                                      Bilags
     d  wktist                             like(rbtist)                         Post-n
      *
     d w_firm          s              3  0
     d w_raar          s              4  0
      *
     d m               s              2  0
     d n               s              2  0
     d tstkt           s              7  0
     d tst_tran        s              1
     d x               s              2  0
      *
      /eject
      *
     c     rhtrl1_key    setll     rhtrl1r                                61
     c     rhtrl1_key    reade     rhtrl1r                                61
      *
     c                   dow       *in61 = *off                                          .....
      *
      * Sjekk periode er > valgt periode
      *
     c                   if        rbrper > rhppet
     c                   goto      neste
     c                   endif
      *
      * Sjekk avdeling fra/til
      *
     c                   if        rbavde < rhpavf or
     c                             rbavde > rhpavt and
     c                             rhpavt > 0
     c                   goto      neste
     c                   endif
      *
      * Sjekk kostnadsbærer fra/til
      *
     c                   if        rbspes < rhpspf or
     c                             rbspes > rhpspt and
     c                             rhpspt > 0
     c                   goto      neste
     c                   endif
      *
      * Sjekk konto fra/til
      *
     c                   if        rbkont < rhpktf or
     c                             rbkont > rhpktt and
     c                             rhpktt > 0
     c                   goto      neste
     c                   endif
      *
      * Test mot utvalg
      *
     c                   if        tstkt > *zeros
     c                   exsr      tst_utv
      *
     c                   if        tst_tran = 'X'
     c                   goto      neste
     c                   endif
     c                   endif
      *
      *  Test om periode < periode-fra
      *
     c                   if        rbrper < rhppef                                       .....
     c                   eval      rbrper = *zero                                            .
     c                   endif                                                           .....
      *
      * Legg ut hovedbokspostering
      *
     c                   eval      wkfirm = rbfirm
     c                   eval      wkraar = rbraar
      *
     c                   select
     c                   when      rhpsrt = 'K'
     c                   eval      wkkon1 = rbkont
     c                   eval      wkkon2 = rbavde
     c                   eval      wkkon3 = rbspes
      *
     c                   when      rhpsrt = 'A'
     c                   eval      wkkon1 = rbavde
     c                   eval      wkkon2 = rbkont
     c                   eval      wkkon3 = rbspes
      *
     c                   when      rhpsrt = 'B'
     c                   eval      wkkon1 = rbspes
     c                   eval      wkkon2 = rbkont
     c                   eval      wkkon3 = rbavde
     c                   endsl
      *
     c                   eval      wkrper = rbrper
     c                   eval      wkbdat = rbbdat
     c                   eval      wkbiln = rbbiln
     c                   eval      wktist = rbtist
      *
     c                   eval      rwkkey = wksort
      *
     c                   write     rhw1pfr                                                   .
      *
     c     neste         tag
      *
     c     rhtrl1_key    reade     rhtrl1r                                61
     c                   enddo
      /space 3
      *
     c     slutt         tag
      *
     c                   eval      *inlr = *on
      *
      /eject
      *
      * Subrutine for kontroll av utvalg
      *
     c     tst_utv       begsr
      *
     c                   eval      tst_tran = *blank
     c                   eval      n = 0
      *
     c                   do        40
     c                   eval      n = n + 1
      *
     c                   if        bkt(n) <> *zeros
      *
      * Konto i utvalg ?
      *
     c                   if        rhpktu = ' ' and
     c                             rbkont = bkt(n)
     c                   goto      tst_end
     c                   endif
      *
      * Konto utelatt ?
      *
     c                   if        rhpktu = 'U' and
     c                             rbkont = bkt(n)
     c                   eval      tst_tran = 'X'
     c                   goto      tst_end
     c                   endif
     c                   endif
      *
     c                   enddo
      *
T5.30c                   if        rhpktu = 'U'
T5.30c                   eval      tst_tran = ' '
T5.30c                   else
     c                   eval      tst_tran = 'X'
T5.30c                   endif
      *
     c     tst_end       endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      *  Flytt utvalgte konti til tabell
      *
     c                   move      rhpk01        bkt(01)
     c                   move      rhpk02        bkt(02)
     c                   move      rhpk03        bkt(03)
     c                   move      rhpk04        bkt(04)
     c                   move      rhpk05        bkt(05)
     c                   move      rhpk06        bkt(06)
     c                   move      rhpk07        bkt(07)
     c                   move      rhpk08        bkt(08)
     c                   move      rhpk09        bkt(09)
     c                   move      rhpk10        bkt(10)
     c                   move      rhpk11        bkt(11)
     c                   move      rhpk12        bkt(12)
     c                   move      rhpk13        bkt(13)
     c                   move      rhpk14        bkt(14)
     c                   move      rhpk15        bkt(15)
     c                   move      rhpk16        bkt(16)
     c                   move      rhpk17        bkt(17)
     c                   move      rhpk18        bkt(18)
     c                   move      rhpk19        bkt(19)
     c                   move      rhpk20        bkt(20)
     c                   move      rhpk21        bkt(21)
     c                   move      rhpk22        bkt(22)
     c                   move      rhpk23        bkt(23)
     c                   move      rhpk24        bkt(24)
     c                   move      rhpk25        bkt(25)
     c                   move      rhpk26        bkt(26)
     c                   move      rhpk27        bkt(27)
     c                   move      rhpk28        bkt(28)
     c                   move      rhpk29        bkt(29)
     c                   move      rhpk30        bkt(30)
     c                   move      rhpk31        bkt(31)
     c                   move      rhpk32        bkt(32)
     c                   move      rhpk33        bkt(33)
     c                   move      rhpk34        bkt(34)
     c                   move      rhpk35        bkt(35)
     c                   move      rhpk36        bkt(36)
     c                   move      rhpk37        bkt(37)
     c                   move      rhpk38        bkt(38)
     c                   move      rhpk39        bkt(39)
     c                   move      rhpk40        bkt(40)
      *
      * Sjekk om kontovalg utfylt
      *
     c                   xfoot     bkt           tstkt
      *
     c                   eval      m = 0
     c                   eval      n = 0
     c                   eval      x = 40
      *
      *  Behandle parametre
      *
     c                   eval      rhtrl1_firm = l_firm
     c                   eval      rhtrl1_raar = rhprÅr
      *
      * Key for hovedboksposteringer
      *
     c     rhtrl1_key    klist
     c                   kfld                    rhtrl1_firm
     c                   kfld                    rhtrl1_raar
      *
     c                   endsr
