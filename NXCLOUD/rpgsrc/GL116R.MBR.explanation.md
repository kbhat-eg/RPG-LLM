# RPG Program `GL116R` Explanation

This ILE RPG program is titled **"ASOKON Tømmer filer"** (Norwegian for "ASOKON Empties Files") and is found in system ASOKON. The main purpose is to clear (delete all records from) a specific set of physical files (database tables), based on a company number ("firmanummer").

Below is a detailed walkthrough:

---

## **Header Comments**

- **Title, Purpose, and Program Info:**
    - System: ASOKON
    - Program: GL116R
    - Description: Empties return files ("Tømmer returfiler.")
    - Created: January 1995 by "RH"
- **Indicators:** (`LR` for program end, 60-69 for file status, etc.)

---

## **File Declarations**

```rpg
fgur1pf    uf   e           k disk
fgur2pf    uf   e           k disk
fgurfpf    uf   e           k disk
fgul1pf    uf   e           k disk
fgul2pf    uf   e           k disk
fgulfpf    uf   e           k disk
```

- Six files are declared as update files (`uf`), externally described (`e`), keyed (`k`), and to be accessed as disk files.
    - `GUR1PF`, `GUR2PF`, `GURFPF`, `GUL1PF`, `GUL2PF`, `GULFPF`

---

## **Data Definitions**

```rpg
d                uds
d dsfirm                944    946  0
```
- Defines a three-digit field `dsfirm` (positions 944-946, 0 decimals).
- Used to hold the "firmanummer"/company number.

---

## **Main Program Logic**

Each file is processed in the following way:

### 1. **GUR1PF**
- Reads and deletes all records for the given company number (`dsfirm`).
- Uses indicator 60 to control end-of-file.

```rpg
c                   dow       *in60 = *off
c                   delete    gur1pfr
c     dsfirm        reade     gur1pf                                 60
c                   enddo
```
- Loop:
    - `delete gur1pfr`: Deletes current record.
    - `reade gur1pf`: Reads next record with key `dsfirm`; sets *IN60 on EOF.

### 2. **GUR2PF, GURFPF, GUL1PF, GUL2PF, GULFPF**
- Each file is processed similarly:
    - Set file pointer to key using `setll dsfirm file`.
    - Read the first record with key using `reade` or `read`.
    - Loop and delete all records for the company.

**For example, for `GUR2PF`:**
```rpg
c     dsfirm        setll     gur2pf
c     dsfirm        reade     gur2pf                                 60
c                   dow       *in60 = *off
c                   delete    gur2pfr
c     dsfirm        reade     gur2pf                                 60
c                   enddo
```

**`GULFPF` is slightly different; after first `reade`/`setll`, a plain `read` is used in the loop.**

---

## **Program End**

```rpg
c     xslutt        tag
c                   eval      *inlr = *on
c                   return
```
- `*inlr = *on` signals program end/close files.
- `return` exits the program.

---

## **Initialization Subroutine**

```rpg
c     *inzsr        begsr
      *
      * Starter les av GUR1PF:
      *
c     dsfirm        setll     gur1pf
c     dsfirm        reade     gur1pf                                 60
c                   endsr
```
- On program startup, sets position to the first record in `GUR1PF` for `dsfirm`.
- Reads the first matching record to set up for the main loop.

---

## **Indicator Usage**

- **`*IN60`**: Used as EOF indicator after `reade`/`read` operations.
- **`*INLR`**: Used to signal end-of-program (Last Record indicator).

---

## **Summary**

**This program deletes (empties) all records for a given company number from six specific files.**  
- It loops through each file, selects records matching the company number key, and deletes them.
- Indicators are used to manage file I/O and loop control.
- Upon completion, it ends the program cleanly and closes files.

### **Typical Use Case**
A batch job run to clean out all pending or return records for a company, possibly at period-end or before re-processing.

---

### **Key RPG/OA Concepts in Use:**
- Disk file processing (`DELETE`, `READE`, `READ`)
- Use of key fields with `SETLL`
- Classic indicator-based loop/end-of-file control
- Structured initialization (`*INZSR`)
- Clean program ending (`*INLR`)

---

**If you are new to RPG or to this program:**
- Get the value for `dsfirm` (your company number) before running.
- Make sure you have backup, as this program will irreversibly delete data for the given company number in the listed files.