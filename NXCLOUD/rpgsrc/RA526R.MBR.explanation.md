# RA526R Program Documentation

## Overview

**Program Name:** RA526R  
**System:** ASOKON  
**Description:** Inquiry program for "Produktansvarlig" (Product Responsible Party)  
**Purpose:**  
This program provides a subfile-based inquiry interface for browsing, searching, and selecting product managers (or product responsible parties) within the system. It is designed for 5250-style workstation displays and supports paging, positioning, and selection functionality.

## Data Model and Files

### Physical/Logical Files

- **FRA26L1**  
  Logical file over `RA26PFR`, renamed as `RA26L1R`. Used for key-based access by product responsible code (`ZSAK`).

- **FRA26L2**  
  Logical file over `RA26PFR`, renamed as `RA26L2R`. Used for key-based access by product responsible description/text (`ZTXT`).

- **FRA526D**  
  Workstation file with subfile support.  
  - Subfile: `B1SFL` (with relative record number `W_SRRN`).

### Subfile Screens

- **B1SFL**: Subfile record format (list of product responsibles).
- **B2CTL**: Subfile control record (header, paging controls).
- **B2CMD**: Command key screen (function key instructions).

## Key Variables and Structures

- **Parameters (from calling program):**
  - `P_FIRM`: Company code.
  - `P_ZSAK`: Product responsible code (optional initial position).
  - `P_ZTXT`: Product responsible description (optional initial position).

- **Subfile Management:**
  - `W_STEL`: Subfile counter.
  - `W_SPGE`: Subfile page size.
  - `W_SRRN`: Current relative record number in the subfile.
  - `W_SFRN`: First record number on the page.
  - `W_SSRN`: Last record number on the page.
  - `W_SEQE`: Sequence indicator (`'B'` = search by description, blank = search by code).

- **Working Fields:**
  - `B_VALG_OK`: Flag for selection completion.
  - `W_FIRM`: Working copy of company code.

- **Constants:**
  - `C_SFIL`: Subfile page size (default 8).

## Indicators (Usage Convention)

- `LR`: End program.
- `10`: Roll (page down).
- `11`: Roll up (page up).
- `12`: Subfile display.
- `13`: Subfile display control.
- `14`: Clear subfile.
- `15`: End of subfile.
- `21`: Home key.
- `22`: Cursor placement.
- `30`: Field protection.
- `31-79`: Error/warning indicators.
- `80-99`: Work indicators.

## Main Program Flow

1. **Initialization (`*INZSR`):**
   - Receives parameters (company, code, description).
   - Sets up key lists for both logical files.
   - Positions the logical file (by code).
   - Loads the initial subfile page.

2. **Main Loop:**
   - Alternates between displaying the command screen (`B2CMD`) and the subfile (`B1SFL` via `B2CTL`).
   - Handles function key processing:
     - `F3/F12`: Exit.
     - `F5`: Refresh/reload current page.
     - `F10`: Page down (next).
     - `F11`: Page up (previous).
     - `F21`: Home/cursor reset.
   - Handles positioning based on input fields (by code or description).
   - Handles selection (if user marks a record).

3. **Subfile Paging:**
   - **Create (`CRT_SUBFILE`):** Reads a page of records from the current logical file, populates the subfile.
   - **Clear (`CLR_SUBFILE`):** Clears subfile buffer and resets counters.
   - **Back (`BCK_SUBFILE`):** Reads previous page.
   - **Display (`DSP_SUBFILE`):** Shows subfile or command screen based on state.

4. **Positioning:**
   - If user enters a code or description for positioning, the program switches access path and repositions file pointer.

5. **Selection:**
   - If user marks a record in the subfile, the corresponding code and description are returned via parameters, and the program exits.

## Subroutines

### `FORNY`
- Refreshes the subfile at the current position.
- Repositions the logical file according to the current sequence (`W_SEQE`).
- Clears and reloads the subfile.

### `POSISJONER`
- Handles explicit positioning requests.
- Sets sequence and key fields based on user input (code or description).
- Clears and reloads the subfile at the new position.
- Clears user input fields for positioning.

### `SUBFILE`
- Toggles cursor placement indicator.
- Iterates through subfile records (using `READC`).
- If a record is marked as selected, sets output parameters and flags for exit.

### `CLR_SUBFILE`
- Sets indicator to clear subfile display.
- Writes control record to clear the subfile.
- Resets subfile counters and indicators.

### `CRT_SUBFILE`
- Reads records from the logical file (by code or description) until page is full or EOF.
- Populates subfile buffer with new records.
- Updates subfile counters and indicators.

### `BCK_SUBFILE`
- Handles paging back (previous page) in the subfile.
- Uses `READP` to move backward in the logical file.
- Repositions to start if EOF reached.
- Clears and refills subfile.

### `DSP_SUBFILE`
- Displays the subfile if records exist, otherwise shows command screen.
- Manages subfile display and control indicators.

### `*INZSR`
- Program initialization.
- Receives parameters, initializes keys, positions logical file, and loads the first page.

## Business/Domain-Specific Logic

- The program is tailored for "Produktansvarlig" (product responsible party) inquiry within the ASOKON system.
- Supports search and positioning by either code or description.
- Subfile paging is implemented with a fixed page size (`C_SFIL` = 8).
- Selection is done by marking a record in the subfile, which sets return parameters for further processing in the calling program.
- Uses two logical files for efficient access by either code or description, supporting flexible user navigation.

## Design Patterns and Conventions

- **Subfile Paging:** Classic 5250 subfile pattern, with explicit management of page size, current/first/last record numbers.
- **Double Logical File Access:** Switches between two access paths (by code or description) based on user input, for efficient positioning.
- **Indicator Management:** Extensive use of indicators for display, control, and error handling, following in-house conventions.
- **Separation of Concerns:** Subroutines are used to encapsulate all subfile operations (clear, create, back, display, refresh).
- **Parameter Passing:** Uses parameter list for input/output, facilitating modular use as a callable inquiry window.

## Integration Points

- **Data:** Relies on `RA26PFR` via two logical files for product responsible master data.
- **UI:** Interacts with DDS display files for subfile display and command screens.
- **External Callers:** Returns selected code/description via parameters; designed to be called as a window from other programs.

## Noteworthy Implementation Details

- **Language/Localization:** Some comments and field names are in Norwegian (e.g., "Produktansvarlig", "Beskrivelse"), reflecting business/domain context.
- **GUI Adaptation:** Comments indicate some changes made for new GUI compatibility (as of version 7.00, 2005-16).
- **Error Handling:** Minimal explicit error handling; relies on indicator conventions for user feedback and control.

## Summary

RA526R is a robust, modular subfile inquiry program for product responsible parties, designed for integration as a lookup window within the ASOKON system. Its structure and conventions reflect best practices for interactive RPG subfile applications, with clear separation of paging, positioning, and selection logic, and flexible access paths for user-driven navigation.