      /TITLE  ASOKON Spørring v.h.a. rapportter (Utvalg)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOKON
      * Program . . . . : RFSYSR
      * Beskrivelse . . : Sjekker om NX økonomisystem
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       060624 bsa  Nytt program
8.01  *K0000  110624 bsa  Sjekk hvilke rutiner som skal kjøres.
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = Avslutt program
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
     fxtill1    if   e           k disk    rename(xtilpfr:xtill1r)
8.01 fbdopl1    if   e           k disk    rename(bdoppfr:bdopl1r)
      *
      *
      * Definering av parametre
     d p_status        s              1
      *
     d                uds
     d l_firm                944    946  0
      *
      * Definering av variabler av nøkler
      *
     d xtill1_regi     s                      like(xtregi)
     d xtill1_felt     s                      like(xtfelt)
     d xtill1_xkey     s                      like(xtxkey)
8.01 d bdopl1_sgr      s                      like(bopsgr)
      *
     d w_firm          s                      like(xtfirm)
      *
8.01 d                 ds
8.01 d ldprec                       256
8.01 d  ldotal                        4    overlay(ldprec)
8.01 d  ldot01                        2    overlay(ldprec:5)
8.01 d  ldot02                        2    overlay(ldprec:7)
8.01 d  ldot03                        2    overlay(ldprec:9)
8.01 d  ldot04                        2    overlay(ldprec:11)
8.01 d  ldot05                        2    overlay(ldprec:13)
8.01 d  ldot06                        2    overlay(ldprec:15)
8.01 d  ldot07                        2    overlay(ldprec:17)
8.01 d  ldot08                        2    overlay(ldprec:19)
8.01 d  ldot09                        2    overlay(ldprec:21)
8.01 d  ldot10                        2    overlay(ldprec:23)
8.01 d  ldwsgr                        6    overlay(ldprec:25)
8.01 d  ldwsal                       10    overlay(ldprec:31)
8.01 d  ldws01                       10    overlay(ldprec:41)
8.01 d  ldws02                       10    overlay(ldprec:51)
8.01 d  ldws03                       10    overlay(ldprec:61)
8.01 d  ldws04                       10    overlay(ldprec:71)
8.01 d  ldws05                       10    overlay(ldprec:81)
8.01 d  ldws06                       10    overlay(ldprec:91)
8.01 d  ldws07                       10    overlay(ldprec:101)
8.01 d  ldws08                       10    overlay(ldprec:111)
8.01 d  ldws09                       10    overlay(ldprec:121)
8.01 d  ldws10                       10    overlay(ldprec:131)
8.01 d  ldavst                        1  0 overlay(ldprec:142)
8.01 d  lddato                       10d   datfmt(*iso)
8.01 d                                     overlay(ldprec:143)
8.01 d  ldperi                        6  0 overlay(ldprec:153)
8.01 d  lddekn                        1  0 overlay(ldprec:159)
8.01 d  ldvdag                        2  0 overlay(ldprec:160)
8.01 d  lddeta                        1  0 overlay(ldprec:162)
8.01 d  ldtota                        1  0 overlay(ldprec:163)
8.01 d  ldfrad                       10d   datfmt(*iso)
8.01 d                                     overlay(ldprec:164)
8.01 d  ldtild                       10d   datfmt(*iso)
8.01 d                                     overlay(ldprec:174)
8.01 d  ldaarr                        4  0 overlay(ldprec:184)
8.01 d  ldlavs                        8  0 overlay(ldprec:188)
8.01 d  ldldet                        6  0 overlay(ldprec:196)
8.01 d  ldtime                        6  0 overlay(ldprec:202)
8.01 d  ldkred                        1  0 overlay(ldprec:208)
8.01 d  ldjobp                        1    overlay(ldprec:209)
8.01 d  ldokoo                        1    overlay(ldprec:210)
      *                                                                    *
      *--------------------------------------------------------------------*
      *
     c     w_firm        chain     fstsl1
     c                   if        not %found
     c                   eval      p_status = '0'
     c                   goto      slutt
     c                   endif
      *
      * Tilleggsregister
      *
     c                   eval      xtill1_regi = 'FSTSPF'
     c                   eval      xtill1_felt = 'OKOSYS'
     c                   eval      xtill1_xkey = *blanks
     c     xtill1_key    chain     xtill1
     c                   if        not %found
     c                   eval      p_status = '0'
     c                   goto      slutt
     c                   endif
8.01  *
8.01  *  Sjekk om dagsoppgjør er satt opp til å kjøres fra jobbplan
8.01  *  og om vi har NX økonomi og automatisk oppdatering.
8.01  *  Det er ikke lov.
8.01  *
8.01 c                   eval      bdopl1_sgr  = *blank
8.01 c     bdopl1_key    chain     bdopl1
8.01 c                   if        %found(bdopl1)
8.01 c                   eval      ldprec = boprec
8.01 c                   endif
8.01  *
8.01 c                   if        faak04 = 0 and
8.01 c                             xtnumm = 0 and
8.01 c                             ldokoo = 'J'
8.01 c                   eval      p_status = '1'
8.01 c                   goto      slutt
8.01 c                   endif
      *
      * Vi kjører ikke NX økonomi, men ønsker kjøre det for kontroll
      *
8.01 c                   if        xtnumm > 0 and
8.01 c                             ldokoo = 'J'
8.01 c                   eval      p_status = '2'
8.01 c                   goto      slutt
8.01 c                   endif
      *
      * Vi kjører ikke NX økonomi, og heller ikke øko oppdatering
      *
8.01 c                   if        xtnumm > 0 and
8.01 c                             ldokoo = 'J'
8.01 c                   eval      p_status = '0'
8.01 c                   goto      slutt
8.01 c                   endif
      *
8.01 c*                  if        faak04 = 0 and
8.01 c*                            xtnumm = 0
8.01 c*                  eval      p_status = '1'
8.01 c*                  goto      slutt
8.01 c*                  endif
      *
     c     slutt         tag
     c                   eval      *inlr = *on
     c                   return
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
     c     *entry        plist
     c                   parm                    p_status
      *
     c     xtill1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    xtill1_regi
     c                   kfld                    xtill1_felt
     c                   kfld                    xtill1_xkey
8.01  *
8.01  * Key for file : Dagsoppgjør paramter
8.01  *
8.01 c     bdopl1_key    klist
8.01 c                   kfld                    w_firm
8.01 c                   kfld                    bdopl1_sgr
      *
     c                   eval      w_firm = l_firm
      *
     c                   endsr
      *
