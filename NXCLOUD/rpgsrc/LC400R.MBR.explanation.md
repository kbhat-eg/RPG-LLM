# Explanation of the RPG Program: LC400R

This RPG program (`LC400R`) is designed to **delete records related to a specific inventory counting batch** from three related files:  
- TELLING (counting records)
- BUNT-HODE (batch header)
- BUNT-LINJE (batch line)  
The program receives a company code (`firm`) and a batch number (`batc`) as parameters and removes all related entries from the files.

---

## File Declarations

```rpg
ftell1    if   e           k disk    rename(ltelpfr:ltell1r)
ftellu    uf   e           k disk    rename(ltelpfr:ltellur)
fbhel1    if   e           k disk    rename(lbhepfr:lbhel1r)
fbhelu    uf   e           k disk    rename(lbhepfr:lbhelur)
fbdtl1    if   e           k disk    rename(lbdtpfr:lbdtl1r)
fbdtlu    uf a e           k disk    rename(lbdtpfr:lbdtlur)
```

- Six files are declared with both input and update capabilities, opened for keyed access.
- Files are renamed from their physical to logical names.
- Each file has both a "1" (read) and "U" (update/delete) version.

---

## Data Declarations

- Variables for keys and data are declared; many use the `LIKE()` keyword for consistency with file fields.
- Example:
    - `ltell1_batc` is defined like `lebatc` (batch number in TELLING).

---

## Main Processing

### 1. **Delete Records from TELLING (ltellur)**

```rpg
ltell1_key    setll     ltell1
ltell1_key    reade     ltell1                                 90
dow       *in90 = *off
   ltellu_batc = lebatc
   ltellu_numm = lenumm
   ltellu_suff = lesuff
   ltellu_line = leline
   ltellu_key    chain     ltellur                            91
   if        *in91 = *off
      delete    ltellur
   endif
   ltell1_key    reade     ltell1                                 90
enddo
```

- **Reads all TELLING (ltell1) records for the batch.**
- For each, sets up the key and attempts to chain (locate) the corresponding update file (ltellur).
- If found, deletes the record from `ltellur`.
- Repeat until all batch records are processed.

---

### 2. **Delete Records from BUNT-HODE (lbhelur)**

```rpg
lbhel1_key    setll     lbhel1
lbhel1_key    reade     lbhel1                                 90
dow       *in90 = *off
   lbhelu_batc = lubatc
   lbhelu_numm = lunumm
   lbhelu_key    chain     lbhelur                            91
   if        *in91 = *off
      delete    lbhelur
   endif
   lbhel1_key    reade     lbhel1                                 90
enddo
```

- **Same logic as above, but for the BUNT-HODE (Batch Header) files.**

---

### 3. **Delete Records from BUNT-LINJE (lbdtlur)**

```rpg
lbdtl1_key    setll     lbdtl1
lbdtl1_key    reade     lbdtl1                                 90
dow       *in90 = *off
   lbdtlu_batc = lvbatc
   lbdtlu_numm = lvnumm
   lbdtlu_line = lvline
   lbdtlu_key    chain     lbdtlur                            91
   if        *in91 = *off
      delete    lbdtlur
   endif
   lbdtl1_key    reade     lbdtl1                                 90
enddo
```

- **Again, same logic for the BUNT-LINJE (Batch Line) files.**

---

### 4. **End Program**

```rpg
eval       *inlr = *on
return
```

- Sets the LR (last record) indicator to on, ending the program.

---

## Subroutine: *INZSR (Initialization)

- **Sets up key lists (`KLIST`)** needed for file operations, defining how to build the keys from the parameters and local working variables.
- **Loads parameters** into internal working variables:
    - `p_firm` and `p_batc` parameters received.
    - `w_firm` and `w_batc` set accordingly.

---

## Indicator Usage (as per header comment)

- `LR` = End program
- `80-89` = Work indicators
- `90-99` = File indicators (for CHAIN, READ, etc.)

---

## Key Takeaways

1. **Purpose:**  
   The program deletes all records in the three main tables relating to a specific inventory counting batch, based on firm and batch parameters.

2. **Structure:**  
   - For each file group (TELLING, BUNT-HODE, BUNT-LINJE):
     - Read all records matching the batch.
     - Delete corresponding record in the update file.
   - Uses separate read and update files to avoid locking issues.

3. **Initializing & Parameters:**  
   - Performs initialization in `*INZSR`, defines all keys, and loads parameters.

4. **Typical Use Case:**  
   - Called as a utility program to clean up all relationships to a given batch before e.g. deleting the batch header.

---

## Onboarding Notes

- **Filenames** may be different between physical and logical; check the file renames.
- **Deletion** is performed directly; ensure no required updates or logging are bypassed.
- **Parameter Order** must be correct on invocation: 1st is firm, 2nd is batch.
- **Error Handling** is minimal; if records are missing, it simply skips deletion.

---

**In summary:**  
This is a utility batch program for cascading deletes of batch-related records in an IBM i/AS400 warehouse/inventory module. Its logic is sequential and easy to follow, with all keys and parameters clearly defined.