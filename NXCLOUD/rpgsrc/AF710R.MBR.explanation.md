```markdown
# AF710R – “Return Next FTP Job”

## 1. Program Header
- Title: ASOKON Query v.h.a. reports (Selection)  
- System: ASFTP  
- Program: AF710R  
- Purpose: Returns the next FTP job name in sequence  

## 2. File Declaration
```rpg
faftpl1 if   a e  k  disk   rename(aftppfr : aftpl1r)
```
- **File name**: FAFTPL1  
- **Attributes**:  
  - `if a e k disk` : Input file, externally described, keyed, disk-based  
  - `rename(aftppfr:aftpl1r)`: internally referred to as `AFTPL1R`

## 3. Parameter Definitions
```rpg
d p_status   s    1              // Output: Status flag (‘N’ = no next job)
d p_navn     s      like(afnavn) // Input: Current job name
d p_nxtnavn  s      like(afnavn) // Output: Next job name
```
- **p_navn**  : The job name passed into the program  
- **p_nxtnavn** : Receives the next job name if found  
- **p_status**  : ‘N’ when there is no “next” record; blank or other on success

## 4. User Data Structure (UDS) & Key Variables
```rpg
d                uds
d l_firm         944    946  0   // Company number (from external UDS)

d aftpl1_navn    s      like(afnavn) // Internal copy of p_navn
d w_firm         s      like(affirm) // Internal copy of company number
```
- **l_firm** is sourced from an externally-described user data structure at positions 944–946.  
- **w_firm** and **aftpl1_navn** form the composite key for reading FAFTPL1R.

## 5. Initialization Subroutine (`*INZSR`)
```rpg
c     *inzsr    begsr
c     *entry    plist
c               parm    p_navn
c               parm    p_nxtnavn
c               parm    p_status

c     aftpl1_key  klist
c               kfld    w_firm
c               kfld    aftpl1_navn

c               eval    aftpl1_navn = p_navn
c               eval    w_firm       = l_firm
c     endsr
```
1. **Entry Parameter List**  
   - Registers the three parameters (`p_navn`, `p_nxtnavn`, `p_status`).  
2. **Key List**  
   - Defines the read key for the `CHAIN` operation:  
     1. `w_firm` (company)  
     2. `aftpl1_navn` (current job)  
3. **Initialize**  
   - Copies `p_navn` into `aftpl1_navn`.  
   - Copies the company number (`l_firm`) into `w_firm`.  

## 6. Main Logic
```rpg
c     aftpl1_key   chain     aftpl1r      // Read “next” record
c                   if        not %found
c                   eval      p_status = 'N'  // No next job
c                   goto      slutt
c                   endif

c                   eval      p_nxtnavn = afrunf  // Field in FAFTPL1R

c     slutt        tag
c                   eval      *inlr = *on      // Set last record indicator
c                   return
```
1. **CHAIN with Key List**  
   - Retrieves the next record _greater than_ the key values (`w_firm`, `aftpl1_navn`).  
2. **Not Found**  
   - If `%FOUND` is false, set `p_status = 'N'` and exit.  
3. **Found**  
   - Move the field `AFRUNF` (the next job name in the file) into `p_nxtnavn`.  
4. **Exit**  
   - Set `*INLR = *ON` to end the program and return to the caller.  
```