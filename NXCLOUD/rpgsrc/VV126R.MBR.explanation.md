# RPG Program VV126R – Explanation and Onboarding Guide

This RPG/400 (ILE RPG) program is used for maintaining "language texts for products with parameters" (Språktekster pr. vare m/parametre). It is a display-file-driven program for displaying, adding, editing, copying, and deleting language-specific text lines tied to an item/product (“vare”).

Below is a structured, developer-oriented walkthrough of its main components, logic, and key mechanics.

---

## 1. **Header and Documentation**
- **Purpose:**  
  The program manages text entries in different languages for products, with support for key-based CRUD (Create, Read, Update, Delete) operations and subfile paging.
- **Indicators:**  
  Inline comments document which indicators (`*INxx`) control which UI features and logic.  
    - `LR` for end-of-program,  
    - `10-15, 21-22, 30-99` control subfile actions, cursor movement, field protection, error messaging, and working status.

---

## 2. **File Declarations (`F-Specs`)**
- `vsprlr` & `vsprlu`: Disk files (presumably language text master/logical) with renamed record formats for read/update.
- `vvarl1`: Disk file for item master (product register), renamed format.
- `vv126d`: The display file (workstation device) with subfile (`sfile(b1sfl:w_srrn)`) and an INFDS data structure for feedback (`dspfbk`).

---

## 3. **Data Declarations (`D-Specs`)**
- **Local Data Area:**  
  Holds user (`l_user`), company/firm number (`l_firm`), etc.
- **INFDS (`dspfbk`):**  
  For feedback from display file, e.g., the cursor row (`d_fcrn`).
- **Key and Work Variables:**  
  Variables for keys (`vsprlr_tvar`, `vsprlr_tspr` etc.), paging variables (`w_fcrn`, `w_srrn`, `w_ssrn`, `w_spge`), status flags (`b_oppr`, `b_forn`, ...).
- **Constants:**  
  `c_sfil` sets the subfile page size (14 records).

---

## 4. **Comments Explaining Subfile and Screen Handling**
- Comprehensive commentary lists variables, their subfile roles, and the display record formats that are used in the UI.

---

## 5. **Main Processing Logic**

### **5.1. Main Loop Entry/Tags**
- Begins at tag `b2taga`, which presents a command screen (`write b2cmd`).
- Control then passes to `b2tagb` to display and handle the subfile:
    - Calls `dsp_subfile` subroutine.
    - Processes function keys via a large `select` structure:
        - Navigation, create, copy, edit, delete, etc.
        - Positioning/scrolling logic.

### **5.2. Subroutines**

#### **forny**: Refresh Subfile
- If not at beginning, re-chains to the subfile.
- Resets subfile position and content by clearing and recreating subfile entries.

#### **posisjoner**: Positioning in Subfile
- Positions the subfile based on a specified starting key (`b2tspr`).
- Clears and recreates subfile records for the new positioning.

#### **subfile**: Subfile Row Processing
- Reads each subfile row, checking the value of the function (edit, copy, delete, view - via `b1valg`).
- For each row selection, sets up the values and calls relevant subroutines for edit/view/copy/delete, then updates the row.
- Triggers a full refresh if structural changes occur.

#### **xc1bld**: New Row/Entry Dialog
- Handles the C1BLD screen (add new key/row).
- Includes input validation (e.g. language code, existing rows).
- On valid input, hands over to edit/view subroutine (`xc2bld`).

#### **spørring**: Inquiry/Prompt Hook
- Placeholder for field-specific lookups (e.g. item lookup), currently inactive (commented-out logic).

#### **xc1msg**: Creation Message Dialog
- Displays info message if attempting to add a row that already exists.
- Allows user to cancel via function keys.

#### **xc2bld**: Edit/View/Add Row
- Handles the C2BLD screen for view, edit, or add.
- Looks up existing row, fills the screen fields.
- On submit, validates input and either updates or adds the record in the file.

#### **xd1win**: Delete Row
- Handles the D1WIN window for confirming deletes.
- Deletes the language text line specified.

#### **xk1win**: Copy Row
- Handles the K1WIN window for copying a row.
- Validates the new row does not exist, then initiates an add.

#### **clr_subfile**: Clear Subfile
- Sets up and clears the subfile records, resets paging variables.

#### **crt_subfile**: Create/Fill Subfile
- Reads file (vsprlr) and writes records to the subfile until subfile page is filled or EOF reached.
- Controls subfile paging variables.

#### **bck_subfile**: Page Backward in Subfile
- Reads backward through the key-based file to implement subfile page-up/back logic.
- Then refreshes the subfile display.

#### **dsp_subfile**: Display Subfile
- Controls the display of the subfile, setting indicators for subfile control/fields as needed.
- Updates paging variables based on display feedback data structure.

#### **\*inzsr**: Initialization
- RPG's initialization subroutine.
- Reads-in entry parameters (`p_vare` = product number).
- Sets up key lists for file access.
- Loads initial product info and initializes the first subfile page.

---

## 6. **Special Observations**
- **Indicator Usage:**  
  The program makes extensive use of numbered indicators for flow control, error display, and subfile functions (e.g. `*IN14` for SFLCLR, `*IN15` for SFLEEND, etc.).
- **Subfile Paging:**  
  Handles both forward and backward paging, record positioning, and cursor placement.
- **CRUD Operations:**  
  Add (C1BLD), Edit/View (C2BLD), Delete (D1WIN), and Copy (K1WIN) are each implemented as dedicated interactive routines.
- **Key List Usage:**  
  Keys for CHAIN/SETLL/READ/DELETE operations are defined explicitly using KLIST/KFLD per standard RPG practice.
- **Prompt/Inquire Fields:**  
  Logic included (though some is commented out) for popping up inquiry screens for item lookup (e.g. by calling `VV500R`).

---

## 7. **Onboarding Notes and Recommendations**
- **UI/Screen Files:**  
  The program relies on the display file (`vv126d`) with subfile (`B1SFL`), and several control/command windows. Ensure familiarity with DDS for these displays.
- **Extension Points:**  
  The commented-out code indicates areas where further features (prompting, autotext copy, etc.) can be enabled or modified.
- **Debugging:**  
  `OPTION(*NODEBUGIO)` means no implicit I/O debugging. Insert debugging manually if needed.
- **Data Integrity:**  
  All updates are carefully keyed; pay particular attention to key structures when adapting for new file structures or features.
- **Language Handling:**  
  The central record keys are product + language code; changes to how languages are managed (e.g. increasing code size) will impact key lists and field definitions.

---

## 8. **Key Takeaway**

**This program is a robust workhorse for maintaining per-product, per-language text lines via a paged subfile interface. It’s ideal for onboarding new RPG developers with its thorough documentation, structured routines, and clear separation of CRUD operations.**

---

**For further work:**  
- Review the display file definitions (`vv126d`) to understand what is presented to the user.
- Study the logical files and record layouts for `vsprlr`, `vsprlu`, and `vvarl1`.
- To extend/modernize, consider Free-Format RPG, modularization, and adding unit tests/automated regression checks.

---

**If you have specific business rules or scenarios to address (e.g., new field validations, integration points), feel free to inquire for targeted guidance!**