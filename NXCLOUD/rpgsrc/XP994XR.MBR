     h option(*nodebugio) datedit(*dmy) decedit(',') DFTACTGRP(*NO) ACTGRP(*NEW)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Definering av parametre
      *
     d  p_filg         s             10a
     d  p_firm         s              3a
6.nu d  p_numm         s              8a
     d  p_suff         s              2a
     d  p_type         s              1a
     d  p_addr         s             30a
     d  p_port         s              5a
      *
     d  w_errrun       s              1s 0 INZ(0)
      *
5.62  * Datastruktur for informasjon ved exceptions
      *
     d PgmError       sds
     d  proc_name        *proc
     d  pgm_status       *STATUS
     d  prv_status            16     20s 0
     d  line_numm             21     28
     d  routine          *ROUTINE
     d  parms            *PARMS
     d  excp_type             40     42
     d  excp_numm             43     46
     d  pgm_lib               81     90
     d  excp_data             91    170
     d  excp_id              171    174
     d  date                 191    198
     d  year                 199    200s 0
     d  last_file            201    208
     d  file_info            209    243
     d  job_name             244    253
     d  job_user             254    263
     d  job_numb             264    269s 0
      *
      *
      *
     D  MsgInfo        s            512a
     D  MsgInfoLen     s             10i 0
     D  FormatName     s              8a   INZ('RCVM0100')
     D  CallStackEntr  s             10a   INZ('*')
     D  CallStackCtr   s             10i 0 INZ(*ZERO)
     D  MsgType        s             10a   INZ('*EXCP')
     D  MsgKey         s              4a   INZ(*BLANKS)
     D  WaitTime       s             10i 0 INZ(*ZERO)
     D  MsgAction      s             10a   INZ('*OLD')
     D  ErrorStruct    s              8a   inz(x'0000000000001000')
      *
      * Parametre for API QMHRCVPM
      *
     d* api_inf        s            512a
     d* api_inflen     s              4B 0 INZ(512)
     d* api_fnam       s              8a   INZ('RCVM0100')
     d* api_callstc    s            512    INZ('*')
     d* api_callstcln  s              4B 0 INZ(0)
     d* api_msgtyp     s             10a   INZ('*EXCP')
     d* api_msgkey     s              4a   INZ(*BLANK)
     d* api_waittim    s              4B 0 INZ(0)
     d* api_msgact     s             10a   INZ('*OLD')
     d* ErrorCode      s              8a
      *
      * Java variabler
      *
      * j_link         s               o   class(*JAVA:'java.lang.String')
      * j_url          s               o   class(*JAVA:'java.net.URL')
      * j_conmsg       s               o   class(*JAVA:'java.lang.String')
      * j_con          s               o   class(*JAVA:
      *                                     'java.net.HttpURLConnection')
     d  j_msger        s               o   class(*JAVA:
     d                                      'no.asp.as.nexsteptrigger.+
     d                                       ExportDocument')
     d  j_mfilg        s               o   class(*JAVA:'java.lang.String')
     d  j_mfirm        s               o   class(*JAVA:'java.lang.String')
     d  j_mnumm        s               o   class(*JAVA:'java.lang.String')
     d  j_msuff        s               o   class(*JAVA:'java.lang.String')
     d  j_muser        s               o   class(*JAVA:'java.lang.String')
     d  j_mpasw        s               o   class(*JAVA:'java.lang.String')
     d  j_mctyp        s               o   class(*JAVA:'java.lang.String')
     d  j_mdtyp        s               o   class(*JAVA:'java.lang.String')
     d  j_mhost        s               o   class(*JAVA:'java.lang.String')
     d  j_mport        s               o   class(*JAVA:'java.lang.String')
      *
      * Java funksjoner
      *
     d mkmsger         pr              o   extproc(*JAVA:
     d                                      'no.asp.as.nexsteptrigger.+
     d                                       ExportDocument':
     d                                      'getInstance')
     d                                     class(*JAVA:'no.asp.as.+
     d                                      nexsteptrigger.+
     d                                      ExportDocument')
     d                                     STATIC
      *
     d callmsger       pr                  extproc(*JAVA:
     d                                      'no.asp.as.nexsteptrigger.+
     d                                      ExportDocument':
     d                                      'export')
     d mfilg                           o   class(*JAVA:'java.lang.String')
     d mfirm                           o   class(*JAVA:'java.lang.String')
     d mnumm                           o   class(*JAVA:'java.lang.String')
     d msuff                           o   class(*JAVA:'java.lang.String')
     d mctyp                           o   class(*JAVA:'java.lang.String')
     d mdtyp                           o   class(*JAVA:'java.lang.String')
     d mhost                           o   class(*JAVA:'java.lang.String')
     d mport                           o   class(*JAVA:'java.lang.String')
     d muser                           o   class(*JAVA:'java.lang.String')
     d mpasw                           o   class(*JAVA:'java.lang.String')
      *
     d mkstr           pr              o   extproc(*JAVA:
     d                                      'java.lang.String':
     d                                      *CONSTRUCTOR)
     d                                     class(*JAVA:'java.lang.String')
     d   bytes                      512a   CONST VARYING
      *
     d getstr          pr           512a   extproc(*JAVA:
     d                                      'java.lang.String':
     d                                      'getBytes')
      *
      *crturl          pr              o   extproc(*JAVA:
      *                                     'java.net.URL':
      *                                     *CONSTRUCTOR)
      *                                    class(*JAVA:'java.net.URL')
      *link                            o   class(*JAVA:'java.lang.String')
      *
      *crtcon          pr              o   extproc(*JAVA:
      *                                     'java.net.URL':
      *                                     'openConnection')
      *                                    class(*JAVA:
      *                                     'java.net.URLConnection')
      *
      *opncon          pr                  extproc(*JAVA:
      *                                     'java.net.HttpURLConnection':
      *                                     'connect')
      *
      *clocon          pr                  extproc(*JAVA:
      *                                     'java.net.HttpURLConnection':
      *                                     'disconnect')
      *
      *getsts          pr            10i 0 extproc(*JAVA:
      *                                     'java.net.HttpURLConnection':
      *                                     'getResponseCode')
      *
      *getststxt       pr              o   extproc(*JAVA:
      *                                     'java.net.HttpURLConnection':
      *                                     'getResponseMessage')
      *                                    class(*JAVA:
      *                                     'java.lang.String')
      *
      * Variabler
      *
      * w_link         s            512a
      * w_consts       s             10i 0
     d  w_head         s            180a
     d  w_text         s            512a
     d  w_ttyp         s              1a
      *
      * Konstanter
      *
     d* c_link         c                   const('http://SIXSERVER:+
     d*                                     8080/nexstepserver-0.1.0/+
     d*                                     executeTask?type=ordre')
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Sette sammen linken
      *
     c                   eval      j_msger = mkmsger()
     c                   eval      j_mfilg = mkstr(%trim(p_filg))
     c                   eval      j_mfirm = mkstr(%trim(p_firm))
     c                   eval      j_mnumm = mkstr(%trim(p_numm))
     c                   eval      j_msuff = mkstr(%trim(p_suff))
     c                   eval      j_muser = mkstr('jms')
     c                   eval      j_mpasw = mkstr('qwerty')
     c                   eval      j_mhost = mkstr(%trim(p_addr))
     c                   eval      j_mport = mkstr(%trim(p_port))
     c                   if        p_type = 'D'
     c                   eval      j_mctyp = mkstr('DELETE')
     c                   else
     c*                  eval      j_mctyp = mkstr('')
     c                   endif
     c                   eval      j_mdtyp = mkstr('ordre')
     c                   callp     callmsger(j_msger:j_mfilg:
     c                              j_mfirm:j_mnumm:j_msuff:
     c                              j_mctyp:j_mdtyp:j_mhost:
     c                              j_mport:j_muser:j_mpasw)
      *
     c*                  eval      w_link = 'http://' + %trim(p_addr) +
     c*                             '/nexstepserver/executeTask+
     c*                             ?type=ordre'
     c*                  eval      w_link = %trim(w_link) + '&ordrenr=' + %trim(
     c*                            p_numm) + '&firma=' + %trim(
     c*                            p_firm) + '&suffix=' + %trim(
     c*                            p_suff)
      *
      * Hvis sletting, legge på bryter i link
      *
     c*                  if        p_type = 'D'
     c*                  eval      w_link = %trim(w_link) + '&DELETE'
     c*                  endif
      *
     c*                  eval      j_link = mkstr(w_link)
     c*                  eval      j_url = crturl(j_link)
     c*                  eval      j_con = crtcon(j_url)
     c*                  callp     opncon(j_con)
     c*                  eval      w_consts = getsts(j_con)
     c*                  callp     clocon(j_con)
      *
      * Sjekke om feil status
      *
     c*                  if        w_consts <> 200
     c*                  eval      j_conmsg = getststxt(j_con)
     c*                  eval      w_head = 'Feil i XP994R: Status=' +
     c*                             %char(w_consts)
      *
     c*                  eval      w_text = %trim(w_head) + '. -> ' +
     c*                            %trim(getstr(j_conmsg))
      *
     c*                  eval      w_ttyp = 'E'
     c*                  call      'XP900C'
     c*                  parm                    w_head
     c*                  parm                    w_text
     c*                  parm                    w_ttyp
     c*                  goto      avslutt
     c*                  endif
      *
      * OK
      *
     c                   eval      w_head = 'Trigget eksport av ordre ' +
     c                               %trim(p_numm)
     c                   eval      w_text = w_head
     c                   eval      w_ttyp = *blank
     c                   call      'XP900C'
     c                   parm                    w_head
     c                   parm                    w_text
     c                   parm                    w_ttyp
      *
      * Avslutt
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * Sette error text iht siste melding
      *
     c     seterrtxt     begsr
      *
     c                   eval      w_errrun = 1
      *
     c                   eval      MsgInfoLen = %size(MsgInfo)
     c                   call      'QMHRCVPM'
     c                   parm                    MsgInfo
     c                   parm                    MsgInfoLen
     c                   parm                    FormatName
     c                   parm                    CallStackEntr
     c                   parm                    CallStackCtr
     c                   parm                    MsgType
     c                   parm                    MsgKey
     c                   parm                    WaitTime
     c                   parm                    MsgAction
     c                   parm                    ErrorStruct
      *
     c                   eval      w_text = %trim(%subst(MsgInfo : 96 : 300))
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Feilrutine
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *pssr         begsr
      *
     c                   if        w_errrun = 0
     c                   exsr      seterrtxt
     c                   endif
      *
     c*                  eval      w_text = 'Info=' +
     c*                            %trim(excp_data) + '. Line=' +
     c*                            %trim(line_numm) + '. Exp_num=' +
     c*                            %trim(excp_numm) + '. Exp_type=' +
     c*                            %trim(excp_type) + '.'
     c                   eval      w_head = 'Feil i ' +
     c                             %trim(pgm_lib) + '/XP994R!'
      *                  eval      w_text = %trim(w_head) +
      *                             ' Sjekk melding på AS400 for +
      *                             detaljer.'
     c                   eval      w_ttyp = 'E'
     c                   call      'XP900C'
     c                   parm                    w_head
     c                   parm                    w_text
     c                   parm                    w_ttyp
      * Skippe MSGW
     c*                  goto      avslutt
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parameter
      *
     c     *entry        plist
     c                   parm                    p_filg
     c                   parm                    p_firm
6.nu c                   parm                    p_numm
     c                   parm                    p_suff
     c                   parm                    p_type
     c                   parm                    p_addr
     c                   parm                    p_port
      *
     c                   endsr
