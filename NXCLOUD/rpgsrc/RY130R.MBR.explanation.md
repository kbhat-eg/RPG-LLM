# RPG Program RY130R - Explanation

This RPG/400 (fixed-format) program is designed to **delete prices and associated search texts for a hardcoded supplier** in two physical files. The program's comments and logic are in Norwegian.

---

## 1. **Header and Metadata**

```rpg
h option(*nodebugio) datedit(*dmy)
```
- `option(*nodebugio)` disables debug I/O.
- `datedit(*dmy)` sets default date format to day-month-year.

The comment section describes the program:
- **Purpose:** Remove prices and search texts for a hardcoded supplier, search text, and price date.
- **Original author/date:** HKO, 1998-10-07

---

## 2. **File Declarations**

```rpg
fjvprl2    uf   e           k disk    rename(jvprpfr:jvprl2r)
fjsokl3    uf   e           k disk    rename(jsokpfr:jsokl3r)
```
- **Jvprl2** (renamed record format `jvprl2r`): Price file, keyed physical file.
- **Jsokl3** (renamed record format `jsokl3r`): Search text file, keyed physical file.

---

## 3. **Variable Declarations**
```rpg
d jvprl2_ldor     s                   like(jxldor)
d jsokl3_vare     s                   like(jsvare)
d jsokl3_stek     s                   like(jsstek)
```
Variables used as keys:
- `jvprl2_ldor`: Supplier number (like field `jxldor` from `jvprl2r`)
- `jsokl3_vare`: Item number (like field `jsvare` from `jsokl3r`)
- `jsokl3_stek`: Search text (like field `jsstek` from `jsokl3r`)

---

## 4. **Main Logic**

### **Deleting prices for a hardcoded supplier**

#### **Step-by-step**

1. **Set supplier number**
   ```rpg
   c                   eval      jvprl2_ldor = 900001
   ```
   Hardcoded supplier number: `900001`.

2. **Process records in the Price file**
   ```rpg
   c     jvprl2_key    setll     jvprl2
   c     jvprl2_key    reade     jvprl2r                                60
   c                   dow       *in60 = *off
   ```
   - `setll`: Set lower limit for reading by key.
   - `reade`: Read next record with the same key; indicator `*in60` is set *on* at end-of-file or key change.

3. **Delete the price record**
   ```rpg
   c                   delete    jvprl2r
   ```

4. **Prepare to delete the search text**
   ```rpg
   c                   eval      jsokl3_vare = jxvare
   c                   eval      jsokl3_stek = 'FARVEMILJ� NORD AS'
   ```
   - Assigns the current price record’s `jxvare` (item) to `jsokl3_vare`.
   - Hardcoded search text: `'FARVEMILJ� NORD AS'`.

5. **Delete the corresponding search text record**
   ```rpg
   c     jsokl3_key    chain     jsokl3                             61
   c                   if        *in61 = *off
   c                   delete    jsokl3r
   c                   endif
   ```
   - `chain`: Attempts to find a match in the search text file for the current item and search text. 
   - If found (`*in61 = *off`), deletes the search text record.

6. **Read the next price record; loop continues**
   ```rpg
   c     jvprl2_key    reade     jvprl2r                                60
   c                   enddo
   ```

---

## 5. **Program Exit**

```rpg
c     avslutt       tag

c                   eval      *inlr = *on
c                   return
```
- `tag avslutt`: Marks end for structured GOTO if needed.
- Sets last record indicator (`*inlr`) to *on*, signaling program end and closing all files.

---

## 6. **Initialization Subroutine**

```rpg
c     *inzsr        begsr

c     jvprl2_key    klist
c                   kfld                    jvprl2_ldor

c     jsokl3_key    klist
c                   kfld                    jsokl3_vare
c                   kfld                    jsokl3_stek

c                   endsr
```
- Defines **key lists** for file operations:
    - `jvprl2_key`: Uses `jvprl2_ldor` as the key field.
    - `jsokl3_key`: Uses `jsokl3_vare` (item) and `jsokl3_stek` (search text) as the composite key.

---

## **Summary**

- The program processes all price records for supplier `900001` in the `jvprl2` file.
- For each record deleted, it attempts to delete a matching search text in the `jsokl3` file for the current item (`jxvare`) and search text `'FARVEMILJ� NORD AS'`.
- Main actions:
    - **Delete from `jvprl2` (prices)**
    - **Delete from `jsokl3` (search text) for each item, if matching search text exists**
- The program is hardcoded for a specific supplier and search text.

This program is useful for one-off data cleanup tasks involving hardcoded criteria in legacy AS/400 environments.