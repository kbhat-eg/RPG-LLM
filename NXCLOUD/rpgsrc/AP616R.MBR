      /TITLE  Oppslag mot rutine-register
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Program . . . . : AP616R
      * Beskrivelse . . : Scanner input streng og returnerer med xml UTF-8
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- - - - - - - - - - - - - - - - - - - - - - - - - -
      *       200812 BSA  Nytt program
6.10  *       210812 bsa  Utvider med flere tegn
      *
7.01  *       170620 bof  Feilretting vedr. lite å.
      *
8.01  *       190122 bof  utvidet med flere tegn
8.02  *K0000  171122 bsa  Legger inn scan i SQL for å søke etter
8.02  *K0000              ugyldige tegn, og erstatte disse med " "
8.02  *K0000              (space)
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     d                uds
     d l_firm                944    946  0
     d l_avde                947    950  0
      *
      * Definering av parametre
      *
     d p_lr            s              1
     d p_input         s            512
     d p_outpt         s            512
      *
      * Definering av variabler i nøkler
      *
     d w_str_in        s            512
     d w_str_out       s            512
     d w_x             s              5  0
      *
      * Definering av variable
      *
      *
8.02 C/Exec SQL
8.02 C+  Set Option DatFmt=*ISO, commit=*none, DlyPrp=*YES
8.02 C+  , SRTSEQ=*LANGIDSHR, LANGID=NOR
8.02 C/End-Exec
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Vi scanner innkommet streng                                     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c                   eval      w_str_in = *blank
     c                   eval      p_outpt = *blank
8.02   //Free
8.02   //Wash text
8.02   exec SQL SET :p_input = REGEXP_REPLACE(:p_input,
8.02      '[^A-Za-z0-9æøåÆØÅ.,_/?+!* :;%@\-&]' , ' ');
8.02
8.02   //End-free
      *
     c     x'3F':'A'     xlate     p_input       p_input
     c                   eval      w_str_in = p_input
      *
     c                   exsr      xml_konv
      *
     c                   eval      p_outpt = w_str_out
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Avslutt program                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c                   if        p_lr = '1'
     c                   eval      *inlr = *on
     c                   endif
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Konverter til gyldige xml tegn                                  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     xml_konv      begsr
      *
     c                   eval      w_str_out = *blanks
      *
      /Free

           // '&':'&#38;' NB Må erstatte & med annet tegn temporært
           w_x = %scan('&':w_str_in);
           dow w_x > 0;
           w_str_in = %subst(w_str_in:1:w_x-1)
                     + '~#38;'
                     + %subst(w_str_in:w_x+1);
           w_x = %scan('&':w_str_in);
           enddo;
           w_str_in = %xlate('~':'&':w_str_in);

           // 'Æ'':'&#198;'
           w_x = %scan('Æ':w_str_in);
           dow w_x > 0;
           w_str_in = %subst(w_str_in:1:w_x-1)
                     + '&#198;'
                     + %subst(w_str_in:w_x+1);
           w_x = %scan('Æ':w_str_in);
           enddo;

           // 'Ø':'&#216;'
           w_x = %scan('Ø':w_str_in);
           dow w_x > 0;
           w_str_in = %subst(w_str_in:1:w_x-1)
                     + '&#216;'
                     + %subst(w_str_in:w_x+1);
           w_x = %scan('Ø':w_str_in);
           enddo;

           // 'Å':'&#197;'
           w_x = %scan('Å':w_str_in);
           dow w_x > 0;
           w_str_in = %subst(w_str_in:1:w_x-1)
                     + '&#197;'
                     + %subst(w_str_in:w_x+1);
           w_x = %scan('Å':w_str_in);
           enddo;

           // 'æ':'&#230;'
           w_x = %scan('æ':w_str_in);
           dow w_x > 0;
           w_str_in = %subst(w_str_in:1:w_x-1)
                     + '&#230;'
                     + %subst(w_str_in:w_x+1);
           w_x = %scan('æ':w_str_in);
           enddo;

           // 'ø':'&#248;'
           w_x = %scan('ø':w_str_in);
           dow w_x > 0;
           w_str_in = %subst(w_str_in:1:w_x-1)
                     + '&#248;'
                     + %subst(w_str_in:w_x+1);
           w_x = %scan('ø':w_str_in);
           enddo;

           // 'å':'&#229;'
7.01       w_x = %scan('å':w_str_in);
           dow w_x > 0;
           w_str_in = %subst(w_str_in:1:w_x-1)
                     + '&#229;'
                     + %subst(w_str_in:w_x+1);
           w_x = %scan('å':w_str_in);
           enddo;

6.10       // '<':'&#60;'
6.10       w_x = %scan('<':w_str_in);
6.10       dow w_x > 0;
6.10       w_str_in = %subst(w_str_in:1:w_x-1)
6.10                 + '&#60;'
6.10                 + %subst(w_str_in:w_x+1);
6.10       w_x = %scan('<':w_str_in);
6.10       enddo;

6.10       // '>':'&#62;'
6.10       w_x = %scan('>':w_str_in);
6.10       dow w_x > 0;
6.10       w_str_in = %subst(w_str_in:1:w_x-1)
6.10                 + '&#62;'
6.10                 + %subst(w_str_in:w_x+1);
6.10       w_x = %scan('>':w_str_in);
6.10       enddo;

6.10       // '''':'&#39;'
6.10       w_x = %scan('''':w_str_in);
6.10       dow w_x > 0;
6.10       w_str_in = %subst(w_str_in:1:w_x-1)
6.10                 + '&#39;'
6.10                 + %subst(w_str_in:w_x+1);
6.10       w_x = %scan('''':w_str_in);
6.10       enddo;

6.10       // '"':'&#34;'
6.10       w_x = %scan('"':w_str_in);
6.10       dow w_x > 0;
6.10       w_str_in = %subst(w_str_in:1:w_x-1)
6.10                 + '&#34;'
6.10                 + %subst(w_str_in:w_x+1);
6.10       w_x = %scan('"':w_str_in);
6.10       enddo;


8.01       // 'ê':'&#234;'
8.01       w_x = %scan('ê':w_str_in);
8.01       dow w_x > 0;
8.01       w_str_in = %subst(w_str_in:1:w_x-1)
8.01                 + '&#234;'
8.01                 + %subst(w_str_in:w_x+1);
8.01       w_x = %scan('ê':w_str_in);
8.01       enddo;

8.01       // 'ë':'&#235;'
8.01       w_x = %scan('ë':w_str_in);
8.01       dow w_x > 0;
8.01       w_str_in = %subst(w_str_in:1:w_x-1)
8.01                 + '&#235;'
8.01                 + %subst(w_str_in:w_x+1);
8.01       w_x = %scan('ë':w_str_in);
8.01       enddo;

8.01       // 'Ö':'&#214;'
8.01       w_x = %scan('Ö':w_str_in);
8.01       dow w_x > 0;
8.01       w_str_in = %subst(w_str_in:1:w_x-1)
8.01                 + '&#214;'
8.01                 + %subst(w_str_in:w_x+1);
8.01       w_x = %scan('Ö':w_str_in);
8.01       enddo;

8.01       // 'ö':'&#246;'
8.01       w_x = %scan('ö':w_str_in);
8.01       dow w_x > 0;
8.01       w_str_in = %subst(w_str_in:1:w_x-1)
8.01                 + '&#246;'
8.01                 + %subst(w_str_in:w_x+1);
8.01       w_x = %scan('ö':w_str_in);
8.01       enddo;

8.01       // 'ô':'&#244;'
8.01       w_x = %scan('ô':w_str_in);
8.01       dow w_x > 0;
8.01       w_str_in = %subst(w_str_in:1:w_x-1)
8.01                 + '&#244;'
8.01                 + %subst(w_str_in:w_x+1);
8.01       w_x = %scan('ö':w_str_in);
8.01       enddo;
8.01
8.01       // 'Ü':'&#220;'
8.01       w_x = %scan('Ü':w_str_in);
8.01       dow w_x > 0;
8.01       w_str_in = %subst(w_str_in:1:w_x-1)
8.01                 + '&#220;'
8.01                 + %subst(w_str_in:w_x+1);
8.01       w_x = %scan('Ü':w_str_in);
8.01       enddo;
8.01
8.01       // 'ü':'&#252;'
8.01       w_x = %scan('ü':w_str_in);
8.01       dow w_x > 0;
8.01       w_str_in = %subst(w_str_in:1:w_x-1)
8.01                 + '&#252;'
8.01                 + %subst(w_str_in:w_x+1);
8.01       w_x = %scan('ü':w_str_in);
8.01       enddo;
8.01
8.01       // 'À':'&#192;'
8.01       w_x = %scan('À':w_str_in);
8.01       dow w_x > 0;
8.01       w_str_in = %subst(w_str_in:1:w_x-1)
8.01                 + '&#192;'
8.01                 + %subst(w_str_in:w_x+1);
8.01       w_x = %scan('À':w_str_in);
8.01       enddo;
8.01
8.01       // 'Á':'&#193;'
8.01       w_x = %scan('Á':w_str_in);
8.01       dow w_x > 0;
8.01       w_str_in = %subst(w_str_in:1:w_x-1)
8.01                 + '&#193;'
8.01                 + %subst(w_str_in:w_x+1);
8.01       w_x = %scan('Á':w_str_in);
8.01       enddo;
8.01
8.01       // 'Ä':'&#196;'
8.01       w_x = %scan('Ä':w_str_in);
8.01       dow w_x > 0;
8.01       w_str_in = %subst(w_str_in:1:w_x-1)
8.01                 + '&#196;'
8.01                 + %subst(w_str_in:w_x+1);
8.01       w_x = %scan('Ä':w_str_in);
8.01       enddo;
8.01
8.01       // '°':'&#176;'
8.01       w_x = %scan('°':w_str_in);
8.01       dow w_x > 0;
8.01       w_str_in = %subst(w_str_in:1:w_x-1)
8.01                 + '&#176;'
8.01                 + %subst(w_str_in:w_x+1);
8.01       w_x = %scan('°':w_str_in);
8.01       enddo;

      /End-Free
      *
     c                   eval      w_str_out = w_str_in
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      * Parameterliste
      *
     c     *entry        plist
     c                   parm                    p_input
     c                   parm                    p_outpt
     c                   parm                    p_lr
      *
     c                   endsr
      *
