# RPG Program Walkthrough: Company Data Deletion

This classic ILE RPG program is designed to **delete all data associated with a company (firm) from a set of files**. The code is written in fixed-format, with Norwegian comments. It is typical for data cleanup at company removal (e.g., when decommissioning a firm in an ERP system).

Let's walk through each important part for onboarding:

---

## Program Metadata & Structure

- **/TITLE**: "ASOKON Opprydding i filer" = "ASOKON Cleanup in files"
- **Header** (`h option(*nodebugio)`): No debug info saved for I/O.
- **Documentation**: Explains the system, program name (`Rf402R`), and its purpose: "Delete company".

---

## File Declarations

```rpgle
fraa1lu    uf   e           k disk
...
fraa7lu    uf   e           k disk
fra01lu    uf   e           k disk
...
fra70lu    uf   e           k disk
```
- **Disk Files**: Dozens of files are defined for update (`uf`), external description (`e`), keyed access (`k`).
- The files seem to group into those prefixed as `fraa?lu` and `fra0?lu`/`fra??lu` (these follow company data structure conventions).
- Each file likely contains one or more records per company.

---

## Data Area Definitions

```rpgle
d                uds
d l_user                911    920
d l_firm                944    946  0
d l_navn                951    980
```
- **UDS**: Declares User Data Section (old RPG for global storage/fields).
- **l_user**: User identifier.
- **l_firm**: Firm/company code (key used for deletion).
- **l_navn**: Company name.
- These fields get loaded from the program's data area, probably upon startup (though no explicit code here, perhaps done externally or prior).

---

## Main Deletion Logic

This program consists almost exclusively of repetitive blocks for each file, example:

```rpgle
c                   read      raa1lu                                 90
c                   dow       *in90 = *off
c                   if        ra1fir = l_firm
c                   delete    raa1pfr
c                   endif
c                   read      raa1lu                                 90
c                   enddo
```
- **Process for Each File:**
  1. **READ** the first record.
  2. **DOW (`do while`)** until end-of-file (`*in90 = *off`).
  3. **IF** the firm field matches `l_firm` (target company code).
  4. **DELETE** the current record.
  5. **READ** next record.
  6. **LOOP** until no more records.

- This pattern repeats for each file:
  - The firm key field (e.g., `ra1fir`, `ra2fir`, etc.) is always compared to `l_firm`.
  - The record format for deletion (e.g., `raa1pfr`) matches the file.

- **Purpose**: For every file, all records belonging to the chosen company (firm) are deleted.

### Comment Sections

Each block is separated and labelled with the type of master data or code it processes (translated from Norwegian):

- Bilagskoder             = Voucher codes
- Betalingsmåter          = Payment methods
- Betalingsbetingelser    = Payment terms
- Faste konti             = Fixed accounts
- MVA koder               = VAT codes
- Rabattkategori          = Discount categories
- Avdeling                = Division/Department
- Distrikt                = District
- Selger                  = Salesperson
- Lager                   = Warehouse
- Kundekategori           = Customer category
- Land                    = Country
- Fordelingsnøkler        = Distribution keys
- Leverandørkategori      = Supplier category
- Mengde                  = Quantity
- Valuta                  = Currency
- Forsendelsesmåte        = Shipping method
- Leveringsbetingelse     = Delivery term
- Kontoklasse             = Account class
- Kontogruppe             = Account group
- Aktivitet               = Activity
- Speditør                = Forwarder
- Virksomhet              = Business unit
- Reklamasjonsårsak       = Complaint reason
- Kjørerute               = Route
- Produktansvarlig        = Product manager
- Kostnadsbærergruppe     = Cost carrier group
- Kostnadsbærer           = Cost carrier
- Formulartekster         = Form texts

---

## Program Exit

```rpgle
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- **avslutt** ("exit") tag for program end.
- Sets last record indicator (`*inlr = *on`) — standard way to close files and end the program in RPG.
- Returns from program.

---

## Subroutine Section

```rpgle
c     *inzsr        begsr
c                   endsr
```
- Subroutine for program initialization (empty in this code).
- `*inzsr` is a special RPG subroutine invoked at program start, if code is present.

---

## Summary

**Purpose:**  
The program's only job is to clean up all records for a specific company (`l_firm`) from a wide array of master and code files, invoked when a "firm" must be purged system-wide for data integrity.

**Key Concepts:**  
- Reads every file's records.
- Deletes any record where the company code matches the target.
- Repeats this for all files listed in the program.

**Usage Notes:**
- `l_firm` must be set before calling this program.
- All files must be available for update mode.
- There is **no error handling** or logging; use with caution!
- A modernized version would be much shorter and safer using SQL and better error handling.

---

## When Onboarding

- Familiarize yourself with the file naming conventions and firm key fields.
- Make sure you know how `l_firm` is populated.
- Get context for each file's business purpose (see comments).
- Understand that all data for `l_firm` in these files will be permanently removed.
- Consider how you’d enhance (logging, error trapping, transaction handling, or replacing with SQL).

---

**In summary**, this is a classic RPG “delete everything for company X across all master/codes” utility. It is simple, brute-force, and effective—but must be handled with extreme care in production systems.