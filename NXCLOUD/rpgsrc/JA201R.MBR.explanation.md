# RPG Program Onboarding Explanation

## 1. Program Overview

This RPG program (`JA201R`) is part of system "VA" and manages rounding rules ("avrundingsregler"). It is designed to allow users to create, maintain, and display rounding rules via a subfile interface (windowed panel). The code is written in RPG/400 with traditional (fixed-format) code.

**Main Features:**

- Maintenance of rounding rules (create, update, display)
- Uses subfiles (windowed lists) to display and select rules
- Supports GUI enhancements (noted in comments)
- Handles various user actions (F3=Exit, F5=Refresh, F12=Cancel, etc.)
- Uses file I/O for storing and retrieving rules

## 2. Files and Workstations

### File Definitions (`F-Specs`)

```rpg
Fjav2l1    if   e           k disk    rename(jav2pfr:jav2l1r)
Fjav2l2    if   e           k disk    rename(jav2pfr:jav2l2r)
Fjav2lu    uf a e           k disk    rename(jav2pfr:jav2lur)
Fja201d    cf   e             workstn sfile(b1wsf:srrn01)
```

- **jav2l1, jav2l2, jav2lu**: Disk files holding rounding rules; different logical views for keying/navigating them. Renamed record formats.
- **ja201d**: Workstation file (represents the display, likely DDS-based), supports subfile processing.

## 3. Data Definitions

- **MLD**: An array of 4 literals, probably used for screen constants/messages.

## 4. Indicator Usage (`*INxx`)

**Documented Roles:**

- *KC*: F3 Exit
- *KE*: F5 Renew
- *KL*: F12 Cancel
- *LR*: Last record indicator, end program
- Others: Control various UI or file states (scroll, protect fields, error flags, etc.)

## 5. Key Variables for Subfiles

Subfile and paging variables:
- `SRRNnn`: Relative record number in subfile
- `SPGEnn`: Page size
- `SFRNnn`: First record number on page
- `SSRNnn`: Last record number on page
- `SVRNnn`: Page containing a particular record

Popup window position variables:
- `WACTLI`: Starting line of window
- `WACTPO`: Starting column/position

## 6. Mainline Logic Structure

### Entry Point

The program starts by initializing variables in the `*INZSR` subroutine, setting initial values, copying parameter values (such as the company/firm and rule), and positioning files for reading.

### Main Panel Loop

**Window/Panel Handling:**

- `B2TAGA`/`B2TAGB`: Control main window flow; sets up position and writes or displays screens.
- Handles user actions:
  - **Exit (F3):** Branch to `XSLUTT` (exit/return)
  - **Refresh (F5):** Reposition subfile, refresh visible rules
  - **Create new (F4 or button):** Validate and create rule
  - **Edit/View:** Controlled by subfile selection
  - **Paging/Scrolling:** Controlled by indicator and DOU loops

**User Actions (Snippet):**

```rpg
C     *INKE         ifeq      *ON     // F5=Refresh
    ...
C     *INKF         ifeq      *ON     // New post
    ...
C     *IN10         ifeq      *ON     // Roll (scroll)
```

### Subfile Record Processing

- **Subfile Options:** Loop through subfile (with DO/READC), check for options (like 1 = select, 2 = edit, 5 = view).
- **On edit/view**, opens window for update via `XC2WIN` subroutine.
- Updates subfile or record as needed.

## 7. Core Subroutines

### `XC2WIN`: Edit/View/Create Rule Window

- Chains to the rule in file, loads text if found, otherwise prepares for a new entry.
- Positions the popup window, presents the panel, and updates or writes rule records depending on whether they exist.
- Updates subfile after change.

### `XCLR01`: Clear Subfile

- Sets indicators to clear subfile screen.
- Zeros out subfile control variables.

### `XCRT01`: Fill Subfile

- Controls paging (`SPGE01`), loops over records and reads entries from the correct file based on search type (numeric `jav2l1` or alpha `jav2l2`).
- Writes records to subfile until page is full or all entries are processed.

### `XDSP01`: Display Subfile

- Handles indicator setup for showing window and control records, issues EXFMT (display) on control format.

### `*INZSR`: Initialization

- Sets all key variables to initial values.
- Populates LIKE variables for parameter passing.
- Processes entry parameter list.

## 8. Parameter List (`PLIST`)

- `pafirm`, `paregel`, `patext` (company, rule, text) passed into the program.

## 9. File Key Lists (`KLIST`)

- **`jav2l1_key`**: Used for file keying with numeric rule.
- **`jav2l2_key`**: Used for file keying with alpha text.

## 10. Program Exit

- At label `XSLUTT`, sets LR (last record), terminates the program.

---

## 11. Summary of Flow

1. **User is presented with a windowed subfile listing rules** (with options to add, edit, view).
2. **Selection or function key** triggers subroutines for respective operations.
3. **Records are read/written/updated** through the appropriate file (by key, based on whether search is by number or text).
4. **Subfile is managed for paging and display**, with variables tracking page and record positions.
5. **Program ends gracefully via F3 or after an operation completes.**

## 12. Additional Notes

- The code is highly reliant on indicators, subfiles, and classic RPG flow control (with `goto`, `TAG`, `DO`/`ENDDO` loops).
- The structure is typical for RPG/400 programs handling subfiles and windowed maintenance panels.
- Comments are in Norwegian; variable names and comments should be interpreted accordingly.

---

## 13. References for Onboarding

- Study the subfile (b1WSF) DDS and jav2pfr/jav2l1/jav2l2 logicals for full data structure clarity.
- Pay attention to how indicators cause branching and state changes.
- Understand the PLIST and parameter passing if this program is called from a CL or another RPG program.
- For enhancements, consider documenting complex indicator logic or refactoring to /FREE if modernizing.

---

### This should give you a strong foundation for onboarding and maintaining this RPG program. If you have file layouts or DDS, reviewing those will clarify screen and data structure details.