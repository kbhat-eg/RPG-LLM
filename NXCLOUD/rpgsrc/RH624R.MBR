     h datedit(*dmy) option(*nodebugio)
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RH624R                                              *
      * Beskrivelse . . : Hovedbok - saldo/budsjett - utskrift                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
T500  * V5.00     270502  Utskrift av alternativt budsjett                KOB *
T5.10 * V5.10     090603  Kontroll mot firma lagt inn                     KOB *
T5.10 * V5.10     090603  Sist konto ble ikke skrevet ut                      *
      * V5.31     230205  Fjernet periode 13 fra utskrift pga plass       KOB *
T5.40 * V5.40     300106  Tekstfeltet ble ikke blanket før utskrift av    HFL *
      *                   sum avdeling                                        *
T5.40 * V5.40     010206  Avdeling/bærer ble feilaktig satt til 0         HFL *
T5.40 * V5.40     081106  Sum avdeling/bærer ble ikke beregnet ved slutt  HFL *
T5.40 * V5.60     200809  Åpnet for utskrift av linjer med 0 i sum        KOB *
      *                   Utvidet slik at 13 perioder skrives ut          KOB *
6.30  * V6.30     040719  Utvidet saldofelter                             bsa *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     frhsal1    if   e           k disk    rename(rhsapfr:rhsal1r)
     frhsal2    if   e           k disk    rename(rhsapfr:rhsal2r)
     frhsal3    if   e           k disk    rename(rhsapfr:rhsal3r)
     frh624p    o    e             printer oflind(*in30)
      *
      *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      *               T   A   B   E   L   L   E   R                      +
      *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      *
6.30 d sal             s             15  2 dim(14)                              Saldo
     d gsa             s             11  2 dim(14)                              Saldo forrige record
     d l1d             s             11  2 dim(14)                              Sum pr. record i kr.
     d l2d             s             11  2 dim(14)                              Sum pr. konto
     d l3d             s             11  2 dim(14)                              Sum pr. kontogruppe
     d l4d             s             11  2 dim(14)                              Sum pr. kontoklasse
     d l5d             s             11  2 dim(14)                              Sum pr. avdeling
     d l9d             s             11  2 dim(14)                              Sum pr. totalt
     d l1s             s              9  0 dim(14)                              Sum pr. record i kr.
     d l2s             s              9  0 dim(14)                              Sum pr. konto
     d l3s             s              9  0 dim(14)                              Sum pr. kontogruppe
     d l4s             s              9  0 dim(14)                              Sum pr. kontoklasse
     d l5s             s              9  0 dim(14)                              Sum pr. avdeling
     d l9s             s              9  0 dim(14)                              Sum pr. totalt
     d kod             s              1    dim(14)                              Kode
     d txt             s             30    dim(2) ctdata perrcd(1)
      *
      /eject
      *
      *  DEFINISJON AV BRUDDBEGREP - NYTT/GAMMELT
      *
     d                 ds
     d nybrd                         13  0                                      Bruddb
     d  nyavd                         4  0 overlay(nybrd)                       Avdeli
     d  nykto                         5  0 overlay(nybrd:5)                     Konto
     d   nygrp                        2  0 overlay(nykto:2)                     Gruppe
     d    nykla                       1  0 overlay(nygrp)                       Klasse
     d  nysps                         4  0 overlay(nybrd:10)                    Spesif
      *
     d                 ds
     d gmbrd                         13  0                                      Bruddb
     d  gmavd                         4  0 overlay(gmbrd)                       Avdeli
     d  gmkto                         5  0 overlay(gmbrd:5)                     Konto
     d   gmgrp                        2  0 overlay(gmkto:2)                     Gruppe
     d    gmkla                       1  0 overlay(gmgrp)                       Klasse
     d  gmsps                         4  0 overlay(gmbrd:10)                    Spesif
      *
     d                uds
     d rhpkda                300    305  0
     d rhprÅr                         4  0
     d rhpper                         2  0
     d rhppef                         2  0
     d rhppet                         2  0
     d rhpavf                         4  0
     d rhpavt                         4  0
     d rhpbØt                         4  0
     d rhpbØf                         4  0
     d rhpktf                         5  0
     d rhpktt                         5  0
     d rhpsrt                         1
     d rhpsml                         1
     d rhpavv                         1
     d rhpavs                         1
     d rhpkgs                         1
     d rhpkks                         1
     d rhptyp                         1
     d rhphel                         1
      *
     d l_wsid                901    910
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
     d antkto          s                   like(totkto)
     d antsps          s                   like(totkto)
     d kotext          s             30
     d avtext          s             30
     d grtext          s             30
     d kltext          s             30
     d dum             s             11  2
     d gmrÅr           s                   like(riraar)
     d gmtyp           s                   like(ritype)
     d l0dum           s                   like(dum)
     d l0sum           s                   like(sum)
     d l1dum           s                   like(dum)
     d l1sum           s                   like(sum)
     d l2dum           s                   like(dum)
     d l2sum           s                   like(sum)
     d l3dum           s                   like(dum)
     d l3sum           s                   like(sum)
     d l4dum           s                   like(dum)
     d l4sum           s                   like(sum)
     d l5dum           s                   like(dum)
     d l5sum           s                   like(sum)
     d l9dum           s                   like(dum)
     d l9sum           s                   like(sum)
     d n               s              2  0
     d nyrÅr           s                   like(riraar)
     d nytyp           s                   like(ritype)
     d rhprfj          s                   like(rhprÅr)
     d sum             s             11  0
     d totkto          s              5  0
     d totsid          s                   like(totkto)
     d wptex1          s                   like(w_text)
     d wptex2          s                   like(w_text)
     d w_avde          s                   like(riavde)
     d w_kont          s                   like(rikont)
     d w_raar          s                   like(riraar)
     d w_spes          s                   like(rispes)
     d w_text          s             30
     d w_type          s                   like(ritype)
     d x               s              2  0
      *
     d w_firm          s                   like(rifirm)
     d p_stat          s              1
     d p_tx30          s             30
     d p_text          s                   like(w_text)
     d p_kont          s                   like(rikont)
     d p_spes          s                   like(rispes)
     d p_avde          s                   like(riavde)
     d p_Økod          s                   like(rispes)
     d p_gkod          s                   like(riavde)
     d p_skod          s              2  0
     d p_tkod          s              2  0
      *
     d rhsal1_kont     s                   like(rikont)
     d rhsal1_spes     s                   like(rispes)
     d rhsal1_avde     s                   like(riavde)
     d rhsal1_raar     s                   like(riraar)
     d rhsal1_type     s                   like(ritype)
     d rhsal2_kont     s                   like(rikont)
     d rhsal2_spes     s                   like(rispes)
     d rhsal2_avde     s                   like(riavde)
     d rhsal2_raar     s                   like(riraar)
     d rhsal2_type     s                   like(ritype)
      *
      *  Saldo-register - Kontonr.rekkefølge
      *
     irhsal1r
     i              risa01                      sal(01)
     i              risa02                      sal(02)
     i              risa03                      sal(03)
     i              risa04                      sal(04)
     i              risa05                      sal(05)
     i              risa06                      sal(06)
     i              risa07                      sal(07)
     i              risa08                      sal(08)
     i              risa09                      sal(09)
     i              risa10                      sal(10)
     i              risa11                      sal(11)
     i              risa12                      sal(12)
     i              risa13                      sal(13)
     i              risa00                      sal(14)
      *
      *  Saldo-register - Avdelingsrekkefølge
      *
     irhsal2r
     i              risa01                      sal(01)
     i              risa02                      sal(02)
     i              risa03                      sal(03)
     i              risa04                      sal(04)
     i              risa05                      sal(05)
     i              risa06                      sal(06)
     i              risa07                      sal(07)
     i              risa08                      sal(08)
     i              risa09                      sal(09)
     i              risa10                      sal(10)
     i              risa11                      sal(11)
     i              risa12                      sal(12)
     i              risa13                      sal(13)
     i              risa00                      sal(14)
      *
      *  Saldo-register - Kostnadsbærerrekkefølge
      *
     irhsal3r
     i              risa01                      sal(01)
     i              risa02                      sal(02)
     i              risa03                      sal(03)
     i              risa04                      sal(04)
     i              risa05                      sal(05)
     i              risa06                      sal(06)
     i              risa07                      sal(07)
     i              risa08                      sal(08)
     i              risa09                      sal(09)
     i              risa10                      sal(10)
     i              risa11                      sal(11)
     i              risa12                      sal(12)
     i              risa13                      sal(13)
      *
      /eject
      *
     c     dummy         tag
      *
     c                   select
     c                   when      rhpsrt = 'K'
     c     rhsal1_key    setll     rhsal1r                                61
     c     rhsal1_key    reade     rhsal1r                                61
     c                   when      rhpsrt = 'A'
     c     rhsal2_key    setll     rhsal2r                                61
     c     rhsal2_key    reade     rhsal2r                                61
     c                   when      rhpsrt = 'B'
     c     rhsal3_key    setll     rhsal3r                                61
     c     rhsal3_key    reade     rhsal3r                                61
     c                   endsl
      *
     c                   dow       *in61 = *off                                          .....
      *
     c                   move      riraar        w_raar
     c                   move      ritype        w_type
      *
      * Sett opp nytt kontroll-begrep
      *
     c                   move      riavde        nyavd
     c                   move      rikont        nykto
     c                   move      rispes        nysps
     c                   move      ritype        nytyp
     c                   move      riraar        nyrÅr
      *
      * Sjekk kontonr. fra/til
      *
     c                   if        nykto < rhpktf                                        .....
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *
     c                   if        nykto > rhpktt                                        .....
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *
      * Sjekk avdeling fra/til
      *
     c                   if        nyavd < rhpavf                                        .....
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *
     c                   if        nyavd > rhpavt                                        .....
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *
      * Sjekk om riktig år
      *
     c                   if        w_raar <> rhprÅr                                      .....
     c                             and w_raar <> rhprfj                                  .....
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *
      * Sjekk hvilke record-type skal behandles
      *
     c                   if        rhptyp = 'R' or                              REGNSKAP .....
     c                             rhptyp = 'P' or                              PROGNOSE .....
     c                             rhptyp = 'F'                                 PROGNOSE .....
     c                   if        w_type = 1                                                .
     c                   goto      behand                                                    .
     c                   endif                                                               .
     c                   endif                                                           .....
      *
     c                   if        rhptyp = 'B' or                              BUDSJETT .....
     c                             rhptyp = 'P'                                 PROGNOSE .....
     c                   if        w_type = 3                                                .
     c                   goto      behand                                                    .
     c                   endif                                                               .
     c                   endif                                                           .....
      *
     c                   if        rhptyp = 'A' and                             ALT.BUDSJ.....
     c                             w_type = 4                                                .
     c                   goto      behand                                                    .
     c                   endif                                                           .....
      *
     c                   goto      neste
      /eject
      *
     c     behand        tag
      *
      * Første gang - ikke test på brudd
      *
     c                   if        gmbrd = *zeros
      *
T5.40 * Flyttet henting av avdeling/bærer-tekst og utskrift av heading hit.
T5.40 * Hent avdelingstekst fra koderegisteret
      *
     c                   if        rhpsrt = 'A'
      *
     c                   move      riavde        w_avde
     c                   move      riavde        p_gkod
T5.40c                   eval      p_tx30 = *blank                               finnes
     c                   eval      avtext = *blank
     c                   call      'RS707R'
     c                   parm                    p_stat
     c                   parm                    p_gkod
     c                   parm                    p_tx30
      *
     c                   move      p_tx30        avtext
      *
     c                   endif
      *
      * Hent kostnadsbærertekst fra koderegisteret
      *
     c                   if        rhpsrt = 'B'
      *
     c                   move      rispes        w_avde
     c                   move      rispes        p_Økod
T5.40c                   eval      p_tx30 = *blank                               finnes
     c                   call      'RS728R'
     c                   parm                    p_stat
     c                   parm                    p_Økod
     c                   parm                    p_tx30
      *
     c                   move      p_tx30        sptext
      *
     c                   endif
      *
      * Skriv heading på første side
      *
     c                   exsr      skriv
      *
     c                   eval      totsid = 1
     c                   eval      antkto = *zeros
T5.40c                   eval      antsps = *zeros
      *
     c                   move      nybrd         gmbrd
     c                   move      nytyp         gmtyp
     c                   move      nyrÅr         gmrÅr
     c                   move      sal           gsa
     c                   goto      neste
     c                   endif
      *
      *  Behandle valgt record
      *
     c                   exsr      rsum
      *
      * Brudd på konto
      *
     c                   if        nykto <> gmkto
     c                   exsr      brkto
     c                   endif
      *
      * Brudd på gruppe
      *
     c                   if        nygrp <> gmgrp
     c                   exsr      brgrp
     c                   endif
      *
      * Brudd på klasse
      *
     c                   if        nykla <> gmkla
     c                   exsr      brkla
     c                   endif
      *
      * Brudd på avdeling
      * (kun hvis sortert på avdeling)
      *
     c                   if        rhpsrt = 'A' and
     c                             nyavd <> gmavd
     c                   exsr      bravd
     c                   endif
      *
      * Brudd på kostnadsbærer  - (kun hvis sortert på kostnadsbærer)
      *
     c                   if        rhpsrt = 'B' and
     c                             nysps <> gmsps
     c                   exsr      brsps
     c                   endif
      *
      * Flytt nytt brudd-begrep til gammelt
      *
     c                   move      nybrd         gmbrd
     c                   move      nytyp         gmtyp
     c                   move      nyrÅr         gmrÅr
     c                   move      sal           gsa
      *
     c     neste         tag
      *
     c                   select
     c                   when      rhpsrt = 'K'
     c     rhsal1_key    reade     rhsal1r                                61
     c                   when      rhpsrt = 'A'
     c     rhsal2_key    reade     rhsal2r                                61
     c                   when      rhpsrt = 'B'
     c     rhsal3_key    reade     rhsal3r                                61
     c                   endsl
      *
     c                   enddo
      *
     c     slutt         tag
      *
T5.10c                   eval      nybrd = *hival
T5.10 *
T5.10c                   exsr      rsum
      *
T5.10c                   exsr      brkto
T5.10c                   exsr      brgrp
T5.10c                   exsr      brkla
      *
T5.40 * Utfører deler av subrutine BRAVD/BRSPS
T5.40c                   eval      *in88 = *on
T5.40c                   if        rhpsrt = 'A'
T5.40c                   exsr      bravd
T.540c                   endif
      *
T5.40c                   if        rhpsrt = 'B'
T5.40c                   exsr      brsps
T.540c                   endif
      *
     c                   if        rhphel = 'H'
     c                   eval(h)   l9s = l9d / 1
     c                   eval(h)   l9sum = l9dum / 1
     c                   else
     c                   eval(h)   l9s = l9d / 1000
     c                   eval(h)   l9sum = l9dum / 1000
     c                   endif
      *
     c                   eval      l9s1  = l9s(01)
     c                   eval      l9s2  = l9s(02)
     c                   eval      l9s3  = l9s(03)
     c                   eval      l9s4  = l9s(04)
     c                   eval      l9s5  = l9s(05)
     c                   eval      l9s6  = l9s(06)
     c                   eval      l9s7  = l9s(07)
     c                   eval      l9s8  = l9s(08)
     c                   eval      l9s9  = l9s(09)
     c                   eval      l9s10 = l9s(10)
     c                   eval      l9s11 = l9s(11)
     c                   eval      l9s12 = l9s(12)
     c                   eval      l9s13 = l9s(13)
     c                   eval      l9s14 = l9s(14)
      *                                                                 .
     c                   write     skrivt
      *
     c                   seton                                        lr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *   Subrutine for summering av matrise-record                  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *
     c     rsum          begsr
      *
     c                   eval      n = 1
      *
     c                   if        rhptyp = 'R' or
     c                             rhptyp = 'P' or
     c                             rhptyp = 'F'
     c                   if        gmrÅr = rhprÅr and
     c                             gmtyp = 1
      *
      * Behandle IB (14 = IB)
      *
     c                   eval      l1d(14) = gsa(14) / 1
     c                   eval      l1dum = l1dum + l1d(14)
      *
      * Summer periode fra 1 - RHPPER
      *
     c                   dou       n > rhpper
     c                   eval      l1d(n) = gsa(n) / 1
     c                   eval      l1dum = l1dum + l1d(n)
     c                   eval      n = n + 1
     c                   enddo
      *
     c                   endif
     c                   endif
      *
      * Saldorecord for prognose/budsjett
      *
     c                   if        rhptyp = 'P' and
     c                             gmrÅr = rhprÅr and
     c                             gmtyp = 3
      *
      * Summer periode fra RHPPER - 13
      *
     c                   eval      n = rhpper + 1
      *
     c                   dou       n > 13
     c                   eval      l1d(n) = gsa(n) / 1
     c                   eval      l1dum = l1dum + l1d(n)
     c                   eval      n = n + 1
     c                   enddo
      *
     c                   endif
      *
      * Saldorecord for prognose/fjorår
      *
     c                   if        rhptyp = 'F' and
     c                             gmrÅr = rhprfj and
     c                             gmtyp = 1
      *
      * Summer periode fra RHPPER - 13
      *
     c                   eval      n = rhpper + 1
      *
     c                   dou       n > 13
     c                   eval      l1d(n) = gsa(n) / 1
     c                   eval      l1dum = l1dum + l1d(n)
     c                   eval      n = n + 1
     c                   enddo
      *
     c                   endif
      *
      * Saldorecord for budsjett
      *
     c                   if        rhptyp = 'B' and
     c                             gmrÅr = rhprÅr and
     c                             gmtyp = 3
      *
      * Behandle IB (14 = IB)
      *
     c                   eval      l1d(14) = gsa(14) / 1
     c                   eval      l1dum = l1dum + l1d(14)
      *
      * Summer periode fra 1 - RHPPER
      *
     c                   dou       n > rhpper
     c                   eval      l1d(n) = gsa(n) / 1
     c                   eval      l1dum = l1dum + l1d(n)
     c                   eval      n = n + 1
     c                   enddo
      *
     c                   endif
      *
      * Saldorecord for alternativt budsjett
      *
     c                   if        rhptyp = 'A' and
     c                             gmrÅr = rhprÅr and
     c                             gmtyp = 4
      *
      * Behandle IB (14 = IB)
      *
     c                   eval      l1d(14) = gsa(14) / 1
     c                   eval      l1dum = l1dum + l1d(14)
      *
      * Summer periode fra 1 - RHPPER
      *
     c                   dou       n > rhpper
     c                   eval      l1d(n) = gsa(n) / 1
     c                   eval      l1dum = l1dum + l1d(n)
     c                   eval      n = n + 1
     c                   enddo
      *
     c                   endif
      *
      * Skriv ut
      *
     c                   if        rhpavs = 'N' and
     c                             gmbrd <> nybrd
      *
      * Hent tekstrecord fra kontoplan-register
      *
     c                   move      gmkto         p_kont
     c                   move      gmavd         p_avde
     c                   move      gmsps         p_spes
      *
     c                   call      'RS740R'
     c                   parm                    p_stat
     c                   parm                    p_kont
     c                   parm                    p_spes
     c                   parm                    p_avde
     c                   parm                    p_text
      *
     c                   move      p_text        kotext
      *
     c                   if        *in30 = *on
     c                   exsr      skriv
     c                   eval      *in30 = *off
     c                   endif
      *
     c                   eval      antkto = antkto + 1
     c                   eval      totkto = totkto + 1
     c                   eval      antsps = antsps + 1
      *
     c                   if        rhphel = 'H'
     c                   eval(h)   l1s = l1d / 1
     c                   eval(h)   l1sum = l1dum / 1
     c                   else
     c                   eval(h)   l1s = l1d / 1000
     c                   eval(h)   l1sum = l1dum / 1000
     c                   endif
      *
     c                   eval      l1s1  = l1s(01)
     c                   eval      l1s2  = l1s(02)
     c                   eval      l1s3  = l1s(03)
     c                   eval      l1s4  = l1s(04)
     c                   eval      l1s5  = l1s(05)
     c                   eval      l1s6  = l1s(06)
     c                   eval      l1s7  = l1s(07)
     c                   eval      l1s8  = l1s(08)
     c                   eval      l1s9  = l1s(09)
     c                   eval      l1s10 = l1s(10)
     c                   eval      l1s11 = l1s(11)
     c                   eval      l1s12 = l1s(12)
     c                   eval      l1s13 = l1s(13)
     c                   eval      l1s14 = l1s(14)
      *
     c                   write     skriv1
     c                   eval      l1s = *zeros
     c                   eval      l1sum = *zeros
      *
     c                   endif
      *
      * Adder til neste nivå
      *
     c                   if        gmbrd <> nybrd
     c                   eval      l2d = l2d + l1d
     c                   eval      l2dum = l2dum + l1dum
     c                   eval      l3d = l3d + l1d
     c                   eval      l3dum = l3dum + l1dum
     c                   eval      l4d = l4d + l1d
     c                   eval      l4dum = l4dum + l1dum
     c                   eval      l5d = l5d + l1d
     c                   eval      l5dum = l5dum + l1dum
     c                   eval      l9d = l9d + l1d
     c                   eval      l9dum = l9dum + l1dum
     c                   eval      l1d = *zeros
KOB  c                   eval      l1dum = *zeros
     c                   endif
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      * Subrutine for beregning ved brudd på konto                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *
     c     brkto         begsr
      *
      * Hent tekstrecord fra kontoplan-register
      *
     c                   eval      p_kont = gmkto
     c                   eval      p_avde = *zero
     c                   eval      p_spes = *zero
      *
     c                   call      'RS740R'
     c                   parm                    p_stat
     c                   parm                    p_kont
     c                   parm                    p_spes
     c                   parm                    p_avde
     c                   parm                    p_text
      *
     c                   move      p_text        kotext
      *
      * Summer pr. linje/adder til neste nivå
      *
      *
     c                   if        rhphel = 'H'
     c                   eval(h)   l2s = l2d / 1
     c                   eval(h)   l2sum = l2dum / 1
     c                   else
     c                   eval(h)   l2s = l2d / 1000
     c                   eval(h)   l2sum = l2dum / 1000
     c                   endif
      *
      * Test om linjen skal skrives
      *
     c                   if        rhpavs = 'N' and
     c                             antsps > 1
      *
     c                   if        *in30 = *on
     c                   exsr      skriv
     c                   eval      *in30 = *off
     c                   endif
      *
     c                   eval      antkto = antkto + 1
      *
     c                   eval      l2s1  = l2s(01)
     c                   eval      l2s2  = l2s(02)
     c                   eval      l2s3  = l2s(03)
     c                   eval      l2s4  = l2s(04)
     c                   eval      l2s5  = l2s(05)
     c                   eval      l2s6  = l2s(06)
     c                   eval      l2s7  = l2s(07)
     c                   eval      l2s8  = l2s(08)
     c                   eval      l2s9  = l2s(09)
     c                   eval      l2s10 = l2s(10)
     c                   eval      l2s11 = l2s(11)
     c                   eval      l2s12 = l2s(12)
     c                   eval      l2s13 = l2s(13)
     c                   eval      l2s14 = l2s(14)
      *
     c                   write     skriv2
      *
     c                   endif
      *
     c                   if        rhpavs = 'J'
      *
     c                   if        *in30 = *on
     c                   exsr      skriv
     c                   eval      *in30 = *off
     c                   endif
      *
     c                   eval      antkto = antkto + 1
      *
     c                   eval      l2s1  = l2s(01)
     c                   eval      l2s2  = l2s(02)
     c                   eval      l2s3  = l2s(03)
     c                   eval      l2s4  = l2s(04)
     c                   eval      l2s5  = l2s(05)
     c                   eval      l2s6  = l2s(06)
     c                   eval      l2s7  = l2s(07)
     c                   eval      l2s8  = l2s(08)
     c                   eval      l2s9  = l2s(09)
     c                   eval      l2s10 = l2s(10)
     c                   eval      l2s11 = l2s(11)
     c                   eval      l2s12 = l2s(12)
     c                   eval      l2s13 = l2s(13)
     c                   eval      l2s14 = l2s(14)
      *
     c                   write     skriv2
      *
     c                   endif
      *
     c                   eval      antsps = *zeros
     c                   eval      l2d = *zeros
     c                   eval      l2s = *zeros
     c                   eval      l2dum = *zeros
     c                   eval      l2sum = *zeros
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *   Subrutine for beregning ved brudd på kontogruppe           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *
     c     brgrp         begsr
      *
      * Summer pr. linje/adder til neste nivå
      *
     c                   if        rhphel = 'H'
     c                   eval(h)   l3s = l3d / 1
     c                   eval(h)   l3sum = l3dum / 1
     c                   else
     c                   eval(h)   l3s = l3d / 1000
     c                   eval(h)   l3sum = l3dum / 1000
     c                   endif
      *
      * Kontogruppe skrives bare hvis minst en konto er skrevet
      *
     c                   if        antkto > *zeros
      *
      * Hent gruppetekst fra koderegisteret
      *
     c                   move      gmgrp         p_tkod
      *
     c                   call      'RS720R'
     c                   parm                    p_stat
     c                   parm                    p_tkod
     c                   parm                    p_tx30
      *
     c                   if        p_stat = 'N'
     c                   eval      grtext = *blank
     c                   movel     txt(2)        grtext
     c                   else
     c                   movel     p_tx30        grtext
     c                   endif
      *
      * Test om linjen skal skrives
      *
     c                   if        rhpkgs = 'J'
      *
     c                   if        *in30 = *on
     c                   exsr      skriv
     c                   eval      *in30 = *off
     c                   endif                                                            .  .
      *                                                              .  .
     c                   eval      l3s1  = l3s(01)
     c                   eval      l3s2  = l3s(02)
     c                   eval      l3s3  = l3s(03)
     c                   eval      l3s4  = l3s(04)
     c                   eval      l3s5  = l3s(05)
     c                   eval      l3s6  = l3s(06)
     c                   eval      l3s7  = l3s(07)
     c                   eval      l3s8  = l3s(08)
     c                   eval      l3s9  = l3s(09)
     c                   eval      l3s10 = l3s(10)
     c                   eval      l3s11 = l3s(11)
     c                   eval      l3s12 = l3s(12)
     c                   eval      l3s13 = l3s(13)
     c                   eval      l3s14 = l3s(14)
      *                                                              .  .
     c                   write     skriv3                                                 .  .
     c                   endif                                                        .....  .
      *                                                                 .
     c                   endif                                                           .....
      *
     c                   eval      antkto = *zeros
     c                   eval      l3d = *zeros
     c                   eval      l3s = *zeros
     c                   eval      l3dum = *zeros
     c                   eval      l3sum = *zeros
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *   Subrutine for beregning ved brudd på kontoklasse           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *
     c     brkla         begsr
      *
      * Summer pr. linje/adder til neste nivå
      *
     c                   if        rhphel = 'H'                                       ........
     c                   eval(h)   l4s = l4d / 1                                             .
     c                   eval(h)   l4sum = l4dum / 1                                         .
     c                   else                                                                .
     c                   eval(h)   l4s = l4d / 1000                                          .
     c                   eval(h)   l4sum = l4dum / 1000                                      .
     c                   endif                                                        ........
      *
      * Hent klassetekst fra koderegisteret
      *
     c                   eval      p_skod = *zero
     c                   move      gmkla         p_skod                                      .
      *
     c                   call      'RS719R'
     c                   parm                    p_stat
     c                   parm                    p_skod
     c                   parm                    p_tx30
      *
     c                   if        p_stat = 'N'
     c                   eval      kltext = *blank
     c                   movel     txt(1)        kltext
     c                   else
     c                   movel     p_tx30        kltext
     c                   endif
      *
      * Test om linjen skal skrives
      *
     c                   if        rhpkks = 'J'                                          .....
      *                                                                 .
     c                   if        *in30 = *on                                               .
     c                   exsr      skriv                                                     .
     c                   eval      *in30 = *off
     c                   endif                                                               .
      *                                                              .  .
     c                   eval      l4s1  = l4s(01)
     c                   eval      l4s2  = l4s(02)
     c                   eval      l4s3  = l4s(03)
     c                   eval      l4s4  = l4s(04)
     c                   eval      l4s5  = l4s(05)
     c                   eval      l4s6  = l4s(06)
     c                   eval      l4s7  = l4s(07)
     c                   eval      l4s8  = l4s(08)
     c                   eval      l4s9  = l4s(09)
     c                   eval      l4s10 = l4s(10)
     c                   eval      l4s11 = l4s(11)
     c                   eval      l4s12 = l4s(12)
     c                   eval      l4s13 = l4s(13)
     c                   eval      l4s14 = l4s(14)
      *                                                              .  .
     c                   write     skriv4                                                    .
     c                   endif                                                           .....
      *
     c                   eval      l4d = *zeros
     c                   eval      l4s = *zeros
     c                   eval      l4dum = *zeros
     c                   eval      l4sum = *zeros
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *   Subrutine for beregning av brudd på avdeling               *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *
     c     bravd         begsr
      *
      * SUMMER PR. LINJE
      *
     c                   if        rhphel = 'H'                                       ........
     c                   eval(h)   l5s = l5d / 1                                             .
     c                   eval(h)   l5sum = l5dum / 1                                         .
     c                   else                                                                .
     c                   eval(h)   l5s = l5d / 1000                                          .
     c                   eval(h)   l5sum = l5dum / 1000                                      .
     c                   endif                                                        ........
      *
      * Hent avdelingstekst fra koderegisteret
      *
     c                   move      gmavd         w_avde
     c                   move      gmavd         p_gkod
T5.40c                   eval      p_tx30 = *blank                               finnes
      *
     c                   call      'RS707R'
     c                   parm                    p_stat
     c                   parm                    p_gkod
     c                   parm                    p_tx30
      *
     c                   movel     p_tx30        avtext
      *
     c                   if        *in30 = *on
     c                   exsr      skriv
     c                   eval      *in30 = *off
     c                   endif
      *                                                              .  .
     c                   eval      l5s1  = l5s(01)
     c                   eval      l5s2  = l5s(02)
     c                   eval      l5s3  = l5s(03)
     c                   eval      l5s4  = l5s(04)
     c                   eval      l5s5  = l5s(05)
     c                   eval      l5s6  = l5s(06)
     c                   eval      l5s7  = l5s(07)
     c                   eval      l5s8  = l5s(08)
     c                   eval      l5s9  = l5s(09)
     c                   eval      l5s10 = l5s(10)
     c                   eval      l5s11 = l5s(11)
     c                   eval      l5s12 = l5s(12)
     c                   eval      l5s13 = l5s(13)
     c                   eval      l5s14 = l5s(14)
      *                                                              .  .
     c                   write     skriv5
      *
T5.40 * Ved slutt, utføres ikke resten av subrutinen
T5.40c                   if        *in88 = *on
T5.40c                   goto      xbravd
T5.40c                   endif
      *
      * Hent avdelingstekst fra koderegisteret og skriv ny heading
      *  n10
     c                   do                                                              .....
     c                   move      nyavd         w_avde                                      .
     c                   move      nyavd         p_gkod
T5.40c                   eval      p_tx30 = *blank                               finnes
      *
     c                   call      'RS707R'
     c                   parm                    p_stat
     c                   parm                    p_gkod
     c                   parm                    p_tx30
      *
     c                   movel     p_tx30        avtext
      *                                                                 .
     c                   exsr      skriv                                                     .
      *                                                                 .
     c                   enddo                                                           .....
      *
     c                   eval      l5d = *zeros
     c                   eval      l5s = *zeros
     c                   eval      l5dum = *zeros
     c                   eval      l5sum = *zeros
      *
E5.40c     xbravd        endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *   Subrutine for beregning av brudd på kostnadsbærer          *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *
     c     brsps         begsr
      *
      * Summer pr. linje
      *
     c                   if        rhphel = 'H'                                       ........
     c                   eval(h)   l5s = l5d / 1                                             .
     c                   eval(h)   l5sum = l5dum / 1                                         .
     c                   else                                                                .
     c                   eval(h)   l5s = l5d / 1000                                          .
     c                   eval(h)   l5sum = l5dum / 1000                                      .
     c                   endif                                                        ........
      *
      * Hent kostnadsbærertekst fra koderegisteret
      *
     c                   move      gmsps         w_spes
     c                   move      gmsps         p_Økod
T5.40c                   eval      p_tx30 = *blank                               finnes
      *
     c                   call      'RS728R'
     c                   parm                    p_stat
     c                   parm                    p_Økod
     c                   parm                    p_tx30
      *
     c                   movel     p_tx30        sptext
      *
     c                   if        *in30 = *on                                               .
     c                   exsr      skriv                                                     .
     c                   eval      *in30 = *off
     c                   endif                                                               .
      *
     c                   eval      l5s1  = l5s(01)
     c                   eval      l5s2  = l5s(02)
     c                   eval      l5s3  = l5s(03)
     c                   eval      l5s4  = l5s(04)
     c                   eval      l5s5  = l5s(05)
     c                   eval      l5s6  = l5s(06)
     c                   eval      l5s7  = l5s(07)
     c                   eval      l5s8  = l5s(08)
     c                   eval      l5s9  = l5s(09)
     c                   eval      l5s10 = l5s(10)
     c                   eval      l5s11 = l5s(11)
     c                   eval      l5s12 = l5s(12)
     c                   eval      l5s13 = l5s(13)
     c                   eval      l5s14 = l5s(14)
      *                                                              .  .
     c                   write     skriv5
      *
T5.40 * Ved slutt, utføres ikke resten av subrutinen
T5.40c                   if        *in88 = *on
T5.40c                   goto      xbrsps
T5.40c                   endif
      *
      * Hent kostnadsbærertekst fra koderegisteret og skriv ny heading
      * n10
     c                   do                                                              .....
     c                   move      nysps         w_spes                                      .
     c                   move      nysps         p_Økod
T5.40c                   eval      p_tx30 = *blank                               finnes
      *
     c                   call      'RS728R'
     c                   parm                    p_stat
     c                   parm                    p_Økod
     c                   parm                    p_tx30
      *
     c                   movel     p_tx30        sptext
      *                                                                 .
     c                   exsr      skriv                                                     .
      *                                                                 .
     c                   enddo                                                           .....
      *
     c                   eval      l5d = *zeros
     c                   eval      l5s = *zeros
     c                   eval      l5dum = *zeros
     c                   eval      l5sum = *zeros
      *
E5.40c     xbrsps        endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *   Subrutine for å skrive heading                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *
     c     skriv         begsr
      *
     c                   eval      totsid = totsid + 1
     c                   write     head1
      *
     c                   if        *in21 = *on or
     c                             *in22 = *on
     c                   write     head2
     c                   endif
      *
     c                   write     head3
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
     c                   eval      w_text = *blank
     c                   eval      totkto = *zeros
     c                   eval      dum = 0
     c                   eval      sum = 0
     c                   eval      x = *zeros
     c                   eval      kod = *blank
T5.10c                   eval      w_firm = l_firm
      *
      * Test for type utskrift
      *
     c                   select
     c                   when      rhptyp = 'R'                                          .....
     c                   eval      *in14 = *on                                               .
     c                   eval      h4prÅr = rhprÅr                                           .
      *
     c                   when      rhptyp = 'B'                                          .....
     c                   eval      *in15 = *on                                               .
     c                   eval      h5prÅr = rhprÅr                                           .
      *
     c                   when      rhptyp = 'A'                                          .....
     c                   eval      *in16 = *on                                               .
     c                   eval      h6prÅr = rhprÅr                                           .
      *
     c                   when      rhptyp = 'P'                                          .....
     c                   move      *on           *in17                                       .
     c                   eval      h7prÅr = rhprÅr                                           .
      *                                                                 .
     c                   do        13            x                                           .
     c                   if        rhpper >= x                                               .
     c                   move      'R'           kod(x)                                      .
     c                   else                                                                .
     c                   move      'B'           kod(x)                                      .
     c                   endif                                                               .
     c                   enddo                                                               .
      *                                                                 .
      *
     c                   when      rhptyp = 'F'                                          .....
     c                   move      *on           *in18                                       .
     c                   eval      h8prÅr = rhprÅr                                           .
      *                                                                 .
     c                   do        13            x                                           .
     c                   if        rhpper >= x                                               .
     c                   move      'R'           kod(x)                                      .
     c                   else                                                                .
     c                   move      'F'           kod(x)                                      .
     c                   endif                                                               .
     c                   enddo                                                               .
      *                                                                 .
     c                   endsl                                                           .....
      *
      * Test for sorteringsrekkefølge
      *
     c                   select
     c                   when      rhpsrt = 'K'                                          .....
     c                   eval      *in20 = *on                                               .
      *
     c                   when      rhpsrt = 'A'                                          .....
     c                   eval      *in21 = *on                                               .
      *
     c                   when      rhpsrt = 'B'                                          .....
     c                   eval      *in22 = *on                                               .
     c                   endsl                                                           .....
      *
      * Test for beløpsverdi ut
      *
     c                   if        rhphel = 'H'                                          .....
     c                   move      *on           *in24                                       .
     c                   endif                                                           .....
      *
     c                   if        rhphel = 'T'                                          .....
     c                   move      *on           *in25                                       .
     c                   endif                                                           .....
      *
      * Test om kladdeblokk ut
      *
     c                   if        rhpavs = 'J'                                          .....
     c                   move      *on           *in26                                       .
     c                   endif                                                           .....
      *
      * Sett startverdier
      *
     c                   eval      nybrd = *zeros
     c                   eval      gmbrd = *zeros
      *
     c                   eval      rhsal1_kont = rhpktf
     c                   eval      rhsal1_spes = *zeros
     c                   eval      rhsal1_avde = *zeros
      *
     c                   eval      rhsal2_avde = rhpavf
     c                   eval      rhsal2_kont = *zeros
     c                   eval      rhsal2_spes = *zeros
      *
     c                   eval      rhprfj = rhprÅr - 1
      *
T5.40 * Henting av avdeling/bærertekst er flyttet.
T5.40 * se under BEHAND TAG.
      *
      * Key for saldoregister - konto
      *
     c     rhsal1_key    klist
     c                   kfld                    w_firm
      *
      * Key for saldoregister - avdeling
      *
     c     rhsal2_key    klist
     c                   kfld                    w_firm
      *
      * Key for saldoregister - Kostnadsbærer
      *
     c     rhsal3_key    klist
     c                   kfld                    w_firm
      *
     c                   endsr
**
K L A S S E S U M
G R U P P E S U M
