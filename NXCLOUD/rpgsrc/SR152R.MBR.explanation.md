# RPG Source Code Forklaring

Dette RPG-programmet er designet for å håndtere en brukergrensesnittbasert applikasjon med subfiler og skjermbilder, spesielt for utvalg av avdeling. Programmet er strukturert med flere subrutiner for å håndtere ulike funksjoner som opprettelse, oppdatering, sletting og visning av data i subfiler og skjermbilder.

## Hovedstruktur og Hovedkontroll

- **Hovedprogrammet** starter med å sette opp fil- og nøkkeldefinisjoner, og initialiserer variabler. Det bruker `*inzsr` for initialisering av filnøkler og data.

- **B2CTL** er hovedkontrollen for å håndtere åpning av skjermbildet og brukerinput via funksjonstaster. Den bruker `exfmt` for å behandle skjermbildet og håndterer funksjonstaster med `select/when` for å styre flyten.

- **Posisjonering** og **subfilekontroll** håndteres med subrutiner `posisjoner` og `control`, som sørger for riktig innlasting og oppdatering av data.

- **Subfile-behandling** foregår i `subfile`-subrutinen, som leser, oppdaterer og sletter poster, og sikrer at dataene er synkronisert med brukerens handlinger.

## Subrutiner

### `forny`
- Tømmer subfilen og oppretter nye data i henhold til nåværende nøkkelverdier.
- Brukes når man skal fornye visningen av data.

### `posisjoner`
- Posisjonerer i data basert på nøkkelverdier (`b2gkod`).
- Tømmer og fyller opp subfilen med data som samsvarer med nøkkelen.

### `control`
- Behandler subfile-kontrollhandlinger som opprettelse ('1') og sletting ('4').
- Validerer nøkkelverdier og oppdaterer eller sletter data i databasen.

### `subfile`
- Leser og behandler poster i subfilen.
- Sletter poster hvis `b1valg` er '4'.
- Oppdaterer visning og data basert på brukerhandlinger.

### `dsp_subfile`
- Viser data i subfilen.
- Aktiverer visning av eksisterende poster.

### `clr_subfile`
- Tømmer subfilen og nullstiller relaterte variabler.
- Brukes for å starte på nytt eller rydde opp.

### `crt_subfile`
- Oppretter nye poster i subfilen.
- Fyller opp med data fra database og oppdaterer visningen.

### `xc1bld`, `xc2bld`, `xc1msg`
- Håndterer skjermbilder og brukerinteraksjon.
- Oppretter og behandler ulike skjermbilder for opprettelse, visning og endring.

### `xd1win`
- Behandler sletting av poster i subfilen.

## Generelle Notater

- Programmet bruker `chain` for oppslag i databaser, og `readc`/`write` for subfiloperasjoner.
- Variabler som `w_srrn`, `w_ssrn`, `w_sfrn` brukes for å holde styr på posisjoner i subfilen.
- Funksjonstaster håndteres med `select/when` og gir brukeren mulighet til å utføre opprettelse, endring, sletting eller avslutte.
- `exfmt` brukes for skjermbehandling, og ulike skjermbilder er definert med navn som `c1bld`, `c2bld`, og `c1msg`.
- Koden er godt strukturert med klare subrutiner for å håndtere ulike deler av funksjonaliteten, noe som gjør den lett å vedlikeholde og utvide.

Dette oppsettet er typisk for RPG-programmer som håndterer brukergrensesnitt og databaser i et terminalbasert miljø, med fokus på enkel datamanipulering og brukerinteraksjon.