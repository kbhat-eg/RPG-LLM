# Documentation: FP227R – Registration of Parameters for Label Printing

## Overview

`FP227R` is a program in the ASOFAK system responsible for registering parameters related to the printing of numeric (talletiketter) labels. Its main function is to determine the print settings based on company-specific parameters and to generate a set of parameter records for downstream label printing processes.

The program interacts primarily with two physical files:

- **VFASPF**: Contains printer information, keyed by company.
- **PARAM**: Output file where parameter records for label printing are written.

## Key Business Logic

### 1. Retrieving Printer Information

The program starts by initializing a key (`faskey`) to zero and then setting it to the value of `lcfirm` (company number). It uses this key to look up the corresponding printer settings in the `VFASPF` file.

- If a matching record is **not found** (`*IN60 = *ON`), the printer type (`lcskty`) is set to zero, indicating a default or unknown printer configuration.
- If a record is **found**, the printer type (`vnskty`) from the file is moved into the local variable `lcskty`.

This conditional logic ensures that the label printing parameters are tailored to the specific company’s printer configuration, or defaulted if not found.

### 2. Setting the Print Program

The program sets the parameter `lcruti` to `'FP228 '`. This likely denotes the downstream print routine or program that will process the generated label parameters.

### 3. Writing Parameter Records

The program uses the `EXCEPT` operation to trigger the writing of parameter records to the `PARAM` file. The output specifications (`O-specs`) at the end of the source define the format and content of these records.

Each record corresponds to a specific label count (e.g., 1, 2, 3, 4, 5, 10, 15, 20, 30, 50, 99), with the fields:

- Position 4: Constant `'0001'` (possibly a parameter type or code)
- Position 6: Label count (e.g., `'01'`, `'02'`, etc.)
- Position 11: Label count in a padded format (e.g., `'00001'`, `'00002'`, etc.)

These records are likely used by the print program (`FP228`) to drive the actual label generation for different batch sizes or configurations.

### 4. Program Termination

After writing the parameter records, the program sets the last record indicator (`*INLR`) to `*ON`, signaling program completion and resource cleanup.

## Data Structure and Field Usage

The program relies on a local data area (`UDS`), with specific offsets for each field. Notable fields include:

- `lcfirm`: Company number, used as the key for printer lookup.
- `lcskty`: Printer type, determined based on company configuration.
- `lcruti`: Name of the downstream print program.
- Other fields (`lcskty`, `lcvalg`, `lcetpr`, etc.) are reserved for various parameters, possibly used in extended business logic or by other programs.

## Design Considerations and Conventions

- **Hardcoded Parameter Sets**: The output records are hardcoded for a fixed set of label quantities. If new label quantities are needed, the program must be updated.
- **Company-Specific Customization**: The lookup in `VFASPF` enables company-specific printer handling, supporting multi-company environments.
- **Separation of Concerns**: This program only registers parameters; the actual printing is delegated to another program (`FP228`), promoting modularity.
- **Use of Local Data Area**: Parameters are passed via a UDS, a common pattern for sharing data between programs in this system.

## External Dependencies

- **VFASPF**: Must be maintained with accurate printer information for each company.
- **PARAM**: Acts as a communication medium for parameter passing to print routines.
- **FP228**: The print program that consumes the parameters generated by `FP227R`.

## Summary

`FP227R` acts as a preparatory step in the label printing workflow, ensuring that the correct parameters are registered based on company and printer configuration. Its output enables the downstream print process to function correctly for different label quantities and organizational setups. Any changes in label configuration or printer setups should be reflected in the corresponding files and, if necessary, in this program’s logic.