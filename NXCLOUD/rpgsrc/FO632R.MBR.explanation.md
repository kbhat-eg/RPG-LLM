# RPG Program Explanation – FO632R

This RPG program, named **FO632R**, is designed for IBM i (AS/400, iSeries) systems. It interacts with users through display files to collect report parameters, validate them, and then passes these parameters to other programs for further processing such as data selection and printing reports.

## 1. **Header and History Section**

The initial comment block provides program metadata:
- **System**: ASOFAK
- **Program**: FO632R
- **Description**: Prints a control list ("Utskrift av kontroll-liste")
- **History**: Documents changes across versions (e.g., added department selection, new GUI adjustments, integration with different subprograms).

## 2. **File Declarations (`F-Specs`)**

```rpg
FFO632D    CF   E             WORKSTN
FVOTYL1    IF   E           K DISK    RENAME(VOTYPFR:VOTYL1R)
Ffra07pf    if   e           k disk
```
- `FO632D`: Display file for user interaction (`WORKSTN`).
- `VOTYL1`: Disk file for order types, with alias `VOTYL1R`.
- `FRA07PF`: Disk file, likely used for department validation.

## 3. **Data Definitions (`D-Specs`)**

Defines variables and data structures for:
- **Work variables**: e.g., `w_firm` (firm number), `w_navn` (name), `w_tvbt`, `w_btch`, etc.
- **Parameter structures** (for passing between programs): `LDPREC`, `LDOTYP`, etc.
- **Local data area structures**: `lda` and its subfields.

**Examples:**
```rpg
d w_firm          s              3  0
d w_atxt          s             20
...
D                 DS
D  LDPREC                 1     84
D  LDOTYP                 1      2
...
```
These are used to temporarily hold and structure the values entered by the user.

## 4. **Initialization and Main Logic**

### **Startup Sequence**

- **Zeroing fields**: Clears fields shown in the initial parameter screen.
- **Control flows using labels**: (e.g., `B1TAG`, `C1TAG`) and subroutines for reuse and clarity.

### **Main Screen Handling ("B1TAG" section)**

- **EXFMT** reads/writes display file record (`B1BLD`) to interact with users.
- Handles **function keys**:
  - **F3 / *INKC**: Exit program (`goto xslutt`)
  - **F4 / *INKD**: Invoke search help (`exsr spørring`)
- **Validation**:
  - Checks if order type exists in the order type register.
  - Validates the department (avdeling) if entered.
  - Validates that "from" date is not after "to" date.

### **Parameter Preparation**

- Gathers user input and assigns to the corresponding parameter variables, e.g.,
  ```rpg
  MOVE      B1OTYP        LDOTYP
  MOVE      B1SEKV        LDSEKV
  ...
  ```
- Handles "unlimited" ranges: If "to" fields are zero, sets them to max values (e.g., 999999 or *hival).

### **Sorting and Selection Screen ("C1TAG" section)**

- User can specify additional selection criteria and sorting.
- Assigns values to internal parameter fields for use by the called report program.

### **Kickoff of Processing**

- Writes values to local data area (for communication between programs).
- Calls the actual selection/print program (`AP600R`), passing relevant parameters.
- If F4 is pressed, indicates job should be placed on a job queue.
- Gets the latest file/member number by calling `FA920R`.
- Calls additional control program `FO633C` with all selection parameters.

## 5. **Subroutines**

### **spørring** (Inquiry/Search Help)
Handles field-level inquiries (prompting user selection for fields like order type, department, customer, info type, etc.) by calling relevant inquiry programs, depending on which field triggered the help.

### **xf1win1** (Hard-Coded Selection Help)
Presents a hardcoded window (F1WIN) with alternate billing options. User selects, and the selected code is assigned to the variables.

### **xf1nul** (Clear Hard-Coded Help Window)
Clears all fields used in the F1 selection window.

### **INZSR** (Initialization Subroutine)
Runs at program start. Sets up important variables, default values, and key structure definitions.

## 6. **Program End**

### **"XSLUTT" Label**
- Sets LR (Last Record indicator) to end program.
- Returns control to the system.

---

## **High-level Flow**

1. **User is prompted for selection parameters** (order type, period, customers, etc.).
2. **Field-level validation and search helps** allow users to select valid values.
3. **After all inputs are gathered**, further sorting/selection details are collected on a subsequent screen.
4. **Collected parameters are packed into data structures** and passed to a called program (`AP600R`) that does the heavy lifting (report generation/selection).
5. If required, **jobs can be submitted to a job queue**.
6. Utility programs are called for maintaining file/member numbers, and possible post-processing.
7. **The program ends cleanly** after kicking off the selection/print process.

---

## **Key Concepts for Onboarding**

- **Parameter Handling**: Data entered by user is validated, packed into parameter blocks, and passed to other programs.
- **File I/O**: Both display files (for user screens) and disk files (for validation/data retrieval).
- **Subprogram Calls**: Most "real processing" (selection, printing, etc.) is delegated to called programs.
- **Use of Subroutines and Tags**: Standard RPG IV flow control mechanisms.
- **History and Comments**: The extensive revision history is valuable for understanding why things have changed.

---

## **Development & Maintenance Tips**

- **Whenever you add new selection options or validation**, mirror the logic seen for other fields (both the UI, the parameter, and the subroutine structure).
- **Program interactions**: Know what parameters each called program expects.
- **Review display files (DDS)** referenced (`FO632D`) to understand the screens shown to users.

---

## **Conclusion**

This is a classic IBM RPG interactive program acting as a "parameter entry front-end" to a report selection and printing process, with robust field help and validations to guide the user and ensure data integrity. The actual data handling and reporting is done by other called programs, with this program responsible for gathering, validating, and passing correct parameters onward.