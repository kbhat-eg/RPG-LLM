# LL620R - Documentation

## Overview

**LL620R** is a parameter entry program for generating reports on item movements ("varebevegelse") in the inventory system. Its primary function is to collect, validate, and package user-specified selection criteria, which are then passed to subsequent processes for report generation. The program acts as a front-end for parameter collection, ensuring data integrity and user guidance before report execution.

## Structure and Flow

### 1. File Declarations

- **rlevl1**: Supplier master file (renamed record format `rlevl1r`).
- **ra26l1**: Buyer/handler master file (renamed record format `ra26l1r`).
- **ll620d**: Workstation file for the parameter entry display (`a1bld` format).

### 2. Data Definitions

- **Local Data Area**: Used to retrieve the current company number (`l_firm`) and company name (`l_fnav`).
- **Parameter Data Structure (`d_prec`)**: A 128-byte structure overlaid by individual fields representing all report selection criteria (from/to item number, groupings, supplier, handler, etc.).
- **Key Variables**: Used for file access (e.g., `rlevl1_levr`, `ra26l1_sakb`).
- **Working Variables**: For temporary storage and parameter passing to called programs.

### 3. Indicator Usage

- **KC**: F3=Exit
- **LR**: Last record/End program
- **30-34**: Field protection and validation errors
- **35-38**: Specific validation errors (supplier, handler, etc.)
- **70-89**: Work indicators for subroutines and general use
- **90-99**: File operation indicators (e.g., CHAIN not found)

### 4. Main Logic

#### Initialization (`*inzsr`)

- Sets up key lists for supplier and handler lookups.
- Receives input parameters via PLIST (`w_in03`, `w_parm`).
- Assigns default values to all selection fields for the screen.
- Sets the company number from the LDA.

#### Main Loop

- **Screen Display**: Presents the input screen (`a1bld`).
- **Exit Handling**: F3 (KC) sets exit flag and jumps to program end.
- **Inquiry Handling**: F4 (KD) triggers the `sp_input` subroutine for field-specific search windows.
- **Validation**: Checks that all "from" values are less than or equal to their corresponding "to" values for each selection criterion. If not, sets the respective error indicator and redisplays the screen.
- **Supplier/Handler Validation**: If supplied, validates existence in respective master files. Sets error indicators if not found.
- **Variant/Sorting Validation**: Ensures variant and sorting values are within allowed ranges.
- **Parameter Packaging**: On successful validation, moves all selection criteria into the packed parameter structure (`d_prec`), which is then moved to the output parameter (`w_parm`).

#### Program End

- Sets LR indicator to terminate the program and returns to the caller.

### 5. Subroutines

#### `sp_input` - Inquiry Subroutine

Handles lookups for each field that supports inquiry/search functionality:

- **Item Number (A1FVAR/A1TVAR)**: Calls `VV500R` for item lookup.
- **Overgroup (A1FOGR/A1TOGR)**: Calls `VG510R` for overgroup lookup.
- **Main Group (A1FHGR/A1THGR)**: Calls `VG511R` for main group lookup.
- **Subgroup (A1FUGR/A1TUGR)**: Calls `VG512R` for subgroup lookup.
- **Warehouse (A1FLAG/A1TLAG)**: Calls `RA510R` for warehouse lookup.
- **Supplier (A1LVNR)**: Calls `RL500R` for supplier lookup.
- **Buyer/Handler (A1SAKB)**: Calls `RA526R` for handler lookup.

Each branch sets or resets the relevant fields based on the lookup result.

### 6. External Program Calls

- **VV500R**: Item master inquiry
- **VG510R**: Overgroup inquiry
- **VG511R**: Main group inquiry
- **VG512R**: Subgroup inquiry
- **RA510R**: Warehouse inquiry
- **RL500R**: Supplier inquiry
- **RA526R**: Buyer/handler inquiry

These programs are responsible for presenting selection lists and returning the chosen value.

### 7. Business/Domain Logic

- **Selection Ranges**: The user can specify ranges for item numbers, warehouses, overgroups, main groups, subgroups, etc. The system enforces that the "from" value is not greater than the "to" value for each range.
- **Supplier and Buyer/Handler Validation**: Ensures that only valid, existing suppliers and handlers can be entered, preventing invalid report generation.
- **Variants and Sorting**: Only certain values are allowed for variant and sorting fields, controlling the type and order of the report output.
- **Parameter Packaging**: All user selections are packed into a single structure (`d_prec`) for ease of passing to downstream processes.

### 8. Design Decisions and Conventions

- **Parameter Packing**: The use of a single 128-byte structure (`d_prec`) to overlay all parameters allows for efficient parameter passing and storage, but requires careful mapping and maintenance.
- **Indicator-Driven UI**: The program uses classic RPG indicator conventions for screen control, error signaling, and file operations.
- **Externalized Lookups**: All master data lookups are handled by external programs, promoting reuse and standardization of selection logic across the application.
- **Hardcoded Defaults**: Initial ranges are set to broad values (e.g., 0 to 99999999 for item numbers) to ensure inclusive selection unless restricted by the user.

## Interactions with Other Modules

- **Master Files**: Reads from supplier (`rlevl1`) and handler (`ra26l1`) master files for validation.
- **Inquiry Programs**: Calls various inquiry programs for interactive field lookups.
- **Downstream Processes**: Passes the packed parameter structure to the next process in the report generation chain (not shown in this program).

## Summary

LL620R is a robust parameter entry module for inventory movement reporting, enforcing strict validation, leveraging reusable inquiry components, and standardizing parameter transfer via a compact data structure. Its design ensures data integrity and user guidance, centralizing all selection logic before report execution. New developers should familiarize themselves with the parameter packing conventions, indicator usage, and the suite of inquiry programs for effective maintenance and extension of this module.