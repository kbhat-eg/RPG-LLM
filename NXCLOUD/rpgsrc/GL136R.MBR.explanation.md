# RPG Source Code Explanation

This RPG program (`GL135R`) is a simple utility used to fetch the company name (`firmanavn`) from a data file (`afirl1`) based on a given key (`wpffir`). Below is a breakdown to help a developer quickly understand how this program works.

---

## 1. Header and Metadata

```
/TITLE  ASBANK
h datedit(*dmy) option(*nodebugio)
```
- **/TITLE**: Sets the source member title.
- **H-spec**: Configures the date edit format (day/month/year) and disables RPG's debug I/O.

---

### Program Comments

Descriptive comments provide metadata:
- **System/Program**: ASBANK/GL135R
- **Description**: Fetches company name
- **Last changed**: 2022-12-05 (by RH)
- **Indicator usage**:
  - `LR`: End-of-program
  - `60-69`: File operation indicators (e.g., `chain` success)

---

## 2. File Declaration

```
fafirl1    if   e           k disk
```
- **fafirl1**: File declaration for a disk file, using the IF (input, full procedural) and K (keyed) keywords.

---

## 3. Data Structure & Fields

### Data Structure

```
d                uds
d dsfirm                944    946  0
```
- Unnamed data structure (`UDS` - user-defined status) with a subfield `dsfirm` (positions 944-946, 3-digits, zero decimal).

### Stand-alone Fields

```
d wpffir          s              3  0
d wpfnav          s             30
```
- **wpffir**: 3-digit (packed) numeric field, input parameter (company number/key)
- **wpfnav**: 30-character alphanumeric field, output parameter (company name)

---

## 4. Main Logic

### Variable Initialization

```rpg
c                   movel     *blanks       wpfnav
c                   movel     '**UKJENT'    wpfnav
```
- `wpfnav` is cleared (filled with blanks), then set to '**UKJENT' (Norwegian for '**UNKNOWN') as a default.

### File Lookup

```rpg
c     wpffir        chain     afirl1                             60
```
- Attempts to read the `afirl1` file using `wpffir` as the key.
- If the chain is successful, indicator 60 is *OFF.

#### On Successful Chain

```rpg
c                   if        *in60 = *off
c                   movel     aafnav        wpfnav
c                   endif
```
- If found, moves the value of `aafnav` (the company name in `afirl1`) to `wpfnav`.

---

## 5. Program Termination

```rpg
c     xslutt        tag
c                   eval      *inlr = *on
c                   return
```
- Control label for program end.
- Sets LR (last record, end of program) to on.
- Returns (exits the program).

---

## 6. Initialization Subroutine (*INZSR)

```rpg
c     *inzsr        begsr
c     *entry        plist
c                   parm                    wpffir
c                   parm                    wpfnav
c                   endsr
```
- **Purpose**: Entry point for initializing the program and establishing a parameter list.
- **Parameter List**:
  - `wpffir` (input): Company key (three-digit)
  - `wpfnav` (output): Company name (30-char string)

---

## 7. High-Level Flow

1. **On entry**, the program receives `wpffir` and `wpfnav` as parameters.
2. It initializes `wpfnav` to '**UKJENT' (unknown).
3. Uses `chain` to look up the company name (`aafnav`) in the file `afirl1`.
4. If found, copies the name into `wpfnav`. If not found, `wpfnav` remains '**UKJENT'.
5. Exits after setting the LR indicator.

---

## 8. Key Points for a New Developer

- The program is a simple lookup utility, likely called from other programs.
- Uses a standard parameter interface (`plist`).
- Handles one key input and returns the company name, or '**UKJENT' if not found.
- All business logic is contained in the mainline code; no subprocedures.
- File `afirl1` must have the fields `aafnav` (company name) and be keyed on `wpffir`.

---

## 9. Typical Usage

Someone would call `GL135R`, passing a 3-digit company number. It will return the associated name (if found), or '**UKJENT'.