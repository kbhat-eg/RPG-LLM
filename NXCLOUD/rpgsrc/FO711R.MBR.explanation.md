# RPG Program FO711R – Explanation

## Overview

This ILE RPG program, **FO711R**, is written for the IBM i (AS/400) system. Its main purpose is to **display information about who is holding an order** (i.e., the person/user responsible for an order that is "held/suspended") and to provide functionality to **remove the order-hold code** if authorized. The code is heavily commented, and the field and variable names are predominantly in Norwegian.

---

## Header and Options

```rpg
h option(*nodebugio) datedit(*dmy)
```

- Disables debugging for I/O operations for performance.
- Sets date edit format to `day/month/year`.

---

## File Declarations

```rpg
ffohel1    if   e           k disk    rename(fohepfr:fohel1r)
fausrl1    if   e           k disk    rename(ausrpfr:ausrl1r)
fra09l1    if   e           k disk    rename(ra09pfr:ra09l1r)
ffusrl1    if   e           k disk    rename(fusrpfr:fusrl1r)
ffo711d    cf   e             workstn
```

- **fohel1:** Order header table (ordrehode).
- **ausrl1:** User table.
- **ra09l1:** Salesperson table.
- **fusrl1:** User table (possibly with additional security info).
- **fo711d:** Workstation display file.

---

## Local Data Area (LDA)

Variables mapped to the Local Data Area:
- `l_wsid`: Workstation ID.
- `l_user`: User.
- `l_firm`: Firm number.

---

## Parameter Definitions

Input parameters received by the program (e.g., order number, suffix, firm, and status).

---

## Key Variable Definitions

Variables used for table lookups (chain operations) in the various files.

---

## Main Data Variables

General working variables used for data manipulation, date/time, codes, and user IDs.

---

## Main Program Logic

### 1. Read Order Information

- Sets up keys and uses `CHAIN` to fetch order header info from `fohel1r`.
- Copies relevant fields (`fokous`, `fokows` etc.) into work variables for display.

### 2. Fetch Plukking ("Picking") Date/Time

- Sets code to `'2'` and calls external program `FU704R` to find when the order was sent for picking.
- If a valid result is returned (`w_svar = 'J'`), picking date/time and user are included.

### 3. Fetch User Information

- Looks up the user who put the order on hold (`fokous`) in the user table (`ausrl1r`).
- Fetches operator name (`abnavn`).

- Also looks up the operator (`fouser`) similarly.

### 4. Fetch Salesperson

- If a salesperson code (`foplse`) is present, retrieves their name from `ra09l1r`.

### 5. Display Logic

- If the hold code (`fokode`) is 0, the order is not held; the program exits.

- Otherwise, the workstation display format `x1bld` is shown (`exfmt x1bld`).

#### User Actions in Display

- **Cancel (`*inkc`):** Sets return status and exits to previous screen.
- **Remove Hold (`*inkh`):**
  - Checks user rights (`fbko03`). If not authorized, sets error indicator and redisplays.
  - If authorized, calls:
    - **FO412R:** Removes picking record and clears hold code.
    - **FO730R:** Recalculates order totals.

- After processing, returns to display until the user cancels or the hold is removed.

---

## Entry and Initialization Subroutine (*INZSR)

- Receives parameters: firm, order number, suffix, status.
- Sets up key lists used for file access.
- Initializes firm and order number from LDA and parameters.
- Checks if the user has rights to remove a hold code by looking up the user in `fusrl1r`. If not found, sets the right to zero (`fbko03 = 0`).

---

## Indicators

The program uses classic RPG indicators for:
- Program ending (`LR`).
- Field protection (`30`).
- Error/warning messages (`31–79`).
- Working indicators (`80–89`).
- File access operations (`90–99`).

---

## Subroutine Structure

Only one subroutine is defined (`*INZSR`) for program initialization and parameter setup.

---

## Summary of the Program Flow

1. **Initialization:** Read LDA and set up keys and rights.
2. **Order Info Fetch:** Pull order data, user, and picking info.
3. **Screen Display:** If order is held, show screen with details.
4. **User Actions:**
    - **Cancel:** Exit.
    - **Remove Hold:** If authorized, remove code and recalculate order.
5. **Exit:** Set LR and end.

---

## Key RPG Techniques Used

- **CHAIN** operations for indexed file access.
- Display file handling via `EXFMT`.
- External program calls for business logic.
- Use of indicators to control display and logic.
- Key lists (`KLIST`/`KFLD`) for composite keys.

---

## Norwegian Business Terms

- **Ordre-Hode:** Order header.
- **Plukking:** Picking (as in order picking).
- **Bruker:** User.
- **Selger:** Salesperson.
- **Sperrekode:** Hold/block code on orders.

---

## Typical Use Case

When an order in the system is "on hold" (possibly by a user or the system), this program is used to both display who set the hold and further details, and (if allowed) enable an authorized user to remove the hold, updating related order information accordingly.

---

## TL;DR

**FO711R** is a classic RPG program that lets users view and, if authorized, remove holds on orders, updating business data and recalculating order totals as needed, with extensive integration with related master files and external business logic programs.