     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : NO100R
      * Beskrivelse . . : Ekstern ordre-hode, vedlikehold
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       021002 HKO  Nytt program
5.10  *       260903 MHA  Legge til teller, endret Ref., fjernet dato i liste
      *       080506 HKO  Lagt inn funksjonstaster for å hente kundeordre
      *                   Lagt inn funksjonstaster for oppretting av kunde
      *                   og kundeprosjekt
      *
      * 6.10  250609 BSA  Oppdatert med sporingsinformasjon
6.11  * 6.10  120712 AMD  Det kom feil melding for avdeling
      *                   (dobbeltbruk av indikatorer)
6.20  * 6.20  271113 bsa  Vedlikehold og visning av leveringsmåte
6.21  *       190214 nho  Sjekker om post er låst med ordrenr *hival
      *                   i NO120R
6.nu  * R7.01 030614 bsa  Programmet gjennomgått mtp nummerutvidelser.
6.31  * 6.31  050716 HKO  Utvidet med lager ved kall av ND105R
6.32  * 7.01  150218 bsa  Ikke avbryt hvis firmakoden er forskjellig.
6.33  * 7.01  150218 bsa  Hvis kundenavnet er blankt oppdateres feltet
6.33  *                   når det legges inn kundenummer.
6.34  * 7.01  020719 bsa  Endret tabellstruktur
6.35  * 7.01  040719 bsa  Slette eksterne tabeller samtidig som NOHE/NODT
      *
7.xx  * 7.00  160216 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
7.0x  *       010318 bsa  Ny funksjonalitet for mer automatisk overførign av varer til ordre
7.01  *       040418 bsa  Hvis ordren er begynt overført, settes en midlertidig status.
7.02  *       050418 bsa  Tekstlinjer følger forrige linje.
7.03  *       080518 bsa  Må endres pr kunde. Varierer med feilmeldinger om
7.03  *                   når installering skjer.
7.04  * 7.00  150616 bsa  Sjekk også GTIN på innkommet EDI linje, hvis
7.04  *                   det finnes.
7.05  * 7.00  050719 bsa  Legger inn filter på type meldinger
7.06  * 7.00  050719 bsa  Ikke alle tester gjelder alle typer systemer.
7.07  * 7.00  120719 bsa  Spesialiteter rundt godkjenning av EDI bestillinger
7.08  * 7.00  160719 bsa  F-tast med link til systemoppsett
7.09  * 7.00  241019 bsa  Endre oppslag mot sletting av "skyggetabeller"
7.10  * 7.00  301019 bsa  Feil i sletting av skyggedetaljer
7.11  * 7.00  100419 ask  Lagt inn ekstra parameter (ordretype) i kall til ND105R
7.11  *                   for å overstyre kontroll mot lagervare på WIN
7.12  * 7.00  020120 bsa  Viser ikke ordre som er begynt overført.
7.13  * 7 00  150120 sst  fjerne leveringsdato fra rpvapf
7.14  * 7.00  020120 bsa  Rettelse ifbm scrolling
7.15  * 7 00  260819 sst  Kode i call for å legge ut bare en type filertil ND105R
7.15  *                   Overføre eksternordre til Prosjekt
7.15k * 7.00  200120 bsa  Hvis ikke ordren og varene finnes på EDHE/EDDT må de
7.15k *                   legges ut.
7.17  * 7.00  190320 bsa  Uheldig låsing hvis posten finnes i EDDT
7.18  * 7 00  230320 sst  Forhøyning av antall fra Smartkalk til RPVAPF
7.19  * 7 00  230320 sst  Omberengeng avhengig av salgsenhet 1 på varen
7.20  * 7 00  060520 sst  Justert avrunding vedr omberenging av antall
7.21  * K000  260520 bsa  Justert kode for overført.
7.22  * K000  190620 bsa  Hvis bestilling kommer elektronisk, skal den
7.22  *                   finnes på skygetabell. Ikke legg den ut på nytt.
7.23  * K000  080720 bsa  Feil i visning, siden alle varelinjer må være overført
7.23  * K000              for at den ikke skal vises.
7.24  * K000  080720 bsa  Leser ikke NOHEL2 ved oppstart, endre tabell
7.25  * K000  201120 ask  Utvidet parameter liste til FA930R pga. 1881 søk
7.26  * K000  171220 sst  Hoppe over '*SS' dersom ikke F16 er trykket
7.27  *K00    260321 sst  Tillate ukjente varer dersom ok fra NX
7.28  * K000  230821 bsa  Endret måten å sjekke på.
      *
8.01  * K000  061022 bsa  Når leveringsdato settes, endres også tilhørende linjer.
8.02  * K000  071022 bsa  Samme logikk som endring 8.01 når vi trykker valg 8.
8.02  * K000              Ordren vil bli splittet, hvis ikke alle linjer har
8.02  * K000              leveringsdato.
8.03  * K000  080523 bsa  Justert endring av leveringsdato på linjenivå.
8.04  * K000  011123 sst  Ikke tillate valg 6 dersom ikke prosjekt benyttes
8.05  * K000  291123 bsa  Switch styring om du henter eksternordre fra EDI
8.06  * 8.xx  190122 bsa  Legger ut leveringsbetingelse fra mottatt
8.06  * 8.xx              EDI bestilling.
8.07  *PRG2   160622 bsa  Utvidet prisgruppe fra 1 til 2 posisjoner
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = Avslutt program
      *       10 = Roll
      *       11 = Rolldown
      *       12 = Sfldsp
      *       13 = Sfldspctl
      *       14 = Sflclr
      *       15 = Sflend
      *       21 = Home-key
      *       22 = Plassering av cursor
      *       30 = Protect av felter ved vise
      *    31-79 = Varsle m/feilmeldinger/skjermindikatorer
      *    80-99 = Arbeidsindikatorer
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fnohel2    if   e           k disk    rename(nohepfr:nohel2r)
     fnohel3    if   e           k disk    rename(nohepfr:nohel3r)
     fnohel4    if   e           k disk    rename(nohepfr:nohel4r)
     fnohel5    if   e           k disk    rename(nohepfr:nohel5r)
     fnohel6    if   e           k disk    rename(nohepfr:nohel6r)
     fnohelr    if   e           k disk    rename(nohepfr:nohelrr)
7.0x fnohel1    if   e           k disk    rename(nohepfr:nohel1r)
7.15 fnohelu    uf a e           k disk    rename(nohepfr:nohelur)
     fnkeolr    if   e           k disk    rename(nkeopfr:nkeolrr)
     fvltpl1    if   e           k disk    rename(vltppfr:vltpl1r)
     fausrl1    if   e           k disk    rename(ausrpfr:ausrl1r)
     ffusrl1    if   e           k disk    rename(fusrpfr:fusrl1r)
     frkunl1    if   e           k disk    rename(rkunpfr:fkunl1r)
     ffkprl1    if   e           k disk    rename(fkprpfr:fkprl1r)
     fnodtlr    if   e           k disk    rename(nodtpfr:nodtlrr)
     fnodtlu    uf   e           k disk    rename(nodtpfr:nodtlur)
7.0x fnodtl1    if   e           k disk    rename(nodtpfr:nodtl1r)
7.0x f                                     prefix(xx:2)
7.01 feddtl1    if   e           k disk    rename(eddtpfr:eddtl1r)
6.35 feddtlu    uf a e           k disk    rename(eddtpfr:eddtlur)
7.0x feddtl3    if   e           k disk    rename(eddtpfr:eddtl3r)
7.0x fedhelu    uf a e           k disk    rename(edhepfr:edhelur)
7.0x fvlagl1    if   e           k disk    rename(vlagpfr:vlagl1r)
7.0x fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
7.09 fedhel4    uf   e           k disk    rename(edhepfr:edhel4r)
7.15 fvkhvl1    if   e           k disk    rename(vkhvpfr:vkhvl1r)
7.15 fvogrl1    if   e           k disk    rename(vogrpfr:vogrl1r)
7.15 fvhgrl1    if   e           k disk    rename(vhgrpfr:vhgrl1r)
7.15 fvugrl1    if   e           k disk    rename(vugrpfr:vugrl1r)
7.15 ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
7.15 frpvalu    uf a e           k disk    rename(rpvapfr:rpvalur)
7.15 frpval1    if   e           k disk    rename(rpvapfr:rpval1r)
7.15 f                                     prefix(rpx:3)
7.15 fvvenl1    if   e           k disk    rename(vvenpfr:vvenl1r)
7.19 fvvenl5    if   e           k disk    rename(vvenpfr:vvenl5r)
8.04 frp1pl1    if   e           k disk    rename(rp1ppfr:rp1pl1r)
8.06 fedh2l4    uf   e           k disk    rename(edh2pfr:edh2l4r)
8.06 fedh2l1    if   e           k disk    rename(edh2pfr:edh2l1r)
      *
     fno100d    cf   e             workstn sfile(b1sfl:w_srrn)
     f                                     infds(dspfbk)
7.0x  *
7.0x  * Definering av array
7.0x  *
7.0x d a_meld          s             50    dim(6) ctdata perrcd(1)
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
7.27 d l_filg                931    933
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av Information Data Structure - display feedback
      *
     d dspfbk          ds
     d  d_fcrn               378    379I 0
      *
      * Definering av variabler i nøkler
      *
     d nohel2_nref     s                   like(nonref)
     d nohel3_knav     s                   like(noknav)
     d nohel4_pnav     s                   like(nopnav)
     d nohel5_user     s                   like(nouser)
     d nohel6_fsys     s                   like(nofsys)
5.10 d nohelr_tell     s                   like(notell)
5.10 d nohelr_fsys     s                   like(nofsys)
7.0x d nohel1_tell     s                   like(notell)
7.0x d nohel1_fsys     s                   like(nofsys)
7.0x d vlagl1_lage     s                   like(vllage)
7.0x d vlagl1_vare     s                   like(vlvare)
7.0x d vvarl1_vare     s                   like(vvvare)
     d vltpl1_lety     s                   like(vylety)
     d ausrl1_user     s                   like(abuser)
     d fusrl1_user     s                   like(fbuser)
     d rkunl1_kund     s                   like(rkkund)
     d fkprl1_kund     s                   like(flkund)
     d fkprl1_kpro     s                   like(flkpro)
5.10 d nohelu_tell     s                   like(notell)
5.10 d nohelu_fsys     s                   like(nofsys)
5.10 d nodtlr_tell     s                   like(ndtell)
5.10 d nodtlr_fsys     s                   like(ndfsys)
5.10 d nodtlu_tell     s                   like(ndtell)
5.10 d nodtlu_fsys     s                   like(ndfsys)
5.10 d nkeolr_kode     s                   like(nkkode)
7.01 d eddtl1_tell     s                   like(edtell)
7.01 d eddtl1_fsys     s                   like(edfsys)
6.34 d eddtl1_ldor     s                   like(edldor)
6.34 d eddtl1_ldat     s                   like(edldat)
7.01 d eddtl1_line     s                   like(edline)
6.35 d edhelu_fsys     s                   like(eofsys)
6.35 d edhelu_tell     s                   like(eotell)
6.35 d edhelu_ldor     s                   like(eoldor)
6.35 d edhelu_ldat     s                   like(eoldat)
6.35 d eddtlu_tell     s                   like(edtell)
6.35 d eddtlu_fsys     s                   like(edfsys)
6.35 d eddtlu_ldor     s                   like(edldor)
6.35 d eddtlu_ldat     s                   like(edldat)
7.0x d eddtlu_line     s                   like(edline)
7.0x d nodtl1_tell     s                   like(ndtell)
7.0x d nodtl1_fsys     s                   like(ndfsys)
7.0x d eddtl3_tell     s                   like(edtell)
7.0x d eddtl3_fsys     s                   like(edfsys)
7.0x d eddtl3_line     s                   like(edline)
7.09 d edhel4_fsys     s                   like(eofsys)
7.09 d edhel4_tell     s                   like(eotell)
7.15 d vkhvl1_kkod     s                   like(vakkod)
7.15 d vkhvl1_klty     s                   like(vaklty)
7.15 d vkhvl1_koty     s                   like(vakoty)
7.15 d vogrl1_ogr      s                   like(vgoogr)
7.15 d vhgrl1_ogr      s                   like(vghogr)
7.15 d vhgrl1_hgr      s                   like(vghhgr)
7.15 d vugrl1_ogr      s                   like(vguogr)
7.15 d vugrl1_hgr      s                   like(vguhgr)
7.15 d vugrl1_ugr      s                   like(vguugr)
7.15 d rpval1_pros     s                   like(rpvpro)
7.15 d rpval1_upro     s                   like(rpvpro)
7.15 d rpval1_akti     s                   like(rpvpro)
7.15 d rpval1_vare     s                   like(rpvvar)
7.15 d rpval1_lass     s                   like(rpvlas)
7.15 d vvenl1_firm     s                   like(vefirm)
7.15 d vvenl1_vare     s                   like(vevare)
7.15 d vvenl1_enhe     s                   like(veenhe)
7.19 d vvenl5_firm     s                   like(vefirm)
7.19 d vvenl5_vare     s                   like(vevare)
7.19 d vvenl5_saen     s                   like(vesaen)
8.04 d rp1pl1_pros     s                   like(rp1pro)
8.06 d edh2l4_fsys     s                   like(e2fsys)
8.06 d edh2l4_tell     s                   like(e2tell)
8.06 d edh2l1_fsys     s                   like(e2fsys)
8.06 d edh2l1_tell     s                   like(e2tell)
8.06 d edh2l1_ldor     s                   like(e2ldor)
8.06 d edh2l1_ldat     s                   like(e2ldat)
      *
      * Definering av variable
      *
     d w_fcrn          s              4  0
     d w_stel          s              4  0
     d w_spge          s              4  0
     d w_srrn          s              4  0
     d w_sfrn          s                   like(w_srrn)
     d w_ssrn          s                   like(w_srrn)
     d w_seqe          s              1
      *
     d b_oppr          s              1    inz(*off)
     d b_forn          s              1    inz(*off)
     d b_anul          s              1    inz(*off)
     d b_feil          s              1    inz(*off)
7.0x d b_stop          s              1    inz(*off)
7.0x d b_show          s              1    inz(*off)
7.0x d b_alle          s              1    inz(*off)
7.02 d b_stext         s              1    inz(*off)
7.02 d b_ltext         s              1    inz(*off)
8.05 d b_edi           s              1    inz(*off)
      *
     d w_stat          s              1  0
     d w_retu          s              1
     d w_ltxt          s             20
7.25 d w_tlfn          s             11
     d w_ldat          s               d   datfmt(*iso)
     d w_udat          s               d   datfmt(*iso)
      *
     d w_firm          s                   like(nofirm)
     d w_ttxt          s                   like(vybesk)
     d w_kna2          s                   like(rknavn)
     d w_pna2          s                   like(flnavn)
     d w_adr1          s                   like(rkgate)
     d w_adr2          s                   like(rkadr2)
     d w_sted          s                   like(rksted)
     d w_pad1          s                   like(fladr1)
     d w_pad2          s                   like(fladr2)
     d w_avde          s              4  0
7.0x d w_mld1          s             50
7.0x d w_mld2          s             50
7.0x d w_vsta          s              1  0
7.0x d w_ldor          s                   like(eoldor)
7.02 d x_ldor          s                   like(eoldor)
7.0x d w_in03          s              1
7.01 d w_alin          s              5  0
7.01 d w_olin          s              5  0
7.03 d w_dato          s              6  0
7.03 d w_date          s                   like(noodat)
7.04 d w_gtin          s                   like(edgtin)
7.04 d w_gvar          s                   like(ndvare)
7.04 d w_genh          s                   like(ndenhe)
7.04 d w_gsts          s              1
7.08 d w_nsys          s              3
8.01 d w_type          s              4
8.05 d w_hent          s              1
8.05 d w_con1          c                   '*** EDI innhenting pågår *** '
8.05 d w_con2          c                   'Vent og prøv igjen senere.   '
8.05 d w_ctl1          s              2  0
8.05 d w_ctpo          s              3  0
8.05 d w_mldc1         s             30
8.05 d w_mldc2         s             30
8.05 d w_cmd           s            256
8.05 d w_len           s             15  5
8.05 d w_jsta          s              2  0
8.05 d w_onof          s              1  0
      *
     d w_ovfprg        s                   like(nkpgmc)
7.15 d w_omr1          s                   like(veomre)
7.15 d w_omr2          s                   like(veomre)
7.18 d w_ant           s             11  3
7.20 d w_just          s              5  3 inz(,49)
     d w_kund_kopi     s                   like(flkund)
     d w_kpro_kopi     s                   like(flkpro)
7.15 d w_ms1           s             50
7.15 d w_ms2           s             50
7.15 d w_svar          s              1
7.15 d w_in12          s              1  0
      *
8.01 d s_ldat          s               d   datfmt(*iso)
8.01 d l_ldat          s               d   datfmt(*iso)
8.01 d c_ldat          s               d   datfmt(*iso)
      *
7.15 d p_kode          s              3
7.15 d p_pros          s                   like(rpvpro)
7.15 d p_upro          s                   like(rpvupr)
7.15 d p_akti          s                   like(rpvakt)
7.15 d p_kpro          s                   like(rpvprk)
7.15 d p_firm          s                   like(w_firm)
7.15 d p_vare          s                   like(vvvare)
8.07 d p_prgr          s              2
7.15 d p_enhe          s                   like(vvenhe)
7.15 d p_lety          s                   like(vylety)
7.15 d p_dato          s                   like(rpvoda)
7.15 d p_time          s               t   timfmt(*iso)
7.15 d p_sapr          s                   like(ndkpri)
7.15 d p_bupr          s                   like(ndkpri)
7.15 d p_tpri          s                   like(ndkpri)
7.15 d p_kopr          s                   like(ndkpri)
7.15 d p_inlr          s              1
8.05 d p_stat          s              1
      *
      * Definering av konstanter
      *
7.08 d c_sfil          s              2  0 inz(12)
      *
7.27  *
7.27  * Eksternt program
7.27   dcl-s co402_verdi1  char(1);
7.27   dcl-s co402_verdi2  char(2048);
7.27   DCL-PR CO402R EXTPGM('CO402R');
7.27     p_filgrp            char(3)     const;
7.27     p_firm              packed(3:0) const;
7.27     p_lager             packed(2:0) const;
7.27     p_nokkel            char(50)    const;
7.27     p_verdi1            char(1);
7.27     p_verdi2            char(2048);
7.27   END-PR;
7.27 d ukjent_vare_ok  s              1    inz(*off)
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      * w_fcrn - Første recordnummer på siden
      * w_stel - Subfile-teller
      * w_spge - Sidestørrelse i subfile (page)
      * w_srrn - Relativt recordnummer i subfile
      * w_sfrn - Første recordnummer på siste side
      * w_ssrn - Siste recordnummer på siste side
      * w_curn - Current recordnummer på siden
      * w_virn - Side og cursorplassering som skal vises
      * w_afld - Aktivt feltnavn
      * w_arow - Aktiv rad for cursor
      * w_acol - Aktiv kolonne for cursor
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      * B1SFL  - B1 Subfile - record
      * B2CTL  - B2 Subfile - control record
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      * C2BLD  - C2 Skjermbilde for opprette/endre/vise
      * D1WIN  - D1 Vindu for slette (Delete)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B2CTL Behandle åpningsbildet med subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Send Alt
      *
     c     b2taga        tag
      *
     c                   write     b2cmd
      *
      * Bare data
      *
     c     b2tagb        tag
      *
     c                   exsr      dsp_subfile
      *
      * Behandling av funksjonstaster
      *
     c                   select
7.05 c                   when      *inka
7.05 c                   exsr      xh1win
7.05 c                   exsr      forny
7.05 c                   goto      b2taga
     c                   when      *inkc or *inkl
     c                   goto      avslutt
     c                   when      *inke
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *in10
     c                   exsr      crt_subfile
     c                   goto      b2tagb
     c                   when      *in11
     c                   exsr      bck_subfile
     c                   goto      b2tagb
     c                   when      *in21
     c                   eval      *in22 = *on
     c                   goto      b2taga
     c                   endsl
      *
      * F13=Statuskoder
      *
     c                   if        *inkm
     c                   call      'NO110R'
     c                   goto      b2tagb
     c                   endif
      *
      * F14=Hent kundeordre
      *
     c                   if        *inkn
8.05 c                   if        b_edi = *off
     c                   call      'NO150R'
8.05 c                   else
8.05 c                   exsr      hent_meld
8.05 c                   if        w_hent <> *blanks
8.05 c                   goto      b2taga
8.05 c                   endif
8.05 c                   endif
     c                   exsr      forny
     c                   goto      b2tagb
     c                   endif
7.08  *
7.08  * F15=Systemoppsett
7.08  *
7.08 c                   if        *inkp
7.08 c                   eval      w_nsys = *blanks
7.08 c                   call      'AD100R'
7.08 c                   parm                    w_nsys
7.08 c                   exsr      forny
7.08 c                   goto      b2tagb
7.08 c                   endif
7.15  *
7.15  * F16=Vise slettede 'Ordre' ved SMK  (Smartkalk)
7.15  *
7.15 c                   if        *inkq
7.15 c                   eval      p_kode = '*SS'
7.15 c                   exsr      forny
7.15 c                   goto      b2tagb
7.15 c                   endif
      *
      * Posisjonering
      *
5.10 c                   if        b2fsys <> *blank or
5.10 c                             b2nref <> *blank or
     c                             b2knav <> *blank or
     c                             b2pnav <> *blank or
     c                             b2user <> *blank
     c                   exsr      posisjoner
     c                   goto      b2tagb
     c                   endif
      *
      * Behandling av subfile
      *
     c                   exsr      subfile
      *
     c                   goto      b2taga
      *
      * Avslutt program
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for fornying av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     forny         begsr
      *
     c                   if        w_fcrn <> 0
     c     w_fcrn        chain     b1sfl
     c                   endif
      *
     c                   select
     c                   when      w_seqe = 'R'
     c                   eval      nohel2_nref = b1nref
     c     nohel2_key    setll     nohel2
     c                   when      w_seqe = 'K'
     c                   eval      nohel3_knav = b1knav
     c     nohel3_key    setll     nohel3
     c                   when      w_seqe = 'P'
     c                   eval      nohel4_pnav = b1pnav
     c     nohel4_key    setll     nohel4
     c                   when      w_seqe = 'U'
     c                   eval      nohel5_user = b1user
     c     nohel5_key    setll     nohel5
     c                   other
     c                   eval      nohel6_fsys = b1fsys
     c     nohel6_key    setll     nohel6
     c                   endsl
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for posisjonering i subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     posisjoner    begsr
      *
      * System
      *
5.10 c                   if        b2fsys <> *blank
     c                   eval      w_seqe = *blank
     c                   eval      nohel6_fsys = b2fsys
     c     nohel6_key    setll     nohel6
     c                   goto      end_pos
     c                   endif
      *
      * Referanse
      *
5.10 c                   if        b2nref <> *blank
     c                   eval      w_seqe = 'R'
     c                   eval      nohel2_nref = b2nref
     c     nohel2_key    setll     nohel2
     c                   goto      end_pos
     c                   endif
      *
      * Kundenavn
      *
     c                   if        b2knav <> *blank
     c                   eval      w_seqe = 'K'
     c                   eval      nohel3_knav = b2knav
     c     nohel3_key    setll     nohel3
     c                   goto      end_pos
     c                   endif
      *
      * Kundeprosjektnavn
      *
     c                   if        b2pnav <> *blank
     c                   eval      w_seqe = 'P'
     c                   eval      nohel4_pnav = b2pnav
     c     nohel4_key    setll     nohel4
     c                   goto      end_pos
     c                   endif
      *
      * Bruker-id
      *
     c                   if        b2user <> *blank
     c                   eval      w_seqe = 'U'
     c                   eval      nohel5_user = b2user
     c     nohel5_key    setll     nohel5
     c                   goto      end_pos
     c                   endif
      *
     c     end_pos       tag
      *
      * Blanker subfile, og fyller opp i.h.t. posisjonering
      *
     c                   eval      *in22 = *off
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
      * Blanker posisjoneringsfelter
      *
5.10 c                   eval      b2fsys = *blank
5.10 c                   eval      b2nref = *blank
     c                   eval      b2knav = *blank
     c                   eval      b2pnav = *blank
     c                   eval      b2user = *blank
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     subfile       begsr
      *
     c                   eval      b_forn = *off
      *
     c                   if        *in22 = *off
     c                   eval      *in22 = *on
     c                   else
     c                   eval      *in22 = *off
     c                   endif
      *
     c                   eval      w_virn = w_fcrn
      *
      * Leser og behandler subfile
      *
     c                   do        w_ssrn
     c                   readc     b1sfl
      *
     c                   if        %eof
     c                   leave
     c                   endif
      *
     c                   eval      *in22 = *off
     c                   eval      w_virn = w_srrn
      *
      * Endre
      *
     c                   if        b1valg = 2
     c                   eval      c2nref = b1nref
     c                   exsr      xc2bld
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Slett
      *
     c                   if        b1valg = 4
     c                   eval      d1nref = b1nref
     c                   exsr      xd1win
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Vis
      *
     c                   if        b1valg = 5
     c                   eval      c2nref = b1nref
     c                   exsr      xc2bld
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
7.15  *
7.15  * Overfør til Prosjekt
7.15  *
7.15 c                   if        b1valg = 6
8.04  *  Kjører dette firma prosjekt?
8.04 c                   eval      rp1pl1_pros = *blank
8.04 c     rp1pl1_key    setll     rp1pl1
8.04 c                   read      rp1pl1
8.04 c                   if        %eof(rp1pl1)
8.04 c                   eval      w_ms1 = 'Valget er ikke gyldig for dere'
8.04 c                   eval      w_ms2 = 'Kun for de som kjører Prosjekt'
8.04 c                   eval      w_svar = 'J'
8.04 c                   eval      w_in12 = 0
8.04 c                   call      'AA007R'
8.04 c                   parm                    w_ms1
8.04 c                   parm                    w_ms2
8.04 c                   parm                    w_svar
8.04 c                   parm                    w_in12
8.04 c                   else
7.15 c                   exsr      ovf_Prosj
8.04 c                   endif
7.15 c*                  if        b1stat <> 0
7.15 c*                  eval      *in60 = *on
7.15 c*                  endif
7.15 c                   eval      b1valg = 0
7.15 c                   update    b1sfl
7.15 c                   iter
7.15 c                   endif
      *
      * Vedlikehold av ekstern ordre-linje
      *
     c                   if        b1valg = 7
     c                   exsr      ordre_linje
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Overfør til ordre
      *
     c                   if        b1valg = 8
     c                   exsr      ovf_ordre
     c                   if        b1stat <> 0
     c                   eval      *in60 = *on
     c                   endif
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Melding
      *
     c                   if        b1valg = 9
     c                   call      'NO101R'
     c                   parm                    w_firm
     c                   parm                    b1fsys
     c                   parm                    b1tell
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
7.0x  *
7.0x  * 10 = Overføring av lagervarer
7.0x  *
7.0x c                   if        b1valg = 10
7.0x  * Ordren er allerede overført
7.0x c                   if        b1over = 1
7.0x c                   eval      w_mld1 = a_meld(6)
7.0x c                   call      'AA005R'
7.0x c                   parm                    w_mld1
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.03  * Ordren er allerede overført - varierer for hver kunde
7.03 c                   eval      nohel1_fsys = b1fsys
7.03 c                   eval      nohel1_tell = b1tell
7.03 c     nohel1_key    chain     nohel1
7.03 c                   if        %found and
7.03 c                             noedat < w_date
7.03 c                   eval      w_mld1 = a_meld(6)
7.03 c                   call      'AA005R'
7.03 c                   parm                    w_mld1
7.03 c                   eval      b1valg = 0
7.03 c                   update    b1sfl
7.03 c                   iter
7.03 c                   endif
7.0x  * Er det riktig type ?
7.0x c                   if        b1fsys = 'EDI' or
7.0x c                             b1fsys = 'SMK' or
7.0x c                             b1fsys = 'EHF'
7.0x c                   eval      w_mld1 = a_meld(5)
7.0x c                   call      'AA005R'
7.0x c                   parm                    w_mld1
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.0x  * Må rette opp i statuser
7.0x c                   if        b1stat <> 9 and
7.0x c                             b1stat <> 0
7.0x c                   eval      w_mld1 = a_meld(4)
7.0x c                   call      'AA005R'
7.0x c                   parm                    w_mld1
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.0x c                   endif
7.0x  * Sjekk videre
7.0x c                   if        b1valg = 10
7.0x  * Finnes det lagervarer på ordren ?
7.0x c                   exsr      xsjekk_lager
7.0x c                   if        b_stop = *on
7.0x c                   eval      w_mld1 = a_meld(1)
7.0x c                   call      'AA005R'
7.0x c                   parm                    w_mld1
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.0x c                   endif
7.0x  *
7.0x c                   if        b1valg = 10
7.0x c                   exsr      overf_varer
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.0x  *
7.0x  * 11 = Overføring av skaffevarer
7.0x  *
7.0x c                   if        b1valg = 11
7.0x  * Ordren er allerede overført
7.0x c                   if        b1over = 1
7.0x c                   eval      w_mld1 = a_meld(6)
7.0x c                   call      'AA005R'
7.0x c                   parm                    w_mld1
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.03  * Ordren er allerede overført - varierer for hver kunde
7.03 c                   eval      nohel1_fsys = b1fsys
7.03 c                   eval      nohel1_tell = b1tell
7.03 c     nohel1_key    chain     nohel1
7.03 c                   if        %found and
7.03 c                             noedat < w_date
7.03 c                   eval      w_mld1 = a_meld(6)
7.03 c                   call      'AA005R'
7.03 c                   parm                    w_mld1
7.03 c                   eval      b1valg = 0
7.03 c                   update    b1sfl
7.03 c                   iter
7.03 c                   endif
7.0x  * Er det riktig type ?
7.0x c                   if        b1fsys = 'EDI' or
7.0x c                             b1fsys = 'SMK' or
7.0x c                             b1fsys = 'EHF'
7.0x c                   eval      w_mld1 = a_meld(5)
7.0x c                   call      'AA005R'
7.0x c                   parm                    w_mld1
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.0x  * Må rette opp i statuser
7.0x c                   if        b1stat <> 9 and
7.0x c                             b1stat <> 0
7.0x c                   eval      w_mld1 = a_meld(4)
7.0x c                   call      'AA005R'
7.0x c                   parm                    w_mld1
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.0x c                   endif
7.0x  * Sjekk videre
7.0x c                   if        b1valg = 11
7.0x  * Finnes det skaffevarer på ordren ?
7.0x c                   exsr      xsjekk_skaff
7.0x c                   if        b_stop = *on
7.0x c                   eval      w_mld1 = a_meld(2)
7.0x c                   call      'AA005R'
7.0x c                   parm                    w_mld1
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.0x c                   endif
7.0x  *
7.0x c                   if        b1valg = 11
7.0x c                   exsr      overf_varer
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.0x  *
7.0x  * 12 = manuell utplukk for overføring
7.0x  *
7.0x c                   if        b1valg = 12
7.0x  * Ordren er allerede overført
7.0x c                   if        b1over = 1
7.0x c                   eval      w_mld1 = a_meld(6)
7.0x c                   call      'AA005R'
7.0x c                   parm                    w_mld1
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.03  * Ordren er allerede overført - varierer for hver kunde
7.03 c                   eval      nohel1_fsys = b1fsys
7.03 c                   eval      nohel1_tell = b1tell
7.03 c     nohel1_key    chain     nohel1
7.03 c                   if        %found and
7.03 c                             noedat < w_date
7.03 c                   eval      w_mld1 = a_meld(6)
7.03 c                   call      'AA005R'
7.03 c                   parm                    w_mld1
7.03 c                   eval      b1valg = 0
7.03 c                   update    b1sfl
7.03 c                   iter
7.03 c                   endif
7.0x  * Er det riktig type ?
7.0x c                   if        b1fsys = 'EDI' or
7.0x c                             b1fsys = 'SMK' or
7.0x c                             b1fsys = 'EHF'
7.0x c                   eval      w_mld1 = a_meld(5)
7.0x c                   call      'AA005R'
7.0x c                   parm                    w_mld1
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.0x  * Er det feilkoder som gjør at vi ikke kan gå videre ?
7.0x c                   if        b1stat <> 9 and
7.0x c                             b1stat <> 0
7.0x c                   eval      w_mld1 = a_meld(4)
7.0x c                   call      'AA005R'
7.0x c                   parm                    w_mld1
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.0x c                   endif
7.0x  *
7.0x c                   if        b1valg = 12
7.0x c                   exsr      overf_linje
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
7.0x  *
7.0x  * Vis sammenhengen mellom referanse og ordre
7.0x  *
7.0x c                   if        b1valg = 15
7.0x c                   exsr      vis_ref
7.0x c                   eval      b1valg = 0
7.0x c                   update    b1sfl
7.0x c                   iter
7.0x c                   endif
      *
     c                   enddo
7.0x  *
7.0x  * F09=Vis alle linjer - skru på og av
7.0x  *
7.0x c                   if        *inki
7.0x c                   if        b_alle = *on
7.0x c                   eval      b_alle = *off
7.0x c                   else
7.0x c                   eval      b_alle = *on
7.0x c                   endif
7.0x c                   eval      b_forn = *on
7.0x c                   endif
      *
     c                   if        b_forn = *on
     c                   exsr      forny
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å behandle bilde for ny/endring/vise (C2BLD)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xc2bld        begsr
      *
     c                   eval      w_arow = 0
     c                   eval      w_acol = 0
      *
5.10 c                   eval      nohelr_tell = b1tell
5.10 c                   eval      nohelr_fsys = b1fsys
     c     nohelr_key    chain     nohelr
     c                   if        not %found
     c                   goto      end_c2bld
     c                   endif
      *
     c                   eval      nkeolr_kode = b1fsys
     c     nkeolr_key    chain     nkeolr
     c                   if        not %found
     c                   goto      end_c2bld
     c                   endif
      *
      * Initierer bildet
      *
     c                   eval      c2knav = noknav
     c                   eval      c2pnav = nopnav
     c                   eval      c2avde = noavde
     c                   eval      c2lage = nolage
     c                   eval      c2ltxt = *blank
     c                   eval      c2lety = nolety
     c                   eval      c2ttxt = *blank
     c                   eval      c2user = nouser
     c                   eval      c2utxt = *blank
     c                   eval      c2kund = nokund
     c                   eval      c2kna2 = *blank
     c                   eval      c2kpro = nokpro
     c                   eval      c2pna2 = *blank
     c                   eval      c2ldat = 0
     c                   eval      c2pnav = nopnav
     c                   eval      c2dref = nodref
     c                   eval      c2rekv = norekv
     c                   eval      c2navn = nonavn
     c                   eval      c2adr1 = noadr1
     c                   eval      c2adr2 = noadr2
     c                   eval      c2ponr = noponr
     c                   eval      c2sted = nosted
     c                   eval      c2unav = nounav
     c                   eval      c2utlf = noutlf
     c                   eval      c2umob = noumob
     c                   eval      c2ufax = noufax
     c                   eval      c2umai = noumai
     c                   eval      c2eusr = noeusr
6.20 c                   eval      c2lmat = nolmat
8.01 c                   eval      s_ldat = noldat
      *
     c     *dmy          move      noodat        c2odat
     c     *hms          move      nootim        c2otim
     c     *dmy          move      noedat        c2edat
      *
     c                   if        noldat <> *loval
     c     *dmy          move      noldat        c2ldat
     c                   endif
      *
     c                   if        c2avde <> 0
     c                   eval      w_avde = c2avde
     c                   call      'RS707R'
     c                   parm                    w_retu
     c                   parm                    w_avde
     c                   parm                    w_ltxt
     c                   eval      c2atxt = w_ltxt
     c                   endif
      *
     c                   if        c2lage <> 0
     c                   call      'RS710R'
     c                   parm                    w_retu
     c                   parm                    c2lage
     c                   parm                    w_ltxt
     c                   eval      c2ltxt = w_ltxt
     c                   endif
      *
     c                   eval      vltpl1_lety = c2lety
     c     vltpl1_key    chain     vltpl1
     c                   if        %found
     c                   eval      c2ttxt = vybesk
     c                   endif
      *
     c                   if        c2user <> *blank
     c                   eval      ausrl1_user = c2user
     c     ausrl1_key    chain     ausrl1
     c                   if        %found
     c                   eval      c2utxt = abnavn
     c                   endif
     c                   endif
      *
     c                   if        c2kund <> 0
     c                   eval      rkunl1_kund = c2kund
     c     rkunl1_key    chain     rkunl1
     c                   if        %found
     c                   eval      c2kna2 = rknavn
     c                   endif
     c                   endif
      *
     c                   if        c2kpro <> 0
     c                   eval      fkprl1_kund = c2kund
     c                   eval      fkprl1_kpro = c2kpro
     c     fkprl1_key    chain     fkprl1
     c                   if        %found
     c                   eval      c2pna2 = flnavn
     c                   endif
     c                   endif
6.20  * Forsendelsesmåte
6.20 c                   if        c2lmat <> 0
6.20 c                   eval      w_retu = *blanks
6.20 c                   eval      c2mtxt = *blanks
6.20 c                   call      'RS717R'
6.20 c                   parm                    w_retu
6.20 c                   parm                    c2lmat
6.20 c                   parm                    c2mtxt
6.20 c                   endif
      *
     c                   if        b1valg = 5
     c                   eval      *in30 = *on
     c                   endif
      *
      * Viser først melding dersom det er melding på hode
      *
     c                   if        nomeld <> *blank
     c                   call      'NO101R'
     c                   parm                    w_firm
     c                   parm                    b1fsys
     c                   parm                    b1tell
     c                   endif
8.06  *
8.06  * Sjekk om det finnes info om leveringsbetingelse fra EDI bestilling
8.06  * Kun om bestillingen har kommet elektronisk
8.06  *
8.06 c                   eval      c2elbe = *blanks
8.06 c                   if        b1fsys = 'EDI' or
8.06 c                             b1fsys = 'SMK' or
8.06 c                             b1fsys = 'EHF'
8.06 c                   eval      edh2l1_fsys = b1fsys
8.06 c                   eval      edh2l1_tell = b1tell
8.06 c                   eval      edh2l1_ldat = *loval
8.06 c                   eval      edh2l1_ldor = 0
8.06 c     edh2l1_key    chain     edh2l1
8.06 c                   if        %found
8.06 c                   eval      c2elbe = %trim(e2lbex)
8.06 c                   endif
8.06 c                   endif
      *
     c     c2taga        tag
      *
     c                   exfmt     c2bld
      *
     c                   if        *inkc or *inkl or *in30
     c                   goto      end_c2bld
     c                   endif
      *
      * F4=Spørring
      *
     c                   if        *inkd
      *
     c                   if        w_afld = 'C2AVDE'
     c                   call      'RA507R'
     c                   parm                    w_firm
     c                   parm                    w_avde
     c                   parm                    w_ltxt
     c                   eval      c2atxt = w_ltxt
     c                   eval      c2avde = w_avde
     c                   goto      c2taga
     c                   endif
      *
     c                   if        w_afld = 'C2LAGE'
     c                   call      'RA510R'
     c                   parm                    w_firm
     c                   parm                    c2lage
     c                   parm                    w_ltxt
     c                   eval      c2ltxt = w_ltxt
     c                   goto      c2taga
     c                   endif
      *
     c                   if        w_afld = 'C2LETY'
     c                   call      'VY500R'
     c                   parm                    w_firm
     c                   parm                    c2lety
     c                   parm                    w_ttxt
     c                   eval      c2ttxt = w_ttxt
     c                   goto      c2taga
     c                   endif
      *
     c                   if        w_afld = 'C2KUND'
     c                   call      'RK500R'
     c                   parm                    w_firm
     c                   parm                    c2kund
     c                   parm                    w_kna2
     c                   eval      c2kna2 = w_kna2
     c**                 if        c2kund <> 0 and
     c**                           c2navn = *blank and
     c**                           c2adr1 = *blank and
     c**                           c2adr2 = *blank and
     c**                           c2ponr = *blank and
     c**                           c2sted = *blank
     c**                 eval      rkunl1_kund = c2kund
     c**   rkunl1_key    chain     rkunl1
     c**                 if        %found
     c**                 eval      c2navn = rknavn
     c**                 eval      c2adr1 = rkgate
     c**                 eval      c2adr2 = rkadr2
     c**                 eval      c2sted = rksted
     c**                 endif
     c**                 endif
     c                   goto      c2taga
     c                   endif
      *
     c                   if        w_afld = 'C2KPRO'
     c                   call      'FL500R'
     c                   parm                    w_firm
     c                   parm                    c2kund
     c                   parm                    c2kpro
     c                   parm                    w_kna2
     c                   parm                    w_pna2
     c                   eval      c2kna2 = w_kna2
     c                   eval      c2pna2 = w_pna2
     c                   goto      c2taga
     c                   endif
6.20  *
6.20 c                   if        w_afld = 'C2LMAT'
6.20 c                   call      'RA517R'
6.20 c                   parm                    w_firm
6.20 c                   parm                    c2lmat
6.20 c                   parm                    c2mtxt
6.20 c                   goto      c2taga
6.20 c                   endif
      *
     c                   goto      c2taga
      *
     c                   endif
      *
      * F6=Opprett ny kunde
      *
     c                   if        *inkf = *on
      *
     c                   eval      fusrl1_user = l_user
     c     fusrl1_key    chain     fusrl1
     c                   if        not %found or
5.20 c                             fbko12 <> 1
     c                   eval      *in50 = *on
     c                   goto      c2taga
5.20 c                   endif
      *
     c                   exsr      oppr_kunde
     c                   goto      c2taga
      *
     c                   endif
      *
      * F7=Opprett kundeprosjekt
      *
     c                   if        *inkg = *on
     c                   exsr      oppr_kundepro
     c                   goto      c2taga
     c                   endif
      *
      * F14=Melding
      *
     c                   if        *inkn
     c                   call      'NO101R'
     c                   parm                    w_firm
     c                   parm                    b1fsys
     c                   parm                    b1tell
     c                   goto      c2taga
     c                   endif
      *
      * Validering av input
      *
     c                   if        c2avde <> 0
     c                   eval      w_avde = c2avde
     c                   call      'RS707R'
     c                   parm                    w_retu
     c                   parm                    w_avde
     c                   parm                    w_ltxt
     c                   if        w_retu <> *blank
6.11 c                   eval      *in40 = *on
     c                   goto      c2taga
     c                   endif
     c                   eval      c2atxt = w_ltxt
     c                   endif
      *
     c                   if        c2lage <> 0
     c                   call      'RS710R'
     c                   parm                    w_retu
     c                   parm                    c2lage
     c                   parm                    w_ltxt
     c                   if        w_retu <> *blank
     c                   eval      *in31 = *on
     c                   goto      c2taga
     c                   endif
     c                   eval      c2ltxt = w_ltxt
     c                   endif
6.20  *
6.20 c                   if        c2lmat <> 0
6.20 c                   eval      c2mtxt = *blanks
6.20 c                   call      'RS717R'
6.20 c                   parm                    w_retu
6.20 c                   parm                    c2lmat
6.20 c                   parm                    c2mtxt
6.20 c                   if        w_retu <> *blank
6.20 c                   eval      *in41 = *on
6.20 c                   goto      c2taga
6.20 c                   endif
6.20 c                   endif
      *
     c                   if        c2lety <> 0
     c                   eval      vltpl1_lety = c2lety
     c     vltpl1_key    chain     vltpl1
     c                   if        not %found
     c                   eval      *in32 = *on
     c                   goto      c2taga
     c                   endif
     c                   eval      c2ttxt = vybesk
     c                   endif
      *
     c                   if        c2user <> *blank
      *
     c                   eval      ausrl1_user = c2user
     c     ausrl1_key    chain     ausrl1
     c                   if        not %found
     c                   eval      *in33 = *on
     c                   goto      c2taga
     c                   endif
      *
     c                   eval      fusrl1_user = l_user
     c     fusrl1_key    chain     fusrl1
     c                   if        not %found or
     c                             fbko10 = 0
     c                   eval      *in34 = *on
     c                   goto      c2taga
     c                   endif
      *
     c                   eval      c2utxt = abnavn
     c                   endif
      *
     c                   if        c2kund = 0
     c                   eval      *in35 = *on
     c                   goto      c2taga
     c                   endif
      *
     c                   eval      rkunl1_kund = c2kund
     c     rkunl1_key    chain     rkunl1
     c                   if        not %found
     c                   eval      *in36 = *on
     c                   goto      c2taga
     c                   endif
     c                   eval      c2kna2 = rknavn
      *
     c                   if        c2kpro <> 0
     c                   eval      fkprl1_kund = c2kund
     c                   eval      fkprl1_kpro = c2kpro
     c     fkprl1_key    chain     fkprl1
     c                   if        not %found
     c                   eval      *in37 = *on
     c                   goto      c2taga
     c                   endif
     c                   eval      c2pna2 = flnavn
     c                   endif
      *
     c                   if        c2ldat <> 0
      *
     c     *dmy          test(d)                 c2ldat                 38
     c                   if        *in38 = *on
     c                   goto      c2taga
     c                   endif
      *
     c                   time                    w_udat
     c     *dmy          move      c2ldat        w_ldat
     c                   if        w_ldat < w_udat
     c                   eval      *in39 = *on
     c                   goto      c2taga
     c                   endif
      *
     c                   endif
      *
      * Oppdatering av ekstern ordre-hode
      *
     c                   clear                   nohelur
      *
     c                   eval      nohelu_tell = b1tell
     c                   eval      nohelu_fsys = b1fsys
     c     nohelu_key    chain     nohelur
      *
6.33 c                   if        noknav = *blanks
6.33 c                   eval      noknav = c2kna2
6.33 c                   endif
     c                   eval      noavde = c2avde
     c                   eval      nolage = c2lage
     c                   eval      nouser = c2user
     c                   eval      nokund = c2kund
     c                   eval      nokpro = c2kpro
     c                   eval      nonavn = c2navn
     c                   eval      noadr1 = c2adr1
     c                   eval      noadr2 = c2adr2
     c                   eval      noponr = c2ponr
     c                   eval      nosted = c2sted
     c                   eval      nolety = c2lety
     c                   eval      noldat = *loval
     c                   eval      nodref = c2dref
     c                   eval      norekv = c2rekv
6.20 c                   eval      nolmat = c2lmat
     c                   eval      noeusr = l_user
      *
     c                   time                    noedat
     c                   time                    noetim
      *
     c                   if        c2ldat <> 0
     c     *dmy          move      c2ldat        noldat
     c                   endif
      *
     c                   if        %found(nohelu)
6.10 c                   time                    noedat
6.10 c                   time                    noetim
6.10 c                   eval      noeusr = l_user
     c                   update    nohelur
8.01  *
8.01  * Ta en runde og oppdater tilhørende linjer
8.01  *
8.01 c                   if        noldat <> *loval
8.01 c                   eval      nodtlu_tell = nohelu_tell
8.01 c                   eval      nodtlu_fsys = nohelu_fsys
8.01 c     nodtlu_key    setll     nodtlu
8.01 c     nodtlu_key    reade     nodtlur
8.01 c                   dow       not %eof
8.01 c                   eval      c_ldat = *loval
8.01 c                   if        %trim(ndvare) <> *blanks
8.01 c                   eval      l_ldat = ndldat
8.01 c                   endif
8.01  *
8.01 c                   if        %trim(ndvare) = *blanks and
8.01 c                             ndldat = *loval and
8.01 c                             l_ldat = *loval
8.01 c                   eval      c_ldat = noldat
8.01 c                   elseif    %trim(ndvare) = *blanks and
8.01 c                             ndldat = *loval and
8.01 c                             l_ldat = s_ldat
8.01 c                   eval      c_ldat = noldat
8.01 c                   elseif    %trim(ndvare) = *blanks and
8.01 c                             ndldat = *loval and
8.01 c                             l_ldat <> *loval and
8.01 c                             l_ldat <> s_ldat
8.01 c                   eval      c_ldat = l_ldat
8.01 c                   elseif    %trim(ndvare) = *blanks and
8.01 c                             ndldat = s_ldat
8.01 c                   eval      c_ldat = noldat
8.01 c                   endif
8.01  *
8.01 c                   if        %trim(ndvare) <> *blanks and
8.01 c                             ndldat = s_ldat
8.01 c                   eval      c_ldat = noldat
8.01 c                   elseif    %trim(ndvare) <> *blanks and
8.03 c                             ndldat <> s_ldat and
8.03 c                             ndldat <> *loval
8.01 c                   eval      c_ldat = ndldat
8.03 c                   elseif    %trim(ndvare) <> *blanks and
8.03 c                             ndldat <> s_ldat and
8.03 c                             ndldat = *loval
8.03 c                   eval      c_ldat = s_ldat
8.01 c                   endif
8.01  *
8.01 c                   eval      ndldat = c_ldat
8.01 c                   update    nodtlur
8.01 c     nodtlu_key    reade     nodtlur
8.01 c                   enddo
8.01 c                   endif
8.01  *
     c                   endif
      *
      * Oppdater subfile
      *
     c                   if        b1valg = 2
     c                   eval      b1user = nouser
     c                   eval      b1ldat = 0
     c                   if        noldat <> *loval
     c     *dmy          move      noldat        b1ldat
     c                   endif
     c                   exsr      hent_status
     c                   endif
      *
     c                   if        b_oppr = *on or
     c                             b1valg = 3
     c                   eval      b_forn = *on
     c                   endif
      *
     c     end_c2bld     tag
      *
     c                   eval      *in30 = *off
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av slette-bildet (D1WIN)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xd1win        begsr
      *
     c                   eval      nohelr_tell = b1tell
     c                   eval      nohelr_fsys = b1fsys
     c     nohelr_key    chain     nohelr
      *
     c                   eval      nkeolr_kode = b1fsys
     c     nkeolr_key    chain     nkeolr
      *
     c                   exfmt     d1win
      *
     c                   if        *inkc or *inkl
     c                   leavesr
     c                   endif
      *
     c                   eval      b_forn = *on
      *
      * Sletter ekstern ordre-hode
      *
     c                   eval      nohelu_tell = b1tell
     c                   eval      nohelu_fsys = b1fsys
     c     nohelu_key    chain     nohelur
     c                   delete    nohelur
      *
      * Sletter tilhørende ekstern ordre-linjer
      *
     c                   eval      nodtlu_tell = nohelu_tell
     c                   eval      nodtlu_fsys = nohelu_fsys
     c     nodtlu_key    setll     nodtlu
     c     nodtlu_key    reade     nodtlur
     c                   dow       not %eof
     c                   delete    nodtlur
     c     nodtlu_key    reade     nodtlur
     c                   enddo
6.35  *
6.35  * Sletter ekstern ordre-hode
6.35  *
7.09 c                   eval      edhel4_fsys = b1fsys
7.09 c                   eval      edhel4_tell = b1tell
7.09 c*                  eval      edhelu_ldor = 0
7.09 c*                  eval      edhelu_ldat = *loval
7.09 c     edhel4_key    chain     edhel4r
7.09 c                   if        %found
7.09 c                   delete    edhel4r
6.35  *
6.35  * Sletter tilhørende ekstern ordre-linjer
6.35  *
6.35 c                   eval      eddtlu_tell = b1tell
6.35 c                   eval      eddtlu_fsys = b1fsys
6.35 c                   eval      eddtlu_ldor = 0
6.35 c                   eval      eddtlu_ldat = *loval
7.10 c                   eval      eddtlu_line = 0
7.10 c     eddtlu_key    setll     eddtlu
7.10 c     eddtlu_key3   reade     eddtlur
6.35 c                   dow       not %eof
6.35 c                   delete    eddtlur
7.10 c     eddtlu_key3   reade     eddtlur
6.35 c                   enddo
7.09 c                   endif
8.06  *
8.06  * Slett gså fra tilleggstabell
8.06  *
8.06 c                   eval      edh2l4_fsys = b1fsys
8.06 c                   eval      edh2l4_tell = b1tell
8.06 c     edh2l4_key    chain     edh2l4r
8.06 c                   if        %found
8.06 c                   delete    edh2l4r
8.06 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for tømming av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     clr_subfile   begsr
      *
     c                   eval      *in14 = *on
     c                   write     b2ctl
     c                   eval      *in14 = *off
      *
     c                   eval      *in15 = *off
     c                   eval      w_srrn = 0
     c                   eval      w_sfrn = 0
     c                   eval      w_ssrn = 0
     c                   eval      w_spge = 0
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å fylle opp subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     crt_subfile   begsr
      *
     c                   eval      w_spge = w_spge + c_sfil
     c                   eval      w_srrn = w_ssrn
      *
     c                   dou       w_srrn = w_spge
      *
     c                   select
     c                   when      w_seqe = 'R'
     c                   read      nohel2
     c                   when      w_seqe = 'K'
     c                   read      nohel3
     c                   when      w_seqe = 'P'
     c                   read      nohel4
     c                   when      w_seqe = 'U'
     c                   read      nohel5
     c                   other
     c                   read      nohel6
     c                   endsl
      *
6.32 c                   if        %eof or
6.32 c                             nofirm <> w_firm
     c                   eval      *in15 = *on
     c                   leave
     c                   endif
7.05  *
7.05  * Sjekk hvis det er valgt system
7.05  *
7.05 c                   if        h1fsys <> *blanks and
7.05 c                             h1fsys <> nofsys
7.05 c                   iter
7.05 c                   endif
7.0x  *
7.0x  * Sjekk ikke bare ordrenummer på ordrehodet, da dette ikke er satt
7.0x  *
7.12 c                   if        nonumm <> *hival and
7.12 c                             nonumm <> 0 and
7.03 c                             b_alle = *off
7.03 c                   iter
7.03 c                   endif
7.15  *   Dersom en kode er valgt tas kun disse med
7.15 c                   if        p_kode <> *blank
7.15 c                             and nofsys <> p_kode
7.15 c                   iter
7.15 c                   endif
7.15  *   Dersom en kode er blank skal ikk e*SS med
7.15 c**7.28             if        p_kode = *blank
7.26 c**7.28                       and nofsys <> p_kode
7.26 c**7.28                       or p_kode = *blank
7.26 c**7.28                       and nofsys = '*SS'
7.15 c**7.28             iter
7.15 c**7.28             endif
7.28  *
7.28 c                   if        p_kode = *blank
7.28 c                             and nofsys = '*SS'
7.28 c                   iter
7.28 c                   endif
7.21  *
7.21 c                   eval      b1over = 0
7.06  *
7.06  * Gjelder ikke EDI meldinger
7.06  *
7.06 c                   if        nofsys <> 'EDI' and
7.06 c                             nofsys <> 'SMK' and
7.06 c                             nofsys <> 'EHF'
7.06  *
7.01 c                   eval      b_show = *on
7.01 c                   eval      w_alin = 0
7.01 c                   eval      w_olin = 0
7.0x c                   eval      nodtlr_tell = notell
7.0x c                   eval      nodtlr_fsys = nofsys
7.0x c     nodtlr_key    setll     nodtlr
7.0x c     nodtlr_key    reade     nodtlr
7.0x c                   dow       not %eof
7.0x  *
7.01 c                   eval      w_alin = w_alin + 1
7.0x c                   eval      eddtl3_tell = ndtell
7.0x c                   eval      eddtl3_fsys = ndfsys
7.0x c                   eval      eddtl3_line = ndline
7.0x c     eddtl3_key    chain     eddtl3
7.0x c                   if        %found
7.01 c**                 eval      b_show = *on
7.23 c                   if        edonum <> 0 and
7.23 c                             edolin <> 0
7.01 c                   eval      w_olin = w_olin + 1
7.23 c                   endif
7.0x c                   endif
7.0x  *
7.0x c     nodtlr_key    reade     nodtlr
7.0x c                   enddo
7.0x  *
7.0x c*7.21              eval      b1over = 0
7.01  * Hvis ikke alle linjene er overført, skal det flagges som e indikasjon
7.01 c                   if        w_alin = w_olin and
7.01 c                             w_alin > 0
7.01 c                   eval      b_show = *off
7.01 c                   endif
7.01  *
7.01 c                   if        w_alin <> w_olin and
7.01 c                             w_olin > 0
7.12 c                   eval      b_show = *on
7.01 c                   eval      b1over = 2
7.01 c                   endif
7.0x  *
7.0x c                   if        b_show = *off
7.0x c                   eval      b1over = 1
7.0x c                   if        b_alle = *off
7.0x c                   iter
7.0x c                   endif
7.0x c                   endif
      *
7.06 c                   endif
      *
     c                   eval      w_srrn = w_srrn + 1
      *
     c                   select
     c                   when      w_seqe = 'R'
     c                   eval      nohel2_nref = nonref
     c                   when      w_seqe = 'K'
     c                   eval      nohel3_knav = noknav
     c                   when      w_seqe = 'P'
     c                   eval      nohel4_pnav = nopnav
     c                   when      w_seqe = 'U'
     c                   eval      nohel5_user = nouser
     c                   other
     c                   eval      nohel6_fsys = nofsys
     c                   endsl
      *
     c                   eval      b1valg = 0
     c                   eval      b1fsys = nofsys
     c                   eval      b1tell = notell
6.20 c**                 eval      b1nref = nonref
6.20 c                   movel     nonref        b1nref
     c                   eval      b1knav = noknav
     c                   eval      b1pnav = nopnav
     c                   eval      b1user = nouser
6.20 c                   eval      b1lmat = nolmat
     c                   eval      b1odat = 0
     c                   eval      b1ldat = 0
     c                   eval      b1meld = *blank
     c                   eval      b1stat = 0
      *
     c     *dmy          move      noodat        b1odat
      *
     c                   if        noldat <> *loval
     c     *dmy          move      noldat        b1ldat
     c                   endif
      *
     c                   if        nomeld <> *blank
     c                   eval      b1meld = 'M'
     c                   endif
      *
     c                   exsr      hent_status
      *
     c                   write     b1sfl
      *
     c                   enddo
      *
     c                   if        w_srrn > w_ssrn
     c                   eval      w_sfrn = w_ssrn + 1
     c                   endif
      *
     c                   eval      w_ssrn = w_srrn
     c                   eval      w_virn = w_sfrn
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å bla tilbake en side i subfilen
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     bck_subfile   begsr
      *
     c                   if        *in15
     c                   select
     c                   when      w_seqe = 'R'
     c     nohel2_key    setgt     nohel2
     c                   readp     nohel2
     c                   when      w_seqe = 'K'
     c     nohel3_key    setgt     nohel3
     c                   readp     nohel3
     c                   when      w_seqe = 'P'
     c     nohel4_key    setgt     nohel4
     c                   readp     nohel4
     c                   when      w_seqe = 'U'
     c     nohel5_key    setgt     nohel5
     c                   readp     nohel5
     c                   other
     c     nohel6_key    setgt     nohel6
     c                   readp     nohel6
     c                   endsl
     c                   endif
      *
      * Leser tilbake en side
      *
     c                   eval      w_stel = 0
      *
     c                   dou       w_stel = w_ssrn + c_sfil
      *
     c                   select
     c                   when      w_seqe = 'R'
     c                   readp     nohel2
     c                   when      w_seqe = 'K'
     c                   readp     nohel3
     c                   when      w_seqe = 'P'
     c                   readp     nohel4
     c                   when      w_seqe = 'U'
     c                   readp     nohel5
     c                   other
     c                   readp     nohel6
     c                   endsl
      *
     c                   if        %eof or
     c                             nofirm <> w_firm
6.32 c                   leave
6.32 c**                 iter
     c                   endif
      *
7.0x c*                  if        nonumm <> 0
7.0x c*                  iter
7.0x c*                  endif
      *
7.14 c                   if        nofsys <> 'EDI' and
7.14 c                             nofsys <> 'EHF' and
7.14 c                             nofsys <> 'SMK'
7.0x c                   eval      b_show = *off
7.0x c                   eval      nodtlr_tell = notell
7.0x c                   eval      nodtlr_fsys = nofsys
7.0x c     nodtlr_key    setll     nodtlr
7.0x c     nodtlr_key    reade     nodtlr
7.0x c                   dow       not %eof
7.0x  *
7.0x c                   eval      eddtl3_tell = ndtell
7.0x c                   eval      eddtl3_fsys = ndfsys
7.0x c                   eval      eddtl3_line = ndline
7.0x c     eddtl3_key    chain     eddtl3
7.0x c                   if        %found
7.0x c                   eval      b_show = *on
7.0x c                   endif
7.0x  *
7.0x c     nodtlr_key    reade     nodtlr
7.0x c                   enddo
7.0x  *
7.0x c                   if        b_show = *off
7.0x c                   iter
7.0x c                   endif
7.14 c                   endif
      *
     c                   eval      w_stel = w_stel + 1
      *
     c                   select
     c                   when      w_seqe = 'R'
     c                   eval      nohel2_nref = nonref
     c                   when      w_seqe = 'K'
     c                   eval      nohel3_knav = noknav
     c                   when      w_seqe = 'P'
     c                   eval      nohel4_pnav = nopnav
     c                   when      w_seqe = 'U'
     c                   eval      nohel5_user = nouser
     c                   other
7.14 c**                 eval      nohel6_fsys = nofsys
7.14 c                   eval      nohel6_fsys = *blanks
     c                   endsl
      *
7.0x c     les_neste2    tag
      *
     c                   enddo
      *
     c                   if        %eof
     c                   select
     c                   when      w_seqe = 'R'
     c     nohel2_key    setll     nohel2
     c                   when      w_seqe = 'K'
     c     nohel3_key    setll     nohel3
     c                   when      w_seqe = 'P'
     c     nohel4_key    setll     nohel4
     c                   when      w_seqe = 'U'
     c     nohel5_key    setll     nohel5
     c                   other
     c     nohel6_key    setll     nohel6
     c                   endsl
     c                   endif
      *
      * Blanker og fyller opp subfile
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for display av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     dsp_subfile   begsr
      *
     c                   if        w_srrn <> 0
     c                   eval      *in12 = *on
     c                   else
     c                   write     b2cmd
     c                   endif
      *
     c                   eval      *in13 = *on
     c                   exfmt     b2ctl
      *
     c                   eval      *in12 = *off
     c                   eval      *in13 = *off
      *
     c                   eval      w_fcrn = d_fcrn
      *
     c                   endsr
      *
8.05  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
8.05  * Subrutine for å hente nye meldinger
8.05  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
8.05  *
8.05 c     hent_meld     begsr
8.05  *
8.05  * Sjekk om overføring allerede pågår.
8.05  *
8.05 c                   eval      w_jsta = 07
8.05 c                   eval      w_onof = 0
8.05  *
8.05 c                   call      'FA730R'
8.05 c                   parm                    w_jsta
8.05 c                   parm                    w_onof
8.05  *
8.05  * Overføring pågår eller finnes ikke.
8.05  *
8.05 c                   if        w_onof  = 1
8.05 c                   eval      w_ctl1 = 4
8.05 c                   eval      w_ctpo = 44
8.05 c                   eval      w_mldc1 = w_con1
8.05 c                   eval      w_mldc2 = w_con2
8.05  *
8.05 c                   call      'AA006C'
8.05 c                   parm                    w_ctl1
8.05 c                   parm                    w_ctpo
8.05 c                   parm                    w_mldc1
8.05 c                   parm                    w_mldc2
8.05  *
8.05 c                   eval      w_cmd = 'DLYJOB DLY(2)'
8.05 c                   eval      w_len = 200
8.05 c                   call      'QCMDEXC'
8.05 c                   parm                    w_cmd
8.05 c                   parm                    w_len
8.05 c                   goto      end_hent
8.05 c                   endif
8.05  *
8.05  * Oppdater jobb-register med aktiv-flagg
8.05  *
8.05 c                   eval      w_jsta = 07
8.05 c                   eval      w_onof = 1
8.05 c                   call      'FA720R'
8.05 c                   parm                    w_jsta
8.05 c                   parm                    w_onof
8.05  *
8.05 c                   eval      p_stat = *blanks
8.05 c                   call      'LI700C'
8.05 c                   parm                    p_stat
8.05 c                   eval      w_fcrn = *zero
8.05 c                   eval      w_type = 'OBKR'
8.05  * Flagger evnt feil
8.05 c                   if        p_stat = 'F'
8.05 c                   exfmt     b9win3
8.05 c                   endif
8.05  *
8.05  * Fjern aktiv-flagg fra jobb-register
8.05  *
8.05 c                   eval      w_jsta = 07
8.05 c                   eval      w_onof = 0
8.05 c                   call      'FA720R'
8.05 c                   parm                    w_jsta
8.05 c                   parm                    w_onof
8.05  *
8.05  *
8.05 c     end_hent      endsr
8.05  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å hente statuskode
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_status   begsr
      *
      * Henter feil-status fra ekstern ordre-hode
      *
     c                   call      'NO105R'
     c                   parm                    w_firm
     c                   parm                    b1stat
     c                   parm                    nolage
     c                   parm                    nouser
     c                   parm                    nokund
     c                   parm                    nokpro
     c                   parm                    nolety
     c                   parm                    noldat
      *
      * Henter eventuell feilstatus fra ekstern ordre-linje
      *
     c                   if        b1stat = 0
      *
     c                   eval      nodtlr_tell = b1tell
     c                   eval      nodtlr_fsys = b1fsys
     c     nodtlr_key    setll     nodtlr
     c     nodtlr_key    reade     nodtlr
      *
     c                   if        %eof
     c                   eval      b1stat = 8
     c                   leavesr
     c                   endif
      *
     c                   dow       not %eof
      *
     c                   call      'ND105R'
     c                   parm                    w_firm
     c                   parm                    w_stat
6.31 c                   parm                    nolage
     c                   parm                    ndvare
     c                   parm                    ndtek1
     c                   parm                    ndanta
     c                   parm                    ndenhe
     c                   parm                    ndlety
     c                   parm                    ndldat
7.11 c                   parm                    nofsys
7.07  *
7.07  * Hvis EDI, er det litt forskjell på testen
7.07  *
7.07 c                   if        b1fsys = 'EDI' or
7.07 c                             b1fsys = 'SMK' or
7.07 c                             b1fsys = 'EHF'
7.27  *
7.27 c                   if        w_stat = 1
7.27 c                             and ukjent_vare_ok = *on
7.27 c                   eval      w_stat = 0
7.27 c                   endif
      *  DEBUGSST
     c                   if        ndvare = '15297000'
     c                   eval      ndvare = ndvare
     c                   endif
7.27  *
7.07 c                   if        w_stat <> 0 and
7.07 c                             w_stat <> 8 and
7.07 c                             w_stat <> 9
7.07 c                   eval      b1stat = 9
7.07 c                   leave
7.07 c                   endif
7.07 c                   else
     c                   if        w_stat <> 0
     c                   eval      b1stat = 9
     c                   leave
     c                   endif
7.07 c                   endif
7.04  * TEMPORÆRT DISABLED
7.04 c                   if        1=2
7.04  * Sjekk GTIN nummer
7.04 c                   if        b1stat = 0
7.04  * Slå opp mot EDI bestilling - kopiregister
7.04 c                   eval      eddtl1_fsys = ndfsys
7.04 c                   eval      eddtl1_tell = ndtell
6.35 c                   eval      eddtl1_ldor = 0
6.35 c                   eval      eddtl1_ldat = *loval
7.04 c                   eval      eddtl1_line = ndline
7.04 c     eddtl1_key    chain     eddtl1r
7.04 c                   if        %found
7.04 c                   eval      w_gtin = edgtin
7.04 c                   if        w_gtin <> 0
7.04 c                   call      'VE717R'
7.04 c                   parm                    w_firm
7.04 c                   parm                    w_gtin
7.04 c                   parm                    w_gvar
7.04 c                   parm                    w_genh
7.04 c                   parm                    w_gsts
7.04  *
7.04 c                   if        w_gsts = '1'
7.04 c                   if        w_gvar <> ndvare
7.04 c                   eval      b1stat = 9
7.04 c                   endif
7.04 c                   if        w_genh <> ndenhe
7.04 c                   eval      b1stat = 9
7.04 c                   endif
7.04 c                   else
7.04 c                   eval      b1stat = 9
7.04 c                   endif
7.04  *
7.04 c                   else
7.04 c                   eval      b1stat = 9
7.04 c                   endif
7.04 c                   endif
7.04  *
7.04 c                   endif
7.04 c                   endif
      *
     c     nodtlr_key    reade     nodtlr
     c                   enddo
      *
     c                   endif
      *
     c                   endsr
      *
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  * Subrutine for å hente statuskode - lagervare
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  *
7.0x c     hent_status_l begsr
7.0x  *
7.0x  * Henter eventuell feilstatus fra ekstern ordre-linje
7.0x  *
7.01 c**                 call      'ND105R'
7.01 c                   call      'NX105R'
7.0x c                   parm                    w_firm
7.0x c                   parm                    w_vsta
7.01 c                   parm                    xxfsys
7.01 c                   parm                    xxtell
7.01 c                   parm                    xxline
7.0x c                   parm                    nolage
7.0x c                   parm                    xxvare
7.0x c                   parm                    xxtek1
7.0x c                   parm                    xxanta
7.0x c                   parm                    xxenhe
7.0x c                   parm                    xxlety
7.0x c                   parm                    xxldat
7.0x  *
7.0x c                   endsr
7.0x  *
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  * Subrutine for å behandle ordrelinjer
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  *
7.0x c     vis_ref       begsr
7.0x  *
7.0x c                   call      'ND102R'
7.0x c                   parm                    w_firm
7.0x c                   parm                    b1fsys
7.0x c                   parm                    b1tell
7.0x  *
7.0x c                   endsr
7.0x  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å behandle ordrelinjer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ordre_linje   begsr
      *
     c                   call      'ND100R'
     c                   parm                    w_firm
     c                   parm                    b1fsys
     c                   parm                    b1tell
      *
      * Oppdaterer feilstatus
      *
     c                   eval      nohelr_tell = b1tell
     c                   eval      nohelr_fsys = b1fsys
     c     nohelr_key    chain     nohelr
     c                   if        %found
     c                   exsr      hent_status
     c                   endif
      *
     c                   endsr
      *
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  * Finnes det lagervarer på ordren ?
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  *
7.0x c     xsjekk_lager  begsr
7.0x  *
7.0x c                   eval      b_stop = *on
7.02 c                   eval      b_ltext = *off
7.0x  *
7.0x c                   eval      nohel1_tell = b1tell
7.0x c                   eval      nohel1_fsys = b1fsys
7.0x c     nohel1_key    chain     nohel1
7.0x  *
7.0x  * Sjekk at det finnes lagervarer på ordren
7.0x  *
7.0x c                   eval      nodtl1_tell = b1tell
7.0x c                   eval      nodtl1_fsys = b1fsys
7.0x c     nodtl1_key    setll     nodtl1
7.0x c     nodtl1_key    reade     nodtl1
7.0x c                   dow       not %eof
7.02 c                   if        xxvare <> *blanks
7.02 c                   eval      b_ltext = *off
7.0x c                   eval      vlagl1_lage = nolage
7.0x c                   eval      vlagl1_vare = xxvare
7.0x c     vlagl1_key    chain     vlagl1
7.0x c                   if        %found
7.0x c                   if        vlvtyp = 'L'
7.0x  * Finn status for varen ?
7.0x c                   exsr      hent_status_l
7.0x c                   if        w_vsta = 0   or
7.0x c                             w_vsta > 7
7.0x c                   eval      b_stop = *off
7.02 c                   eval      b_ltext = *on
7.0x  * Opprett vare på sideregister
7.0x c                   exsr      add_llinje
7.0x c                   endif
7.0x c                   endif
7.0x c                   endif
7.02 c                   else
7.02  * Vi har å gjøre med tekstlinjer. Skal følge forrige linje.
7.02 c                   if        b_ltext = *on
7.02 c                   exsr      add_textl
7.02 c                   endif
7.02 c                   endif
7.0x c     nodtl1_key    reade     nodtl1
7.0x c                   enddo
7.0x  *
7.0x c                   endsr
7.0x  *
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  * Finnes det skaffevarer på ordren ?
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  *
7.0x c     xsjekk_skaff  begsr
7.0x  *
7.0x c                   eval      b_stop = *on
7.02 c                   eval      b_stext = *off
7.0x  *
7.0x c                   eval      nohel1_tell = b1tell
7.0x c                   eval      nohel1_fsys = b1fsys
7.0x c     nohel1_key    chain     nohel1
7.0x  *
7.0x  * Sjekk at det finnes lagervarer på ordren
7.0x  *
7.0x c                   eval      nodtl1_tell = b1tell
7.0x c                   eval      nodtl1_fsys = b1fsys
7.0x c     nodtl1_key    setll     nodtl1
7.0x c     nodtl1_key    reade     nodtl1
7.0x c                   dow       not %eof
7.02 c                   if        xxvare <> *blanks
7.02 c                   eval      b_stext = *off
7.0x c                   eval      vlagl1_lage = nolage
7.0x c                   eval      vlagl1_vare = xxvare
7.0x c     vlagl1_key    chain     vlagl1
7.0x c                   if        %found
7.0x c                   if        vlvtyp = 'S'
7.0x  * Finn status for varen ?
7.0x c                   exsr      hent_status_l
7.0x c                   if        w_vsta = 8
7.0x c                   eval      b_stop = *off
7.02 c                   eval      b_stext = *on
7.0x  * Opprett vare på sideregister
7.0x c                   exsr      add_slinje
7.0x c                   endif
7.0x c                   endif
7.0x c                   endif
7.02 c                   else
7.02  * Vi har å gjøre med tekstlinjer. Skal følge forrige linje.
7.02 c                   if        b_stext = *on
7.02 c                   exsr      add_textl
7.02 c                   endif
7.02 c                   endif
7.0x c     nodtl1_key    reade     nodtl1
7.0x c                   enddo
7.0x  *
7.0x c                   endsr
7.0x  *
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  * Subrutine for å legge ut varer på sideregister
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  *
7.0x c     add_llinje    begsr
7.0x  *
7.0x  * Legg ut linje på sideregister
7.0x  *
7.0x c                   eval      vvarl1_vare = xxvare
7.0x c     vvarl1_key    chain     vvarl1
7.0x c                   if        not %found
7.0x c                   eval      vvnobb = 0
7.0x c                   eval      vvlvar = *blanks
7.0x c                   endif
7.0x  *
7.0x c                   if        xxldat <> *loval
7.0x c                   eval      eddtlu_ldat = xxldat
7.0x c                   endif
7.0x  *
7.0x c                   if        eddtlu_ldat = *loval
7.0x c                   eval      eddtlu_ldat = noldat
7.0x c                   endif
7.0x  *
7.0x c                   if        eddtlu_ldat = *loval
7.0x c                   time                    eddtlu_ldat
7.0x c                   endif
7.0x  *
7.0x c                   eval      eddtlu_fsys = b1fsys
7.0x c                   eval      eddtlu_tell = b1tell
7.0x c                   eval      eddtlu_ldor = 0
7.0x c                   eval      eddtlu_line = xxline
7.0x c     eddtlu_key    chain     eddtlu
7.0x  *
7.0x c                   if        not %found(eddtlu)
7.0x c                   clear                   eddtlur
7.0x c                   eval      edfirm = w_firm
7.0x c                   eval      edfsys = b1fsys
7.0x c                   eval      edtell = b1tell
7.0x c                   eval      edldor = 0
7.02 c                   eval      x_ldor = 0
7.0x c                   eval      edldat = eddtlu_ldat
7.0x c                   eval      edline = xxline
7.0x c                   time                    edodat
7.0x c                   time                    edotim
7.0x c                   eval      edousr = l_user
7.0x  * Hent vareinfo
7.0x c                   eval      edvare = xxvare
7.0x c                   eval      edenhe = xxenhe
7.0x c                   eval      edlety = xxlety
7.0x c                   eval      edtek1 = xxtek1
7.0x c                   eval      edtek2 = xxtek2
7.0x c                   eval      ednref = xxnref
7.0x c                   eval      edanta = xxanta
7.0x c                   eval      ednobb = vvnobb
7.0x c                   eval      edlvar = vvlvar
7.0x  *
7.0x c                   time                    ededat
7.0x c                   time                    edetim
7.0x c                   eval      edeusr = l_user
7.0x  *
7.0x c                   write     eddtlur
7.0x  *
7.0x  * Legg ut hodet hvis ikke dette finnes
7.0x  *
7.0x c                   eval      edhelu_fsys = b1fsys
7.0x c                   eval      edhelu_tell = b1tell
7.0x c                   eval      edhelu_ldat = edldat
7.0x c                   eval      edhelu_ldor = 0
7.0x c     edhelu_key    chain     edhelu
7.0x  *
7.0x c                   if        not %found
7.0x c                   clear                   edhelur
7.0x c                   eval      eofirm = w_firm
7.0x c                   eval      eofsys = b1fsys
7.0x c                   eval      eotell = b1tell
7.0x c                   eval      eoldat = edldat
7.0x c                   eval      eoldor = 0
7.0x c                   time                    eoodat
7.0x c                   time                    eootim
7.0x c                   eval      eoousr = l_user
7.0x  *
7.0x c                   eval      eonref = nonref
7.0x c                   eval      eolage = nolage
7.0x c                   eval      eoavde = noavde
7.0x c                   eval      eouser = nouser
7.0x c                   eval      eokund = nokund
7.0x c                   eval      eoknav = noknav
7.0x c                   eval      eokpro = nokpro
7.0x c                   eval      eopnav = nopnav
7.0x c                   eval      eonavn = nonavn
7.0x c                   eval      eoadr1 = noadr1
7.0x c                   eval      eoadr2 = noadr2
7.0x c                   eval      eoponr = noponr
7.0x c                   eval      eosted = nosted
7.0x c                   eval      eolety = nolety
7.0x c                   eval      eodref = nodref
7.0x c                   eval      eorekv = norekv
7.0x c                   eval      eounav = nounav
7.0x c                   eval      eoutlf = noutlf
7.0x c                   eval      eoumob = noumob
7.0x c                   eval      eoufax = noufax
7.0x c                   eval      eoumai = noumai
7.0x c                   eval      eobdat = nobdat
7.0x c                   eval      eolmat = nolmat
7.0x  *
7.0x c                   write     edhelur
7.0x c                   else
7.0x c                   unlock    edhelu
7.0x c                   endif
7.0x  *
7.0x c                   endif
7.0x  *
7.0x c                   endsr
7.0x  *
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  * Subrutine for å legge ut skaffevarer på sideregister
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  *
7.0x c     add_slinje    begsr
7.0x  *
7.0x  * Legg ut linje på sideregister
7.0x  *
7.0x c                   eval      vvarl1_vare = xxvare
7.0x c     vvarl1_key    chain     vvarl1
7.0x c                   if        not %found
7.0x c                   eval      vvnobb = 0
7.0x c                   eval      vvlvar = *blanks
7.0x c                   endif
7.0x  *
7.0x c                   eval      eddtlu_ldor = vvldor
7.0x c                   if        vlbldo <> 0
7.0x c                   eval      eddtlu_ldor = vlbldo
7.0x c                   endif
7.0x  *
7.0x c                   if        xxldat <> *loval
7.0x c                   eval      eddtlu_ldat = xxldat
7.0x c                   endif
7.0x  *
7.0x c                   if        eddtlu_ldat = *loval
7.0x c                   eval      eddtlu_ldat = noldat
7.0x c                   endif
7.0x  *
7.0x c                   if        eddtlu_ldat = *loval
7.0x c                   time                    eddtlu_ldat
7.0x c                   endif
7.0x  *
7.0x c                   eval      eddtlu_fsys = b1fsys
7.0x c                   eval      eddtlu_tell = b1tell
7.0x c                   eval      eddtlu_line = xxline
7.0x c     eddtlu_key    chain     eddtlu
7.0x  *
7.0x c                   if        not %found(eddtlu)
7.0x c                   clear                   eddtlur
7.0x c                   eval      edfirm = w_firm
7.0x c                   eval      edfsys = b1fsys
7.0x c                   eval      edtell = b1tell
7.0x c                   eval      edline = xxline
7.0x c                   eval      edldor = eddtlu_ldor
7.02 c                   eval      x_ldor = eddtlu_ldor
7.0x c                   eval      edldat = eddtlu_ldat
7.0x c                   time                    edodat
7.0x c                   time                    edotim
7.0x c                   eval      edousr = l_user
7.0x  * Hent vareinfo
7.0x c                   eval      edvare = xxvare
7.0x c                   eval      edenhe = xxenhe
7.0x c                   eval      edlety = xxlety
7.0x c                   eval      edtek1 = xxtek1
7.0x c                   eval      edtek2 = xxtek2
7.0x c                   eval      ednref = xxnref
7.0x c                   eval      edanta = xxanta
7.0x c                   eval      ednobb = vvnobb
7.0x c                   eval      edlvar = vvlvar
7.0x  *
7.0x c                   time                    ededat
7.0x c                   time                    edetim
7.0x c                   eval      edeusr = l_user
7.0x  *
7.0x c                   write     eddtlur
7.0x  *
7.0x  * Legg ut hodet hvis ikke dette finnes
7.0x  *
7.0x c                   eval      edhelu_ldat = edldat
7.0x c                   eval      edhelu_ldor = edldor
7.0x c     edhelu_key    chain     edhelu
7.0x  *
7.0x c                   if        not %found
7.0x c                   clear                   edhelur
7.0x c                   eval      eofirm = w_firm
7.0x c                   eval      eofsys = b1fsys
7.0x c                   eval      eotell = b1tell
7.0x c                   eval      eoldor = edldor
7.0x c                   eval      eoldat = edldat
7.0x c                   time                    eoodat
7.0x c                   time                    eootim
7.0x c                   eval      eoousr = l_user
7.0x  *
7.0x c                   eval      eonref = nonref
7.0x c                   eval      eolage = nolage
7.0x c                   eval      eoavde = noavde
7.0x c                   eval      eouser = nouser
7.0x c                   eval      eokund = nokund
7.0x c                   eval      eoknav = noknav
7.0x c                   eval      eokpro = nokpro
7.0x c                   eval      eopnav = nopnav
7.0x c                   eval      eonavn = nonavn
7.0x c                   eval      eoadr1 = noadr1
7.0x c                   eval      eoadr2 = noadr2
7.0x c                   eval      eoponr = noponr
7.0x c                   eval      eosted = nosted
7.0x c                   eval      eolety = nolety
7.0x c                   eval      eodref = nodref
7.0x c                   eval      eorekv = norekv
7.0x c                   eval      eounav = nounav
7.0x c                   eval      eoutlf = noutlf
7.0x c                   eval      eoumob = noumob
7.0x c                   eval      eoufax = noufax
7.0x c                   eval      eoumai = noumai
7.0x c                   eval      eobdat = nobdat
7.0x c                   eval      eolmat = nolmat
7.0x  *
7.0x c                   write     edhelur
7.0x c                   else
7.0x c                   unlock    edhelu
7.0x c                   endif
7.0x  *
7.0x c                   endif
7.0x  *
7.0x c                   endsr
7.0x  *
7.02  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.02  * Subrutine for å legge ut tekstlinjer på sideregister
7.02  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.02  *
7.02 c     add_textl     begsr
7.02  *
7.02 c                   if        xxldat <> *loval
7.02 c                   eval      eddtlu_ldat = xxldat
7.02 c                   endif
7.02  *
7.02 c                   if        eddtlu_ldat = *loval
7.02 c                   eval      eddtlu_ldat = noldat
7.02 c                   endif
7.02  *
7.02 c                   if        eddtlu_ldat = *loval
7.02 c                   time                    eddtlu_ldat
7.02 c                   endif
7.02  *
7.02 c                   eval      eddtlu_fsys = b1fsys
7.02 c                   eval      eddtlu_tell = b1tell
7.02 c                   eval      eddtlu_line = xxline
7.02 c     eddtlu_key    chain     eddtlu
7.02  *
7.02 c                   if        not %found(eddtlu)
7.02 c                   clear                   eddtlur
7.02 c                   eval      edfirm = w_firm
7.02 c                   eval      edfsys = b1fsys
7.02 c                   eval      edtell = b1tell
7.02 c                   eval      edline = xxline
7.02 c                   eval      edldor = x_ldor
7.02 c                   eval      edldat = eddtlu_ldat
7.02 c                   time                    edodat
7.02 c                   time                    edotim
7.02 c                   eval      edousr = l_user
7.02  * Hent vareinfo
7.02 c                   eval      edvare = *blanks
7.02 c                   eval      edenhe = *blanks
7.02 c                   eval      edlety = xxlety
7.02 c                   eval      edtek1 = xxtek1
7.02 c                   eval      edtek2 = xxtek2
7.02 c                   eval      ednref = xxnref
7.02 c                   eval      edanta = 0
7.02 c                   eval      ednobb = 0
7.02 c                   eval      edlvar = *blanks
7.02  *
7.02 c                   time                    ededat
7.02 c                   time                    edetim
7.02 c                   eval      edeusr = l_user
7.02  *
7.02 c                   write     eddtlur
7.02  *
7.02 c                   endif
7.02  *
7.02 c                   endsr
7.02  *
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  * Subrutine for å overføre lagervarer
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  *
7.0x c     overf_varer   begsr
7.0x  *
7.0x  * Start overføring
7.0x  *
7.0x c                   eval      w_ldor = 0
7.0x c                   eval      w_in03 = '0'
7.0x  *
7.0x c                   call      'NO122R'
7.0x c                   parm                    w_firm
7.0x c                   parm                    b1fsys
7.0x c                   parm                    b1tell
7.0x c                   parm                    w_ldor
7.0x c                   parm                    w_in03
7.0x  *
7.0x  * Hvis F3 eller F12 er tastet, rydd opp i "plukkede" linjer
7.0x  *
7.0x c                   if        w_in03 = '1'
7.0x  *
7.0x  * Sletter ekstern ordre-hode
7.0x  *
7.0x c                   eval      edhelu_tell = b1tell
7.0x c                   eval      edhelu_fsys = b1fsys
7.0x c                   eval      edhelu_ldor = 0
7.0x c                   eval      edhelu_ldat = *loval
7.0x c     edhelu_key    setll     edhelu
7.0x c     edhelu_key3   reade     edhelur
7.0x c                   dow       not %eof
7.0x c                   if        eonumm = 0
7.0x c                   delete    edhelur
7.0x  *
7.0x  * Sletter tilhørende ekstern ordre-linjer
7.0x  *
7.0x c                   eval      eddtlu_tell = b1tell
7.0x c                   eval      eddtlu_fsys = b1fsys
7.0x c                   eval      eddtlu_ldor = eoldor
7.0x c                   eval      eddtlu_ldat = eoldat
7.0x c                   eval      eddtlu_line = 0
7.0x c     eddtlu_key    setll     eddtlu
7.0x c     eddtlu_key2   reade     eddtlur
7.0x c                   dow       not %eof
7.0x c                   if        edonum = 0
7.0x c                   delete    eddtlur
7.0x c                   endif
7.0x c     eddtlu_key2   reade     eddtlur
7.0x c                   enddo
7.0x  *
7.0x c                   endif
7.0x  *
7.0x c     edhelu_key3   reade     edhelur
7.0x c                   enddo
7.0x  *
7.0x c                   endif
7.0x  *
7.0x c                   endsr
7.0x  *
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  * Subrutine for å overføre enkeltlinjer manuelt
7.0x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.0x  *
7.0x c     overf_linje   begsr
7.0x  *
7.0x c                   call      'ND101R'
7.0x c                   parm                    w_firm
7.0x c                   parm                    b1fsys
7.0x c                   parm                    b1tell
7.0x  *
7.0x  * Oppdaterer feilstatus
7.0x  *
7.0x c                   eval      nohelr_tell = b1tell
7.0x c                   eval      nohelr_fsys = b1fsys
7.0x c     nohelr_key    chain     nohelr
7.0x c                   if        %found
7.0x c                   exsr      hent_status
7.0x c                   endif
7.0x  *
7.0x c                   endsr
7.0x  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å overføre ekstern ordre til ordre
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ovf_ordre     begsr
      *
     c                   eval      nohelr_tell = b1tell
     c                   eval      nohelr_fsys = b1fsys
     c     nohelr_key    chain     nohelr
     c                   if        not %found
     c                   leavesr
     c                   endif
7.0x  *
7.0x  * Hele er overført fra før
7.0x  *
7.0x c                   if        b1over = 1
7.0x c                   eval      *in31 = *on
7.0x c                   leavesr
7.0x c                   endif
      *
     c                   exsr      hent_status
     c                   if        b1stat <> 0
     c                   leavesr
     c                   endif
8.02  *
8.02  * Sjekk at alle linjer (tekst) har leveringsdato
8.02  *
8.02 c                   exsr      sjk_levdato
7.15k *
7.15k * Opprette ordren på EDHE/EDDT hvis den ikke finnes
7.22  * Hvis den har kommet elektronisk via EDI, skal den finnes
7.22  * og det er bedre om det blir feil senere.
7.15k *
7.22 c                   if        b1fsys <> 'SMK' and
7.22 c                             b1fsys <> 'EDI' and
7.22 c                             b1fsys <> 'EHF'
7.15kc                   exsr      lag_skygge
7.22 c                   endif
      *
      * Henter ut navn på overføringsprogram
      *
     c                   eval      w_ovfprg = 'NO120R'
     c                   eval      nkeolr_kode = b1fsys
     c     nkeolr_key    chain     nkeolr
     c                   if        %found
     c                   eval      w_ovfprg = nkpgmc
     c                   endif
      *
      * Kaller overføringsprogram
      *
6.21  * Er post låst?
6.21 c                   if        w_ovfprg = 'NO120R'
6.21 c                   eval      nohelr_tell = b1tell
6.21 c                   eval      nohelr_fsys = b1fsys
6.21 c     nohelr_key    chain     nohelr
6.21 c                   if        %found
6.21 c                   if        nonumm = *hival or
6.21 c                             nonumm <> 0
6.21 c                   leavesr
6.21 c                   endif
6.21 c                   endif
6.21 c                   endif
6.21  *
     c                   call      w_ovfprg
     c                   parm                    w_firm
     c                   parm                    b1fsys
     c                   parm                    b1tell
      *
     c                   eval      b_forn = *on
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Oppretter ny kunde i kunderegisteret
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppr_kunde    begsr
5.20  *
      * Kaller program for oppretting av kunde
      *
     c                   call      'FA930R'
     c                   parm                    w_retu
     c                   parm                    w_firm
     c                   parm                    w_kna2
     c                   parm                    w_adr1
     c                   parm                    w_adr2
     c                   parm                    w_sted
     c                   parm                    c2kund
7.25 c                   parm                    w_tlfn
      *
      * Henter navn på kunde
      *
     c                   if        c2kund <> 0
     c                   eval      rkunl1_kund = c2kund
     c     rkunl1_key    chain     rkunl1
     c                   if        %found
     c                   eval      c2kna2 = rknavn
     c                   endif
     c                   endif
      *
     c                   eval      c2kpro = 0
     c                   eval      c2pna2 = *blank
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Oppretter kundeprosjekt
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppr_kundepro begsr
      *
      * Oppretter kundeprosjekt
      *
     c                   if        c2kund = 0
     c                   call      'FL104R'
     c                   parm                    w_firm
     c                   parm                    c2kund
     c                   parm                    c2kpro
     c                   else
     c                   call      'FL105R'
     c                   parm                    w_firm
     c                   parm                    c2kund
     c                   parm                    c2kpro
     c                   parm                    w_pna2
     c                   parm                    w_pad1
     c                   parm                    w_pad2
     c                   parm                    w_kund_kopi
     c                   parm                    w_kpro_kopi
     c                   endif
      *
      * Henter navn på kunde og kundeprosjekt
      *
     c                   if        c2kund <> 0
     c                   eval      rkunl1_kund = c2kund
     c     rkunl1_key    chain     rkunl1
     c                   if        %found
     c                   eval      c2kna2 = rknavn
     c                   endif
     c                   endif
      *
     c                   if        c2kpro <> 0
     c                   eval      fkprl1_kund = c2kund
     c                   eval      fkprl1_kpro = c2kpro
     c     fkprl1_key    chain     fkprl1
     c                   if        %found
     c                   eval      c2pna2 = flnavn
     c                   endif
     c                   endif
      *
     c                   endsr
      *
7.05  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.05  * Subrutine for behandling av filter-bildet (H1WIN)
7.05  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.05  *
7.05 c     xh1win        begsr
7.05  *
7.05 c     h1taga        tag
7.05 c                   exfmt     h1win
7.05  *
7.05 c                   if        *inkc or *inkl
7.05 c                   goto      end_h1win
7.05 c                   endif
7.05  *
7.05 c     end_h1win     endsr
7.05  *
7.15  *
7.15  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.15  * Subrutine for å overføre ekstern ordre til Prosjekt
7.15  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.15  *
7.15 c     ovf_Prosj     begsr
7.15  *
7.15  *    Sjekk om noen av disse varene + lassnr finnes fra før.
7.15  *     I saå fall skal ikke filen leses inn på nytt.
7.15  *
7.15 c                   eval      nodtlr_fsys = b1fsys
7.15 c                   eval      nodtlr_tell = b1tell
7.15 c     nodtlr_key    setll     nodtlr
7.15 c     nodtlr_key    reade     nodtlr
7.15 c                   dow       not %eof(nodtlr)
7.15 c                             and ndfirm = w_firm
7.15 c                             and ndfsys = b1fsys
7.15 c                             and ndtell = b1tell
7.15 c                   eval      rpval1_pros = p_pros
7.15 c                   eval      rpval1_upro = p_upro
7.15 c                   eval      rpval1_akti = p_akti
7.15 c                   eval      rpval1_vare = ndvare
7.15 c                   eval      rpval1_lass = ndlass
7.15 c     rpval1_key    chain     rpval1
7.15 c                   if        %found(rpval1)
7.15 c                   eval      w_ms1 = 'En vare/lass kombinasjon finnes +
7.15 c                                      fra før.'
7.15 c                   eval      w_ms2 = 'Denne overføringen kan ikke utføres'
7.15 c                   eval      w_svar = 'N'
7.15 c                   call      'AA007R'
7.15 c                   parm                    w_ms1
7.15 c                   parm                    w_ms2
7.15 c                   parm                    w_svar
7.15 c                   parm                    w_in12
7.15  *
7.15 c                   goto      end_ovf
7.15 c                   endif
7.15 c     nodtlr_key    reade     nodtlr
7.15 c                   enddo
7.15  *
7.15 c                   eval      nohelr_tell = b1tell
7.15 c                   eval      nohelr_fsys = b1fsys
7.15 c     nohelr_key    chain     nohelr
7.15 c                   if        not %found
7.15 c                   leavesr
7.15 c                   endif
7.15  *   Merke bilag at det er slettet   SMK > *SS
7.15 c                   eval      nofsys =  '*SS'
7.15 c                   write     nohelur
7.15  *
7.15 c                   eval      nohelu_fsys = b1fsys
7.15 c                   eval      nohelu_tell = b1tell
7.15 c     nohelu_key    chain     nohelu
7.15 c                   if        %found(nohelu)
7.15 c                   delete    nohelur
7.15 c                   endif
7.15  *
7.15  *    Legg inn nye linjer RPVAPF
7.15 c                   eval      nodtlr_fsys = b1fsys
7.15 c                   eval      nodtlr_tell = b1tell
7.15 c     nodtlr_key    setll     nodtlr
7.15 c     nodtlr_key    reade     nodtlr
7.15 c                   dow       not %eof(nodtlr)
7.15 c                             and ndfirm = w_firm
7.15 c                             and ndfsys = b1fsys
7.15 c                             and ndtell = b1tell
7.15  *  debugss
s.ss c                   if        ndvare = '10541290'
     c                   eval      ndvare = ndvare
     c                   endif
7.15 c                   eval      rpvpro = p_pros
7.15 c                   eval      rpvupr = p_upro
7.15 c                   eval      rpvakt = p_akti
7.15 c                   eval      rpvprk = p_kpro
7.15 c                   eval      rpvvar = ndvare
7.15 c                   eval      rpvkto = *zero
7.15 c                   exsr      get_konto
7.15 c                   eval      rpvlas = ndlass
7.15 c                   if        %found(vvarl1)
7.15 c                   eval      rpvtxt = vvtek1
7.15 c                   else
7.15 c                   eval      rpvtxt = ndtek1
7.15 c                   endif
7.15 c                   eval      rpvenh = vvenhe
7.15 c                   eval      rpvens = ndenhe
7.15sc*                  eval      rpvlda = ndldat
7.15sc                   eval      rpvlda = *loval
7.15 c                   eval      rpvabu = ndanta
7.15  *   Hvis enhet fra Smartkalk <> enhet på varen omberegens antall dersom faktor finnes
7.19  *   Hvis enhet fra Smartkalk <> 1. salgsenhet på varen (vvenl2) omberegnes antall
7.19 c**                 if        rpvenh <> rpvens
7.15 c                   exsr      HentOmrF
7.15 c                   if        w_omr1 > 0
7.15 c                             and w_omr2 > 0
7.19 c                             and w_omr1 <> w_omr2
7.19 c                   eval      rpvenh = veenhe
7.18 c                   eval      w_ant  = ndanta * w_omr1 / w_omr2
7.18 c                   eval(h)   rpvabu = w_ant +  w_just
7.18 c                   else
7.18 c                   eval      w_ant  = ndanta
7.18 c                   eval(h)   rpvabu = w_ant +  w_just
7.15 c                   endif
7.19 c**                 endif
7.15  *
7.15 c                   eval      rpvabj = rpvabu
7.15 c                   exsr      hentPris
7.15 c                   if        p_kopr <> 0
7.15 c                   eval      rpvkpr = p_kopr
7.15 c                   else
7.15 c                   eval      rpvkpr = ndntpr
7.15 c                   endif
7.15 c                   eval      rpvkpb = rpvabu * rpvkpr
7.15 c                   eval      rpvoda = ndodat
7.15 c                   eval      rpvoti = ndotim
7.15 c                   eval      rpvous = ndousr
7.15 c                   eval      rpveda = ndedat
7.15 c                   eval      rpveti = ndetim
7.15 c                   eval      rpveus = ndeusr
7.15  *
7.15 c                   write     rpvalur
7.15 c                   read      nodtlr
7.15 c                   enddo
7.15  *
7.15  *   Gi melidng om at bilag er overført prosjekt
7.15  *
7.15 c                   eval      w_mld1 = 'Bilag er overført Pr+
7.15 c                                       osjekt: ' + p_pros
7.15 c                   if        p_upro <> *blank
7.15 c                   eval      w_mld1 =  w_mld1 + '\' + p_upro
7.15 c                   endif
7.15 c                   if        p_akti <> *blank
7.15 c                   eval      w_mld1 =  w_mld1 + '\' + p_akti
7.15 c                   endif
7.15 c                   call      'AA005R'
7.15 c                   parm                    w_mld1
7.15  *
7.15 c                   eval      b_forn = *on
7.15  *
7.15 c     end_ovf       endsr
7.15  *
7.15  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.15  * Subrutine for å hente kontohnev/konto
7.15  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.15  *
7.15 c     get_konto     begsr
7.15  *  ktohnv fra vare
7.15 c                   eval      vvarl1_vare = ndvare
7.15 c                   eval      vkhvl1_kkod = *blank
7.15 c     vvarl1_key    chain     vvarl1
7.15 c                   if        %found(vvarl1)
7.15 c                   eval      vkhvl1_kkod = vvkhev
7.15  *  ktohnv fra Undergruppe
7.15 c                   if        vkhvl1_kkod = *blank
7.15 c                   eval      vugrl1_ogr  = vvogrp
7.15 c                   eval      vugrl1_hgr  = vvhgrp
7.15 c                   eval      vugrl1_ugr  = vvugrp
7.15 c     vugrl1_key    chain     vugrl1
7.15 c                   if        %found(vugrl1)
7.15 c                   eval      vkhvl1_kkod = vgukhv
7.15 c                   endif
7.15 c                   endif
7.15  *  ktohnv fra hovedgruppe
7.15 c                   if        vkhvl1_kkod = *blank
7.15 c                   eval      vhgrl1_ogr  = vvogrp
7.15 c                   eval      vhgrl1_hgr  = vvhgrp
7.15 c     vhgrl1_key    chain     vhgrl1
7.15 c                   if        %found(vhgrl1)
7.15 c                   eval      vkhvl1_kkod = vghkhv
7.15 c                   endif
7.15 c                   endif
7.15  *  ktohnv fra overgruppe
7.15 c                   if        vkhvl1_kkod = *blank
7.15 c                   eval      vogrl1_ogr  = vvogrp
7.15 c     vogrl1_key    chain     vogrl1
7.15 c                   if        %found(vogrl1)
7.15 c                   eval      vkhvl1_kkod = vgokhv
7.15 c                   endif
7.15 c                   endif
7.15  *  Vare ikke funnet
7.15 c                   endif
7.15  *  ktohnv fra Statusregister
7.15 c                   if        vkhvl1_kkod = *blank
7.15 c     fstsl1_key    chain     fstsl1
7.15 c                   if        %found(fstsl1)
7.15 c                   eval      vkhvl1_kkod = faakhv
7.15 c                   endif
7.15 c                   endif
7.15  *
7.15 c                   eval      vkhvl1_klty = *zero
7.15 c                   eval      vkhvl1_koty = 'FP'
7.15 c     vkhvl1_key    chain     vkhvl1
7.15 c                   if        %found(vkhvl1)
7.15 c                   eval      rpvkto = vakko7
7.15 c                   endif
7.15  *
7.15 c                   endsr
7.15  *
7.15  *  _________________________________________________________________________
7.15  *  Hente omregningsfaktorer på varen
7.15  *  _________________________________________________________________________
7.15  *
7.15  *
7.15 c     HentOmrF      begsr
7.15  *
7.15 c                   eval      w_omr1 = *zero
7.15 c                   eval      w_omr2 = *zero
7.15  *
7.15 c                   eval      vvenl1_firm = rpvfir
7.15 c                   eval      vvenl1_vare = rpvvar
7.15 c                   eval      vvenl1_enhe = ndenhe
7.15 c     vvenl1_key    chain     vvenl1
7.15 c                   if        %found(vvenl1)
7.15 c                   eval      w_omr1 = veomre
7.15 c                   endif
7.15  *
7.19 c*                  eval      vvenl1_firm = rpvfir
7.19 c*                  eval      vvenl1_vare = rpvvar
7.19 c*                  eval      vvenl1_enhe = vvenhe
7.19 c*    vvenl1_key    chain     vvenl1
7.19 c*                  if        %found(vvenl1)
7.19 c                   eval      vvenl5_firm = rpvfir
7.19 c                   eval      vvenl5_vare = rpvvar
7.19 c                   eval      vvenl5_saen = 1
7.19 c     vvenl5_key    chain     vvenl5
7.19 c                   if        %found(vvenl5)
7.19 c                   eval      w_omr2 = veomre
7.15 c                   endif
7.15  *
7.15 c                   endsr
7.15  *
7.15  *  _________________________________________________________________________
7.15  *  Hente pris fra prisberegning
7.15  *  _________________________________________________________________________
7.15  *
7.15 c     HentPris      begsr
7.15 c                   eval      p_firm = w_firm
7.15 c                   eval      p_vare = rpvvar
7.15 c                   eval      p_prgr = *blank
7.15 c                   eval      p_enhe = rpvenh
7.15 c                   time                    p_dato
7.15 c                   time                    p_time
7.15 c                   call      'VP700R'
7.15 c                   parm                    p_firm
7.15 c                   parm                    p_vare
7.15 c                   parm                    p_prgr
7.15 c                   parm                    p_enhe
7.15 c                   parm                    p_lety
7.15 c                   parm                    p_dato
7.15 c                   parm                    p_time
7.15 c                   parm                    p_inlr
7.15 c                   parm                    p_sapr
7.15 c                   parm                    p_bupr
7.15 c                   parm                    p_tpri
7.15 c                   parm                    p_kopr
7.15  *
7.15 c                   endsr
7.15k * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.15k * Opretter EDHE/EDDT hvis den ikke allerede finner - kalles fra valg 8
7.15k * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.15k *
7.15kc     lag_skygge    begsr
7.15k *
7.15kc                   eval      nohel1_tell = b1tell
7.15kc                   eval      nohel1_fsys = b1fsys
7.15kc     nohel1_key    chain     nohel1
7.15k *
7.15kc                   eval      nodtl1_tell = b1tell
7.15kc                   eval      nodtl1_fsys = b1fsys
7.15kc     nodtl1_key    setll     nodtl1
7.15kc     nodtl1_key    reade     nodtl1
7.15kc                   dow       not %eof
7.15kc                   if        xxvare <> *blanks
7.15k * Opprett vare på sideregister
7.15kc                   exsr      add_linje
7.15kc                   else
7.15k * Tekstlinje
7.15kc                   exsr      add_textl
7.15kc                   endif
7.15kc     nodtl1_key    reade     nodtl1
7.15kc                   enddo
7.15k *
7.15kc                   endsr
7.15k *
7.15k * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.15k * Subrutine for å legge ut varer på sideregister
7.15k * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.15k *
7.15kc     add_linje     begsr
7.15k *
7.15k * Legg ut linje på sideregister
7.15k *
7.15kc                   eval      vvarl1_vare = xxvare
7.15kc     vvarl1_key    chain     vvarl1
7.15kc                   if        not %found
7.15kc                   eval      vvnobb = 0
7.15kc                   eval      vvldor = 0
7.15kc                   eval      vvlvar = *blanks
7.15kc                   endif
7.15k *
7.15kc                   eval      vlagl1_lage = nolage
7.15kc                   eval      vlagl1_vare = xxvare
7.15kc     vlagl1_key    chain     vlagl1
7.15kc                   if        not %found
7.15kc                   eval      vlvtyp = *blanks
7.15kc                   eval      vlbldo = 0
7.15kc                   endif
7.15k *
7.15kc                   if        vlvtyp = 'L'
7.15kc                   eval      eddtlu_ldor = 0
7.15kc                   else
7.15kc                   eval      eddtlu_ldor = vvldor
7.15kc                   if        vlbldo <> 0
7.15kc                   eval      eddtlu_ldor = vlbldo
7.15kc                   endif
7.15kc                   endif
7.15k *
7.15kc                   if        xxldat <> *loval
7.15kc                   eval      eddtlu_ldat = xxldat
7.15kc                   endif
7.15k *
7.15kc                   if        eddtlu_ldat = *loval
7.15kc                   eval      eddtlu_ldat = noldat
7.15kc                   endif
7.15k *
7.15kc                   if        eddtlu_ldat = *loval
7.15kc                   time                    eddtlu_ldat
7.15kc                   endif
7.15k *
7.15kc                   eval      eddtlu_fsys = b1fsys
7.15kc                   eval      eddtlu_tell = b1tell
7.15kc**                 eval      eddtlu_ldor = 0
7.15kc                   eval      eddtlu_line = xxline
7.15kc     eddtlu_key    chain     eddtlu
7.15k *
7.15kc                   if        not %found(eddtlu)
7.15kc                   clear                   eddtlur
7.15kc                   eval      edfirm = w_firm
7.15kc                   eval      edfsys = b1fsys
7.15kc                   eval      edtell = b1tell
7.15kc                   eval      edldor = eddtlu_ldor
7.15kc                   eval      x_ldor = eddtlu_ldor
7.15kc                   eval      edldat = eddtlu_ldat
7.15kc                   eval      edline = xxline
7.15kc                   time                    edodat
7.15kc                   time                    edotim
7.15kc                   eval      edousr = l_user
7.15k * Hent vareinfo
7.15kc                   eval      edvare = xxvare
7.15kc                   eval      edenhe = xxenhe
7.15kc                   eval      edlety = xxlety
7.15kc                   eval      edtek1 = xxtek1
7.15kc                   eval      edtek2 = xxtek2
7.15kc                   eval      ednref = xxnref
7.15kc                   eval      edanta = xxanta
7.15kc                   eval      ednobb = vvnobb
7.15kc                   eval      edlvar = vvlvar
7.15k *
7.15kc                   time                    ededat
7.15kc                   time                    edetim
7.15kc                   eval      edeusr = l_user
7.15k *
7.15kc                   write     eddtlur
7.15k *
7.15k * Legg ut hodet hvis ikke dette finnes
7.15k *
7.15kc                   eval      edhelu_fsys = b1fsys
7.15kc                   eval      edhelu_tell = b1tell
7.15kc                   eval      edhelu_ldat = edldat
7.15kc                   eval      edhelu_ldor = eddtlu_ldor
7.15kc     edhelu_key    chain     edhelu
7.15k *
7.15kc                   if        not %found
7.15kc                   clear                   edhelur
7.15kc                   eval      eofirm = w_firm
7.15kc                   eval      eofsys = b1fsys
7.15kc                   eval      eotell = b1tell
7.15kc                   eval      eoldat = edldat
7.15kc                   eval      eoldor = eddtlu_ldor
7.15kc                   time                    eoodat
7.15kc                   time                    eootim
7.15kc                   eval      eoousr = l_user
7.15k *
7.15kc                   eval      eonref = nonref
7.15kc                   eval      eolage = nolage
7.15kc                   eval      eoavde = noavde
7.15kc                   eval      eouser = nouser
7.15kc                   eval      eokund = nokund
7.15kc                   eval      eoknav = noknav
7.15kc                   eval      eokpro = nokpro
7.15kc                   eval      eopnav = nopnav
7.15kc                   eval      eonavn = nonavn
7.15kc                   eval      eoadr1 = noadr1
7.15kc                   eval      eoadr2 = noadr2
7.15kc                   eval      eoponr = noponr
7.15kc                   eval      eosted = nosted
7.15kc                   eval      eolety = nolety
7.15kc                   eval      eodref = nodref
7.15kc                   eval      eorekv = norekv
7.15kc                   eval      eounav = nounav
7.15kc                   eval      eoutlf = noutlf
7.15kc                   eval      eoumob = noumob
7.15kc                   eval      eoufax = noufax
7.15kc                   eval      eoumai = noumai
7.15kc                   eval      eobdat = nobdat
7.15kc                   eval      eolmat = nolmat
7.15k *
7.15kc                   write     edhelur
7.15kc                   else
7.15kc                   unlock    edhelu
7.15kc                   endif
7.15k *
7.17 c                   else
7.17 c                   unlock    eddtlu
7.15kc                   endif
7.15k *
7.15kc                   endsr
7.15k *
8.02  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
8.02  * Sørg for at alle linjer har leveringsdato. Hvis ikke splittes
8.02  * ordren unødvendig.
8.02  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
8.02  *
8.02 c     sjk_levdato   begsr
8.02  *
8.02 c                   eval      s_ldat = noldat
8.02  *
8.02 c                   eval      nodtlu_tell = b1tell
8.02 c                   eval      nodtlu_fsys = b1fsys
8.02 c     nodtlu_key    setll     nodtlu
8.02 c     nodtlu_key    reade     nodtlur
8.02 c                   dow       not %eof
8.02 c                   eval      c_ldat = *loval
8.02 c                   if        %trim(ndvare) <> *blanks
8.02 c                   eval      l_ldat = ndldat
8.02 c                   endif
8.02  *
8.02 c                   if        %trim(ndvare) = *blanks and
8.02 c                             ndldat = *loval and
8.02 c                             l_ldat = *loval
8.02 c                   eval      c_ldat = noldat
8.02 c                   elseif    %trim(ndvare) = *blanks and
8.02 c                             ndldat = *loval and
8.02 c                             l_ldat = s_ldat
8.02 c                   eval      c_ldat = noldat
8.02 c                   elseif    %trim(ndvare) = *blanks and
8.02 c                             ndldat = *loval and
8.02 c                             l_ldat <> *loval and
8.02 c                             l_ldat <> s_ldat
8.02 c                   eval      c_ldat = l_ldat
8.02 c                   elseif    %trim(ndvare) = *blanks and
8.02 c                             ndldat = s_ldat
8.02 c                   eval      c_ldat = noldat
8.02 c                   endif
8.02  *
8.02 c                   if        %trim(ndvare) <> *blanks and
8.02 c                             ndldat = s_ldat
8.02 c                   eval      c_ldat = noldat
8.02 c                   elseif    %trim(ndvare) <> *blanks and
8.02 c                             ndldat <> s_ldat
8.02 c                   eval      c_ldat = ndldat
8.02 c                   endif
8.02  *
8.02 c                   eval      ndldat = c_ldat
8.02 c                   update    nodtlur
8.02 c     nodtlu_key    reade     nodtlur
8.02 c                   enddo
8.02  *
8.02 c                   endsr
8.02  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
7.15  *
7.15  * Parametre
7.15  *
7.15 c     *entry        plist
7.15 c                   parm                    p_kode
7.15 c                   parm                    p_pros
7.15 c                   parm                    p_upro
7.15 c                   parm                    p_akti
7.15 c                   parm                    p_kpro
      *
      * Key for posisjonering på referanse
      *
     c     nohel2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nohel2_nref
      *
      * Key for posisjonering på kundenavn
      *
     c     nohel3_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nohel3_knav
      *
      * Key for posisjonering på kundeprosjektnavn
      *
     c     nohel4_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nohel4_pnav
      *
      * Key for posisjonering på bruker-id
      *
     c     nohel5_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nohel5_user
      *
      * Key for posisjonering på system
      *
     c     nohel6_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nohel6_fsys
      *
      * Key for les på ekstern ordre-hode
      *
     c     nohelr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nohelr_fsys
     c                   kfld                    nohelr_tell
7.0x  *
7.0x  * Key for les på ekstern ordre-hode
7.0x  *
7.0x c     nohel1_key    klist
7.0x c                   kfld                    w_firm
7.0x c                   kfld                    nohel1_fsys
7.0x c                   kfld                    nohel1_tell
      *
      * Key for oppslag på leveringstype
      *
     c     vltpl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vltpl1_lety
      *
      * Key for oppslag på bruker
      *
     c     ausrl1_key    klist
     c                   kfld                    ausrl1_user
      *
      * Key for oppslag på ofak-bruker
      *
     c     fusrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fusrl1_user
      *
      * Key for oppslag på kunde
      *
     c     rkunl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl1_kund
      *
      * Key for oppslag på kundeprosjekt
      *
     c     fkprl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fkprl1_kund
     c                   kfld                    fkprl1_kpro
      *
      * Key for oppdatering av ekstern ordre-hode
      *
     c     nohelu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nohelu_fsys
     c                   kfld                    nohelu_tell
      *
      * Key for les på ekstern ordre-linje
      *
     c     nodtlr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nodtlr_fsys
     c                   kfld                    nodtlr_tell
7.0x  *
7.0x  * Key for les på ekstern ordre-linje
7.0x  *
7.0x c     nodtl1_key    klist
7.0x c                   kfld                    w_firm
7.0x c                   kfld                    nodtl1_fsys
7.0x c                   kfld                    nodtl1_tell
      *
      * Key for oppdatering av ekstern ordre-linje
      *
     c     nodtlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nodtlu_fsys
     c                   kfld                    nodtlu_tell
7.01  *
7.01  * Key for oppslag på EDI melding-linje
7.01  *
7.01 c     eddtl1_key    klist
7.01 c                   kfld                    w_firm
7.01 c                   kfld                    eddtl1_fsys
7.01 c                   kfld                    eddtl1_tell
6.34 c                   kfld                    eddtl1_ldor
6.34 c                   kfld                    eddtl1_ldat
7.01 c                   kfld                    eddtl1_line
7.0x  *
7.0x  * Key for oppdatering av ekstern ordre-linje
7.0x  *
7.0x c     eddtl3_key    klist
7.0x c                   kfld                    w_firm
7.0x c                   kfld                    eddtl3_fsys
7.0x c                   kfld                    eddtl3_tell
7.0x c                   kfld                    eddtl3_line
6.35  *
6.35  * Key for oppdatering av ekstern ordre-hode
6.35  *
6.35 c     edhelu_key    klist
6.35 c                   kfld                    w_firm
6.35 c                   kfld                    edhelu_fsys
6.35 c                   kfld                    edhelu_tell
6.35 c                   kfld                    edhelu_ldor
6.35 c                   kfld                    edhelu_ldat
7.0x  *
7.0x  * Key for oppdatering av ekstern ordre-hode
7.0x  *
7.0x c     edhelu_key3   klist
7.0x c                   kfld                    w_firm
7.0x c                   kfld                    edhelu_fsys
7.0x c                   kfld                    edhelu_tell
7.0x  *
7.09  * Key for oppdatering av ekstern ordre-hode
7.09  *
7.09 c     edhel4_key    klist
7.09 c                   kfld                    w_firm
7.09 c                   kfld                    edhel4_fsys
7.09 c                   kfld                    edhel4_tell
6.35  *
6.35  * Key for oppslag på EDI melding-linje
6.35  *
6.35 c     eddtlu_key    klist
6.35 c                   kfld                    w_firm
6.35 c                   kfld                    eddtlu_fsys
6.35 c                   kfld                    eddtlu_tell
6.35 c                   kfld                    eddtlu_ldor
6.35 c                   kfld                    eddtlu_ldat
7.0x c                   kfld                    eddtlu_line
7.0x  *
7.0x  * Key for oppdatering av ekstern ordre-linje
7.0x  *
7.0x c     eddtlu_key2   klist
7.0x c                   kfld                    w_firm
7.0x c                   kfld                    eddtlu_fsys
7.0x c                   kfld                    eddtlu_tell
7.0x c                   kfld                    eddtlu_ldor
7.0x c                   kfld                    eddtlu_ldat
7.10  *
7.10  * Key for oppdatering av ekstern ordre-linje
7.10  *
7.10 c     eddtlu_key3   klist
7.10 c                   kfld                    w_firm
7.10 c                   kfld                    eddtlu_fsys
7.10 c                   kfld                    eddtlu_tell
7.0x  *
7.0x  * Key for les på lager
7.0x  *
7.0x c     vlagl1_key    klist
7.0x c                   kfld                    w_firm
7.0x c                   kfld                    vlagl1_vare
7.0x c                   kfld                    vlagl1_lage
7.0x  *
7.0x  * Key for les på varer
7.0x  *
7.0x c     vvarl1_key    klist
7.0x c                   kfld                    w_firm
7.0x c                   kfld                    vvarl1_vare
      *
      * Key for ekstern ordre kode
      *
     c     nkeolr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nkeolr_kode
7.15  *
7.15  * Key for les Hovedgruppe
7.15  *
7.15 c     vogrl1_key    klist
7.15 c                   kfld                    w_firm
7.15 c                   kfld                    vogrl1_ogr
7.15  *
7.15  * Key for les Overgruppee
7.15  *
7.15 c     vhgrl1_key    klist
7.15 c                   kfld                    w_firm
7.15 c                   kfld                    vhgrl1_ogr
7.15 c                   kfld                    vhgrl1_hgr
7.15  *
7.15  * Key for les Undergruppe
7.15  *
7.15 c     vugrl1_key    klist
7.15 c                   kfld                    w_firm
7.15 c                   kfld                    vugrl1_ogr
7.15 c                   kfld                    vugrl1_hgr
7.15 c                   kfld                    vugrl1_ugr
7.15  *
7.15  * Key for les statusregister
7.15  *
7.15 c     fstsl1_key    klist
7.15 c                   kfld                    w_firm
7.15  *
7.15  * Key for les kontohenvisning
7.15  *
7.15 c     vkhvl1_key    klist
7.15 c                   kfld                    w_firm
7.15 c                   kfld                    vkhvl1_kkod
7.15 c                   kfld                    vkhvl1_klty
7.15 c                   kfld                    vkhvl1_koty
7.15  *
7.15  * Key for les enheter for omberenging
7.15  *
7.15 c     vvenl1_key    klist
7.15 c                   kfld                    w_firm
7.15 c                   kfld                    vvenl1_vare
7.15 c                   kfld                    vvenl1_enhe
7.15  *
7.15  * Key for les av budjsetterte varer på prosejkt
7.15  *
7.15 c     rpval1_key    klist
7.15 c                   kfld                    w_firm
7.15 c                   kfld                    rpval1_pros
7.15 c                   kfld                    rpval1_upro
7.15 c                   kfld                    rpval1_akti
7.15 c                   kfld                    rpval1_vare
7.15 c                   kfld                    rpval1_lass
7.19  *
7.19  * Key for les enheter for omberenging
7.19  *
7.19 c     vvenl5_key    klist
7.19 c                   kfld                    w_firm
7.19 c                   kfld                    vvenl5_vare
7.19 c                   kfld                    vvenl5_saen
8.04  *
8.04  * Key for les av prosjekt
8.04  *
8.04 c     rp1pl1_key    klist
8.04 c                   kfld                    w_firm
8.04 c                   kfld                    rp1pl1_pros
8.06  *
8.06  * Key for oppdatering av ekstern ordre-hode
8.06  *
8.06 c     edh2l1_key    klist
8.06 c                   kfld                    w_firm
8.06 c                   kfld                    edh2l1_fsys
8.06 c                   kfld                    edh2l1_tell
8.06 c                   kfld                    edh2l1_ldor
8.06 c                   kfld                    edh2l1_ldat
8.06  *
8.06  * Key for oppdatering av ekstern ordre-hode
8.06  *
8.06 c     edh2l4_key    klist
8.06 c                   kfld                    w_firm
8.06 c                   kfld                    edh2l4_fsys
8.06 c                   kfld                    edh2l4_tell
      *
      * Henter firma fra LDA
      *
     c                   eval      w_firm = l_firm
      *
      * Initierer skjermbildet
      *
     c                   eval      *in22 = *on
7.27  *
7.27  * Endring 7.27
7.27  *
7.27   CallP CO402R(l_filg:w_firm:0:'EKSTORDRE_TILORDRE_UKJENT_VARE_OK':
7.27                    co402_verdi1:co402_verdi2);
7.27   if co402_verdi1 = '1';
7.27     ukjent_vare_ok = *on;
7.27   endif;
8.05  *
8.05  * Endring 7.27
8.05  *
8.05   CallP CO402R(l_filg:w_firm:0:'HENTE_ORDRE_FRA_EDI':
8.05                    co402_verdi1:co402_verdi2);
8.05   if co402_verdi1 = '1';
8.05     b_edi = *on;
8.05   endif;
      *
      * Posisjonerer databasen, og fyller opp subfile
      *
7.24 c**                 eval      nohel2_nref = *blank
7.24 c**   nohel2_key    setll     nohel2
7.24 c                   eval      nohel6_fsys = *blanks
7.24 c     nohel6_key    setll     nohel6
      *
     c                   exsr      crt_subfile
      *
     c                   endsr
      *
** Meldinger
Kan ikke overføres, inneholder ikke lagervarer
Kan ikke overføres, inneholder ikke skaffevarer
Kan ikke overføres, status må være < 9
Kan ikke overføres, kan ikke være feilkoder
Kan ikke overføres, EDI ordre kan ikke splittes opp
Ordren er allerede overført.
