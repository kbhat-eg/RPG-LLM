      /TITLE  Oppslag mot rutine-register
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Program . . . . : AA609R
      * Beskrivelse . . : Oppslag mot PDF parametre
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- - - - - - - - - - - - - - - - - - - - - - - - - -
      *       150410 BSA  Nytt program
6.10  * 6.10  091210 BSA  Henter inn FIFO folder
6.11  * 6.10  150211 BSA  Henter inn Fakturainfomasjon eller ei.
6.20  * 6.20  060913 BSA  Legger inn parameter for bruk av Dataq
6.21  * 6.20  081013 BSA  Legger inn parameter for signatur på pakkseddel
7.01  * K000  050620 BSA  Henter filgruppa fra parameter.
      *
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     fafopl1    if   e           k disk    rename(afoppfr:afopl1r)
     fafapl1    if   e           k disk    rename(afappfr:afapl1r)
     fafpslr    if   e           k disk    rename(afpspfr:afpslrr)
      *
     d                uds
     d l_filg                931    933
     d l_firm                944    946  0
     d l_avde                947    950  0
      *
      * Definering av parametre
      *
     d p_ruti          s                   like(afprut)
     d p_pdf           s                   like(afppdf)
     d p_pdf_ds        s            512
7.01 d p_filg          s              3
      *
      * Definering av variabler i nøkler
      *
     d afopl1_ruti     s                   like(afprut)
     d afapl1_arut     s                   like(afarut)
     d afapl1_afir     s                   like(afafir)
     d afapl1_aavd     s                   like(afaavd)
     d afpslr_ufil     s                   like(l_filg)
     d afpslr_uide     s                   like(afuide)
      *
      * Definering av variable
      *
     d d_pdf           ds
     d  d_mail                        1  0
     d  d_exlp                        1  0
     d  d_arki                        1  0
     d  d_skje                        1  0
     d  d_land                        1  0
     d  d_xmlm                       75
     d  d_jasm                       75
     d  d_logo                       75
     d  d_emal                       50
      *
      *
     d w_pdf_ds        ds
     d  w_xmlm                       75
     d  w_jasm                       75
     d  w_logo                       75
     d  w_path                      100
     d  w_emal                       50
6.10 d  w_fifo                       75
6.10 d  w_kopi                        1
6.20 d  w_dtaq                        1
6.21 d  w_sign                        1
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Hent inn post fra formularregister                              *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c                   eval      w_pdf_ds = *blanks
      * Sjekk først om det finnes avvik på firma og avdelingsnivå.
     c                   eval      afapl1_arut = p_ruti
     c                   eval      afapl1_afir = l_firm
     c                   eval      afapl1_aavd = l_avde
     c     afapl1_key    chain     afapl1r
     c                   if        %found and
     c                             afapdf = 1
     c                   eval      p_pdf = afapdf
     c                   eval      d_mail = afamai
     c                   eval      d_exlp = afaexl
     c                   eval      d_arki = afaarc
     c                   eval      d_skje = afaprv
     c                   eval      d_land = afalan
     c                   eval      d_xmlm = afaxlm
     c                   eval      d_jasm = afajas
     c                   eval      d_logo = afalog
     c****               eval      d_pdf = afpdss
     c                   else
      *
     c                   eval      afopl1_ruti = p_ruti
     c     afopl1_key    chain     afopl1r                            60
      *
     c                   if        *in60 = *off and
     c                             afppdf = 1
     c                   eval      p_pdf = afppdf
     c                   eval      d_mail = afpmai
     c                   eval      d_exlp = afpexl
     c                   eval      d_arki = afparc
     c                   eval      d_skje = afpprv
     c                   eval      d_land = afplan
     c                   eval      d_xmlm = afpxlm
     c                   eval      d_jasm = afpjas
     c                   eval      d_logo = afplog
     c***                eval      d_pdf = afpdss
     c                   endif
     c                   endif
      *
      * Finn hvor xml'en skal legges
      *
7.01 c**                 eval      afpslr_ufil = l_filg
7.01 c                   eval      afpslr_ufil = p_filg
     c                   eval      afpslr_uide = 'XMLPATH   '
     c     afpslr_key    chain     afpslrr
     c                   if        %found
     c                   eval      w_path = *blanks
     c                   movel     afudss        w_path
     c                   endif
6.10  *
6.10  * Finn hvor xml'en skal legges
6.10  *
6.10 c                   eval      w_fifo = *blanks
7.01 c**                 eval      afpslr_ufil = l_filg
7.01 c                   eval      afpslr_ufil = p_filg
6.10 c                   eval      afpslr_uide = 'FIFOFOLDER'
6.10 c     afpslr_key    chain     afpslrr
6.10 c                   if        %found
6.10 c                   movel     afudss        w_fifo
6.10 c                   endif
6.11  *
6.11  * Finn om det skal benyttes skriver papirkopier av faktura
6.11  *
6.11 c                   eval      w_kopi = '0'
7.01 c**                 eval      afpslr_ufil = l_filg
7.01 c                   eval      afpslr_ufil = p_filg
6.11 c                   eval      afpslr_uide = 'FAKTKOPI  '
6.11 c     afpslr_key    chain     afpslrr
6.11 c                   if        %found
6.11 c                   movel     afudss        w_kopi
6.11 c                   endif
      *
      * Finn default path til logo, nb kun hvis ikke annen er funnet tidligere
      *
     c                   if        %trim(d_logo) = *blanks
     c                   eval      afpslr_uide = 'LOGO      '
     c     afpslr_key    chain     afpslrr
     c                   if        %found
     c                   eval      d_logo = *blanks
     c                   movel     afudss        d_logo
     c                   endif
     c                   endif
      *
      * Finn default e-post adresse for mottaker av mail
      *
7.01 c**                 eval      afpslr_ufil = l_filg
7.01 c                   eval      afpslr_ufil = p_filg
     c                   eval      afpslr_uide = 'DFTEMAIL  '
     c     afpslr_key    chain     afpslrr
     c                   if        %found
     c                   eval      w_emal = *blanks
     c                   movel     afudss        d_emal
     c                   endif
6.20  *
6.20  * Finn om det skal benyttes skriver papirkopier av faktura
6.20  *
6.20 c                   eval      w_dtaq = '0'
7.01 c**                 eval      afpslr_ufil = l_filg
7.01 c                   eval      afpslr_ufil = p_filg
6.20 c                   eval      afpslr_uide = 'DATAQ     '
6.20 c     afpslr_key    chain     afpslrr
6.20 c                   if        %found
6.20 c                   movel     afudss        w_dtaq
6.20 c                   endif
6.21  *
6.21  * Finn om det skal være signatur på pakksedler
6.21  *
6.21 c                   eval      w_sign = '0'
7.01 c**                 eval      afpslr_ufil = l_filg
7.01 c                   eval      afpslr_ufil = p_filg
6.21 c                   eval      afpslr_uide = 'SIGNPAKK  '
6.21 c     afpslr_key    chain     afpslrr
6.21 c                   if        %found
6.21 c                   movel     afudss        w_sign
6.21 c                   endif
      *
     c                   eval      w_xmlm = d_xmlm
     c                   eval      w_jasm = d_jasm
     c                   eval      w_logo = d_logo
     c                   eval      w_emal = d_emal
     c                   eval      p_pdf_ds = w_pdf_ds
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Avslutt program                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      * Parameterliste
      *
     c     *entry        plist
7.01 c                   parm                    p_filg
     c                   parm                    p_ruti
     c                   parm                    p_pdf
     c                   parm                    p_pdf_ds
      *
      * Key for rutineregister
      *
     c     afopl1_key    klist
     c                   kfld                    afopl1_ruti
      *
      * Key for avvikende pdf informasjon
      *
     c     afapl1_key    klist
     c                   kfld                    afapl1_arut
     c                   kfld                    afapl1_afir
     c                   kfld                    afapl1_aavd
      *
      * Key for propertiesfil
      *
     c     afpslr_key    klist
     c                   kfld                    afpslr_ufil
     c                   kfld                    afpslr_uide
      *
     c                   endsr
      *
