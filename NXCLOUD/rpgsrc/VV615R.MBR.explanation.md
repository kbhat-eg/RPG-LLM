# Program Overview

This IBM ILE RPG program (`VV615R`) is intended for parameter handling and print control of product coverage, with interface to XLS (Excel) and integration with the IFS (integrated file system). It's tailored for a Norwegian-speaking business system and interacts with various master and transaction files.

The code is structured to:
- Display a parameter input screen.
- Validate user input against master files.
- Allow field-based inquiries (lookups).
- Assemble parameters into a structure.
- Call a transfer (processing) program (`VV615C`).
- Show job status information.

---

## 1. Header & File Specifications

- `h option(*nodebugio) datedit(*dmy)`
  - Disables debug I/O.
  - Specifies date editing in Day/Month/Year format.

- File Declarations:
  - Several physical files are declared with `rename` to use unique record format names for this program:
    - `vogrl1` - Over group master
    - `vhgrl1` - Main group master
    - `vugrl1` - Subgroup master
    - `ra06l1` - Discount category
    - `ra10l1` - Warehouse group (added in version 6.33)
    - `rkunl1` - Customer master
    - `fkprl1` - Customer project master

- `vv615d` - Display file for the program's workstation interface.

---

## 2. Data Structures and Variables

- Extracts relevant fields from the local data area (LDA), e.g., company number (`l_firm`), warehouse (`l_lage`).

- Defines `d_list`, a DS (data structure) that overlays a char(44) field for parameter passing between programs:
  - Contains fields like company, group codes, customer/project numbers, date, warehouse, etc.

- Defines variables for the keys used to access each master file.

- Control and work variables (error flags, date, time, messages, etc.).

---

## 3. Mainline Logic

### Displaying and Processing the Input Panel

- **Initialization**
  - Sets the initial value for the warehouse field from the local data area.
  - The display (`b1bld`) is shown with `exfmt`.

- **Function Key Processing**
  - If function key KC or KL pressed, exit.
  - If KD pressed, call the inquiry subroutine to perform a lookup for the active input field, redisplay the screen.

- **Input Validation**
  - Calls subroutine `sjekk_inp` to check values entered; if errors, redisplay the screen.

- **Parameter Assembly**
  - Moves entered and validated screen fields into `d_list` for parameter passing.

- **Defaults Handling**
  - If discount category "to" is zero, it defaults to 999.

- **Call Transfer Program**
  - Calls external program `'VV615C'` with the assembled parameter structure.

- **Time Stamping**
  - Captures the time and writes a status message indicating job start.

---

## 4. Subroutines

### Inquiry (`spørring`)
Handles function key KD to look up codes for the field currently active (`w_afld`):

- Group codes (over, main, under) call programs `VG510R`, `VG511R`, `VG512R`.
- Discount categories call `RA506R`.
- Customer and project call `RK500R` and `FL500R`.
- Results are returned via parameters for display.

### Input Validation (`sjekk_inp`)
Validates the user input for each field:

- Each code entered (group, discount, customer, project, etc.) is checked by:
  - Setting the key variables.
  - Doing a keyed CHAIN to the relevant master file.
  - If not found, sets an error indicator and error flags.

- For date fields:
  - If empty, fills with current date.
  - Tests for a valid date format and sets error flag on failure.

### Initialization (`*inzsr`)
- Sets up key lists for each master file lookup.
- Loads company from LDA.
- Initializes screen fields with default values.

---

## 5. Error Handling

- Errors found during validation set the `b_feil` flag and set appropriate indicator fields (`*inxx`) for the display file to highlight errors.

---

## 6. Special Notes

- All parameter fields are zero-initialized (or blank) by default.
- Extensive use of overlays in data structures allows efficient packing/unpacking for calls between programs.
- Comments and change logs use versioning and initials.
- Some Norwegian is used in comments and variable names (e.g., "Vare" = Product, "kunde" = customer, "rabkat" = discount category).

---

## 7. Main Program Flow (High Level):

```
Initialize fields and keys
Display parameter entry screen

Loop:
    If F3/F12 (KC/KL) pressed, exit
    If F4 (KD) pressed, perform inquiry on active field, redisplay
    Validate all input fields
        If error, redisplay
    Move input fields into parameter structure
    If needed, set default values
    Call processing program with parameters
    Show "Job started" message with time
```

---

## 8. Key Takeaways for Onboarding

- The program is a "parameter front-end": handles validating and collecting parameter data for batch/transfer processing.
- The business logic is mostly enforced via data validation against the master files.
- Adding new fields or validation involves updating the corresponding CHAIN, key lists, error handling, and possibly the DS for parameter passing.
- Inquiries (`spørring`) are handled via subprogram calls depending on which field (code) the user is attempting to look up.

---

**Summary**:  
This program manages parameter entry for a product-coverage reporting function, using display files for user interaction, master file validation, lookups, and structured parameter passing to a back-end process. Error handling and status messaging are tightly integrated, with field-specific validation and inquiry support.