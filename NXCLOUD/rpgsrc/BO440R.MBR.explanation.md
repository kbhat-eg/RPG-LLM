# RPG Program Explanation: BO440R

## Program Purpose

This program, named `BO440R`, is part of the "ASSHOP" system. Its main function is to remove (delete) records from a historical receipt (bong) register, based on parameters entered by the user through a display screen.

## Structure Overview

- **File Specification**
  - `fbo440d    cf   e             workstn`
    - Defines a display file (`bo440d`) used for user interaction.
- **Data Definitions**
  - **LDA (Local Data Area):** Used to store and retrieve environment-specific data, such as company code (`dsfirm`).
  - **Working Variables:**
    - `w_dato`: Date value in ISO format.
    - `w_afir`: 3-character field, probably for company or environment identification.
    - `w_feil`: 1-character field, used as an error flag.

---

## Main Logic Flow

### 1. Initial Input Screen

- **Tags:** The program uses labels (`b1tag`, `b1taga`) to control the program flow.
- **Data Entry:** The user is presented with a screen (`b1bld`) to enter parameters (date, company, etc.).
- **Function Keys:**
  - **F3:** Exit (`*inkc`, branch to `xslutt`).
  - **F12:** Cancel (`*inkl`, branch to `b1tag` to restart input).
- **Input Validation:** After user input, the program calls a validation subroutine (`sjkinp`). If errors are found (`w_feil = '1'`), the input loop restarts.

### 2. Processing

- **Parameter Preparation:**
  - `w_afir` is loaded with the company/environment code from the LDA (`dsfirm`).
  - If a date is entered, it's converted to ISO date and stored in `w_dato`.
- **Calling Deletion Program:**
  - Calls program `BO441C`, passing the company/firm code and the date (`w_afir`, `w_dato`). This external program likely performs the actual deletion from the bong register.

### 3. Program Exit

- **Tag `xslutt`:**
  - Sets LR (`*inlr`) on, signalling end of program.
  - Returns to caller.

---

## Subroutines

### 1. `sjkinp` — Input Field Validation

- **Initialization:** Turns off error indicator (`*in32`).
- **Checks:**
  - If the date is zero/missing, sets error indicator (`*in31`), marks error (`w_feil = '1'`), and exits subroutine.
  - Validates the date format with `TEST(D)`. If invalid, marks error.
- **Leaves subroutine after checks.**

### 2. `*inzsr` — Initialization Subroutine

- **Runs at program start.**
- **Initializes:** 
  - Associates the local data area (`LDA`) to the `lda` data structure.
  - Clears working variables (`w_afir` and `w_feil`).

---

## Key RPG Techniques Used

- **Workstation File:** For user interaction.
- **LDA:** For system/environment parameter passing.
- **Subroutines:** For reused logic (validation, initialization).
- **Indicators:** For managing screens, errors, and program flow.
- **Parameter Passing:** To call another program to do the actual deletion.

---

## Main Variables Explained

| Variable   | Type      | Purpose                                |
|------------|-----------|----------------------------------------|
| `w_dato`   | Date      | Holds the entry date in ISO format     |
| `w_afir`   | Char(3)   | Holds the company/environment code     |
| `w_feil`   | Char(1)   | Error flag ('1' = error found)         |
| `dsfirm`   | Zoned(3,0)| Company code from LDA                  |

---

## High-Level Workflow Diagram

```
[Start] 
   |
[*inzsr - Initialization]
   |
[b1tag:]
   |
[Show input screen (b1bld)]
   |
[User enters data / presses F3 or F12]
   |
[If F3: Exit]   [If F12: Re-show input]   [Else: Validate input (sjkinp)]
                                         |
                                [If error: Re-show input]
                                         |
                                [Else: Prepare params]
                                         |
                            [Call BO441C with company and date]
                                         |
                                      [Exit]
```

---

## Conclusion

This program is a typical interactive RPG parameter collection/preparation program. It gathers input using a display file, validates the entry, formats parameters, and then calls another program to do the actual removal from a register. Error handling and screen looping are managed with RPG indicators and subroutines.