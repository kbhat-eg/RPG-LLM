     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOFAK
      * Program . . . . : FO103R
      * Beskrivelse . . : Registrering av Ordre/Tilbud,  Opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      * R3.10 221299 AMD  Lagt inn kontroll på gyldig avdeling
      * R3.11 140900 AMD  Skrevet om til ny standard (avvik ikke anm.)
5.40  * R5.40 060605 AMD  Ved endring av lager på ordrehode, skal ordre-
5.40  *                   linjer oppdateres med valg om hvilke.
5.61  *       270509 AMD  Korrigering av feil i parameterliste ved
5.61  *                   spørring på prosjektnummer (Regnskapsprosj.)
5.70  * PRGR  081208 bof  Utvidet med prisgruppe
5.71  * PRGR  130509 bof  Sjekker om noen varelinjer har vtyp lik S på
5.71  *                   tillager.
5.71  * PRGR  170609 bof  Fjernet 5.71 foreløbig.
6.20  * 6.20  221110 NHO  Proj er nå alfa, Lagt inn underprosjekt.
      *                   Fjernet aktivitet
6.20  * 6.20  231110 bof  Sjekker alltid leveringsmåte
6.21  * 6.21  101111 bof  Må kun fylle ut noe i fors.måte dersom kjøre-
      *                   kontoløsning = 1
6.22  * 6.20  101111 bof  Vise S-varer dersom lager er endret          er
6.24  * 6.20  101111 bof  Sjekker også behandling av skaffevare FAALBE
6.25  * 6.20  101213 bsa  Rekompilert grunnet endringer i skjermfil
6.26  * 6.20  070714 bof  Vise fors.måte tekst, selv om ikke kj.kontor
6.30  * 6.30  160214 bof  Validering av leveringsmåte ifølge AVALPF
6.NU  * R6.30 230514 bsa  Programmet gjennomgått mtp nummerutvidelser.
6.31  * 6.30  290915 bof  Validering av selger  ifølge AVALPF
7.01  * K000  210121 bsa  Feil i parameterlista til RP601.
8.01  *PRG2   090622 BOF  Utvidet prisgruppe fra 1 til 2 posisjoner
8.02  *K000   210225 bsa  Hvis endring av avdeling på hodet, må dette også endre
8.02  *K000               linjer.
8.03  *K000   160525 bsa  Hvis endring av avdeling på hodet, ta med alle varelinjer
8.03  *K000               uten avdeling også.
      *
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     ffo103d    cf   e             workstn
     ffohel1    if   e           k disk    rename(fohepfr:fohel1r)
     ffohelu    uf   e           k disk    rename(fohepfr:fohelur)
8.02 ffodtlu    uf   e           k disk    rename(fodtpfr:fodtlur)
5.71 ffodtl1    if   e           k disk    rename(fodtpfr:fodtl1r)
5.71 fvlagl1    if   e           k disk    rename(vlagpfr:vlagl1r)
6.24 ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
6.30 favall1    if   e           k disk    rename(avalpfr:avall1r)
      *
      * Definering av Local data area
      *
     d                uds
6.10 d l_user                911    920
     d l_sfir                944    946  0
     d l_fnav                951    980
     d l_syst                999    999
      *
      * Definering av parametere
      *
     d p_firm          s                   like(fofirm)
     d p_numm          s                   like(fonumm)
     d p_suff          s                   like(fosuff)
     d p_110d          s                   like(w_alf1)
      *
      * Definering av variable i nøkler
      *
     d w_firm          s                   like(fofirm)
     d fohel1_numm     s                   like(fonumm)
     d fohel1_suff     s                   like(fosuff)
5.71 d fodtl1_numm     s                   like(fdnumm)
5.71 d fodtl1_suff     s                   like(fdsuff)
5.71 d vlagl1_vare     s                   like(vlvare)
5.71 d vlagl1_lage     s                   like(vllage)
6.30 d avall1_apgm     s                   like(avapgm)
      *
      * Definering av variable
      *
     d w_alf1          s              1
3.10 d w_jadr          s             30
3.10 d w_jpnr          s              4  0
3.10 d w_jste          s             30
3.10 d w_javd          s              4  0
     d w_kont          s              5  0
     d w_spes          s              4  0
     d w_retk          s              1
5.40 d w_valg          s              1
5.70 d w_pval          s              1
5.40 d w_in03          s              1
      *
     d w_ikod          s              4  0
     d w_jkod          s              2  0
     d w_qkod          s              2  0
     d w_ukod          s              3
     d w_itxt          s             20
     d w_jtxt          s             20
     d w_qtxt          s             20
     d w_utxt          s             30
     d w_gtxt          s             20
     d w_proj          s                   like(foproj)
     d w_ptx1          s                   like(e1prtx)
     d w_ptx2          s                   like(e1prtx)
     d w_lage          s                   like(folage)
6.20 d*w_akti          s                   like(foakti)
6.20 d w_ptx3          s                   like(e1prtx)
6.20 d w_upro          s              6
6.20 d w_utx1          s                   like(e1prtx)
6.20 d w_utx2          s                   like(e1prtx)
6.20 d w_kund          s                   like(fokund)
6.20 d w_uprs          s              1
     d w_avde          s                   like(foavde)
7.01 d w_rakt          s              1
7.01 d w_fdat          s              6  0
7.01 d w_tdat          s              6  0
7.01 d w_kunf          s              6  0
7.01 d w_knav          s             30
7.01 d w_kpro          s              6  0
7.01 d w_selg          s              4  0
      *
8.02 d s_avde          s                   like(foavde)
      *
6.30  * Firmastyrt validering av felt
6.30  *
6.30 d u_lmat          s              1    inz(*off)
6.31 d u_selg          s              1    inz(*off)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * E1 Behandler vedlikehold av faste opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     e1taga        tag
      *
     c                   eval      e1lmtx = *blank
     c                   eval      e1avtx = *blank
     c                   eval      e1setx = *blank
     c                   eval      e1latx = *blank
     c                   eval      e1prtx = *blank
6.20 c**                 eval      e1aktx = *blank
6.20 c                   eval      e1uptx = *blank
      *
      * Hent opplysninger fra ORDRE-HODE-REGISTER
      *
     c     fohel1_key    chain     fohel1r                            90
     c                   if        *in90 = *off
     c                   move      folmat        e1lmat
     c                   movel     folmtx        e1lmtx
     c                   eval      e1avde = foavde
8.02 c                   eval      s_avde = foavde
     c                   eval      e1selg = foselg
     c                   eval      e1lage = folage
     c                   eval      e1proj = foproj
6.20 c**                 eval      e1akti = foakti
6.20 c                   eval      e1upro = foupro
     c                   eval      w_lage = folage
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandler henting av opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Hent,   Tekst for avdeling
      *
     c                   exsr      sbavde
      *
      * Hent,   Tekst for selger
      *
     c                   exsr      sbselg
      *
      * Hent,   Tekst for lager
      *
     c                   exsr      sblagr
      *
      * Hent,   Tekst for prosjekt
      *
     c                   exsr      sbproj
      *
6.20  **Hent,   Tekst for aktivitet
      *
6.20 c**                 exsr      sbakti
6.20  * Hent,   Tekst for underprosjekt
      *
6.20 c                   exsr      sbupro
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandler skjermbilde  E1
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Send alt
      *
5.40 c                   eval      w_valg = ' '
5.70 c                   eval      w_pval = ' '
5.40 c                   eval      w_in03 = ' '
5.40  *
     c     e1tagb        tag
     c                   exfmt     e1bld
      *
      * F3=Gå tilbake til forrige bilde
      *
     c                   if        *inkc  = *on
     c                   eval      p_110d = '9'
     c                   goto      xslutt
     c                   endif
      *
      * F4=Spørring kan benyttes dersom
      *    ASOKON kjøres.
      *
     c                   if        l_syst = 'A'
     c                   if        *inkd  = *on
     c                   if        w_arcd = 'E1BLD'
      *
      * Call program for avdeling
      *
     c                   if        w_afld = 'E1AVDE'
     c                   call      'RA507R'
     c                   parm                    p_firm
     c                   parm                    w_avde
     c                   parm                    w_gtxt
     c                   if        w_avde <> 0
     c                   eval      e1avde = w_avde
     c                   eval      e1avtx = w_gtxt
     c                   endif
     c                   goto      e1tagb
     c                   endif
      *
      * Call program for selger
      *
     c                   if        w_afld = 'E1SELG'
     c                   call      'RA509R'
     c                   parm                    p_firm
     c                   parm                    w_ikod
     c                   parm                    w_itxt
     c                   if        w_ikod <> 0
     c                   eval      e1selg = w_ikod
     c                   eval      e1setx = w_itxt
     c                   endif
     c                   goto      e1tagb
     c                   endif
      *
      * Call program for lager
      *
     c                   if        w_afld = 'E1LAGE'
     c                   call      'RA510R'
     c                   parm                    p_firm
     c                   parm                    w_jkod
     c                   parm                    w_jtxt
     c                   if        w_jkod <> 0
     c                   eval      e1lage = w_jkod
     c                   eval      e1latx = w_jtxt
     c                   endif
     c                   goto      e1tagb
     c                   endif
      *
      * Call program for prosjekt
      *
     c                   if        w_afld = 'E1PROJ'
6.20 c                   eval      *in36 = '0'
6.20 c**                 call      'RP500R'
6.20 c                   call      'RP600R'
     c                   parm                    p_firm
     c                   parm                    w_proj
6.20 c**                 parm                    w_akti
6.20 c**                 parm                    w_kont
6.20 c**                 parm                    w_spes
     c                   parm                    w_ptx1
     c                   parm                    w_uprs
6.20 c**                 if        w_proj <> 0
6.20 c                   if        w_proj <> *blank
     c                   eval      e1proj = w_proj
6.20 c                   eval      e1upro = w_upro
     c                   eval      e1prtx = w_ptx1
6.20 c**                 eval      e1akti = w_akti
6.20 c                   eval      e1upro = *blank
6.20 c**                 eval      e1aktx = *blank
6.20 c                   eval      e1uptx = *blank
     c                   endif
     c                   goto      e1tagb
     c                   endif
      *
      * Call program for aktivitet
      *
6.20 c**                 if        w_afld = 'E1AKTI'
6.20 c**                 call      'RA521R'
6.20 c**                 parm                    p_firm
6.20 c**                 parm                    w_ukod
6.20 c**                 parm                    w_utxt
6.20 c**                 if        w_ukod <> *blank
6.20 c**                 eval      e1akti = w_ukod
6.20 c**                 eval      e1aktx = w_utxt
6.20 c**                 endif
6.20 c**                 goto      e1tagb
6.20 c**                 endif
6.20  * Call program for underprosjekt
6.20  *
6.20 c                   if        w_afld = 'E1UPRO'
6.20 c                   move      '0'           *in45
6.20 c                   eval      w_upro = *blanks
6.20 c                   eval      w_utx1 = *blanks
6.20 c                   eval      w_proj = e1proj
6.20 c                   eval      w_kund = fokund
7.01 c                   eval      w_rakt = *blanks
7.01 c                   eval      w_kunf = 0
7.01 c                   eval      w_fdat = 0
7.01 c                   eval      w_tdat = 0
7.01 c                   eval      w_selg = 0
7.01 c                   eval      w_kpro = 0
6.20 c                   if        e1upro = *blank
6.20 c                   eval      e1uptx = *blanks
6.20 c                   endif
6.20 c                   call      'RP601R'
6.20 c                   parm                    p_firm
6.20 c                   parm                    w_proj
6.20 c                   parm                    w_upro
7.01 c                   parm                    w_rakt
6.20 c                   parm                    w_utx1
6.20 c                   parm                    w_utx2
6.20 c                   parm                    w_kund
7.01 c**                 parm                    w_uprs
7.01 c                   parm                    w_fdat
7.01 c                   parm                    w_tdat
7.01 c                   parm                    w_knav
7.01 c                   parm                    w_selg
7.01 c                   parm                    w_kunf
7.01 c                   parm                    w_kpro
6.20 c                   if        w_proj <> *blanks
6.20 c                   eval      e1proj = w_proj
6.20 c                   eval      e1upro = w_upro
6.20 c                   eval      e1uptx = w_utx1
6.20 c                   eval      e1prtx = w_utx2
6.20 c                   else
6.20 c                   eval      e1prtx = *blank
6.20 c                   endif
6.20 c                   goto      e1tagb
6.20 c                   endif
      *
      *
      * Call program for leveringsmåte
      *
     c                   if        w_afld = 'E1LMAT'
     c                   call      'RA517R'
     c                   parm                    p_firm
     c                   parm                    w_qkod
     c                   parm                    w_qtxt
     c                   if        w_qkod <> 0
     c                   eval      e1lmat = w_qkod
     c                   eval      e1lmtx = w_qtxt
     c                   endif
     c                   goto      e1tagb
     c                   endif
      *
     c                   endif
     c                   endif
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandler sjekking av opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Sjekk,  Finnes avdeling i KODE-REGISTER
      *
     c                   eval      e1avtx = *blank
     c                   if        e1avde <> *zero
     c                   exsr      sbavde
3.10 c                   if        w_retk <> *blank
     c                   eval      *in32  = *on
     c                   goto      e1tagb
     c                   endif
     c                   endif
      *
      * Sjekk,  Finnes selger i KODE-REGISTER
      *
6.31 c                   if        u_selg = *on and
6.31 c                             e1selg =  0
6.31 c                   eval      *in33 = *on
6.31 c                   goto      e1tagb
6.31 c                   endif
     c                   eval      e1setx = *blank
     c                   if        e1selg <> *zero
     c                   exsr      sbselg
     c                   if        w_retk <> *blank
     c                   eval      *in33  = *on
     c                   goto      e1tagb
     c                   endif
     c                   endif
      *
      * Sjekk,  Finnes lager i KODE-REGISTER
      *
     c                   eval      e1latx = *blank
     c                   exsr      sblagr
3.10 c                   if        w_retk = '1'
     c                   eval      *in34  = *on
     c                   goto      e1tagb
     c                   endif
      *
      * Sjekk,  Finnes prosjekt i kontoregister
      *
     c                   eval      e1prtx = *blank
6.20 c**                 if        e1proj <> *zero
6.20 c                   if        e1proj <> *blank
6.20  *  Linje under er fjernet i forbindelse med kopiering av ordre
6.20  *  da blir e1prog lik foproj slik at test ikke ble utført
6.20 c************       if        e1proj <> foproj
     c                   exsr      sbproj
     c                   if        w_retk = 'X'
     c                   eval      *in45  = *on
     c                   goto      e1tagb
     c                   endif
     c                   if        w_retk <> *blank
     c                   eval      *in35  = *on
     c                   goto      e1tagb
     c                   endif
6.20 c***                endif
     c                   endif
      *
6.20  * Sjekk,  Finnes prosjekt/underprosjekt i kontoregisteret
6.20  *
6.20 c                   eval      e1uptx = *blank
6.20 c                   if        e1upro <> *blanks
6.20  * Slettet i forb. m kopiering
6.20 c****               if        e1upro <> foupro
6.20 c                   exsr      sbupro
6.20 c                   if        w_retk <> *blank
6.20 c                   eval      *in36 = *on
6.20 c                   goto      e1tagb
     c                   endif
6.20 c****               endif
6.20 c                   endif
6.20  *
      * Sjekk,  Finnes aktivitet i koderegister
      *
6.20 c**                 eval      e1aktx = *blank
6.20 c**                 if        e1akti <> *blank
6.20 c**                 if        e1akti <> foakti
6.20 c**                 exsr      sbakti
6.20 c**                 if        w_retk <> *blank
6.20 c**                 eval      *in36  = *on
6.20 c**                 goto      e1tagb
6.20 c**                 endif
6.20 c**                 endif
6.20 c**                 endif
      *
      * Sjekk,  Finnes leveringsmåte i KODE-REGISTER
6.26 c                   if        e1lmat <> *zero
6.26 c                   if        e1lmat <> folmat
6.26 c                   exsr      sbform
6.26 c                   if        w_retk <> *blank
6.26 c                   eval      *in37 = *on
6.26 c                   goto      e1tagb
6.26 c                   endif
6.26 c                   endif
6.26 c                   endif
      *
      *
6.30  * Sjekk,  Er det krav til Leveringsmåte
6.30 c                   if        u_lmat = *on and
6.30 c                             e1lmat =  0
6.30 c                   eval      *in37 = *on
6.30 c                   goto      e1tagb
6.30 c                   endif
6.30  *
6.21 c                   if        faakjk = 1
     c                   exsr      sbform
     c                   if        w_retk <> *blank
     c                   eval      *in37  = *on
     c                   goto      e1tagb
     c                   endif
6.21 c                   endif
      *
6.22  * Viser S-vare dersom lager er endret
6.23  * styres av kontroll mot skaffevarer
6.23 c                   if        faalbe > 0
5.40 c                   if        folage <> 0  and
5.40 c                             e1lage <> folage
6.22 c                   call      'FO577R'
6.22 c                   parm                    p_firm
6.22 c                   parm                    p_numm
6.22 c                   parm                    p_suff
6.22 c                   parm                    e1lage
6.24 c                   parm                    w_retk
6.24 c                   if        w_retk = '1' and
6.24 c                             faalbe > 1
6.24 c                   goto      e1tagb
6.24 c                   endif
6.22 c                   endif
6.24 c                   endif
5.40  *
5.40  * Dersom lager er endret, skal varelinjer oppdateres.
5.40  * Kall opp program hvor det kan velges hva som skal
5.40  * oppdateres, alle linjer eller bare de med likt fra lager.
5.40  * (Bilde skal bare sendes ved endring, ikke ved ny ordre)
5.40  *
5.40 c                   if        folage <> 0
5.40 c                   if        e1lage <> folage
5.40 c                   call      'FO794R'
5.40 c                   parm                    w_valg
5.70 c                   parm                    w_pval
5.40 c                   parm                    w_in03
5.40  *
5.40  * Dersom F3, gå tilbake
5.40  *
5.40 c                   if        w_in03 = '1'
5.40 c                   goto      e1tagb
5.40 c                   endif
5.40 c                   endif
5.40 c                   endif
      *
      *
      * Dersom noen valg er endret, sendt bilde pånytt
      *
     c                   if        e1lmat <> folmat or
     c                             e1avde <> foavde or
     c                             e1selg <> foselg or
     c                             e1lage <> folage or
     c                             e1proj <> foproj or
6.20 c**                           e1akti <> foakti
6.20 c                             e1upro <> foupro
     c                   eval      folmat = e1lmat
     c                   eval      foavde = e1avde
     c                   eval      foselg = e1selg
     c                   eval      folage = e1lage
     c                   eval      foproj = e1proj
6.20 c**                 eval      foakti = e1akti
6.20 c                   eval      foupro = e1upro
     c                   goto      e1tagb
     c                   endif
      *
      * Oppdaterer ORDRE-HODE-REGISTER
      *
     c     fohel1_key    chain     fohelur                            90
     c                   if        *in90 = *off
     c                   move      e1lmat        folmat
     c                   movel     e1lmtx        folmtx
     c                   eval      foavde = e1avde
     c                   eval      foselg = e1selg
     c                   eval      folage = e1lage
     c                   eval      foproj = e1proj
6.20 c**                 eval      foakti = e1akti
6.20 c                   eval      foupro = e1upro
6.10 c                   time                    foedat
6.10 c                   time                    foetim
6.10 c                   eval      foeusr = l_user
     c                   update    fohelur
8.02  * Sjekk om det er tilkoblede linjer som skal oppdateres med "ny" avdeling
8.02  *
8.02 c                   if        foavde <> s_avde
8.02 c                   exsr      sjk_lines
8.02 c                   endif
8.02  *
     c                   endif
      *
     c                   if        folage <> w_lage
     c                   call      'FO732R'
     c                   parm                    w_firm
     c                   parm                    fohel1_numm
     c                   parm                    fohel1_suff
     c                   parm                    footyp
     c                   parm                    w_lage
5.40 c                   parm                    w_valg
5.70 c                   parm                    w_pval
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for prosjekt                     RS770R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbproj        begsr
      *
6.20 c**                 eval      w_kont = *zero
6.20 c**                 eval      w_spes = *zero
      *
6.20 c**                 call      'RS770R'
6.20 c                   call      'RS880R'
     c                   parm                    w_retk
     c                   parm                    e1proj
6.20 c                   parm                    e1upro
6.20 c**                 parm                    e1akti
6.20 c**                 parm                    w_kont
6.20 c**                 parm                    w_spes
     c                   parm                    w_ptx1
     c                   parm                    w_ptx2
      *
     c                   eval      e1prtx = *blank
      *
     c                   if        w_retk = *blank
     c                   movel     w_ptx1        e1prtx
     c                   endif
      *
     c                   endsr
      *
      *
6.20  * Sjekk/Hent tekst for underprosjekt                RS881R
6.20  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.20  *
6.20 c     sbupro        begsr
6.20  *
6.20 c                   call      'RS881R'
6.20 c                   parm                    w_retk
6.20 c                   parm                    e1proj
6.20 c                   parm                    e1upro
6.20 c                   parm                    w_ptx1
6.20 c                   parm                    w_ptx2
6.20 c                   parm                    w_ptx3
6.20  *
6.20 c                   eval      e1uptx = *blank
6.20  *
6.20 c                   if        w_retk = *blank
6.20 c                   movel     w_ptx1        e1uptx
6.20 c                   movel     w_ptx3        e1prtx
6.20 c                   endif
6.20  *
6.20 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for avdeling                     RS707R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbavde        begsr
      *
     c                   eval      e1avtx = *blank
     c                   call      'RS707R'
     c                   parm                    w_retk
     c                   parm                    e1avde
     c                   parm                    w_gtxt
      *
      *
     c                   if        w_retk = *blank
     c                   movel     w_gtxt        e1avtx
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for selger                       RS709R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbselg        begsr
      *
     c                   eval      e1setx = *blank
     c                   call      'RS709R'
     c                   parm                    w_retk
     c                   parm                    e1selg
     c                   parm                    w_itxt
      *
     c                   if        w_retk = *blank
     c                   movel     w_itxt        e1setx
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for lager
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sblagr        begsr
3.10  *
3.10 c                   call      'FÅ720R'
3.10 c                   parm                    p_firm
3.10 c                   parm                    e1lage
3.10 c                   parm                    w_jtxt
3.10 c                   parm                    w_jadr
3.10 c                   parm                    w_jpnr
3.10 c                   parm                    w_jste
3.10 c                   parm                    w_javd
3.10 c                   parm                    w_retk
3.10  *
3.10 c                   eval      e1latx = *blank
3.10  *
3.10 c                   if        w_retk = '0'
3.10 c                   eval      e1latx = w_jtxt
3.10 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for leveringsmåte                RS717R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbform        begsr
      *
     c                   eval      e1lmtx = *blank
     c                   call      'RS717R'
     c                   parm                    w_retk
     c                   parm                    e1lmat
     c                   parm                    w_qtxt
      *
     c                   if        w_retk = *blank
     c                   movel     w_qtxt        e1lmtx
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for aktivitet                    RS721R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.20 c**   sbakti        begsr
6.20  *
6.20 c**                 eval      e1aktx = *blank
6.20 c**                 call      'RS721R'
6.20 c**                 parm                    w_retk
6.20 c**                 parm                    e1akti
6.20 c**                 parm                    w_utxt
      *
6.20 c**                 if        w_retk = *blank
6.20 c**                 movel     w_utxt        e1aktx
6.20 c**                 endif
      *
6.20 c**                 endsr
      *
8.02  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
8.02  * Oppdater linjer med samme som fra-avdeling
8.02  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
8.02 c     sjk_lines     begsr
8.02  *
8.02 c     fohel1_key    setll     fodtlu
8.02 c     fohel1_key    reade     fodtlu
8.02 c                   dow       not %eof
8.03 c                   if        fdavde = 0 and
8.03 c                             fdvare <> *blanks
8.03 c                   eval      fdavde = foavde
8.03 c**                 if        foavde <> fdavde and
8.03 c                   elseif    foavde <> fdavde and
8.02 c                             s_avde <> 0 and
8.02 c                             fdavde <> 0
8.02 c                   eval      fdavde = foavde
8.02 c                   time                    fdedat
8.02 c                   time                    fdetim
8.02 c                   eval      fdeusr = l_user
8.02 c                   endif
8.02 c                   update    fodtlur
8.02 c     fohel1_key    reade     fodtlu
8.02 c                   enddo
8.02  *
8.02 c                   endsr
8.02  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Nullstilling av felter som ikke kan redefineres
      *
     c                   eval      w_retk = *blank
     c                   eval      p_110d = *blank
      *
6.20 c**                 eval      w_kont = *zero
6.20 c**                 eval      w_spes = *zero
      *
      * Key for file : ORDRE-HODE-REGISTER
      *
     c     fohel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fohel1_numm
     c                   kfld                    fohel1_suff
5.71  *
5.71  * Key for file : ORDRE-Detaljer-REGISTER
5.71  *
5.71 c     fodtl1_key    klist
5.71 c                   kfld                    w_firm
5.71 c                   kfld                    fodtl1_numm
5.71 c                   kfld                    fodtl1_suff
5.71  *
5.71  * Key for file : lager
5.71  *
5.71 c     vlagl1_key    klist
5.71 c                   kfld                    w_firm
5.71 c                   kfld                    vlagl1_vare
5.71 c                   kfld                    vlagl1_lage
6.21  *
6.21 c     fstsl1_key    klist
6.21 c                   kfld                    w_firm
6.30  *
6.30  * Key for file : Firmastyrt validering
6.30  *
6.30 c     avall1_key    klist
6.30 c                   kfld                    w_firm
6.30 c                   kfld                    avall1_apgm
      *
      * Tar inn parameter fra forrige program
      *
     c     *entry        plist
     c                   parm                    p_110d
     c                   parm                    p_firm
     c                   parm                    p_numm
     c                   parm                    p_suff
      *
      * Legger inn firmanummer i nøkklene
      *
     c                   eval      w_firm = p_firm
s.ss c     fstsl1_key    chain     fstsl1r
      *
      * Legger inn bestillingsnummer og suffix i nøkklene
      *
     c                   eval      fohel1_numm = p_numm
     c                   eval      fohel1_suff = p_suff
6.30  *
6.30  * Firmastyrt validering av utvalgte felter
6.30  *
6.30  *
6.30 c                   eval      avall1_apgm = 'FO103R'
6.30 c     avall1_key    setll     avall1
6.30 c     avall1_key    reade     avall1
6.30 c                   dow       not %eof(avall1)
6.30 c                   if        avaflt = 'FOLMAT'  and
6.30 c                             avaval = 1
6.30 c                   eval      u_lmat = *on
6.30 c                   endif
6.31 c                   if        avaflt = 'FOSELG'  and
6.31 c                             avaval = 1
6.31 c                   eval      u_selg = *on
6.31 c                   endif
6.30 c     avall1_key    reade     avall1
6.30 c                   enddo
      *
      *
     c                   endsr
