```markdown
## Overview

This RPG (Report Program Generator) source code is for an IBM i (AS/400) system, written in the "original" (fixed-format) ILE RPG style. The program, named `FO691R`, is part of a system called ASOFAK. Its purpose is **printing the order status register** (`Utskrift av ordre-status-register`—title and Norwegian comments indicate it's used in a Norwegian context).

The program handles screen interaction, collects input for sorting/filtering, prepares parameters, calls other programs for processing and printing, and handles job queueing.

---

## Key Sections Explained

### 1. Control and File Specifications

```rpg
h datedit(*dmy.) option(*nodebugio)
FFO691D    CF   E             WORKSTN
```

- `h datedit(*dmy.)`: Date fields are edited as day/month/year.
- `option(*nodebugio)`: Prevents debug breakpoints on I/O operations.
- `FO691D    CF   E             WORKSTN`: Declares a display file (`WORKSTN`) for screen input/output.

---

### 2. Data Structures

#### General Data Structure

```rpg
D                 DS
D  LDPREC                 1     64
D  LDVAL1                 1      1  0
```
- Defines a data structure for parameter passing.
- `LDPREC` is 64 bytes, `LDVAL1` is the first byte (packed decimal).

#### Local Data Area Data Structure

```rpg
d lda            uds
d  l_ruti               800    809
D  l_chgv               844    844
D  l_sfir               944    946  0
D  l_fnav               951    980
```
- `lda uds`: Defines layout over the Local Data Area (LDA).
- `l_ruti`: 10 bytes at position 800, for routine name.
- `l_chgv`: 1 byte at position 844, for a change flag.
- `l_sfir`: 3 bytes at position 944, a numeric field.
- `l_fnav`: 30 bytes at position 951, probably a file name or description.

#### Standalone Variables

```rpg
w_in03          s              1
w_tvbt          s              1
w_btch          s              1
```
- Temporary variables used for flags or indicators.

---

### 3. Main Program Logic

#### Initialization and Tag

```rpg
C     C1TAG         TAG
C                   MOVE      *ZERO         C1VAL1
```
- Labels the entry point; resets screen variable `C1VAL1` to zero.

#### Screen Handling Loop

```rpg
C     C1TAGA        TAG
C     C1TAGB        TAG
C                   EXFMT     C1BLD
```
- Tags for flow control.
- Displays the screen format `C1BLD` and waits for user input.

#### Function Key Handling

```rpg
C     *INKC         CABEQ     *ON           XSLUTT
```
- If F3 (Function Key C) is pressed (`*INKC`), go to label `XSLUTT` to exit.

#### Input Assignment

```rpg
C                   MOVE      C1VAL1        LDVAL1
```
- Moves entered value from the screen to the program variable for parameter passing.

#### Set Up for Next Program

```rpg
c                   eval      l_chgv = *blank
c                   eval      l_ruti = 'FO693'
c                   out       *dtaara
```
- Prepares the LDA: clears `l_chgv`, sets routine name to 'FO693', and writes to system LDA (`*DTAARA`).

#### Call to Print Program

```rpg
call      'AP600R'
parm                    l_ruti
parm                    l_chgv
parm                    w_tvbt
parm                    w_in03
parm                    w_btch
```
- Calls external program `AP600R`, passing routine name, flag, and temp variables.

#### Handle "Job Queue" (F4/INKD)

```rpg
C     *INKD         IFEQ      *ON
C                   MOVE      '1'           WWVALG
C                   END
```
- If F4 (INKD) is pressed, sets a variable (`WWVALG`) for job queuing logic.

#### Call to Subprogram for Selection/Printing

```rpg
C                   CALL      'FO692C'
C                   PARM                    LDPREC
C                   PARM                    WWVALG
```
- Calls subprogram `FO692C`, passing user input and job queue flag.

---

### 4. Program Exit

```rpg
C     XSLUTT        TAG
C                   SETON                                        LR
C                   RETURN
```
- Label for exit.
- Sets Last Record indicator (`LR`), signaling program end and cleanup.
- Returns from program.

---

### 5. Initialization Subroutine

```rpg
C     *INZSR        BEGSR
C     *DTAARA       DEFINE    *LDA          LDA
C                   MOVE      *ZERO         WWVALG            1
CSR                 ENDSR
```
- `*INZSR` is the initialization subroutine, which runs at program startup.
- Defines LDA structure.
- Zeroes out the job queue selection variable.

---

## Summary

- **FO691R** is a screen-handling program for order status printing.
- Prompts user for sorting/filtering parameters.
- Handles function keys to either exit or queue jobs.
- Writes information to the Local Data Area to communicate with called programs.
- Calls print/selection programs (`AP600R` and `FO692C`) with collected parameters.
- Initializes and cleans up variables and LDA usage.
- Uses fixed-format RPG coding and is heavily commented in Norwegian.

---

### Common Operations

- **EXFMT**—Dislays a screen, waits for input.
- **CALL/PARM**—Calls another program and passes parameters.
- **MOVE/EVAL**—Assigns values to variables.
- ***INxx**—Special indicators for function keys.

---

### Key Functional Points

1. Prompts user for selection/sorting criteria.
2. Handles F3 (exit) and F4 (queue job) keys.
3. Passes parameters via LDA and to external programs.
4. Supports both immediate and batch processing.
5. Highly modular, with processing delegated to other programs.

---

### Typical Use Case

An end user runs this program, selects criteria for the order status printout, and either:
- Runs the report directly, or,
- Queues the report for batch/job processing.
```
