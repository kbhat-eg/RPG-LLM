# RPG Program LO612R: Explanation

This RPG program (ILE RPG, sometimes known as RPG IV) is designed for IBM i (AS/400) systems for user input of parameters to generate a notification list ("varsel-liste") for suppliers ("leverandør"). Below is a structured explanation of its components and logic.

---

## Header and Comments

The header section includes metadata:
- **System:** ASLAGR
- **Program:** LO612R
- **Description:** Input of parameters for the warning list (notification list) for suppliers.
- **Change Log:** Tracks changes, versions, and authors (e.g., parameter addition, GUI changes).

---

## File Specifications

```rpg
frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
flo612d    cf   e             workstn
```
- **frlevl1:** Input file, externally described, keyed disk file. The record format `rlevpfr` is renamed to `rlevl1r`.
- **flo612d:** Display file for user interaction, designated as a workstation file.

---

## Data Definitions

### User Data Area

```rpg
d                uds
d l_user                911    920
d l_firm                944    946  0
```
- Accesses the local data area to extract the user ID and the company code (`l_firm`).

### Key Variables

```rpg
d rlevl1_levr     s                   like(rllevr)
```
- Temporary variable for supplier number (key), matching type/length to the file's field.

### Work Variables

```rpg
d w_firm          s              3  0
d w_udat          s               d   datfmt(*iso)
d w_navn          s                   like(rlnavn)
d w_lagr          s              2  0 inz(0)
```
- **w_firm:** Temporary company number.
- **w_udat:** Date variable, ISO format.
- **w_navn:** Temporary for supplier name.
- **w_lagr:** Additional parameter (introduced in version 6.20), initialized to zero.

---

## Mainline Logic

### Main Control Loop

#### a1tag: Start

```rpg
c     a1tag         tag
c                   eval      a1ldor = 0
c                   eval      a1dagr = 0
```
- Initialize input fields: supplier number (`a1ldor`) and a date range field (`a1dagr`) to zero.

#### a1taga: User Prompt and Processing Loop

```rpg
c     a1taga        tag
c                   exfmt     a1bld
```
- Display the main screen format (`a1bld`), wait for user input.

#### Function Key Handling

```rpg
c                   select
c                   when      *inkc
c                   goto      avslutt
c                   when      *inkd
c                   exsr      spørring
c                   goto      a1taga
c                   endsl
```
- **F3 (INKC):** Exit the program (`goto avslutt`).
- **F4 (INKD):** Call the "inquiry" subroutine (`spørring`), then return to input.

#### Validation

1. **Supplier Number:**
    - If `a1ldor` ≠ 0, set up key and attempt to read supplier master.
    - If not found, set error indicator (`*in31`), redisplay input.

2. **Date Check:**
    - Validate the entered date (`a1dato`) using `test(d)`. If bad, set error indicator (`*in32`), redisplay input.

3. **Date Code Validation:**
    - Check if the entered code (`a1onbe`) is 1 or 2. If not, set error indicator (`*in33`), redisplay input.

#### Print Program Call

```rpg
c                   call      'LO614C'
c                   parm                    a1ldor
c                   parm                    a1dato
c                   parm                    a1dagr
c                   parm                    a1onbe
c                   parm                    w_lagr
```
- If all inputs are valid, calls program `LO614C`, passing parameters for further processing/printing.

---

## Program Exit

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Sets last record indicator to close files and exit program.

---

## Subroutines

### spørring: Inquiry (F4)

```rpg
c     spørring      begsr
c                   call      'RL500R'
c                   parm                    w_firm
c                   parm                    a1ldor
c                   parm                    w_navn
c                   endsr
```
- Calls another program (`RL500R`) to query the supplier register, retrieving supplier name for the entered or selected number.

### *inzsr: Initialization

```rpg
c     *inzsr        begsr
c     rlevl1_key    klist
c                   kfld                    w_firm
c                   kfld                    rlevl1_levr
c                   eval      w_firm = l_firm
c                   time                    w_udat
c     *dmy          move      w_udat        a1dato
c                   eval      a1onbe = 1
c                   endsr
```
- Prepares the key list for the supplier file.
- Copies the company number from the user area.
- Sets the default date to today.
- Initializes the "date type" code to 1.

---

## Summary

This program is a typical interactive green-screen RPG application for validating user input, performing lookups, and calling other programs to handle reporting/printing. The logic loop ensures data validation, error handling, and offers function keys for inquiry and exit. The program is modular, using subroutines and cleanly separates UI handling from back-end operations.

**Key elements:**
- Robust input validation.
- Modular design (use of subprocedures and external program calls).
- Uses indicators (`*in31`, `*in32`, `*in33`) for UI feedback.
- Employs DDS display file (`a1bld`) for screens.

This explanation should help developers quickly grasp the program’s structure and purpose.