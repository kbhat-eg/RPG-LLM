# RPG Program Explanation

## Overview

This RPG program is part of the "ASOFAK" system and its purpose is to fetch VAT (MVA) rates for VAT code 'H'. The program name is likely "FÃ˜706R" (note the character encoding issue). It's described as a common module for fetching VAT rates.

## Structure
The program is written in fixed-format ILE RPG (RPG/400 style), and is organized into several sections:

- **Header/Documentation**: Contains metadata, revision log, and program description (in Norwegian).
- **Data Declarations**: Defines parameters and local variables.
- **Mainline Logic**: Implements the core processing (fetching VAT rate).
- **Subroutine - Initialization**: Sets up initial parameter values when the program is started.

---

## Data Declarations

### Parameter Variables

```rpg
d p_firm          s              3  0        // Company code (3-digit integer)
d p_dato          s               d   datfmt(*iso) // Date (ISO format)
d p_mvap          s              6  2        // VAT calculation %
d p_mvat          s              5  4        // Output VAT rate
d p_mvaf          s             10  9        // Output VAT factor
```

- These are used both as parameters passed to the program and as data sent to the called program.

### Working Variables

```rpg
d w_stat          s              1           // Status flag (1 char)
d w_mvak          s              1           // VAT code (initialized to 'H')
d w_mvat          s             30           // VAT description (30 chars)
d w_bpro          s              5  2        // Calculation percentage
```

---

## Main Program Logic

### Initialization

```rpg
c                   eval      w_stat = *blank
c                   eval      w_mvak = 'H'
c                   eval      w_mvat = *blank
```
- Clears status and VAT description.
- Sets VAT code to 'H'.

### Call to Subprogram

```rpg
c                   call      'RS205R'
c                   parm                    w_stat
c                   parm                    w_mvak
c                   parm                    w_mvat
c                   parm                    p_dato
c                   parm                    p_mvap
c                   parm                    p_mvat
c                   parm                    p_mvaf
c                   parm                    w_bpro
```
- Calls sub-program 'RS205R', passing in the VAT code and other parameters.
- The expectation is that 'RS205R' fills out or calculates the VAT rates for code 'H', for the given date.

### Program Exit

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```

- Marks the "avslutt" (exit) tag (not referenced elsewhere, likely for readability).
- Sets the last record indicator (`*INLR`) to ON so the program closes files and ends cleanly.
- Returns from the program.

---

## Initialization Subroutine (`*inzsr`)

This special subroutine is run automatically when the program starts.

```rpg
c     *inzsr        begsr
    ...
c     *entry        plist
c                   parm                    p_firm
c                   parm                    p_dato
c                   parm                    p_mvap
c                   parm                    p_mvat
c                   parm                    p_mvaf
```
- Defines the parameter list for the program: company, date, and references for the VAT values.

```rpg
c                   eval      p_mvap = 0
c                   eval      p_mvat = 1
c                   eval      p_mvaf = 1
```
- **Initializes the output parameters**: sets the default VAT calculation percentage to 0, output VAT rate to 1, and VAT factor to 1. This avoids garbage values if the called program does not update them.

```rpg
c                   endsr
```
- Ends the subroutine.

---

## Summary

- **Purpose:** Fetch and return VAT rates for VAT code 'H' for a given date (`p_dato`). 
- **Operation:** Calls subprogram `RS205R` with the VAT code and other parameters. The subprogram calculates and fills out VAT rates.
- **Parameters:** Receives company code, date, and variables by reference for outputting VAT calculation percentage, rate, and factor.
- **Initialization:** Sets safe "zero/one" defaults for output values before calling the calculation subprogram.

**Note:**  
This structure is intended for use as a common routine, called by other programs needing to look up VAT information for a specific VAT code (here, hardcoded as 'H'). It expects and interacts closely with the 'RS205R' subprogram for the actual VAT rate retrieval or calculation logic.