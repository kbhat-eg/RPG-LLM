     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Inputrecord:
      *(Firma)    Kundenr.  Kortnr.   Kundenavn Adresse   Adresse2  Postnr
      * Poststed  Bet.Bet   Bet.måte  Samlefakt FaktType  PrisPakk  Kr.Grens
      * Kr.sperr  Kr.Type   RabKat    Kundekat  Orgnr     Kont.Pers KontPMail
      * Telefon   Mobil     Passiv    FaktSekv  SpesAvt   SpesAvttxtePostadr
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
8.00  *K00  170323 sst Endret antall siffer i Dekningsgrad etter at Optimera trengte 100%
8.01  *K00  240323 sst Ta ehnsyn til negativ dekkningsgrad
8.xx  *K00  020424 bsa Utvidet prisgruppe
      *
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fxlfrab    uf   f  512        disk     usropn
     f*skonlk    if   e           k disk    rename(skonpfr:skonlkr)
     ffrablu    uf a e           k disk    rename(frabpfr:frablur)
     ffrabld    uf   e           k disk    rename(frabpfr:frabldr)
      *
      * Definering av Local data area
      *
     d                uds
     d l_alle                 11     11
     d l_rabkat               12     12
     d l_user                911    920
     d l_fgr                 931    933
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av variabler i nøkler
      *
     d frablu_firm     s                   like(frfirm)
     d frablu_prgr     s                   like(frprgr)
     d frablu_rkat     s                   like(frrkat)
     d frablu_kkat     s                   like(frkkat)
     d frablu_kund     s                   like(frkund)
     d frablu_kpro     s                   like(frkpro)
     d frablu_ogrp     s                   like(frogrp)
     d frablu_hgrp     s                   like(frhgrp)
     d frablu_ugrp     s                   like(frugrp)
     d frablu_ldor     s                   like(frldor)
     d frablu_modn     s                   like(frmodn)
     d frablu_vare     s                   like(frvare)
     d frablu_enhe     s                   like(frenhe)
     d frablu_lety     s                   like(frlety)
     d frabld_firm     s                   like(frfirm)
     d frabld_rkat     s                   like(frrkat)
     d* skonlk_filg     s                   like(skfilg)
     d* skonlk_firm     s                   like(skfirm)
     d* skonlk_type     s                   like(sktype)
     d* skonlk_fnum     s                   like(skfnum)
     d* skonlk_fnu2     s                   like(skfnu2)
     d* skonlk_falf     s                   like(skfalf)
      *
     d w_dato          s             10
      *
      * Definering av variable
      *
     d i               s              3  0
     d vare            s             15
     d d_firm          s              3
8.xx d d_prgr          s              2
     d d_rkat          s              3
     d s_rkat          s              3
     d d_kkat          s              4
     d d_kund          s              6
     d d_kpro          s              6
     d d_ogrp          s              2
     d d_hgrp          s              2
     d d_ugrp          s              3
     d d_ldor          s              6
     d d_modn          s              8
     d d_vare          s             15
     d d_enhe          s              3
     d d_lety          s              1
     d d_nota          s              5
     d d_pslm          s             10
     d d_rab1          s             10
     d d_ra1d          s             10
     d d_ra1f          s             10
     d d_ra1t          s             10
     d d_rab2          s             10
     d d_ra2d          s             10
     d d_ra2f          s             10
     d d_ra2t          s             10
     d d_rabn          s             10
     d d_rand          s             10
     d d_ranf          s             10
     d d_rant          s             10
     d d_rabb          s             10
     d d_rabd          s             10
     d d_rbuf          s             10
     d d_rbut          s             10
     d d_rabt          s             10
     d d_ratd          s             10
     d d_ratf          s             10
     d d_ratt          s             10
     d d_dekn          s             10
     d d_dekd          s             10
     d d_dekf          s             10
     d d_dekt          s             10
     d d_slet          s             10
      *
     Ixlfrab    ns  01
     I                                  1  256  kunde
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     c                   open      xlfrab
     c                   read      xlfrab
      *
      *   Ev. slette alle berørte rabattkategorier frarabattmatrisa før ny oppdatering
      *
     c                   if        l_rabkat = 'J'
     c                   dow       not %eof(xlfrab)
     c                   if        %subst(kunde:1:1) = ';'
     c                             or %subst(kunde:1:2) = '0;'
     c                   do        2
     c                   eval      i = %scan(';':kunde)
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   enddo
      *
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rkat = %trim(%subst(kunde:1:i-1))
      *    Slett alle forekomster i fRABLU av denne rabattkategori
     c                   if        d_rkat <> *blank
     c                   if        d_rkat <> s_rkat
     c                   eval      frabld_rkat = %dec(%trim(d_rkat):3:0)
     c     frabld_key    setll     frabld
     c     frabld_key    reade     frabld
      *
     c                   dow       not %eof(frabld)
     c                   delete    frabldr
     c                   eval      s_rkat = d_rkat
     c     frabld_key    reade     frabld
     c                   enddo
      *
     c                   endif
     c                   endif
     c                   endif
     c                   read      xlfrab
     c                   enddo
     c                   endif
      *_____________________________________________________________________
      *
      *   Ev. slette alle rabattkategorier frarabattmatrisa før ny oppdatering
      *
     c                   if        l_alle = 'J'
      *
     c                   eval      frabld_rkat = *zero
     c     frabld_key    setll     frabld
     c                   read      frabld
      *
     c                   dow       not %eof(frabld)
     c                   delete    frabldr
     c                   read      frabld
     c                   enddo
      *
     c                   endif
      *__________________________________________________________________________
     c                   close     xlfrab
     c                   open      xlfrab
     c                   read      xlfrab
      *  ________________________________________________________________________
      *
      *    Oppdatering av rabattmarise
      *
     c                   dow       not %eof(xlfrab)
     c
      *  NBNBNBNBNBNB!!!!!!!!!!
     c                   if        (%subst(kunde:1:1) <> ';'
     c                             and %subst(kunde:1:2) <> '0;')
     c                             or %subst(kunde:1:5) = ';;;;;'
     c                   read      xlfrab
     c                   iter
     c                   endif
     c                   eval      i = %scan('            ':kunde)
     c                   eval      %subst(kunde:i:5) = ';;;;;'
      * Æ,Ø,Å
     c                   eval      kunde = %xlate(x'77':'Ø':kunde)
     c                   eval      kunde = %xlate(x'14':'Ø':kunde)
     c                   eval      kunde = %xlate(x'2A':'Å':kunde)
     c                   eval      kunde = %xlate(x'1B':'Å':kunde)
     c                   eval      kunde = %xlate(x'46':'Æ':kunde)
     c                   eval      kunde = %xlate(x'1A':'Æ':kunde)
     c                   eval      kunde = %xlate(x'EF':'å':kunde)
     c                   eval      kunde = %xlate(x'90':'ø':kunde)
     c                   eval      kunde = %xlate(x'A0':'æ':kunde)
      *
      *  Firmanummer
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_firm = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_firm:3:1) = ' '
     c                   eval      %subst(d_firm:2:2) = %subst(d_firm:1:2)
     c                   eval      %subst(d_firm:1:1) = '0'
     c                   enddo
      *
      *  Prisgruppe
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_prgr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Rabattkategori
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rkat = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_rkat:3:1) = ' '
     c                   eval      %subst(d_rkat:2:2) = %subst(d_rkat:1:2)
     c                   eval      %subst(d_rkat:1:1) = '0'
     c                   enddo
      *  Kundekategori
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kkat = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_kkat:4:1) = ' '
     c                   eval      %subst(d_kkat:2:3) = %subst(d_kkat:1:3)
     c                   eval      %subst(d_kkat:1:1) = '0'
     c                   enddo
      *  kundenummer
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kund = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_kund:6:1) = ' '
     c                   eval      %subst(d_kund:2:5) = %subst(d_kund:1:5)
     c                   eval      %subst(d_kund:1:1) = '0'
     c                   enddo
      *  kundeprosjekt
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kpro = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_kpro:6:1) = ' '
     c                   eval      %subst(d_kpro:2:5) = %subst(d_kpro:1:5)
     c                   eval      %subst(d_kpro:1:1) = '0'
     c                   enddo
      *  Overgruppe
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ogrp = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_ogrp:2:1) = ' '
     c                   eval      %subst(d_ogrp:2:1) = %subst(d_ogrp:1:1)
     c                   eval      %subst(d_ogrp:1:1) = '0'
     c                   enddo
      *  Hovedgruppe
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_hgrp = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_hgrp:2:1) = ' '
     c                   eval      %subst(d_hgrp:2:1) = %subst(d_hgrp:1:1)
     c                   eval      %subst(d_hgrp:1:1) = '0'
     c                   enddo
      *  Undergruppe
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ugrp = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_ugrp:3:1) = ' '
     c                   eval      %subst(d_ugrp:2:2) = %subst(d_ugrp:1:2)
     c                   eval      %subst(d_ugrp:1:1) = '0'
     c                   enddo
      *  Leverandørnummer
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ldor = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_ldor:6:1) = ' '
     c                   eval      %subst(d_ldor:2:5) = %subst(d_ldor:1:5)
     c                   eval      %subst(d_ldor:1:1) = '0'
     c                   enddo
      *  Modulnummer
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_modn = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_modn:8:1) = ' '
     c                   eval      %subst(d_modn:2:7) = %subst(d_modn:1:7)
     c                   eval      %subst(d_modn:1:1) = '0'
     c                   enddo
      *  Varenummer
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_vare = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Enhet
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_enhe = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Lev.type
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_lety = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   if        d_lety = *blank
     c                   eval      d_lety = '0'
     c                   endif
      *  Notat
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_nota = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  PSLM  Påslag mestergruppen
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_pslm = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_pslm:10:1) = ' '
     c                   eval      %subst(d_pslm:2:9) = %subst(d_pslm:1:9)
     c                   eval      %subst(d_pslm:1:1) = '0'
     c                   enddo
      *  Rabatt-1
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rab1 = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_rab1:10:1) = ' '
     c                   eval      %subst(d_rab1:2:9) = %subst(d_rab1:1:9)
     c                   eval      %subst(d_rab1:1:1) = '0'
     c                   enddo
      *  Rabatt-1 Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ra1d = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_ra1d:10:1) = ' '
     c                   eval      %subst(d_ra1d:2:9) = %subst(d_ra1d:1:9)
     c                   eval      %subst(d_ra1d:1:1) = '0'
     c                   enddo
      *  Rabatt-1 fra Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ra1f = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Rabatt-1 til Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ra1t = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Rabatt-2
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rab2 = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_rab2:10:1) = ' '
     c                   eval      %subst(d_rab2:2:9) = %subst(d_rab2:1:9)
     c                   eval      %subst(d_rab2:1:1) = '0'
     c                   enddo
      *  Rabatt-2 Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ra2d = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_ra2d:10:1) = ' '
     c                   eval      %subst(d_ra2d:2:9) = %subst(d_ra2d:1:9)
     c                   eval      %subst(d_ra2d:1:1) = '0'
     c                   enddo
      *  Rabatt-2 fra Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ra2f = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Rabatt-2 til Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ra2t = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Rabatt-N
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rabn = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_rabn:10:1) = ' '
     c                   eval      %subst(d_rabn:2:9) = %subst(d_rabn:1:9)
     c                   eval      %subst(d_rabn:1:1) = '0'
     c                   enddo
      *  Rabatt-N Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rand = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_rand:10:1) = ' '
     c                   eval      %subst(d_rand:2:9) = %subst(d_rand:1:9)
     c                   eval      %subst(d_rand:1:1) = '0'
     c                   enddo
      *  Rabatt-N fra Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ranf = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Rabatt-N til Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rant = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Rabatt-B
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rabb = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_rabb:10:1) = ' '
     c                   eval      %subst(d_rabb:2:9) = %subst(d_rabb:1:9)
     c                   eval      %subst(d_rabb:1:1) = '0'
     c                   enddo
      *  Rabatt-B Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rabd = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_rabd:10:1) = ' '
     c                   eval      %subst(d_rabd:2:9) = %subst(d_rabd:1:9)
     c                   eval      %subst(d_rabd:1:1) = '0'
     c                   enddo
      *  Rabatt-B fra Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rbuf = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Rabatt-B til Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rbut = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Rabatt-T
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_rabt = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_rabt:10:1) = ' '
     c                   eval      %subst(d_rabt:2:9) = %subst(d_rabt:1:9)
     c                   eval      %subst(d_rabt:1:1) = '0'
     c                   enddo
      *  Rabatt-T Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ratd = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_ratd:10:1) = ' '
     c                   eval      %subst(d_ratd:2:9) = %subst(d_ratd:1:9)
     c                   eval      %subst(d_ratd:1:1) = '0'
     c                   enddo
      *  Rabatt-T fra Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ratf = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Rabatt-T til Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ratt = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Dekningsgrad
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_dekn = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_dekn:10:1) = ' '
     c                   eval      %subst(d_dekn:2:9) = %subst(d_dekn:1:9)
     c                   eval      %subst(d_dekn:1:1) = '0'
     c                   enddo
      *  Dekningsgrad Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_dekd = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_dekd:10:1) = ' '
     c                   eval      %subst(d_dekd:2:9) = %subst(d_dekd:1:9)
     c                   eval      %subst(d_dekd:1:1) = '0'
     c                   enddo
      *  Dekningsgrad fra Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_dekf = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Dekningsgrad til Dato
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_dekt = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *
      * Sjekk om leverandørnummer skal endres
      *
     c*                  eval      skonlk_filg = l_fgr
     c*                  eval      skonlk_firm = l_firm
     c*                  eval      skonlk_type = 'LEVER     '
     c*                  eval      skonlk_fnum = %dec(%trim(d_ldor):6:0)
     c*                  eval      skonlk_fnu2 = *zero
     c*                  eval      skonlk_falf = *blank
     c*    skonlk_key    chain     skonlkr
     c*                  if        %found(skonlk)
     c*                  move      sktnum        d_ldor
     c*                  endif
      *
     c                   eval      frablu_firm = %dec(%trim(d_firm):3:0)
     c                   eval      frablu_prgr = d_prgr
     c                   eval      frablu_rkat = %dec(%trim(d_rkat):3:0)
     c                   eval      frablu_kkat = %dec(%trim(d_kkat):4:0)
     c                   eval      frablu_kund = %dec(%trim(d_kund):6:0)
     c                   eval      frablu_kpro = %dec(%trim(d_kpro):6:0)
     c                   eval      frablu_ogrp = %dec(%trim(d_ogrp):2:0)
     c                   eval      frablu_hgrp = %dec(%trim(d_hgrp):2:0)
     c                   eval      frablu_ugrp = %dec(%trim(d_ugrp):3:0)
     c                   eval      frablu_ldor = %dec(%trim(d_ldor):6:0)
     c                   eval      frablu_modn = %dec(%trim(d_modn):8:0)
     c                   eval      frablu_vare = d_vare
     c                   eval      frablu_enhe = d_enhe
     c                   eval      frablu_lety = %dec(%trim(d_lety):1:0)
      *
     c     frablu_key    chain     frablu
      *
     c                   clear                   frablur
      *
     c                   eval      frfirm = %dec(%trim(d_firm):3:0)
     c                   eval      frprgr = d_prgr
     c                   eval      frrkat = %dec(%trim(d_rkat):3:0)
     c                   eval      frkkat = %dec(%trim(d_kkat):4:0)
     c                   eval      frkund = %dec(%trim(d_kund):6:0)
     c                   eval      frkpro = %dec(%trim(d_kpro):6:0)
     c                   eval      frogrp = %dec(%trim(d_ogrp):2:0)
     c                   eval      frhgrp = %dec(%trim(d_hgrp):2:0)
     c                   eval      frugrp = %dec(%trim(d_ugrp):3:0)
     c                   eval      frldor = %dec(%trim(d_ldor):6:0)
     c                   eval      frmodn = %dec(%trim(d_modn):8:0)
     c                   eval      frvare = d_vare
     c                   eval      frenhe = d_enhe
     c                   eval      frlety = %dec(%trim(d_lety):1:0)
     c                   eval      frnota = d_nota
     c                   eval(h)   frpslm = %dec(%trim(d_pslm):4:2)
     c                   eval(h)   frrab1 = %dec(%trim(d_rab1):4:2)
     c                   eval(h)   frra1d = %dec(%trim(d_ra1d):4:2)
     c                   if        d_ra1f <> *blank
     c                   eval      w_dato = d_ra1f
     c                   exsr      reddato
     c                   eval      d_ra1f = w_dato
     c                   eval      frra1f = %date(%trim(d_ra1f))
     c                   else
     c                   eval      frra1f = *loval
     c                   endif
     c                   if        d_ra1t <> *blank
     c                   eval      w_dato = d_ra1t
     c                   exsr      reddato
     c                   eval      d_ra1t = w_dato
     c                   eval      frra1t = %date(%trim(d_ra1t))
     c                   else
     c                   eval      frra1t = *loval
     c                   endif
     c                   eval(h)   frrab2 = %dec(%trim(d_rab2):4:2)
     c                   eval(h)   frra2d = %dec(%trim(d_ra2d):4:2)
     c                   if        d_ra2f <> *blank
     c                   eval      w_dato = d_ra2f
     c                   exsr      reddato
     c                   eval      d_ra2f = w_dato
     c                   eval      frra2f = %date(%trim(d_ra2f))
     c                   else
     c                   eval      frra2f = *loval
     c                   endif
     c                   if        d_ra2t <> *blank
     c                   eval      w_dato = d_ra2t
     c                   exsr      reddato
     c                   eval      d_ra2t = w_dato
     c                   eval      frra2t = %date(%trim(d_ra2t))
     c                   else
     c                   eval      frra2t = *loval
     c                   endif
     c                   eval(h)   frrabn = %dec(%trim(d_rabn):4:2)
     c                   eval(h)   frrand = %dec(%trim(d_rand):4:2)
     c                   if        d_ranf <> *blank
     c                   eval      w_dato = d_ranf
     c                   exsr      reddato
     c                   eval      d_ranf = w_dato
     c                   eval      frranf = %date(%trim(d_ranf))
     c                   else
     c                   eval      frranf = *loval
     c                   endif
     c                   if        d_rant <> *blank
     c                   eval      w_dato = d_rant
     c                   exsr      reddato
     c                   eval      d_rant = w_dato
     c                   eval      frrant = %date(%trim(d_rant))
     c                   else
     c                   eval      frrant = *loval
     c                   endif
     c                   eval(h)   frrabb = %dec(%trim(d_rabb):4:2)
     c                   eval(h)   frrabd = %dec(%trim(d_rabd):4:2)
     c                   if        d_rbuf <> *blank
     c                   eval      w_dato = d_rbuf
     c                   exsr      reddato
     c                   eval      d_rbuf = w_dato
     c                   eval      frrbuf = %date(%trim(d_rbuf))
     c                   else
     c                   eval      frrbuf = *loval
     c                   endif
     c                   if        d_rbut <> *blank
     c                   eval      w_dato = d_rbut
     c                   exsr      reddato
     c                   eval      d_rbut = w_dato
     c                   eval      frrbut = %date(%trim(d_rbut))
     c                   else
     c                   eval      frrbut = *loval
     c                   endif
     c                   eval(h)   frrabt = %dec(%trim(d_rabt):4:2)
     c                   eval(h)   frratd = %dec(%trim(d_ratd):4:2)
     c                   if        d_ratf <> *blank
     c                   eval      w_dato = d_ratf
     c                   exsr      reddato
     c                   eval      d_ratf = w_dato
     c                   eval      frratf = %date(%trim(d_ratf))
     c                   else
     c                   eval      frratf = *loval
     c                   endif
     c                   if        d_ratt <> *blank
     c                   eval      w_dato = d_ratt
     c                   exsr      reddato
     c                   eval      d_ratt = w_dato
     c                   eval      frratt = %date(%trim(d_ratt))
     c                   else
     c                   eval      frratt = *loval
     c                   endif
8.01 c                   eval      i = %scan('-':d_dekn)
8.01 c                   if        i > 0
8.01 c                   eval      %subst(d_dekn:I:1) = '0'
8.01 c                   eval(h)   frdekn = %dec(%trim(d_dekn):5:2) * -1
8.01 c                   else
8.01 c                   eval(h)   frdekn = %dec(%trim(d_dekn):5:2)
8.01 c                   endif
      *
8.01 c                   eval      i = %scan('-':d_dekd)
8.01 c                   if        i > 0
8.01 c                   eval      %subst(d_dekd:I:1) = '0'
8.01 c                   eval(h)   frdekd = %dec(%trim(d_dekd):5:2) * -1
8.01 c                   else
8.01 c                   eval(h)   frdekd = %dec(%trim(d_dekd):5:2)
8.01 c                   endif
      *
     c                   if        d_dekf <> *blank
     c                   eval      w_dato = d_dekf
     c                   exsr      reddato
     c                   eval      d_dekf = w_dato
     c                   eval      frdekf = %date(%trim(d_dekf))
     c                   else
     c                   eval      frdekf = *loval
     c                   endif
     c                   if        d_dekt <> *blank
     c                   eval      w_dato = d_dekt
     c                   exsr      reddato
     c                   eval      d_dekt = w_dato
     c                   eval      frdekt = %date(%trim(d_dekt))
     c                   else
     c                   eval      frdekt = *loval
     c                   endif
      *
     c                   eval      frousr = %trim(l_user) + '_o'
     c                   time                    frodat
     c                   time                    frotim
     c                   eval      freusr = %trim(l_user) + '_o'
     c                   time                    fredat
     c                   time                    fretim
      *
     c                   if        frldor = 600002
     c                   eval      frldor = frldor
     c                   eval      frrab1 = frrab1
     c                   endif
      *
     c                   if        %found(frablu)
     c                   update    frablur
     c                   else
     c                   write     frablur
     c                   endif
      *
     c                   read      xlfrab
     c                   enddo
      *
     c     end           tag
      *
     c                   eval      *inlr = *on
     c                   return
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     reddato       begsr
      *                            dd.mm.åååå  > åååå-mm-dd
     c                   if            %subst(w_dato:3:1) = '.'
     c                             and %subst(w_dato:6:1) = '.'
     c                             and %subst(w_dato:9:2) > '00'
     c                             and %subst(w_dato:9:2) < '50'
     c                   eval      w_dato = %subst(w_dato:7:4) + '-' +
     c                                      %subst(w_dato:4:2) + '-' +
     c                                      %subst(w_dato:1:2)
     c                   else
      *                            åååå-mm-dd er ok
     c                   if            %subst(w_dato:5:1) <> '-'
     c                             or  %subst(w_dato:8:1) <> '-'
      *                            Alt annet er feil
     c                   eval      w_dato = *blank
     c                   endif
     c                   endif
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for posisjonering på prosjekt
      *
     c     frablu_key    klist
     c                   kfld                    frablu_firm
     c                   kfld                    frablu_prgr
     c                   kfld                    frablu_rkat
     c                   kfld                    frablu_kkat
     c                   kfld                    frablu_kund
     c                   kfld                    frablu_kpro
     c                   kfld                    frablu_ogrp
     c                   kfld                    frablu_hgrp
     c                   kfld                    frablu_ugrp
     c                   kfld                    frablu_ldor
     c                   kfld                    frablu_modn
     c                   kfld                    frablu_vare
     c                   kfld                    frablu_enhe
     c                   kfld                    frablu_lety
      *
     c     frabld_key    klist
     c                   kfld                    frabld_firm
     c                   kfld                    frabld_rkat
      *
     c*    skonlk_key    klist
     c*                  kfld                    skonlk_filg
     c*                  kfld                    skonlk_firm
     c*                  kfld                    skonlk_type
     c*                  kfld                    skonlk_fnum
     c*                  kfld                    skonlk_fnu2
     c*                  kfld                    skonlk_falf
      *
     c                   endsr
