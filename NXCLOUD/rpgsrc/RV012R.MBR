     h option(*nodebugio) datedit(*dmy)
     h decedit('0.')
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : RV012R
      * Beskrivelse . . : Leser linjer fra LOVF til kommaseparert til
      *                   (Global format (ImportRGBatchLineCSV.ifs))
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * ----- ------ ---- -------------------------------------------------
      *
9.01  *       011221 mst   Endring av layout og form på dato
9.02  *       180222 mst   NB!  Programmet er helt gjort om pga
9.02  *                    summering på konto/billag og at det fra før var IP le
9.03  *       190522 mst   Les på debetkonto synkende
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
9.02 f*lovfl1    ip   e           k disk    rename(lovfpfr:lovfpf1)
9.03 flovfl3    if   e           k disk     rename(lovfpfr:lovfpf2)
      *
     frv12pf    o    e           k disk
      *
      * Definering av Local data area
      *
     d                uds
     d l_firm                944    946  0
      *
      * Definering av inputfil
      *
     d rfirm           s              3  0
     d rperi           s              4  0
     d rbunt           s              5  0
     d rbln            s              8  0
     d rbil            s              4  0
     d rbdat           s             10
     d rdat            s             10
     d rgbilk          s              2  0
     d rgtext          s             20
     d rgdavd          s              4  0
     d rgdkto          s              6  0
     d rgdsps          s              4  0
     d rgdmom          s              1
     d rgbelp          s             10  2
     d rgmvag          s             10  2
     d rgcavd          s              4  0
     d rgckto          s              6  0
     d rgcsps          s              4  0
     d rgcmom          s              1
     d rgproj          s              6
     d rgakti          s              6
     d rgkref          s              8  0
     d rgkund          s              6  0
     d rgvalks         s              3
     d rgvalb          s             11  2
     d rgmngk          s              2  0
     d rgmngd          s              9  2
     d rgautx          s              1
     d rgkidi          s             25
     d rgsfak          s             15
     d rgupro          s              6
     d rgarbo          s              6
     d tell            s              2  0
      *
      * Datastruktur for posteringsdato
     d                 ds
     d p_fdati                 1     10
     d  p_fa                   1      4
     d  p_f1                   5      5
     d  p_fm                   6      7
     d  p_f2                   8      8
     d  p_fd                   9     10
     d                 ds
     d p_fdatu                 1      6
     d  p_fdu                  1      2
     d  p_fmu                  3      4
     d  p_fau                  5      6
     d*
      * Datastruktur for bilagsdato
     d                 ds
     d b_fdati                 1     10
     d  b_aa                   1      4
     d  b_a1                   5      5
     d  b_mn                   6      7
     d  b_a2                   8      8
     d  b_dd                   9     10
     d                 ds
     d b_fdatu                 1      6
     d  b_ddu                  1      2
     d  b_mnu                  3      4
     d  b_aau                  5      6
      *
      *
      * Datastruktur for forfallsdato
     d                 ds
     d f_fdati                 1     10
     d  f_fa                   1      4
     d  f_f1                   5      5
     d  f_fn                   6      7
     d  f_f2                   8      8
     d  f_fd                   9     10
     d                 ds
     d f_fdatu                 1      6
     d  f_fdu                  1      2
     d  f_fnu                  3      4
     d  f_fau                  5      6
      *
      * Variable for brudd og  oppsummering
      *
     d w_lgbiln        s                   like(lgbiln)
     d w_lgbilk        s                   like(lgbilk)
     d w_lgtext        s                   like(lgtext)
     d w_lgckto        s                   like(lgckto)
     d w_lgdkto        s                   like(lgdkto)
     d w_lgdavd        s                   like(lgdavd)
     d w_lgcavd        s                   like(lgcavd)
     d w_lgbdat        s                   like(lgbdat)
     d w_lgfdat        s                   like(lgfdat)
     d w_lgsfak        s                   like(lgsfak)
      *
     d w_lgbelp        s                   like(lgbelp)
     d w_lgvalb        s                   like(lgvalb)
     d w_lgmngd        s                   like(lgmngd)
      *
     d w_pfdatu        s                   like(p_fdatu)
     d w_bfdatu        s                   like(b_fdatu)
     d w_ffdatu        s                   like(f_fdatu)
      *
      * Teller for første post debet/kredit
     d w_dtell         s              1
     d w_ctell         s              1
      *************************************************************************
     C                   clear                   w_dtell
     C                   clear                   w_ctell
      *
      * Les hode
9.03 C                   read      lovfl3
      *
     c                   if        l_firm <> lgfirm
     c                   goto      slutx
     c                   endif

     C                   movel     lgbdat        p_fdati
     C                   movel     lgfdat        b_fdati
     C                   movel     lgfdat        f_fdati

     c* Heading for kjøring
     c                   if        tell   = 0
     c                   add       1             tell
     c                   eval      rvdata = *blank
     c                   eval      rvdata = %trim('@FIRM_BEGIN(2217)')
     c                   write     rv12pfr
      *
     c                   eval      rvdata = *blank
     c                   eval      rvdata = %trim('@IMPORT_METHOD(3)')
     c                   write     rv12pfr
      *
     c                   eval      rvdata = *blank
     c                   eval      rvdata = %trim('@WaBnd(Descr,ValDT)')
     c                   write     rv12pfr
      *
     c                   eval      rvdata = *blank
      *
     c                   write     rv12pfr
      *
     c                   eval      rvdata = *blank
     c                   eval      rvdata = %trim('@WaVo(VoT,VoDt,') +
     c                                           ('BilNr,BilDt,BilArt,Txt,') +
     c                                           ('DAvd,KAvd,Pro,Dkto,Kkto,') +
     c                                           ('KMva,DMva,Val,Valk,ValB,') +
     c                                           ('Bel,Mbil,Fdat,Kjn,Men,') +
     c                                           ('KID,AvgK,SLA,LFakt,Rem,') +
     c                                           ('Pro,Marb,Ex1,Ex2,Ex3,Ex4)')
     c                   write     rv12pfr
     c                   endif
      *
     C                   clear                   w_lgbiln
     C                   clear                   w_lgbilk
     C                   clear                   w_lgtext
     C                   clear                   w_lgckto
     C                   clear                   w_lgdkto
     C                   clear                   w_lgvalb
     C                   clear                   w_lgbelp
     C                   clear                   w_lgmngd
     C                   clear                   w_pfdatu
     C                   clear                   w_bfdatu
     C                   clear                   w_ffdatu
      *
     C                   clear                   w_lgcavd
     C                   clear                   w_lgdavd
     C                   clear                   w_lgsfak
      *
     C     les           tag
      *
     C                   if        lgdkto  = 0
     C                   goto      kredit
     c                   endif
     C                   if        lgckto  = 0
     C                   goto      debet
     c                   endif
      *
      ***********************************************************
      *
      * Les debet
     C     debet         tag
      * Siste kredit/færste post
     C                   if        w_dtell =' '
     C                   exsr      behan
     C                   clear                   w_lgvalb
     C                   clear                   w_lgbelp
     C                   clear                   w_lgmngd
      *
     c                   add       lgvalb        w_lgvalb
     c                   add       lgbelp        w_lgbelp
     c                   add       lgmngd        w_lgmngd
     C                   eval      w_dtell    = '1'
     C                   goto      les1
     C                   endif
      *
     c                   if        w_lgdkto  = lgdkto
     c                             and       w_lgbiln  = lgbiln
     c                   add       lgvalb        w_lgvalb
     c                   add       lgbelp        w_lgbelp
     c                   add       lgmngd        w_lgmngd
     c                   else
     C                   exsr      behan
     C                   clear                   w_lgvalb
     C                   clear                   w_lgbelp
     C                   clear                   w_lgmngd
     c                   add       lgvalb        w_lgvalb
     c                   add       lgbelp        w_lgbelp
     c                   add       lgmngd        w_lgmngd
     c                   endif
     c                   eval      w_lgdkto  = lgdkto
     c                   eval      w_lgbiln  = lgbiln
     c                   eval      w_lgbilk  = lgbilk
     c                   eval      w_lgtext  = lgtext
     C                   eval      w_lgbdat  = lgbdat
     C                   eval      w_lgfdat  = lgfdat
     C                   eval      w_lgfdat  = lgfdat

     C                   eval      w_lgsfak  = lgsfak
     C                   eval      w_lgdavd  = lgdavd
     C                   eval      w_lgcavd  = lgcavd
     C                   goto      les1
      *
      * Les kredit
     C     kredit        tag
     C                   if        lgckto <> 0
      * Første post
     C                   if        w_ctell =' '
     C                   exsr      behan
     C                   clear                   w_lgvalb
     C                   clear                   w_lgbelp
     C                   clear                   w_lgmngd
      *
     c                   add       lgvalb        w_lgvalb
     c                   add       lgbelp        w_lgbelp
     c                   add       lgmngd        w_lgmngd
     C                   eval      w_ctell    = '1'
     C                   goto      les1
     C                   endif

     c                   if        w_lgckto  = lgckto
     c                             and       w_lgbiln  = lgbiln
     c                   add       lgvalb        w_lgvalb
     c                   add       lgbelp        w_lgbelp
     c                   add       lgmngd        w_lgmngd
     c                   else
     C                   exsr      behan
     C                   clear                   w_lgvalb
     C                   clear                   w_lgbelp
     C                   clear                   w_lgmngd
     c                   add       lgvalb        w_lgvalb
     c                   add       lgbelp        w_lgbelp
     c                   add       lgmngd        w_lgmngd
     C                   endif
     C                   endif
      *
     C     les1          tag
     c                   eval      w_lgdkto  = lgdkto
     c                   eval      w_lgckto  = lgckto
     c                   eval      w_lgbiln  = lgbiln
     c                   eval      w_lgbilk  = lgbilk
     c                   eval      w_lgtext  = lgtext
     C                   eval      w_lgbdat  = lgbdat
     C                   eval      w_lgfdat  = lgfdat
     C                   eval      w_lgsfak  = lgsfak
     c                   eval      w_lgdavd  = lgdavd
     c                   eval      w_lgcavd  = lgcavd
9.03 c                   read      lovfl3
      *
     C                   movel     lgbdat        p_fdati
     C                   movel     lgfdat        b_fdati
     C                   movel     lgfdat        f_fdati
      *
     c                   if        not %eof
     C                   goto      les
     C                   endif
      *  Siste post
     C                   if        w_lgbelp <> 0
     C                   exsr      behan
     c                   endif
     c
     C     slutx         tag
     c                   eval      *inlr = *on
      ***********************************************************
     c     behan         begsr
     c* Blanker felt
     c*                  eval      p_fdati  = *blanks
     c*                  eval      b_fdati  = *blanks
     c*                  eval      f_fdati  = *blanks
      *
      *
      * Posteringsdato
     c                   movel     w_lgbdat      p_fdati
     c*                  movel     lgbdat        p_fdati
9.01 c*                  movel     p_fa          p_fau
9.01 c                   move      p_fa          p_fau
     c                   movel     p_fm          p_fmu
     c                   movel     p_fd          p_fdu
     c*                  movel     p_fdatu       p_fdatu
      *
      * Bilagsdato
     c                   movel     w_lgfdat      b_fdati
     c*                  movel     lgfdat        b_fdati
9.01 c*                  movel     b_aa          b_aau
9.01 c                   move      b_aa          b_aau
     c                   movel     b_mn          b_mnu
     c                   movel     b_dd          b_ddu
     c*                  movel     b_fdatu       b_fdatu
      *
      * Forfallsdato
     c                   movel     w_lgfdat      f_fdati
     c*                  movel     lgfdat        f_fdati
9.01 c*                  movel     f_fa          f_fau
9.01 c                   move      f_fa          f_fau
     c                   movel     f_fn          f_fnu
     c                   movel     f_fd          f_fdu
     c*                  movel     f_fdatu       f_fdatu
     c*
      * Beløp skal legges ut med 4 desimaler
     c*                  z-add     lgbelp        zfbelp
      * Legger ut detaljer fra bovf
      * Nullstiller
9.01 c* Ikke første post
9.01 c                   if        w_dtell = ' '
9.01 C                   goto      slutt
9.01 C                   endif
9.01 c                   if        w_ctell = ' '
9.01 C                             and   w_lgbelp = 0
9.01 C                   goto      slutt
9.01 C                   endif
      *
      *
     c*
     c                   eval      rvdata = *blank
      * Start
9.01 c                   eval      rvdata = %trim('') +
      * Type journal
     c                                     %char('1')     + ',' +
      * Posteringsdato
     c                                     %char(p_fdatu)     + ',' +
      * Bilagsnummer
     c*                                     %char(lgbiln)    + ',' +
     c                                     %char(w_lgbiln)    + ',' +
      * Bilagsdato
     c                                     %char(b_fdatu)     + ',' +
      * Bilagsart
     c*                                    %char(lgbilk)     + ',' +
     c                                     %char(w_lgbilk)     + ',' +
      * Bilagstekst
     c*                                     %trim(lgtext)     + ',' +
     c                                     %trim(w_lgtext)     + ',' +
      * Avd.nummer
     c*                                     %char(lgdavd)     + ',' +
     c                                     %char(w_lgdavd)     + ',' +
     c*                                     %char(lgcavd)     + ',' +
     c                                     %char(w_lgcavd)     + ',' +
      * Prosjekt nummer
     c                                     %trim(lgproj)     + ',' +
      * Debet konto
     c*                                     %char(lgdkto)     + ',' +
     c                                     %char(w_lgdkto)     + ',' +
      * Kredit konto
     c*                                     %char(lgckto)     + ',' +
     c                                     %char(w_lgckto)     + ',' +
      * Mva kode
     c                                     %char(lgcmom)     + ',' +
     c                                     %char(lgdmom)     + ',' +
      * Valutakode
     c                                     %char(lgvalk)    + ',' +
      * Valuta kurs   NB!   Skal være kurs
     c                                     %char(lgvalb)    + ',' +
      * Valuta beløp
     c*                                     %char(lgvalb)    + ',' +
     c                                     %char(w_lgvalb)    + ',' +
      * Beløp
     c*                                     %char(lgbelp)    + ',' +
     c                                     %char(W_lgbelp)    + ',' +
      * Motbilagsnummer
     c                                     %char(' ')       + ',' +
      * Forfallsdato
     c                                     %char(f_fdatu)    + ',' +
      * Kjedenummer
     c                                     %char(' ')       + ',' +
      * Mengde
     c*                                     %char(lgmngd)    + ',' +
     c                                     %char(W_lgmngd)    + ',' +
      * Kid
     c                                     %trim(lgkidi)    + ',' +
      * Avgiftklasse
     c                                     %trim(',') +
      * SLAccount
     c                                     %trim(',') +
      * Lev.fakt.nr.
     c*                                     %trim(lgsfak)    + ',' +
     c                                     %trim(w_lgsfak)    + ',' +
      * RemittanceProfileNO
     c                                     %trim(',') +
      * Produktnr.
     c                                     %trim(',') +
      * Medarbeidernr.
     c                                     %trim(',') +
      * Ekstra 1
     c                                     %trim(',') +
      * Ekstra 2
     c                                     %trim(',') +
      * Ekstra 3
     c                                     %trim(',') +
      * Ekstra 4
     c                                     %trim(',')
      *
     c                   write     rv12pfr
      *
     c     slutt         tag
     c     behanx        endsr
      *
