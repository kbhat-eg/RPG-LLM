# RF825R – Unique Filename Generator with Date and Customer Number

## Purpose

This program (RF825R) is a utility designed to generate a unique filename based on a customer number (kundenummer) and the current date. The filename format is:

```
<customer_number>.<yyyymmdd>.csv
```

This is used to ensure that output files are uniquely named per customer and date, likely for data export or reporting purposes.

---

## High-Level Structure

- **Entry Parameters:** Receives a customer number and returns the generated filename.
- **Initialization:** Standard RPG *INZSR subroutine to handle parameter passing.
- **Main Logic:** Gets the current date, formats it, and constructs the filename.
- **Exit:** Sets LR indicator to end the program.

---

## Detailed Walkthrough

### Header and Options

```rpg
h option(*nodebugio) datedit(*dmy)
```
- `*nodebugio`: Disables debug for I/O operations.
- `datedit(*dmy)`: Sets default date editing to day-month-year, though ISO format is used in code.

---

### Data Structures and Variables

#### Filename Construction

```rpg
d                 ds
d d_fnav                        28
d* d_fnav01                     15    overlay(d_fnav:1)
d* d_fnav02                      1    overlay(d_fnav:16)   inz('.')
d* d_fnav03                      6  0 overlay(d_fnav:17)
```
- `d_fnav`: Full filename (28 chars).
- Overlays (commented out): Previously used to break the filename into parts (customer, separator, date), but only `d_fnav` is used in logic.

#### Parameters

```rpg
d p_fnav          s             28
d p_bmid          s             15
```
- `p_bmid`: Input parameter, customer number (up to 15 chars).
- `p_fnav`: Output parameter, generated filename (28 chars).

#### Working Variables

```rpg
d w_dato          s               d   datfmt(*iso)
d w_dato_8        s              8  0
```
- `w_dato`: Date, ISO format.
- `w_dato_8`: Date as 8-digit number (yyyymmdd).

---

### Main Logic

#### 1. Get Current Date

```rpg
c                   time                    w_dato
```
- Retrieves the system date into `w_dato` (ISO format).

#### 2. Convert Date to Numeric Format

```rpg
c     *iso          move      w_dato        w_dato_8
```
- Converts `w_dato` to an 8-digit numeric value (yyyymmdd). This is required for filename formatting.

#### 3. Build the Filename

```rpg
c                   eval      d_fnav = %trim(p_bmid) + '.' +
c                             %char(w_dato_8) + '.csv'
```
- Concatenates:
    - Trimmed customer number
    - Literal period
    - Date as string
    - Literal ".csv"
- Example result: `1234567.20240626.csv`

#### 4. Return the Filename

```rpg
c                   eval      p_fnav = d_fnav
```
- Assigns the constructed filename to the output parameter.

#### 5. Program Exit

```rpg
c                   eval      *inlr = *on
c                   return
```
- Sets Last Record indicator to end the program and returns control.

---

### Subroutine: *INZSR

Handles parameter passing at program start.

```rpg
c     *inzsr        begsr
c     *entry        plist
c                   parm                    p_bmid
c                   parm                    p_fnav
c                   endsr
```
- Defines the parameter list:
    - `p_bmid`: Input (customer number)
    - `p_fnav`: Output (filename)

---

## Business/Domain-Specific Logic

- The filename format is domain-specific: customer number and date are used to ensure uniqueness and traceability.
- The `.csv` extension suggests files are intended for data interchange or export.

---

## Design Decisions and Conventions

- **Parameter Passing:** Uses standard RPG parameter list conventions for input/output.
- **No File I/O:** This program only constructs the filename; it does not create or write to the file.
- **Single Responsibility:** The program does only one thing—constructs a filename—making it reusable as a utility.
- **Legacy Overlays:** The commented overlays in the data structure suggest earlier versions may have manipulated filename parts separately, but this was streamlined for simplicity.

---

## Interactions

- **Caller Responsibility:** The program expects to be called by another program, passing in the customer number and receiving the filename.
- **No External Files/APIs:** No direct interaction with files, databases, or APIs; all logic is internal.

---

## Summary

RF825R is a utility program for generating unique, date-stamped filenames for customer data exports. It is designed for modular reuse, relies on standard RPG parameter passing, and adheres to conventions ensuring easy integration with other business processes. The filename format is strictly controlled for consistency across the system.