# FO794R Program Documentation

## Overview

**Program:** FO794R  
**System:** ASOFAK  
**Description:**  
This program presents a selection screen for the user to choose which order lines should be changed. It validates the user’s selection and returns the result via parameters. The program is typically invoked from another module that needs to prompt the user for this decision.

## Structure

- **Display File:** `fo796d` (workstn)
- **Parameters:**  
  - `p_valg`: User's selection (1 character)
  - `p_in03`: Indicator for F3=Exit (1 character)
- **Main Variables:**  
  - `b_feil`: Error flag (1 character, initialized to *off)
  - `b1valg`: Holds the user's selection from the screen

## Key Sections and Logic

### Initialization (`*inzsr`)
- The program receives two parameters: `p_valg` (selection) and `p_in03` (exit indicator).
- These parameters are passed by reference and will be updated before the program returns.

### Main Loop (Opening Screen)
- The main logic is a loop that:
  1. Presents the screen (`b1bld` format from `fo796d`).
  2. Waits for user input.
  3. Handles function keys (F3=Exit, F12=Cancel).
  4. Validates input.
  5. If input is invalid, redisplays the screen with error indication.
  6. If input is valid, copies the selection to the output parameter and exits.

#### Function Key Handling
- If F3 (or F12) is pressed (`*inkc` or `*inkl`), set `p_in03` to *on and exit immediately.

#### Input Validation (`sjekk_input`)
- Ensures that the selection (`b1valg`) is either blank, '0', or '1'.
- If the selection is invalid:
  - Sets indicator `*in31` on (likely to display an error message on the screen).
  - Sets `b_feil` to *on, causing the main loop to redisplay the screen.

#### Parameter Assignment (`flytt_par`)
- Copies the validated selection from the screen field (`b1valg`) to the output parameter (`p_valg`).

### Program Exit
- Sets LR (`*inlr`) to *on to ensure program cleanup and returns control to the caller.

## Business/Domain-Specific Logic

- **Order Line Selection:**  
  The program’s main business function is to allow the user to select which order lines should be changed. The actual meaning of the values ('0', '1', blank) should be documented elsewhere, but typically:
  - `'0'` or blank: No change or default action.
  - `'1'`: Selects order lines for change.

- **Screen Design:**  
  The screen format (`b1bld`) and fields such as `b1valg` are defined in the display file `fo796d`. Error indicator `*in31` is used to signal invalid input to the user.

## Design Decisions and Conventions

- **Single-Screen Loop:**  
  The program uses an input loop with tags (`b1taga`) to repeatedly prompt the user until valid input is received or the user exits.
- **Parameter Passing:**  
  Output is returned via parameters, a common convention for called programs in this system.
- **Error Handling:**  
  Uses a combination of error flags and display file indicators to manage and display input validation errors.
- **Function Key Indicators:**  
  Handles F3 and F12 using standard indicator checks (`*inkc`, `*inkl`).

## External Interactions

- **Display File (`fo796d`):**  
  All user interaction is managed via this display file, which must define the screen format `b1bld` and field `b1valg`.
- **Calling Program:**  
  FO794R is intended to be called from other modules/programs that need to prompt the user for order line change selection.

## Summary of Flow

1. Initialize parameters.
2. Display selection screen.
3. If F3/F12 pressed, set exit indicator and return.
4. Validate user input.
5. If invalid, redisplay screen with error.
6. If valid, copy selection to output parameter and exit.

---

**Note:**  
- The program is minimal by design, focusing solely on user selection and validation.  
- All business rules related to what the selection values mean are enforced elsewhere; this program only ensures a valid selection is made.  
- Changes to the selection logic or valid values must be reflected both in this program and in any documentation for the calling modules.