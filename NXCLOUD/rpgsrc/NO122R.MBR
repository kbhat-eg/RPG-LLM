     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : NO122R
      * Beskrivelse . . : Ekstern ordre-hode, overføring til ordre
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       010318 bsa  Nytt program
7.01  * MGR   151216 sst  Ber flytende Memosaldo m/ordre pr ant. dager
7.01  *       170117 sst  Hente parameter meosaldo fra AFPSPF
7.02  * 7.00  250320 bsa  Innfører switchstyring av memosaldo
7.03  * K000  291220 bsa  Endrer logikken på hvordan vår ref oppdateres
7.04  * K000  160321 bsa  Hvis fakturakunde må denne hentes inn og
7.04  * K000              legges på ordrehodet.
      *
8.01  * K000  030222 bsa  Hvis vi overfører ordre hvor det allerde
8.01  * K000              finnes et tilbud med samme eksternreferanse,
8.01  * K000              skal tilbudet slettes.
8.02  * K000  090222 bsa  Hvis det finnes parentref, skal ikke priser
8.02  * K000              eller rabatter endres.
8.03  * K000  100222 bsa  Hvis systemkode 'TBU', forslå tilbud.
8.04  * K000  231122 sst  Flyttet ant memo-dager og utv.kreditgrense til  UTVIDET_MEMOSALDO (nx)
8.05  * 8.xx  200122 bsa  Skriver tekst som har kommet som melding til
8.05  * 8.xx              toptekst på ordren som opprettes. NB Forutsetter
8.05  * 8.xx              at bestillingen har kommet elektronisk.
8.06  * 8.xx  240222 bsa  Henter inn evnt leveringsbetingelse fra EDI, og
8.06  * 8.xx              legger den som forslag på ordren (FOLBTX)
8.07  *PRG2   220622 bof  Utvidet prisgruppe fra 1 til 2 posisjoner
8.08  * K000  130824 bsa  Henter nummerserie basert på feil ordretype
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fnohel1    if   e           k disk    rename(nohepfr:nohel1r)
8.01 fnoh2l1    if   e           k disk    rename(noh2pfr:noh2l1r)
8.01 fnoh2lu    uf   e           k disk    rename(noh2pfr:noh2lur)
     fnodtl1    if   e           k disk    rename(nodtpfr:nodtl1r)
     fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
     ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
     ffusrl1    if   e           k disk    rename(fusrpfr:fusrl1r)
     frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
     frkmel1    if   e           k disk    rename(rkmepfr:rkmel1r)
     ffkprl1    if   e           k disk    rename(fkprpfr:fkprl1r)
     fnohelu    uf   e           k disk    rename(nohepfr:nohelur)
     ffohelu    uf a e           k disk    rename(fohepfr:fohelur)
     ffodtl1    if   e           k disk    rename(fodtpfr:fodtl1r)
     fausrl1    if   e           k disk    rename(ausrpfr:ausrl1r)
     fedhelr    if   e           k disk    rename(edhepfr:edhelrr)
     f                                     prefix(rr:2)
     fedhelu    uf   e           k disk    rename(edhepfr:edhelur)
     feddtlr    if   e           k disk    rename(eddtpfr:eddtlrr)
     feddtlu    uf   e           k disk    rename(eddtpfr:eddtlur)
     f                                     prefix(xx:2)
7.03 fra09l1    if   e           k disk    rename(ra09pfr:ra09l1r)
8.04 f*afpslr    if   e           k disk    rename(afpspfr:afpslrr)
8.05 ffotxlu    uf a e           k disk    rename(fotxpfr:fotxlur)
8.06 fedh2l1    if   e           k disk    rename(edh2pfr:edh2l1r)
      *
     fno122d    cf   e             workstn
      *
      * Definering av parametre
      *
     d p_firm          s                   like(nofirm)
     d p_fsys          s                   like(nofsys)
     d p_tell          s                   like(notell)
     d p_ldor          s                   like(eoldor)
     d p_in03          s              1
      *
      * Definering av Local data area
      *
     d                uds
     d l_wsid                901    910
     d l_user                911    920
7.01 d l_filg                931    933
      *
      * Definering av variabler i nøkler
      *
     d nohel1_fsys     s                   like(nofsys)
     d nohel1_tell     s                   like(notell)
     d nodtl1_fsys     s                   like(ndfsys)
     d nodtl1_tell     s                   like(ndtell)
     d nodtl1_line     s                   like(ndline)
     d votyl1_otyp     s                   like(vaotyp)
     d fusrl1_user     s                   like(fbuser)
     d rkunl1_kund     s                   like(rkkund)
     d fkprl1_kund     s                   like(flkund)
     d fkprl1_kpro     s                   like(flkpro)
     d nohelu_fsys     s                   like(nofsys)
     d nohelu_tell     s                   like(notell)
     d fohelu_numm     s                   like(fonumm)
     d fohelu_suff     s                   like(fosuff)
     d fodtl1_numm     s                   like(fdnumm)
     d fodtl1_suff     s                   like(fdsuff)
     d fodtl1_line     s                   like(fdline)
     d ausrl1_user     s                   like(abuser)
     d eddtlu_line     s                   like(edline)
     d eddtlu_ldor     s                   like(edldor)
     d eddtlu_ldat     s                   like(edldat)
     d eddtlr_ldor     s                   like(edldor)
     d eddtlr_ldat     s                   like(edldat)
     d edhelr_ldor     s                   like(eoldor)
     d edhelr_ldat     s                   like(eoldat)
     d edhelu_ldor     s                   like(eoldor)
     d edhelu_ldat     s                   like(eoldat)
7.03 d ra09l1_ikod     s                   like(raikod)
8.04 d*afpslr_ufil     s                   like(afufil)
8.04 d*afpslr_uide     s                   like(afuide)
8.05 d fotxlu_numm     s                   like(ftnumm)
8.05 d fotxlu_suff     s                   like(ftsuff)
8.05 d fotxlu_line     s                   like(ftline)
      *
      * Definering av variable
      *
     d b_sper          s              1    inz(*off)
8.02 d b_pref          s              1    inz(*off)
      *
     d s_ldor          s                   like(fdldor)
      *
     d w_kode          s              1
     d w_fast          s             10
     d w_sald          s             11  2
     d w_sal2          s             11  2
     d w_tots          s             11  2
     d w_totr          s             11  2
     d w_totk          s             11  2
     d w_tota          s             11  2
     d w_totn          s             11  2
     d w_tot1          s             11  2
     d w_tot2          s             11  2
     d w_fell          s              6
     d w_valg          s              2  0
     d w_text          s             70
     d w_nref          s              6  0
      *
     d s_avde          s              4  0
7.04 d s_kund          s                   like(rkkund)
      *
     d w_firm          s                   like(nofirm)
     d w_numm          s                   like(fonumm)
     d w_suff          s                   like(fosuff)
     d w_otyp          s                   like(footyp)
     d w_line          s                   like(fdline)
     d w_onum          s                   like(vaonum)
     d w_type          s                   like(vaonum)
     d w_fsys          s                   like(p_fsys)
     d w_tell          s                   like(p_tell)
     d w_ldor          s                   like(fdldor)
      *
7.01  *w_utvgrns = utvidelse av memosaldo(Mestergruppen)
7.01 d w_utvgrns       s              2  0
7.01  *w_memodagr = antall dager ordre skal med i memosaldo
7.01 d w_memodagr      s              3  0
7.01 d w_3x            s              3
7.01 d p_fir           s              3
7.01 d p_kun           s              6
7.01 d w_kgrn          s             11  2
      *
      * Parametre til RS205R - hent mva %
      *
     d w_stat          s              1
     d w_mvak          s              1
     d w_mvtx          s             30
     d w_mvas          s              6  2
     d w_mvat          s              5  4
     d w_mvaf          s             10  9
     d w_bpro          s              5  2
     d w_date          s               d   datfmt(*iso)
     d w_ldat          s               d   datfmt(*iso)
     d w_gral          s                   like(rkgral)
8.01 d w_aktp          s             15
8.01 d w_sgru          s             60
8.01 d w_kkko          s              2  0
8.01 d w_slko          s              2  0
8.01 d w_osuf          s              2  0
8.01 d w_typd          s              4
8.01 d w_kom1          s             30
8.01 d w_kom2          s             30
8.01 d w_opdt          s              1
      *
8.01 d s_numm          s                   like(fonumm)
8.01 d s_suff          s                   like(fosuff)
8.01 d s_firm          s                   like(nofirm)
8.01 d s_fsys          s              3
8.01 d s_scan          s             15
      *
7.02 d u_702           s              1    inz(*off)                            Kredit og memodager
      *
7.02   dcl-s co402_verdi1  char(1);
7.02   dcl-s co402_verdi2  char(2048);
7.02   DCL-PR CO402R EXTPGM('CO402R');
7.02     p_filgrp            char(3)     const;
7.02     p_firm              packed(3:0) const;
7.02     p_lager             packed(2:0) const;
7.02     p_nokkel            char(50)    const;
7.02     p_verdi1            char(1);
7.02     p_verdi2            char(2048);
7.02   END-PR;
8.01  * Uten denne aksepteres ikke *loval som dato
8.01 C/Exec SQL
8.01 C+  Set Option DatFmt=*ISO, DlyPrp=*YES, SRTSEQ=*LANGIDUNQ, LANGID=NOR
8.01 C+  , commit=*none
8.01 C/End-Exec
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B1 Behandle åpningsbildet
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Avbryter dersom ekstern ordre ikke finnes
      *
     c                   eval      nohel1_fsys = p_fsys
     c                   eval      nohel1_tell = p_tell
     c     nohel1_key    chain     nohel1
     c                   if        not %found
     c                   goto      avslutt
     c                   else
     c                   eval      nohelu_fsys = p_fsys
     c                   eval      nohelu_tell = p_tell
     c     nohelu_key    chain     nohelur
     c                   eval      nonumm = *hival
     c                   update    nohelur
     c                   endif
8.01  *
8.01  * Hent også evnt info fra TBU type
8.01  *
8.01 c     nohel1_key    chain     noh2l1
8.01 c                   if        not %found
8.01 c                   eval      n2pref = *blanks
8.01 c                   endif
      *
      * Hent ordretype
      *
     c                   eval      w_otyp = faaot8
     c                   if        w_otyp = *blank
     c                   eval      w_otyp = faaot2
     c                   endif
      *
8.03 c                   if        p_fsys = 'TBU'
8.03 c                   eval      w_otyp = 'T'
8.03 c                   endif
      *
     c                   eval      b1otyp = w_otyp
      *
      * Henter informasjon og kredittsperre og kredittgrense
      * Ved kredittsperre stoppes videre overføring
      *
     c                   eval      rkunl1_kund = nokund
     c     rkunl1_key    chain     rkunl1
7.01  * Beregne memosaldo pr dato, Mestergruppen
7.02 c                   if        u_702 = *on
7.01 c                   if        w_memodagr > 0
7.01 c                   move      w_firm        p_fir
7.01 c                   move      rkunl1_kund   p_kun
7.01 c                   call      'FO763R'
7.01 c                   parm                    p_fir
7.01 c                   parm                    p_kun
7.01 c                   endif
7.02 c                   endif
      * Henter inn memosaldo
     c     rkunl1_key    chain     rkmel1
      *
     c                   if        rkkres = 1
     c                   eval      b_sper = *on
     c                   eval      *in41 = *on
     c                   endif
      *
     c                   if        rkgrns <> 0
7.01  *   Utvide kreditgrense   (Mestergruppen løsning 2017_01)  sst
7.02 c                   if        u_702 = *on
7.01 c                   if        w_sald < rkgrns * 1000
7.01 c                   eval      w_kgrn = rkgrns * 1000 *
7.01 c                                      (1+w_utvgrns/100)
7.01 c                   else
7.01 c                   eval      w_kgrn = rkgrns * 1000
7.01 c                   endif
7.01 c                   if        w_sald > w_kgrn
7.01 c                   eval      *in42 = *on
7.01 c                   endif
7.02 c                   else
     c                   eval      w_sald = rksald + (rkmems * w_mvat)
     c                   if        w_sald > rkgrns
     c                   eval      *in42 = *on
     c                   endif
7.02 c                   endif
     c                   endif
      *
      * Sjekk beløpsgrense almenning fra kunde dersom utfylt
      *
     c                   if        rkgral <> 0
     c                   eval      w_gral = rkgral
      *
     c                   else
      *
      * Ellers hent beløpsgrense almenning
      *
     c                   call      'FO106R'
     c                   parm                    nokund
     c                   parm                    w_gral
      *
     c                   endif
      *
     c                   if        w_gral <> 0
     c                   eval      w_sald = rkkjal + rkmema
     c                   if        w_sald > w_gral
     c                   eval      *in43 = *on
     c                   endif
     c                   endif
      *
      * Behandler bildet
      *
     c     b1taga        tag
      *
     c                   exfmt     b1bld
      *
      * Avbryter ved kredittsperre
      *
     c                   if        b_sper = *on
     c                   goto      avslutt
     c                   endif
      *
      * F3=Avslutt
      *
     c                   if        *inkc or *inkl
     c                   eval      nohelu_fsys = p_fsys
     c                   eval      nohelu_tell = p_tell
     c     nohelu_key    chain     nohelur
     c                   eval      nonumm = 0
     c                   update    nohelur
     c                   eval      p_in03 = '1'
     c                   goto      avslutt
     c                   endif
      *
      * F4=Spørring
      *
     c                   if        *inkd
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1otyp
     c                   goto      b1taga
     c                   endif
      *
      * Validering av ordretype
      *
     c                   if        b1otyp = *blank
     c                   eval      b1otyp = w_otyp
     c                   endif
      *
     c                   eval      votyl1_otyp = b1otyp
     c     votyl1_key    chain     votyl1
     c                   if        not %found
     c                   eval      *in31 = *on
     c                   goto      b1taga
     c                   endif
      *
     c                   if        vaosys <> 0
     c                   eval      *in32 = *on
     c                   goto      b1taga
     c                   endif
      *
8.08 c                   eval      w_otyp = b1otyp
      *
      * Oppretter ordre-hode - opprettes for hver leverandør
      *
     c     edhelr_key    setll     edhelr
     c     edhelr_key2   reade     edhelr
     c                   dow       not %eof
      *
     c                   if        rrnumm = 0
      *
     c                   if        s_ldor <> rrldor or
     c                             rrldor = 0
     c                   exsr      ordre_hode
     c                   endif
      *
      * Oppretter ordre-linje
      *
     c                   exsr      ordre_linje
      *
      * Oppdater ordrehode og memosaldo med verdier fra ordrelinjer
      *
     c                   exsr      oppdat_ordre
      *
      * Kaller program for ordrebehandling
      *
     c                   eval      w_valg = 2
      *
     c                   call      'FO100R'
     c                   parm                    w_valg
     c                   parm                    fonumm
     c                   parm                    fosuff
      *
     c                   endif
      *
     c     edhelr_key2   reade     edhelr
     c                   enddo
      *
      * Oppdater ekstern ordre-hode med ordrenummer
      *
     c                   eval      nohelu_fsys = p_fsys
     c                   eval      nohelu_tell = p_tell
     c     nohelu_key    chain     nohelur
     c                   if        %found
      * Gjøres ikke da det er en til mange referanser her.
     c**                 eval      nonumm = fonumm
     c                   time                    noedat
     c                   time                    noetim
     c                   eval      noeusr = l_user
     c                   update    nohelur
     c                   endif
      *
      * Kaller program for ordrebehandling
      *
     c*                  eval      w_valg = 2
      *
     c*                  call      'FO100R'
     c*                  parm                    w_valg
     c*                  parm                    fonumm
     c*                  parm                    fosuff
      *
      * Kaller program for å sende ordrebekreftelse til nettbutikk
      *
     c*                  if        p_fsys = 'NBU'
     c*                  eval      w_nref = %int(%trim(nonref))
     c*                  call      'NN750C'
     c*                  parm                    w_firm
     c*                  parm                    w_nref
     c*                  parm                    fonumm
     c*                  endif
      *
      * Avslutt program
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Oppretter ordre-hode
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ordre_hode    begsr
      *
      * Hent neste ledig nummer i.h.t. ordretype
      *
     c                   exsr      hent_nummer
8.06  *
8.06  * Slå opp mot evnt tilleggsregister på mottatt EDI medling
8.06  *
8.06 c                   if        nofsys = 'EDI' or
8.06 c                             nofsys = 'EHF' or
8.06 c                             nofsys = 'SMK'
8.06  *
8.06 c     nohel1_key    chain     edh2l1
8.06 c                   if        not %found
8.06 c                   eval      e2lbex = *blanks
8.06 c                   endif
8.06  *
8.06 c                   endif
      *
      * Initierer fil
      *
     c                   eval      s_ldor = rrldor
     c                   eval      fosuff = 00
     c                   eval      fomkod = 0
     c                   eval      fobind = 'N'
      *
     c                   eval      fofirm = nofirm
     c                   eval      fonumm = w_numm
     c                   eval      footyp = b1otyp
     c                   eval      folety = nolety
     c                   eval      fobdat = *loval
     c                   eval      foldat = noldat
     c                   eval      fobetb = 0
     c                   eval      foselg = 0
     c                   eval      folmat = nolmat
8.06 c                   eval      folbtx = e2lbex
     c                   eval      fokund = nokund
     c                   eval      fokpro = nokpro
     c                   eval      fonavn = nonavn
     c                   eval      foadr1 = noadr1
     c                   eval      foadr2 = noadr2
     c                   eval      fosted = %trim(noponr) + ' ' + nosted
     c                   eval      foproj = *blank
     c                   eval      foakti = *blank
     c                   eval      fovref = *blank
     c                   eval      fodref = nodref
     c                   eval      forekv = norekv
     c                   eval      fodate = *loval
     c                   eval      fotime = *loval
     c                   eval      forkat = 0
     c                   eval      fonref = nonref
     c                   eval      fofsys = nofsys
     c                   eval      foavde = noavde
      * Hvis avdeling er 0, hent fra bruker eller kunde
     c                   if        foavde = 0
     c                   if        s_avde <> 0
     c                   eval      foavde = s_avde
     c                   else
     c                   eval      foavde = rkavde
     c                   endif
     c                   endif
      *
     c                   eval      folage = nolage
      *
     c                   eval      w_suff = fosuff
      *
     c                   time                    fobdat
     c                   time                    fodate
     c                   time                    fotime
      *
      * Henter kundeinformasjon
      *
7.04 c                   eval      s_kund = 0
     c                   eval      rkunl1_kund = nokund
     c     rkunl1_key    chain     rkunl1
     c                   if        %found
      *
     c                   eval      fobetb = rkbetb
     c                   eval      fodist = rkdist
     c                   eval      folbet = rklbet
     c                   eval      fovalk = rkvalk
     c                   eval      forkat = rkrabk
     c                   eval      fosped = rksped
     c                   eval      fokjor = rkkjØr
     c                   eval      fomkod = rkmkod
     c                   eval      fokobk = rkordb
     c                   eval      fokgfa = rkfagb
     c                   eval      fokgfr = rkfrgb
     c                   eval      fokgek = rkekgb
     c                   eval      forabp = rkorab
     c                   eval      foneto = rkneto
     c                   eval      fofaty = rkfaty
      *
7.03 c*                  if        rkslgr <> 0
     c                   eval      foselg = rkslgr
7.03 c*                  endif
      *
     c                   if        fonavn = *blank and
     c                             foadr1 = *blank and
     c                             foadr2 = *blank
     c                   eval      fonavn = rknavn
     c                   eval      foadr1 = rkgate
     c                   eval      foadr2 = rkadr2
     c                   eval      fosted = rksted
     c                   endif
7.04  *
7.04  * Sjekk om det er fakturakunde på kunden
7.04  *
7.04 c                   if        rkfaku <> 0
7.04 c                   eval      s_kund = rkfaku
7.04 c                   eval      rkunl1_kund = rkfaku
7.04 c     rkunl1_key    chain     rkunl1
7.04 c                   if        %found
7.04 c                   eval      fobetb = rkbetb
7.04 c                   eval      fodist = rkdist
7.04 c                   eval      folbet = rklbet
7.04 c                   eval      fovalk = rkvalk
7.04 c                   eval      forkat = rkrabk
7.04 c                   eval      fosped = rksped
7.04 c                   eval      fokjor = rkkjØr
7.04 c                   eval      fomkod = rkmkod
7.04 c                   eval      fokobk = rkordb
7.04 c                   eval      fokgfa = rkfagb
7.04 c                   eval      fokgfr = rkfrgb
7.04 c                   eval      fokgek = rkekgb
7.04 c                   eval      forabp = rkorab
7.04 c                   eval      foneto = rkneto
7.04 c                   eval      fofaty = rkfaty
7.04 c                   eval      foselg = rkslgr
7.04 c                   eval      fokund = s_kund
7.04 c                   eval      folkun = nokund
7.04 c                   eval      fokuna = rkalfa
7.04 c                   endif
7.04 c                   endif
      *
     c                   endif
7.03  *
7.03  * Endel av koden er flyttet - logikken blir slik
7.03  * Selger hentes fra tilknyttet brukeren
7.03  * Slår opp på selger, og henter navnet på selger og
7.03  * legger som vår ref på ordren.
7.03  * Hvis selger ikke ligger på bruker, hentes den fra kunden.
      *
      * Hent brukerinformasjon
      *
     c                   if        nouser <> *blank
     c                   eval      fusrl1_user = nouser
     c                   else
     c                   eval      fusrl1_user = l_user
     c                   endif
      *
     c     fusrl1_key    chain     fusrl1
     c                   if        %found
7.03 c**                 eval      fovref = fbvref
7.03 c                   if        fbselg <> 0
     c                   eval      foselg = fbselg
7.03 c                   endif
     c                   endif
7.03  *
7.03  * Henter vår ref fra selger
7.03  *
7.03 c                   eval      ra09l1_ikod = foselg
7.03 c     ra09l1_key    chain     ra09l1r
7.03 c                   if        %found
7.03 c                   eval      fovref = raitxt
7.03 c                   endif
      *
      * Henter kundeprosjekt-informasjon
      *
     c                   if        nokpro <> 0
     c                   eval      fkprl1_kund = nokund
     c                   eval      fkprl1_kpro = nokpro
     c     fkprl1_key    chain     fkprl1
     c                   if        %found
     c                   eval      foproj = flproj
     c                   if        florka <> 0
     c                   eval      forkat = florka
     c                   endif
     c                   if        flfaty <> 0
     c                   eval      fofaty = flfaty
     c                   endif
     c                   eval      fobetb = flbetb
     c                   eval      fomkod = flmkod
     c                   eval      fokgek = flekgb
     c                   eval      foneto = flneto
     c                   eval      fokgfa = flfagb
     c                   endif
      *
     c                   endif
      *
      * Skriver til fil
      *
     c                   eval      fouser = l_user
     c                   time                    fodate
     c                   time                    fotime
     c                   eval      fooous = l_user
     c                   time                    foedat
     c                   time                    foetim
     c                   eval      foeusr = l_user
     c                   write     fohelur
8.01  *
8.01  * Sjekk om dette er en TBU ordre, med parent ref
8.01  *
8.02 c                   eval      b_pref = *off
8.01 c                   if        %trim(n2pref) <> *blanks
8.01  * Finnes det et tilbud på denne referansen fra før, skal den slettes
8.01 c                   eval      s_scan = %trim(n2pref)
8.01 c                   eval      s_fsys = 'TBU'
8.01 c                   eval      s_numm = 0
8.01 c                   eval      s_suff = 0
8.02  * Sett kode for at priser ikke skal endres
8.02 c                   eval      b_pref = *on
8.01 c/exec sql
8.01 c+ select fofirm,
8.01 c+        fonumm,
8.01 c+        fosuff
8.01 c+ into   :s_firm,
8.01 c+        :s_numm,
8.01 c+        :s_suff
8.01 c+ from   fohepf
8.01 c+ where  fofirm = :w_firm and
8.01 c+        fofsys = :s_fsys and
8.01 c+        fonref = :s_scan
8.01 c+ fetch first 1 rows only
8.01 c/end-exec
8.01  *
8.01  * Finnes det et tilbud på denne referansen fra før, skal den slettes
8.01  *
8.01 c                   if        s_numm <> 0
8.01  *
8.01 c                   eval      w_aktp = 'SLETTET'
8.01 c                   eval      w_slko = 99
8.01 c                   eval      w_sgru = 'Overført TBU ordre'
8.01 c                   eval      w_kkko = 0
8.01  *
8.01 c                   call      'XL700R'
8.01 c                   parm                    s_numm
8.01 c                   parm                    w_aktp
8.01 c                   parm                    w_slko
8.01 c                   parm                    w_kkko
8.01 c                   parm                    w_sgru
8.01 c
8.01  *
8.01  *  Kaller opp subprogrammet for sletting av ordre
8.01  *
8.01 c                   eval      w_typd = '*KOP'
8.01 c                   eval      w_kom1 = 'Overført TBU ordre'
8.01 c                   eval      w_kom2 = *blanks
8.01 c                   eval      w_osuf = 0
8.01 c                   eval      w_opdt = *blanks
8.01  *
8.01 c                   call      'FO410R'
8.01 c                   parm                    w_firm
8.01 c                   parm                    s_numm
8.01 c                   parm                    s_suff
8.01 c                   parm                    w_typd
8.01 c                   parm                    w_kom1
8.01 c                   parm                    w_kom2
8.01 c                   parm                    w_opdt
8.01  *
8.01 c                   endif
8.01  *
8.01 c                   endif
      *
      * Oppdater med ordreinfo
      *
     c                   eval      edhelu_ldor = rrldor
     c                   eval      edhelu_ldat = rrldat
     c     edhelu_key    chain     edhelu
     c                   if        %found
     c                   eval      eonumm = fonumm
     c                   eval      eosuff = fosuff
     c                   time                    eoedat
     c                   time                    eoetim
     c                   eval      eoeusr = l_user
     c                   update    edhelur
     c                   endif
      *
     c                   eval      w_line = 0
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Oppretter ordre-linje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ordre_linje   begsr
      *
      * Henter høyeste linjenummer fra ordre-linje
      *
     c                   exsr      hent_linjenr
      *
      * Dersom det ligger melding på ekstern ordre-hode, splittes denne og
      * legges ut som tekstlinjer
      *
     c                   if        nomeld <> *blank
      *
8.05 c                   if        nofsys <> 'EDI' and
8.05 c                             nofsys <> 'EHF' and
8.05 c                             nofsys <> 'SMK'
      *
     c                   eval      w_text = %subst(nomeld:1:70)
     c                   eval      w_line = w_line + 10
     c                   call      'FD111R'
     c                   parm                    w_firm
     c                   parm                    fonumm
     c                   parm                    fosuff
     c                   parm                    w_line
     c                   parm                    faatty
     c                   parm                    w_text
      *
     c                   if        %subst(nomeld:71:70) <> *blank
     c                   eval      w_text = %subst(nomeld:71:70)
     c                   eval      w_line = w_line + 10
     c                   call      'FD111R'
     c                   parm                    w_firm
     c                   parm                    fonumm
     c                   parm                    fosuff
     c                   parm                    w_line
     c                   parm                    faatty
     c                   parm                    w_text
     c                   endif
      *
     c                   if        %subst(nomeld:141:70) <> *blank
     c                   eval      w_text = %subst(nomeld:141:70)
     c                   eval      w_line = w_line + 10
     c                   call      'FD111R'
     c                   parm                    w_firm
     c                   parm                    fonumm
     c                   parm                    fosuff
     c                   parm                    w_line
     c                   parm                    faatty
     c                   parm                    w_text
     c                   endif
      *
     c                   if        %subst(nomeld:211:46) <> *blank
     c                   eval      w_text = %subst(nomeld:211:46)
     c                   eval      w_line = w_line + 10
     c                   call      'FD111R'
     c                   parm                    w_firm
     c                   parm                    fonumm
     c                   parm                    fosuff
     c                   parm                    w_line
     c                   parm                    faatty
     c                   parm                    w_text
     c                   endif
8.05  * Hvis elektronisk, legg det ut som topptekst
8.05 c                   else
8.05  *
8.05 c                   eval      w_text = %subst(nomeld:1:70)
8.05 c                   eval      w_line = 1010
8.05  *
8.05 c                   eval      fotxlu_numm = fonumm
8.05 c                   eval      fotxlu_suff = fosuff
8.05 c                   eval      fotxlu_line = w_line
8.05 c     fotxlu_key    chain     fotxlu
8.05 c                   if        not %found
8.05 c                   eval      ftfirm = fofirm
8.05 c                   eval      ftnumm = fonumm
8.05 c                   eval      ftsuff = fosuff
8.05 c                   eval      ftline = w_line
8.05 c                   eval      fttext = w_text
8.05  *
8.05 c                   time                    ftodat
8.05 c                   time                    ftotim
8.05 c                   eval      ftousr = l_user
8.05 c                   time                    ftedat
8.05 c                   time                    ftetim
8.05 c                   eval      fteusr = l_user
8.05  *
8.05 c                   write     fotxlur
8.05 c                   endif
      *
8.05 c                   if        %subst(nomeld:71:70) <> *blank
8.05 c                   eval      w_text = %subst(nomeld:71:70)
8.05 c                   eval      w_line = w_line + 10
8.05  *
8.05 c                   eval      fotxlu_numm = fonumm
8.05 c                   eval      fotxlu_suff = fosuff
8.05 c                   eval      fotxlu_line = w_line
8.05 c     fotxlu_key    chain     fotxlu
8.05 c                   if        not %found
8.05 c                   eval      ftfirm = fofirm
8.05 c                   eval      ftnumm = fonumm
8.05 c                   eval      ftsuff = fosuff
8.05 c                   eval      ftline = w_line
8.05 c                   eval      fttext = w_text
8.05  *
8.05 c                   time                    ftodat
8.05 c                   time                    ftotim
8.05 c                   eval      ftousr = l_user
8.05 c                   time                    ftedat
8.05 c                   time                    ftetim
8.05 c                   eval      fteusr = l_user
8.05  *
8.05 c                   write     fotxlur
8.05 c                   endif
8.05 c                   endif
      *
8.05 c                   if        %subst(nomeld:141:70) <> *blank
8.05 c                   eval      w_text = %subst(nomeld:141:70)
8.05 c                   eval      w_line = w_line + 10
8.05  *
8.05 c                   eval      fotxlu_numm = fonumm
8.05 c                   eval      fotxlu_suff = fosuff
8.05 c                   eval      fotxlu_line = w_line
8.05 c     fotxlu_key    chain     fotxlu
8.05 c                   if        not %found
8.05 c                   eval      ftfirm = fofirm
8.05 c                   eval      ftnumm = fonumm
8.05 c                   eval      ftsuff = fosuff
8.05 c                   eval      ftline = w_line
8.05 c                   eval      fttext = w_text
8.05  *
8.05 c                   time                    ftodat
8.05 c                   time                    ftotim
8.05 c                   eval      ftousr = l_user
8.05 c                   time                    ftedat
8.05 c                   time                    ftetim
8.05 c                   eval      fteusr = l_user
8.05  *
8.05 c                   write     fotxlur
8.05 c                   endif
8.05 c                   endif
      *
8.05 c                   if        %subst(nomeld:211:46) <> *blank
8.05 c                   eval      w_text = %subst(nomeld:211:46)
8.05 c                   eval      w_line = w_line + 10
8.05  *
8.05 c                   eval      fotxlu_numm = fonumm
8.05 c                   eval      fotxlu_suff = fosuff
8.05 c                   eval      fotxlu_line = w_line
8.05 c     fotxlu_key    chain     fotxlu
8.05 c                   if        not %found
8.05 c                   eval      ftfirm = fofirm
8.05 c                   eval      ftnumm = fonumm
8.05 c                   eval      ftsuff = fosuff
8.05 c                   eval      ftline = w_line
8.05 c                   eval      fttext = w_text
8.05  *
8.05 c                   time                    ftodat
8.05 c                   time                    ftotim
8.05 c                   eval      ftousr = l_user
8.05 c                   time                    ftedat
8.05 c                   time                    ftetim
8.05 c                   eval      fteusr = l_user
8.05  *
8.05 c                   write     fotxlur
8.05 c                   endif
8.05 c                   endif
      *
9.01 c                   endif
      *
     c                   endif
      *
      * Leser alle ekstern ordre-linjer, og legger disse ut som ordre-linjer
      * Leser med utgangspunkt i EDDTLR - plukkregister
      *
     c                   eval      eddtlr_ldor = rrldor
     c                   eval      eddtlr_ldat = rrldat
     c     eddtlr_key    setll     eddtlr
     c     eddtlr_key    reade     eddtlr
     c                   dow       not %eof
      *
     c                   if        edonum = 0
     c                   eval      nodtl1_fsys = p_fsys
     c                   eval      nodtl1_tell = p_tell
     c                   eval      nodtl1_line = edline
     c     nodtl1_key    chain     nodtl1
     c                   if        %found
      *
     c                   eval      w_kode = *blank
     c                   eval      w_line = w_line + 10
     c                   eval      w_ldat = edldat
     c*                  if        w_ldat = *loval
     c*                  eval      w_ldat = noldat
     c*                  endif
     c*                  if        w_ldat = *loval
     c*                  time                    w_ldat
     c*                  endif
      *
     c                   if        ndvare <> *blank
     c*                  if        ndvare <> *blank and
     c*                            edldor = 0
8.02  * Hvis parentref er dette er ordre som ikke skal endre priser
8.02 c                   if        b_pref = *on
8.02 c                   call      'FD116R'
8.02 c                   parm                    w_kode
8.02 c                   parm                    w_firm
8.02 c                   parm                    fonumm
8.02 c                   parm                    fosuff
8.02 c                   parm                    w_line
8.02 c                   parm                    faalty
8.02 c                   parm                    ndlety
8.02 c                   parm                    ndvare
8.02 c                   parm                    ndanta
8.02 c                   parm                    ndenhe
8.02 c                   parm                    w_ldat
8.02 c                   parm                    ndkpri
8.02 c                   parm                    ndntpr
8.02 c                   parm                    ndrab1
8.02 c                   parm                    ndrab2
8.02 c                   parm                    ndkamp
8.02 c                   else
     c                   call      'FD106R'
     c                   parm                    w_kode
     c                   parm                    w_firm
     c                   parm                    fonumm
     c                   parm                    fosuff
     c                   parm                    w_line
     c                   parm                    faalty
     c                   parm                    ndlety
     c                   parm                    ndvare
     c                   parm                    ndanta
     c                   parm                    ndenhe
     c                   parm                    w_ldat
8.02 c                   endif
      *
      * FD112R er skrevet til å hente varer som ikke er kalkulert på systemet. NB Er ikke korrekt,
      * og krever sannsynligvis endel rettelser.
      *
     c*                  elseif    ndvare <> *blank and
     c*                            edldor <> 0
     c*                  call      'FD112R'
     c*                  parm                    w_kode
     c*                  parm                    w_firm
     c*                  parm                    fonumm
     c*                  parm                    fosuff
     c*                  parm                    w_line
     c*                  parm                    faalty
     c*                  parm                    ndlety
     c*                  parm                    ndvare
     c*                  parm                    ndanta
     c*                  parm                    ndenhe
     c*                  parm                    w_ldat
     c*                  parm                    edldor
     c                   else
     c                   eval      w_text = ndtek1 + ndtek2
     c                   call      'FD111R'
     c                   parm                    w_firm
     c                   parm                    fonumm
     c                   parm                    fosuff
     c                   parm                    w_line
     c                   parm                    faatty
     c                   parm                    w_text
     c                   endif
      *
     c                   eval      eddtlu_ldor = rrldor
     c                   eval      eddtlu_ldat = rrldat
     c                   eval      eddtlu_line = edline
     c     eddtlu_key    chain     eddtlu
     c                   if        %found
     c                   eval      xxonum = fonumm
     c                   eval      xxosuf = fosuff
     c                   eval      xxolin = w_line
     c**                 eval      xxldat = w_ldat
     c                   update    eddtlur
     c                   endif
      *
     c                   endif
      *
     c                   endif
      *
     c     eddtlr_key    reade     eddtlr
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Henter inn ordrenummer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_nummer   begsr
      *
     c                   eval      w_kode = '0'
     c                   eval      w_fell = faaork
     c                   eval      w_fast = l_wsid
     c                   eval      w_type = b1otyp
      *
      * Hente inn eventuell overstyrt
      * ordretype for nummerserie
      *
     c                   call      'VA752R'
     c                   parm                    w_firm
     c                   parm                    b1otyp
     c                   parm                    w_onum
      *
     c                   if        w_onum <> *blank
     c                   eval      w_type = w_onum
     c                   endif
      *
      * Kaller subprogram for henting av nummer fra nummer-register
      *
     c                   call      'AS100R'
     c                   parm                    w_kode
     c                   parm                    w_firm
     c                   parm                    w_fell
     c                   parm                    w_type
     c                   parm                    w_fast
     c                   parm                    w_numm
      *
      * sjekker at ordrenr ikke har tidligere relasjoner liggende
      *
     c                   call      'FO415R '
     c                   parm                    w_firm
     c                   parm                    w_numm
      *
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å hente høyeste linjenummer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_linjenr  begsr
      *
     c                   eval      fodtl1_numm = fonumm
     c                   eval      fodtl1_suff = fosuff
     c                   eval      fodtl1_line = 9999
     c     fodtl1_key    setll     fodtl1
     c                   readp     fodtl1
     c                   if        not %eof and
     c                             fdfirm = w_firm and
     c                             fdnumm = fonumm and
     c                             fdsuff = fosuff
     c                   eval      w_line = fdline
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Oppdaterer ordre og memosaldo
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppdat_ordre  begsr
      *
      * Henter ordretotal
      *
     c                   eval      w_tots = 0
     c                   eval      w_totr = 0
     c                   eval      w_totk = 0
     c                   eval      w_tota = 0
     c                   eval      w_totn = 0
     c                   eval      w_tot1 = 0
     c                   eval      w_tot2 = 0
      *
     c     fodtl1_key2   setll     fodtl1
     c     fodtl1_key2   reade     fodtl1
     c                   dow       not %eof
     c                   eval      w_tots = w_tots + fdsums
     c                   eval      w_totr = w_totr + fdsumr
     c                   eval      w_totk = w_totk + fdsumk
      *
     c                   eval      w_totn = fdsums
     c                   eval      w_tot1 = 0
     c                   eval      w_tot2 = 0
      *
     c                   if        fdrab1 <> 0
     c                   eval      w_tot1 = w_totn * fdrab1 / 100
     c                   eval      w_totn = w_totn - w_tot1
     c                   endif
      *
     c                   if        fdrab2 <> 0
     c                   eval      w_tot2 = w_totn * fdrab2 / 100
     c                   eval      w_totn = w_totn - w_tot2
     c                   endif
      *
      * NB!  w_tot1
      * og   w_tot2 brukes om
      * igjen og null-stilles
      *
     c                   eval      w_tot1 = 0
     c                   eval      w_tot2 = 0
      *
     c                   if        fdbrr1 <> 0
     c                   eval      w_tot1 = w_totn * fdbrr1 / 100
     c                   eval      w_totn = w_totn - w_tot1
     c                   endif
      *
     c                   if        fdbrr2 <> 0
     c                   eval      w_tot2 = w_totn * fdbrr2 / 100
     c                   eval      w_totn = w_totn - w_tot2
     c                   endif
      *
     c                   eval      w_tota = w_tota + w_tot1
     c                   eval      w_tota = w_tota + w_tot2
      *
     c     fodtl1_key2   reade     fodtl1
     c                   enddo
      *
      * Beregner justeringsbeløp, og oppdaterer memosaldo
      *
     c                   eval      w_kode = *blank
     c                   eval      w_sald = w_tots - w_totr
      *
     c                   eval      w_sal2 = w_tota
      *
     c                   call      'FA922R'
     c                   parm                    w_firm
     c                   parm                    footyp
     c                   parm                    fokund
     c                   parm                    w_sald
     c                   parm                    w_sal2
      *
      * Oppdaterer ordre-hode med ny saldo
      *
     c                   eval      fohelu_numm = fonumm
     c                   eval      fohelu_suff = fosuff
     c     fohelu_key    chain     fohelur
      *
     c                   eval      fotots = w_tots
     c                   eval      fototr = w_totr
     c                   eval      fototk = w_totk
     c                   eval      fobrra = w_tota
      *
     c                   time                    foedat
     c                   time                    foetim
     c                   eval      foeusr = l_user
     c                   update    fohelur
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_firm
     c                   parm                    p_fsys
     c                   parm                    p_tell
     c                   parm                    p_ldor
     c                   parm                    p_in03
      *
      * Key for oppslag på ekstern ordre-hode
      *
     c     nohel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nohel1_fsys
     c                   kfld                    nohel1_tell
      *
      * Key for les på ekstern ordre-linje
      *
     c     nodtl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nodtl1_fsys
     c                   kfld                    nodtl1_tell
     c                   kfld                    nodtl1_line
      *
      * Key for oppslag på ordre-type
      *
     c     votyl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    votyl1_otyp
      *
      * Key for oppslag på ordre-status
      *
     c     fstsl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på ordre-bruker
      *
     c     fusrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fusrl1_user
      *
      * Key for oppslag på kunde
      *
     c     rkunl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl1_kund
      *
      * Key for oppslag på kundeprosjekt
      *
     c     fkprl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fkprl1_kund
     c                   kfld                    fkprl1_kpro
      *
      * Key for oppdatering av ekstern ordre-hode
      *
     c     nohelu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nohelu_fsys
     c                   kfld                    nohelu_tell
      *
      * Key for oppdatering av ordre-hode
      *
     c     fohelu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fohelu_numm
     c                   kfld                    fohelu_suff
      *
      * Key for oppslag på ordre-linje
      *
     c     fodtl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fodtl1_numm
     c                   kfld                    fodtl1_suff
     c                   kfld                    fodtl1_line
      *
     c     fodtl1_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    fodtl1_numm
     c                   kfld                    fodtl1_suff
      *
     c     ausrl1_key    klist
     c                   kfld                    ausrl1_user
      *
      * Key for oppslag på utplukkede linjer
      *
     c     eddtlr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_fsys
     c                   kfld                    w_tell
     c                   kfld                    eddtlr_ldor
     c                   kfld                    eddtlr_ldat
      *
      * Key for oppslag på utplukkede linjer - linjer
      *
     c     eddtlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_fsys
     c                   kfld                    w_tell
     c                   kfld                    eddtlu_ldor
     c                   kfld                    eddtlu_ldat
     c                   kfld                    eddtlu_line
      *
      * Key for oppslag på utplukkede linjer - hode
      *
     c     edhelu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_fsys
     c                   kfld                    w_tell
     c                   kfld                    edhelu_ldor
     c                   kfld                    edhelu_ldat
      *
      * Key for oppslag på utplukkede linjer - hode
      *
     c     edhelr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_fsys
     c                   kfld                    w_tell
     c                   kfld                    edhelr_ldor
     c                   kfld                    edhelr_ldat
      *
      * Key for oppslag på utplukkede linjer - hode
      *
     c     edhelr_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    w_fsys
     c                   kfld                    w_tell
7.01  *
7.01  * Key for propertiesfil
7.01  *
8.04 c*    afpslr_key    klist
8.04 c*                  kfld                    afpslr_ufil
8.04 c*                  kfld                    afpslr_uide
7.03  *
7.03  * Key for oppslag på selger
7.03  *
7.03 c     ra09l1_key    klist
7.03 c                   kfld                    w_firm
7.03 c                   kfld                    ra09l1_ikod
8.05  *
8.05  * Key for topp/bunn tekst linjer
8.05  *
8.05 c     fotxlu_key    klist
8.05 c                   kfld                    w_firm
8.05 c                   kfld                    fotxlu_numm
8.05 c                   kfld                    fotxlu_suff
8.05 c                   kfld                    fotxlu_line
      *
      * Henter firma fra parameter
      *
     c                   eval      w_firm = p_firm
     c                   eval      w_fsys = p_fsys
     c                   eval      w_tell = p_tell
     c                   eval      edhelr_ldor = p_ldor
     c                   eval      edhelr_ldat = *loval
      *
      * Henter informasjon fra ordre-status
      *
     c     fstsl1_key    chain     fstsl1
      *
      * Hent mva % for beregning av memosaldo inkl. mva
      *
     c                   eval      w_stat = *blank
     c                   eval      w_mvak = '3'
     c                   time                    w_date
      *
     c                   call      'RS205R'
     c                   parm                    w_stat
     c                   parm                    w_mvak
     c                   parm                    w_mvtx
     c                   parm                    w_date
     c                   parm                    w_mvas
     c                   parm                    w_mvat
     c                   parm                    w_mvaf
     c                   parm                    w_bpro
      *
      * Henter opplysninger fra BRUKER-REGISTERENE
      *
     c                   eval      ausrl1_user = l_user
     c     ausrl1_key    chain     ausrl1
     c                   if        %found(ausrl1)
     c                   eval      s_avde = absavd
     c                   else
     c                   eval      s_avde = 0
     c                   endif
7.01  *
7.01  *   Hent inn % utvidelse av kreditgrense
7.01  *
8.04 c*                  eval      afpslr_ufil = l_filg
8.04 c*                  eval      afpslr_uide = 'KRGRNSUTV'
8.04 c*    afpslr_key    chain     afpslrr
8.04 c*                  if        %found(afpslr)
8.04 c*                  movel     afudss        w_utvgrns
8.04 c*                  endif
7.01  *
7.01  *   Hent inn ant dager fram ordre skal med i memosaldo
8.04 c*                  eval      afpslr_uide = 'MEMODAGER'
8.04 c*    afpslr_key    chain     afpslrr
8.04 c*                  if        %found(afpslr)
8.04 c*                  movel     afudss        w_3x
8.04 c*                  move      w_3x          w_memodagr
8.04 c*                  endif
7.01  *
7.02  * Utvidet memosaldo
8.04  *   Hent inn % utvidelse av kreditgrense
8.04  *   Hent inn ant dager fram ordre skal med i memosaldo
7.02  *
8.04 c                   eval      w_memodagr = 999
8.04 c                   eval      w_utvgrns  = 0
7.09  *
7.02   CallP CO402R(l_filg:w_firm:0:'UTVIDET_MEMOSALDO':
7.02                    co402_verdi1:co402_verdi2);
7.02   if co402_verdi1 = '1';
7.02     u_702 = *on;
8.04     if  %subst(co402_verdi2:1:3) <> *blank;
8.04       w_memodagr = %dec(%subst(co402_verdi2:1:3):3:0);
8.04     endif;
8.04     if  %subst(co402_verdi2:133:2) <> *blank;
8.04       w_utvgrns = %dec(%subst(co402_verdi2:133:2):2:0);
8.04     endif;
7.02   endif;
      *
     c                   endsr
