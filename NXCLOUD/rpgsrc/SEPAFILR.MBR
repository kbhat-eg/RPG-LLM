**FREE
 ctl-opt datedit(*dmy);
 ctl-opt datfmt(*iso);

//      System  . . . . : NXCLOUD
//      Program . . . . : GETIFSFILE
//      Beskrivelse . . : Leser angitt katalog og behandler fil for fil
//
//      Ref.   Dato  Sign Endringsbeskrivelse
//      ----- ------ ---- -------------------------------------------------
//            030125 ask  Nytt program


       /copy RWUTIL/QRPGLESRC,GETIFSPR

//      Definering av variable

        dcl-s  FilePath    varchar(50);
        dcl-s  p_Name      char(50);
        dcl-ds IFSRetur    likeds(IFSList);
        dcl-s  lin         int(5:0);

// Fix program

        dcl-pr sepafixc extpgm;
           w_fnam      char(50);
        end-pr;

// Finner Ã¸nsket katalog i AFPSPF

     exec sql
       select afudss
         into :FilePath
         from afpspf
           where afuide  = 'SEPAIN';

     if sqlcod <> 0000;
     *inlr = *on;
     return;
     endif;
     FilePath = %trimr(FilePath);

// Kaller prosedyre og henter directoy liste

       IFSRetur = CheckIFS(FilePath);
            if IFSRetur.Status = 'E';
              *inlr = *on;
              return;
            EndIf;

// Leser liste og behandler fil for fil

     lin = 1;

     dow lin < 501 and
         IFSRetur.IFSLink(lin) <> '  ';
          p_Name = IFSRetur.IFSLink(lin);
          sepafixc(p_Name);
          lin = lin + 1;
     enddo;

//      Avslutt program

     *inlr = *on;
     return;
