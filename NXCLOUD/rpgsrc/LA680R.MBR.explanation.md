# Program Documentation: LA680R – Inventory Control Against Milestones

## Overview

**System:** ASLAGR  
**Program:** LA680R  
**Description:**  
This program is used to control and validate warehouse inventory against defined milestones. It is primarily an interactive program that collects user input, validates it, and then triggers the relevant control routines. The main business purpose is to ensure that inventory data entered by users is consistent and meets certain criteria before further processing.

---

## Structure and Flow

### Initialization

- **Local Data Area (LDA):**  
  The program retrieves session/user-specific data (user ID, firm code, etc.) from the LDA for use throughout the session.
- **Initialization Subroutine (`*inzsr`):**  
  Sets up initial values, particularly copying the firm code from the LDA to the working variable `w_firm`.

### Main Program Loop

1. **Field Reset:**  
   At program start (`start_pgm`), all screen fields (warehouse, parameters, date) are cleared or set to blanks/zero.
2. **Screen Display:**  
   The main screen (`B1BLD`) is displayed and user input is captured via `exfmt`.
3. **Function Key Handling:**  
   - **F3 (Exit):** If pressed, program terminates.
   - **F4 (Inquiry):** Calls program `RA510R` for warehouse inquiry, passing relevant parameters, then returns to the input screen.
4. **Validation:**
   - **Warehouse Validation:**  
     Calls program `FØ720R` to validate the entered warehouse. If invalid, sets error indicator and returns to input screen.
   - **Date Validation:**  
     If date validation is requested (`b1val3 = 1`), tests the entered date. If invalid, sets error indicator and returns to input screen.
5. **Control Routine Call:**  
   If at least one validation parameter is set, prepares a parameter structure and calls the control routine (`LA680C`), passing the packed parameters.
6. **Program Exit:**  
   On completion or exit request, sets LR indicator and returns.

---

## Key Data Structures

### Local Data Area (LDA) Fields

- **l_user:** User ID from LDA (positions 911–920)
- **l_firm:** Firm/Company code from LDA (positions 944–946)
- **l_fnav:** User name or navigation info from LDA (positions 951–980)

### Parameter Data Structure (`d_parm`)

A 20-byte structure used to pass parameters to the control routine and external programs:

| Field     | Length | Type      | Overlay Offset | Purpose                       |
|-----------|--------|-----------|---------------|-------------------------------|
| d_firm    | 3      | Zoned(3,0)| 1             | Firm code                     |
| d_lage    | 2      | Zoned(2,0)| 4             | Warehouse code                |
| d_val1    | 1      | Zoned(1,0)| 6             | Validation parameter 1        |
| d_val2    | 1      | Zoned(1,0)| 7             | Validation parameter 2        |
| d_val3    | 1      | Zoned(1,0)| 8             | Validation parameter 3        |
| d_dato    | 8      | Date      | 9             | Date parameter (ISO format)   |
| d_dumm    | 1      | Char      | 20            | Dummy, initialized to '*'     |

### Working Variables

- **w_firm:** Working copy of firm code
- **w_parm:** Working packed parameter string for external calls
- **w_latx, w_adrs, w_ponr, w_pste, w_avde:** Various warehouse-related fields returned from validation routines

---

## Screen Handling

- **Display File:** `LA680D` (workstation file)
- **Main Screen Format:** `B1BLD`  
  Used for parameter selection and data entry.

### Indicator Usage

- **LR:** End of program
- **21:** Home key
- **22:** Cursor placement
- **30:** Field protection on display
- **31–79:** Error/warning indicators for messages and screen feedback
- **80–99:** Working indicators

---

## External Program Calls

- **RA510R:**  
  Inquiry program for warehouse information. Called when F4 is pressed.
- **FØ720R:**  
  Warehouse validation program. Checks if the entered warehouse code is valid and retrieves related info.
- **LA680C:**  
  Main control routine. Receives packed parameters and performs the actual inventory/milestone control logic.

---

## Business/Domain Logic

- **Parameter Validation:**  
  The program expects the user to enter a warehouse and up to three validation parameters (val1, val2, val3). If date validation is requested (`val3`), a date must also be entered and validated.
- **Milestone Control:**  
  The core business logic (not shown here) is executed in `LA680C`, which uses the parameters collected and validated by this program.

---

## Design Decisions and Conventions

- **Parameter Packing:**  
  Parameters for external calls are packed into a single data structure (`d_parm`). This is a common pattern in this codebase for modularity and to simplify parameter passing between RPG programs.
- **Indicator-Driven UI:**  
  The program uses standard indicator conventions for error handling and screen interaction, which is consistent throughout the ASLAGR system.
- **Separation of Concerns:**  
  User interaction, validation, and core business logic are separated into different programs/modules, promoting maintainability and reuse.

---

## Relationships and Dependencies

- **Display File (`LA680D`):**  
  Defines the user interface for parameter entry.
- **Other Programs:**
  - **RA510R:** Inquiry support (user assistance)
  - **FØ720R:** Warehouse validation (data integrity)
  - **LA680C:** Main control logic (business rules)

---

## Summary

LA680R serves as the entry point for users to initiate inventory control operations against warehouse milestones. It validates user input, ensures data integrity, and delegates business logic to specialized routines. Understanding this program is essential for working with the inventory control workflow and its associated validation and control routines within the ASLAGR system.