# Program Overview  
This RPGLE program **MM401R** runs on the ASLOGI system and its sole purpose is to delete all records from the deviation register (file *MPRALU*) for a given company code.

---

## File Declaration  
- **MPRALU** (physical file)  
  - External name: `mprapfr`  
  - Internal alias: `mpralur`  

---

## Data Areas & Variables  

1. **Local Data Area (UDS)**  
   - Field `l_firm` (positions 944–946)  
     • Contains the current company code loaded from the data area at program start.  

2. **Working-Storage Fields**  
   - `w_firm`  
     • Defined **like(MQFIRM)**  
     • Holds the same company code as `l_firm` for use in file keying.  

3. **File Field**  
   - `mpralu_firm`  
     • Mirrors the `FIRM` field in the MPRALU file structure.  

---

## Program Flow  

1. **Initialization** (`*INZSR`)  
   - Build the key list `mpralu_key` using `w_firm`.  
   - Load `w_firm = l_firm`  

2. **Main Logic**  
   - Invoke the subroutine `slett_avvik`  

3. **Termination** (`avslutt` tag)  
   - Set `*INLR = *ON` to end the program.  

---

## Subroutine: slett_avvik  

Purpose: Loop through all deviation-register records for the current company and delete them.

Step-by-step:  
1. **Position to First Record**  
   - `SETLL` on `mpralu` using `mpralu_key` (company code).  
2. **Read First Equal Record**  
   - `READEC mpralu_key` → fetch first matching record.  
3. **Loop Until End-of-File**  
   - `DOW NOT %EOF`  
     • `DELETE` the current record from `mpralur`.  
     • `READE` to fetch the next record with the same key.  
   - `ENDDO`  
4. **Return** from subroutine  

---

## Key List Definition (`mpralu_key`)  

- Defined in the **Initialization** subroutine (`*INZSR`):  
  - Contains a single key field: `w_firm`  
  - Drives the `READE`/`SETLL` operations in `slett_avvik`.  

---

**Pedagogical Notes**  
- *SETLL* positions the file cursor to the start of records matching the key.  
- *READE* reads only records with a key equal to the specified value.  
- Setting `*INLR = *ON` ensures cleanup and program termination.