# Overview

This RPG (Report Program Generator) program (LE226R) generates a printed **inventory value list** (lagerverdiliste) for a company, detailing inventory quantities and values, grouped and subtotaled by various product grouping levels: warehouse (lager), item number (varenummer), main group (hovedgruppe), and overarching group (overgruppe), with calculated totals at each level.

The program uses classic fixed-format RPG IV (ILE RPG) code, including file specifications, data declarations, calculation logic, and output specifications for formatted printing.

# Key Sections Explained

---

## 1. **File Specifications**

```rpg
flwa1l1    ip   e           k disk
f            rename(lwa1pfr:lwa1l1r)
fvvarl1    if   e           k disk
f            rename(vvarpfr:vvarl1r)
fvogrl1    if   e           k disk
f            rename(vogrpfr:vogrl1r)
fvhgrl1    if   e           k disk
f            rename(vhgrpfr:vhgrl1r)
fliste     o    f  132        printer oflind(*inof)
```

- **Input:** Reads database files with product, group, and inventory data, with logical record format renaming.
- **Output:** Produces a report (printer file) with 132-column width.

---

## 2. **Data Declarations**

### a. Character/Decimal Fields

These fields store various working and output values for subtotals and descriptions, e.g.:

```rpg
d lcfvar                300    314
d lctdat                        10d   datfmt(*iso)
d ant30           s              8  0
d sal3            s             11  2
...
```

- **antXX variables:** Track quantities at various subtotal levels (e.g. ant30 = qty for warehouse, ant53 = subtotal for item).
- **bevX, kosX, salX:** Totals for movement, cost, and sales value at each level.
- **ww...:** Work variables, often used as keys for chains or for fetching descriptions.

---

### b. Key lists

Key lists are used for keyed database record access (CHAIN operation):

```rpg
c     varkey        klist
c                   kfld                    wwfirm
c                   kfld                    wwvare
```

Each `klist` groups fields to be used as composite keys.

---

## 3. **Input Section**

```rpg
ilwa1l1r
i                                          mlfirm        l7
i                                          mlogrp        l6
i                                          mlhgrp        l5
i                                          mlvare        l4
i                                          mllage        l3
```

- The program reads inventory records by company, overgroup, main group, item, and warehouse (the order of group breaks).

---

## 4. **Calculation Section**

### a. **Initialization**

- Turns off heading indicator.
- Zeros all subtotal fields at each group break (lager, varenummer, hovedgruppe, overgruppe) using labeled condition indicators (l3, l4, l5, l6).

### b. **Main Logic (per record):**

Key steps:

- **Item Lookup**: CHAIN into item master (vvarl1) to get item details.
- **Decimals Check**: Determines display/processing based on how many decimals are used for the item.
- **Quantity Calculation**: Adds current record's quantity to subtotal.
- **Value Calculation**: Updates cost and sales value accumulators.
- **Movement Calculation**: Determines if item movement occurred before a cut-off date.

Group break logic (on l3, l4, l5, l6) accumulates subtotals for each level, and reads in group descriptions (with CHAINs to group files).

### c. **Initialization Subroutine**

`*inzsr` sets up selection flags, handles date formatting, initializes company number, and builds key lists for database access.

---

## 5. **Output Section**

Uses classic RPG O-specs to format and print the report.

- **Page Headers:** Company, operator, date, time, page number.
- **Column Headers:** Item, description, units, prices, values, etc.
- **Detail Lines:** For each item/warehouse, prints values if quantity > 0.
- **Subtotals:** At each group break, prints subtotal lines for main group, overgroup, etc.
- **Grand Totals:** Prints firm-wide totals at bottom.

Conditional indicators (e.g. l3, l4, l5, l6) control when certain subtotal lines print, based on group breaks.

---

# Walkthrough of Processing

1. **Program starts and initializes variables** (totals, date, etc).
2. **Reads each inventory record** (lwa1l1).
3. **At each group break** (warehouse, item, main group, overgroup):  
   - Zeros appropriate accumulators.
   - On break, prints subtotal lines.
4. **For each record:**
   - Looks up item details.
   - Accumulates quantity, cost, sales, and movement values.
   - Handles record according to number of decimals for item.
5. **Prints details and sub/group totals**, per the O-specs.
6. **At end, prints overall totals.**

---

# Key Concepts

- **Group Breaks:** The code relies heavily on group break logic (l3, l4, l5, l6) to aggregate and print subtotals at the right times.
- **CHAIN Database Lookups:** Used to fetch supplementary data, such as item descriptions or group names.
- **Calculation and Output Separation:** Calculations use C-specs; output uses O-specs, with conditional indicators harmonizing printing and logic.
- **Date and Format Handling:** Dates are managed both numerically and as display fields; report is formatted with user, date, firm, etc.

---

# Typical Use Case

A user (operator) runs this program to print a detailed inventory value report by warehouse, item number, main group, and overgroup, showing quantities and monetary values, with sub-totals and totals, as of a specific date, for company accounting or management review.

---

# Norwegian Terms in Code

- **Vare** = Item/product
- **Lager** = Warehouse
- **Hovedgruppe** = Main group
- **Overgruppe** = Overarching group
- **Betegnelse** = Description
- **Salgspris** = Sales price
- **Kostpris** = Cost price
- **Antall** = Quantity
- **Verdi** = Value
- **Beholdning** = Stock/Inventory
- **Eldre enn** = Older than

---

# Conclusion

This program is a solid example of a classic RPG inventory report, using group break logic to print a structured, subtotaled inventory valuation, with supporting lookups, formatted output, and date-sensitive calculations.