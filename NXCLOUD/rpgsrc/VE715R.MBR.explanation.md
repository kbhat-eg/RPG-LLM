## Overall Description

This RPG (Report Program Generator) program is named `VE715R`. Its main purpose is to return item-related information (item number, NOBB number, unit) for a given company and EAN (GTIN) number.

- **Inputs:** Company number (`firma`), EAN number (`eannr`)
- **Outputs:** Item number (`vare`), Unit (`enhet`), NOBB number (`nobb`), Status (`status`: '1' = found/ok, blank = not found)

The code interacts with three database files, using them to look up and return related data.

---

## Detailed Walkthrough

### 1. File Declarations

```rpg
fvvepl2    if   e           k disk    rename(vveppfr:vvepl2r)
fveanl1    if   e           k disk    rename(veanpfr:veanl1r)
fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
```
- **vvepl2**: Item-unit mapping file
- **veanl1**: EAN-to-item mapping file
- **vvarl1**: Item master file

All files are opened for input and have keys, using external formats renamed to `vvepl2r`, `veanl1r`, `vvarl1r`.

---

### 2. Variable Definitions

**Key Variables:**
Variables used as keys for database lookups, e.g.:
- `vvepl2_pfir`, `vvepl2_pgti`: To read `vvepl2`
- `veanl1_firm`, `veanl1_eann`: To read `veanl1`
- `vvarl1_vare`: To read `vvarl1`

**Parameter Variables:**
Used for input/output parameters via the parameter list:
- `p_firm`: Company number (input)
- `p_eann`: EAN number (input)
- `p_vare`: Item number (output)
- `p_enhe`: Unit (output)
- `p_nobb`: NOBB number (output)
- `p_stat`: Status (output, 1=OK)

---

### 3. Main Logic

#### **a. Output Parameter Initialization**
```rpg
c                   eval      p_vare = *blank
c                   eval      p_enhe = *blank
c                   eval      p_nobb = *zero
c                   eval      p_stat = *blank
```
All output parameters are initialized to "not found" values.

#### **b. Early Exit for EAN = 0**
```rpg
c                   if        p_eann = 0
c                   goto      avslutt
c                   endif
```
If the EAN is zero, the program skips processing.

#### **c. Primary Lookup (`vvepl2` for item & unit)**

1. Set up keys for file.
2. `CHAIN` (random read) into `vvepl2` using company and EAN.
3. If found:
   - Set item number and unit from the file, set status to '1'.

#### **d. Secondary Lookup (`veanl1` for item only)**

If not found in primary:
- Try the `veanl1` file (EAN register) for the item number, update status to '1' on success.

#### **e. NOBB Number Lookup (`vvarl1`)**

If status is '1' (found so far):
- Read `vvarl1` (item master), using item number and company, to get the NOBB number.

---

### 4. Parameter List & Key Lists

- **Parameter List (`*entry plist`):**  
  The program is called with a list of parameters (company, EAN, etc.).
- **KLISTs:**  
  Defines composite keys for chained reads to the files.

---

### 5. Program End

```rpg
c                   eval      *inlr = *on
c                   return
```
Sets the last record indicator (`*inlr`) to release resources and ends the program.

---

## Summary Table

| Step         | File     | Purpose                                  | Key Fields                | Output fields set      |
|--------------|----------|------------------------------------------|---------------------------|------------------------|
| 1 (primary)  | vvepl2   | Find item number and unit by EAN/company | p_firm, p_eann            | p_vare, p_enhe, p_stat |
| 2 (secondary)| veanl1   | Find item number if not found above       | p_firm, p_eann            | p_vare, p_stat         |
| 3 (tertiary) | vvarl1   | Find NOBB number by item/company         | p_firm, p_vare            | p_nobb                 |

---

## Business Rule Notes

- If EAN is blank or zero, nothing is returned.
- Lookup prefers the unit-specific file; if not found, falls back to a simpler mapping.
- NOBB number is only fetched if an item was found via EAN.
- Status `p_stat` is used to communicate if a result was found.

---

## Usage

This program is typically called from other applications or batch jobs to resolve product details based on GTIN numbers. Output parameters are provided by reference, so the calling program receives the results directly.

---

## Maintenance History

See program header for brief change log:
- Initially created 2010-10-11.
- Updated 2011-10-04 to return nothing if GTIN/EAN is 0.

---

### **Onboarding Tips**

- You must understand the structure of the three files accessed.
- Familiarity with CHAIN operation and parameter passing conventions in RPG III/400 is important.
- Most customizations or bug fixes will involve adjusting the lookup logic or adding extra file reads.

---

**If you have any file layouts or typical call scenarios, it will make debugging and enhancements much easier!**