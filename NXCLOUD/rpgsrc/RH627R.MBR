      /TITLE  Utskrift av saldobalanse       Sist endret: 18.01.02
     h datedit(*dmy) option(*nodebugio)
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RH627R                                              *
      * Beskrivelse . . : Utskrift av kostnadsbærerrapport                    *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
      *                                                                       *
T400  * V4.00     040302  Nytt pgm. basert på RH621R                     HFL  *
T400  * V4.00     080402  Endret beregning av oppnådd/brukt               HFL *
6.30  * V6.30     040719  Utvidet saldofelter                             bsa *
      *                                                                       *
      *                                                                       *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     frhsal1    if   e           k disk    rename(rhsapfr:rhsal1r)
     frhsal2    if   e           k disk    rename(rhsapfr:rhsal2r)
     frhsal3    if   e           k disk    rename(rhsapfr:rhsal3r)
     frhovlr    if   e           k disk    rename(rhovpfr:rhovlrr)
T400 fra28lr    if   e           k disk    rename(ra28pfr:ra28lrr)
      *
E400 frh627p    o    e             printer oflind(*in30)
      *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      *               T   A   B   E   L   L   E   R                      +
      *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      *
6.30 d sal             s             15  2 dim(13)
     d txt             s             30    dim(2) ctdata perrcd(1)
     d uav             s              5  0 dim(8)
      *
     d                 ds
     d nybrd                         13  0                                      Bruddb
     d  nyavd                         4  0 overlay(nybrd)                       Avdeli
     d  nykto                         5  0 overlay(nybrd:5)                     Konto
     d   nygrp                        2  0 overlay(nykto:2)                     Gruppe
     d    nykla                       1  0 overlay(nygrp)                       Klasse
     d  nysps                         4  0 overlay(nybrd:10)                    Spesif
      *
     d                 ds
     d gmbrd                         13  0                                      Bruddb
     d  gmavd                         4  0 overlay(gmbrd)                       Avdeli
     d  gmkto                         5  0 overlay(gmbrd:5)                     Konto
     d   gmgrp                        2  0 overlay(gmkto:2)                     Gruppe
     d    gmkla                       1  0 overlay(gmgrp)                       Klasse
     d  gmsps                         4  0 overlay(gmbrd:10)                    Spesif
      *
     d  nyavdo         s              4  0                                      Spesif
     d  gmavdo         s              4  0                                      Spesif
T400 d ra28lr_Økod     s                   like(rebkod)
      *
     d                uds
     d rhpkda                300    305  0
     d rhprÅr                         4  0
     d rhpper                         2  0
     d rhppef                         2  0
     d rhppet                         2  0
     d rhpbØf                         4  0
     d rhpbØt                         4  0
T400 d rhpbÆf                         2
T400 d rhpbÆt                         2
     d rhpktf                         5  0
     d rhpktt                         5  0
     d rhpavf                         4  0
     d rhpavt                         4  0
     d rhpsrt                         1
     d rhpsml                         1
     d rhpavv                         1
     d rhpkgs                         1
     d rhpkks                         1
     d*rhpgrs                         1
      *
     d l_wsid                901    910
     d l_user                911    920
     d l_firm                944    946  0
     d l_navn                951    980
      *
     d antkto          s                   like(totkto)
     d antsps          s                   like(totkto)
     d bev             s                   like(risa01)
     d difh            s                   like(risa01)
     d difp            s                   like(risa01)
     d lrbevd          s                   like(risa01)
     d lrbevk          s                   like(risa01)
     d lrdifh          s                   like(risa01)
     d lrdifp          s                   like(risa01)
     d lrsald          s                   like(risa01)
     d lrsalk          s                   like(risa01)
     d l1beÅr          s                   like(risa01)
     d l1befj          s                   like(risa01)
     d l1bevp          s                   like(risa01)
     d l1buÅr          s                   like(risa01)
     d l1bufj          s                   like(risa01)
     d l1busÅ          s                   like(risa01)
     d l1busf          s                   like(risa01)
     d l1saÅr          s                   like(risa01)
     d l1safj          s                   like(risa01)
     d l1salh          s                   like(risa01)
     d l1samh          s              9  0
     d l1samp          s              9  0
     d l2bevp          s                   like(risa01)
     d l2salh          s                   like(risa01)
     d*l2samh          s                   like(risa01)
     d*l2samp          s                   like(risa01)
     d l2samh          s              9  0
     d l2samp          s              9  0
     d l3bevp          s                   like(risa01)
     d l3salh          s                   like(risa01)
     d l3samh          s              9  0
     d l3samp          s              9  0
     d l4bevp          s                   like(risa01)
     d l4salh          s                   like(risa01)
     d l4samh          s              9  0
     d l4samp          s              9  0
     d l5bevp          s                   like(risa01)
     d l5salh          s                   like(risa01)
     d l5samh          s              9  0
     d l5samp          s              9  0
     d m               s              2  0
     d n               s              2  0
     d x               s              2  0
     d prfjo           s                   like(rhprÅr)
E400 d proh            s              7  1
E400 d prop            s              7  1
6.30 d risa01          s             15  2
     d samh            s                   like(risa01)
     d samp            s                   like(risa01)
     d sum             s                   like(risa01)
     d totkto          s              5  0
     d totsid          s                   like(totkto)
     d wavde           s                   like(rhavde)
     d wmvak           s                   like(rhmvak)
     d wmvao           s                   like(rhmvao)
     d wtext           s                   like(rhtext)
      *
     d w_type          s                   like(ritype)
     d w_firm          s                   like(rhfirm)
T.500d w_xuav          s              6  0
     d p_stat          s              1
     d p_tx30          s             30
     d p_gkod          s                   like(rhavde)
     d p_Økod          s                   like(rhspes)
     d p_skod          s              2  0
     d p_tkod          s              2  0
     d avtext          s             30
     d grtext          s             30
     d kltext          s             30
      *
     d rhovlr_kont     s                   like(rikont)
     d rhovlr_spes     s                   like(rispes)
     d rhovlr_avde     s                   like(riavde)
      *
     irhsal1r
      *  Saldo-register - Kontonr.rekkefølge
     i              risa01                      sal(01)
     i              risa02                      sal(02)
     i              risa03                      sal(03)
     i              risa04                      sal(04)
     i              risa05                      sal(05)
     i              risa06                      sal(06)
     i              risa07                      sal(07)
     i              risa08                      sal(08)
     i              risa09                      sal(09)
     i              risa10                      sal(10)
     i              risa11                      sal(11)
     i              risa12                      sal(12)
     i              risa13                      sal(13)
      *
     irhsal2r
      *  Saldo-register - Avdelingsrekkefølge
     i              risa01                      sal(01)
     i              risa02                      sal(02)
     i              risa03                      sal(03)
     i              risa04                      sal(04)
     i              risa05                      sal(05)
     i              risa06                      sal(06)
     i              risa07                      sal(07)
     i              risa08                      sal(08)
     i              risa09                      sal(09)
     i              risa10                      sal(10)
     i              risa11                      sal(11)
     i              risa12                      sal(12)
     i              risa13                      sal(13)
      *
     irhsal3r
      *  Saldo-register - Kostnadsbærerrekkefølge
     i              risa01                      sal(01)
     i              risa02                      sal(02)
     i              risa03                      sal(03)
     i              risa04                      sal(04)
     i              risa05                      sal(05)
     i              risa06                      sal(06)
     i              risa07                      sal(07)
     i              risa08                      sal(08)
     i              risa09                      sal(09)
     i              risa10                      sal(10)
     i              risa11                      sal(11)
     i              risa12                      sal(12)
     i              risa13                      sal(13)
      *
     c     dummy         tag
      *
     c                   select
     c                   when      rhpsrt = 'K'
     c     rhsal1_key    setll     rhsal1r                                61
     c     rhsal1_key    reade     rhsal1r                                61
     c                   when      rhpsrt = 'A'
     c     rhsal2_key    setll     rhsal2r                                61
     c     rhsal2_key    reade     rhsal2r                                61
     c                   when      rhpsrt = 'B'
     c     rhsal3_key    setll     rhsal3r                                61
     c     rhsal3_key    reade     rhsal3r                                61
     c                   endsl
      *
     c                   dow       *in61 = *off                                          .....
      *
     c                   move      ritype        w_type
      *
      * Sjekk om brudd i kontrollbegrepet
      *
     c                   move      riavde        nyavd
     c                   move      rikont        nykto
     c                   move      rispes        nysps
     c                   move      riavde        nyavdo
      *
      * Sjekk årstall mot parameter
      *
     c                   if        riraar > rhprÅr                                       .....
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *
     c                   if        rhpsml = 'F' and                                      .....
     c                             riraar < rhprÅr - 1                                   .....
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *
     c                   if        rhpsml = 'B' and                                      .....
     c                             riraar < rhprÅr                                       .....
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *
      * Sjekk kontonr. fra/til
      *
     c                   if        nykto < rhpktf or                                     .....
     c                             nykto > rhpktt                                        .....
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *                                                                 .
      * Sjekk avdeling fra/til
      *
     c                   if        nyavd < rhpavf or                                     .....
     c                             nyavd > rhpavt                                        .....
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *
     c     avd_med       tag
      *
T400  * Sjekk om kostnadsbærergruppe fra/til er utfylt
      *
T400 c                   if        rhpbÆt = *blanks                                      .....
T400 c                   goto      bar_tag1                                                  .
T400 c                   endif                                                           .....
      *
T400  * K.bærergruppe fra/til er utfylt
T400  * Finn kostnadsbærergruppe
      *
T400 c                   eval      ra28lr_Økod = nysps
T400 c     ra28lr_key    chain     ra28lrr                            62
T400 c                   if        *in62 = *on
T400 c                   move      *blanks       rebgrp
T400 c                   endif                                                           .....
      *
T400 c                   if        rebgrp < rhpbÆf or                                    .....
T400 c                             rebgrp > rhpbÆt                                       .....
T400 c                   goto      neste                                                     .
T400 c                   endif                                                           .....
      *
T400 c     bar_tag1      tag
      *
T400  * Sjekk om kostnadsbærer fra/til er utfylt
      *
T400 c                   if        rhpbØt = *zeros                                       .....
T400 c                   goto      bar_med                                                   .
T400 c                   endif                                                           .....
      *
T400  * Kostnadsbærer fra/til er utfylt
      *
T400 c                   if        nysps < rhpbØf or                                     .....
T400 c                             nysps > rhpbØt                                        .....
T400 c                   goto      neste                                                     .
T400 c                   endif                                                           .....
      *
T400 c     bar_med       tag
T400  *    Her behandles alle poster som skal være med
      *
      * Første gang - ikke test på brudd
      *
     c                   if        gmbrd = *zeros                                        .....
     c                   move      nybrd         gmbrd                                       .
     c                   move      nyavdo        gmavdo                                      .
     c                   exsr      sr_forst
     c                   endif                                                           .....
      *
      * Dersom konto-rekkefølge, nullstill avd i bruddbegrep
      *
     c                   if        rhpsrt = 'K'                                          .....
     c                   eval      nyavd = *zeros                                            .
     c                   endif                                                           .....
      * Test hele bruddbegrepet - hvis like, summer laveste nivå
      *
     c                   if        nybrd = gmbrd                                         .....
     c                   exsr      rsum                                                      .
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *
     c     brudde        tag
      *
      * Brudd på hele begrepet
      *
     c                   exsr      brhel
      *
      * Brudd på konto
      *
     c                   if        nykto <> gmkto                                        .....
     c                   exsr      brkto                                                     .
     c                   endif                                                           .....
      *
      * Brudd på gruppe
      *
     c                   if        nyavd <> gmavd or                                     .....
     c                             nygrp <> gmgrp                                        .....
     c                   exsr      brgrp                                                     .
     c                   endif                                                           .....
      *
      * Brudd på klasse
      *
     c                   if        nyavd <> gmavd or                                     .....
     c                             nykla <> gmkla                                        .....
     c                   exsr      brkla                                                     .
     c                   endif                                                           .....
      *
      * Brudd på avdeling  - (kun hvis sortert på avdeling)
      *
     c                   if        rhpsrt = 'A' and                                      .....
     c                             nyavd <> gmavd                                            .
     c                   exsr      bravd                                                     .
     c                   endif                                                           .....
      *
      * Brudd på kostnadsbærer  - (kun hvis sortert på kostnadsbærer)
      *
     c                   if        rhpsrt = 'B' and                                      .....
     c                             nysps <> gmsps                                            .
     c                   exsr      brsps                                                     .
     c                   endif                                                           .....
      *
      * Summer til L1-nivå
      *
     c                   exsr      rsum
      *
      * Flytt nytt brudd-begrep til gammelt
      *
     c                   move      nybrd         gmbrd
     c                   move      nyavdo        gmavdo                                      .
      *
     c     neste         tag
      *
     c                   select
     c                   when      rhpsrt = 'K'
     c     rhsal1_key    reade     rhsal1r                                61
     c                   when      rhpsrt = 'A'
     c     rhsal2_key    reade     rhsal2r                                61
     c                   when      rhpsrt = 'B'
     c     rhsal3_key    reade     rhsal3r                                61
     c                   endsl
      *
     c                   enddo
      *
     c     slutt         tag
      *
      * Brudd-behandling
      *
     c                   exsr      brhel                                                     .
     c                   exsr      brkto                                                     .
     c                   exsr      brgrp                                                     .
     c                   exsr      brkla                                                     .
      *
     c                   if        rhpsrt = 'A'                                          .....
     c                   exsr      bravd                                                     .
     c                   endif                                                           .....
      *
     c                   if        rhpsrt = 'B'                                          .....
     c                   exsr      brsps                                                     .
     c                   endif                                                           .....
      *
      * Beregn differanser debet/kredit - skriv siste side
      *
     c                   eval      lrdifp = lrbevd + lrbevk
     c                   eval      lrdifh = lrsald + lrsalk
      *
     c                   eval      totsid = totsid + 1
     c                   write     skrivt
      *
     c                   eval      m = *zeros
     c                   eval      n = *zeros
     c                   eval      x = *zeros
      *
     c                   eval      m = m + 1
     c                   eval      n = n + 1
      *
     c                   eval      *inlr = *on
     c/eject
      ****************************************************************
      *   Subrutine for behandling av alle aktuelle recordtyper      *
      ****************************************************************
      *
     c     rsum          begsr
      *
      * Summer til denne periode og hittil i år
      *
     c                   exsr      hsum
      *
      * Recordtype 1  - saldo
      *
     c                   if        w_type = 1                                            .....
      *                                                                 .
      * Saldo i år                                                      .
      *                                                                 .
     c                   if        riraar = rhprÅr                                    .....  .
     c                   eval      l1beÅr = l1beÅr + bev                                  .  .
     c                   eval      l1saÅr = l1saÅr + sum                                  .  .
      *
      * Summer for siste side
      *
     c                   if        bev    > *zero                                        .....
     c                   eval      lrbevd = lrbevd + bev                                     .
     c                   else                                                                .
     c                   eval      lrbevk = lrbevk + bev                                     .
     c                   endif                                                           .....
      *
     c                   if        sum    > *zero                                        .....
     c                   eval      lrsald = lrsald + sum                                     .
     c                   else                                                                .
     c                   eval      lrsalk = lrsalk + sum                                     .
     c                   endif                                                           .....
      *                                                              .  .
     c                   else                                                             .  .
      *                                                              .  .
      * Saldo i fjor                                                 .  .
      *                                                              .  .
     c                   if        riraar = prfjo                                         .  .
     c                   eval      l1befj = l1befj + bev                                  .  .
     c                   eval      l1safj = l1safj + sum                                  .  .
     c                   endif                                                            .  .
     c                   endif                                                        .....  .
      *                                                                 .
     c                   endif                                                           .....
      *
      * Recordtype 3  - budsjett
      *
     c                   if        w_type = 3                                            .....
      *                                                                 .
      * Budsjett i år                                                   .
      *                                                          .....  .
     c                   if        riraar = rhprÅr                                        .  .
     c                   eval      l1buÅr = l1buÅr + bev                                  .  .
     c                   eval      l1busÅ = l1busÅ + sum                                  .  .
     c                   else                                                             .  .
      *                                                              .  .
      * Budsjett i fjor                                              .  .
      *                                                              .  .
     c                   if        riraar = prfjo                                         .  .
     c                   eval      l1bufj = l1bufj + bev                                  .  .
     c                   eval      l1busf = l1busf + sum                                  .  .
     c                   endif                                                            .  .
      *                                                              .  .
     c                   endif                                                       .....   .
      *                                                                 .
     c                   endif                                                           .....
      *
      * Recordtype 4  - alternativt budsjett
      *
     c                   if        w_type = 4                                            .....
      *                                                                 .
      * Budsjett i år                                                   .
      *                                                                 .
     c                   if        riraar = rhprÅr                                    .....  .
     c                   eval      l1buÅr = l1buÅr + bev                                  .  .
     c                   eval      l1busÅ = l1busÅ + sum                                  .  .
     c                   else                                                             .  .
      *                                                              .  .
      * Budsjett i fjor                                              .  .
      *                                                              .  .
     c                   if        riraar = prfjo                                         .  .
     c                   eval      l1bufj = l1bufj + bev                                  .  .
     c                   eval      l1busf = l1busf + sum                                  .  .
     c                   endif                                                            .  .
      *                                                              .  .
     c                   endif                                                        .....  .
      *                                                                 .
     c                   endif                                                           .....
      *
     c                   endsr
     c/eject
      ****************************************************************
      *   Subrutine for beregning av denne periode og hittil         *
      ****************************************************************
      *
     c     hsum          begsr
      *
     c                   eval      bev = 0
     c                   eval      sum = 0
      *
     c                   eval      n = 1
      *
     c                   eval      sum = sum + risa00                           IB
      *
      * Summer periode fra 1 - til denne periode
      *
     c                   dou       n > rhpper                                            .....
      *                                                                 .
     c                   eval      sum = sum + sal(n)                                        .
      *                                                                 .
      * Summer bevegelse for periode fra  - til                         .
      *                                                                 .
     c                   if        n >= rhppef and                                    .....  .
     c                             n <= rhppet                                            .  .
     c                   eval      bev = bev + sal(n)                                     .  .
     c                   endif                                                        .....  .
      *                                                                 .
     c                   eval      n = n + 1                                                 .
     c                   enddo                                                           .....
      *
     c                   endsr
     c/eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på spesifikasjon         *
      ****************************************************************
      *
     c     brhel         begsr
      *
     c                   eval      l1bevp = l1beÅr
     c                   eval      l1salh = l1saÅr
      *
      * Sammenligning mot budsjett
      *
     c                   if        rhpsml = 'B'                                          .....
     c                   eval      l1samp = l1buÅr                                           .
     c                   eval      l1samh = l1busÅ                                           .
     c                   endif                                                           .....
      *
      * Sammenligning mot fjorår
      *
     c                   if        rhpsml = 'F'                                          .....
     c                   eval      l1samp = l1befj                                           .
     c                   eval      l1samh = l1safj                                           .
     c                   endif                                                           .....
      *
      * Sammenligning mot gjennomsnitt
      *
     c                   if        rhpsml = 'G'                                          .....
     c                   eval(h)   l1samp = l1salh / rhpper                                  .
     c                   eval      l1samh = l1salh                                           .
     c                   endif                                                           .....
      *
      * Beregn differanser
      *
     c                   eval      difp = l1bevp - l1samp
     c                   eval      difh = l1salh - l1samh
      *
      * Beregn brukt/oppnådd
      *
     c                   if        rhpavv = 'P'                                          .....
     c                   eval      samp = l1samp                                             .
     c                   eval      samh = l1samh                                             .
     c                   exsr      brukt                                                     .
     c                   endif                                                           .....
      *
      * Adder til neste nivå
      *
     c                   eval      l2bevp = l2bevp + l1bevp
     c                   eval      l2salh = l2salh + l1salh
     c                   eval      l2samp = l2samp + l1samp
     c                   eval      l2samh = l2samh + l1samh
      *
      * Hent tekstrecord fra kontoplan-register
      *
     c                   eval      wtext = *blanks
     c                   eval      wmvak = *blanks
     c                   eval      wmvao = *blanks
      *
     c                   move      gmkto         rhovlr_kont
     c                   move      gmsps         rhovlr_spes
     c                   move      gmavd         rhovlr_avde
     c     rhovlr_key    chain     rhovlr                             62
      *
     c                   if        *in62 = *on
     c                   move      *zeros        rhovlr_avde
     c     rhovlr_key    chain     rhovlr                             62
     c                   endif
      *
     c                   if        *in62 = *on
     c                   move      *zeros        rhovlr_spes
     c     rhovlr_key    chain     rhovlr                             62
     c                   endif
      *
     c                   if        *in62 = *off
     c                   move      rhtext        wtext
     c                   move      rhmvak        wmvak
     c                   move      rhmvao        wmvao
     c                   endif
      *
      * Skriv linje
      *
     c                   eval      totkto = totkto + 1
     c                   eval      antsps = antsps + 1
     c                   eval      antkto = antkto + 1
      *
     c                   if        *in30 = *on                                           .....
     c                   exsr      skriv                                                     .
     c                   eval      *in30 = *off                                              .
     c                   endif                                                           .....
      *
     c                   write     skriv1
      *
      * Nullstill arbeidsfelt på L1-nivå
      *
     c     l1null        tag
      *
     c                   eval      l1bevp = *zeros
     c                   eval      l1salh = *zeros
     c                   eval      l1samp = *zeros
     c                   eval      l1samh = *zeros
      *
     c                   eval      l1beÅr = *zeros
     c                   eval      l1befj = *zeros
      *
     c                   eval      l1buÅr = *zeros
     c                   eval      l1bufj = *zeros
      *
     c                   eval      l1saÅr = *zeros
     c                   eval      l1safj = *zeros
      *
     c                   eval      l1busÅ = *zeros
     c                   eval      l1busf = *zeros
      *
     c                   endsr
     c/eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på konto                 *
      ****************************************************************
      *
     c     brkto         begsr
      *
      * Beregn differanser
      *
     c                   eval      difp = l2bevp - l2samp
     c                   eval      difh = l2salh - l2samh
      *
      * Beregn brukt/oppnådd
      *
     c                   if        rhpavv = 'P'                                          .....
     c                   eval      samp = l2samp                                             .
     c                   eval      samh = l2samh                                             .
     c                   exsr      brukt                                                     .
     c                   endif                                                           .....
      *
      * Test om linjen skal skrives
      *
     c                   if        antsps > 1                                            .....
      *                                                                 .
     c                   if        *in30 = *on                                        .....  .
     c                   exsr      skriv                                                  .  .
     c                   eval      *in30 = *off                                              .
     c                   endif                                                        .....  .
      *
     c                   eval      antkto = antkto + 1                                       .
     c                   write     skriv2                                                    .
      *                                                                 .
     c                   endif                                                           .....
      *
      * Adder til neste nivå
      *
     c                   eval      l3bevp = l3bevp + l2bevp
     c                   eval      l3salh = l3salh + l2salh
     c                   eval      l3samp = l3samp + l2samp
     c                   eval      l3samh = l3samh + l2samh
      *
      * Nullstill arbeidsfelt på L2-nivå
      *
     c     l2null        tag
      *
     c                   eval      antsps = *zeros
     c                   eval      l2bevp = *zeros
     c                   eval      l2salh = *zeros
     c                   eval      l2samp = *zeros
     c                   eval      l2samh = *zeros
      *
     c                   endsr
     c/eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på kontogruppe           *
      ****************************************************************
      *
     c     brgrp         begsr
      *
      * Kontogruppe skrives bare hvis minst en konto er skrevet
      *
     c                   if        antkto > *zeros                                       .....
      *                                                                 .
      * Beregn differanser                                              .
      *                                                                 .
     c                   eval      difp = l3bevp - l3samp                                    .
     c                   eval      difh = l3salh - l3samh                                    .
      *                                                                 .
      * Beregn brukt/oppnådd
      *                                                                 .
     c                   if        rhpavv = 'P'                                       .....  .
     c                   eval      samp = l3samp                                          .  .
     c                   eval      samh = l3samh                                          .  .
     c                   exsr      brukt                                                  .  .
     c                   endif                                                        .....  .
      *                                                                 .
      * Hent gruppe-tekst fra koderegisteret                            .
      *                                                                 .
     c                   move      gmgrp         p_tkod                                      .
     c                   call      'RS720R'                                      gruppe-
     c                   parm                    p_stat                           kode
     c                   parm                    p_tkod                           kode
     c                   parm                    p_tx30                           kode
      *
     c                   if        p_stat = 'N'                                 Kode
     c                   eval      grtext = *blank                               finnes
     c                   movel     txt(2)        grtext                           ikke
     c                   else
     c                   move      p_tx30        grtext
     c                   endif
      *                                                                 .
      * Test om linjen skal skrives                                     .
      *                                                                 .
     c                   if        rhpkgs = 'J'                                       .....  .
      *                                                              .  .
     c                   if        *in30 = *on                                        .....  .
     c                   exsr      skriv                                                  .  .
     c                   eval      *in30 = *off                                              .
     c                   endif                                                            .  .
      *                                                              .  .
     c                   write     skriv3                                                 .  .
     c                   endif                                                        .....  .
      *                                                                 .
     c                   endif                                                           .....
      *
      * Adder til neste nivå
      *
     c                   eval      l4bevp = l4bevp + l3bevp
     c                   eval      l4salh = l4salh + l3salh
     c                   eval      l4samp = l4samp + l3samp
     c                   eval      l4samh = l4samh + l3samh
      *
      * Nullstill arbeidsfelt på L3-nivå
      *
     c     l3null        tag
      *
     c                   eval      antkto = *zeros
     c                   eval      l3bevp = *zeros
     c                   eval      l3salh = *zeros
     c                   eval      l3samp = *zeros
     c                   eval      l3samh = *zeros
      *
     c                   endsr
     c/eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på lontoklasse           *
      ****************************************************************
      *
     c     brkla         begsr
      *
      * Beregn differanser
      *
     c                   eval      difp = l4bevp - l4samp
     c                   eval      difh = l4salh - l4samh
      *
      * Beregn brukt/oppnådd
      *
     c                   if        rhpavv = 'P'                                          .....
     c                   eval      samp = l4samp                                             .
     c                   eval      samh = l4samh                                             .
     c                   exsr      brukt                                                     .
     c                   endif                                                           .....
      *
      * Hent klasse-tekst fra koderegisteret
      *
     c                   eval      p_skod = *zero
     c                   move      gmkla         p_skod
     c                   call      'RS719R'                                      klasse-
     c                   parm                    p_stat                           kode
     c                   parm                    p_skod                           kode
     c                   parm                    p_tx30                           kode
      *
     c                   if        p_stat = 'N'                                 Kode
     c                   eval      kltext = *blank                               finnes
     c                   movel     txt(1)        kltext                           ikke
     c                   else
     c                   move      p_tx30        kltext
     c                   endif
      *
      * Test om linjen skal skrives
      *
     c                   if        rhpkks = 'J'                                          .....
      *                                                                 .
     c                   if        *in30 = *on                                        .....  .
     c                   exsr      skriv                                                     .
     c                   eval      *in30 = *off                                              .
     c                   endif                                                               .
      *                                                                 .
     c                   write     skriv4                                                    .
     c                   endif                                                           .....
      *
      * Adder til neste nivå
      *
     c                   eval      l5bevp = l5bevp + l4bevp
     c                   eval      l5salh = l5salh + l4salh
     c                   eval      l5samp = l5samp + l4samp
     c                   eval      l5samh = l5samh + l4samh
      *
      * Nullstill arbeidsfelt på L4-nivå
      *
     c     l4null        tag
      *
     c                   eval      l4bevp = *zeros
     c                   eval      l4salh = *zeros
     c                   eval      l4samp = *zeros
     c                   eval      l4samh = *zeros
      *
     c                   endsr
     c/eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på avdeling              *
      ****************************************************************
      *
     c     bravd         begsr
      *
      * Beregn differanser
      *
     c                   eval      difp = l5bevp - l5samp
     c                   eval      difh = l5salh - l5samh
      *
      * Beregn brukt/oppnådd
      *
     c                   if        rhpavv = 'P'                                          .....
     c                   eval      samp = l5samp                                             .
     c                   eval      samh = l5samh                                             .
     c                   exsr      brukt                                                     .
     c                   endif                                                           .....
      *
      * Hent avdelingstekst fra koderegisteret
      *
     c                   if        rhpsrt = 'A'                                 Kode
     c                   eval      avtext = *blank                               finnes
     c                   move      gmavd         wavde
     c                   move      gmavd         p_gkod
     c                   call      'RS707R'                                      klasse-
     c                   parm                    p_stat                           kode
     c                   parm                    p_gkod                           kode
     c                   parm                    p_tx30                           kode
      *
     c                   move      p_tx30        avtext
     c                   endif
      *
      * Skriv heading og linje
      *
     c                   if        *in30 = *on                                        .....  .
     c                   exsr      skriv                                                     .
     c                   eval      *in30 = *off                                              .
     c                   endif                                                           .....
      *
     c                   write     skriv5
      *
     c                   if        *in61 = *off                                 Kode
      *
      * Hent ny avdelingstekst fra koderegisteret og skriv ny heading
      *                                                                 .
     c                   if        rhpsrt = 'A'                                 Kode
     c                   eval      avtext = *blank                               finnes
     c                   move      nyavd         wavde                                       .
     c                   move      nyavd         p_gkod
     c                   call      'RS707R'                                      klasse-
     c                   parm                    p_stat                           kode
     c                   parm                    p_gkod                           kode
     c                   parm                    p_tx30                           kode
      *
     c                   move      p_tx30        avtext
     c                   endif
      *                                                                 .
     c                   exsr      skriv                                                     .
      *
      * Nullstill arbeidsfelt på L5-nivå
      *
     c                   eval      l5bevp = *zeros
     c                   eval      l5salh = *zeros
     c                   eval      l5samp = *zeros
     c                   eval      l5samh = *zeros
      *
     c                   endif
      *
     c                   endsr
     c/eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på kostnadsbærer         *
      ****************************************************************
      *
     c     brsps         begsr
      *
      * Beregn differanser
      *
     c                   eval      difp = l5bevp - l5samp
     c                   eval      difh = l5salh - l5samh
      *
      * Beregn brukt/oppnådd
      *
     c                   if        rhpavv = 'P'                                          .....
     c                   eval      samp = l5samp                                             .
     c                   eval      samh = l5samh                                             .
     c                   exsr      brukt                                                     .
     c                   endif                                                           .....
      *
      * Hent kostnadsbærertekst fra koderegisteret
      *
     c                   if        rhpsrt = 'B'                                 Kode
     c                   eval      sptext = *blank                               finnes
     c                   move      gmsps         wspes
     c                   move      gmsps         p_Økod
      *
     c                   call      'RS728R'                                      klasse-
     c                   parm                    p_stat                           kode
     c                   parm                    p_Økod                           kode
     c                   parm                    p_tx30                           kode
      *
     c                   move      p_tx30        sptext
     c                   endif
      *
      * Skriv heading og linje
      *
     c                   if        *in30 = *on                                        .....  .
     c                   exsr      skriv                                                     .
     c                   eval      *in30 = *off                                              .
     c                   endif                                                           .....
      *
     c                   write     skriv5
      *
     c                   if        *in61 = *off                                 Kode
      *
      * Hent ny kostnadsbærertekst fra koderegisteret og skriv ny heading
      *                                                                 .
     c                   if        rhpsrt = 'B'                                 Kode
     c                   eval      sptext = *blank                               finnes
     c                   move      nysps         wspes                                       .
     c                   move      nysps         p_Økod
      *                                                                 .
     c                   call      'RS728R'                                      klasse-
     c                   parm                    p_stat                           kode
     c                   parm                    p_Økod                           kode
     c                   parm                    p_tx30                           kode
      *
     c                   move      p_tx30        sptext
     c                   endif
      *                                                                 .
     c                   exsr      skriv                                                     .
      *
      * Nullstill arbeidsfelt på L5-nivå
      *
     c                   eval      l5bevp = *zeros
     c                   eval      l5salh = *zeros
     c                   eval      l5samp = *zeros
     c                   eval      l5samh = *zeros
      *
     c                   endif
      *
     c                   endsr
     c/eject
      *
      ****************************************************************
      *   Subrutine for 1.gang for å hente kostnadsbærer- eller
      *   avdelingstekst.
      ****************************************************************
      *
     c     sr_forst      begsr
      *
      * Hent avdelingstekst fra koderegisteret
      *
     c                   if        rhpsrt = 'A'                                 Kode
     c                   eval      avtext = *blank                               finnes
     c                   move      gmavd         wavde
     c                   move      gmavd         p_gkod
     c                   call      'RS707R'                                      klasse-
     c                   parm                    p_stat                           kode
     c                   parm                    p_gkod                           kode
     c                   parm                    p_tx30                           kode
      *
     c                   move      p_tx30        avtext
     c                   endif
      *
      * Hent kostnadsbærertekst fra koderegisteret
      *
     c                   if        rhpsrt = 'B'                                 Kode
     c                   eval      sptext = *blank                               finnes
     c                   move      gmsps         wspes
     c                   move      gmsps         p_Økod
      *
     c                   call      'RS728R'                                      klasse-
     c                   parm                    p_stat                           kode
     c                   parm                    p_Økod                           kode
     c                   parm                    p_tx30                           kode
      *
     c                   move      p_tx30        sptext
     c                   endif
      *
      * Skriv heading
      *
     c                   write     head2
     c                   eval      *in30 = *off                                              .
     c                   endsr
     c/eject
      *
      ****************************************************************
      *   Subrutine for beregning av brukt/oppnådd                   *
      ****************************************************************
      *
     c     brukt         begsr
      *
      * Denne periode
      *
     c                   eval      *in16 = *off
     c                   eval      *in17 = *off
     c                   if        samp <> *zero                                         .....
      *
S400 c*                  if        (difp / samp * 100) + 100 < 9999,9                        .
S400 c*                  eval(h)   prop = (difp / samp * 100) + 100                          .
S400 c*                  else                                                                .
S400 c*                  eval      prop = 9999,9                                             .
S400 c*                  endif                                                               .
      *
T400 c                   select
T400 c                   when      (difp / samp * 100) + 100 < -999999,9                     .
T400 c                   eval(h)   prop = -999999,9                                          .
T400 c                   when      (difp / samp * 100) + 100 >  999999,9                     .
T400 c                   eval(h)   prop =  999999,9                                          .
T400 c                   other                                                               .
T400 c                   eval(h)   prop = (difp / samp * 100) + 100                          .
T400 c                   endsl                                                        .....  .
      *
     c                   else                                                                .
     c                   if        difp <> *zero                                      .....  .
     c                   eval      *in16 = *on                                            .  .
     c                   else                                                             .  .
     c                   eval      prop = 100                                             .  .
     c                   endif                                                        .....  .
     c                   endif                                                           .....
      *
      * Hittil
      *
     c                   if        samh <> *zero                                         .....
      *
S400 c*                  if        (difh / samh * 100) + 100 < 9999,9                        .
S400 c*                  eval(h)   proh = (difh / samh * 100) + 100                          .
S400 c*                  else                                                                .
S400 c*                  eval      proh = 9999,9                                             .
S400 c*                  endif                                                               .
      *
T400 c                   select
T400 c                   when      (difh / samh * 100) + 100 < -999999,9                     .
T400 c                   eval(h)   proh = -999999,9                                          .
T400 c                   when      (difh / samh * 100) + 100 >  999999,9                     .
T400 c                   eval(h)   proh =  999999,9                                          .
T400 c                   other                                                               .
T400 c                   eval(h)   proh = (difh / samh * 100) + 100                          .
T400 c                   endsl                                                        .....  .
      *
     c                   else                                                                .
     c                   if        difh <> *zero                                      .....  .
     c                   eval      *in17 = *on                                            .  .
     c                   else                                                             .  .
     c                   eval      proh = 100                                             .  .
     c                   endif                                                        .....  .
     c                   endif                                                           .....
      *
     c                   endsr
     c/eject
      *
      ****************************************************************
      *   Subrutine for å skrive heading                             *
      ****************************************************************
      *
     c     skriv         begsr
      *
     c                   eval      totsid = totsid + 1
     c                   write     head1
     c                   write     head2
      *
     c                   endsr
     c/space 3
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
     c                   eval      totkto = *zeros
     c                   eval      risa01 = *zeros
      *
      * Behandle parameter
      *
     c                   eval      prfjo = rhprÅr - 1
      *
     c                   select
     c                   when      rhpsml = 'B'                                          .....
     c                   eval      *in11 = *on                                               .
      *
     c                   when      rhpsml = 'F'                                          .....
     c                   eval      *in12 = *on                                               .
      *
     c                   when      rhpsml = 'G'                                          .....
     c                   eval      *in13 = *on                                               .
     c                   endsl                                                           .....
      *
     c                   select
     c                   when      rhpavv = 'D'                                          .....
     c                   eval      *in14 = *on                                               .
      *
     c                   when      rhpavv = 'P'                                          .....
     c                   eval      *in15 = *on                                               .
     c                   endsl                                                           .....
      *
S400 c*                  select
S400 c*                  when      rhpsrt = 'A'                                          .....
S400 c*                  eval      *in18 = *on                                               .
      *
S400 c*                  when      rhpsrt = 'B'                                          .....
     c                   eval      *in20 = *on                                               .
S400 c*                  endsl                                                           .....
      *
     c                   if        rhppef <> rhppet                                      .....
     c                   eval      *in19 = *on                                               .
     c                   endif                                                           .....
      *
      * Sett startverdier
      *
     c                   eval      w_firm = l_firm
     c                   eval      nybrd = *zeros
     c                   eval      gmbrd = *zeros
     c                   eval      gmsps = *zeros
      *
      * Hent avdelingstekst fra koderegisteret
      *
     c                   if        rhpsrt = 'A'                                 Kode
      *
S400 c*                  if        rhanul = 'J'                                          .....
S400 c*                  move      *zeros        p_gkod
S400 c*                  else                                                            .....
     c                   move      rhpavf        p_gkod
S400 c*                  endif
      *
     c                   eval      avtext = *blank                               finnes
     c                   call      'RS707R'                                      klasse-
     c                   parm                    p_stat                           kode
     c                   parm                    p_gkod                           kode
     c                   parm                    p_tx30                           kode
      *
     c                   move      p_gkod        wavde
     c                   move      p_tx30        avtext
      *
     c                   endif
      *
      * Hent kostnadsbærertekst fra koderegisteret
      *
     c                   if        rhpsrt = 'B'                                 Kode
      *
     c                   move      rhpbØf        p_Økod
     c                   move      rhpbØf        wspes
     c                   call      'RS728R'                                      klasse-
     c                   parm                    p_stat                           kode
     c                   parm                    p_Økod                           kode
     c                   parm                    p_tx30                           kode
      *
     c                   if        p_stat = 'N'                                 Kode
     c                   eval      sptext = *blank                               finnes
     c                   else
     c                   move      p_tx30        sptext
     c                   endif
      *
     c                   endif
      *
      * Skriv heading på første side
      *
     c                   write     head1
      *
     c                   eval      totsid = 1
     c                   eval      antkto = *zeros
     c                   eval      antsps = *zeros
      *
      * Key for saldoregister - konto
      *
     c     rhsal1_key    klist
     c                   kfld                    w_firm
      *
      * Key for saldoregister - avdeling
      *
     c     rhsal2_key    klist
     c                   kfld                    w_firm
      *
      * Key for saldoregister - Kostnadsbærer
      *
     c     rhsal3_key    klist
     c                   kfld                    w_firm
      *
      * Key for kontoplan
      *
     c     rhovlr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rhovlr_kont
     c                   kfld                    rhovlr_spes
     c                   kfld                    rhovlr_avde
      *
      * Key for kostnadsbærer
      *
     c     ra28lr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ra28lr_Økod
      *
     c                   endsr
      *
**
K L A S S E S U M
G R U P P E S U M
