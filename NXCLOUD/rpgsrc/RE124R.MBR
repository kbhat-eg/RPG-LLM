     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *                                                                       *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RE124R                                              *
      * Beskrivelse . . : Tilrettelegger trans fra Ergosoft Lønn              *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
      *                                                                       *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     fre0ipf    ip  ae           k disk
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
     fraa3l1    if   e           k disk    rename(raa3pfr:raa3l1r)
     fraa4l1    if   e           k disk    rename(raa4pfr:raa4l1r)
     fre0tpf    o    e           k disk
      *
     d per             s              2  0 dim(13)                              Perioder
     d txt             s             20    dim(5) ctdata perrcd(1)              BILAGSTEKST
     d wbel            s              1    dim(14)                              INN BELØP
     d wfbe            s              1    dim(14)                              ARB BELØP
      *
     d                 ds
     d rpcin1                       256                                         Input
     d  wdsbty                        2    overlay(rpcin1)                      Biltyp
     d  wdsbnt                        2    overlay(rpcin1:3)                    Buntnr
     d  wdsper                        1    overlay(rpcin1:5)                    Period
     d  wdspko                        1    overlay(rpcin1:7)                    Perkod
6.NU d  wdsbil                        8    overlay(rpcin1:9)                    Bilags
6 NU d  wdsbda                        8    overlay(rpcin1:18)                   Dato (
     d   wdsbdd                       2    overlay(wdsbda)                       - Dag
     d   wdsbmm                       2    overlay(wdsbda:4)                     - Mån
     d   wdsbÅÅ                       2    overlay(wdsbda:7)                     - År
6.NU d  wdskto                        8  0 overlay(rpcin1:27)                   Konto
6.NU d  wdsako                        2  0 overlay(rpcin1:36)                   Avgift
6.NU d  wdsbko                        2  0 overlay(rpcin1:39)                   Tekstk
6.NU d  wdstxt                       25    overlay(rpcin1:43)                   Tekst
6.NU d  wdsmko                        1    overlay(rpcin1:71)                   Mengde
6.NU d  wdsmgd                        4    overlay(rpcin1:74)                   Mengde
6.NU d  wdspri                        4    overlay(rpcin1:79)                   Pris
6.NU d  wdsbel                       14    overlay(rpcin1:84)                   Beløp
6.NU d  wdsavd                        9    overlay(rpcin1:99)                   Avdeli
6.NU d  wdspro                       10    overlay(rpcin1:110)                  Prosje
6.NU d  wdssta                        1    overlay(rpcin1:122)                  Status
6.NU d  wdsref                        1    overlay(rpcin1:125)                  Ref
6.NU d  wdsfda                        8    overlay(rpcin1:128)                  FDato
     d   wdsfdd                       2    overlay(wdsfda)                       - Dag
     d   wdsfmm                       2    overlay(wdsfda:4)                     - Mån
     d   wdsfÅÅ                       2    overlay(wdsfda:7)                     - År
6.NU d  wdseda                        8    overlay(rpcin1:137)                  BETDat
     d   wdsedd                       2    overlay(wdseda)                       - Dag
     d   wdsemm                       2    overlay(wdseda:4)                     - Mån
     d   wdseÅÅ                       2    overlay(wdseda:7)                     - År
6.NU d  wdsuav                       14    overlay(rpcin1:146)                  Uavreg
6.NU d  wdsbst                        1    overlay(rpcin1:161)                  Bstatu
6.NU d  wdspst                        1    overlay(rpcin1:163)                  Pstatu
6.NU d  wdssda                        8    overlay(rpcin1:165)                  SRDato
     d   wdssdd                       2    overlay(wdssda)                       - Dag
     d   wdssmm                       2    overlay(wdssda:4)                     - Mån
     d   wdssÅÅ                       2    overlay(wdssda:7)                     - År
6.NU d  wdsobs                        1    overlay(rpcin1:174)                  OBS
     d rpcin2                       256                                         Input
     d rpcin3                       256                                         Input
     d                 ds
     d wwsbda                 16     21                                         Dato (
     d  wwsbdd                        2    overlay(wwsbda)                       - Dag
     d  wwsbmm                        2    overlay(wwsbda:3)                     - Mån
     d  wwsbÅÅ                        2    overlay(wwsbda:5)                     - År
      *
      * LOCAL DATA
      *
     d                uds
     d pfirm                 300    302  0                                      Firma
     d pnavn                         30                                         Navn
     d puser                         10                                         Bruker
     d pdato                          6  0                                      Pr. da
     d praar                          4  0                                      Pr. år
     d pperf                          2  0                                      Period
     d ppert                          2  0                                      Period
     d psyst                 471    472  0                                      System
      *
     d l_user                911    920
     d l_firm                944    946  0
     d l_navn                951    980
      *
     d pdatx           s              8  0
     d wfbelØ          s             14
     d wfelt           s                   like(rpcin1)
     d wftgn           s              1
     d wkp             s              2  0
     d wkper           s              8  0
     d wlinje          s              8  0
6.NU d wnota           s              8  0
     d wnxbun          s                   like(rtbunt)
     d wtpre           s             10  2
     d x               s              3  0
     d y               s                   like(x)
      *
     d w_firm          s                   like(l_firm)
     d w_raar          s              4  0
      *
     d raa4l1_4aar     s                   like(ra4aar)
      *
      *  Statusopplysninger - avvikende perioder?!?
      *
     iraa3l1r
     i              ra3p01                      per(01)
     i              ra3p02                      per(02)
     i              ra3p03                      per(03)
     i              ra3p04                      per(04)
     i              ra3p05                      per(05)
     i              ra3p06                      per(06)
     i              ra3p07                      per(07)
     i              ra3p08                      per(08)
     i              ra3p09                      per(09)
     i              ra3p10                      per(10)
     i              ra3p11                      per(11)
     i              ra3p12                      per(12)
     i              ra3p13                      per(13)
      *
B001 c                   if        *in15 = *off
 001 c                   eval      rtraar = praar                               ÅR på trans
 001 c                   eval      rtrper = ppert                               ÅR på trans
 001 c                   move      *on           *in15
E001 c                   endif
      *
     c     start         tag
      *
     c                   move      wdsbil        rtbiln                         Bilag-nr.
      *
     c                   eval      wwsbdd = wdsbdd                              Bilag-dag
     c                   eval      wwsbmm = wdsbmm                              Bilag-mnd
     c                   eval      wwsbÅÅ = wdsbÅÅ                              Bilag-år
     c*dmy               move      wwsbda        rtbdat                         Bilag-dato
      *
     c                   eval      rtbilk = wdsbko                              Bilagskode
      *
     c                   movel     wdstxt        rttext                         Bilagstekst
      *
     c                   movea     wdsbel        wbel
     c                   movea     *blank        wfbe
     c                   z-add     14            x
     c                   z-add     14            y
     c                   eval      wftgn = *blank
      *
     c                   dou       x = 0
     c                   if        wbel(x) >= '0' and
     c                             wbel(x) <= '9'
     c                   move      wbel(x)       wfbe(y)
     c                   sub       1             y
     c                   endif
      *
B002 c                   if        wbel(x) = '-'
 002 c                   eval      wftgn = '-'
E002 c                   endif
 001 c                   sub       1             x
E001 c                   enddo
      *
     c                   movea     wfbe          wfbelØ                         Bruttobeløp
     c                   move      wfbelØ        rtbelØ                         Bruttobeløp
      *
     c                   eval      rtdavd = *zeros                              Debet-avd.
     c                   eval      rtdkto = *zeros                              Debet-kto.
      *
     c                   eval      rtcavd = *zeros                              Kredit-avd.
     c                   eval      rtckto = *zeros                              Kredit-kto.
      *
B001 c                   if        wftgn <> '-'                                 +/-
 001 c                   move      wdsavd        rtdavd                         Debet-avd.
 001 c                   move      wdskto        rtdkto                         Debet-kto.
X001 c                   else
 001 c                   move      wdsavd        rtcavd                         Kredit-avd.
 001 c                   move      wdskto        rtckto                         Kredit-kto.
E001 c                   endif
      *
     c                   eval      wfbelØ = *blank
      *
B001 c                   if        wdspro <> *blank
 001 c                   movea     *blank        wbel
 001 c                   movea     wdspro        wbel
 001 c                   movea     *blank        wfbe
 001 c                   z-add     14            x
 001 c                   z-add     14            y
 001 c                   eval      wftgn = *blank
      *
B002 c                   dou       x = 0
B003 c                   if        wbel(x) >= '0' and
 003 c                             wbel(x) <= '9'
 003 c                   move      wbel(x)       wfbe(y)
 003 c                   sub       1             y
E003 c                   endif
 002 c                   sub       1             x
E002 c                   enddo
      *
 001 c                   movea     wfbe          wfbelØ
E001 c                   endif
     c                   move      wfbelØ        rtpros                         Prosjekt-nr.
      *
     c                   eval      rtakti = *blank                              Aktivitet
      *
     c                   eval      rtfdat = *loval                              Forfallsdato
      *
      * Legg ut postering
      *
     c                   add       rtbelØ        wtpre
     c                   add       1             wlinje                         Linjenr.
     c                   eval      rtreid = 'T'                                 Rec.-id
     c                   eval      rtfirm = l_firm                              Firma
     c                   eval      rtbunt = wnxbun                              Bunt-nr.
     c                   eval      rtlinj = wlinje                              Bunt-nr.
     c                   eval      rtstat = *blank                              Buntstatus
     c                   eval      rtdsps = *zero                               Debet-spes.
     c                   eval      rtdmva = ' '                                 Debet-mva.
     c                   eval      rtcsps = *zero                               Kredit-spes.
     c                   eval      rtcmva = ' '                                 Kredit-mva.
     c                   eval      rtrefn = *zero                               Referanse
     c                   eval      rtkrab = *zero                               Rabatt
     c                   eval      rtvalk = *blank                              Valuta-kode
     c                   eval      rtvalb = *zero                               Valuta-beløp
     c                   eval      rtmngd = *zero                               Mengde
     c                   eval      rtmngk = *zero                               Mengde-kode
     c                   eval      rtresn = *zero                               Reskontronr.
     c                   eval      rtvirk = *blank                              Virksomhet
     c                   eval      rtatte = *zero                               Attestert
     c                   eval      rtautx = *blank                              Avkryssing
     c                   eval      rtkrys = *blank                              Avkryssing
     c                   eval      rtkidi = *blank                              KID-referanse
     c                   eval      rtbetb = *zero                               Betalingbet.
     c                   eval      rtbref = *blank                              Bank-referanse
      *
     c                   write     re0tpfr                                      Skriv post
      *
      *
     c     slutt         tag
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     *inzsr        begsr
      *
     c                   eval      wtpre = *zeros
     c                   eval      wkp = *zeros
     c                   eval      x = 0
     c                   move      *zeros        rpcin1
      *
     c                   move      txt(1)        rttext                         Bilagstekst
     c                   z-add     1             wnxbun
     c     uyear         sub       1             w_raar
      *
     c     afirl1_key    chain     afirl1                             10
 001  *
     c     raa3l1_key    chain     raa3l1                             10         Avvikende perioder
 001  *
     c                   eval      raa4l1_4aar = *year
     c     raa4l1_key    chain     raa4l1
 001  *
B001 c                   if        %found
 001 c                   z-add     ra4sgb        wnota
E001 c                   else
 001 c                   z-add     0             wnota
E001 c                   endif
 001  *
     c     afirl1_key    klist
     c                   kfld                    w_firm
 001  *
     c     raa3l1_key    klist
     c                   kfld                    w_firm
 001  *
     c     raa4l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    raa4l1_4aar
      *
     c                   endsr
      * ----------------------------------------
**   Bilagstekster
Faktura
Kreditnota
Øreavrunding
Gebyr
Utg. MVA
