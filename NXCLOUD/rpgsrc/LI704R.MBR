     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  System. . . . . : ASOFAK
      *  Program . . . . : LI704R
      *  Beskrivelse . . : Mottak av EDI-best. (Type : ORDR)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Spesialversjon. :
      *  Tilpasset for . :
      *
      *  Referanse  Dato   Endringsbeskrivelse                     Sign.
      *  --------- ------  -------------------------------------------------
      *    6.20    190614  Nytt program                            BSA
6.30  *    6.30    090118  Henter numemrserie fra samme serie som andre
6.30  *                    eksterne ordre.
6.31  *    6.30    090118  Må håndtere alle slag GTIN nummer
6.32  *    6.30    100118  Må håndtere linjenummer fra bestilling. Veldig viktig
6.32  *                    ved retur.
6.33  *    6.30    100118  Statuskode for innlesing.
6.34  *    6.30    160218  Justeringer etter test  - bla leveringsdato.
6.35  *    6.30    020719  Justert etter endringer på tabeller
6.36  *    6.30    030719  Justeringer ifbm med test
6.37  *    6.30    090719  Må ta høyde for tekstlinjer også
6.38  *    6.30    110719  Diverse justeringer ifbm testing
7.01  *    7.00    260919  Tar i mot prosjektnummer, sjekker om
7.01  *                    det er internt eller eksternt prosjektnummer.
7.02  *    7.00    021019  Utvidet info på eksternordre.
7.03  *    7.00    071019  Tar vare på leveringsdato
7.04  *    7.00    081019  Gjør om bruken av faxfeltet, da dette ikke er
7.04  *                    aktuelt på loggfila. Benyttes til ekstrnt
7.04  *                    prosjektnummer. (AEP)
7.05  *    7.00    111019  Feil håndtering av testlinjer.
7.06  *    7.00    111019  Identifiserer kilde til melding
7.07  *    7.00    141019  Må logge riktig referansenummer
7.08  *    7.00    221019  Sjekker mot logistikkpunkt for å bestemme
7.08  *                    forsendelsesmåte.
7.09  *    7.00    240120  Bruker kunde og finner avdeling og lagere
7.10  * K000  260520  bsa  Logikk for å sette leveringsmåte
7.11  * K000  270520  bsa  Justert på eksternt prosjektnummer.
7.12  * K000  020620  bsa  Justerer kilde på skyggetabell.
7.13  * K000  190620  bsa  Legger ikke UID ut i rekvisisjonsfeltet på
7.13  *                    eksternordre, da det bare er forvirrende.
7.14  * K000  250820  bsa  Sender mail til ordremottaker ved ny ordre inn
7.14  * K000               Bruker samme logikk som ved mottak i nettbutikk.
7.15  * K000  100920  bsa  Rettelse på mailsending
7.16  * K000  031120  bsa  Utvider funksjonaliteten på mailsending.
7.17  * K000  231120  bsa  Sjekker om det kommer kundenummer. Hvis det er
7.17  * K000               tilfelle, kontroller at det er gyldig. Kan det
7.17  * K000               ikke brukes, bruk vanlig identifisering.
7.18  * K000  190421  bsa  Switch som styrer om avdeling skal hentes fra
7.18  * K000               avdeling på lager, eller via kunde.
7.19  * K000  160921  bsa  Skal ikke nullstille avdeling om lager ikke er satt
      *
8.01  * K000  160921  bsa  Hvis koden er satt, skal ikke mail sendes
8.01  * K000               ukritisk til alle personer merket som nett-
8.01  * K000               butikk bruker. Kan ikke kjøres ukritisk da det
8.01  * K000               hos store kunder kan være flere hundre brukere
8.01  * K000               som er merket som dette.
8.02  * K000  191021  bsa  Håndtere ulikt antall siffer i kundenummer. Ofte
8.02  * K000               er ikke alle 6 siffer utfylt.
8.03  * K000  170122  bsa  Retter diverse feil.
8.04  * K000  210322  bsa  Må ikke nullstill prosjektnummer ukritisk.
8.06  * K000  050422  bsa  Feil nullstilling av felter.
8.07  * K000  010223  bsa  Feil håndtering av kundenummer
8.08  * K000  250423  bsa  Endret logikk rundt prosjektnummer.
8.09  * K000  080523  bsa  Hvis ikke logikken rundt prosjektnummer finner
8.09  * K000               internt prosjektnummer, skal denne nulstilles.
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = Avslutt program
      *    80-89 = Arbeidsindikatorer
      *    90-99 = Fileindikatorer chain etc.
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     flwebpf    if   e           k disk
     frkunl5    if   e           k disk    rename(rkunpfr:rkunl5r)
7.17 frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
     frkunl4    if   e           k disk    rename(rkunpfr:rkunl4r)
     fvvarl3    if   e           k disk    rename(vvarpfr:vvarl3r)
     fvvarl4    if   e           k disk    rename(vvarpfr:vvarl4r)
     fnohelu    uf a e           k disk    rename(nohepfr:nohelur)
     fedhelu    uf a e           k disk    rename(edhepfr:edhelur)
     fnodtlu    uf a e           k disk    rename(nodtpfr:nodtlur)
     feddtlu    uf a e           k disk    rename(eddtpfr:eddtlur)
6.37 fedtxlu    uf a e           k disk    rename(edtxpfr:edtxlur)
6.33 feloglu    uf a e           k disk    rename(elogpfr:eloglur)
7.01 ffkprl6    if   e           k disk    rename(fkprpfr:fkprl6r)
7.08 fmjlol2    if   e           k disk    rename(mjlopfr:mjlol2r)
7.08 fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
7.08 fanbll1    if   e           k disk    rename(anblpfr:anbll1r)
7.10 fraa8l1    if   e           k disk    rename(raa8pfr:raa8l1r)
7.14 ffusrl1    if   e           k disk    rename(fusrpfr:fusrl1r)
7.14 fausrl1    if   e           k disk    rename(ausrpfr:ausrl1r)
7.14 fafpslr    if   e           k disk    rename(afpspfr:afpslrr)
7.16 fra10l1    if   e           k disk    rename(ra10pfr:ra10l1r)
7.16 fra07l1    if   e           k disk    rename(ra07pfr:ra07l1r)
      *
      * Definering av LDA
      *
     d                uds
     d l_user                911    920
7.14 d l_filg                931    933
     d l_firm                944    946  0
      *
      * Definering av variable i nøkler
      *
     d*rlevl1_levr     s                   like(rllevr)
     d vvarl3_nobb     s                   like(vvnobb)
     d vvarl4_lvar     s                   like(vvlvar)
     d rkunl5_eank     s                   like(rkeank)
     d rkunl4_ftnr     s                   like(rkftnr)
     d nohelu_fsys     s                   like(nofsys)
     d nohelu_tell     s                   like(notell)
     d nodtlu_fsys     s                   like(ndfsys)
     d nodtlu_tell     s                   like(ndtell)
     d nodtlu_line     s                   like(ndline)
     d edhelu_fsys     s                   like(eofsys)
     d edhelu_tell     s                   like(eotell)
6.35 d edhelu_ldor     s                   like(eoldor)
6.35 d edhelu_ldat     s                   like(eoldat)
     d eddtlu_fsys     s                   like(edfsys)
     d eddtlu_tell     s                   like(edtell)
6.35 d eddtlu_ldor     s                   like(edldor)
6.35 d eddtlu_ldat     s                   like(edldat)
     d eddtlu_line     s                   like(edline)
6.33 d eloglu_faar     s                   like(xlfaar)
6.33 d eloglu_type     s                   like(xltype)
6.33 d eloglu_lean     s                   like(xllean)
6.33 d eloglu_refn     s                   like(xlrefn)
6.37 d edtxlu_fsys     s                   like(etfsys)
6.37 d edtxlu_tell     s                   like(ettell)
6.37 d edtxlu_ldor     s                   like(etldor)
6.37 d edtxlu_ldat     s                   like(etldat)
6.37 d edtxlu_line     s                   like(etline)
6.37 d edtxlu_type     s                   like(ettype)
6.37 d edtxlu_tlin     s                   like(ettlin)
7.01 d fkprl6_epro     s                   like(flepro)
7.01 d fkprl6_kund     s                   like(flkund)
7.08 d mjlol2_eann     s                   like(mjeann)
7.08 d anbll1_leie     s                   like(aoleie)
7.08 d anbll1_lbut     s                   like(aolbut)
7.14 d ausrl1_user     s                   like(abuser)
7.14 d afpslr_ufil     s                   like(l_filg)
7.14 d afpslr_uide     s                   like(afuide)
7.16 d ra10l1_jkod     s                   like(rajkod)
7.16 d ra07l1_gkod     s                   like(ragkod)
7.17 d rkunl1_kund     s                   like(rkkund)
      *
      * Definering av øvrige variable
      *
     d w_firm          s                   like(rkfirm)
     d w_vare          s                   like(vvvare)
     d w_bes_alf       s              6
     d w_bes_inn       s             35
     d w_besa          s              6
     d w_besn          s              6
     d w_rect          s              4
     d w_srec          s              4
     d w_laks          s              3
     d w_lenh          s              3
     d w_stat          s              1
     d w_date          s               d   datfmt(*iso)
     d w_time          s               t   timfmt(*iso)
     d w_dato_6        s              6  0
     d w_dato_alf      s              6
     d w_dato_8        s              8  0
     d w_time_6        s              6  0
     d w_time_alf      s              4
     d w_pris          s             15  3
     d w_numm_15       s             15  0
     d w_numm_alf      s             13
     d w_anta          s              9  3
     d w_pos1          s              2  0
     d w_pos2          s              2  0
     d w_atel          s              1  0
     d w_numtst        s             15    inz('000000000000000')
     d w_fast          s             10
     d w_fell          s              6
     d w_kode          s              1
     d w_type          s              2
     d w_mnum          s              8  0
     d w_eann          s             14  0
     d w_nobb          s                   like(vvnobb)
     d w_eava          s                   like(vvvare)
     d w_eaen          s                   like(vvenhe)
     d w_east          s              1
     d w_dpgl          s             13  0
     d w_ivgl          s             13  0
     d w_bygl          s             13  0
6.33 d w_meld          s            128
6.33 d w_refn          s                   like(xlrefn)
6.33 d w_udat          s               d   datfmt(*iso)
6.33 d w_utim          s               t   timfmt(*iso)
6.33 d w_year          s              4  0
6.31 d x               s              2  0
6.32 d y               s              2  0
6.37 d w_mel1          s            256
6.37 d w_mel2          s            256
6.37 d w_mel3          s            256
6.37 d w_mel4          s            256
6.37 d w_mel5          s            256
7.05 d w_mel6          s            256
7.05 d w_mel7          s            256
7.05 d w_mel8          s            256
7.05 d w_mel9          s            256
7.05 d w_mel10         s            256
6.38 d w_gl04          s             13  0
6.38 d w_or04          s              9  0
7.01 d w_prnr          s             35
7.01 d w_leng          s              3  0
7.01 d w_kpro          s              6
7.03 d w_ldat          s               d   datfmt(*iso)
7.04 d w_aepn          s             15
7.04 d w_rekv          s             70
7.06 d w_fsys          s              3
7.10 d w_hkod          s                   like(aohkod)
7.10 d w_lkod          s                   like(aolkod)
8.02 d w_kund          s              6
      *
     d s_line          s              4  0
      *
     d b_bhod          s              1    inz(*off)
     d b_blin          s              1    inz(*off)
     d b_oskr          s              1    inz(*off)
6.33 d b_feil          s              1    inz(*off)
      *
6.33 d p_eror          s              1
     d p_rec1          s             50
     d p_rec2          s             50
     d p_rec3          s             50
     d p_send          s             50
     d p_subj          s            100
     d p_txt1          s            100
     d p_txt2          s            100
     d p_txt3          s            100
     d p_txt4          s            100
     d p_avsl          s            100
7.14 d p_navn          s             20
7.14 d p_emal          s             50
      *
     d c_fsys          c                   'EDI'
     d c_digi          c                   '0123456789'
     d c_char          c                   'ABCDEFGHIJKLMNOPQRSTUVWXYZÆØÅ ab+
     d                                      cdefghijklmnopqrstuvwxyzæøå.,/:-'
      *
      *  Definering av datastrukturer for melding inn
      *
     d                 ds
     d d_ed00                        80
     d  d_id00                        4    overlay(d_ed00)
     d  d_decs00                      1    overlay(d_ed00:5)
     d  d_send00                     13    overlay(d_ed00:6)
     d  d_mott00                     13    overlay(d_ed00:19)
     d  d_gdat00                      6    overlay(d_ed00:32)
     d    d_gdax00                    6  0 overlay(d_gdat00:1)
     d  d_gtim00                      4    overlay(d_ed00:38)
     d    d_gtix00                    4  0 overlay(d_gtim00:1)
     d  d_test00                      1    overlay(d_ed00:42)
     d  d_kva100                      3    overlay(d_ed00:43)
     d  d_mdat00                     12    overlay(d_ed00:46)
     d  d_for100                      3    overlay(d_ed00:58)
     d  d_kva200                      3    overlay(d_ed00:61)
     d  d_levd00                      8    overlay(d_ed00:64)
     d    d_lvda00                    8  0 overlay(d_levd00:1)
     d  d_for200                      3    overlay(d_ed00:69)
      *
     d                 ds
     d d_ed01                        80
     d  d_id01                        4    overlay(d_ed01)
     d  d_mref01                     10    overlay(d_ed01:5)
     d  d_mtyp01                      6    overlay(d_ed01:15)
     d  d_mver01                      3    overlay(d_ed01:21)
     d  d_mrel01                      3    overlay(d_ed01:24)
     d  d_mkon01                      2    overlay(d_ed01:27)
     d  d_mfor01                      6    overlay(d_ed01:29)
     d  d_mkod01                      3    overlay(d_ed01:35)
     d  d_benr01                     35    overlay(d_ed01:38)
     d  d_resp01                      3    overlay(d_ed01:73)
      *
     d                 ds
     d d_ed02                        80
     d  d_id02                        4    overlay(d_ed02)
     d  d_ftxq02                      3    overlay(d_ed02:5)
     d  d_ftxt02                     70    overlay(d_ed02:8)
      *
     d                 ds
     d d_ed03                        80
     d  d_id03                        4    overlay(d_ed03)
     d  d_refq03                      3    overlay(d_ed03:5)
7.04 d  d_refr03                     70    overlay(d_ed03:8)
      *
     d                 ds
     d d_ed04                        80
     d  d_id04                        4    overlay(d_ed04)
     d  d_parq04                      3    overlay(d_ed04:5)
     d  d_part04                     13    overlay(d_ed04:8)
     d    d_pean04                   13  0 overlay(d_part04:1)
     d  d_porg04                      3    overlay(d_ed04:21)
7.17 d  d_alid04                      6    overlay(d_ed04:24)
7.17 d    d_alin04                    6  0 overlay(d_alid04:1)
      *
     d                 ds
     d d_ed05                        80
     d  d_id05                        4    overlay(d_ed05)
     d  d_pnav05                     30    overlay(d_ed05:5)
     d  d_pad105                     30    overlay(d_ed05:35)
      *
     d                 ds
     d d_ed06                        80
     d  d_id06                        4    overlay(d_ed06)
     d  d_pad206                     30    overlay(d_ed06:5)
     d  d_ppnu06                      4    overlay(d_ed06:35)
     d  d_ppst06                     30    overlay(d_ed06:39)
      *
     d                 ds
     d d_ed07                        80
     d  d_id07                        4    overlay(d_ed07)
     d  d_refq07                      3    overlay(d_ed07:5)
     d  d_fore07                     14    overlay(d_ed07:8)
     d  d_ctfu07                      3    overlay(d_ed07:22)
     d  d_kont07                     30    overlay(d_ed07:25)
      *
     d                 ds
     d d_ed08                        80
     d  d_id08                        4    overlay(d_ed08)
     d  d_komm08                     70    overlay(d_ed08:5)
     d  d_komq08                      3    overlay(d_ed08:75)
      *
     d                 ds
     d d_ed09                        80
     d  d_id09                        4    overlay(d_ed09)
     d  d_trsq09                      3    overlay(d_ed09:5)
     d  d_trko09                      3    overlay(d_ed09:8)
     d  d_fmko09                      8    overlay(d_ed09:11)
     d  d_lebq09                      3    overlay(d_ed09:19)
     d  d_levb09                      3    overlay(d_ed09:22)
     d  d_levq09                      3    overlay(d_ed09:25)
     d  d_lskq09                      3    overlay(d_ed09:28)
     d  d_lbst09                     13    overlay(d_ed09:31)
     d  d_lsko09                      3    overlay(d_ed09:44)
      *
     d                 ds
     d d_ed10                        80
     d  d_id10                        4    overlay(d_ed10)
     d  d_vlin10                      6    overlay(d_ed10:5)
     d    d_vlix10                    6  0 overlay(d_vlin10:1)
6.32 d    d_vlix05                    5  0 overlay(d_vlin10:1)
6.32 d    d_vlix04                    4  0 overlay(d_vlin10:1)
6.32 d    d_vlix03                    3  0 overlay(d_vlin10:1)
6.32 d    d_vlix02                    2  0 overlay(d_vlin10:1)
6.32 d    d_vlix01                    1  0 overlay(d_vlin10:1)
     d  d_eanr10                     15    overlay(d_ed10:11)
6.31 d    d_eanx14                   14  0 overlay(d_eanr10:1)
6.31 d    d_eanx13                   13  0 overlay(d_eanr10:1)
6.31 d    d_eanx12                   12  0 overlay(d_eanr10:1)
6.31 d    d_eanx08                    8  0 overlay(d_eanr10:1)
     d  d_eank10                      3    overlay(d_ed10:26)
     d  d_piq110                      3    overlay(d_ed10:29)
     d  d_alt110                     15    overlay(d_ed10:32)
     d    d_altx10                    8  0 overlay(d_alt110:1)
     d  d_alk110                      3    overlay(d_ed10:47)
     d  d_piq210                      3    overlay(d_ed10:50)
     d  d_alt210                     15    overlay(d_ed10:53)
     d  d_alk210                      3    overlay(d_ed10:68)
      *
     d                 ds
     d d_ed11                        80
     d  d_id11                        4    overlay(d_ed11)
     d  d_txk111                      3    overlay(d_ed11:5)
     d  d_txt111                     35    overlay(d_ed11:8)
     d  d_txt211                     35    overlay(d_ed11:43)
      *
     d                 ds
     d d_ed12                        80
     d  d_id12                        4    overlay(d_ed12)
     d  d_kvaq12                      3    overlay(d_ed12:5)
     d  d_kvan12                     15    overlay(d_ed12:8)
     d    d_kvah12                   11  0 overlay(d_kvan12:1)
     d    d_kvad12                    3  3 overlay(d_kvan12:13)
     d  d_benh12                      3    overlay(d_ed12:23)
      *
     d                 ds
     d d_ed13                        80
     d  d_id13                        4    overlay(d_ed13)
     d  d_lftq13                      3    overlay(d_ed13:5)
     d  d_lftx13                     70    overlay(d_ed13:8)
      *
7.01 d                 ds
7.01 d d_kpros                        6  0
7.01 d  d_kproa                       6    overlay(d_kpros:1)
7.01 d  d_kpro5                       5    overlay(d_kpros:1)
7.01 d  d_kpro4                       4    overlay(d_kpros:1)
7.01 d  d_kpro3                       3    overlay(d_kpros:1)
7.01 d  d_kpro2                       2    overlay(d_kpros:1)
7.01 d  d_kpro1                       1    overlay(d_kpros:1)
      *
7.03 d                 ds
7.03 d w_ed03                        70
7.03 d  w_levd03                      8    overlay(w_ed03:1)
7.03 d    w_lvda03                    8  0 overlay(w_levd03:1)
8.02 d                 ds
8.02 d d_kund                         6  0
8.02 d  d_kunda                       6    overlay(d_kund:1)
8.02 d  d_kund5                       5    overlay(d_kund:1)
8.02 d  d_kund4                       4    overlay(d_kund:1)
8.02 d  d_kund3                       3    overlay(d_kund:1)
8.02 d  d_kund2                       2    overlay(d_kund:1)
8.02 d  d_kund1                       1    overlay(d_kund:1)
7.18  *
7.18  * Definering av eksterne prg
7.18  *
7.18   dcl-s co402_verdi1  char(1);
7.18   dcl-s co402_verdi2  char(2048);
7.18   DCL-PR CO402R EXTPGM('CO402R');
7.18     p_filgrp            char(3)     const;
7.18     p_firm              packed(3:0) const;
7.18     p_lager             packed(2:0) const;
7.18     p_nokkel            char(50)    const;
7.18     p_verdi1            char(1);
7.18     p_verdi2            char(2048);
7.18   END-PR;
      *
7.18 d u_718           s              1    inz(*off)
8.01 d u_801           s              1    inz(*off)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Hoved program styrerutine - les av innposter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   eval      b_oskr = *off
      *
     c                   read      lwebpf
      *
     c                   dow       not %eof
     c                   eval      w_rect = %subst(beslin:1:4)
      *
     c                   select
     c                   when      w_rect = 'ED00'
     c                   exsr      ed00
     c                   when      w_rect = 'ED01'
     c                   exsr      ed01
     c                   when      w_rect = 'ED02'
     c                   exsr      ed02
     c                   when      w_rect = 'ED03'
     c                   exsr      ed03
     c                   when      w_rect = 'ED04'
     c                   exsr      ed04
     c                   when      w_rect = 'ED05'
     c                   exsr      ed05
     c                   when      w_rect = 'ED06'
     c                   exsr      ed06
     c                   when      w_rect = 'ED07'
     c                   exsr      ed07
     c                   when      w_rect = 'ED08'
     c                   exsr      ed08
     c                   when      w_rect = 'ED09'
     c                   exsr      ed09
     c                   when      w_rect = 'ED10'
     c                   exsr      ed10
     c                   when      w_rect = 'ED11'
     c                   exsr      ed11
     c                   when      w_rect = 'ED12'
     c                   exsr      ed12
     c                   when      w_rect = 'ED13'
     c                   exsr      ed13
     c                   endsl
      *
6.33 c     neste_lweb    tag
      *
     c                   read      lwebpf
     c                   enddo
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     end_pgm       tag
      *
     c                   if        b_blin = *on
     c                   exsr      skriv_lbest
     c                   endif
      *
7.14 c**                 if        b_oskr = *on
7.14 c**                 exsr      send_melding
7.14 c**                 endif
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED00  - Meldingsinit.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed00          begsr
      *
     c**                 exsr      hent_mnum
      *
     c**                 exsr      null_hbest
     c                   eval      d_ed00 = beslin
      *
     c**                 eval      b_bhod = *on
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED01  - Meldingshode
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed01          begsr
      *
      * Er forrige linje skrevet?
      *
     c                   if        b_blin = *on
     c                   exsr      skriv_lbest
     c                   exsr      null_lbest
     c                   endif
      *
     c                   exsr      hent_mnum
     c                   exsr      null_hbest
     c                   eval      d_ed01 = beslin
      *
     c                   eval      nonref = %trim(d_benr01)
6.34  * Leveringsdato sette 0 hvis ikke den er utfylt på EDI meldinga.
6.34 c**                 if        noldat = *loval
6.34 c**                 eval      noldat = w_date
6.34 c**                 endif
      *
     c                   eval      b_bhod = *on
6.33 c                   eval      b_feil = *off
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED02 - Fritekst/hode
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed02          begsr
      *
     c                   eval      d_ed02 = beslin
      *
     c                   if        d_ftxt02 <> *blank
     c                   eval      nomeld = %trim(nomeld) + %trim(d_ftxt02)
     c                   endif
6.37  *
6.37 c                   if        d_ftxt02 <> *blank and
6.37 c                             w_mel1 = *blank
6.37 c                   eval      w_mel1 = %trim(d_ftxt02)
7.05 c                   goto      ed02_end
6.37 c                   endif
6.37  *
6.37 c                   if        d_ftxt02 <> *blank and
6.37 c                             w_mel1 <> *blank   and
6.37 c                             w_mel2 = *blank
6.37 c                   eval      w_mel2 = %trim(d_ftxt02)
7.05 c                   goto      ed02_end
6.37 c                   endif
6.37  *
6.37 c                   if        d_ftxt02 <> *blank and
6.37 c                             w_mel1 <> *blank   and
6.37 c                             w_mel2 <> *blank   and
6.37 c                             w_mel3 =  *blank
6.37 c                   eval      w_mel3 = %trim(d_ftxt02)
7.05 c                   goto      ed02_end
6.37 c                   endif
6.37  *
6.37 c                   if        d_ftxt02 <> *blank and
6.37 c                             w_mel1 <> *blank   and
6.37 c                             w_mel2 <> *blank   and
6.37 c                             w_mel3 <> *blank   and
6.37 c                             w_mel4 <> *blank
6.37 c                   eval      w_mel4 = %trim(d_ftxt02)
7.05 c                   goto      ed02_end
6.37 c                   endif
6.37  *
6.37 c                   if        d_ftxt02 <> *blank and
6.37 c                             w_mel1 <> *blank   and
6.37 c                             w_mel2 <> *blank   and
6.37 c                             w_mel3 <> *blank   and
6.37 c                             w_mel4 <> *blank   and
6.37 c                             w_mel5 =  *blank
6.37 c                   eval      w_mel5 = %trim(d_ftxt02)
7.05 c                   goto      ed02_end
6.37 c                   endif
7.05  *
7.05 c                   if        d_ftxt02 <> *blank and
7.05 c                             w_mel1 <> *blank   and
7.05 c                             w_mel2 <> *blank   and
7.05 c                             w_mel3 <> *blank   and
7.05 c                             w_mel4 <> *blank   and
7.05 c                             w_mel5 <> *blank   and
7.05 c                             w_mel6 =  *blank
7.05 c                   eval      w_mel6 = %trim(d_ftxt02)
7.05 c                   goto      ed02_end
7.05 c                   endif
7.05  *
7.05 c                   if        d_ftxt02 <> *blank and
7.05 c                             w_mel1 <> *blank   and
7.05 c                             w_mel2 <> *blank   and
7.05 c                             w_mel3 <> *blank   and
7.05 c                             w_mel4 <> *blank   and
7.05 c                             w_mel5 <> *blank   and
7.05 c                             w_mel6 =  *blank   and
7.05 c                             w_mel7 =  *blank
7.05 c                   eval      w_mel7 = %trim(d_ftxt02)
7.05 c                   goto      ed02_end
7.05 c                   endif
7.05  *
7.05 c                   if        d_ftxt02 <> *blank and
7.05 c                             w_mel1 <> *blank   and
7.05 c                             w_mel2 <> *blank   and
7.05 c                             w_mel3 <> *blank   and
7.05 c                             w_mel4 <> *blank   and
7.05 c                             w_mel5 <> *blank   and
7.05 c                             w_mel6 =  *blank   and
7.05 c                             w_mel7 =  *blank   and
7.05 c                             w_mel8 =  *blank
7.05 c                   eval      w_mel8 = %trim(d_ftxt02)
7.05 c                   goto      ed02_end
7.05 c                   endif
7.05  *
7.05 c                   if        d_ftxt02 <> *blank and
7.05 c                             w_mel1 <> *blank   and
7.05 c                             w_mel2 <> *blank   and
7.05 c                             w_mel3 <> *blank   and
7.05 c                             w_mel4 <> *blank   and
7.05 c                             w_mel5 <> *blank   and
7.05 c                             w_mel6 =  *blank   and
7.05 c                             w_mel7 =  *blank   and
7.05 c                             w_mel8 =  *blank   and
7.05 c                             w_mel9 =  *blank
7.05 c                   eval      w_mel9 = %trim(d_ftxt02)
7.05 c                   goto      ed02_end
7.05 c                   endif
7.05  *
7.05 c                   if        d_ftxt02 <> *blank and
7.05 c                             w_mel1 <> *blank   and
7.05 c                             w_mel2 <> *blank   and
7.05 c                             w_mel3 <> *blank   and
7.05 c                             w_mel4 <> *blank   and
7.05 c                             w_mel5 <> *blank   and
7.05 c                             w_mel6 =  *blank   and
7.05 c                             w_mel7 =  *blank   and
7.05 c                             w_mel8 =  *blank   and
7.05 c                             w_mel9 =  *blank   and
7.05 c                             w_mel10 =  *blank
7.05 c                   eval      w_mel10 = %trim(d_ftxt02)
7.05 c                   goto      ed02_end
7.05 c                   endif
      *
7.05 c     ed02_end      endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED03 - Referanser
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed03          begsr
      *
     c                   eval      d_ed03 = beslin
      *
     c                   if        d_refq03 = 'CR '
     c                   if        d_refr03 <> *blank
8.06 c**                 eval      norekv = *blank
8.06 c**                 eval      w_rekv = *blank
     c                   eval      norekv = %trim(d_refr03)
7.04 c                   eval      w_rekv = %trim(d_refr03)
     c                   endif
     c                   endif
8.06  * Nullstilles i "null_hbest". Ligger det her, vil det nullstilles for hver ED03.
8.04 c**                 eval      nokpro = 0
8.06 c**                 eval      w_prnr = *blanks
8.06 c**                 eval      w_aepn = *blanks
7.01 c                   if        d_refq03 = 'AEP'
7.01 c                   if        d_refr03 <> *blank
7.01 c                   eval      w_prnr = %trim(d_refr03)
7.04 c                   eval      w_aepn = %trim(d_refr03)
7.01 c                   if        %check(c_digi:%trim(w_prnr)) = 0
7.01  *
7.01 c                   eval      w_kpro = *blanks
7.01 c                   eval      w_leng = %len(%trim(w_prnr))
7.01 c                   if        w_leng < 7
7.01 c                   eval      d_kproa = %subst(w_prnr:1:w_leng)
7.01 c                   if        w_leng = 1
7.01 c                   move      d_kpro1       w_kpro
7.01 c                   elseif    w_leng = 2
7.01 c                   move      d_kpro2       w_kpro
7.01 c                   elseif    w_leng = 3
7.01 c                   move      d_kpro3       w_kpro
7.01 c                   elseif    w_leng = 4
7.01 c                   move      d_kpro4       w_kpro
7.01 c                   elseif    w_leng = 5
7.01 c                   move      d_kpro5       w_kpro
7.01 c                   elseif    w_leng = 6
7.01 c                   move      d_kproa       w_kpro
7.01 c                   endif
7.01 c                   move      w_kpro        d_kpros
7.01 c                   eval      nokpro = d_kpros
7.01 c                   endif
7.01  *
7.01 c                   endif
7.01 c                   endif
7.01 c                   endif
      *
7.03 c                   if        d_refq03 = '69 '
7.03 c                   eval      w_ldat = *loval
7.03 c                   eval      w_ed03 = d_refr03
7.03 c                   if        w_lvda03 <> 0
7.03 c     *ymd          move      w_lvda03      w_ldat
7.03 c                   endif
7.03 c                   if        w_ldat <> *loval
7.03 c                   eval      noldat = w_ldat
7.03 c                   endif
7.03 c                   endif
      *
7.06 c                   if        d_refq03 = 'MS '
7.06 c                   if        %trim(d_refr03) = 'Smartkalk'
7.06 c                   eval      w_fsys = 'SMK'
7.06 c                   else
7.06 c                   eval      w_fsys = %trim(d_refr03)
7.06 c                   endif
7.06 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED04 - Partsinformasjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed04          begsr
      *
6.38 c                   eval      w_or04 = 0
6.38 c                   eval      w_gl04 = 0
     c                   eval      d_ed04 = beslin
      *
6.38 c**   ' ':'0'       xlate     d_part04      d_part04
6.38 c                   if        %len(%trim(d_part04)) = 9
6.38 c                   eval      w_or04 = %int(%trim(d_part04))
6.38 c                   elseif    %len(%trim(d_part04)) = 13
6.38 c                   eval      w_gl04 = %int(%trim(d_part04))
6.38 c                   endif
      *
     c                   if        d_parq04 = 'BY '
7.17  *
7.17  * Sjekk om det er kommet kundenummer ?
7.17  *
8.02 c                   eval      w_kund = *blanks
8.02 c                   eval      d_kunda = *blanks
8.02 c                   eval      w_leng = %len(%trim(d_alid04))
8.02 c                   if        w_leng < 7
8.02 c                   eval      d_kunda = %subst(d_alid04:1:w_leng)
8.02 c                   if        w_leng = 1
8.02 c                   move      d_kund1       w_kund
8.02 c                   elseif    w_leng = 2
8.02 c                   move      d_kund2       w_kund
8.02 c                   elseif    w_leng = 3
8.02 c                   move      d_kund3       w_kund
8.02 c                   elseif    w_leng = 4
8.02 c                   move      d_kund4       w_kund
8.02 c                   elseif    w_leng = 5
8.02 c                   move      d_kund5       w_kund
8.07 c                   elseif    w_leng = 6
8.07 c                   move      d_kunda       w_kund
8.02 c                   endif
8.02 c                   eval      d_alid04 = w_kund
8.02 c                   endif
7.17  *
7.17 c     ' ':'0'       xlate     d_alid04      d_alid04
7.17 c                   if        d_alin04 <> 0
7.17 c                   eval      rkunl1_kund = d_alin04
7.17 c     rkunl1_key    chain     rkunl1
7.17 c                   if        %found
7.17 c                   eval      nokund = rkkund
7.17 c                   eval      nonavn = rknavn
7.17 c                   eval      noknav = rknavn
7.17 c                   eval      noadr1 = rkgate
7.17 c                   eval      noadr2 = rkadr2
7.17 c                   eval      nolage = rklagr
7.17 c                   eval      noavde = rkavde
7.17 c                   movel     rkponr        noponr
7.17 c                   eval      nosted = rksted
7.17 c                   endif
7.17 c                   endif
7.17  *
7.17  * Ikke sjekk videre hvis det kan identifiseres via kundenummer
7.17  *
7.17 c                   if        %trim(nonavn) = *blanks
      *
6.38 c                   if        w_or04 <> 0
     c                   eval      w_bygl = w_or04
6.38 c                   else
6.38 c                   eval      w_bygl = w_gl04
6.38 c                   endif
      *
6.38 c**                 eval      rkunl5_eank = d_pean04
6.38 c                   eval      rkunl5_eank = w_gl04
6.36 c                   if        rkunl5_eank > 0
     c     rkunl5_key    chain     rkunl5
      *
     c                   if        %found
     c                   eval      nokund = rkkund
     c                   eval      nonavn = rknavn
     c                   eval      noknav = rknavn
     c                   eval      noadr1 = rkgate
     c                   eval      noadr2 = rkadr2
7.09 c                   eval      nolage = rklagr
7.09 c                   eval      noavde = rkavde
     c                   movel     rkponr        noponr
     c                   eval      nosted = rksted
6.38 c                   else
6.38 c                   if        %trim(d_part04) <> *blanks
6.38 c                   eval      noknav = d_part04
6.38 c                   else
6.38 c                   eval      noknav = 'Ukjent kunde'
6.38 c                   endif
6.38 c                   eval      nokund = 0
6.38 c                   endif
6.38 c                   endif
      * EHF faktura ? (orgnummer)
6.38 c**                 if        d_pean04 < 1000000000
6.38 c                   if        nokund = 0 and
6.38 c                             w_or04 > 0
6.38 c**                 eval      rkunl4_ftnr = d_pean04
6.38 c                   eval      rkunl4_ftnr = w_or04
     c     rkunl4_key    chain     rkunl4
     c                   if        %found
     c                   eval      nokund = rkkund
     c                   eval      nonavn = rknavn
     c                   eval      noknav = rknavn
     c                   eval      noadr1 = rkgate
     c                   eval      noadr2 = rkadr2
7.09 c                   eval      nolage = rklagr
7.09 c                   eval      noavde = rkavde
     c                   movel     rkponr        noponr
     c                   eval      nosted = rksted
     c                   else
6.38 c                   if        %trim(d_part04) <> *blanks
6.38 c                   eval      noknav = d_part04
6.38 c                   else
6.38 c                   eval      noknav = 'Ukjent kunde'
6.38 c                   endif
6.38 c                   eval      nokund = 0
6.38 c                   endif
6.38 c                   endif
7.01  *
7.17 c                   endif
7.01  *
7.01  * Sjekk om vi finner prosjektnummer hvis det er angitt i ED03
7.01  *
8.08 c*                  if        nokpro = 0    and
8.08 c*                            %trim(w_prnr) <> *blanks
8.08 c                   if        nokpro <> 0
8.09 c                   if        %trim(norekv) = *blanks
8.09 c                   eval      norekv = %char(nokpro)
8.09 c                   endif
7.01 c                   eval      fkprl6_epro = %trim(w_prnr)
7.01 c                   eval      fkprl6_kund = nokund
7.01 c     fkprl6_key    chain     fkprl6
7.01 c                   if        %found
7.01 c                   eval      nokpro = flkpro
8.09 c                   else
8.09 c                   eval      nokpro = 0
7.01 c                   endif
8.09 c**                 if        %trim(norekv) <> *blanks
8.09 c**                 eval      norekv = %char(nokpro)
8.09 c**                 endif
7.01 c                   endif
      *
     c                   endif
      *
     c                   if        d_parq04 = 'DP '
6.38 c                   if        w_gl04 <> 0
6.38 c                   eval      w_dpgl = w_gl04
7.08  * Sjekk logistikkpunktet
7.08 c                   eval      mjlol2_eann = w_dpgl
7.08 c     mjlol2_key    chain     mjlol2
7.08 c                   if        %found
7.08 c                   eval      nolage = mjlage
7.08  * Finn kode for hentes fra nettbutikk
7.08 c                   movel     aafftn        anbll1_leie
7.08 c                   movel     w_dpgl        anbll1_lbut
7.08 c     anbll1_key    chain     anbll1
7.08 c                   if        %found
7.08 c                   eval      nolmat = aohkod
7.08 c                   else
7.10 c**                 eval      nolmat = 4
7.10 c                   eval      nolmat = w_hkod
7.08 c                   endif
7.08 c                   else
7.10 c**                 eval      nolmat = 5
7.10 c                   eval      nolmat = w_lkod
7.08 c                   endif
6.38 c                   else
6.38 c                   eval      w_dpgl = w_or04
7.10 c**                 eval      nolmat = 5
7.10 c                   eval      nolmat = w_lkod
6.38 c                   endif
     c                   endif
      *
     c                   if        d_parq04 = 'IV '
6.38 c                   if        w_gl04 <> 0
6.38 c**                 eval      w_ivgl = d_pean04
6.38 c                   eval      w_ivgl = w_gl04
6.38 c                   else
6.38 c                   eval      w_ivgl = w_or04
6.38 c                   endif
     c                   endif
7.18  *
7.18  * Sjekk om avdeling skal hentes fra lager
7.18  *
7.18 c                   if        u_718 = *on
7.19 c                   if        nolage <> 0
7.18 c                   eval      noavde = 0
7.18 c                   eval      ra10l1_jkod = nolage
7.18 c     ra10l1_key    chain     ra10l1
8.03 c                   if        %found
7.18 c                   eval      noavde = rajavd
7.18 c                   endif
7.19 c                   endif
7.18 c                   endif
7.18  *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED05 - Mottager navn/adr 1
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed05          begsr
      *
     c                   eval      d_ed05 = beslin
      *
     c                   if        d_parq04 = 'DP '
     c                   if        d_pnav05 <> *blank
     c                   eval      nonavn = %trim(d_pnav05)
     c                   eval      noadr1 = %trim(d_pad105)
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED06 -  Mottager adr 2/postdata
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed06          begsr
      *
     c                   eval      d_ed06 = beslin
      *
     c                   if        d_parq04 = 'DP '
     c                   if        d_ppst06 <> *blank
     c                   eval      noadr2 = %trim(d_pad206)
     c                   eval      noponr = %trim(d_ppnu06)
     c                   eval      nosted = %trim(d_ppst06)
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED07 - Foretaksnr m.m.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed07          begsr
      *
      *
     c                   eval      d_ed07 = beslin
      *
     c                   if        d_parq04 = 'BY '
     c                   if        d_ctfu07 = 'PD '
     c                   eval      nodref = d_kont07
7.02 c                   eval      nounav = d_kont07
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED08 - Komm. adresse
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed08          begsr
      *
     c                   eval      d_ed08 = beslin
      *
7.02 c                   if        d_komq08 = 'EM '
7.02 c                   eval      noumai = d_komm08
7.02 c                   elseif    d_komq08 = 'TE '
7.02 c                   eval      noutlf = d_komm08
7.02 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED09 - Transport m.m.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed09          begsr
      *
     c                   eval      d_ed09 = beslin
      *
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED10 - Varelinjer/vareidentifikasjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed10          begsr
      *
      * Er ordrehode skrevet?
      *
     c                   if        b_bhod = *on
     c                   exsr      skriv_hbest
     c                   endif
      *
      * Er forrige linje skrevet?
      *
     c                   if        b_blin = *on
     c                   exsr      skriv_lbest
     c                   endif
      *
     c                   exsr      null_lbest
6.31 c                   eval      x=0
6.32 c                   eval      y=0
      *
     c                   eval      ndnref = nonref
     c                   eval      ndfsys = nofsys
     c                   eval      ndtell = notell
      *
     c                   eval      d_ed10 = beslin
6.31 c                   eval      x = %len(%trim(d_eanr10))
6.32 c                   eval      y = %len(%trim(d_vlin10))
     c     ' ':'0'       xlate     d_vlin10      d_vlin10
     c**                 eval      ndline = d_vlix10
     c                   eval      ndline = s_line + 10
     c                   eval      s_line = ndline
      *
     c     ' ':'0'       xlate     d_eanr10      d_eanr10
      *
     c     ' ':'0'       xlate     d_alt110      d_alt110
     c     c_digi        check     d_alt110                               80
     c                   if        *in80 = *on
     c                   eval      d_altx10 = 0
     c                   endif
      *
     c                   exsr      finn_vare
      *
     c                   eval      b_blin = *on
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED11 - Varelinjer/varetekst
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed11          begsr
      *
     c                   eval      d_ed11 = beslin
      *
     c                   eval      ndtek1 = d_txt111
     c                   eval      ndtek2 = d_txt211
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED12 - Varelinjer/kvantumsinformasjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed12          begsr
      *
     c                   eval      d_ed12 = beslin
      * Bestilt kvantum ?
     c                   if        d_kvaq12 = '21 '
      *
     c     ' ':'0'       xlate     d_kvan12      d_kvan12
      *
     c                   eval      ndanta = d_kvah12 + d_kvad12
     c                   if        ndenhe = *blanks
     c                   eval      ndenhe = d_benh12
     c                   endif
      *
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ED13 - Varelinjer/fritekst
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ed13          begsr
      *
     c                   eval      d_ed13 = beslin
6.37  *
6.37 c                   if        d_lftx13 <> *blank and
6.37 c                             w_mel1 = *blank
6.37 c                   eval      w_mel1 = %trim(d_lftx13)
6.37 c                   eval      d_lftx13 = *blanks
6.37 c                   endif
6.37  *
6.37 c                   if        d_lftx13 <> *blank and
6.37 c                             w_mel1 <> *blank   and
6.37 c                             w_mel2 = *blank
6.37 c                   eval      w_mel2 = %trim(d_lftx13)
6.37 c                   eval      d_lftx13 = *blanks
6.37 c                   endif
6.37  *
6.37 c                   if        d_lftx13 <> *blank and
6.37 c                             w_mel1 <> *blank   and
6.37 c                             w_mel2 <> *blank   and
6.37 c                             w_mel3 =  *blank
6.37 c                   eval      w_mel3 = %trim(d_lftx13)
6.37 c                   eval      d_lftx13 = *blanks
6.37 c                   endif
6.37  *
6.37 c                   if        d_lftx13 <> *blank and
6.37 c                             w_mel1 <> *blank   and
6.37 c                             w_mel2 <> *blank   and
6.37 c                             w_mel3 <> *blank   and
6.37 c                             w_mel4 =  *blank
6.37 c                   eval      w_mel4 = %trim(d_lftx13)
6.37 c                   eval      d_lftx13 = *blanks
6.37 c                   endif
6.37  *
6.37 c                   if        d_lftx13 <> *blank and
6.37 c                             w_mel1 <> *blank   and
6.37 c                             w_mel2 <> *blank   and
6.37 c                             w_mel3 <> *blank   and
6.37 c                             w_mel4 <> *blank   and
6.37 c                             w_mel5 =  *blank
6.37 c                   eval      w_mel5 = %trim(d_lftx13)
6.37 c                   eval      d_lftx13 = *blanks
6.37 c                   endif
7.05  *
7.05 c                   if        d_lftx13 <> *blank and
7.05 c                             w_mel1 <> *blank   and
7.05 c                             w_mel2 <> *blank   and
7.05 c                             w_mel3 <> *blank   and
7.05 c                             w_mel4 <> *blank   and
7.05 c                             w_mel5 =  *blank   and
7.05 c                             w_mel6 =  *blank
7.05 c                   eval      w_mel6 = %trim(d_lftx13)
7.05 c                   eval      d_lftx13 = *blanks
7.05 c                   endif
7.05  *
7.05 c                   if        d_lftx13 <> *blank and
7.05 c                             w_mel1 <> *blank   and
7.05 c                             w_mel2 <> *blank   and
7.05 c                             w_mel3 <> *blank   and
7.05 c                             w_mel4 <> *blank   and
7.05 c                             w_mel5 =  *blank   and
7.05 c                             w_mel6 =  *blank   and
7.05 c                             w_mel7 =  *blank
7.05 c                   eval      w_mel7 = %trim(d_lftx13)
7.05 c                   eval      d_lftx13 = *blanks
7.05 c                   endif
7.05  *
7.05 c                   if        d_lftx13 <> *blank and
7.05 c                             w_mel1 <> *blank   and
7.05 c                             w_mel2 <> *blank   and
7.05 c                             w_mel3 <> *blank   and
7.05 c                             w_mel4 <> *blank   and
7.05 c                             w_mel5 =  *blank   and
7.05 c                             w_mel6 =  *blank   and
7.05 c                             w_mel7 =  *blank   and
7.05 c                             w_mel8 =  *blank
7.05 c                   eval      w_mel8 = %trim(d_lftx13)
7.05 c                   eval      d_lftx13 = *blanks
7.05 c                   endif
7.05  *
7.05 c                   if        d_lftx13 <> *blank and
7.05 c                             w_mel1 <> *blank   and
7.05 c                             w_mel2 <> *blank   and
7.05 c                             w_mel3 <> *blank   and
7.05 c                             w_mel4 <> *blank   and
7.05 c                             w_mel5 =  *blank   and
7.05 c                             w_mel6 =  *blank   and
7.05 c                             w_mel7 =  *blank   and
7.05 c                             w_mel8 =  *blank   and
7.05 c                             w_mel9 =  *blank
7.05 c                   eval      w_mel9 = %trim(d_lftx13)
7.05 c                   eval      d_lftx13 = *blanks
7.05 c                   endif
7.05  *
7.05 c                   if        d_lftx13 <> *blank and
7.05 c                             w_mel1 <> *blank   and
7.05 c                             w_mel2 <> *blank   and
7.05 c                             w_mel3 <> *blank   and
7.05 c                             w_mel4 <> *blank   and
7.05 c                             w_mel5 =  *blank   and
7.05 c                             w_mel6 =  *blank   and
7.05 c                             w_mel7 =  *blank   and
7.05 c                             w_mel8 =  *blank   and
7.05 c                             w_mel9 =  *blank   and
7.05 c                             w_mel10 =  *blank
7.05 c                   eval      w_mel10 = %trim(d_lftx13)
7.05 c                   eval      d_lftx13 = *blanks
7.05 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for å finne varenummer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     finn_vare     begsr
      *
      * Sjekk eannn
      *
6.31 c                   if        x = 8
6.31 c                   eval      w_eann = d_eanx08
6.31 c                   elseif    x = 12
6.31 c                   eval      w_eann = d_eanx12
6.31 c                   elseif    x = 13
6.31 c                   eval      w_eann = d_eanx13
6.31 c                   else
6.31 c                   eval      w_eann = d_eanx14
6.31 c                   endif
6.36  *
6.36 c                   if        w_eann > 0
6.36  *
     c**                 call      'VE710R  '
     c                   call      'VE717R  '
     c                   parm                    w_firm
     c                   parm                    w_eann
     c                   parm                    w_eava
     c                   parm                    w_eaen
     c                   parm                    w_nobb
     c                   parm                    w_east
     c                   if        w_east = '1'
     c                   eval      ndvare = w_eava
     c                   eval      ndenhe = w_eaen
     c                   goto      end_vare
     c                   endif
      *
6.36 c                   endif
      *
      * Sjekk via nobbnr
      *
6.36 c                   if        d_altx10 > 0
      *
     c                   eval      vvarl3_nobb = d_altx10
     c     vvarl3_key    chain     vvarl3
     c                   if        %found
     c                   eval      ndvare = vvvare
     c                   goto      end_vare
     c                   endif
      *
6.36 c                   endif
      *
      * Sjekk via lev.varenr
      *
6.36 c                   if        d_alt210 <> *blanks
      *
     c                   eval      vvarl4_lvar = d_alt210
     c     vvarl4_key    chain     vvarl4
     c                   if        %found
     c                   eval      ndvare = vvvare
     c                   goto      end_vare
     c                   endif
      *
6.36 c                   endif
      *
     c     end_vare      endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for å skrive ordre hode
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     skriv_hbest   begsr
      *
7.06 c**                 eval      nohelu_fsys = c_fsys
7.06 c                   eval      nohelu_fsys = w_fsys
     c                   eval      nohelu_tell = notell
      *
     c     nohelu_key    chain     nohelur
     c                   if        not %found
7.06 c                   eval      nofsys = w_fsys
7.13 c                   if        w_fsys = 'SMK'
7.13 c                   eval      norekv = *blank
7.13 c                   endif
     c                   time                    noodat
     c                   time                    nootim
     c                   eval      noousr = l_user
     c                   time                    noedat
     c                   time                    noetim
     c                   eval      noeusr = l_user
     c                   write     nohelur
     c                   endif
7.14  *
7.14  * Send mail til ordrebehandler for avdelingen.
7.14  *
7.14 c                   if        noavde <> 0
7.14  *
7.14 c     fusrl1_key    setll     fusrl1
7.14 c     fusrl1_key    reade     fusrl1
7.14 c                   dow       not %eof
7.14 c                   eval      ausrl1_user = fbuser
7.14 c     ausrl1_key    chain     ausrl1
7.15 c                   if        not %found
7.14 c                   goto      nyles_avde
7.14 c                   endif
7.15  *
7.15 c                   if        absavd <> noavde
7.15 c                   goto      nyles_avde
7.15 c                   endif
7.14  *
7.14 c                   if        fbko10 = 1
7.14 c                   eval      p_navn = *blanks
7.14 c                   eval      p_emal = *blanks
7.14 c                   call      'FB710R'
7.14 c                   parm                    fbuser
7.14 c                   parm                    p_navn
7.14 c                   parm                    p_emal
7.14  *
7.14 c                   if        p_emal <> *blanks
7.14 c                   exsr      send_melding
7.14 c                   endif
7.14  *
7.14 c                   endif
7.14  *
7.14 c     nyles_avde    tag
7.14  *
7.14 c     fusrl1_key    reade     fusrl1
7.14 c                   enddo
7.14  *
7.16  * Send mail til ordrebehandler på innkommet lager
7.16 c                   elseif    nolage <> 0
7.16 c     fusrl1_key    setll     fusrl1
7.16 c     fusrl1_key    reade     fusrl1
7.16 c                   dow       not %eof
7.16 c                   eval      ausrl1_user = fbuser
7.16 c     ausrl1_key    chain     ausrl1
7.16 c                   if        not %found
7.16 c                   goto      nyles_lage
7.16 c                   endif
7.16  *
7.16 c                   if        ablagr <> nolage
7.16 c                   goto      nyles_lage
7.16 c                   endif
7.16  *
7.16 c                   if        fbko10 = 1
7.16 c                   eval      p_navn = *blanks
7.16 c                   eval      p_emal = *blanks
7.16 c                   call      'FB710R'
7.16 c                   parm                    fbuser
7.16 c                   parm                    p_navn
7.16 c                   parm                    p_emal
7.16  *
7.16 c                   if        p_emal <> *blanks
7.16 c                   exsr      send_melding
7.16 c                   endif
7.16  *
7.16 c                   endif
7.16  *
7.16 c     nyles_lage    tag
7.16  *
7.16 c     fusrl1_key    reade     fusrl1
7.16 c                   enddo
7.14  *
7.16  * Send mail til alle nettbutikkbrukere
7.16 c                   else
8.01 c                   if        u_801 = *off
7.16 c     fusrl1_key    setll     fusrl1
7.16 c     fusrl1_key    reade     fusrl1
7.16 c                   dow       not %eof
7.16  *
7.16 c                   if        fbko10 = 1
7.16 c                   eval      p_navn = *blanks
7.16 c                   eval      p_emal = *blanks
7.16 c                   call      'FB710R'
7.16 c                   parm                    fbuser
7.16 c                   parm                    p_navn
7.16 c                   parm                    p_emal
7.16  *
7.16 c                   if        p_emal <> *blanks
7.16 c                   exsr      send_melding
7.16 c                   endif
7.16  *
7.16 c                   endif
7.16  *
7.16 c     fusrl1_key    reade     fusrl1
7.16 c                   enddo
7.16  *
8.01 c                   endif
7.14 c                   endif
      *
      * Legg ut kopi av EDI bestillingen inn
      *
7.06 c**                 eval      edhelu_fsys = c_fsys
7.06 c                   eval      edhelu_fsys = w_fsys
     c                   eval      edhelu_tell = notell
6.35 c                   eval      edhelu_ldor = 0
6.35 c                   eval      edhelu_ldat = *loval
     c     edhelu_key    chain     edhelur
     c                   if        not %found
     c                   clear                   edhelur
     c                   eval      eofirm = w_firm
7.06 c**                 eval      eofsys = c_fsys
7.06 c                   eval      eofsys = w_fsys
     c                   eval      eotell = notell
6.35 c                   eval      eoldor = 0
6.35 c                   eval      eoldat = *loval
      *
     c                   eval      eonref = nonref
     c                   eval      eofrsp = nofrsp
     c                   eval      eolage = nolage
     c                   eval      eoavde = noavde
     c                   eval      eouser = nouser
     c                   eval      eokund = nokund
     c                   eval      eoknav = noknav
     c                   eval      eokpro = nokpro
     c                   eval      eopnav = nopnav
     c                   eval      eonavn = nonavn
     c                   eval      eoadr1 = noadr1
     c                   eval      eoadr2 = noadr2
     c                   eval      eoponr = noponr
     c                   eval      eosted = nosted
     c                   eval      eoldat = noldat
     c                   eval      eodref = nodref
7.04 c**                 eval      eorekv = %trim(d_refr03)
7.04 c                   eval      eorekv = %trim(w_rekv)
     c                   eval      eounav = nounav
     c                   eval      eoutlf = noutlf
     c                   eval      eoumob = noumob
7.04 c**                 eval      eoufax = noufax
7.04 c                   eval      eoufax = w_aepn
     c                   eval      eoumai = noumai
     c                   eval      eomeld = nomeld
     c                   eval      eonumm = nonumm
     c                   eval      eolmat = nolmat
     c                   eval      eobdat = nobdat
     c                   eval      eodpgl = w_dpgl
     c                   eval      eobygl = w_bygl
     c                   eval      eoivgl = w_ivgl
      *
     c                   time                    eoodat
     c                   time                    eootim
     c                   eval      eoousr = l_user
     c                   time                    eoedat
     c                   time                    eoetim
     c                   eval      eoeusr = l_user
     c                   write     edhelur
     c                   else
     c                   time                    eoedat
     c                   time                    eoetim
     c                   eval      eoeusr = l_user
     c                   update    edhelur
     c                   endif
6.37  *
6.37  * Legg ut eventuelle eksterne tekstlinjer. Legges inn som
6.37  * topptekst.
6.37  *
6.37 c                   if        %trim(w_mel1) <> *blanks
6.37  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
6.37 c                   eval      edtxlu_tell = notell
6.37 c                   eval      edtxlu_ldor = 0
6.37 c                   eval      edtxlu_ldat = *loval
6.37 c                   eval      edtxlu_line = 0
6.37 c                   eval      edtxlu_type = 'H'
6.37 c                   eval      edtxlu_tlin = 1
6.37 c     edtxlu_key    chain     edtxlur
6.37 c                   if        not %found
6.37 c                   clear                   edtxlur
6.37 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
6.37 c                   eval      ettell = notell
6.37 c                   eval      etldor = 0
6.37 c                   eval      etldat = *loval
6.37 c                   eval      ettype = 'H'
6.37 c                   eval      ettlin = 1
6.37 c                   eval      ettek1 = %trim(w_mel1)
6.37  *
6.37 c                   time                    etodat
6.37 c                   time                    etotim
6.37 c                   eval      etousr = l_user
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   write     edtxlur
6.37 c                   else
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   update    edtxlur
6.37 c                   endif
6.37  *
6.37 c                   endif
6.37  *
6.37 c                   if        %trim(w_mel2) <> *blanks
6.37  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
6.37 c                   eval      edtxlu_tell = notell
6.37 c                   eval      edtxlu_ldor = 0
6.37 c                   eval      edtxlu_ldat = *loval
6.37 c                   eval      edtxlu_line = 0
6.37 c                   eval      edtxlu_type = 'H'
6.37 c                   eval      edtxlu_tlin = 2
6.37 c     edtxlu_key    chain     edtxlur
6.37 c                   if        not %found
6.37 c                   clear                   edtxlur
6.37 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
6.37 c                   eval      ettell = notell
6.37 c                   eval      etldor = 0
6.37 c                   eval      etldat = *loval
6.37 c                   eval      ettype = 'H'
6.37 c                   eval      ettlin = 2
6.37 c                   eval      ettek1 = %trim(w_mel2)
6.37  *
6.37 c                   time                    etodat
6.37 c                   time                    etotim
6.37 c                   eval      etousr = l_user
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   write     edtxlur
6.37 c                   else
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   update    edtxlur
6.37 c                   endif
6.37  *
6.37 c                   endif
6.37  *
6.37 c                   if        %trim(w_mel3) <> *blanks
6.37  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
6.37 c                   eval      edtxlu_tell = notell
6.37 c                   eval      edtxlu_ldor = 0
6.37 c                   eval      edtxlu_ldat = *loval
6.37 c                   eval      edtxlu_line = 0
6.37 c                   eval      edtxlu_type = 'H'
6.37 c                   eval      edtxlu_tlin = 3
6.37 c     edtxlu_key    chain     edtxlur
6.37 c                   if        not %found
6.37 c                   clear                   edtxlur
6.37 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
6.37 c                   eval      ettell = notell
6.37 c                   eval      etldor = 0
6.37 c                   eval      etldat = *loval
6.37 c                   eval      ettype = 'H'
6.37 c                   eval      ettlin = 3
6.37 c                   eval      ettek1 = %trim(w_mel3)
6.37  *
6.37 c                   time                    etodat
6.37 c                   time                    etotim
6.37 c                   eval      etousr = l_user
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   write     edtxlur
6.37 c                   else
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   update    edtxlur
6.37 c                   endif
6.37  *
6.37 c                   endif
6.37  *
6.37 c                   if        %trim(w_mel4) <> *blanks
6.37  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
6.37 c                   eval      edtxlu_tell = notell
6.37 c                   eval      edtxlu_ldor = 0
6.37 c                   eval      edtxlu_ldat = *loval
6.37 c                   eval      edtxlu_line = 0
6.37 c                   eval      edtxlu_type = 'H'
6.37 c                   eval      edtxlu_tlin = 4
6.37 c     edtxlu_key    chain     edtxlur
6.37 c                   if        not %found
6.37 c                   clear                   edtxlur
6.37 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
6.37 c                   eval      ettell = notell
6.37 c                   eval      etldor = 0
6.37 c                   eval      etldat = *loval
6.37 c                   eval      ettype = 'H'
6.37 c                   eval      ettlin = 4
6.37 c                   eval      ettek1 = %trim(w_mel4)
6.37  *
6.37 c                   time                    etodat
6.37 c                   time                    etotim
6.37 c                   eval      etousr = l_user
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   write     edtxlur
6.37 c                   else
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   update    edtxlur
6.37 c                   endif
6.37  *
6.37 c                   endif
6.37  *
6.37 c                   if        %trim(w_mel5) <> *blanks
6.37  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
6.37 c                   eval      edtxlu_tell = notell
6.37 c                   eval      edtxlu_ldor = 0
6.37 c                   eval      edtxlu_ldat = *loval
6.37 c                   eval      edtxlu_line = 0
6.37 c                   eval      edtxlu_type = 'H'
6.37 c                   eval      edtxlu_tlin = 5
6.37 c     edtxlu_key    chain     edtxlur
6.37 c                   if        not %found
6.37 c                   clear                   edtxlur
6.37 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
6.37 c                   eval      ettell = notell
6.37 c                   eval      etldor = 0
6.37 c                   eval      etldat = *loval
6.37 c                   eval      ettype = 'H'
6.37 c                   eval      ettlin = 5
6.37 c                   eval      ettek1 = %trim(w_mel5)
6.37  *
6.37 c                   time                    etodat
6.37 c                   time                    etotim
6.37 c                   eval      etousr = l_user
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   write     edtxlur
6.37 c                   else
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   update    edtxlur
6.37 c                   endif
6.37  *
6.37 c                   endif
7.05  *
7.05 c                   if        %trim(w_mel6) <> *blanks
7.05  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
7.05 c                   eval      edtxlu_tell = notell
7.05 c                   eval      edtxlu_ldor = 0
7.05 c                   eval      edtxlu_ldat = *loval
7.05 c                   eval      edtxlu_line = 0
7.05 c                   eval      edtxlu_type = 'H'
7.05 c                   eval      edtxlu_tlin = 6
7.05 c     edtxlu_key    chain     edtxlur
7.05 c                   if        not %found
7.05 c                   clear                   edtxlur
7.05 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
7.05 c                   eval      ettell = notell
7.05 c                   eval      etldor = 0
7.05 c                   eval      etldat = *loval
7.05 c                   eval      ettype = 'H'
7.05 c                   eval      ettlin = 6
7.05 c                   eval      ettek1 = %trim(w_mel6)
7.05  *
7.05 c                   time                    etodat
7.05 c                   time                    etotim
7.05 c                   eval      etousr = l_user
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   write     edtxlur
7.05 c                   else
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   update    edtxlur
7.05 c                   endif
7.05  *
7.05 c                   endif
7.05  *
7.05 c                   if        %trim(w_mel7) <> *blanks
7.05  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
7.05 c                   eval      edtxlu_tell = notell
7.05 c                   eval      edtxlu_ldor = 0
7.05 c                   eval      edtxlu_ldat = *loval
7.05 c                   eval      edtxlu_line = 0
7.05 c                   eval      edtxlu_type = 'H'
7.05 c                   eval      edtxlu_tlin = 7
7.05 c     edtxlu_key    chain     edtxlur
7.05 c                   if        not %found
7.05 c                   clear                   edtxlur
7.05 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
7.05 c                   eval      ettell = notell
7.05 c                   eval      etldor = 0
7.05 c                   eval      etldat = *loval
7.05 c                   eval      ettype = 'H'
7.05 c                   eval      ettlin = 7
7.05 c                   eval      ettek1 = %trim(w_mel7)
7.05  *
7.05 c                   time                    etodat
7.05 c                   time                    etotim
7.05 c                   eval      etousr = l_user
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   write     edtxlur
7.05 c                   else
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   update    edtxlur
7.05 c                   endif
7.05  *
7.05 c                   endif
7.05  *
7.05 c                   if        %trim(w_mel8) <> *blanks
7.05  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
7.05 c                   eval      edtxlu_tell = notell
7.05 c                   eval      edtxlu_ldor = 0
7.05 c                   eval      edtxlu_ldat = *loval
7.05 c                   eval      edtxlu_line = 0
7.05 c                   eval      edtxlu_type = 'H'
7.05 c                   eval      edtxlu_tlin = 8
7.05 c     edtxlu_key    chain     edtxlur
7.05 c                   if        not %found
7.05 c                   clear                   edtxlur
7.05 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
7.05 c                   eval      ettell = notell
7.05 c                   eval      etldor = 0
7.05 c                   eval      etldat = *loval
7.05 c                   eval      ettype = 'H'
7.05 c                   eval      ettlin = 8
7.05 c                   eval      ettek1 = %trim(w_mel8)
7.05  *
7.05 c                   time                    etodat
7.05 c                   time                    etotim
7.05 c                   eval      etousr = l_user
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   write     edtxlur
7.05 c                   else
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   update    edtxlur
7.05 c                   endif
7.05  *
7.05 c                   endif
7.05  *
7.05 c                   if        %trim(w_mel9) <> *blanks
7.05  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
7.05 c                   eval      edtxlu_tell = notell
7.05 c                   eval      edtxlu_ldor = 0
7.05 c                   eval      edtxlu_ldat = *loval
7.05 c                   eval      edtxlu_line = 0
7.05 c                   eval      edtxlu_type = 'H'
7.05 c                   eval      edtxlu_tlin = 9
7.05 c     edtxlu_key    chain     edtxlur
7.05 c                   if        not %found
7.05 c                   clear                   edtxlur
7.05 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
7.05 c                   eval      ettell = notell
7.05 c                   eval      etldor = 0
7.05 c                   eval      etldat = *loval
7.05 c                   eval      ettype = 'H'
7.05 c                   eval      ettlin = 9
7.05 c                   eval      ettek1 = %trim(w_mel9)
7.05  *
7.05 c                   time                    etodat
7.05 c                   time                    etotim
7.05 c                   eval      etousr = l_user
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   write     edtxlur
7.05 c                   else
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   update    edtxlur
7.05 c                   endif
7.05  *
7.05 c                   endif
7.05  *
7.05 c                   if        %trim(w_mel10) <> *blanks
7.05  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
7.05 c                   eval      edtxlu_tell = notell
7.05 c                   eval      edtxlu_ldor = 0
7.05 c                   eval      edtxlu_ldat = *loval
7.05 c                   eval      edtxlu_line = 0
7.05 c                   eval      edtxlu_type = 'H'
7.05 c                   eval      edtxlu_tlin = 10
7.05 c     edtxlu_key    chain     edtxlur
7.05 c                   if        not %found
7.05 c                   clear                   edtxlur
7.05 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
7.05 c                   eval      ettell = notell
7.05 c                   eval      etldor = 0
7.05 c                   eval      etldat = *loval
7.05 c                   eval      ettype = 'H'
7.05 c                   eval      ettlin = 10
7.05 c                   eval      ettek1 = %trim(w_mel10)
7.05  *
7.05 c                   time                    etodat
7.05 c                   time                    etotim
7.05 c                   eval      etousr = l_user
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   write     edtxlur
7.05 c                   else
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   update    edtxlur
7.05 c                   endif
7.05  *
7.05 c                   endif
      *
     c                   eval      b_bhod = *off
     c                   eval      b_oskr = *on
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for å skrive ordre linje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     skriv_lbest   begsr
      *
      * Er hode skrevet?
      *
     c                   if        b_bhod = *on
     c                   exsr      skriv_hbest
     c                   endif
      *
     c                   eval      ndldat = noldat
      *
7.12 c**                 eval      nodtlu_fsys = c_fsys
7.12 c                   eval      nodtlu_fsys = w_fsys
     c                   eval      nodtlu_tell = notell
     c                   eval      nodtlu_line = ndline
      *
     c     nodtlu_key    chain     nodtlur
     c                   if        not %found
     c                   if        ndvare = *blanks
      * Vi har ikke funnet vareinfo, legg inn fra EDI melding
6.31 c**                 eval      ndvare = d_alt110
6.31 c                   movel     d_altx10      ndvare
     c                   eval      ndenhe = d_benh12
     c                   eval      ndanta = d_kvah12 + d_kvad12
     c                   endif
      *
     c                   time                    ndodat
     c                   time                    ndotim
     c                   eval      ndousr = l_user
     c                   time                    ndedat
     c                   time                    ndetim
     c                   eval      ndeusr = l_user
     c                   write     nodtlur
     c                   else
     c                   time                    ndedat
     c                   time                    ndetim
     c                   eval      ndeusr = l_user
     c                   update    nodtlur
     c                   endif
      *
      * Legg ut kopi av orginbal bestillingslinje
      *
7.12 c**                 eval      eddtlu_fsys = c_fsys
7.12 c                   eval      eddtlu_fsys = w_fsys
     c                   eval      eddtlu_tell = notell
6.35 c                   eval      eddtlu_ldor = 0
6.35 c                   eval      eddtlu_ldat = *loval
     c                   eval      eddtlu_line = ndline
      *
     c     eddtlu_key    chain     eddtlur
     c                   if        not %found
     c                   clear                   eddtlur
      *
     c                   eval      edfirm = w_firm
7.12 c**                 eval      edfsys = c_fsys
7.12 c                   eval      edfsys = w_fsys
     c                   eval      edtell = notell
     c                   eval      edline = ndline
6.35 c                   eval      edldor = 0
6.35 c                   eval      edldat = *loval
      *
     c                   eval      ednref = ndnref
6.32 c*6.38              if        y = 6
     c                   eval      ednlin = d_vlix10
6.32 c*6.38              elseif    y = 5
6.32 c*6.38              eval      ednlin = d_vlix05
6.32 c*6.38              elseif    y = 4
6.32 c*6.38              eval      ednlin = d_vlix04
6.32 c*6.38              elseif    y = 3
6.32 c*6.38              eval      ednlin = d_vlix03
6.32 c*6.38              elseif    y = 2
6.32 c*6.38              eval      ednlin = d_vlix02
6.32 c*6.38              else
6.32 c*6.38              eval      ednlin = d_vlix01
6.32 c*6.38              endif
      *
     c                   eval      edlvar = d_alt210
     c                   eval      ednobb = d_altx10
6.31 c                   if        x = 8
6.31 c                   eval      edgtin = d_eanx08
6.31 c                   elseif    x = 12
6.31 c                   eval      edgtin = d_eanx12
6.31 c                   elseif    x = 13
6.31 c                   eval      edgtin = d_eanx13
6.31 c                   else
6.31 c                   eval      edgtin = d_eanx14
6.31 c                   endif
     c                   eval      edvare = ndvare
     c                   eval      edtek1 = ndtek1
     c                   eval      edtek2 = ndtek2
     c                   eval      edanta = ndanta
     c                   eval      edenhe = d_benh12
     c                   eval      edntpr = ndntpr
     c                   eval      edlety = ndlety
     c                   eval      edldat = ndldat
     c                   eval      edmeld = ndmeld
      *
     c                   time                    edodat
     c                   time                    edotim
     c                   eval      edousr = l_user
     c                   time                    ededat
     c                   time                    edetim
     c                   eval      edeusr = l_user
     c                   write     eddtlur
     c                   else
     c                   time                    ededat
     c                   time                    edetim
     c                   eval      edeusr = l_user
     c                   update    eddtlur
     c                   endif
6.37  *
6.37  * Legg ut eventuelle tekstlinjer. Legges inn som
6.37  * påfølgende tekstlinjer.
6.37  *
6.37 c                   if        %trim(w_mel1) <> *blanks
6.37  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
6.37 c                   eval      edtxlu_tell = notell
6.37 c                   eval      edtxlu_ldor = 0
6.37 c                   eval      edtxlu_ldat = *loval
6.37 c                   eval      edtxlu_line = ndline
6.37 c                   eval      edtxlu_type = 'L'
6.37 c                   eval      edtxlu_tlin = 1
6.37 c     edtxlu_key    chain     edtxlur
6.37 c                   if        not %found
6.37 c                   clear                   edtxlur
6.37 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
6.37 c                   eval      ettell = notell
6.37 c                   eval      etldor = 0
6.37 c                   eval      etldat = *loval
6.37 c                   eval      etline = ndline
6.37 c                   eval      ettype = 'L'
6.37 c                   eval      ettlin = 1
6.37 c                   eval      ettek1 = %trim(w_mel1)
6.37  *
6.37 c                   time                    etodat
6.37 c                   time                    etotim
6.37 c                   eval      etousr = l_user
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   write     edtxlur
6.37 c                   else
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   update    edtxlur
6.37 c                   endif
6.37  *
6.37 c                   endif
6.37  *
6.37 c                   if        %trim(w_mel2) <> *blanks
6.37  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
6.37 c                   eval      edtxlu_tell = notell
6.37 c                   eval      edtxlu_ldor = 0
6.37 c                   eval      edtxlu_ldat = *loval
6.37 c                   eval      edtxlu_line = ndline
6.37 c                   eval      edtxlu_type = 'L'
6.37 c                   eval      edtxlu_tlin = 2
6.37 c     edtxlu_key    chain     edtxlur
6.37 c                   if        not %found
6.37 c                   clear                   edtxlur
6.37 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
6.37 c                   eval      ettell = notell
6.37 c                   eval      etldor = 0
6.37 c                   eval      etldat = *loval
6.37 c                   eval      etline = ndline
6.37 c                   eval      ettype = 'L'
6.37 c                   eval      ettlin = 2
6.37 c                   eval      ettek1 = %trim(w_mel2)
6.37  *
6.37 c                   time                    etodat
6.37 c                   time                    etotim
6.37 c                   eval      etousr = l_user
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   write     edtxlur
6.37 c                   else
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   update    edtxlur
6.37 c                   endif
6.37  *
6.37 c                   endif
6.37  *
6.37 c                   if        %trim(w_mel3) <> *blanks
6.37  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
6.37 c                   eval      edtxlu_tell = notell
6.37 c                   eval      edtxlu_ldor = 0
6.37 c                   eval      edtxlu_ldat = *loval
6.37 c                   eval      edtxlu_line = ndline
6.37 c                   eval      edtxlu_type = 'L'
6.37 c                   eval      edtxlu_tlin = 3
6.37 c     edtxlu_key    chain     edtxlur
6.37 c                   if        not %found
6.37 c                   clear                   edtxlur
6.37 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
6.37 c                   eval      ettell = notell
6.37 c                   eval      etldor = 0
6.37 c                   eval      etldat = *loval
6.37 c                   eval      etline = ndline
6.37 c                   eval      ettype = 'L'
6.37 c                   eval      ettlin = 3
6.37 c                   eval      ettek1 = %trim(w_mel3)
6.37  *
6.37 c                   time                    etodat
6.37 c                   time                    etotim
6.37 c                   eval      etousr = l_user
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   write     edtxlur
6.37 c                   else
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   update    edtxlur
6.37 c                   endif
6.37  *
6.37 c                   endif
6.37  *
6.37 c                   if        %trim(w_mel4) <> *blanks
6.37  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
6.37 c                   eval      edtxlu_tell = notell
6.37 c                   eval      edtxlu_ldor = 0
6.37 c                   eval      edtxlu_ldat = *loval
6.37 c                   eval      edtxlu_line = ndline
6.37 c                   eval      edtxlu_type = 'L'
6.37 c                   eval      edtxlu_tlin = 4
6.37 c     edtxlu_key    chain     edtxlur
6.37 c                   if        not %found
6.37 c                   clear                   edtxlur
6.37 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
6.37 c                   eval      ettell = notell
6.37 c                   eval      etldor = 0
6.37 c                   eval      etldat = *loval
6.37 c                   eval      etline = ndline
6.37 c                   eval      ettype = 'L'
6.37 c                   eval      ettlin = 4
6.37 c                   eval      ettek1 = %trim(w_mel4)
6.37  *
6.37 c                   time                    etodat
6.37 c                   time                    etotim
6.37 c                   eval      etousr = l_user
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   write     edtxlur
6.37 c                   else
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   update    edtxlur
6.37 c                   endif
6.37  *
6.37 c                   endif
6.37  *
6.37 c                   if        %trim(w_mel5) <> *blanks
6.37  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
6.37 c                   eval      edtxlu_tell = notell
6.37 c                   eval      edtxlu_ldor = 0
6.37 c                   eval      edtxlu_ldat = *loval
6.37 c                   eval      edtxlu_line = ndline
6.37 c                   eval      edtxlu_type = 'L'
6.37 c                   eval      edtxlu_tlin = 5
6.37 c     edtxlu_key    chain     edtxlur
6.37 c                   if        not %found
6.37 c                   clear                   edtxlur
6.37 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
6.37 c                   eval      ettell = notell
6.37 c                   eval      etldor = 0
6.37 c                   eval      etldat = *loval
6.37 c                   eval      etline = ndline
6.37 c                   eval      ettype = 'L'
6.37 c                   eval      ettlin = 5
6.37 c                   eval      ettek1 = %trim(w_mel5)
6.37  *
6.37 c                   time                    etodat
6.37 c                   time                    etotim
6.37 c                   eval      etousr = l_user
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   write     edtxlur
6.37 c                   else
6.37 c                   time                    etedat
6.37 c                   time                    etetim
6.37 c                   eval      eteusr = l_user
6.37 c                   update    edtxlur
6.37 c                   endif
6.37  *
6.37 c                   endif
7.05  *
7.05 c                   if        %trim(w_mel6) <> *blanks
7.05  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
7.05 c                   eval      edtxlu_tell = notell
7.05 c                   eval      edtxlu_ldor = 0
7.05 c                   eval      edtxlu_ldat = *loval
7.05 c                   eval      edtxlu_line = ndline
7.05 c                   eval      edtxlu_type = 'L'
7.05 c                   eval      edtxlu_tlin = 6
7.05 c     edtxlu_key    chain     edtxlur
7.05 c                   if        not %found
7.05 c                   clear                   edtxlur
7.05 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
7.05 c                   eval      ettell = notell
7.05 c                   eval      etldor = 0
7.05 c                   eval      etldat = *loval
7.05 c                   eval      etline = ndline
7.05 c                   eval      ettype = 'L'
7.05 c                   eval      ettlin = 6
7.05 c                   eval      ettek1 = %trim(w_mel6)
7.05  *
7.05 c                   time                    etodat
7.05 c                   time                    etotim
7.05 c                   eval      etousr = l_user
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   write     edtxlur
7.05 c                   else
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   update    edtxlur
7.05 c                   endif
7.05  *
7.05 c                   endif
7.05  *
7.05 c                   if        %trim(w_mel7) <> *blanks
7.05  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
7.05 c                   eval      edtxlu_tell = notell
7.05 c                   eval      edtxlu_ldor = 0
7.05 c                   eval      edtxlu_ldat = *loval
7.05 c                   eval      edtxlu_line = ndline
7.05 c                   eval      edtxlu_type = 'L'
7.05 c                   eval      edtxlu_tlin = 7
7.05 c     edtxlu_key    chain     edtxlur
7.05 c                   if        not %found
7.05 c                   clear                   edtxlur
7.05 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
7.05 c                   eval      ettell = notell
7.05 c                   eval      etldor = 0
7.05 c                   eval      etldat = *loval
7.05 c                   eval      etline = ndline
7.05 c                   eval      ettype = 'L'
7.05 c                   eval      ettlin = 7
7.05 c                   eval      ettek1 = %trim(w_mel7)
7.05  *
7.05 c                   time                    etodat
7.05 c                   time                    etotim
7.05 c                   eval      etousr = l_user
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   write     edtxlur
7.05 c                   else
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   update    edtxlur
7.05 c                   endif
7.05  *
7.05 c                   endif
7.05  *
7.05 c                   if        %trim(w_mel8) <> *blanks
7.05  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
7.05 c                   eval      edtxlu_tell = notell
7.05 c                   eval      edtxlu_ldor = 0
7.05 c                   eval      edtxlu_ldat = *loval
7.05 c                   eval      edtxlu_line = ndline
7.05 c                   eval      edtxlu_type = 'L'
7.05 c                   eval      edtxlu_tlin = 8
7.05 c     edtxlu_key    chain     edtxlur
7.05 c                   if        not %found
7.05 c                   clear                   edtxlur
7.05 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
7.05 c                   eval      ettell = notell
7.05 c                   eval      etldor = 0
7.05 c                   eval      etldat = *loval
7.05 c                   eval      etline = ndline
7.05 c                   eval      ettype = 'L'
7.05 c                   eval      ettlin = 8
7.05 c                   eval      ettek1 = %trim(w_mel8)
7.05  *
7.05 c                   time                    etodat
7.05 c                   time                    etotim
7.05 c                   eval      etousr = l_user
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   write     edtxlur
7.05 c                   else
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   update    edtxlur
7.05 c                   endif
7.05  *
7.05 c                   endif
7.05  *
7.05 c                   if        %trim(w_mel9) <> *blanks
7.05  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
7.05 c                   eval      edtxlu_tell = notell
7.05 c                   eval      edtxlu_ldor = 0
7.05 c                   eval      edtxlu_ldat = *loval
7.05 c                   eval      edtxlu_line = ndline
7.05 c                   eval      edtxlu_type = 'L'
7.05 c                   eval      edtxlu_tlin = 9
7.05 c     edtxlu_key    chain     edtxlur
7.05 c                   if        not %found
7.05 c                   clear                   edtxlur
7.05 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
7.05 c                   eval      ettell = notell
7.05 c                   eval      etldor = 0
7.05 c                   eval      etldat = *loval
7.05 c                   eval      etline = ndline
7.05 c                   eval      ettype = 'L'
7.05 c                   eval      ettlin = 9
7.05 c                   eval      ettek1 = %trim(w_mel9)
7.05  *
7.05 c                   time                    etodat
7.05 c                   time                    etotim
7.05 c                   eval      etousr = l_user
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   write     edtxlur
7.05 c                   else
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   update    edtxlur
7.05 c                   endif
7.05  *
7.05 c                   endif
7.05 c                   if        %trim(w_mel10) <> *blanks
7.05  *
7.12 c**                 eval      edtxlu_fsys = c_fsys
7.12 c                   eval      edtxlu_fsys = w_fsys
7.05 c                   eval      edtxlu_tell = notell
7.05 c                   eval      edtxlu_ldor = 0
7.05 c                   eval      edtxlu_ldat = *loval
7.05 c                   eval      edtxlu_line = ndline
7.05 c                   eval      edtxlu_type = 'L'
7.05 c                   eval      edtxlu_tlin = 10
7.05 c     edtxlu_key    chain     edtxlur
7.05 c                   if        not %found
7.05 c                   clear                   edtxlur
7.05 c                   eval      etfirm = w_firm
7.12 c**                 eval      etfsys = c_fsys
7.12 c                   eval      etfsys = w_fsys
7.05 c                   eval      ettell = notell
7.05 c                   eval      etldor = 0
7.05 c                   eval      etldat = *loval
7.05 c                   eval      etline = ndline
7.05 c                   eval      ettype = 'L'
7.05 c                   eval      ettlin = 10
7.05 c                   eval      ettek1 = %trim(w_mel10)
7.05  *
7.05 c                   time                    etodat
7.05 c                   time                    etotim
7.05 c                   eval      etousr = l_user
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   write     edtxlur
7.05 c                   else
7.05 c                   time                    etedat
7.05 c                   time                    etetim
7.05 c                   eval      eteusr = l_user
7.05 c                   update    edtxlur
7.05 c                   endif
7.05  *
7.05 c                   endif
      *
     c                   eval      b_blin = *off
     c                   eval      ndvare = *blanks
     c                   eval      ndenhe = *blanks
     c                   eval      ndanta = 0
6.31 c                   eval      x = 0
6.32 c                   eval      y = 0
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for å nullstille ordre hode
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     null_hbest    begsr
      *
     c                   clear                   d_ed01
     c                   clear                   d_ed02
     c                   clear                   d_ed03
7.03 c                   clear                   w_ed03
     c                   clear                   d_ed04
     c                   clear                   d_ed05
     c                   clear                   d_ed06
     c                   clear                   d_ed07
     c                   clear                   d_ed08
     c                   clear                   d_ed09
      *
     c                   eval      nofirm = w_firm
     c                   eval      nonref = *blank
     c                   eval      nolage = 0
     c                   eval      nouser = *blank
     c                   eval      nokund = 0
8.06 c                   eval      noknav = *blanks
8.06 c                   eval      nonavn = *blanks
8.06 c                   eval      noadr1 = *blanks
8.06 c                   eval      noadr2 = *blanks
8.06 c                   eval      noponr = *blanks
8.06 c                   eval      nosted = *blanks
8.06 c                   eval      nodref = *blanks
8.06 c                   eval      nolass = 0
     c                   eval      nokpro = 0
     c                   eval      nolety = 0
     c                   eval      noldat = *loval
     c                   eval      nonumm = 0
     c                   eval      nomeld = *blank
8.06 c                   eval      norekv = *blank
     c                   eval      s_line = 0
     c                   eval      w_dpgl = 0
     c                   eval      w_ivgl = 0
     c                   eval      w_bygl = 0
6.37 c                   eval      w_mel1 = *blanks
6.37 c                   eval      w_mel2 = *blanks
6.37 c                   eval      w_mel3 = *blanks
6.37 c                   eval      w_mel4 = *blanks
6.37 c                   eval      w_mel5 = *blanks
7.05 c                   eval      w_mel6 = *blanks
7.05 c                   eval      w_mel7 = *blanks
7.05 c                   eval      w_mel8 = *blanks
7.05 c                   eval      w_mel9 = *blanks
7.05 c                   eval      w_mel10 = *blanks
7.01 c                   eval      w_prnr = *blanks
7.03 c                   eval      w_ldat = *loval
7.04 c                   eval      w_aepn = *blanks
7.04 c                   eval      w_rekv = *blanks
7.06 c                   eval      w_fsys = c_fsys
      *
     c                   time                    nobdat
     c                   time                    noodat
     c                   time                    nootim
     c                   time                    noedat
     c                   time                    noetim
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for å nullstille ordre linje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     null_lbest    begsr
      *
     c                   clear                   d_ed10
     c                   clear                   d_ed11
     c                   clear                   d_ed12
     c                   clear                   d_ed13
      *
     c                   eval      ndfirm = w_firm
     c                   eval      ndanta = 0
     c                   eval      ndntpr = 0
     c                   eval      ndlety = 0
     c                   eval      ndldat = *loval
      *
6.37 c                   eval      w_mel1 = *blanks
6.37 c                   eval      w_mel2 = *blanks
6.37 c                   eval      w_mel3 = *blanks
6.37 c                   eval      w_mel4 = *blanks
6.37 c                   eval      w_mel5 = *blanks
7.05 c                   eval      w_mel6 = *blanks
7.05 c                   eval      w_mel7 = *blanks
7.05 c                   eval      w_mel8 = *blanks
7.05 c                   eval      w_mel9 = *blanks
7.05 c                   eval      w_mel10 = *blanks
      *
     c                   time                    ndodat
     c                   time                    ndedat
     c                   time                    ndetim
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for å hente/oppdatere meldingsnummer for EDI/ordre inn
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_mnum     begsr
      *
     c                   eval      w_kode = '0'
6.30 c**                 eval      w_fell = 'FEDIIN'
6.30 c                   eval      w_fell = 'FNETTB'
     c                   eval      w_type = *blank
     c                   eval      w_fast = *blank
     c                   eval      w_mnum = 0
      *
      *  Kaller opp subprogram for henting av nummer fra NUMMER-REGISTER
      *
     c                   call      'AS100R'
     c                   parm                    w_kode
     c                   parm                    w_firm
     c                   parm                    w_fell
     c                   parm                    w_type
     c                   parm                    w_fast
     c                   parm                    w_mnum
      *
7.06 c                   eval      w_fsys = c_fsys
     c                   eval      notell = w_mnum
      *
     c     end_mnum      endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å sende melding til ordrebehandlere
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     send_melding  begsr
      *
7.14  * Reaktivert kode for sending av mail til ordremottaker
      *
7.16  * Hent info fra lager
7.16 c                   eval      rajtxt = *blanks
7.16 c                   if        nolage <> 0
7.16 c                   eval      ra10l1_jkod = nolage
7.16 c     ra10l1_key    chain     ra10l1
7.16 c                   if        not %found
7.16 c                   eval      rajtxt = *blanks
7.16 c                   endif
7.16 c                   endif
7.16  * Hent info fra avdeling
7.16 c                   eval      ragtxt = *blanks
7.16 c                   if        noavde <> 0
7.16 c                   eval      ra07l1_gkod = noavde
7.16 c     ra07l1_key    chain     ra07l1
7.16 c                   if        not %found
7.16 c                   eval      ragtxt = *blanks
7.16 c                   endif
7.16 c                   endif
7.16  *
     c                   eval      p_rec1 = p_emal
     c                   eval      p_rec2 = *blanks
     c                   eval      p_rec3 = *blanks
7.14 c                   eval      p_send = afudss
7.16 c                   eval      p_subj = 'Ny nettbutikk ordre med ref.nr ' +
7.16 c                             %char(notell)
7.16 c                   eval      p_txt1 = 'Lager: ' + %char(nolage) + ', ' +
7.16 c                             %trim(rajtxt)
7.16 c                   eval      p_txt2 = 'Avdeling: ' + %char(noavde) + ', '+
7.16 c                             %trim(ragtxt)
7.16 c                   eval      p_txt3 = 'Kunde: ' + %char(nokund) + ', ' +
7.16 c                             %trim(nonavn)
7.16 c                   eval      p_txt4 = 'Kundens referanse: ' +
7.16 c                             %trim(nodref)
7.16 c                   eval      p_avsl = 'Gå til eksterne ordrer for å +
7.16 c                             importere som ordre'
      *
     c                   call      'AF726R'
     c                   parm                    p_rec1
     c                   parm                    p_rec2
     c                   parm                    p_rec3
     c                   parm                    p_send
     c                   parm                    p_subj
     c                   parm                    p_txt1
     c                   parm                    p_txt2
     c                   parm                    p_txt3
     c                   parm                    p_txt4
     c                   parm                    p_avsl
      *
     c                   endsr
      *
6.33  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.33  * ERROR-rutine
6.33  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.33  *
6.33 c     *pssr         begsr
6.33  *
6.33  *  Prøv å logge hvilken bestilling det er problemer med
6.33  *
6.33 c                   eval      eloglu_faar = w_year
6.33 c                   eval      eloglu_type = w_type
6.33 c                   move      w_eann        eloglu_lean
7.07 c**                 eval      eloglu_refn = w_refn
7.07 c                   eval      eloglu_refn = nonref
6.33 c     eloglu_key    chain     eloglu
6.33 c                   eval      w_meld = %trim(beslin)
6.33 c                   if        %found
6.33 c                   eval      xlstat = '20'
6.33 c                   eval      xleror = 'ER'
6.33 c                   eval      xlmerk = w_meld
6.33 c                   update    eloglur
6.33 c                   else
6.33 c                   eval      xlfaar = w_year
6.33 c                   eval      xltype = w_type
6.33 c                   move      w_eann        xllean
7.07 c**                 eval      xlrefn = w_refn
7.07 c                   eval      xlrefn = nonref
6.33 c                   eval      xllevn = 0
6.33 c                   eval      xlmda1 = w_udat
6.33 c                   eval      xlmti1 = w_utim
6.33 c                   eval      xlmott = 1
6.33 c                   eval      xlspli = 0
6.33 c                   eval      xlovrf = 0
6.33 c                   eval      xlstat = '20'
6.33 c                   eval      xleror = 'ER'
6.33 c                   eval      xlmerk = w_meld
6.33 c                   time                    xlodat
6.33 c                   time                    xlotim
6.33 c                   eval      xlousr = l_user
6.33 c                   write     eloglur
6.33 c                   endif
6.33  *
6.33 c                   eval      b_feil = *on
6.33 c                   eval      p_eror = 'E'
6.33 c                   goto      neste_lweb
6.33  *
6.33 c                   endsr
6.33  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
6.33  *
6.33  * Parameterliste
6.33  *
6.33 c     *entry        plist
6.33 c                   parm                    p_eror
      *
      * Key for lesing av ordrehode/forsyst.
      *
     c     nohelu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nohelu_fsys
     c                   kfld                    nohelu_tell
      *
      * Key for lesing av ordrelinje/forsyst.
      *
     c     nodtlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    nodtlu_fsys
     c                   kfld                    nodtlu_tell
     c                   kfld                    nodtlu_line
      *
      * Key for lesing av ordrehode/forsyst - kopi
      *
     c     edhelu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    edhelu_fsys
     c                   kfld                    edhelu_tell
      *
      * Key for lesing av ordrelinje/forsyst.
      *
     c     eddtlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    eddtlu_fsys
     c                   kfld                    eddtlu_tell
6.35 c                   kfld                    eddtlu_ldor
6.35 c                   kfld                    eddtlu_ldat
     c                   kfld                    eddtlu_line
6.37  *
6.37  * Key for lesing av ordrelinje/tekstlinjer
6.37  *
6.37 c     edtxlu_key    klist
6.37 c                   kfld                    w_firm
6.37 c                   kfld                    edtxlu_fsys
6.37 c                   kfld                    edtxlu_tell
6.37 c                   kfld                    edtxlu_ldor
6.37 c                   kfld                    edtxlu_ldat
6.37 c                   kfld                    edtxlu_line
6.37 c                   kfld                    edtxlu_type
6.37 c                   kfld                    edtxlu_tlin
      *
      * Key for posisjonering på nobb-nummer
      *
     c     vvarl3_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl3_nobb
      *
      * Key for posisjonering på leverandørens-varenummer
      *
     c     vvarl4_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl4_lvar
      *
      * Key for oppslag på kunde-register (EAN)
      *
     c     rkunl5_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl5_eank
      *
      * Key for oppslag på kunde-register (foretaksnummer)
      *
     c     rkunl4_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl4_ftnr
6.33  *
6.33  *  Key for oppdatering av LOGFIL
6.33  *
6.33 c     eloglu_key    klist
6.33 c                   kfld                    w_firm
6.33 c                   kfld                    eloglu_faar
6.33 c                   kfld                    eloglu_type
6.33 c                   kfld                    eloglu_lean
6.33 c                   kfld                    eloglu_refn
7.01  *
7.01  * Key for lesing av kundeprosjekt
7.01  *
7.01 c     fkprl6_key    klist
7.01 c                   kfld                    w_firm
7.01 c                   kfld                    fkprl6_epro
7.01 c                   kfld                    fkprl6_kund
7.08  *
7.08  * Key for oppslag på logistikkpunkt
7.08  *
7.08 c     mjlol2_key    klist
7.08 c                   kfld                    w_firm
7.08 c                   kfld                    mjlol2_eann
7.08  *
7.08  * Key for posisjonering på firma
7.08  *
7.08 c     afirl1_key    klist
7.08 c                   kfld                    w_firm
7.08  *
7.08  * Key for posisjonering på nettbutikk
7.08  *
7.08 c     anbll1_key    klist
7.08 c                   kfld                    anbll1_leie
7.08 c                   kfld                    anbll1_lbut
7.10  *
7.10  * Key for posisjonering på firma
7.10  *
7.10 c     raa8l1_key    klist
7.10 c                   kfld                    w_firm
7.14  *
7.14  * Key for oppslag på ofak-bruker
7.14  *
7.14 c     fusrl1_key    klist
7.14 c                   kfld                    w_firm
7.14  *
7.14  * Key for file : GPL-BRUKER-REGISTER
7.14  *
7.14 c     ausrl1_key    klist
7.14 c                   kfld                    ausrl1_user
7.14  *
7.14  * Key for properties
7.14  *
7.14 c     afpslr_key    klist
7.14 c                   kfld                    afpslr_ufil
7.14 c                   kfld                    afpslr_uide
7.16  *
7.16  * Key for oppslag på lager
7.16  *
7.16 c     ra10l1_key    klist
7.16 c                   kfld                    w_firm
7.16 c                   kfld                    ra10l1_jkod
7.16  *
7.16  * Key for oppslag på avdeling
7.16  *
7.16 c     ra07l1_key    klist
7.16 c                   kfld                    w_firm
7.16 c                   kfld                    ra07l1_gkod
7.17  *
7.17  * Key for oppslag på kunder
7.17  *
7.17 c     rkunl1_key    klist
7.17 c                   kfld                    w_firm
7.17 c                   kfld                    rkunl1_kund
      *
      *  Legger inn firmanummer
      *
     c                   eval      w_firm = l_firm
      *
      *  Legger inn "current" dato og tid
      *
     c                   time                    w_date
     c                   time                    w_time
      *
7.08 c     afirl1_key    chain     afirl1
8.03  *
8.03  * Slå opp mot e-handels informasjon
8.03  *
8.03 c     raa8l1_key    chain     raa8l1
7.10  *
7.10  * Finn leveringsmåte fra default oppsett på nettbutikk.
7.10  *
7.10 c                   eval      w_hkod = 0
7.10 c                   eval      w_lkod = 0
      *
7.10 c                   movel     aafftn        anbll1_leie
7.10 c                   movel     ra8ean        anbll1_lbut
7.10 c     anbll1_key    chain     anbll1
7.10 c                   if        %found
7.10 c                   eval      w_hkod = aohkod
7.10 c                   eval      w_lkod = aolkod
7.10 c                   endif
7.14  *
7.14  * Hent avsender til mail
7.14  *
7.14  * henter mailadresse fra
7.14 c                   eval      afpslr_ufil = l_filg
7.14 c                   eval      afpslr_uide = 'NOMAIL   '
7.14 c     afpslr_key    chain     afpslr
7.14 c                   if        not %found
7.14 c                   eval      afudss = *blanks
7.14 c                   endif
7.18  *
7.18  * Styrer om avdeling hentes fra lager
7.18  *
7.18   CallP CO402R(l_filg:w_firm:0:'LI704_718':
7.18                    co402_verdi1:co402_verdi2);
7.18   if co402_verdi1 = '1';
7.18     u_718 = *on;
7.18   endif;
8.01  *
8.01  * Hvis koden er satt, skal mailsending kun begrenses til
8.01  * brukere på angitt lager/avdeling.
8.01  *
8.01   CallP CO402R(l_filg:w_firm:0:'LI704_801':
8.01                    co402_verdi1:co402_verdi2);
8.01   if co402_verdi1 = '1';
8.01     u_801 = *on;
8.01   endif;
      *
     c                   endsr
