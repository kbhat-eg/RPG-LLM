# RPG Program VT110R - Maintenance of Offer Prices for Items

This RPG source code implements an interactive maintenance program for offer prices related to items (varer). It supports viewing, adding, updating, deleting, and copying offer price records. The code uses subfiles and multiple record-level access paths for flexible record positioning and fast user navigation.

---

## High-Level Structure

- **Header (`h`)**: Sets program options (e.g., date format, debug).
- **File Specs (`f`)**: Declares physical and logical files, display files with subfile (SFL), and feedback data structure (`infds`).
- **Data Definitions (`d`)**: Local variables, data structures, constants, including fields for subfile navigation and records.
- **Keylists (`klist`)**: Reusable sets of key fields for indexed file access.
- **Mainline + Subroutines (`c`)**: Program flow, screen handling, and business logic organized as subroutines.

---

## File and Data Structure Overview

### Files

- **vtillr, vtillu, vtill1..vtill6**: Main files for offer prices, with multiple logical views (for positioning on various fields).
- **vvarl1, vltpl1, ra30l1, venhl1**: Item, delivery type, price group, unit master files.
- **vt110d**: Display file with subfiles for item offers.

### Main Data Elements

- **Parameter variables**: `p_firm` (company), `p_vare` (item).
- **Subfile navigation**: `w_fcrn`, `w_srrn`, `w_ssrn`, etc.
- **Selection fields for positioning**: `b2lety` (delivery type), `b2prgr` (price group), `b2fdat` (from date), etc.
- **Data structures**: For feedback from display file, and overlays for record keys.

---

## Program Flow Breakdown

### 1. **Initialization (`*inzsr`)**

- Reads parameters (company, item).
- Loads item description.
- Sets up the initial subfile (list) with records for the selected item.

### 2. **Main Screen Handling**

- Entry point handles screen display and user function key actions:
    - F3/F12: Exit.
    - F4: Inquiry (calls subroutine).
    - F5: Refresh/reload subfile.
    - F6: Add new entry (calls `xc1bld`).
    - SFLROLL/SFLROLLED: Page navigation.
    - Home: Cursor positioning.
    - Handles filtering/positioning on various fields (delivery type, price group, dates, campaign).
- Calls subfile handling routines that interpret user actions (change, copy, delete, view).

### 3. **Subfile Management**

- **Creating Subfiles (`crt_subfile`)**: Loads records into the subfile, according to current positioning mode.
- **Clearing Subfile (`clr_subfile`)**: Blanks subfile (for refresh or after positioning).
- **Back-Paging (`bck_subfile`)**: Reads previous block of records.
- **Display (`dsp_subfile`)**: Manages actual subfile display, including focus.
- **Navigation and Filtering (`posisjoner`)**: Positions record pointer for next subfile load, based on user filter criteria.

### 4. **CRUD Operations**

- **Create/Update (`xc2bld`)**:
    - Edits or creates a record.
    - Validates input (unit, dates, price group).
    - Calls price calculation/maintenance program (`VP715R`).
    - Updates subfile and the underlying files.
- **Copy (`xk1win`)**: Prepares a new record using data from a selected record by copying and letting the user adjust fields.
- **Delete (`xd1win`)**: Shows confirmation window, then deletes the record.
- **View**: Opens a record in view-only mode.

### 5. **Input/Field Validation (`sjekk_input`)**

- Ensures all required fields are entered.
- Validates that date and time ranges are logical.
- Validates existence of referenced units, price group, delivery type, etc.

### 6. **Inquiry/Look-up Support (`sp√∏rring`)**

- Context-sensitive field look-up for price group, delivery type (calls external programs for lookup and description).
- Updates descriptions on screen after inquiry.

### 7. **Description Fetching (`hent_info`)**

- Loads item, price group, and delivery type descriptions for display.

---

## Special Handling and Comments

- **Indicator Usage**: The program uses standard RPG indicators for user interface control, error flagging, and workflow (e.g., `*IN10` for SFLROLL, `*INLR` for end-of-program).
- **Subfile Paging**: Uses counter variables to keep track of logical page position and record relative numbers.
- **External Calls**:
    - To other maintenance and lookup programs, e.g., `VP715R` (price maintenance), `VE550R` (unit lookup), `RA530R` (price group lookup), `VY500R` (delivery type lookup).
- **Multi-key Positioning**: Allows smart navigation in the subfile by various fields (e.g., by item, delivery type, price group, dates, etc).
- **Support for Extended Price Group**: Comments marked `5.70` and `8.01` correspond to enhancements (e.g., price group expanded from 1 to 2 characters).

---

## User Actions Overview

- **Display a list of offer prices for an item.**
- **Filter records by delivery type, price group, dates, or campaign, and quickly reposition subfile.**
- **Add, edit, delete, or copy offer price records, with validation and confirmation.**
- **Invoke look-ups for price group, delivery type, and units for data accuracy.**
- **View item-level and offer-level information, including history and audit information.**

---

## Sample Workflow

1. **Program is called** with item and company as parameters.
2. **Subfile is initialized** showing existing offers for the item.
3. **User navigates** the list, pages through records, applies filters as needed.
4. **User adds a new offer** with `F6`, enters details, and saves after validation.
5. **User changes/copies/deletes** records directly via subfile options.
6. **Lookups and validations** ensure master data consistency and correct date spans.
7. **User exits** using `F3` or `F12`; program closes files and ends.

---

## Key Takeaways

- The program is a robust, user-interactive RPG application leveraging subfiles for easy maintenance of complex, multi-keyed records (offer prices per item).
- It is highly modular, with clear separation between input handling, record management, and validation.
- Special attention is given to user experience: fast navigation, context-sensitive lookups, and multi-field filtering.

---

## Extensibility

- Modular subroutines make it straightforward to add additional positioning criteria or validations.
- Logical files on offer prices facilitate various access patterns for scalability.
- Business rules/validations are encapsulated and easy to maintain.

---

### If you need information about a particular subroutine or logic block, please specify!