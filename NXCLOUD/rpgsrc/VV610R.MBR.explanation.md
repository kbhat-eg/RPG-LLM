## VV610R – Documentation

### Purpose

**VV610R** is an interactive RPG program designed for parameter entry and validation related to "dekningskontroll" (coverage control) for items ("Vare"). The program collects and verifies user input for groupings (overgruppe, hovedgruppe, undergruppe) and a date, then packages the parameters and calls a transfer program (`VV610C`). The program also supports interactive inquiries for group information via subprograms.

---

### Structure Overview

- **Physical Files:**  
  - `vogrl1` (overgruppe)
  - `vhgrl1` (hovedgruppe)
  - `vugrl1` (undergruppe)  
  These files are renamed from their corresponding physical files and used for group validation.
- **Display File:**  
  - `vv610d` – The workstation file for user interaction.

- **Local Data Area:**  
  - Used for retrieving the company number (`l_firm`).

- **Parameter Data Structure:**  
  - `d_list` is a 32-byte structure containing all parameters to be sent to the transfer program.

- **Key Variables:**  
  - Variables for building composite keys for group file lookups.

- **Main Logic:**  
  - Display parameter entry screen.
  - Handle function keys (exit, inquiry).
  - Validate input fields.
  - Build parameter list and call transfer program.
  - Loop or exit as appropriate.

- **Subroutines:**  
  - `spørring` – Handles group inquiries.
  - `sjekk_inp` – Validates user input.
  - `*inzsr` – Initialization logic.

---

### Business/Domain Logic

#### Group Structure

- **Overgruppe (Ogrp):** Top-level group for items.
- **Hovedgruppe (Hgrp):** Main group, subordinate to overgruppe.
- **Undergruppe (Ugrp):** Subgroup, subordinate to hovedgruppe.
- **Firm:** Company number, read from the LDA.

The program ensures that any group code entered by the user exists in the corresponding master file. If not, it flags an error and highlights the relevant field.

#### Parameter Packaging

- All validated input is overlaid into `d_list` and passed to `VV610C`. The structure includes:
  - `d_firm`: Company number (positions 1–3)
  - `d_ogrp`: Overgruppe (positions 4–5)
  - `d_hgrp`: Hovedgruppe (positions 6–7)
  - `d_ugrp`: Undergruppe (positions 8–10)
  - `d_dato`: Date (positions 11–...)

#### Inquiries

- The user can press a function key to invoke an inquiry for each group level:
  - `VG510R` for overgruppe
  - `VG511R` for hovedgruppe
  - `VG512R` for undergruppe

Each inquiry subprogram receives the relevant group codes and returns descriptive text.

#### Error Handling

- If a group code is invalid (not found in the master file), a specific indicator is set (`*in31`, `*in32`, `*in33`), and `b_feil` is set to `*on` to block further processing.
- Dates are checked for validity using `test(d)`. If invalid, `*in34` is set, and `b_feil` is turned on.

---

### Design Decisions & Conventions

- **Key Lists (`klist`):**  
  Defined in `*inzsr` for each group level, using company number plus group codes. This standardizes file lookups.

- **Data Overlay:**  
  The parameter structure (`d_list`) uses overlays for packing/unpacking fields efficiently for inter-program communication.

- **Error Indicators:**  
  Uses indicator lights (`*in31`, `*in32`, `*in33`, `*in34`, `*in90`) to signal field-specific or general errors for the display file.

- **Field Initialization:**  
  Date fields are initialized with the current system date if not provided.

- **Function Key Handling:**  
  Function keys are used for exit (`*inkc`, `*inkl`), inquiry (`*inkd`), and standard navigation.

- **Language/Localization:**  
  Some field and comment names are in Norwegian (e.g., "Beskrivelse", "Overgruppe"), reflecting the business context.

---

### Interactions with Other Modules

- **VV610C:**  
  The transfer program, called with the packed parameter list. It likely performs the main business process (not shown here).

- **VG510R / VG511R / VG512R:**  
  Inquiry programs for group lookups, called as needed during user interaction.

---

### Key Sections Explained

#### Initialization (`*inzsr`)

- Sets up key lists for file lookups.
- Reads the company number from LDA.
- Initializes the date field with the current date.

#### Main Screen Loop

- Displays the entry screen (`exfmt b1bld`).
- Handles function keys for exit and inquiries.
- Calls input validation (`sjekk_inp`).
- On successful validation, builds the parameter list and calls `VV610C`.

#### Input Validation (`sjekk_inp`)

- Validates each group code by chaining to the respective master file.
- If a code is invalid, sets error indicators and blocks further processing.
- Checks and initializes the date field as needed, including format validation.

#### Inquiry Handling (`spørring`)

- Depending on the active field (`w_afld`), calls the appropriate inquiry subprogram.
- Resets dependent group fields when higher-level group changes.

---

### Summary

VV610R is a parameter entry and validation front-end for item coverage control, ensuring group codes and dates are valid before passing them to the main business process. It enforces strict validation against master files and provides inquiry functionality to assist the user. The design is modular, with clear separation between validation, inquiry, and parameter transfer, and uses standard RPG conventions for error handling and inter-program communication.