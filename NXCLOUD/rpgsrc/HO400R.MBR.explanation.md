# RPG Program HO400R Explanation

This program is written in IBM ILE RPG and is designed for deleting “picked” order transactions sent from a handheld terminal, based on a given reference (håndterminal = handheld terminal). The main function is to remove both header and detail file records for a specific company ('firm') and reference ('refn') from two physical files.

---

## **1. File Specifications**

```rpg
fhohelu    uf   e           k disk    rename(hohepfr:hohelur)
fhodtlu    uf   e           k disk    rename(hodtpfr:hodtlur)
```
- **fhohelu**: File for order headers. Renames external file `hohepfr` to local name `hohelur`.
- **fhodtlu**: File for order lines/details. Renames `hodtpfr` to `hodtlur`.
- Both files are user-opened (`u`), full procedural (`f`), externally described (`e`), keyed (`k`), and disk-resident.

---

## **2. Parameter Definitions**

```rpg
d p_firm          s                   like(hofirm)
d p_refn          s                   like(horefn)
```
- `p_firm`, `p_refn`: Parameters for company and reference passed into the program, using the same types as fields `hofirm` and `horefn` in the files.

---

## **3. Working Variables**

```rpg
d w_firm          s                   like(hofirm)
d w_refn          s                   like(horefn)
```
- Local working variables for company and reference.

---

## **4. Main Logic (C-Specs)**

### **Initialization & Parameter Handling**
- The *INZSR subroutine* sets up the program:
    - Receives `p_firm` and `p_refn` from the caller.
    - Sets up keyed lists (`KLIST`) for locating records by `w_firm` and `w_refn`.
    - Copies parameter values into work variables.

---

### **Delete Header Record**

```rpg
c     hohelu_key    chain     hohelur                            90
c                   if        *in90 = *off and
c                             hostat = 1
c                   delete    hohelur
```
- `chain` retrieves the order header by key (`hohelu_key`). If record exists (`*in90 = *off`) and status is 1 (`hostat = 1` indicates "picked" status), the record gets deleted.

---

### **Delete Order Line Records**

```rpg
c     hodtlu_key    setll     hodtlu
c     hodtlu_key    reade     hodtlur                                91
c                   dow       *in91 = *off
c                   delete    hodtlur
c     hodtlu_key    reade     hodtlur                                91
c                   enddo
```
- `setll` positions to the first detail record for the given key.
- `reade` fetches sequential records matching the key.
- In the loop, all matching records are deleted.

---

### **End of Program**

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- `*inlr = *on` marks the last record for cleanup and closes files.
- `return` exits the program.

---

## **5. Subroutine for Initialization**

```rpg
c     *inzsr        begsr
c     *entry        plist
c                   parm                    p_firm
c                   parm                    p_refn
```
- *INZSR (initialization subroutine)*
    - Handles program entry and parameter mapping.
    - Defines key lists for both files (header and detail).
    - Moves parameters into working variables for use in main logic.

---

## **6. General Flow**

1. **Initialization:** Receives the `firm` and `refn` parameters.
2. **Header Delete:** Searches for an order header matching keys, deletes if status allows.
3. **Detail Delete:** Loops through all matching detail/order-line records and deletes them.
4. **End:** Cleans up and exits.

---

## **7. Purpose and Business Logic**

- The program is used to remove all transactions (both header and lines) in the handheld terminal files for a specific company and reference once they have been processed/picked (`hostat = 1`).
- Ensures referential integrity and data cleanliness by cleaning both header and related detail records.

---

## **Comments and Structure**

- The program is well-commented, using Norwegian for business descriptions.
- Change history and system references are included for audit.

---

### **Summary Table**

| Section         | Purpose                                                |
|-----------------|-------------------------------------------------------|
| File Specs      | Link program to external data files (order hdr/lines) |
| Parameter Defs  | Define incoming company/refn parameters               |
| Variables       | Local work storage                                    |
| Initialization  | Assign parameters, setup keys                         |
| Header Delete   | Remove header if picked                               |
| Line Delete     | Remove all matching detail lines                      |
| End             | Program cleanup and exit                              |