# RPG Program Explanation

This RPG program (NN899R) is designed for IBM i (AS/400) systems. Its purpose is to retrieve warehouse (`lager`) information for a customer. Below is a detailed walkthrough of the code:

---

## 1. Header and Metadata

```rpg
h option(*nodebugio) datedit(*dmy)
```
- **`h option(*nodebugio)`:** Disables debug input/output for performance.
- **`datedit(*dmy)`:** Sets default date format to day-month-year.

The comment block provides program metadata, system info (ASOFAK), program name (NN899R), description (Fetches warehouse for customer), and change history.

---

## 2. File Definition

```rpg
frkunl1    if   e           k disk    rename(rkunpfr:fkunl1r)
```
- **f-spec for file `rkunl1`**: Input file, externally described, keyed access, used for disk operations.
- **Renamed record format**: `rkunpfr` is renamed as `fkunl1r` in this program for clarity or avoidance of conflicts.

---

## 3. Data Definitions (D-spec)

### Program Parameters

```rpg
d p_kund          s              6  0
d p_lage          s              2
d p_avde          s              4
```
- `p_kund`: Customer number (6 digits, no decimals).
- `p_lage`: Warehouse/Storage code (2 chars).
- `p_avde`: Department code (4 chars).

### LDA (Local Data Area) Usage

```rpg
5.70 d                uds
5.70 d l_sfir                944    946  0
```
- `l_sfir`: Reads 3 bytes from the user data area (LDA), positions 944-946, typically holding firm/company number.

### Key Variables

```rpg
d rkunl1_kund     s                   like(rkkund)
```
- `rkunl1_kund`: Local variable, same type as key field `rkkund` in file.

### Additional Variables

```rpg
d w_firm          s                   like(rkfirm)
```
- `w_firm`: Local variable, same type as field `rkfirm` in file.

---

## 4. Mainline Logic

### Variable Initialization and Chain Lookup

```rpg
c                   eval      w_firm = l_sfir
c                   eval      rkunl1_kund = p_kund
c     rkunl1_key    chain     rkunl1
```
- Assigns company number from LDA to `w_firm`.
- Assigns program input customer number to local key variable.
- Performs a **keyed lookup** (`chain`) into `rkunl1` file using a key list (`rkunl1_key`, see below).

### Found/Not Found Logic

```rpg
c                   if        %found
c                   move      rklagr        p_lage
c                   move      rkavde        p_avde
c                   else
c                   move      '00'          p_lage
c                   move      '0000'        p_avde
c                   endif
```
- **If record found:**  
  - Moves warehouse (`rklagr`) and department (`rkavde`) fields from the file record to output parameters.
- **If not found:**  
  - Sets warehouse and department codes to default '00' and '0000'.

---

## 5. Program Termination

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- `*inlr = *on`: Closes the file(s) and ends the program (last record processing).
- `return`: Exits the program.

---

## 6. Subroutine: *INZSR (Initialization Subroutine)

```rpg
c     *inzsr        begsr
* Parameter
c     *entry        plist
c                   parm                    p_kund
c                   parm                    p_lage
c                   parm                    p_avde
* Key for les Kunde
c     rkunl1_key    klist
c                   kfld                    w_firm
c                   kfld                    rkunl1_kund
c                   endsr
```
- The **`*INZSR` subroutine** runs once at program start:
  - Defines program parameters (*entry plist): maps `p_kund`, `p_lage`, and `p_avde` for external calls.
  - Sets up a **key list (`rkunl1_key`)** for lookup: consists of `w_firm` (company) and `rkunl1_kund` (customer).

---

## 7. Summary

- **Purpose**: Looks up warehouse and department code for a given customer and company.
- **Inputs**: `p_kund` (customer number).
- **Outputs**: `p_lage` (warehouse), `p_avde` (department).  
  If not found, returns defaults ('00', '0000').
- **Logic**:
  1. Read company from LDA.
  2. Prepare key.
  3. CHAIN lookup in the customer register.
  4. Set output values.
  5. Terminate.

---

This program is a typical RPG "subroutine" callable from other programs (or CL), providing external code with warehouse and department for a given customer.