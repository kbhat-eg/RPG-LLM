# Overview  
This ILE RPG program (`VP600R`) drives a display screen for selecting price‐book print parameters and then calls the print program (`VP600C`) with those parameters.  

---

# 1. H-Specification  
- `option(*nodebugio)`  
- `datedit(*dmy)`  
  · Use DMY date format editing.  

---

# 2. File Declarations (F-Specs)  
• **Keyed files (all externally described):**  
  - `vshel1` ← `vshepfr` (item-master header)  
  - `vogrl1` ← `vogrpfr` (overgroup)  
  - `vhgrl1` ← `vhgrpfr` (main group)  
  - `vugrl1` ← `vugrpfr` (subgroup)  
  - `vltpl1` ← `vltppfr` (delivery type)  
  - `rlevl1` ← `rlevpfr` (vendor)  
• **Workstation:**  
  - `vP600D` as display file  

---

# 3. Data Definitions (D-Specs)  
1. **Local Data Area (UDS)**  
   - `l_firm` (3,0) ← firm code passed in via UDS.  
2. **Parameter List Structure (`d_list`, 64 bytes)**  
   Overlayed fields:  
   - `d_firm` (3)  
   - `d_vsor` (10) – product range  
   - `d_ogrp` (2) – over-group  
   - `d_hgrp` (2) – main group  
   - `d_ugrp` (3) – sub group  
   - `d_ldor` (6) – vendor  
   - `d_sval`, `d_tval`, `d_rval`, `d_2val`, `d_lval` (1 each) – print‐flag parameters  
   - `d_lety` (1) – delivery type  
   - `d_dato` (date) – date parameter  
   - (v6.20) `d_lage` (2) – warehouse  
3. **Key‐record variables**  
   E.g. `vshel1_vsor` like `VCVSOR`,  … `rlevl1_levr` like `RLLEVR`, etc.  
4. **Working variables**  
   - `b_feil` (flag)  
   - `w_udat` (date now), `w_tmst` (timestamp), `w_memb` (member name for VF  
   - `w_firm` like `VCFIRM`  
   - (v5.70) `w_jkod`, `w_jtxt`, `w_stat` – for warehouse lookup  

---

# 4. Program Initialization (`*INZSR`)  
- Build key‐lists for each file:  
  - `vshel1_key`: `(w_firm, vshel1_vsor{, vshel1_lage})`  
  - `vogrl1_key`: `(w_firm, vogrl1_oogr)`  
  - …  
  - `rlevl1_key`: `(w_firm, rlevl1_levr)`  
- Read `l_firm` from UDS into `w_firm`.  
- Initialize screen date (`b1dato`) to today.  

---

# 5. Main Loop (Tag B1TAGA)  
1. **Display/Accept**  
   `EXFMT b1bld` – show the screen, wait for user input.  
2. **Function‐key handling**  
   - F3/F12 (`*inkc/*inkl`) → GOTO AVSLUTT (exit)  
   - F4 (`*inkd`) → EXSR SPØRRING (call value-help subroutine), then redisplay.  
3. **Input validation**  
   - EXSR SJ_EKK_INPUT  
   - If `b_feil = *on`, redisplay (`GOTO B1TAGA`).  
4. **Prepare parameters**  
   - Move B1-fields → overlayed `d_list` fields  
   - Generate a unique member name:  
     `w_memb = 'P' + %subst( %char(w_tmst) : 9 : 9 )`  
5. **Call print program**  
   CALL 'VP600C' passing:  
   - `d_list` (64-byte parameter block)  
   - `w_memb` (member name)  
6. **Loop back** (redisplay screen)  

---

# 6. Exit (Tag AVSLUTT)  
- `*INLR = *on` → end program  

---

# 7. Subroutine SPØRRING (Value-Help)  
Depending on `w_afld` (the field that triggered F4), call the appropriate lookup program, e.g.:  
- B1VSOR → CALL ‘VC500R’ with (`w_firm`, `b1vsor`, `b1lage`, `b1besk`)  
- B1OGRP → CALL ‘VG510R’ → returns `b1ogrp`, `b1otxt`  
- B1HGRP → CALL ‘VG511R’ → returns `b1hgrp`, `b1htxt`  
- B1UGRP → CALL ‘VG512R’ → returns `b1ugrp`, `b1utxt`  
- B1LDOR → CALL ‘RL500R’ → returns `b1ldor`, `b1lnav`  
- B1LETY → CALL ‘VY500R’ → returns `b1lety`, `b1lbes`  
- (v5.70) B1LAGE → CALL ‘RA510R’ → returns `b1lage`, `b1lana`  

After each CALL → `LEAVESR`.  

---

# 8. Subroutine SJ_EKK_INPUT (Validation)  
1. **Reset**  
   - `b_feil = *off`  
   - clear all description fields (`b1besk`, `b1otxt`, etc.)  
2. **Exclusive‐OR logic**  
   - If `b1vsor` ≠ blank, then none of `b1ogrp|b1hgrp|b1ugrp|b1ldor` may be used → set `*IN31`, `b_feil` if violated.  
3. **Chain lookups** (record existence & retrieve text):  
   - If `b1vsor`  
     • Set `vshel1_vsor`, (`vshel1_lage`), CHAIN vshel1  
     • If not found → clear `vshel1_lage`, retry chain → if still not found → set `*IN32`, `b_feil`.  
     • Else retrieve `vcbesk → b1besk`.  
   - If `b1ogrp` ≠ 0 → CHAIN vogrl1 → if not found → `*IN33`, `b_feil`; else `b1otxt`.  
   - If `b1hgrp` → CHAIN vhgrl1 → if not found → `*IN34`, `b_feil`; else `b1htxt`.  
   - If `b1ugrp` → CHAIN vugrl1 → if not found → `*IN35`, `b_feil`; else `b1utxt`.  
   - If `b1ldor` → CHAIN rlevl1 → if not found → `*IN36`, `b_feil`; else `b1lnav`.  
   - Always do `b1lbes = vybesk` for delivery type (no condition).  
   - (v5.70) If `b1lage` → CALL ‘RS710R’ to validate warehouse → set `*IN39`, `b_feil` on error; return description to `b1lana`.  
4. **Date check**  
   - If `b1dato = 0` → default to today.  
   - Else TEST valid date → if invalid → `*IN38`, `b_feil`.  

Return to main; if `b_feil` on → screen redisplayed with error indicators.  

---

# 9. Key Points for Onboarding  
- This is a typical “screen‐to‐report‐call” pattern in RPG.  
- Parameter block `d_list` uses *overlay on a 64‐byte buffer—fields must align exactly.  
- Value‐help via F4 → SPØRRING → various lookup programs.  
- Input checks via CHAIN on keyed physical files, setting indicators *IN31–*IN39 to highlight fields.  
- Member naming uses time‐based suffix for unique spooled‐file member.  
- All exits return with `*INLR=*ON`.