```markdown
# RPG Program RA210R - Customer Data Export for Adra Match

## Overview

This RPG (Report Program Generator) code is written for IBM i (AS/400) in the classic fixed-format style. The program's primary purpose is to extract customer and supplier data from input files, format it, and write it to an output file for use with Adra Match (a reconciliation solution).

The code includes:
- File definitions for reading customer and supplier master files.
- Formatting of fields from input records.
- Output of formatted records to a file.
- A subroutine to process supplier data.

---

## Header Specifications

```rpg
h datedit(*dmy) option(*nodebugio)
```
- **`datedit(*dmy)`**: Dates are edited as Day-Month-Year.
- **`option(*nodebugio)`**: Disables some debug information for input/output operations.

---

## File Declarations

```rpg
frkunl1    ip   e           k disk    rename(rkunpfr:rkunl1r)
frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
fadrkund   o    f  256        disk
```
- **rkunl1**: Input, externally described, keyed file (customers). The record format from file `rkunpfr` is renamed as `rkunl1r`.
- **rlevl1**: Input, externally described, keyed file (suppliers). The record format is renamed similarly.
- **adrkund**: Output file for the formatted data, record length 256.

---

## Data Declarations

```rpg
d                uds
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980
d w_aar           s              4  0
d w_mnd           s              2  0
d w_fgr           s              3
d w_sted          s             25
d w_ponr          s              4
d w_kund          s              6
d krec            s            256
d rlevl1_firm     s                    like(rlfirm)
d rlevl1_levr     s                    like(rllevr)
```
- Declares variables for:
  - User, firm, navigation fields (some not used in code shown)
  - Temporary storage for year, month, group, address fields, customer/supplier number, and record buffer (`krec`).
  - Key fields for supplier file (`rlevl1_firm`, `rlevl1_levr`).

---

## Main Logic - Customer Processing

The first block processes customer records from `rkunl1` one at a time (loop initialization/reading not shown in provided code). For each record, it:

### Extracts and formats fields:
- **Postal number (`rkponr`)** into `w_ponr`
- If postal number equals the first 4 digits of address field (`rksted`), `w_sted` is set to positions 6-30 of address; otherwise, uses full address.
- Customer number (`rkkund`) into `w_kund`. Any leading zeros are stripped from the customer number.

### Record composition:
- Combines blank prefix, customer number, name, address lines, postal code, place, and trailing blanks into the output buffer `krec`.
- Output is written using the `EXCEPT kundrec` statement, which refers to the output specs at the bottom.

---

## Supplier Processing

After processing customers, the program resets key fields and processes supplier records (`rlevl1`) in a loop:
- Initializes keys, sets file pointer, and reads records.
- For each supplier record, it calls subroutine `LEVER`.

---

## Subroutine - LEVER

Processes a single supplier record:
- Similar to customer processing, but uses supplier fields (e.g., `rlponr`, `rlsted`, `rllevr`, etc.).
- Composes the output record `krec` and writes with `EXCEPT kundrec`.

---

## Initialization Subroutine (*INZSR)

Executed once at program start.
- Defines an entry parameter (`w_fgr`) used to select/filter data (usage not fully shown).
- Prepares a key list for processing the supplier file.

---

## Output Specification

```rpg
oadrkund   e            kundrec
o                       krec               256
```
- Defines output record `kundrec` to `adrkund`, writing the contents of variable `krec` (256 bytes).

---

## Notable Techniques

- **Removing leading zeroes from customer/supplier numbers:**  
  A `DOW` loop shifts characters left until the first is not '0', padding the tail with blanks.
- **Conditional address extraction:**  
  Handles two possible address layouts depending if postal number matches the prefix in the address field.
  
---

## Summary Table

| File      | Usage   | Description                                    |
|-----------|---------|------------------------------------------------|
| rkunl1    | Input   | Customer master file                           |
| rlevl1    | Input   | Supplier master file                           |
| adrkund   | Output  | Formatted customer/supplier address output     |

---

## Intended Use

This program is specialized for extracting and formatting key fields from customer and supplier records, producing a flat file suitable for reconciliation in Adra Match. The code demonstrates typical fixed-format RPG techniques and file handling patterns.

---
```