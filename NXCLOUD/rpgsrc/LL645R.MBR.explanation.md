# RPG Program LL645R - "Utskrift av omløpshastighet - parameter"

This code is a classic ILE RPG (RPG IV) program with fixed-format logic. Its purpose is to manage and validate user input for printing "omløpshastighet" (turnover rate), allowing selection and validation of a variety of selection parameters (items, groups, suppliers, handlers, etc.), then packaging the parameters into a block for use by another program.

Let's walk through the key sections and concepts:

---

## 1. Header and Metadata

- **/TITLE:** Program title - Print of turnover rate, parameter entry.
- **Comments:**  
  - Program name: LL645R  
  - Description, versioning, change history.
- **Indicator Usage:**  
  - Outlines which indicators are used for what (exit, errors, subroutines, etc.).

---

## 2. File Declarations (`F-Specs`)

```rpg
frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
fra26l1    if   e           k disk    rename(ra26pfr:ra26l1r)
fll645d    cf   e             workstn
```
- Declares three files:
  - `RLEVL1` and `RA26L1` as input files, renamed for internal use.
  - `LL645D` as a display file (workstation).

---

## 3. Data Definitions (`D-Specs`)

### Local Data Area (LDA) Fields
These pull out specific bytes from the LDA for use (firm number, firm name, etc.).

### Parameter Block (`p_prec`)

```rpg
d                 ds
d p_prec                       128
d  p_fvar                        8  0 overlay(p_prec)
...
d  p_lagi                        1  0 overlay(p_prec:48)
```
- `p_prec` is a 128-byte structure. Fields are overlaid onto it for easy packing/unpacking.
- Typical RPG pattern for parameter transfer blocks.

### Variables for Keys and Fields

- Used for file access (by key), e.g. `rlevl1_levr` for supplier number.
- Various `w_*` fields for work storage (firm number, text fields, parameter block, etc.).

---

## 4. Main Control Logic (`C-Specs`)

### Screen Handling Loop

- **Tag a1taga**: Start of the main screen processing loop.
- `exfmt a1bld`: Display and get input from the parameter selection screen.

#### Command Handling

- **F3 (exit):** Sets `w_in03`, jumps to program end.
- **F4 (inquiry):** Calls subroutine `sp_input` based on the field that requested inquiry (context-sensitive help).

#### Validation Checks

- Consistently checks and validates that the "from" values are less than or equal to "to" values for all ranges (items, warehouses, groups, etc.).
- Chains into supplier and handler files to check existence.
- Checks sorting and type codes for validity.
- If validation fails, sets the appropriate indicator and re-displays the screen.

#### Parameter Packing

- If validation passes, packs all input fields into the `p_prec` structure for parameter passing.

---

## 5. Subroutine: `sp_input` (Inquiry)

- Handles inquiry/lookups based on the field in focus (`wactfe`).
- Calls out to various programs (e.g., `VV500R`, `VG510R`, `VG511R`, etc.) for lookups of items, groups, warehouses, suppliers, and handlers.
- After each successful inquiry, updates the relevant field and returns to the screen.

---

## 6. Subroutine: `*inzsr` (Initialization)

- Defines key lists for chained file lookups.
- Specifies the entry parameter list (`plist`) accepting input indicator and return parameter block.
- Initializes default screen values (e.g., item range, group range, type, etc.).
- Sets the working firm number.

---

## 7. Program End

- **Tag `end_pgm`:**
  - Sets Last Record Indicator (`*INLR`) to end the program.
  - Returns control to the caller.

---

## Key Concepts

- **Indicator-Based Logic:** Heavily uses indicators for controlling flow, error reporting, and screen state.
- **Parameter Packing:** Overlays input fields into a buffer to return a single structure—classic RPG for batch processing.
- **Screen and File Interaction:** Validates all user selections both by format (range checks) and existence (file `chain`), reporting errors directly on the screen via indicators.
- **Subroutine-Based Inquiry:** External programs are called for field lookup and selection support.

---

## Summary

This program acts as a parameter collector for turnover rate reporting. It validates user selections for ranges (items, groups, etc.), checks existence of suppliers and handlers, allows for inquiry/lookup per field, and finally packs the data into a parameter block to pass to the next program or process. It demonstrates classic fixed-format RPG techniques: indicator usage, data overlays, file keying, and subroutine-based logic.