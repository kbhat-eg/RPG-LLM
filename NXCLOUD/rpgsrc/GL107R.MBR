      /TITLE  ASOKON Oversikt over filer til remittering totalt
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      * System  . . . . : ASOKON                                        *
      * Program . . . . : GL107R                                        *
      * Beskrivelse . . : Underprogram for overføring til DIRREM.       *
      *                   Hovedprogram er RL106R.                       *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      * Spesialversjon. :                                               *
      * Tilpasset for . :                                               *
      *                                                                 *
      * Referanse  Dato   Endringsbeskrivelse                      Sign.*
      * --------- ------  ----------------------------------------------*
      *           161194  Nytt program november-1994               RH   *
T5.00 * V5.00     171002  Ikke lenger key i GUBFPF, bruker L8.     HFL  *
      * V5.51     051207  Feil dersom ÅR er blank. Legger inn "0"  RHO  *
      *                                                                 *
      *                                                                 *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      *  BRUK AV INDIKATORER                                            *
      *                                                                 *
      *       KC = F3  = Exit                                           *
      *       KF = F6  = Overfør batcen(e) til DIRREM                   *
      *       KL = F12 = Annuller                                       *
      *                                                                 *
      *       LR = Avslutt program                                      *
      *       10 = Roll                                                 *
      *       12 = Sfldsp                                               *
      *       13 = Sfldspctl                                            *
      *       14 = Sflclr                                               *
      *       15 = Sflend                                               *
      *       16 = Readc 16 on, no more records                         *
      *       30 = Protect av felter ved vise                           *
      *    31-59 = Varsle m/feilmeldinger/skjermindikatorer             *
      *    60-69 = Fileindikatorer chain etc.                           *
      *    70-79 = Arbeidsindikatorer i sub-rutiner                     *
      *    80-89 = Arbeidsindikatorer ordinære                          *
      *    90-99 = Benyttes ved std. sub-rutiner                        *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     fgu00l1    uf   e           k disk
     fgu01l1    uf   e           k disk
     fgu02l1    uf   e           k disk
     fgu03l1    uf   e           k disk
     fgu04l1    uf   e           k disk
     fgu21l1    uf   e           k disk
     fgu22l1    uf   e           k disk
     fgu23l1    uf   e           k disk
     fgu99l1    uf   e           k disk
E5.00fgubfl8    uf   e           k disk
     frltrlu    uf   e           k disk
      *Felles sekvens nummer
     fgustpf    uf   e           k disk
      *Faste opplysninger
     fgfaspf    uf   e           k disk
     fgl107d    cf   e             workstn
     f                                     sfile(r1wsf:srrn02)
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Definering av felter                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      *     nn - er 01 for subfile 01,
      *             02 for subfile 02,
      *             03 for subfile 03, o.s.v.
      * SRRNnn - Relativt recordnummer i subfile
      * SPGEnn - Sidestørrelse i subfile (page)
      * SFRNnn - Første recordnummer på siden
      * SSRNnn - Siste  recordnummer på siden
      * SVRNnn - Vis den side som inneholder denne record.
      *
      * Forklaring på spesielle felter
      * som benyttes ved windows.
      * - - - - - - - - - - - - - - - - -
      *
      * w_arow - Actual line, angir startlinje for vindu.
      * w_acol - Actual posision, angir startposisjon for vindu.
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      *
      *
      * SUBFILE-1
      * B2CTL  - B2 Subfile - control record
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      * SUBFILE-2
      * R1WSF  - R1 Subfile - record
      * R2WCT  - R2 Subfile - control record
      * R2CMD  - R2 Eget skjermbilde for CMD-taster
      *
      /eject
      *
      * Datastruktur for rabattdato-1 DMÅ (i fra diskfile)
      *
     d*dsudat          s               d   datfmt(*iso)
     d                 ds
     d rddmÅ1                         8  0
     d  gardd1                        2  0 overlay(rddmÅ1)
     d  gardm1                        2  0 overlay(rddmÅ1:3)
     d  gardÅ1                        4  0 overlay(rddmÅ1:5)
      *
      * Datastruktur for rabattdato-2 DMÅ (i fra diskfile)
      *
     d                 ds
     d rddmÅ2                         8  0
     d  gardd2                        2  0 overlay(rddmÅ2)
     d  gardm2                        2  0 overlay(rddmÅ2:3)
     d  gardÅ2                        4  0 overlay(rddmÅ2:5)
      *
      * Datastruktur for rabattdato-3 DMÅ (fra diskfile)
      *
     d                 ds
     d rddmÅ3                         8  0
     d  gardd3                        2  0 overlay(rddmÅ3)
     d  gardm3                        2  0 overlay(rddmÅ3:3)
     d  gardÅ3                        4  0 overlay(rddmÅ3:5)
      *
      * Datastruktur for opprinnelig forfallsdato (bilde C2).
      *
     d                 ds
     d dsopfo                         8  0
S5.00d* gaopfd                        2  0 overlay(dsopfo)
T5.00d  w_opfd                        2  0 overlay(dsopfo)
E5.00d  w_opfm                        2  0 overlay(dsopfo:3)
E5.00d  w_opfÅ                        4  0 overlay(dsopfo:5)
      *
T5.00d                 ds
T5.00d wsopfo                         8  0
T5.00d  wsopfÅ                        4  0 overlay(wsopfo)
T5.00d  wsopfm                        2  0 overlay(wsopfo:5)
T5.00d  wsopfd                        2  0 overlay(wsopfo:7)
      *
      * Datastruktur for forfallsdato DMÅ  ( i fra diskfile)
      *
     d                 ds
     d dsforf                         8  0
     d  gaford                        2  0 overlay(dsforf)
     d  gaform                        2  0 overlay(dsforf:3)
     d  gaforÅ                        4  0 overlay(dsforf:5)
      *
      * Datastruktur for dato sist endret Daglig sekvensteller:
      *
     d                 ds
     d ds7dda                         8  0
     d  ds7dÅr                        4  0 overlay(ds7dda)
     d  ds7dmÅ                        2  0 overlay(ds7dda:5)
     d  ds7ddg                        2  0 overlay(ds7dda:7)
      *
     d a1slpo          s              3  0
     d sfrn01          s                   like(srrn01)
     d sfrn02          s                   like(srrn02)
     d spge01          s              3  0
     d spge02          s              3  0
     d srrn01          s              4  0
     d srrn02          s              4  0
     d ssrn01          s                   like(srrn01)
     d ssrn02          s                   like(srrn02)
     d w_arow          s              2  0
     d w_acol          s              3  0
     d wpbfnr          s                   like(gdzubf)
     d wpdagl          s              6  0
     d wpdato          s              8  0
     d wpendr          s              1
     d wpfgrp          s                   like(gdzfgr)
     d wpfirm          s                   like(gdzfir)
     d wpfler          s              2
     d wpin03          s              1  0
     d wpin12          s              1  0
     d wplinj          s              5  0
     d wpride          s                   like(gdzrid)
     d wpsekv          s              4  0
     d wpslet          s              2
     d wptime          s              6  0
     d wpvalg          s              1
     d wpzfgr          s                   like(gdzfgr)
     d wpzfir          s                   like(gdzfir)
     d wpzrid          s                   like(gdzrid)
     d wpzubf          s                   like(gdzubf)
      *
      /eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * START:                                                          *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Vise innhold av batch:                                          .
      *                                                                 .
     c                   if        wpvalg = '5'                                 .....        .
     c                   eval      r2bfnr = wpbfnr                                  .
     c                   exsr      xc5bld                                           .        .
      * Avslutt program ved F12.                               .        .
     c                   if        *inkl = *on                                  ... .        .
     c                   eval      wpin12 = 1                                     . .        .
     c                   endif                                                  ... .        .
     c                   endif                                                  .....        .
      *                                                                 .
      * Slette batch:                                                   .
      *                                                                 .
     c                   if        wpvalg = '4'                                 .....        .
     c                   exsr      xc4bld                                           .        .
      * Avslutt program ved F12.                               .        .
     c                   if        *inkl = *on                                  ... .        .
     c                   eval      wpin12 = 1                                     . .        .
     c                   endif                                                  ... .        .
     c                   endif                                                  .....        .
      *                                                                 .
      * Oppdaterer GUBFPF (forslagsfile) og RLTRPF (leverandør-         .
      * transaksjoner).  Samtidig blir sist brukte sekvensnummer        .
      * hentet, med test på om det er EGET eller FELLES som skal        .
      * benyttes.                                                       .
      *                                                                 .
     c                   if        wpvalg = 'O'                                 .....        .
     c                   exsr      xoverf                                           .        .
     c                   endif                                                  .....        .
      *                                                                 .
     c                   if        wpvalg = 'O'                                 .....        .
     c                             or wpvalg = 'P'                                  .        .
     c                   exsr      xfØrst                                           .        .
     c                   endif                                                  .....        .
      *                                                                 .
      * Oppdaterer sekvensteller med sist brukte:                       .
      *                                                                 .
     c                   if        wpvalg = 'S'                                 .....        .
     c                             or wpvalg = 'T'                                  .        .
     c                   exsr      xsiste                                           .        .
     c                   endif                                                  .....        .
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Avslutt program                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Tøm subfile-2                                                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xclr02        begsr
     c                   move      *on           *in24
     c                   write     r2wct
     c                   move      *off          *in24
      *
     c                   move      *off          *in25
     c                   eval      srrn02 = 0
     c                   eval      sfrn02 = 0
     c                   eval      ssrn02 = 0
     c                   eval      spge02 = 0
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Fyll opp subfile-2                                              *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xcrt02        begsr
     c                   eval      spge02 = spge02 + 9                          SFL END
     c                   eval      srrn02 = ssrn02
      *
     c                   dou       srrn02 = spge02                                       .....
     c     xcr02         tag                                                                 .
E5.00c     key03         reade     gubfl8                                 25                 .
     c     *in25         cabeq     *on           xend02                         EOF          .
      *Kun "G"-(Godkjente) poster skal leses.                           .
     c     gastat        cabne     'G'           xcr02                                       .
      *                                                                 .
      * Kun innlandsposter skal leses ved TBII, og utenlandsposter      .
      * ved TBIU.                                                       .
      *                                                                 .
      * Innenlands:                                                     .
     c                   if        wpride = 'TBII'                              .....
     c                             and gavalb <> 0                                  .
     c                   goto      xcr02                                            .
     c                   endif                                                  .....
      * Utenlands:                                                      .
     c                   if        wpride = 'TBIU'                              .....
     c                             and gavalb = 0                                   .
     c                   goto      xcr02                                            .
     c                   endif                                                  .....
      *Display-felter                                                   .
     c                   eval      srrn02 = srrn02 + 1                                       .
     c                   eval      r1bfli = gabfli                                           .
T5.00c                   eval      dsforf = 0                                                .
T5.00c     *dmy          move      gafdat        dsforf                                      .
     c                   eval      r1bdat = dsforf                                           .
     c                   eval      r1belØ = gabelØ                                           .
     c                   movel     garabb        r1rabb                                      .
     c                   movel     gatext        r1text                                      .
     c                   eval      r1levr = galevr                                           .
     c                   movel     gakids        r1kids                                      .
      *                                                                 .
      * Lagrer linjenummer for sist leste posten.  Denne blir           .
      * brukt i KEY08 for å posisjonere ved neste ROLL frwemover:       .
      *                                                                 .
     c                   eval      wplinj = gabfli                                           .
      *                                                                 .
     c                   write     r1wsf                                                     .
     c                   enddo                                                           .....
      *
     c     xend02        tag
      *
     c                   if        srrn02 > ssrn02                                       .....
     c                   eval      sfrn02 = ssrn02 + 1                                     . .
     c                   endif                                                           .....
      *
     c                   eval      ssrn02 = srrn02
     c                   eval      w_virn = sfrn02
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Display subfile-2                                               *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xdsp02        begsr
      *
     c                   if        srrn02 <> 0                                           .....
     c                   move      *on           *in22                                       .
     c                   endif                                                           .....
      *
     c                   move      *on           *in23
     c                   exfmt     r2wct
     c                   move      *off          *in22
     c                   move      *off          *in23
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - -
      * Subrutine for å slette batch.                                   *
      * - - - - - - - - - - - - - - -
      *
     c     xc4bld        begsr
      *
      * Initierer "flagg" som forteller om det er en eller
      * to batcher pr. forslagsnummer.  Dette kan være
      * tilfelle dersom det er både innenlands og utenlands
      * batch.  WPFLER får i såfall verdien "JA".
      *
     c                   eval      wpfler = *blanks
      *
      * Sender ventemelding ved sletting.
      *
     c                   eval      w_arow = 6
     c                   eval      w_acol = 26
     c                   eval      a1slpo = 0
      *
      * Tester på om det finnes flere batcher på GU99L1 med det
      * samme forslagsnummeret.  Dette vil være tilfelle dersom
      * det er både innland og utland.
      *
      * Dersom innenlands, tester om det finnes utenlandstransaksjon.
      *
     c                   if        wpride = 'TBII'                              .......
     c                   movel     'TBIU'        wpride                               .
     c     key01         chain     gu99l1                             61              .
     c                   if        *in61 = *off                                 ...   .
     c                   movel     'JA'          wpfler                           .   .
     c                   endif                                                  ...   .
     c                   movel     'TBII'        wpride                               .
     c                   endif                                                  .......
      *
      * Dersom utenlands, tester om det finnes innenlandstransaksjon.
      *
     c                   if        wpride = 'TBIU'                              .......
     c                   movel     'TBII'        wpride                               .
     c     key01         chain     gu99l1                             61              .
     c                   if        *in61 = *off                                 ...   .
     c                   movel     'JA'          wpfler                           .   .
     c                   endif                                                  ...   .
     c                   movel     'TBIU'        wpride                               .
     c                   endif                                                  .......
      *
      * Det finnes to batcher.  Dette medfører at "U" (Utgår) må
      * legges ut i feltet GASTAT på file GUBFPF (forslagsfile).
      * GU04L1 (ved utenlands) eller GU23L1 ved innenlands må
      * lese for å finne linjenummer på poster som skal behandles
      * på GUBFPF.
      *
     c                   if        wpfler = 'JA'                                .........
      * Batch som slettes er innenlands.  Henter linjenummer       .
      * i fra Fakturatransaksjonsfile Innenlands.  Linjenummer     .
      * må brukes for å hente post på GUBFPF.                      .
     c                   if        wpride = 'TBII'                              ....... .
     c     key02         setll     gu23l1                                             . .
     c     key02         reade     gu23l1                                 61          . .
      *                                                          . .
     c                   dow       *in61 = *off                                 ..... . .
      *                                                        . . .
E5.00c     key07         chain     gubfl8                             62            . . .
     c                   if        *in62 = *off                                 ... . . .
     c                   movel     'U'           gastat                           . . . .
     c                   update    gabfpfr                                        . . . .
     c                   endif                                                  ... . . .
      *                                                        . . .
     c     key02         reade     gu23l1                                 61        . . .
     c                   enddo                                                  ..... . .
      *                                                          . .
     c                   endif                                                  ....... .
      *                                                            .
     c                   if        wpride = 'TBIU'                              ....... .
     c     key02         setll     gu04l1                                             . .
     c     key02         reade     gu04l1                                 61          . .
      *                                                          . .
     c                   dow       *in61 = *off                                 ..... . .
      *                                                        . . .
E5.00c     key06         chain     gubfl8                             62            . . .
     c                   if        *in62 = *off                                 ... . . .
     c                   movel     'U'           gastat                           . . . .
     c                   update    gabfpfr                                        . . . .
     c                   endif                                                  ... . . .
      *                                                        . . .
     c     key02         reade     gu04l1                                 61        . . .
     c                   enddo                                                  ..... . .
      *                                                          . .
     c                   endif                                                  ....... .
      *                                                            .
     c                   endif                                                  .........
      *
      * Det finnes kun en batch.  Dette medfører at " " (Blank)
      * legges ut i feltet GASTAT på file GUBFPF (forslagsfile)
      * for alle poster.
      *
     c                   if        wpfler = *blanks                             .........
      *                                                            .
      * Leser alle poster på forslagsfile med likt firma og        .
      * forslagsnummer, og lgger " " i feltet GASTAT.              .
      *                                                            .
E5.00c     key03         setll     gubfl8                                               .
E5.00c     key03         reade     gubfl8                                 61            .
      *                                                            .
     c                   dow       *in61 = *off                                 .....   .
     c                   movel     ' '           gastat                             .   .
     c                   update    gabfpfr                                          .   .
E5.00c     key03         reade     gubfl8                                 61        .   .
     c                   enddo                                                  .....   .
      *                                                            .
     c                   endif                                                  .........
      *
      * Sletter alle poster på GD-filene som tilhører batchen.
      *
      * BETFOR00 - GU00L1
      *
     c     key02         setll     gu00l1
     c     key02         reade     gu00l1                                 61
     c                   dow       *in61 = *off                                 ...
     c                   delete    gu00pfr                                        .
     c     key02         reade     gu00l1                                 61      .
     c                   enddo                                                  ...
      *
      * BETFOR01 - GU01L1
      *
     c     key02         setll     gu01l1
     c     key02         reade     gu01l1                                 61
     c                   dow       *in61 = *off                                 ...
     c                   delete    gu01pfr                                        .
     c     key02         reade     gu01l1                                 61      .
     c                   enddo                                                  ...
      *
      * BETFOR02 - GU02L1
      *
     c     key02         setll     gu02l1
     c     key02         reade     gu02l1                                 61
     c                   dow       *in61 = *off                                 ...
     c                   delete    gu02pfr                                        .
     c     key02         reade     gu02l1                                 61      .
     c                   enddo                                                  ...
      *
      * BETFOR03 - GU03L1
      *
     c     key02         setll     gu03l1
     c     key02         reade     gu03l1                                 61
     c                   dow       *in61 = *off                                 ...
     c                   delete    gu03pfr                                        .
     c     key02         reade     gu03l1                                 61      .
     c                   enddo                                                  ...
      *
      * BETFOR04 - GU04L1
      *
     c     key02         setll     gu04l1
     c     key02         reade     gu04l1                                 61
     c                   dow       *in61 = *off                                 ...
     c                   delete    gu04pfr                                        .
     c                   eval      a1slpo = a1slpo + 1                            .
     c     key02         reade     gu04l1                                 61      .
     c                   enddo                                                  ...
      *
      * BETFOR21 - GU21L1
      *
     c     key02         setll     gu21l1
     c     key02         reade     gu21l1                                 61
     c                   dow       *in61 = *off                                 ...
     c                   delete    gu21pfr                                        .
     c     key02         reade     gu21l1                                 61      .
     c                   enddo                                                  ...
      *
      * BETFOR21 - GU22L1
      *
     c     key02         setll     gu22l1
     c     key02         reade     gu22l1                                 61
     c                   dow       *in61 = *off                                 ...
     c                   delete    gu22pfr                                        .
     c     key02         reade     gu22l1                                 61      .
     c                   enddo                                                  ...
      *
      * BETFOR23 - GU23L1
      *
     c     key02         setll     gu23l1
     c     key02         reade     gu23l1                                 61
     c                   dow       *in61 = *off                                 ...
     c                   delete    gu23pfr                                        .
     c                   eval      a1slpo = a1slpo + 1                            .
     c     key02         reade     gu23l1                                 61      .
     c                   enddo                                                  ...
      *
      * BETFOR99 - GU99L1
      *
     c     key01         setll     gu99l1
     c     key01         reade     gu99l1                                 61
     c                   dow       *in61 = *off                                 ...
     c                   delete    gu99pfr                                        .
     c     key01         reade     gu99l1                                 61      .
     c                   enddo                                                  ...
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for å vise i eget vindu poster i fra forslagsfile.    *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xc5bld        begsr
      *
      * Posisjonerer vindu.
      *
     c                   eval      w_arow = 4
     c                   eval      w_acol = 13
      *
      * Tøm subfile-2
      *
     c                   exsr      xclr02
      *
E5.00c     key03         setll     gubfl8
      *
      * Fyll opp subfile-2
      *
     c                   exsr      xcrt02
      *
      * Send Alt
      *
     c     r2taga        tag
      *
     c                   write     r2cmd
      *
      * Bare data
      *
     c     r2tagb        tag
      *
     c                   exsr      xdsp02                                       DSP SFL
      *
      * F3 => Avslutt program i fra subfile program.
      *
     c     *inkc         cabeq     *on           rslutt
      *
      * Roll
      *
     c                   if        *in20 = *on                                           .....
E5.00c     key08         setll     gubfl8                                                    .
E5.00c     key08         reade     gubfl8                                 25                 .
     c                   exsr      xcrt02                                       CRT SFL      .
     c                   goto      r2tagb                                                    .
     c                   endif                                                           .....
      *
      * Posisjoner
      * startverdi
      *
     c                   if        r2bfli <> 0                                           ...
      *                                                               .
E5.00c     key04         setll     gubfl8                                                  .
     c                   exsr      xclr02                                       TØM SFL    .
     c                   exsr      xcrt02                                       CRT SFL    .
S5.00c*                  eval      r2bfli = *blanks                                        .
T5.00c                   eval      r2bfli = *zeros                                         .
     c                   goto      r2tagb                                                  .
      *                                                               .
     c                   endif                                                           ...
      *
      /eject
      * - - - - - - - - - - - -
      * Behandling av subfile-2
      * - - - - - - - - - - - -
      *
      * Sjekk om valg
      * er foretatt i
      * subfile
      *
     c                   do        ssrn02                                                .....
     c                   readc     r1wsf                                  26                 .
      *                                                                 .
     c                   if        *in26 = *on                                  ...          .
     c                   leave                                                    .          .
     c                   endif                                                  ...          .
      *                                                                 .
      * Vise forslagspost.                                              .
      *                                                                 .
     c                   if        r1valg = '5'                                 .....        .
      * Kun vise data, ikke endre!                             .        .
     c                   move      *on           *in33                              .        .
     c                   eval      r2bfli = r1bfli                                  .        .
     c                   exsr      xc2bld                                           .        .
     c                   eval      r1valg = *blank                                  .        .
     c                   eval      r2bfli = 0                                       .        .
     c     *inkl         cabeq     *on           rslutt                             .
     c                   iter                                                       .        .
     c                   endif                                                  .....        .
      *                                                                 .
     c                   enddo                                                           .....
      *
     c                   goto      r2taga
      *
     c     rslutt        tag
      * "Frigjør" subfile-2
     c                   if        r1valg = '5'                                          .....
     c                   move      srrn02        w_virn                                      .
     c                   eval      r1valg = *blank                                           .
     c                   update    r1wsf                                                     .
     c                   endif                                                           .....
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * C2BLD Behandle bilde for Endring / Vise                         *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xc2bld        begsr
E5.00c     key04         chain     gubfl8                             60
      *
     c                   if        *in60 = *off                                          .....
     c                   movel     'Vise'        c2nyen                                      .
     c                   movel     gastat        c2stat                                      .
     c***                eval      c2firm = gafirm                                           .
     c                   eval      c2levr = galevr                                           .
     c                   eval      c2bdat = dsforf                                           .
S5.00c*                  eval      c2tell = gatell                                           .
T5.00c                   eval      c2tist = gatist                                           .
     c                   movel     gavalk        c2valk                                      .
     c                   movel     gaatts        c2atts                                      .
     c                   eval      c2bilk = gabilk                                           .
     c                   eval      c2belØ = gabelØ                                           .
     c                   eval      c2rest = garest                                           .
     c                   eval      c2biln = gabiln                                           .
     c                   eval      c2valb = gavalb                                           .
     c                   eval      c2valr = gavalr                                           .
     c                   movel     gabetk        c2betk                                      .
     c                   eval      c2raar = garaar                                           .
     c                   eval      c2rper = garper                                           .
     c                   eval      c2jour = gajour                                           .
     c                   eval      c2samb = gasamb                                           .
     c                   eval      c2refn = garefn                                           .
     c                   movel     gatext        c2text                                      .
     c                   movel     gavirk        c2virk                                      .
     c                   eval      c2fdmÅ = dsforf                                           .
     c                   eval      c2rrf1 = garrf1                                           .
     c                   eval      c2rrf2 = garrf2                                           .
     c                   movel     gadeck        c2deck                                      .
     c                   eval      c2bfnr = gabfnr                                           .
     c                   eval      c2bfli = gabfli                                           .
     c                   movel     gakidi        c2kidi                                      .
     c                   eval      c2avde = gaavde                                           .
     c                   movel     garekl        c2rekl                                      .
     c                   eval      c2delb = gadelb                                           .
     c                   eval      c2betb = gabetb                                           .
     c                   movel     garemk        c2remk                                      .
      *                                                                 .
T5.00c                   move      gaopfd        wsopfo                                      .
T5.00c                   move      wsopfd        w_opfd                                      .
T5.00c                   move      wsopfm        w_opfm                                      .
T5.00c                   move      wsopfÅ        w_opfÅ                                      .
     c                   eval      c3opfo = dsopfo                                           .
     c                   eval      c3rbn1 = garbn1                                           .
     c                   eval      c3rbv1 = garbv1                                           .
     c                   eval      c3rbn2 = garbn2                                           .
     c                   eval      c3rbv2 = garbv2                                           .
     c                   eval      c3rbn3 = garbn3                                           .
     c                   eval      c3rbv3 = garbv3                                           .
     c                   eval      c3opbn = gaopbn                                           .
     c                   eval      c3opbv = gaopbv                                           .
      *                                                                                  .....
5.51 c                   if        garda1 = *loval
5.51 c                   move      *zeros        c3rda1
5.51 c                   else
5.51 c                   move      garda1        c3rda1
5.51 c                   endif
      *                                                                                  .....
5.51 c                   if        garda2 = *loval
5.51 c                   move      *zeros        c3rda2
5.51 c                   else
5.51 c                   move      garda2        c3rda2
5.51 c                   endif
      *                                                                                  .....
5.51 c                   if        garda3 = *loval
5.51 c                   move      *zeros        c3rda3
5.51 c                   else
5.51 c                   move      garda3        c3rda3
5.51 c                   endif
      *                                                                                  .....
5.51 c***                eval      c3rda1 = rddmÅ1                                           .
5.51 c***                eval      c3rda2 = rddmÅ2                                           .
5.51 c***                eval      c3rda3 = rddmÅ3                                           .
      *                                                                                  .....
     c                   endif                                                           .....
      *
     c                   exfmt     c2bld
      *
     c     *inkc         cabeq     *on           c2tag1
      *
      * Send opp bilde nr. 2 av 2.
     c                   exfmt     c3bld
      *
     c     c2tag1        tag
      *
     c                   if        r1valg = '2'                                          .....
     c                             or r1valg = '5'                                           .
     c                   move      srrn02        w_virn                                      .
     c                   eval      r1valg = *blank                                           .
     c                   update    r1wsf                                                     .
     c                   endif                                                           .....
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for å overføre GD-filer ("DIRADD") til DIRREM         *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xoverf        begsr
      *
      * Leser GUBFPF - Utebetalingsforslag, for å tilbakestille
      * de poster som ikke blir tatt med i overføringen.  Denne
      * operasjonen blir utført for hver batch som finnes på
      * samlefile.
      *
E5.00c     key03         setll     gubfl8                                                    .
E5.00c     key03         reade     gubfl8                                 61                 .
      *
      * Jobben skal kun kjøres dersom det IKKE er lønnsoverføring,
      * d.v.s. bilagsdato (GABILD) er null:
      *
     c                   dow       *in61 = *off                                 .......      .
     c                   if        gastat = 'U'                                 ..... .      .
S5.00c*                            and gabild <> 0                                  . .      .
T5.00c                             and gabdat <> *loval                             . .      .
      *                                                        . .      .
      * Oppdaterer leverandørtransaksjon.                      . .      .
     c     key05         chain     rltrlu                             62            . .      .
     c                   if        *in62 = *off                                 ... . .      .
     c                   eval      robfnr = 0                                     . . .      .
     c                   eval      robfli = 0                                     . . .      .
     c                   update    rltrpfr                                        . . .      .
     c                   endif                                                  ... . .      .
      * Sletter transaksjon på forslagsfile.                   . .      .
     c                   delete    gabfpfr                                          . .      .
      *                                                        . .      .
      * Dersom post på forslagfile ikke skal slettes, så må    . .      .
      * lås fjernes:                                           . .      .
      *                                                        . .      .
     c                   else                                                   ..... .      .
E5.00c                   unlock    gubfl8                                           . .      .
      *                                                        . .      .
     c                   endif                                                  ..... .      .
      *                                                          .      .
      * Henter neste post:                                       .      .
      *                                                          .      .
E5.00c     key03         reade     gubfl8                                 61          .      .
     c                   enddo                                                  .......      .
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for å hente siste sekvensnummer.                      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     xfØrst        begsr
      *
     c                   eval      wpsekv = 0
      *
      * Henter DAGLIG sekvensteller ved OVERFØRING til DIRREM:
      * Feltet blir nullstilt ved ny dag.
      *
     c                   if        wpvalg = 'O'                                 ......
      ***********GAFIRM    CHAINGFASPF               61         .
     c     wpfirm        chain     gfaspf                             61             .
     c                   eval      ds7ddg = uday                                     .
     c                   eval      ds7dmÅ = umonth                                   .
     c                   eval      ds7dÅr = 2000                                     .
     c                   eval      ds7dÅr = ds7dÅr + uyear                           .
     c                   if        uyear >= 80                                  ...  .
     c                   eval      ds7dÅr = 1900                                  .  .
     c                   eval      ds7dÅr = ds7dÅr + uyear                        .  .
     c                   endif                                                  ...  .
     c                   if        gefdda <> ds7dda                             ...  .
     c                   eval      gefdda = ds7dda                                .  .
     c                   eval      gefdas = 0                                     .  .
     c                   update    gfaspfr                                        .  .
     c                   endif                                                  ...  .
     c                   eval      wpdagl = gefdas                                   .
     c                   endif                                                  ......
      *
      * Henter opp faste opplysninger.
      *
      ***********GAFIRM    CHAINGFASPF               61
     c     wpfirm        chain     gfaspf                             61
      *
      * Henter EGET sekvensnummer ved OVERFØRING til DIRREM:
      *
     c                   if        gefefs = 'E'                                 ......
     c                             and wpvalg = 'O'                                  .
     c                   eval      wpsekv = geffos                                   .
     c                   endif                                                  ......
      * Henter EGET hjelpesekvensnummer, UTEN overføring:
     c                   if        gefefs = 'E'                                 ......
     c                             and wpvalg = 'P'                                  .
     c                   if        geffos > geffo2                              ...  .
     c                   eval      geffo2 = geffos                                .  .
     c                   eval      gefdat = wpdato                                .  .
     c                   eval      geftim = wptime                                .  .
     c                   update    gfaspfr                                        .  .
     c                   endif                                                  ...  .
     c                   if        gefdat <> wpdato                             ...  .
     c                             or geftim <> wptime                            .  .
     c                   eval      geffo2 = geffos                                .  .
     c                   eval      gefdat = wpdato                                .  .
     c                   eval      geftim = wptime                                .  .
     c                   update    gfaspfr                                        .  .
     c                   endif                                                  ...  .
     c                   eval      wpsekv = geffo2                                   .
     c                   endif                                                  ......
      *
      * Henter FELLES sekvensnummer ved overføring til DIRREM:
      *
     c                   if        gefefs = 'F'                                 ......
     c                             and wpvalg = 'O'                                  .
     c     geffin        chain     gustpf                             61             .
     c                   eval      wpsekv = gdusb1                                   .
     c                   endif                                                  ......
      *
      * Henter FELLES hjelpesekvensnummer, UTEN overføring:
      *
     c                   if        gefefs = 'F'                                 ......
     c                             and wpvalg = 'P'                                  .
     c     geffin        chain     gustpf                             61             .
     c                   if        gdusb1 > gdusb2                              ...  .
     c                   eval      gdusb2 = gdusb1                                .  .
     c                   eval      gdudat = wpdato                                .  .
     c                   eval      gdutim = wptime                                .  .
     c                   update    gustpfr                                        .  .
     c                   endif                                                  ...  .
     c                   if        gdudat <> wpdato                             ...  .
     c                             or gdutim <> wptime                            .  .
     c                   eval      gdusb2 = gdusb1                                .  .
     c                   eval      gdudat = wpdato                                .  .
     c                   eval      gdutim = wptime                                .  .
     c                   update    gustpfr                                        .  .
     c                   endif                                                  ...  .
     c                   eval      wpsekv = gdusb2                                   .
     c                   endif                                                  ......
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for å oppdatere sekvensnummer.                        *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     xsiste        begsr
      *
      * Oppdaterer DAGLIG og EGET sekvensnummer ved overføring DIRREM:
      *
     c                   if        wpvalg = 'S'                                 .......
      ***********GAFIRM    CHAINGFASPF               61          .
     c     wpfirm        chain     gfaspf                             61              .
     c                   if        *in61 = *off                                 ..... .
     c                   eval      gefdas = wpdagl                                  . .
      * Oppdaterer EGET sekvensnummer:                         . .
     c                   if        gefefs = 'E'                                 ... . .
     c                   eval      geffos = wpsekv                                . . .
     c                   endif                                                  ... . .
     c                   update    gfaspfr                                          . .
     c                   endif                                                  ..... .
     c                   endif                                                  .......
      *
      * Oppdaterer EGET hjelpesekvensnummer UTEN overføring:
      *
      *
      * Henter opp faste opplysninger.
      *
      ***********GAFIRM    CHAINGFASPF               61
     c     wpfirm        chain     gfaspf                             61
      *
     c                   if        *in61 = *off                                 ......
     c                             and gefefs = 'E'                                  .
     c                             and wpvalg = 'T'                                  .
     c                   eval      geffo2 = wpsekv                                   .
     c                   update    gfaspfr                                           .
     c                   endif                                                  ......
      * Dummy:
     c                   if        *in61 = *on                                  ......
     c                             and gefefs = 'E'                                  .
     c                   unlock    gfaspf                                            .
     c                   endif                                                  ......
      *
      * E L L E R
      *
      * Oppdaterer FELLES sekvensnummer ved overføring til DIRREM
      * dersom WPVALG er "S", og hjelpefelt for sekvensnummer når
      * WPVALG er "T".
      *
     c                   if        gefefs = 'F'                                 ......
     c     geffin        chain     gustpf                             61             .
     c                   if        wpvalg = 'S'                                 ...  .
     c                   eval      gdusb1 = wpsekv                                .  .
     c                   else                                                     .  .
     c                   eval      gdusb2 = wpsekv                                .  .
     c                   endif                                                  ...  .
     c                   if        *in61 = *off                                 ...  .
     c                   update    gustpfr                                        .  .
     c                   else                                                     .  .
     c                   unlock    gustpf                                         .  .
     c                   endif                                                  ...  .
     c                   endif                                                  ......
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     *inzsr        begsr
      *
      * Parameterliste
      *
     c     *entry        plist
     c                   parm                    wpfgrp
     c                   parm                    wpfirm
     c                   parm                    wpride
     c                   parm                    wpbfnr
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
      *
     c                   eval      wpin12 = 0
      *
      * Variabler som brukes ved sletting av batch.
      *
     c                   eval      wpfler = *blanks
     c                   eval      wpslet = *blanks
     c                   eval      a1slpo = 0
      *
     c                   eval      wpendr = *blanks
      *
     c                   eval      spge01 = 0
     c                   eval      srrn01 = 0
     c                   eval      spge02 = 0
     c                   eval      srrn02 = 0
     c                   eval      w_arow = 4
     c                   eval      w_acol = 26
     c                   eval      wpin03 = 0
     c                   eval      wpin12 = 0
      *
      *
      *
      *
      * Definering av parameterliste:
      *
      *
      * Key for file GU99L1
      *
     c     key01         klist
     c                   kfld                    wpfgrp
     c                   kfld                    wpfirm
     c                   kfld                    wpbfnr
     c                   kfld                    wpride
      *
      * Key for GU-filer:
      *
     c     key02         klist
     c                   kfld                    wpfgrp
     c                   kfld                    wpfirm
     c                   kfld                    wpride
     c                   kfld                    wpbfnr
      *
E5.00 * Key for file GUBFL8 for å vise poster for forslaget.
      *
     c     key03         klist
     c                   kfld                    wpfirm
     c                   kfld                    wpbfnr
      *
E5.00 * Key for file GUBFL8 for å vise info om en eksakt transaksjon.
      *
     c     key04         klist
     c                   kfld                    wpfirm
     c                   kfld                    wpbfnr
     c                   kfld                    r2bfli
      *
      * Key for file transaksjoner; RLTRPF
      *
     c     key05         klist
     c                   kfld                    wpfirm
     c                   kfld                    galevr
S5.00c*                  kfld                    gabilÅ
S5.00c*                  kfld                    gabilm
S5.00c*                  kfld                    gabild
T5.00c                   kfld                    gabdat
S5.00c*                  kfld                    gatell
T5.00c                   kfld                    gatist
      *
E5.00 * Key for file forslagfile GUBFL8 v.h.a. verdier fra GU04PF.
      *
     c     key06         klist
     c                   kfld                    wpfirm
     c                   kfld                    gddubf
     c                   kfld                    gddbfl
      *
E5.00 * Key for file forslagfile GUBFL8 v.h.a. verdier fra GU23PF.
      *
     c     key07         klist
     c                   kfld                    wpfirm
     c                   kfld                    gdlubf
     c                   kfld                    gdlbfl
      *
E5.00 * Key for å initierer posisjonering mot file GUBFL8 v/ROLL:
      *
     c     key08         klist
     c                   kfld                    wpfirm
     c                   kfld                    wpbfnr
     c                   kfld                    wplinj
      *
      *
     c                   endsr
      *
