# Explanation of RPG Source Code (Program: EL600R)

This ILE RPG program is designed for IBM i (AS/400) systems, and its main function is to handle user parameter entry and validation for generating a "bonusgrunnlag" (bonus basis) report, likely in a vendor/bonus accounting context. The code is commented in Norwegian, and the documentation gives an overview of indicator usage, program purpose, and change history.

Let's break down the main sections for easier onboarding:

---

## 1. Header and Attributes

```rpg
h datedit(*dmy) option(*nodebugio)
```
- `datedit(*dmy)`: Dates are in Day-Month-Year format.
- `option(*nodebugio)`: Debug input/output is not generated.

---

## 2. Files Declaration

```rpg
fvbotl1    if   e           k disk    rename(vbotpfr:vbotl1r)
fel600d    cf   e             workstn
```
- `vbotl1`: Physical file for bonus type (`vatbot`), renamed record format.
- `el600d`: Display file for workstation I/O, with the format to interact with the user.

---

## 3. Data Definitions

Numerous fields are defined for parameters, temporary variables, and display/work storage:

- **Selection Criteria**
  - `waar`, `wmnd`, `wpakod`, `wpdat1`: Selection period/year, month, package code, date.
- **Partner/Vendor Parameters**
  - `p_kund`: Vendor/customer number.
  - `p_in03`, `p_stat`, `p_kode`, `p_tx30`: Assorted status, code and text fields.
- **Bonus Type**
  - `w_tbot`: Bonus type code.
  - `w_tbes`: Bonus type description.
- **Firm/Company**
  - `w_firm`: Firm number.
- **Parameter Storage**
  - `paarf`, `paart`, `palt1`, `plnrf`, `plnrt`, `ptbot`: Various report parameters, mapped from screen fields.
- **Indicator and Message Fields**
  - `var`: Array with messages for warnings (Norwegian: "Varsel m/svarkrav").
  - `wsavli`, `wsavpo`: Window/message location on the screen.

---

## 4. Indicator Use

Extensive documentation on how indicators are used—these are the classic RPG “*INxx” values to control program logic and screen fields, e.g.:
- `*inkc` (KC): Exit
- `*inlr` (LR): End of job
- Indicators 31–59: Error/warning message triggers
- Indicators 60–69: File indicators, etc.

---

## 5. Main Program Logic

### Main Entry

```rpg
c     dummy         tag
```
Dummy tag, possibly a placeholder or for debugging.

---

### User Input and Validation (A2BLD screen)

```rpg
c     a2tagb        tag
c                   exfmt     a2bld
```
- Displays the A2BLD screen format for parameter entry.

#### Reset Error Indicators
Clears relevant error/warning indicators (31, 32, 33, 35, 36, 40, 41).

#### Exit Handling
If exit (`*inkc`) is pressed:
- Sets `p_in03` to '1'
- Jumps to program end (`xslutt`).

#### Inquiry Handling
If inquiry (`*inkd`) is pressed:
- Calls subroutine `spr_rut` (e.g., for vendor/bonus type lookups).
- Returns to parameter entry loop.

#### Parameter Validations
- **Year Validation**: If entered year (`a2brar`) > system year, shows warning and asks for confirmation using a modal window (`xm1win`).
- **Vendor Range**: If "from" value > "to" value on vendor range, sets error indicator.
- **Bonus Type**: If bonus type is entered, CHAINs (lookups) in file for validity; on failure, sets error indicator.
- **Report Option**: Checks that alternative report code (`a2alt1`) is '0' or '1'.

#### Storing Parameters for Further Processing

Values entered by the user are moved into the program parameter fields (`paarf`, `paart`, `palt1`, etc.).

---

### Program End and Cleanup

```rpg
c     xslutt        tag
c                   eval      *inlr = *on
c                   return
```
Sets last record indicator and returns, ending the program.

---

## 6. Subroutines

### Vendor and Bonus Type Lookup (`spr_rut`)
Handles the logic for "prompt" (lookup) actions on:
- Vendor "from" and "to" fields: Calls `RL500R` to perform vendor lookup, returning selected value.
- Bonus type: Calls `VA565R` to perform bonus type lookup.

Indicator 57 or 58 is set to identify which prompt was chosen.

---

### Message/Confirmation Window (`xm1win`)
Displays a message window (e.g., warning for next year's period), captures user response, and sets reply accordingly (e.g., user presses exit to answer "No").

---

### Initialization Subroutine (`*inzsr`)
Handles program startup:
- Parameter list: Receives `p_in03`.
- Zeros out temporary fields.
- Sets up bonus type key fields.
- Moves firm number from a parameter field.
- Sets vendor range defaults (`a2plnf` = 0, `a2plnt` = 999999).
- Sets input flag for status.

---

## 7. CTDATA for Messages

At the end, a message block for the warning about period selection is provided for use in the warning window.

```
Valgt periode er neste år.
Bekreft dersom dette er riktig.
```

---

## 8. General Flow

1. **Initialize**: Set up working variables, get input parameters.
2. **Display Parameter Screen**: Allow user to enter/modify report parameters.
3. **Validate Inputs**: Year, vendor range, bonus type, and report option.
    - If an error or confirmation is needed, handle accordingly.
    - If user requests lookup, call appropriate subroutine.
4. **Store Parameters**: Once validated, transfer them to work variables for downstream processing (not shown in this code).
5. **Exit**: Set `*INLR` to end the program.

---

## 9. Summary

- **Program purpose**: Collect and validate user parameters for a bonus report and exit or continue as appropriate.
- **Key features**: Screen display, parameter validation, file lookups, subroutines for lookups and message display, prompt for confirmation if selection period is for the next year.
- **Indicators**: Used extensively for controlling display, error highlighting, and user responses.

---

## 10. Onboarding Tip

- Study the display file (`EL600D`) to understand the UI flow.
- Check the physical files—especially `VBOTL1`—for bonus types.
- Understand how subroutine lookups (`RL500R`, `VA565R`) return values.
- Trace indicator usage for error handling and workflow control.

This structure is typical of legacy RPG applications: heavily screen-driven, indicator-based, and using subroutines for modular actions. It’s designed for data entry clerks/office staff working on green screen interfaces and ensures data is valid before parameter-driven reports/processes are generated.