     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOFAK
      * Program . . . . : FO101R
      * Beskrivelse . . : Registrering av tilbud/ordre, Opplysninger
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      * R3.10 221299 AMD  Lagt inn kontroll på gyldig avdeling
      * R3.11 140900 AMD  Skrevet om til ny standard (avvik ikke anm.)
3.31  * R3.31 280301 AMD  Lagt inn mulighet for å styre om rabatter skal
      *                   vises med prosent, eller som bare et nettobeløp.
5.40  * R5.40 060605 AMD  Ved endring av lager på ordrehode, skal ordre
5.40  *                   linjer oppdateres med valg om hvilke.
5.41  * R5.41 010306 AMD  Korrigering av feil i parameterliste ved
      *                   spørring på prosjektnummer (Regnskapsprosj.)
5.42  * R5.42 040706 AMD  Endring av momskoder på linjenivå dersom
      *                   ordrehode endres fra pliktig til fritt eller
      *                   motsatt
5.43  * R5.43 060307 BOF  Mulighet til å overstyre fakturatype
5.60  * R5.60 090108 BOF  Mulighet til å overstyre kjørerute
5.61  * R5.61 220508 AMD  Mulighet til å legge inn depositum
5.70  * PRGR  081208 bof  Utvidet med prisgruppe
5.71  * PRGR  130509 bof  Sjekker om noen varelinjer har vtyp lik S på
      * 6.10  240609 BSA  Oppdatert med sporingsinformasjon
5.71  * PRGR  170609 bof  Fjernet 5.71 sjekken foreløbig.
6.11  * R6.10 021210 BSA  Behandler kort via F10 (bilde2), samt call til
6.11  *                   nytt visningspgm for kortinfo.
6.12  * R6.10 180711 BSA  Sjekker om kort er registrert på kunden. Hvis ikke
6.12  *                   kan ikke kode legges inn på koden.
6.13  * R6.10 150512 BSA  Innført GE Kort
6.20  * 6.20  121110 nho  Fjernet akt., konto og spes.  Lagt inn under-
      *                   prosjekt
6.21  * 6.20  231110 bof  Sjekker alltid leveringsmåte
6.22  * 6.20  230211 bsa  Utvider avdelingstekst fra 20 til 30 posisjoner
6.23  * 6.20  190311 nho  Vise S-varer dersom lager er endret          er
6.24  * 6.20  101111 bof  Sjekker også behandling av skaffevare FAALBE
6.25  * 6.20  131212 bof  Forsend.måte skal kun være krav hvis kjørekontor
6.26  * 6.20  141013 bkv  Forsend.måte skal kun være krav hvis kjørekontor, men hvis kode utfylt
      *                   så må den være gyldig
6.27  * 6.20  090914 bsa  Fjernet krav til kreditkort på F10 vedlikehold.
6.30  * 6.30  160214 bof  Validering av leveringsmåte ifølge AVALPF
6.NU  * R6.30 230514 bsa  Programmet gjennomgått mtp nummerutvidelser.
6.31  * 6.30  290915 bof  Validering av selger  ifølge AVALPF
6.32  * 6.30  020616 bof  Validering depositum, kan ikke være høyere enn ordrebel m/mva.
6.33  * 6.30  050417 bof  Hvis endring av avg.kode så endre momsk.på varen
7.xx  * 7.00  210116 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
7.01  * 7.00  191119 bkv  Endret datoformat til Newlook std
7.02  * 7.00  070220 nho  Sjekk mot SDEPPF om ordrenr, kundenr finnes
7.02  * 7.00  070220      slett post
7.03  * 7.00  190320 bkv  Lagt inn unlock på 7.02 endring
7.04  * 6.30  211117 sst  Lagt på spørring på aktivitet
7.05  * K000  210121 bsa  Feil i parameterlista til RP601.
      *
7.fb  * 7.00  040419 bsa  Depositumsløsning, så ingen input.
8.01  *       050122 bof  lagt inn ekstra test ved årskiftet
8.02  *       250522 sst  Endre 'GE Kort' til Santander
8.03  *K0000  110523 bsa  Hvis dette er tilbud, skal ikke depositum
8.03  *K0000              være tilgjengelig.
8.05  *PRG2   090622 BOF  Utvidet prisgruppe fra 1 til 2 posisjoner
8.06  *K000   210225 bsa  Hvis endring av avdeling på hodet, må dette også endre
8.06  *K000               linjer.
8.07  *K000   160525 bsa  Hvis endring av avdeling på hodet, ta med alle varelinjer
8.07  *K000               uten avdeling også.
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     ffo101d    cf   e             workstn
     ffohel1    if   e           k disk    rename(fohepfr:fohel1r)
     ffohelu    uf   e           k disk    rename(fohepfr:fohelur)
5.42 ffodtlu    uf   e           k disk    rename(fodtpfr:fodtlur)
5.42 fvltyl1    uf   e           k disk    rename(vltypfr:vltyl1r)
5.42 fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
5.43 ffmftl1    if   e           k disk    rename(fmftpfr:fmftl1r)
7.02 f*sdepl1    if   e           k disk    rename(sdeppfr:sdepl1r)
7.02 fsdepl1    uf   e           k disk    rename(sdeppfr:sdepl1r)
5.61 fsdeplu    uf a e           k disk    rename(sdeppfr:sdeplur)
5.71 ffodtl1    if   e           k disk    rename(fodtpfr:fodtl1r)
5.71 fvlagl1    if   e           k disk    rename(vlagpfr:vlagl1r)
6.11 fruksl1    if   e           k disk    rename(rukspfr:ruksl1r)
6.12 frukrl5    if   e           k disk    rename(rukrpfr:rukrl5r)
6.24 ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
7.fb ffst2l1    if   e           k disk    rename(fst2pfr:fst2l1r)
6.30 favall1    if   e           k disk    rename(avalpfr:avall1r)
6.33 fvmval1    if   e           k disk    rename(vmvapfr:vmval1r)
8.03 fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
      *
      * Definering av Local data area
      *
     d                uds
5.61 d l_wsid                901    910
5.61 d l_user                911    920
     d l_sfir                944    946  0
     d l_fnav                951    980
     d l_syst                999    999
      *
      * Definering av data struktur for lev.bet.tekst
      *
     d                 ds
     d d_lbtx                        75
     d  d_ltx1                       25    overlay(d_lbtx)
     d  d_ltx2                       25    overlay(d_lbtx:26)
     d  d_ltx3                       25    overlay(d_lbtx:51)
      *
      * Definering av parametere
      *
     d p_firm          s                   like(fofirm)
     d p_numm          s                   like(fonumm)
     d p_suff          s                   like(fosuff)
6.11 d p_kund          s                   like(fokund)
6.11 d p_kpro          s                   like(fokpro)
6.11 d p_kftp          s              2  0
6.11 d p_ktsq          s              4  0
      *
7.02 d w_oyear         s              4  0
7.02 d w_dyear         s              4  0
      * Definering av variable i nøkler
      *
6.20 d w_kund          s                   like(fokund)
     d w_firm          s                   like(fofirm)
     d fohel1_numm     s                   like(fonumm)
     d fohel1_suff     s                   like(fosuff)
5.42 d fodtlu_numm     s                   like(fdnumm)
5.42 d fodtlu_suff     s                   like(fdsuff)
5.42 d vltyl1_ltyp     s                   like(valtyp)
5.42 d vvarl1_vare     s                   like(vvvare)
5.43 d fmftl1_tfat     s                   like(fmtfat)
5.61 d sdepl1_numm     s                   like(sknumm)
5.61 d sdepl1_kund     s                   like(skkund)
7.fb d sdepl1_tell     s                   like(sktell)
5.61 d sdeplu_numm     s                   like(sknumm)
5.61 d sdeplu_kund     s                   like(skkund)
7.fb d sdeplu_tell     s                   like(sktell)
5.71 d fodtl1_numm     s                   like(fdnumm)
5.71 d fodtl1_suff     s                   like(fdsuff)
5.71 d vlagl1_vare     s                   like(vlvare)
5.71 d vlagl1_lage     s                   like(vllage)
6.11 d ruksl1_skty     s                   like(ruskty)
6.11 d ruksl1_slag     s                   like(ruslag)
6.12 d rukrl5_ktyp     s                   like(ruktyp)
6.12 d rukrl5_kkun     s                   like(rukkun)
6.12 d rukrl5_kpro     s                   like(rukpro)
6.30 d avall1_apgm     s                   like(avapgm)
6.33 d vmval1_mkod     s                   like(vamkod)
8.03 d votyl1_otyp     s                   like(vaotyp)
      *
      * Definering av variable
      *
     d w_alf1          s              1
3.10 d w_jadr          s             30
3.10 d w_jpnr          s              4  0
3.10 d w_jste          s             30
3.10 d w_javd          s              4  0
6.20 d*w_akti          s              3
6.20 d w_upro          s              6
6.20 d w_rupr          s              1
7.04 d w_akti          s              6
6.20 d*w_kont          s              5  0
6.20 d*w_spes          s              4  0
     d w_retk          s              1
     d w_cbda          s               d   datfmt(*iso)
     d w_cfda          s               d   datfmt(*iso)
5.40 d w_valg          s              1
5.70 d w_pval          s              1
5.40 d w_in03          s              1
6.11 d w_alt1          s             25
6.11 d w_alt2          s             25
6.11 d w_alt3          s             25
6.11 d w_alt4          s             25
6.11 d w_alt5          s             25
6.11 d w_alt6          s             25
6.11 d w_alt7          s             25
6.11 d w_alt8          s             25
6.11 d w_kort          s              1
6.12 d w_ktyp          s              1
      *
     d w_ikod          s              4  0
     d w_jkod          s              2  0
     d w_qkod          s              2  0
     d w_ukod          s              3
5.60 d w_ykod          s              2  0
     d w_itxt          s                   like(c2setx)
     d w_jtxt          s                   like(c2latx)
     d w_qtxt          s                   like(c2lmtx)
6.20 d*w_utxt          s                   like(c3aktx)
5.60 d w_ytxt          s                   like(c2kjtx)
     d w_gtxt          s                   like(c2avtx)
     d w_ptxt          s                   like(c2vatx)
     d w_vtxt          s                   like(c2sptx)
     d w_ctx1          s                   like(c2btx1)
     d w_ctx2          s                   like(c2btx2)
6.20 d*w_ktx1          s                   like(c3kotx)
6.20 d*w_ktx2          s                   like(c3kotx)
     d w_ptx1          s                   like(c3prtx)
6.20 d w_utx1          s                   like(c3prtx)
6.20 d w_utx2          s                   like(c3prtx)
6.20 d w_uprs          s              1
6.20  *w_uprs Skal dette prosjekt deles i underprosjekt?
     d w_ptx2          s                   like(c3prtx)
     d w_ptx3          s                   like(c3prtx)
     d w_rtx1          s                   like(c2ltx1)
     d w_rtx2          s                   like(c2ltx2)
     d w_rtx3          s                   like(c2ltx3)
7.04 d w_atx1          s                   like(c3prtx)
7.04 d w_atx2          s                   like(c3prtx)
     d w_lage          s                   like(folage)
     d w_proj          s                   like(foproj)
     d w_avde          s                   like(foavde)
     d w_pdat          s               d   datfmt(*iso)
     d w_pomr          s             10  6
     d w_toti          s                   like(fototr)
7.05 d w_fdat          s              6  0
7.05 d w_tdat          s              6  0
7.05 d w_kunf          s              6  0
7.05 d w_knav          s             30
7.05 d w_kpro          s              6  0
7.05 d w_selg          s              4  0
      *
8.06 d s_avde          s                   like(foavde)
      *
6.30  * Firmastyrt validering av felt
6.30  *
6.30 d u_lmat          s              1    inz(*off)
6.31 d u_selg          s              1    inz(*off)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * C2 Behandler vedlikehold av faste ordreopplysninger      I
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     c2taga        tag
      *
      * Hent opplysninger fra ORDRE-HODE-REGISTER
      *
     c     fohel1_key    chain     fohel1r                            90
     c                   if        *in90 = *off
     c                   eval      c2mkod = fomkod
3.31 c                   eval      c2neto = foneto
     c                   eval      c2avde = foavde
8.06 c                   eval      s_avde = foavde
     c                   eval      c2selg = foselg
     c                   eval      c2lage = folage
     c                   eval      w_lage = folage
     c                   eval      c2betb = fobetb
KOB  c                   eval      c2rabp = forabp
5.43 c                   eval      c2faty = fofaty
     c                   eval      c2valk = fovalk
     c                   eval      c2sped = fosped
     c                   eval      c2lmat = folmat
     c                   eval      c2lmtx = folmtx
     c                   eval      c2lbet = folbet
     c                   eval      d_lbtx = folbtx
     c                   eval      c2ltx1 = d_ltx1
     c                   eval      c2ltx2 = d_ltx2
     c                   eval      c2ltx3 = d_ltx3
5.60 c                   eval      c2kjor = fokjor
5.60 c                   eval      c2kjnr = fokjnr
     c                   endif
8.03  * Hvis tilbud, ikke åpne felt for depositum.
8.03 c                   eval      votyl1_otyp = footyp
8.03 c     votyl1_key    chain     votyl1r
8.03 c                   if        %found and
8.03 c                             vaoakk = 0
8.03 c                   eval      *in50 = *on
8.03 c                   endif
5.61  *
5.61  * Hent opplysninger fra Depositum-fil
5.61  *
7.02  *
7.02 c                   eval      w_oyear=%subdt(fobdat:*years)
7.02  *
5.61 c                   eval      sdepl1_numm = fonumm
5.61 c                   eval      sdepl1_kund = fokund
7.fb c                   eval      sdepl1_tell = 0
5.61 c     sdepl1_key    chain     sdepl1r
5.61 c                   if        %found
7.02 c                   eval      w_dyear=%subdt(skodat:*years)
7.02 c                   if        w_oyear = w_dyear
5.61 c                   eval      c2depo = skdepo
5.61 c                   eval      c2depb = skdepb
5.61 c                   eval      c2dept = skdept
7.03 c                   unlock    sdepl1
8.01 c                   else
8.01  * sjekk neste år på ordredato (i tilfelle årsskifte)
8.01 c                   eval      w_oyear = w_oyear + 1
8.01 c                   if        w_oyear = w_dyear
8.01 c                   eval      c2depo = skdepo
8.01 c                   eval      c2depb = skdepb
8.01 c                   eval      c2dept = skdept
8.01 c                   unlock    sdepl1
     c                   else
7.02 c                   delete    sdepl1r
5.61 c                   endif
8.01 c                   endif
7.02 c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandler henting av opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Hent,   Tekst for avdeling
      *
     c                   exsr      sbavde
      *
      * Hent,   Tekst for selger
      *
     c                   exsr      sbselg
      *
      * Hent,   Tekst for lager
      *
     c                   exsr      sblagr
      *
      * Hent,   Tekst for betalingsbetingelser
      *
     c                   exsr      sbbetb
      *
      * Hent,   Tekst for valuta
      *
     c                   exsr      sbvalk
      *
      * Hent,   Tekst for speditør
      *
     c                   exsr      sbsped
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandler skjermbilde  C2
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Send alt
      *
5.40 c                   eval      w_valg = ' '
5.70 c                   eval      w_pval = ' '
5.40 c                   eval      w_in03 = ' '
5.40  *
     c     c2tagb        tag
     c                   exfmt     c2bld
      *
      * F3=Avslutt subprogram
      *
     c     *inkc         cabeq     *on           xslutt
      *
      * F4=Spørring kan benyttes dersom
      *    ASOKON kjøres.
      *
     c                   if        l_syst = 'A'
     c                   if        *inkd  = *on
     c                   if        w_arcd = 'C2BLD'
      *
      * Call program for avdeling
      *
     c                   if        w_afld = 'C2AVDE'
     c                   call      'RA507R'
     c                   parm                    p_firm
     c                   parm                    w_avde
     c                   parm                    w_gtxt
     c                   if        w_avde <> 0
     c                   eval      c2avde = w_avde
     c                   eval      c2avtx = w_gtxt
     c                   endif
     c                   goto      c2tagb
     c                   endif
      *
      * Call program for selger
      *
     c                   if        w_afld = 'C2SELG'
     c                   call      'RA509R'
     c                   parm                    p_firm
     c                   parm                    w_ikod
     c                   parm                    w_itxt
     c                   if        w_ikod <> 0
     c                   eval      c2selg = w_ikod
     c                   eval      c2setx = w_itxt
     c                   endif
     c                   goto      c2tagb
     c                   endif
      *
      * Call program for lager
      *
     c                   if        w_afld = 'C2LAGE'
     c                   call      'RA510R'
     c                   parm                    p_firm
     c                   parm                    w_jkod
     c                   parm                    w_jtxt
     c                   if        w_jkod <> 0
     c                   eval      c2lage = w_jkod
     c                   eval      c2latx = w_jtxt
     c                   endif
     c                   goto      c2tagb
     c                   endif
      *
      * Call program for leveringsmåte
      *
     c                   if        w_afld = 'C2LMAT'
     c                   call      'RA517R'
     c                   parm                    p_firm
     c                   parm                    w_qkod
     c                   parm                    w_qtxt
     c                   if        w_qkod <> 0
     c                   eval      c2lmat = w_qkod
     c                   eval      c2lmtx = w_qtxt
     c                   endif
     c                   goto      c2tagb
     c                   endif
5.60  *
5.60  * Call program for kjørerute
5.60  *
5.60 c                   if        w_afld = 'C2KJOR'
5.60 c                   call      'RA525R'
5.60 c                   parm                    p_firm
5.60 c                   parm                    w_ykod
5.60 c                   parm                    w_ytxt
5.60 c                   if        w_ykod <> 0
5.60 c                   eval      c2kjor = w_ykod
5.60 c                   eval      c2kjtx = w_ytxt
5.60 c                   endif
5.60 c                   goto      c2tagb
5.60 c                   endif
      *
      *
     c                   endif
     c                   endif
     c                   endif
      *
      * Fange opp F4 på felter uten spørremulighet
      *
     c                   if        *inkd  = *on
     c                   goto      c2tagb
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandler sjekking av opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
      * Sjekk,  Finnes avdeling i KODE-REGISTER
      *
     c                   eval      c2avtx = *blank
     c                   if        c2avde <> *zero
     c                   exsr      sbavde
     c                   if        w_retk <> *blank
     c                   eval      *in32 = *on
     c                   goto      c2tagb
     c                   endif
     c                   endif
      *
      * Sjekk,  Finnes selger i KODE-REGISTER
      *
6.31  * Sjekk,  Er det krav til selger
6.31 c                   if        u_selg = *on and
6.31 c                             c2selg =  0
6.31 c                   eval      *in33 = *on
6.31 c                   goto      c2tagb
6.31 c                   endif
     c                   eval      c2setx = *blank
     c                   if        c2selg <> *zero
     c                   exsr      sbselg
     c                   if        w_retk <> *blank
     c                   eval      *in33 = *on
     c                   goto      c2tagb
     c                   endif
     c                   endif
      *
      * Sjekk,  Finnes lager i KODE-REGISTER
      *
     c                   eval      c2latx = *blank
     c                   exsr      sblagr
3.10 c                   if        w_retk = '1'
     c                   eval      *in34 = *on
     c                   goto      c2tagb
     c                   endif
      *
      * Sjekk,  Finnes betalingsbetingelser i KODE-REGISTER
      *
     c                   eval      c2btx1 = *blank
     c                   eval      c2btx2 = *blank
     c                   if        c2betb <> *zero
     c                   exsr      sbbetb
     c                   if        w_retk <> *blank
     c                   eval      *in35 = *on
     c                   goto      c2tagb
     c                   endif
     c                   endif
5.43  *
5.43  * Sjekk,  Finnes fakturatype
5.43  *
5.43 c                   if        c2faty <> 0
5.43 c                   eval      fmftl1_tfat = c2faty
5.43 c     fmftl1_key    chain     fmftl1
5.43 c                   if        not %found(fmftl1)
5.43 c                   eval      *in41 = *on
5.43 c                   goto      c2tagb
5.43 c                   endif
5.43 c                   endif
5.43 c
      *
      * Sjekk,  Finnes valutakode i KODE-REGISTER
      *
     c                   eval      c2vatx = *blank
     c                   if        c2valk <> *blank
     c                   exsr      sbvalk
     c                   if        w_retk <> *blank
     c                   eval      *in36 = *on
     c                   goto      c2tagb
     c                   endif
     c                   endif
      *
      * Sjekk,  Finnes speditør i KODE-REGISTER
      *
     c                   eval      c2sptx = *blank
     c                   if        c2sped <> *zero
     c                   exsr      sbsped
     c                   if        w_retk <> *blank
     c                   eval      *in37 = *on
     c                   goto      c2tagb
     c                   endif
     c                   endif
      *
      * Sjekk,  Finnes forsendelsesmåtekode i KODE-REGISTER
      *
6.30  * Sjekk,  Er det krav til Leveringsmåte
6.30 c                   if        u_lmat = *on and
6.30 c                             c2lmat =  0
6.30 c                   eval      *in38 = *on
6.30 c                   goto      c2tagb
6.30 c                   endif
6.30  *
6.26 c                   if        c2lmat <> *zero
6.26 c                   if        c2lmat <> folmat
6.26 c                   exsr      sbform
6.26 c                   if        w_retk <> *blank
6.26 c                   eval      *in38 = *on
6.26 c                   goto      c2tagb
6.26 c                   endif
6.26 c                   endif
6.26 c                   endif
6.26 c
6.26 c                   if        faakjk = 1
6.26 c                   exsr      sbform
6.26 c                   if        w_retk <> *blank
6.26 c                   eval      *in38 = *on
6.26 c                   goto      c2tagb
6.26 c                   endif
6.26 c                   endif
      *
      * Sjekk,  Finnes leveringsbetingelseskode i KODE-REGISTER
      *
     c                   if        c2lbet <> *zero
     c                   if        c2lbet <> folbet
     c                   exsr      sblevb
     c                   if        w_retk <> *blank
     c                   eval      *in40 = *on
     c                   goto      c2tagb
     c                   endif
     c                   endif
     c                   endif
5.60  *
5.60  * Sjekk,  Finnes kjørerute  i KODE-REGISTER
5.60  *
5.60 c                   if        c2kjor <> *zero
5.60 c                   if        c2kjor <> fokjor
5.60 c                   exsr      sbkjor
5.60 c                   if        w_retk <> *blank
5.60 c                   eval      *in48 = *on
5.60 c                   goto      c2tagb
5.60 c                   endif
5.60 c                   endif
5.60 c                   endif
6.23  *
6.23  * Viser S-vare dersom lager er endret
6.23  * styres av kontroll mot skaffevarer
6.23  *
6.23 c                   if        faalbe > 0
5.40 c                   if        folage <> 0 and
5.40 c                             c2lage <> folage
6.23 c                   call      'FO577R'
6.23 c                   parm                    p_firm
6.23 c                   parm                    p_numm
6.23 c                   parm                    p_suff
6.23 c                   parm                    c2lage
6.24 c                   parm                    w_retk
6.24 c                   if        w_retk = '1' and
6.24 c                             faalbe > 1
6.24 c                   goto      c2tagb
6.24 c                   endif
6.23 c                   endif
6.24 c                   endif
6.32  *
6.32  * Valider depositum, må ikke være større enn ordrebeløp.
6.32  *
6.32 c                   if        c2depo <> 0
6.32 c                   exsr      hent_toti
6.32 c                   if        c2depo > w_toti
6.32 c                   eval      *in42 = *on
6.32 c                   goto      c2tagb
6.32 c                   endif
6.32 c                   endif
5.40  *
5.40  * Dersom lager er endret, skal varelinjer oppdateres.
5.40  * Kall opp program hvor det kan velges hva som skal
5.40  * oppdateres, alle linjer eller bare de med likt fra lager.
5.40  * (Bilde skal bare sendes ved endring, ikke ved ny ordre)
5.40  *
5.40 c                   if        folage <> 0
5.40 c                   if        c2lage <> folage
5.40 c                   call      'FO794R'
5.40 c                   parm                    w_valg
5.70 c                   parm                    w_pval
5.40 c                   parm                    w_in03
5.40  *
5.40  * Dersom F3, gå tilbake
5.40  *
5.40 c                   if        w_in03 = '1'
5.40 c                   goto      c2tagb
5.40 c                   endif
5.40 c                   endif
5.40 c                   endif
      *
      *
      *
      * Dersom noen valg er endret, sendt bilde pånytt
      *
     c                   if        c2avde <> foavde
     c                             or c2selg <> foselg
     c                             or c2lage <> folage
     c                             or c2betb <> fobetb
5.43 c                             or c2faty <> fofaty
KOB  c                             or c2rabp <> forabp
     c                             or c2valk <> fovalk
     c                             or c2sped <> fosped
     c                             or c2lmat <> folmat
     c                             or c2lbet <> folbet
5.60 c                             or c2kjor <> fokjor
5.61 c                             or c2depo <> skdepo
     c                   eval      foavde = c2avde
     c                   eval      foselg = c2selg
     c                   eval      folage = c2lage
     c                   eval      fobetb = c2betb
5.43 c                   eval      fofaty = c2faty
KOB  c                   eval      forabp = c2rabp
     c                   eval      fovalk = c2valk
     c                   eval      fosped = c2sped
     c                   eval      folmat = c2lmat
     c                   eval      folbet = c2lbet
5.60 c                   eval      fokjor = c2kjor
5.60 c                   eval      fokjnr = c2kjnr
5.61  *
5.61  * Oppdater Depositum-fil
5.61  *
5.61 c                   eval      sdeplu_numm = fonumm
5.61 c                   eval      sdeplu_kund = fokund
7.fb c                   eval      sdeplu_tell = 0
5.61 c     sdeplu_key    chain     sdeplur
5.61 c                   if        %found
5.61 c                   eval      skdepo = c2depo
6.10 c                   time                    skedat
6.10 c                   time                    sketim
6.10 c                   eval      skeusr = l_user
5.61 c                   update    sdeplur
5.61 c                   else
5.61 c                   eval      skfirm = w_firm
5.61 c                   eval      sknumm = fonumm
5.61 c                   eval      skkund = fokund
5.61 c                   eval      skdepo = c2depo
5.61 c                   eval      skdepb = 0
5.61 c                   eval      skdept = 0
5.61 c                   eval      skwsid = l_wsid
5.61 c                   eval      skuser = l_user
5.61 c                   time                    skdate
5.61 c                   time                    sktime
5.61 c                   if        skdepo <> 0
6.10 c                   time                    skodat
6.10 c                   time                    skotim
6.10 c                   eval      skousr = l_user
6.10 c                   time                    skedat
6.10 c                   time                    sketim
6.10 c                   eval      skeusr = l_user
5.61 c                   write     sdeplur
5.61 c                   endif
5.61 c                   endif
5.61  *
     c                   goto      c2tagb
     c                   endif
5.42  *
5.42  * Sjekk om momskode på ordrehode er endret
5.42  *
5.42 c                   if        c2mkod <> fomkod
5.42 c                   exsr      endr_mva
5.42 c                   endif
      *
      * Oppdaterer ORDRE-HODE-REGISTER
      *
     c     fohel1_key    chain     fohelur                            90
     c                   if        *in90 = *off
     c                   eval      fomkod = c2mkod
3.31 c                   eval      foneto = c2neto
     c                   eval      foavde = c2avde
     c                   eval      foselg = c2selg
     c                   eval      folage = c2lage
     c                   eval      fobetb = c2betb
5.43 c                   eval      fofaty = c2faty
KOB  c                   eval      forabp = c2rabp
     c                   eval      fovalk = c2valk
     c                   eval      fosped = c2sped
     c                   eval      folmat = c2lmat
     c                   eval      folmtx = c2lmtx
     c                   eval      folbet = c2lbet
5.60 c                   eval      fokjor = c2kjor
5.60 c                   eval      fokjnr = c2kjnr
     c                   eval      d_ltx1 = c2ltx1
     c                   eval      d_ltx2 = c2ltx2
     c                   eval      d_ltx3 = c2ltx3
     c                   eval      folbtx = d_lbtx
6.10 c                   time                    foedat
6.10 c                   time                    foetim
6.10 c                   eval      foeusr = l_user
     c                   update    fohelur
8.06  * Sjekk om det er tilkoblede linjer som skal oppdateres med "ny" avdeling
8.06  *
8.06 c                   if        foavde <> s_avde
8.06 c                   exsr      sjk_lines
8.06 c                   endif
8.06  *
     c                   endif
5.61  *
5.61  * Oppdaterer Depositum-fil
5.61  *
5.61 c                   eval      sdeplu_numm = fonumm
5.61 c                   eval      sdeplu_kund = fokund
7.fb c                   eval      sdeplu_tell = 0
5.61 c     sdeplu_key    chain     sdeplur
5.61 c                   if        %found
5.61 c                   eval      skdepo = c2depo
6.10 c                   time                    skedat
6.10 c                   time                    sketim
6.10 c                   eval      skeusr = l_user
     c                   update    sdeplur
     c                   endif
      *
     c                   if        folage <> w_lage
     c                   call      'FO732R'
     c                   parm                    w_firm
     c                   parm                    fohel1_numm
     c                   parm                    fohel1_suff
     c                   parm                    footyp
     c                   parm                    w_lage
5.40 c                   parm                    w_valg
5.70 c                   parm                    w_pval
     c                   endif
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * C3 Behandler vedlikehold av faste ordreopplysninger      II
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     c3taga        tag
      *
      * Hent opplysninger fra ORDRE-HODE-REGISTER
      *
     c     fohel1_key    chain     fohel1r                            90
     c                   if        *in90 = *off
      *
     c                   eval      c3fkda = 0
     c                   eval      c3ffda = 0
      *
     c                   if        fofkda <> *loval
     c     *dmy          move      fofkda        c3fkda
     c                   endif
      *
     c                   if        foffda <> *loval
     c     *dmy          move      foffda        c3ffda
     c                   endif
      *
     c                   eval      c3kref = fokref
     c                   eval      c3proj = foproj
6.20 c**                 eval      c3akti = foakti
6.20 c                   eval      c3upro = foupro
6.20 c**                 eval      c3kont = fokont
6.20 c**                 eval      c3spes = fospes
     c                   eval      c3ksob = foksob
     c                   eval      c3kgfa = fokgfa
     c                   eval      c3kgfr = fokgfr
     c                   eval      c3kgek = fokgek
     c                   eval      c3ldor = foldor
6.11 c                   eval      c3psuf = fopsuf
6.11 c                   if        c3psuf > 0
6.11 c                   exsr      kort_txt
6.11 c                   endif
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandler henting av opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Hent,   Tekst for prosjekt
      *
     c                   exsr      sbproj
      *
6.20  **Hent,   Tekst for aktivitet
      *
6.20 c**                 exsr      sbakti
6.20  * Hent,   Tekst for underprosjekt
      *
6.20 c                   exsr      sbupro
      *
      * Hent,   Tekst for konto
      *
6.20 c**                 exsr      sbkont
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandler skjermbilde  C3
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
      * Send alt
      *
     c     c3tagb        tag
     c                   exfmt     c3bld
      *
      * F3=Gå tilbake til forrige bilde
      *
     c     *inkc         cabeq     *on           c2taga
      *
      * F4=Spørring kan benyttes dersom
      *    ASOKON kjøres.
      *
     c                   if        l_syst = 'A'
     c                   if        *inkd  = *on
     c                   if        w_arcd = 'C3BLD'
      *
      * Call program for prosjekt
      *
     c                   if        w_afld = 'C3PROJ'
6.20 c                   call      'RP600R'
     c                   parm                    p_firm
     c                   parm                    w_proj
     c                   parm                    w_ptx1
     c                   parm                    w_uprs
      *
6.20 c                   if        w_proj <> *blanks
     c                   eval      c3proj = w_proj
6.20 c                   eval      c3upro = w_upro
6.20 c                   eval      c3upro = *blank
6.20 c                   eval      c3uptx = *blank
     c                   eval      c3prtx = w_ptx1
7.04 c                   if        w_uprs = 'J'
7.04 c                   eval      w_upro = *blanks
7.04 c                   eval      w_utx1 = *blanks
7.04 c                   eval      w_proj = c3proj
7.04 c                   eval      w_kund = fokund
7.04 c                   if        c3upro = *blank
7.04 c                   eval      c3uptx = *blanks
7.04 c                   endif
7.05 c                   eval      w_kunf = 0
7.05 c                   eval      w_fdat = 0
7.05 c                   eval      w_tdat = 0
7.05 c                   eval      w_selg = 0
7.05 c                   eval      w_kpro = 0
7.05 c                   eval      w_knav = *blanks
7.04 c                   call      'RP601R'
7.04 c                   parm                    p_firm
7.04 c                   parm                    w_proj
7.04 c                   parm                    w_upro
7.05 c                   parm                    w_rupr
7.04 c                   parm                    w_utx1
7.04 c                   parm                    w_utx2
7.04 c                   parm                    w_kund
7.05 c                   parm                    w_fdat
7.05 c                   parm                    w_tdat
7.05 c                   parm                    w_knav
7.05 c                   parm                    w_selg
7.05 c                   parm                    w_kunf
7.05 c                   parm                    w_kpro
7.04 c                   if        w_upro <> *blanks
7.04 c                   eval      c3upro = w_upro
7.04 c                   eval      c3uptx = w_utx1
7.04 c                   else
7.04 c                   eval      c3uptx = *blank
7.04 c                   endif
7.04 c                   endif
7.04 c                   else
7.04 c                   eval      c3prtx = *blank
     c                   goto      c3tagb
     c                   endif
7.02 c                   endif
      *
6.20  * Call program for underprosjekt
6.20  *
6.20 c                   if        w_afld = 'C3UPRO'
6.20 c                   eval      w_upro = *blanks
6.20 c                   eval      w_utx1 = *blanks
6.20 c                   eval      w_proj = c3proj
6.20 c                   eval      w_kund = fokund
6.20 c                   if        c3upro = *blank
6.20 c                   eval      c3uptx = *blanks
6.20 c                   endif
6.20 c                   call      'RP601R'
6.20 c                   parm                    p_firm
6.20 c                   parm                    w_proj
6.20 c                   parm                    w_upro
6.20 c                   parm                    w_utx1
6.20 c                   parm                    w_utx2
6.20 c                   parm                    w_kund
6.20 c                   if        w_proj <> *blanks
6.20 c                   eval      c3proj = w_proj
6.20 c                   eval      c3upro = w_upro
6.20 c                   eval      c3uptx = w_utx1
6.20 c                   eval      c3prtx = w_utx2
6.20 c                   else
6.20 c                   eval      c3prtx = *blank
6.20 c                   endif
6.20 c                   goto      c3tagb
6.20 c                   endif
      *
      * Call program for aktivitet
      *
7.04 c                   if        w_afld = 'C3AKTI'
7.04 c                   eval      w_proj = c3proj
7.04 c                   eval      w_upro = c3upro
7.04 c                   eval      w_atx1 = *blank
7.04 c                   eval      w_atx2 = *blank
7.04 c                   eval      w_akti = *blank
7.04 c                   call      'RP605R'
7.04 c                   parm                    p_firm
7.04 c                   parm                    w_proj
7.04 c                   parm                    w_upro
7.04 c                   parm                    w_atx1
7.04 c                   parm                    w_atx2
7.04 c                   parm                    w_kund
7.04 c                   parm                    w_akti
7.04 c                   if        w_akti <> *blank
7.04 c                   eval      c3akti = w_akti
7.04 c*                  eval      c3aktx = w_atx1
7.04 c                   endif
7.04 c                   goto      c3tagb
7.04 c                   endif
6.11  *
6.11  * Call program for kontokort
6.11  *
6.11 c                   if        w_afld = 'C3PSUF'
6.11  *
6.11 c                   eval      p_kund = fokund
6.11 c                   eval      p_kftp = *zero
6.11 c                   eval      p_ktsq = *zero
6.11  *
6.11 c                   call      'FM501R'
6.11 c                   parm                    p_firm
6.11 c                   parm                    p_kund
6.11 c                   parm                    p_kpro
6.11 c                   parm                    p_kftp
6.11 c                   parm                    p_ktsq
6.11  *
6.11 c                   if        p_kftp <> 0
6.11 c                   eval      c3psuf = p_kftp
6.11 c                   exsr      kort_txt
6.11 c                   endif
6.11 c                   goto      c3tagb
6.11 c                   endif
      *
     c                   endif
     c                   endif
     c                   endif
      *
      * Fange opp F4 på felter uten spørremulighet
      *
     c                   if        *inkd  = *on
     c                   goto      c3tagb
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandler sjekking av opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
      * Sjekk,  Fakturadato
      *
     c                   if        c3fkda <> *zero
     c     *dmy          test(d)                 c3fkda                 31
     c                   if        *in31 = *on
     c                   goto      c3tagb
     c                   endif
     c                   endif
      *
      * Sjekk,  Forfallsdato
      *
     c                   if        c3ffda <> *zero
     c     *dmy          test(d)                 c3ffda                 32
     c                   if        *in32 = *on
     c                   goto      c3tagb
     c                   endif
     c                   endif
      *
      * Sjekk,  Finnes prosjekt i KONTO-REGISTER
      *
     c                   eval      c3prtx = *blank
6.20 c**                 if        c3proj <> *zero
6.20 c                   if        c3proj <> *blanks
     c                   if        c3proj <> foproj
     c                   exsr      sbproj
6.20 c                   if        w_retk = 'X'
6.20 c                   eval      *in45  = *on
6.20 c                   goto      c3tagb
6.20 c                   endif
     c                   if        w_retk <> *blank
     c                   eval      *in34 = *on
     c                   goto      c3tagb
     c                   endif
     c                   endif
     c                   endif
      *
6.20  * Sjekk,  Finnes prosjekt/underprosjekt i kontoregisteret
6.20  *
6.20 c                   eval      c3prtx = *blank
6.20 c                   if        c3upro <> *blanks
6.20 c                   if        c3upro <> foupro
6.20 c                   exsr      sbupro
6.20 c                   if        w_retk <> *blank
6.20 c                   eval      *in35 = *on
6.20 c                   goto      c3tagb
6.20 c                   endif
6.20 c                   endif
6.20 c                   endif
6.20  *
      * Sjekk,  Finnes aktivitet i KODE-REGISTER
      *
6.20 c**                 eval      c3aktx = *blank
6.20 c**                 if        c3akti <> *blank
6.20 c**                 if        c3akti <> foakti
6.20 c**                 exsr      sbakti
6.20 c**                 if        w_retk <> *blank
6.20 c**                 eval      *in35 = *on
6.20 c**                 goto      c3tagb
6.20 c**                 endif
6.20 c**                 endif
6.20 c**                 endif
      *
      * Sjekk,  Finnes konto i KONTO-REGISTER
      *
6.20 c**                 eval      c3kotx = *blank
6.20 c**                 if        c3kont <> *zero
6.20 c**                 if        c3kont <> fokont
6.20 c**                 exsr      sbkont
6.20 c**                 if        w_retk <> *blank
6.20 c**                 eval      *in36 = *on
6.20 c**                 goto      c3tagb
6.20 c**                 endif
6.20 c**                 endif
6.20 c**                 endif
6.11  *
6.11  * Sjekk, korttype
6.11  *
6.11 c                   if        c3psuf <> 0
6.11 c                   exsr      sjk_kort
6.11 c                   if        w_kort = '0'
6.11 c                   eval      *in37 = *on
6.11 c                   goto      c3tagb
6.11 c                   endif
6.12 c                   if        w_ktyp = '0'
6.12 c                   eval      *in38 = *on
6.12 c                   goto      c3tagb
6.12 c                   endif
6.11 c                   endif
      *
      * Oppdaterer ORDRE-HODE-REGISTER
      *
     c     fohel1_key    chain     fohelur                            90
     c                   if        *in90 = *off
      *
     c                   eval      fofkda = *loval
     c                   eval      foffda = *loval
      *
     c                   if        c3fkda <> 0
     c     *dmy          move      c3fkda        fofkda
     c                   endif
      *
     c                   if        c3ffda <> 0
     c     *dmy          move      c3ffda        foffda
     c                   endif
      *
     c                   eval      fokref = c3kref
     c                   eval      foproj = c3proj
6.20 c**                 eval      foakti = c3akti
6.20 c                   eval      foupro = c3upro
6.20 c**                 eval      fokont = c3kont
6.20 c**                 eval      fospes = c3spes
     c                   eval      foksob = c3ksob
     c                   eval      fokgfa = c3kgfa
     c                   eval      fokgfr = c3kgfr
     c                   eval      fokgek = c3kgek
     c                   eval      foldor = c3ldor
6.11 c                   eval      fopsuf = c3psuf
6.10 c                   time                    foedat
6.10 c                   time                    foetim
6.10 c                   eval      foeusr = l_user
     c                   update    fohelur
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for kontonummer                  RS740R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.20 c**   sbkont        begsr
      *
6.20 c**                 eval      c3kotx = *blank
6.20 c**                 call      'RS740R'
6.20 c**                 parm                    w_retk
6.20 c**                 parm                    c3kont
6.20 c**                 parm                    c3spes
6.20 c**                 parm                    foavde
6.20 c**                 parm                    w_ktx1
      *
      *
6.20 c**                 if        w_retk = *blank
6.20 c**                 movel     w_ktx1        c3kotx
6.20 c**                 endif
      *
6.20 c**                 endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.20  **Sjekk/Hent tekst for prosjekt                     RS770R
6.20  * Sjekk/Hent tekst for prosjekt                     RS880R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbproj        begsr
      *
6.20 c**                 eval      w_kont = *zero
6.20 c**                 eval      w_spes = *zero
      *
6.20 c**                 call      'RS770R'
6.20 c                   call      'RS880R'
6.20 c                   parm                    w_retk
6.20 c                   parm                    c3proj
6.20 c                   parm                    c3upro
6.20 c**                 parm                    c3akti
6.20 c**                 parm                    w_kont
6.20 c**                 parm                    w_spes
6.20 c                   parm                    w_ptx1
6.20 c                   parm                    w_ptx2
      *
6.20 c                   eval      c3prtx = *blank
      *
6.20 c                   if        w_retk = *blank
6.20 c                   movel     w_ptx1        c3prtx
6.20 c                   endif
      *
     c                   endsr
      *
6.20  * Sjekk/Hent tekst for underprosjekt                RS881R
6.20  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.20  *
6.20 c     sbupro        begsr
6.20  *
6.20 c                   call      'RS881R'
6.20 c                   parm                    w_retk
6.20 c                   parm                    c3proj
6.20 c                   parm                    c3upro
6.20 c                   parm                    w_ptx1
6.20 c                   parm                    w_ptx2
6.20 c                   parm                    w_ptx3
6.20  *
6.20 c                   eval      c3uptx = *blank
6.20  *
6.20 c                   if        w_retk = *blank
6.20 c                   movel     w_ptx1        c3uptx
6.20 c                   movel     w_ptx3        c3prtx
6.20 c                   endif
6.20  *
6.20 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for betalingsbetigelser          RS203R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     sbbetb        begsr
      *
     c                   eval      w_cbda = *loval
     c                   eval      w_cfda = *loval
      *
     c                   call      'FÅ703R'
     c                   parm                    p_firm
     c                   parm                    c2betb
     c                   parm                    w_cbda
     c                   parm                    w_retk
     c                   parm                    w_cfda
     c                   parm                    w_ctx1
     c                   parm                    w_ctx2
      *
     c                   eval      c2btx1 = *blank
     c                   eval      c2btx2 = *blank
      *
     c                   if        w_retk = *blank
     c                   movel     w_ctx1        c2btx1
     c                   movel     w_ctx2        c2btx2
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for avdeling                     RS707R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbavde        begsr
      *
     c                   eval      c2avtx = *blank
     c                   call      'RS707R'
     c                   parm                    w_retk
     c                   parm                    c2avde
     c                   parm                    w_gtxt
      *
     c                   if        w_retk = *blank
     c                   movel     w_gtxt        c2avtx
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for selger                       RS709R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbselg        begsr
      *
     c                   eval      c2setx = *blank
     c                   call      'RS709R'
     c                   parm                    w_retk
     c                   parm                    c2selg
     c                   parm                    w_itxt
      *
     c                   if        w_retk = *blank
     c                   movel     w_itxt        c2setx
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for lager                        RS710R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
3.10 c     sblagr        begsr
      *
3.10 c                   call      'FÅ720R'
3.10 c                   parm                    p_firm
3.10 c                   parm                    c2lage
3.10 c                   parm                    w_jtxt
3.10 c                   parm                    w_jadr
3.10 c                   parm                    w_jpnr
3.10 c                   parm                    w_jste
3.10 c                   parm                    w_javd
3.10 c                   parm                    w_retk
      *
3.10 c                   eval      c2latx = *blank
3.10  *
3.10 c                   if        w_retk = '0'
3.10 c                   eval      c2latx = w_jtxt
3.10 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for valuta                       RS216R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbvalk        begsr
      *
     c                   eval      c2vatx = *blank
     c                   call      'RS216R'
     c                   parm                    w_retk
     c                   parm                    c2valk
     c                   parm                    w_ptxt
     c                   parm                    w_pdat
     c                   parm                    w_pomr
      *
     c                   if        w_retk = *blank
     c                   movel     w_ptxt        c2vatx
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for forsendelsesmåte             RS717R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbform        begsr
      *
     c                   eval      c2lmtx = *blank
     c                   call      'RS717R'
     c                   parm                    w_retk
     c                   parm                    c2lmat
     c                   parm                    w_qtxt
      *
     c                   if        w_retk = *blank
     c                   movel     w_qtxt        c2lmtx
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for leveringsbetingelse          RS718R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sblevb        begsr
      *
     c                   eval      c2ltx1 = *blank
     c                   eval      c2ltx2 = *blank
     c                   eval      c2ltx3 = *blank
      *
     c                   call      'RS718R'
     c                   parm                    w_retk
     c                   parm                    c2lbet
     c                   parm                    w_rtx1
     c                   parm                    w_rtx2
     c                   parm                    w_rtx3
      *
     c                   if        w_retk = *blank
     c                   movel     w_rtx1        c2ltx1
     c                   movel     w_rtx2        c2ltx2
     c                   movel     w_rtx3        c2ltx3
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for aktivitet                    RS721R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.20 c**   sbakti        begsr
6.20  *
6.20 c**                 eval      c3aktx = *blank
6.20 c**                 call      'RS721R'
6.20 c**                 parm                    w_retk
6.20 c**                 parm                    c3akti
6.20 c**                 parm                    w_utxt
      *
6.20 c**                 if        w_retk = *blank
6.20 c**                 movel     w_utxt        c3aktx
6.20 c**                 endif
6.20  *
6.20 c**                 endsr
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk/Hent tekst for speditør                     RS722R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbsped        begsr
      *
     c                   eval      c2sptx = *blank
     c                   call      'RS722R'
     c                   parm                    w_retk
     c                   parm                    c2sped
     c                   parm                    w_vtxt
      *
     c                   if        w_retk = *blank
     c                   movel     w_vtxt        c2sptx
     c                   endif
      *
     c                   endsr
5.60  *
5.60  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.60  * Sjekk/Hent tekst for kjørerute                    RS725R
5.60  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.60  *
5.60 c     sbkjor        begsr
5.60  *
5.60 c                   eval      c2kjtx = *blank
5.60 c                   call      'RS725R'
5.60 c                   parm                    w_retk
5.60 c                   parm                    c2kjor
5.60 c                   parm                    w_ytxt
5.60  *
5.60 c                   if        w_retk = *blank
5.60 c                   movel     w_ytxt        c2kjtx
5.60 c                   endif
5.60  *
5.60 c                   endsr
5.42  *
5.42  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.42  * Endring av mva-kode på linje-nivå
5.42  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.42  *
5.42 c     endr_mva      begsr
5.42  *
5.42 c                   eval      fodtlu_numm = fonumm
5.42 c                   eval      fodtlu_suff = fosuff
5.42  *
5.42 c     fodtlu_key    setll     fodtlu
5.42 c     fodtlu_key    reade     fodtlu
5.42 c                   dow       not %eof
5.42  *
5.42  * Behandler ikke tekstlinjer
5.42  *
5.42 c                   eval      vltyl1_ltyp = fdltyp
5.42 c     vltyl1_key    chain     vltyl1
5.42  *
5.42 c                   if        valktx <> 0
5.42 c                   goto      neste_linje
5.42 c                   endif
5.42  *
5.42  * Oppslag på vareregister
5.42  *
5.42 c                   eval      vvarl1_vare = fdvare
5.42 c     vvarl1_key    chain     vvarl1
5.42  *
5.42  * Endring av momskode på linjenivå
5.42  *
5.42 c                   if        c2mkod = 1
5.42 c                   eval      fdomva = '4'
5.42 c                   else
5.42  *
6.33 c                   eval      vmval1_mkod = vvkmva
6.33 c     vmval1_key    chain     vmval1
6.33 c                   if        %found
6.33 c                   eval      fdomva = vamkof
6.33 c                   if        c2mkod = 2 and
6.33 c                             vamkuo <> *blank
6.33 c                   eval      fdomva = vamkuo
6.33 c                   endif
6.33 c                   else
6.33 c                   select
6.33 c                   when      vvkmva = 1
6.33 c                   eval      fdomva = '4'
6.33 c                   when      vvkmva = 2
6.33 c                   eval      fdomva = 'H'
6.33 c                   endsl
6.33 c                   endif
6.33 c                   endif
      *
6.10 c                   time                    fdedat
6.10 c                   time                    fdetim
6.10 c                   eval      fdeusr = l_user
5.42 c                   update    fodtlur
5.42  *
5.42 c     neste_linje   tag
5.42  *
5.42 c     fodtlu_key    reade     fodtlu
5.42 c                   enddo
5.42  *
5.42 c                   endsr
      *
      *
6.11  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.11  * Subrutine for å legge inn tekster til kort
6.11  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.11  *
6.11 c     kort_txt      begsr
6.11  *
6.11 c                   eval      w_alt1 = 'VISA Purchasing          '
6.11 c                   eval      w_alt2 = 'Europay Purchasing       '
6.11 c                   eval      w_alt3 = 'Maxbo Kort               '
8.02 c                   eval      w_alt4 = 'Santander                '
6.11 c                   eval      w_alt5 = 'BM Kort                  '
6.11 c                   eval      w_alt6 = 'NBBL Fordelskort         '
6.11 c                   eval      w_alt7 = '                         '
6.11 c                   eval      w_alt8 = '                         '
6.11  *
6.11  * Legg inn tekster
6.11  *
6.11 c                   select
6.11 c                   when      c3psuf = 1
6.11 c                   movel     w_alt1        c3ktyp
6.11 c                   when      c3psuf = 2
6.11 c                   movel     w_alt2        c3ktyp
6.11 c                   when      c3psuf = 3
6.11 c                   movel     w_alt3        c3ktyp
6.11 c                   when      c3psuf = 4
6.11 c                   movel     w_alt4        c3ktyp
6.11 c                   when      c3psuf = 5
6.11 c                   movel     w_alt5        c3ktyp
6.11 c                   when      c3psuf = 6
6.11 c                   movel     w_alt6        c3ktyp
6.11 c                   when      c3psuf = 7
6.11 c                   movel     w_alt7        c3ktyp
6.11 c                   when      c3psuf = 8
6.11 c                   movel     w_alt8        c3ktyp
6.11 c                   endsl
6.11  *
6.11 c                   endsr
6.11  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.11  * Subrutine for å sjekke at dette er et kreditkort
6.11  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.11 c     sjk_kort      begsr
6.11  *
6.11 c                   eval      w_kort = '0'
6.12 c                   eval      w_ktyp = '0'
6.11  * Slå opp på register
6.27 c*                  eval      ruksl1_skty = c3psuf
6.27 c*                  eval      ruksl1_slag = folage
6.27 c*    ruksl1_key    chain     ruksl1
6.27 c*                  if        %found(ruksl1)
6.27 c*                  if        rustyp = 'K'
6.27 c*                  eval      w_kort = '1'
6.27 c*                  endif
6.27 c*                  else
6.27 c*                  eval      ruksl1_slag = 0
6.27 c*    ruksl1_key    chain     ruksl1
6.27 c*                  if        %found(ruksl1)
6.27 c*                  if        rustyp = 'K'
6.27 c*                  eval      w_kort = '1'
6.27 c*                  endif
6.27 c*                  endif
6.27 c*                  endif
6.12  * Sjekk i tillegg at korttypen er registrert på kunden.
6.27 c*                  if        w_kort = '1'
6.12 c                   eval      rukrl5_ktyp = c3psuf
6.12 c                   eval      rukrl5_kkun = fokund
6.12 c                   eval      rukrl5_kpro = 0
6.12 c     rukrl5_key    chain     rukrl5
6.12 c                   if        %found(rukrl5)
6.12 c                   eval      w_ktyp = '1'
6.27 c                   eval      w_kort = '1'
6.12 c                   endif
6.27 c*                  endif
6.11  *
6.11 c                   endsr
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  * Subrutine for å hente totalsum ordre innkl. mva
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  *
6.32 c     hent_toti     begsr
6.32 c                   eval      w_toti = 0
6.32 c                   call      'FO703R  '
6.32 c                   parm                    w_firm
6.32 c                   parm                    fonumm
6.32 c                   parm                    fosuff
6.32 c                   parm                    w_toti
6.32  *
6.32 c                   endsr
8.06  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
8.06  * Oppdater linjer med samme som fra-avdeling
8.06  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
8.06 c     sjk_lines     begsr
8.06  *
8.06 c     fohel1_key    setll     fodtlu
8.06 c     fohel1_key    reade     fodtlu
8.06 c                   dow       not %eof
8.07 c                   if        fdavde = 0 and
8.07 c                             fdvare <> *blanks
8.07 c                   eval      fdavde = foavde
8.07 c**                 if        foavde <> fdavde and
8.07 c                   elseif    foavde <> fdavde and
8.06 c                             s_avde <> 0 and
8.06 c                             fdavde <> 0
8.06 c                   eval      fdavde = foavde
8.06 c                   time                    fdedat
8.06 c                   time                    fdetim
8.06 c                   eval      fdeusr = l_user
8.06 c                   endif
8.06 c                   update    fodtlur
8.06 c     fohel1_key    reade     fodtlu
8.06 c                   enddo
8.06  *
8.06 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     *inzsr        begsr
      *
      * Nullstilling av felter som ikke kan redefineres
      *
     c                   eval      w_retk = *blank
6.20 c**                 eval      w_kont = *zero
6.20 c**                 eval      w_spes = *zero
     c                   eval      w_pdat = *loval
     c                   eval      w_pomr = *zero
      *
      * Key for file : ORDRE-HODE-REGISTER
      *
     c     fohel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fohel1_numm
     c                   kfld                    fohel1_suff
5.42  *
5.42  * Key for file : ORDRE-LINJE-REGISTER
5.42  *
5.42 c     fodtlu_key    klist
5.42 c                   kfld                    w_firm
5.42 c                   kfld                    fodtlu_numm
5.42 c                   kfld                    fodtlu_suff
5.42  *
5.42  * Key for oppslag på linjetype
5.42  *
5.42 c     vltyl1_key    klist
5.42 c                   kfld                    w_firm
5.42 c                   kfld                    vltyl1_ltyp
5.42  *
5.42  * Key for oppslag på vare
5.42  *
5.42 c     vvarl1_key    klist
5.42 c                   kfld                    w_firm
5.42 c                   kfld                    vvarl1_vare
5.43  *
5.43  * Key for oppslag på fakturatype
5.43  *
5.43 c     fmftl1_key    klist
5.43 c                   kfld                    w_firm
5.43 c                   kfld                    fmftl1_tfat
5.61  *
5.61  * Key for oppslag på depositum-fil
5.61  *
5.61 c     sdepl1_key    klist
5.61 c                   kfld                    w_firm
5.61 c                   kfld                    sdepl1_numm
5.61 c                   kfld                    sdepl1_kund
7.fb c                   kfld                    sdepl1_tell
5.61  *
5.61  * Key for oppdatering av depositum-fil
5.61  *
5.61 c     sdeplu_key    klist
5.61 c                   kfld                    w_firm
5.61 c                   kfld                    sdeplu_numm
5.61 c                   kfld                    sdeplu_kund
7.fb c                   kfld                    sdeplu_tell
5.71  *
5.71  * Key for file : ORDRE-Detaljer-REGISTER
5.71  *
5.71 c     fodtl1_key    klist
5.71 c                   kfld                    w_firm
5.71 c                   kfld                    fodtl1_numm
5.71 c                   kfld                    fodtl1_suff
5.71  *
5.71  * Key for file : lager
5.71  *
5.71 c     vlagl1_key    klist
5.71 c                   kfld                    w_firm
5.71 c                   kfld                    vlagl1_vare
5.71 c                   kfld                    vlagl1_lage
6.11  *
6.11  * Key for oppslag i kortregister
6.11  *
6.11 c     ruksl1_key    klist
6.11 c                   kfld                    w_firm
6.11 c                   kfld                    ruksl1_skty
6.11 c                   kfld                    ruksl1_slag
6.12  *
6.12  * Key for oppslag mot kortregister på kortnummer
6.12  *
6.12 c     rukrl5_key    klist
6.12 c                   kfld                    w_firm
6.12 c                   kfld                    rukrl5_ktyp
6.12 c                   kfld                    rukrl5_kkun
6.12 c                   kfld                    rukrl5_kpro
6.24  *
6.24  * Key for oppslag på status
6.24  *
6.24 c     fstsl1_key    klist
6.24 c                   kfld                    w_firm
7.fb  *
7.fb  * Key for oppslag på ofak-koderegister sideregister
7.fb  *
7.fb c     fst2l1_key    klist
7.fb c                   kfld                    w_firm
6.30  *
6.30  * Key for file : Firmastyrt validering
6.30  *
6.30 c     avall1_key    klist
6.30 c                   kfld                    w_firm
6.30 c                   kfld                    avall1_apgm
6.33  *
6.33  * Key for oppslag på mva.-kode
6.33  *
6.33 c     vmval1_key    klist
6.33 c                   kfld                    w_firm
6.33 c                   kfld                    vmval1_mkod
8.03  *
8.03  * Key for file : Ordretype
8.03  *
8.03 c     votyl1_key    klist
8.03 c                   kfld                    w_firm
8.03 c                   kfld                    votyl1_otyp
      *
      * Tar inn parameter fra forrige program
      *
     c     *entry        plist
     c                   parm                    p_firm
     c                   parm                    p_numm
     c                   parm                    p_suff
      *
      * Legger inn firmanummer i nøkklene
      *
     c                   eval      w_firm = p_firm
6.24  *
6.24  * Hent opplysninger fra ofak koderegister
6.24  *
6.24 c     fstsl1_key    chain     fstsl1r
7.fb c     fst2l1_key    chain     fst2l1
      *
      * Legger inn ordrenummer og suffix i nøkklene
      *
     c                   eval      fohel1_numm = p_numm
     c                   eval      fohel1_suff = p_suff
      *
6.30  * Firmastyrt validering av utvalgte felter
6.30  *
6.30  *
6.30 c                   eval      avall1_apgm = 'FO101R'
6.30 c     avall1_key    setll     avall1
6.30 c     avall1_key    reade     avall1
6.30 c                   dow       not %eof(avall1)
6.30 c                   if        avaflt = 'FOLMAT'  and
6.30 c                             avaval = 1
6.30 c                   eval      u_lmat = *on
6.30 c                   endif
6.31 c                   if        avaflt = 'FOSELG'  and
6.31 c                             avaval = 1
6.31 c                   eval      u_selg = *on
6.31 c                   endif
6.30 c     avall1_key    reade     avall1
6.30 c                   enddo
      *
7.fb c                   if        faak11 = 1
7.fb c                   eval      *in50 = *on
7.fb c                   endif
      *
     c                   endsr
