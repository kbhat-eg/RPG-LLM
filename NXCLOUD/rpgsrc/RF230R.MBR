     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOKON
      * Program . . . . : RF230R
      * Beskrivelse . . : Kontaktpersoner, vedlikehold
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       010806 HFL  Nytt program
      * V5.50 280906 KOB  Lagt inn utskrift av kundekort
6.10  * R6.10 230909 BSA  Lagt inn sporingsfelter
7.xx  * 7.xx  130516 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
Q.01  * 7.00  030419 bsa  Mulighet til å bruke 27x132 størrelse
Q.02  * 7.00  030419 bsa  Quick wins - mulighet til å kopiere personer
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = Avslutt program
      *       10 = Roll
      *       11 = Rolldown
      *       12 = Sfldsp
      *       13 = Sfldspctl
      *       14 = Sflclr
      *       15 = Sflend
      *       21 = Home-key
      *       22 = Plassering av cursor
      *       30 = Protect av felter ved vise
      *    31-79 = Varsle m/feilmeldinger/skjermindikatorer
      *    80-99 = Arbeidsindikatorer
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     frukplr    if   e           k disk    rename(rukppfr:rukplrr)
     frukpl2    if   e           k disk    rename(rukppfr:rukpl2r)
     frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
     frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
     frukplu    uf a e           k disk    rename(rukppfr:rukplur)
     frukpl3    if   e           k disk    rename(rukppfr:rukpl3r)
     f                                     prefix(x:1)
     frukpl4    if   e           k disk    rename(rukppfr:rukpl4r)
     f                                     prefix(x:1)
     frukpl5    if   e           k disk    rename(rukppfr:rukpl5r)
Q.02 frukpl1    if   e           k disk    rename(rukppfr:rukpl1r)
      *
     frf230d    cf   e             workstn sfile(b1sfl:w_srrn)
     f                                     infds(dspfbk)
      *
      * Definering av local data area
      *
     d                uds
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av Information Data Structure - display feedback
      *
     d dspfbk          ds
     d  d_fcrn               378    379I 0
      *
      * Definering av variabler i nøkler
      *
     d rukplr_kund     s                   like(rukund)
     d rukplr_levr     s                   like(rulevr)
     d rukplr_kpnr     s                   like(rukpnr)
     d rukpl2_kpnr     s                   like(rukpnr)
     d rukplu_kund     s                   like(rukund)
     d rukplu_levr     s                   like(rulevr)
     d rukplu_kpnr     s                   like(rukpnr)
     d rukpl3_alfa     s                   like(rualfa)
     d rukpl4_penr     s                   like(rupenr)
     d rukpl5_alfa     s                   like(rualfa)
     d rukpl5_kpnr     s                   like(rukpnr)
     d rkunl1_kund     s                   like(rkkund)
     d rlevl1_levr     s                   like(rllevr)
Q.02 d rukpl1_kund     s                   like(rukund)
Q.02 d rukpl1_levr     s                   like(rulevr)
Q.02 d rukpl1_kpnr     s                   like(rukpnr)
      *
      * Definering av variable
      *
     d w_fcrn          s              4  0
     d w_stel          s              4  0
     d w_spge          s              4  0
     d w_srrn          s              4  0
     d w_sfrn          s                   like(w_srrn)
     d w_ssrn          s                   like(w_srrn)
     d w_knav          s                   like(rknavn)
     d w_kftp          s              2  0
     d*w_ktpn          s             25
      *
     d w_seqe          s              1
     d w_retk          s              1
     d w_4pnr          s              6  0
     d b_valg_ok       s              1    inz(*off)
     d b_forn          s              1    inz(*off)
     d b_oppr          s              1    inz(*off)
     d b_anul          s              1    inz(*off)
      *
     d p_kund          s              6  0
     d p_levr          s              6  0
     d p_tx30          s             30
     d w_firm          s                   like(rufirm)
     d w_kund          s                   like(rukund)
     d w_levr          s                   like(rulevr)
     d s_kund          s                   like(rukund)
     d s_levr          s                   like(rulevr)
     d w_kpnr          s                   like(rukpnr)
     d w_alfa          s                   like(rualfa)
     d w_kort          s             16
     d w_ddat          s               d   datfmt(*iso)
     d w_adr1          s             30
     d w_adr2          s             30
     d w_sted          s             30
     d w_kprs          s             30
     d w_tlfa          s             15
     d w_tlfp          s             15
     d w_tlfm          s             15
     d w_mail          s             50
     d w_orka          s              3  0
     d w_okun          s              6  0
     d w_okpr          s              6  0
     d w_opda          s               d
     d w_proj          s              6  0
     d w_posi          s              2  0
     d w_modu          s             10
     d w_disp          s              1
     d w_stat          s              1
      *
Q.02 d s_kpnr          s                   like(rukpnr)
      *
      * Definering av konstanter
      *
     d Lo              c                   'abcdefghijklmnopqrstuvwxyzæøå'
     d Up              c                   'ABCDEFGHIJKLMNOPQRSTUVWXYZÆØÅ'
      *
     d c_sfil          s              2  0 inz(14)
     d c_digi          c                   '0123456789 '
      *
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      * w_fcrn - Første recordnummer på siden
      * w_stel - Subfile-teller
      * w_spge - Sidestørrelse i subfile (page)
      * w_srrn - Relativt recordnummer i subfile
      * w_sfrn - Første recordnummer på siste side
      * w_ssrn - Siste recordnummer på siste side
      * w_curn - Current recordnummer på siden
      * w_virn - Side og cursorplassering som skal vises
      * w_afld - Aktivt feltnavn
      * w_arow - Aktiv rad for cursor
      * w_acol - Aktiv kolonne for cursor
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      * B1SFL  - B1 Subfile - record
      * B2CTL  - B2 Subfile - control record
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      * C2BLD  - C2 Skjermbilde for opprette/endre/vise
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B2CTL Behandle åpningsbildet med subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Send Alt
      *
     c     b2taga        tag
      *
     c                   write     b2cmd
      *
      * Bare data
      *
     c     b2tagb        tag
      *
     c                   exsr      dsp_subfile
      *
      * Behandling av funksjonstaster
      *
     c                   select
     c                   when      *inkc or *inkl
     c                   goto      avslutt
     c                   when      *inke
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *inkf
     c                   exsr      bc2bld
     c                   exsr      xc1bld
     c                   goto      b2tagb
     c                   when      *in10
     c                   exsr      crt_subfile
     c                   goto      b2tagb
     c                   when      *in11
     c                   exsr      bck_subfile
     c                   goto      b2tagb
     c                   when      *in21
     c                   eval      *in22 = *on
     c                   goto      b2taga
     c                   endsl
      *
      * Posisjonering
      *
     c                   if        b2kpnr <> 0 or
     c                             b2alfa <> *blank
     c                   exsr      posisjoner
     c                   goto      b2tagb
     c                   endif
      *
      * Behandling av subfile
      *
     c                   exsr      subfile
     c                   if        b_valg_ok = *on
     c                   goto      avslutt
     c                   endif
      *
     c                   goto      b2taga
      *
      * Avslutt program
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for fornying av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     forny         begsr
      *
     c                   if        w_fcrn <> 0
     c     w_fcrn        chain     b1sfl
     c                   endif
      *
     c                   select
     c                   when      w_seqe = 'K'
     c                   eval      rukpl2_kpnr = b1kpnr
     c     rukpl2_key    setll     rukpl2
     c                   when      w_seqe = 'A'
     c                   eval      rukpl5_alfa = b1alfa
     c                   eval      rukpl5_kpnr = *zero
     c     rukpl5_key    setll     rukpl5
     c                   endsl
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c     end_forny     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for posisjonering i subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     posisjoner    begsr
      *
      * Posisjoner startverdi på kontaktpersonnr.
      *
     c                   if        b2kpnr <> 0
     c                   eval      w_seqe = 'K'
     c                   eval      rukpl2_kpnr = b2kpnr
     c     rukpl2_key    setll     rukpl2
     c                   goto      end_pos
     c                   endif
      *
      * Posisjoner startverdi på alfa
      *
     c                   if        b2alfa <> *blank
     c                   eval      w_seqe = 'A'
     c                   eval      rukpl5_alfa = b2alfa
     c     rukpl5_key    setll     rukpl5
     c                   goto      end_pos
     c                   endif
      *
     c     end_pos       tag
      *
      * Blanker subfile, og fyller opp i.h.t. posisjonering
      *
     c                   eval      *in22 = *off
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
      * Blanker posisjoneringsfelter
      *
     c                   eval      b2kpnr = 0
     c                   eval      b2alfa = *blank
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     subfile       begsr
      *
     c                   if        *in22 = *off
     c                   eval      *in22 = *on
     c                   else
     c                   eval      *in22 = *off
     c                   endif
      *
     c                   eval      b_forn = *off
     c                   eval      w_virn = w_fcrn
      *
      * Leser og behandler subfile
      *
     c                   do        w_ssrn
     c                   readc     b1sfl
      *
     c                   if        %eof
     c                   leave
     c                   endif
      *
     c                   eval      *in22 = *off
     c                   eval      w_virn = w_srrn
      *
      * Endre/vise
      *
     c                   if        b1valg = 2 or
     c                             b1valg = 5
     c                   eval      c2kpnr = b1kpnr
     c                   exsr      xc2bld
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
Q.02  *
Q.02  * Kopier
Q.02  *
Q.02 c                   if        b1valg = 3
Q.02 c                   eval      k1kpnr = b1kpnr
Q.02 c                   exsr      xk1win
Q.02 c                   eval      b1valg = 0
Q.02 c**                 update    b1sfl
Q.02 c                   iter
Q.02 c                   endif
      *
      * Slett
      *
     c                   if        b1valg = 4
     c                   eval      d1kpnr = b1kpnr
     c                   exsr      xd1win
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Skriv kundekort
      *
     c                   if        b1valg = 6
     c                   call      'RF632C'
     c                   parm                    b1kpnr
      *
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
     c                   enddo
      *
     c                   if        b_forn = *on
     c                   exsr      forny
     c                   endif
      *
     c     end_subfile   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for tømming av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     clr_subfile   begsr
      *
     c                   eval      *in14 = *on
     c                   write     b2ctl
     c                   eval      *in14 = *off
      *
     c                   eval      *in15 = *off
     c                   eval      w_srrn = 0
     c                   eval      w_sfrn = 0
     c                   eval      w_ssrn = 0
     c                   eval      w_spge = 0
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å fylle opp subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     crt_subfile   begsr
      *
     c                   eval      w_spge = w_spge + c_sfil
     c                   eval      w_srrn = w_ssrn
      *
      * Fyller opp subfile
      *
     c                   dou       w_srrn = w_spge
      *
     c                   select
     c                   when      w_seqe = 'K'
     c                   read      rukpl2
     c                   when      w_seqe = 'A'
     c                   read      rukpl5
     c                   endsl
      *
     c                   if        %eof
     c                   eval      *in15 = *on
     c                   leave
     c                   endif
      *
     c                   if        rufirm <> w_firm
     c                   eval      *in15 = *on
     c                   leave
     c                   endif
      *
      * Skriver til subfile
      *
     c                   eval      w_srrn = w_srrn + 1
      *
     c                   select
     c                   when      w_seqe = 'K'
     c                   eval      rukpl2_kpnr = rukpnr
     c                   when      w_seqe = 'A'
     c                   eval      rukpl5_alfa = rualfa
     c                   endsl
      *
     c                   eval      b1valg = 0
      *
Q.02 c                   eval      b1kund = rukund
Q.02 c                   eval      b1levr = rulevr
     c                   eval      b1kpnr = rukpnr
     c                   eval      b1alfa = rualfa
     c                   eval      b1krol = rukrol
      *
     c                   write     b1sfl
      *
     c                   enddo
      *
     c                   if        w_srrn > w_ssrn
     c                   eval      w_sfrn = w_ssrn + 1
     c                   endif
      *
     c                   eval      w_ssrn = w_srrn
     c                   eval      w_virn = w_sfrn
      *
     c                   endsr
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av skjermbilde for ny rad (C1BLD)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xc1bld        begsr
      *
     c                   eval      b_oppr = *on
     c                   eval      b_forn = *off
      *
      * Hent sist brukte kontaktpersonnummer
      *
     c                   eval      w_retk = ' '
     c                   call      'RS003R'
     c                   parm                    w_retk
     c                   parm                    w_firm
     c                   parm                    w_4pnr
      *
     c                   if        w_retk = *blank
     c                   eval      c1kpnr = w_4pnr
     c                   else
     c                   eval      *in37 = *on                                  Pos.cur.
     c                   goto      c1taga
     c                   endif
      *
     c     c1taga        tag
      *
     c                   exfmt     c1bld
      *
      * Reduser sist brukte kontaktpersonnummer
      *
     c                   select
     c                   when      *inkc or *inkl or
     c                             c1kpnr <> w_4pnr
     c                   eval      w_retk = 'S'
     c                   call      'RS003R'
     c                   parm                    w_retk
     c                   parm                    w_firm
     c                   parm                    w_4pnr
      *
     c                   endsl
      *
     c                   select
     c                   when      *inkc or *inkl
     c                   goto      end_c1bld
     c                   endsl
      *
      * Sender opp informasjonsbilde dersom kontaktperson finnes fra før
      *
     c                   eval      rukplr_kpnr = c1kpnr
     c     rukplr_key    chain     rukplr
     c                   if        %found
     c                   exsr      xc1msg
     c                   if        b_anul = *on
     c                   goto      c1taga
     c                   endif
     c                   endif
      *
      * Kaller vedlikeholdsprogram
      *
     c                   eval      c2kpnr = c1kpnr
     c                   exsr      xc2bld
      *
     c                   eval      c1kpnr = 0
      *
     c     end_c1bld     tag
      *
     c                   eval      b_oppr = *off
      *
     c                   if        b_forn = *on
     c                   exsr      forny
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for utlegging av opprettelsesmelding
      * Meldingsbildet legges ut dersom det forsøkes å opprette en rad som
      * finnes fra før.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xc1msg        begsr
      *
     c                   eval      b_anul = *off
      *
     c                   exfmt     c1msg
      *
      * Behandling av funksjonstaster
      *
     c                   if        *inkc or *inkl
     c                   eval      b_anul = *on
     c                   goto      end_c1msg
     c                   endif
      *
     c     end_c1msg     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å behandle skjermbilde for ny/endring/vise (C2BLD)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xc2bld        begsr
      *
     c                   eval      w_arow = 0
     c                   eval      w_acol = 0
      *
     c                   eval      w_kpnr = c2kpnr
      *
     c                   eval      rukpl2_kpnr = c2kpnr
     c     rukpl2_key    chain     rukpl2
      *
     c                   if        %found(rukpl2)
      *
     c                   eval      c2enav = ruenav
     c                   eval      c2fnav = rufnav
      *
     c                   eval      c2penr = rupenr
     c                   eval      c2krol = rukrol
     c                   eval      c2ktlf = ruktlf
     c                   eval      c2kfax = rukfax
     c                   eval      c2ptlf = ruptlf
     c                   eval      c2pfax = rupfax
     c                   eval      c2mtlf = rumtlf
     c                   eval      c2stat = rustat
     c                   eval      c2mail = rumail
     c                   eval      c2kund = rukund
     c                   eval      c2levr = rulevr
     c                   eval      c2eusr = rueusr
      *
      * Hent eventuelt kundenavn
      *
     c                   eval      c2ktxt = *blank
     c                   if        rukund > 0
     c                   eval      rkunl1_kund = rukund
     c     rkunl1_key    chain     rkunl1
     c                   if        %found(rkunl1)
     c                   eval      c2ktxt = rknavn
     c                   endif
     c                   endif
      *
      * Hent eventuelt leverandørnavn
      *
     c                   eval      c2ltxt = *blank
     c                   if        rulevr > 0
     c                   eval      rlevl1_levr = rulevr
     c     rlevl1_key    chain     rlevl1
     c                   if        %found(rlevl1)
     c                   eval      c2ltxt = rlnavn
     c                   endif
     c                   endif
      *
     c                   if        ruedat <> *loval
     c     *dmy          move      ruedat        c2edat
     c                   endif
      *
     c                   else
      *
     c                   eval      c2enav = *blank
     c                   eval      c2fnav = *blank
     c                   eval      c2penr = *zero
     c                   eval      c2krol = *blank
     c                   eval      c2ktlf = *blank
     c                   eval      c2kfax = *blank
     c                   eval      c2ptlf = *blank
     c                   eval      c2pfax = *blank
     c                   eval      c2mtlf = *blank
     c                   eval      c2stat = *blank
     c                   eval      c2mail = *blank
     c                   eval      c2eusr = *blank
     c                   eval      c2edat = *zero
      *
     c                   endif
      *
Q.02 c                   if        %trim(k1enav) <> *blanks or
Q.02 c                             %trim(k1fnav) <> *blanks
Q.02 c                   eval      c2enav = k1enav
Q.02 c                   eval      c2fnav = k1fnav
Q.02 c                   eval      k1fnav = *blanks
Q.02 c                   eval      k1enav = *blanks
Q.02 c                   endif
      *
      * Dersom 'vise' settes protect-indikatorer
      *
     c                   if        b1valg = 5
     c                   eval      *in30 = *on
     c                   endif
      *
      * Behandler bildet
      *
     c     c2tagb        tag
      *
     c                   exfmt     c2bld
      *
     c                   if        *inkc or *inkl or *in30
     c                   goto      end_c2bld
     c                   endif
      *
      * Spørring
      *
     c                   if        *inkd
     c                   exsr      spr_rut
     c                   goto      c2tagb
     c                   endif
      *
      * Kort
      *
     c                   if        *inke
      *
     c                   if        w_kund <> 0
      *
     c                   call      'RF220R'
     c                   parm                    w_firm
     c                   parm                    w_kund
     c                   parm                    w_kpnr
      *
     c                   endif
      *
     c                   goto      c2tagb
     c                   endif
      *
      * Validering
      *
     c                   if        c2enav = *blank
     c                   eval      *in31  = *on
     c                   goto      c2tagb
     c                   endif
      *
     c                   if        c2fnav = *blank
     c                   eval      *in32  = *on
     c                   goto      c2tagb
     c                   endif
      *
      * Sjekk om kontaktperson med samme navn og personr. finnes fra før
      *
     c                   eval      w_alfa = %trimr(c2enav) + ' ' +
     c                                      %trim(c2fnav)
     c     Lo:Up         xlate     w_alfa        w_alfa
      *
     c                   eval      rukpl3_alfa = w_alfa
     c     rukpl3_key    setll     rukpl3                                 60
     c     rukpl3_key    reade     rukpl3                                 60
      *
     c                   dow       *in60 = *off
     c                   if        xualfa = w_alfa and
     c                             xukpnr <> c2kpnr
     c                   exsr      xv2msg
     c                   if        b_anul = *on
     c                   goto      end_c2bld
     c                   endif
     c                   endif
     c     rukpl3_key    reade     rukpl3                                 60
     c                   enddo
      *
      * Sjekk om kontaktperson med samme personnummer finnes fra før
      *
     c                   if        c2penr <> 0
     c                   eval      rukpl4_penr = c2penr
     c     rukpl4_key    setll     rukpl4                                 60
     c     rukpl4_key    reade     rukpl4                                 60
      *
     c                   dow       *in60 = *off
     c                   if        xupenr = c2penr and
     c                             xukpnr <> c2kpnr
     c                   exsr      xv2msg
     c                   if        b_anul = *on
     c                   goto      end_c2bld
     c                   endif
     c                   endif
     c     rukpl4_key    reade     rukpl4                                 60
     c                   enddo
     c                   endif
      *
      * Oppdaterer tabell
      * Tar vare på kunde- og leverandørnr. for oppslag
     c                   eval      s_kund = rukund
     c                   eval      s_levr = rulevr
      *
     c                   clear                   rukplur
      *
     c                   eval      rukplu_kund = s_kund
     c                   eval      rukplu_levr = s_levr
     c                   eval      rukplu_kpnr = c2kpnr
     c     rukplu_key    chain     rukplur
      *
     c                   eval      ruenav = c2enav
     c                   eval      rufnav = c2fnav
      *
     c                   eval      rualfa = %trimr(ruenav) + ' ' +
     c                                      %trim(rufnav)
     c     Lo:Up         xlate     rualfa        rualfa
      *
     c                   eval      rupenr = c2penr
     c                   eval      rukrol = c2krol
     c                   eval      ruktlf = c2ktlf
     c                   eval      rukfax = c2kfax
     c                   eval      ruptlf = c2ptlf
     c                   eval      rupfax = c2pfax
     c                   eval      rumtlf = c2mtlf
     c                   eval      rustat = c2stat
     c                   eval      rumail = c2mail
     c                   eval      rukund = c2kund
     c                   eval      rulevr = c2levr
     c                   eval      rueusr = l_user
     c                   time                    ruetim
     c                   time                    ruedat
      *
     c                   if        %found(rukplu)
     c                   update    rukplur
     c                   else
     c                   eval      rufirm = w_firm
     c                   eval      rukpnr = c2kpnr
6.10 c                   eval      ruousr = l_user
6.10 c                   time                    ruotim
6.10 c                   time                    ruodat
     c                   write     rukplur
     c                   eval      b1kpnr = c2kpnr
     c                   exsr      forny
     c                   endif
      *
     c                   eval      b_forn = *on
      *
     c     end_c2bld     tag
      *
     c                   eval      *in30 = *off
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for utlegging av opprettelsesmelding
      * Meldingsbildet legges ut dersom det forsøkes å opprette en rad som
      * finnes fra før.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xv2msg        begsr
      *
     c                   eval      b_anul = *off
      *
      * Hent kundenavn
      *
     c                   if        rukund > 0
     c                   eval      rkunl1_kund = xukund
     c     rkunl1_key    chain     rkunl1
     c                   if        %found(rkunl1)
     c                   eval      v2kpnr = xukpnr
     c                   eval      v2kund = xukund
     c                   eval      v2ktxt = rknavn
     c                   eval      *in71 = *on
     c                   endif
     c                   endif
      *
      * Hent leverandørnavn
      *
     c                   if        rulevr > 0
     c                   eval      rlevl1_levr = xulevr
     c     rlevl1_key    chain     rlevl1
     c                   if        %found(rlevl1)
     c                   eval      v2kpnr = xukpnr
     c                   eval      v2levr = xulevr
     c                   eval      v2ltxt = rlnavn
     c                   eval      *in72 = *on
     c                   endif
     c                   endif
      *
     c                   exfmt     v2msg
      *
      * Behandling av funksjonstaster
      *
     c                   if        *inkc or *inkl
     c                   eval      b_anul = *on
     c                   goto      end_v2msg
     c                   endif
      *
     c     end_v2msg     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å init. av skjermbilde for ny/endring/vise (C2BLD)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     bc2bld        begsr
      *
     c                   eval      c2enav = *blank
     c                   eval      c2fnav = *blank
     c                   eval      c2penr = *zero
     c                   eval      c2krol = *blank
     c                   eval      c2ktlf = *blank
     c                   eval      c2kfax = *blank
     c                   eval      c2ptlf = *blank
     c                   eval      c2pfax = *blank
     c                   eval      c2mtlf = *blank
     c                   eval      c2stat = *blank
     c                   eval      c2mail = *blank
     c                   eval      c2eusr = *blank
     c                   eval      c2edat = *zero
     c                   eval      c2kpnr = *zero
     c                   eval      c2mail = *blank
     c                   eval      c2eusr = *blank
     c                   eval      c2edat = *zero
      *
     c                   endsr
      *
      * Subrutine for å bla tilbake en side i subfilen
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     bck_subfile   begsr
      *
     c                   if        *in15
     c                   select
     c                   when      w_seqe = 'K'
     c     rukpl2_key    setgt     rukpl2
     c                   readp     rukpl2
     c                   when      w_seqe = 'A'
     c     rukpl5_key    setgt     rukpl5
     c                   readp     rukpl5
     c                   endsl
     c                   endif
      *
      * Leser tilbake en side
      *
     c                   eval      w_stel = 0
      *
     c                   dou       w_stel = w_ssrn + c_sfil
      *
     c                   select
     c                   when      w_seqe = 'K'
     c                   readp     rukpl2
     c                   when      w_seqe = 'A'
     c                   readp     rukpl5
     c                   endsl
      *
     c                   if        %eof or
     c                             rufirm <> w_firm
     c                   leave
     c                   endif
      *
     c                   eval      w_stel = w_stel + 1
      *
     c                   select
     c                   when      w_seqe = 'K'
     c                   eval      rukpl2_kpnr = rukpnr
     c                   when      w_seqe = 'A'
     c                   eval      rukpl5_alfa = rualfa
     c                   endsl
      *
     c                   enddo
      *
     c                   if        %eof
     c                   select
     c                   when      w_seqe = 'K'
     c     rukpl2_key    setll     rukpl2
     c                   when      w_seqe = 'A'
     c     rukpl5_key    setll     rukpl5
     c                   endsl
     c                   endif
      *
      * Blanker og fyller opp subfile
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c     end_bck       endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for display av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     dsp_subfile   begsr
      *
     c                   if        w_srrn <> 0
     c                   eval      *in12 = *on
     c                   else
     c                   write     b2cmd
     c                   endif
      *
     c                   eval      *in13 = *on
     c                   exfmt     b2ctl
      *
     c                   eval      *in12 = *off
     c                   eval      *in13 = *off
      *
     c                   eval      w_fcrn = d_fcrn
      *
     c                   endsr
      *
Q.02  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Q.02  * Subrutine for å behandle kopierings-bildet (K1WIN)
Q.02  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Q.02  *
Q.02 c     xk1win        begsr
Q.02  *
Q.02  * Tar vare på nøkkel til rad det skal kopieres fra
Q.02  *
Q.02 c                   eval      s_kpnr = k1kpnr
Q.02 c                   eval      k1enav = *blanks
Q.02 c                   eval      k1fnav = *blanks
Q.02  *
Q.02  * Fyller kopierings-bildet
Q.02  *
Q.02 c                   eval      rukpl1_kund = b1kund
Q.02 c                   eval      rukpl1_levr = b1levr
Q.02 c                   eval      rukpl1_levr = 0
Q.02 c                   eval      rukpl1_kpnr = k1kpnr
Q.02 c     rukpl1_key    chain     rukpl1
Q.02  *
Q.02 c                   if        %found
Q.02 c                   eval      k1enav = ruenav
Q.02 c                   eval      k1fnav = rufnav
Q.02 c                   endif
Q.02  *
Q.02 c     k1taga        tag
Q.02  *
Q.02 c                   exfmt     k1win
Q.02  *
Q.02 c                   if        *inkc or *inkl
Q.02 c                   goto      end_k1win
Q.02 c                   endif
Q.02  *
Q.02  * Sjekk om utfylt
Q.02  *
Q.02 c                   if        k1enav = *blanks
Q.02 c                   eval      *in31 = *on
Q.02 c                   goto      k1taga
Q.02 c                   endif
Q.02  *
Q.02  * Sjekk om utfylt
Q.02  *
Q.02 c                   if        k1fnav = *blanks
Q.02 c                   eval      *in31 = *on
Q.02 c                   goto      k1taga
Q.02 c                   endif
Q.02  *
Q.02  * Hent sist brukte kontaktnr
Q.02  *
Q.02 c                   eval      w_retk = ' '
Q.02 c                   call      'RS003R'
Q.02 c                   parm                    w_retk
Q.02 c                   parm                    w_firm
Q.02 c                   parm                    s_kpnr
Q.02  *
Q.02 c                   if        w_retk = *blank
Q.02 c                   eval      c1kpnr = s_kpnr
Q.02 c                   eval      c2kpnr = s_kpnr
Q.02 c                   endif
Q.02  *
Q.02  * Kaller vedlikeholdsprogram
Q.02  *
Q.02 c                   exsr      xc2bld
Q.02  *
Q.02 c                   eval      b_forn = *on
Q.02  *
Q.02 c     end_k1win     endsr
Q.02  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av slette-bildet (D1WIN)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xd1win        begsr
      *
     c                   eval      rukpl2_kpnr = d1kpnr
     c     rukpl2_key    chain     rukpl2
      *
     c                   eval      d1enav = ruenav
     c                   eval      d1fnav = rufnav
     c                   eval      d1kpnr = rukpnr
      *
     c                   exfmt     d1win
      *
     c                   if        *inkc or *inkl
     c                   goto      end_d1win
     c                   endif
      *
      * Sletter rad
      *
     c                   eval      rukplu_kund = rukund
     c                   eval      rukplu_levr = rulevr
     c                   eval      rukplu_kpnr = d1kpnr
     c     rukplu_key    chain     rukplur
      *
     c                   delete    rukplur
      *
     c                   eval      b_forn = *on
      *
     c     end_d1win     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for forespørsel
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     spr_rut       begsr
      *
      * Call kunder
      *
     c                   if        w_afld = 'C2KUND'
     c                   eval      p_kund = c2kund
     c                   call      'RK500R'
     c                   parm                    w_firm
     c                   parm                    p_kund
     c                   parm                    p_tx30
      *
     c                   eval      c2kund = p_kund
     c                   eval      c2ktxt = p_tx30
     c                   eval      *in51 = *on
     c                   goto      end_spr_rut
     c                   endif
      *
      * Call leverandør
      *
     c                   if        w_afld = 'C2LEVR'
     c                   eval      p_kund = c2levr
     c                   call      'RL500R'
     c                   parm                    w_firm
     c                   parm                    p_levr
     c                   parm                    p_tx30
      *
     c                   eval      c2levr = p_levr
     c                   eval      c2ltxt = p_tx30
     c                   eval      *in52 = *on
     c                   goto      end_spr_rut
     c                   endif
      *
     c     end_spr_rut   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for oppslag på kontakperson-register
      *
     c     rukplr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rukplr_kund
     c                   kfld                    rukplr_levr
     c                   kfld                    rukplr_kpnr
      *
      * Key for les av kontakperson-register - alfa
      *
     c     rukpl3_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rukpl3_alfa
      *
      * Key for les av kontakperson-register - personnr.
      *
     c     rukpl4_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rukpl4_penr
      *
      * Key for les av kontakperson-register - alfa
      *
     c     rukpl5_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rukpl5_alfa
     c                   kfld                    rukpl5_kpnr
      *
      * Key for posisjonering
      *
     c     rukpl2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rukpl2_kpnr
      *
      * Key for oppdat. av kontaktperson-register
      *
     c     rukplu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rukplu_kund
     c                   kfld                    rukplu_levr
     c                   kfld                    rukplu_kpnr
      *
      * Key for oppslag på kunde
      *
     c     rkunl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl1_kund
      *
      * Key for oppslag på leverandør
      *
     c     rlevl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl1_levr
Q.02  *
Q.02  * Key for oppdat. av kontaktperson-register
Q.02  *
Q.02 c     rukpl1_key    klist
Q.02 c                   kfld                    w_firm
Q.02 c                   kfld                    rukpl1_kund
Q.02 c                   kfld                    rukpl1_levr
Q.02 c                   kfld                    rukpl1_kpnr
      *
      * Henter verdier fra LDA og initierer skjermbildet
      *
     c                   time                    w_ddat
      *
     c                   eval      w_firm = l_firm
      *
     c                   eval      *in22 = *on
      *
      * Posisjonerer databasen, og fyller opp subfile
      *
     c                   eval      w_seqe = 'K'
     c                   eval      rukpl2_kpnr = 0
     c     rukpl2_key    setll     rukpl2
      *
     c                   exsr      crt_subfile
      *
     c                   endsr
