     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASVADM
      * Program . . . . : JV126R
      * Beskrivelse . . : Oppdatering av priser til EVR, behandling
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       030796 HKO  Nytt program
      *       250899 HKO  Ny logikk
      *       310103 HKO  Lagt inn grossistløsning
      *       220803 HKO  Lagt inn logikk for kun å vise varer hvor
      *                   prisgiver sammefaller med leverandør i EVR
      *       141003 HKO  Lagt inn filter
      *       240605 HKO  Lagt inn valg av leveringstype
      *                   Viser varens varetype
      *       121105 HKO  Lagt inn valg for å utelate varer utgått på dato
      *                   i EVR.
      *                   Viser '** SLETTET **' i vareteksten på slettede
      *                   varer
      *       280508 bof  Utvidet parm. til JV750R
5.70  * PRGR  191108 bof  Utvidet med prisgruppe
5.61  *       060109 bof  Viser '** UTGÅTT **' i vareteksten på utgåttede
5.61  *                   varer
6.10  *       260809 bof  Endret statuskode fra num. til alfa.
6.11  *       270809 bof  Nytt valg - endre enhet i EVR
6.12  *       030909 bof  Utvidet med sortimentskode
6.13  *       030909 bof  Utvidet med kall til spørreprogram sortiment
6.14  *       100909 bof  Viser '** UTGÅR **' i vareteksten hvis utg.dato
6.15  *       180110 bof  Nytt valg 19 - Tvansoverfør. Bare for sts O og G
6.16  *       300410 bof  Nytt felt, viser antall frigjorte varer
6.17  *       160610 bof  En ekstra lest i CRT_SUBFILE pga. dato etter select
6.18  *       201010 bof  Teller på b2antf for liten,gjør om til arbeidsfelt
6.19  *       261010 bof  Nullstiller teller etter at varer er overført.
os71  * os71  151210 bsa  Lagt inn korreksjoner på SQL pga. OS/400 feil
os71  *                   Det er også lagt inn endring på SQL,
os71  *                   som er nødvendig ved overgang til v6.1
6.1a  *       210111 bof  Feilretting vedr. **UTGÅR**
6.1b  *       070812 bof  Løper igjennom og setter holdekode,for sikk.skyld
6.20  * 6.20  081110 bof  Utvidet med utg.dato på lager
6.21  *       120411 bof  Utvidet med valg på oppdatere flere prisgivere
6.22  *       250511 bof  Legger **UTG.NOBB** hvis jvudat er passert mm
6.23  *       180214 bof  Fjernet 6.1b her, lagt inn i JV127R pga. test
6.24  *       080114 bof  Hvis bytte av hovedlev.,så hentes prisforskjell
6.25  *       250814 bkv  Viser '** UTGÅR **' kun hvis utgått på alle lager
6.31  *       270214 bof  endret kall til vedlikehold av pakning
6.32  *       270314 bof  Hvis pris har utgått, skal den ikke vises
6.33  *       010714 bof  Utvidet filter med modul og aktiviserte
6.34  *       020714 bof  Vise DG vha. F23-skift - i kolonne %endr
6.35  *       140714 bof  Utvidet med prisendringsdato + parameter for utg.priser
6.35  *                   Endret også jvprl2 til jvprl3, antakeligvis mer riktig
6.36  *       160714 bof  Lev.varenr ligger nå på JVLEPF
6.37  *       200814 bof  Utvidet med innkjøpspris 2
6.38  *       210814 bof  Hvis kladdeb.på vare i EVR, så GUL varetekst
6.39  *       220814 bof  Nytt valg, se duplikate GTIN
6.3a  *       110515 bof  Skal sjekke mot varepris i tillegg til vare
6.3b  *  6.30 180515 bkv  Endret LVAR pga økt fra 15 til 20 tegn
6.3q  *       260515 bof  Datoformat sql
6.3x  * 6.30  040615 bof  utvidet parm i forb. med prgr. på betingelse
6.3y  * 6.30  050815 bof  utv. parm i forb. med prgr. på frakt + oppdat.
6.3c  * 6.30  220815 bof  prisens prisdato brukes for sammenligning mot EVR
6.3d  * 6.30  010416 bof  hvis vare utgått, viser den vare-lev-nivå med utg.dato
6.3e  * 6.30  130416 hko  Kan tvinge gjennom oppdatering også av status 7
6.3f  * 6.30  020816 bof  Feilretting vedr. test på til prisdato.
6.3g  * 6.30  300816 bof  Bruke vare-prisg.indeks for søk lev.varenr
6.3h  *       160916 bof  Ny datostyring på prisdato i EVR og prisdato l.dor
6.3i  *       170718 bof  Switch mellom å se %endring på kost.
6.3j  * 6.30  190718 bof  Feilretting vedr. filter og utfylt p_ldor
6.3k  *       041018 bof  Innføring av logistikk-varenr
6.3l  *       121118 bkv  Default NOBB , var vare
6.3m  *       220219 bkv  Endret på logistikkvare
6.3n  *       150219 bof  utvidet kall til JV141R med utgåtte varer.
7.xx  * 7.00  040316 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
8.01  *PRG2   140622 BOF  Utvidet prisgruppe fra 1 til 2 posisjoner
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = Avslutt program
      *       10 = Rollup
      *       11 = Rolldown
      *       12 = Sfldsp
      *       13 = Sfldspctl
      *       14 = Sflclr
      *       15 = Sflend
      *       21 = Home-key
      *       22 = Plassering av cursor
      *       30 = Protect av felter ved vise
      *    31-79 = Varsle m/feilmeldinger/skjermindikatorer
      *    80-99 = Arbeidsindikatorer
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fjvprpf    if   e           k disk
6.36 fjvlepf    if   e           k disk
     fjvsost    if   e           k disk    rename(jvsost:jvsostr)
      *
     fjvarl5    if   e           k disk    rename(jvarpfr:jvarl5r)
     fjvarl6    if   e           k disk    rename(jvarpfr:jvarl6r)
     fjvarl7    if   e           k disk    rename(jvarpfr:jvarl7r)
6.3g fjvlel2    if   e           k disk    rename(jvlepfr:jvlel2r)
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
6.21 fvvprl1    if   e           k disk    rename(vvprpfr:vvprl1r)
     fjlevl1    if   e           k disk    rename(jlevpfr:jlevl1r)
     fjvdtl1    if   e           k disk    rename(jvdtpfr:jvdtl1r)
6.35 fjvprl3    if   e           k disk    rename(jvprpfr:jvprl3r)
6.32 fjvprl1    if   e           k disk    rename(jvprpfr:jvprl1r)
     fjvdtlu    uf a e           k disk    rename(jvdtpfr:jvdtlur)
     fjvarl1    if   e           k disk    rename(jvarpfr:jvarl1r)
     fjwprlu    uf   e           k disk    rename(jwprpfr:jwprlur)
6.25 fra10l1    if   e           k disk    rename(ra10pfr:ra10l1r)
6.39 fjvpkl1    if   e           k disk    rename(jvpkpfr:jvpkl1r)
6.39 fjvlelr    if   e           k disk    rename(jvlepfr:jvlelrr)
6.38 fanotl1    if   e           k disk    rename(anotpfr:anotl1r)
      *
     fjv126d    cf   e             workstn sfile(b1sfl:w_srrn)
     f                                     infds(dspfbk)
      *
      * Definering av parametre
      *
     d p_firm          s              3  0
     d p_otyp          s              1  0
6.3h d p_edat          s               d   datfmt(*iso)
6.3h d p_pdat          s               d   datfmt(*iso)
     d p_lety          s              1  0
8.01 d p_prgr          s              2
     d p_ldor          s                   like(jvldor)
     d p_ogrp          s                   like(jvogrp)
     d p_hgrp          s                   like(jvhgrp)
     d p_ugrp          s                   like(jvugrp)
     d p_pgiv          s                   like(jvldor)
     d p_sams          s              1  0
     d p_utgd          s              1  0
     d p_inio          s              1  0
     d p_koio          s              1  0
     d p_saio          s              1  0
6.12 d p_osor          s                   like(jvsort)
6.15 d p_vare          s                   like(jvvare)
6.21 d p_flpr          s              1  0
6.35 d p_utgp          s              1  0
      *
      * Definering av Local data area
      *
     d                uds
     d l_fnav                951    980
6.20 d l_lage               1001   1002  0
      *
      * Definering av Information Data Structure - display feedback
      *
     d dspfbk          ds
     d  d_fcrn               378    379I 0
      *
      * Definering av variabler i nøkler
      *
     d jvarl5_tek1     s                   like(jvtek1)
     d jvarl6_vare     s                   like(jvvare)
     d jvarl7_nobb     s                   like(jvnobb)
6.3g d jvlel2_llva     s                   like(jvllva)
     d vvarl1_vare     s                   like(jvvare)
6.21 d vvprl1_vare     s                   like(vpvare)
6.21 d vvprl1_ldor     s                   like(vpldor)
     d jlevl1_ldor     s                   like(jlldor)
     d jvarl1_vare     s                   like(jvvare)
     d jvdtl1_dvar     s                   like(jvdvar)
6.35 d jvprl3_ldor     s                   like(jxldor)
6.32 d jvprl1_vare     s                   like(jxvare)
6.32 d jvprl1_ldor     s                   like(jxldor)
     d jvdtlu_dvar     s                   like(jvdvar)
     d jwprlu_vare     s                   like(jbvare)
6.25 d ra10l1_firm     s                   like(vvfirm)
6.38 d anotl1_syst     s                   like(ausyst)
6.38 d anotl1_noid     s                   like(aunoid)
6.39 d jvpkl1_vare     s                   like(jwvare)
6.39 d jvpkl1_ldor     s                   like(jwldor)
6.39 d jvlelr_lldo     s                   like(jvlldo)
6.39 d jvlelr_lvnr     s                   like(jvlvnr)
      *
      * Definering av variable
      *
     d w_fcrn          s              4  0
     d w_stel          s              4  0
     d w_spge          s              4  0
     d w_srrn          s              4  0
     d w_sfrn          s                   like(w_srrn)
     d w_ssrn          s                   like(w_srrn)
      *
     d w_seqe          s              1
      *
     d b_nye_varer     s              1    inz(*off)
     d b_open_sok      s              1    inz(*off)
6.20 d b_inlr          s              1    inz(*off)
6.33 d b_filt          s              1    inz(*off)
6.39 d b_pakn          s              1    inz(*off)
      *
     d w_ldor_alf      s              6
     d w_valg          s              1  0
     d w_udat          s               d   datfmt(*iso)
6.3c d w_sdat          s               d   datfmt(*iso)
6.20 d w_utda          s               d   datfmt(*iso)
6.25 d w_utd2          s               d   datfmt(*iso)
      *
     d w_vsts          s              1  0
     d w_endr          s              4  2
     d w_grpr          s              9  2
     d w_gdat          s               d   datfmt(*iso)
     d w_enhe          s              3
     d w_enh1          s              3
     d w_enh2          s              3
     d w_enh3          s              3
     d w_eni1          s              3
     d w_eni2          s              3
     d w_eni3          s              3
     d w_enp1          s              3
     d w_enp2          s              3
     d w_enp3          s              3
     d w_ofp1          s             12  6
     d w_ofp2          s             12  6
     d w_ofp3          s             12  6
     d w_ofv2          s             12  6
     d w_ofv3          s             12  6
     d w_ofi1          s             12  6
     d w_ofi2          s             12  6
     d w_ofi3          s             12  6
     d w_bldo          s              6  0
     d w_bogr          s              2  0
     d w_bhgr          s              2  0
     d w_bugr          s              3  0
     d w_bmod          s              8  0
     d w_bvar          s             15
     d w_bvty          s              1
     d w_blet          s              1  0
     d w_bbet          s             35
     d w_ntpr          s              8  2
     d w_ifak          s              8  6
     d w_pogr          s              2  0
     d w_phgr          s              2  0
     d w_pugr          s              3  0
     d w_pldo          s              6  0
     d w_pmod          s              8  0
     d w_pvar          s             15
     d w_ppko          s              1
     d w_pvty          s              1
     d w_plet          s              1  0
     d w_kfak          s              8  6
     d w_kbel          s              7  2
     d w_sfak          s              8  6
     d w_midl          s              1  0
     d w_inpr          s              9  2
     d w_kopr          s              9  2
     d w_s1im          s              9  2
     d w_s2pr          s              9  2
     d w_s2im          s              9  2
     d w_s3pr          s              9  2
     d w_s3im          s              9  2
     d w_dekn          s              5  2
     d w_bepr          s              9  2
     d w_kepr          s              9  2
     d w_iepr          s              9  2
6.37 d w_iepr2         s              9  2
     d w_inlr          s              1
     d w_ste1          s             35
     d w_ste2          s             35
     d w_ste3          s             35
     d w_ste4          s             35
     d w_ste5          s             35
     d w_skaf          s              1  0
     d w_gprk          s              1  0
6.18 d w_antf          s              6  0
6.24 d w_hlev          s              1  0
6.33 d w_modn          s                   like(jvmodn)
6.33 d w_ko01          s              1
6.39 d w_gvar          s                   like(jvvare)
6.39 d w_genh          s                   like(jvpenh)
6.39 d w_gsta          s              1
6.3m d* w_logi          s              9  0
      *
     d s_tek1          s                   like(jvtek1)
     d s_vare          s                   like(jvvare)
     d s_nobb          s                   like(jvnobb)
     d s_lvar          s                   like(jvlvar)
     d s_stek          s             35
      *
     d w_firm          s              3  0
     d w_vare          s                   like(jvvare)
     d w_lvar          s                   like(jvlvar)
     d w_ldor          s                   like(jvldor)
     d w_xxxx          s                   like(jvldor)
     d w_ldop          s                   like(jvldor)
6.31 d w_ldox          s                   like(jvldor)
     d w_eldo          s                   like(jvldor)
     d w_enum          s                   like(jlenum)
5.70 d w_prut          s              1
6.13 d w_levr          s                   like(jvldor)
6.13 d w_ogrp          s                   like(jvogrp)
6.13 d w_hgrp          s                   like(jvhgrp)
6.13 d w_ugrp          s                   like(jvugrp)
6.13 d w_pgiv          s                   like(jvldor)
6.13 d w_lety          s              1  0
6.13 d w_sort          s                   like(jvsort)
6.20 d w_lage          s              2  0
6.34 d w_dg            s             11  2
6.3i d w_kpros         s             11  2
6.34 d w_ffak          s              8  6
6.34 d w_inp2          s              9  2
6.39 d w_gtin          s                   like(jvean1)
5.3x d w_pgbe          s              1
6.3y d w_pgfr          s              1
6.3y d w_oppd          s              1
6.3m d* w_nobb          s                   like(jvnobb)
6.3m d* w_undv          s              8  0
6.3m d* w_logl          s             15
6.3k d w_jvqvnr        s                   like(vvvare)
6.3l d w_jvquno        s              8  0
6.3l d w_jvllva        s             20
6.3m d w_erlogv        s              2  0                                      er logistikk vare
6.3m d w_erundv        s              2  0                                      er undervare
      *
      * Definering av konstanter
      *
     d c_sfil          s              2  0 inz(8)
      *
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      * w_fcrn - Første recordnummer på siden
      * w_stel - Subfile-teller
      * w_spge - Sidestørrelse i subfile (page)
      * w_srrn - Relativt recordnummer i subfile
      * w_sfrn - Første recordnummer på siste side
      * w_ssrn - Siste recordnummer på siste side
      * w_curn - Current recordnummer på siden
      * w_virn - Side og cursorplassering som skal vises
      * w_afld - Aktivt feltnavn
      * w_arow - Aktiv rad for cursor
      * w_acol - Aktiv kolonne for cursor
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      * B1SFL  - B1 Subfile - record
      * B2CTL  - B2 Subfile - control record
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B2CTL Behandle åpningsbildet med subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.3q C/Exec SQL
6.3q C+  Set Option DatFmt=*ISO, DlyPrp=*YES, SRTSEQ=*LANGIDUNQ, LANGID=NOR
6.3q C/End-Exec
      *
      * Send Alt
      *
     c     b2taga        tag
      *
     c                   write     b2cmd
      *
      * Bare data
      *
     c     b2tagb        tag
      *
     c                   exsr      dsp_subfile
      *
      * Behandling av standad funksjonstaster
      *
     c                   select
     c                   when      *inkc or *inkl
     c                   goto      avslutt
     c                   when      *inke
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *in10
     c                   exsr      crt_subfile
     c                   goto      b2tagb
     c                   when      *in11
     c                   exsr      bck_subfile
     c                   goto      b2tagb
     c                   when      *in21
     c                   eval      *in22 = *on
     c                   goto      b2taga
     c                   endsl
      *
      * F1=Filter
      *
     c                   if        *inka = *on
     c                   call      'JV143R'
6.30 c                   parm                    w_firm
     c                   parm                    w_vsts
     c                   parm                    w_endr
6.33 c                   parm                    w_modn
6.33 c                   parm                    w_ko01
6.33 c                   eval      b_filt = *on
6.3j  * legger inn lev.nr på nytt og blanker jvarl5_tek1
6.3j  * dette for å få alle linjer på nytt, nå med filter
6.3j c                   eval      w_ldor = p_ldor
6.10 c                   exsr      forny
6.10 c                   goto      b2taga
     c                   endif
      *
      * F9=Gjenta søk
      *
     c                   if        *inki = *on
     c                   eval      *in22 = *on
     c                   eval      b2stek = s_stek
     c                   goto      b2tagb
     c                   endif
      *
      * F13=Statuskoder
      *
     c                   if        *inkm = *on
     c                   call      'JV140R'
     c                   goto      b2taga
     c                   endif
      *
      * F14=Gruppebehandling
      *
     c                   if        *inkn = *on
     c                   call      'JV141R'
     c                   parm                    w_firm
     c                   parm                    b_nye_varer
     c                   parm                    p_ldor
     c                   parm                    p_ogrp
     c                   parm                    p_hgrp
     c                   parm                    p_ugrp
     c                   parm                    p_pgiv
6.3n c                   parm                    p_utgp
6.13 c                   exsr      hent_frigjort
     c                   exsr      forny
     c                   goto      b2taga
     c                   endif
      *
      * F15=Betingelser
      *
     c                   if        *inkp = *on
     c                   if        p_pgiv <> 0
     c                   move      p_pgiv        w_ldor_alf
     c                   else
     c                   move      p_ldor        w_ldor_alf
     c                   endif
     c                   call      'JP101R'
     c                   parm                    w_ldor_alf
     c                   exsr      forny
     c                   goto      b2taga
     c                   endif
      *
      * F16=Påslagsfaktorer
      *
     c                   if        *inkq = *on
     c                   call      'JC100R'
     c                   exsr      forny
     c                   goto      b2taga
     c                   endif
      *
      * F17=Forpakninger
      *
     c                   if        *inkr = *on
     c                   call      'JZ100R'
     c                   exsr      forny
     c                   goto      b2taga
     c                   endif
6.13  *
6.13  * F18=Spørring på Sortiment
6.13  *
6.13 c                   if        *inks = *on
6.13 c                   eval      w_levr = p_ldor
6.13 c                   eval      w_ogrp = p_ogrp
6.13 c                   eval      w_hgrp = p_hgrp
6.13 c                   eval      w_ugrp = p_ugrp
6.13 c                   eval      w_pgiv = p_pgiv
6.13 c                   eval      w_lety = p_lety
6.13 c                   eval      w_sort = p_osor
6.13 c                   call      'JV545R  '
6.13 c                   parm                    w_firm
6.13 c                   parm                    w_levr
6.13 c                   parm                    w_ogrp
6.13 c                   parm                    w_hgrp
6.13 c                   parm                    w_ugrp
6.13 c                   parm                    w_pgiv
6.13 c                   parm                    w_lety
6.13 c                   parm                    w_sort
6.3x c                   parm                    p_prgr
6.13 c                   exsr      forny
6.13 c                   goto      b2taga
6.13 c                   endif
      *
      * F20=Start overføring
      *
     c                   if        *inku = *on
6.15 c                   eval      p_vare = *blank
     c                   call      'JV127R'
     c                   parm                    p_firm
     c                   parm                    p_otyp
6.3h c                   parm                    p_edat
6.3h c                   parm                    p_pdat
     c                   parm                    p_ldor
     c                   parm                    p_ogrp
     c                   parm                    p_hgrp
     c                   parm                    p_ugrp
     c                   parm                    p_pgiv
     c                   parm                    p_sams
     c                   parm                    p_utgd
     c                   parm                    p_inio
     c                   parm                    p_koio
     c                   parm                    p_saio
5.70 c                   parm                    p_prgr
6.12 c                   parm                    p_osor
6.15 c                   parm                    p_vare
6.21 c                   parm                    p_flpr
6.35 c                   parm                    p_utgp
     c                   eval      w_vsts = 0
     c                   eval      w_endr = 0
6.23 c*                  exsr      nullst_frigj
6.19 c                   exsr      hent_frigjort
     c                   exsr      forny
     c                   goto      b2taga
     c                   endif
      *
      * F23=Bytt informasjon (varenr/nobbnr/lev.varenr)
      *
     c                   if        *inkx = *on
      *
     c                   if        *in80 = *on
     c                   eval      *in80 = *off
     c                   eval      *in81 = *on
     c                   exsr      forny
     c                   goto      b2taga
     c                   endif
      *
     c                   if        *in81 = *on
     c                   eval      *in81 = *off
     c                   eval      *in82 = *on
     c                   exsr      forny
     c                   goto      b2taga
     c                   endif
      *
     c                   if        *in82 = *on
     c                   eval      *in82 = *off
     c                   eval      *in80 = *on
     c                   exsr      forny
     c                   goto      b2taga
     c                   endif
      *
     c                   endif
      *
      * Søking
      *
     c                   if        b2stek <> *blank
     c                   exsr      sØk
     c                   goto      b2tagb
     c                   endif
      *
      * Posisjonering
      *
     c                   if        b2tek1 <> *blank or
     c                             b2vare <> 0 or
     c                             b2nobb <> 0 or
     c                             b2lvar <> *blank
     c                   exsr      posisjoner
     c                   goto      b2taga
     c                   endif
      *
      * Behandling av subfile
      *
     c                   exsr      subfile
      *
     c                   goto      b2taga
      *
      * Avslutt program
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for fornying av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     forny         begsr
      *
     c                   if        w_fcrn <> 0
     c     w_fcrn        chain     b1sfl
     c                   endif
      *
     c                   eval      b_open_sok = *on
      *
     c                   select
     c                   when      w_seqe = 'V'
     c                   eval      s_vare = b1vare
     c                   if        p_ldor <> 0
     c                   eval      jvarl6_vare = b1vare
     c     jvarl6_key    setll     jvarl6
     c                   endif
     c                   when      w_seqe = 'N'
     c                   eval      s_nobb = b1nobb
     c                   if        p_ldor <> 0
     c                   eval      jvarl7_nobb = b1nobb
     c     jvarl7_key    setll     jvarl7
     c                   endif
     c                   when      w_seqe = 'L'
     c                   eval      s_lvar = b1lvar
     c                   if        p_ldor <> 0
6.3g c                   eval      jvlel2_llva = b1lvar
6.3g c     jvlel2_key    setll     jvlel2
     c                   endif
     c                   other
6.33 c                   if        b_filt = *off
     c                   eval      s_tek1 = b1tek1
6.33 c                   else
6.33 c                   eval      s_tek1 = *blank
6.33 c                   endif
     c                   if        p_ldor <> 0
6.3j c                   if        b_filt = *on
6.3j c                   eval      jvarl5_tek1 = *blank
6.3j c                   else
     c                   eval      jvarl5_tek1 = b1tek1
6.3j c                   endif
     c     jvarl5_key    setll     jvarl5
     c                   endif
     c                   endsl
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for søking i subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sØk           begsr
      *
      * Tar vare på søk
      *
     c                   eval      s_stek = b2stek
      *
      * Søk via søketekst
      *
     c                   call      'AS701R'
     c                   parm                    b2stek
     c                   parm                    w_ste1
     c                   parm                    w_ste2
     c                   parm                    w_ste3
     c                   parm                    w_ste4
     c                   parm                    w_ste5
      *
     c                   eval      b_open_sok = *on
      *
     c                   eval      w_seqe = 'S'
      *
     c                   if        p_ldor <> 0
     c                   eval      jvarl5_tek1 = *blank
     c     jvarl5_key    setll     jvarl5
     c                   endif
      *
      * Blanker subfile, og fyller opp i.h.t. søk
      *
     c                   eval      *in22 = *off
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
      * Blanker søkefelt
      *
     c                   eval      b2stek = *blank
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for posisjonering i subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     posisjoner    begsr
      *
     c                   eval      b_open_sok = *on
      *
     c                   eval      s_tek1 = *blank
     c                   eval      s_vare = *blank
     c                   eval      s_nobb = 0
     c                   eval      s_lvar = *blank
      *
      * Varetekst
      *
     c                   if        b2tek1 <> *blank
     c                   eval      w_seqe = *blank
     c                   eval      s_tek1 = b2tek1
     c                   if        p_ldor <> 0
     c                   eval      jvarl5_tek1 = b2tek1
     c     jvarl5_key    setll     jvarl5
     c                   endif
     c                   goto      end_pos
     c                   endif
      *
      * Varenummer
      *
     c                   if        b2vare <> 0
     c                   eval      w_seqe = 'V'
     c                   eval      *in80 = *on
     c                   eval      *in81 = *off
     c                   eval      *in82 = *off
     c                   movel     b2vare        s_vare
     c                   if        p_ldor <> 0
     c                   movel     b2vare        jvarl6_vare
     c     jvarl6_key    setll     jvarl6
     c                   endif
     c                   goto      end_pos
     c                   endif
      *
      * Nobbnummer
      *
     c                   if        b2nobb <> 0
     c                   eval      w_seqe = 'N'
     c                   eval      *in80 = *off
     c                   eval      *in81 = *on
     c                   eval      *in82 = *off
     c                   eval      s_nobb = b2nobb
     c                   if        p_ldor <> 0
     c                   eval      jvarl7_nobb = b2nobb
     c     jvarl7_key    setll     jvarl7
     c                   endif
     c                   goto      end_pos
     c                   endif
      *
      * Leverandørens varenummer
      *
     c                   if        b2lvar <> *blank
     c                   eval      w_seqe = 'L'
     c                   eval      *in80 = *off
     c                   eval      *in81 = *off
     c                   eval      *in82 = *on
     c                   eval      s_lvar = b2lvar
     c                   if        p_ldor <> 0
6.3g c                   eval      jvlel2_llva = b2lvar
6.3g c     jvlel2_key    setll     jvlel2
     c                   endif
     c                   goto      end_pos
     c                   endif
      *
     c     end_pos       tag
      *
      * Blanker subfile, og fyller opp i.h.t. posisjonering
      *
     c                   eval      *in22 = *off
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
      * Blanker posisjoneringsfelter
      *
     c                   eval      b2tek1 = *blank
     c                   eval      b2vare = 0
     c                   eval      b2lvar = *blank
     c                   eval      b2nobb = 0
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     subfile       begsr
      *
     c                   if        *in22 = *off
     c                   eval      *in22 = *on
     c                   else
     c                   eval      *in22 = *off
     c                   endif
      *
     c                   eval      w_virn = w_fcrn
      *
      * Leser og behandler subfile
      *
     c                   do        w_ssrn
     c                   readc     b1sfl
      *
     c                   if        %eof
     c                   leave
     c                   endif
      *
     c                   eval      *in22 = *off
     c                   eval      w_virn = w_srrn
      *
      * Endre
      *
     c                   if        b1valg = 2
     c                   exsr      xc2bld
     c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = b1vare
6.3k c                   exsr      finn_logivar                                 farge
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Holde tilbake
      *
     c                   if        b1valg = 3
     c                   exsr      hold_vare
     c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = b1vare
6.3k c                   exsr      finn_logivar                                 farge
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Vis
      *
     c                   if        b1valg = 5
6.3d c                   exsr      sjekk_jvle
6.3m c                   if        b1udev > 0
6.3m c                   movel     b1nobb        w_vare
6.3m c                   else
     c                   eval      w_vare = b1vare
6.3m c                   endif
     c                   call      'JV510R'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = w_vare
6.3k c                   exsr      finn_logivar                                 farge
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Frigi
      *
     c                   if        b1valg = 6
     c                   exsr      frigi_vare
     c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = b1vare
6.3k c                   exsr      finn_logivar                                 farge
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Vedlikehold av vare-pris
      *
     c                   if        b1valg = 7
6.3d c                   exsr      sjekk_jvle
     c                   eval      w_vare = b1vare
     c                   call      'JX100R'
     c                   parm                    w_vare
     c                   exsr      hent_pris
     c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = w_vare
6.3k c                   exsr      finn_logivar                                 farge
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Vedlikehold av vare-pakning
      *
     c                   if        b1valg = 8
6.3d c                   exsr      sjekk_jvle
     c                   eval      w_vare = b1vare
     c                   call      'JW100R'
     c                   parm                    w_firm
     c                   parm                    w_vare
6.31 c                   parm                    w_ldox
     c                   exsr      hent_pris
     c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = w_vare
6.3k c                   exsr      finn_logivar                                 farge
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Vedlikehold av søketekster
      *
     c                   if        b1valg = 9
     c                   eval      w_vare = b1vare
     c                   call      'JS100R'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = w_vare
6.3k c                   exsr      finn_logivar                                 farge
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Velg betingelse
      *
     c                   if        b1valg = 10
     c                   eval      w_vare = b1vare
     c                   call      'JP500R'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   parm                    p_pgiv
6.3x c                   parm                    p_prgr
     c                   parm                    p_lety
     c                   exsr      hent_pris
     c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = w_vare
6.3k c                   exsr      finn_logivar                                 farge
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Vis produktinformasjon
      *
     c                   if        b1valg = 11
     c                   eval      w_vare = b1vare
     c                   call      'JU510R'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = w_vare
6.3k c                   exsr      finn_logivar                                 farge
     c                   update    b1sfl
     c                   iter
     c                   endif
6.11  *
6.11  * Endre enhet i EVR
6.11  *
6.11 c                   if        b1valg = 12
6.11 c                   eval      w_vare = b1vare
6.11 c                   call      'JV144R'
6.11 c                   parm                    w_firm
6.11 c                   parm                    w_vare
6.11 c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = w_vare
6.3k c                   exsr      finn_logivar                                 farge
6.15 c                   update    b1sfl
6.11 c                   iter
6.11 c                   endif
6.39  *
6.39  * Se på gtin i EVR
6.39  *
6.39 c                   if        b1valg = 13
6.11 c                   eval      w_vare = b1vare
6.39 c                   eval      w_gtin = 0
6.39 c                   exsr      sjekk_gtin
6.39 c                   if        w_gtin <> 0
6.39 c                   call      'VE540R'
6.39 c                   parm                    w_gtin
     c                   exsr      hent_pris
6.39 c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = b1vare
6.3k c                   exsr      finn_logivar                                 farge
6.39 c                   update    b1sfl
6.39 c                   iter
6.39 c                   endif
6.39 c                   endif
6.3m  *
6.3m  * Vis logistikkvare
6.3m  *
6.3m c                   if        b1valg = 14
6.3m c                   if        b1udev > 0 or b1logv > 0
6.3m c                   eval      w_vare = b1vare
6.3m c                   call      'JK110R'
6.3m c                   parm                    w_vare
6.3m c                   endif
6.3m c                   eval      b1valg = 0
6.3m c*                   eval      w_jvqvnr = b1vare
6.3m c                   exsr      finn_logivar
6.3m c                   update    b1sfl
6.3m c                   iter
6.3m c                   endif
      *
      * Kalkulasjon
      *
     c                   if        b1valg = 15
     c                   eval      w_vare = b1vare
     c                   call      'JV142R'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   parm                    p_pgiv
     c                   parm                    p_lety
     c                   parm                    w_skaf
5.70 c                   parm                    p_prgr
6.24 c                   parm                    w_hlev
6.3h c                   parm                    p_edat
6.3h c                   parm                    p_pdat
6.35 c                   parm                    p_utgp
     c                   exsr      hent_pris
     c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = w_vare
6.3k c                   exsr      finn_logivar                                 farge
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Fjern midlertidig pris
      *
     c                   if        b1valg = 17
     c                   eval      jwprlu_vare = b1vare
     c     jwprlu_key    chain     jwprlur
     c                   if        %found
     c                   delete    jwprlur
     c                   endif
     c                   exsr      hent_pris
     c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = b1vare
6.3k c                   exsr      finn_logivar                                 farge
     c                   update    b1sfl
     c                   iter
     c                   endif
6.15  *
6.15  * Tvangsoverfør
6.15  *
6.15 c                   if        b1valg = 19
6.3e c                   if        b1osts = '7' or
6.3e c                             b1osts = 'G' or
6.15 c                             b1osts = 'O'
6.15 c                   eval      p_vare = b1vare
6.15 c                   call      'JV127R'
6.15 c                   parm                    p_firm
6.15 c                   parm                    p_otyp
6.3h c                   parm                    p_edat
6.3h c                   parm                    p_pdat
6.15 c                   parm                    p_ldor
6.15 c                   parm                    p_ogrp
6.15 c                   parm                    p_hgrp
6.15 c                   parm                    p_ugrp
6.15 c                   parm                    p_pgiv
6.15 c                   parm                    p_sams
6.15 c                   parm                    p_utgd
6.15 c                   parm                    p_inio
6.15 c                   parm                    p_koio
6.15 c                   parm                    p_saio
5.70 c                   parm                    p_prgr
6.12 c                   parm                    p_osor
6.12 c                   parm                    p_vare
6.21 c                   parm                    p_flpr
6.35 c                   parm                    p_utgp
6.15 c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = b1vare
6.3k c                   exsr      finn_logivar                                 farge
6.15 c                   update    b1sfl
6.15 c                   iter
6.15 c                   else
6.15 c                   exsr      xc1msg
6.15 c                   eval      b1valg = 0
6.3k c                   eval      w_jvqvnr = b1vare
6.3k c                   exsr      finn_logivar                                 farge
6.15 c                   update    b1sfl
6.15 c                   iter
6.15 c                   endif
6.15 c                   endif
      *
     c                   enddo
      *
     c                   endsr
      *
6.15  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.15  * Subrutine for utlegging av melding
6.15  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.15  *
6.15 c     xc1msg        begsr
6.15  *
6.15 c                   exfmt     c1msg
6.15  *
6.15  * Behandling av funksjonstaster
6.15  *
6.15 c                   if        *inkc or *inkl
6.15 c                   leavesr
6.15 c                   endif
6.15  *
6.15 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * C2BLD Behandle bilde for endring av vareingormasjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xc2bld        begsr
      *
6.3m c                   if        b1udev > 0
6.3m c                   movel     b1nobb        w_vare
6.3m c                   else
     c                   eval      w_vare = b1vare
6.3m c                   endif
     c                   eval      w_valg = 2
      *
     c                   call      'JV101R'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   parm                    w_valg
      *
      * Oppdater subfile
      *
6.3m c                   if        b1udev > 0
6.3m c                   movel     b1nobb        jvarl1_vare
6.3m c                   else
     c                   eval      jvarl1_vare = b1vare
6.3m c                   endif
     c     jvarl1_key    chain     jvarl1
     c                   if        %found
      *
     c                   eval      b1tek1 = jvtek1
     c                   eval      b1nobb = jvnobb
     c                   eval      b1lvar = jvlvar
     c                   eval      b1pkod = *blank
     c                   eval      b1skod = 0
     c                   eval      b1vtyp = *blank
     c                   eval      b1hkod = 'X'
      * finn nobb og lvar fra undervare
6.3l c                   eval      w_jvquno = 0
6.3l c                   eval      w_jvllva = *blank
6.3l c/exec sql
6.3l c+ select IFNULL(jvquno, 0) , IFNULL(jvllva, '''')
6.3l c+ into   :w_jvquno, :w_jvllva
6.3l c+ from   jvklpf
6.3l c+ inner join jvlepf on jvlvnr = jvqvnr and
6.3l c+  jvlldo = jvqldo
6.3l c+ where  jvqvnr = :jvvare and
6.3l c+        jvqldo = :p_pgiv and
6.3l c+        jvqfir = :w_firm
6.3l c+ fetch first 1 rows only
6.3l c/end-exec
6.3l c                   if        w_jvquno > 0
6.3l c                   eval      jvnobb = w_jvquno
6.3m c                   eval      b1nobb = w_jvquno
6.36 c                   movel     w_jvllva      b1lvar
6.3l c                   movel     w_jvllva      jvlvar
6.3l c                   endif
      *
6.25 c                   exsr      utga_lagere
6.25  * hvis utgått på alle lager:
6.25 c                   if        w_utd2 <> *loval
6.25 c                   if        w_utd2 <= w_udat
6.25 c                   eval      b1tek1 = %subst(jvtek1:1:19) +
6.25 c                                      ' ** UTGÅTT**'
6.25 c                   else
6.25 c                   eval      b1tek1 = %subst(jvtek1:1:19) +
6.25 c                                      ' ** UTGÅR **'
6.25 c                   endif
6.25 c                   endif

6.22 c                   if        jvstat = 4
6.22 c                   eval      b1tek1 = %subst(jvtek1:1:18) +
6.22 c                                      ' **SLETTET*'
6.22 c                   endif
6.22 c                   if        jvudat    <> *loval and
6.22 c                             jvudat    <= w_udat
6.22 c                   eval      b1tek1 = %subst(jvtek1:1:19) +
6.22 c                                      ' *NOBB.UTG.*'
6.22 c                   endif
      *
     c                   select
     c                   when      *in80 = *on
     c                   eval      b1nypo = jvvare
     c                   when      *in81 = *on
     c                   eval      b1nypo = %editc(jvnobb : 'Z')
     c                   when      *in82 = *on
6.3b c*                  eval      b1nypo = jvlvar
6.3b c                   movel     jvlvar        b1nypo
     c                   endsl
      *
     c                   endif
      *
     c                   eval      jvdtl1_dvar = b1vare
     c     jvdtl1_key    chain     jvdtl1
     c                   if        %found
     c                   eval      b1pkod = jvdpko
     c                   eval      b1skod = jvdsko
     c                   if        jvdsko = 1
     c                   eval      b1vtyp = 'S'
     c                   endif
     c                   if        jvdhko = 0
     c                   eval      b1hkod = *blank
     c                   endif
     c                   endif
      *
     c                   exsr      hent_pris
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å holde vare tilbake fra overføring
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hold_vare     begsr
      *
     c                   clear                   jvdtlur
      *
     c                   eval      jvdtlu_dvar = b1vare
     c     jvdtlu_key    chain     jvdtlur
      *
6.16 c                   if        jvdhko = 0
6.18 c                   eval      w_antf = w_antf - 1
6.16 c                   endif
6.18 c                   if        w_antf < 10000
6.18 c                   eval      b2antf = w_antf
6.18 c                   else
6.18 c                   eval      b2antf = 9999
6.18 c                   endif
     c                   eval      jvdhko = 1
     c                   if        %found
     c                   update    jvdtlur
     c                   else
     c                   eval      jvdfir = w_firm
     c                   eval      jvdvar = b1vare
     c                   write     jvdtlur
     c                   endif
      *
      * Oppdater subfile
      *
     c                   eval      b1hkod = 'X'
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å frigi vare for overføring
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     frigi_vare    begsr
      *
     c                   clear                   jvdtlur
      *
     c                   eval      jvdtlu_dvar = b1vare
     c     jvdtlu_key    chain     jvdtlur
      *
6.16 c                   if        jvdhko = 1
6.18 c                   eval      w_antf = w_antf + 1
6.16 c                   endif
6.18 c                   if        w_antf < 10000
6.18 c                   eval      b2antf = w_antf
6.18 c                   else
6.18 c                   eval      b2antf = 9999
6.18 c                   endif
      *
     c                   eval      jvdhko = 0
     c                   if        %found
     c                   update    jvdtlur
     c                   else
     c                   eval      jvdfir = w_firm
     c                   eval      jvdvar = b1vare
     c                   write     jvdtlur
     c                   endif
      *
      * Oppdater subfile
      *
     c                   eval      b1hkod = *blank
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for henting av prisinformasjon på vare
      * Eksisterndene salgspris hentes fra eget vareregister
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - --
      *
     c     hent_pris     begsr
      *
     c                   eval      b1endr = 0
     c                   eval      b1midl = *blank
      *
      * Henter salgspris fra fellesprogram
      *
     c                   eval      w_gprk = 0
     c                   eval      w_ldop = p_pgiv
6.3y c                   eval      w_oppd = *blank
      *
     c                   call      'JV750R'
     c                   parm                    w_firm
     c                   parm                    b1vare
5.70 c                   parm                    p_prgr
     c                   parm                    w_ldop
     c                   parm                    b1pkod
     c                   parm                    b1skod
     c                   parm                    p_lety
     c                   parm                    w_gprk
6.3h c                   parm                    p_pdat
6.3h c                   parm                    p_utgp
      *
     c                   parm                    b1osts
      *
     c                   parm                    w_xxxx
     c                   parm                    w_lvar
     c                   parm                    w_eldo
     c                   parm                    w_grpr
     c                   parm                    w_gdat
      *
     c                   parm                    w_enhe
     c                   parm                    w_enh1
     c                   parm                    w_enh2
     c                   parm                    w_enh3
     c                   parm                    w_eni1
     c                   parm                    w_eni2
     c                   parm                    w_eni3
     c                   parm                    w_enp1
     c                   parm                    w_enp2
     c                   parm                    w_enp3
     c                   parm                    w_ofp1
     c                   parm                    w_ofp2
     c                   parm                    w_ofp3
     c                   parm                    w_ofv2
     c                   parm                    w_ofv3
     c                   parm                    w_ofi1
     c                   parm                    w_ofi2
     c                   parm                    w_ofi3
      *
     c                   parm                    w_bldo
     c                   parm                    w_bogr
     c                   parm                    w_bhgr
     c                   parm                    w_bugr
     c                   parm                    w_bmod
     c                   parm                    w_bvar
     c                   parm                    w_bvty
     c                   parm                    w_blet
     c                   parm                    w_bbet
     c                   parm                    w_ntpr
     c                   parm                    w_ifak
      *
     c                   parm                    w_pogr
     c                   parm                    w_phgr
     c                   parm                    w_pugr
     c                   parm                    w_pldo
     c                   parm                    w_pmod
     c                   parm                    w_pvar
     c                   parm                    w_ppko
     c                   parm                    w_pvty
     c                   parm                    w_plet
     c                   parm                    w_kfak
     c                   parm                    w_kbel
     c                   parm                    w_sfak
      *
     c                   parm                    w_midl
     c                   parm                    w_inpr
     c                   parm                    w_kopr
     c                   parm                    b1s1pr
     c                   parm                    w_s1im
     c                   parm                    w_s2pr
     c                   parm                    w_s2im
     c                   parm                    w_s3pr
     c                   parm                    w_s3im
     c                   parm                    w_dekn
5.70 c                   parm                    w_prut
6.34 c                   parm                    w_ffak
6.34 c                   parm                    w_inp2
5.3x c                   parm                    w_pgbe
6.3y c                   parm                    w_pgfr
6.3y c                   parm                    w_oppd
      *
6.34 c                   eval(h)   w_inpr = w_inpr * w_ffak
      *
      * Henter salgspris fra EVR, og beregner prosentvis endring av pris
6.3c c                   if        w_gdat > w_udat
6.3c c                   eval      w_sdat = w_gdat
6.3c c                   else
6.3c c                   eval      w_sdat = w_udat
6.3c c                   endif
      *
6.21 c                   call      'VP712R'
     c                   parm                    w_firm
     c                   parm                    b1vare
6.21 c                   parm                    w_enum
     c                   parm                    p_prgr
     c                   parm                    w_enh1
     c                   parm                    p_lety
6.3c c                   parm                    w_sdat
     c                   parm                    w_inlr
     c                   parm                    b1sepr
     c                   parm                    w_bepr
     c                   parm                    w_kepr
     c                   parm                    w_iepr
6.37 c                   parm                    w_iepr2
6.24 c                   parm                    w_hlev
      *
     c                   if        b1sepr <> 0
     c                   if        %abs((100 * b1s1pr / b1sepr) - 100) > 999,99
     c                   eval      b1endr = 999,99
     c                   else
     c                   eval(h)   b1endr = (100 * b1s1pr / b1sepr) - 100
     c                   endif
     c                   endif
6.34  *
6.34  * Beregner DG
6.34  *
6.3l c*                  if        *in81 = *on
6.3l c                   if        *in80 = *on
6.34 c                   eval      w_dg = 0
6.34 c                   if        w_kopr <> 0 and
6.34 c                             b1s1pr <> 0
6.34 c                   select
6.34 c                   when      (100 - (w_kopr * 100 / b1s1pr)) < -99,99
6.34 c                   eval      w_dg   = -99,99
6.34 c                   when      (100 - (w_kopr * 100 / b1s1pr)) > 99,99
6.34 c                   eval      w_dg   = 99,99
6.34 c                   other
6.34 c                   eval(h)   w_dg   = 100 - (w_kopr * 100 / b1s1pr)
6.34 c                   endsl
6.34 c                   eval      b1endr = w_dg
6.34  *
6.34 c                   endif
6.34 c                   endif
6.3i  *
6.3i  * Beregner % endring på kostpris
6.3i  *
6.3i c                   if        *in82 = *on and
6.3i c                             w_kepr <> 0
6.3i c                   eval      w_kpros = 0
6.3i c                   if        %abs((100 * w_kopr / w_kepr) - 100) > 999,99
6.3i c                   eval      w_kpros = 999,99
6.3i c                   else
6.3i c                   eval(h)   w_kpros = (100 * w_kopr / w_kepr) - 100
6.3i c                   endif
6.3i c                   eval      b1endr = w_kpros
6.3i  *
6.3i c                   endif
      *
      * Setter midlertidig prisoppdatert-flagg
      *
     c                   if        w_midl = 1
     c                   eval      b1midl = 'M'
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for tømming av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     clr_subfile   begsr
      *
     c                   eval      *in14 = *on
     c                   write     b2ctl
     c                   eval      *in14 = *off
      *
     c                   eval      *in15 = *off
     c                   eval      w_srrn = 0
     c                   eval      w_sfrn = 0
     c                   eval      w_ssrn = 0
     c                   eval      w_spge = 0
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å fylle opp subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     crt_subfile   begsr
      *
     c                   if        p_ldor = 0 and
     c                             b_open_sok = *on
      *
     c                   select
     c                   when      w_seqe = 'V'
     c/exec sql
     c+ declare vare cursor for
6.3m c+ select * from (
6.3m c+ select v.jvtek1,
     c+        v.jvnobb,
6.3m c*+        v.jvvare,
6.3m c+        ifnull( (select jvqvnr from jvklpf where
6.3m c+           jvquno = v.jvnobb and jvqldo = p.jvlldo), v.jvvare) as jvvare,
     c+        v.jvogrp,
     c+        v.jvhgrp,
     c+        v.jvugrp,
6.30 c+        v.jvmodn,
     c+        v.jvsort,
6.36 c+        p.jvlvnr,
6.36 c+        p.jvlldo,
6.36 c+        p.jvllva
6.3m c+        ,(select count(*) from jvkhpf where jvkvnr=v.jvvare) as lvare
6.3m c+        ,(select count(*) from jvklpf where jvquno=v.jvnobb) as uvare
os71 c+ from   jvarpf as v inner join
6.36 c+        jvlepf as p on
6.36 c+        v.jvvare  = p.jvlvnr
6.36 c+ where  p.jvlldo  = :p_pgiv and
6.3m c*+        v.jvvare  >= :s_vare and
6.3m c+         v.jvvare not in                                                 ikke logistikk vare
6.3m c+        (select jvkvnr from jvkhpf
6.3m c+         where jvkfir = :w_firm)
6.3m c*+        v.jvvare  in
6.3m c*+        (select vvvare from vvarpf
6.3m c*+         where vvfirm = :w_firm)  and
6.3m c*+         v.jvnobb not in
6.3m c*+        (select jvquno from jvklpf
6.3m c*+        where jvqfir = :w_firm)
6.3m c+ ) aa
6.3m c+   where    aa.jvvare  >= :s_vare and
6.3m c+            aa.jvvare  in                                                i EVR
6.3m c+        (select vvvare from vvarpf
6.3m c+         where vvfirm = :w_firm)
6.3m c+ order by aa.jvvare, aa.jvtek1
     c+ for read only
     c/end-exec
     c/exec sql
     c+ close vare
     c/end-exec
     c/exec sql
     c+ open vare
     c/end-exec
     c                   when      w_seqe = 'N'
     c/exec sql
     c+ declare nobb cursor for
6.3m c+ select * from (
6.3m c+ select v.jvtek1,
     c+        v.jvnobb,
6.3m c*+        v.jvvare,
6.3m c+        ifnull( (select jvqvnr from jvklpf where
6.3m c+           jvquno = v.jvnobb and jvqldo = p.jvlldo), v.jvvare) as jvvare,
     c+        v.jvogrp,
     c+        v.jvhgrp,
     c+        v.jvugrp,
6.33 c+        v.jvmodn,
     c+        v.jvsort,
6.36 c+        p.jvlvnr,
6.36 c+        p.jvlldo,
6.36 c+        p.jvllva
6.3m c+        ,(select count(*) from jvkhpf where jvkvnr=v.jvvare) as lvare
6.3m c+        ,(select count(*) from jvklpf where jvquno=v.jvnobb) as uvare
os71 c+ from   jvarpf as v inner join
6.36 c+        jvlepf as p on
6.36 c+        v.jvvare  = p.jvlvnr
6.36 c+ where  p.jvlldo  = :p_pgiv and
6.3m c+        (v.jvnobb  >= :s_nobb
6.3m c*+        (v.jvnobb  >= :s_nobb or
6.3m c*+        v.jvvare in
6.3m c*+        (select jvqvnr from jvklpf
6.3m c*+         where jvqldo = :p_pgiv)) and
6.3m c+         ) and
6.3m c+         v.jvvare not in                                                 ikke logistikk vare
6.3m c+        (select jvkvnr from jvkhpf
6.3m c+         where jvkfir = :w_firm)
6.3m c*+        and v.jvvare  in
6.3m c*+        (select vvvare from vvarpf
6.3m c*+         where vvfirm = :w_firm)
6.3m c*+         where vvfirm = :w_firm)  and
6.3m c*+         v.jvnobb not in
6.3m c*+        (select jvquno from jvklpf
6.3m c*+        where jvqfir = :w_firm)
6.3m c+ ) aa
6.3m c+   where    aa.jvvare  in                                                i EVR
6.3m c+        (select vvvare from vvarpf
6.3m c+         where vvfirm = :w_firm)
6.3m c+ order by aa.jvnobb, aa.jvtek1
     c+ for read only
     c/end-exec
     c/exec sql
     c+ close nobb
     c/end-exec
     c/exec sql
     c+ open nobb
     c/end-exec
     c                   when      w_seqe = 'L'
     c/exec sql
     c+ declare lev_vare cursor for
6.3m c+ select * from (
6.36 c+ select p.jvlvnr,
6.36 c+        p.jvlldo,
6.36 c+        p.jvllva,
     c+        v.jvtek1,
     c+        v.jvnobb,
6.3m c*+        v.jvvare,
6.3m c+        ifnull( (select jvqvnr from jvklpf where
6.3m c+           jvquno = v.jvnobb and jvqldo = p.jvlldo), v.jvvare) as jvvare,
     c+        v.jvogrp,
     c+        v.jvhgrp,
     c+        v.jvugrp,
6.33 c+        v.jvmodn,
     c+        v.jvsort
6.3m c+        ,(select count(*) from jvkhpf where jvkvnr=v.jvvare) as lvare
6.3m c+        ,(select count(*) from jvklpf where jvquno=v.jvnobb) as uvare
6.36 c+ from   jvlepf as p inner join
os71 c+        jvarpf as v on
6.36 c+        p.jvlvnr  = v.jvvare
6.36 c+ where  p.jvlldo  = :p_pgiv and
6.36 c+        p.jvllva  >= :s_lvar and
6.3m c+         v.jvvare not in                                                 ikke logistikk vare
6.3m c+        (select jvkvnr from jvkhpf
6.3m c+         where jvkfir = :w_firm)
6.3m c*+        v.jvvare  in
6.3m c*+        (select vvvare from vvarpf
6.3m c*+         where vvfirm = :w_firm)  and
6.3m c*+         v.jvnobb not in
6.3m c*+        (select jvquno from jvklpf
6.3m c*+        where jvqfir = :w_firm)
6.3m c+ order by p.jvlldo,  p.jvllva, v.jvtek1
6.3m c+ ) aa
6.3m c+   where    aa.jvvare  in                                                i EVR
6.3m c+        (select vvvare from vvarpf
6.3m c+         where vvfirm = :w_firm)
6.3m c+ order by aa.jvlldo, aa.jvllva, aa.jvtek1
     c+ for read only
     c/end-exec
     c/exec sql
     c+ close lev_vare
     c/end-exec
     c/exec sql
     c+ open lev_vare
     c/end-exec
6.3m c                   when      w_seqe = 'S'
6.3m c/exec sql
6.3m c+ declare fsok cursor for
6.3m c+ select * from (
6.3m c+ select v.jvtek1,
6.3m c+        v.jvnobb,
6.3m c*+        v.jvvare,
6.3m c+        ifnull( (select jvqvnr from jvklpf where
6.3m c+           jvquno = v.jvnobb and jvqldo = p.jvlldo), v.jvvare) as jvvare,
6.3m c+        v.jvogrp,
6.3m c+        v.jvhgrp,
6.3m c+        v.jvugrp,
6.3m c+        v.jvmodn,
6.3m c+        v.jvsort,
6.3m c+        p.jvlvnr,
6.3m c+        p.jvlldo,
6.3m c+        p.jvllva
6.3m c+        ,(select count(*) from jvkhpf where jvkvnr=v.jvvare) as lvare
6.3m c+        ,(select count(*) from jvklpf where jvquno=v.jvnobb) as uvare
6.3m c+ from   jvarpf as v inner join
6.3m c+        jvlepf as p on
6.3m c+        v.jvvare  = p.jvlvnr
6.3m c+        inner join
6.3m c+        jvsost as s on
6.3m c+        v.jvvare = s.jvsvar
6.3m c+ where  p.jvlldo  = :p_pgiv  and
6.3m c+        v.jvtek1  >= :s_tek1  and
6.3m c+         v.jvvare not in                                                 ikke logistikk vare
6.3m c+        (select jvkvnr from jvkhpf
6.3m c+         where jvkfir = :w_firm)
6.3m c*+        v.jvvare  in
6.3m c*+        (select vvvare from vvarpf
6.3m c*+         where vvfirm = :w_firm)  and
6.3m c*+         v.jvnobb not in
6.3m c*+        (select jvquno from jvklpf
6.3m c*+        where jvqfir = :w_firm)
6.3m c+        and
6.3m c+        s.jvstek like :w_ste1 and
6.3m c+        s.jvstek like :w_ste2 and
6.3m c+        s.jvstek like :w_ste3 and
6.3m c+        s.jvstek like :w_ste4
6.3m c+ order by v.jvtek1,  v.jvnobb
6.3m c+ ) aa
6.3m c+   where    aa.jvvare  in                                                i EVR
6.3m c+        (select vvvare from vvarpf
6.3m c+         where vvfirm = :w_firm)
6.3m c+ order by aa.jvtek1, aa.jvnobb
6.3m c+ for read only
6.3m c/end-exec
6.3m c/exec sql
6.3m c+ close fsok
6.3m c/end-exec
6.3m c/exec sql
6.3m c+ open fsok
6.3m c/end-exec
     c                   other
     c/exec sql
     c+ declare tekst cursor for
6.3m c+ select * from (
     c+ select v.jvtek1,
     c+        v.jvnobb,
6.3m c*+        v.jvvare,
6.3m c+        ifnull( (select jvqvnr from jvklpf where
6.3m c+           jvquno = v.jvnobb and jvqldo = p.jvlldo), v.jvvare) as jvvare,
     c+        v.jvogrp,
     c+        v.jvhgrp,
     c+        v.jvugrp,
6.33 c+        v.jvmodn,
     c+        v.jvsort,
6.36 c+        p.jvlvnr,
6.36 c+        p.jvlldo,
6.36 c+        p.jvllva
6.3m c+        ,(select count(*) from jvkhpf where jvkvnr=v.jvvare) as lvare
6.3m c+        ,(select count(*) from jvklpf where jvquno=v.jvnobb) as uvare
os71 c+ from   jvarpf as v inner join
os71 c+        jvlepf as p on
6.36 c+        v.jvvare  = p.jvlvnr
6.36 c+ where  p.jvlldo  = :p_pgiv  and
     c+        v.jvtek1  >= :s_tek1  and
6.3m c+         v.jvvare not in                                                 ikke logistikk vare
6.3m c+        (select jvkvnr from jvkhpf
6.3m c+         where jvkfir = :w_firm)
6.3m c*+        v.jvvare  in
6.3m c*+        (select vvvare from vvarpf
6.3m c*+         where vvfirm = :w_firm)  and
6.3m c*+         v.jvnobb not in
6.3m c*+        (select jvquno from jvklpf
6.3m c*+        where jvqfir = :w_firm)
6.3m c+ order by  v.jvtek1,  v.jvnobb
6.3m c+ ) aa
6.3m c+   where    aa.jvvare  in                                                i EVR
6.3m c+        (select vvvare from vvarpf
6.3m c+         where vvfirm = :w_firm)
6.3m c+ order by aa.jvtek1, aa.jvnobb
     c+ for read only
     c/end-exec
     c/exec sql
     c+ close tekst
     c/end-exec
     c/exec sql
     c+ open tekst
     c/end-exec
     c                   endsl
      *
     c                   endif
      *
     c                   eval      w_spge = w_spge + c_sfil
     c                   eval      w_srrn = w_ssrn
      *
     c                   dou       w_srrn = w_spge
      *
6.32 c     neste_fetch   tag
      *
     c                   if        p_ldor = 0
      *
     c                   select
     c                   when      w_seqe = 'V'
     c/exec sql
     c+ fetch vare
     c+ into  :jvtek1,
     c+       :jvnobb,
     c+       :jvvare,
     c+       :jvogrp,
     c+       :jvhgrp,
     c+       :jvugrp,
6.33 c+       :jvmodn,
     c+       :jvsort,
6.36 c+       :jvlvnr,
6.36 c+       :jvlldo,
6.3m c+       :jvllva,
6.3m c+       :w_erlogv,
6.3m c+       :w_erundv
     c/end-exec
     c                   when      w_seqe = 'N'
     c/exec sql
     c+ fetch nobb
     c+ into  :jvtek1,
     c+       :jvnobb,
     c+       :jvvare,
     c+       :jvogrp,
     c+       :jvhgrp,
     c+       :jvugrp,
6.33 c+       :jvmodn,
     c+       :jvsort,
6.36 c+       :jvlvnr,
6.36 c+       :jvlldo,
6.3m c+       :jvllva,
6.3m c+       :w_erlogv,
6.3m c+       :w_erundv
     c/end-exec
     c                   when      w_seqe = 'L'
     c/exec sql
     c+ fetch lev_vare
6.36 c+ into  :jvlvnr,
6.36 c+       :jvlldo,
     c+       :jvlvar,
     c+       :jvtek1,
     c+       :jvnobb,
     c+       :jvvare,
     c+       :jvogrp,
     c+       :jvhgrp,
     c+       :jvugrp,
6.33 c+       :jvmodn,
6.3m c+       :jvsort,
6.3m c+       :w_erlogv,
6.3m c+       :w_erundv
     c/end-exec
6.3m c                   when      w_seqe = 'S'
6.3m c/exec sql
6.3m c+ fetch fsok
6.3m c+ into  :jvtek1,
6.3m c+       :jvnobb,
6.3m c+       :jvvare,
6.3m c+       :jvogrp,
6.3m c+       :jvhgrp,
6.3m c+       :jvugrp,
6.3m c+       :jvmodn,
6.3m c+       :jvsort,
6.3m c+       :jvlvnr,
6.3m c+       :jvlldo,
6.3m c+       :jvllva,
6.3m c+       :w_erlogv,
6.3m c+       :w_erundv
6.3m c/end-exec
     c                   other
     c/exec sql
     c+ fetch tekst
     c+ into  :jvtek1,
     c+       :jvnobb,
     c+       :jvvare,
     c+       :jvogrp,
     c+       :jvhgrp,
     c+       :jvugrp,
6.33 c+       :jvmodn,
     c+       :jvsort,
6.36 c+       :jvlvnr,
6.36 c+       :jvlldo,
6.3m c+       :jvllva,
6.3m c+       :w_erlogv,
6.3m c+       :w_erundv
     c/end-exec
     c                   endsl
      *
     c                   if        sqlcod = 100 or sqlstt = '02000'
     c                   eval      *in15 = *on
     c                   leave
     c                   endif
      *
     c                   else
     c                   select
     c                   when      w_seqe = 'V'
     c                   read      jvarl6                                 15
     c                   when      w_seqe = 'N'
     c                   read      jvarl7                                 15
     c                   when      w_seqe = 'L'
6.3g c                   read      jvlel2                                 15
     c                   other
     c                   read      jvarl5                                 15
     c                   endsl
     c                   endif
      *
     c                   if        *in15
     c                   leave
     c                   endif
      *
     c                   if        p_ldor <> 0 and
     c                             p_ldor <> jvldor
     c                   eval      *in15 = *on
     c                   leave
     c                   endif
6.3m  **hvis ikke sql søk, så test på logistikkvare her.
6.3m c*                   if        w_seqe = 'V' or
6.3m c*                             w_seqe = 'N' or
6.3m c*                             w_seqe = 'L' or
6.3m c*                             w_seqe = *blank
     c                   eval      vvarl1_vare = jvvare
     c     vvarl1_key    chain     vvarl1
     c                   if        not %found
     c                   iter
     c                   endif
6.3m c*                   eval      w_logi = 0
6.3m c*/exec sql
6.3m c*+ select count(*)
6.3m i*+ into   :w_logi
6.3m c*+ from   jvklpf
6.3m c*+ where  jvquno = :jvvare and
6.3m c*+        jvqfir = :w_firm
6.3m c*/end-exec
6.3m c*                   if        w_logi <> 0
6.3m c*                   iter
6.3m c*                   endif
6.3m c*                   endif
      *
     c                   if        p_ogrp <> 0 and
     c                             p_ogrp <> jvogrp
     c                   iter
     c                   endif
      *
     c                   if        p_hgrp <> 0 and
     c                             p_hgrp <> jvhgrp
     c                   iter
     c                   endif
      *
     c                   if        p_ugrp <> 0 and
     c                             p_ugrp <> jvugrp
     c                   iter
     c                   endif
6.33  *
6.33 c                   if        w_modn <> 0 and
6.33 c                             w_modn <> jvmodn
6.33 c                   iter
6.33 c                   endif
      *
6.12  *
6.12 c                   if        p_osor <> *blank
6.12 c                   if        jvsort =  *blank or
6.12 c                             %subst(jvsort:1:1) > %subst(p_osor:1:1)
6.12 c                   iter
6.12 c                   endif
6.12 c                   endif
      *
6.32  *
6.35  * regel : hvis pris har utgått skal den ikke vises
6.35  * untak : parameter som sier at den skal vises
6.35  * tester også på om riktig pris brukes, ut fra dato
6.32  *
6.32 c                   eval      jvprl1_vare = jvvare
6.32 c                   eval      jvprl1_ldor = jxldor
6.35 c     jvprl1_key    setll     jvprl1
6.35 c     jvprl1_key    reade     jvprl1
6.35 c                   dow       not %eof(jvprl1)
6.3h c                   if        p_pdat >= jxgdat
6.3h c                   if        p_utgp =  0      and
6.32 c                             jxtdat <> *loval and
6.3f c                             jxtdat <= w_udat
6.32 c                   goto      neste_fetch
6.32 c                   endif
6.34 c                   leave
6.35 c                   endif
6.35 c     jvprl1_key    reade     jvprl1
6.35 c                   enddo
      *
6.3a c                   if        p_sams = 1   and
6.3a c                             p_flpr = 0
6.21 c                   eval      vvprl1_vare = jvvare
6.21 c                   eval      vvprl1_ldor = w_enum
6.21 c     vvprl1_key    chain     vvprl1
6.21 c                   if        not %found(vvprl1)
6.21 c                   iter
6.21 c                   endif
6.3a c                   endif
      *
6.25 c                   exsr      utga_lagere
     c                   if        p_utgd = 1 and
6.25 c                             w_utd2 <> *loval and
6.25 c                             w_utd2 <= w_udat
     c                   iter
     c                   endif
      *
      * Spesialbehandling dersom søk via søketekst
      *
6.3m c*                   if        w_seqe = 'S'
6.3m c*/exec sql
6.3m c*+                  declare sok_s cursor for
6.3m c*+                  select jvsvar,
6.3m c*+                         jvstek
6.3m c*+                  from   jvsost
6.3m c*+                  where  jvsvar = :jvvare and
6.3m c*+                         jvstek like :w_ste1 and
6.3m c*+                         jvstek like :w_ste2 and
6.3m c*+                         jvstek like :w_ste3 and
6.3m c*+                         jvstek like :w_ste4 and
6.3m c*+                         jvstek like :w_ste5
6.3m c*+                  for read only
6.3m c*/end-exec
6.3m c*/exec sql
6.3m c*+                  close sok_s
6.3m c*/end-exec
6.3m c*/exec sql
6.3m c*+                  open sok_s
6.3m c*/end-exec
6.3m c*/exec sql
6.3m c*+                  fetch
6.3m c*+                  from  sok_s
6.3m c*+                  into  :jvsvar,
6.3m c*+                        :jvstek
6.3m c*/end-exec
6.3m  **
6.3m c*                   if        sqlcod = 100 or sqlstt = '02000'
6.3m c*                   iter
6.3m c*                   endif
6.3m  **
6.3m c*                   endif
      *
6.38  * Sjekker om det finnes notatark på varen i EVR
6.38  *
6.38 c                   eval      *in50  = *off
6.38 c                   eval      anotl1_syst = 'VVAR'
6.38 c                   eval      anotl1_noid = vvvare
6.38 c     anotl1_key    chain     anotl1
6.38 c                   if        %found
6.38 c                   eval      *in50 = *on
6.38 c                   endif
      *
      *
6.16  * gjør en chain for å fylle alle felter fra jvarl1
6.16 c                   eval      jvarl1_vare = jvvare
6.16 c     jvarl1_key    chain     jvarl1
      *
     c                   eval      b1vare = jvvare
     c                   eval      b1nobb = jvnobb
6.36 c                   movel     jvllva        b1lvar
     c                   eval      b1tek1 = jvtek1
     c                   eval      b1nypo = *blank
     c                   eval      b1pkod = *blank
     c                   eval      b1skod = 0
     c                   eval      b1vtyp = *blank
     c                   eval      b1hkod = 'X'
6.3m c                   eval      b1logv = w_erlogv
6.3m c                   eval      b1udev = w_erundv
      * finn nobb og lvar fra undervare
6.3l c                   eval      w_jvquno = 0
6.3l c                   eval      w_jvllva = *blank
6.3m c                   if        b1udev > 0 or b1logv > 0
6.3m c/exec sql
6.3l c+ select IFNULL(jvquno, 0) , IFNULL(jvllva, '''')
6.3l c+ into   :w_jvquno, :w_jvllva
6.3l c+ from   jvklpf
6.3l c+ inner join jvlepf on jvlvnr = jvqvnr and
6.3l c+  jvlldo = jvqldo
6.3l c+ where  jvqvnr = :jvvare and
6.3l c+        jvqldo = :p_pgiv and
6.3l c+        jvqfir = :w_firm
6.3l c+ fetch first 1 rows only
6.3l c/end-exec
6.3l c                   if        w_jvquno > 0
6.3l c                   eval      jvnobb = w_jvquno
6.3m c                   eval      b1nobb = w_jvquno
6.36 c                   movel     w_jvllva      b1lvar
6.3l c                   movel     w_jvllva      jvlvar
6.3l c                   endif
6.3m c                   endif
      *
6.20 c                   eval      w_lage = l_lage
6.25 c*                  call      'VL720R'
6.25 c*                  parm                    w_firm
6.25 c*                  parm                    jvvare
6.25 c*                  parm                    w_lage
6.25 c*                  parm                    w_utda
6.25 c*                  parm                    b_inlr
6.25 c*                  if        w_utda <> *loval
6.25 c*                  if        w_utda <= w_udat
6.25 c*                  eval      b1tek1 = %subst(jvtek1:1:19) +
6.25 c*                                     ' **UTGÅTT**'
6.25 c*                  else
6.25 c*                  eval      b1tek1 = %subst(jvtek1:1:19) +
6.25 c*                                     ' ** UTGÅR **'
6.25 c*                  endif
6.25 c*                  endif

6.25 c                   exsr      utga_lagere
      * hvis utgått på alle lager:
6.25 c                   if        w_utd2 <> *loval
6.25 c                   if        w_utd2 <= w_udat
6.25 c                   eval      b1tek1 = %subst(jvtek1:1:19) +
6.25 c                                      ' ** UTGÅTT**'
6.25 c                   else
6.25 c                   eval      b1tek1 = %subst(jvtek1:1:19) +
6.25 c                                      ' ** UTGÅR **'
6.25 c                   endif
6.25 c                   endif

     c                   if        jvstat = 4
     c                   eval      b1tek1 = %subst(jvtek1:1:18) +
6.22 c                                      ' **SLETTET*'
     c                   endif
6.14  *
6.22 c                   if        jvudat <> *loval    and
6.22 c                             jvudat <= w_udat
6.14 c                   eval      b1tek1 = %subst(jvtek1:1:18) +
6.22 c                                      ' *NOBB.UTG*'
6.14 c                   endif
      *
     c                   eval      jvdtl1_dvar = jvvare
     c     jvdtl1_key    chain     jvdtl1
     c                   if        %found
     c                   eval      b1pkod = jvdpko
     c                   eval      b1skod = jvdsko
     c                   if        jvdsko = 1
     c                   eval      b1vtyp = 'S'
     c                   endif
     c                   if        jvdhko = 0
     c                   eval      b1hkod = *blank
     c                   endif
     c                   endif
      *
6.33 c                   if        w_ko01 <> *blank
6.33 c                   if        w_ko01 = 'F' and
6.33 c                             jvdhko = 1
6.33 c                   iter
6.33 c                   endif
6.33 c                   if        w_ko01 = 'I' and
6.33 c                             jvdhko = 0
6.33 c                   iter
6.33 c                   endif
6.33 c                   endif
      *
     c                   exsr      hent_pris
      *
     c                   if        w_vsts <> 0 and
6.10 c                             b1osts = *blank
     c                   iter
     c                   endif
      *
     c                   if        w_endr <> 0 and
     c                             %abs(b1endr) < w_endr
     c                   iter
     c                   endif
      *
      * Skriver til subfile
      *
     c                   eval      w_srrn = w_srrn + 1
      *
     c                   if        p_ldor = 0
     c                   select
     c                   when      w_seqe = 'V'
     c                   eval      jvarl6_vare = jvvare
     c                   when      w_seqe = 'N'
     c                   eval      jvarl7_nobb = jvnobb
     c                   when      w_seqe = 'L'
6.3g c                   eval      jvlel2_llva = jvlvar
     c                   other
     c                   eval      jvarl5_tek1 = jvtek1
     c                   endsl
     c                   endif
      *
     c                   select
     c                   when      *in80 = *on
     c                   eval      b1nypo = jvvare
     c                   when      *in81 = *on
     c                   eval      b1nypo = %editc(jvnobb : 'Z')
     c                   when      *in82 = *on
     c                   eval      b1nypo = jvlvar
     c                   endsl
      *
6.3l c                   eval      w_jvqvnr = jvvare
6.3l c                   exsr      finn_logivar                                 farge
      *
     c                   write     b1sfl
      *
     c                   enddo
      *
     c                   if        w_srrn > w_ssrn
     c                   eval      w_sfrn = w_ssrn + 1
     c                   endif
      *
     c                   eval      w_ssrn = w_srrn
     c                   eval      w_virn = w_sfrn
      *
     c                   eval      b_open_sok = *off
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å bla tilbake en side i subfilen
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     bck_subfile   begsr
      *
     c                   if        w_seqe = 'S' or
     c                             p_ldor = 0
     c                   exsr      forny
     c                   leavesr
     c                   endif
      *
     c                   if        *in15
     c                   select
     c                   when      w_seqe = 'V'
     c     jvarl6_key    setgt     jvarl6
     c                   readp     jvarl6
     c                   when      w_seqe = 'N'
     c     jvarl7_key    setgt     jvarl7
     c                   readp     jvarl7
     c                   when      w_seqe = 'L'
6.3g c     jvlel2_key    setgt     jvlel2
6.3g c                   readp     jvlel2
     c                   other
     c     jvarl5_key    setgt     jvarl5
     c                   readp     jvarl5
     c                   endsl
     c                   endif
      *
      * Leser tilbake en side
      *
     c                   eval      w_stel = 0
      *
     c                   dou       w_stel = w_ssrn + c_sfil
      *
     c                   select
     c                   when      w_seqe = 'V'
     c                   readp     jvarl6
     c                   when      w_seqe = 'N'
     c                   readp     jvarl7
     c                   when      w_seqe = 'L'
6.3g c                   readp     jvlel2
     c                   other
     c                   readp     jvarl5
     c                   endsl
      *
     c                   if        %eof
     c                   leave
     c                   endif
      *
     c                   if        jvldor <> p_ldor
     c                   leave
     c                   endif
      *
     c                   if        p_ogrp <> 0 and
     c                             p_ogrp <> jvogrp
     c                   iter
     c                   endif
      *
     c                   if        p_hgrp <> 0 and
     c                             p_hgrp <> jvhgrp
     c                   iter
     c                   endif
      *
     c                   if        p_ugrp <> 0 and
     c                             p_ugrp <> jvugrp
     c                   iter
     c                   endif
6.33  *
6.33 c                   if        w_modn <> 0 and
6.33 c                             w_modn <> jvmodn
6.33 c                   iter
6.33 c                   endif
6.12  *
6.12 c                   if        p_osor <> *blank
6.12 c                   if        jvsort =  *blank or
6.12 c                             %subst(jvsort:1:1) > %subst(p_osor:1:1)
6.12 c                   iter
6.12 c                   endif
6.12 c                   endif
      *
     c                   eval      vvarl1_vare = jvvare
     c     vvarl1_key    chain     vvarl1
     c                   if        not %found
     c                   iter
     c                   endif
      *
6.3a c                   if        p_sams = 1  and
6.3a c                             p_flpr = 0
6.21 c                   eval      vvprl1_vare = jvvare
6.21 c                   eval      vvprl1_ldor = w_enum
6.21 c     vvprl1_key    chain     vvprl1
6.21 c                   if        not %found(vvprl1)
6.21 c                   iter
6.21 c                   endif
6.3a c                   endif
      *
6.20  *   Hent utg.dato fra subprogram
6.25  *   Hent utg.dato fra subprogram
6.25 c*                  call      'VL720R'
6.25 c*                  parm                    w_firm
6.25 c*                  parm                    vvvare
6.25 c*                  parm                    w_lage
6.25 c*                  parm                    w_utda
6.25 c*                  parm                    b_inlr
6.25 c                   exsr      utga_lagere
     c                   if        p_utgd = 1 and
6.25 c                             w_utd2 <> *loval and
6.25 c                             w_utd2 <= w_udat
     c                   iter
     c                   endif
      *
6.33 c                   eval      jvdtl1_dvar = jvvare
6.33 c     jvdtl1_key    chain     jvdtl1
6.33 c                   if        %found and
6.33 c                             w_ko01 <> *blank
6.33 c                   if        w_ko01 = 'F' and
6.33 c                             jvdhko = 1
6.33 c                   iter
6.33 c                   endif
6.33 c                   if        w_ko01 = 'I' and
6.33 c                             jvdhko = 0
6.33 c                   iter
6.33 c                   endif
6.33 c                   endif
      *
      *
     c                   if        w_vsts <> 0 or
     c                             w_endr <> 0
     c                   eval      b1vare = jvvare
     c                   exsr      hent_pris
     c                   if        w_vsts <> 0 and
6.10 c                             b1osts = *blank
     c                   iter
     c                   endif
     c                   if        w_endr <> 0 and
     c                             %abs(b1endr) < w_endr
     c                   iter
     c                   endif
     c                   endif
      *
     c                   eval      w_stel = w_stel + 1
      *
     c                   select
     c                   when      w_seqe = 'V'
     c                   eval      jvarl6_vare = jvvare
     c                   when      w_seqe = 'N'
     c                   eval      jvarl7_nobb = jvnobb
     c                   when      w_seqe = 'L'
6.3g c                   eval      jvlel2_llva = jvlvar
     c                   other
     c                   eval      jvarl5_tek1 = jvtek1
     c                   endsl
      *
     c                   enddo
      *
     c                   if        %eof
     c                   select
     c                   when      w_seqe = 'V'
     c     jvarl6_key    setll     jvarl6
     c                   when      w_seqe = 'N'
     c     jvarl7_key    setll     jvarl7
     c                   when      w_seqe = 'L'
6.3g c     jvlel2_key    setll     jvlel2
     c                   other
     c     jvarl5_key    setll     jvarl5
     c                   endsl
     c                   endif
      *
      * Blanker og fyller opp subfile
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for display av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     dsp_subfile   begsr
      *
     c                   if        w_srrn <> 0
     c                   eval      *in12 = *on
     c                   else
     c                   write     b2cmd
     c                   endif
      *
     c                   eval      *in13 = *on
     c                   exfmt     b2ctl
      *
     c                   eval      *in12 = *off
     c                   eval      *in13 = *off
      *
     c                   eval      w_fcrn = d_fcrn
      *
     c                   endsr
6.16  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.16  * Subrutine for å hente antall frigjorte varer
6.16  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.16  *
6.16 c     hent_frigjort begsr
6.16  *
6.18 c                   eval      w_antf = 0
6.16 c                   eval      b2antf = 0
6.16 c                   if        p_ldor <> 0
6.16  *
6.16 c     jvarl5_key2   setll     jvarl5
6.16 c     jvarl5_key2   reade     jvarl5
6.16 c                   dow       not %eof
6.16 c                   exsr      tell_frigj
6.16 c     jvarl5_key2   reade     jvarl5
6.16 c                   enddo
6.16  *
6.16 c                   else
6.16  *
6.35 c                   eval      jvprl3_ldor = p_pgiv
6.35 c     jvprl3_key    setll     jvprl3
6.35 c     jvprl3_key    reade     jvprl3
6.35 c                   dow       not %eof
6.3h c                   if        p_pdat >= jxgdat
6.16 c                   eval      jvarl1_vare = jxvare
6.35 c     jvarl1_key    chain     jvarl1
6.16 c                   if        %found
6.16 c                   exsr      tell_frigj
6.13 c                   endif
6.35 c                   endif
6.35 c     jvprl3_key    reade     jvprl3
6.16 c                   enddo
6.16  *
6.16 c                   endif
6.16  *
6.16 c                   endsr
6.23  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.23  * Subrutine for å sette frigj.i hold. Egentlig gjøres dette i JV626R
6.23  * men noen ganger henger det igjen.
6.23  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.23  *
6.23 c*    nullst_frigj  begsr
6.23  *
6.23 c*                  if        p_ldor <> 0
6.23  *
6.23 c*    jvarl5_key2   setll     jvarl5
6.23 c*    jvarl5_key2   reade     jvarl5
6.23 c*                  dow       not %eof
6.23 c*                  eval      jvdtlu_dvar = jvvare
6.23 c*    jvdtlu_key    chain     jvdtlur
6.23 c*                  eval      jvdhko = 1
6.23 c*                  if        %found
6.23 c*                  update    jvdtlur
6.23 c*                  endif
6.23 c*    jvarl5_key2   reade     jvarl5
6.23 c*                  enddo
6.23  *
6.23 c*                  else
6.23  *
6.23 c*                  eval      jvprl2_ldor = p_pgiv
6.23 c*    jvprl2_key    setll     jvprl2
6.23 c*    jvprl2_key    reade     jvprl2
6.23 c*                  dow       not %eof
6.23 c*                  eval      jvarl1_vare = jxvare
6.23 c*    jvarl1_key    chain     jvarl1
6.23 c*                  if        %found
6.23 c*                  eval      jvdtlu_dvar = jvvare
6.23 c*    jvdtlu_key    chain     jvdtlur
6.23 c*                  eval      jvdhko = 1
6.23 c*                  if        %found
6.23 c*                  update    jvdtlur
6.23 c*                  endif
6.23 c*                  endif
6.23 c*    jvprl2_key    reade     jvprl2
6.23 c*                  enddo
6.23  *
6.23 c*                  endif
6.23  *
6.23 c*                  endsr
6.16  *
6.16  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.16  * Subrutine for oppdatering av holde-kode
6.16  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.16  *
6.16 c     tell_frigj    begsr
6.16  *
6.16 c                   if        p_ogrp <> 0 and
6.16 c                             p_ogrp <> jvogrp
6.16 c                   leavesr
6.16 c                   endif
6.16  *
6.16 c                   if        p_hgrp <> 0 and
6.16 c                             p_hgrp <> jvhgrp
6.16 c                   leavesr
6.16 c                   endif
6.16  *
6.16 c                   if        p_ugrp <> 0 and
6.16 c                             p_ugrp <> jvugrp
6.16 c                   leavesr
6.16 c                   endif
6.16  *
6.16 c                   if        b_nye_varer = *on
6.16 c                   if        jvstat = 4 or
6.16 c                             jvudat <> *loval and
6.16 c                             jvudat < w_udat
6.16 c                   leavesr
6.16 c                   endif
6.16 c                   endif
6.16  *
6.16 c                   eval      vvarl1_vare = jvvare
6.16 c     vvarl1_key    chain     vvarl1r
6.16 c                   if        b_nye_varer = *on  and %found or
6.16 c                             b_nye_varer = *off and not %found
6.16 c                   leavesr
6.16 c                   endif
6.16  *
6.16 c                   eval      jvdtl1_dvar = jvvare
6.16 c     jvdtl1_key    chain     jvdtl1r
6.18 c                   if        %found(jvdtl1)
6.16  *
6.16 c                   if        jvdhko = 0
6.18 c                   eval      w_antf = w_antf + 1
6.13 c                   endif
6.18 c                   if        w_antf < 10000
6.18 c                   eval      b2antf = w_antf
6.18 c                   else
6.18 c                   eval      b2antf = 9999
6.18 c                   endif
6.18  *
6.18 c                   endif
6.17  *
6.16 c                   endsr
6.39  *
6.39  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.39  * Sjekker om status G oppstår
6.39  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.39  *
6.39 c     sjekk_gtin    begsr
6.39  *
6.39  * finner pakninger til enheter
6.39 c                   eval      jvpkl1_vare = w_vare
6.39 c                   eval      jvpkl1_ldor = w_ldox
6.39 c     jvpkl1_key    setll     jvpkl1
6.39 c     jvpkl1_key    reade     jvpkl1
6.39 c                   dow       not %eof
6.39  *
6.39  * sjekker fra / tildato
6.39 c                   exsr      sjekk_pkdato
6.39 c                   if        b_pakn = *on
6.39  *
6.39 c                   eval      jlevl1_ldor = jwldor
6.39 c     jlevl1_key    chain     jlevl1
6.39 c                   if        %found(jlevl1) and
6.39 c                             jlenum <> 0 and
6.39 c                             jwgtin <> 0
6.39  *
6.39 c                   call      'VE710R  '
6.39 c                   parm                    w_firm
6.39 c                   parm                    jwgtin
6.39 c                   parm                    w_gvar
6.39 c                   parm                    w_genh
6.39 c                   parm                    w_gsta
6.39  *
6.39 c                   if        w_gvar <> *blank and
6.39 c                             w_gvar <> w_vare
6.39 c                   eval      w_gtin = jwgtin
6.39 c                   leavesr
6.39 c                   endif
6.39 c                   endif
6.39  *
6.39 c                   endif
6.39 c     jvpkl1_key    reade     jvpkl1
6.39 c                   enddo
6.39  *
6.39 c                   endsr
6.39  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.39  * Subrutine for å sjekke om dato er innenfor fra /til dato
6.39  * hvis *loval i begge datoer = ok
6.39  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.39  *
6.39 c     sjekk_pkdato  begsr
6.39  *
6.39 c                   eval      b_pakn = *on
6.39  *
6.39 c                   if        jwfdat = *loval and
6.39 c                             jwtdat = *loval
6.39 c                   leavesr
6.39 c                   endif
6.39  *
6.39 c                   if        jwfdat <= w_udat and
6.39 c                             jwtdat >  w_udat
6.39 c                   leavesr
6.39 c                   endif
6.39  *
6.39 c                   if        jwfdat = *loval  and
6.39 c                             jwtdat >  w_udat
6.39 c                   leavesr
6.39 c                   endif
6.39  *
6.39 c                   if        jwfdat <= w_udat and
6.39 c                             jwtdat =  *loval
6.39 c                   leavesr
6.39 c                   endif
6.39  *
6.39 c                   eval      b_pakn = *off
6.39  *
6.39 c                   endsr
6.39  *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for sjekk om vare utgått på alle lager
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     utga_lagere   begsr
      *
6.25 c                   eval      w_utd2 = *loval
      *
6.25 c     ra10l1_key    setll     ra10l1
6.25 c     ra10l1_key    reade     ra10l1
6.25 c                   dow       not %eof(ra10l1)
      *
6.25 c                   call      'VL720R'
6.25 c                   parm                    w_firm
6.25 c                   parm                    vvvare
6.25 c                   parm                    rajkod
6.25 c                   parm                    w_utda
6.25 c                   parm                    b_inlr
      *
6.25 c                   if        w_utda = *loval
6.25 c                   eval      w_utd2 = *loval
6.25 c                   leave
6.25 c                   endif
6.25 c                   if        w_utda <> *loval
6.25 c                   if        w_utda <= w_udat
6.25 c                   if        w_utd2 < w_utda
6.25 c                   eval      w_utd2 = w_utda
6.25 c                   endif
6.25 c                   else
6.25 c                   eval      w_utd2 = w_utda
6.25 c                   endif
6.25 c                   endif
      *
6.25 c     ra10l1_key    reade     ra10l1
6.25 c                   enddo
      *
     c                   endsr
      *
6.3d  *
6.3d  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3d  * Subrutine for sjekke om vare har utgått i jvlepf, hvis utgått
6.3d  * vises nivået.
6.3d  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3d  *
6.3d c     sjekk_jvle    begsr
6.3d  *
6.3d c                   eval      jvlelr_lvnr = b1vare
6.3d c                   eval      jvlelr_lldo = w_ldox
6.3d c     jvlelr_key    chain     jvlelr
6.3d c                   if        %found(jvlelr) and
6.3d c                             jvluda <> *loval and
6.3d c                             jvluda <= w_udat
6.3d c                   call      'JV119R '
6.3d c                   parm                    b1vare
6.3d c                   parm                    w_ldox
6.3d  *
6.3d c                   endif
6.3d  *
6.3d c                   endsr
6.3k  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3k  * Finn info om logistikkvare for riktig prisgiver
6.3k  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3k  *
6.3k c     finn_logivar  begsr
6.3k  *
6.3k c                   eval      *in51 = *off
6.3k c                   eval      *in52 = *off
6.3k c
6.3m c                   if        b1udev > 0
6.3m c                   eval      *in51 = *on
6.3m c                   else
6.3m c                   if        b1logv > 0
6.3m c                   eval      *in52 = *on
6.3m c                   endif
6.3m c                   endif
6.3m c
6.3m c*                   if        %trim(w_jvqvnr) = ''
6.3m c*                   leavesr
6.3m c*                   endif
6.3m c*
6.3m c*                   eval      w_logl = ''
6.3m c*                   eval      w_undv = 0
6.3m c*                   movel     w_jvqvnr      w_jvquno
6.3m c*/exec sql
6.3m c*+                  select jvquno, jvqvnr
6.3m c*+                  into :w_undv, :w_logl
6.3m c*+                  from jvklpf
6.3m c*+                  where (jvquno = :w_jvquno or
6.3m c*+                  jvqvnr = :w_jvqvnr)
6.3m c*+                  and jvqfir = :w_firm
6.3m c*+                  fetch first 1 rows only
6.3m c*/end-exec
6.3m c*                   if        w_logl = w_jvqvnr
6.3m c*                   eval      *in52 = *on
6.3m c*                   elseif    w_undv > 0
6.3m c*                   eval      *in51 = *on
6.3m c*                   endif
6.3k c
6.3k c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_firm
     c                   parm                    p_otyp
6.3h c                   parm                    p_edat
6.3h c                   parm                    p_pdat
     c                   parm                    p_lety
5.70 c                   parm                    p_prgr
     c                   parm                    p_ldor
     c                   parm                    p_ogrp
     c                   parm                    p_hgrp
     c                   parm                    p_ugrp
     c                   parm                    p_pgiv
     c                   parm                    p_sams
     c                   parm                    p_utgd
     c                   parm                    p_inio
     c                   parm                    p_koio
     c                   parm                    p_saio
6.12 c                   parm                    p_osor
6.21 c                   parm                    p_flpr
6.35 c                   parm                    p_utgp
      *
      * Key for posisjonering på varetekst-1
      *
     c     jvarl5_key    klist
     c                   kfld                    w_ldor
     c                   kfld                    jvarl5_tek1
6.16  *
6.16  * Key for posisjonering på leverandør
6.16  *
6.16 c     jvarl5_key2   klist
6.16 c                   kfld                    w_ldor
      *
      * Key for posisjonering på leverandørs varenummer
      *
6.3g c     jvlel2_key    klist
     c                   kfld                    w_ldor
6.3g c                   kfld                    jvlel2_llva
      *
      * Key for posisjonering på NOBB-nummer
      *
     c     jvarl7_key    klist
     c                   kfld                    w_ldor
     c                   kfld                    jvarl7_nobb
      *
      * Key for posisjonering på varenummer
      *
     c     jvarl6_key    klist
     c                   kfld                    w_ldor
     c                   kfld                    jvarl6_vare
      *
      * Key for oppslag EVR-vare
      *
     c     vvarl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl1_vare
6.21  *
6.21  * Key for oppslag EVR-vare-pris
6.21  *
6.21 c     vvprl1_key    klist
6.21 c                   kfld                    w_firm
6.21 c                   kfld                    vvprl1_vare
6.21 c                   kfld                    vvprl1_ldor
      *
      * Key for oppslag mot leverandør
      *
     c     jlevl1_key    klist
     c                   kfld                    jlevl1_ldor
      *
      * Key for oppslag på vare
      *
     c     jvarl1_key    klist
     c                   kfld                    jvarl1_vare
      *
      * Key for oppslag på vare-detalj
      *
     c     jvdtl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jvdtl1_dvar
      *
      * Key for oppdatering av vare-detalj
      *
     c     jvdtlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jvdtlu_dvar
6.16  *
6.16  * Key for les på vare-pris (prisgivere)
6.16  *
6.35 c     jvprl3_key    klist
6.35 c                   kfld                    jvprl3_ldor
6.32  *
6.32  * Key for les på vare-pris (prisgivere)
6.32  *
6.32 c     jvprl1_key    klist
6.32 c                   kfld                    jvprl1_vare
6.32 c                   kfld                    jvprl1_ldor
      *
      * Key for oppdatering av midlertidig pris
      *
     c     jwprlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jwprlu_vare
6.25  *
6.25  *  Key for les av lager
6.25  *
6.25 c     ra10l1_key    klist
6.25 c                   kfld                    ra10l1_firm
6.25  *
      *
6.38  *
6.38  * Key for oppslag på notat
6.38  *
6.38 c     anotl1_key    klist
6.38 c                   kfld                    w_firm
6.38 c                   kfld                    anotl1_syst
6.38 c                   kfld                    anotl1_noid
6.39  *
6.39  * Key for oppslag på vare-pakning
6.39  *
6.39 c     jvpkl1_key    klist
6.39 c                   kfld                    jvpkl1_vare
6.39 c                   kfld                    jvpkl1_ldor
6.39  *
6.39  * Key for les på vare-leverandør
6.39  *
6.39 c     jvlelr_key    klist
6.39 c                   kfld                    jvlelr_lvnr
6.39 c                   kfld                    jvlelr_lldo
      *
      *
      * Initierer tabell-kolonner
      *
     c                   eval      w_firm = p_firm
     c                   eval      w_ldor = p_ldor
6.25  *
6.25 c                   eval                    ra10l1_firm = w_firm
6.24  *
6.24  * hvis bytte av hovedlev., så vil det hentes %vis endring fra h.lev.
6.24  *
6.24 c                   eval      w_hlev = 0
6.24 c                   if        p_sams = 0 and
6.24 c                             p_flpr = 0
6.24 c                   eval      w_hlev = 1
6.24 c                   endif
      *
      * Henter dagens dato
      *
     c                   time                    w_udat
      *
      * Initierer skjermbilde-felt og henter reskontronummer på prisgiver
      *
     c                   eval      b2ldor = p_ldor
     c                   eval      b2ldop = p_pgiv
     c                   eval      b2ogrp = p_ogrp
     c                   eval      b2hgrp = p_hgrp
     c                   eval      b2ugrp = p_ugrp
     c                   eval      b2lety = p_lety
5.70 c                   eval      b2prgr = p_prgr
6.12 c                   eval      b2osor = p_osor
6.3h c                   if        p_pdat = *loval
6.3h c                   time                    p_pdat
6.35 c                   endif
      *
     c                   eval      jlevl1_ldor = p_ldor
     c     jlevl1_key    chain     jlevl1
     c                   if        %found
     c                   eval      b2navn = jlnavn
     c                   eval      w_enum = jlenum
     c                   endif
      *
     c                   eval      jlevl1_ldor = p_pgiv
     c     jlevl1_key    chain     jlevl1
     c                   if        %found
     c                   eval      b2pnav = jlnavn
     c                   eval      w_enum = jlenum
     c                   endif
      *
6.31  * henter gjeldene prisgiver
6.31  *
6.31 c                   if        p_pgiv <> 0
6.31 c                   eval      w_ldox = p_pgiv
6.31 c                   else
6.31 c                   eval      w_ldox = p_ldor
6.31 c                   endif
      *
      * Initierer arbeidsfelt
      *
     c                   eval      b_nye_varer = *off
6.16  *
6.16  * Henter antall frigjorte
6.16  *
6.16 c                   exsr      hent_frigjort
      *
     c                   eval      *in22 = *on
6.3k c*                  eval      *in80 = *on
6.3k c                   eval      *in81 = *on
      *
6.20 c                   eval      w_lage = l_lage
      *
     c                   eval      b_open_sok = *on
      *
      * Posisjonerer i tabell, og fyller subfile
      *
     c                   if        p_ldor <> 0
     c     jvarl5_key    setll     jvarl5
     c                   endif
      *
     c                   exsr      crt_subfile
      *
     c                   endsr
