# RPG Program Overview

This ILE RPG program (`LH500R`) is used to perform inquiries on the historical inventory ledger ("historisk lagerbok") for a warehouse management system. Its main functionality revolves around searching, displaying, and providing detailed information about inventory transactions—such as stock movements, orders, and sales—in a user-friendly subfile-driven interactive display.

## File Declarations

- A variety of physical and logical files are declared (e.g., `vhisl3`, `vhisl1`, `vvarl1`, etc.), representing historical inventory, item master, order headers, etc.
- These files are renamed from their physical format (e.g., `vhispfr:vhisl3r`).
- There is also a workstation file (`lh502d`) that contains subfile and display records for terminal interaction.

## Data Definitions

- **Local Data Area:** Holds user id, firm id, and user names.
- **Reference Fields:** Complex transaction references are broken down into constituent fields (orders, lines, etc.) using data structures and overlays for flexible parsing.
- **Parameters:** Designed to receive firm, item, warehouse, date, and selection number as input parameters from the calling program.
- **Variables:** Many variables for working with keys, subfile paging, error flags, and display fields.
- **Constants:** E.g., the subfile size, edit code for date/time formatting.

## Indicator Usage

- Indicators 10–99 are used for function keys, display states, file operations, and error handling.

## Main Logic Flow

### Initialization (`*INZSR`)

- Receives parameters (firm, item, warehouse, date, selection).
- Sets up keys and reads initial item and warehouse info.
- Positions the inventory history file and fills the subfile with relevant data.
- Checks if the company is a "MalProff" company (special customer variant) and sets a flag.

### Main Display Loop

- Shows the main subfile control display and handles user interaction through function keys:
    - `F3/F12`: Exit program.
    - `F4`: Inquiry on input fields.
    - `F5`: Refresh subfile.
    - `Roll-up`: Page through subfile.
- Handles subfile positioning based on user input (e.g., by warehouse or date).

### Subfile Handling

- Subfile routines handle paging, record read/selection, updating display, and visually indicating the selected record.
- If a user selects a subfile record for details, it calls the `vis_det` subroutine.

### Transaction Details

- The `vis_det` subroutine shows detailed information about the selected transaction, choosing the info to extract and format based on transaction type.
- Several helper routines (`finn_otyp`, `finn_batc`, `finn_ltrans`, `finn_bong`, `finn_best`, `finn_ordre`) parse reference info and fetch related data from other files:
    - **Order types** (`finn_otyp`): Decodes the transaction code.
    - **Batch** (`finn_batc`): Shows information on physical counts.
    - **Stock Movement** (`finn_ltrans`, `hnt_ltrans`): Fetches movement type and translates reasons.
    - **Cash Register (Bong)** (`finn_bong`): Shows info on cash transactions; handles special MalProff variant.
    - **Purchase (Bestilling)** (`finn_best`): Shows supplier order or incoming invoice details.
    - **Sales Order (Ordre)** (`finn_ordre`): Shows sales order or outgoing invoice details.

### Subfile Maintenance

- `clr_subfile` clears the subfile.
- `crt_subfile` refills the subfile with new data based on the current position and filtering.

### Helper Subroutines

- `les_lager`: Calls an external program to retrieve warehouse information.
- `les_vare`: Fetches item information.
- `sp_input`: Handles user-initiated inquiries on specific input fields (such as warehouse).

## Program Modularity

- The code is organized using subroutines (`begsr`/`endsr`) for a clear separation of tasks (display, search, detail fetch, etc.).
- Branching and data selection is determined by transaction type, system code, and reference patterns.
- Many changes are annotated with version numbers and comments, reflecting continuous improvement and bug fixes.

## Subfile Display Model

- Uses a standard subfile pattern for workstn display. Subfiles allow paging through transaction records, positioning, and detail selection.
- Subfile control fields keep track of the page, record range, and currently selected line.

## Special Considerations

- The program is designed to handle extensions and special cases (such as "MalProff" customers with additional info fields).
- Data overlays in data structures enable flexible handling of variable-format reference numbers.
- Norwegian field names and comments dominate, so variable names closely follow their business meaning (e.g., "lager" = warehouse, "bestilling" = order).

---

## Summary Table: Key Concepts

| Area            | Description                                                           |
|-----------------|-----------------------------------------------------------------------|
| **Files**       | Inventory history, items, orders, batches, etc., plus display files   |
| **Subfiles**    | Used for paging, selection, and display                               |
| **Indicators**  | Control display, file, and error states                               |
| **Detail Fetch**| Performed via transaction type analysis and file access               |
| **Modularity**  | Subroutines for all major operations                                 |
| **Parameters**  | Program called with firm, item, warehouse, date, selection info       |
| **Localization**| Norwegian variable names and comments                                 |

---

## Onboarding Hints

- **Subfile Programming:** Understand how subfiles work for paging and display in RPG.
- **Business Logic:** Get familiar with Norwegian inventory/accounting terms for easier navigation of variables and comments.
- **Extensibility:** Historical modifications appear in comments; the program is continually adapted for new transaction types and formats.
- **External Calls:** Some info (e.g., warehouse) is fetched using external RPG programs (e.g., `RA510R`, `FØ720R`).

---

**In essence**, this program is a robust and heavily-maintained RPG interactive inquiry for inventory history, supporting many transaction types and user options, and using best-practice subfile techniques for navigation and display.