# Explanation of RPG Source Code: RC600R

This RPG (Report Program Generator) source code is an ILE RPG program for IBM i, designed to handle printouts of "saker" (cases/issues) based on user-selected parameters.

---

## 1. **Program Metadata and Documentation**

- **Header:** 
  - Specifies system name (`ASOKON`), program name (`RC600R`), and a description: "Utskrift av saker - parameter" (Printout of cases - parameters).
  - Provides a reference table for modifications, indicators' use, and standard indicator assignments.
  - Documents specific function key assignments (`F1`, `F3`), and indicator use (e.g., LR for end-of-program).

---

## 2. **File Definitions**

```rpg
fausrl1    if   e           k disk
frc600d    cf   e             workstn
```
- `ausrl1` is an input file (likely keyed).
- `rc600d` is a display file (workstation).

---

## 3. **Data Definitions**

```rpg
d                uds
d w_type                300    300
d w_edat                          d   datfmt(*iso)
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980
d s               s              1  0
d w_firm          s              3  0
d w_in03          s              1
```

- `uds`: User Data Structure (Local Data Area).
- `w_type`, `w_edat`: Work fields for report type and date.
- `l_user`, `l_firm`, `l_fnav`: Fields mapped to LDA (possibly session/user info).
- `s`, `w_firm`, `w_in03`: Variable fields; `w_in03` may act as a flag or status.

---

## 4. **Program Logic**

### a. **Main Tag: `dummy`**

Acts as a starting point (could be for readability as not referenced directly).

---

### b. **Screen Handling**

```rpg
c     a2taga        tag
c                   exfmt     a2bld
c                   eval      *in31 = *off
c                   eval      *in32 = *off
```
- `exfmt a2bld`: Displays and receives input from the screen format `a2bld`.
- Turns off message indicators *in31 and *in32.

---

### c. **Handle Exit (F3)**

```rpg
c                   if        *inkc = *on
c                   eval      w_in03 = '1'
c                   goto      xslutt
c                   endif
```
- If F3 (indicator KC) is pressed, sets `w_in03` to `'1'` and jumps to program end (`xslutt`).

---

### d. **Validate "Older Than Date" Field**

```rpg
c     *dmy          test(d)                 a2edat                 31
c                   if        *in31 = *on
c                   goto      a2taga
c                   endif
c     *dmy          move      a2edat        w_edat
```
- Tests if the entered date field `a2edat` is valid (DMY format).
- If invalid, `*in31` is set, and user is returned to the input screen.
- On valid entry, moves `a2edat` to work field `w_edat`.

---

### e. **Validate Report Type**

```rpg
c                   if        a2type <> 'J'
c                             and a2type <> 'N'
c                   move      *on           *in32
c                   goto      a2taga
c                   endif
c                   move      a2type        w_type
```
- Checks if the report type (`a2type`) is 'J' or 'N'. If not, sets error indicator `*in32` and returns for correction.
- If valid, moves it to work field `w_type`.

---

### f. **Call Report Program**

```rpg
c                   call      'RC600C'
c                   parm                    w_in03
c                   parm                    w_type
c                   parm                    w_edat
```
- Calls the external program `RC600C` with parameters: termination flag, report type, and date.

---

### g. **Program End**

```rpg
c     xslutt        tag
c                   eval      *inlr = *on
c                   return
```
- Sets Last Record Indicator (`*INLR`) on, which ends the RPG program and closes files.

---

### h. **Initialization Subroutine (`*INZSR`)**

```rpg
c     *inzsr        begsr
c                   move      l_firm        w_firm
c                   move      'J'           a2type
c                   eval      w_in03 = ' '
c                   endsr
```
- Runs automatically at program start.
- Moves company number from LDA to work field, sets default type to 'J', and clears `w_in03`.

---

## 5. **Screen Fields and Indicators**

- **Screen Format**: `a2bld` is used for parameter selection for the printout.
- **Indicators**:
    - `*INKA` (F1) - Choose company
    - `*INKC` (F3) - Exit
    - `*IN31` - Date field error
    - `*IN32` - Type field error

---

## 6. **Summary**

This is a classic ILE RPG program for IBM i, responsible for:
- Prompting the user for report parameters.
- Validating the inputs.
- Calling another program to perform the actual report generation.
- Handling termination and errors appropriately via indicators.

Through its structure and comments, the code is well-suited for maintenance and onboarding, especially for those familiar with RPG IV and IBM i conventions.