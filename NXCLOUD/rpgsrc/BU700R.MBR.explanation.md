```markdown
# RPG Program: BU700R – Store Export Utility

This is a classic ILE RPG program for IBM i (AS/400) used in a retail or store (butikk) environment, primarily for exporting various master data entities (items, customers, prices, etc.). The language is in Norwegian, but the coding style and comments are easy to follow. Here’s an explanation to help you get onboarded quickly.

---

## 1. **Header and Options**

```rpg
     h option(*nodebugio) datedit(*dmy)
```

- `option(*nodebugio)`: Disables debug input/output. That means input/output operations won’t be debugged in this program.
- `datedit(*dmy)`: Sets default date format to day-month-year.

---

## 2. **Maintenance Log & Documentation Block**

The large commented block at the top describes:
- **System/Program name**: `ASSHOP` / `BU700R`
- **Purpose**: Export from store ("Butikk, eksport")
- **Change log**: For example, "*160304 HKO Nytt program*" means the program was new on March 4, 2016, by user HKO.
- **Version/Change notes**: e.g., "*Utvidet med kasse for kall til å hente lager*" – Expanded with cash register for fetching inventory.

---

## 3. **Parameter Definitions**

```rpg
     d p_firm          s              3  0
     d p_dato          s               d   datfmt(*iso)
     d p_time          s               t   timfmt(*iso)
5.70 d p_kass          s              3
```

- `p_firm`: Store/company identifier (numeric, 3 digits).
- `p_dato`: Date parameter (date type, ISO format).
- `p_time`: Time parameter (time type, ISO format).
- `p_kass`: Cash register code (char, 3 bytes) – **added in version 5.70.**

---

## 4. **Local Variables**

```rpg
     d w_firm          s              3  0
```

- `w_firm`: Working variable for the firm/company id.

---

## 5. **Main Logic (Mainline)**

The main program calls a number of other RPG programs, each responsible for exporting a certain type of entity. For each call, it passes (at minimum) the firm id (`w_firm`), and sometimes additional info like date and time.

### Example:

```rpg
     c                   call      'BU710R'
     c                   parm                    w_firm
```

This calls program `BU710R` ("Leveringstype" – delivery type), passing it the current firm.

**Sequence of Called Programs:**
- **BU710R**: Delivery types
- **BU711R**: Item types
- **BU712R**: Price codes
- **BU715R**: Companies
- **BU716R**: Departments
- **BU717R**: Inventory (Lager)
- **BU718R**: Sellers (Sales staff)
- **BU720R**: Item groups
- **BU721R**: Module free-texts
- **BU725R**: Item information (also passes date, time, and cash register)
- **BU726R**: Item lists
- **BU728R**: Offer prices (passes date and time)
- **BU729R**: Deleted items (passes date and time)
- **BU730R**: Customer info (passes date and time)
- **BU731R**: Customer notes

All these programs are modular, facilitating separation of functionality and easier maintenance.

---

## 6. **Program End**

```rpg
     c     avslutt       tag
     c                   eval      *inlr = *on
     c                   return
```

- `avslutt tag`: A label for jumping to program end (not used directly in the shown code).
- `*inlr = *on`: Sets the last record indicator to true, ensuring clean program termination and releasing files/resources.
- `return`: Exits the program.

---

## 7. **Initialization Subroutine (`*inzsr`)**

This subroutine runs before the main logic starts, typically for setup/initialization.

```rpg
     c     *inzsr        begsr
     c     *entry        plist
     c                   parm                    p_firm
     c                   parm                    p_dato
     c                   parm                    p_time
5.70 c                   parm                    p_kass
     c                   eval      w_firm = p_firm
     c                   endsr
```

- `*entry plist ...` defines the parameters expected on program entry: `p_firm`, `p_dato`, `p_time`, (`p_kass` if version 5.70 or higher).
- The values are received into the program’s parameter variables.
- `w_firm = p_firm`: Sets up the working firm variable for use in the rest of the program.

---

## 8. **Summary of Flow**

1. **Initialization**: Receives key parameters (firm, date, time, cash register) at program start.
2. **Main Execution**: Sequentially calls a series of export subprograms, always passing at least the firm code, sometimes additional parameters as required.
3. **Termination**: Cleanly ends the program.

---

## 9. **Usage Context**

- **Batch/Interface Export**: This design is typical for master data exports/integrations; easy to add/remove called subprograms.
- **Maintainability**: Adding new export types only requires adding new CALL statements; logic stays simple and modular.
- **Customization Ready**: The original authors left clear documentation and versioning so that enhancements are easy to track.

---

## 10. **Key Takeaways for New Developers**

- **Parameter-driven**: Inputs are provided at job start; the same firm id is used for all export modules in the session.
- **Modularized**: Each master data type/export is in its own program, making this main program a coordinator.
- **Extensible**: Adding more entities or customizations is straightforward.

If you need to add a new export module, simply define a new CALL with the relevant parameters, following the established pattern.

```
c                   call      'MYNEWPROG'
c                   parm                    w_firm
c                   parm                    <other_required_params>
```

**End of explanation.**
```