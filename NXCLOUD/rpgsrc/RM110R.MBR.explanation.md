## Explanation of RPG Program RM110R

This program, written in ILE RPG, is used for customer information maintenance ("vedlikehold av kundeinformasjon") in an application called "Almenning". Its main purpose is to allow users to view, search, edit, and otherwise manage customer records using subfiles, and it uses both native record-level access and embedded SQL.

Below is a high-level explanation of the main components and their purpose, followed by more detailed comments on program structure, file usage, variables, and key logic.

---

### Program Overview

- **Functionality**: Maintenance of customer records with facilities for searching, paging, editing, and displaying related information.
- **Interface**: Uses DSPF (display files) with subfiles for record lists and detail windows for edit/view.
- **Navigation**: Supports function keys for rolling pages, search, positioning, etc.
- **Data**: Uses multiple files (customer master, address, auxiliary info, etc.) and SQL for searching.

---

### File Definitions (`F-Specs`)

- Five variants of the customer master file (`rkunpfr`) for various key accesses.
    - `rkunlr`, `rkunl1`, `rkunl2`, `rkunl3`, `rkunlu`: each with different record formats or keys.
- Other files:  
    - `frksopf`  - Secondary or search file  
    - `fapospf`  - Postal info  
    - `frmkul1`/`frmkulu` - Customer auxiliary info (e.g., limits)
- Display file: `frm110d` using subfile record format `b1sfl`.

---

### Work Variables

- **Subfile-related**:  
    - `w_stel`, `w_spge`, `w_srrn`, `w_sfrn`, `w_ssrn`, etc.: For tracking subfile record numbers, pagination.
- **Keys/Fields for file ops**:  
    - E.g., `rkunlr_kund`, `rkunlu_kund`, etc.: Used to chain/setll/setgt files.
- **Search fields**:  
    - `w_ste1`-`w_ste5`: Processed search text split into up to 5 components.
- **Program flags**:  
    - `b_oppr`, `b_forn`, `b_feil`, `b_open_sok`: Various program statuses.
- **Constants**:  
    - E.g., `c_sfil = 11`: Subfile page size.

---

### Main Program Flow

1. **Initialization (`*inzsr`)**  
    - Loads parameters, initializes dates, assigns values from LDA, positions files, fills subfile.

2. **Main Display Loop**
    - Driven by tags (`b2taga`, `b2tagb`, etc.) and user function keys.
    - Reads user input, calls subroutines based on key pressed (page up/down, search, edit, etc.).

3. **Handling Function Keys**
    - `F3`/`F12`: Exit
    - `F10`/`F11`: Page Up/Down in subfile.
    - `F21`: Home key.
    - `F5`: Toggle passive/active customers.
    - `F9`: Repeat search.
    - Search and positioning logic (by customer number, alpha field, postal code).

---

### Subroutines

#### 1. **forny**  
   _Refreshes the subfile based on the current record and key type_; repositions file; clears and recreates subfile display.

#### 2. **søk**  
   _Handles search against input text_:  
   - Calls AS700R to parse search string.  
   - Clears and refills subfile with search results.

#### 3. **posisjoner**  
   _Positions the subfile to a specific record based on customer number, alpha field, or postal code._

#### 4. **subfile**  
   _Reads user selections from the subfile and acts on them:_  
   - Edit (`valg=2`): Calls detail edit, updates record.  
   - View (`valg=5`): Calls detail display.  
   - Manage properties (`valg=7`): Calls property maintenance.

#### 5. **xc2bld / xc3bld**  
   _Handles display/edit window for a selected customer record_; pulls & writes values from/to master and auxiliary files.

#### 6. **clr_subfile / crt_subfile**  
   - **clr_subfile**: Clears the entire subfile and resets counters.  
   - **crt_subfile**: Fills the subfile window. Uses SQL if a search is active, otherwise reads from keyed file, skipping passive customers if needed.

#### 7. **bck_subfile**
   _Loads previous page of subfile records for paging up._

#### 8. **dsp_subfile**
   _Handles display and format of subfile control/command screens._

#### 9. **beh_eiendom**
   _Calls external program to display/manage properties for a customer._

---

### File Access and Key Lists

Different variants of the customer file are accessed with different keys to support flexible retrieval (by customer number, alpha sort, postal code, etc.). Key lists are defined at the bottom for each access path.

---

### Embedded SQL

Used for performing dynamic customer searches based on parsed search strings, providing a more powerful search than keyed access.

---

### Indicator Usage

Common RPG indicators (`*inxx`, e.g., *in10, *in11, etc.) are used for user input, subfile display flags, and error/status signaling. Comments at the top define their meanings.

---

## Conclusion

- **User interaction**: Done via subfiles on the display file, with search, paging, edit, and select capabilities.
- **Data management**: Performed on several levels: search (SQL), keyed read, and update.
- **Structure**: Uses classic RPG subroutine flows with tags and subroutines for logic branching.

### Onboarding Tips

- **Familiarity with subfiles** and RPG indicators is important to understand screen update logic.
- **Key lists** (`klist/kfld`) define how records are positioned and read from files.
- **External calls** (e.g., `AS700R`, `RM120R`, `RK502R`) may be central to business rules or auxiliary data.
- **Indicator management** is crucial for UI flow (paging, showing messages, toggling display elements).
- **Search logic**: Embedded SQL opens up more flexible querying—understand the search variable flow.

---

### Reference: Common Subfile Logic

- **Display subfile**: Fill, display, process user input, and potentially update.
- **Paging**: Handled by tracking beginning/ending record numbers and indicator toggling.
- **Selective update**: Only updates records that user has changed or selected.
- **Passive/active customers**: Toggleable filtering.
- **Search**: Split and process multi-word search phrases.

---

In summary, this is a typical mid-complexity "maintenance" RPG program that uses subfiles for flexible customer management, mixing native and SQL-based data access, and employs classic RPG subroutine and indicator-driven flow.