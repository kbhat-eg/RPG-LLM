# RK976R - Program Documentation

## Overview

**Program Name:** RK976R  
**System:** ASOKON  
**Description:**  
This program is responsible for updating the "purredato" (dunning or reminder date) parameter within the ASOKON system. It is a workstation (interactive) program that presents a screen to the user, validates input, and sets parameter values for further processing or calling programs.

**Original Author:** KOB  
**Created:** December 2002

---

## Business/Domain Logic

- **Purpose:**  
  The program allows a user to enter or update a specific date parameter (likely related to dunning/reminder processing) for a given firm. It validates the date input and sets parameters for use by the calling process or subsequent batch logic.

- **Screen Interaction:**  
  Utilizes a display file (`RK976D`) with at least one format (`A2BLD`), which is used to collect the parameter(s) from the user.

- **Parameter Passing:**  
  The program receives and returns at least one parameter (`p_in03`), which is used to indicate exit status or other process control information.

---

## Structure and Flow

### 1. Initialization (`*INZSR`)

- **Purpose:**  
  Sets initial values for local variables and receives parameter(s) from the calling program.
- **Parameter List:**  
  - `p_in03` (1 char): Used as a return code or flag to the caller.
- **Actions:**  
  - Clears `p_in03`.
  - Receives `p_in03` via parameter list.

---

### 2. Main Logic

#### a. Display and Input

- **Display File:**  
  - `RK976D` (WORKSTN device): Presents screen(s) to the user.
- **Screen Format:**  
  - `A2BLD`: Used for entering/selecting parameters.

#### b. Exit Handling

- **Indicator `KC` (`*INKC`):**  
  - Mapped to F3 (Exit) key.
  - If F3 is pressed:
    - Sets `p_in03` to '1' (signals exit to caller).
    - Jumps to program end (`XSLUTT`).

#### c. Field Validation

- **Date Validation:**  
  - Uses RPG's `TEST(D)` operation to check if the entered date (`A2PDAT`) is valid in DMY format.
  - If invalid, sets indicator 31 and returns to input screen.

#### d. Parameter Assignment

- **Firm and Date:**  
  - Assigns the entered firm number (`L_FIRM`) to the parameter `RPFIRM`.
  - Moves and converts the entered date (`A2PDAT`) to ISO format in `RPPDAT`.

---

### 3. Program Termination (`XSLUTT`)

- **Sets LR Indicator:**  
  - `*INLR = *ON`: Signals program end and resource release.
- **Returns to Caller:**  
  - Ends the program gracefully.

---

## Data Definitions

- **Work Fields:**  
  - `RPFIRM` (3,0): Firm number parameter.
  - `RPPDAT` (Date, *ISO): Date parameter (purredato).
- **Screen Fields:**  
  - `L_USER`, `L_FIRM`, `L_FNAV`: User, firm number, and firm name from the display file.
- **Parameter:**  
  - `P_IN03` (1 char): Used for exit signaling.
- **Indicators:**  
  - `KC` (F3): Exit.
  - `LR`: Last record/program end.
  - `31`: Invalid date input.

---

## Indicators and Conventions

- **Indicator Usage (as per header comments):**
  - `KC` (F3): Exit.
  - `LR`: End of program.
  - `30`: Protect fields on display.
  - `31-59`: Error/warning messages and screen indicators.
  - `60-69`: File indicators.
  - `70-79`: Work indicators in subroutines.
  - `80-89`: General work indicators.
  - `90-99`: Standard subroutine indicators.

---

## Notable Design Decisions

- **Goto Usage:**  
  The program uses `GOTO` for flow control (e.g., exit and validation failure). While not modern best practice, it is a common idiom in legacy RPG code for simple interactive programs.
- **Indicator-based Error Handling:**  
  Uses numbered indicators (e.g., `*IN31`) for signaling validation errors and controlling flow.
- **Screen-Driven Workflow:**  
  The main logic is driven by screen interaction, with all user input and validation routed through the display file formats.

---

## Relationships with Other Modules

- **Display File (`RK976D`):**  
  All user interaction is through this display file. The `A2BLD` format is used for parameter entry.
- **Parameter Passing:**  
  The program is intended to be called by another program or process, passing and returning parameters via the parameter list.

---

## Summary

RK976R is a straightforward interactive RPG program for updating a date parameter (likely for dunning/reminder processes) for a firm. It validates user input, handles exit conditions, and passes parameters back to the caller. The code follows established conventions for indicator usage, error handling, and screen-based workflow within the ASOKON system.