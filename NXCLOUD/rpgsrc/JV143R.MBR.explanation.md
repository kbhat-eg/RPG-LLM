# RPG Program JV143R Explanation

This RPG (Report Program Generator) program is for IBM i (AS/400) systems, written in the older "fixed format" style, with some enhancements in version 6.30 and 7.00 as noted by comments in the source code.

The program title and comments indicate that it is used for a transfer to EVR (probably another system or subsystem), and includes a filter, likely for records or data.

Below is an explanation of each section of the code to help a developer become familiar with its logic and structure.

---

## Header Section

```rpg
h option(*nodebugio) datedit(*dmy)
```
- Compiler options:
    - `*nodebugio`: Turns off debug I/O information.
    - `datedit(*dmy)`: Date format is day/month/year.

The surrounding comments record program meta-information (name, description, changes, etc.).

---

## File Definition

```rpg
fjv143d    cf   e             workstn
```
- Declares a Display File (likely DDS-based), used for screen input/output, with the name `JV143D`.
- `cf` means "Control Format", `e` means externally described, `workstn` is the device type (workstation).
- All user interaction is through this display file.

---

## Data Definitions

### Parameters

These represent input/output values, possibly for CL calling programs or passed in at startup.

```rpg
d p_vsts          s              1  0
d p_endr          s              4  2
6.30 d p_modn     s              8  0
6.30 d p_ko01     s              8
6.30 d p_firm     s              3  0
```
- `p_vsts`: Status value (1 digit, no decimals).
- `p_endr`: Amount, or some value (4 digits, 2 decimals).
- `p_modn`: Module number/id (8 digits, no decimals).
- `p_ko01`: Code or key (8 alphanumeric).
- `p_firm`: Firm (company code, 3 digits, no decimals).

### Work Variables

```rpg
6.30 d w_firm      s              3  0
d w_mte1           s             30
d b_feil           s              1    inz(*off)
```
- `w_firm`: Working copy for `firm`.
- `w_mte1`: Likely a descriptive text field (30 chars).
- `b_feil`: Error flag (1 char), initialized to 'off'.

---

## Main Program Logic

### Opening Screen Handling

```rpg
c     b1tag         tag

c                   exfmt     b1bld
```
- **Label `b1tag`**: Used for looping back after certain events.
- `exfmt b1bld` displays format `b1bld` from the display file and waits for user input.

#### Function Key Handling

```rpg
c                   if        *inkc or *inkl
c                   goto      avslutt
c                   endif
6.30 c               if        *inkd
6.30 c               exsr      spørring
6.30 c               goto      b1tag
6.30 c               endif
```
- Checks IBM i function key indicators:
    - **F3 (often *INKC) or F12 (*INKL)**: Exit, jump to `avslutt` (end program).
    - **F6 (*INKD)**: Trigger subroutine `spørring` (search/inquiry), then loop back to display.

#### Returning Values from the Screen

```rpg
c                   eval      p_vsts = b1vsts
c                   eval      p_endr = b1endr
6.30 c               eval      p_modn = b1modn
6.30 c               eval      p_ko01 = b1ko01
```
- Passes entered/displayed values from the screen (fields in format `b1bld`) back into the parameter variables for possible return to calling programs.

---

### Program Exit Routine

```rpg
c     avslutt       tag

c                   eval      *inlr = *on
c                   return
```
- **Label `avslutt`**: Marks exit point.
- Sets *INLR (last record indicator) on to close the program cleanly.
- Returns to caller.

---

## Subroutines

### `spørring`: Inquiry Subroutine (`begsr`/`endsr` delimited)

```rpg
6.30 c     spørring      begsr

6.30 c                   if        w_afld = 'B1MODN'
6.30 c                   call      'JU500R'
6.30 c                   parm                    w_firm
6.30 c                   parm                    b1modn
6.30 c                   parm                    b1mtxt
6.30 c                   leavesr
6.30 c                   endif

6.30 c                   endsr
```
- Handles F6 key (search/inquiry).
    - Checks if the active field (`w_afld`) is `'B1MODN'`.
    - If so, calls program `'JU500R'`, passing:
        - `w_firm`: firm code.
        - `b1modn`: module code from screen.
        - `b1mtxt`: module text/description.
    - Exits subroutine after call.

---

### Initialization Subroutine `*inzsr`

```rpg
c     *inzsr        begsr

c     *entry        plist
c                   parm                    p_firm
c                   parm                    p_vsts
c                   parm                    p_endr
6.30 c               parm                    p_modn
6.30 c               parm                    p_ko01
```
- On program startup:
    - Receives parameters from the calling program via parameter list.

```rpg
c                   eval      b1vsts = p_vsts
c                   eval      b1endr = p_endr
6.30 c               eval      b1modn = p_modn
6.30 c               eval      b1ko01 = p_ko01

6.30 c               eval      w_firm = p_firm

c                   endsr
```
- Initializes display file fields with parameter values.
- Assigns `p_firm` to local working variable `w_firm`.

---

## Summary of Operation

1. **Initialization**: Receives parameters, initializes screen variables.
2. **User Interface**: Presents a screen (DDS `b1bld`) to the user for data input/update.
3. **Function Keys**:
    - **F3/F12**: Exit.
    - **F6**: Opens inquiry/search (e.g., module lookup via `JU500R`).
4. **Returns Values**: After user interaction, program updates parameters with screen values.
5. **Exit**: Cleans up and ends.

### Version Notes

- Code with `6.30` and `7.00` comments indicate enhancements for additional filtering and GUI adaptations.
- The routine is modular and easily extended for new fields or logic.

---

## Key RPG Concepts Used

- **Display File I/O**: Using `exfmt` for screen I/O.
- **Indicators**: For function key recognition.
- **Parameter Passing**: Both on entry (from caller) and exit (to return values).
- **Subroutines**: Modular code structure, e.g., `spørring` for search/inquiry logic.
- **Program Calls**: Ability to call other programs (e.g., for lookups).

---

## For New Developers

- Review the DDS for display file `JV143D` to understand what fields are on the main screen.
- Understand IBM i indicator use for function key management.
- The inquiry subroutine (F6) enables lookups via external program calls.
- Most values entered/changed by the user are passed back to the calling program or workflow via output parameters.

This template is typical for IBM i interactive programs, especially in administrative or entry systems, and demonstrates well the RPG fixed-format style.