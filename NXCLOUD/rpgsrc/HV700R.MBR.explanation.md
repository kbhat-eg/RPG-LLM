# HV700R – Generating Handheld Terminal Files for Vareinfo

This program (HV700R) presents a display interface for selecting parameters used to generate files for handheld terminals. It allows users to specify which Varesortiment (product assortment), optional Lager (warehouse), and up to five Kundekategori (customer categories) filters are used. Based on these inputs, the program calls other modules (HV701C, HV702C, or HV703C) to generate output files for the chosen handheld terminal type.

---

## Overview of Flow

1. **Initialization and Prompting**  
   - The program reads the local data area to retrieve the current Firma (company code) into `w_firm`.  
   - It initializes the screen fields (for example, setting the default date `b1dato` with the current date).

2. **Main Interactive Screens**  
   - The first screen (b1bld) collects basic selection criteria:  
     - Varesortiment (`b1vsor`)  
     - Lager (`b1lage`)  
     - Date (`b1dato`)  
     - Up to five Kundekategori codes (`b1kat1` … `b1kat5`)  
   - The user can press function keys for further actions (spørring/lookups, sortiment maintenance, or exit).  
   - After validating input, the program moves on to a second screen (b2bld) to choose which handheld terminal type is targeted (`b2valg`).

3. **Generating Files**  
   - Depending on `b2valg`, the program calls one of three external programs (HV701C, HV702C, HV703C) to produce the respective output files. Parameters such as `w_firm`, `b1vsor`, date, category inputs, and a timestamp-based member name (`w_memb`) are passed along.

4. **Lookups and Data Validation**  
   - The **spørring** subroutine handles external lookups:  
     - Calls “VC500R” for varesortiment descriptions.  
     - Calls “RA510R” for lager descriptions.  
     - Calls “RA511R” for individual kundekategori descriptions.  
   - The **sjekk_input** subroutine runs all validation checks:  
     - Confirms the user has entered a valid varesortiment (`b1vsor`).  
     - Chains to the VARESORTIMENT master file (vshel1) to ensure the chosen varesortiment + warehouse exists.  
     - Validates the date field (using *dmy and handling blank/zero dates).  
     - Calls “RS710R” to validate the warehouse (`b1lage`) if specified.  
     - Converts and verifies each kundekategori. Calls “RS711R” for each category to ensure it is valid.

5. **Helper Subroutines**  
   - **kat_alf**: Ensures each kundekategori is zero-padded to four characters (e.g., “1” becomes “0001”). This is required for consistent lookups in the RA511R/RS711R modules.  
   - **sortiment**: Calls “VC100R” for maintenance tasks related to varesortiment.  
   - **Init ( *inzsr )**: Prepares keys for CHAIN operations, sets up the firm code, and initializes display fields.

---

## Notable Design/Implementation Details

- **Modular Structure**:  
  The program is a workflow controller. Actual updates, lookups, and file generation happen in external modules (e.g., HV70xC, RA51xR, RS71xR, VC500R, VC100R), keeping this program focused on user interaction and parameter handling.

- **Multi-Key CHAIN**:  
  The varesortiment file (vshel1) is accessed with a key list (vshel1_key) including Firma (`w_firm`), Varesortiment (`vshel1_vsor`), and Lager (`vshel1_lage`). This ensures correct retrieval of the master record.

- **Timestamp-Based Member Naming**:  
  A unique member name is created (`w_memb`) by concatenating “H” with the time portion from `w_tmst_20`.

- **Domain-Specific Subroutines**:  
  The program includes specialized calls for validating lager (warehouses), varesortiment (product assortments), and kundekategori. These are typical in systems that handle product information across multiple inventory and category classifications.

---

## Interaction with Other Modules

1. **HV701C, HV702C, HV703C**  
   - Generate the respective handheld terminal files. The program sets up parameters such as company, assortment, date, category filters, and a custom member name before calling them.

2. **VC500R** and **RA510R**  
   - Provide lookups for varesortiment and lager descriptions, respectively, when the user triggers spørring (inquiry) for those fields on-screen.

3. **RA511R**  
   - Retrieves the description for a numeric kundekategori. The program calls RA511R multiple times (one for each category code) if the user queries it.

4. **RS711R** / **RS710R**  
   - Validates kundekategori codes (RS711R) and lager (RS710R). Each returns a status code so HV700R knows if the input is accepted.

5. **VC100R**  
   - Invoked via “sortiment” subroutine to allow immediate maintenance of the varesortiment data, keeping the user within a single workflow.

---

## Key Takeaways

- **Primary Purpose**: Prompt the user for product assortment, warehouse, date, and category codes, then hand off these inputs to dedicated generation programs.  
- **Validation & Lookups**: Ensures each input is valid through synchronized calls to other modules.  
- **Flexible Category Handling**: From zero-padding categories to optional “ALLE” placeholders, the program allows broad or specific filtering of customer categories.  
- **Reusable Patterns**: The code extensively uses calls to external programs (a common pattern in this codebase) where each external program handles specialized tasks, keeping the main interactive program simpler and more focused on user interaction.