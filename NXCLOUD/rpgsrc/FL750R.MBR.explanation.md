# Overview of the RPG Program "FL750R" - Updating Search Texts

This source code represents a well-structured RPG program used within an IBM i environment. Its primary purpose is to update search texts associated with customer projects, likely for improved searchability and data management.

---

## Header Comments & Metadata
- **Program Description:** Indicates this is a customer project update program focusing on search texts.
- **Version History & Changes:** Tracks updates such as extending seller number length, adding external project numbers, and tracking information.

---

## Data Structures and File References

### File Definitions (`rename` statements):
- These define external files used during program execution:
  - `fkprpfr`, `rkunpfr`, `apospfr`, `fkpspfr` are the files, renamed locally with suffixes (`l1r`, `l1r`, etc.).
  - The rename commands map external file fields to local variables for ease of reference.

### Data Structures:
- **Parameters (`p_firm`, `p_kund`, `p_kpro`):** Passed into the program, likely containing company, customer, and project identifiers.
- **Local Variables (`fkprl1_kund`, `fkprl1_kpro`, etc.):** Used for holding key fields during lookups and processing.
- **Search Text Variables (`w_stek`):** Used to build the updated search text string.
- **Constants (`Lo`, `Up`):** Define lowercase and uppercase alphabet characters for translation operations.

---

## Main Program Logic

### Initialization
- Transfer input parameters (`p_kund`, `p_kpro`) into local lookup variables (`fkprl1_kund`, `fkprl1_kpro`).
- Perform a `CHAIN` (lookup) on `fkprl1` file:
  - If found, call the subroutine `oppdater` to update the search text.
- End the program with `*INLR = *ON` to release resources and return.

---

## Subroutine `oppdater` â€“ Updating Search Text
- This subroutine constructs the search text (`w_stek`) step-by-step, concatenating various customer details:

  1. **Customer Name:**
     - Uses `xlate` to uppercase (`Lo:Up`) customer name.
     - Initializes `w_stek` with customer name.

  2. **Address Lines:**
     - Checks if address lines (`fladr1`, `fladr2`) are not blank.
     - Converts them to uppercase and appends to `w_stek`.

  3. **Postal Code & City:**
     - Checks if postal number (`flponr`) is non-zero.
     - Converts numbers to strings, appends postal code and city name (`apsted`) after translation to uppercase.
     - Chains to external postal code table (`apospf`) via `chain` on `apponr`.
  
  4. **Contact Person:**
     - If available (`flkprs`), uppercase and append.

  5. **Seller Number:**
     - If specified (`flselg`), convert to string, append.

  6. **Customer & Project Numbers:**
     - Convert `flkund` and `flkpro` to character strings, append.

  7. **External Project Name:**
     - If filled (`flepro`), append.

- The constructed search text is stored into the `fkpslu_skun` field for the record.

### Updating or Creating Search Record:
- Performs `CHAIN` on the search text key (`fkpslu_key`).
- If the record exists (`%found`):
  - Time-stamps and updates the record with current user info (`flseda`, `flseti`, `flsoda`, `flsoti`, `flsous`, `flseus`).
- If not found:
  - Creates a new record with all relevant details and timestamps.

---

## Initialization Subroutine `*inzsr`
- Loads the company data (`w_firm`) from parameters.
- Sets up key fields for lookups in related registers:
  - Customer project register (`fkprl1`)
  - Customer register (`rkunl1`)
  - Postal code register (`apospf`)
  - Search text register (`fkpslur`)

---

## Summary
This RPG program reads customer and project identifiers, constructs a comprehensive search text based on various customer details, and updates or creates a record in the search text database. It uses standard IBM i file handling techniques (`CHAIN`, `UPDATE`, `WRITE`) and string manipulation (`xlate`, concatenation) to perform its function efficiently.

---

**Note:** The code employs best practices such as translating text to uppercase for uniform searchability, timestamp tracking, and structured subroutines for clarity and reusability.