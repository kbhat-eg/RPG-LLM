# RPG Program RM720R - Validity Control for Property

This program is an ILE RPG (RPG IV, or RPGLE) source code written for the IBM i platform. It is designed to check the validity of a real estate property (eiendom), most likely based on key values, and return status and description information.

Let's break down the main sections of the code:

---

## Header Specifications

```rpg
h datedit(*dmy) option(*nodebugio)
```

- `h` (header) specifies compile-time options.
- `datedit(*dmy)` sets date format to Day-Month-Year.
- `option(*nodebugio)` disables debug support for I/O operations for performance.

---

## Comments Block

The large comment section documents:
- The system and program name (`ASOKON`, `RM720R`).
- Purpose of the program: "Kontroll av gyldig eiendom" ("Check of valid property").
- Change history, indicators usage, and return code conventions.

Specific indicators:
- `60-61` are used as file indicators for `chain` (file I/O result tracking).
- Return code: If `p_stat` = `'N'`, the record is **not found** ("post finnes ikke").

---

## File Definition

```rpg
frmeil1    if   e           k disk    rename(rmeipfr:rmeil1r)
```

- Logical file `rmeil1` is defined for input (`i`), full procedural file (`f`), external description (`e`), keyed access (`k`), and disk resident.
- The record format is renamed from `rmeipfr` to `rmeil1r`.

---

## Standalone Fields (D-Specs)

```rpg
d w_firm          s                   like(rmefir)
d p_stat          s              1
d p_ealm          s                   like(rmealm)
d p_egnr          s                   like(rmegnr)
d p_ebnr          s                   like(rmebnr)
d p_enav          s                   like(rmenav)

d rmeil1_ealm     s                   like(rmealm)
d rmeil1_egnr     s                   like(rmegnr)
d rmeil1_ebnr     s                   like(rmebnr)
```

- `w_firm`: Work variable for firm number, based on the type of `rmefir`.
- `p_stat`, `p_ealm`, `p_egnr`, `p_ebnr`, `p_enav`: Program parameters (status, property identifiers, name).
- `rmeil1_ealm`, `rmeil1_egnr`, `rmeil1_ebnr`: Variables for composing the key to the file.

```rpg
d                uds
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980
```

- Positions in the user space (with `uds` - user defined structure) for user, firm, and some name.

---

## Main Logic

```rpg
c                   eval      rmeil1_ealm = p_ealm
c                   eval      rmeil1_egnr = p_egnr
c                   eval      rmeil1_ebnr = p_ebnr
c     rmeil1_key    chain     rmeil1r                            60
```

- The program sets up the key fields (`ealm`, `egnr`, `ebnr`) from input parameters.
- Performs a keyed `chain` operation (search) to file `rmeil1r` with the key; if not found, indicator 60 is set ON.

### Handling the Result

```rpg
c                   if        *in60 = *on
c                   eval      p_stat = 'N'
c                   eval      p_enav = 'Eiendommen er ikke gyldig'
c                   else
c                   eval      p_stat = *blank
c                   eval      p_enav = rmenav
c                   endif
```

- If the key is **not found** (`*in60 = *on`):
  - Sets status (`p_stat`) to `'N'` ("not found").
  - Sets description (`p_enav`) to "The property is not valid".
- If found:
  - Sets status blank (valid).
  - Returns the property name from the record.

---

## Program End

```rpg
c     slutt         tag
c                   eval      *inlr = *on
c                   return
```

- Tags end of processing.
- Sets last record indicator (`*INLR`) to `*ON` to close files and signal program end.
- Returns to caller.

---

## Initialization Subroutine

```rpg
c     *inzsr        begsr
c                   eval      w_firm = l_firm
```

- The initialization subroutine (`*inzsr`) runs at program start.
- Sets the work firm number from the user space area.

### Parameter List Definition

```rpg
c     *entry        plist
c                   parm                    p_stat
c                   parm                    p_ealm
c                   parm                    p_egnr
c                   parm                    p_ebnr
c                   parm                    p_enav
```

- Declares incoming parameters for the program (for use as a subprocedure or service program).

### Key List for File Access

```rpg
c     rmeil1_key    klist
c                   kfld                    w_firm
c                   kfld                    rmeil1_ealm
c                   kfld                    rmeil1_egnr
c                   kfld                    rmeil1_ebnr
```

- Defines composite key sequence for file access:
  - Firm number
  - Property fields

---

## Summary Flow

1. Initializes from parameters and user space.
2. Builds key for the desired property.
3. Tries to find the property in file `rmeil1`.
4. If found, returns property info; otherwise, sets status and description to indicate non-existence.

---

## Onboarding Notes

- All variables like `rmefir`, `rmealm`, etc., are based on externally described filesâ€”review the file definitions for more context.
- The program is likely called from another program, passing parameters (pass-by-reference).
- Indicator 60 tracks the file search result.
- The program is written in fixed-format RPG IV; modern RPG can refactor this to free-form for improved readability.

---

## Key Concepts Used

- **CHAIN**: Keyed fetch from a file.
- **Indicators**: Traditional RPG way of handling file status and logic branching.
- **Parameter Passing**: Using parameter lists for modular code.
- **User Space Areas**: For session/user-specific data.

---

## Typical Use

This program is a validity filter or validator for real estate records, typically used in a batch or interactive process to check if a property exists, and to retrieve its name if it does. If not, it signals this to the caller via parameters.