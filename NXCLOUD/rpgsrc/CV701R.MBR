     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . :
      * Program . . . . : CV701R
      * Beskrivelse . . : Readiness vare, eksport til fil
      *
      *                   All verdier presenteres i lagerenhet
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       040209 HKO  Nytt program
      *       090310 HKO  Lagt inn test på avdeling
      *                   Tilpasset program til versjon 5.70
      *       240510 HKO  Lagt inn salg pr. uke for bruk i RELEX
      *       300510 HKO  Lagt inn hyllemin, hyllemaks, sesong og
      *                   omr.faktor mellom innkjøpsenhet og lagerenhet.
      *                   Sesong hentes fra frie koder, hyllemin fra
      *                   best.punkt og hyllemaks fra best.mengde.
      *       010710 HKO  Lagt inn Relex sperredato (dato for når
      *                   Relex kan ta over oppdateringen av min/maks)
      *       060211 HKO  Leser kun inn statistikk for leveringstype 0
      *       240611 HKO  Henter salg 13-15 måneder og første salgsdato
      *                   Fjernet innlesing av hyllemin/hyllemaks
      *                   Henter ledetid fra leverandør/lager dersom
      *                   ledetid ikke er oppgitt
      *       190312 HKO  Tilpasset til 6.20
      *       100412 HKO  Lagt inn test på prisgruppe
      *       100812 HKO  Leser statistikk på lager og ikke på avdeling
      *                   Henter salg på ordredato og ikke på bilagsdato
      *                   Teller antall salg kun dersom antall solgt > 0
      *                   Dersom vi ikke mottar avdling som paramter så
      *                   benyttes hovedlager som lager
      *       200812 HKO  Henter også salg fra pakksedler <= 1 mnd gamle
      *       291112 HKO  Henter prioritert leverandør fra lagerregister
      *                   Dersom ledetid ikke finnes på leverandør/lager
      *                   hentes ledetid fra leverandør uavhengig av lager
      *       250213 HKO  Endret slik at første salgsdato hentes fra første
      *                   salg som lagervare
6.21  *       151113 bof  tester om utregning cvtotk ikke > 999999999,99
      *       160115 HKO  Fjernet cvtotk og cvomlh.
      *                   Lagt inn siste telledato, flagg for overstyrt
      *                   bestillingsleverandør og informasjon om
      *                   erstatningsvare.
6.30  *       180515 BKV  Endret LVAR pga økt fra 15 til 20 tegn
      *       181016 HKO  Utvidet med første og siste varemottaksdato,
      *                   lagerført dato og med hyllemin og hyllemaks
      *                   Lagt inn logikk avhengig av lagerstyring
      *                   Henter prisgruppe også fra avdeling 0
      *       260617 HKO  Lagt inn omregning også av salg 3 mnd fram
      *       030917 HKO  Endret logikk for henting av varemottaksdatoer
6.31  * 6.30  161018 bof  Utvidet med trelast sortiment
6.32  * 6.32  280219 hko  Henter eldste utgår-dato fra vare eller fra lager
6.32  * 6.32  120319 hko  Benytter leverandør fra lager istedenfor på vare
      *                   dersom overstyrt hovedleverandør på lager
8.01  *PRG2   080622 bof  Utvidet prisgruppe fra 1 til 2 posisjoner
8.02  *       130924 bof  Behandler spesialtegn for cvlvar
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fra10lx    if   e           k disk    rename(ra10pfr:ra10lxr)
     ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
     fvpgrl1    if   e           k disk    rename(vpgrpfr:vpgrl1r)
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fvvenl1    if   e           k disk    rename(vvenpfr:vvenl1r)
     fvvenl4    if   e           k disk    rename(vvenpfr:vvenl4r)
     fvvprl1    if   e           k disk    rename(vvprpfr:vvprl1r)
     fvlagl1    if   e           k disk    rename(vlagpfr:vlagl1r)
     fvhisl4    if   e           k disk    rename(vhispfr:vhisl4r)
     fvverl4    if   e           k disk    rename(vverpfr:vverl4r)
     frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
     flodtlv    if   e           k disk    rename(lodtpfr:lodtlvr)
     flohel1    if   e           k disk    rename(lohepfr:lohel1r)
     fmltil1    if   e           k disk    rename(mltipfr:mltil1r)
     fsstalx    if   e           k disk    rename(sstapfr:sstalxr)
     ffodtlx    if   e           k disk    rename(fodtpfr:fodtlxr)
     ffohel1    if   e           k disk    rename(fohepfr:fohel1r)
     fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
     fsistlx    if   e           k disk    rename(sistpfr:sistlxr)
      *
     fcvarpf    uf a e           k disk    rename(cvarpfr:cvarpfr)
      *
      * Definering av parametre
      *
     d p_list          s              8
      *
      * Datastruktur for parameterliste -inn
      *
     d                 ds
     d d_list                         8
     d  d_firm                        3  0 overlay(d_list:1)
     d  d_avde                        4  0 overlay(d_list:4)
      *
      * Definering av variable i nøkkel
      *
     d ra10lx_javd     s                   like(rajavd)
     d vpgrl1_glag     s                   like(vpglag)
     d vpgrl1_gavd     s                   like(vpgavd)
     d vvenl1_enhe     s                   like(veenhe)
     d vvenl4_inen     s                   like(veinen)
     d vvprl1_ldor     s                   like(vpldor)
     d vvprl1_prgr     s                   like(vpprgr)
     d vvprl1_enhe     s                   like(vpenhe)
     d vvprl1_lety     s                   like(vplety)
     d vhisl4_kode     s                   like(vhkode)
     d vverl4_envr     s                   like(vvenvr)
     d rlevl1_levr     s                   like(rllevr)
     d lodtlv_numm     s                   like(ldnumm)
     d lodtlv_suff     s                   like(ldsuff)
     d lohel1_numm     s                   like(lonumm)
     d lohel1_suff     s                   like(losuff)
     d mltil1_ogrp     s                   like(mcogrp)
     d mltil1_hgrp     s                   like(mchgrp)
     d mltil1_ugrp     s                   like(mcugrp)
     d mltil1_ldor     s                   like(mcldor)
     d mltil1_vare     s                   like(mcvare)
     d mltil1_lage     s                   like(mclage)
     d mltil1_crdo     s                   like(mccrdo)
     d sstalx_orda     s                   like(sforda)
     d fodtlx_edat     s                   like(fdedat)
     d fohel1_numm     s                   like(fonumm)
     d fohel1_suff     s                   like(fosuff)
     d votyl1_otyp     s                   like(vaotyp)
     d sistlx_orda     s                   like(siorda)
      *
      * Definering av variable
      *
     d w_firm          s                   like(vvfirm)
     d w_avde          s                   like(sfsavd)
     d w_lage          s                   like(vllage)
     d w_prgr          s                   like(vpgprg)
     d w_vare          s                   like(vvvare)
     d w_da15          s                   like(sforda)
     d w_da12          s                   like(sforda)
     d w_da06          s                   like(sforda)
     d w_da03          s                   like(sforda)
     d w_da01          s                   like(sforda)
     d w_du01          s                   like(sforda)
     d w_du02          s                   like(sforda)
     d w_du03          s                   like(sforda)
     d w_du04          s                   like(sforda)
     d w_du05          s                   like(sforda)
     d w_du06          s                   like(sforda)
     d w_du07          s                   like(sforda)
     d w_du08          s                   like(sforda)
     d w_du09          s                   like(sforda)
     d w_du10          s                   like(sforda)
     d w_du11          s                   like(sforda)
     d w_du12          s                   like(sforda)
     d w_du13          s                   like(sforda)
     d w_du14          s                   like(sforda)
     d w_du15          s                   like(sforda)
     d w_du16          s                   like(sforda)
     d w_du17          s                   like(sforda)
     d w_du18          s                   like(sforda)
     d w_du19          s                   like(sforda)
     d w_du20          s                   like(sforda)
     d w_du21          s                   like(sforda)
     d w_du22          s                   like(sforda)
     d w_du23          s                   like(sforda)
     d w_du24          s                   like(sforda)
     d w_du25          s                   like(sforda)
     d w_du26          s                   like(sforda)
     d w_du27          s                   like(sforda)
     d w_du28          s                   like(sforda)
     d w_du29          s                   like(sforda)
     d w_du30          s                   like(sforda)
     d w_du31          s                   like(sforda)
     d w_du32          s                   like(sforda)
     d w_du33          s                   like(sforda)
     d w_du34          s                   like(sforda)
     d w_du35          s                   like(sforda)
     d w_du36          s                   like(sforda)
     d w_du37          s                   like(sforda)
     d w_du38          s                   like(sforda)
     d w_du39          s                   like(sforda)
     d w_du40          s                   like(sforda)
     d w_du41          s                   like(sforda)
     d w_du42          s                   like(sforda)
     d w_du43          s                   like(sforda)
     d w_du44          s                   like(sforda)
     d w_du45          s                   like(sforda)
     d w_du46          s                   like(sforda)
     d w_du47          s                   like(sforda)
     d w_du48          s                   like(sforda)
     d w_du49          s                   like(sforda)
     d w_du50          s                   like(sforda)
     d w_du51          s                   like(sforda)
     d w_du52          s                   like(sforda)
     d w_omro          s                   like(veomre)
     d w_omrl          s                   like(veomre)
     d w_omrs          s                   like(veomre)
      *
     d w_udat          s               d   datfmt(*iso)
     d w_mvap          s              6  2
     d w_mvat          s              5  4
     d w_mvaf          s             10  9
5.50 d w_mv2f          s             10  9
5.50 d w_mv2p          s              6  2
5.50 d w_mv2t          s              5  4
     d w_kode          s              1  0
6.31 d w_lv_nobb       s                   like(vvnobb)
6.31 d w_lv_nlev       s                   like(vvnlev)
6.31 d w_lv_lvar       s                   like(vvlvar)
      *
6.3q C/Exec SQL
6.3q C+  Set Option DatFmt=*ISO
6.3q C/End-Exec
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Henter dato for 15 mnd, 12 mnd, 6 mnd, 3 mnd og 1 mnd
      *
     c                   eval      w_da15 = %date
     c     w_da15        subdur    15:*months    w_da15
      *
     c                   eval      w_da12 = %date
     c     w_da12        subdur    1:*years      w_da12
      *
     c                   eval      w_da06 = %date
     c     w_da06        subdur    6:*months     w_da06
      *
     c                   eval      w_da03 = %date
     c     w_da03        subdur    3:*months     w_da03
      *
     c                   eval      w_da01 = %date
     c     w_da01        subdur    1:*months     w_da01
      *
      * Henter start-dato for alle uker i 52 uker
      *
     c                   eval      w_du01 = %date
     c     w_du01        subdur    7:*days       w_du01
      *
     c     w_du01        subdur    7:*days       w_du02
     c     w_du01        subdur    14:*days      w_du03
     c     w_du01        subdur    21:*days      w_du04
     c     w_du01        subdur    28:*days      w_du05
     c     w_du01        subdur    35:*days      w_du06
     c     w_du01        subdur    42:*days      w_du07
     c     w_du01        subdur    49:*days      w_du08
     c     w_du01        subdur    56:*days      w_du09
     c     w_du01        subdur    63:*days      w_du10
     c     w_du01        subdur    70:*days      w_du11
     c     w_du01        subdur    77:*days      w_du12
     c     w_du01        subdur    84:*days      w_du13
     c     w_du01        subdur    91:*days      w_du14
     c     w_du01        subdur    98:*days      w_du15
     c     w_du01        subdur    105:*days     w_du16
     c     w_du01        subdur    112:*days     w_du17
     c     w_du01        subdur    119:*days     w_du18
     c     w_du01        subdur    126:*days     w_du19
     c     w_du01        subdur    133:*days     w_du20
     c     w_du01        subdur    140:*days     w_du21
     c     w_du01        subdur    147:*days     w_du22
     c     w_du01        subdur    154:*days     w_du23
     c     w_du01        subdur    161:*days     w_du24
     c     w_du01        subdur    168:*days     w_du25
     c     w_du01        subdur    175:*days     w_du26
     c     w_du01        subdur    182:*days     w_du27
     c     w_du01        subdur    189:*days     w_du28
     c     w_du01        subdur    196:*days     w_du29
     c     w_du01        subdur    203:*days     w_du30
     c     w_du01        subdur    210:*days     w_du31
     c     w_du01        subdur    217:*days     w_du32
     c     w_du01        subdur    224:*days     w_du33
     c     w_du01        subdur    231:*days     w_du34
     c     w_du01        subdur    238:*days     w_du35
     c     w_du01        subdur    245:*days     w_du36
     c     w_du01        subdur    252:*days     w_du37
     c     w_du01        subdur    259:*days     w_du38
     c     w_du01        subdur    266:*days     w_du39
     c     w_du01        subdur    273:*days     w_du40
     c     w_du01        subdur    280:*days     w_du41
     c     w_du01        subdur    287:*days     w_du42
     c     w_du01        subdur    294:*days     w_du43
     c     w_du01        subdur    301:*days     w_du44
     c     w_du01        subdur    308:*days     w_du45
     c     w_du01        subdur    315:*days     w_du46
     c     w_du01        subdur    322:*days     w_du47
     c     w_du01        subdur    329:*days     w_du48
     c     w_du01        subdur    336:*days     w_du49
     c     w_du01        subdur    343:*days     w_du50
     c     w_du01        subdur    350:*days     w_du51
     c     w_du01        subdur    357:*days     w_du52
      *
      * Behandler alle lagervarer
      *
     c     vvarl1_key    setll     vvarl1
     c     vvarl1_key    reade     vvarl1
     c                   dow       not %eof
     c                   exsr      behandling
     c     vvarl1_key    reade     vvarl1
     c                   enddo
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandling
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandling    begsr
      *
     c                   eval      w_vare = vvvare
      *
      * Behandler kun lagervarer
      *
     c                   if        vvvtyp = 'D' or
     c                             vvvtyp = 'T'
     c                   leavesr
     c                   endif
      *
     c                   if        faalag = 1
     c     vlagl1_key    chain     vlagl1
     c                   if        not %found
     c                   leavesr
     c                   endif
     c                   else
     c                   eval      vlvtyp = vvvtyp
     c                   endif
      *
     c                   if        vlvtyp <> 'L'
     c                   leavesr
     c                   endif
      *
      * Initierer informasjon
      *
     c                   clear                   cvarpfr
      *
      * Henter generell informasjon
      *
     c                   eval      cvfirm = w_firm
     c                   eval      cvlage = w_lage
      *
      * Vareinformasjon
      *
     c                   eval      cvvare = w_vare
     c                   eval      cvnobb = vvnobb
     c                   eval      cvtek1 = vvtek1
     c                   eval      cvvtyp = vlvtyp
     c                   eval      cvldor = vvldor
     c                   eval      cvnlev = vvnlev
6.30 c*                  eval      cvlvar = vvlvar
6.30 c                   movel     vvlvar        cvlvar
     c                   eval      cvkble = 0
     c                   eval      cvogrp = vvogrp
     c                   eval      cvhgrp = vvhgrp
     c                   eval      cvugrp = vvugrp
     c                   eval      cvkses = vvkfri
     c                   eval      cvlenh = vvenhl
     c                   eval      cvodat = vvodat
     c                   eval      cvudat = vvudat
      *
      * Henter leverandør fra lager
      *
6.32 c                   if        vlbldo <> 0 and
6.32 c                             vlbldo <> cvldor
6.32 c                   eval      cvldor = vlbldo
6.32 c                   eval      cvkble = 1
6.32 c                   endif
      *
      * Henter utgår-dato fra lager dersom dato ikke finnes på vare,
      * eller dersom utgår-dato på lager er eldre enn dato på vare.
      *
     c                   if        vludat <> *loval
     c                   if        cvudat =  *loval or
     c                             cvudat <> *loval and
     c                             vludat <  cvudat
     c                   eval      cvudat = vludat
     c                   endif
     c                   endif
      *
      * Henter innkjøpsenhet
      *
     c                   eval      vvenl4_inen = 1
     c     vvenl4_key    chain     vvenl4
     c                   if        %found
      *
     c                   eval      cvienh = veenhe
      *
     c                   if        cvienh <> cvlenh
     c                   eval      vvenl1_enhe = cvlenh
     c     vvenl1_key    chain     vvenl1
     c                   if        %found
     c                   eval      w_omrl = veomre
     c                   eval      vvenl1_enhe = cvienh
     c     vvenl1_key    chain     vvenl1
     c                   if        %found
     c                   eval(h)   cvofak = veomre/w_omrl
     c                   endif
     c                   endif
     c                   endif
      *
     c                   endif
      *
      * Henter priser
      *
6.32 c                   eval      vvprl1_ldor = cvldor
6.32 c                   eval      vvprl1_prgr = w_prgr
6.32 c                   eval      vvprl1_enhe = vvenhl
6.32 c                   eval      vvprl1_lety = 0
6.32 c     vvprl1_key    chain     vvprl1
6.32 c                   if        not %found
6.32 c                   eval      vvprl1_prgr = *blank
6.32 c     vvprl1_key    chain     vvprl1
6.32 c                   if        not %found and
6.32 c                             vvldor <> cvldor
6.32 c                   eval      vvprl1_ldor = vvldor
6.32 c                   eval      vvprl1_prgr = w_prgr
6.32 c     vvprl1_key    chain     vvprl1
6.32 c                   if        not %found
6.32 c                   eval      vvprl1_prgr = *blank
6.32 c     vvprl1_key    chain     vvprl1
6.32 c                   endif
6.32 c                   endif
6.32 c                   endif
      *
     c                   if        %found
     c                   eval      cvinpr = vpinpr
     c                   eval      cvkopr = vpkopr
     c                   eval      cvsapr = vpsapr
     c                   endif
      *
      * Kalkulerer salgpris inkl.mva
      *
     c                   if        cvsapr <> 0
      *
6.32 c                   eval      cvldor = vpldor
      *
     c                   select
     c                   when      vvkmva = 0
     c                   eval      cvsaim = cvsapr * w_mvat
     c                   when      vvkmva = 2
     c                   eval      cvsaim = cvsapr * w_mv2t
     c                   endsl
      *
     c                   eval      w_kode = 4
     c                   call      'FA909R'
     c                   parm                    w_firm
     c                   parm                    w_vare
     c                   parm                    w_kode
     c                   parm                    cvsaim
      *
     c                   endif
      *
      * Henter første salgsdato (fra varen som lagervare)
      *
     c     sstalx_key2   chain     sstalx
     c                   if        %found
      *
     c                   if        sfvtyp <> 'S'
     c                   eval      cvfdat = sforda
     c                   else
      *
     c                   eval      sstalx_orda = *loval
     c     sstalx_key    setll     sstalx
     c     sstalx_key2   reade     sstalx
     c                   dow       not %eof
     c                   if        sfvtyp <> 'S'
     c                   eval      cvfdat = sforda
     c                   leave
     c                   endif
     c     sstalx_key2   reade     sstalx
     c                   enddo
      *
     c                   endif
      *
     c                   endif
      *
      * Henter statistikkinformasjon
      *
     c                   eval      sstalx_orda = w_da15
     c     sstalx_key    setll     sstalx
     c     sstalx_key2   reade     sstalx
     c                   dow       not %eof
      *
     c                   if        sflety <> 1
      *
     c                   if        sforda >= w_da12
     c                   eval      cvom12 = cvom12 +
     c                                      (sfsumb-sfrab1-sfrab2-sfrabo)
     c                   if        sfanta > 0
     c                   eval      cvas12 = cvas12 + 1
     c                   endif
     c                   eval      cvan12 = cvan12 + sfanta
     c                   endif
     c                   if        sforda >= w_da06
     c                   eval      cvan06 = cvan06 + sfanta
     c                   endif
     c                   if        sforda >= w_da03
     c                   eval      cvan03 = cvan03 + sfanta
     c                   endif
     c                   if        sforda >= w_da15 and
     c                             sforda < w_da12
     c                   eval      cvaf03 = cvaf03 + sfanta
     c                   endif
     c                   if        sforda >= w_da01
     c                   eval      cvan01 = cvan01 + sfanta
     c                   endif
      *
     c                   select
     c                   when      sforda >= w_du52 and
     c                             sforda < w_du51
     c                   eval      cvau52 = cvau52 + sfanta
     c                   when      sforda >= w_du51 and
     c                             sforda < w_du50
     c                   eval      cvau51 = cvau51 + sfanta
     c                   when      sforda >= w_du50 and
     c                             sforda < w_du49
     c                   eval      cvau50 = cvau50 + sfanta
     c                   when      sforda >= w_du49 and
     c                             sforda < w_du48
     c                   eval      cvau49 = cvau49 + sfanta
     c                   when      sforda >= w_du48 and
     c                             sforda < w_du47
     c                   eval      cvau48 = cvau48 + sfanta
     c                   when      sforda >= w_du47 and
     c                             sforda < w_du46
     c                   eval      cvau47 = cvau47 + sfanta
     c                   when      sforda >= w_du46 and
     c                             sforda < w_du45
     c                   eval      cvau46 = cvau46 + sfanta
     c                   when      sforda >= w_du45 and
     c                             sforda < w_du44
     c                   eval      cvau45 = cvau45 + sfanta
     c                   when      sforda >= w_du44 and
     c                             sforda < w_du43
     c                   eval      cvau44 = cvau44 + sfanta
     c                   when      sforda >= w_du44 and
     c                             sforda < w_du43
     c                   eval      cvau44 = cvau44 + sfanta
     c                   when      sforda >= w_du43 and
     c                             sforda < w_du42
     c                   eval      cvau43 = cvau43 + sfanta
     c                   when      sforda >= w_du42 and
     c                             sforda < w_du41
     c                   eval      cvau42 = cvau42 + sfanta
     c                   when      sforda >= w_du41 and
     c                             sforda < w_du40
     c                   eval      cvau41 = cvau41 + sfanta
     c                   when      sforda >= w_du40 and
     c                             sforda < w_du39
     c                   eval      cvau40 = cvau40 + sfanta
     c                   when      sforda >= w_du39 and
     c                             sforda < w_du38
     c                   eval      cvau39 = cvau39 + sfanta
     c                   when      sforda >= w_du38 and
     c                             sforda < w_du37
     c                   eval      cvau38 = cvau38 + sfanta
     c                   when      sforda >= w_du37 and
     c                             sforda < w_du36
     c                   eval      cvau37 = cvau37 + sfanta
     c                   when      sforda >= w_du36 and
     c                             sforda < w_du35
     c                   eval      cvau36 = cvau36 + sfanta
     c                   when      sforda >= w_du35 and
     c                             sforda < w_du34
     c                   eval      cvau35 = cvau35 + sfanta
     c                   when      sforda >= w_du34 and
     c                             sforda < w_du33
     c                   eval      cvau34 = cvau34 + sfanta
     c                   when      sforda >= w_du33 and
     c                             sforda < w_du32
     c                   eval      cvau33 = cvau33 + sfanta
     c                   when      sforda >= w_du32 and
     c                             sforda < w_du31
     c                   eval      cvau32 = cvau32 + sfanta
     c                   when      sforda >= w_du31 and
     c                             sforda < w_du30
     c                   eval      cvau31 = cvau31 + sfanta
     c                   when      sforda >= w_du30 and
     c                             sforda < w_du29
     c                   eval      cvau30 = cvau30 + sfanta
     c                   when      sforda >= w_du29 and
     c                             sforda < w_du28
     c                   eval      cvau29 = cvau29 + sfanta
     c                   when      sforda >= w_du28 and
     c                             sforda < w_du27
     c                   eval      cvau28 = cvau28 + sfanta
     c                   when      sforda >= w_du27 and
     c                             sforda < w_du26
     c                   eval      cvau27 = cvau27 + sfanta
     c                   when      sforda >= w_du26 and
     c                             sforda < w_du25
     c                   eval      cvau26 = cvau26 + sfanta
     c                   when      sforda >= w_du25 and
     c                             sforda < w_du24
     c                   eval      cvau25 = cvau25 + sfanta
     c                   when      sforda >= w_du24 and
     c                             sforda < w_du23
     c                   eval      cvau24 = cvau24 + sfanta
     c                   when      sforda >= w_du23 and
     c                             sforda < w_du22
     c                   eval      cvau23 = cvau23 + sfanta
     c                   when      sforda >= w_du22 and
     c                             sforda < w_du21
     c                   eval      cvau22 = cvau22 + sfanta
     c                   when      sforda >= w_du21 and
     c                             sforda < w_du20
     c                   eval      cvau21 = cvau21 + sfanta
     c                   when      sforda >= w_du20 and
     c                             sforda < w_du19
     c                   eval      cvau20 = cvau20 + sfanta
     c                   when      sforda >= w_du19 and
     c                             sforda < w_du18
     c                   eval      cvau19 = cvau19 + sfanta
     c                   when      sforda >= w_du18 and
     c                             sforda < w_du17
     c                   eval      cvau18 = cvau18 + sfanta
     c                   when      sforda >= w_du17 and
     c                             sforda < w_du16
     c                   eval      cvau17 = cvau17 + sfanta
     c                   when      sforda >= w_du16 and
     c                             sforda < w_du15
     c                   eval      cvau16 = cvau16 + sfanta
     c                   when      sforda >= w_du15 and
     c                             sforda < w_du14
     c                   eval      cvau15 = cvau15 + sfanta
     c                   when      sforda >= w_du14 and
     c                             sforda < w_du13
     c                   eval      cvau14 = cvau14 + sfanta
     c                   when      sforda >= w_du13 and
     c                             sforda < w_du12
     c                   eval      cvau13 = cvau13 + sfanta
     c                   when      sforda >= w_du12 and
     c                             sforda < w_du11
     c                   eval      cvau12 = cvau12 + sfanta
     c                   when      sforda >= w_du11 and
     c                             sforda < w_du10
     c                   eval      cvau11 = cvau11 + sfanta
     c                   when      sforda >= w_du10 and
     c                             sforda < w_du09
     c                   eval      cvau10 = cvau10 + sfanta
     c                   when      sforda >= w_du09 and
     c                             sforda < w_du08
     c                   eval      cvau09 = cvau09 + sfanta
     c                   when      sforda >= w_du08 and
     c                             sforda < w_du07
     c                   eval      cvau08 = cvau08 + sfanta
     c                   when      sforda >= w_du07 and
     c                             sforda < w_du06
     c                   eval      cvau07 = cvau07 + sfanta
     c                   when      sforda >= w_du06 and
     c                             sforda < w_du05
     c                   eval      cvau06 = cvau06 + sfanta
     c                   when      sforda >= w_du05 and
     c                             sforda < w_du04
     c                   eval      cvau05 = cvau05 + sfanta
     c                   when      sforda >= w_du04 and
     c                             sforda < w_du03
     c                   eval      cvau04 = cvau04 + sfanta
     c                   when      sforda >= w_du03 and
     c                             sforda < w_du02
     c                   eval      cvau03 = cvau03 + sfanta
     c                   when      sforda >= w_du02 and
     c                             sforda < w_du01
     c                   eval      cvau02 = cvau02 + sfanta
     c                   when      sforda >= w_du01
     c                   eval      cvau01 = cvau01 + sfanta
     c                   endsl
      *
     c                   endif
      *
     c     sstalx_key2   reade     sstalx
     c                   enddo
      *
      * Henter pakkseddel-informasjon
      *
     c                   eval      fodtlx_edat = w_da01
     c     fodtlx_key    setll     fodtlx
     c     fodtlx_key2   reade     fodtlx
     c                   dow       not %eof
      *
     c                   if        fdlety <> 1
      *
     c                   eval      fohel1_numm = fdnumm
     c                   eval      fohel1_suff = fdsuff
     c     fohel1_key    chain     fohel1
     c                   if        %found and
     c                             fobdat >= w_da01
      *
     c                   eval      votyl1_otyp = footyp
     c     votyl1_key    chain     votyl1
     c                   if        %found and
     c                             vaoakk = 2
      *
     c                   if        fdenh1 <> vvenhs
     c                   eval      vvenl1_enhe = vvenhs
     c     vvenl1_key    chain     vvenl1
     c                   if        %found
     c                   eval      w_omrs = veomre
     c                   eval      vvenl1_enhe = fdenh1
     c     vvenl1_key    chain     vvenl1
     c                   if        %found
     c                   eval      w_omro = veomre
     c                   eval(h)   fdanta = fdanta * w_omro/w_omrs
     c                   endif
     c                   endif
     c                   endif
      *
     c                   if        vaokre = '-'
     c                   eval      fdanta = fdanta * -1
     c                   eval      fdsums = fdsums * -1
     c                   eval      fdsumr = fdsumr * -1
     c                   endif
      *
     c                   eval      cvom12 = cvom12 + (fdsums-fdsumr)
     c                   if        fdanta > 0
     c                   eval      cvas12 = cvas12 + 1
     c                   endif
     c                   eval      cvan12 = cvan12 + fdanta
     c                   eval      cvan06 = cvan06 + fdanta
     c                   eval      cvan03 = cvan03 + fdanta
     c                   eval      cvan01 = cvan01 + fdanta
      *
     c                   select
     c                   when      fobdat >= w_du05 and
     c                             fobdat < w_du04
     c                   eval      cvau05 = cvau05 + fdanta
     c                   when      fobdat >= w_du04 and
     c                             fobdat < w_du03
     c                   eval      cvau04 = cvau04 + fdanta
     c                   when      fobdat >= w_du03 and
     c                             fobdat < w_du02
     c                   eval      cvau03 = cvau03 + fdanta
     c                   when      fobdat >= w_du02 and
     c                             fobdat < w_du01
     c                   eval      cvau02 = cvau02 + fdanta
     c                   when      fobdat >= w_du01
     c                   eval      cvau01 = cvau01 + fdanta
     c                   endsl
      *
     c                   endif
     c                   endif
     c                   endif
      *
     c     fodtlx_key2   reade     fodtlx
     c                   enddo
      *
      * Regner om antall solgt fra statistikenhet til lagerenhet
      *
     c                   if        vvenhl <> vvenhs
      *
     c                   eval      vvenl1_enhe = vvenhl
     c     vvenl1_key    chain     vvenl1
     c                   if        %found
     c                   eval      w_omrl = veomre
     c                   eval      vvenl1_enhe = vvenhs
     c     vvenl1_key    chain     vvenl1
     c                   if        %found
     c                   eval      w_omrs = veomre
     c                   eval(h)   cvan12 = cvan12 * w_omrs/w_omrl
     c                   eval(h)   cvan06 = cvan06 * w_omrs/w_omrl
     c                   eval(h)   cvaf03 = cvaf03 * w_omrs/w_omrl
     c                   eval(h)   cvan03 = cvan03 * w_omrs/w_omrl
     c                   eval(h)   cvan01 = cvan01 * w_omrs/w_omrl
     c                   eval(h)   cvau01 = cvau01 * w_omrs/w_omrl
     c                   eval(h)   cvau02 = cvau02 * w_omrs/w_omrl
     c                   eval(h)   cvau03 = cvau03 * w_omrs/w_omrl
     c                   eval(h)   cvau04 = cvau04 * w_omrs/w_omrl
     c                   eval(h)   cvau05 = cvau05 * w_omrs/w_omrl
     c                   eval(h)   cvau06 = cvau06 * w_omrs/w_omrl
     c                   eval(h)   cvau07 = cvau07 * w_omrs/w_omrl
     c                   eval(h)   cvau08 = cvau08 * w_omrs/w_omrl
     c                   eval(h)   cvau09 = cvau09 * w_omrs/w_omrl
     c                   eval(h)   cvau10 = cvau10 * w_omrs/w_omrl
     c                   eval(h)   cvau11 = cvau11 * w_omrs/w_omrl
     c                   eval(h)   cvau12 = cvau12 * w_omrs/w_omrl
     c                   eval(h)   cvau13 = cvau13 * w_omrs/w_omrl
     c                   eval(h)   cvau14 = cvau14 * w_omrs/w_omrl
     c                   eval(h)   cvau15 = cvau15 * w_omrs/w_omrl
     c                   eval(h)   cvau16 = cvau16 * w_omrs/w_omrl
     c                   eval(h)   cvau17 = cvau17 * w_omrs/w_omrl
     c                   eval(h)   cvau18 = cvau18 * w_omrs/w_omrl
     c                   eval(h)   cvau19 = cvau19 * w_omrs/w_omrl
     c                   eval(h)   cvau20 = cvau20 * w_omrs/w_omrl
     c                   eval(h)   cvau21 = cvau21 * w_omrs/w_omrl
     c                   eval(h)   cvau22 = cvau22 * w_omrs/w_omrl
     c                   eval(h)   cvau23 = cvau23 * w_omrs/w_omrl
     c                   eval(h)   cvau24 = cvau24 * w_omrs/w_omrl
     c                   eval(h)   cvau25 = cvau25 * w_omrs/w_omrl
     c                   eval(h)   cvau26 = cvau26 * w_omrs/w_omrl
     c                   eval(h)   cvau27 = cvau27 * w_omrs/w_omrl
     c                   eval(h)   cvau28 = cvau28 * w_omrs/w_omrl
     c                   eval(h)   cvau29 = cvau29 * w_omrs/w_omrl
     c                   eval(h)   cvau30 = cvau30 * w_omrs/w_omrl
     c                   eval(h)   cvau31 = cvau31 * w_omrs/w_omrl
     c                   eval(h)   cvau32 = cvau32 * w_omrs/w_omrl
     c                   eval(h)   cvau33 = cvau33 * w_omrs/w_omrl
     c                   eval(h)   cvau34 = cvau34 * w_omrs/w_omrl
     c                   eval(h)   cvau35 = cvau35 * w_omrs/w_omrl
     c                   eval(h)   cvau36 = cvau36 * w_omrs/w_omrl
     c                   eval(h)   cvau37 = cvau37 * w_omrs/w_omrl
     c                   eval(h)   cvau38 = cvau38 * w_omrs/w_omrl
     c                   eval(h)   cvau39 = cvau39 * w_omrs/w_omrl
     c                   eval(h)   cvau40 = cvau40 * w_omrs/w_omrl
     c                   eval(h)   cvau41 = cvau41 * w_omrs/w_omrl
     c                   eval(h)   cvau42 = cvau42 * w_omrs/w_omrl
     c                   eval(h)   cvau43 = cvau43 * w_omrs/w_omrl
     c                   eval(h)   cvau44 = cvau44 * w_omrs/w_omrl
     c                   eval(h)   cvau45 = cvau45 * w_omrs/w_omrl
     c                   eval(h)   cvau46 = cvau46 * w_omrs/w_omrl
     c                   eval(h)   cvau47 = cvau47 * w_omrs/w_omrl
     c                   eval(h)   cvau48 = cvau48 * w_omrs/w_omrl
     c                   eval(h)   cvau49 = cvau49 * w_omrs/w_omrl
     c                   eval(h)   cvau50 = cvau50 * w_omrs/w_omrl
     c                   eval(h)   cvau51 = cvau51 * w_omrs/w_omrl
     c                   eval(h)   cvau52 = cvau52 * w_omrs/w_omrl
     c                   endif
     c                   endif
      *
     c                   endif
      *
     c                   eval      cvda01 = w_du01
      *
      * Henter lagerinformasjon
      *
     c                   eval      cvbehl = vlbehl
     c                   eval      cvoord = vloord
     c                   eval      cvbbes = vlbbes
     c                   eval      cvmini = vlmini
     c                   eval      cvmaks = vlmaks
     c                   eval      cvhmin = vlbpun
     c                   eval      cvhmax = vlbmen
     c                   eval      cvanbr = vlbmin
     c                   eval      cvltid = vlltid
     c                   eval      cvsdat = vlsdat
     c                   eval      cvrdat = vlstda
     c                   eval      cvloka = vlplas
6.21  *
      * Henter ledetid
      *
     c                   if        cvltid = 0
      *
     c                   eval      mltil1_ogrp = 0
     c                   eval      mltil1_hgrp = 0
     c                   eval      mltil1_ugrp = 0
     c                   eval      mltil1_ldor = cvldor
     c                   eval      mltil1_vare = *blank
     c                   eval      mltil1_lage = w_lage
     c                   eval      mltil1_crdo = 0
     c     mltil1_key    chain     mltil1
     c                   if        %found
     c                   eval      cvltid = mcltid
     c                   endif
      *
     c                   if        not %found
     c                   eval      mltil1_lage = 0
     c     mltil1_key    chain     mltil1
     c                   if        %found
     c                   eval      cvltid = mcltid
     c                   endif
     c                   endif
      *
     c                   endif
      *
      * Henter lagerført dato
      * Nyeste dato av dato vare gikk fra skaffevare til lagervare
      * og datoene for oppretting av vare i lagerregisteret eller
      * i vareregisteret
      *
     c                   eval      cvldat = *loval
      *
     c                   eval      vhisl4_kode = 'SL'
     c     vhisl4_key    chain     vhisl4
     c                   if        %found
     c                   eval      cvldat = vhdato
     c                   endif
      *
     c                   if        vlodat > cvldat
     c                   eval      cvldat = vlodat
     c                   endif
      *
     c                   if        vvodat > cvldat
     c                   eval      cvldat = vvodat
     c                   endif
      *
      * Henter første og siste varemottaksdato
      *
     c                   eval      cvfvda = *loval
     c                   eval      cvsvda = *loval
      *
     c                   eval      vhisl4_kode = 'IP'
     c     vhisl4_key    setll     vhisl4
     c     vhisl4_key    reade     vhisl4
     c                   if        not %eof and
     c                             vhdato >= cvldat
     c                   eval      cvfvda = vhdato
     c                   eval      cvsvda = vhdato
     c                   endif
      *
     c     vhisl4_key    reade     vhisl4
     c                   dow       not %eof and
     c                             vhdato >= cvldat
     c                   eval      cvfvda = vhdato
     c     vhisl4_key    reade     vhisl4
     c                   enddo
      *
      * Henter siste telledato (nyeste dato av tellet og justert)
      *
     c                   eval      cvteda = *loval
      *
     c                   eval      vhisl4_kode = 'T'
     c     vhisl4_key    chain     vhisl4
     c                   if        %found
     c                   eval      cvteda = vhdato
     c                   endif
      *
     c                   eval      vhisl4_kode = 'J'
     c     vhisl4_key    chain     vhisl4
     c                   if        %found and
     c                             vhdato > cvteda
     c                   eval      cvteda = vhdato
     c                   endif
      *
      * Henter informasjon om vare som erstatningsvare
      *
     c                   eval      vverl4_envr = vvvare
     c     vverl4_key    chain     vverl4
     c                   if        %found
     c                   eval      cvevar = vvegvr
     c                   eval      cvefid = vvfidt
     c                   eval      cvesid = vvsidt
     c                   eval      cveomr = vvomre
     c                   endif
      *
6.30  * Henter logistikkvare-informasjon
      *
6.30 c                   eval      w_lv_nobb = 0
6.30 c                   eval      w_lv_lvar = *blank
6.30 c                   eval      w_lv_nlev = 0
6.31 c/exec sql
6.31 c+ select vvlnob,
6.31 c+        vvllva,
6.31 c+        vvlnle
6.31 c+ into   :w_lv_nobb,
6.31 c+        :w_lv_lvar,
6.31 c+        :w_lv_nlev
6.31 c+ from   vvlepf
6.31 c+ where  vvlvnr = :vvvare and
6.32 c+        vvlldo = :cvldor
6.31 c+ fetch first 1 rows only
6.31 c/end-exec
      *
6.32 c                   if        w_lv_nobb <> 0
6.32 c                   eval      cvnobb = w_lv_nobb
6.32 c                   eval      cvnlev = w_lv_nlev
6.32 c*                  eval      cvlvar = w_lv_lvar
6.32 c                   movel     w_lv_lvar     cvlvar
6.32 c                   endif
8.02  *
8.02 c     x'05':' '     xlate     cvlvar        cvlvar
      *
      * Henter leverandørinfo
      *
     c                   if        cvldor <> 0
     c                   eval      rlevl1_levr = cvldor
     c     rlevl1_key    chain     rlevl1
     c                   if        %found
     c                   eval      cvlnav = rlnavn
     c                   endif
     c                   endif
      *
      * Henter siste innkjøpsdato
      *
     c                   eval      lodtlv_numm = 999999
     c                   eval      lodtlv_suff = 99
     c     lodtlv_key1   setgt     lodtlv
     c     lodtlv_key2   readpe    lodtlv
      *
     c                   dow       not %eof
     c                   if        ldavde = w_avde
     c                   eval      lohel1_numm = ldnumm
     c                   eval      lohel1_suff = ldsuff
     c     lohel1_key    chain     lohel1
     c                   eval      cvidat = lobdat
     c                   leave
     c                   endif
     c     lodtlv_key2   readpe    lodtlv
     c                   enddo
      *
     c     sistlx_key    chain     sistlx
     c                   if        %found and
     c                             siorda > cvidat
     c                   eval      cvidat = siorda
     c                   endif
      *
      * Skriver til fil
      *
     c                   write     cvarpfr
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_list
      *
      * Key for les på lager-register
      *
     c     ra10lx_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ra10lx_javd
      *
      * Key for les på status-register
      *
     c     fstsl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på prisgruppe-knytning
      *
     c     vpgrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vpgrl1_glag
     c                   kfld                    vpgrl1_gavd
      *
      * Key for les på vare
      *
     c     vvarl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på vare-enhet
      *
     c     vvenl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_vare
     c                   kfld                    vvenl1_enhe
      *
     c     vvenl4_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_vare
     c                   kfld                    vvenl4_inen
      *
      * Key for oppslag på vare-pris
      *
     c     vvprl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_vare
     c                   kfld                    vvprl1_ldor
     c                   kfld                    vvprl1_prgr
     c                   kfld                    vvprl1_enhe
     c                   kfld                    vvprl1_lety
      *
      * Key for les på lager
      *
     c     vlagl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_vare
     c                   kfld                    w_lage
      *
      * Key for les på historisk lagerbok
      *
     c     vhisl4_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_vare
     c                   kfld                    w_lage
     c                   kfld                    vhisl4_kode
      *
      * Key for oppslag på erstatningsvare
      *
     c     vverl4_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vverl4_envr
      *
      * Key for oppslag leverandør
      *
     c     rlevl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl1_levr
      *
      * Key for oppslag på bestilling linje
      *
     c     lodtlv_key1   klist
     c                   kfld                    w_firm
     c                   kfld                    w_vare
     c                   kfld                    lodtlv_numm
     c                   kfld                    lodtlv_suff
      *
     c     lodtlv_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    w_vare
      *
      * Key for oppslag på bestilling hode
      *
     c     lohel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lohel1_numm
     c                   kfld                    lohel1_suff
      *
      * Key for oppslag på ledetid
      *
     c     mltil1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    mltil1_ogrp
     c                   kfld                    mltil1_hgrp
     c                   kfld                    mltil1_ugrp
     c                   kfld                    mltil1_ldor
     c                   kfld                    mltil1_vare
     c                   kfld                    mltil1_lage
     c                   kfld                    mltil1_crdo
      *
      * Key les på statistikk
      *
     c     sstalx_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_lage
     c                   kfld                    w_vare
     c                   kfld                    sstalx_orda
      *
     c     sstalx_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    w_lage
     c                   kfld                    w_vare
      *
      * Key les på ordre-linje
      *
     c     fodtlx_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_lage
     c                   kfld                    w_vare
     c                   kfld                    fodtlx_edat
      *
     c     fodtlx_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    w_lage
     c                   kfld                    w_vare
      *
      * Key oppslag på ordre-hode
      *
     c     fohel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fohel1_numm
     c                   kfld                    fohel1_suff
      *
      * Key oppslag på ordre-type
      *
     c     votyl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    votyl1_otyp
      *
      * Key for oppslag på innkjøpsstatistikk
      *
     c     sistlx_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_lage
     c                   kfld                    w_vare
      *
      *
      * Kopierer parameter til datastruktur
      *
     c                   eval      d_list = p_list
      *
     c                   eval      w_firm = d_firm
     c                   eval      w_avde = d_avde
      *
      * Henter lager
      *
     c     fstsl1_key    chain     fstsl1
      *
     c                   eval      w_lage = 0
      *
     c                   if        d_avde <> 0
     c                   eval      ra10lx_javd = d_avde
     c     ra10lx_key    chain     ra10lx
     c                   eval      w_lage = rajkod
     c                   else
     c                   eval      w_lage = faahla
     c                   endif
      *
      * Henter prisgruppe
      *
     c                   eval      vpgrl1_glag = w_lage
     c                   eval      vpgrl1_gavd = w_avde
     c     vpgrl1_key    chain     vpgrl1
     c                   if        not %found
     c                   eval      vpgrl1_gavd = 0
     c     vpgrl1_key    chain     vpgrl1
     c                   endif
     c                   if        %found
     c                   eval      w_prgr = vpgprg
     c                   else
     c                   eval      w_prgr = *blank
     c                   endif
      *
      * Finner mva-sats
      *
     c                   call      'FÅ705R'
     c                   parm                    w_firm
     c                   parm                    w_udat
     c                   parm                    w_mvap
     c                   parm                    w_mvat
     c                   parm                    w_mvaf
5.50  *
5.50  * Finner mva-sats for halv sats
5.50  *
5.50 c                   call      'FÅ706R'
5.50 c                   parm                    w_firm
5.50 c                   parm                    w_udat
5.50 c                   parm                    w_mv2p
5.50 c                   parm                    w_mv2t
5.50 c                   parm                    w_mv2f
      *
     c                   endsr
