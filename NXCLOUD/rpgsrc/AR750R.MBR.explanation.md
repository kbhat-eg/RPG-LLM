**Overview**  
This program (AR750R) allows users to query a “user register” stored in two physical files (AUSRL1 and AUSRL2). It uses a subfile-driven display (B1WSF) to present matching user records and returns a chosen entry to the calling program. The primary inputs are user ID (b2user) or user name (b2navn). The selections are handled by function keys (e.g., F3 for exit, F5 for refresh) and subroutines that manage the subfile contents, display, and scrolling.

---

## Purpose and Structure

1. **User Search & Display**  
   - The user can enter either a user ID (b2user) or a user name (b2navn).  
   - Based on which value is provided, the program positions to the correct place in the file (AUSRL1 or AUSRL2).  
   - It clears and rebuilds the subfile with matching user records.

2. **Subfile Management**  
   - Several subroutines handle subfile operations:
     - **XCLR01**: Clears/initializes subfile indicators and counters.  
     - **XCRT01**: Reads records from the appropriate file (AUSRL1 or AUSRL2) and populates up to seven subfile records at a time (controlled by SPGE01).  
     - **XDSP01**: Presents the subfile screen; function keys and user input are processed after the display.

3. **Return to Caller**  
   - If a user selects a record in the subfile (marked by B1VALG='1'), the program moves the user data into the parameters (wpuser, wpnavn) and then exits.  
   - If the user presses F3, the program immediately exits with a return code (w_retu).

---

## Business or Domain-Specific Logic

- **User Registry**:  
  - The files AUSRL1 and AUSRL2 are two variants of a “user register.”  
  - AUSRL1 seems keyed by user ID (ausrl1_user), while AUSRL2 can also be keyed by user name (ausrl2_navn) plus user ID.  
  - The program determines which file to read based on whether b2user or b2navn was entered.

- **Selection Criteria**:  
  - b2user (search by exact user ID).  
  - b2navn (search by name, which might be partially matched if the file supports it).  
  - The sequence is indicated by a one-character field (WSEQEN), set to 'A' for name-based lookups or blank for ID-based lookups.

- **Subfile Pagination**:  
  - The code reads up to seven records (SPGE01 = 7) in each loop when building/updating the subfile.  
  - The fields SRRN01, SFRN01, SSRN01, and SVRN01 track subfile record numbers for scrolling and display.

---

## Key Design Decisions & Conventions

1. **Separate Files for ID/Name Lookups**  
   - By having AUSRL1 keyed on user ID and AUSRL2 keyed on user name, the program can handle different search needs without additional complex logic in a single file.

2. **Function Key Handling**  
   - F3 (exit) sets a return code and jumps to the end.  
   - F5 (refresh) re-invokes the subfile load logic (XLSP01), which essentially clears the subfile and repopulates records.

3. **Subroutine-Driven Flow**  
   - Each major operation (clearing subfile, creating subfile, displaying subfile, handling function keys) is wrapped in a named subroutine to keep the code organized and readable.

4. **Return via Parameters**  
   - The chosen user ID and name are passed back to the calling program through parameters (wpuser, wpnavn).  
   - This is how the parent program learns which user was selected.

---

## Interactions with Other Modules

- **AUSRL1 / AUSRL2**:  
  - Both physical files are part of the “user register.”  
  - The code uses RENAME to map their record formats to AUSRL1R/AUSRL2R internally.  
- **Calling Program**:  
  - Receives the selected user information via wpuser and wpnavn parameters.  
  - Initiates this program to query users.

---

## Flow Summary

1. **Program Initialization**  
   - Zeroes out counters and initializes fields in *INZSR.  
   - Defines keys for AUSRL1 (by user ID) and AUSRL2 (by user name + user ID).  
   - Reads the first block of records for the subfile display.

2. **Main Loop**  
   - Displays the subfile via XDSP01.  
   - Responds to function keys:
     - **F3** → exits with a return code.  
     - **F5** → clears and reloads the subfile (XLSP01).  
     - **Roll keys** (IN10) → triggers XCRT01 to load the next block.

3. **User Selection**  
   - The subfile is polled for changed records (READC).  
   - If B1VALG = '1', the user ID and name are moved to wpuser and wpnavn, and the program exits.

4. **Exit**  
   - Control returns to the calling program with the selected values or with a return code indicating no selection.

---

## Notable Subroutines

- **XCLR01 (Clear Subfile)**  
  - Sets the subfile “clear” indicator (*IN14) to reset the subfile display.  
  - Resets counters for record numbering and pages.

- **XCRT01 (Build Subfile)**  
  - Determines how many records to load (SPGE01 = 7).  
  - In a loop, reads from AUSRL1 or AUSRL2 based on WSEQEN.  
  - Writes each record to the subfile (B1WSF).  
  - Updates record counters for continuous pagination.

- **XDSP01 (Display Subfile)**  
  - Conditions indicators to show the subfile content.  
  - Presents the display (B2WCT) and waits for user input (function keys or subfile selection).

- **XLSP01 (Refresh Logic)**  
  - Retrieves the last subfile position.  
  - Applies WSEQEN logic again (ID-based or name-based) to SETLL in AUSRL1 or AUSRL2.  
  - Clears and recreates the subfile to reflect any updates or changes.

---

**Summary**  
AR750R is a query-and-select program for entries in a user register. It manages subfile displays for searching by user ID or user name. The subroutines segregate each operation (clearing, creating, displaying) for maintainability and clarity. Users can select a record to pass back to the caller, or exit with function keys to end the session.