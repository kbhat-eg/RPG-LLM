# RPG Program AX700R – Module Validity Check

This program is named **AX700R** and is designed to verify if a specified module (tilleggsmodul) is valid (installed) in the system. It optionally displays a message if the module is missing.

Below is an explanation of its structure and logic.

---

## 1. **Heading and Comments**

- **/title** and comments at the beginning describe the system, program, purpose, parameters, change history, and indicator usage conventions.
- **Parameters**:
  - `Modulnavn` (Module name)
  - `Displayindikator` (Display indicator):  
    `0` = Do not show screen, `1` = Show screen
  - `Statusindikator` (Status indicator):  
    `0` = Module is OK, `1` = Module is not installed

- **Indicator usage** is explained, mapping indicator numbers to functions (e.g., LR for program end, 10/11 for rollup/rolldown, etc.)

---

## 2. **File Specification**

```rpg
famodl1    if   e           k disk    rename(amodpfr:amodl1r)
```
- **famodl1**: A database file used in the program.
- `if e`: Input file, externally described, keyed access.
- `rename(amodpfr:amodl1r)`: External format `amodpfr` is renamed to `amodl1r` within this program.

---

## 3. **Data Definitions**

### **Parameters and Fields**

```rpg
d p_modu          s             10
d p_disp          s              1
d p_stat          s              1
```
- **p_modu**: Module name (input/output parameter).
- **p_disp**: Display flag (input parameter).
- **p_stat**: Status flag (output parameter).

### **Key Variables**

```rpg
d amodl1_modu     s                   like(axmodu)
```
- **amodl1_modu**: Variable to hold the module key (same type as `axmodu`).

### **Work Fields**

```rpg
d w_firm          s              3  0
d w_srrn          s              4  0
d w_meld          s             50
```
- **w_firm**: Work variable, possibly firm/company code.
- **w_srrn**: Work variable, possibly record number.
- **w_meld**: Message text to display.

---

## 4. **Main Program Logic**

### **Module Existence Check**
```rpg
c                   eval      amodl1_modu = p_modu
c     amodl1_key    chain     amodl1
c                   if        %found
c                   eval      p_stat = '0'
c                   else
c                   eval      p_stat = '1'
c                   if        p_disp = '1'
c                   eval      w_meld = 'Tilleggsmodul m� installeres. ' +
6.30 c                                      'Kontakt EG Norge'
c                   call      'AA005R'
c                   parm                    w_meld
c                   endif
c                   endif
```

- Sets the module key from the parameter.
- **CHAIN**: Checks if the module exists in the file.
- If found:
  - Sets status to `'0'` (OK).
- If NOT found:
  - Sets status to `'1'` (Not installed).
  - If display flag is `'1'`:
    - Sets the message to "The add-on module must be installed. Contact EG Norge".
    - Calls program `'AA005R'` to display the message, passing `w_meld` as parameter.

### **End Program**

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Sets LR (Last Record) = ON to end the program.
- Returns.

---

## 5. **Subroutine: Initialization (`*inzsr`)**

### **Parameter List**

```rpg
c     *inzsr        begsr
c     *entry        plist
c                   parm                    p_modu
c                   parm                    p_disp
c                   parm                    p_stat
```
- Defines the parameter interface for this program (module name, display flag, status flag).

### **Key List**

```rpg
c     amodl1_key    klist
c                   kfld                    amodl1_modu
```
- Defines the key list used for file access (with `amodl1_modu` as the key field).

### **Other Initialization**

```rpg
c                   eval      p_stat = *blank
c                   endsr
```
- Sets the status parameter to blank on entry.

---

## 6. **Summary of Program Flow**

1. **Initialization**: Sets up parameters and keys.
2. **Checks if the module exists** in the specified file using key lookup.
3. **Sets status flag accordingly**:
   - `'0'`: Module is installed.
   - `'1'`: Module is not installed.
4. **If not found and display is requested**:
   - Composes and displays an appropriate error message.
5. **Ends the program**.

---

## 7. **Notes for Onboarding**

- This program is typical for checking if a given module has been installed, with optional user notification.
- Uses traditional fixed-format RPG IV code (not free-format).
- Uses external files and calls another program to display messages (`AA005R`).
- Key conventions and indicator mappings are well documented in comments.

---

If you have specific questions about file structure or external programs (like `AA005R`), you may need to refer to their DDS/definitions or documentation.