     h datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOFAK
      * Program . . . . : JV163R
      * Beskrivelse . . : Leser inn info om prioritert leverandør fra
      *                   semikolonseparert fil.
      *
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       210519 bsa  Nytt program
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     flwexpf    if   e           k disk    rename(lexcpfr:lwexpfr)
     fvprllu    uf a e           k disk    rename(vprlpfr:vprllur)
     frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
      *
      *
     d                 ds
     d d_inpu                       256
     d  d_lagen                       2  0 overlay(d_inpu:1)
     d   d_lage                       2    overlay(d_lagen:1)
     d   d_lag1                       1    overlay(d_lagen:1)
     d  d_ogrpn                       2  0 overlay(d_inpu:3)
     d   d_ogrp                       2    overlay(d_ogrpn:1)
     d   d_ogr1                       1    overlay(d_ogrpn:1)
     d  d_hgrpn                       2  0 overlay(d_inpu:5)
     d   d_hgrp                       2    overlay(d_hgrpn:1)
     d   d_hgr1                       1    overlay(d_hgrpn:1)
     d  d_ugrpn                       3  0 overlay(d_inpu:7)
     d   d_ugrp                       3    overlay(d_ugrpn:1)
     d   d_ugr2                       2    overlay(d_ugrpn:1)
     d   d_ugr1                       1    overlay(d_ugrpn:1)
     d  d_modnn                       6  0 overlay(d_inpu:10)
     d   d_modn                       6    overlay(d_modnn:1)
     d   d_mod5                       5    overlay(d_modnn:1)
     d   d_mod4                       4    overlay(d_modnn:1)
     d   d_mod3                       3    overlay(d_modnn:1)
     d   d_mod2                       2    overlay(d_modnn:1)
     d   d_mod1                       1    overlay(d_modnn:1)
     d  d_varen                       8    overlay(d_inpu:16)
     d   d_vare                       8    overlay(d_varen:1)
     d   d_var7                       7    overlay(d_varen:1)
     d   d_var6                       6    overlay(d_varen:1)
     d   d_var5                       5    overlay(d_varen:1)
     d   d_var4                       4    overlay(d_varen:1)
     d   d_var3                       3    overlay(d_varen:1)
     d   d_var2                       2    overlay(d_varen:1)
     d   d_var1                       1    overlay(d_varen:1)
     d  d_pr1ln                       6  0 overlay(d_inpu:24)
     d   d_pr1l                       6    overlay(d_pr1ln:1)
     d   d_pr15                       5    overlay(d_pr1ln:1)
     d   d_pr14                       4    overlay(d_pr1ln:1)
     d   d_pr13                       3    overlay(d_pr1ln:1)
     d   d_pr12                       2    overlay(d_pr1ln:1)
     d   d_pr11                       1    overlay(d_pr1ln:1)
     d  d_pr2ln                       6  0 overlay(d_inpu:30)
     d   d_pr2l                       6    overlay(d_pr2ln:1)
     d   d_pr25                       5    overlay(d_pr2ln:1)
     d   d_pr24                       4    overlay(d_pr2ln:1)
     d   d_pr23                       3    overlay(d_pr2ln:1)
     d   d_pr22                       2    overlay(d_pr2ln:1)
     d   d_pr21                       1    overlay(d_pr2ln:1)
     d  d_pr3ln                       6  0 overlay(d_inpu:36)
     d   d_pr3l                       6    overlay(d_pr3ln:1)
     d   d_pr35                       5    overlay(d_pr3ln:1)
     d   d_pr34                       4    overlay(d_pr3ln:1)
     d   d_pr33                       3    overlay(d_pr3ln:1)
     d   d_pr32                       2    overlay(d_pr3ln:1)
     d   d_pr31                       1    overlay(d_pr3ln:1)
      *
     d b_ok            s              1    inz(*off)
     d w_posi          s              4  0
     d digits          c                   ' 0123456789'
     d w_date          s               d   datfmt(*iso)
     d w_time          s               t
      *
     d                uds
     d l_user                911    920
     d l_filg                931    933
     d l_firm                944    946  0
      *
     d w_firm          s                   like(plfirm)
     d w_leng          s              2  0
      *
     d w_lage          s              2
     d w_ogrp          s              2
     d w_hgrp          s              2
     d w_ugrp          s              3
     d w_modn          s              6
     d w_vare          s              8
     d w_pr1l          s              6
     d w_pr2l          s              6
     d w_pr3l          s              6
     d w_anta          s              5  0
      *
     d p_anta          s              5  0
      *
      * Definering av variable i nøkkler
      *
     d rlevl1_levr     s                   like(rllevr)
     d vprllu_lage     s                   like(pllage)
     d vprllu_ogrp     s                   like(plogrp)
     d vprllu_hgrp     s                   like(plhgrp)
     d vprllu_ugrp     s                   like(plugrp)
     d vprllu_modn     s                   like(plmodn)
     d vprllu_vare     s                   like(plvare)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Leser inn input file, og splitter record fra regneark.
      *
     c                   read      lwexpf
     c                   dow       not %eof
      *
     c                   eval      b_ok = *off
     c                   eval      d_inpu = *blank
     c                   exsr      utled_ds
      *
      *   Legg ut ny post på kortregister
      *
     c                   if        b_ok = *on
      *
     c                   eval      w_anta = w_anta + 1
      *
      * Opprett post hvis den ikke finnes fra før.
      *
     c                   eval      vprllu_lage = d_lagen
     c                   eval      vprllu_ogrp = d_ogrpn
     c                   eval      vprllu_hgrp = d_hgrpn
     c                   eval      vprllu_ugrp = d_ugrpn
     c                   eval      vprllu_modn = d_modnn
     c                   eval      vprllu_vare = d_varen
     c     vprllu_key    chain     vprllur
      *
     c                   if        not %found(vprllu)
     c                   clear                   vprllur
     c                   eval      plfirm = w_firm
     c                   eval      pllage = d_lagen
     c                   eval      plogrp = d_ogrpn
     c                   eval      plhgrp = d_hgrpn
     c                   eval      plugrp = d_ugrpn
     c                   eval      plmodn = d_modnn
     c                   eval      plvare = d_varen
      *
     c                   eval      plousr = l_user
     c                   eval      plotim = w_time
     c                   eval      plodat = w_date
     c                   endif
      *
     c                   eval      plpr1l = d_pr1ln
     c                   eval      plpr2l = d_pr2ln
     c                   eval      plpr3l = d_pr3ln
      *
     c                   eval      pleusr = l_user
     c                   eval      pletim = w_time
     c                   eval      pledat = w_date
      *
     c                   if        %found(vprllu)
     c                   update    vprllur
     c                   else
     c                   write     vprllur
     c                   endif
      *
     c                   endif
      *
     c                   read      lwexpf
     c                   enddo
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     avslutt       tag
      *
     c                   eval      p_anta = w_anta
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for håndtering av innlest post
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     utled_ds      begsr
      *
     c**                 movel     exclin        d_inpu
     c     '"':' '       xlate     exclin        exclin
      * Lager
     c                   eval      w_posi = 0
     c                   eval      w_posi = %scan(';':exclin)
     c                   eval      d_lage = %trim(%subst(exclin:1:w_posi-1))
      *
     c                   eval      w_lage = *blanks
     c                   eval      w_leng = %len(%trim(d_lage))
     c                   if        w_leng = 0
     c                   eval      d_lage = '0'
     c                   endif
     c                   if        w_leng = 1
     c                   move      d_lag1        w_lage
     c                   elseif    w_leng = 2
     c                   move      d_lage        w_lage
     c                   endif
      *
      * Overgruppe
      *
     c                   eval      exclin = %subst(exclin:w_posi+1:512-w_posi)
     c                   eval      w_posi = %scan(';':exclin)
     c                   eval      d_ogrp = %trim(%subst(exclin:1:w_posi-1))
      *
     c                   eval      w_ogrp = *blanks
     c                   eval      w_leng = %len(%trim(d_ogrp))
     c                   if        w_leng = 0
     c                   eval      d_ogrp = '0'
     c                   endif
     c                   if        w_leng = 1
     c                   move      d_ogr1        w_ogrp
     c                   elseif    w_leng = 2
     c                   move      d_ogrp        w_ogrp
     c                   endif
      *
      * Hovedgruppe
      *
     c                   eval      exclin = %subst(exclin:w_posi+1:512-w_posi)
     c                   eval      w_posi = %scan(';':exclin)
     c                   eval      d_hgrp = %trim(%subst(exclin:1:w_posi-1))
      *
     c                   eval      w_hgrp = *blanks
     c                   eval      w_leng = %len(%trim(d_hgrp))
     c                   if        w_leng = 0
     c                   eval      d_hgrp = '0'
     c                   endif
     c                   if        w_leng = 1
     c                   move      d_hgr1        w_hgrp
     c                   elseif    w_leng = 2
     c                   move      d_hgrp        w_hgrp
     c                   endif
      *
      * Undergruppe
      *
     c                   eval      exclin = %subst(exclin:w_posi+1:512-w_posi)
     c                   eval      w_posi = %scan(';':exclin)
     c                   eval      d_ugrp = %trim(%subst(exclin:1:w_posi-1))
      *
     c                   eval      w_ugrp = *blanks
     c                   eval      w_leng = %len(%trim(d_ugrp))
     c                   if        w_leng = 0
     c                   eval      d_ugrp = '0'
     c                   endif
     c                   if        w_leng = 1
     c                   move      d_ugr1        w_ugrp
     c                   elseif    w_leng = 2
     c                   move      d_ugr2        w_ugrp
     c                   elseif    w_leng = 3
     c                   move      d_ugrp        w_ugrp
     c                   endif
      *
      * Modulnummer
      *
     c                   eval      exclin = %subst(exclin:w_posi+1:512-w_posi)
     c                   eval      w_posi = %scan(';':exclin)
     c                   eval      d_modn = %trim(%subst(exclin:1:w_posi-1))
      *
     c                   eval      w_modn = *blanks
     c                   eval      w_leng = %len(%trim(d_modn))
     c                   if        w_leng = 0
     c                   eval      d_modn = '0'
     c                   endif
     c                   if        w_leng = 1
     c                   move      d_mod1        w_modn
     c                   elseif    w_leng = 2
     c                   move      d_mod2        w_modn
     c                   elseif    w_leng = 3
     c                   move      d_mod3        w_modn
     c                   elseif    w_leng = 4
     c                   move      d_mod4        w_modn
     c                   elseif    w_leng = 5
     c                   move      d_mod5        w_modn
     c                   elseif    w_leng = 6
     c                   move      d_modn        w_modn
     c                   endif
      *
      *  Varenummer
      *
     c                   eval      exclin = %subst(exclin:w_posi+1:512-w_posi)
     c                   eval      w_posi = %scan(';':exclin)
     c                   eval      d_vare = %trim(%subst(exclin:1:w_posi-1))
      *
     c                   eval      w_vare = *blanks
     c                   eval      w_leng = %len(%trim(d_vare))
     c                   if        w_leng = 0
     c                   eval      d_vare = *blanks
     c                   endif
     c                   if        w_leng = 1
     c                   move      d_var1        w_vare
     c                   elseif    w_leng = 2
     c                   move      d_var2        w_vare
     c                   elseif    w_leng = 3
     c                   move      d_var3        w_vare
     c                   elseif    w_leng = 4
     c                   move      d_var4        w_vare
     c                   elseif    w_leng = 5
     c                   move      d_var5        w_vare
     c                   elseif    w_leng = 6
     c                   move      d_var6        w_vare
     c                   elseif    w_leng = 7
     c                   move      d_var7        w_vare
     c                   elseif    w_leng = 8
     c                   move      d_vare        w_vare
     c                   endif
      *
      *  Prioritert leverandør 1
      *
     c                   eval      exclin = %subst(exclin:w_posi+1:512-w_posi)
     c                   eval      w_posi = %scan(';':exclin)
     c                   eval      d_pr1l = %trim(%subst(exclin:1:w_posi-1))
      *
     c                   eval      w_pr1l = *blanks
     c                   eval      w_leng = %len(%trim(d_pr1l))
     c                   if        w_leng = 0
     c                   eval      d_pr1l = '0'
     c                   endif
     c                   if        w_leng = 1
     c                   move      d_pr11        w_pr1l
     c                   elseif    w_leng = 2
     c                   move      d_pr12        w_pr1l
     c                   elseif    w_leng = 3
     c                   move      d_pr13        w_pr1l
     c                   elseif    w_leng = 4
     c                   move      d_pr14        w_pr1l
     c                   elseif    w_leng = 5
     c                   move      d_pr15        w_pr1l
     c                   elseif    w_leng = 6
     c                   move      d_pr1l        w_pr1l
     c                   endif
      *
      *  Prioritert leverandør 2
      *
     c                   eval      exclin = %subst(exclin:w_posi+1:512-w_posi)
     c                   eval      w_posi = %scan(';':exclin)
     c                   eval      d_pr2l = %trim(%subst(exclin:1:w_posi-1))
      *
     c                   eval      w_pr2l = *blanks
     c                   eval      w_leng = %len(%trim(d_pr2l))
     c                   if        w_leng = 0
     c                   eval      d_pr2l = '0'
     c                   endif
     c                   if        w_leng = 1
     c                   move      d_pr21        w_pr2l
     c                   elseif    w_leng = 2
     c                   move      d_pr22        w_pr2l
     c                   elseif    w_leng = 3
     c                   move      d_pr23        w_pr2l
     c                   elseif    w_leng = 4
     c                   move      d_pr24        w_pr2l
     c                   elseif    w_leng = 5
     c                   move      d_pr25        w_pr2l
     c                   elseif    w_leng = 6
     c                   move      d_pr2l        w_pr2l
     c                   endif
      *
      *  Prioritert leverandør 3
      *
     c                   eval      exclin = %subst(exclin:w_posi+1:512-w_posi)
     c                   eval      w_posi = %scan(';':exclin)
     c                   if        w_posi = 0
     c                   eval      d_pr3l = %trim(exclin)
     c                   else
     c                   eval      d_pr3l = %trim(%subst(exclin:1:w_posi-1))
     c                   endif
      *
     c                   eval      w_pr3l = *blanks
     c                   eval      w_leng = %len(%trim(d_pr3l))
     c                   if        w_leng = 0
     c                   eval      d_pr3l = '0'
     c                   endif
     c                   if        w_leng = 1
     c                   move      d_pr31        w_pr3l
     c                   elseif    w_leng = 2
     c                   move      d_pr32        w_pr3l
     c                   elseif    w_leng = 3
     c                   move      d_pr33        w_pr3l
     c                   elseif    w_leng = 4
     c                   move      d_pr34        w_pr3l
     c                   elseif    w_leng = 5
     c                   move      d_pr35        w_pr3l
     c                   elseif    w_leng = 6
     c                   move      d_pr3l        w_pr3l
     c                   endif
      *
      * Sjekk gyldighet
      *  lagernummer
      *
     c                   if        %check(digits:d_lage) <> 0
     c                   leavesr
     c                   endif
      *
      * Sjekk at det er gyldig leverandørnummer
      *
     c                   if        %check(digits:w_pr1l) <> 0
     c                   eval      d_pr1ln = 0
     c                   else
     c                   move      w_pr1l        d_pr1ln
     c                   endif
     c                   if        %check(digits:w_pr2l) <> 0
     c                   eval      d_pr2ln = 0
     c                   else
     c                   move      w_pr2l        d_pr2ln
     c                   endif
     c                   if        %check(digits:w_pr3l) <> 0
     c                   eval      d_pr3ln = 0
     c                   else
     c                   move      w_pr3l        d_pr3ln
     c                   endif
      *
      *
     c                   if        d_pr1ln <> 0
     c                   eval      rlevl1_levr = d_pr1ln
     c     rlevl1_key    chain     rlevl1
     c                   if        not %found
     c                   eval      d_pr1ln = 0
     c                   endif
     c                   endif
      *
     c                   if        d_pr2ln <> 0
     c                   eval      rlevl1_levr = d_pr2ln
     c     rlevl1_key    chain     rlevl1
     c                   if        not %found
     c                   eval      d_pr2ln = 0
     c                   endif
     c                   endif
      *
     c                   if        d_pr3ln <> 0
     c                   eval      rlevl1_levr = d_pr3ln
     c     rlevl1_key    chain     rlevl1
     c                   if        not %found
     c                   eval      d_pr3ln = 0
     c                   endif
     c                   endif
      *
      * Hvis ingen leverandørnummer, skip posten
      *
     c                   if        d_pr1ln = 0 and
     c                             d_pr2ln = 0 and
     c                             d_pr3ln = 0
     c                   leavesr
     c                   endif
      *
     c                   move      w_lage        d_lagen
     c                   move      w_ogrp        d_ogrpn
     c                   move      w_hgrp        d_hgrpn
     c                   move      w_ugrp        d_ugrpn
     c                   move      w_vare        d_varen
     c                   move      w_modn        d_modnn
      *
     c                   eval      b_ok = *on
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_anta
      *
      * Key for oppdatering av prioritert leverandør
      *
     c     vprllu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vprllu_lage
     c                   kfld                    vprllu_ogrp
     c                   kfld                    vprllu_hgrp
     c                   kfld                    vprllu_ugrp
     c                   kfld                    vprllu_modn
     c                   kfld                    vprllu_vare
      *
      * Key for oppdatering av kunderegister
      *
     c     rlevl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl1_levr
      *
     c                   eval      w_firm = l_firm
     c                   time                    w_time
     c                   time                    w_date
     c                   eval                    w_anta = 0
      *
     c                   endsr
