# Explanation of RPG Source Code: **AP633R**

This program is written in ILE RPG (RPG IV, in fixed-form). Its purpose is to support the screen viewing of NOBB (Norwegian Building Database) information by providing a PDF path and launching it through an external program.

---

## **Header & Program Metadata**

- The `/TITLE` directive provides a title: "Skjermvisning av PDF utskrifter" (Screen viewing of PDF printouts).
- `H` specs set program options:
  - `DECEDIT('0.')`: Sets decimal edit characters.
  - `DATEDIT(*DMY.)`: Sets default date edit format to Day/Month/Year.
  - `option(*nodebugio)`: Disables debug data for I/O fields.
  - `DftActgrp(*No)`: The program runs in its own activation group.

Program metadata (comment lines) describes the program name (`AP633R`), purpose, author, and change history.

---

## **File Declaration**

```rpg
fafpslr    if   e           k disk    rename(afpspfr:afpslrr)
```
- An externally described file (`afpspfr`) is used with the RPG record format renamed to `afpslrr`. This file is accessed for retrieving configuration.

---

## **Variable Declarations**

### **Parameters**

```rpg
d p_nobb          s              8
d p_link          s            256
```
- `p_nobb`: Input parameter, likely a NOBB article or reference number.
- `p_link`: Output (or working) variable for the constructed PDF link.

### **Key Variables**

```rpg
d afpslr_ufil     s                   like(l_filg)
d afpslr_uide     s                   like(afuide)
```
- Variables used as keys to access records in the configuration file.

### **Working Variables**

```rpg
d w_date          s               d   datfmt(*iso)
d w_brpt          s             60
d nobbpth         s            100
```
- `w_date`: Current date in ISO format.
- `w_brpt`: Working variable to hold the trimmed NOBB number.
- `nobbpth`: The path to the NOBB PDF directory.

---

## **LDA (Local Data Area) Definitions**

```rpg
d                uds
d l_ruti                800    809
d l_outq                810    819
d l_wsid                901    910
d l_user                911    920
d l_filg                931    933
d l_firm                944    946  0
```

- These fields map to sections within the LDA (global user/session/context information), such as routing information, output queue, workstation ID, user, file group, and firm code.

---

## **Mainline Code**

### **Build PDF Path**

```rpg
c                   eval      w_brpt = %trim(p_nobb)
c                   eval      p_link = %trim(nobbpth)+%Trim(w_brpt)
```
- The trimmed NOBB number (`p_nobb`) is assigned to `w_brpt`.
- The final link (`p_link`) is constructed by concatenating the trimmed PDF path from the configuration (`nobbpth`) and the NOBB number.

### **Call External Program**

```rpg
c                   call      'AP628C'
c                   parm                    p_link
```
- Calls the external program `AP628C`, passing the constructed PDF link as a parameter. Presumably, this program launches the browser with a PDF preview.

### **Program Exit**

```rpg
c                   eval      *inlr = *on
c                   return
```
- Sets the last record indicator (ends the program), then returns.

---

## **Subroutine: *inzsr (Initialization)**

Subroutine for initializing key context and loading configuration.

### **Parameter List**

```rpg
c     *entry        plist
c                   parm                    p_nobb
```
- Receives the NOBB parameter as input.

### **Set Up Key for File Access**

```rpg
c     afpslr_key    klist
c                   kfld                    afpslr_ufil
c                   kfld                    afpslr_uide
```
- Sets up a key list for record access (used by `CHAIN`).

### **Set Date**

```rpg
c                   time                    w_date
```
- Stores the current system date in `w_date`.

### **Fetch PDF Path from Configuration**

```rpg
c                   eval      afpslr_ufil = l_filg
c                   eval      afpslr_uide = 'NOBBLINK  '
c     afpslr_key    chain     afpslrr
c                   if        %found
c                   eval      nobbpth = *blanks
c                   movel     afudss        nobbpth
c                   endif
```
- Fills key fields (`afpslr_ufil` from LDA, `afpslr_uide` with a constant).
- Performs a `CHAIN` (random access) to find the relevant configuration (PDF base path).
- If found, moves the `afudss` field (the path) to `nobbpth` for later use.

---

## **Summary of Program Logic**

1. **Initialization (`*inzsr`):**
   - Reads input NOBB number.
   - Loads the base PDF path from the configuration file based on parameters from LDA and a fixed identifier.
2. **Main Processing:**
   - Trims and builds the full PDF link/path.
   - Calls another program (`AP628C`) to use the link (likely launching a browser).
3. **Cleanup:**
   - Ends the program cleanly by setting `*INLR = *ON`.

---

## **Key Learning Points**

- The program is structured as a simple service utility: receive a number, look up a base path, combine them, and trigger a viewer.
- Variable names and comments are Norwegian.
- All data, including configuration, is dynamicâ€”read from outside (LDA, configuration file).
- Extensibility: To view a different kind of document, only the key constants or parameters would need to change.

---

## **Typical Use Case**

- Another program or user passes an item/article number to `AP633R`.
- The program looks up where on the server the corresponding PDF is located.
- It triggers a browser or viewer to display the PDF to the user.

---

### **In Summary**
This program acts as a bridge between a user or another application, and the document repository for NOBB data, encapsulating lookup, path construction, and display logic in a re-usable RPG service program.