# RPG Program JH600R - Explanation

## Overview

This program, `JH600R`, is designed as a parameter interface for printing item agreements. It is an interactive (workstation) program that manages a screen, processes user input, validates data, and calls a print program (`JH600C`) with the appropriate parameters.

The program follows classic RPG/400 (ILE RPG with fixed format) structure and conventions, using indicators for user actions and program logic. Subroutines (BEGSR/ENDSR) are used for modularity.

---

## Header

```rpg
h option(*nodebugio) datedit(*dmy)
```
- *option(*nodebugio)*: Disables I/O debug information.
- *datedit(*dmy)*: Default date format is day-month-year.

---

## File Declaration

```rpg
FJH600D    CF   E             WORKSTN
```
- Declares a display file (`JH600D`) connected to a workstation for interactive screen handling.

---

## Data Area Usage

This section defines data area overlays for local data area (LDA), usually to fetch user and company information.

```rpg
D                UDS
D  DSUSER               911    920
D  DSFIRM               944    946  0
```
- `UDS`: Overlay on LDA.
- `DSUSER`: User ID from bytes 911-920.
- `DSFIRM`: Company number from bytes 944-946.

---

## Working Storage and Parameter Structures

```rpg
D                 DS
D  DSLIST                 1     64
D  WPFIRM                 1      3  0
D  WPLDOR                 4      9  0
```
- `DSLIST`: Parameter list (64 bytes) for passing values to other programs.
- `WPFIRM`, `WPLDOR`: Fields inside `DSLIST`. `WPFIRM` is firm number, `WPLDOR` appears to be an order number or similar.

---

## Main Logic Flow (C-specs)

### Main Screen Processing Loop

```rpg
C     B1TAG         TAG
C     B1TAGA        TAG
C                   EXFMT     B1BLD
```
- Two tags for control flow.
- `EXFMT B1BLD`: Display screen `B1BLD` and wait for user input.

### Handling Function Keys

```rpg
C     *INKC         CABEQ     *ON           XSLUTT
C     *INKL         CABEQ     *ON           B1TAG
C     *INKD         IFEQ      *ON
C                   EXSR      SP�RRING
C                   GOTO      B1TAGA
C                   ENDIF
```
- If F3 pressed (`KC`), exit program.
- If F12 pressed (`KL`), restart main screen.
- If F4 pressed (`KD`), call subroutine `SPØRRING` (inquiry/help).

### Input Validation and Processing

```rpg
C                   EXSR      SJEKK_INP
C     WFEIL         IFEQ      *ON
C                   MOVE      *OFF          WFEIL
C                   GOTO      B1TAGA
C                   ENDIF
```
- Call `SJEKK_INP` subroutine to validate input fields.
- If error (`WFEIL = *ON`), clear error and redisplay input screen.

### Parameter Preparation and Call to Print Program

```rpg
C                   EXSR      FLYTT_PAR
C                   CALL      'JH600C'
C                   PARM                    DSLIST
C                   GOTO      B1TAGA
```
- Move screen/field data to parameters via `FLYTT_PAR`.
- Call print/output program `JH600C` with `DSLIST` as parameter.
- Return to main screen.

---

## End Program

```rpg
C     XSLUTT        TAG
C                   MOVE      *ON           *INLR
C                   RETURN
```
- Set LR indicator to end the program.
- Return to caller.

---

## Subroutines

### 1. `SPØRRING` (Inquiry Help)

```rpg
C     SP�RRING      BEGSR
C     w_afld        IFEQ      'B1LDOR'
C                   CALL      'JL500R'
C                   PARM                    B1LDOR
C                   PARM                    WNAVN
C                   GOTO      ENDSP�RR
C                   ENDIF
C     ENDSP�RR      ENDSR
```
- If the active field is `B1LDOR`, call `JL500R` (likely a lookup/help program) and pass field and name.
- Return to main logic.

---

### 2. `SJEKK_INP` (Check Input Fields)

```rpg
C     SJEKK_INP     BEGSR
C     ENDSJEKK      ENDSR
```
- Placeholder for input validation logic.
- In provided code, it does nothing (to be implemented).

---

### 3. `FLYTT_PAR` (Move Data to Parameters)

```rpg
C     FLYTT_PAR     BEGSR
C                   MOVE      DSFIRM        WPFIRM
C                   Z-ADD     B1LDOR        WPLDOR
C                   ENDSR
```
- Moves company number (`DSFIRM`) into parameter field (`WPFIRM`).
- Adds screen/order data (`B1LDOR`) into parameter field (`WPLDOR`).
- Prepares the parameter list for called program.

---

### 4. `*INZSR` (Initialization)

```rpg
C     *INZSR        BEGSR
C                   MOVE      *OFF          WFEIL             1
C                   MOVE      *BLANK        WNAVN            30
C                   Z-ADD     0             WWFIRM            3 0
C                   MOVE      DSFIRM        WWFIRM
C                   ENDSR
```
- Runs automatically at program start.
- Resets error and working variables.
- Initializes display field (`WWFIRM`) from data area (`DSFIRM`).

---

## Additional Notes

- **Indicators**: `KC`, `KD`, `KL` refer to function key indicators (F3, F4, F12). Other indicators like `WFEIL` are for error tracking.
- **Norwegian Comments**: The comments are in Norwegian (e.g., "Utskrift av vareavtaler" — "Print of item agreements").
- **Screen fields**: Names like `B1LDOR` and `WNAVN` represent screen fields or variables.
- **External Calls**:
    - `JH600C`: The main print/out program.
    - `JL500R`: Likely a lookup/help program for inquiries.

---

## In Summary

- The program displays a data entry/inquiry screen for item agreements.
- User can F3=Exit, F12=Cancel, F4=Inquiry.
- Input is validated, then mapped into parameters.
- Calls the print program (JH600C) with entered data.
- Uses local data area to prefill company/user identifiers.

This code demonstrates standard RPG/400 practices for building parameter-driven interactive programs on IBM i (AS/400).