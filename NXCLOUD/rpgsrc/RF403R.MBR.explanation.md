# RPG Program Explanation: RF403R (ASOKON – Delete Company Data)

This RPG/400 (ILE) program is used for cleaning up (deleting) all information for a specific company (“firma”) across a variety of files in the ASOKON system. 

## **Overview**
- **Purpose:**  
  The program cycles through a list of files and deletes all records that match a given company number (l_firm).

- **File Types:**  
  Each file seems to hold different types of accounting and company-related data (customers, ledgers, suppliers, reports, etc.).

- **Process Flow:**  
  For each file:
  1. Read records sequentially.
  2. If the company number in the record equals the supplied company number (`l_firm`), delete the record.
  3. Continue until the end of file, then move to the next file.

---

## **Code Structure**

### **Header and Program Info**
- `/TITLE` and the block comments describe:
  - System: ASOKON
  - Program: RF403R
  - Function: Delete ("slett") all data for a company ("firma").

### **File Declarations (F-specs)**
- Many files are declared, each with:
  - `UF`: User Open, Full Procedural
  - `E`: External described file
  - `K`: Keyed access
  - Some files use the `RENAME` keyword to rename record formats.

_Examples:_
```rpg
frfoblu    uf   e           k disk    rename(rforpfr:rfoblur)
frforlu    uf   e           k disk    rename(rforpfr:rforlur)
frhovlu    uf   e           k disk
...
```

### **Data Declarations (D-specs)**
Defines fields for:
- `l_user`  (user, positions 911-920)
- `l_firm`  (company number, positions 944-946, packed decimal)
- `l_navn`  (name, positions 951-980)

These are probably loaded from some external control record in a real program run, but in this source they are just declared.

---

### **Main Logic**

The primary operation for each file is:

- **Read first record**
- **Loop:**  
  While not EOF:  
    - If this record’s company number = `l_firm`, delete the record.
    - Read next record.

**Example Block:**

```rpg
c     read      rfoblu                                 90
c     dow       *in90 = *off
c     if        rffirm = l_firm
c     delete    rfoblur
c     endif
c     read      rfoblu                                 90
c     enddo
```
- `read rfoblu 90`: Reads a record; sets *IN90 on EOF.
- `dow *IN90 = *off`: Loops while not EOF.
- `if rffirm = l_firm`: Checks if company number matches.
- `delete rfoblur`: Deletes the record.
- `read rfoblu 90`: Read next.
- `enddo`: End of the loop for this file.

This pattern is repeated for each file, but the record format and company field names differ depending on the file.

---

### **File/Section Comments**

Each group of deletes is preceded by a comment (in Norwegian) describing the file or data block, e.g.:
- Fordeling fra budsjett (Budget allocations)
- Hovedboksposteringer (General ledger postings)
- Kunder (Customers)
- Leverandører (Suppliers)
- Inkasso faste data (Collection agency fixed data)
- Resultatrapporter (Report data)
- etc.

---

### **Program End and Subroutines**

At the end:
```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Sets the last record indicator `*INLR` to on, so the program closes all files and ends.

There is an empty subroutine for *inzsr (initialization subroutine). This is standard boilerplate.

---

## **Summary Table: Fields by File**

| File (F-spec) | Company Field | Delete Format |
|---------------|--------------|--------------|
| rfoblu/rfoblur | rffirm      | rfoblur      |
| rforlu/rforlur | rffirm      | rforlur      |
| rfoslu/rfoslur | rffirm      | rfoslur      |
| frhovlu        | rhfirm      | rhovpfr      |
| frhsalu        | rifirm      | rhsapfr      |
| frhtrlu        | rbfirm      | rhtrpfr      |
| frklalu        | rxfirm      | rklapfr      |
| frksalu        | rksafi      | rksapfr      |
| frksolu        | rksfir      | rksopfr      |
| frktrlu        | rnfirm      | rktrpfr      |
| frkunlu        | rkfirm      | rkunpfr      |
| frlbalu        | rvfirm      | rlbapfr      |
| frlsolu        | rlsfir      | rlsopfr      |
| frltrlu        | rofirm      | rltrpfr      |
| frlevlu        | rlfirm      | rlevpfr      |
| frrf0lu        | rr0fir      | rrf0pfr      |
| frrf5lu        | rr5fir      | rrf5pfr      |
| frrf8lu        | rr8fir      | rrf8pfr      |
| frrf9lu        | rr9fir      | rrf9pfr      |
| frzumlu        | rzfirm      | rzumpfr      |
| frca0lu        | rc0fir      | rca0pfr      |
| frcnflu        | rcnfir      | rcnfpfr      |

---

## **Points to Note**

- **No User Interaction:** The program assumes `l_firm` is preset, and no prompting is present.
- **No Error Handling:** If a delete fails, no action is taken.
- **No Referential Integrity Checks:** Does not check relationships between tables; may cause orphaned records if foreign keys were enforced.
- **Old Syntax:** Written in fixed-format RPG, predating modern /free-style RPG.

---

## **Summary**

This program is a “company delete” utility: it purges all data for a supplied company number from a wide range of files. Each loop reads and deletes records matching the company, ensuring the database is clean of that company's data. It follows a repeated pattern: read, check, delete, repeat.

### **Good to Know**
- Make sure you understand the business consequences before running this program: once executed, all data for the company in question will be removed from every file listed.
- Check for backups and proper access before using in production.

---

If you need specifics about any file or section, just ask!