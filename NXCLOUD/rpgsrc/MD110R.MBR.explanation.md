# RPG Program MD110R: Code Explanation and Onboarding Guide

## Overview

This RPG program is named **MD110R** and is used for maintaining "Plukkområde" (picking area) relationships in a warehouse management (lagerstyring) context. The code is written in traditional ILE RPG (fixed-format), using both display files and multiple logical/physical files, and is meant for interactive use with subfiles (records shown in a list to the user).

The code supports standard CRUD (Create, Read, Update, Delete) operations plus copy functionality, subfile paging, and various validation routines. Several data files represent different entities (like warehouse, product groupings, etc.). The program user interface is largely controlled by a subfile display.

The comments and variable names are mostly in Norwegian. Here is a structured guide to help new developers understand the code.

---

## Program Structure

### 1. **Header Section**

- `h option(*nodebugio) datedit(*dmy)`
  - Disables debugging of I/O operations and sets date editing to day/month/year format.

### 2. **File Declarations (`F-specs`)**

- Declares multiple files for input/output, almost all keyed and externally defined (via `e k disk`).
- Most files are renamed to specific record formats for clarity.
- Main display file: `md110d` (with a subfile `b1sfl` and a display file information DS `dspfbk`).

### 3. **Data Structure and Variable Declarations (`D-specs`)**

- **Local Data Area (LDA):** Imports user, firm, and navigation info from LDA.
- **Display Feedback:** Used for tracking display attributes, such as the current record number.
- **Key and Work Variables:** For building file keys and holding current/selected values from the subfile.
- **Control Variables:** For state management (`b_oppr`, `b_forn`, etc.), subfile pointers, and constants.

### 4. **Indicator Usage**

- Standard RPG indicators (LR, *IN10, *IN12-*IN16, etc.) are used for program and screen flow control, field protection, error handling, and screen marker management.

### 5. **Main Processing Flow**

The program is essentially a loop directing control between subroutines based on user actions, with screen handling and subfile lists as the main interaction means.

#### 5.1. **Entry Point / Main Menu Loop**

- **Entry tags:** `b2taga`, `b2tagb`.
- Shows command window, processes user actions.
- If the user requests a function (add, change, copy, delete, view, roll page), the program responds by executing the relevant subroutine.

#### 5.2. **Selection of Actions**

- **Select/When construct**: Handles user function keys (add, change, copy, delete, page forward/back, etc.).
- **Goto** statements: Used for main menu loop control, typical in older RPG code.

#### 5.3. **Subfile Handling**

- **Subroutines:**
  - `subfile`, `clr_subfile` (clear), `crt_subfile` (create/fill), `bck_subfile` (previous page), `dsp_subfile` (display).
- **Paging:** Uses variables for first/last/relative record numbers and handles multi-page subfile lists.
- **Subfile Row Actions:** Add (2), Copy (3), Delete (4), View (5) — user marks a row in subfile and the relevant subroutine is called.

#### 5.4. **CRUD Subroutines**

- **xc1bld:** Handles "Add new record" popup.
- **xc2bld:** Handles "Edit/View" record popup.
- **xd1win:** Handles "Delete" confirmation and execution.
- **xk1win:** Handles "Copy" action popup.
- **xc1msg:** Displays error/info messages (e.g. record already exists).

### 6. **Validation Logic**

- Extensive validation of input fields and combinations before creating/updating records, with feedback via screen indicators.
- Calls out to other programs (e.g., for warehouse, product group, module validation) for lookup and validation.
- Checks for invalid groupings and missing required fields.

### 7. **Integration with Other Programs**

- **CALLs to other RPG programs:** Uses the `CALL 'PROGNAME'` statement and passes parameters to look up or validate fields such as warehouse or product groups.
- **External validation logic/programs:** E.g., `RA510R` (warehouse), `VG510R`, `VG511R`, `VG512R` (over/hoved/under-gruppe), `VV500R` (varenummer), `JU500R` (modulnummer).

---

## Key Concepts and Data Flow

#### **Subfile Management**

- Uses a display subfile (`b1sfl` in `md110d`) to list records.
- Supports:
  - Paging (next/previous page).
  - Selecting a row for edit/copy/delete/view.

#### **Data Structures**

- **Keys for Searching/Updates:**
  - Multiple keylists (`klist`) are defined for use with `CHAIN`, `SETLL`, etc., for each file.
- **Variables:**
  - `b1valg`: Indicates the action selected for a row (change, copy, delete, view).
  - `b1olag`, `b1oogr`, etc.: Represents the current row's keys (lag, overgruppe, hovedgruppe, undergruppe, modul, vare).
  - `c1*`, `k1*`, `d1*` variables: Hold values for respective pop-ups or operations.

#### **State and Error Handling**

- Uses boolean variables to track errors (`b_feil`) and states such as "add mode", "refresh needed", etc.
- Screen indicators (`*INxx`) control error messages, field protection, and display logic.

#### **External Data Access**

- Files represent master data (lager, overgruppe, undergruppe, modul, etc.) and are accessed via keyed operations for validation and to fetch description texts.

---

## Onboarding Tips

- **Understand the Subfile Pattern:** This code is a classic example of RPG subfile processing. Learn how subfile screens and record selection work.
- **Indicator Management:** Note how indicators manage flow, field protection, and error signaling.
- **Validation and Lookup:** Much data validation is handled by calling other programs.
- **Error Handling:** Errors are signaled by setting indicators, and the display is updated accordingly.
- **Legacy Structure:** The code is written in fixed-format RPG IV; consider the different "tags" and heavy use of GOTO in the flow, which is typical for the era.

---

## Summary Table of Important Elements

| Element         | Description                                              |
|-----------------|---------------------------------------------------------|
| `b1sfl`         | Main subfile for listing and editing records            |
| `b2ctl`, `b2cmd`| Control and command records for subfile display         |
| `xc1bld`, `xc2bld`| Subroutines for add/edit screens                      |
| `*INxx`         | Indicators for field protection, errors, etc.           |
| `CHAIN`, `SETLL`, `READ`, `READP`| File access/positioning operations    |
| `CALL 'PROG'`   | Calls to external programs for validation/lookups       |
| Keylists (`klist`)| Composite keys for data file access                   |
| `w_srrn`, `w_ssrn`, etc.| Variables for subfile record tracking           |

---

## Example Control Flow

1. Program initializes, fills the subfile with records.
2. User interacts via the subfile (select, function keys).
3. Depending on the action:
   - Relevant input/confirmation screen is shown.
   - Validation occurs (directly or via external calls).
   - File operations (`CHAIN`, `WRITE`, `UPDATE`, `DELETE`) are performed.
4. Subfile is refreshed as needed.
5. Program waits for further actions or exits on command.

---

## Conclusion

This program is a good example of interactive maintenance applications on IBM i, using RPG fixed-format techniques, subfiles, and a modular validation approach. Understanding the subfile pattern, indicator system, and the use of external validation routines is key to maintaining and extending this program.

If you are new to RPG, focus first on mastering display file handling (subfiles), file operations (`CHAIN`, `READ`, etc.), indicator usage, and subroutine/flow control.

If you need to add new fields, actions, or validations, follow the existing structure—define variables, add logic to subroutines, and ensure proper screen and database validation. Most business rules are enforced using indicator-driven logic and external program calls.