# Explanation of the IBM ILE RPG Program

This RPG (Report Program Generator) program is written for IBM i (AS/400) and is intended for reporting missing or matching order/invoice numbers. Below, the program's structure and logic are explained step by step, following its source layout.

---

## 1. Header Section

```rpg
H/TITLE            : Utskrift av manglende/matchende ordre/fakturanr.
H decedit('0,') dftname(fs244) datedit(*dmy.)
```
- **Program Title:** "Printout of missing/matching order/invoice numbers" (in Norwegian).
- **decedit/datedit:** Formatting for decimal and date fields.
- **dftname:** Default program name.

Documentation lines provide change logs, author, description, etc.

---

## 2. File Specifications

```rpg
Fskwwpf    if   e           k disk
Fliste     o    f  132        printer oflind(*inof)
```
- **skwwpf:** Input file, keyed, externally described.
- **liste:** Output file, printer, line width of 132, overflow indicator *INOF.

---

## 3. Table (Array) Declarations

```rpg
D txt             s             70    dim(6) ctdata perrcd(1)              
```
- **txt:** Array of 6 lines for header texts, each 70 characters, loaded from compile-time data.

---

## 4. Work Fields

A variety of `D`-specs for temporary storage:
- **fstanr/stanr1/stanr2/diff/fra/til:** Numeric fields for storing and comparing order/invoice numbers.
- **h1txt/h2txt:** Header text fields (one line each).
- **kodkey/linjer/subår/subdag/wwdato/l3bida:** Miscellaneous counters, date, or key info.

**Field overlays:** These use positional definitions to map incoming data to named variables (from local data).

Example:
```rpg
D pakode                300    301
D pakod1                300    300
D pakod2                301    301
D paofra                302    309  0
D paotil                310    317  0
...
```
- These extract parameters from the program parameter area for use as control data.

---

## 5. Main Calculation Section

### Main Processing Loop

```rpg
C     start         tag
...
C                   read      skwwpfr                                60
...
C                   if        *in60 = *on
C                   goto      slutt
...
C                   goto      start
```

- **start / slutt tags**: The main processing loop starts at `start` and ends at `slutt` for program exit.
- **Read Input Record:** Reads the next record from the input file `skwwpf`. If EOF (`*IN60`), jumps to `slutt`.

### Processing Logic

- **Order/Invoice Number Handling:** 
  - Depending on code in `pakod1`, decide which field is order or invoice number.
  - Assign `stanr1`/`stanr2` accordingly.
- **Range Test:** 
  - If `stanr1 > paotil`, exit loop.
- **Duplicate Check:** 
  - If `stanr1 = fstanr` (same as previous), skip processing (goto start).

### Missing Numbers Check

```rpg
C                   eval      diff = stanr1 - fstanr
C                   if        diff > 1
C                   eval      fra = fstanr + 1
C                   eval      til = stanr1 - 1
...
C                   except    linje2
C                   except    linje1
C                   eval      linjer = linjer + 1
```
- **If a gap (`diff > 1`) exists between current and previous number:** 
  - Print the missing range using `except linje2` and `except linje1`.
- **Print matching record if applicable:** 
  - If param code is match (`pakod2 = 'M'`), output detail via `except linje3`.

### Page Break Management

```rpg
C                   if        linjer = 40
C                   except    head1
C                   eval      linjer = 0
```
- **Header Reprinting:** After 40 lines, prints the header again.

---

## 6. Initialization Subroutine (`*INZSR`)

```rpg
C     *inzsr        begsr
...
C                   eval      fstanr = 0
C                   eval      fra = 0
C                   eval      til = 0
C                   eval      diff = 0
C                   eval      linjer = 0
C                   eval      h1txt = *blanks
C                   eval      h2txt = *blanks
...
C                   movel     txt(n)        h1txt/h2txt
...
C                   move      paofra        stanr1
...
C                   except    head1
C                   endsr
```
- **Field Initialization:** Resets key variables.
- **Header Text:** Depending on parameter code, selects the appropriate header lines from the `txt` array.
- **Initial Header Output:** Outputs the first header before listing.

---

## 7. Output Section

Outputs are written to the printer file `liste` using O-specs and exception lines:

- **head1:** Full page header, including company, title, and parameter info.
- **linje1/linje2:** Shows missing number ranges.
- **linje3:** Detail line for a match, showing numbers, date, customer info, etc.

---

## 8. Compile-Time Array Data

At the end there is embedded compile-time data for the `txt` array:
```
   Ordrenr. mangler
   Ordrenr. matcher
   Fakturanr. mangler
   Fakturanr. matcher
   Ordrenr.                       Fakt./Kred.nr.
   Fakt./Kred.nr.                   Ordrenr.
```
- These are the various lines used for report headers, depending on the report type.

---

# **Summary of the Program's Purpose**

The program generates a report to list missing or matching order/invoice numbers for a given company and period, based on parameters. It prints ranges where numbers are missing and details of matches, with dynamic headers and page breaks.

# **Entry Points for New Developers**

- **Input File:** `skwwpf` contains the order/invoice records.
- **Key Variables:** `stanr1`, `stanr2`, `fstanr`, `fra`, `til` manage order/invoice number logic.
- **Parameter Handling:** Controlled by overlay fields like `pakode`, `paofra`, etc.
- **Output:** Via O-specifications to the `liste` printer file, with different EXCEPT lines for headers and details.
- **Control Flow:** Main loop at `start`, ends at `slutt`, initialization via `*INZSR` subroutine.
- **Customizable Headers:** Driven by the parameter code and the `txt` compile-time array.

---

**In summary:**  
This RPG program is a well-commented legacy report utility, listing missing and matching order or invoice numbers. It’s modular, using parameters for flexibility, and outputs formatted report pages suitable for business auditing or reconciliation tasks. The main points of maintenance or extension would be in the input file definition, parameter input mapping, and output formatting.