     h datedit(*dmy.) option(*nodebugio)
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      * System. . . . . : ASOKON                                              *
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *       270319 nho  Mamut
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     fbqvwl1    if   e           k disk    rename(bqvwpfr:bqvwl1r)
     fra01l1    if   e           k disk    rename(ra01pfr:ra01l1r)
     fbovfut    o    e             disk    rename(bovfutr:bovfutl)
      *
     d w_belØ          s                   like(bfbelp)
     d w_belp          s                   like(bfbelp)
     d w_tell          s              1  0
      *
610  d bqvwl1_firm     s                   like(bffirm)
610  d bqvwl1_bdat     s                   like(bfbdat)
610  d bqvwl1_dkto     s                   like(bfdkto)
610  d bqvwl1_ckto     s                   like(bfckto)
610  d bqvwl1_bilk     s                   like(bfbilk)
     d bqvwl1_dbkr     s                   like(bfdbkr)
     d ra01l1_firm     s                   like(raafir)
     d ra01l1_akod     s                   like(raakod)
610   *
610  d w_bdat          s                   like(bfbdat)
610  d w_dkto          s                   like(bfdkto)
610  d w_ckto          s                   like(bfckto)
610  d w_bilk          s                   like(bfbilk)
610  d w_dbkr          s                   like(bfdbkr)
610   *
610  d x_dato          s                   like(bfbdat)
610  d x_kond          s                   like(bfdkto)
610  d x_konc          s                   like(bfckto)
610  d x_bilk          s                   like(bfbilk)
610  d x_dbkr          s                   like(bfdbkr)
6.11 d                uds
6.11 d l_user                911    920
6.11 d l_firm                944    946  0
      *
      *
      * Key for fordelings-parametre
610  c     bqvwl1_key    klist
610  c                   kfld                    bqvwl1_firm
610  c                   kfld                    bqvwl1_bdat
610  c                   kfld                    bqvwl1_dbkr
610  c                   kfld                    bqvwl1_dkto
610  c                   kfld                    bqvwl1_ckto
610  c                   kfld                    bqvwl1_bilk
      * Key for posisjonering på bilagskode
      *
     c     ra01l1_key    klist
     c                   kfld                    ra01l1_firm
     c                   kfld                    ra01l1_akod
      *
      /eject
610  c                   eval      ra01l1_firm = l_firm
      *
610  c                   eval      bqvwl1_firm = l_firm
610  c*                  eval      bqvwl1_bdat = *zero
6.10 c                   eval      bqvwl1_dkto = *zero
6.10 c                   eval      bqvwl1_ckto = *zero
6.10 c                   eval      bqvwl1_bilk = *zero
6.10 c                   eval      bqvwl1_dbkr = *blank
      *
610  c     bqvwl1_key    setll     bqvwl1
610   **********************************************************************
     c     nyles         tag
610   *
610  c                   read      bqvwl1                                 15
610   *
     c                   eval      w_belp = bfbelp
610   * Eof
610  c                   if        *in15  = '1'
610  c                   move      *on           *inlr
610  c                   goto      ut
610  c                   endif
      *
      * Test på inneværend firma
      *
     c                   if        bqvwl1_firm <> bffirm
610  c                   move      *on           *inlr
610  c                   goto      ut
610  c                   endif
610   *
      * Ta vare på brudd første gang
610  c                   if        w_tell = 0
     c                   eval      w_bdat = bfbdat
     c                   eval      w_dkto = bfdkto
     c                   eval      w_ckto = bfckto
     c                   eval      w_bilk = bfbilk
     c                   eval      w_dbkr = bfdbkr
610  c                   eval      w_tell = 1
     c                   eval      x_dato = bfbdat
     c                   eval      x_kond = bfdkto
     c                   eval      x_konc = bfckto
     c                   eval      x_bilk = bfbilk
     c                   eval      x_dbkr = bfdbkr
610  c                   endif
6.10  *
      * Sjekk om brudd på bilagsdato
     c
6.10 c                   if        w_bdat <>  bfbdat
610  c                   eval      x_bilk = bfbilk
610  c                   eval      x_kond = bfdkto
610  c                   eval      x_konc = bfckto
610  c                   eval      x_dato = bfbdat
610  c                   eval      x_dbkr = bfdbkr
      *
610  c                   readp     bqvwl1                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
      *
     c                   eval      bfbelp =  w_belØ
     c                   write     bovfutl
610  c                   read      bqvwl1                                 15
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
      *
     c                   eval      bfdbkr = x_dbkr
     c                   eval      w_dbkr = bfdbkr
     c                   eval      bfbilk = x_bilk
     c                   eval      w_bilk = bfbilk
     c                   eval      bfdkto = x_kond
     c                   eval      w_dkto = bfdkto
     c                   eval      bfckto = x_konc
     c                   eval      w_ckto = bfckto
     c                   eval      bfbdat = x_dato
     c                   eval      w_bdat = bfbdat
      *
     c                   eval      w_bdat = bfbdat
     c                   eval      w_dkto = bfdkto
     c                   eval      w_ckto = bfckto
     c                   eval      w_bilk = bfbilk
     c                   eval      w_dbkr = bfdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
610   *
      * Sjekk om brudd på Debet/Kredit
     c
6.10 c                   if        w_dbkr <>  bfdbkr
610  c                   eval      x_dbkr = bfdbkr
610  c                   eval      x_bilk = bfbilk
610  c                   eval      x_kond = bfdkto
610  c                   eval      x_konc = bfckto
610  c                   readp     bqvwl1                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
     c                   eval      bfbelp =  w_belØ
     c                   write     bovfutl
610  c                   read      bqvwl1                                 15
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
     c                   eval      bfdbkr = x_dbkr
     c                   eval      w_dbkr = bfdbkr
     c                   eval      w_dkto = bfdkto
     c                   eval      w_ckto = bfckto
     c                   eval      w_bilk = bfbilk
     c                   goto      nyles
6.10 c                   endif
610   *
      * Sjekk om brudd på konto /debet
     c
6.10 c                   if        w_dkto <>  bfdkto
610  c                   eval      x_dbkr = bfdbkr
610  c                   eval      x_bilk = bfbilk
610  c                   eval      x_kond = bfdkto
610  c                   eval      x_konc = bfckto
      *
610  c                   readp     bqvwl1                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
      *
     c                   eval      bfbelp =  w_belØ
     c                   write     bovfutl
610  c                   read      bqvwl1                                 15
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
      *
     c                   eval      bfdbkr = x_dbkr
     c                   eval      w_dbkr = bfdbkr
     c                   eval      bfbilk = x_bilk
     c                   eval      w_bilk = bfbilk
     c                   eval      bfdkto = x_kond
     c                   eval      w_dkto = bfdkto
     c                   eval      bfckto = x_konc
     c                   eval      w_ckto = bfckto
      *
     c                   eval      w_dkto = bfdkto
     c                   eval      w_ckto = bfckto
     c                   eval      w_bilk = bfbilk
     c                   eval      w_dbkr = bfdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
610   *
      * Sjekk om brudd på konto /kredit
     c
6.10 c                   if        w_ckto <>  bfckto
610  c                   eval      x_dbkr = bfdbkr
610  c                   eval      x_bilk = bfbilk
610  c                   eval      x_kond = bfdkto
610  c                   eval      x_konc = bfckto
      *
610  c                   readp     bqvwl1                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
      *
     c                   eval      bfbelp =  w_belØ
     c                   write     bovfutl
610  c                   read      bqvwl1                                 15
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
      *
     c                   eval      bfdbkr = x_dbkr
     c                   eval      w_dbkr = bfdbkr
     c                   eval      bfbilk = x_bilk
     c                   eval      w_bilk = bfbilk
     c                   eval      bfdkto = x_kond
     c                   eval      w_dkto = bfdkto
     c                   eval      bfckto = x_konc
     c                   eval      w_ckto = bfckto
      *
     c                   eval      w_dkto = bfdkto
     c                   eval      w_ckto = bfckto
     c                   eval      w_bilk = bfbilk
     c                   eval      w_dbkr = bfdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
610   *
      * Sjekk om brudd på bilagskode
     c
6.10 c                   if        w_bilk <>  bfbilk
610  c                   eval      x_bilk = bfbilk
610  c                   eval      x_dbkr = bfdbkr
610  c                   readp     bqvwl1                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
     c                   eval      bfbelp =  w_belØ
     c                   write     bovfutl
610  c                   read      bqvwl1                                 15
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
     c                   eval      bfbilk = x_bilk
     c                   eval      w_bilk = bfbilk
     c                   eval      bfdbkr = x_dbkr
     c                   eval      w_dbkr = bfdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
     c                   add       bfbelp        w_belØ
      *
      ******************************************************
      *  AVSLUTT DENNE TRANS                               *
      ******************************************************
      *
     c     ut            tag
610  c                   if        *inlr = '0'
610  c                   goto      nyles
610  c                   endif
      *
     c                   if        *inlr  =  '1'   and
     c                             w_belØ > 0
610  c                   readp     bqvwl1                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
     c                   eval      bfbelp =  w_belØ
     c                   write     bovfutl
610  c                   endif
      *
     c/eject
      *
