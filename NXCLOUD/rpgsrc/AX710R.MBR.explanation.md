# Explanation of the RPG Source Code

This ILE RPG program calculates the starting (Monday) and ending (Sunday) dates for a given ISO year and week number, returning them along with a status indicator. The code follows the ISO 8601 week date standard, where the first week of the year is the one containing January 4th, and weeks run Monday to Sunday.

---

## High-Level Overview

**Purpose:**  
Given an ISO year (`p_aarr`) and week number (`p_week`):
- Return the start date (`p_fdat`) - Monday of the week.
- Return the end date (`p_tdat`) - Sunday of the week.
- Return status (`p_stat`) to indicate errors or success.

---

## Input/Output Parameters

- `p_aarr` (4,0) - Input: Year (e.g., 2024)
- `p_week` (2,0) - Input: ISO week number (1-53)
- `p_fdat` (date) - Output: Start date (Monday)
- `p_tdat` (date) - Output: End date (Sunday)
- `p_stat` (1) - Output: Status ('0' = OK, '1' = Error)

---

## Important Working Variables

- `w_monday` - Constant date for Monday before ISO week 1 base (initialized to 2001-12-31, known Monday)
- `w_mon1` - Monday date for week 1 of given year
- `w_monw` - Monday date for requested week
- `w_sunw` - Sunday date for requested week
- Other vars support date manipulation, day-of-week calculation, etc.

---

## Main Program Logic

### 1. Parameter Validation

```rpg
if  p_aarr < 1 or p_week < 1 or p_week > 53
    p_stat = '1'
    goto avslutt
endif
```
- Checks if year or week is out of range (invalid).
- Sets `p_stat` to '1' (error), and exits.

---

### 2. Determine January 4th of the given year

- Builds a date string for January 4th of year `p_aarr` (`w_wdat`).
- Does a similar setup for Jan 4th of the year after (`w_wdtn`).
- These are used per ISO 8601 to find week 1.

---

### 3. Find Day of Week for January 4th

```rpg
w_wday = %diff(w_wdat:w_monday:*days)
div 7 w_wday
mvr w_wday
w_wday = w_wday + 1
if w_wday <= 0
   w_wday = w_wday + 7
endif
```
- Calculates how many days from the base Monday (2001-12-31) to Jan 4th; finds the weekday number (Monday=1).
- This is used to find which day of the week January 4th is.

---

### 4. Find Monday of Week 1

- If Jan 4th is a Monday, week 1 starts Jan 4th.
- Otherwise, back-calculate to the previous Monday.

```rpg
if w_wday = 1
    w_mon1 = w_wdat
else
    w_wday = w_wday - 1
    w_mon1 = w_wdat - w_wday days
endif
```

---

### 5. Find Monday of Requested Week

```rpg
w_wddw = (p_week - 1) * 7
w_monw = w_mon1 + w_wddw days
```
- Adds 0 for week 1, 7 for week 2, etc., to the Monday of week 1.

---

### 6. Find Sunday of Requested Week

```rpg
w_sunw = w_monw + 6 days
```

---

### 7. Set Output Parameters

```rpg
p_fdat = w_monw
p_tdat = w_sunw
p_stat = '0'
```

---

### 8. Special Handling for Week 53

```rpg
if p_week = 53
    if p_tdat >= w_wdtn
        p_aarr = p_aarr + 1
        p_week = 1
    endif
endif
```
- Not every year has a week 53. If the calculated Sunday falls past Jan 4th of next year (week 1 next year), it means week 53 is invalid and is replaced with week 1 of the next year.

---

### 9. Program End

- Tagged `avslutt` label for program completion.
- Sets LR indicator on to exit.

---

## Initialization Subroutine (`*inzsr`)

This subroutine runs at program start:
- Associates input/output parameters with internal variables (`*entry plist`).
- Initializes `p_stat`, `p_fdat`, `p_tdat`.

---

## Indicators (Comment Section)

- Classic RPG indicators are referenced (e.g., LR, 10-99), but not used in logic here.

---

## Summary Table

| Variable   | In/Out | Type     | Purpose                                     |
|------------|--------|----------|---------------------------------------------|
| p_aarr     | In/Out | 4,0      | ISO Year                                   |
| p_week     | In/Out | 2,0      | ISO Week number (1-53)                     |
| p_fdat     | Out    | date     | Start date (Monday) of the week            |
| p_tdat     | Out    | date     | End date (Sunday) of the week              |
| p_stat     | Out    | 1-char   | Status ('0' = OK, '1' = invalid input)     |

---

## ISO Week Date Standard

- Week 1: The week containing January 4th.
- Weeks start Monday, end Sunday.

---

## Practical Usage

- **Call with (year, week):** Returns Monday and Sunday dates, checks for invalid input.
- **Handles week 53 edge cases** per ISO standard.

---

## Example

Given: `p_aarr = 2024`, `p_week = 1`

- Program calculates
  - `p_fdat` = 2024-01-01 (Monday)
  - `p_tdat` = 2024-01-07 (Sunday)
  - `p_stat` = '0' (OK)

---

## Takeaways

- The routine is robust for typical business usage (reports, payroll).
- ISO-compliant week computations.
- Handles boundary and error conditions gracefully.
- Easy to integrate into larger applications as a date utility.