# ILE RPG Program Explanation: LE280R

This RPG program is a classic “green screen” interactive application, used for gathering parameters and validating criteria for a historical inventory printout ("utskrift av historisk lagerbok - parameter"). The code is mostly written in RPG/400 or RPG III-style, not fully in free-format. Let's break down the core components, sections, and their logic.

---

## 1. Header and Program Description

```rpg
h datedit(*dmy) option(*nodebugio)
* Program . . . . : LE280R
* Beskrivelse . . : Utskrift av historisk lagerbok - parameter
* Referanse  Dato   Endringsbeskrivelse                      Sign.
* 7.00 190516  bsa  Endringer reltart til ny GUI. ...
```

- **`h datedit(*dmy)`**: Specifies that the date edit pattern is day/month/year.
- **`option(*nodebugio)`**: Disables debug on I/O operations.
- **Comments**: Describe the program's purpose, versioning, and change history.

---

## 2. Indicators Reference

```rpg
*   KA = F1  = Valg av firma
*   KC = F3  = Exit
*   LR = Avslutt program
*   30 = Protect av felter ved vise
*31-59 = Varsle m/feilmeldinger/skjermindikatorer (errors/screen)
*60-69 = Fileindikatorer chain etc.
*70-79 = Arbeidsindikatorer i sub-rutiner
...
```

- **Indicators**: Used to signal different program states or results (e.g., key pressed, error detected, protect field).

---

## 3. File Declarations

```rpg
fll635d    cf   e             workstn
```

- **`ll635d`**: A display device file (workstation) for screen interaction.

---

## 4. Data Definitions

### A. User Data Space (UDS)
```rpg
d                uds
d lcfvar                300    314
d lctvar                        15
d lcflag                         2  0
...
```
- **UDS**: User data storage area for passing parameters or sharing state between program and display.
- **Variables**: Various fields represent ranges and flags for parameters such as warehouse (`lager`), group, date, sorting, etc.
- **Example**: `lcfdat` and `lctdat` are from- and to-dates in *ISO format.

### B. Working Storage
```rpg
d wpin03          s              1  0
d w_firm          s              3  0
...
```
- **Work variables**: For internal, temporary values.

---

## 5. Main Control Flow

### A. Initialization (`*inzsr` Subroutine)
```rpg
c     *inzsr        begsr
c                   eval      a1fvar = *zeros
c                   movel     '99999999'    a1tvar
c                   eval      a1flag = *zeros
...
c                   parm                    wpin03
c                   endsr
```
- **Purpose**: Sets all screen and internal fields to standard, default values.

### B. Entry Point and Main Screen Handling

```rpg
c     a1taga        tag
c                   exfmt     a1bld
```
- **Main loop label**: `a1taga`
- **`exfmt a1bld`**: Display and edit the screen format `a1bld` (entry of parameters). Waits for user input.

#### Key Actions
- **Exit on F3**: If `*inkc` (indicator for F3) is on, set flag, jump to end.
- **Validate Input Ranges**: Check that "from" fields are not greater than "to" fields for different fields (ex: variables, warehouse, group, etc.).
- **Validate Dates**: Test if entered dates are valid and in correct order.
- **Check Codes**: Validate that type- or system-codes are allowed values.
- **On invalid input**: Set corresponding indicator, return to input screen for correction.

#### Example Validation Logic
```rpg
c                   if        a1fvar > a1tvar
c                   move      *on           *in30
c                   goto      a1taga
c                   endif
```
- If "from" variable (`a1fvar`) > "to" variable (`a1tvar`), set error indicator 30 and return to input.

#### Calling Subroutines for Lookups
```rpg
c                   exsr      sblagr
```
- Calls the `sblagr` subroutine to check if a warehouse exists in the code register.

---

## 6. Parameter Transfer

```rpg
c                   movel     a1fvar        lcfvar
c                   movel     a1tvar        lctvar
...
```
- **Moves validated screen fields to local data area** for use in other program sections or called programs.

---

## 7. Exit Point

```rpg
c     xslutt        tag
c                   eval      *inlr = *on
c                   return
```
- **Program termination**: Set last record indicator on, return to caller.

---

## 8. Subroutines

### `sblagr` - Warehouse Name Lookup
```rpg
c     sblagr        begsr
c                   call      'RS710R'
c                   parm                    w_retk
c                   parm                    w_lage
c                   parm                    w_jtxt
c                   endsr
```
- Calls an external program (`RS710R`) to verify and possibly retrieve warehouse data, passing working variables as parameters.

---

## 9. Typical User Flow

1. **Program starts** and fields are initialized.
2. **Parameter entry screen (`a1bld`) displayed**. User enters criteria for the report.
3. **User presses Enter**.
    - **Validations occur**: If invalid, error indicator is set and screen is re-displayed.
    - **If user presses F3** (Exit), program ends.
4. **On successful entry**, parameters are transferred for downstream use and the program ends.

---

## 10. Summary Table

| Section      | Purpose                                    |
|--------------|--------------------------------------------|
| Header       | Program metadata and edit options          |
| Indicators   | Describes use of various indicators        |
| Files        | Declares display file                      |
| Data         | Stores parameters, temporary state         |
| Init         | Sets default field values                  |
| Main Loop    | Handles screen, input, and validation      |
| Error checks | Range, code, and date validations          |
| Subroutines  | Code lookup, parameter transfer            |
| Exit         | Clean program end                          |

---

## 11. Key Concepts

- **Screen Input**: Using a display file, shows parameter input screen and retrieves user data.
- **Validation**: Ensures logical and allowed input (ranges, dates, codes).
- **Indicators**: Signal error conditions and program flow.
- **Subroutines & Calls**: For modular logic and external lookups.
- **Parameter Passing**: Moves validated entries to a user data area.

---

## 12. Onboarding Note

- This code is representative of classic IBM i (AS/400) RPG. You’ll often encounter indicator-driven logic, *inLR for end of program, and interaction with green-screen displays.
- The `UDS` storage allows for fields to be shared across programs, often to communicate with CL or other RPG programs.
- For further analysis, check the DDS for the display file (`ll635d`), and the definition of external program `RS710R`. 

**This program is a typical parameter entry and validation “front-end” for a report—easy to maintain as long as you respect the indicator and variable conventions established in the comments.**