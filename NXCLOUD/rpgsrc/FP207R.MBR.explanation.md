# FP207R – Printer Type Retrieval Program

## Overview

**Program:** FP207R  
**System:** ASOFAK  
**Purpose:**  
This program retrieves the printer type for a given device from the device register (`ENH` file, externally described as `Faenhl1`). The printer type is returned as a numeric code, with each code corresponding to a specific printer model or category.

## Business/Domain Logic

The mapping of printer type codes is as follows:

| Code | Printer Type           | Description             |
|------|-----------------------|-------------------------|
| 0    | Meto 8100 Twinax      | Twinax model            |
| 1    | Meto 8100 Standard    | Standard model          |
| 2    | Meto Bandit           | Bandit model            |
| 3    | Utgått                | Discontinued            |
| 4    | Meto mi-4/6           | mi-4/6 model            |
| 5    | Zebra QL320           | Zebra QL320 printer     |
| 6    | Datamax Ex-2 (Default)| Default if not found    |

The codes are maintained in the field `LCSKTY` (local variable `lctype`).

## Structure and Data Flow

### File Declaration

- **Faenhl1**  
  - Declared as a keyed, externally-described disk file.
  - Represents the device register (enhetsregister), which contains device/printer information.

### Key Fields and Variables

- **lcruti**:  
  - Input field, positions 810–819, used as the device/printer ID to look up.
- **lctype**:  
  - Output field, position 891, holds the printer type code.
- **aenhl1_prid**:  
  - Local variable, same type as the file's key field (`aeprid`), used to hold the lookup key.

### Main Logic

1. **Prepare Key:**  
   - The input device ID (`lcruti`) is moved into the key variable (`aenhl1_prid`).

2. **File Lookup:**  
   - A keyed CHAIN operation is performed on `Faenhl1` using `aenhl1_prid`.
   - If a matching record is found:
     - The printer type (`aetype` field from the file) is moved into `lctype`.
   - If no record is found:
     - `lctype` is set to 6 (Datamax Ex-2), which acts as the default/fallback printer type.

3. **Program End:**  
   - `*INLR` is set to `*ON` to indicate program end and close files.

### Initialization Subroutine (`*INZSR`)

- Sets up the key list (`aenhl1_key`) for the device register file.
- This is a standard pattern in this codebase: keys are explicitly set up in the initialization subroutine to ensure correct keying for file operations.

## Notable Design Decisions & Conventions

- **Defaulting Behavior:**  
  If the requested device/printer is not found in the device register, the program defaults the printer type to 6 (Datamax Ex-2). This is a business rule, likely reflecting that this is the most generic or compatible model.

- **Explicit Key Handling:**  
  Keys for file access are explicitly defined and initialized in the `*INZSR` subroutine, which is a convention in this codebase for clarity and maintainability.

- **Minimal Error Handling:**  
  The program only distinguishes between found/not found for the device. No further error handling or logging is present, which is typical for simple lookup utilities in this system.

## Integration Points

- **Device Register (`Faenhl1`):**  
  The program relies entirely on the device register for printer information. Any changes to the structure or content of this file will directly affect the program's behavior.

- **Calling Context:**  
  The program is typically called from other modules that need to determine the printer type for a device, possibly as part of print job preparation or device management workflows.

## Maintenance Notes

- **Printer Type Expansion:**  
  If new printer types are introduced, update the mapping table and ensure the `lctype` handling reflects the new codes.
- **File Field Names:**  
  The program expects certain field names (`aetype`, `aeprid`) and positions. Changes to the file definition must be coordinated with this program.

## Revision History (from header)

- **V5.60 210109 KOB:** Updated printer type information.
- **K000 220520 BSA:** Added default value if the printer type is not found (sets to 6).

---

**Summary:**  
FP207R is a utility program that looks up the printer type for a given device from the device register. It provides a default value when the device is not found, supporting robust downstream processing that depends on printer type information. The program follows established conventions for file access and initialization in this codebase.