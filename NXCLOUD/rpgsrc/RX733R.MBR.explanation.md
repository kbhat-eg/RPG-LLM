# RX733R Program Documentation

## Overview

**System:** ASOKON  
**Program:** RX733R  
**Description:** Resets the factoring date field for customer postings.  
**Versioning:**  
- Initial version: 2014-04-05 (KOB)  
- V6.10: 2022-09-09 (BSA) - Added tracking fields (sporingsfelter)

This program operates on the `RKTRLU` (renamed from `RKTRPFR`) physical file, updating records for a specific firm by resetting the factoring date and updating audit/tracking fields.

---

## File Definitions

```rpg
frktrlu    uf   e           k disk    rename(rktrpfr:rktrlur)
```
- **RKTRLU**: Customer postings file, renamed from `RKTRPFR` to `RKTRLUR` in the program.
- **Type:** Update-capable, keyed file.

---

## Data Area and Local Variables

The program extracts information from the *Local Data Area* (LDA):

- **l_user (911-920):** User ID executing the program.
- **l_firm (944-946):** Firm number (packed decimal, 3 digits).
- **l_navn (951-980):** User name (not used in logic).

Local variables:
- **w_firm:** Working variable for firm, same type as `rnfirm` (firm number).
- **rktrlu_firm:** Used as key value for file access, also like `rnfirm`.

---

## Main Logic

### 1. Initialization

- The program starts by assigning the firm number from LDA (`l_firm`) to the local key variable (`rktrlu_firm`).

### 2. File Processing Loop

- A keyed read is performed on `RKTRLU` using `rktrlu_key` (see subroutine for key definition).
- The program enters a loop, processing all records for the specified firm.

#### For Each Record:

- **Factoring Date (`rnfada`):** Set to *LOVAL* (lowest possible value, i.e., reset).
- **Tracking Fields** (added in V6.10):
  - **rnedat:** Set to current date (system time).
  - **rnetim:** Set to current time (system time).
  - **rneusr:** Set to current user (from LDA).
- The record is updated in the file.

- The loop continues until no more records are found for the firm (`*in91 = *on`).

### 3. Program End

- Standard RPG logic to end the program: set LR indicator on and return.

---

## Key List Definition (`*INZSR` Subroutine)

- The key for reading records is built using the local variable `rktrlu_firm`.
- This restricts processing to records for the current firm only.

---

## Business/Domain-Specific Logic

- **Factoring Date Reset:** The main business purpose is to reset the factoring date (`rnfada`) for all customer postings belonging to the firm specified in the LDA.
- **Audit/Tracking:** As of V6.10, each updated record logs the date, time, and user performing the update for traceability.
- **Firm Isolation:** All operations are scoped to a single firm, preventing cross-firm data updates.

---

## Conventions and Design Notes

- **File Renaming:** The program uses the `rename` keyword to distinguish between the external file name (`RKTRPFR`) and the program-internal name (`RKTRLUR`).
- **LDA Usage:** The program relies on LDA for runtime context (firm and user), a common pattern in legacy AS/400 applications.
- **Indicator 91:** Used for EOF on keyed read operations; this is a local convention for controlling read loops.
- **No Parameter Passing:** All context is implicit via LDA, not via *ENTRY parameters.

---

## External Dependencies

- **RKTRPFR/RKTRLU:** The physical file containing customer postings.
- **LDA:** Must be pre-populated by the calling environment with the correct user and firm information.

---

## Integration Points

- This program is likely called as part of a batch or maintenance process to clear factoring dates, possibly in response to business events or corrections.
- The audit fields (`rnedat`, `rnetim`, `rneusr`) may be referenced by other programs or audit/reporting tools for tracking changes.

---

## Summary

**RX733R** is a utility program for resetting the factoring date on customer postings for a specific firm, updating tracking fields for audit purposes. It operates on a single file and is driven by firm and user data from the LDA. The design prioritizes batch processing, auditability, and firm-level data isolation.