      /TITLE  ASOKON: Kontroll av sist brukte leverandørnummer
     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  System. . . . . : ASOKON                                       *
      *  Program . . . . : RS002R                                       *
      *  Beskrivelse . . : Henter sist brukte  leverandørnummer         *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Spesialversjon. :                                              *
      *  Tilpasset for . :                                              *
      *                                                                 *
      *  Referanse  Dato   Endringsbeskrivelse                     Sign.*
      *  --------- ------  ---------------------------------------------*
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     fraa4l1    if   e           k disk    rename(raa4pfr:raa4l1r)
     fraa4lu    uf   e           k disk    rename(raa4pfr:raa4lur)
     fraa1l1    if   e           k disk    rename(raa1pfr:raa1l1r)
     frlevlr    if   e           k disk    rename(rlevpfr:rlevlrr)
      *
     d p_retk          s              1
     d p_4lnr          s                   like(ra4lnr)
     d w_firm          s                   like(ra4fir)
     d w_test          s                   like(p_retk)
     d w_4lnr          s                   like(ra4lnr)
     d w_levr          s                   like(rllevr)
      *
     d rlevlr_levr     s                   like(rllevr)
     d raa4l1_4aar     s                   like(ra4aar)
     d raa4lu_4aar     s                   like(ra4aar)
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Hent sist brukte leverandørnummer fra koderegister             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c                   move      p_retk        w_test
     c                   eval      p_retk = *blank
      *
     c                   eval      raa4l1_4aar = 0                                           .
     c     raa4l1_key    chain     raa4l1r                            90
      *
      * Nei: Legger inn kode for ikke funnet
      *
     c                   if        *in90 = *on                                           .....
     c                   move      'N'           p_retk                                      .
     c                   goto      xslutt                                                    .
     c                   endif                                                           .....
      *
      * Ja:  Oppdaterer sist brukte nummer
      *
     c                   if        w_test = *blank                                       .....
     c                   eval      w_4lnr = ra4lnr + 1                                       .
     c                   endif                                                           .....
      *
     c                   if        w_test = 'S'                                          .....
     c                             and p_4lnr = ra4lnr                                       .
     c                   eval      w_4lnr = ra4lnr - 1                                       .
     c                   endif                                                           .....
      *
     c                   if        w_test = 'K'                                          .....
     c                   eval      w_4lnr = p_4lnr                                           .
     c                   endif                                                           .....
      *
      * Sjekk mot grenser
      *
     c                   if        w_4lnr < ra1hrs                                       .....
     c                   eval      p_retk = 'N'                                              .
     c                   goto      xslutt                                                    .
     c                   endif                                                           .....
      *
      * Sjekker om sist brukte leverandørnummer finnes
      * i leverandørregisteret - hvis ja, finn neste ledige                 neste ledig.
      *
     c                   eval      w_levr = w_4lnr
      *
     c     finnes        tag
      *
     c                   eval      rlevlr_levr = w_levr
     c     rlevlr_key    chain     rlevlrr                            90
     c                   if        *in90 = *off                                          .....
     c                   eval      w_levr = w_levr + 1                                       .
     c                   goto      finnes                                                    .
     c                   endif                                                           .....
      *
      * Oppdater sist bruket leverandørnummer
      *
     c                   eval      raa4lu_4aar = 0                                           .
     c     raa4lu_key    chain     raa4lur                            90
      *
     c                   if        *in90 = *off                                          .....
      *
     c                   if        w_levr > ra4lnr                                       .....
     c                   eval      ra4lnr = w_levr                                           .
     c                   endif                                                           .....
      *
     c                   if        w_test = 'S'                                          .....
     c                             and p_4lnr = ra4lnr                                       .
     c                   eval      ra4lnr = w_4lnr                                           .
     c                   endif                                                           .....
      *
     c                   update    raa4lur                                                   .
     c                   endif                                                           .....
      *
     c                   eval      p_4lnr = ra4lnr                                           .
     c                   eval      p_retk = ' '
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Avslutt program                                                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Subrutine for initiering av program                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      *  Tar inn parameter fra forrige program
      *
     c     *entry        plist
     c                   parm                    p_retk
     c                   parm                    w_firm
     c                   parm                    p_4lnr
      *
      *
      * Key for statuskode 1
      *
     c     raa1l1_key    klist
     c                   kfld                    w_firm
      *
      * Key for statuskode 4
      *
     c     raa4l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    raa4l1_4aar
      *
      * Key for statuskode 4
      *
     c     raa4lu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    raa4lu_4aar
      *
      * Key for leverandørregister
      *
     c     rlevlr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevlr_levr
      *
      *  Hent opplysninger grenseverdier
      *
     c     raa1l1_key    chain     raa1l1r                            90
      *
     c                   endsr
