     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RR624R                                              *
      * Beskrivelse . . : Utskrift av resultatrapport - 13 perioder           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
      * V5.50     210607  Skriver overflow                               HFL  *
      * V5.50     021107  Summerer IB også ved budsjett                  HFL  *
6.20  * R6.20     250211  Avdelingsstekst utvidet til 30 posisjoner       bsa *
      *                                                                       *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     frrf0l1    if   e           k disk    rename(rrf0pfr:rrf0l1r)
     frrf5l1    if   e           k disk    rename(rrf5pfr:rrf5l1r)
     frrf9l1    if   e           k disk    rename(rrf9pfr:rrf9l1r)
     frrf9l2    if   e           k disk    rename(rrf9pfr:rrf9l2r)
     frr624p    o    e             printer oflind(*in30)
      *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      *               T   A   B   E   L   L   E   R                      +
      *+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      *
     d pav             s              4  0 dim(24)
     d uav             s              4  0 dim(8)
     d sal             s             11  2 dim(14)
     d gsa             s             11  2 dim(14)                              Oppsamlet saldo
     d l1s             s              9  0 dim(14)                              Sum for utskrift
     d kod             s              1    dim(14)                              Kode
      *
      *++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      * Data struktur
      *++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      *
     d                 ds
     d nybrd                          9  0                                      Bruddb
     d  nylin                         5  0 overlay(nybrd)                       Linje
     d  nyavd                         4  0 overlay(nybrd:6)                     Avd
      *
     d                 ds
     d gmbrd                          9  0                                      Bruddb
     d  gmlin                         5  0 overlay(gmbrd)                       Linje
     d  gmavd                         4  0 overlay(gmbrd:6)                     Avd
      *
      *++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      * LOCAL DATA
      *++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     d                uds
     d rhprap                300    301  0
     d rhpkda                         6  0
     d rhprÅr                         4  0
     d rhpper                         2  0
     d rhppef                         2  0
     d rhppet                         2  0
     d rhpavf                         4  0
     d rhpavt                         4  0
     d rhpsrt                         1
     d rhpavs                         1
     d rhptyp                         1
     d rhphel                         1
     d rhplin                         1
     d rhanul                         1
     d rhpa01                         4  0
     d rhpa02                         4  0
     d rhpa03                         4  0
     d rhpa04                         4  0
     d rhpa05                         4  0
     d rhpa06                         4  0
     d rhpa07                         4  0
     d rhpa08                         4  0
     d rhpa09                         4  0
     d rhpa10                         4  0
     d rhpa11                         4  0
     d rhpa12                         4  0
     d rhpa13                         4  0
     d rhpa14                         4  0
     d rhpa15                         4  0
     d rhpa16                         4  0
     d rhpa17                         4  0
     d rhpa18                         4  0
     d rhpa19                         4  0
     d rhpa20                         4  0
     d rhpa21                         4  0
     d rhpa22                         4  0
     d rhpa23                         4  0
     d rhpa24                         4  0
      *
     d l_wsid                901    910
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
     d bev             s                   like(rr9hia)
     d bevp            s                   like(rr9hia)
     d difh            s                   like(rr9hia)
     d difp            s                   like(rr9hia)
     d gm9abl          s                   like(rr9abl)
     d gm9avd          s                   like(rr9avd)
     d gm9kod          s                   like(rr9kod)
     d gm9lin          s                   like(rr9lin)
     d gm9nul          s                   like(rr9nul)
     d gm9sln          s                   like(rr9sln)
     d gm9txt          s                   like(rr9txt)
     d n               s              2  0
     d m               s              2  0
     d x               s              2  0
     d tstavd          s              7  0
     d ny9abl          s                   like(rr9abl)
     d ny9avd          s                   like(rr9avd)
     d ny9kod          s                   like(rr9kod)
     d ny9lin          s                   like(rr9lin)
     d ny9nul          s                   like(rr9nul)
     d ny9sln          s                   like(rr9sln)
     d ny9txt          s                   like(rr9txt)
     d sisskr          s                   like(rr9lin)
     d proh            s              7  1
     d prop            s              7  1
     d pslnh           s              5  1
     d pslnp           s              5  1
     d salh            s                   like(rr9hia)
     d salh0           s              9  0
     d salh1           s              7  0
     d samh            s                   like(rr9hia)
     d samh0           s              9  0
     d samh1           s              7  0
     d samp            s                   like(rr9hia)
     d samp0           s              9  0
     d samp1           s              7  0
     d slnh            s                   like(rr9hia)
     d slnp            s                   like(rr9hia)
     d sum             s                   like(rr9hia)
     d wpro1           s              9  4
     d rhprfj          s                   like(rhprÅr)
      *
     d w_firm          s                   like(rr9fir)
     d w_stat          s              1
6.20 d w_gtxt          s             30
     d w_gkod          s                   like(rr9avd)
     d w_0rap          s                   like(rr0rap)
     d w_0txt          s                   like(rr0txt)
     d w_5abl          s                   like(rr5abl)
     d w_5kod          s                   like(rr5kod)
     d w_5lin          s                   like(rr5lin)
     d w_5rap          s                   like(rr5rap)
     d w_5txt          s                   like(rr5txt)
     d w_9avd          s                   like(rr9avd)
     d w_9typ          s                   like(rr9typ)
      *
     d rrf9l2_9rap     s                   like(rr9rap)
     d rrf5l1_5rap     s                   like(rr5rap)
     d rrf0l1_0rap     s                   like(rr0rap)
      *
     d rrf9l1_9rap     s                   like(rr9rap)
      *
      /eject
      *
     irrf9l1r
      *
      *  Resultatregister - Linjerekkefølge
      *
     i              rr9s01                      sal(01)
     i              rr9s02                      sal(02)
     i              rr9s03                      sal(03)
     i              rr9s04                      sal(04)
     i              rr9s05                      sal(05)
     i              rr9s06                      sal(06)
     i              rr9s07                      sal(07)
     i              rr9s08                      sal(08)
     i              rr9s09                      sal(09)
     i              rr9s10                      sal(10)
     i              rr9s11                      sal(11)
     i              rr9s12                      sal(12)
     i              rr9s13                      sal(13)
     i              rr9s00                      sal(14)
     irrf9l2r
      *
      *  Resultatregister - Avdelingsrekkefølge
      *
     i              rr9s01                      sal(01)
     i              rr9s02                      sal(02)
     i              rr9s03                      sal(03)
     i              rr9s04                      sal(04)
     i              rr9s05                      sal(05)
     i              rr9s06                      sal(06)
     i              rr9s07                      sal(07)
     i              rr9s08                      sal(08)
     i              rr9s09                      sal(09)
     i              rr9s10                      sal(10)
     i              rr9s11                      sal(11)
     i              rr9s12                      sal(12)
     i              rr9s13                      sal(13)
     i              rr9s00                      sal(14)
      *
      /eject
      *
      * Les saldo-records
      *
     c                   select
     c                   when      rhpsrt = ' '
     c                   eval      rrf9l1_9rap = rhprap
     c     rrf9l1_key    setll     rrf9l1r                                                   .
     c     rrf9l1_key    reade     rrf9l1r                                60
     c                   other
     c                   eval      rrf9l2_9rap = rhprap
     c     rrf9l2_key    setll     rrf9l2r                                                   .
     c     rrf9l2_key    reade     rrf9l2r                                60
     c                   endsl
      *
     c                   dow       *in60 = *off
      *
      * Sjekk om avdeling 0000 med
      *
     c                   if        rhanul = 'N' and                                      .....
     c                             rr9avd = *zeros                                       .....
     c                   goto      neste                                                     .
     c                   endif                                                           .....
      *
      * Sjekk avdeling fra/til
      *
     c                   if        rr9avd >= rhpavf and                                  .....
     c                             rr9avd <= rhpavt                                      .....
     c                   goto      avdx1                                                     .
     c                   endif                                                           .....
      *
      * Hvis avdeling ligger utenfor
      * fra - til,
      * sjekk mot tabell
      *
      * Hvis valg ikke utfylt -                                         .
      * les neste postering                                             .
      *                                                                 .
     c                   if        tstavd = *zeros                                       ... .
     c                   goto      neste                                                   . .
     c                   endif                                                           ... .
      *                                                                 .
      * Hvis valg utfylt -                                              .
      * sjekk mot tabell                                                .
      *                                                                 .
     c                   eval      n = 1                                                     .
     c                   dou       n > 24                                                ... .
      *                                                               . .
     c                   if        pav(n) <> *zeros                                        . .
      *                                                               . .
     c                   if        rr9avd = pav(n)                                         . .
     c                   goto      avdx1                                                   . .
     c                   endif                                                             . .
      *                                                               . .
     c                   endif                                                             . .
      *                                                               . .
     c                   eval      n = n + 1                                               . .
     c                   enddo                                                           ... .
      *                                                                 .
      * Avdeling ikke i tabell -                                           .
      * les neste postering                                             .
      *                                                                 .
     c                   goto      neste                                                     .
      *                                                                 .
      /eject
      *                                                                 .
     c     avdx1         tag                                                                 .
      *
      * Regnskap
      *
     c                   if        rhptyp = 'R' or                              REGNSKAP .....
     c                             rhptyp = 'P' or                              REGNSKAP .....
     c                             rhptyp = 'F' and                             REGNSKAP .....
     c                             rr9aar = rhprÅr and                                   .....
     c                             rr9typ = 1                                                .
     c                   goto      behand                                                    .
     c                   endif                                                           .....
      *
      * Budsjett
      *
     c                   if        rhptyp = 'B' and                             REGNSKAP .....
     c                             rr9aar = rhprÅr and                                   .....
     c                             rr9typ = 3                                                .
     c                   goto      behand                                                    .
     c                   endif                                                           .....
      *
      * Alternativt budsjett
      *
     c                   if        rhptyp = 'A' and                             ALT.BUDSJ.....
     c                             rr9aar = rhprÅr and                                   .....
     c                             rr9typ = 4                                                .
     c                   goto      behand                                                    .
     c                   endif                                                           .....
      *
      * Prognose mot budsjett
      *
     c                   if        rhptyp = 'P' and                             REGNSKAP .....
     c                             rr9aar = rhprÅr and                                   .....
     c                             rr9typ = 3                                                .
     c                   goto      behand                                                    .
     c                   endif                                                           .....
      *
      * Prognose mot fjorår
      *
     c                   if        rhptyp = 'F' and                             REGNSKAP .....
     c                             rr9aar <> rhprfj and                                  .....
     c                             rr9typ = 1                                                .
     c                   goto      behand                                                    .
     c                   endif                                                           .....
      *
      * Les neste record
      *
     c                   goto      neste
      *
     c     behand        tag
      *
      * Bygg kontrollbegrepet
      *
     c                   move      rr9lin        nylin
     c                   move      rr9avd        nyavd
     c                   move      rr9lin        ny9lin
     c                   move      rr9txt        ny9txt
     c                   move      rr9abl        ny9abl
     c                   move      rr9kod        ny9kod
     c                   move      rr9nul        ny9nul
     c                   move      rr9sln        ny9sln
     c                   move      rr9avd        ny9avd
      *
      * Første gang - ikke test på brudd
      *
     c                   if        gmbrd = *zeros                                        .....
     c                   move      nybrd         gmbrd                                       .
     c                   move      ny9txt        gm9txt
     c                   move      ny9lin        gm9lin
     c                   move      ny9abl        gm9abl
     c                   move      ny9kod        gm9kod
     c                   move      ny9nul        gm9nul
     c                   move      ny9sln        gm9sln
     c                   move      ny9avd        gm9avd
      *
      * Skriv heading på første side
      *
     c                   if        rhpsrt = 'A'
     c                   eval      w_gkod = ny9avd
      *
     c                   call      'RS707R'
     c                   parm                    w_stat
     c                   parm                    w_gkod
     c                   parm                    w_gtxt
      *
     c                   endif
      *
     c                   exsr      skrhed
      *
     c                   endif
      *
      * Dersom linje-rekkefølge, nullstill avd i bruddbegrep
      *
     c                   if        rhpsrt = ' '
     c                   eval      nyavd = *zeros
     c                   endif
      *
      * Test hele bruddbegrepet - hvis ikke brudd, summer laveste nivå
      *
     c                   if        nybrd = gmbrd
     c                   exsr      rsum
     c                   goto      neste
     c                   endif
      /eject
      *
      * Brudd på linje
      *
     c                   if        nylin <> gmlin
     c                   exsr      brlin
     c                   endif
      *
      * Brudd på avdeling eller LR - (kun hvis sortert på avdeling)
      *
     c                   if        rhpsrt = 'A'
     c                             and nyavd <> gmavd
     c                   exsr      bravd
     c                   endif
      *
      * Summer til L1-nivå
      *
     c                   exsr      rsum
      *
      * Flytt nytt brudd-begrep til gammelt
      *
     c                   move      nybrd         gmbrd
     c                   move      ny9txt        gm9txt
     c                   move      ny9lin        gm9lin
     c                   move      ny9abl        gm9abl
     c                   move      ny9kod        gm9kod
     c                   move      ny9nul        gm9nul
     c                   move      ny9sln        gm9sln
     c                   move      ny9avd        gm9avd
      *
     c     neste         tag
      *
     c                   select
     c                   when      rhpsrt = ' '
     c     rrf9l1_key    reade     rrf9l1r                                60
     c                   other
     c     rrf9l2_key    reade     rrf9l2r                                60
     c                   endsl
      *
     c                   enddo
      *
      /Space 3
      *
     c     slutt         tag
      *
     c                   eval      *inlr = *on
      *
      * Brudd på linje
      *
     c                   move      *hival        nybrd
      *
     c                   if        nylin <> gmlin
     c                   exsr      brlin
     c                   endif
      *
      * Brudd på avdeling eller LR - (kun hvis sortert på avdeling)
      *
     c                   if        rhpsrt = 'A'
     c                             and nyavd <> gmavd
     c                   exsr      bravd
     c                   endif
      *
      * Summer til L1-nivå
      *
     c                   exsr      rsum
      *
     c                   move      *hival        gm9lin
      *
     c                   exsr      brtxt
      *
      /eject
      ****************************************************************
      *   Subrutine for behandling av alle aktuelle recordtyper      *
      ****************************************************************
      *
     c     rsum          begsr
      *
     c                   eval      n = 1
      *
      * Saldorecord for regnskap
      *
     c                   if        rhptyp = 'R' or                                       .....
     c                             rhptyp = 'P' or                                       .....
     c                             rhptyp = 'F'                                          .....
      *
     c                   if        rr9aar = rhprÅr and                                       .
     c                             rr9typ = 1                                                .
      *                                                                 .
      * Behandle IB (14 = IB)                                           .
      *                                                                 .
     c                   eval      gsa(14) = gsa(14) + sal(14)                             . .
      *                                                                 .
      * Summer periode fra 1 - RHPPER                                   .
      *                                                                 .
     c                   dou       n > rhpper                                          ..... .
     c                   eval      gsa(n) = gsa(n) + sal(n)                                . .
     c                   eval      n = n + 1                                               . .
     c                   enddo                                                         ..... .
      *                                                                 .
     c                   endif                                                               .
     c                   endif                                                           .....
      *
      * Saldorecord for budsjett
      *
     c                   if        rhptyp = 'B' and                                      .....
     c                             rr9aar = rhprÅr and                                       .
     c                             rr9typ = 3                                                .
      *                                                                 .
T5.50 * Behandle IB (14 = IB)                                           .
      *                                                                 .
T5.50c                   eval      gsa(14) = gsa(14) + sal(14)                             . .
      *                                                                 .
      * Summer periode fra 1 - RHPPER                                   .
      *                                                                 .
     c                   dou       n > rhpper                                          ..... .
     c                   eval      gsa(n) = gsa(n) + sal(n)                                . .
     c                   eval      n = n + 1                                               . .
     c                   enddo                                                         ..... .
      *                                                                 .
     c                   endif                                                           .....
      *
      * Saldorecord for prognose/budsjett
      *
     c                   if        rhptyp = 'P' and                                      .....
     c                             rr9aar = rhprÅr and                                       .
     c                             rr9typ = 3                                                .
      *                                                                 .
      * Summer periode fra RHPPER - 13                                  .
      *                                                                 .
     c                   eval      n = rhpper + 1                                            .
      *                                                                 .
     c                   dou       n > 13                                              ..... .
     c                   eval      gsa(n) = gsa(n) + sal(n)                                . .
     c                   eval      n = n + 1                                               . .
     c                   enddo                                                         ..... .
      *                                                                 .
     c                   endif                                                           .....
      *
      * Saldorecord for prognose/fjorår
      *
     c                   if        rhptyp = 'F' and                                      .....
     c                             rr9aar = rhprfj and                                       .
     c                             rr9typ = 1                                                .
      *                                                                 .
      * Summer periode fra RHPPER - 13                                  .
      *                                                                 .
     c                   eval      n = rhpper + 1                                            .
      *                                                                 .
     c                   dou       n > 13                                              ..... .
     c                   eval      gsa(n) = gsa(n) + sal(n)                                . .
     c                   eval      n = n + 1                                               . .
     c                   enddo                                                         ..... .
      *                                                                 .
     c                   endif                                                           .....
      *
     c                   endsr
      /eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på linje                 *
      ****************************************************************
      *
     c     brlin         begsr
      *
      * Sjekk om det finnes linjer
      * med lavere nummer som skal skrives
      *
     c                   dow       w_5lin < gm9lin                                       .....
      *                                                                 .
      * Skriv linje                                                     .
      *                                                                 .
     c                   write     skrtxt                               30                   .
      *
      * Skriv blanke linjer
      *
     c                   if        w_5abl = '1'                                          .....
     c                   write     skrbl1                               30                   .
     c                   endif                                                           .....
      *
     c                   if        w_5abl = '2'                                          .....
     c                   write     skrbl2                               30                   .
     c                   endif                                                           .....
      *
     c                   if        w_5abl = '3'                                          .....
     c                   write     skrbl3                               30                   .
     c                   endif                                                           .....
      *
      * Skriv ny side
      *
     c                   if        w_5abl = 'S'                                          .....
     c                   exsr      skrhed                                                    .
     c                   endif                                                           .....
      *                                                                 .
      * Hent ny linje                                                   .
      *                                                                 .
     c                   exsr      xltxt                                                     .
      *                                                                 .
     c                   enddo                                                           .....
      *
      * Non-print total/ikke utskrift
      *
     c                   if        gm9kod = 'N' or                                       .....
     c                             gm9nul = 'N'                                          .....
     c                   goto      l1null                                                    .
     c                   endif                                                           .....
      *
      * Beregn beløp for utskrift
      *
     c                   if        rhphel = 'H'                                          .....
     c                   eval(h)   l1s = gsa / 1                                             .
     c                   else                                                                .
     c                   eval(h)   l1s = gsa / 1000                                          .
     c                   endif                                                           .....
      *
     c                   xfoot     l1s           l1sum
      *
     c                   eval      gm9tx1 = gm9txt                                           .
     c                   eval      gm9tx2 = gm9txt                                           .
      *
     c                   eval      l1s01 = l1s(01)                                           .
     c                   eval      l1s02 = l1s(02)                                           .
     c                   eval      l1s03 = l1s(03)                                           .
     c                   eval      l1s04 = l1s(04)                                           .
     c                   eval      l1s05 = l1s(05)                                           .
     c                   eval      l1s06 = l1s(06)                                           .
     c                   eval      l1s07 = l1s(07)                                           .
     c                   eval      l1s08 = l1s(08)                                           .
     c                   eval      l1s09 = l1s(09)                                           .
     c                   eval      l1s10 = l1s(10)                                           .
     c                   eval      l1s11 = l1s(11)                                           .
     c                   eval      l1s12 = l1s(12)                                           .
     c                   eval      l1s13 = l1s(13)                                           .
T5.50c                   eval      l1s14 = l1s(14)                                           .
      *
     c                   write     skrlin                               30
      *
      * Skriv blanke linjer
      *
     c                   if        gm9abl = '1'                                          .....
     c                   write     skrbl1                               30                   .
     c                   endif                                                           .....
      *
     c                   if        gm9abl = '2'                                          .....
     c                   write     skrbl2                               30                   .
     c                   endif                                                           .....
      *
     c                   if        gm9abl = '3'                                          .....
     c                   write     skrbl3                               30                   .
     c                   endif                                                           .....
      *
      * Skriv ny side
      *
     c                   if        gm9abl = 'S'                                          .....
     c                   exsr      skrhed                                                    .
     c                   endif                                                           .....
      *
     c     l1null        tag
      *
     c                   eval      gsa = *zeros
      *
     c                   endsr
      /eject
      ****************************************************************
      *   Subrutine for behandling av tekstlinjer                    *
      ****************************************************************
      *
     c     brtxt         begsr
      *
      * Behandle tekstlinje
      *
      * Sjekk om det finnes tekstlinjer
      * med lavere nummer som skal skrives
      *
     c                   dow       w_5lin < gm9lin
      *
      * Test om nulllinjer skal skrives
      *
     c                   if        rhanul = 'N' and
     c                             rhpsrt = ' ' and
     c                             w_5kod = 'K'
     c                   goto      skrblt
     c                   endif
      *
      *      også de med 0 i antall blanke
      *
     c                   if        rhanul = 'J' and
     c                             rhpsrt = ' ' and
     c                             w_5kod = 'K' and
     c                             w_5abl = '0'
     c                   goto      skrblt
     c                   endif
      *
     c                   if        rr5lin = sisskr
     c                   goto      brhxlt
     c                   endif
      *
      * Skriv tekstlinje
      *
     c                   write     skrtxt                               30
      *
     c     skrblt        tag
      *
     c                   if        *in30 = *on
     c                   exsr      skrhed
     c                   eval      *in30 = *off
     c                   endif
      *
      * Skriv blanke linjer
      *
     c                   if        w_5abl = '1'
     c                   write     skrbl1                               30
     c                   endif
      *
     c                   if        w_5abl = '2'
     c                   write     skrbl2                               30
     c                   endif
      *
     c                   if        w_5abl = '3'
     c                   write     skrbl3                               30
     c                   endif
      *
      * Skriv ny side
      *
     c                   if        w_5abl = 'S'
     c                   exsr      skrhed
     c                   endif
      *
      * Hent ny tekstlinje
      *
     c     brhxlt        tag
      *
     c                   exsr      xltxt
      *
     c                   enddo
      *
     c                   endsr
      /eject
      ****************************************************************
      *   Subrutine for beregning ved brudd på avdeling              *
      ****************************************************************
      *
     c     bravd         begsr
      *
      * Hent avdelingstekst fra koderegisteret
      *
     c                   move      gm9avd        w_9avd
     c                   move      gm9avd        w_gkod
      *
     c                   call      'RS707R'                                      avdelings-
     c                   parm                    w_stat
     c                   parm                    w_gkod
     c                   parm                    w_gtxt
      *
     c                   if        *in30 = *on
     c                   exsr      skrhed
T5.50c                   eval      *in30 = *off
     c                   endif
      *
      * Hent avdelingstekst fra koderegisteret og skriv ny heading
      *
     c  nlr              do                                                              .....
     c                   move      ny9avd        w_9avd                                      .
     c                   move      ny9avd        w_gkod                                      .
      *
     c                   call      'RS707R'                                      avdelings-
     c                   parm                    w_stat
     c                   parm                    w_gkod
     c                   parm                    w_gtxt
      *                                                                 .
     c                   exsr      skrhed                                                    .
      *                                                                 .
      * Start forfra på tekst                                           .
      *                                                                 .
     c                   move      rhprap        rr5rap                                      .
     c                   eval      rr5lin = *zero                                            .
     c     rrf5l1_key    setll     rrf5l1                                                    .
      *                                                                 .
      * Hent første tekstlinje                                          .
      *                                                                 .
     c                   exsr      xltxt                                                     .
      *                                                                 .
     c                   enddo                                                           .....
      *
     c                   endsr
      /eject
      *
      ****************************************************************
      *   Subrutine for beregning av brukt/oppnådd/sml.linje         *
      ****************************************************************
      *
     c     beregn        begsr
      *
      * Denne periode
      *
S5.50c*                  eval      *in16 = *off
S5.50c*                  eval      *in17 = *off
      *
     c                   if        samp <> *zero
     c                   select
      *
     c                   when      (difp / samp) * 100 + 100 >= 999999,9                     .
     c                   eval      prop = 999999,9
      *
     c                   when      (difp / samp) * 100 + 100 <= -999999,9
     c                   eval      prop = -999999,9
      *
     c                   other
     c                   eval(h)   prop = (difp / samp) * 100 + 100
     c                   endsl
     c                   else
     c                   if        samp = *zero
S5.50c*                  eval      *in16 = *on
     c                   endif
     c                   endif
      *
     c                   if        slnp <> *zero
     c                   select
      *
     c                   when      (bevp / slnp) * 100 >= 9999,9
     c                   eval      pslnp = 9999,9
      *
     c                   when      (bevp / slnp) * 100 <= -9999,9
     c                   eval      pslnp = -9999,9
      *
     c                   other
     c                   eval(h)   pslnp = (bevp / slnp) * 100
     c                   endsl
     c                   else
     c                   eval      pslnp = *zero
     c                   endif
      *
      * Hittil
      *
     c                   if        samh <> *zero
     c                   select
      *
     c                   when      (difh / samh) * 100 + 100 >= 999999,9
     c                   eval      proh = 999999,9
      *
     c                   when      (difh / samh) * 100 + 100 <= -999999,9
     c                   eval      proh = -999999,9
      *
     c                   other
     c                   eval(h)   proh = (difh / samh) * 100 + 100
     c                   endsl
     c                   else
     c                   if        samh = *zero
S5.50c*                  eval      *in17 = *on
     c                   endif
     c                   endif
      *
     c                   if        slnh <> *zero
     c                   select
      *
     c                   when      (salh / slnh) * 100 >= 9999,9
     c                   eval      pslnh = 9999,9
      *
     c                   when      (salh / slnh) * 100 <= -9999,9
     c                   eval      pslnh = -9999,9
      *
     c                   other
     c                   eval(h)   pslnh = (salh / slnh) * 100
     c                   endsl
     c                   else
     c                   eval      pslnh = *zero
     c                   endif
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *   Subrutine for å skrive heading                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *
     c     skrhed        begsr
      *
     c                   write     head1
      *
     c                   endsr
      *
      /space 3
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Hent tekstlinjer fra rrf5l1                                     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xltxt         begsr
      *
     c     xlles         tag
      *
     c                   read      rrf5l1r                                61
      *
     c                   if        *in61 = *on or
     c                             rr5fir > w_firm or
     c                             rr5rap > rhprap
     c                   move      *hival        w_5lin
     c                   goto      xlend
     c                   endif
      *
     c                   if        rr5kod <> 'T'
     c                   goto      xlles
     c                   endif
      *
     c                   move      rr5lin        w_5lin
     c                   move      rr5txt        w_5tx1
     c                   move      rr5txt        w_5tx2
     c                   move      rr5abl        w_5abl
     c                   move      rr5kod        w_5kod
      *
     c     xlend         tag
      *                                                                 .
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      * Behandle parameter
      *
     c                   if        rhptyp = 'R'                                 REGNSKAP .....
     c                   move      *on           *in14                                       .
     c                   endif                                                           .....
      *
     c                   if        rhptyp = 'B'                                 BUDSJETT .....
     c                   move      *on           *in15                                       .
     c                   endif                                                           .....
      *
     c                   if        rhptyp = 'A'                                 ALT.BUDSJ.....
     c                   move      *on           *in16                                       .
     c                   endif                                                           .....
      *
     c                   if        rhptyp = 'P'                                 PROGNOSE .....
     c                   move      *on           *in17                          BUDSJETT     .
      *                                                                 .
      * Legg ut koder i heading                                         .
      *                                                                 .
     c                   do        13            x                                           .
     c                   if        rhpper >= x                                               .
     c                   move      'R'           kod(x)                                      .
     c                   else                                                                .
     c                   move      'B'           kod(x)                                      .
     c                   endif                                                               .
     c                   enddo                                                               .
      *                                                                 .
     c                   endif                                                           .....
      *
     c                   if        rhptyp = 'F'                                 PROGNOSE .....
     c                   move      *on           *in18                          FJORÅR       .
      *                                                                 .
     c                   do        13            x                                           .
     c                   if        rhpper >= x                                               .
     c                   move      'R'           kod(x)                                      .
     c                   else                                                                .
     c                   move      'F'           kod(x)                                      .
     c                   endif                                                               .
     c                   enddo                                                               .
      *                                                                 .
     c                   endif                                                           .....
      *
     c                   eval      kod01 = kod(01)                                           .
     c                   eval      kod02 = kod(02)                                           .
     c                   eval      kod03 = kod(03)                                           .
     c                   eval      kod04 = kod(04)                                           .
     c                   eval      kod05 = kod(05)                                           .
     c                   eval      kod06 = kod(06)                                           .
     c                   eval      kod07 = kod(07)                                           .
     c                   eval      kod08 = kod(08)                                           .
     c                   eval      kod09 = kod(09)                                           .
     c                   eval      kod10 = kod(10)                                           .
     c                   eval      kod11 = kod(11)                                           .
     c                   eval      kod12 = kod(12)                                           .
     c                   eval      kod13 = kod(13)                                           .
      *
     c                   if        rhpsrt = 'A'
E5.50c                   eval      *in20 = *on
     c                   endif
      *
     c                   if        rhphel = 'H'
     c                   eval      *in21 = *on
     c                   endif
      *
     c                   if        rhphel = 'T'
     c                   eval      *in22 = *on
     c                   endif
      *
     c                   if        rhplin = 'N'
     c                   eval      *in23 = *on
     c                   endif
      *
      * Sett startverdier
      *
     c                   eval      gm9txt = *blank
     c                   eval      gm9lin = *zero
     c                   eval      nybrd = *zero
     c                   eval      gmbrd = *zero
      *
     c                   move      l_firm        w_firm
      *
     c                   eval      rhprfj = rhprÅr - 1
      *
      * Hent rapportheading
      *
     c                   eval      w_0rap = rhprap
     c                   eval      rrf0l1_0rap = rhprap
     c     rrf0l1_key    chain     rrf0l1                             63
      *
     c                   if        *in63 = *off
     c                   move      rr0txt        w_0txt
     c                   else
     c                   eval      w_0txt = *blank
     c                   endif
      *
      * Hent første tekstlinje
      *
     c                   eval      rr5rap = rhprap
     c                   eval      rr5lin = *zero
     c     rrf5l1_key    setll     rrf5l1r
      *
     c                   exsr      xltxt
      *
      *  Flytt utvalgte avdelinger til tabell
      *
     c                   move      rhpa01        pav(01)
     c                   move      rhpa02        pav(02)
     c                   move      rhpa03        pav(03)
     c                   move      rhpa04        pav(04)
     c                   move      rhpa05        pav(05)
     c                   move      rhpa06        pav(06)
     c                   move      rhpa07        pav(07)
     c                   move      rhpa08        pav(08)
     c                   move      rhpa09        pav(09)
     c                   move      rhpa10        pav(10)
     c                   move      rhpa11        pav(11)
     c                   move      rhpa12        pav(12)
     c                   move      rhpa13        pav(13)
     c                   move      rhpa14        pav(14)
     c                   move      rhpa15        pav(15)
     c                   move      rhpa16        pav(16)
     c                   move      rhpa17        pav(17)
     c                   move      rhpa18        pav(18)
     c                   move      rhpa19        pav(19)
     c                   move      rhpa20        pav(20)
     c                   move      rhpa21        pav(21)
     c                   move      rhpa22        pav(22)
     c                   move      rhpa23        pav(23)
     c                   move      rhpa24        pav(24)
      *
      * Sjekk om avdelingsvalg utfylt
      *
     c                   xfoot     pav           tstavd
      *
      * Key for RESULTAREGISTER - HEADING
      *
     c     rrf0l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rrf0l1_0rap
      *
      * Key for tekstlinjer
      *
     c     rrf5l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rr5rap
      *
      * Key for resultatregister - linje
      *
     c     rrf9l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rrf9l1_9rap
      *
      * Key for resultatregister - avdeling
      *
     c     rrf9l2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rrf9l2_9rap
      *
     c                   endsr
