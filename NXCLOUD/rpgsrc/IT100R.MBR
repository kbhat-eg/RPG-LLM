     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASNAVIOKO
      * Program . . . . : IT100R
      * Beskrivelse . . : Leser replikeringtransaksjoner fra NAV kø
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       071114 ask  Nytt program
7.01  * 7.01  021220 ask  Utvidet med valutakursoppdatering
7.02  * 7.02  030321 ask  Lagt inn mulighet for å ignorere logging (w_stat=9)
7.03  * 7.03  180321 ask  Utvidet med logging av regnskapstransaksjoner
8.01  * 800   070521 ask  Lagt inn funksjonalitet for å øke hastighet ved mange poster
8.02  * 800   301122 ask  Lagt inn behandling av returer på masterdata overføringer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fifnai1    uf   e           k disk    rename(ifnast:ifnai1r)
     fiupdi1    uf a e           k disk    rename(iupdst:iupdi1r)
     fierri1    uf a e           k disk    rename(ierrst:ierri1r)
      *
      * Local Data Area
      *
     d                uds
     d l_firm                944    946  0
     d l_user                911    920
      *
      * Definering av variabler i nøkler
      *
     d ifnai1_prog     s                   like(ifprog)
      *
      * Definering av variable
      *
     d w_firm          s                   like(iffirm)
     d w_stat          s              1
     d w_date          s               d   datfmt(*iso)
     d w_time          s               t   timfmt(*iso)
8.02 d w_datp          s               d   datfmt(*iso)
8.02 d w_timp          s               t   timfmt(*iso)
     d w_parm          s           2048
     d w_comd          s             20
     d w_user          s             10
8.01 d w_inlr          s              1
      *
8.01 d b_lr110         s              1    inz(*off)
8.01 d b_lr123         s              1    inz(*off)
8.02 d b_lr124         s              1    inz(*off)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Hovedprogram - leser parametre og kaller oppdateringsprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   eval      ifnai1_prog = *blanks
     c     ifnai1_key    setll     ifnai1
      *
     c                   read      ifnai1
     c                   dow       not %eof and
     c                             iffirm = w_firm
     c                   eval      w_parm = ifparm
     c                   eval      w_comd = ifcomd
     c                   eval      w_user = ifeusr
8.02 c                   eval      w_datp = ifodat
8.02 c                   eval      w_timp = ifetim
      *
      * Sjekk programkode og kaller tilhørende oppdateringsprogram
      *
     c                   if        ifprog = 'NEXSTEPEXPORTCUSTOMERBALANCE'
     c                   eval      w_stat = *blank
8.01 c                   eval      w_inlr = *blank
8.01 c                   eval      b_lr110 = *on
     c                   call      'IT110R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
8.01 c                   parm                    w_inlr
     c                   endif
      *
     c                   if        ifprog = 'NEXSTEPEXPORTCUSTOMER'
     c                   eval      w_stat = *blank
     c                   call      'IT111R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
     c                   endif
      *
     c                   if        ifprog = 'NEXSTEPEXPORTVENDOR'
     c                   eval      w_stat = *blank
     c                   call      'IT112R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
     c                   endif
      *
     c                   if        ifprog = 'NEXSTEPEXPORTPAYMENTTERM'
     c                   eval      w_stat = *blank
     c                   call      'IT113R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
     c                   endif
      *
     c                   if        ifprog = 'NEXSTEPEXPORTTERRITORIES'
     c                   eval      w_stat = *blank
     c                   call      'IT114R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
     c                   endif
      *
     c                   if        ifprog = 'NEXSTEPEXPORTLOCATIONS'
     c                   eval      w_stat = *blank
     c                   call      'IT115R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
     c                   endif
      *
     c                   if        ifprog = 'NEXSTEPEXPORTCOUNTRY'
     c                   eval      w_stat = *blank
     c                   call      'IT116R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
     c                   endif
      *
     c                   if        ifprog = 'NEXSTEPEXPORTSALESPERSON'
     c                   eval      w_stat = *blank
     c                   call      'IT117R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
     c                   endif
      *
     c                   if        ifprog = 'NEXSTEPEXPORTSHIPPINGAGENT'
     c                   eval      w_stat = *blank
     c                   call      'IT118R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
     c                   endif
      *
     c                   if        ifprog = 'NEXSTEPEXPORTSPECIFICATIONS'
     c                   eval      w_stat = *blank
     c                   call      'IT119R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
     c                   endif
      *
     c                   if        ifprog = 'NEXSTEPEXPORTSHIPMENTMETHOD'
     c                   eval      w_stat = *blank
     c                   call      'IT120R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
     c                   endif
      *
     c                   if        ifprog = 'NEXSTEPEXPORTDEPARTMENTS'
     c                   eval      w_stat = *blank
     c                   call      'IT121R'
5.04 c                   parm                    w_firm
5.04 c                   parm                    w_comd
5.04 c                   parm                    w_parm
5.04 c                   parm                    w_user
5.04 c                   parm                    w_stat
     c                   endif
7.01  *
7.01 c                   if        ifprog = 'NEXSTEPEXPORTEXCHANGERATE'
7.01 c                   eval      w_stat = *blank
7.01 c                   call      'IT122R'
7.01 c                   parm                    w_firm
7.01 c                   parm                    w_comd
7.01 c                   parm                    w_parm
7.01 c                   parm                    w_user
7.01 c                   parm                    w_stat
7.01 c                   endif
7.03  *
7.03 c                   if        ifprog = 'NEXSTEPRECONCILIATIONINTERFACE'
7.03 c                   eval      w_stat = *blank
8.01 c                   eval      b_lr123 = *on
7.03 c                   call      'IT123R'
7.03 c                   parm                    w_firm
7.03 c                   parm                    w_comd
7.03 c                   parm                    w_parm
7.03 c                   parm                    w_user
7.03 c                   parm                    w_stat
8.01 c                   parm                    w_inlr
7.03 c                   endif
8.02  *
8.02 c                   if        ifprog = 'NEXSTEPHUB'
8.02 c                   eval      w_stat = *blank
8.02 c                   eval      b_lr124 = *on
8.02 c                   call      'IT124R'
8.02 c                   parm                    w_firm
8.02 c                   parm                    w_comd
8.02 c                   parm                    w_datp
8.02 c                   parm                    w_timp
8.02 c                   parm                    w_parm
8.02 c                   parm                    w_user
8.02 c                   parm                    w_stat
8.02 c                   parm                    w_inlr
8.02 c                   endif
      *
      * Setter "timestamp" for loggoppdateringer
      *
     c                   time                    w_date
     c                   time                    w_time
      *
      * Vellykket oppdatering, skriv oppd.logg og slett trans før ny les
      *
     c                   if        w_stat = '1'
      *
     c                   eval      iufirm = iffirm
     c                   eval      iuprog = ifprog
     c                   eval      iucomd = ifcomd
     c                   eval      iuparm = ifparm
     c                   eval      iuodat = w_date
     c                   eval      iuotim = w_time
     c                   eval      iuousr = w_user
     c                   write     iupdi1r
      *
     c                   delete    ifnai1r
     c                   endif
      *
      * Mislykket oppdatering, skriv feillogg og slett trans før ny les
      *
     c                   if        w_stat = ' '
      *
     c                   eval      iefirm = iffirm
     c                   eval      ieprog = ifprog
     c                   eval      iecomd = ifcomd
     c                   eval      ieparm = ifparm
     c                   eval      ieodat = w_date
     c                   eval      ieotim = w_time
     c                   eval      ieousr = w_user
     c                   write     ierri1r
      *
     c                   delete    ifnai1r
     c                   endif
7.02  *
7.02  * Oppdateringstransen skal bare ignoreres
7.02  *
7.02 c                   if        w_stat = '9'
7.02  *
7.02 c                   delete    ifnai1r
7.02 c                   endif
      *
     c                   read      ifnai1
     c                   enddo
8.01  *
8.01  *  Sjekker om program har vært brukt og kjører en siste runde for å lukke filer
8.01  *
8.01 c                   if        b_lr110 = *on
8.01 c                   eval      w_inlr = '1'
8.01 c                   call      'IT110R'
8.01 c                   parm                    w_firm
8.01 c                   parm                    w_comd
8.01 c                   parm                    w_parm
8.01 c                   parm                    w_user
8.01 c                   parm                    w_stat
8.01 c                   parm                    w_inlr
8.01 c                   endif
8.01  *
8.01 c                   if        b_lr123 = *on
8.01 c                   eval      w_inlr = '1'
8.01 c                   call      'IT123R'
8.01 c                   parm                    w_firm
8.01 c                   parm                    w_comd
8.01 c                   parm                    w_parm
8.01 c                   parm                    w_user
8.01 c                   parm                    w_stat
8.01 c                   parm                    w_inlr
8.01 c                   endif
8.01  *
8.02 c                   if        b_lr124 = *on
8.02 c                   eval      w_inlr = '1'
8.02 c                   call      'IT124R'
8.02 c                   parm                    w_firm
8.02 c                   parm                    w_comd
8.02 c                   parm                    w_datp
8.02 c                   parm                    w_timp
8.02 c                   parm                    w_parm
8.02 c                   parm                    w_user
8.02 c                   parm                    w_stat
8.02 c                   parm                    w_inlr
8.02 c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for les av transaksjonsfil
      *
     c     ifnai1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ifnai1_prog
      *
     c                   eval      w_firm = l_firm
      *
     c                   endsr
