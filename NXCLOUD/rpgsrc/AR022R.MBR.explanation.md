# RPG Program AR022R - Explanation

This RPG (Report Program Generator) code is a traditional *O-spec* or *printed report* program, written for IBM i (AS/400, iSeries) in fixed-format (columns-based) RPG/400.  
It prints a report of system users, pulling data from a user master file and writing it to a printer file.

---

## Header and Program Metadata

```rpg
h option(*nodebugio) datedit(*dmy)
```
- `option(*nodebugio)` disables debug IO.
- `datedit(*dmy)` specifies day-month-year date formatting.

The long comment block provides program/maintenance history and documentation in Norwegian.  
- "Utskrift av systembrukere" = "Printout of system users."
- Author: RHO, created in August 1994.

---

## Indicator Usage

Indicators are standard in old RPG:
- `LR` - End of program.
- 60-69, 70-79, ...95-99 - File and subroutine work indicators.

---

## File Declarations

```rpg
fausrl1    if   e           k disk
far022p    o    e             printer
```
- `ausrl1` is an input keyed disk file (likely user master).
- `ar022p` is an output printer file (for report).

---

## Data Structures and Variables

```rpg
d hlp             s              1    dim(40)     Hjelp-array (help array, not used)
d w_ovfl          s              1  0             Overflow indicator (numeric, 0 decimal)
```
- `hlp` is an array of 40 single characters (likely unused in code).
- `w_ovfl` is a 1-digit integer for overflow control.

---

## Report Format Sections (O-specs)

Comments document the output format names:
- **A1HDR**: Report Heading
- **D1DET**: Detail Line
- **T1TOT**: Totals Line

---

## Main Program Logic

### 1. Write Report Heading

```rpg
c                   write     a1hdr
```
- Writes the heading section at the start.

### 2. Detail Lines Loop

```rpg
c                   dou       *in15 = *on
   c                   exsr      xovfd1
   c                   add       1             t1anta
   c                   write     d1det                                30
   c                   if        *in30 = *on
   c                   eval      w_ovfl = 1
   c                   endif
   c                   if        w_ovfl = 1
   c                   write     a1hdr
   c                   eval      w_ovfl = *zero
   c                   endif
   c                   read      ausrl1                                 15
c     xslutt        tag
c                   enddo
```

- **DOU loop** runs until indicator 15 is set ON. (Set by `READ ausrl1 ... 15` when EOF.)
- `exsr xovfd1` runs subroutine to map fields from file to print variables.
- Increments `t1anta` (count of lines/users).
- `write d1det 30` outputs the current detail line.
- If line count overflow indicator `*in30` is on, set `w_ovfl = 1`.
- If overflow (`w_ovfl=1`), print new heading (`a1hdr`) and reset overflow.
- `read ausrl1 15` reads next record, sets *in15 on EOF.
- Ends on EOF.

---

### 3. Print Totals

```rpg
c                   write     t1tot                                30
```
- Writes a totals line (likely including number of users printed).

### 4. Program End

```rpg
c                   eval      *inlr = *on
```
- Sets Last Record indicator to end program, triggering RPG's program cleanup.

---

## Subroutines

### A. **xovfd1** - Transfer File Fields to Print Fields

```rpg
c     xovfd1        begsr
   c                   movel     abuser        d1user
   c                   movel     abnavn        d1navn
   c                   movel     abtlfn        d1tlfn
   c                   movel     abmeny        d1meny
   c                   movel     absfil        d1sfil
   c                   movel     absbib        d1sbib
   c                   z-add     absfir        d1sfir
   c                   z-add     absavd        d1savd
   c                   movel     abfnav        d1fnav
   c                   movel     abbfil        d1bfil
   c                   movel     abbfir        d1bfir
   c                   movel     abbavd        d1bavd
   c                   movel     aba4s3        d1a4s3
   c                   movel     abrlib        d1rlib
c                   endsr
```
- For each detail record, moves or adds fields from `ausrl1` file to report variables used in `d1det` print line.

### B. **INZSR** - Initialization Subroutine

```rpg
c     *inzsr        begsr
   c                   eval      w_ovfl = *zero
   c                   eval      t1anta = *zero
   c                   read      ausrl1                                 15
c                   endsr
```
- Resets overflow and user count variables.
- Reads first record from file (indicator 15 set if EOF).

---

## Summary 

- This RPG/400 program prints a report of system users from file `AUSR1`.
- It outputs a heading, detail lines for each user, and a totals line.
- Handles page overflow â€” prints new headings as needed.
- Uses traditional RPG techniques: indicators, subroutines, O-spec printer files.
- Code is well-documented (in Norwegian), useful for onboarding or maintenance.