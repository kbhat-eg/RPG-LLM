```markdown
# FU704R: Log Lookup Program

This RPG ILE program retrieves a record from a log file (`flogl1`) based on an input code and returns whether the code exists, plus associated metadata.

---

## 1. File Definition

- **File:** `flogl1` (renamed from `flogpfr`)
- **Organization:** Keyed (`K`)
- **Disk file**, no debugging I/O, dates in *DMY* format.

---

## 2. Parameter Definitions

These `D` specs define the incoming and outgoing parameters:

- **Input parameters**  
  • `p_aarr` – Year code  
  • `p_numm` – Number code  
  • `p_suff` – Suffix  
  • `p_kode` – Main code  

- **Output parameters**  
  • `p_svar` – Found-flag: `'J'` or blank  
  • `p_date` – Date of log entry  
  • `p_time` – Time of log entry  
  • `p_user` – User from log entry  
  • `p_wsid` – Workstation ID from log entry  

All parameters are `LIKES` of corresponding fields from the file.

---

## 3. Local Data Area (LDA)

- **`l_firm`** (positions 944–946) holds a company identifier.
- **`l_user`**, **`l_wsid`** store default user/workstation values.

These are accessed via the *User Data Structure* named `uds`.

---

## 4. Key Variables for File Access

Before reading, the program initializes these variables to build the retrieval key:

- `flogl1_aarr, flogl1_numm, flogl1_suff, flogl1_kode`
- `flogl1_date, flogl1_time` (set to *HIVAL* to start at the top of that key range)

And a work variable:

- `w_firm` ← `l_firm`

---

## 5. Main Logic Flow

1. **`EXSR hent_logg`**  
   Calls the subroutine that performs the keyed read.
2. **`GOTO avslutt`**  
   Skips to cleanup.
3. **`avslutt`**  
   Sets `*INLR = *ON` and `RETURN` to end the program.

---

## 6. Subroutine: `hent_logg`

```rpg
begsr hent_logg;
  // 1. Initialize output flag
  eval p_svar = *BLANK;

  // 2. Prepare key fields
  eval flogl1_aarr = p_aarr;
  eval flogl1_numm = p_numm;
  eval flogl1_suff = p_suff;
  eval flogl1_kode = p_kode;
  eval flogl1_date = *HIVAL;
  eval flogl1_time = *HIVAL;

  // 3. Position to the first record matching the code key
  flogl1_key setll flogl1r;
  readp flogl1r;

  // 4. If end-of-file, exit with blank flag
  if %eof;
    eval p_svar = *BLANK;
    goto end_sr;
  endif;

  // 5. If the record exactly matches all input fields
  if fuaarr = p_aarr and
     funumm = p_numm and
     fusuff = p_suff and
     fukode = p_kode;
    eval p_svar  = 'J';           // Found flag
    eval p_date  = fudate;        // Log date
    eval p_time  = futime;        // Log time
    eval p_user  = fuuser;        // Username
    eval p_wsid  = fuwsid;        // Workstation ID
  endif;

end_sr;
endsr;
```

- **Keyed read (`SETLL` + `READP`)** positions the file cursor.  
- If the record matches exactly, output parameters are populated.

---

## 7. Subroutine: `*INZSR` (Initialization)

Although not fully shown, it does two things:

1. **`PLIST`** — Defines the parameter list for the module entry point.  
2. **`KLIST`** — Sets up the same key fields for file access, including `w_firm = l_firm`.

This ensures that on module initialization, the key template is in place.

---

### Summary

- The program accepts a composite code (year, number, suffix, code).  
- It looks up this key in the `flogl1` log file.  
- If found, it returns `'J'` along with the date, time, user, and workstation of the log entry.  
- Otherwise, it returns blank in `p_svar`.  
- Cleanup is handled by setting `*INLR` to *ON* and returning.