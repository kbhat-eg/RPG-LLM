     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASLAGR
      * Program . . . . : LI100R
      * Beskrivelse . . : Behandling av innkomne EDI-meldinger
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
5.40  *       250107 bof  Hvis oppd.og best.oppd.før gir melding.
      * 6.10  170609 BSA  Oppdatert med sporingsinformasjon
6.11  * 6.10  151209 BSA  Lagt inn funksjonalitet fra Mestergruppen. Lister ønsket
      *                   informasjonsstype. Leser fra ny indeks.
6.12  * 6.10  281209 BSA  Endret i ryddefunksjon. Sletter kun G og S merkede poster
      *                   til angitt dato.
6.13  * 6.10  100610 BSA  Oppdaterer med slette/godkjent kode
6.14  * 6.10  190710 BSA  Problemer med scrolling.
6.15  * 6.10  050413 bsa  Ved manuell godkjenning, skal ikke status på linjene endres.
6.20  * 6.20  190311 NHO  Begrense muligheter ved valg vedr EDI
6.21  * 6.20  060411 bsa  Legger ut kode for direktelevering
6.22  * 6.20  060511 bsa  Mulighet for filter på direktelevering, FAKT/KRED
6.23  * 6.20  060511 bsa  Ved rekontroll av slettede meldinger, skal den reaktiveres.
6.24  * 6.20  090511 bsa  Mulig for å velge alle typer (S,G,' ' og A)
6.25  * 6.20  260911 nho  'Tillat BLANK' dersom alle parametere over
6.25  *                   = 1
6.26  * 6.20  120312 bsa  Kan ikke definere file som "uf" når den ikke skal
6.26  *                   oppdateres. Flere like brukere kan ikke gå inn i programmet
6.27  * 6.20  130312 bsa  Innført lesemodus på EDI behandlingsbildet
6.28  * 6.20  150312 bsa  Hvis lesemodus, skal det ikke være tilgangskontroll
6.29  * 6.20  080313 bsa  Nullstille leverandørnavn
6.2a  * 6.20  240513 bsa  Bruker feil felt
6.nu  * 6.30  280514 bof  Rettelser i hht. nummerutidelse
6.30  * 6.30  070814 bsa  Utvidet muligheter for filtrering. Lager baseres
6.30  *                   på GLN nummer på 100001 rec. Slår opp mot log.pkt
6.30  *                   og ser om den matcher. Filtreres på varemottatt
6.31  * 6.30  030914 bsa  Sjekker mot matching av ordre, om dette skal gjøres
6.31  *                   ved avslutning.
6.32  * 6.30  030315 bsa  Flagger feil hvis feil ved innlesing.
6.33  * 6.20  060616 bsa  Sjekker om innhenting av EDI meldinger pågår.
6.34  * 6.30  280917 bsa  Endrer sjekk på kreditnota
      *
7.xx  * 6.30  200116 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
7.01  * 6.30  200318 bkv  Newlook takler ikke blank, bruker U eller 0
7.02  * 7.00  140819 bsa  Utvidet skjermbilde og legger ut leveringsdato.
7.03  * 7.00  150819 bkv  Lagt på statustekst og forfalsdato
7.04  * 7.00  201019 bsa  Finner lager fra DP, og sender med som filter-
7.04  *                   verdi. Gipling
7.05  * 6.20  230816 bsa  Legger til, fakturaleverandør ved filtrering
7.06  * 7.00  030221 bsa  Må også kalle LO570 med riktige parametre
7.06  * 7.00              uavhengig av om switch er satt.
      *
8.01  * 8.00  030221 bsa  Utvidet meldingsnummer fra 6 - 8 siffer
8.02  * 8.00  130821 bsa  Må også kalle LO570 med riktige parametre
8.02  * 8.00              Hvis 7.04 slår til, legges lager i første
8.02  * 8.00              lager.
8.03  * 8.00  060921 bsa  Innfører beløpskontroll
8.04  * 8.00  070921 bsa  Skal ikke sette lager til 0, da det kan
8.04  * 8.00              være at lager er manuelt satt som filter.
8.05  * 8.00  070921 bsa  Hvis ikke lager finnes via EDI meldinga,
8.05  * 8.00              beholder vi lager fra filter. Denne settes
8.05  * 8.00              også ved retur.
8.06  * 8.00  270122 bsa  Innfører filtrering på statuskode.
8.07  * 8.00  100222 bsa  Henter avdeling fra brukeren og filtrerer på det.
8.07  * 8.00              Styres av switch
8.08  * 8.00  210222 bof  Feilretting i kall til LI166R
8.09  * 8.00  020425 bsa  Lager mer effektiv sletting av gamle poster.
8.10  *K0000  130525 bsa  Fjerner mulighet for godkjenning av bestillinger med
8.10  *K0000              "feil" ordretype.
8.11  * 8.00  140525 bsa  Feil tolking av datofelt for sletting av gamle
8.11  * 8.00              poster i cloud. Kun endringer i dds.
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = avslutt
      *       10 = Roll
      *       12 = Sfldsp
      *       13 = Sfldspctl
      *       14 = Sflclr
      *       15 = Sflend
      *       16 = Readc 16 on, no more records
      *       21 = Home-key
      *       22 = Plassering av cursor
      *       30 = Protect av felter ved vise
      *    31-79 = Varsle m/feilmeldinger/skjermindikatorer
      *    80-89 = Arbeidsindikatorer
      *    90-99 = Fileindikatorer chain etc.
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.11 fledil1    if   e           k disk    rename(ledipfr:ledil1r)
6.11 fledil5    if   e           k disk    rename(ledipfr:ledil5r)
     fledilr    if   e           k disk    rename(ledipfr:ledilrr)
     fledilu    uf   e           k disk    rename(ledipfr:ledilur)
     frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
     frlevl5    if   e           k disk    rename(rlevpfr:rlevl5r)
     flohelr    if   e           k disk    rename(lohepfr:lohelrr)
6.21 ffohelr    if   e           k disk    rename(fohepfr:fohelrr)
6.31 ffohel1    if   e           k disk    rename(fohepfr:fohel1r)
     fvotylr    if   e           k disk    rename(votypfr:votylrr)
6.20 flstsl1    if   e           k disk    rename(lstspfr:lstsl1r)
6.26 f*usrl1    uf a e           k disk    rename(lusrpfr:lusrl1r)
6.26 flusrl1    if   e           k disk    rename(lusrpfr:lusrl1r)
6.30 fmjlolr    if   e           k disk    rename(mjlopfr:mjlol1r)
7.04 fmjlol2    if   e           k disk    rename(mjlopfr:mjlol2r)
6.31 flsbol1    if   e           k disk    rename(lsbopfr:lsbol1r)
6.32 felogl3    uf   e           k disk    rename(elogpfr:elogl3r)
8.07 fra10lx    if   e           k disk    rename(ra10pfr:ra10lxr)
      *
     fli100d    cf   e             workstn sfile(b1sfl:w_srrn)
     f                                     infds(dspfbk)
      *
      * Definering av LDA
      *
     d                uds
6.27 d l_vise                700    700
6.10 d l_user                911    920
7.04 d l_filg                931    933
     d l_firm                944    946  0
8.07 d l_avde                944    946  0
     d l_fnav                951    980
6.20 d lusrl1_user     s                   like(lbuser)
      *
      * Definering av Information Data Structure - display feedback
      *
     d dspfbk          ds
     d  d_fkey               369    369
     d  d_srow               370    370I 0
     d  d_scol               371    371I 0
     d  d_fcrn               378    379I 0
      *
      * Parameter-ut
      *
     d                 ds
8.01 d d_prec                        22
     d  d_firm                        3  0 overlay(d_prec)
     d  d_type                        4    overlay(d_prec:4)
8.01 d  d_mnum                        8  0 overlay(d_prec:8)
8.01 d  d_mlin                        6  0 overlay(d_prec:16)
8.01 d  d_kode                        1    overlay(d_prec:22)
8.03  *
8.03  * Parameter-ut
8.03  *
8.03 d                 ds
8.03 d x_prec                        32
8.03 d  x_firm                        3  0 overlay(x_prec)
8.03 d  x_type                        4    overlay(x_prec:4)
8.03 d  x_mnum                        8  0 overlay(x_prec:8)
8.03 d  x_mlin                        6  0 overlay(x_prec:16)
8.03 d  x_biln                        8  0 overlay(x_prec:22)
8.03 d  x_kode                        1    overlay(x_prec:30)
8.03 d  x_ekod                        1    overlay(x_prec:31)
      *
      * FAKTURA Hode
      *
     d d_fakh1         ds
     d  d_fh_dtyp                     3
     d  d_fh_fanr                    35
     d  d_fh_fako                     3
     d  d_fh_ldat                      d   datfmt(*iso)
     d  d_fh_best                    20
     d  d_fh_lord                    20
     d  d_fh_lfak                    20
     d  d_fh_sean                    13  0
     d  d_fh_snav                    30
     d  d_fh_fean                    13  0
     d  d_fh_fnav                    30
     d  d_fh_fad1                    30
     d  d_fh_fad2                    30
     d  d_fh_fste                    30
     d  d_fh_forg                    20
     d  d_fh_kref                    20
     d  d_fh_lref                    20
     d  d_fh_valk                     3
     d  d_fh_ffda                      d   datfmt(*iso)
     d  d_fh_levb                     3
     d  d_fh_forf                      d   datfmt(*iso)
6.30 d  d_fh_bean                    13  0
6.30 d  d_fh_beaa                    13    overlay(d_fh_bean)
      *
      * Partsinfo
      *
     d                 ds
     d d_pinf                       400
     d  d_part                        3    overlay(d_pinf)
     d  d_pean                       13  0 overlay(d_pinf:4)
     d  d_pnav                       30    overlay(d_pinf:17)
     d  d_pad1                       30    overlay(d_pinf:47)
     d  d_pad2                       30    overlay(d_pinf:77)
     d  d_pste                       30    overlay(d_pinf:107)
     d  d_porg                       20    overlay(d_pinf:137)
      *
      * Fakturatotaler
      *
     d d_fakt          ds
     d  d_ft_ftot                    15  2
     d  d_ft_teks                    15  2
     d  d_ft_tmva                    15  2
     d  d_ft_mvgr                    15  2
     d  d_ft_veks                    15  2
     d  d_ft_vink                    15  2
     d  d_ft_stil                    15  2
     d  d_ft_sfra                    15  2
      *
      * ORDREBEKREFTELSE Hode
      *
     d d_obkh          ds
     d  d_oh_obnr                    35
     d  d_oh_olda                      d   datfmt(*iso)
     d  d_oh_llda                      d   datfmt(*iso)
     d  d_oh_sean                    13  0
     d  d_oh_bean                    13  0
6.30 d  d_oh_beaa                    13    overlay(d_oh_bean)
     d  d_oh_fean                    13  0
     d  d_oh_kref                    30
     d  d_oh_aksp                     3
     d  d_oh_valk                     3
     d  d_oh_ttyp                     3
     d  d_oh_fmat                     3
     d  d_oh_lbet                     3
     d  d_oh_lste                    13  0
     d  d_oh_txt1                    70
     d  d_oh_txt2                    70
     d  d_oh_txt3                    70
      *
      * ORDREBEKREFTELSE Ordretotaler
      *
     d d_obks          ds
     d  d_os_suml                    17  2
     d  d_os_ntot                    17  2
     d  d_os_mvag                    17  2
     d  d_os_mvat                    17  2
     d  d_os_btot                    17  2
     d  d_os_tilt                    17  2
     d  d_os_frat                    17  2
      *
      * Definering av variabler i nøkler
      *
6.11 d ledil5_kode     s                   like(likode)
6.11 d ledil5_type     s                   like(litype)
6.11 d ledil5_mnum     s                   like(limnum)
6.11 d ledil5_mlin     s                   like(limlin)
     d ledil1_type     s                   like(litype)
     d ledil1_mnum     s                   like(limnum)
     d ledil1_mlin     s                   like(limlin)
     d ledilr_type     s                   like(litype)
     d ledilr_mnum     s                   like(limnum)
     d ledilu_type     s                   like(litype)
     d ledilu_mnum     s                   like(limnum)
     d ledilu_mlin     s                   like(limlin)
     d rlevl1_levr     s                   like(rllevr)
     d rlevl5_eanl     s                   like(rleanl)
     d lohelr_numm     s                   like(lonumm)
     d lohelr_suff     s                   like(losuff)
     d votylr_otyp     s                   like(vaotyp)
6.21 d fohelr_numm     s                   like(fonumm)
6.30 d mjlolr_lage     s                   like(mjlage)
6.30 d mjlolr_avde     s                   like(mjavde)
6.31 d fohel1_numm     s                   like(fonumm)
6.31 d fohel1_suff     s                   like(fosuff)
6.32 d elogl3_faar     s                   like(xlfaar)
6.32 d elogl3_type     s                   like(xltype)
6.32 d elogl3_mnum     s                   like(xlmnum)
7.04 d mjlol2_eann     s                   like(mjeann)
8.07 d ra10lx_javd     s                   like(rajavd)
      *
      * Definering av variable
      *
     d w_fcrn          s              4  0
     d w_stel          s              4  0
     d w_spge          s              4  0
     d w_srrn          s              4  0
     d w_sfrn          s                   like(w_srrn)
     d w_ssrn          s                   like(w_srrn)
      *
     d b_forn          s              1    inz(*off)
     d b_anul          s              1    inz(*off)
     d b_feil          s              1    inz(*off)
     d b_alle          s              1    inz(*off)
     d b_snav          s              1    inz(*off)
     d b_sfak          s              1    inz(*off)
     d b_sbes          s              1    inz(*off)
6.12 d b_slet          s              1    inz(*off)
6.24 d b_blank         s              1    inz(*off)
6.30 d b_read          s              1    inz(*off)
6.31 d b_synk          s              1    inz(*off)
6.31 d b_updo          s              1    inz(*off)
      *
     d w_firm          s                   like(lifirm)
6.11 d w_kode          s                   like(likode)
     d w_type          s                   like(litype)
     d w_utty          s                   like(litype)
     d w_dato          s                   like(limdat)
     d w_mnum          s                   like(limnum)
     d w_stat          s                   like(listat)
     d w_retn          s              2  0
     d w_pste          s             30
     d w_avde          s              4  0
     d w_prec          s             45
     d w_besk          s             30
     d w_kred          s              3
     d w_numm          s                   like(lonumm)
     d w_suff          s                   like(losuff)
     d w_nump          s                   like(linumm)
     d w_sufp          s                   like(lisuff)
     d w_ldor          s                   like(loldor)
     d w_modu          s             10    inz('NED     ')
     d w_disp          s              1    inz('1')
     d w_tilg          s              1
     d w_snav          s             24
     d w_sfak          s             35
     d w_sbes          s             20
     d w_mdat          s                   like(limdat)
     d w_line          s              5  0
6.nu d w_benr          s                   like(lonumm)
     d w_lpro          s              1
     d w_errk          s              2
6.30 d w_eann          s                   like(mjeann)
6.30 d w_ean2          s                   like(mjeann)
6.30 d w_ean3          s                   like(mjeann)
6.30 d w_ean4          s                   like(mjeann)
6.30 d w_ean5          s                   like(mjeann)
6.30 d w_ltxt          s             20
6.31 d w_acok          s              1
6.33 d w_navn          s             10
6.33 d w_hent          s              1
6.33 d w_con1          c                   '*** EDI innhenting pågår *** '
6.33 d w_con2          c                   'Vent og prøv igjen senere.   '
6.33 d w_ctl1          s              2  0
6.33 d w_ctpo          s              3  0
6.33 d w_mld1          s             30
6.33 d w_mld2          s             30
6.33 d w_cmd           s            256
6.33 d w_len           s             15  5
6.33 d w_jsta          s              2  0
6.33 d w_onof          s              1  0
7.04 d w_lage          s              2  0
7.05 d w_fldo          s                   like(lildor)
8.03 d y_prec          s             32
8.09 d w_skod          s                   like(likode)
      *
8.05 d s_lage          s                   like(mjlage)
      *
7.04 d u_704           s              1    inz(*off)
8.07 d u_807           s              1    inz(*off)
      *
6.32 d p_stat          s              1
7.00  *
7.00  * Definering av eksterne prg
7.00  *
7.00   dcl-s co402_verdi1  char(1);
7.00   dcl-s co402_verdi2  char(2048);
7.00   DCL-PR CO402R EXTPGM('CO402R');
7.00     p_filgrp            char(3)     const;
7.00     p_firm              packed(3:0) const;
7.00     p_lager             packed(2:0) const;
7.00     p_nokkel            char(50)    const;
7.00     p_verdi1            char(1);
7.00     p_verdi2            char(2048);
7.00   END-PR;
      *
      * Definering av konstanter
      *
7.02 d c_sfil          s              2  0 inz(17)
      *
     d lo              c                   'abcdefghijklmnopqrstuvwxyzæøåäö'
     d up              c                   'ABCDEFGHIJKLMNOPQRSTUVWXYZÆØÅÄÖ'
      *
      *
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      * w_srrn - Relativt recordnummer i subfile
      * w_spge - Sidestørrelse i subfile (page)
      * w_sfrn - Første recordnummer på siden
      * w_ssrn - Siste  recordnummer på siden
      * w_virn - Vis den side som inneholder denne record.
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      * A1BLD  - A1 Valg av meldingstype
      * B1SFL  - B1 Subfile - record
      * B2CTL  - B2 Subfile - control record
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      * B4WIN  - B4 Vindu for slette (Delete)
      * F1BLD  - F1 Søke på meldingstype
      * H1WIN  - H1 Vindu for angivelse av søkefilter
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * A1BLD Sjekk om meldingstype er fast eller skal velges
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
8.09 c/exec sql
8.09 c+ SET OPTION DatFmt=*ISO,
8.09 c+            SRTSEQ=*LANGIDUNQ,
8.09 c+            LANGID=NOR,
8.09 c+            commit=*none
8.09 c/end-exec
      *
      * Kontrollerer gyldig tilgang
      *
     c                   call      'AX700R'
     c                   parm                    w_modu
     c                   parm                    w_disp
     c                   parm                    w_tilg
      *
     c                   if        w_tilg = '1'
     c                   goto      end_pgm
     c                   endif
      *
     c                   if        w_type = *blank
     c                   eval      a1type = *blank
      *
     c     a1tagb        tag
     c                   exfmt     a1bld
      *
      * Behandling av funksjonstaster
      *
     c                   select
     c                   when      *inkc or *inkl
     c                   goto      end_pgm
     c                   when      *inkd
     c                   exsr      finn_type
     c                   eval      a1type = w_type
     c                   goto      a1tagb
     c                   endsl
     c                   eval      w_type = a1type
     c                   endif
6.28  * Ikke kjør sjekk hvis bruker er i lesemodus
6.28 c                   if        *in79 = *off
6.20  * Sjekk vedr. EDI skal kun skje dersom det ligger  1  på
6.20  * firmaregisteret
6.20 c     lstsl1_key    chain     lstsl1
6.20 c                   if        laaeds = 1
6.20  *
6.20 c     lusrl1_key    chain     lusrl1
6.20  *
6.20  * Test OBKR/EDI
6.20 c                   if        %found
6.20  *
6.25  * Test om det er lov til å ha blank
6.25 c                   if        a1type = *blank
6.25 c                   if        lbko05 = 1 and
6.25 c                             lbko06 = 1 and
6.25 c                             lbko07 = 1 and
6.25 c                             lbko08 = 1
6.25 c                   eval      *in43  = *off
6.25 c                   else
6.25 c                   eval      *in43  = *on
6.25 c                   endif
6.25 c                   endif
6.25  *
6.20 c                   if        lbko05 = 0 and
6.20 c                             a1type = 'OBKR'
6.20 c                   eval      *in39 = *on
6.20 c                   goto      a1tagb
6.20 c                   endif
6.20  *
6.20  * Test FAKT/EDI
6.20 c                   if        lbko06 = 0 and
6.20 c                             a1type = 'FAKT'
6.20 c                   eval      *in40 = *on
6.20 c                   goto      a1tagb
6.20 c                   endif
6.20  * Test PAKK/EDI
6.20 c                   if        lbko07 = 0 and
6.20 c                             a1type = 'PAKK'
6.20 c                   eval      *in41 = *on
6.20 c                   goto      a1tagb
6.20 c                   endif
6.20  * Test ORDR/EDI
6.20 c                   if        lbko08 = 0 and
6.20 c                             a1type = 'ORDR'
6.20 c                   eval      *in42 = *on
6.20 c                   goto      a1tagb
6.20 c                   endif
6.20  * Test BLANK/EDI
6.20 c*6.25              if        lbko09 = 0 and
6.20 c*6.25                        a1type = *blank
6.20 c*6.25              eval      *in43 = *on
6.20 c*6.25              goto      a1tagb
6.20 c*6.25              endif
6.20  *
6.25 c                   if        *in43  = *on
6.25 c                   goto      a1tagb
6.25 c                   endif
6.25  *
6.20 c                   endif
6.20 c                   endif
      *
6.28 c                   endif
      *
      * Posisjonerer databasen, og fyller opp subfile
      *
6.11 c*                  eval      ledil1_type = w_type
6.11 c*                  eval      ledil1_mnum = 0
6.11 c*    ledil1_key    setll     ledil1
6.11  *
6.11 c                   eval      w_kode = ' '
6.11 c                   eval      ledil5_kode = w_kode
6.11 c                   eval      ledil5_type = w_type
6.11 c                   eval      ledil5_mnum = 0
6.11 c     ledil5_key    setll     ledil5
      *
     c                   exsr      crt_subfile
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B2CTL Behandle åpningsbildet med subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Send Alt
      *
     c     b2taga        tag
     c                   write     b2cmd
      *
      * Bare data
      *
     c     b2tagb        tag
     c                   exsr      dsp_subfile
      *
      * Behandling av funksjonstaster
      *
     c                   select
     c                   when      *inka
     c                   exsr      xh1win
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *inkc or *inkl
     c                   goto      end_pgm
     c                   when      *inke
     c                   eval      w_fcrn = *zero
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *inkg
6.11 c                   exsr      xh2win
     c                   exsr      forny
     c                   goto      b2taga
6.32 c                   when      *inkh
6.32 c                   call      'LI120R'
6.32 c                   exsr      forny
6.32 c                   goto      b2tagb
     c                   when      *inki
     c                   exsr      hent_meld
6.33 c                   if        w_hent <> *blanks
6.33 c                   goto      b2taga
6.33 c                   endif
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *inkj
     c                   exsr      xb10win
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *inkm
     c                   exsr      xb13win
     c                   goto      b2tagb
     c                   when      *inkn
     c                   exsr      xb14win
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *inkp
     c                   exsr      xb15win
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *in10
     c                   exsr      crt_subfile
     c                   goto      b2tagb
     c                   when      *in11
     c                   exsr      bck_subfile
     c                   goto      b2tagb
     c                   endsl
      *
      * Behandling av subfile
      *
     c                   exsr      subfile
     c                   if        b_forn = *on
     c                   exsr      forny
     c                   endif
      *
     c                   goto      b2taga
      *
      * Avslutt program
      *
     c     end_pgm       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for fornying av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     forny         begsr
      *
6.24 c                   if        b_alle = *on
6.24 c                   eval      ledil5_kode = ' '
6.24 c                   else
6.11 c                   eval      ledil5_kode = w_kode
6.24 c                   endif
      *
     c                   if        w_fcrn <> 0
     c     w_fcrn        chain     b1sfl
6.11 c*                  eval      ledil1_type = b1type
6.11 c*                  eval      ledil1_mnum = b1mnum
6.11 c                   eval      ledil5_type = b1type
6.11 c                   eval      ledil5_mnum = b1mnum
     c                   else
6.11 c*                  eval      ledil1_mnum = 0
6.11 c                   eval      ledil5_mnum = 0
     c                   endif
      *
6.11 c*    ledil1_key    setll     ledil1
6.11 c     ledil5_key    setll     ledil5
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
     c                   eval      b_forn = *off
      *
     c     end_forny     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     subfile       begsr
      *
     c                   eval      b_forn = *off
      *
      * Beholder eksisterende posisjonering i subfilen
      *
     c*                  if        w_curn > 0
     c*                  eval      w_virn = w_curn
     c*                  endif
     c                   eval      w_virn = w_fcrn
      *
      * Leser og behandler subfile
      *
     c                   do        w_ssrn
     c                   readc     b1sfl
      *
     c                   if        %eof
     c                   leave
     c                   endif
      *
     c                   eval      w_virn = w_srrn
      *
      * Ikke lovlige aksjoner på oppdatert melding
      *
     c                   if        b1stat = '9'
     c                   if        b1valg <> 5
     c                   if        b1valg <> 6
     c                   eval      b1valg = 0
     c                   endif
     c                   endif
     c                   endif
6.27  *
6.27  * Ikke lovlige aksjoner via lesemodus
6.27  *
6.27 c                   if        *in79 = *on
6.27 c                   if        b1valg <> 5
6.27 c                   if        b1valg <> 6
6.27 c                   eval      b1valg = 0
6.27 c                   endif
6.27 c                   endif
6.27 c                   endif
8.03  *
8.03  * Beløpsanalyse
8.03  *
8.03 c                   if        b1valg = 1
8.03 c                   exsr      xb1bld
8.03 c                   eval      b1valg = 0
8.03 c                   eval      b_forn = *on
8.03 c                   update    b1sfl
8.03 c                   iter
8.03 c                   endif
      *
      * Kjøre ny kontroll mot bestilling
      *
     c                   if        b1valg = 3
     c                   eval      w_nump = b1numm
     c                   eval      w_sufp = b1suff
     c                   exsr      ny_kontroll
     c                   eval      b1valg = 0
     c                   eval      b_forn = *on
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Slette melding
      *
     c                   if        b1valg = 4
     c                   exsr      xb4win
     c                   eval      b1valg = 0
     c                   eval      b_forn = *on
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Se på detaljer i melding
      *
     c                   if        b1valg = 5
     c                   exsr      xb5bld
     c                   eval      b1valg = 0
     c*                  eval      b_forn = *on
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Skrive ut papirkopi
      *
     c                   if        b1valg = 6
     c                   exsr      xb6bld
     c                   eval      b1valg = 0
     c*                  eval      b_forn = *on
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Manuelt godkjenne melding for oppdatering
      *
     c                   if        b1valg = 7
     c                   exsr      xb7win
     c                   eval      b1valg = 0
     c                   eval      b_forn = *on
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Oppdatere melding mot bestillingssystem
      *
     c                   if        b1valg = 8
     c                   exsr      xb8win
6.31  * Sjekk om det skal være matching mellom bestilling og ordre.
6.31 c                   exsr      xb8win2
     c                   eval      b1valg = 0
     c                   eval      b_forn = *on
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Søke etter bestilling på leverandør
      *
     c                   if        b1valg = 9
     c                   exsr      best_sok
     c                   eval      b1valg = 0
     c                   eval      b_forn = *on
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
     c                   enddo
      *
     c                   if        b_forn = *on
     c                   exsr      forny
     c                   endif
      *
     c     end_subfile   endsr
      *
8.03  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
8.03  * Subrutine for å se på detaljer i beløpsanalyse
8.03  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
8.03  *
8.03 c     xb1bld        begsr
8.03  *
8.03 c                   eval      x_firm = w_firm
8.03 c                   eval      x_type = b1type
8.03 c                   eval      x_mnum = b1mnum
8.03 c                   eval      x_mlin = b1mlin
8.03 c                   eval      x_biln = 0
8.03 c                   eval      x_kode = *blank
8.03 c                   eval      x_ekod = *blank
8.03  *
8.03 c                   eval      y_prec = x_prec
8.03  *
8.03 c                   if        b1type = 'FAKT'
8.03 c                   call      'LI166R'
8.08 c                   parm                    y_prec
8.03 c                   endif
8.03  *
8.03 c                   endsr
8.03  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å slette melding
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xb4win        begsr
      *
     c                   eval      *in30 = *off
     c                   eval      b4mdat = b1mdat
     c                   eval      b4suff = b1suff
     c                   eval      b4numm = b1numm
     c                   eval      b4levr = b1levr
     c                   eval      w_xrow = 6 + w_srrn
      *
     c                   if        b4suff <> 0
     c                   eval      *in30 = *on
     c                   endif
     c                   exfmt     b4win
      *
     c                   if        *inkc or *inkl
     c                   goto      end_xb4win
     c                   endif
      *
     c                   eval      ledilr_type = b1type
     c                   eval      ledilr_mnum = b1mnum
     c     ledilr_key    setll     ledilr
     c     ledilr_key    reade     ledilr
      *
     c                   dow       not %eof
      *
     c                   eval      ledilu_type = litype
     c                   eval      ledilu_mnum = limnum
     c                   eval      ledilu_mlin = limlin
     c     ledilu_key    chain     ledilu
     c                   if        %found
     c                   if        listat <> '9'
     c                   eval      listat = '7'
6.13 c                   eval      likode = 'S'
6.10 c                   time                    liedat
6.10 c                   time                    lietim
6.10 c                   eval      lieusr = l_user
     c                   update    ledilur
     c*                  delete    ledilur
     c                   endif
     c                   endif
      *
     c     ledilr_key    reade     ledilr
     c                   enddo
6.32  *
6.32  * Logger i fila at den er slettet og av hvem.
6.32  *
6.32 c                   eval      ledilu_type = b1type
6.32 c                   eval      ledilu_mnum = b1mnum
6.32 c                   eval      ledilu_mlin = 100001
6.32 c     ledilu_key    chain     ledil1
6.32 c                   if        %found
6.32 c                   eval      elogl3_faar = %subdt(limdat:*years)
6.32 c                   eval      elogl3_mnum = limnum
6.32 c                   eval      elogl3_type = litype
6.32 c     elogl3_key    chain     elogl3
6.32 c                   if        %found
6.32 c                   time                    xlavsd
6.32 c                   time                    xlavst
6.32 c                   eval      xlavsu = l_user
6.32 c                   update    elogl3r
6.32 c                   endif
6.32 c                   endif
      *
     c     end_xb4win    endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å se på detaljer i melding
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xb5bld        begsr
      *
     c                   eval      d_firm = w_firm
     c                   eval      d_type = b1type
     c                   eval      d_mnum = b1mnum
     c                   eval      d_mlin = b1mlin
     c                   eval      d_kode = *blank
     c                   eval      w_xrow = 6 + w_srrn
      *
     c                   eval      w_prec = d_prec
      *
     c                   if        d_type = 'OBKR'
     c                   call      'LI102R'
     c                   parm                    w_prec
     c                   end
      *
     c                   if        d_type = 'FAKT'
     c                   call      'LI106R'
     c                   parm                    w_prec
     c                   end
      *
     c     end_b5bld     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av filter-bildet (H1WIN)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xh1win        begsr
      *
     c                   if        h1sldo = *zero
     c                   eval      h1lnav = *blank
     c                   endif
7.05 c                   if        h1fldo = *zero
7.05 c                   eval      h1fnav = *blank
7.05 c                   endif
     c                   if        h1innk = *zero
     c                   eval      h1inav = *blank
     c                   endif
6.30  *
6.30 c                   if        h1lage = *zero
7.xx c**                 eval      h1ltxt = *blank
6.30 c                   endif
6.30  *
6.30 c                   if        h2lage = *zero
7.xx c**                 eval      h2ltxt = *blank
6.30 c                   endif
6.30  *
6.30 c                   if        h3lage = *zero
7.xx c**                 eval      h3ltxt = *blank
6.30 c                   endif
6.30  *
6.30 c                   if        h4lage = *zero
7.xx c**                 eval      h4ltxt = *blank
6.30 c                   endif
6.30  *
6.30 c                   if        h5lage = *zero
7.xx c**                 eval      h5ltxt = *blank
6.30 c                   endif
      *
7.01 c                   if        h1fakr = *blank
7.01 c                   eval      h1fakr = '0'
7.01 c                   endif
7.01 c                   if        h1vmot = *blank
7.01 c                   eval      h1vmot = '0'
7.01 c                   endif
      *
     c     h1taga        tag
     c                   exfmt     h1win
      *
7.01 c                   if        h1fakr = '0'
7.01 c                   eval      h1fakr = *blank
7.01 c                   endif
7.01 c                   if        h1vmot = '0'
7.01 c                   eval      h1vmot = *blank
7.01 c                   endif
      *
6.22 c                   eval      *in32 = *off
6.22 c                   eval      *in33 = *off
      *
     c                   if        *inkc or *inkl
     c                   goto      end_h1win
     c                   endif
      *
8.06 c                   if        *inke
8.06 c                   eval      h1sldo = 0
8.06 c                   eval      h1lnav = *blank
8.06 c                   eval      h1smda = 0
8.06 c                   eval      h1sfak = *blank
8.06 c                   eval      h1stat = *blank
8.06 c                   goto      h1taga
8.06 c                   endif
      *
     c                   if        *inkd
7.05 c                   if        w_afld = 'H1FLDO'
7.05 C                   call      'RL500R'
7.05 C                   parm                    w_firm
7.05 C                   parm                    h1fldo
7.05 C                   parm                    h1fnav
7.05 c                   endif
      *
     c                   if        w_afld = 'H1SLDO'
     C                   call      'RL500R'
     C                   parm                    w_firm
     C                   parm                    h1sldo
     C                   parm                    h1lnav
     c                   endif
      *
     c                   if        w_afld = 'H1INNK'
     c                   call      'RA509R'
     c                   parm                    w_firm
     c                   parm                    h1innk
     c                   parm                    h1inav
     c                   endif
6.30  *
6.30 c                   if        w_afld = 'H1LAGE'
6.30 c                   eval      w_ltxt = *blanks
6.30 c                   call      'RA510R'
6.30 c                   parm                    w_firm
6.30 c                   parm                    h1lage
6.30 c                   parm                    w_ltxt
7.xx c**                 movel     w_ltxt        h1ltxt
6.30 c                   endif
6.30  *
6.30 c                   if        w_afld = 'H2LAGE'
6.30 c                   eval      w_ltxt = *blanks
6.30 c                   call      'RA510R'
6.30 c                   parm                    w_firm
6.30 c                   parm                    h2lage
6.30 c                   parm                    w_ltxt
7.xx c**                 movel     w_ltxt        h2ltxt
6.30 c                   endif
6.30  *
6.30 c                   if        w_afld = 'H3LAGE'
6.30 c                   eval      w_ltxt = *blanks
6.30 c                   call      'RA510R'
6.30 c                   parm                    w_firm
6.30 c                   parm                    h3lage
6.30 c                   parm                    w_ltxt
7.xx c**                 movel     w_ltxt        h3ltxt
6.30 c                   endif
6.30  *
6.30 c                   if        w_afld = 'H4LAGE'
6.30 c                   eval      w_ltxt = *blanks
6.30 c                   call      'RA510R'
6.30 c                   parm                    w_firm
6.30 c                   parm                    h4lage
6.30 c                   parm                    w_ltxt
7.xx c**                 movel     w_ltxt        h4ltxt
6.30 c                   endif
6.30  *
6.30 c                   if        w_afld = 'H5LAGE'
6.30 c                   eval      w_ltxt = *blanks
6.30 c                   call      'RA510R'
6.30 c                   parm                    w_firm
6.30 c                   parm                    h5lage
6.30 c                   parm                    w_ltxt
7.xx c**                 movel     w_ltxt        h5ltxt
6.30 c                   endif
6.30  *
     c                   goto      h1taga
     c                   endif
      *
     c                   if        h1snav <> *blank
     c                   eval      h1snav = %trim(%xlate(lo:up:h1snav))
     c                   endif
      *
     c                   if        h1smda <> 0
     c     *dmy          test(d)                 h1smda                 31
     c                   if        *in31  = *on
     c                   goto      h1taga
     c                   endif
     c                   endif
      *
     c                   if        h1sfak <> *blank
     c                   eval      h1sfak = %trim(%xlate(lo:up:h1sfak))
     c                   endif
      *
     c                   if        h1sbes <> *blank
     c                   eval      h1sbes = %trim(%xlate(lo:up:h1sbes))
     c                   endif
6.30  * Finn GLN nummer til logistikkpunkt for filtrering av poster
6.30 c                   eval      w_eann = 0
6.30 c                   if        h1lage <> 0
6.30 c                   eval      mjlolr_lage = h1lage
6.30 c                   eval      mjlolr_avde = *zero
6.30 c     mjlolr_key    chain     mjlolr
6.30 c                   if        %found
6.30 c                   eval      w_eann = mjeann
6.30 c                   endif
6.30 c                   endif
6.30  *
6.30 c                   eval      w_ean2 = 0
6.30 c                   if        h2lage <> 0
6.30 c                   eval      mjlolr_lage = h2lage
6.30 c                   eval      mjlolr_avde = *zero
6.30 c     mjlolr_key    chain     mjlolr
6.30 c                   if        %found
6.30 c                   eval      w_ean2 = mjeann
6.30 c                   endif
6.30 c                   endif
6.30  *
6.30 c                   eval      w_ean3 = 0
6.30 c                   if        h3lage <> 0
6.30 c                   eval      mjlolr_lage = h3lage
6.30 c                   eval      mjlolr_avde = *zero
6.30 c     mjlolr_key    chain     mjlolr
6.30 c                   if        %found
6.30 c                   eval      w_ean3 = mjeann
6.30 c                   endif
6.30 c                   endif
6.30  *
6.30 c                   eval      w_ean4 = 0
6.30 c                   if        h4lage <> 0
6.30 c                   eval      mjlolr_lage = h4lage
6.30 c                   eval      mjlolr_avde = *zero
6.30 c     mjlolr_key    chain     mjlolr
6.30 c                   if        %found
6.30 c                   eval      w_ean4 = mjeann
6.30 c                   endif
6.30 c                   endif
6.30  *
6.30 c                   eval      w_ean5 = 0
6.30 c                   if        h5lage <> 0
6.30 c                   eval      mjlolr_lage = h5lage
6.30 c                   eval      mjlolr_avde = *zero
6.30 c     mjlolr_key    chain     mjlolr
6.30 c                   if        %found
6.30 c                   eval      w_ean5 = mjeann
6.30 c                   endif
6.30 c                   endif
6.30  * Kun 1 og 2 er gyldig valg (varemottatt)
6.30 c                   eval      *in33 = *off
6.30 c                   if        h1vmot  <> *blank and
6.30 c                             h1vmot  <> '1'    and
6.30 c                             h1vmot  <> '2'    and
6.30 c                             h1vmot  <> '3'
6.30 c                   eval      *in33 = *on
6.30 c                   goto      h1taga
6.30 c                   endif
6.22  * Kun 1 er gyldig valg
6.22 c                   eval      *in32 = *off
6.22 c                   if        h1dirk  <> *blank and
6.22 c                             h1dirk  <> '1'
6.22 c                   eval      *in32 = *on
6.22 c                   goto      h1taga
6.22 c                   endif
6.22  * Kun F/K er gyldig valg
6.22 c                   eval      *in33 = *off
6.22 c                   if        h1fakr  <> *blank and
7.xx c                             h1fakr  <> '0'    and
6.22 c                             h1fakr  <> 'F'    and
6.22 c                             h1fakr  <> 'K'
6.22 c                   eval      *in33 = *on
6.22 c                   goto      h1taga
6.22 c                   endif
      *
     c                   eval      w_fcrn = *zero
      *
     c     end_h1win     endsr
      *
6.11  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.11  * Subrutine for behandling av visningskode
6.11  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.11  *
6.11 c     xh2win        begsr
6.11  *
6.11 c                   eval      h2vise = w_kode
7.01 c                   if        h2vise = *blank
7.01 c                   eval      h2vise = 'U'
7.01 c                   endif
6.11 c     h2taga        tag
6.11 c                   exfmt     h2win
6.11  *
6.11 c                   if        *inkc or *inkl
6.11 c                   goto      end_h2win
6.11 c                   endif
6.11  *
6.11 c                   eval      w_kode = h2vise
7.01 c                   if        w_kode = 'U'
7.01 c                   eval      w_kode = *blank
7.01 c                   endif
6.11 c                   eval      w_fcrn = 0
6.14  *
6.14 c                   if        w_kode = *blank
6.14 c                   eval      b_blank = *on
6.14 c                   else
6.14 c                   eval      b_blank = *off
6.14 c                   endif
6.24 c                   if        w_kode = 'A'
6.24 c                   eval      b_alle = *on
6.24 c                   else
6.24 c                   eval      b_alle = *off
6.24 c                   endif
6.11  *
6.11 c     end_h2win     endsr
6.11  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å skrive ut papirkopi
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xb6bld        begsr
      *
7.xx c                   eval      b9dkop = *zero
7.xx c                   eval      b9avvk = *zero
     c                   eval      w_xrow = 6 + w_srrn
      *
     c     xb9ut         tag
     c                   exfmt     b9win
      *
     c                   if        *inkc or *inkl
     c                   goto      end_b6bld
     c                   endif
      *
     c                   eval      d_firm = w_firm
     c                   eval      d_type = b1type
     c                   eval      d_mnum = b1mnum
     c                   eval      d_mlin = b1mlin
     c                   eval      d_kode = *blank
      *
     c                   eval      w_prec = d_prec
      *
7.xx c                   if        b9dkop = 1
     c                   if        d_type = 'OBKR'
     c                   call      'LI601C'
     c                   parm                    w_prec
     c                   endif
      *
     c                   if        d_type = 'FAKT'
     c                   call      'LI605C'
     c                   parm                    w_prec
     c                   endif
     c                   endif
      *
7.xx c                   if        b9avvk = 1
     c                   call      'LI607C'
     c                   parm                    w_prec
     c                   endif
      *
6.32 c                   eval      ledilu_type = b1type
6.32 c                   eval      ledilu_mnum = b1mnum
6.32 c                   eval      ledilu_mlin = 100001
6.32 c     ledilu_key    chain     ledil1
6.32 c                   if        %found
6.32  *
6.32  * Logger i fila at den er skrevet og av hvem.
6.32  *
6.32 c                   eval      elogl3_faar = %subdt(limdat:*years)
6.32 c                   eval      elogl3_type = litype
6.32 c                   eval      elogl3_mnum = limnum
6.32 c     elogl3_key    chain     elogl3
6.32 c                   if        %found
6.32 c                   time                    xlskrd
6.32 c                   time                    xlskrt
6.32 c                   eval      xlskru = l_user
6.32 c                   update    elogl3r
6.32 c                   endif
6.32 c                   endif
      *
     c     end_b6bld     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for manuell godkjenning av melding
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xb7win        begsr
      *
     c                   eval      *in30 = *off
     c                   eval      b7mdat = b1mdat
     c                   eval      b7numm = b1numm
     c                   eval      b7suff = b1suff
     c                   eval      b7levr = b1levr
     c                   eval      b7utsk = *blank
     c                   eval      w_xrow = 6 + w_srrn
      *
     c                   if        b7suff <> 0
     c                   eval      *in30 = *on
     c                   endif
      *
     c     xb7ut         tag
     c                   exfmt     b7win
      *
     c                   if        *inkc or *inkl
     c                   goto      end_xb7win
     c                   endif
      *
     c                   if        b1stat = '2'
     c                   eval      *in31 = *on
     c                   goto      xb7ut
     c                   endif
      *
     c                   if        b7utsk = '1'
     c                   eval      d_firm = w_firm
     c                   eval      d_type = b1type
     c                   eval      d_mnum = b1mnum
     c                   eval      d_mlin = b1mlin
     c                   eval      d_kode = *blank
      *
     c                   eval      w_prec = d_prec
      *
     c                   call      'LI607C'
     c                   parm                    w_prec
     c                   endif
      *
     c                   eval      ledilr_type = b1type
     c                   eval      ledilr_mnum = b1mnum
     c     ledilr_key    setll     ledilr
     c     ledilr_key    reade     ledilr
      *
     c                   dow       not %eof
      *
     c                   eval      ledilu_type = litype
     c                   eval      ledilu_mnum = limnum
     c                   eval      ledilu_mlin = limlin
     c     ledilu_key    chain     ledilu
     c                   if        %found
6.15 c                   if        limlin = 100001
6.15 c                   eval      listat = '8'
6.15 c                   endif
6.10 c                   time                    liedat
6.10 c                   time                    lietim
6.10 c                   eval      lieusr = l_user
     c                   update    ledilur
     c                   endif
      *
     c     ledilr_key    reade     ledilr
     c                   enddo
      *
     c     end_xb7win    endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppdatering av bestilling
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xb8win        begsr
      *
8.10 c                   if        b1type = 'FAKT'
8.10 c                   eval      lohelr_numm = b1numm
8.10 c                   eval      lohelr_suff = b1suff
8.10 c     lohelr_key    chain     lohelr
8.10 c                   if        %found
8.10 c                   eval      votylr_otyp = lootyp
8.10 c     votylr_key    chain     votylr
8.10 c                   if        vaoakk <> 2
8.10 c                   eval      w_ctl1 = 4
8.10 c                   eval      w_ctpo = 44
8.10 c                   eval      w_ctpo = 44
8.10 c                   eval      w_mld1 = 'Bestillingen har feil ordretype'
8.10 c                   eval      w_mld2 = 'Kan ikke oppdateres'
      *
8.10 c                   call      'AA006C'
8.10 c                   parm                    w_ctl1
8.10 c                   parm                    w_ctpo
8.10 c                   parm                    w_mld1
8.10 c                   parm                    w_mld2
      *
8.10 c                   goto      end_xb8win
8.10 c                   endif
8.10 c                   endif
8.10 c                   endif
      *
     c                   eval      b8mdat = b1mdat
     c                   eval      b8numm = b1numm
     c                   eval      b8suff = b1suff
     c                   eval      b8levr = b1levr
     c                   eval      b8utsk = *blank
     c                   eval      w_xrow = 6 + w_srrn
      *
     c                   eval      *in30 = *off
     c                   if        b8suff <> 0
     c                   eval      *in30 = *on
     c                   endif
      *
     c     xb8ut         tag
     c                   exfmt     b8win
      *
     c                   if        *inkc or *inkl
     c                   goto      end_xb8win
     c                   endif
      *
      * sjekker om bestilling finnes og om behandlingskoder er riktig
      *
     c                   eval      lohelr_numm = b1numm
     c                   eval      lohelr_suff = b1suff
     c     lohelr_key    chain     lohelr
     c                   if        %found
     c                   eval      votylr_otyp = lootyp
     c     votylr_key    chain     votylr
     c                   if        vaoakk > 2
     c                   eval      *in32 = *on
     c                   goto      xb8ut
     c                   endif
     c                   else
     c                   eval      *in33 = *on
     c                   goto      xb8ut
     c                   endif
      *
     c                   if        b1stat <> ' ' and
     c                             b1stat <> '8'
     c                   eval      *in31 = *on
     c                   goto      xb8ut
     c                   endif
6.32  *
6.32 c                   if        b1stat = 'E'
6.32 c                   eval      *in31 = *on
6.32 c                   goto      xb8ut
6.32 c                   endif
      *
     c                   eval      d_firm = w_firm
     c                   eval      d_type = b1type
     c                   eval      d_mnum = b1mnum
     c                   eval      d_mlin = b1mlin
     c                   eval      d_kode = b8utsk
     c                   eval      w_prec = d_prec
      *
     c                   select
     c                   when      b1type = 'OBKR'
     c                   call      'LI710R'
     c                   parm                    w_prec
     c                   parm                    w_errk
     c                   when      b1type = 'FAKT'
     c                   call      'LI730R'
     c                   parm                    w_prec
     c                   parm                    w_errk
     c                   endsl
      *
     c                   if        w_errk <> *blank
     c                   exsr      sjk_errk
     c                   goto      xb8ut
     c                   endif
      *
     c                   if        w_errk = *blank
     c                   eval      ledilr_type = b1type
     c                   eval      ledilr_mnum = b1mnum
     c     ledilr_key    setll     ledilr
     c     ledilr_key    reade     ledilr
      *
     c                   dow       not %eof
      *
     c                   eval      ledilu_type = litype
     c                   eval      ledilu_mnum = limnum
     c                   eval      ledilu_mlin = limlin
     c     ledilu_key    chain     ledilu
     c                   if        %found
     c                   eval      listat = '9'
6.13 c                   eval      likode = 'G'
6.10 c                   time                    liedat
6.10 c                   time                    lietim
6.10 c                   eval      lieusr = l_user
     c                   update    ledilur
     c                   endif
      *
     c     ledilr_key    reade     ledilr
     c                   enddo
6.32  *
6.32  * Logger i fila at den er skrevet og av hvem.
6.32  *
6.32 c                   eval      ledilu_type = b1type
6.32 c                   eval      ledilu_mnum = b1mnum
6.32 c                   eval      ledilu_mlin = 100001
6.32 c     ledilu_key    chain     ledil1
6.32 c                   if        %found
6.32 c                   eval      elogl3_faar = %subdt(limdat:*years)
6.32 c                   eval      elogl3_type = litype
6.32 c                   eval      elogl3_mnum = limnum
6.32 c     elogl3_key    chain     elogl3
6.32 c                   if        %found
6.32 c                   time                    xlgodd
6.32 c                   time                    xlgodt
6.32 c                   eval      xlgodu = l_user
6.32 c                   update    elogl3r
6.32 c                   endif
6.32 c                   endif
     c                   endif
      *
     c     end_xb8win    endsr
      *
6.31  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.31  * Subrutine for sjekk om det skal synkes mellom bestilling og ordre
6.31  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.31  *
6.31 c     xb8win2       begsr
6.31  *
6.31 c                   eval      b_synk = *off
6.31 c                   eval      b_updo = *off
6.31  *
6.31  * Henter inn informasjon om synkronisering
6.31  *
6.31 c     lsbol1_key    chain     lsbol1
6.31 c                   if        %found
6.31 c                   if        laftyp = 'M' or
6.31 c                             laftyp = 'A'
6.31 c                   eval      b_synk = *on
6.31 c                   endif
6.31 c                   endif
6.31  *
6.31  * sjekker om bestilling finnes og om behandlingskoder er riktig
6.31  *
6.31 c                   if        b_synk = *on
6.31 c                   eval      lohelr_numm = b1numm
6.31 c                   eval      lohelr_suff = b1suff
6.31 c     lohelr_key    chain     lohelr
6.31 c                   if        %found
6.31 c                   eval      votylr_otyp = lootyp
6.31 c     votylr_key    chain     votylr
6.31 c                   if        vaoakk > 1
6.31 c                   eval      b_synk = *off
6.31 c                   endif
6.31 c                   else
6.31 c                   eval      b_synk = *off
6.31 c                   endif
6.31 c                   endif
6.31  *
6.31  * Sjekk at ordren fortsatt ligger inne
6.31  *
6.31 c                   if        b_synk = *on
6.31 c                   eval      fohel1_numm = loornr
6.31 c                   eval      fohel1_suff = loorsu
6.31 c     fohel1_key    chain     fohel1
6.31 c                   if        not %found
6.31 c                   eval      b_synk = *off
6.31 c                   endif
6.31 c                   endif
6.31  *
6.31  * Er det suffikser på ordren skal det ikke synkes opp
6.31  *
6.31 c                   if        b_synk = *on
6.31 c                   eval      fohel1_suff = 0
6.31 c                   eval      fohelr_numm = loornr
6.31 c     fohel1_key    setll     fohelr
6.31 c     fohelr_key    reade     fohelr
6.31 c                   dow       not %eof
6.31 c                   if        fosuff > 0
6.31 c                   eval      b_synk = *off
6.31 c                   endif
6.31 c     fohelr_key    reade     fohelr
6.31 c                   enddo
6.31 c                   endif
6.31  *
6.31  * Sjekk om du har tilgang til ordre
6.31  *
6.31 c                   if        b_synk = *on
6.31 c                   eval      w_acok = '1'
6.31 c                   call      'FO711R'
6.31 c                   parm                    w_firm
6.31 c                   parm                    loornr
6.31 c                   parm                    loorsu
6.31 c                   parm                    w_acok
6.31  *
6.31 c                   if        w_acok <> '1'
6.31 c                   eval      b_synk = *off
6.31 c                   endif
6.31 c                   endif
6.31  *
6.31  * Manuell endringe av linjer
6.31  *
6.31 c                   if        b_synk = *on
6.31 c                   eval      w_numm = lonumm
6.31 c                   eval      w_suff = losuff
6.31  * Manuell endring
6.31 c                   if        laftyp = 'M'
6.31 c                   call      'LO580R'
6.31 c                   parm                    w_firm
6.31 c                   parm                    w_numm
6.31 c                   parm                    w_suff
6.31  * Vi forusetter at det er gjort endringer. Skrur på endringsindikator
6.31 c                   eval      b_updo = *on
6.31 c                   else
6.31  *  Automatisk endring
6.31 c                   call      'LO586R'
6.31 c                   parm                    w_firm
6.31 c                   parm                    w_numm
6.31 c                   parm                    w_suff
6.31  *
6.31 c                   endif
6.31 c                   endif
6.31  *
6.31 c     end_xb8win2   endsr
6.31  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekk feilstatus fra oppdateringsprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjk_errk      begsr
      *
     c                   eval      *in35 = *off
     c                   eval      *in36 = *off
     c                   eval      *in37 = *off
     c                   eval      *in38 = *off
      *
     c                   if        b1type = 'OBKR'
     c                   if        w_errk = '1'
     c                   eval      *in38 = *on
     c                   else
     c                   eval      *in37 = *on
     c                   endif
      *
     c                   leavesr
     c                   endif
      *
     c                   if        b1type = 'FAKT'
     c                   if        w_errk = '1'
     c                   eval      *in36 = *on
     c                   else
     c                   eval      *in35 = *on
     c                   endif
      *
     c                   leavesr
     c                   endif
      *
     c     end_sjk       endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for overgang til bestillingssystem
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xb10win       begsr
      *
     c                   eval      w_xrow = d_srow
     c                   eval      w_xcol = d_scol
      *
     c                   eval      w_benr = *zero
     c                   eval      w_lpro = *blank
      *
     c                   call      'LO500R'
     c                   parm                    w_benr
     c                   parm                    w_lpro
      *
     c     end_xb10win   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å vise statuskoder
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xb13win       begsr
      *
     c                   eval      w_xrow = d_srow
     c                   eval      w_xcol = d_scol
      *
     c                   exfmt     b13win
      *
     c     end_xb13win   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for total rekontroll av alle meldinger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xb14win       begsr
      *
     c                   eval      w_xrow = d_srow
     c                   eval      w_xcol = d_scol
      *
     c                   exfmt     b14win
      *
     c                   if        *inkc or *inkl
     c                   goto      end_xb14win
     c                   endif
      *
     c                   eval      ledilr_type = w_type
     c                   eval      ledilr_mnum = 0
     c     ledilr_key    setll     ledilr
     c                   read      ledilr
      *
     c                   dow       not %eof
     c                   if        listat <> ' ' and
     c                             listat <> '7' and
     c                             listat <> '8' and
     c                             listat <> '9'
      *
     c                   if        limlin <> 100001
     c                   goto      ny_post
     c                   endif
      *
     c                   if        a1type <> *blank
     c                   if        litype <> a1type
     c                   goto      ny_post
     c                   endif
     c                   endif
      *
     c                   eval      w_type = litype
     c                   eval      w_mnum = limnum
     c                   eval      w_retn = *zero
      *
     c                   if        w_type = 'FAKT'
     c                   call      'LI715R'
     c                   parm                    w_firm
     c                   parm                    w_type
     c                   parm                    w_mnum
     c                   parm                    w_nump
     c                   parm                    w_sufp
     c                   parm                    w_retn
     c                   endif
      *
     c                   if        w_type = 'OBKR'
     c                   call      'LI716R'
     c                   parm                    w_firm
     c                   parm                    w_type
     c                   parm                    w_mnum
     c                   parm                    w_retn
     c                   endif
      *
     c                   endif
      *
     c     ny_post       tag
     c                   read      ledilr
     c                   enddo
      *
     c                   eval      w_fcrn = *zero
     c                   eval      w_type = a1type
      *
     c     end_xb14win   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for sletting av oppdaterte og/eller slettemarkerte mld.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xb15win       begsr
      *
     c*                  eval      b15sl1 = 'N'
6.12 c*                  eval      b15sl2 = 'N'
6.12 c                   eval      b15sl2 = 'B'
     c                   eval      b15dat = 0
      *
     c     xb15ut        tag
     c                   exfmt     b15win
      *
     c                   if        *inkc or *inkl
     c                   goto      end_xb15win
     c                   endif
      * Sjekk gyldig input
6.12 c                   eval      *in32 = *off
6.12 c                   eval      b15sl2 = %xlate(lo:up:b15sl2)
6.12 c                   if        b15sl2 <> 'B' and
6.12 c                             b15sl2 <> 'S' and
6.12 c                             b15sl2 <> 'G'
6.12 c                   eval      *in32 = *on
6.12 c                   goto      xb15ut
6.12 c                   endif
      *
      * Slett oppdaterte meldinger
      *
     c*                  if        b15sl1 = 'J' or
     c*                            b15sl1 = 'j'
     c*    *dmy          test(d)                 b15dat                 31
     c*                  if        *in31 = *on
     c*                  goto      xb15ut
     c*                  endif
     c*    *dmy          move      b15dat        w_dato
      *
     c*                  eval      ledilr_type = w_type
     c*                  eval      ledilr_mnum = 0
     c*    ledilr_key    setll     ledilr
     c*                  read      ledilr
      *
     c*                  dow       not %eof
     c*                  if        listat = '9' and
     c*                            limdat < w_dato
      *
     c*                  eval      ledilu_type = litype
     c*                  eval      ledilu_mnum = limnum
     c*                  eval      ledilu_mlin = limlin
     c*    ledilu_key    chain     ledilu
     c*                  if        %found
     c*                  delete    ledilur
     c*                  endif
     c*                  endif
      *
     c*                  read      ledilr
     c*                  enddo
     c*                  endif
      *
      * Slett godkjente eller slettede meldinger
      *
6.12 c*                  if        b15sl2 = 'J' or
6.12 c*                            b15sl2 = 'j'
     c     *dmy          test(d)                 b15dat                 31
     c                   if        *in31 = *on
     c                   goto      xb15ut
     c                   endif
     c     *dmy          move      b15dat        w_dato
      *
8.09 c                   eval      w_skod = *blanks
8.09 c                   if        b15sl2 = 'B'
      *
8.09  /Free
8.09
8.09     exec sql
8.09
8.09       delete from ledipf
8.09         where lifirm = :w_firm and
8.09               litype = :w_type and
8.09               limdat <= :w_dato and
8.09               likode <> :w_skod;
8.09
8.09  /end-free
8.09 c                   else
8.09 c                   eval      w_skod = b15sl2
      *
8.09  /Free
8.09
8.09     exec sql
8.09
8.09       delete from ledipf
8.09         where lifirm = :w_firm and
8.09               litype = :w_type and
8.09               limdat <= :w_dato and
8.09               likode = :w_skod;
8.09
8.09
8.09  /end-free
      *
8.09 c                   endif
      *
8.09 c*                  eval      ledilr_type = w_type
8.09 c*                  eval      ledilr_mnum = 0
8.09 c*    ledilr_key    setll     ledilr
8.09 c*                  read      ledilr
      *
8.09 c*                  dow       not %eof
8.09 c*                  eval      b_slet = *off
8.09  *
8.09 c*                  if        b15sl2 = 'B' and
8.09 c*                            likode = 'S'
8.09 c*                  eval      b_slet = *on
8.09 c*                  endif
8.09  *
8.09 c*                  if        b_slet = *off
8.09 c*                  if        b15sl2 = 'B' and
8.09 c*                            likode = 'G'
8.09 c*                  eval      b_slet = *on
8.09 c*                  endif
8.09 c*                  endif
8.09  *
8.09 c*                  if        b_slet = *off
8.09 c*                  if        likode = b15sl2
8.09 c*                  eval      b_slet = *on
8.09 c*                  endif
8.09 c*                  endif
6.12  *
6.12 c*                  if        listat = '7' and
6.12 c*                            limdat < w_dato
8.09 c*                  if        b_slet = *on and
8.09 c*                            limdat < w_dato
      *
8.09 c*                  eval      ledilu_type = litype
8.09 c*                  eval      ledilu_mnum = limnum
8.09 c*                  eval      ledilu_mlin = limlin
8.09 c*    ledilu_key    chain     ledilu
8.09 c*                  if        %found
8.09 c*                  delete    ledilur
8.09 c*                  endif
8.09 c*                  endif
      *
8.09 c*                  read      ledilr
8.09 c*                  enddo
6.12 c*                  endif
      *
     c                   eval      w_fcrn = *zero
     c                   eval      w_type = a1type
      *
     c     end_xb15win   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for tømming av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     clr_subfile   begsr
      *
     c                   eval      *in14 = *on
     c                   write     b2ctl
     c                   eval      *in14 = *off
      *
     c                   eval      *in15 = *off
     c                   eval      w_srrn = 0
     c                   eval      w_sfrn = 0
     c                   eval      w_ssrn = 0
     c                   eval      w_spge = 0
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å fylle opp subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     crt_subfile   begsr
      *
     c                   eval      w_spge = w_spge + c_sfil
     c                   eval      w_srrn = w_ssrn
      *
     c                   dou       w_srrn = w_spge
      *
6.11 c*                  read      ledil1
6.11 c                   read      ledil5
      *
     c                   if        %eof or
     c                             lifirm <> w_firm
     c                   eval      *in15 = *on
     c                   leave
     c                   endif
      *
     c                   if        w_type <> *blank and
     c                             litype <> w_type
6.14 c                   eval      *in15 = *on
     c                   leave
     c                   endif
      *
     c                   if        limlin <> 100001
     c                   iter
     c                   endif
      *
6.24 c                   if        b_alle = *off
6.11 c                   if        b_blank = *off  and
6.11 c                             (listat = '7' and likode = 'S')
6.14 c                   if        w_kode <> 'S'
6.11 c                   iter
6.11 c                   endif
6.11 c                   endif
6.24 c                   endif
      *
6.24 c                   if        b_alle = *off
6.11 c                   if        b_blank = *off  and
6.11 c                             (listat = '9' and likode = 'G')
6.14 c                   if        w_kode <> 'G'
6.11 c                   iter
6.11 c                   endif
6.11 c                   endif
6.24 c                   endif
      *
6.24 c                   if        b_alle = *off
6.14 c                   if        b_blank = *off  and
6.14 c                             (listat <> '9' and listat <> '7')
6.14 c                   iter
6.14 c                   endif
6.24 c                   endif
      *
6.24 c                   if        b_alle = *off
6.14 c                   if        b_blank = *on
6.14 c                   if        listat = '9' or listat = '7'
6.14 c                   iter
6.14 c                   endif
6.14 c                   endif
6.24 c                   endif
8.06  *
8.06  * Ligger her, da status kan endres.
8.06  *
8.06 c                   if        h1stat <> *blank and
8.06 c                             h1stat <> listat
8.06 c                   iter
8.06 c                   endif
      *
     c                   eval      b1valg = 0
7.03 c*                   eval      b1tsta = ''
      *
     c                   if        limdat <> *loval
     c     *dmy          move      limdat        b1mdat
     c                   endif
      *
     c                   eval      b1type = litype
6.34 c                   if        b1type = 'FAKT'
6.34 c                   movel     limeld        w_kred
     c                   if        w_kred = '381'
     c                   eval      b1utty = 'KRED'
     c                   else
     c                   eval      b1utty = b1type
6.34 c                   endif
6.34 c                   else
6.34 c                   eval      b1utty = b1type
     c                   endif
      *
     c                   if        litype = 'FAKT'
     c                   eval      d_fakh1 = limeld
7.02 c                   eval      b1edat = 0
7.02 c                   if        d_fh_ldat <> *loval
7.02 c     *dmy          move      d_fh_ldat     b1edat
7.02 c                   endif
7.03 c                   eval      b1fdat = 0
7.03 c                   if        d_fh_forf <> *loval
7.03 c     *dmy          move      d_fh_forf     b1fdat
7.03 c                   endif
7.03 c*                   exsr      status_hode
      *
     c                   endif
     c                   if        litype = 'OBKR'
     c                   eval      d_obkh  = limeld
7.02 c                   eval      b1edat = 0
7.02 c                   if        d_oh_llda <> *loval
7.02 c     *dmy          move      d_oh_llda     b1edat
7.02 c                   endif
7.03 c                   eval      b1fdat = 0
7.03 c*                   if        d_oh_llda <> *loval
7.03 c*     *dmy          move      d_oh_llda     b1fdat
7.03 c*                   endif
7.03 c*                   exsr      status_hode
     c                   endif
      *
     c                   eval      *in30 = *off
     c                   eval      b1mnum = limnum
     c                   eval      b1mlin = limlin
     c                   eval      b1numm = linumm
     c                   eval      b1suff = lisuff
     c                   eval      b1stat = listat
     c*                   eval      b1fdat = lifdat
     c                   exsr      sjekk_status
     c                   exsr      sjekk_levr
     c                   exsr      sjekk_otyp
      *
     c                   if        litype = 'FAKT'
     c                   exsr      sjekk_ftot
     c                   endif
     c                   if        litype = 'OBKR'
     c                   exsr      sjekk_obto
     c                   endif
      *
      * Sjekk mot angitt filterverdier
      *
7.05 c                   if        h1fldo <> *zero
7.05 c                   if        h1fldo <> w_fldo
7.05 c                   iter
7.05 c                   endif
7.05 c                   endif
      *
     c                   if        h1sldo <> *zero
     c                   if        h1sldo <> b1ldor
     c                   iter
     c                   endif
     c                   endif
      *
     c                   if        h1snav <> *blank
     c                   exsr      sjekk_lnav
     c                   if        b_snav = *off
     c                   iter
     c                   endif
     c                   endif
      *
     c                   if        h1smda <> *zero
     c     *dmy          move      h1smda        w_mdat
     c                   if        limdat <> w_mdat
     c                   iter
     c                   endif
     c                   endif
      *
     c                   if        h1sfak <> *blank
     c                   exsr      sjekk_fakn
     c                   if        b_sfak = *off
     c                   iter
     c                   endif
     c                   endif
      *
     c                   if        h1sbes <> *blank
     c                   exsr      sjekk_besn
     c                   if        b_sbes = *off
     c                   iter
     c                   endif
     c                   endif
      *
     c                   if        h1innk <> *zero
     c                   if        loinnk <> h1innk
     c                   iter
     c                   endif
     c                   endif
9.01  * Sjekk mot angitt lager/EAN lokasjonsnummer
6.30 c                   if        h1lage <> *zero and
6.30 c                             w_eann <> *zero or
6.30 c                             h2lage <> *zero and
6.30 c                             w_ean2 <> *zero or
6.30 c                             h3lage <> *zero and
6.30 c                             w_ean3 <> *zero or
6.30 c                             h4lage <> *zero and
6.30 c                             w_ean4 <> *zero or
6.30 c                             h5lage <> *zero and
6.30 c                             w_ean5 <> *zero
6.30 c                   eval      b_read = *on
6.30  * Sjekk faktura
6.30 c                   if        litype = 'FAKT'
6.30 c                   exsr      sj_fakt
6.30 c                   if        b_read = *off
6.30 c                   iter
6.30 c                   endif
6.30 c                   endif
6.30  * Sjekk ordrebekreftelse
6.30 c                   if        litype = 'OBKR'
6.30 c                   exsr      sj_obkr
6.30 c                   if        b_read = *off
6.30 c                   iter
6.30 c                   endif
6.30 c                   endif
6.30  *
6.30 c                   endif
6.30  * Sjekk ordretypen på bestillingen
6.30 c                   if        h1vmot <> *blanks
6.30  *
6.30 c                   if        h1vmot = '3' and
6.30 c                             b1numm > 0
6.30 c                   iter
6.30 c                   endif
6.30  *
6.30 c                   if        h1vmot = '1'     and
6.30 c                             b1otyp = *blanks or
6.30 c                             h1vmot = '2'     and
6.30 c                             b1otyp = *blanks
6.30 c                   iter
6.30 c                   endif
6.30  *
6.30 c                   if        b1otyp <> *blanks
6.30 c                   exsr      sj_otyp
6.30 c                   if        b_read = *off
6.30 c                   iter
6.30 c                   endif
6.30 c                   endif
6.30  *
6.30 c                   endif
6.22  * Sjekk mot filter for direktelevering
6.22 c                   if        h1dirk = '1' and
6.22 c                             b1lety = 0
6.22 c                   iter
6.22 c                   endif
6.22  * Sjekk mot filter for faktura/kreditnota
6.22 c                   if        h1fakr = 'F' and
6.22 c                             b1utty <> 'FAKT'
6.22 c                   iter
6.22 c                   endif
6.22 c                   if        h1fakr = 'K' and
6.22 c                             b1utty <> 'KRED'
6.22 c                   iter
6.22 c                   endif
      *
7.02 c                   eval      b1bdat = 0
7.02 c                   if        lomoda <> *loval
7.02 c     *dmy          move      lomoda        b1bdat
7.02 c                   endif
      *
     c                   if        b1suff <> 0
     c                   eval      *in30 = *on
     c                   endif
      *
     c                   eval      w_srrn = w_srrn + 1
     c                   write     b1sfl
      *
     c                   enddo
      *
     c     end_crt       tag
      *
     c                   if        w_srrn > w_ssrn
     c                   eval      w_sfrn = w_ssrn + 1
     c                   endif
      *
     c                   eval      w_ssrn = w_srrn
     c                   eval      w_virn = w_sfrn
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å bla tilbake en side i subfilen
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     bck_subfile   begsr
      *
     c                   if        *in15
6.11 c*    ledil1_key    setgt     ledil1
6.11 c*                  readp     ledil1
6.11 c     ledil5_key    setgt     ledil5
6.14 c**                 readp     ledil5
     c                   endif
      *
      * Leser tilbake en side
      *
     c                   eval      w_stel = 0
      *
     c                   dou       w_stel = w_ssrn + c_sfil
      *
6.11 c*                  readp     ledil1
6.11 c                   readp     ledil5
      *
     c                   if        %eof or
     c                             lifirm <> w_firm
6.14 c                   eval      *in15 = *on
     c                   leave
     c                   endif
      *
     c                   if        w_type <> *blank and
     c                             litype <> w_type
6.14 c                   eval      *in15 = *on
     c                   leave
     c                   endif
      *
     c                   if        limlin <> 100001
     c                   iter
     c                   endif
      *
6.24 c                   if        b_alle = *off
6.11 c                   if        b_blank = *off  and
6.11 c                             (listat = '7' and likode = 'S')
6.11 c                   if        w_kode <> 'S'
6.11 c                   iter
6.11 c                   endif
6.11 c                   endif
6.24 c                   endif
      *
6.24 c                   if        b_alle = *off
6.11 c                   if        b_blank = *off  and
6.11 c                             (listat = '9' and likode = 'G')
6.11 c                   if        w_kode <> 'G'
6.11 c                   iter
6.11 c                   endif
6.11 c                   endif
6.24 c                   endif
      *
6.24 c                   if        b_alle = *off
6.14 c                   if        b_blank = *off  and
6.14 c                             (listat <> '9' and listat <> '7')
6.14 c                   iter
6.14 c                   endif
6.24 c                   endif
      *
6.24 c                   if        b_alle = *off
6.14 c                   if        b_blank = *on
6.14 c                   if        listat = '9' or listat = '7'
6.14 c                   iter
6.14 c                   endif
6.14 c                   endif
6.24 c                   endif
      *
     c                   eval      w_stel = w_stel + 1
      *
     c                   eval      ledil1_type = litype
     c                   eval      ledil1_mnum = limnum
      *
     c                   enddo
      *
     c                   if        %eof
6.11 c*    ledil1_key    setll     ledil1
6.11 c     ledil5_key    setll     ledil5
     c                   endif
      *
      * Blanker og fyller opp subfile
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c     end_bck       endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for display av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     dsp_subfile   begsr
      *
     c                   if        w_srrn <> 0
     c                   eval      *in12 = *on
     c                   else
     c                   write     b2cmd
     c                   endif
      *
     c                   eval      *in13 = *on
     c                   exfmt     b2ctl
      *
     c                   eval      *in12 = *off
     c                   eval      *in13 = *off
      *
     c                   eval      w_fcrn = d_fcrn
      *
     c                   endsr
      *
6.30  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  * Subrutine for sjekk om EAN nummer fra faktura
6.30  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  *
6.30 c     sj_fakt       begsr
6.30  *
6.30 c                   if        d_fh_beaa = *blanks
6.30 c                   eval      b_read = *off
6.30 c                   else
6.30 c                   if        d_fh_bean <> 0      and
6.30 c                             d_fh_bean <> w_eann and
6.30 c                             d_fh_bean <> w_ean2 and
6.30 c                             d_fh_bean <> w_ean3 and
6.30 c                             d_fh_bean <> w_ean4 and
6.30 c                             d_fh_bean <> w_ean5
6.30 c                   eval      b_read = *off
6.30 c                   endif
6.30 c                   endif
6.30  *
6.30 c                   endsr
6.30  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  * Subrutine for sjekk om EAN nummer fra ordrebekreftelse
6.30  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  *
6.30 c     sj_obkr       begsr
6.30  *
6.30 c                   if        d_oh_beaa = *blanks
6.30 c                   eval      b_read = *off
6.30 c                   else
6.30 c                   if        d_oh_bean <> 0      and
6.30 c                             d_oh_bean <> w_eann and
6.30 c                             d_oh_bean <> w_ean2 and
6.30 c                             d_oh_bean <> w_ean3 and
6.30 c                             d_oh_bean <> w_ean4 and
6.30 c                             d_oh_bean <> w_ean5
6.30 c                   eval      b_read = *off
6.30 c                   endif
6.30 c                   endif
6.30  *
6.30 c                   endsr
6.30  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  * Subrutine for sjekk om varemotatt bestilling
6.30  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  *
6.30 c     sj_otyp       begsr
6.30  *
6.30 c                   eval      b_read = *on
6.30  *
6.30 c                   eval      votylr_otyp = b1otyp
6.30 c     votylr_key    chain     votylr
6.30 c                   if        %found
6.30 c                   if        h1vmot = '1' and
6.30 c                             vaoakk <> 2
6.30 c                   eval      b_read = *off
6.30 c                   elseif    h1vmot = '2' and
6.30 c                             vaoakk <> 1
6.30 c                   eval      b_read = *off
6.30 c                   endif
6.30 c                   else
6.30 c                   eval      b_read = *off
6.30 c                   endif
6.30  *
6.30 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for kontroll av leverandør
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_levr    begsr
      *
     c                   eval      rlevl1_levr = lildor
     c                   eval      b1ldor = lildor
6.29 c                   eval      b1levr = *blanks
7.05 c                   eval      w_fldo = *zeros
      *
     c     rlevl1_key    chain     rlevl1
     c                   if        %found
     c                   eval      b1levr = rlnavn
7.05 c                   eval      w_fldo = rlflev
     c                   else
     c                   exsr      meld_levr
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å finne leverandør fra EDI-melding (Partsinformasjon)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     meld_levr     begsr
      *
     c                   eval      w_stat = listat
      *
     c                   eval      ledilu_type = b1type
     c                   eval      ledilu_mnum = b1mnum
     c                   eval      ledilu_mlin = 200000
     c     ledilu_key    setll     ledilu
     c                   read      ledilu
      *
     c                   dow       not %eof and
6.2a c**                           limnum < 300000
6.2a c                             limlin < 300000
     c                   eval      d_pinf = limeld
     c                   if        d_part = 'SU '
     c                   eval      b1levr = d_pnav
     c                   if        d_pean <> *zero
     c                   eval      rlevl5_eanl = d_pean
     c     rlevl5_key    chain     rlevl5
     c                   if        %found
     c                   eval      b1ldor = rllevr
     c                   eval      b1levr = rlnavn
     c                   endif
     c                   endif
      *
     c                   unlock    ledilu
     c                   goto      end_meld
     c                   endif
      *
     c                   read      ledilu
     c                   enddo
      *
     c     end_meld      tag
     c                   eval      listat = w_stat
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å sjekk av søkenavn fra filter mot lev.navn
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_lnav    begsr
      *
     c                   eval      b_snav = *off
     c                   eval      w_snav = %xlate(lo:up:b1levr)
      *
     c                   if        %scan(%trim(h1snav) : w_snav) > 0
     c                   eval      b_snav = *on
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å sjekk av fakturanr fra filter mot melding
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_fakn    begsr
      *
     c                   eval      b_sfak = *off
     c                   eval      w_sfak = %xlate(lo:up:d_fh_fanr)
      *
     c                   if        %scan(%trim(h1sfak) : w_sfak) > 0
     c                   eval      b_sfak = *on
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å sjekk av best.nr fra filter mot melding
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_besn    begsr
      *
     c                   eval      b_sbes = *off
     c*                  eval      w_sbes = %xlate(lo:up:d_fh_best)
      *
     c                   if        linumm <> *zero
     c                   eval      w_sbes = *blank
     c                   movel     linumm        w_sbes
      *
     c                   if        %scan(%trim(h1sbes) : w_sbes) > 0
     c                   eval      b_sbes = *on
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å finne fakturatotal fra EDI-melding
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_ftot    begsr
      *
     c                   eval      ledilu_type = b1type
     c                   eval      ledilu_mnum = b1mnum
     c                   eval      ledilu_mlin = 900001
      *
     c     ledilu_key    chain     ledilu
     c                   if        %found
     c                   eval      d_fakt = limeld
     c                   eval      b1fbel = d_ft_ftot
     c                   unlock    ledilu
     c                   else
     c                   eval      b1fbel = 0
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å finne ordrebekr.total fra EDI-melding
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_obto    begsr
      *
     c                   eval      ledilu_type = b1type
     c                   eval      ledilu_mnum = b1mnum
     c                   eval      ledilu_mlin = 900001
      *
     c     ledilu_key    chain     ledilu
     c                   if        %found
     c                   eval      d_obks = limeld
     c                   eval      b1fbel = d_os_btot
     c                   unlock    ledilu
     c                   else
     c                   eval      b1fbel = 0
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å finne ordretype
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_otyp    begsr
      *
     c                   eval      lohelr_numm = linumm
     c                   eval      lohelr_suff = lisuff
     c     lohelr_key    chain     lohelr
     c                   if        %found
     c                   eval      b1otyp = lootyp
     c                   eval      b1onum = loornr
     c                   else
     c                   eval      b1otyp = *blank
     c                   eval      b1onum = 0
     c                   endif
      *
6.21 c                   eval      b1lety = 0
6.21 c                   if        b1onum <> 0
6.21 c                   eval      fohelr_numm = b1onum
6.21 c     fohelr_key    chain     fohelr
6.21 c                   if        %found(fohelr)
6.21 c                   eval      b1lety = folety
6.21 c                   else
6.21 c                   eval      b1lety = 0
6.21 c                   endif
6.21 c                   endif
      *
     c     end_otyp      endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for kontroll av meldingsstatus
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_status  begsr
      *
     c                   eval      *in31 = *off
     c                   eval      *in32 = *off
     c                   eval      *in33 = *off
     c                   eval      *in34 = *off
      *
     c                   select
     c                   when      listat = '1'
     c                   eval      *in32 = *on
     c                   when      listat = '2'
     c                   eval      *in32 = *on
     c                   when      listat = '3'
     c                   eval      *in32 = *on
     c                   when      listat = '4'
     c                   eval      *in32 = *on
     c                   when      listat = '5'
     c                   eval      *in32 = *on
     c                   when      listat = '8'
     c                   eval      *in31 = *on
     c                   when      listat = '9'
     c                   eval      *in34 = *on
     c                   endsl
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å hente nye meldinger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_meld     begsr
6.33  *
6.33  * Sjekk om overføring allerede pågår.
6.33  *
6.33 c                   eval      w_jsta = 07
6.33 c                   eval      w_onof = 0
6.33  *
6.33 c                   call      'FA730R'
6.33 c                   parm                    w_jsta
6.33 c                   parm                    w_onof
6.33  *
6.33  * Overføring pågår eller finnes ikke.
6.33  *
6.33 c                   if        w_onof  = 1
6.32 c                   eval      w_ctl1 = 4
6.33 c                   eval      w_ctpo = 44
6.33 c                   eval      w_mld1 = w_con1
6.33 c                   eval      w_mld2 = w_con2
6.33  *
6.33 c                   call      'AA006C'
6.33 c                   parm                    w_ctl1
6.33 c                   parm                    w_ctpo
6.33 c                   parm                    w_mld1
6.33 c                   parm                    w_mld2
6.33  *
6.33 c                   eval      w_cmd = 'DLYJOB DLY(5)'
6.33 c                   eval      w_len = 200
6.33 c                   call      'QCMDEXC'
6.33 c                   parm                    w_cmd
6.33 c                   parm                    w_len
6.33 c                   goto      end_hent
6.33 c                   endif
6.33  *
6.33  * Oppdater jobb-register med aktiv-flagg
6.33  *
6.33 c                   eval      w_jsta = 07
6.33 c                   eval      w_onof = 1
6.33 c                   call      'FA720R'
6.33 c                   parm                    w_jsta
6.33 c                   parm                    w_onof
6.33  *
6.32 c                   eval      p_stat = *blanks
     c                   call      'LI700C'
6.32 c                   parm                    p_stat
     c                   eval      w_fcrn = *zero
     c                   eval      w_type = a1type
6.32  * Flagger evnt feil
6.32 c                   if        p_stat = 'F'
6.32 c                   exfmt     b9win3
6.32 c                   endif
6.33  *
6.33  * Fjern aktiv-flagg fra jobb-register
6.33  *
6.33 c                   eval      w_jsta = 07
6.33 c                   eval      w_onof = 0
6.33 c                   call      'FA720R'
6.33 c                   parm                    w_jsta
6.33 c                   parm                    w_onof
6.33  *
      *
     c     end_hent      endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å kall av ny kontroll mot bestilling
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ny_kontroll   begsr
      *
     c                   eval      w_type = b1type
     c                   eval      w_mnum = b1mnum
     c                   eval      w_retn = *zero
     c                   eval      w_xrow = 6 + w_srrn
      *
     c                   if        w_type = 'FAKT'
     c                   call      'LI715R'
     c                   parm                    w_firm
     c                   parm                    w_type
     c                   parm                    w_mnum
     c                   parm                    w_nump
     c                   parm                    w_sufp
     c                   parm                    w_retn
     c                   endif
      *
     c                   if        w_type = 'OBKR'
     c                   call      'LI716R'
     c                   parm                    w_firm
     c                   parm                    w_type
     c                   parm                    w_mnum
     c                   parm                    w_retn
     c                   endif
6.23  * Hvis det er kjørt kontroll mot ei melding som er slettet, skal denne reaktiveres
6.23 c                   exsr      sub_reaktiver
      *
     c     end_ktrl      endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å kalle prog. for søk etter bestilling
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     best_sok      begsr
      *
7.04 c                   if        u_704 = *on
8.05  * Tar vare på angitt lager
8.05 c                   eval      s_lage = h1lage
7.04 c                   eval      w_lage = 0
7.04 c                   eval      ledilr_type = b1type
7.04 c                   eval      ledilr_mnum = b1mnum
7.04 c     ledilr_key    setll     ledilr
7.04 c     ledilr_key    reade     ledilr
7.04 c                   dow       not %eof
7.04  *
7.04 c                   if        limlin > 200000 and
7.04 c                             limlin < 300000
7.04 c                   eval      d_pinf = limeld
7.04 c                   if        d_part = 'DP '
7.04 c                   eval      mjlol2_eann = d_pean
7.04 c     mjlol2_key    chain     mjlol2
7.04 c                   if        %found
7.04 c                   eval      w_lage = mjlage
7.04 c                   goto      sok_lager
7.04 c                   endif
7.04 c                   endif
7.04 c                   endif
7.04  *
7.04 c     ledilr_key    reade     ledilr
7.04 c                   enddo
7.04 c                   endif
7.04  *
7.04 c     sok_lager     tag
      *
     c                   eval      w_ldor = b1ldor
     c                   eval      w_numm = *zero
     c                   eval      w_suff = *zero
     c                   eval      w_xrow = 6 + w_srrn
      *
     c*                  call      'LO560R'
7.04 c                   if        u_704 = *on
8.05 c                   if        w_lage <> 0
8.02 c                   eval      h1lage = w_lage
8.05 c                   else
8.05 c                   eval      h1lage = s_lage
8.05 c                   endif
7.04 c                   call      'LO570R'
7.04 c                   parm                    w_firm
7.04 c                   parm                    w_ldor
7.04 c                   parm                    w_numm
7.04 c                   parm                    w_suff
8.02 c                   parm                    h1lage
8.02 c                   parm                    h2lage
8.02 c                   parm                    h3lage
8.02 c                   parm                    h4lage
8.02 c                   parm                    h5lage
7.04 c                   else
8.04 c**                 eval      h1lage = 0
8.05 c                   eval      h1lage = s_lage
     c                   call      'LO570R'
     c                   parm                    w_firm
     c                   parm                    w_ldor
     c                   parm                    w_numm
     c                   parm                    w_suff
8.02 c                   parm                    h1lage
8.02 c                   parm                    h2lage
8.02 c                   parm                    h3lage
8.02 c                   parm                    h4lage
8.02 c                   parm                    h5lage
7.04 c                   endif
      *
8.05 c                   eval      h1lage = s_lage
      *
     c                   if        w_numm = *zero
     c                   leavesr
     c                   endif
      *
     c                   eval      ledilr_type = b1type
     c                   eval      ledilr_mnum = b1mnum
     c     ledilr_key    setll     ledilr
     c     ledilr_key    reade     ledilr
      *
     c                   dow       not %eof
      *
     c                   eval      ledilu_type = litype
     c                   eval      ledilu_mnum = limnum
     c                   eval      ledilu_mlin = limlin
     c     ledilu_key    chain     ledilu
     c                   if        %found
     c                   eval      linumm = w_numm
     c                   eval      lisuff = w_suff
6.10 c                   time                    liedat
6.10 c                   time                    lietim
6.10 c                   eval      lieusr = l_user
     c                   update    ledilur
     c                   endif
      *
     c     ledilr_key    reade     ledilr
     c                   enddo
      *
     c                   eval      w_nump = w_numm
     c                   eval      w_sufp = w_suff
      *
     c                   exsr      ny_kontroll
      *
     c     end_sok       endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å finne meldingstyper
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     finn_type     begsr
      *
     c                   call      'LI501R'
     c                   parm                    w_firm
     c                   parm                    w_type
     c                   parm                    w_besk
      *
     c     end_finn      endsr
7.03  *
7.03  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.03  * Subrutiner for kontroll av meldingsstatus
7.03  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.03  *
7.03 c*     status_hode   begsr
7.03  **
7.03 c*                   select
7.03 c*                   when      listat = ' '
7.03 c*                   eval      b1tsta = 'Ok!            '
7.03 c*                   when      listat = '1'
7.03 c*                   eval      b1tsta = 'Feil i best.nr.'
7.03 c*                   when      listat = '2'
7.03 c*                   eval      b1tsta = 'Sjekk lever.   '
7.03 c*                   when      listat = '3'
7.03 c*                   eval      b1tsta = 'Avvik fra best.'
7.03 c*                   when      listat = '4'
7.03 c*                   eval      b1tsta = 'Feil ordretype.'
7.03 c*                   when      listat = '5'
7.03 c*                   eval      b1tsta = 'Avvik totalsum.'
7.03 c*                   when      listat = '7'
7.03 c*                   eval      b1tsta = 'Slettemarkert  '
7.03 c*                   when      listat = '8'
7.03 c*                   eval      b1tsta = 'Manuelt ok     '
7.03 c*                   when      listat = '9'
7.03 c*                   eval      b1tsta = 'Oppdatert      '
7.03 c*                   endsl
7.03  **
7.03 c*                   endsr
      *
6.23  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.23  * Subrutine for reakitvere EDI melding
6.23  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.23  *
6.23 c     sub_reaktiver begsr
6.23  *
6.23 c                   eval      ledilr_type = b1type
6.23 c                   eval      ledilr_mnum = b1mnum
6.23 c     ledilr_key    setll     ledilr
6.23 c     ledilr_key    reade     ledilr
6.23  *
6.23 c                   dow       not %eof
6.23  *
6.23 c                   eval      ledilu_type = litype
6.23 c                   eval      ledilu_mnum = limnum
6.23 c                   eval      ledilu_mlin = limlin
6.23 c     ledilu_key    chain     ledilu
6.23 c                   if        %found
6.23 c                   eval      likode = *blank
6.23 c                   time                    liedat
6.23 c                   time                    lietim
6.23 c                   eval      lieusr = l_user
6.23 c                   update    ledilur
6.23 c                   endif
6.23  *
6.23 c     ledilr_key    reade     ledilr
6.23 c                   enddo
6.23  *
6.23 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
     c     *entry        plist
     c                   parm                    w_type
      *
6.20  *  Key for les av LAGER-KODE
6.20  *
6.20 c     lstsl1_key    klist
6.20 c                   kfld                    w_firm
6.31  *
6.31  *  Key for les av synkroniseringsregister
6.31  *
6.31 c     lsbol1_key    klist
6.31 c                   kfld                    w_firm
6.31  *
      *  Key for posisjonering av MELDINGSLINJER
      *
     c     ledil1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ledil1_type
     c                   kfld                    ledil1_mnum
      *
      *  Key for behandling av MELDINGSLINJER
      *
     c     ledilr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ledilr_type
     c                   kfld                    ledilr_mnum
6.11  *
6.11  *  Key for behandling av MELDINGSLINJER
6.11  *
6.11 c     ledil5_key    klist
6.11 c                   kfld                    w_firm
6.11 c                   kfld                    ledil5_kode
6.11 c                   kfld                    ledil5_type
6.11 c                   kfld                    ledil5_mnum
      *
      *  Key for oppdatering av MELDINGSLINJER
      *
     c     ledilu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ledilu_type
     c                   kfld                    ledilu_mnum
     c                   kfld                    ledilu_mlin
      *
      * Key for les av leverandør
      *
     c     rlevl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl1_levr
      *
      * Key for les av leverandør på EAN - lokasjonsnummer
      *
     c     rlevl5_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl5_eanl
      *
      *  Key for les av BESTILLING-HODE
      *
     c     lohelr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lohelr_numm
     c                   kfld                    lohelr_suff
6.30  *
6.30  *  Key for les av logistikkpunkt
6.30  *
6.30 c     mjlolr_key    klist
6.30 c                   kfld                    w_firm
6.30 c                   kfld                    mjlolr_lage
6.30 c                   kfld                    mjlolr_avde
      *
      *  Key for les av ordretype
      *
     c     votylr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    votylr_otyp
      *
6.20  *  Key for les av BRUKER BESTILLING/LAGER
6.20  *
6.20 c     lusrl1_key    klist
6.20 c                   kfld                    w_firm
6.20 c                   kfld                    lusrl1_user
6.21  *
6.21  *  Key for les av ordre-hode
6.21  *
6.21 c     fohelr_key    klist
6.21 c                   kfld                    w_firm
6.21 c                   kfld                    fohelr_numm
6.31  *
6.31  *  Key for les av ordre-hode
6.31  *
6.31 c     fohel1_key    klist
6.31 c                   kfld                    w_firm
6.31 c                   kfld                    fohel1_numm
6.31 c                   kfld                    fohel1_suff
6.32  *
6.32  *  Key for behandling av loggfile
6.32  *
6.32 c     elogl3_key    klist
6.32 c                   kfld                    w_firm
6.32 c                   kfld                    elogl3_faar
6.32 c                   kfld                    elogl3_type
6.32 c                   kfld                    elogl3_mnum
7.04  *
7.04  *  Key for les av logistikkpunkt
7.04  *
7.04 c     mjlol2_key    klist
7.04 c                   kfld                    w_firm
7.04 c                   kfld                    mjlol2_eann
8.07  *
8.07  *  Key for les av lager/avdeling
8.07  *
8.07 c     ra10lx_key    klist
8.07 c                   kfld                    w_firm
8.07 c                   kfld                    ra10lx_javd
      *
      * Henter firmanummer fra LDA
      *
     c                   eval      w_firm = l_firm
6.14 c                   eval      b_blank = *on
6.20 c                   eval      lusrl1_user = l_user
6.27  * Kommer vi fra F11 funksjon via historikk ?? (FO550R)
6.27 c                   if        l_vise = '1'
6.27 c                   eval      *in79 = *on
6.27 c                   endif
      *
7.04  *
7.04  * Endring 7.04
7.04  *
7.04   CallP CO402R(l_filg:w_firm:0:'LI100R_704':
7.04                    co402_verdi1:co402_verdi2);
7.04   if co402_verdi1 = '1';
7.04     u_704 = *on;
7.04   endif;
8.07  *
8.07  * Endring 8.07
8.07  *
8.07   CallP CO402R(l_filg:w_firm:0:'LI100R_807':
8.07                    co402_verdi1:co402_verdi2);
8.07   if co402_verdi1 = '1';
8.07     u_807 = *on;
8.07   endif;
8.07  *
8.07  * Legg opp til filtrering av brukeren
8.07  *
8.07 c                   if        u_807 = *on
      *
8.07 c                   eval      h1lage = 0
8.07 c                   if        l_avde <> 0
8.07 c                   eval      ra10lx_javd = l_avde
8.07 c     ra10lx_key    chain     ra10lx
8.07 c                   if        %found
8.07 c                   eval      h1lage = rajkod
8.07 c                   endif
8.07  * Finn GLN nummer til logistikkpunkt for filtrering av poster
8.07 c                   eval      w_eann = 0
8.07 c                   if        h1lage <> 0
8.07 c                   eval      mjlolr_lage = h1lage
8.07 c                   eval      mjlolr_avde = h1lage
8.07 c     mjlolr_key    chain     mjlolr
8.07 c                   if        %found
8.07 c                   eval      w_eann = mjeann
8.07 c                   endif
8.07 c                   if        w_eann = 0
8.07 c                   eval      mjlolr_lage = h1lage
8.07 c                   eval      mjlolr_avde = *zero
8.07 c     mjlolr_key    chain     mjlolr
8.07 c                   if        %found
8.07 c                   eval      w_eann = mjeann
8.07 c                   endif
8.07 c                   endif
8.07 c                   endif
8.07 c                   endif
      *
8.07 c                   endif
      *
     c                   endsr
      *
