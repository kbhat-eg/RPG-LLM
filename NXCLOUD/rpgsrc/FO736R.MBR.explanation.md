# IBM ILE RPG Program Explanation (FO736R)

This program is a complex ILE RPG application built for the IBM i platform (AS/400), handling order picking and order number display for a warehouse/logistics solution. Throughout decades, it has received numerous enhancements, as evidenced by the detailed change log in the comments.

Below, you'll find a structured and pedagogical overview of its core logic, major data structures, and functional flows. This will help you quickly understand the program's function and how to maintain or extend it.

---

## 1. **Overview and Purpose**
- **Program Name:** FO736R
- **Main Functionality:** Handles both the picking (selection and processing) and display of order numbers. It drives the UI for users to pick orders, validate numerous business rules (credit checks, order type checks, deposit requirements, etc), and update order and picking-related database files accordingly.
- **Context:** Used in a warehouse, likely part of a larger ERP/logistics system.
- **Main Input:** Parameters indicating which company, order number, etc., to operate on.
- **UI:** Uses workstation file (display file) `fo736d` with subfiles for listing and updating orders and lines.

---

## 2. **Major Files Used**
- **Display file:** `fo736d` (with subfiles for order and line display)
- **Order files:** `fohelu`, `fohel1` (order header), `fodtl1` (order lines)
- **Order type:** `votyl1`
- **Picking param:** `fplolu`, `fplol1`, `fplolo`
- **Picking lines:** `fplllu`, `fplll1`
- **Customer:** `rkunl1`
- **Others for validation:** `vinfl1` (info register), `fusrl1` (user), `fstsl1` (status), `lwpll2` (radio picking), `sdepl1` (deposit claims), etc.

---

## 3. **Key Data Structures**
- **Working variables:** Defined for various purposes (order numbers, suffixes, types, customer, values, etc.)
- **Key Lists:** KLISTs for each file for file access.
- **Status/Control Flags:** Many *IN indicators and working flags for UI, process control, and business rule enforcement.
- **SQL Variables:** For embedded SQL (e.g., fetching sort codes).

---

## 4. **Core Functional Sections**

### 4.1 Program Entry and Initialization
- **Program parameters:** Receives action (pick or display), company number, order number, suffix.
- **Company number is copied to all relevant keys and working variables.**
- **Blanking/resetting various fields for a new session.**
- **Configuration calls:** Calls out to program CO402R to check system switches for business logic toggles (e.g., special pick/credit rules).
- **Subfiles unlocked and ready for display.**

---

### 4.2 Main Processing Logic

#### 4.2.1 Determining Picking vs. Display Mode
- If no order number is provided (`wpnumm` = *zero), it goes to the order listing (display) flow.
- If an order number is provided, it moves directly to picking logic (order details and picking lines).

#### 4.2.2 **Order Picking Flow**
- **Fetches order header and type records.**
- **Loads customer information and, if configured, credit/memo balance data.**
- **Stores fetched values in working fields for display and further processing.**
- **Checks if any picking on radio terminal has occurred (may import picked quantities).**
- **Checks deposit requirements, credit status, and order type restrictions.**
- **Validates that the target order type is allowed.**
- **Handles business rules around cash customers, credit limits, deposit payment, etc.**
- **If all checks pass:**
  - Updates the order header to mark it as "in processing."
  - Updates or inserts the picking parameter record for the order.
  - Calls subroutines to process order lines or additional info as per user input.
  - Calls out to print programs if required (packs slips, etc.)
- **Special logic for updating memosaldo (memo balance) after picking certain order types.**

#### 4.2.3 **Order Display Flow**
- **Populates the order listing subfile.**
- **Handles user function keys for paging, refresh, print, roll, search by order type, etc.**
- **Processes user selections for viewing, picking, updating, or deleting orders.**

#### 4.2.4 **Picking Lines Processing**
- Handles picking (and resting) at the order line level.
- Allows validation and update of quantities, codes, and marks lines appropriately.
- Checks and enforces credit limit logic per line if configured.

---

### 4.3 **Subroutines and Helpers**

- **B4WIN, B7WIN, O1SUBR:** Handle screen flows for deleting, updating extra info, and managing delivery dates/information.
- **XD1BLD, XD1SLT, XD7WIN:** These are for picking line entry, updating the subfile, and writing picking line data.
- **SJK_RT, SJEKK_DEPO, SJEKK_D100:** Subroutines for checking radio terminal picks and deposit requirements.
- **SBLAGR:** Looks up and returns warehouse descriptions.
- **XCLR01, XCRT01, XDSP01:** Subfile management for orders (clear, fill, display).
- **XCLR02, XCRT02, XDSP02:** Subfile management for lines.
- **Newlook_vask:** Cleans up display data for compatibility with Newlook GUI.
- **UPD_LOGG:** Logs status changes, e.g., marking order as picked.

---

### 4.4 **Business Rule Highlights**

- **Order type validation:** Ensures only allowed "to order types" can be selected (from the order type register and with custom expansions).
- **Credit checks:** Extensive logic around credit limits (with memo balance inclusion and extendable rules), both for the order and at line level.
- **Deposit/payment checks:** Orders (especially for cash customers) are only allowed for picking if deposit requirements are fulfilled.
- **Custom configuration:** Many rules toggle on/off or alter behavior via switch/config register (CO402R).
- **Radio terminal integration:** Reads pick data from radio terminal file if present and updates main files accordingly.
- **Audit trails:** Modifications are logged via subroutines for traceability.

---

## 5. **User Interface**

- **Workstation (Display) Driven:** The program uses DDS-based screens and subfiles.
- **Main screens:**
  - **Order selection (subfile):** List of orders eligible for picking.
  - **Order detail:** Shows a specific order for picking, with detailed information.
  - **Order line detail (subfile):** Allows picking at line level.
  - **Confirmation and message screens:** For error, status, or information prompts.

- **Function keys supported:** Search, paging, add/remove/modify lines, delete picks, print, etc.

---

## 6. **Extensibility and Maintenance Tips**

- **Configuration/development switches** (CO402R): Many business rules can be enabled or disabled per company, reducing code changes for new requirements.
- **Easy to add new validations:** Most validation logic is isolated into IF and subroutine blocks, or controlled by switches.
- **Database field expansion:** Historical changes show that keys and fields (e.g., order number expansion) are handled carefully to avoid breaking logic.

---

## 7. **Key Takeaways for Onboarding**

- **Read and understand the business rules** implemented by the validation and pick/update flows. They are central to the application’s correctness.
- **Learn the file structures and key lists** (KLISTs), as they're the backbone of data access in this program.
- **Explore the switch/config table (CO402R)** for all the business rules toggled by parameters—most differences between installations or companies can be plugged in here.
- **Familiarize yourself with subfile programming** and display file operations in RPG if new to this area.
- **Note the extensive use of indicators** (`*INnn`) for controlling UI states and error/message handling.

---

## 8. **Further Reading**

- **ILE RPG Reference Manual** (for syntax and built-in functions, especially for those unfamiliar with fixed-form RPG).
- **IBM i Subfile Programming Guide** (for understanding subfile-based UIs).
- **Database file layouts or DDS** for all files mentioned (`fohelu`, `fplolu`, etc.)—essential to know the shapes of your records and keys.

---

By understanding this structure, you will be able to maintain, troubleshoot, and extend FO736R to meet business and user needs in warehouse order picking and processing.