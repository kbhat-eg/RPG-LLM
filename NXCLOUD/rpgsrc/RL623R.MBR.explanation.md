# RPG Program Explanation: RL023R – Printing Supplier Labels

## Overview

This RPG III/IV-style program is designed for IBM i (AS/400) systems and is responsible for printing labels for suppliers. The code supports various label formats (single, 3-across, laser), filtering (by supplier number, category, region, etc.), and both bulk and individual supplier selection.

The program is well-documented with history, indicator usage, and is structured with data definitions, file declarations, main logic, and subroutines.

---

## Key Sections

### 1. Header & Documentation

- The `/TITLE` and comment sections outline the purpose, history, and modification notes.
- Usage of indicators (e.g., KA for company selection, KC for exit, etc.) is detailed for program maintainers.

---

### 2. File Declarations

```rpg
frlevl1    if   e           k disk    rename(rlevpfr:rlavl1r)
frlevl2    if   e           k disk    rename(rlevpfr:rlevl2r)
frl623p    o    e             printer oflind(*in30)
```
- **frlevl1/frlevl2:** Supplier master files, accessed by key (`k disk`). Renamed for internal use.
- **frl623p:** Output printer file, using overflow indicator `*in30`.

---

### 3. Work Fields & Data Structures

**Tables (arrays for grouping up to 3 suppliers per label):**
- `lnr`, `lna`, `la1`, `la2`, `lst`, `lpe` – each holds segments (number, name, address 1, address 2, postal area, contact) for up to 3 suppliers (for 3-across labels).

**General Working Variables:**
- Counters (`n`, `m`, `wantre`, `wantdl`)
- Selector and filter fields (for region, category, range, etc.)
- `w_*` variables: working variables for firm and supplier keys.
- `kun(21)`: List of up to 21 individual supplier numbers for selection.
- Parameter structure (`uds`): Holds all filter and preference parameters.

---

### 4. Main Program Logic

#### Initialization

- Subroutine `*inzsr` sets initial values, prints label headers (depending on format), sets file position (`setll`) to the correct starting point.

#### Reading and Filtering Suppliers

1. **Loop (`lesk`):**
    - Reads the next supplier from `frlevl1` or `frlevl2` depending on alpha/numeric sort (controlled by `psort`).
    - If beyond company, program ends.

2. **Filtering:**  
   Several filters are applied, skipping to the next record (`goto neste`) if the supplier fails any:
    - Passive suppliers (if not included)
    - Supplier number range (`pknrf`–`pknrt`)
    - Department, category, warehouse, and district range
    - If individual suppliers are specified (`kun`), only those numbers are accepted

3. **Collecting Data for Printing:**
    - Supplier info is copied into the arrays (`lnr`, `lna`, etc.)
    - If contact person should be included, it's formatted as "Attn. ..."

#### Printing Labels

- **Single Label:** Immediately outputs using format `mlapp1`.
- **Three-Across or Laser Labels:**
    - Waits until 3 suppliers are collected; then outputs a row with formats `mlapp3` or `mlapp4`.
    - Overflow control for page headers (`head`).
    - Calls `xnull` subroutine to clear arrays before collecting the next set.

#### After Main Loop

- If the last collected group has fewer than 3, fills remaining label spaces with blanks and prints out the incomplete group before ending (`slutt`).

---

### 5. Subroutines

**`xnull`**  
Clears all supplier array values (`lnr`, `lna`, etc.) and reset counter `n` to zero.

**`*inzsr`**  
Program initialization: sets up starting variables, writes initial header if needed, positions input files.

---

## Key Indicators Used

- **10:** End-of-suppliers/stop reading
- **30:** Printer overflow/page break
- **LR:** End-of-program
- **n:** Counter for suppliers in the current label row (1–3)

---

## Special Features

- **Passive Supplier Exclusion:** Optionally skips passive suppliers based on a parameter.
- **Range Filtering:** Suppliers filtered on number, department, category, region, warehouse, etc.
- **Individual Supplier Mode:** Allows selection of up to 21 explicit suppliers (overrides ranges).
- **Label Formats:** Supports single, 3-across, and laser-compatible label formats.
- **Contact Info Option:** Can print contact person line if requested.

---

## High-Level Flow

1. **Initialize program and output.**
2. **Loop through supplier file(s), applying filters.**
3. **Gather up to 3 suppliers for one label-row (or 1 for single).**
4. **Output label (format depends on parameters).**
5. **Repeat until file is exhausted.**
6. **Print any remaining labels.**
7. **Write summary/footer and end.**

---

## Modification Markers

Lines starting with `T5.50`, `T5.40`, etc., indicate historical changes with references to project/version notes and sign-offs, helping with traceability and maintenance.

---

## Summary

This is a classic RPG program for complex, parameter-driven printing of supplier (vendor) address labels, supporting both batch and ad-hoc (individual-supplier) modes, with robust filtering, and output control for various physical label formats. The code is modularized with clear subroutines for initialization and array management, and leverages RPG's indicator-driven state management for control flow and output handling.