      /title  Oppdatering av akkumulerings-register
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASSTAT
      * Program . . . . : VS001R
      * Beskrivelse . . : Oppdatering av akkumulerings-register
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      * V5.30 221104 KOB  Korrigert feltlengder i DS
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fsknil1    if   e           k disk    rename(sknipfr:sknil1r)
     fskaklu    uf a e           k disk    rename(skakpfr:skaklur)
      *
      * Definering av parameter (inn)
      *
     d                 ds
     d wkparm                       128
     d  wkfirm                        3  0              overlay(wkparm:01)
     d  wkhhaa                        4  0              overlay(wkparm:04)
     d  wkkode                       12                 overlay(wkparm:08)
     d  wkperi                        2  0              overlay(wkparm:20)
     d  wkavde                             like(saavde) overlay(wkparm:31)
     d  wklage                             like(salage) overlay(wkparm:35)
     d  wkotyp                             like(saotyp) overlay(wkparm:37)
     d  wkland                        3                 overlay(wkparm:39)
     d  wkdist                             like(sadist) overlay(wkparm:42)
     d  wkselg                             like(saselg) overlay(wkparm:44)
     d  wkkkat                             like(sakkat) overlay(wkparm:48)
     d  wkkund                             like(sakund) overlay(wkparm:52)
     d  wkogrp                             like(saogrp) overlay(wkparm:58)
     d  wkhgrp                             like(sahgrp) overlay(wkparm:60)
     d  wkugrp                             like(saugrp) overlay(wkparm:62)
     d  wkvare                             like(savare) overlay(wkparm:65)
      *
     d  wkanta                       11  3              overlay(wkparm:81)
     d  wksumb                       11  2              overlay(wkparm:92)
     d  wksumk                       11  2              overlay(wkparm:103)
     d  wksumr                       11  2              overlay(wkparm:114)
      *
      * Omdefinering av kode
      *
     d wxkode          ds            12
     d wxkode_11                      1  0
     d wxkode_12                      1  0
     d wxkode_13                      1  0
     d wxkode_21                      1  0
     d wxkode_22                      1  0
     d wxkode_23                      1  0
     d wxkode_24                      1  0
     d wxkode_25                      1  0
     d wxkode_31                      1  0
     d wxkode_32                      1  0
     d wxkode_33                      1  0
     d wxkode_34                      1  0
      *
      * Definering av variable i nøkler
      *
     d w_firm          s                   like(safirm)
     d w_hhaa          s                   like(sahhaa)
     d w_kode          s                   like(sakode)
      *
     d skaklu_avde     s                   like(saavde)
     d skaklu_lage     s                   like(salage)
     d skaklu_otyp     s                   like(saotyp)
     d skaklu_land     s                   like(saland)
     d skaklu_dist     s                   like(sadist)
     d skaklu_selg     s                   like(saselg)
     d skaklu_kkat     s                   like(sakkat)
     d skaklu_kund     s                   like(sakund)
     d skaklu_ogrp     s                   like(saogrp)
     d skaklu_hgrp     s                   like(sahgrp)
     d skaklu_ugrp     s                   like(saugrp)
     d skaklu_vare     s                   like(savare)
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * XINIT  Initisiering av jobben                                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
      *  Hopper til Multioppdateringsrutinen
      *
     c     wkkode        cabeq     *blank        xstart
      *
      * Sjekk, Skal denne typen oppdatere akk.register
      *
     c                   eval      w_kode = wkkode
     c     sknil1_key    chain     sknil1r                            10
      *
     c     *in10         cabeq     *on           xslutt
     c     snakkk        cabne     *blank        xslutt
      *
      *  Start oppdatering
      *
     c                   eval      wxkode = wkkode
     c                   exsr      oppakk
      *
     c                   goto      xslutt
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * XSTART Henter alle budsjett-koder for oppdatering              *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c     xstart        tag
      *
     c                   eval      w_kode = *blank
     c     sknil1_key    setll     sknil1
      *
      *
     c     xneste        tag
     c                   read      sknil1                                 10
     c     *in10         cabeq     *on           xslutt
      *
      * Sjekk, Hopp ut dersom ikke riktig
      *
     c     snfirm        cabne     w_firm        xslutt
     c     snakkk        cabne     *blank        xneste
      *
      *  Start oppdatering
      *
     c                   eval      wxkode = snkode
     c                   exsr      oppakk
      *
      * Returner til les neste
      *
     c                   goto      xneste
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
      *
     c                   return
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Oppdater akkumulerings-register                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c     oppakk        begsr
      *
      * Kall opp subrutine for å lage riktig nøkkel
      *
     c                   exsr      lagkey
      *
      * Oppdater AKKUMULERINGS-REGISTER
      *
     c                   eval      w_kode = wxkode
     c     skaklu_key    chain     skaklur                            12
      *
     c     *in12         ifeq      *on
     c                   move      *zero         sasa01
     c                   move      *zero         sasa02
     c                   move      *zero         sasa03
     c                   move      *zero         sasa04
     c                   move      *zero         sasa05
     c                   move      *zero         sasa06
     c                   move      *zero         sasa07
     c                   move      *zero         sasa08
     c                   move      *zero         sasa09
     c                   move      *zero         sasa10
     c                   move      *zero         sasa11
     c                   move      *zero         sasa12
     c                   move      *zero         sasa13
      *
     c                   move      *zero         sara01
     c                   move      *zero         sara02
     c                   move      *zero         sara03
     c                   move      *zero         sara04
     c                   move      *zero         sara05
     c                   move      *zero         sara06
     c                   move      *zero         sara07
     c                   move      *zero         sara08
     c                   move      *zero         sara09
     c                   move      *zero         sara10
     c                   move      *zero         sara11
     c                   move      *zero         sara12
     c                   move      *zero         sara13
      *
     c                   move      *zero         sako01
     c                   move      *zero         sako02
     c                   move      *zero         sako03
     c                   move      *zero         sako04
     c                   move      *zero         sako05
     c                   move      *zero         sako06
     c                   move      *zero         sako07
     c                   move      *zero         sako08
     c                   move      *zero         sako09
     c                   move      *zero         sako10
     c                   move      *zero         sako11
     c                   move      *zero         sako12
     c                   move      *zero         sako13
      *
     c                   move      *zero         saan01
     c                   move      *zero         saan02
     c                   move      *zero         saan03
     c                   move      *zero         saan04
     c                   move      *zero         saan05
     c                   move      *zero         saan06
     c                   move      *zero         saan07
     c                   move      *zero         saan08
     c                   move      *zero         saan09
     c                   move      *zero         saan10
     c                   move      *zero         saan11
     c                   move      *zero         saan12
     c                   move      *zero         saan13
      *
     c                   endif
      *
     c     wkperi        ifeq      01
     c                   add       wksumb        sasa01
     c                   add       wksumk        sako01
     c                   add       wksumr        sara01
     c                   add       wkanta        saan01
     c                   endif
      *
     c     wkperi        ifeq      02
     c                   add       wksumb        sasa02
     c                   add       wksumk        sako02
     c                   add       wksumr        sara02
     c                   add       wkanta        saan02
     c                   endif
      *
     c     wkperi        ifeq      03
     c                   add       wksumb        sasa03
     c                   add       wksumk        sako03
     c                   add       wksumr        sara03
     c                   add       wkanta        saan03
     c                   endif
      *
     c     wkperi        ifeq      04
     c                   add       wksumb        sasa04
     c                   add       wksumk        sako04
     c                   add       wksumr        sara04
     c                   add       wkanta        saan04
     c                   endif
      *
     c     wkperi        ifeq      05
     c                   add       wksumb        sasa05
     c                   add       wksumk        sako05
     c                   add       wksumr        sara05
     c                   add       wkanta        saan05
     c                   endif
      *
     c     wkperi        ifeq      06
     c                   add       wksumb        sasa06
     c                   add       wksumk        sako06
     c                   add       wksumr        sara06
     c                   add       wkanta        saan06
     c                   endif
      *
     c     wkperi        ifeq      07
     c                   add       wksumb        sasa07
     c                   add       wksumk        sako07
     c                   add       wksumr        sara07
     c                   add       wkanta        saan07
     c                   endif
      *
     c     wkperi        ifeq      08
     c                   add       wksumb        sasa08
     c                   add       wksumk        sako08
     c                   add       wksumr        sara08
     c                   add       wkanta        saan08
     c                   endif
      *
     c     wkperi        ifeq      09
     c                   add       wksumb        sasa09
     c                   add       wksumk        sako09
     c                   add       wksumr        sara09
     c                   add       wkanta        saan09
     c                   endif
      *
     c     wkperi        ifeq      10
     c                   add       wksumb        sasa10
     c                   add       wksumk        sako10
     c                   add       wksumr        sara10
     c                   add       wkanta        saan10
     c                   endif
      *
     c     wkperi        ifeq      11
     c                   add       wksumb        sasa11
     c                   add       wksumk        sako11
     c                   add       wksumr        sara11
     c                   add       wkanta        saan11
     c                   endif
      *
     c     wkperi        ifeq      12
     c                   add       wksumb        sasa12
     c                   add       wksumk        sako12
     c                   add       wksumr        sara12
     c                   add       wkanta        saan12
     c                   endif
      *
     c     *in12         ifeq      *off
     c                   update    skaklur
     c                   else
      *
     c                   move      w_firm        safirm
     c                   move      w_hhaa        sahhaa
     c                   move      w_kode        sakode
      *
     c                   move      skaklu_avde   saavde
     c                   move      skaklu_lage   salage
     c                   move      skaklu_otyp   saotyp
     c                   move      skaklu_land   saland
     c                   move      skaklu_dist   sadist
     c                   move      skaklu_selg   saselg
     c                   move      skaklu_kkat   sakkat
     c                   move      skaklu_kund   sakund
     c                   move      skaklu_ogrp   saogrp
     c                   move      skaklu_hgrp   sahgrp
     c                   move      skaklu_ugrp   saugrp
     c                   move      skaklu_vare   savare
      *
     c                   write     skaklur
     c                   endif
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Lager nøkkel utfra budsjett-kode                                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c     lagkey        begsr
      *
     c                   eval      skaklu_avde = *zero
     c                   eval      skaklu_lage = *zero
     c                   eval      skaklu_otyp = *blank
     c                   eval      skaklu_land = *blank
     c                   eval      skaklu_dist = *zero
     c                   eval      skaklu_selg = *zero
     c                   eval      skaklu_kkat = *zero
     c                   eval      skaklu_kund = *zero
     c                   eval      skaklu_ogrp = *zero
     c                   eval      skaklu_hgrp = *zero
     c                   eval      skaklu_ugrp = *zero
     c                   eval      skaklu_vare = *blank
      *
      * (11-52) (Avdeling)
      *
     c     wxkode_11     ifeq      1
     c                   move      wkavde        skaklu_avde
     c                   endif
     c     wxkode_11     ifeq      2
     c                   move      wkavde        skaklu_avde
     c                   endif
     c     wxkode_11     ifeq      3
     c                   move      wkavde        skaklu_avde
     c                   endif
      *
      * (12-53) (Lager)
      *
     c     wxkode_12     ifeq      1
     c                   move      wklage        skaklu_lage
     c                   endif
     c     wxkode_12     ifeq      2
     c                   move      wklage        skaklu_lage
     c                   endif
     c     wxkode_12     ifeq      3
     c                   move      wklage        skaklu_lage
     c                   endif
      *
      * (13-51) (Ordretype)
      *
     c     wxkode_13     ifeq      1
     c                   move      wkotyp        skaklu_otyp
     c                   endif
     c     wxkode_13     ifeq      2
     c                   move      wkotyp        skaklu_otyp
     c                   endif
     c     wxkode_13     ifeq      3
     c                   move      wkotyp        skaklu_otyp
     c                   endif
      *
      * (21-25) (Land)
      *
     c     wxkode_21     ifeq      1
     c                   move      wkland        skaklu_land
     c                   endif
     c     wxkode_21     ifeq      2
     c                   move      wkland        skaklu_land
     c                   endif
     c     wxkode_21     ifeq      3
     c                   move      wkland        skaklu_land
     c                   endif
      *
      * (22-23) (Distrikt)
      *
     c     wxkode_22     ifeq      1
     c                   move      wkdist        skaklu_dist
     c                   endif
     c     wxkode_22     ifeq      2
     c                   move      wkdist        skaklu_dist
     c                   endif
     c     wxkode_22     ifeq      3
     c                   move      wkdist        skaklu_dist
     c                   endif
      *
      * (23-24) (Selger)
      *
     c     wxkode_23     ifeq      1
     c                   move      wkselg        skaklu_selg
     c                   endif
     c     wxkode_23     ifeq      2
     c                   move      wkselg        skaklu_selg
     c                   endif
     c     wxkode_23     ifeq      3
     c                   move      wkselg        skaklu_selg
     c                   endif
      *
      * (24-21) (Kundekategori)
      *
     c     wxkode_24     ifeq      1
     c                   move      wkkkat        skaklu_kkat
     c                   endif
     c     wxkode_24     ifeq      2
     c                   move      wkkkat        skaklu_kkat
     c                   endif
     c     wxkode_24     ifeq      3
     c                   move      wkkkat        skaklu_kkat
     c                   endif
      *
      * (25-32) (Kundenummer)
      *
     c     wxkode_25     ifeq      1
     c                   move      wkkund        skaklu_kund
     c                   endif
     c     wxkode_25     ifeq      2
     c                   move      wkkund        skaklu_kund
     c                   endif
     c     wxkode_25     ifeq      3
     c                   move      wkkund        skaklu_kund
     c                   endif
      *
      * (31-14) (Overgruppe)
      *
     c     wxkode_31     ifeq      1
     c                   move      wkogrp        skaklu_ogrp
     c                   endif
     c     wxkode_31     ifeq      2
     c                   move      wkogrp        skaklu_ogrp
     c                   endif
     c     wxkode_31     ifeq      3
     c                   move      wkogrp        skaklu_ogrp
     c                   endif
      *
      * (32-15) (Hovedgruppe)
      *
     c     wxkode_32     ifeq      1
     c                   move      wkhgrp        skaklu_hgrp
     c                   endif
     c     wxkode_32     ifeq      2
     c                   move      wkhgrp        skaklu_hgrp
     c                   endif
     c     wxkode_32     ifeq      3
     c                   move      wkhgrp        skaklu_hgrp
     c                   endif
      *
      * (33-16) (Undergruppe)
      *
     c     wxkode_33     ifeq      1
     c                   move      wkugrp        skaklu_ugrp
     c                   endif
     c     wxkode_33     ifeq      2
     c                   move      wkugrp        skaklu_ugrp
     c                   endif
     c     wxkode_33     ifeq      3
     c                   move      wkugrp        skaklu_ugrp
     c                   endif
      *
      * (34-31) (Varenummer)
      *
     c     wxkode_34     ifeq      1
     c                   move      wkvare        skaklu_vare
     c                   endif
     c     wxkode_34     ifeq      2
     c                   move      wkvare        skaklu_vare
     c                   endif
     c     wxkode_34     ifeq      3
     c                   move      wkvare        skaklu_vare
     c                   endif
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     csr   *inzsr        begsr
      *
      * Key for oppdatering av KUNDE-NIVÅ-REGISTER
      *
     c     sknil1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_kode
      *
      * Key for oppdatering av KUNDE-AKKUMULERINGS-REGISTER
      *
     c     skaklu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_hhaa
     c                   kfld                    w_kode
     c                   kfld                    skaklu_avde
     c                   kfld                    skaklu_lage
     c                   kfld                    skaklu_otyp
     c                   kfld                    skaklu_land
     c                   kfld                    skaklu_dist
     c                   kfld                    skaklu_selg
     c                   kfld                    skaklu_kkat
     c                   kfld                    skaklu_kund
     c                   kfld                    skaklu_ogrp
     c                   kfld                    skaklu_hgrp
     c                   kfld                    skaklu_ugrp
     c                   kfld                    skaklu_vare
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Tar inn parameter fra forrige program                          *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     c     *entry        plist
     c                   parm                    dsparm          128
     c                   move      dsparm        wkparm
      *
     c                   eval      w_firm      = wkfirm
     c                   eval      w_hhaa      = wkhhaa
      *
     csr                 endsr
