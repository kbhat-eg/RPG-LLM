     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Programmet leser w_dspfd og sjekker om kritiske
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  2022_04_19 sst Nytt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fw_dspfd   if   e             disk    usropn
      *
      * Definering av Local data area
      *
     d                uds
     d l_feil                  1      1
     d l_ws                  901    910
     d l_user                911    920
     d l_filg                931    933
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av variabler i nøkler
      *
      * Definering av variable
      *
     d p_lib           s             10
     d w_sekv          s              3  0
     d p_sekv          s              3
     d p_jobb          s             10
     d p_prog          s             10
     d p_text          s            100
     d w_cdat          s              6
     d w_stack         s            100
     d nxc_comp        s            200
     d w_src           s              5
     d w_srct          s            450
     d w_msg           s            200
     d w_firm          s              3  0
     d w_s1            s              4
     d w_s2            s              3
     d w_fra           s             16
     d w_til           s             16
     d w_txt           s            320
     d w_krit          s              1     inz('N')
     d w_krif          s              1     inz('N')
      *
      * Eksternt program
       dcl-s co402_verdi1  char(1);
       dcl-s co402_verdi2  char(2048);
       DCL-PR CO402R EXTPGM('CO402R');
         p_filgrp            char(3)     const;
         p_firm              packed(3:0) const;
         p_lager             packed(2:0) const;
         p_nokkel            char(50)    const;
         p_verdi1            char(1);
         p_verdi2            char(2048);
       END-PR;
      *
      *   _______________________________________________________________
     c                   open      w_dspfd
     c                   read      w_dspfd
      *
     c                   dow       not %eof(w_dspfd)
      *  __________
     c                   eval      w_s1  = %subst(mlname:1:4) + '*'
     c                   eval      w_s2  = %subst(mlname:1:3) + '*'
     c                   eval      w_src = %subst(mlname:1:5)
     c                   if        mlname <> *blank
     c                              and (%scan(w_src:w_srct) > 0
     c                               or  (%scan(w_s1:w_srct) > 0
     c                                and %scan('P ':mlname) > 0)
     c                               or  (%scan(w_s2:w_srct) > 0
     c                                and %scan('P ':mlname) > 0))
     c                   eval      w_msg = 'Source: ' +
     c                             %trim(mlname) + ' >' +
     c                             %trim(mlmtxt) + %trim('<')
     c                   eval      p_jobb = 'KRITISKSRC'
     c                   eval      p_prog = p_lib
     c                   eval      w_sekv = w_sekv + 1
     c                   move      w_sekv        p_sekv
     c                   eval      p_text = w_msg
     c                   call      'EGD99R'
     c                   parm                    p_jobb
     c                   parm                    p_prog
     c                   parm                    p_sekv
     c                   parm                    p_text
     c                   eval      w_krit = 'J'
     c                   endif
      *        Sjekk om ddf/sql definisjoner
     c                   if        mlname <> *blank
     c                              and (%scan('QDDF':mlfile) > 0
     c                               or  %scan('QSQL':mlfile) > 0)
     c                   eval      w_msg = 'Ny/endret file: ' +
     c                             %trim(mlname) + ' ligger i ' +
     c                             %trim(mlfile) + ' i ' +
     c                             %trim(mllib)
     c                   eval      w_krif = 'J'
     c                   eval      p_jobb = 'KRITISKSRC'
     c                   eval      p_prog = p_lib
     c                   eval      w_sekv = w_sekv + 1
     c                   move      w_sekv        p_sekv
     c                   eval      p_text = w_msg
     c                   call      'EGD99R'
     c                   parm                    p_jobb
     c                   parm                    p_prog
     c                   parm                    p_sekv
     c                   parm                    p_text
     c                   eval      w_krif = 'J'
     c                   endif
      *
     c                   read      w_dspfd
      *
     c                   enddo
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  ==========================================================================
     c     Avslutt       tag
      *
     c                   if        w_krit = 'J'
     c                   eval      w_txt = 'Det finnes kritiske sourcer i +
     c                              NXKORR. Sjekk med kommandoen NXK.'
     c                   eval      w_fra = 'SJEKKLIB'
     c                   call      'SEND_SMS'
     c                   parm                    w_til
     c                   parm                    w_fra
     c                   parm                    w_txt
     c                   endif
      *
     c                   if        w_krif = 'J'
     c                   eval      w_txt = 'Det finnes nye/endrede filer i ' +
     c                              %trim(p_lib) + ' for utsending på søndag. +
     c                                               Sjekk med kommandoen NXK'
     c                   eval      w_fra = 'SJEKKLIB'
     c                   call      'SEND_SMS'
     c                   parm                    w_til
     c                   parm                    w_fra
     c                   parm                    w_txt
     c                   endif
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      *
      * Parameterliste
      *
     c     *entry        plist
     c                   parm                    p_lib
      *
     c                   eval      w_firm = l_firm
7.02  * Programmer som skal overvåkes
7.02  *
7.02   CallP CO402R(l_filg:w_firm:0:'KRITISKE_SOURCER':
7.02                    co402_verdi1:co402_verdi2);
7.02   if co402_verdi1 = '1';
7.02     w_srct = co402_verdi2;
7.02   endif;
      *
     c                   endsr
      *
