**Overview**  
This program is an interactive inquiry (*spørring*) for order types within the ASOFAK system. It uses RPG subfile techniques to display a list of records from two physical files (VOTYL1 and VOTYL2), allowing the user to search and scroll through data. The user can apply filters based on order type (`b2otyp`) or description (`b2otxt`), navigate pages forward and backward, and select an item to return as a parameter.

---

### Primary Purpose  
- Provide an on-screen list of order types (`vaotyp`) and their descriptions (`vaotxt`).  
- Support various user interactions via function keys, including positioning the subfile to specific records, scrolling pages forward and backward, resetting the subfile content, and selecting an order type for return to the calling program.

---

### Data Sources and Files  
1. **VOTYL1** (renamed from `votypfr:votyl1r`)  
   - Used to retrieve order types keyed by firm (`w_firm`) and order type (`votyl1_otyp`).
2. **VOTYL2** (renamed from `votypfr:votyl2r`)  
   - Used to retrieve descriptions keyed by firm (`w_firm`) and description (`votyl2_otxt`).
3. **VA550D** (workstation file)  
   - Contains the subfile record format (`B1SFL`) and control record formats (`B2CTL`, `B2CMD`).  
   - Uses the feedback data structure (`dspfbk`) to track cursor location (`d_fcrn`).

---

### Program Parameters  
- **p_firm**: The firm field (like `vaofir`), identifying which firm’s order types to display.  
- **p_otyp**: An output parameter that will hold the user’s selected order type.

---

### Key Indicators and Displays  
- The subfile is shown via `B1SFL`, controlled by `B2CTL`.  
- `B2CMD` is a separate format for handling additional command keys.  
- Indicators (e.g., `*IN10` for roll forward, `*IN11` for roll backward) control paging logic and subfile clearing, displaying, and updating.  
- Indicators 12 (`Sfldsp`), 13 (`Sfldspctl`), 14 (`Sflclr`), 15 (`Sflend`) are set on/off at various points to manage subfile states.

---

### Overall Flow  
1. **Initialization**  
   - The program receives `p_firm` and `p_otyp` via the parameter list.  
   - It sets the default key for VOTYL1 (`votyl1_key`) by firm and a blank order type.  
   - A first subfile build (`crt_subfile`) is run for initial data loading.

2. **Main Loop**  
   - The user interface is refreshed by writing `B2CMD`, then the main loop is driven by subroutines and function key checks.  
   - On each iteration, the subfile is displayed (`dsp_subfile`) and the user’s input (function keys or selections) is evaluated.

3. **User Actions**  
   - **Exit** (`*INKC` or `*INKL`): Program tags `avslutt` and sets `*INLR = *ON`.  
   - **Refresh/Forny** (`*INKE`): Clears and rebuilds the subfile from the current position.  
   - **Page Forward** (`*IN10`): Calls `crt_subfile` to retrieve the next set of records.  
   - **Page Backward** (`*IN11`): Calls `bck_subfile` to scroll one page backward in the file.  
   - **Home Key** (`*IN21`): Toggles cursor placement (`*IN22`) and returns to the top format.  
   - **Positioning**: If the user enters an order type (`b2otyp`) or description (`b2otxt`), calls `posisjoner` to set a new key in VOTYL1 or VOTYL2, clear the subfile, and rebuild from that position.

4. **Subfile Reading and Selection**  
   - In subroutine `subfile`, each subfile record is read conditionally with `READC B1SFL`. If the user marked `b1valg = 1`, the program captures that order type in `p_otyp` and sets `b_valg_ok = *ON`, indicating the user made a valid choice that ends the loop.

5. **Building the Subfile (`crt_subfile`)**  
   - In subroutine `crt_subfile`, the program counts how many lines fit per page (`c_sfil` = 8) and repeatedly reads from VOTYL1 or VOTYL2, depending on the user’s search criterion (`w_seqe`).  
   - Each record read is written to `B1SFL`.  
   - The subfile end indicator (`*IN15`) is set if EOF is reached or if the record’s firm doesn’t match `w_firm`.

6. **Clearing the Subfile (`clr_subfile`)**  
   - Turns on indicator 14 (`*IN14`) to clear subfile data, writes `B2CTL`, and resets counters (`w_srrn`, `w_sfrn`, `w_ssrn`, `w_spge`).  
   - Indicator 15 (`*IN15`) is turned off again to allow new data to be loaded.

7. **Scrolling Backwards (`bck_subfile`)**  
   - If the subfile is finished (`*IN15 = *ON`), the code sets the keys to read the prior records (`READP VOTYL1` or `READP VOTYL2`).  
   - It iterates enough records to move backward one subfile page, then calls `clr_subfile` and `crt_subfile` to rebuild from that new position.

8. **Display Subfile (`dsp_subfile`)**  
   - If there are existing subfile records (`w_srrn > 0`), indicator 12 (`Sfldsp`) is set on. Otherwise, `B2CMD` is written.  
   - Indicator 13 (`Sfldspctl`) is set on, `B2CTL` is EXFMT’d to present the subfile to the user, then both indicators are turned off again.  
   - The data structure feedback (`dspfbk`) is checked for cursor row/column (`w_fcrn`).

---

### Notable Design Choices
- **Separate Files for Type and Description**: The program keeps two files, VOTYL1 (keyed by order type) and VOTYL2 (keyed by description). This makes it possible to handle positioning on either field in the subfile depending on the user’s filter choice.  
- **Dual Key Lists (`votyl1_key`, `votyl2_key`)**: Each key is defined in a sublist, so the code can quickly switch from searching by `otype` to `otxt`.  
- **Toggle of Indicators**: Common subfile indicators 12, 13, 14, 15 are toggled repeatedly to clear and redisplay sections. This is a typical approach to subfile rewriting in RPG.  
- **Use of Temporary Variables**: Variables like `w_srrn` (relative record number), `w_spge` (subfile page size), `w_ssrn` (last subfile record number) manage subfile pagination consistently.

---

### Business/Domain Logic
- The program’s core logic is tailored for listing valid order types, an essential component in many ERP-like applications. Users typically search by order type code or partial textual matches in the order description, then select the relevant record.  
- The returned order type (`p_otyp`) might be used in follow-up processes, such as creating or maintaining orders in other parts of the ASOFAK system.

---

**Summary**  
This RPG program manages a paginated subfile inquiry of order types stored in two database files. It allows users to navigate, position by code or text, and select an entry. The subroutines handle the standard operations—clearing the subfile, building pages, scrolling forward/back, and responding to inquiry requests—while returning the user’s selection to the calling process.