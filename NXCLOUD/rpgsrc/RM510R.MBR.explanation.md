## Overview  
This program (RM510R) is part of the ASOKON system and handles inquiries related to properties (“Eiendommer”). It reads and displays data from two database files—RMEIL1 and RMEIL2—through a subfile interface. The user can search for properties either by their numerical identifiers (EGNR/EBNR) or by a descriptive name (ENAV), and then page through the matching records.

## High-Level Flow  
1. The program is invoked with parameters (EALM, EGNR, EBNR, ENAV).  
2. It initializes a subfile display (via the display file RM510D) and positions the data based on these inputs.  
3. The core logic revolves around populating and navigating a subfile. The user can press function keys to page forward/backward, position to a specific record, select a record, or exit.  
4. When a record is selected, relevant fields (EGNR, EBNR, ENAV) are returned and the program ends.

## Data Sources  
- **RMEIL1 / RMEIL2**: Both point to property-related data. The code uses different key sequences for these two files:  
  - RMEIL1 is keyed by (FIRM, EALM, EGNR, EBNR).  
  - RMEIL2 is keyed by (FIRM, EALM, ENAV).  
- The program decides which file to read based on the “w_seqe” indicator: a value of 'B' means searching via RMEIL2 (by description), while blank indicates searching via RMEIL1 (by numbers).

## Subfile Logic and Structure  
- The display file defines a subfile (B1SFL) and corresponding subfile-control (B2CTL) records.  
- Several indicators (IN10, IN11, etc.) govern scrolling up/down and subfile maintenance.  
- The code uses these main subroutines to manage the subfile contents:

### 1. CLR_SUBFILE  
Clears the existing subfile contents by turning on indicator 14 (SFLCLR), writing the control record, then resetting counters such as w_srrn (current record number), w_sfrn (first record on the last page), and w_ssrn (last record contributed to the subfile).

### 2. CRT_SUBFILE  
Populates the subfile with a fixed block of records, determined by the constant c_sfil (page size). This subroutine reads sequentially from whichever file the code is currently set to, checking for end of file or a mismatch on the firm ID. Records are written to the subfile (B1SFL) until the page is filled or data is exhausted.

### 3. SUBFILE  
Handles user interactions once the page is displayed. It checks each subfile record (via READC) to see if the user marked it with “b1valg = 1.” If so, the selected record’s IDs (EGNR, EBNR, ENAV) are passed back via program parameters, and the program completes (“b_valg_ok = *on”). Otherwise, subfile reading continues.

### 4. FORNY  
Refreshes the subfile after the user issues a “refresh” function key (e.g., F5). It repositions the database (either on RMEIL1 or RMEIL2, depending on the current sequence), clears the subfile, and then repopulates the subfile by calling CRT_SUBFILE.

### 5. POSISJONER  
Positions the record pointer based on direct input in the display fields (e.g., b2egnr or b2enav). If the user typed a property number (EGNR) or description (ENAV), the program sets the key structures (rmeil1_key or rmeil2_key) and does a SetLL before refilling the subfile. This lets the viewer “jump” directly to a given record.

### 6. BCK_SUBFILE  
Pages backwards through the subfile by reading in reverse (READP). It repositions the pointer to the record just before the current subfile block, fills a temporary counter to move one page backward, and then rebuilds the subfile with CLR_SUBFILE and CRT_SUBFILE.

### 7. DSP_SUBFILE  
Shows the subfile display. Depending on whether there are any records, the program may skip the subfile portion (IN12). After writing the control record (B2CTL with EXFMT), the code updates w_fcrn (the cursor’s relative record number).

## Key Domain/Business Points  
1. **EALM, EGNR, EBNR**: Numerical property identifiers. These typically form the main “property ID.”  
2. **ENAV**: Textual descriptor for the property, useful for name-based searches.  
3. **Paging Mechanism**: The code breaks subfile records into chunks of size c_sfil (here, 8). Each page can display up to eight matching entries; the user can roll forward or backward to navigate.  
4. **Sequence Choice (w_seqe)**: The program dynamically toggles between RMEIL1 (numerical search) and RMEIL2 (description-based search).  
5. **Indicators**: This code uses a comprehensive indicator scheme for subfile management—clearing, displaying, controlling cursor position, and monitoring function key usage.

## Noteworthy Design Decisions  
- The subfile code is compartmentalized into small subroutines (clr_subfile, crt_subfile, bck_subfile, etc.) that each focus on one part of the subfile process. This makes the file easier to maintain but requires familiarity with the overall flow of calls.  
- The program sets different key lists (rmeil1_key, rmeil2_key) to position the read process depending on whether the user is searching by number or description.  
- Reversing through data (in bck_subfile) requires additional logic to read in reverse from the file and avoid overshooting the boundaries of the records.  
- Indicators serve both subfile management and function key control, requiring careful tracking of which indicators are turned on/off during each operation.

## Program Entry & Parameter Handling  
- The main entry point (labeled *ENTRY) sets up parameters (p_ealm, p_egnr, p_ebnr, p_enav).  
- It initializes the subfile area by positioning the file to the first record that matches the provided parameters, then calls CRT_SUBFILE to show the initial list of properties.  
- If the user selects a record or presses a function key to exit, the program returns the chosen property identifiers or ends without selection.

## Summary  
RM510R is a subfile-driven inquiry program for managing and retrieving property records in ASOKON. Through different key-based searches, it allows users to page through properties either numerically or by name. The design centers on modular subroutines that handle subfile clearing, population, navigation, and display, tied together by function key handling for user-driven paging and selection. The result is a flexible, indicator-based approach for property lookups and selection in a multi-page subfile environment.