# RPG Program Onboarding Explanation for `EL010R`

This program, written in IBM ILE RPG, is named **EL010R** and is part of the ASKORR system. It is a display file (workstation) program for *inquiry on a register* (“Spørring på register”). The code handles subfiles for interactive user input via 5250 screens.

---

## Key Concepts

- **Subfile**: An IBM i (AS/400) technique to display, scroll, and choose from lists on a 5250 screen.
- **Workstation File**: `fel010d`; provides the user interface.
- **Physical File**: `elf4lu` (with format `elf4lur`); contains the data.
- **Indicators**: Used for program logic and display file communication (`*INxx`).
- **Parameters**: Text, description, and status are passed in and returned.

---

## File Declarations

```rpg
felf4lu    if   e           k disk
f                                     rename(elf4pfr:elf4lur)
fel010d    cf   e             workstn
f                                     sfile(b1sfl:w_srrn)
```

- **elf4lu**: Input file (disk), with record format renamed to `elf4lur`.
- **fel010d**: Display file with subfile defined as `b1sfl`, record number tracked by `w_srrn`.

---

## Data Structures & Variables

### Parameters
```rpg
d p_text          s                   like(e4text)
d p_besk          s                   like(e4besk)
d p_stat          s              1
```
- Used to receive and return selected record values.

### Key and Work Variables
```rpg
d elf4lu_text     s                   like(e4text)
d w_spge          s              3  0   // Subfile page size
d w_srrn          s              4  0   // Subfile relative record number
d w_sfrn          s                   like(w_srrn)
d w_ssrn          s                   like(w_srrn)
d w_seqe          s              1
d w_type          s              2    inz('R ')
d w_valg_ok       s              1    inz(*off)
```
- **w_srrn**: Current subfile record number.
- **w_ssrn**: Last record number displayed in subfile.
- **w_sfrn**: First record number on screen.
- **w_spge**: Number of records per subfile “page.”
- **elf4lu_text** and **w_type**: Used for database positioning.

### Constant
```rpg
d c_sfil          s              2  0 inz(7)
```
- Number of records per subfile page (subfile size is 7).

---

## Subfile Screen Fields (as explained in comments)
- **w_srrn**: Subfile relative record number.
- **w_spge**: Subfile page size.
- **w_sfrn**: First record number on current page.
- **w_ssrn**: Last record number on current page.
- **wvisrn**: (not declared here, but referenced for page navigation).

---

## Main Processing Flow

### Initialization (`*inzsr`)
- Receives parameters (`p_text`, `p_besk`, `p_stat`).
- Prepares key for database positioning (`elf4lu_key`).
- Positions file at first record.
- Calls `crt_subfile` to load the first subfile page.

### Main Loop (pseudo-code)

1. **Display and Input (B2CTL)**
   - Write command screen, display subfile.
2. **Function Key Handling**
   - Exit keys (`*INKC`, `*INKL`): End program.
   - "Renew" key (`*INKE`): Positions and reloads subfile.
   - Roll/Scroll (`*IN10`): Loads next subfile page.
3. **Subfile Positioning**
   - If search value entered, position subfile accordingly.
4. **Subfile Processing**
   - Read subfile records for selection.
   - If selection made, store data to output parameters, and finish.

### End Program (`avslutt`)
- Set LR (Last Record) indicator on and return.

---

## Subroutines

### `forny` (Renew Subfile)
- Repositions physical file to start.
- Clears and reloads subfile.

### `posisjoner` (Position in Subfile)
- If user entered text for positioning, sets key and repositions file.
- Clears and fills subfile from new position.
- Clears search field.

### `subfile`
- Reads subfile records using `READC` (read changed records).
- If a record has `b1valg = '1'` (user selection), saves its values to output variables and sets `w_valg_ok` (selection made).

### `clr_subfile`
- Turns on indicator 14 (clear subfile).
- Writes control record to clear subfile.
- Resets indicators and subfile record counters.

### `crt_subfile`
- Increments page size counters.
- Reads records from database until subfile page is full or end of file or type mismatch.
- Writes each record to subfile.
- Updates page start/end counters for display logic.

### `dsp_subfile`
- If subfile has records, enables indicator for subfile display (`*IN12`).
- Writes/Displays control screen with `EXFMT`.
- Clears indicators after display.

---

## Indicators Used

- **LR (`*INLR`)**: End program.
- **10 (`*IN10`)**: Page/scroll.
- **12 (`*IN12`)**: Display subfile.
- **13 (`*IN13`)**: Display control record.
- **14 (`*IN14`)**: Clear subfile.
- **15 (`*IN15`)**: End of file for physical file.
- **16 (`*IN16`)**: No more changed subfile records (from `READC`).
- **60-69**: File operation indicators.

---

## Typical Use Case Flow

1. **Initialization**: Loads first page of register data into subfile, displays to user.
2. **User Navigation**: User can scroll, search, or select an entry.
3. **Selection**: When a user selects a record (`b1valg = '1'`), its text and description are returned.
4. **Exit**: User can cancel at any time.

---

## Subfile Screens Referenced

- **B1SFL**: Subfile record format.
- **B2CTL**: Subfile control record format.
- **B2CMD**: Command key prompt format.

---

## Summary

This RPG program provides a typical IBM i subfile selection user interface. It allows:
- Paging, searching, and selecting from a list.
- Streamlined navigation with function keys.
- Clean subfile handling with separate routines for clarity and maintainability.

**For onboarding:**  
- The subfile (screen list) logic, function key handling, and data passing are the focal points.
- The code is well-structured and commented, making it maintainable for future extensibility.

If you are new to this program, focus on understanding:
- The subfile lifecycle (clear, fill, display, process selection).
- How function keys and indicators coordinate display file actions.
- Parameter passing in and out of the program for integration.