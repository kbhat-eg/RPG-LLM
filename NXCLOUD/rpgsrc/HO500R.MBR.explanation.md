## Program Explanation: HO500R — Handheld Terminal Order Header Inquiry

### Purpose and Overview

This RPG program, **HO500R**, is part of the ASLAGR system and is responsible for presenting and handling inquiries into order headers via handheld terminals. It provides users with an interactive subfile-based display that allows searching, positioning, and viewing details for orders ("ordre-hode") stored in the system.

The program is designed to support efficient lookup and navigation in large volumes of order data, enabling direct access by order reference number or customer number, and supporting related actions like detail view and record retrieval.

### Key Structural Elements

#### 1. **File Declarations**
- The program utilizes several logical files, each with aliases for their record formats:
  - **HOHEL[R/1R/2R]:** Order header (main, by different access paths or keys).
  - **RKUNL1:** Customer master logical file.
  - **FKPRL1:** Customer project logical file.
- All files are accessed using unique keys optimized for their respective functions (search by reference, customer, or project).

#### 2. **Workstation and Display**
- **HO500D:** The display file with subfile support (`sfile(b1sfl:w_srrn)`) for listing orders.
- Several special screen formats are used:
  - `B1SFL:` Subfile record format (main list of orders).
  - `B2CTL:` Subfile control format (for actions and control keys).
  - `B2CMD:` Command/function key assistance display.

#### 3. **Indicators and Conventions**
- The code distinctively organizes indicators for:
  - End-of-program (`LR`)
  - Subfile handling (roll, screen field display, protection, page end)
  - Key handling (positioning, specific field input validation)
  - Error and business logic (validation, status, file access, etc.)

#### 4. **Key Data Structures**
- Several data structures are defined to align with the primary keys of the files:
  - For **orders**: Both by reference and customer.
  - For **customer** and **customer project**: To facilitate display of associated names and information.

#### 5. **Primary Variables and Subfile Management**
- The program manages subfile pagination and record navigation variables (`w_srrn`, `w_ssrn`, `w_spge`, etc.), critical for performance and user experience when working with large sets.

### Main Business Logic and Flow

#### Startup and Initialization

- `*inzsr` (Initialization subroutine): Sets up entry-point parameters, initializes key lists for all database accesses, and positions at the start of the order header file by firm. Then, it fills the subfile with the initial set of orders.

#### Main Processing Loop

- The user is presented with a subfile of orders. The program responds to function keys for navigation and specific actions:
  - **F3/F12:** Exit the program.
  - **F4:** Field input assistance.
  - **F5:** Refreshes or “renews” the subfile display (e.g., after database updates).
  - **Roll (F10):** Loads the next page of subfile entries.
  - **Home-key (F21):** Cursor positioning.
- For each actionable key, the program routes control via subroutine calls and control-flow tags (`goto b2tagb`, `goto avslutt`, etc.) to ensure functional clarity.

#### Subfile Control and Positioning

- **Positioning (`posisjoner`):**
  - Enables direct position in subfile by order reference (`b2refn`) or customer number (`b2kund`).
  - Uses corresponding keyed logicals to reposition quickly, then refreshes the subfile display.
- **Subfile Renewal (`forny`):**
  - Calls out to another module (`HO700C` — likely a refresh/update program), resets subfile state, and reloads visible orders.
- **Subfile Management (`clr_subfile`, `crt_subfile`, `dsp_subfile`):**
  - Handles clearing, populating, and displaying the order subfile.
  - Controls page size and manages the subfile’s navigation window (using `w_spge` and related variables).

#### Interactive Actions

- **View Details (`vis_detalj`):**
  - Calls program HD510R, passing in the relevant firm and reference number to display order header details on demand.
- **Record Retrieval (`hent_inn`):**
  - For the selected order, ensures it's eligible for retrieval based on status, presents a confirmation window if needed, then sets a flag indicating the record should be handed back to the calling process.
- **Input Assistance (`sp_input`):**
  - If the active input field is B2KUND (customer input), calls RK500R (likely a customer lookup program), then uses the selected customer to reposition the order list.

#### Special Error and Status Handling

- Error indicators and message flags are set based on business validation, such as non-existent reference numbers or invalid input, guiding the display logic (conditional message presentation on the subfile control screen).

### Notable Design Patterns, Conventions, and Integration Points

- **Separation of Actions and Display:** Clear distinction between core database logic (in subroutines) and user interface management (display subfile vs. control screen).
- **Use of External Programs:** Many actions rely on calling external modules (HO700C, HD510R, RK500R), which is typical in AS/400 business systems where modular processes are reused.
- **Subfile Paging/Positioning Logic:** Rather than loading the full data set, paging is efficiently managed to constrain memory use and speed up navigation, leveraging RPG’s support for subfiles.
- **Specialized Key Management:** Key lists ensure optimized access paths for each type of search or navigation (by order/ref, by customer, by project), making the system responsive for high-volume datasets.
- **Indicator Usage:** Adheres to well-defined blocks of indicators for different logic, which helps maintain readability and support.
- **Localization and Norwegian Business Terms:** Variables and comments use Norwegian terms (e.g., "ordre-hode," "kunde," "spørring"), reflecting the business context and domain.

### Relationships with Other Modules

- **HO700C:** Likely used for refreshing or mass-updating the order data in the subfile.
- **HD510R:** Order header detail display program.
- **RK500R:** Customer master details input/lookup.
- **Database files:** `HOHEPFR`, `RKUNPFR`, `FKPRPFR`—these files serve as the backbone for all order, customer, and project-related information.

### Summary

HO500R is a classic terminal-based RPG program, designed for efficient interactive search, navigation, and selection/inspection of order header records, with strong support for modular integration, subfile-driven UI, and responsive business logic tailored to order/customer inquiries in a Norwegian business environment. It establishes patterns and conventions (indicator usage, key list handling, display logic separation) that are consistent across many applications in this codebase.