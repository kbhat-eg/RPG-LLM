# RPG Program VA556R - Explanation

This source code is for an ILE RPG (Report Program Generator) program named `VA556R`. The program appears to be used for order type validation and selection in an IBM i (AS/400) environment. Below is an explanation of the structure and logic for onboarding purposes.

---

## 1. Header and File Declarations

```rpg
h option(*nodebugio) datedit(*dmy)
```
- **H Spec**: Sets the program options.
  - `*nodebugio`: Disables debug on I/O operations.
  - `datedit(*dmy)`: Date edit word for DD/MM/YY format.

```rpg
fva556d    cf   e             workstn
fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
```
- **F Specs**:
  - `va556d`: Workstation (display file) used for user interaction.
  - `votyl1`: Disk file, likely a table/file with order types, renamed as `votyl1r` for record format reference.

---

## 2. Definition of Variables

### Parameters (for calling program)

```rpg
d p_retu          s              1
d p_firm          s                   like(vaofir)
d p_otyp          s                   like(vaotyp)
```
- `p_retu`: Return code (length 1).
- `p_firm`: Firm/Company code (same type as `vaofir`).
- `p_otyp`: Order type (same type as `vaotyp`).

### Variables for Key Handling

```rpg
d votyl1_otyp     s                   like(vaotyp)
```
- `votyl1_otyp`: Used for order type key in lookups.

### General Local Variables

```rpg
d w_test          s              1  0
d w_firm          s                   like(vaofir)
```
- `w_test`: Working/test flag.
- `w_firm`: Working variable for firm code.

---

## 3. Main Program Logic

### Initialization

```rpg
c                   eval      b1otyp = *blank
```
- Clears (`*blank`) the `b1otyp` field, likely used on screen to enter an order type.

### User Interaction Loop

```rpg
c     b1tagb        tag
c                   exfmt     b1bld
```
- Places a label (`b1tagb`).
- Displays and waits for input for screen format `b1bld`.

### Function Key Handling

#### F3 = Exit

```rpg
c                   if        *inkc or *inkl
c                   eval      p_retu = '9'
c                   goto      avslutt
c                   endif
```
- If F3 (exit) or F12 (cancel) is pressed, sets return code to '9' and branches to program end.

#### F4 = Inquiry

```rpg
c                   if        *inkd = *on
c                   call      'VA550R'
c                   parm                    w_firm
c                   parm                    b1otyp
c                   goto      b1tagb
c                   endif
```
- If F4 (likely inquiry) is pressed, calls program `VA550R`, passing firm and order type as parameters, then returns to the input screen.

### Order Type Validation

```rpg
c                   if        b1otyp <> *blank
c                   eval      votyl1_otyp = b1otyp
c     votyl1_key    chain     votyl1r                            90
c                   if        *in90 = *on
c                   eval      *in32 = *on
c                   goto      b1tagb
c                   endif
```
- If an order type is entered:
  - Prepares key variable.
  - Performs a `CHAIN` (random read) in `votyl1` file.
  - If not found (`*in90`=ON), sets error indicator for screen (`*in32`=ON), returns to entry.

#### Additional Validation

```rpg
c                   if        vaosys <> w_test
c                   eval      *in33 = *on
c                   goto      b1tagb
c                   endif
c                   endif
```
- If some condition (likely system check) fails, sets another error indicator for the screen (`*in33`=ON), returns to entry.

### If Order Type Valid

```rpg
c                   eval      p_otyp = b1otyp
```
- Copies valid order type to return parameter.

---

## 4. Program Exit

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Label for exit.
- Sets last record indicator to turn off the program.
- Returns to caller.

---

## 5. *INZSR Subroutine (Initialization)

```rpg
c     *inzsr        begsr
c     *entry        plist
c                   parm                    p_retu
c                   parm                    p_firm
c                   parm                    p_otyp
```
- Subroutine `*INZSR` runs automatically at program start.
- Establishes parameter list for call.

```rpg
c     votyl1_key    klist
c                   kfld                    w_firm
c                   kfld                    votyl1_otyp
```
- Prepares key list for reading order type file: firm + order type.

```rpg
c                   eval      w_firm = p_firm
c                   move      p_retu        w_test
c                   eval      p_retu = *blank
c                   eval      p_otyp = *blank
c                   endsr
```
- Initializes local firm variable.
- Sets work test flag.
- Clears return parameters.

---

## 6. Additional Notes

- The program is entirely in "fixed-format" RPG, which uses column-based coding.
- User interaction is handled via a display file; function keys are used for control.
- Error handling uses indicator lights (`*in32`, `*in33`, `*in90`), which typically correspond to specific error fields/messages on the screen.
- Subprogram calling is done with `CALL` and `PARM`.
- The program validates an order type against a reference file, enables lookup, and provides error feedback on the display.

---

## Summary

This program allows a user to enter and validate an order type for a given firm. It handles:
- User input and validation through a display file
- File lookup for order type validation
- Error handling and user feedback using screen indicators
- Exit and inquiry functionality via function keys
- Parameter passing for integration with other programs

The main loop continues until the user provides valid input or exits, ensuring data integrity and user-friendly feedback.