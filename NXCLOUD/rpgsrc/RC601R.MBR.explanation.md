# RPG Source Code Walkthrough: "Utskrift av saker"

This RPG/400 (ILE RPG) program is for printing matters (cases), likely a register/listing report from a database of cases, customers, and related data. Below is a detailed explanation for onboarding developers.

---

## 1. **Header & Documentation**
- The `/TITLE` and comment block at the top describe:
    - **System**: ASOKON
    - **Program Name**: RC601R
    - **Description**: Printing of cases ("Utskrift av saker")
    - **Version/Change notes**: Example - At version 7.00, it fetches the name of the collection agency from RCA0PF.

- Use of indicators is well-documented (e.g., `KA`, `KC`, `LR`, `30`, `31-59`, etc.), which is important for maintaining code readability and standard usage of RPG indicators.

---

## 2. **File Declarations**
```rpg
frcnfl1    if   e           k disk    rename(rcnfpfr:rcnfl1r)
frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
frca0l1    if   e           k disk    rename(rca0pfr:rca0l1r)
frc601p    o    e             printer oflind(*in30)
```
- **Input Files**:
    - `rcnfl1`: The main case register, renamed record format for clarity.
    - `rkunl1`: Customer register.
    - `rca0l1`: Status codes, e.g., collection agency info (added in version 7.00).
- **Output File**:
    - `rc601p`: Printer output with overflow indicator `*in30`.

---

## 3. **Variable & Data Structure Declarations**

### Key Variables
```rpg
d rcnfl1_kund     s                   like(rkkund)
d rkunl1_kund     s                   like(rkkund)
```
Defines variables matching the customer number field type.

### Local Data Area (LDA) Map
```rpg
d l_wsid                901    910
d l_user                911    920
d l_file                931    933
d l_firm                944    946  0
d l_fnav                951    980
```
Maps fields from the Local Data Area, useful for session/user info.

### Date Work Structures
```rpg
d                 ds
d w_dato                         6  0
d  w_dag                         2  0 overlay(w_dato)
d  w_mnd                         2  0 overlay(w_dato:3)
d  w_aar                         2  0 overlay(w_dato:5)
```
Overlays allow interpretation of a date as day, month, and year.

### Other Variables
- String, customer, firm, and status fields for controlling logic and output.

---

## 4. **Main Process Loop**

### Initialization
```rpg
c     rcnfl1_key    setll     rcnfl1
c     rcnfl1_key    reade     rcnfl1                                 90
```
- Positions and reads the first record in the case register file.

### Main Loop
```rpg
c                   dow       *in90 = *off
```
- Loops over case register records until EOF (`*in90` is set by `reade`).

#### Core Logic
- Sets local reference fields.
- Skips records where the file doesn't match the required `l_file`.
- Increments total case counter (`w_tota`).
- Applies filters based on `w_type` and `rcnsta` (status), skipping records as needed.
- Reads customer data for the current record.
- Calls two subroutines:
    - `kontroll`: Checks for exclusion conditions (e.g., closed case dates).
    - `utskrift`: If not excluded, prints the record.

```rpg
c     neste         tag
c     rcnfl1_key    reade     rcnfl1                                 90
c                   enddo
```
- Tag/label system is used for skipping to the next iteration.

### End of Program
- Sets LR (last record, end program).
- Stores final counts.
- Writes summary to the printer file.

---

## 5. **Subroutines**

### kontroll
```rpg
c     kontroll      begsr
...
c                   endsr
```
- Resets delete flag.
- Skips records based on closed date (`rcndat` > `w_edat` for type "J" cases).
- Logic ensures only relevant records are printed.

### utskrift
```rpg
c     utskrift      begsr
...
c                   endsr
```
- Increments customer count.
- Checks for printer file overflow (`*in30`), writes page header if needed.
- Prints the detail line.

### *inzsr (Initialization Subroutine)
```rpg
c     *inzsr        begsr
...
c                   endsr
```
- Receives parameters (`w_type` and `w_edat`).
- Sets up key lists for file access.
- Fetches firm info from LDA, loads agency name (if not found, sets to "Unknown").
- Sets indicator 11 based on `w_type`.
- Prints the first header.

---

## 6. **Other Key Points**

- **Indicator usage**: Extensively uses RPG indicators for state, flow, error, and print control.
- **Comments**: Norwegian comments and data names; business logic is domain-specific (case/customer registry).
- **RPG III/IV style**: C-specs, D-specs, and explicit subroutine handling (begsr/endsr).

---

## 7. **Typical Program Flow**
1. Initializes parameters and keys.
2. Loops through all cases for a firm and file.
3. For each case:
    - Skips according to type and status.
    - Checks if closed after the given date.
    - Reads customer data.
    - Prints case details if eligible.
4. At EOF, prints totals and finishes.

---

## 8. **Onboarding Summary**

- **Purpose**: List/print cases filtered by type/date/status.
- **Architecture**: Classic RPG, modular with clearly defined subroutines.
- **Key Data**: Case (`rcnfl1`), Customer (`rkunl1`), Agency (`rca0l1`).
- **Indicators**: Critical for logic, flow, and output control.
- **Customization**: Entry parameters allow flexible use per report run.
- **Extension**: New business logic typically added via new subroutines or inline conditions.

---

This program is a well-commented, classic RPG report for case management, well-suited for maintenance and moderate extension by developers familiar with RPG and Norwegian business terminology.