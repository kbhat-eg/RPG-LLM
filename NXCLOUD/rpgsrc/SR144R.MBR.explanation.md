## Program SR144R – Selection for Parameter File, Campaign (ASSTAT System)

### Overview

SR144R is part of the ASSTAT system. Its main function is to handle campaign selection and maintenance in a parameter file. Specifically, it interacts with parameter records for campaigns, fetching, displaying, updating, or deleting entries from two files:
- **SLPML1**: The master parameter file (input-only).
- **SLPMLU**: The update parameter file (update-capable).

The program is driven by workstation input (i.e., is interactive, as seen with `workstn`) and is generally used as part of a workflow where a previous program calls it with campaign/parameter context.

---

### File Relationships

1. **SR144D** – Workstation file for screen interaction.
2. **SLPML1** (renamed as SLPML1R) – Parameter file, `input` access only, key-based.
3. **SLPMLU** (renamed as SLPMLUR) – Parameter file for update, allowing `update`, `delete`, or `write` operations, key-based.

---

### Data & Structures

#### Working Variables
- **wwfyll**, **wptext**: Temporary storage for data from screen or previous program.
- **wwfirm**, **wwtype**, **wwkode**, **wptype**: Store "company", "type", and "code" information.
  
#### Data Structures
- **wwrest(DS)**: 330 bytes, holding extra record information, mainly text and campaign field.
  - `wwtext`: Text/title (1–30).
  - `wwkamp`: Campaign code (31–35).
- **dsuser**: User info (used in context but not directly manipulated here).
- **wwvalg(DS)**: Holds selection values for searching/updating.

#### Keylist
- **key01**: Nested key fields to uniquely identify a campaign parameter record:
  - `wwfirm`, `wwtype`, `wwkode`, `wwvalg`

---

### Main Program Logic

#### Initialization (`*inzsr` Subroutine)
- Receives two parameters from a previous program: type (`wptype`) and text (`wptext`).
- Sets up the key fields for subsequent file operations.
- Initializes other working fields and variables used later.

#### Main Loop

##### 1. Display/Input Handling
- Main label is `b2tagb`.
- Loads selection value into key structure for subsequent chain lookups.

##### 2. Fetch Existing Record (`SLPML1`)
- Executes `chain` using `key01`.
- If the record exists (`*in60 = *off`):
  - Loads auxiliary/rest fields (`srrest` → `wwrest`).
  - Gets the campaign code from the rest structure for screen field `b2kamp`.
- If the record doesn't exist (`*in60 = *on`):
  - Blanks out the campaign code on the screen.

##### 3. User Input via Screen
- Uses EXFMT (`b2bld`) to display/edit campaign info.

##### 4. Program Exit Handling
- If the user presses a function key to exit (`*inkc` or `*inkl`), jump to `xslutt` to end program cleanly.

##### 5. Save Logic
- Updates working fields from input values.
- Fetches the update record (`SLPMLU`).
- Prepares rest structure and text for update.

###### If record exists in update file (SLPMLU):
- If the campaign code is blank, the record is deleted.
- Otherwise, updates the record with newest info and resets `srsyst` to indicate "L" (possibly denoting an update/modification through this module).

###### If record does not exist:
- Populates relevant fields with context and writes a new record to `SLPMLU`.

---

### Program Termination

#### `xslutt` Label
- Sets LR indicator on (`*inlr = *on`) for RPG clean-up.
- Returns to caller (previous program or system).

---

### Domain/Business Specifics

- **Company (Firm), Type, Code**: These are domain-identifying keys for campaign/parameter records.
- **Campaign logic**: If a campaign code is no longer present (blanked out), existing parameter records are removed.
- **Rest/WWREST**: Used for storing user-editable data like campaign code and display text–critical for downstream campaign logic.
- **Parameter Passing**: Relies on values passed from a previous program stage; ensures workflow is tightly integrated.
- **Field 'srsyst'**: Marker ('L') for campaign records manipulated by this program, can be used for audit or differentiation by other system components.

---

### Design/Codebase Conventions & Observations

- **Direct screen interaction** is common in this application style via the workstation file.
- **Data field renaming** is used for clarity and to reduce field name conflicts across files.
- **Short variable names** are legacy AS/400 RPG conventions; always refer to field usage lists for mapping to functional meaning.
- **Tag-based control flow** (`b2tagb`, `xslutt`)—standard old-school RPG (III/400) structure, not modern structured RPG.
- **Keylists**: Used for repeated key-based file actions, ensuring consistency between reads/updates.
- **Exit logic**: Handles both operator-requested and program-driven exits with explicit function key checks.

---

### Integration Points

- **Preceding program**: Supplies campaign/parameter context.
- **Parameter files**: SLPML1 is authoritative for existing parameters; SLPMLU is used for updates and write-backs, potentially for batch updates later or for audit purposes.

---

### Summary

This program provides interactive maintenance for campaign-related parameter records, allowing users to view, update, or delete campaign assignments based on input provided from upstream workflow. It ensures all changes are reflected in both the main and update files, with auditability via srsyst. Understanding this program is key for anyone working on or supporting campaign/parameter workflows within the ASSTAT application.