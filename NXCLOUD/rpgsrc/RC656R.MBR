     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RC656R                                              *
      * Beskrivelse . . : Oppdatering av inkassokode med dato                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato  Sign Endringsbeskrivelse                             *
      * --------- ------ ---- ----------------------------------------------- *
6.10  * V6.10     210909 BSA  Lagt inn sporingsfelter                         *
6.30  *           200320 sst  Legg ut dagens dato som ink.dat på poster       *
6.30  *                       Oppdatere kunde med sperrekode
6.31  *           200414 sst  RKKRES=1 settes istedenfor  RKSPRK = 'J'          *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     frkwbpf    if   e           k disk    rename(rkwbpfr:rkwbpfr)
     frktrlu    uf   e           k disk    rename(rktrpfr:rktrlur)
6.30 frkunlu    uf   e           k disk    rename(rkunpfr:rkunlur)
      *
6.30 d w_ink_kun_sper  s              1    inz(' ')
6.30 d w_dd_ink_dato   s              1    inz(' ')
6.30  *
6.30   dcl-s co402_verdi1  char(1);
6.30   dcl-s co402_verdi2  char(2048);
6.30   DCL-PR CO402R EXTPGM('CO402R');
6.30     p_filgrp            char(3)     const;
6.30     p_firm              packed(3:0) const;
6.30     p_lager             packed(2:0) const;
6.30     p_nokkel            char(50)    const;
6.30     p_verdi1            char(1);
6.30     p_verdi2            char(2048);
6.30   END-PR;

     d                uds
      *
     d  pfirm                300    302  0
     d  pnavn                303    332
     d  puser                333    342
     d  pkdat                343    348  0
     d  praar                349    352  0
     d  prper                353    354  0
     d  pavdf                355    358  0
     d  pavdt                359    362  0
     d  pkatf                363    366  0
     d  pkatt                367    370  0
     d  pself                371    374  0
     d  pselt                375    378  0
     d  pknrf                379    384  0
     d  pknrt                385    390  0
     d  kun                  391    450  0 dim(10)
     d  pknr1                391    396  0
     d  pknr2                397    402  0
     d  pknr3                403    408  0
     d  pknr4                409    414  0
     d  pknr5                415    420  0
     d  pknr6                421    426  0
     d  pknr7                427    432  0
     d  pknr8                433    438  0
     d  pknr9                439    444  0
     d  pknr0                445    450  0
     d  pfdat                451    456  0
     d  plope                457    459  0
     d  ppkod                460    460
     d  ppros                461    463  1
     d  pgrns                464    465  0
     d  pgbyr                466    466
     d  pmini                467    468  0
     d  pbskr                469    469
     d  pegrn                470    470
     d  pajor                471    471
     d  ptext                472    472  0
     d  ppunr                473    473  0
     d  ppbeh                474    474
     d  palfa                475    475
     d  pdfgg                476    481  0
     d  pparam               300    490
      *
     d  l_wsid               901    910
     d  l_user               911    920
     d  l_fgrp               931    933
     d  l_firm               944    946  0
     d  l_fnav               951    980
      *
     c     dummy         tag
      *
      *  Oppdater inkassokode og dato
      *
     c                   read      rkwbpfr                                61
      *
     c                   dow       *in61 = *off
      *
      *  Oppdater inkassokode og dato
      *
     c     rnkey         chain     rktrlu                             10
      *
     c                   if        *in10 = *off
     c                   move      'J'           rninko                         KODE - Sendt inkasso
     c     *dmy          move      pkdat         rnidat
6.30  *  Ev. dagens dato som inkassodato på postene som er sendt
6.30 c                   if        w_dd_ink_dato   = 'J'
6.30 c     *dmy          move      udate         rnidat
6.30 c                   endif
6.30  *
6.10 c                   time                    rnedat
6.10 c                   time                    rnetim
6.10 c                   eval      rneusr = l_user
     c                   update    rktrlur
     c                   endif
6.30  *
6.30  *  Ev. oppdatere kunde som sperret når sendt inkasso
6.30  *
6.30 c                   if        w_ink_kun_sper = 'J'
     c                             and rkkund <> rnkund
6.30 c     rkunlu_key    chain     rkunlu
6.30 c                   if        %found(rkunlu)
6.31 c**  14.04.20       eval      rksprk = 'J'   BBR, / Berit
6.31 c                   eval      rkkres = 1
6.30 c                   time                    rkedat
6.30 c                   time                    rketim
6.30 c                   eval      rkepgm = 'RC656R'
6.30 c                   update    rkunlur
6.30 c                   endif
6.30 c                   endif
      *
     c     neste         tag
      *
     c                   read      rkwbpfr                                61
     c                   enddo
      *
     c                   seton                                        lr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      * Key for kundeposteringer
      *
     c     rnkey         klist
     c                   kfld                    rnfirm
     c                   kfld                    rnkund
     c                   kfld                    rnbdat
     c                   kfld                    rntist
6.30  *
6.30 c     rkunlu_key    klist
6.30 c                   kfld                    rnfirm
6.30 c                   kfld                    rnkund
6.30  *
6.30  *   Sjekk diverse spesialiteter
6.30  *
6.30    CallP CO402R(l_fgrp:l_firm:0:'INKASSO_DATO_DD':
6.30                     co402_verdi1:co402_verdi2);
6.30    if co402_verdi1 = '1';
6.30      eval  w_dd_ink_dato = 'J';
6.30    endif;
6.30  *
6.30    CallP CO402R(l_fgrp:l_firm:0:'INKASSO_KUNDE_SPERRES':
6.30                     co402_verdi1:co402_verdi2);
6.30    if co402_verdi1 = '1';
6.30      eval  w_ink_kun_sper = 'J';
6.30    endif;
6.30  *
     c                   endsr
