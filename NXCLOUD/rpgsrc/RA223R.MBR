      /TITLE  ASSERV Vedlikehold av Gruppe-tekster (Hm)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : Status innlesning filer
      * Program . . . . : RA223R
      * Beskrivelse . . : SJekk om alle filer er lest inn
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      *  Dato  Sign Endringbeskrivelse
      * ------ ---- ---------------------------------------------      ----
      * 061117 sst  Nytt program
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     frsvsl1    if   e           k disk    rename(rsvspfr:rsvsl1r)
     frsvsl2    if   e           k disk    rename(rsvspfr:rsvsl2r)
     frsvslu    uf a e           k disk    rename(rsvspfr:rsvslur)
      *
     f**ra223d    cf   e             workstn sfile(b1sfl:w_srrn)
     fra223d    cf   e             workstn
      *
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av parametre
      *
      *
      * Definering av variabler i nøkler
      *
     d rsvsl1_firm     s                   like(rvfirm)
     d rsvsl1_type     s                   like(rvtype)
     d rsvsl1_fdat     s                   like(rvfdat)
     d rsvsl1_file     s                   like(rvfile)
     d rsvsl2_firm     s                   like(rvfirm)
     d rsvsl2_type     s                   like(rvtype)
     d rsvsl2_fdat     s                   like(rvfdat)
     d rsvslu_firm     s                   like(rvfirm)
     d rsvslu_type     s                   like(rvtype)
     d rsvslu_fdat     s                   like(rvfdat)
     d rsvslu_file     s                   like(rvfile)
      *
      * Definering av variable
      *
     d w_spge          s              3  0
     d w_srrn          s              4  0
     d w_sfrn          s                   like(w_srrn)
     d w_ssrn          s                   like(w_srrn)
      *
     d w_seqe          s              1
     d w_forn          s              1    inz(*off)
     d w_anul          s              1    inz(*off)
     d w_feil          s              1    inz(*off)
     d w_date          s               d   datfmt(*iso)
     d w_sdat          s               d   datfmt(*iso)
     d w_dati          s               d   datfmt(*iso)
     d w_edat          s             10
     d w_dd            s              2
     d w_mm            s              2
     d w_aa            s              2
     d waan            s              2  0
     d w_dat           s              6  0
     d w_datx          s              6
     d w_days          s              5  0
     d w_rem           s              5  0
     d wactli          s              2  0
     d wactpo          s              3  0
     d w_txt           s             43
     d w_fdat          s             10
     d w_f             s              1
     d w_f2            s              1
     d w_f3            s              1
     d w_lestfor       s              1
     d p_type          s             10
     d p_file          s             30
      *
      * Definering av konstanter
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B2CTL Behandle åpningsbildet med subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   eval      rsvsl2_firm = l_firm
     c                   eval      rsvsl2_type = 'SVEA'
     c                   eval      w_mm = %subst(p_file:16:2)
     c                   eval      w_dd = %subst(p_file:18:2)
     c                   if        umonth = 01
     c                             and  w_mm = '12'
     c                   eval      waan = uyear - 1
     c                   else
     c                   eval      waan = uyear
     c                   endif
     c                   move      waan          w_aa
     c                   eval      w_datx = w_dd + w_mm + w_aa
     c                   move      w_datx        w_dat
     c     *dmy          move      w_dat         rsvsl2_fdat
     c     rsvsl2_key    chain     rsvsl2
     c                   if        %found(rsvsl2)
     c                   eval      w_lestfor = 'J'
     c                   endif
      *
     c                   eval      w_sdat = rsvsl2_fdat
     c                   subdur    1:*days       rsvsl2_fdat
     c*                  eval      rsvsl1_file = 'ÅÅÅÅÅÅÅÅ'
     c     *dmy          move      021017        w_date
     c                   eval      m1mld1 = ' Fil-dato  -
     c                             Melding                Lest dato'
      *
     c*    rsvsl1_key    setgt     rsvsl1
     c*                  readp     rsvsl1
     c                   do        7
     c                   eval      w_txt = *blank
     c     rsvsl2_key    chain     rsvsl2
     c                   if        %found(rsvsl2)
      *  Forrige dag er lest inn og rapporteres i bilde
     c                   movel     rsvsl2_fdat   w_txt
     c                   eval      w_txt = %trim(w_txt) + ' ' + rvfile
     c                   goto      bilde
     c                   endif
      *
     c                   movel     rsvsl2_fdat   w_txt
     c
     c     rsvsl2_fdat   subdur    w_date        w_days:*D
      *
      /Free
            w_rem = %rem(w_days:7);
      /End-Free
     c                   eval      w_f = ' '
     c                   select
     c                   when      w_rem = 5
     c                   eval      w_txt = %trim(w_txt) + ' Lørdag'
     c                   when      w_rem = 6
     c                   eval      w_txt = %trim(w_txt) + ' Søndag'
     c                   other
     c                   eval      w_txt = %trim(w_txt) + ' Denne dagen mangler'
     c                   eval      w_f = 'J'
     c                   eval      w_f2 = 'J'
     c                   endsl
     c                   goto      bilde
      *
     c     bilde         tag
     c                   select
     c                   when      m1mld2 = *blank
     c                   if        w_lestfor = 'J'
     c                   eval      m1mld3 = w_txt
     c                   if        w_f = 'J'
     c                   eval      *in42 = *on
     c                   endif
     c                   eval      w_txt = *blank
     c     *dmy          move      w_dat         w_dati
     c                   movel     w_dati        w_txt
     c                   eval      w_txt = %trim(w_txt) + ' Filen er lest før'
     c                   eval      m1mld2 = w_txt
     c                   eval      *in41 = *on
     c                   else
     c                   eval      m1mld2 = w_txt
     c                   if        w_f = 'J'
     c                   eval      *in41 = *on
     c                   endif
     c                   endif
     c                   when      m1mld3 = *blank
     c                   eval      m1mld3 = w_txt
     c                   if        w_f = 'J'
     c                   eval      *in42 = *on
     c                   endif
     c                   when      m1mld4 = *blank
     c                   eval      m1mld4 = w_txt
     c                   if        w_f = 'J'
     c                   eval      *in43 = *on
     c                   endif
     c                   when      m1mld5 = *blank
     c                   eval      m1mld5 = w_txt
     c                   if        w_f = 'J'
     c                   eval      *in44 = *on
     c                   endif
     c                   when      m1mld6 = *blank
     c                   eval      m1mld6 = w_txt
     c                   if        w_f = 'J'
     c                   eval      *in45 = *on
     c                   endif
     c                   when      m1mld7 = *blank
     c                   eval      m1mld7 = w_txt
     c                   if        w_f = 'J'
     c                   eval      *in46 = *on
     c                   endif
     c                   when      m1mld8 = *blank
     c                   eval      m1mld8 = w_txt
     c                   if        w_f = 'J'
     c                   eval      *in47 = *on
     c                   endif
     c                   endsl
     c     rsvsl2_fdat   subdur    1:*days       rsvsl2_fdat
     c                   enddo
     c                   eval      wActli = 2
     c                   eval      wActpo = 2
     c                   if        w_lestfor = 'J'
     c                             or w_f2 = 'J'
     c                   if        w_lestfor = 'J'
     c                   eval      m1msg = 'Denne filen er lest før. -
     c                             Vil du fortsette?'
     c                   else
     c                   if        w_f2 = 'J'
     c                   eval      m1msg = 'En/Flere filer mangler. -
     c                             Vil du fortsette?'
     c                   endif
     c                   endif
     c                   exfmt     m1win
     c                   if        m1svar <> 'J'
     c                   eval      p_type = 'Avbrudd'
     c                   goto      end
     c                   endif
     c                   eval      rsvslu_firm = l_firm
     c                   eval      rsvslu_type = rsvsl2_type
     c                   eval      rsvslu_fdat = w_sdat
     c                   eval      rsvslu_file = p_file
     c     rsvslu_key    chain     rsvslu
     c                   eval      rvfile = p_file
     c                   eval      rvfdat = w_sdat
     c                   time                    rvedat
     c                   time                    rvetim
     c                   eval      rveusr = l_user
     c                   if        %found(rsvslu)
     c                   eval      rvantl = rvantl + 1
     c                   update    rsvslur
     c                   else
     c                   time                    rvodat
     c                   time                    rvotim
     c                   eval      rvousr = l_user
     c                   eval      rvantl = 1
     c                   eval      rvfirm = l_firm
     c                   eval      rvtype = 'SVEA'
     c                   write     rsvslur
     c                   endif
     c                   endif
      *
     c     end           tag
     c                   eval      *inlr = *on
ad    *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_type
     c                   parm                    p_file
      *
      * Key for posisjonering på recordformat
      *
     c     rsvsl1_key    klist
     c                   kfld                    rsvsl1_firm
     c                   kfld                    rsvsl1_type
     c                   kfld                    rsvsl1_fdat
     c                   kfld                    rsvsl1_file
      *
     c     rsvsl2_key    klist
     c                   kfld                    rsvsl2_firm
     c                   kfld                    rsvsl2_type
     c                   kfld                    rsvsl2_fdat
      *
      * Key for posisjonering på recordformat
      *
     c     rsvslu_key    klist
     c                   kfld                    rsvslu_firm
     c                   kfld                    rsvslu_type
     c                   kfld                    rsvslu_fdat
     c                   kfld                    rsvslu_file
      *
     c                   endsr
      *
