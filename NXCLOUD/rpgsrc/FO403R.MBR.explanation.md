# RPG Program FO403R – File Cleanup and Company Deletion

This program, written in ILE RPG, is designed to systematically delete all records belonging to a specific company (identified by `l_firm`) from a set of files in the ASOFAK system.

---

## High-Level Description

- **System:** ASOFAK
- **Program:** FO403R
- **Purpose:** Deletes all records for a specified company across multiple files/tables.
- **Process:** For each file, the program reads through all records and deletes those with a company number matching `l_firm`.

---

## File Declarations

```rpg
ffdellu    uf   e           k disk
ffenklu    uf   e           k disk
... (multiple files) ...
fsodtlu    uf   e           k disk
fsohelu    uf   e           k disk
```
- Each `f...lu` line declares a file as update-capable (`uf`) and keyed (`k`), used for disk operations. These are the physical files the program processes.

---

## Data Structure Declarations

```rpg
d                uds
d l_user                911    920
d l_firm                944    946  0
d l_navn                951    980

d w_firm          s              3  0
```
- `l_user`, `l_firm`, and `l_navn` are fields from the program's user data structure (perhaps passed in the program’s parameter list).
- `l_firm` (positions 944–946) is the 3-digit company number; this is the main filter for deletions.
- `w_firm` is a working variable for the company number, initialized in the subroutine.

---

## Main Deletion Logic

For each file, the pattern is as follows:

```rpg
c     read      fileName                                90
c     dow       *in90 = *off
c     if        <companyField> = l_firm
c     delete    <deleteFormat>
c     endif
c     read      fileName                                90
c     enddo
```

- **Step-by-step:**
    1. **Read**: Reads the first record of the file (e.g., `fdellu`).
    2. **Loop**: Continues as long as the read was successful (`*in90 = *off`).
    3. **Check**: If the record's company number field matches `l_firm`, delete the record.
    4. **Read**: Gets the next record.
    5. **Repeat**: Until end of file.

- Each section is commented with the Norwegian name of the type of records being deleted (e.g., "Ordre-slettet" = deleted order).

- The variable `<companyField>` is specific to each file and identifies the company number (e.g., `fyfirm`, `fefirm`, etc.).

- `<deleteFormat>` is the record format name used for the deletion.

---

## Example Section

**Order Rows:**
```rpg
c                   read      fodtlu                                 90
c                   dow       *in90 = *off
c                   if        fdfirm = l_firm
c                   delete    fodtpfr
c                   endif
c                   read      fodtlu                                 90
c                   enddo
```
- Reads file `fodtlu`, deletes each record where `fdfirm` equals `l_firm`.

---

## Program End and Cleanup

```rpg
c     avslutt       tag

c                   eval      *inlr = *on
c                   return
```
- Marks the logical end of the program and ensures the activation group is cleaned up (`*inlr = *on`).

---

## Initialization Subroutine

```rpg
c     *inzsr        begsr

c                   eval      w_firm  = 000

c                   endsr
```
- Initializes the working company number to zero at program start. (`*inzsr` runs automatically at program initialization.)

---

## Summary

- The program loops through a list of files, deleting records for a specified company number.
- Each file section uses a similar loop using `read`/`dow`/`if`/`delete`.
- The company number to delete is provided in `l_firm`, likely passed as a parameter when the program is called.
- The program is modular and easy to extend with more files if needed.

---

## Onboarding Tips

- **Adding new files:** Follow the existing pattern: declare your file, then add a processing block mirroring the others.
- **Changing company selection:** Adjust `l_firm`; this is the filter for all deletions.
- **Safety:** This program permanently deletes data for a company. Use with caution!
- **Language:** Field names and comments are in Norwegian, but the logic is standard RPG and easily mapped to your domain knowledge.

---

Feel free to ask for a walkthrough on a specific part or how to adapt for additional requirements.