# RC762R Program Documentation

## Overview

**Program Name:** RC762R  
**System:** ASOKON  
**Description:**  
This program generates a unique filename containing the current date and time. The filename follows a specific structure and is intended for use cases where unique file naming is necessary, such as generating EDI (Electronic Data Interchange) files.

## Purpose

The primary function of RC762R is to construct a filename string using the current system date and time, formatted according to business requirements. The filename format is:

```
D<YYMMDD>.T<HHMMSS>.EDI
```
- `D` – Constant prefix
- `<YYMMDD>` – Current date (Year, Month, Day)
- `.T` – Constant separator
- `<HHMMSS>` – Current time (Hour, Minute, Second)
- `.EDI` – Constant suffix indicating EDI file

**Example output:**  
`D240618.T134205.EDI` (for June 18, 2024, 13:42:05)

## Structure and Logic

### Data Structures

#### Filename Construction

```rpg
d                 ds
d d_fnav                        20
d  d_fnav01                      1    overlay(d_fnav)     inz('D')
d  d_fnav02                      6  0 overlay(d_fnav:2)
d  d_fnav03                      2    overlay(d_fnav:8)   inz('.T')
d  d_fnav04                      6  0 overlay(d_fnav:10)
d  d_fnav05                      4    overlay(d_fnav:16)  inz('.EDI')
```

- `d_fnav` (20A): The full filename, composed of five overlaid subfields:
    - `d_fnav01` (1A): Constant 'D' (prefix)
    - `d_fnav02` (6P0): Date in YYMMDD format (positions 2-7)
    - `d_fnav03` (2A): Constant '.T' (positions 8-9)
    - `d_fnav04` (6P0): Time in HHMMSS format (positions 10-15)
    - `d_fnav05` (4A): Constant '.EDI' (positions 16-19)

### Parameters

```rpg
d p_fnav          s             20
```
- `p_fnav`: Output parameter for the generated filename.

### Working Variables

```rpg
d w_dato          s               d   datfmt(*iso)
d w_time          s               t   timfmt(*iso)
d w_dato_6        s              6  0
d w_time_6        s              6  0
```
- `w_dato`: Holds the current date in ISO format.
- `w_time`: Holds the current time in ISO format.
- `w_dato_6`: Date as a 6-digit packed number (YYMMDD).
- `w_time_6`: Time as a 6-digit packed number (HHMMSS).

### Main Logic

1. **Initialization and Parameter Handling**
    - The program expects a single parameter (`p_fnav`), which will be populated with the generated filename.
    - The parameter is defined in the entry parameter list (`*entry plist`).

2. **Timestamp Retrieval**
    - The program retrieves the current system date and time using two `time` opcodes, storing results in `w_dato` and `w_time`.

3. **Date and Time Formatting**
    - The date (`w_dato`) is converted to a 6-digit packed numeric (`w_dato_6`) in YYMMDD format using `move *ymd`.
    - The time (`w_time`) is converted to a 6-digit packed numeric (`w_time_6`) in HHMMSS format using `move *hms`.

4. **Filename Assembly**
    - The components are assembled into the overlaid fields of `d_fnav`:
        - `d_fnav01` is already initialized to 'D'.
        - `d_fnav02` is set to `w_dato_6`.
        - `d_fnav03` is already initialized to '.T'.
        - `d_fnav04` is set to `w_time_6`.
        - `d_fnav05` is already initialized to '.EDI'.
    - The full filename is then assigned to the output parameter `p_fnav`.

5. **Program Termination**
    - The program sets LR (`*inlr`) to `*on` and returns, signaling completion.

### Subroutines

- **Initialization Subroutine (`*inzsr`):**
    - Handles the parameter list and initializes the parameter variable.

### Design Decisions and Conventions

- **Overlayed Data Structure:**  
  The use of overlays allows assembly of the filename in place, improving performance and clarity, and ensuring that each component is placed at the correct offset.
- **Packed Numeric Fields:**  
  Date and time are handled as packed numerics for compactness and ease of conversion to string representations.
- **Hardcoded Constants:**  
  The filename's structure is hardcoded with constant prefixes/suffixes to standardize file naming for downstream processes.
- **No External Dependencies:**  
  The program does not interact with any files, databases, or external APIs. It is purely computational, focused on generating a unique string.
- **Exit Handling:**  
  The program uses the standard RPG indicator LR (`*inlr`) to ensure proper cleanup and signaling of program end.

### Integration Points

- **Parameter Passing:**  
  The program is designed to be called by other programs, which will receive the generated filename via the `p_fnav` parameter.
- **No Direct File I/O:**  
  Any actual file creation or further processing must be handled by the calling program/module.

## Business/Domain-Specific Notes

- **EDI File Generation:**  
  The `.EDI` suffix and the naming convention suggest the program is part of an EDI processing workflow, where unique filenames are required for each outgoing or incoming file to avoid collisions and enable traceability.
- **Timestamp-based Uniqueness:**  
  By embedding the precise date and time, the program ensures that filenames are unique to the second, suitable for high-frequency file generation scenarios.

## Summary Table

| Field      | Content           | Source/Format        | Purpose                |
|------------|-------------------|----------------------|------------------------|
| d_fnav01   | 'D'               | Constant             | Prefix                 |
| d_fnav02   | YYMMDD            | Current date         | Date component         |
| d_fnav03   | '.T'              | Constant             | Date/time separator    |
| d_fnav04   | HHMMSS            | Current time         | Time component         |
| d_fnav05   | '.EDI'            | Constant             | Suffix (file type)     |

---

**In summary:**  
RC762R is a utility program that generates a standardized, timestamp-based filename for EDI files, ensuring uniqueness and consistency across the system. It is intended to be called by other programs which require such filenames for file generation or processing.