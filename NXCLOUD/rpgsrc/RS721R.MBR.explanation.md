# Program Overview

This RPG program (RS721R) is designed to **check whether a given activity code ("kode") is valid** for a specified firm. It uses a physical file (likely a master data table) to verify the existence of this code and returns a status and description accordingly.

---

## Source Structure and Main Components

### 1. **Header and Metadata**
- The `/TITLE` line and following comments describe the system, program name, and purpose ("Kontroll av gyldig aktivitet" = "Check of valid activity").
- Documentation about indicator usage, parameter usage, and return codes.

### 2. **File Declaration**
```rpg
fra21l1    if   e           k disk    rename(ra21pfr:ra21l1r)
```
- **fra21l1** is a file interface. 
- `k disk` = keyed disk access.
- `rename` = local record format is `ra21l1r`, physical file is `ra21pfr`.

### 3. **Data Definitions**
```rpg
d w_firm          s                   like(raufir)
d p_stat          s              1
d p_ukod          s                   like(raukod)
d p_utxt          s                   like(rautxt)
d ra21l1_ukod     s                   like(raukod)
d                uds
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980
```
- `w_firm` holds the firm number extracted for use as the file key.
- `p_stat` is a one-character status returned to the caller.
- `p_ukod` is the activity code to look up (from the caller).
- `p_utxt` is for the description text (to return to caller).
- `ra21l1_ukod` is a local variable for the code used in the key.
- `l_user`, `l_firm`, `l_fnav` are user data structure fields (from the program status area, likely job/user info).

### 4. **Main Logic**

#### **Initialization**
```rpg
c                   eval      ra21l1_ukod = p_ukod
c     ra21l1_key    chain     ra21l1r                            60
```
- Copy the parameter code into local variable used in key definition.
- Attempt a **CHAIN** (keyed read) against the file (`ra21l1r`) using the composite key defined later.

#### **Existence Check**
```rpg
c                   if        *in60 = *on
c                   eval      p_stat = 'N'
c                   eval      p_utxt = 'Koden er ugyldig  '
c                   else
c                   eval      p_stat = *blank
c                   eval      p_utxt = rautxt
c                   endif
```
- If indicator 60 is ON → CHAIN was not successful (record not found).
    - Set status to 'N' (not found) and return "Koden er ugyldig" ("Code is invalid").
- Else → code exists for firm.
    - Set status to blank and use the `rautxt` text from the record.

#### **Program End**
```rpg
c     slutt         tag
c                   eval      *inlr = *on
c                   return
```
- Set LR indicator (end of program) and return.

---

### 5. **Subroutine: *INZSR (Initialization)**
```rpg
c     *inzsr        begsr
c                   eval      w_firm = l_firm
```
- On program start, copy the firm value from the user space into the `w_firm` variable (used as part of the key).

#### **Parameter Passing**
```rpg
c     *entry        plist
c                   parm                    p_stat
c                   parm                    p_ukod
c                   parm                    p_utxt
```
- Defines how data is passed into and out of the program:
    - `p_stat` (status, output)
    - `p_ukod` (activity code, input)
    - `p_utxt` (description, output)

#### **Key List for File Access**
```rpg
c     ra21l1_key    klist
c                   kfld                    w_firm
c                   kfld                    ra21l1_ukod
```
- Defines the composite key for the file access:
    - First part: firm number
    - Second part: activity code

---

## **Summary of Flow**

1. The program receives three parameters: a status variable, an activity code, and a text description buffer.
2. It initializes the current firm (from user space) into a key variable.
3. It attempts to locate the code for this firm in the `fra21l1` file using a CHAIN operation.
4. If the code is found, it returns a blank status and the description from the file.
5. If not found, it returns 'N' in the status and a fixed "invalid code" message.

---

## **Typical Use Case**

This program is a utility that can be called from other RPG or CL programs to **validate that an activity code is allowed/exists** for a specific firm, and to fetch the code description, supporting code list integrity in a larger application.

---

## **Key Points for Onboarding**

- **CHAIN** is key to record lookup; indicator 60 is used to check for success.
- **INZSR** is used for program initialization and parameter definition.
- The combination of `w_firm` and `ra21l1_ukod` makes up the record key.
- All "output" is returned through the parameter list (`plist`).

---

This program is typical for file validation utility routines in classic ILE RPG development.