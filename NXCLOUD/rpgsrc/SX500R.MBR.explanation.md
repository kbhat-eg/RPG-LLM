# Explanation of the RPG Program: SX500R

This program, part of the ASSTAT system, is named **SX500R** and is for "Sletting av poster - parameter" ("Deletion of records - parameter"). The purpose is to provide a user interface for deleting records, validate input parameters, and handle the communication with related programs for authorization and deletion.

## File Definition

```rpg
fsx500d    cf   e             workstn
```
- **sx500d**: Workstation file, likely the display file where screens are defined.
- **cf**: Combined file (input and output), externally described.

---

## LDA (Local Data Area) Definitions

```rpg
d                uds
d l_firm                944    946  0
d l_navn                951    980
```
- References data from the LDA, primarily company number (`l_firm`) and company name (`l_navn`).

---

## Data Structure for Parameter List

```rpg
d                 ds
d d_list                        64
d  d_firm                        3  0 overlay(d_list:1)
d  d_raar                        4  0 overlay(d_list:4)
```
- `d_list`: 64-byte data structure for passing parameters to another program.
- `d_firm` overlays first 3 bytes (company number).
- `d_raar` overlays next 4 bytes (accounting year).

---

## Stand-Alone Variables and Constants

```rpg
d b_feil          s              1    inz(*off)
d w_stop          s              1    inz(*off)
d w_firm          s              3  0
d w_mld1          c                   'Vennligst vent .........     '
d w_mld2          c                   'Sletting p�g�r .........     '
d wactli          s              2  0
d wactpo          s              3  0
d wmld01          s             30
d wmld02          s             30
```
- **b_feil**: Flag for input errors.
- **w_stop**: Flag to halt processing.
- **w_firm**: Work variable for company number.
- **w_mld1/w_mld2**: Constants for screen messages ("Please wait..."; "Deletion in progress...").
- **wactli, wactpo**: Possibly message positioning on the screen.
- **wmld01, wmld02**: Work fields for display messages.

---

## Mainline Logic

### Entry Point: Display Opening Screen

```rpg
c     b1taga        tag
c                   exfmt     b1bld
```
- Displays the initial screen (`b1bld` format).

---

### Exit Handling (F3=Exit)

```rpg
c                   if        *inkc or *inkl
c                   goto      avslutt
c                   endif
```
- If the user presses F3 or another exit key, the program jumps to the exit routine.

---

### Authorization Check

```rpg
c                   call      'SX501C'
c                   parm                    w_stop
c                   if        w_stop = *on
c                   goto      avslutt
c                   endif
```
- Calls program `SX501C` to check if the user is authorized. Sets `w_stop` flag if not authorized and exits.

---

### Input Validation

```rpg
c                   exsr      sjekk_input
c                   if        b_feil = *on
c                   goto      b1taga
c                   endif
```
- Calls the `sjekk_input` subroutine to check input fields.
- If input is invalid, loops back to the initial screen.

---

### Move Screen Fields to Parameter List

```rpg
c                   exsr      flytt_par
```
- Fills out `d_list` data structure for the delete program.

---

### Show "Please Wait" Message

```rpg
c                   eval      wactli = 4
c                   eval      wactpo = 44
c                   eval      wmld01 = w_mld1
c                   eval      wmld02 = w_mld2
c                   call      'AA006C'
c                   parm                    wactli
c                   parm                    wactpo
c                   parm                    wmld01
c                   parm                    wmld02
```
- Sets up and displays a message ("Please wait", "Deletion in progress") using program `AA006C`. Positioning is likely controlled by `wactli` and `wactpo`.

---

### Call Deletion Program

```rpg
c                   call      'SX510R'
c                   parm                    d_list
```
- Calls `SX510R` to actually perform the deletion, passing the parameter list.

---

### Exit Routine

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Program termination: sets last record flag, returns control.

---

## Subroutines

### 1. sjekk_input (Check Input Fields)

```rpg
c     sjekk_input   begsr
c                   eval      b_feil = *off
c                   if        b1raar <> 0 and
c                             b1raar >  *year
c                   eval      *in31 = *on
c                   eval      b_feil = *on
c                   goto      end_sjekk
c                   endif
c     end_sjekk     tag
c                   endsr
```
- Checks if the accounting year (`b1raar`) is not zero and is in the future. If so, indicator 31 is set and error flag is raised.

---

### 2. flytt_par (Move Fields to Parameter List)

```rpg
c     flytt_par     begsr
c                   eval      d_firm = w_firm
c                   eval      d_raar = b1raar
c                   endsr
```
- Moves company number and year into the parameter data structure for use by the delete program.

---

### 3. *inzsr (Initialization Subroutine)

```rpg
c     *inzsr        begsr
c                   eval      w_firm = l_firm
c                   eval      b1firm = l_firm
c                   eval      b1navn = l_navn
c                   eval      wactli = 3
c                   eval      wactpo = 2
c                   endsr
```
- Initializes work fields and screen variables with values from the LDA.

---

## Summary (For Onboarding)

- The program presents a deletion screen to the user.
- Exits gracefully if the user cancels or if the user lacks authorization.
- Validates that the "accounting year" makes sense (not zero, not in the future).
- Prepares and passes required parameters to a separate deletion program.
- Uses a screen messaging program to inform the user during processing.
- Typical business RPG pattern: display, validation, call-outs to other programs, user feedback.

**Key routines to check or adapt when onboarding:**
- Input validation rules in `sjekk_input`
- Overlay fields in `d_list` for parameter passing
- The definitions and attributes of the display file (`sx500d`)
- The logic inside the called programs (`SX501C`, `SX510R`, `AA006C`) if changes are needed

**Note:** Some fields (e.g., `b1raar`, `b1firm`, `b1bld`) are likely defined externally in the display file (`sx500d`). Make sure you review the display file for complete context.