     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *                                                                       *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RA200R                                              *
      * Beskrivelse . . : Tilrettelegger trans fra Adra                       *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
6.30  * 6.30  sst 250117  Hente periode fra bilagsdato                        *
      *                   splittet konto i konto,avdeling,spes
6.31  *       sst 280317  Lagt Kidd-feltet i Tekst dersom pos 3 = R
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     fradrpf    ip  af  512        disk
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
     fraa3l1    if   e           k disk    rename(raa3pfr:raa3l1r)
     fraa4lu    uf   e           k disk    rename(raa4pfr:raa4lur)
     fre0tpf    o    e           k disk
      *
     d per             s              2  0 dim(13)
     d txt             s             20    dim(5) ctdata perrcd(1)
     d wbel            s              1    dim(14)
     d wfbe            s              1    dim(14)
      *
     d                 ds
     d rpcin1                       512
     d  wdsbty                        2    overlay(rpcin1)
     d  wdsHR                         1    overlay(rpcin1:3)
     d  wdsavs                        1    overlay(rpcin1:4)
     d  wdsbil                        8    overlay(rpcin1:6)
     d  wdsbda                        8    overlay(rpcin1:21)
     d   wdsbdd                       2    overlay(wdsbda:7)
     d   wdsbmm                       2    overlay(wdsbda:5)
     d   wdsbÅÅ                       2    overlay(wdsbda:3)
6.30 d  wdskto                       20    overlay(rpcin1:30)
     d  wdsval                       13    overlay(rpcin1:50)
     d  wdsvak                        3    overlay(rpcin1:63)
     d  wdsbel                       16    overlay(rpcin1:68)
     d  wdsDK                         1    overlay(rpcin1:85)
     d  wdsref                        8    overlay(rpcin1:87)
     d  wdskid                       25    overlay(rpcin1:105)
     d  wdstx1                       30    overlay(rpcin1:130)
     d  wdsnav                       30    overlay(rpcin1:160)
     d  wdstx2                       30    overlay(rpcin1:190)
     d  wdseks                      150    overlay(rpcin1:220)
     d  wdskry                       35    overlay(rpcin1:370)
     d  wdserf                       35    overlay(rpcin1:405)
     d  wdsarf                       35    overlay(rpcin1:440)
     d  wdsbkt                       35    overlay(rpcin1:475)
      *
     d                 ds
     d wwsbda                         6
     d  wwsbdd                        2    overlay(wwsbda)
     d  wwsbmm                        2    overlay(wwsbda:3)
     d  wwsbÅÅ                        2    overlay(wwsbda:5)
      *
      * LOCAL DATA
      *
     d                uds
     d pfirm                 300    302  0
     d pnavn                         30
     d puser                         10
     d pdato                          6  0
     d praar                          4  0
     d pperf                          2  0
     d ppert                          2  0
     d psyst                 471    472  0
      *
     d l_user                911    920
     d l_firm                944    946  0
     d l_navn                951    980
      *
     d pdatx           s              8  0
     d wfbelØ          s             14
     d wfelt           s                   like(rpcin1)
     d wftgn           s              1
     d wkp             s              2  0
     d wkper           s              8  0
     d wlinje          s              8  0
     d wblin           s              8  0
6.NU d wnota           s              8  0
     d wnxbun          s                   like(rtbunt)
     d wtpre           s             10  2
     d i               s              3  0
     d s_bil           s                   like(wdsbil)
      *
     d w_firm          s                   like(l_firm)
     d w_raar          s              4  0
     d wwsbdn          s              6  0
6.30 d w_kto           s              8
6.30 d w_avd           s              8
6.30 d w_sps           s              8
6.30 d w_mva           s              1
      *
     d raa4lu_4aar     s                   like(ra4aar)
      *
      *  Statusopplysninger - avvikende perioder?!?
      *
     iraa3l1r
     i              ra3p01                      per(01)
     i              ra3p02                      per(02)
     i              ra3p03                      per(03)
     i              ra3p04                      per(04)
     i              ra3p05                      per(05)
     i              ra3p06                      per(06)
     i              ra3p07                      per(07)
     i              ra3p08                      per(08)
     i              ra3p09                      per(09)
     i              ra3p10                      per(10)
     i              ra3p11                      per(11)
     i              ra3p12                      per(12)
     i              ra3p13                      per(13)
      *
     iradrpf    NS  01
     i                                  1  512  rpcin1
      *
6.30 c*                  if        *in15 = *off
6.30 c*                  eval      rtraar = praar
6.30 c*                  eval      rtrper = ppert
6.30 c*                  move      *on           *in15
6.30 c*                  endif
      *    Korr av feiltranser pga problemer i overføringen
     c                   if        %subst(rpcin1:1:3) = 'ï»¿'
     c                   eval      %subst(rpcin1:1:253) =
     c                             %subst(rpcin1:4:253)
     c                   endif
      *
     c                   if        %subst(wdskid:1:4) = 'TEST'
     c                   eval      wdskid = wdskid
     c                   endif
      *
6.30 c                   eval      praar = *zero
6.30 c                   move      wdsbÅÅ        praar
6.30 c                   eval      praar = praar + 2000
6.30 c                   move      wdsbmm        ppert
6.30 c                   eval      rtraar = praar
6.30 c                   eval      rtrper = ppert
      *
     c     start         tag
      *
     c                   if        wdsbil <> s_bil
     c                   eval      raa4lu_4aar = praar
     c     raa4lu_key    chain     raa4lu
 001  *
B001 c                   if        %found
 001 c                   z-add     ra4sig        wnota
E001 c                   else
 001 c                   z-add     0             wnota
E001 c                   endif
     c                   eval      wnota = wnota + 1
     c                   eval      wblin = *zero
     c                   eval      ra4sig = wnota
     c                   update    raa4lur
      *
     c                   move      wdsbil        s_bil
     c                   endif
      *
     c                   eval      wwsbdd = wdsbdd
     c                   eval      wwsbmm = wdsbmm
     c                   eval      wwsbÅÅ = wdsbÅÅ
     c                   move      wwsbda        wwsbdn
     c     *dmy          move      wwsbdn        rtbdat
      *
     c                   eval      rtbilk = 87
      *
     c                   eval      rttext = 'Adra Innbet     '
     c                   if        (%subst(wdskid:1:1) >= '0' and
     c                              %subst(wdskid:1:1) <= '9' and
     c                              %subst(wdskid:9:1) >= '0' and
     c                              %subst(wdskid:9:1) <= '9' and
     c                              %subst(wdskid:10:5)  = ' ')   or
     c                             wdskid  = *blank
     c                   else
     c                   eval      rttext = '>' +
     c                             %subst(wdskid:1:18)
     c                   endif
      *   Beløp
     c                   eval      i = %scan('-':wdsbel)
     c                   eval      wftgn = ' '
     c                   if        i > 0
     c                   eval      wftgn = '-'
     c                   eval      %subst(wdsbel:i:1) = '0'
     c                   endif
     c                   move      wdsbel        rtbelØ
     c                   if        rtbelØ = 0
     c                   goto      slutt
     c                   endif
      *  Debug
     c                   if        rtbelØ = 106
     c                   eval      rtbelØ = rtbelØ
     c                   endif
      *   Valuta beløp        debug
     c                   if        rtbelØ = 1796,34
     c                   eval      rtbelØ = rtbelØ
     c                   endif
     c                   eval      rtvalb = *zero
     c                   eval      rtvalk = *blank
     c                   if        wdsvak <> 'NOK'
     c                   eval      i = %scan('-':wdsval)
     c                   eval      wftgn = ' '
     c                   if        i > 0
     c                   eval      wftgn = '-'
     c                   eval      %subst(wdsval:i:1) = '0'
     c                   endif
     c                   eval      i = %scan('.':wdsval)
     c                   if        i > 0
     c                   eval      %subst(wdsval:2:i-1) =
     c                               %subst(wdsval:1:i-1)
     c                   eval      %subst(wdsval:1:1) = *blank
     c                   endif
     c                   move      wdsval        rtvalb
     c                   eval      rtvalk = wdsvak
     c                   endif
      *   Referanse
     c                   dow       %subst(wdsref:8:1) = *blank
     c                   eval      %subst(wdsref:2:7) = %subst(wdsref:1:7)
     c                   eval      %subst(wdsref:1:1) = '0'
     c                   enddo
6.30 c                   move      wdsref        rtrefn
     c                   if        wdsref  <> '00000000' and
     c                             wdsref  <> *blank
     c*  Kommer i ref    move      wdsref        rttext
     c                   endif
6.30  *
     c                   eval      rtdavd = *zeros
     c                   eval      rtdkto = *zeros
     c                   eval      rtdsps = *zeros
     c                   eval      rtdmva = *blank
      *
     c                   eval      rtcavd = *zeros
     c                   eval      rtckto = *zeros
     c                   eval      rtcsps = *zeros
     c                   eval      rtcmva = *blank
      *
6.30 c                   eval      w_kto  = *blank
6.30 c                   eval      w_avd  = *blank
6.30 c                   eval      w_sps  = *blank
6.30 c                   eval      w_mva  = *blank
      *  Test, Debug
     c                   if        wdsbil = '233'
     c                   eval      wdsbil = wdsbil
     c                   endif
      *  Test
     c     nyt           tag
6.30 c                   eval      i = %scan('.':wdskto)
     c                   if            i > 0
     c                             and i < 21
     c                   eval      %subst(wdskto:i:1) = ','
     c                   goto      nyt
     c                   endif
6.30 c                   eval      i = %scan(' ':wdskto)
6.30 c                   if        i > 0 and
     c                             i < 21
     c                   eval      %subst(wdskto:i:1) = ','
     c                   endif
6.30 c                   eval      i = %scan(',':wdskto)
6.30 c                   if        i > 0
6.30 c                   eval      w_kto  = %subst(wdskto:1:i-1)
6.30 c                   eval      wdskto = %subst(wdskto:i+1:20-i)
6.30 c                   eval      i = %scan(',':wdskto)
6.30 c                   if        i > 0
6.30 c                   eval      w_avd  = %subst(wdskto:1:i-1)
6.30 c                   eval      wdskto = %subst(wdskto:i+1:20-i)
6.30 c                   eval      i = %scan(',':wdskto)
6.30 c                   if        i > 0
6.30 c                   eval      w_sps  = %subst(wdskto:1:i-1)
6.30 c                   eval      wdskto = %subst(wdskto:i+1:20-i)
6.30 c                   eval      i = %scan(',':wdskto)
6.30 c                   if        i > 0
6.30 c                   eval      w_mva  = %subst(wdskto:1:i-1)
6.30 c                   endif
6.30 c                   endif
6.30 c                   endif
6.30 c                   else
6.30 c                   eval      w_kto  = wdskto
6.30 c                   endif
6.30  *
6.30 c                   dow       %subst(w_kto:8:1) = *blank
6.30 c                   eval      %subst(w_kto:2:7) = %subst(w_kto:1:7)
6.30 c                   eval      %subst(w_kto:1:1) = '0'
6.30 c                   enddo
      *  Test, debug
     c                   if        w_kto = '00001900'
     c                   eval      w_kto = w_kto
     c                   endif
6.30  *
6.30 c                   dow       %subst(w_avd:8:1) = *blank
6.30 c                   eval      %subst(w_avd:2:7) = %subst(w_avd:1:7)
6.30 c                   eval      %subst(w_avd:1:1) = '0'
6.30 c                   enddo
6.30  *
6.30 c                   dow       %subst(w_sps:8:1) = *blank
6.30 c                   eval      %subst(w_sps:2:7) = %subst(w_sps:1:7)
6.30 c                   eval      %subst(w_sps:1:1) = '0'
6.30 c                   enddo
      *
B001 c*                  if        wftgn <> '-'
B001 c                   if        wdsbty = 'K'
     c                   if        wftgn  = '-'
6.30 c                   move      w_kto         rtdkto
6.30 c                   move      w_avd         rtdavd
6.30 c                   move      w_sps         rtdsps
     c                   if        w_mva <> ' '
     c                   move      w_mva         rtdmva
     c                   endif
     c                   else
6.30 c                   move      w_kto         rtckto
6.30 c                   move      w_avd         rtcavd
6.30 c                   move      w_sps         rtcsps
     c                   if        w_mva <> ' '
     c                   move      w_mva         rtcmva
     c                   endif
     c                   endif
X001 c                   else
     c                   if        wftgn = '-'
6.30 c                   move      w_kto         rtckto
6.30 c                   move      w_avd         rtcavd
6.30 c                   move      w_sps         rtcsps
     c                   else
6.30 c                   move      w_kto         rtdkto
6.30 c                   move      w_avd         rtdavd
6.30 c                   move      w_sps         rtdsps
     c                   endif
E001 c                   endif
      *
     c                   eval      rtakti = *blank
      *
     c                   eval      rtfdat = rtbdat
      *
     c*                  if        (%subst(wdskid:1:1) < '0' or
     c*                             %subst(wdskid:1:1) > '9')  and
     c*                            %subst(wdskid:1:1) <> ' '
     c*                  movel     wdskid        rttext
     c*                  endif
      *
     c*                  if        wdskid <> *blank      and
     c*                            wdskid <> '000000000' and
     c*                            wdstx1 <> *blank
     c**                 eval      %subst(rttext:5:9) = %subst(wdskid:1:9)
     c*                  eval      %subst(rttext:12:9) = %subst(wdskid:1:9)
     c*                  eval      %subst(rttext:14:1) = '/'
     c*                  eval      %subst(rttext:15:6) = %subst(wdstx1:1:6)
     c*                  else
     c*                  if        wdskid <> *blank      and
     c*                            wdskid <> '000000000'
     c*                  eval      %subst(rttext:12:9) = %subst(wdskid:1:9)
     c*                  else
     c*                  if        wdstx1 <> *blank
     c*                  eval      %subst(rttext:15:6) = %subst(wdstx1:1:6)
     c*                  endif
     c*                  endif
     c*                  endif
6.32 c*                  movel     wdskid        rttext
      *
      * Legg ut postering
      *
     c                   add       1             wlinje
     c                   eval      rtreid = 'T'
     c                   eval      rtfirm = l_firm
     c                   eval      rtbunt = wnxbun
     c                   eval      rtlinj = wlinje
     c                   eval      rtbiln = wnota
     c                   eval      wblin  = wblin + 1
     c                   eval      rtbill = wblin
     c                   eval      rtstat = *blank
6.30 c*                  eval      rtdsps = *zero
     c*                  eval      rtdmva = ' '
6.30 c*                  eval      rtcsps = *zero
     c*                  eval      rtcmva = ' '
     c                   eval      rtkrab = *zero
     c                   eval      rtmngd = *zero
     c                   eval      rtmngk = *zero
     c*??                eval      rtresn = *zero
     c                   eval      rtvirk = *blank
     c*??                eval      rtatte = *zero
     c                   eval      rtautx = *blank
     c                   eval      rtkrys = *blank
     c                   eval      rtkidi = *blank
     c                   eval      rtbetb = *zero
     c                   eval      rtbref = *blank
      *
     c                   write     re0tpfr
      *
      *
     c     slutt         tag
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     *inzsr        begsr
      *
     c                   eval      wtpre = *zeros
     c                   eval      wkp = *zeros
     c                   move      *zeros        rpcin1
      *
     c                   move      txt(1)        rttext
     c                   z-add     1             wnxbun
     c     uyear         sub       1             w_raar
      *
     c     afirl1_key    chain     afirl1                             10
 001  *
     c     raa3l1_key    chain     raa3l1                             10
 001  *
 001  *
     c     afirl1_key    klist
     c                   kfld                    w_firm
 001  *
     c     raa3l1_key    klist
     c                   kfld                    w_firm
 001  *
     c     raa4lu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    raa4lu_4aar
      *
     c                   endsr
      * ----------------------------------------
**   Bilagstekster
Faktura
Kreditnota
Øreavrunding
Gebyr
Utg. MVA
