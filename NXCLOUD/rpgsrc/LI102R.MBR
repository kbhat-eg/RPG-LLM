     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASLAGR
      * Program . . . . : LI102R
      * Beskrivelse . . : Detaljer på ordrebekreftelse
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      * 5.60  180108 TSV  Endringer på vise partsinfo.
      * 5.61  220108 TSV  Overgang til kundeordre fra detaljbilde (B2)
6.10  * R6.10 250809 BSA  Utvidet ref. felter fra 20 til 30 posisjoner
6.11  * R6.10 281209 BSA  Legger ut meldingsnummer.
6.12  * R6.10 210110 BSA  Kobler mot bestilling og ordre
6.13  * R6.10 020210 BSA  Hvis akseptkode er blank, settes den til akseptert
6.14  * R6.10 100311 BSA  Miks av formater på linjer pga av GTIN nr
6.15  * R6.10 080612 BSA  Feil nettopris ved oppdatering av bestilling/orde
6.16  * R6.10 070812 BSA  Faste adresselinjer på partsinformasjon
6.17  * R6.10 261112 BSA  Fortsetter fiks med miks av formater
6.18  * R6.10 310113 BSA  Legger ut totaler i skjermbildet
6.19  * R6.10 040213 BSA  Innfører flere linjestatuser
6.1A  * R6.10 120213 BSA  Innfører flere linjestatuser, fortsetter
6.20  * R6.20 260312 BSA  Utvidet parameterliste til FO701R
6.21  * R6.20 110512 BSA  Mangler parameterliste til FO701R
6.22  * R6.20 280114 BSA  Må nullstille verdier hvis bestilt linje ikke
6.22  *                   finnes.
6.23  * R6.20 100214 BSA  Bruk pris som vise på linja.
6.24  * R6.20 110214 BSA  Rekalkuler status, hvis oppdatering av priser
6.24  *                   kvantum osv.
6.25  * R6.20 180214 BSA  Finner pris som skal oppdatere bestilling og
6.25  *                   pris. Vi oppdaterer ikke med rabatter.
6.26  * R6.20 190314 BSA  Totaler fra EDI melding blir for stor for
6.26  *                   feltet i skjermen. Utelater desimaler for
6.26  *                   å vise større beløp.
6.27  * R6.20 300614 BSA  Fortsetter test av miks av formater (6.14)
6.27  *                   Fortsatt muligheter for at det feiler.
6.30  * 6.30  260113 bof  Omskriving i forb. endring pakning VA
6.32  *       140314 bof  Lagt inn test på fra /til dato på pakning
6.33  *       080414 bof  Feilretting vedr. omr.faktor fra vare/pakn
6.nu  * R6.30 270514 bsa  Programmet gjennomgått mtp nummerutvidelser.
6.34  * R6.30 020914 bsa  Utvidet til å slette varer som ikke er bekreftet
6.35  * R6.20 310315 BSA  Håndtering av fritekst på ordre og linjer
6.36  * R6.20 220615 BSA  Bruker levert enhet i presentasjon av pris. Tar
6.36  *                   ikke hensyn til evnt angitt prisenhet.
6.37  *  R6.30 080316 BSA  Utvidet sjekk for å skille tekstlinjer fra andre.
6.38  *  R6.30 130616 BSA  Reduser lager, hvis det slettes bestillingslinjer
6.39  *  R6.30 230117 BSA  Kan ikke vise GTIN nummer lenger enn 13 tegn.
6.3a  *  R6.30 010317 BSA  Ikke sjekkk mot leverandør hvis GLN nummer er 0
6.3b  *  R6.30 070417 BSA  Feil oppslag hvis info styres av GLN nummer
6.3b  *                    subrutine vis_parter.
6.3c  *  R6.30 010818 BSA  Rekalkulerer ikke info hvis det ikke har vært
6.3c  *                    gjort endringer.
6.3d  *  R6.30 030818 BSA  Legger til leverandørens ordrenummer.
6.3f  *  R6.30 300818 bsa  Rekalkulerer også linjer etter sletting av info.
      *
7.xx  *  7.00  150119 BKV  Endringer pga ny GUI
7.01  * 7.00  701119 bkv  Vasker vekk probl Newlook tegn
7.02  *  R6.30 290419 BSA  Kan slette linjer fra bestillingen, hvis
7.02  *                    bekreftet antall er 0.
7.03  *  R6.30 240118 BSA  Legger ut kost fra bestilling.
7.04  * R6.30 090819 BSA  Kaller spesial for ikke ødelegge standard.
7.05  *K0000  140819 BSA  Utvidet skjermbilde og legger leveringsdato ut i bildet
7.06  *K0000  080920 BSA  Utvider GTIN nummer til 14 posisjoner.
7.07  *K0000  040621 BSA  Feil antall linjer i scroll.
7.08  *K0000  220621 BSA  Utvidet meldingsnummer fra 6 - 8 siffer
      *
8.01  *K0000  231221 bsa  Legger ut akseptansekode i skjermbilde
8.02  *       030822 bof  Sett w_omr2 til 1 før oppslag, i tilfelle man ikke finner omr.
8.03  *800   290923  ask  Utvidet felt for leverandørens ordrebekreftelsesnummer (bare komp)
8.04  *PRG2   210622 bof  Utvidet prisgruppe fra 1 til 2 posisjoner
8.05  *800    010324 bsa  Byttet program for oppdatering av avvik.
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = avslutt
      *       10 = Roll
      *       12 = Sfldsp
      *       13 = Sfldspctl
      *       14 = Sflclr
      *       15 = Sflend
      *       16 = Readc 16 on, no more records
      *       21 = Home-key
      *       22 = Plassering av cursor
      *       30 = Protect av felter ved vise
      *    31-79 = Varsle m/feilmeldinger/skjermindikatorer
      *    80-89 = Arbeidsindikatorer
      *    90-99 = Fileindikatorer chain etc.
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av linjenummersekvenser (2 første siffer i linjenr LIMLIN)
      *
      *    10 : Hodeinformasjon
      *    20 : Partsinformasjon
      *    30 : Referanser
      *    40 : Transportinformasjon
      *    50 : Linjer
      *    55 : Linjer fra best. (ikke match i EDI-melding)
      *    60 : Tillegg/fradrag hodenivå
      *    65 : Fritkstlinjer på hodenivå
      *    90 : Totaler
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fraa8l1    if   e           k disk    rename(raa8pfr:raa8l1r)
     fmjlol2    if   e           k disk    rename(mjlopfr:mjlol2r)
     fledil1    if   e           k disk    rename(ledipfr:ledil1r)
     fledilr    if   e           k disk    rename(ledipfr:ledilrr)
6.34 fledilu    uf   e           k disk    rename(ledipfr:ledilur)
     flohel1    if   e           k disk    rename(lohepfr:lohel1r)
     flodtl1    if   e           k disk    rename(lodtpfr:lodtl1r)
     flodtlr    if   e           k disk    rename(lodtpfr:lodtlrr)
6.34 flodtlu    uf   e           k disk    rename(lodtpfr:lodtlur)
6.12 ffodtlr    if   e           k disk    rename(fodtpfr:fodtlrr)
6.12 fvotylr    if   e           k disk    rename(votypfr:votylrr)
     frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
     frlevl5    if   e           k disk    rename(rlevpfr:rlevl5r)
     fvvenlr    if   e           k disk    rename(vvenpfr:vvenlrr)
6.30 fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fjvpkl2    if   e           k disk    rename(jvpkpfr:jvpkl2r)
6.30 fjvarl1    if   e           k disk    rename(jvarpfr:jvarl1r)
      *
     fli102d    cf   e             workstn sfile(b1sfl:w_srrn)
      *
      *
      * Parameter-inn
      *
     d d_prec          ds
     d  d_firm                        3  0
     d  d_type                        4
7.08 d  d_mnum                        8  0
     d  d_mlin                        6  0
     d  d_kode                        1
      *
      * ORDREBEKREFTELSE Hode
      *
     d d_obkh          ds
     d  d_oh_obnr                    35
     d  d_oh_olda                      d   datfmt(*iso)
     d  d_oh_llda                      d   datfmt(*iso)
     d  d_oh_sean                    13  0
     d  d_oh_bean                    13  0
     d  d_oh_fean                    13  0
     d  d_oh_kref                    30
     d  d_oh_aksp                     3
     d  d_oh_valk                     3
     d  d_oh_ttyp                     3
     d  d_oh_fmat                     3
     d  d_oh_lbet                     3
     d  d_oh_lste                    13  0
     d  d_oh_txt1                    70
     d  d_oh_txt2                    70
     d  d_oh_txt3                    70
      *
      * ORDREBEKREFTELSE Tilegg/fradragslinjer
      *
     d d_obkh2         ds
     d  d_oh_ftkv                     3
     d  d_oh_tsek                     3
     d  d_oh_ftty                     3
     d  d_oh_fttx                    30
     d  d_oh_tbel                    17  2
      *
      * Fritekst/hodelinje
      *
     d d_obkh3         ds
     d  d_oh_ftxq                     3
     d  d_oh_ftxt                    70
      *
      * Ordrebekr.referanser/hode
      *
     d d_obkh4         ds
     d  d_oh_bstn                    35
     d  d_oh_proj                    35
     d  d_oh_kunr                    35
     d  d_oh_konr                    35
6.3d d  d_oh_lonr                    35
      *
      * Ordrebekr. partsinfo./hode
      *
     d d_obkh5         ds           400
     d  d_oh_part                     3
     d  d_oh_pean                    13  0
     d  d_oh_pnav                    30
     d  d_oh_pad1                    30
     d  d_oh_pad2                    30
     d  d_oh_pste                    30
     d  d_oh_porg                    20
      *
      * Ordrebekr. transport/lev. - hode
      *
     d d_obkh6         ds
     d  d_oh_trmo                     3
     d  d_oh_trna                    35
     d  d_oh_lebe                     3
6.35  *
6.35  * Fritekst/varelinjer
6.35  *
6.35 d d_obkl15        ds
6.35 d  d_ol_ftxq                     3
6.35 d  d_ol_ftxt                    70
6.35 d  d_ol_lref                     6  0
      *
      * ORDREBEKREFTELSE Linje
      *
     d d_obkl          ds
     d  d_ol_llin                     6  0
     d  d_ol_laks                     3
6.14 d* d_ol_vean                    13  0
6.14 d  d_ol_vean                    14  0
     d  d_ol_vnob                     8  0
     d  d_ol_vlev                    15
     d  d_ol_bkva                    15  3
     d  d_ol_benh                     3
     d  d_ol_lkva                    15  3
     d  d_ol_lenh                     3
     d  d_ol_llda                      d   datfmt(*iso)
     d  d_ol_pris                    15  3
     d  d_ol_penh                     3
     d  d_ol_prpr                     9  0
     d  d_ol_prkv                     3
     d  d_ol_epri                    15  3
     d  d_ol_evar                     8  0
     d  d_ol_linr                     6  0
     d  d_ol_linb                    15  3
     d  d_ol_mvap                     4  2
     d  d_ol_tkv1                     3
     d  d_ol_tty1                     3
     d  d_ol_ttx1                    35
     d  d_ol_tse1                     3
     d  d_ol_tme1                    11  3
     d  d_ol_ten1                     3
     d  d_ol_tpr1                     5  2
     d  d_ol_tbe1                    15  2
     d  d_ol_tkv2                     3
     d  d_ol_tty2                     3
     d  d_ol_ttx2                    35
     d  d_ol_tse2                     3
     d  d_ol_tme2                    11  3
     d  d_ol_ten2                     3
     d  d_ol_tpr2                     5  2
     d  d_ol_tbe2                    15  2
     d  d_ol_txt1                    35
     d  d_ol_txt2                    35
6.14  *
6.14  * Ordrebekreftelse Linje (gammel)
6.14  *
6.14 d x_obkl          ds
6.14 d  x_ol_llin                     6  0
6.14 d  x_ol_laks                     3
6.14 d  x_ol_vean                    13  0
6.14 d  x_ol_vnob                     8  0
6.14 d  x_ol_vlev                    15
6.14 d  x_ol_bkva                    15  3
6.14 d  x_ol_benh                     3
6.14 d  x_ol_lkva                    15  3
6.14 d  x_ol_lenh                     3
6.14 d  x_ol_llda                      d   datfmt(*iso)
6.14 d  x_ol_pris                    15  3
6.14 d  x_ol_penh                     3
6.14 d  x_ol_prpr                     9  0
6.14 d  x_ol_prkv                     3
6.14 d  x_ol_epri                    15  3
6.14 d  x_ol_evar                     8  0
6.14 d  x_ol_linr                     6  0
6.14 d  x_ol_linb                    15  3
6.14 d  x_ol_mvap                     4  2
6.14 d  x_ol_tkv1                     3
6.14 d  x_ol_tty1                     3
6.14 d  x_ol_ttx1                    35
6.14 d  x_ol_tse1                     3
6.14 d  x_ol_tme1                    11  3
6.14 d  x_ol_ten1                     3
6.14 d  x_ol_tpr1                     5  2
6.14 d  x_ol_tbe1                    15  2
6.14 d  x_ol_tkv2                     3
6.14 d  x_ol_tty2                     3
6.14 d  x_ol_ttx2                    35
6.14 d  x_ol_tse2                     3
6.14 d  x_ol_tme2                    11  3
6.14 d  x_ol_ten2                     3
6.14 d  x_ol_tpr2                     5  2
6.14 d  x_ol_tbe2                    15  2
6.14 d  x_ol_txt1                    35
6.14 d  x_ol_txt2                    35
      *
      * ORDREBEKREFTELSE Ordretotaler
      *
     d d_obks          ds
     d  d_os_suml                    17  2
     d  d_os_ntot                    17  2
     d  d_os_mvag                    17  2
     d  d_os_mvat                    17  2
     d  d_os_btot                    17  2
     d  d_os_tilt                    17  2
     d  d_os_frat                    17  2
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
7.00 d l_filg                931    933
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av variabler i nøkler
      *
     d ledilr_type     s                   like(litype)
     d ledilr_mnum     s                   like(limnum)
     d ledilr_mlin     s                   like(limlin)
     d ledil1_type     s                   like(litype)
     d ledil1_mnum     s                   like(limnum)
7.08 d ledil1_mlin     s                   like(limlin)
     d lohel1_numm     s                   like(lonumm)
     d lohel1_suff     s                   like(losuff)
     d lodtl1_numm     s                   like(ldnumm)
     d lodtl1_suff     s                   like(ldsuff)
     d lodtl1_line     s                   like(ldline)
     d lodtlr_numm     s                   like(ldnumm)
6.12 d fodtlr_numm     s                   like(fdnumm)
     d lodtlr_suff     s                   like(ldsuff)
6.12 d fodtlr_suff     s                   like(fdsuff)
     d lodtlr_line     s                   like(ldline)
6.12 d fodtlr_line     s                   like(fdline)
6.12 d votylr_otyp     s                   like(lootyp)
     d rlevl1_levr     s                   like(rllevr)
     d rlevl5_eanl     s                   like(rleanl)
     d vvenlr_vare     s                   like(vevare)
     d vvenlr_enhe     s                   like(veenhe)
     d mjlol2_eann     s                   like(mjeann)
6.30 d vvarl1_vare     s                   like(vvvare)
     d jvpkl2_vare     s                   like(jwvare)
6.30 d jvpkl2_ldor     s                   like(jwldor)
     d jvpkl2_enhe     s                   like(jwenhe)
6.30 d jvarl1_vare     s                   like(jvvare)
      *
6.12 d w_anta          s                   like(ldanta)
6.12 d w_inkp          s                   like(ldipny)
6.20 d w_kopr          s                   like(ldipny)
6.12 d w_line          s                   like(ldline)
6.12 d w_numm          s                   like(fdnumm)
6.12 d w_suff          s                   like(fdsuff)
6.15 d w_npri          s             15  3
6.24 d w_type          s                   like(litype)
6.24 d w_mnum          s                   like(limnum)
6.24 d w_retn          s              2  0
6.32 d w_udat          s               d   datfmt(*iso)
6.34 d w_enor          s              1
6.35 d w_otel          s              2  0
6.38 d w_vlst          s              1
6.38 d w_numa          s              8
6.38 d w_lina          s              4
7.01 d w_len           s              3  0
7.01 d w_teller        s              3  0
      *
6.35 d s_mlin          s                   like(limlin)
      *
      * Definering av parametre
      *
7.08 d p_parm          s             22
      *
      * Definering av variable
      *
     d w_spge          s              4  0
     d w_srrn          s              4  0
     d w_sfrn          s                   like(w_srrn)
     d w_ssrn          s                   like(w_srrn)
      *
     d w_seqe          s              1
     d b_forn          s              1    inz(*off)
     d b_anul          s              1    inz(*off)
     d b_feil          s              1    inz(*off)
     d b_omrf          s              1    inz(*off)
6.12 d b_best          s              1    inz(*off)
6.12 d b_ordr          s              1    inz(*off)
6.24 d b_reka          s              1    inz(*off)
6.32 d b_pakn          s              1    inz(*off)
7.02 d b_dele          s              1    inz(*off)
      *
     d w_firm          s                   like(lifirm)
     d w_stat          s             12
     d w_aksp          s              6
     d w_tell          s              1  0
     d w_blin          s                   like(ldline)
     d w_elin          s                   like(ldline)
     d w_omr1          s                   like(veomre)
     d w_omr2          s                   like(veomre)
     d w_lnav          s                   like(rlnavn)
     d w_lpro          s              1
6.14  *
6.14  * Ordrebekreftelse Linje
6.14  *
6.14 d w_obkl          ds           400
6.27 d  w_test2                       1    overlay(w_obkl:10)
6.14 d  w_test                        1    overlay(w_obkl:46)
6.38  *
6.38  * Datastruktur for lageroppdatering
6.38  *
6.38 d                 ds
6.38 d hlrec                        128
6.38 d  hlvare                       15    overlay(hlrec)
6.38 d  hllage                        2  0 overlay(hlrec:16)
6.38 d  hldato                         d   overlay(hlrec:18) datfmt(*iso)
6.38 d  hltime                         t   overlay(hlrec:28) timfmt(*iso)
6.38 d  hlotyp                        2    overlay(hlrec:36)
6.38 d  hlltyp                        2    overlay(hlrec:38)
6.38 d  hlanta                       11  3 overlay(hlrec:40)
6.38 d  hlkopr                        9  2 overlay(hlrec:51)
6.38 d  hlrefr                       20    overlay(hlrec:60)
6.38 d  hlsyst                        1    overlay(hlrec:80)
6.38 d  hlaltk                        2    overlay(hlrec:81)
6.38 d  hlrest                        1    overlay(hlrec:83)
6.38 d  hltype                        1    overlay(hlrec:84)
6.38 d  hlenhe                        3    overlay(hlrec:85)
6.38 d  hlinlr                        1    overlay(hlrec:88)
6.38 d  hllety                        1    overlay(hlrec:89)
6.38 d  hlonum                        8  0 overlay(hlrec:90)
6.38 d  hlolin                        4  0 overlay(hlrec:98)
      *
7.00   dcl-s co402_verdi1  char(1);
7.00   dcl-s co402_verdi2  char(2048);
7.00   DCL-PR CO402R EXTPGM('CO402R');
7.00     p_filgrp            char(3)     const;
7.00     p_firm              packed(3:0) const;
7.00     p_lager             packed(2:0) const;
7.00     p_nokkel            char(50)    const;
7.00     p_verdi1            char(1);
7.00     p_verdi2            char(2048);
7.00   END-PR;
7.01 d u_702           s              1    inz(*off)
7.04 d u_704           s              1    inz(*off)
8.05 d w_fo701r        s              6    inz('FO712R')
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.60  * For visning NAD - partsinfo
 .    * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
 .    * w_n_ini: Hvilke parter(3035) skal vises og i hvilken rekkefølge.
 .    *
 .    * w_n_ine: Ditto ean-adr.info: 0=Nei
 .    *          (hvis navn blankt)  1=Leverandører (rlevl5 / lean)
 .    *          (i meldinga prøv )  2=Hovednummer  (raa8l1 / hean)
 .    *          (å hente navn her)  3=Logistikk    (mjlol2 / loge)
 .    *                              4=Både leverandør og hovednummer
 .    *
 .    * w_n_ina: Ditto vise adresse: 0=Bare navn
 .    *          (vise fra melding ) 1=Ja
 .    *          (navn + adr1,adr2,) 2=Ja hvis Ean mangler
 .    *
 .   d w_n_ini         s             18    inz('BYOBDPUDIVSUSFCA  ')
 .   d w_n_ine         s             18    inz('2 0 4 4 1 1 1 1   ')
 .   d w_n_ina         s             18    inz('1 0 2 2 0 0 0 0   ')
 .    *
 .    * Arbeidsvariable partsinfo
 .   d w_ine           s              1    inz('0')
 .   d w_ina           s              1    inz('0')
 .   d w_hdg           s                   like(B7HDG01)
 .   d w_num           s                   like(B7NUM01)
 .   d w_txt           s                   like(B7TXT01)
 .   d w_ptr           s              3  0 inz(0)
 .   d w_pt2           s              3  0
 .   d dummy           s              2  0
 .   d w_adri          s              1  0 inz(0)
 .   d w_init          s              1    inz(*off)
 .   d w_n_wrk         s              2
5.60 d wll             s              6  0 dim(9)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Definering av konstanter
      *
7.07 d c_sfil          s              2  0 inz(13)
      *
      *
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      * w_srrn - Relativt recordnummer i subfile
      * w_spge - Sidestørrelse i subfile (page)
      * w_sfrn - Første recordnummer på siden
      * w_ssrn - Siste  recordnummer på siden
      * w_virn - Vis den side som inneholder denne record.
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      * B1SFL  - B1 Subfile - record
      * B2CTL  - B2 Subfile - control record
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      * B5WIN  - B5 Vindu for vising av detaljer
      * B7WIN  - B7 Vindu for vising av partsinformasjon
      * B8WIN  - B8 Vindu for vising av tillegg/fradrag
      * B9WIN  - B9 Vindu for vising av ordretotaler
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B2CTL Behandle åpningsbildet med subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Send Alt
      *
     c     b2taga        tag
     c                   write     b2cmd
      *
      * Bare data
      *
     c     b2tagb        tag
     c                   exsr      dsp_subfile
      *
      * Behandling av funksjonstaster
      *
     c                   select
     c                   when      *inkc or *inkl
     c                   goto      end_pgm
     c                   when      *inkg
     c                   exsr      vis_parter
     c                   goto      b2tagb
     c                   when      *inkh
     c                   exsr      vis_tillegg
     c                   goto      b2tagb
     c                   when      *inki
     c                   exsr      vis_total
     c                   goto      b2tagb
     c                   when      *inkj
     c                   exsr      vis_best
     c                   goto      b2tagb
     c                   when      *inkk
     c                   exsr      vis_refn
     c                   goto      b2tagb
5.61 c                   when      *inkn
 .   c                   exsr      oppd_ordre
5.61 c                   goto      b2tagb
6.35 c                   when      *inkp
6.35 c                   exsr      vis_otext
6.35 c                   goto      b2tagb
      *
     c                   when      *in10
     c                   exsr      crt_subfile
     c                   goto      b2tagb
     c                   endsl
      *
      * Behandling av subfile
      *
     c                   exsr      subfile
     c                   goto      b2taga
      *
      * Avslutt program
      *
     c     end_pgm       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.61  * Subrutine for oppkall av ordreoppdatering
 .    * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
 .    *
 .   c     oppd_ordre    begsr
 .    *
 .   c                   eval      w_lpro = *blank
 .    *
 .   c                   call      'FO500R'
 .   c                   parm                    loornr
 .   c                   parm                    w_lpro
 .    *
5.61 c     end_ordre     endsr
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     subfile       begsr
      *
     c                   eval      b_forn = *off
      *
      * Beholder eksisterende posisjonering i subfilen
      *
     c                   if        w_curn > 0
     c                   eval      w_virn = w_curn
     c                   endif
      *
      * Leser og behandler subfile
      *
     c                   do        w_ssrn
     c                   readc     b1sfl
      *
     c                   if        %eof
     c                   leave
     c                   endif
      *
     c                   eval      w_virn = w_srrn
6.24 c                   eval      b_reka = *off
6.34  *
6.34  * Slett linje fra bestilling
6.34  *
6.34 c                   if        b1valg = 4
6.34 c                   exsr      xb4win
6.34 c                   eval      b1valg = 0
6.34 c                   update    b1sfl
6.34 c                   iter
6.34 c                   endif
      *
      * Se på detaljer
      *
     c                   if        b1valg = 5
     c                   exsr      xb5win
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
6.19  * Hvis "feil" status, kan ikke oppdatering skje
6.19 c                   if        b1valg = 6 or
6.19 c                             b1valg = 7 or
6.19 c                             b1valg = 8
6.19 c                   if        b1stat = 'Ikke bekreft'
6.19 c**                 eval      *in31 = *on
6.19 c                   eval      b1valg = 0
6.19 c                   update    b1sfl
6.19 c                   leave
6.19 c                   endif
6.19 c                   endif
      *
6.12  * Opddater antall på bestilling og ordre
6.12  *
6.12 c                   if        b1valg = 6
6.35  * Hvis tekstlinje, ignorer
6.35 c                   if        b1lkva = 0 and
6.35 c                             b1lenh = *blanks
6.35 c                   else
6.12  * Slå opp og finn linje som er valgt
6.12 c                   exsr      meld_linje
6.12 c                   eval      lodtlr_line = liline
6.12 c                   eval      b_best = *off
6.12 c                   eval      b_ordr = *off
6.12 c                   exsr      best_linje
6.12  * Vi sjekker at bestillinga ikke har kommet for langt i arbeidsflyten
6.12 c                   if        b_best = *on
6.12 c                   exsr      sjekk_otype
6.12 c                   if        b_best = *off
6.12 c                   eval      b1valg = 0
6.12 c                   update    b1sfl
6.12 c                   iter
6.12 c                   endif
6.12 c                   endif
6.12  *
6.12  * Vi oppdaterer linja hvis det er avviken kvantum og bestilling ble funnet
6.12  *
6.12 c                   if        b_best = *on and
6.12 c                             ldanta <> d_ol_lkva
6.12 c                   eval      w_numm = ldnumm
6.12 c                   eval      w_suff = ldsuff
6.12 c                   eval      w_line = ldline
6.12 c                   eval      w_anta = d_ol_lkva
6.12 c                   eval      w_inkp = 0
6.12 c                   eval      w_stat = *blank
6.12 c                   call      'LO701R'
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.12 c                   parm                    w_line
6.12 c                   parm                    w_anta
6.12 c                   parm                    w_inkp
6.12 c                   parm                    w_stat
6.12  *
6.12  * Kaller program for oppdatering av summer på bestilling
6.12  *
6.12 c                   call      'LO700R'
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.24  * Rekalkuler status på linja
6.24 c                   eval      b_reka = *on
6.24  *
6.12 c                   endif
6.12  *
6.12  * Hvis tilhørende ordrenummer oppdateres denne også
6.12  *
6.12 c                   if        b_ordr = *on and
6.12 c                             fdanta <> d_ol_lkva
6.12 c                   eval      w_numm = ldornu
6.12 c                   eval      w_suff = ldorsu
6.12 c                   eval      w_line = ldorli
6.12 c                   eval      w_anta = d_ol_lkva
6.12 c                   eval      w_inkp = 0
6.20 c                   eval      w_kopr = 0
6.12 c                   eval      w_stat = *blank
7.04 c                   call      w_fo701r
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.12 c                   parm                    w_line
6.12 c                   parm                    w_anta
6.12 c                   parm                    w_inkp
6.20 c                   parm                    w_kopr
6.12 c                   parm                    w_stat
6.12  *
6.12  * Kaller program for oppdatering av summer på ordreheading
6.12  *
6.12 c                   call      'FO700R'
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.12  *
6.12 c                   endif
6.12  *
6.12 c                   eval      b1valg = 0
6.12 c                   update    b1sfl
6.12 c                   iter
6.35 c                   endif
6.12 c                   endif
6.12  *
6.12  * Opddater pris på bestilling og ordre(kalkulerer kostverdi)
6.12  *
6.12 c                   if        b1valg = 7
6.35  * Hvis tekstlinje, ignorer
6.35 c                   if        b1lkva = 0 and
6.35 c                             b1lenh = *blanks
6.35 c                   else
6.12  * Slå opp og finn linje som er valgt
6.12 c                   exsr      meld_linje
6.12 c                   eval      lodtlr_line = liline
6.12 c                   exsr      best_linje
6.12  * Vi sjekker at bestillinga ikke har kommet for langt i arbeidsflyten
6.12 c                   if        b_best = *on
6.12 c                   exsr      sjekk_otype
6.12 c                   if        b_best = *off
6.12 c                   eval      b1valg = 0
6.12 c                   update    b1sfl
6.12 c                   iter
6.12 c                   endif
6.12 c                   endif
6.15  * Kalkuler pris det skal sammenlignes med
6.15 c                   exsr      kal_ntopr
6.12  * Vi oppdaterer hvis avvikende pris
6.12 c                   if        b_best = *on and
6.15 c**                           ldipny <> d_ol_pris
6.15 c                             ldipny <> w_npri
6.12 c                   eval      w_numm = ldnumm
6.12 c                   eval      w_suff = ldsuff
6.12 c                   eval      w_line = ldline
6.12 c                   eval      w_anta = 0
6.15 c**                 eval      w_inkp = d_ol_pris
6.15 c                   eval      w_inkp = w_npri
6.12 c                   eval      w_stat = *blank
6.12 c                   call      'LO701R'
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.12 c                   parm                    w_line
6.12 c                   parm                    w_anta
6.12 c                   parm                    w_inkp
6.12 c                   parm                    w_stat
6.12  *
6.12  * Kaller program for oppdatering av summer på bestilling
6.12  *
6.12 c                   call      'LO700R'
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.24  * Rekalkuler status på linja
6.24 c                   eval      b_reka = *on
6.24  *
6.12 c                   endif
6.12  *
6.12  * Hvis tilhørende ordrenummer oppdateres denne også
6.12  *
6.12 c                   if        b_ordr = *on and
6.15 c**                           fdinpr <> d_ol_pris
6.15 c                             fdinpr <> w_npri
6.12 c                   eval      w_numm = ldornu
6.12 c                   eval      w_suff = ldorsu
6.12 c                   eval      w_line = ldorli
6.12 c                   eval      w_anta = 0
6.21 c                   eval      w_kopr = 0
6.15 c**                 eval      w_inkp = d_ol_pris
6.15 c                   eval      w_inkp = w_npri
6.12 c                   eval      w_stat = *blank
7.04 c                   call      w_fo701r
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.12 c                   parm                    w_line
6.12 c                   parm                    w_anta
6.12 c                   parm                    w_inkp
6.21 c                   parm                    w_kopr
6.12 c                   parm                    w_stat
6.12  *
6.12  * Kaller program for oppdatering av summer på ordreheading
6.12  *
6.12 c                   call      'FO700R'
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.12  *
6.12 c                   endif
6.12  *
6.12 c                   eval      b1valg = 0
6.12 c                   update    b1sfl
6.12 c                   iter
6.35 c                   endif
6.12 c                   endif
6.12  *
6.12  * Opddater både pris og antall på bestilling og ordre
6.12  *
6.12 c                   if        b1valg = 8
6.35  * Hvis tekstlinje, ignorer
6.35 c                   if        b1lkva = 0 and
6.35 c                             b1lenh = *blanks
6.35 c                   else
6.12  * Slå opp og finn linje som er valgt
6.12 c                   exsr      meld_linje
6.12 c                   eval      lodtlr_line = liline
6.12 c                   exsr      best_linje
6.12  * Vi sjekker at bestillinga ikke har kommet for langt i arbeidsflyten
6.12 c                   if        b_best = *on
6.12 c                   exsr      sjekk_otype
6.12 c                   if        b_best = *off
6.12 c                   eval      b1valg = 0
6.12 c                   update    b1sfl
6.12 c                   iter
6.12 c                   endif
6.12 c                   endif
6.12  * Vi oppdaterer både pris og antall
6.12 c                   if        b_best = *on
6.15  * Kalkuler pris det skal sammenlignes med
6.15 c                   exsr      kal_ntopr
6.12  *
6.12 c                   eval      w_numm = ldnumm
6.12 c                   eval      w_suff = ldsuff
6.12 c                   eval      w_line = ldline
6.12 c                   eval      w_anta = d_ol_lkva
6.15 c**                 eval      w_inkp = d_ol_pris
6.15 c                   eval      w_inkp = w_npri
6.12 c                   eval      w_stat = *blank
6.12 c                   call      'LO701R'
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.12 c                   parm                    w_line
6.12 c                   parm                    w_anta
6.12 c                   parm                    w_inkp
6.12 c                   parm                    w_stat
6.12  *
6.12  * Kaller program for oppdatering av summer på bestilling
6.12  *
6.12 c                   call      'LO700R'
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.24  * Rekalkuler status på linja
6.24 c                   eval      b_reka = *on
6.24  *
6.12 c                   endif
6.12  *
6.12  * Hvis tilhørende ordrenummer oppdateres denne også
6.12  *
6.12 c                   if        b_ordr = *on
6.12  *
6.12 c                   eval      w_numm = ldornu
6.12 c                   eval      w_suff = ldorsu
6.12 c                   eval      w_line = ldorli
6.12 c                   eval      w_anta = d_ol_lkva
6.15 c**                 eval      w_inkp = d_ol_pris
6.15 c                   eval      w_inkp = w_npri
6.21 c                   eval      w_kopr = 0
6.12 c                   eval      w_stat = *blank
7.04 c                   call      w_fo701r
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.12 c                   parm                    w_line
6.12 c                   parm                    w_anta
6.12 c                   parm                    w_inkp
6.21 c                   parm                    w_kopr
6.12 c                   parm                    w_stat
6.12  *
6.12  * Kaller program for oppdatering av summer på ordreheading
6.12  *
6.12 c                   call      'FO700R'
6.12 c                   parm                    w_firm
6.12 c                   parm                    w_numm
6.12 c                   parm                    w_suff
6.12  *
6.12 c                   endif
6.12  *
6.12 c                   eval      b1valg = 0
6.12 c                   update    b1sfl
6.12 c                   iter
6.35 c                   endif
6.12 c                   endif
      *
     c                   enddo
6.24  * Hvis det oppdatert pris eller kvantum, må linjene resjekkes
6.24 c                   if        b_reka = *on
6.24 c                   exsr      ny_kontroll
6.3c c**                 endif
      *
6.12 c                   eval      ledil1_mlin = 500000
6.12 c     ledil1_key    setll     ledil1
6.12 c                   exsr      clr_subfile
6.12 c                   exsr      crt_subfile
6.3c c                   endif
      *
     c     end_subfile   endsr
      *
6.24  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.24  * Subrutine for kall av ny kontroll mot bestilling
6.24  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.24  *
6.24 c     ny_kontroll   begsr
6.24  *
6.24 c                   eval      w_type = 'OBKR'
6.24 c                   eval      w_mnum = d_mnum
6.24 c                   eval      w_retn = *zero
6.24  *
6.24 c                   call      'LI716R'
6.24 c                   parm                    w_firm
6.24 c                   parm                    w_type
6.24 c                   parm                    w_mnum
6.24 c                   parm                    w_retn
6.24  *
6.24 c                   eval      b_reka = *off
6.24  *
6.24 c                   endsr
6.24  *
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  * Subrutine for å slette linjer fra bestilling
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  *
6.34 c     xb4win        begsr
7.02 c                   if        u_702 = *on
7.02  * Hvis bekreftet med 0, skal det være mulig å slette varen fra bestilling.
7.02 c                   eval      b_dele = *off
7.02 c                   if        b1stat = 'Avvik antall' and
7.02 c                             b1lkva = 0
7.02 c                   eval      b_dele = *on
7.02 c                   goto      kan_slettes
7.02 c                   endif
7.02 c                   endif
6.34  * Kun bestillingslinjer som ikke er bekreftet på EDI melding kan slettes
6.34 c                   if        b1line < 550000 or
6.34 c                             b1line > 554999
6.34 c                   exfmt     c4msg
6.34 c                   goto      end_c4win
6.34 c                   endif
      *
7.02 c     kan_slettes   tag
      *
6.34 c                   eval      b4nobb = d_ol_vnob
6.34 c                   eval      b4tek1 = d_ol_txt1
6.34 c                   eval      b4stat = b1stat
6.34 c                   eval      b4bkva = ldanta
      *
6.34 c                   exfmt     b4win
6.34  *
6.34  * Behandling av funksjonstaster
6.34  *
6.34 c                   if        *inkc or *inkl
6.34 c                   goto      end_c4win
6.34 c                   endif
6.34  *
6.34  * Da sletter vi linje fra EDI medlingen
6.34  *
6.34 c                   exsr      del_meld
6.3f  *
6.3f c                   eval      b_reka = *on
6.34  *
6.34 c     end_c4win     endsr
6.34  *
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  * Subrutine for sletting av meldingslinje
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  *
6.34 c     del_meld      begsr
6.34  *
6.34  * Slett referanse fra EDI melding
6.34  *
6.34 c                   eval      ledilr_mlin = b1line
6.34 c     ledilr_key    chain     ledilu
6.34 c                   if        %found
6.34 c                   delete    ledilur
6.34 c                   endif
6.34  *
6.34  * Slett linje fra bestilling
6.34  *
6.34 c                   eval      lodtlr_line = liline
6.34 c     lodtlr_key    chain     lodtlu
6.34 c                   if        %found
6.34 c                   delete    lodtlur
6.34  * Rekalkuler bestillingstotaler
6.34 c                   eval      w_enor = *blanks
6.34 c                   eval      w_numm = lodtlr_numm
6.34 c                   eval      w_suff = lodtlr_suff
6.34 c                   call      'LO730R'
6.34 c                   parm                    w_enor
6.34 c                   parm                    w_firm
6.34 c                   parm                    w_numm
6.34 c                   parm                    w_suff
6.38  * Oppdater lager
6.38 c                   if        ldlage <> 0
6.38 c                   eval      ldanta = ldanta * -1
6.38 c                   exsr      oppdat_lager
6.38 c                   endif
6.38  *
6.34 c                   endif
6.34  *
6.34 c                   endsr
6.34  *
6.38  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.38  * Oppdatering av Lager
6.38  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.38  *
6.38 c     oppdat_lager  begsr
6.38  *
6.38  * Legger over verdier i overførings-felter
6.38  *
6.38 c                   move      ldvare        hlvare
6.38 c                   move      ldlage        hllage
6.38 c                   move      ldenh1        hlenhe
6.38 c                   move      *loval        hldato
6.38 c                   move      *loval        hltime
6.38 c                   move      ldotyp        hlotyp
6.38 c                   move      ldltyp        hlltyp
6.38  *
6.38 c                   eval      hlanta = ldanta
6.38 c                   eval      hlkopr = ldkpny
6.38  *
6.38 c                   eval      hlrefr = *blank
6.38 c                   move      'L'           hlsyst
6.38 c                   eval      hlaltk = *blank
6.38 c                   eval      hlrest = *blank
6.38 c                   move      ldnumm        w_numa
6.38 c                   move      ldline        w_lina
6.38 c                   eval      hlrefr = 'B:' + w_numa +
6.38 c                                      'L:' + w_lina
6.38 c                   eval      hlonum = ldnumm
6.38 c                   eval      hlolin = ldline
6.38 c                   move      ldlety        hllety
6.38  *
6.38  * Kaller opp lageroppdaterings-program
6.38  * dersom dette ikke er en vare hentet inn fra LVR
6.38  *
6.38 c                   if        ldlvre = 0
6.38  *
6.38 c                   eval      w_vlst = *blank
6.38  *
6.38 c                   call      'VL001R'
6.38 c                   parm                    w_vlst
6.38 c                   parm                    hlrec
6.38 c                   endif
6.38  *
6.38 c                   endsr
6.38  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å vise detaljer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xb5win        begsr
6.35  * Hvis tekstlinje, vis kun denne
6.35 c                   if        b1lkva = 0 and
6.37 c                             b1lenh = *blanks and
6.37 c                             b1bkva = 0
6.35 c                   eval      ledilr_mlin = b1line
6.35 c     ledilr_key    chain     ledilr
6.35 c                   if        %found
6.35 c                   eval      b15tx1 = *blanks
6.35 c                   eval      b15tx2 = *blanks
6.35 c                   eval      b15tx3 = *blanks
6.35 c                   eval      b15tx4 = *blanks
6.35 c                   eval      b15tx5 = *blanks
6.35 c                   eval      d_obkl15 = limeld
6.35 c                   eval      b15tx1 = d_ol_ftxt
6.35 c                   exfmt     b15win
6.35 c                   endif
6.35 c                   else
      *
     c                   exsr      meld_linje
     c                   eval      lodtlr_line = liline
     c                   exsr      best_linje
     c                   exsr      sjekk_aksept
      *
     c                   eval      b5linn = ldline
     c                   eval      b5llin = d_ol_llin
6.39 c                   if        d_ol_vean > 9999999999999
6.39 c                   eval      b5eann = 0
6.39 c                   else
     c                   eval      b5eann = d_ol_vean
6.39 c                   endif
     c                   eval      b5nobb = d_ol_vnob
     c                   movel     ldvare        b5evnr
     c                   eval      b5lvnr = d_ol_vlev
     c                   eval      b5tek1 = d_ol_txt1
     c                   eval      b5tek2 = d_ol_txt2
     c                   eval      b5bkva = ldanta
     c                   eval      b5benh = ldenh1
     c                   eval      b5bpen = ldenh1
     c                   eval      b5oenh = ldenh1
     c                   eval      b5bken = ldenh1
     c                   eval      b5lkva = d_ol_lkva
     c                   eval      b5lenh = d_ol_lenh
     c                   eval      b5bpri = ldipny
     c                   eval      b5bkos = ldkpny
6.12 c                   eval      b5fkva = fdanta
6.12 c                   eval      b5fkos = fdkopr
6.12 c                   eval      b5fenh = fdenh1
6.12 c                   move      ldnumm        b5bnum
6.12 c                   move      fdnumm        b5onum
      *
      * Prisenhet?
      *
6.36 c**                 if        d_ol_penh <> *blank
6.36 c**                 eval      b5nenh = d_ol_penh
6.36 c**                 eval      b5penh = d_ol_penh
6.36 c**                 else
     c                   eval      b5nenh = d_ol_lenh
     c                   eval      b5penh = d_ol_lenh
6.36 c**                 endif
      *
      * Rabatt?
      *
     c                   eval      b5rabb = 0
     c*                  if        d_ol_tty1 = 'DI '
     c                   if        d_ol_prkv = 'AAB'
     c                   if        d_ol_tpr1 <> 0
     c                   eval      b5rabb = (d_ol_pris * d_ol_tpr1) / 100
     c                   else
     c                   eval      b5rabb = d_ol_tbe1
     c                   endif
     c                   endif
     c*                  endif
      *
      * Nobb pris?
      *
     c                   if        d_ol_prkv = 'AAB'
     c                   eval      b5npri = d_ol_pris
     c*                  eval      b5lpri = d_ol_pris - b5rabb
     c                   else
     c                   eval      b5npri = 0
     c                   eval      b5nenh = *blank
     c*                  eval      b5lpri = d_ol_pris
     c                   endif
      *
     c                   if        d_ol_lkva <> *zero
     c                   eval(h)   b5lpri = d_ol_linb / d_ol_lkva
     c                   else
     c                   eval(h)   b5lpri = d_ol_linb / 1
     c                   endif
      *
     c                   if        d_ol_llda <> *loval
     c     *dmy          move      d_ol_llda     b5ldat
     c                   else
     c                   eval      b5ldat = 0
     c                   endif
     c                   eval      b5aksp = w_aksp
      *
     c                   if        d_ol_prpr <> 0
     c                   endif
      *
      * Avvikende enhet (bestilling/bekreftelse) ?
      *
     c                   if        d_ol_lenh <> *blank and
     c                             ldenh1 <> d_ol_lenh
     c                   exsr      omregn_pris
     c                   else
     c                   eval      b5opri = 0
     c                   eval      b5oenh = *blank
     c                   eval      b5oant = 0
     c                   eval      b5oaen = *blank
     c                   endif
      *
     c                   if        ldldat <> *loval
     c     *dmy          move      ldldat        b5odat
     c                   eval      *in42 = *on
     c                   else
     c                   eval      b5odat = b2odat
     c                   eval      *in42 = *off
     c                   endif
      *
     c                   eval      b5stat = b1stat
      *
     c                   exfmt     b5win
6.35 c                   endif
      *
     c     end_c5win     endsr
      *
6.12  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.12  * Subrutine for tømming av subfile
6.12  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.12  *
6.12 c     clr_subfile   begsr
6.12  *
6.12 c                   eval      *in14 = *on
6.12 c                   write     b2ctl
6.12 c                   eval      *in14 = *off
6.12  *
6.12 c                   eval      *in15 = *off
6.12 c                   eval      w_srrn = 0
6.12 c                   eval      w_sfrn = 0
6.12 c                   eval      w_ssrn = 0
6.12 c                   eval      w_spge = 0
6.12  *
6.12 c                   endsr
6.12  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å fylle opp subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     crt_subfile   begsr
      *
     c                   eval      w_spge = w_spge + c_sfil
     c                   eval      w_srrn = w_ssrn
      *
     c                   if        *in15 = *on
     c                   leavesr
     c                   endif
      *
     c                   dou       w_srrn = w_spge
      *
     c                   read      ledil1
      *
     c                   if        %eof
     c                   eval      *in15 = *on
     c                   leave
     c                   endif
      *
     c                   if        limlin > 599999
     c                   eval      *in15 = *on
     c                   leave
     c                   endif
      *
     c                   eval      w_srrn = w_srrn + 1
      *
6.14 c**                 eval      d_obkl = limeld
6.14 c                   eval      w_obkl = limeld
6.14 c                   exsr      obkl_konv
     c                   exsr      status_linje
8.01 c                   eval      w_aksp = *blanks
8.01 c                   exsr      sjekk_aksept
8.01 c                   eval      b1aksp = w_aksp
     c                   eval      lodtlr_line = liline
     c                   exsr      best_linje
      *
     c                   eval      b1valg = 0
     c                   eval      b1line = limlin
     c                   eval      b1tek1 = %trim(d_ol_txt1) + ' ' +
     c                                      %trim(d_ol_txt2)
     c                   eval      b1bkva = ldanta
     c                   eval      b1benh = ldenh1
     c                   eval      b1lkva = d_ol_lkva
     c                   eval      b1lenh = d_ol_lenh
7.05 c                   if        d_ol_llda <> *loval
7.05 c     *dmy          move      d_ol_llda     b1edat
7.05 c                   else
7.05 c                   eval      b1edat = 0
7.05 c                   endif
7.05 c                   if        ldldat <> *loval
7.05 c     *dmy          move      ldldat        b1bdat
7.05 c                   else
7.05 c                   eval      b1bdat = b2odat
7.05 c                   endif
     c                   eval      b1stat = w_stat
6.12 c                   eval      b1okva = fdanta
      *
7.01 c                   exsr      newlo_vask
      *
     c                   write     b1sfl
6.35  * Finnes det frie tekstlinjer tilknyttet meldingslinje ?
6.35 c                   eval      s_mlin = limlin
6.35 c                   eval      ledilr_mlin = 700000
6.35 c     ledilr_key    setll     ledilr
6.35 c                   read      ledilr
6.35 c                   dow       limlin < 800000 and
6.35 c                             not %eof
6.35 c                   eval      d_obkl15 = limeld
6.35 c                   if        d_ol_lref = s_mlin
6.35 c                   eval      w_srrn = w_srrn + 1
6.35  *
6.35 c                   eval      b1valg = 0
6.35 c                   eval      b1line = limlin
6.35 c                   eval      b1tek1 = %trim(d_ol_ftxt)
6.35 c                   eval      b1bkva = 0
6.35 c                   eval      b1benh = *blanks
6.35 c                   eval      b1lkva = 0
6.35 c                   eval      b1lenh = *blanks
6.35 c                   eval      b1stat = *blanks
6.35 c                   eval      b1okva = 0
      *
7.01 c                   exsr      newlo_vask
      *
6.35 c                   write     b1sfl
6.35  *
6.35 c                   if        w_srrn = w_spge
6.35 c                   leave
6.35 c                   endif
6.35 c                   endif
6.35  *
6.35 c                   read      ledilr
6.35 c                   enddo
      *
     c     les_forbi     tag
      *
     c                   enddo
      *
     c     end_crt       tag
      *
     c                   if        w_srrn > w_ssrn
     c                   eval      w_sfrn = w_ssrn + 1
     c                   endif
      *
     c                   eval      w_ssrn = w_srrn
     c                   eval      w_virn = w_sfrn
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for display av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     dsp_subfile   begsr
      *
     c                   if        w_srrn <> 0
     c                   eval      *in12 = *on
     c                   else
     c                   write     b2cmd
     c                   endif
      *
     c                   eval      *in13 = *on
     c                   exfmt     b2ctl
      *
     c                   eval      *in12 = *off
     c                   eval      *in13 = *off
6.19 c**                 eval      *in31 = *off
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutiner for kontroll av meldingsstatus
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     status_hode   begsr
      *
     c                   select
     c                   when      listat = ' '
     c                   eval      b2stat = 'Ok!            '
     c                   when      listat = '1'
     c                   eval      b2stat = 'Feil i best.nr.'
     c                   when      listat = '2'
     c                   eval      b2stat = 'Sjekk lever.   '
     c                   when      listat = '3'
     c                   eval      b2stat = 'Avvik fra best.'
     c                   when      listat = '4'
     c                   eval      b2stat = 'Feil ordretype.'
     c                   when      listat = '5'
     c                   eval      b2stat = 'Avvik totalsum.'
     c                   when      listat = '8'
     c                   eval      b2stat = 'Manuelt ok     '
     c                   when      listat = '9'
     c                   eval      b2stat = 'Oppdatert      '
     c                   endsl
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     status_linje  begsr
      *
     c                   select
     c                   when      listat = ' '
     c                   eval      w_stat = 'Ok!         '
     c                   when      listat = '1'
     c                   eval      w_stat = 'Endret lev. '
     c                   when      listat = '2'
     c                   eval      w_stat = 'Avvist lev  '
     c                   when      listat = '3'
     c                   eval      w_stat = 'Ikke kobling'
     c                   when      listat = '4'
     c                   eval      w_stat = 'Ikke i best.'
     c                   when      listat = '5'
     c                   eval      w_stat = 'Avvik antall'
     c                   when      listat = '6'
     c                   eval      w_stat = 'Avvik enhet '
     c                   when      listat = '7'
     c                   eval      w_stat = 'Avvik pris  '
6.19 c                   when      listat = '8'
6.19 c                   eval      w_stat = 'Ikke bekreft'
6.19 c                   when      listat = '9'
6.19 c                   eval      w_stat = 'Avvik GTIN  '
6.1A c                   when      listat = 'D'
6.1A c                   eval      w_stat = 'Avvik levdat'
     c                   endsl
      *
     c                   endsr
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for kontroll av akseptkode
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_aksept  begsr
      *
     c                   select
     c                   when      d_ol_laks = '1  '
     c                   eval      w_aksp = 'Ny    '
     c                   when      d_ol_laks = '3  '
     c                   eval      w_aksp = 'Endret'
     c                   when      d_ol_laks = '5  '
     c                   eval      w_aksp = 'OK    '
     c                   when      d_ol_laks = '7  '
     c                   eval      w_aksp = 'Avvist'
6.13 c                   when      d_ol_laks = '   '
6.13 c                   eval      w_aksp = 'OK    '
6.1A c                   when      d_ol_laks = 'U  '
6.1A c                   eval      w_aksp = 'Ukjent'
     c                   other
     c                   eval      w_aksp = d_ol_laks
     c                   endsl
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for lesing av leverandør
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     les_ldor      begsr
      *
     c                   eval      rlevl1_levr = lildor
     c     rlevl1_key    chain     rlevl1
     c                   if        %found
     c                   eval      b2lnav = rlnavn
     c                   else
     c                   eval      b2lnav = 'Ugyldig leverandør'
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for lesing av bestillingshode
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     best_hode     begsr
      *
     c     lohel1_key    chain     lohel1
     c                   if        not %found
     c                   eval      loldat = *loval
     c                   eval      lodref = *blank
6.18 c                   eval      lototi = 0
7.03 c                   eval      lototk = 0
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.60  * Subrutine for å vise partsinformasjon
 .    * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
 .    *
 .   c     vis_parter    begsr
 .    *
 .    * initiering
 .   c                   eval      w_hdg = *blanks
 .   c                   eval      w_num = *zero
 .   c                   eval      w_txt = *blanks
 .   c                   eval      w_ptr = 0
 .   c                   eval      w_init = *on
 .   c     1             do        11            dummy
 .   c                   exsr      sr_ins_b7lin
 .   c                   enddo
 .   c                   eval      w_init = *off
 .   c                   eval      w_hdg = *blanks
 .   c     1             DO        9             w_pt2
 .   c                   eval      wll(w_pt2) = 0
 .   c                   enddo
 .    *
 .    * Bygger sortert tabell for "kfld  limlin"
 .   c                   eval      ledilr_mlin = 200000
 .   c     ledilr_key    setll     ledilr
 .   c                   read      ledilr
 .   c                   dow       limlin < 300000 and
 .   c                             not %eof
 .   c                   eval      d_obkh5 = limeld
 .   c     1             DO        9             w_pt2
 .   c                   eval      w_n_wrk=%SUBST(w_n_ini:(w_pt2*2)-1:2)
 .   c                   if        w_n_wrk = d_oh_part
 .   c                   eval      wll(w_pt2) = limlin
 .   c                   endif
 .   c                   enddo
 .   c                   read      ledilr
 .   c                   enddo
 .    *
 .    * Henter partsinfo i valgt rekkefølge og legger ut til bilde
 .   c                   eval      w_ptr = 0
 .   c     1             DO        9             w_pt2
 .   c                   if        wll(w_pt2) = 0
 .   c                   iter
 .   c                   endif
 .   c                   eval      ledilr_mlin = wll(w_pt2)
 .   c     ledilr_key    chain     ledilr
 .   c                   if        %found
 .   c                   eval      d_obkh5 = limeld
 .    *
 .    * Evt Ean-oppslag hvis gitt og navn er blankt
 .    *
 .   c                   eval      w_num = d_oh_pean
 .   c                   eval      w_txt = d_oh_pnav
 .   c                   if        w_txt = *blank
 .   c                   eval      w_ine  =%SUBST(w_n_ine:(w_pt2*2)-1:1)
 .   c                   select
6.3b c**   w_ine         wheneq    '1'
6.3b c     d_oh_part     wheneq    'SU'
 .   c                   exsr      sr_les_lean
 .   c                   if        w_txt = '*blank'
 .   c                   eval      w_txt = 'Ikke i lokasjon-leverandører'
 .   c                   endif
6.3b c**   w_ine         wheneq    '2'
6.3b c     d_oh_part     wheneq    'BY'
 .   c                   exsr      sr_les_hean
 .   c                   if        w_txt = '*blank'
 .   c                   eval      w_txt = 'Ikke i lokasjon-hovednummer'
 .   c                   endif
6.3b c**   w_ine         wheneq    '3'
6.3b c     d_oh_part     wheneq    'DP'
6.3b c                   if        d_oh_pean <> 0
 .   c                   exsr      sr_les_loge
 .   c                   if        w_txt = '*blank'
 .   c                   eval      w_txt = 'Ikke i lokasjon-logistikk'
 .   c                   endif
6.3b c                   endif
6.3b c**   w_ine         wheneq    '4'
6.3b c     d_oh_part     wheneq    'IV'
6.3b c                   exsr      sr_les_hean
 .   c                   if        w_txt = '*blank'
6.3b c**                 exsr      sr_les_hean
6.3b c                   eval      w_txt = 'Ikke i lokasjon-hovednummer'
 .   c                   endif
6.3b c     d_oh_part     wheneq    'UD'
6.3b c                   if        d_oh_pean <> 0
6.3b c                   exsr      sr_les_loge
6.3b c                   if        w_txt = '*blank'
6.3b c                   eval      w_txt = 'Ikke i lokasjon-logistikk'
6.3b c                   endif
6.3b c                   endif
6.3b c     d_oh_part     wheneq    'SF'
6.3b c                   if        d_oh_pean <> 0
6.3b c                   exsr      sr_les_loge
6.3b c                   if        w_txt = '*blank'
6.3b c                   eval      w_txt = 'Ikke i lokasjon-logistikk'
6.3b c                   endif
6.3b c                   endif
6.3b c     d_oh_part     wheneq    'CA'
6.3b c                   exsr      sr_les_lean
6.3b c                   if        w_txt = '*blank'
6.3b c                   eval      w_txt = 'Ikke i lokasjon-leverandør'
6.3b c                   endif
 .   c                   endsl
 .   c                   if        w_txt = '*blank'
 .   c                   eval      w_txt = 'Ikke i lokasjons-tabeller"'
 .   c                   endif
 .   c                   endif
6.16  * Sekvens flyttet
 .   c                   select
 .    * BY - kjøper
 .   c                   when      d_oh_part = 'BY '
6.16 c**                 eval      w_hdg = 'Kjøper  . . . . .'
6.16 c                   eval      b7hdg01 = 'Kjøper  . . . . .'
6.16 c                   eval      b7num01 = w_num
6.16 c                   eval      b7txt01 = w_txt
 .    * OB - Bestiller
 .   c                   when      d_oh_part = 'OB '
6.16 c**                 eval      w_hdg = 'Bestiller . . . .'
 .    * DP - Mottager
 .   c                   when      d_oh_part = 'DP '
6.16 c**                 eval      w_hdg = 'Varemottager  . .'
6.16 c                   eval      b7hdg04 = 'Leveringsadr. . .'
6.16 c                   eval      b7num04 = w_num
6.16 c                   eval      b7txt04 = w_txt
6.16 c                   eval      b7txt05 = d_oh_pad1
6.16 c                   if        d_oh_pad2 <> *blanks
6.16 c                   eval      b7txt06 = d_oh_pad2
6.16 c                   eval      b7txt07 = %trim(d_oh_pste) + ' ' +
6.16 c                                       %trim(d_oh_porg)
6.16 c                   else
6.16 c                   eval      b7txt06 = %trim(d_oh_pste) + ' ' +
6.16 c                                       %trim(d_oh_porg)
6.16 c                   endif
6.16 c**                 eval      w_txt = d_oh_porg
 .    * IV - Fakturamottager
 .   c                   when      d_oh_part = 'IV '
6.16 c**                 eval      w_hdg = 'Fakturamottager .'
6.16 c                   eval      b7hdg03 = 'Fakturamottager .'
6.16 c                   eval      b7num03 = w_num
6.16 c                   eval      b7txt03 = w_txt
 .    * UD - Sluttmottager
 .   c                   when      d_oh_part = 'UD '
6.16 c**                 eval      w_hdg = 'Sluttmottager . .'
 .    * SU - leverandør
 .   c                   when      d_oh_part = 'SU '
6.16 c**                 eval      w_hdg = 'Leverandør/selger'
6.16 c                   eval      b7hdg02 = 'Leverandør/selger'
6.16 c                   eval      b7num02 = w_num
6.16 c                   eval      b7txt02 = w_txt
 .    * SF - hentested
 .   c                   when      d_oh_part = 'SF '
6.16 c**                 eval      w_hdg = 'Hentested . . . .'
 .    * CA - Transportør
 .   c                   when      d_oh_part = 'CA '
6.16 c**                 eval      w_hdg = 'Transportør . . .'
 .   c                   endsl
 .    * Legg ut heading, ean og navn til partsinfo - bildet.
6.16 c**                 exsr      sr_ins_b7lin
 .    *
 .    * Legg evt ut utvidet adresse info til partsinfo - bildet.
6.16 c                   if        1 = 2
 .   c                   eval      w_ina  =%SUBST(w_n_ina:(w_pt2*2)-1:1)
 .   c                   if        w_ina = '1' or
 .   c                             (w_ina = '2' and w_num = 0)
 .   c                   eval      w_txt = d_oh_pad1
 .   c                   exsr      sr_ins_b7lin
 .   c                   eval      w_txt = d_oh_pad2
 .   c                   exsr      sr_ins_b7lin
 .   c                   eval      w_txt = d_oh_pste
 .   c                   exsr      sr_ins_b7lin
 .   c                   eval      w_txt = d_oh_porg
 .   c                   exsr      sr_ins_b7lin
 .   c                   endif
6.16 c                   endif
 .    *
 .   c                   endif
 .   c                   enddo
 .    * vis bildet
 .   c                   exfmt     b7win
5.60 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.60  * Subrutine les EAN - Leverandør
 .    * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
 .   c     sr_les_lean   begsr
6.3a c                   eval      w_txt = '*blank'
6.3a c                   if        d_oh_pean <> 0
 .   c                   eval      rlevl5_eanl = d_oh_pean
 .   c     rlevl5_key    chain     rlevl5
 .   c                   if        %found
 .   c                   eval      w_txt = rlnavn
 .   c                   endif
6.3a c                   endif
5.60 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.60  * Subrutine les EAN - Hovednummer
 .    * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
 .   c     sr_les_hean   begsr
 .   c     raa8l1_key    chain     raa8l1
 .   c                   if        not %found or ra8ean <> d_oh_pean
 .   c                   eval      w_txt = '*blank'
 .   c                   else
 .   c                   eval      w_txt = l_fnav
 .   c                   endif
5.60 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.60  * Subrutine les EAN - Logistikk
 .    * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
 .   c     sr_les_loge   begsr
 .   c                   eval      mjlol2_eann = d_oh_pean
 .   c                   eval      w_txt = '*blank'
 .   c     mjlol2_key    chain     mjlol2
 .   c                   if        %found
 .   c                   eval      w_txt = mjsted
 .   c                   endif
5.60 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.60  * Subrutine for å legge inn linje på bilde partsinformasjon
 .    * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
 .   c     sr_ins_b7lin  begsr
 .   c                   if        w_hdg = *blanks and
 .   c                             w_num = *zero   and
 .   c                             w_txt = *blanks and
 .   c                             w_init = *off
 .   c                   goto      sr_ins_b7end
 .   c                   endif
 .    *
 .   c                   eval      w_ptr = w_ptr + 1
 .   c                   if        w_ptr > 11
 .   c                   goto      sr_ins_b7end
 .   c                   endif
 .    *
 .   c                   select
 .   c     w_ptr         wheneq    1
 .   c                   eval      B7HDG01 = w_hdg
 .   c                   eval      B7NUM01 = w_num
 .   c                   eval      B7TXT01 = w_txt
 .   c     w_ptr         wheneq    2
 .   c                   eval      B7HDG02 = w_hdg
 .   c                   eval      B7NUM02 = w_num
 .   c                   eval      B7TXT02 = w_txt
 .   c     w_ptr         wheneq    3
 .   c                   eval      B7HDG03 = w_hdg
 .   c                   eval      B7NUM03 = w_num
 .   c                   eval      B7TXT03 = w_txt
 .   c     w_ptr         wheneq    4
 .   c                   eval      B7HDG04 = w_hdg
 .   c                   eval      B7NUM04 = w_num
 .   c                   eval      B7TXT04 = w_txt
 .   c     w_ptr         wheneq    5
 .   c                   eval      B7HDG05 = w_hdg
 .   c                   eval      B7NUM05 = w_num
 .   c                   eval      B7TXT05 = w_txt
 .   c     w_ptr         wheneq    6
 .   c                   eval      B7HDG06 = w_hdg
 .   c                   eval      B7NUM06 = w_num
 .   c                   eval      B7TXT06 = w_txt
 .   c     w_ptr         wheneq    7
 .   c                   eval      B7HDG07 = w_hdg
 .   c                   eval      B7NUM07 = w_num
 .   c                   eval      B7TXT07 = w_txt
 .   c     w_ptr         wheneq    8
 .   c                   eval      B7HDG08 = w_hdg
 .   c                   eval      B7NUM08 = w_num
 .   c                   eval      B7TXT08 = w_txt
 .   c     w_ptr         wheneq    9
 .   c                   eval      B7HDG09 = w_hdg
 .   c                   eval      B7NUM09 = w_num
 .   c                   eval      B7TXT09 = w_txt
 .   c     w_ptr         wheneq    10
 .   c                   eval      B7HDG10 = w_hdg
 .   c                   eval      B7NUM10 = w_num
 .   c                   eval      B7TXT10 = w_txt
 .   c     w_ptr         wheneq    11
 .   c                   eval      B7HDG11 = w_hdg
 .   c                   eval      B7NUM11 = w_num
 .   c                   eval      B7TXT11 = w_txt
 .   c                   endsl
 .    *
 .   c                   clear                   w_hdg
 .   c                   clear                   w_num
 .   c                   clear                   w_txt
 .    *
5.60 c     sr_ins_b7end  endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å vise tillegg på hodenivå
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     vis_tillegg   begsr
      *
     c                   eval      b8tek0 = *blank
     c                   eval      b8tek1 = *blank
     c                   eval      b8tek2 = *blank
     c                   eval      b8tek3 = *blank
     c                   eval      b8tek4 = *blank
     c                   eval      b8tek5 = *blank
     c                   eval      b8tek6 = *blank
     c                   eval      b8tek7 = *blank
     c                   eval      b8bel0 = 0
     c                   eval      b8bel1 = 0
     c                   eval      b8bel2 = 0
     c                   eval      b8bel3 = 0
     c                   eval      b8bel4 = 0
     c                   eval      b8bel5 = 0
     c                   eval      b8bel6 = 0
     c                   eval      b8bel7 = 0
      *
     c                   eval      ledilr_mlin = 600000
     c     ledilr_key    setll     ledilr
     c                   eval      w_tell = 0
     c                   read      ledilr
      *
     c                   dow       limlin < 650000 and
     c                             not %eof
      *
     c                   eval      d_obkh2 = limeld
     c                   eval      w_tell = w_tell + 1
     c                   if        d_oh_ftkv = 'A  '
     c                   eval      d_oh_tbel = d_oh_tbel * -1
     c                   endif
      *
     c                   select
      *
     c                   when      w_tell = 1
     c                   eval      b8tek0 = d_oh_fttx
     c                   eval      b8bel0 = d_oh_tbel
      *
     c                   when      w_tell = 2
     c                   eval      b8tek1 = d_oh_fttx
     c                   eval      b8bel1 = d_oh_tbel
      *
     c                   when      w_tell = 3
     c                   eval      b8tek2 = d_oh_fttx
     c                   eval      b8bel2 = d_oh_tbel
      *
     c                   when      w_tell = 4
     c                   eval      b8tek3 = d_oh_fttx
     c                   eval      b8bel3 = d_oh_tbel
      *
     c                   when      w_tell = 5
     c                   eval      b8tek4 = d_oh_fttx
     c                   eval      b8bel4 = d_oh_tbel
      *
     c                   when      w_tell = 6
     c                   eval      b8tek5 = d_oh_fttx
     c                   eval      b8bel5 = d_oh_tbel
      *
     c                   when      w_tell = 7
     c                   eval      b8tek6 = d_oh_fttx
     c                   eval      b8bel6 = d_oh_tbel
      *
     c                   when      w_tell = 8
     c                   eval      b8tek7 = d_oh_fttx
     c                   eval      b8bel7 = d_oh_tbel
     c                   endsl
      *
     c                   read      ledilr
     c                   enddo
      *
     c                   exfmt     b8win
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å vise ordretotaler
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     vis_total     begsr
      *
     c                   eval      b9tek0 = 'Sum varelinjer (netto)        '
     c                   eval      b9tek1 = 'Sum alle tillegg ordre        '
     c                   eval      b9tek2 = 'Sum alle fradrag ordre        '
     c                   eval      b9tek3 = 'Netto total (eks.mva.)        '
     c                   eval      b9tek5 = 'Mva grunnlag                  '
     c                   eval      b9tek6 = 'Total mva.                    '
     c                   eval      b9tek7 = 'Ordretotal                    '
      *
     c                   eval      ledilr_mlin = 900001
     c     ledilr_key    chain     ledilr
     c                   if        not %found
     c                   eval      b9bel0 = 0
     c                   eval      b9bel1 = 0
     c                   eval      b9bel2 = 0
     c                   eval      b9bel3 = 0
     c                   eval      b9bel4 = 0
     c                   eval      b9bel5 = 0
     c                   eval      b9bel6 = 0
     c                   eval      b9bel7 = 0
     c                   else
     c                   eval      d_obks = limeld
     c                   eval      b9bel0 = d_os_suml
     c                   eval      b9bel1 = d_os_tilt
     c                   eval      b9bel2 = d_os_frat * -1
     c                   eval      b9bel3 = d_os_ntot
     c                   eval      b9bel4 = 0
     c                   eval      b9bel5 = d_os_mvag
     c                   eval      b9bel6 = d_os_mvat
     c                   eval      b9bel7 = d_os_btot
     c                   endif
      *
     c                   exfmt     b9win
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for visning av bestilling
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     vis_best      begsr
      *
     c                   eval      w_lpro = *blank
      *
     c                   if        linumm <> 0
     c                   call      'LO500R'
     c                   parm                    linumm
     c                   parm                    w_lpro
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å vise referanseinformasjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     vis_refn      begsr
      *
     c                   eval      b11bst = *blank
     c                   eval      b11kun = *blank
     c                   eval      b11pro = *blank
     c                   eval      b11kon = *blank
      *
     c                   eval      ledilr_mlin = 300001
     c     ledilr_key    chain     ledilr
      *
     c                   if        %found
     c                   eval      d_obkh4 = limeld
      *
     c                   if        b11bst = *blank
     c                   eval      b11bst = d_oh_bstn
     c                   endif
      *
     c                   eval      b11kun = d_oh_kunr
     c                   eval      b11pro = d_oh_proj
     c                   eval      b11kon = d_oh_konr
6.3d c                   eval      b11lonr= d_oh_lonr
      *
     c                   endif
      *
     c                   exfmt     b11win
      *
     c     end_refn      endsr
      *
6.35  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.35  * Subrutine for å vise ordretekst
6.35  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.35  *
6.35 c     vis_otext     begsr
6.35  *
6.35 c                   eval      b15tx1 = *blank
6.35 c                   eval      b15tx2 = *blank
6.35 c                   eval      b15tx3 = *blank
6.35 c                   eval      b15tx4 = *blank
6.35 c                   eval      b15tx5 = *blank
6.35 c                   eval      w_otel = 0
6.35  *
6.35 c                   eval      ledil1_mlin = 350000
6.35 c     ledil1_key    setll     ledil1
6.35 c                   read      ledil1
6.35 c                   dow       limlin < 390000 and
6.35 c                             not %eof
6.35 c                   eval      w_otel = w_otel + 1
6.35 c                   eval      d_obkh3 = limeld
6.35 c                   select
6.35 c                   when      w_otel = 1
6.35 c                   eval      b15tx1 = d_oh_ftxt
6.35 c                   when      w_otel = 2
6.35 c                   eval      b15tx2 = d_oh_ftxt
6.35 c                   when      w_otel = 3
6.35 c                   eval      b15tx3 = d_oh_ftxt
6.35 c                   when      w_otel = 4
6.35 c                   eval      b15tx4 = d_oh_ftxt
6.35 c                   when      w_otel = 5
6.35 c                   eval      b15tx5 = d_oh_ftxt
6.35 c                   read      ledil1
6.35 c                   endsl
6.35 c                   read      ledil1
6.35 c                   enddo
6.35  *
6.35 c                   exfmt     b15win
6.35  *
6.35 c     end_otext     endsr
6.35  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for lesing av bestillingslinje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     best_linje    begsr
      *
     c     lodtlr_key    chain     lodtlr
     c                   if        not %found
     c                   eval      ldline = 0
6.22 c                   eval      ldvare = *blanks
     c                   eval      ldanta = 0
     c                   eval      ldenh1 = *blank
     c                   eval      ldipny = 0
     c                   eval      ldkpny = 0
6.12 c                   eval      fdanta = 0
6.12 c                   else
6.12 c                   eval      b_best = *on
6.12 c                   eval      fodtlr_numm = ldornu
6.12 c                   eval      fodtlr_suff = ldorsu
6.12 c                   eval      fodtlr_line = ldorli
6.12 c     fodtlr_key    chain     fodtlr
6.12 c                   if        not %found
6.12 c                   eval      fdanta = 0
6.12 c                   eval      fdkopr = 0
6.12 c                   eval      fdenh1 = *blank
6.12 c                   else
6.12 c                   eval      b_ordr = *on
6.12 c                   endif
     c                   endif
      *
     c                   endsr
      *
6.12  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.12  * Subrutine for test av status på ordretype
6.12  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.12  *
6.12 c     sjekk_otype   begsr
6.12  *
6.12 c                   eval      votylr_otyp = lootyp
6.12 c     votylr_key    chain     votylr
6.12 c                   if        not %found
6.12 c                   eval      b_best = *off
6.12 c                   else
6.12 c                   if        vaoakk <> 1
6.12 c                   eval      b_best = *off
6.12 c                   endif
6.12 c                   endif
6.12  * Hvis feil i ordretypen vises feilmelding
6.12 c                   if        b_best = *off
6.12 c                   exfmt     c1msg
6.12  *
6.12  * Behandling av funksjonstaster
6.12  *
6.12 c                   if        *inkc or *inkl
6.12 c                   eval      b_ordr = *off
6.12 c                   endif
6.12  *
6.12 c                   endif
6.12  *
6.12 c                   endsr
6.12  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for lesing av meldingslinje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     meld_linje    begsr
      *
     c                   eval      ledilr_mlin = b1line
     c     ledilr_key    chain     ledilr
     c                   if        %found
6.17 c**                 eval      d_obkl = limeld
6.17 c                   eval      w_obkl = limeld
6.17 c                   exsr      obkl_konv
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for omregning av pris hvis avvikende enhet best./bekr.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     omregn_pris   begsr
      *
     c                   eval      b_omrf = *on
      *
     c                   eval      vvenlr_vare = ldvare
     c                   eval      vvenlr_enhe = ldenh1
     c     vvenlr_key    chain     vvenlr
     c                   if        %found(vvenlr)
     c                   eval      w_omr1 = veomre
     c                   else
6.30 c                   eval      jvpkl2_ldor = 0
6.30 c                   eval      vvarl1_vare = ldvare
6.30 c     vvarl1_key    chain     vvarl1
6.30 c                   if        %found(vvarl1)
6.30 c                   eval      jvpkl2_ldor = vvnlev
6.30 c                   else
6.30 c                   eval      jvarl1_vare = ldvare
6.30 c     jvarl1_key    chain     jvarl1
6.30 c                   if        %found(jvarl1)
6.33 c                   eval      jvpkl2_ldor = jvldor
6.30 c                   endif
6.30 c                   endif
6.30 c                   if        jvpkl2_ldor <> 0
6.32  *
6.32 c                   eval      jvpkl2_vare = ldvare
6.32 c                   eval      jvpkl2_enhe = ldenh1
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof(jvpkl2)
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on
     c                   eval      w_omr1 = 1
     c                   eval      b_omrf = *off
     c                   else
     c                   eval      w_omr1 = jwofak
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
6.30 c                   endif
     c                   endif
6.33  *
6.33 c                   if        w_omr1 = 0
6.33 c                   eval      b_omrf = *off
6.33 c                   endif
      *
     c                   if        b_omrf = *on
8.02 c                   eval      w_omr2 = 1
     c                   eval      vvenlr_vare = ldvare
     c                   eval      vvenlr_enhe = d_ol_lenh
     c     vvenlr_key    chain     vvenlr
     c                   if        %found(vvenlr)
     c                   eval      w_omr2 = veomre
     c                   else
6.30 c                   eval      jvpkl2_ldor = 0
6.30 c                   eval      vvarl1_vare = ldvare
6.30 c     vvarl1_key    chain     vvarl1
6.30 c                   if        %found(vvarl1)
6.30 c                   eval      jvpkl2_ldor = vvnlev
6.30 c                   else
6.30 c                   eval      jvarl1_vare = ldvare
6.30 c     jvarl1_key    chain     jvarl1
6.30 c                   if        %found(jvarl1)
6.30 c                   eval      jvpkl2_ldor = vvldor
6.30 c                   endif
6.30 c                   endif
6.30 c                   if        jvpkl2_ldor <> 0
     c                   eval      jvpkl2_vare = ldvare
     c                   eval      jvpkl2_enhe = ldenh1
     c     jvpkl2_key    chain     jvpkl2
     c                   if        not %found(jvpkl2)
     c                   eval      w_omr2 = 1
     c                   eval      b_omrf = *off
     c                   else
     c                   eval      w_omr2 = jwofak
     c                   endif
6.30 c                   endif
     c                   endif
     c                   endif
      *
     c                   if        b_omrf = *on
     c                   eval      b5opri = (w_omr1 / w_omr2) * b5lpri
     c*                  eval      b5oant = (w_omr1 / w_omr2) * b5lkva
     c                   eval      b5oant =  b5lkva / w_omr1
     c                   eval      b5oaen = b5oenh
     c                   else
     c                   eval      b5opri = *zero
     c                   eval      b5oant = *zero
     c                   eval      b5oaen = *blank
     c                   endif
      *
     c                   endsr
      *
6.14  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.14  * Subrutine for plassere ordrelinje inn i riktig ds struktur
6.14  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.14  *
6.14 c     obkl_konv     begsr
6.14  *
6.27  * 13 siffers GTIN, men i ny struktur
6.27 c                   if        w_test2 = '0'
6.27 c                   eval      d_obkl = limeld
6.27 c                   else
6.14 c                   if        w_test <> '0'
6.14 c                   eval      d_obkl = limeld
6.14 c                   else
6.14  * GTIN nr er lagt ut med 13 siffers struktur (gammel)
6.14 c                   eval      x_obkl = limeld
6.14 c                   eval      d_ol_llin = x_ol_llin
6.14 c                   eval      d_ol_laks = x_ol_laks
6.14 c                   eval      d_ol_vean = x_ol_vean
6.14 c                   eval      d_ol_vnob = x_ol_vnob
6.14 c                   eval      d_ol_vlev = x_ol_vlev
6.14 c                   eval      d_ol_bkva = x_ol_bkva
6.14 c                   eval      d_ol_benh = x_ol_benh
6.14 c                   eval      d_ol_lkva = x_ol_lkva
6.14 c                   eval      d_ol_lenh = x_ol_lenh
6.14 c                   eval      d_ol_llda = x_ol_llda
6.14 c                   eval      d_ol_pris = x_ol_pris
6.14 c                   eval      d_ol_penh = x_ol_penh
6.14 c                   eval      d_ol_prpr = x_ol_prpr
6.14 c                   eval      d_ol_prkv = x_ol_prkv
6.14 c                   eval      d_ol_epri = x_ol_epri
6.14 c                   eval      d_ol_evar = x_ol_evar
6.14 c                   eval      d_ol_linr = x_ol_linr
6.14 c                   eval      d_ol_linb = x_ol_linb
6.14 c                   eval      d_ol_mvap = x_ol_mvap
6.14 c                   eval      d_ol_tkv1 = x_ol_tkv1
6.14 c                   eval      d_ol_tty1 = x_ol_tty1
6.14 c                   eval      d_ol_ttx1 = x_ol_ttx1
6.14 c                   eval      d_ol_tse1 = x_ol_tse1
6.14 c                   eval      d_ol_tme1 = x_ol_tme1
6.14 c                   eval      d_ol_ten1 = x_ol_ten1
6.14 c                   eval      d_ol_tpr1 = x_ol_tpr1
6.14 c                   eval      d_ol_tbe1 = x_ol_tbe1
6.14 c                   eval      d_ol_tkv2 = x_ol_tkv2
6.14 c                   eval      d_ol_tty2 = x_ol_tty2
6.14 c                   eval      d_ol_ttx2 = x_ol_ttx2
6.14 c                   eval      d_ol_tse2 = x_ol_tse2
6.14 c                   eval      d_ol_tme2 = x_ol_tme2
6.14 c                   eval      d_ol_ten2 = x_ol_ten2
6.14 c                   eval      d_ol_tpr2 = x_ol_tpr2
6.14 c                   eval      d_ol_tbe2 = x_ol_tbe2
6.14 c                   eval      d_ol_txt1 = x_ol_txt1
6.14 c                   eval      d_ol_txt2 = x_ol_txt2
6.14 c                   endif
6.26 c                   endif
6.14  *
6.14 c                   endsr
6.14  *
6.15  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.15  * Subrutine for å finne tillegg/fradrags tekst fra kode
6.15  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.15  *
6.15 c     kal_ntopr     begsr
6.15  *
6.15 c**                 eval      w_npri = d_ol_pris
6.15  *
6.25 c                   if        d_ol_lkva <> *zero
6.25 c                   eval(h)   w_npri = d_ol_linb / d_ol_lkva
6.25 c                   else
6.25 c                   eval(h)   w_npri = d_ol_linb / 1
6.25 c                   endif
      *
6.15 c*6.23              if        d_ol_epri <> 0 and
6.15 c*6.23                        d_ol_epri <> d_ol_pris
6.15 c*6.23              eval      w_npri = d_ol_epri
6.15 c*6.23              endif
6.15  *
6.15 c                   endsr
6.15  *
6.18  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.18  * Subrutine for å vise ordretotaler
6.18  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.18  *
6.18 c     finn_total    begsr
6.18  *
6.18 c                   eval      ledilr_mlin = 900001
6.18 c     ledilr_key    chain     ledilr
6.18 c                   if        not %found
6.18 c                   eval      b2kbel = 0
6.18 c                   else
6.18 c                   eval      d_obks = limeld
6.18 c**tot inkl mva     eval      b2kbel = d_os_btot
6.18 c                   if        d_os_ntot <> 0
6.18 c                   eval      b2kbel = d_os_ntot
6.18 c                   else
6.18 c                   eval      b2kbel = d_os_suml
6.18 c                   endif
6.18 c                   endif
6.18  *
6.18 c                   endsr
6.18  *
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  * Subrutine for å sjekke om dato er innenfor fra /til dato
6.32  * hvis *loval i begge datoer = ok
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  *
6.32 c     sjekk_pkdato  begsr
6.32  *
6.32 c                   eval      b_pakn = *on
6.32  *
6.32 c                   if        jwfdat = *loval and
6.32 c                             jwtdat = *loval
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.32 c                   if        jwfdat <= w_udat and
6.32 c                             jwtdat >  w_udat
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.32 c                   if        jwfdat = *loval  and
6.32 c                             jwtdat >  w_udat
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.32 c                   if        jwfdat <= w_udat and
6.32 c                             jwtdat =  *loval
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.32 c                   eval      b_pakn = *off
6.32  *
6.32 c                   endsr
6.32  *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.01  * Newlook vask av data
7.01  *  Fjerner tegn som gjør at Newlook feiltolker
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.01  *
7.01   begsr newlo_vask;
7.01     for w_teller = 1 to 3 ;
7.01       w_len = %len(%trim(b1tek1));
7.01       if (w_len > 0);
7.01       b1tek1 = %ScanRpl('.':'':b1tek1:w_len); // newlook tåler ikke . på slutten
7.01       endif;
7.01       w_len = %len(%trim(b1tek1));
7.01       if (w_len > 0);
7.01       b1tek1 = %ScanRpl(':':'':b1tek1:w_len); // newlook tåler ikke : på slutten
7.01       endif;
7.01       w_len = %len(%trim(b1stat));
7.01       if (w_len > 0);
7.01       b1stat = %ScanRpl('.':'':b1stat:w_len); // newlook tåler ikke . på slutten
7.01       endif;
7.01       w_len = %len(%trim(b1stat));
7.01       if (w_len > 0);
7.01       b1stat = %ScanRpl(':':'':b1stat:w_len); // newlook tåler ikke : på slutten
7.01       endif;
7.01     endfor ;
7.01   endsr;
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      *  Tar inn parameter fra forrige program
      *
     c     *entry        plist
     c                   parm                    p_parm
     c                   eval      d_prec = p_parm
      *
      *  Key for les av MELDINGSLINJER
      *
     c     ledil1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ledil1_type
     c                   kfld                    ledil1_mnum
     c                   kfld                    ledil1_mlin
      *
      *  Key for oppslag på MELDINGSLINJER
      *
     c     ledilr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ledilr_type
     c                   kfld                    ledilr_mnum
     c                   kfld                    ledilr_mlin
      *
      *  Key for les av BESTILLING-HODE
      *
     c     lohel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lohel1_numm
     c                   kfld                    lohel1_suff
      *
      *  Key for les av BESTILLING-LINJE
      *
     c     lodtl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lodtl1_numm
     c                   kfld                    lodtl1_suff
      *
      *  Key for oppslag på BESTILLING-LINJE
      *
     c     lodtlr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lodtlr_numm
     c                   kfld                    lodtlr_suff
     c                   kfld                    lodtlr_line
6.12  *
6.12  *  Key for oppslag på ordrelinje
6.12  *
6.12 c     fodtlr_key    klist
6.12 c                   kfld                    w_firm
6.12 c                   kfld                    fodtlr_numm
6.12 c                   kfld                    fodtlr_suff
6.12 c                   kfld                    fodtlr_line
      *
      * Key for les av leverandør
      *
     c     rlevl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl1_levr
      *
      * Key for les av leverandør på EAN - lokasjonsnummer
      *
     c     rlevl5_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl5_eanl
      *
      * Key for les av vare-enhet
      *
     c     vvenlr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvenlr_vare
     c                   kfld                    vvenlr_enhe
6.30  *
6.30  * Key for les av vare
6.30  *
6.30 c     vvarl1_key    klist
6.30 c                   kfld                    w_firm
6.30 c                   kfld                    vvarl1_vare
      *
      *  Key for file les hoved EAN-lokasjonsnummer
      *
     c     raa8l1_key    klist
     c                   kfld                    w_firm
      *
      * Key for les av logistikkpunkt
      *
     c     mjlol2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    mjlol2_eann
      *
      * Key for les av vare/enhet (Vareadm.)
      *
     c     jvpkl2_key    klist
     c                   kfld                    jvpkl2_vare
6.30 c                   kfld                    jvpkl2_ldor
     c                   kfld                    jvpkl2_enhe
6.30  *
6.30  * Key for les av vare       (Vareadm.)
6.30  *
6.30 c     jvarl1_key    klist
6.30 c                   kfld                    jvarl1_vare
6.12  *
6.12  * Key for les av ordretype register
6.12  *
6.12 c     votylr_key    klist
6.12 c                   kfld                    w_firm
6.12 c                   kfld                    votylr_otyp
      *
      * Legg inn nøkkelbegreper
      *
     c                   eval      w_firm = d_firm
     c                   eval      ledilr_type = d_type
     c                   eval      ledilr_mnum = d_mnum
     c                   eval      ledilr_mlin = d_mlin
     c                   eval      ledil1_type = d_type
     c                   eval      ledil1_mnum = d_mnum
7.02  *
7.02  * Endring 7.02
7.02  *
7.02   CallP CO402R(l_filg:w_firm:0:'LI102R_702':
7.02                    co402_verdi1:co402_verdi2);
7.02   if co402_verdi1 = '1';
7.02     u_702 = *on;
7.02   endif;
7.04  *
7.04  * Endring 7.03
7.04  *
7.04   w_fo701r = 'FO701R';
7.04   CallP CO402R(l_filg:w_firm:0:'LI102R_704':
7.04                    co402_verdi1:co402_verdi2);
7.04   if co402_verdi1 = '1';
7.04     u_704 = *on;
7.04     w_fo701r = 'FX701R';
7.04   endif;
      *
      * Finn informasjon på meldingshode
      *
     c                   eval      ledilr_mlin = 100001
     c     ledilr_key    chain     ledilr
     c                   if        %found
     c     *dmy          move      limdat        b2mdat
     c     *hms          move      limtid        b2mtid
     c                   eval      lohel1_numm = linumm
     c                   eval      lohel1_suff = lisuff
     c                   eval      lodtl1_numm = linumm
     c                   eval      lodtl1_suff = lisuff
     c                   eval      lodtlr_numm = linumm
     c                   eval      lodtlr_suff = lisuff
6.11 c                   eval      b2mlnr = limnum
      *
     c                   exsr      status_hode
     c                   exsr      best_hode
      *
     c                   eval      b2numm = linumm
     c                   eval      d_obkh = limeld
6.18 c                   eval      b2bbel = lototi
7.03 c                   eval      b2bkbl = lototk
6.18  *
6.18 c                   exsr      finn_total
      *
     c                   if        d_oh_olda <> *loval
     c     *dmy          move      d_oh_olda     b2odat
     c                   else
     c                   if        loldat <> *loval
     c     *dmy          move      loldat        b2odat
     c                   else
     c                   eval      b2odat = 0
     c                   endif
     c                   endif
      *
     c                   if        d_oh_llda <> *loval
     c     *dmy          move      d_oh_llda     b2ldat
     c                   else
     c                   eval      b2ldat = 0
     c                   endif
      *
     c                   if        d_oh_kref <> *blank
     c                   eval      b2vref = d_oh_kref
     c                   else
     c                   eval      b2vref = lodref
     c                   endif
     c                   movel     d_oh_obnr     b2kref
      *
     c                   eval      b2ldor = lildor
     c                   exsr      les_ldor
      *
     c                   endif
6.35  *
6.35  * Finnes det noen linjer med fritekstlinjer tilknyttet ordrehodet
6.35  *
6.35 c                   eval      ledil1_mlin = 350000
6.35 c     ledil1_key    setll     ledil1
6.35 c                   read      ledil1
6.35 c                   dow       limlin < 390000 and
6.35 c                             not %eof
6.35 c                   eval      *in32 = *on
6.35 c                   read      ledil1
6.35 c                   enddo
      *
      * Fyller opp subfile med meldingslinjer
      *
      *
     c                   eval      ledil1_mlin = 500000
     c     ledil1_key    setll     ledil1
      *
     c                   exsr      crt_subfile
      *
     c                   endsr
      *
