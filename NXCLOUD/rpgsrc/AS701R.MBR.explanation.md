# Explanation of the RPG Source Code

This RPG program is designed to **split a search string into up to five search terms**. It also generates SQL `LIKE` patterns for these terms, using the `%` wildcard, suitable for queries. The program ensures that if any term is empty, it returns a string of `%` characters for that slot, which acts as a match-all wildcard in SQL.

---

## File Header

- `h option(*nodebugio) datedit(*dmy)`: 
  - Use no debug I/O and date edit (day-month-year).
- Program name: `AS700R`.
- **Description:** Common program for splitting a search string into up to 5 search texts (terms).
- **Special rules:** If a search term is empty, it returns a string of `%`s.
- **Date and author:** 28-Jun-2005, HKO.

---

## Data Definitions

### Parameters

```rpg
d p_stek          s             35
d p_ste1          s             35
d p_ste2          s             35
d p_ste3          s             35
d p_ste4          s             35
d p_ste5          s             35
```
- `p_stek`: Input search string, up to 35 characters.
- `p_ste1`-`p_ste5`: Output parameters, each up to 35 chars, to store the split terms.

### Working Variables

```rpg
d w_l             s              2  0
d w_l1            s              2  0
d w_l2            s              2  0
d w_l3            s              2  0
d w_l4            s              2  0
d w_l5            s              2  0

d w_stek          s             35
```
- `w_l1`-`w_l5`: Lengths of each term found.
- `w_stek`: Working copy of the input string.
- `w_l`: Temporary variable used when swapping lengths.

---

## Main Program Logic

### 1. **Splitting the Input String**

- The program trims leading spaces from the input (`w_stek = %triml(p_stek)`).
- It then repeatedly:
  - Scans for the next space (`%scan(' ':w_stek)`) to find the first word.
  - Extracts that word using `%subst`.
  - Updates the working string by removing the extracted word and trimming further spaces.
  - Repeats for up to 5 terms (`w_l1` to `w_l5` and `p_ste1` to `p_ste5`).
- If there are fewer than 5 terms (spaces), remaining outputs are set to blanks.

### 2. **Sorting Terms by Length (Longest First)**

- It checks the lengths `w_l1`...`w_l5` and swaps terms so that the **longest term is moved to `p_ste1`**.
- This is a bubble-sort style check for up to 5 values.
- The associated search strings (`p_steN`) and their registered lengths (`w_lN`) are swapped simultaneously.

### 3. **Formatting Output Terms as SQL LIKE Patterns**

For each search term output (`p_ste1` to `p_ste5`):  
- If the value is not blank:
    - Prepend a `%`, trim the word, and pad with `%` to fill length.
- If blank:
    - Fill the whole output with just `%` (acts as "match anything").

This ensures each output is a valid SQL LIKE pattern (e.g. `%word%%%%%%%%%%%%`).

---

## Program Structure

### Entry & Initialization

- `*inzsr` subroutine is called automatically on program start:
  - Reads the entry parameters in order (input string, then five outputs).
  - Sets all outputs to blank initially.

### Main Logic

- All the main logic (splitting, sorting, formatting) happens after the initialization.
- The program sets `*inlr = *on` and returns, signaling end-of-program.

---

## Summary Table

| Variable   | Purpose                                       |
|------------|-----------------------------------------------|
| p_stek     | Input search string (up to 35 chars)          |
| p_ste1-5   | Output search patterns (up to 35 chars each)  |
| w_stek     | Working variable for string manipulation      |
| w_l1-5     | Length of each word found                     |
| w_l        | Temporary variable used for swapping lengths  |

---

## Typical Flow Example

Input: `"apple orange peach plum grape"`

- `p_ste1`: `%orange%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%` (if 'orange' is the longest)
- `p_ste2`: `%apple%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%`
- `p_ste3`: `%peach%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%`
- `p_ste4`: `%grape%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%`
- `p_ste5`: `%plum%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%`

If there are fewer terms, the rest are filled with only `%` (i.e. "match all").

---

## Key RPG Operations Used

| Operation   | Description                                                |
|-------------|------------------------------------------------------------|
| `%triml`    | Trim leading blanks from a string                          |
| `%scan`     | Find position of a value within a string                   |
| `%subst`    | Extract a substring from a string                          |
| `*blank`    | RPG built-in blank value                                   |
| `*inlr = *on` | Set last record indicator (end program)                  |

---

## Use Case

This program is typically called by other applications that need to split search input into components and produce SQL-compatible LIKE patterns, ensuring flexible and robust database querying even with incomplete or partial user input.