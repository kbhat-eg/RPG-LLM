# RA510R – Warehouse Inquiry Program Documentation

## Overview

**RA510R** is a core interactive program in the ASOKON system, designed for warehouse (lager) inquiry and selection. It provides a subfile-driven user interface for browsing, searching, and selecting warehouse records by code or description. The program supports paging, positioning, and selection mechanisms tailored for integration with both traditional DDS-based and newer GUI interfaces.

## Key Business Logic

- **Warehouse Browsing:** Users can view a paginated list of warehouse records.
- **Search/Positioning:** Direct positioning is available by warehouse code (`jkod`) or description (`jtxt`).
- **Selection:** Users can select a warehouse, returning the code and description as output parameters.
- **Paging:** Forward and backward paging is supported.
- **Integration:** The program is designed to be called with input/output parameters for seamless integration with other modules.

## File and Display Definitions

- **Physical Files:**
    - `fra10l1` (RA10PFR): Primary warehouse master file, keyed by warehouse code.
    - `fra10l2` (RA10PFR): Alternate access path, keyed by warehouse description.

- **Display Files:**
    - `fra510d`: Workstation file with subfile (`b1sfl`) and control records (`b2ctl`, `b2cmd`).

## Parameters

- `p_firm` (Company/Client identifier)
- `p_jkod` (Warehouse code, input/output)
- `p_jtxt` (Warehouse description, input/output)

## Main Data Structures and Variables

- **Subfile Control:**
    - `w_stel`: Subfile line counter
    - `w_spge`: Subfile page size
    - `w_srrn`: Current relative subfile record number
    - `w_sfrn`: First record number of the current page
    - `w_ssrn`: Last record number of the current page

- **Selection State:**
    - `w_seqe`: Search sequence indicator ('B' = by description)
    - `b_valg_ok`: Flag indicating a successful selection

- **Positioning Keys:**
    - `ra10l1_jkod`: For positioning by code
    - `ra10l2_jtxt`: For positioning by description

## Application Flow

### 1. Initialization (`*inzsr`)

- Receives input parameters.
- Sets up key lists for both access paths.
- Initializes the display.
- Positions to the start of the warehouse file and loads the first page into the subfile.

### 2. Main Loop

- **Display Subfile:** Shows the current page of warehouse records.
- **User Input Handling:** Processes function keys for paging, refreshing, positioning, and selection.
    - **Paging:** F10 (next), F11 (previous)
    - **Positioning:** F21 (home), or direct entry of code/description
    - **Selection:** User marks a row, sets `b1valg` to 1
    - **Exit:** F3/F12 to exit

- **Subfile Management:** Handles clearing, filling, and updating the subfile based on user actions.

### 3. Subroutines

#### `forny`

- Refreshes the subfile at the current position.
- Repositions the file pointer based on current search sequence (by code or description).
- Clears and refills the subfile.

#### `posisjoner`

- Positions the file based on user-entered code or description.
- Clears and refills the subfile at the new position.
- Resets positioning fields for the next interaction.

#### `subfile`

- Processes subfile for user selection.
- Reads changed records, checks for selection (`b1valg` = 1).
- Sets output parameters and exit flag on selection.

#### `clr_subfile`

- Clears the subfile by setting indicator 14 and writing the control record.
- Resets subfile counters and page indicators.

#### `crt_subfile`

- Fills the subfile with the next page of records from the current position.
- Handles both access paths (code or description).
- Stops at end-of-file or when company changes.

#### `bck_subfile`

- Handles backward paging.
- Positions to the previous page using `readp`.
- Clears and refills the subfile with the previous page.

#### `dsp_subfile`

- Handles display of the subfile and control record.
- Sets indicators for display and formatting.

## Indicators and Conventions

- **Indicators 10–15, 21–22, 30, 31–99:** Used for subfile control, error reporting, and UI state.
- **Subfile Paging:** Controlled by `w_spge` and constant `c_sfil` (page size).
- **Access Paths:** The program can switch between code and description access paths dynamically.

## Integration Points

- **Called by Other Programs:** RA510R is designed to be called from other modules, passing company, code, and description as parameters.
- **Returns Selection:** On successful selection, returns the chosen warehouse code and description.

## Noteworthy Design Decisions

- **Dual Access Paths:** Supports flexible searching by both code and description, which is important for usability.
- **Subfile Paging Logic:** Carefully manages subfile pointers and indicators to ensure correct paging and positioning.
- **Indicator-Driven UI:** Relies heavily on RPG indicators for UI state, which is a convention in this codebase.
- **Separation of Concerns:** Subroutines are well-structured, each handling a distinct aspect of the subfile or UI logic.

## Relationships with Other Modules

- **RA10PFR:** Master data source for warehouse information.
- **Display File (`fra510d`):** Must be kept in sync with subfile logic; any changes to the subfile structure in DDS will impact this program.
- **Caller Programs:** Must provide valid company, code, and description parameters and handle the returned values.

## Business/Domain-Specific Notes

- **Warehouse Inquiry:** Central to inventory management and transaction processing.
- **Paging Size:** Default page size is set via `c_sfil` (8 records); can be adjusted if UI requirements change.
- **Selection Handling:** Only one selection per invocation is supported.

---

**In summary:**  
RA510R is a robust, interactive warehouse inquiry tool supporting dynamic searching and paging, designed for seamless integration into the ASOKON suite. Its structure reflects standard RPG subfile patterns, with careful attention to business needs for flexible searching and efficient navigation. Understanding its subfile and indicator management is key for maintenance and extension.