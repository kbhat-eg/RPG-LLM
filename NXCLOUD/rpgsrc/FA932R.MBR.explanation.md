# Overview of the RPG Source Code

This RPG program is designed for integration with the IBM i system, specifically to perform a company lookup via a web service (Bisnode) and process the received data. 

---

# Key Components and Functionality

## 1. **Header Specifications**

- **`Hh decedit('0.') datedit(*dmy-) option(*nodebugio)`**  
  Sets numeric editing and date formats; disables debug I/O for performance.

- **`h DftActgrp(*No) Actgrp(*NEW) BndDir('CGIDEV2/CGIDEV2')`**  
  Sets the activation group and binding directory for calling external modules, particularly CGIDEV2 for web/services.

- **Includes (`/copy hspecsbnd`)**  
  Incorporates external definitions or parameters, standard for modular code.

---

## 2. **System Documentation and Change Log**

The comments specify system environment, program name (`FA932R`), description (company lookup via web service against Bisnode), and a change history, including updates for specific features and modifications.

---

## 3. **Data Definitions**

### a. **Local Data Area (LDA)**

- **`uds` structure** contains values like user info and flags.
- **Variables (`l_user`, `l_figr`, etc.)** store environment/session info, including user ID, figure code, filename parts, and company identifiers.

### b. **Parameters (Parameters for external calls)**

- **`p_fnum`, `p_navn`, etc.** are input parameters representing company number, name, address, and other info passed into the program.

### c. **XML Input/Output Variables**

- **`XML_Input`, `XML_Output1-4`** hold XML data files for interfacing with the web service or reading responses.

### d. **Supporting Variables**

- Variables for web request details (`w_url`, `w_reqf`, `w_rspf`), user credentials, response statuses, and temporary buffers for XML parsing.

### e. **Constants**

- **`c_sfil`** with value 14, likely used for string operations or file handling.

### f. **Structured Data for XML Parsing**

- **`Identifikasjon`, `NavnAdresse`, `Rating`, `Grunnfakta`, `Scoring`**  
  These are data structures to parse parts of the XML response into accessible RPG fields.

---

## 4. **External Program Declarations**

- **`CO402R`**: An external program for retrieving user login details (user ID and password) from a configuration system.

## 5. **SQL Settings**

- **`Set Option`** adjusts date formats, language, and formatting for embedded SQL.

---

## 6. **Main Program Logic**

### a. **Building the Request Files**

- Constructs XML filenames based on folder paths and the company figure number (`l_figr`), then calls a utility (`GetHTMLIFS`) to generate necessary XML templates for request and headers.

### b. **Loading User Credentials (External Call)**

- Calls `CO402R` program to retrieve external login credentials which are stored in `co402_verdi1`, `co402_verdi2`.

- Parses `co402_verdi2` to extract the user ID and password, stored in `w_usrk` and `w_pask`.

### c. **Setting Parameters for Web Service**

- Assigns the user credentials and constructs URL for web service (commented out test URL and production URL).

- Calls external subroutine `'AW703C'` â€” likely a web service call to retrieve company data based on XML request files.

### d. **Reading and Parsing Response XML**

- Reads the response XML files into the structured variables (`Identifikasjon`, `NavnAdresse`, `Rating`, etc.) using `xml-into`.

- Extracts relevant company information fields from the parsed structures into local variables.

### e. **Calculations and Database Retrieval**

- Calculates `w_scorn`, the score as a numeric value.

- Based on the rating and decision (`w_besl`), conditionally retrieves credit limit data from the `ra33st` database table, depending on the score.

### f. **Preparing Return Data**

- Assigns the retrieved and computed values to output parameters such as `p_navn`, `p_adr1`, etc.

### g. **Cleanup**

- Deletes the temporary XML files created during the process.

---

## 7. **Program Termination**

- Closes with setting `*inlr = *on` (end of the program logic), and `return` to exit.

---

## 8. **Error Handling Routine**

- A simple routine resets output parameters to blanks or zeros if no data is found, ensuring clean return values on failure.

---

## 9. **Subroutine for Initialization (`*inzsr`)**

- **Purpose**: Sets initial values for parameters and retrieves external login credentials.

- **Steps**:
  - Loads parameters.
  - Calls external `AS100R` to get a sequence counter and company code.
  - Calls `CO402R` to get user credentials, parsing the credential string to separate user ID and password.

---

# Summary

This RPG program is a comprehensive system for:

- Preparing XML request templates for company data via web service.
- Calling an external web service for company info.
- Parsing the XML response into structured data.
- Making further database lookups for credit limits based on the score.
- Returning relevant info back to calling programs.

It exemplifies typical RPG integration with web services, XML processing, and database access on IBM i, with modular design and clear separation of initialization, processing, and cleanup phases.