# RPG Program Overview: *Henter fakturatype fra kunde*  
This RPG program is designed to fetch the invoice type ("fakturatype") for a customer from a file, based on firm and customer number. It also indicates whether the customer exists and if they are blocked for use.

---

## Header and Documentation

- **/TITLE** and comments describe purpose, usage, revision history, and indicators/return codes.
- **h datedit(**dmy**) option(**nodebugio**):** 
  - Sets the date format for edited output to DD/MM/YY.
  - Disables debug I/O.

---

## File Declaration

```rpg
frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
```
- Declares file `rkunpfr`, renamed locally as `rkunl1r`, for input (`i`), full procedural (`f`), externally described (`e`), and keyed access (`k`).

---

## Variable Declarations

- **Parameter Variables (passed into/out of program):**
    ```rpg
    d p_firm          s                   like(rkfirm)
    d p_kund          s                   like(rkkund)
    d p_faty          s                   like(rkfaty)
    d p_retk          s              1
    ```
    - `p_firm`: Firm number (parameter)
    - `p_kund`: Customer number (parameter)
    - `p_faty`: Invoice type (output)
    - `p_retk`: Return code (output)  
        - `'N'`: Customer not found
        - `'S'`: Customer blocked/suspended
- **Work Variables:**
    ```rpg
    d w_firm          s                   like(rkfirm)
    d w_kund          s                   like(rkkund)
    ```
    - Used for the key in file lookup.
- **Others:** Defined, likely for future/legacy use or external data areas (user, name, etc).

---

## Parameter List

```rpg
c     *entry        plist
c                   parm                    p_retk
c                   parm                    p_firm
c                   parm                    p_kund
c                   parm                    p_faty
```
- RPG entry point: Maps program parameters to the variables above.

---

## Main Logic

1. **Initialization:**
    ```rpg
    c                   eval      w_firm = p_firm
    c                   eval      p_retk = *blank
    c                   eval      p_faty = 0
    ```
    - Copies firm from parameter.
    - Initializes return code and invoice type.

2. **Set up key for customer file:**
    ```rpg
    c                   eval      rkunl1_kund = p_kund
    c     rkunl1_key    chain     rkunl1r                            60
    ```
    - Prepares customer key.
    - Performs keyed lookup (`CHAIN`) on customer file; sets indicator 60 if not found.

3. **Customer not found:**
    ```rpg
    c                   if        *in60 = *on
    c                   move      'N'           p_retk
    c                   goto      slutt
    c                   endif
    ```
    - If not found, sets return code `'N'` and ends program.

4. **Customer blocked?**
    ```rpg
    c                   if        rksprk = 'J'
    c                   move      'S'           p_retk
    c                   goto      slutt
    c                   endif
    ```
    - If customer is blocked (`rksprk` = 'J'), sets return code `'S'` and ends program.

5. **Return invoice type:**
    ```rpg
    c                   move      rkfaty        p_faty
    ```
    - Otherwise, fetches invoice type for customer.

---

## End of Program

```rpg
c     slutt         tag
c                   eval      *inlr = *on
c                   return
```
- Tag/label for early exit (`goto slutt` above).
- Turns on the last record indicator (`*INLR`), closing the program, and returns.

---

## Initialization Subroutine (*inzsr*)

- Sets up the key list for the customer file:
    ```rpg
    c     rkunl1_key    klist
    c                   kfld                    w_firm
    c                   kfld                    rkunl1_kund
    ```
    - Defines the composite key for file access.

---

## Return Codes Summary

- `p_retk = 'N'` — Customer not found
- `p_retk = 'S'` — Customer blocked
- On success, `p_faty` is set to the customer's invoice type.

---

## Usage Summary

Given a firm and customer number:
1. Checks if customer exists.
2. Checks if they are blocked.
3. Returns their invoice type if eligible.

The program is efficient, strictly procedural, and uses standard RPG III/400 idioms like indicators and `CHAIN`.  
Comments are in Norwegian, but logic is generally straightforward and cleanly organized.