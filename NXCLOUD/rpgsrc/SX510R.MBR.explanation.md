```markdown
# Overview  
This RPG program (`SX510R` in library `ASSTAT`) deletes sales-statistics records up to a specified period. It:  
- Reads parameters (firm and period) via a parameter list  
- Opens the `sstal1` file (renamed internally to `sstal1r`)  
- Deletes every record for the given firm where the period is less than the specified one  

---

## 1. File Specification  
```
FSSTAL1    UF   E           K  DISK  RENAME(SSTAPFR: SSTAL1R)
```  
- UF: Update file (delete operations allowed)  
- E: Externally described  
- K: Keyed access on disk  
- RENAME: logical name `SSTAL1R` in code for physical file `SSTAPFR`  

### Keyed Fields on `SSTAL1R`  
1. `sstal1_firm` (Firm)  
2. `sstal1_paar` (Year/Period)  
3. `sstal1_binr` (???—binary number)  
4. `sstal1_line` (Line number)  
5. `sstal1_bida` (???—additional ID)  

---

## 2. Working Variables  
```rpg
D sstal1_firm  S        LIKESFFIRM  
D sstal1_paar  S        LIKESFPAAR  
D sstal1_binr  S        LIKESFBINR  
D sstal1_line  S        LIKESFLINE  
D sstal1_bida  S        LIKESFBIDA  
```  
These mirror the file fields—used to build keys for reads/deletes.

---

## 3. Local Data Area (LDA)  
```rpg
D         UDS
D l_firm       944  946  0   // holds the firm code  
D l_navn       951  980     // holds a name or description  
```  
- `UDS` declares the program’s user data area  
- `l_firm` and `l_navn` overlay fixed LDA positions  

---

## 4. Parameter-List Data Structure  
```rpg
D p_list      S             64  // raw 64-byte parameter  
D             DS
D d_list                  64  
D  d_firm       3  0 OVERLAY(d_list:1)  
D  d_paar       4  0 OVERLAY(d_list:4)  
```  
- `p_list` receives input parameters (usually from a caller)  
- `d_list` overlays `p_list` so you can extract:  
  - `d_firm` (3-digit firm)  
  - `d_paar` (4-digit period)  

---

## 5. Initialization Subroutine (`*INZSR`)  
Executed once at program start.  
```rpg
C     *INZSR      BEGSR  
C     *ENTRY      PLIST  
C                   PARM      p_list  
C                   EVAL      d_list = p_list  

// Build the key list for later I/O  
C     sstal1_key  KLIST  
C                   KFLD      sstal1_firm  
C                   KFLD      sstal1_paar  
C                   KFLD      sstal1_binr  
C                   KFLD      sstal1_line  
C                   KFLD      sstal1_bida  
C                   ENDSR  
```  
- Moves incoming `p_list` to `d_list` → sets `d_firm` and `d_paar`.  
- Defines the I/O key sequence (`sstal1_key`) matching the disk file key order.  

---

## 6. Main Logic: Deleting Records  
1. **Set Lower Limit**  
   ```rpg
   C                   EVAL      sstal1_firm = d_firm  
   C                   EVAL      sstal1_paar = 0  
   C     sstal1_key   SETLL     SSTAL1R       90  
   ```  
   - Positions the file pointer at the first record for `d_firm` and period `>= 0`.  
   - On error or end‐of‐file, jumps to label `90` (cleanup).

2. **Loop: Read & Delete**  
   ```rpg
   C     sstal1_les  TAG  
   C                   READ      SSTAL1R       90  
   C                   IF        SFFIRM = d_firm  
   C                   AND       SFPAAR < d_paar  
   C                   DELETE    SSTAL1R  
   C                   GOTO      sstal1_les  
   C                   ENDIF  
   ```  
   - `READ` reads the next record in key sequence.  
   - If the record’s **firm** matches `d_firm` **and** its **period** is **less** than `d_paar`, it:  
     - Deletes that record  
     - Loops back to read the next one.  
   - Once you encounter a record whose period is ≥ `d_paar`, or firm changes, the loop ends.  

---

## 7. Cleanup & Exit  
```rpg
C     90          TAG  // end‐of‐file or key out‐of‐range  
C                   EVAL      *INLR = *ON  
C                   RETURN
```  
- Sets **last record indicator** (`*INLR`) on → closes files, ends program.  
- `RETURN` hands control back to the caller.  

---

# Summary  
- **Initialization**: extract firm/period from parameters, build key list  
- **Main loop**: position on firm’s first record, read each one, delete if period < limit  
- **Exit**: set *INLR and return to free resources  
```