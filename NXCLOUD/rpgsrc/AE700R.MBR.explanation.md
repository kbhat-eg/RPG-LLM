# Overview  
This RPGLE program (AE700R) reads user-defined “utkø/Enheter” records from the file AENHL1 and, for each record where the start-flag is set, calls another program (AE702C) to perform a start/stop action.  

---

## 1. File Declaration  
```rpg
faenhl1   if   a e   k   disk   rename(aenhpfr:aenhl1r)
```
- `faenhl1`: File input on disk  
- `rename(aenhpfr:aenhl1r)`: Uses externally-defined file layout (PF source named AENHPFR) under the local name AENHL1R  

---

## 2. Data Definitions  

**Keyed File Key**  
```rpg
d aenhl1_prid    s   like(aeprid)  
```  
- Defines the key field for the file AENHL1.  

**Working Variables**  
```rpg
d w_prid         s   like(aeprid)   // Parameter: program ID  
d w_qmsg         s   10             // Parameter: message option  
d w_form         s   10             // Parameter: format option  
d w_tilk         s   like(aetilk)  // Parameter: linking info  
```  

---

## 3. Main Logic (Hovedprogram)  
```rpg
 /eject
 // Reset key and position to start of file
 eval      aenhl1_prid = *blank  
 aenhl1_key setll   aenhl1  
 read      aenhl1    90  

 dow       *in90 = *off  
   // If start-flag = 1, invoke subroutine to call AE702C
   if      aestrt = 1  
     exsr    call_pgm  
   endif  

   // Read next record; on EOF branch to label 90
   read   aenhl1    90  
 enddo  

 // End program
 eval      *inlr = *on  
 return  
```

Steps:  
1. Blank the key field.  
2. `SETLL` positions the file cursor at the first record.  
3. `READ ... 90` reads the first record; on EOF jumps to label 90.  
4. Loop (`DOW *IN90=*OFF`) until EOF:  
   - If `aestrt = 1`, execute the `call_pgm` subroutine.  
   - Read the next record; on EOF go to label 90.  
5. At EOF, set the Last-Record Indicator (`*INLR = *ON`) and return.  

---

## 4. Subroutine CALL_PGM  
```rpg
c     call_pgm begsr  
  // Copy record fields to parameters
  eval w_prid = aeprid  
  eval w_tilk = aetilk  

  // Choose message option
  if  aeqmsg = 1  
    eval w_qmsg = '*INQMSG   '  
  else  
    eval w_qmsg = '*NOMSG    '  
  endif  

  // Choose format option
  if  aeform = *blank  
    eval w_form = '*ALL      '  
  else  
    eval w_form = aeform  
  endif  

  // Call external program AE702C
  call 'AE702C'  
    parm w_prid  
    parm w_qmsg  
    parm w_form  
    parm w_tilk  
c   endsr  
```

What it does:  
- Initializes four working variables based on the current record.  
- Sets default values when fields are blank or flags are off.  
- Calls the start/stop program AE702C with the prepared parameters.  

---

## 5. Initialization Subroutine (*INZSR)  
```rpg
c  *inzsr begsr  
  // Build the key list for file AENHL1
  aenhl1_key klist  
    kfld aenhl1_prid  
c  endsr  
```
- Automatically runs at program startup.  
- Defines the key list used by `SETLL` and subsequent file reads.