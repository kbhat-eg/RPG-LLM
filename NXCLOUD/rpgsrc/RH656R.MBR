     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RH656R                                              *
      * Beskrivelse . . : Hovedbok - tabellarisk saldobalanse                 *
      * Beskrivelse . . : Tabellarisk saldobalanse                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
6.20  * V6.20     250211  Avdelingstekst utvidet til 30 posisjoner       bsa  *
6.30  * V6.30     040719  Utviodet saldofelter                           bsa  *
      *                                                                       *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     frhsal1    if   e           k disk    rename(rhsapfr:rhsal1r)
     frhsal2    if   e           k disk    rename(rhsapfr:rhsal2r)
     frh656p    o    e             printer oflind(*in30)
      *
      * T   A   B   E   L   L   E   R
      *
6.30 d sal             s             15  2 dim(13)
      *
     d                 ds
     d nybrd                         13  0                                      Bruddb
     d  nyavd                         4  0 overlay(nybrd)                       Avdeli
     d  nykto                         5  0 overlay(nybrd:5)                     Konto
     d   nygrp                        2  0 overlay(nykto:2)                     Gruppe
     d    nykla                       1  0 overlay(nygrp)                       Klasse
     d  nysps                         4  0 overlay(nybrd:10)                    Spesif
     d nyavdo                         4  0                                      Bruddb
      *
     d                 ds
     d gmbrd                         13  0                                      Bruddb
     d  gmavd                         4  0 overlay(gmbrd)                       Avdeli
     d  gmkto                         5  0 overlay(gmbrd:5)                     Konto
     d   gmgrp                        2  0 overlay(gmkto:2)                     Gruppe
     d    gmkla                       1  0 overlay(gmgrp)                       Klasse
     d  gmsps                         4  0 overlay(gmbrd:10)                    Spesif
     d gmavdo                         4  0                                      Bruddb
      *
     d                uds
     d rhpkda                300    305  0
     d rhprÅr                         4  0
     d rhpper                         2  0
     d rhppef                         2  0
     d rhppet                         2  0
     d rhpavf                         4  0
     d rhpavt                         4  0
     d rhpbØf                         4  0
     d rhpbØt                         4  0
     d rhpktf                         5  0
     d rhpktt                         5  0
     d rhpsrt                         1
     d rhpsml                         1
     d rhpavv                         1
     d rhpkgs                         1
     d rhpkks                         1
T400 d rhpspb                         1
     d rhanul                         1
     d rhpa01                         4  0
     d rhpa02                         4  0
     d rhpa03                         4  0
     d rhpa04                         4  0
     d rhpa05                         4  0
     d rhpa06                         4  0
     d rhpa07                         4  0
     d rhpa08                         4  0
     d rhpa09                         4  0
     d rhpa10                         4  0
     d rhpa11                         4  0
     d rhpa12                         4  0
     d rhpa13                         4  0
     d rhpa14                         4  0
     d rhpa15                         4  0
     d rhpa16                         4  0
     d rhpa17                         4  0
     d rhpa18                         4  0
     d rhpa19                         4  0
     d rhpa20                         4  0
     d rhpa21                         4  0
     d rhpa22                         4  0
     d rhpa23                         4  0
     d rhpa24                         4  0
      *
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
     d antkto          s                   like(totkto)
     d antsps          s                   like(totkto)
6.20 d avtext          s             30
     d bev             s                   like(risa01)
     d difh            s                   like(risa01)
     d difp            s                   like(risa01)
      *
     d lrbevd          s                   like(risa01)
     d lrbevk          s                   like(risa01)
     d lrdifh          s                   like(risa01)
     d lrdifp          s                   like(risa01)
     d lrsald          s                   like(risa01)
     d lrsalk          s                   like(risa01)
      *
     d l1beÅr          s                   like(risa01)
     d l1befj          s                   like(risa01)
     d l1bevp          s                   like(risa01)
     d l1buÅr          s                   like(risa01)
     d l1bufj          s                   like(risa01)
     d l1busÅ          s                   like(risa01)
     d l1busf          s                   like(risa01)
     d l1saÅr          s                   like(risa01)
     d l1safj          s                   like(risa01)
     d l1salh          s                   like(risa01)
     d l1samh          s                   like(risa01)
     d l1samp          s                   like(risa01)
      *
     d l2bevp          s                   like(risa01)
     d l2salh          s                   like(risa01)
     d l2samh          s                   like(risa01)
     d l2samp          s                   like(risa01)
      *
     d l3bevp          s                   like(risa01)
     d l3salh          s                   like(risa01)
     d l3samh          s                   like(risa01)
     d l3samp          s                   like(risa01)
      *
     d l4bevp          s                   like(risa01)
     d l4salh          s                   like(risa01)
     d l4samh          s                   like(risa01)
     d l4samp          s                   like(risa01)
      *
     d l5bevp          s                   like(risa01)
     d l5salh          s                   like(risa01)
     d l5samh          s                   like(risa01)
     d l5samp          s                   like(risa01)
      *
     d n               s              2  0
     d prfjo           s                   like(rhprÅr)
     d proh            s              7  1
     d prop            s              7  1
6.30 d risa01          s             15  2
     d samh            s                   like(risa01)
     d samp            s                   like(risa01)
     d sum             s                   like(risa01)
     d totkto          s              5  0
     d totsid          s                   like(totkto)
     d wmvak           s              1
     d wmvao           s              1
     d wpro1           s              9  4
     d wtext           s             30
     d wtype           s                   like(ritype)
      *
     d p_stat          s              1
     d p_gkod          s                   like(riavde)
     d p_gtxt          s             20
     d p_kont          s                   like(rikont)
     d p_spes          s                   like(rispes)
     d p_avde          s                   like(riavde)
     d p_text          s             30
     d p_skod          s              2  0
     d p_stxt          s             20
     d p_tkod          s              2  0
     d p_ttxt          s             20
      *
     d w_firm          s                   like(rifirm)
      *
      *  Saldo-register - Kontonr.rekkefølge
      *
     irhsal1r
     i              risa01                      sal(01)
     i              risa02                      sal(02)
     i              risa03                      sal(03)
     i              risa04                      sal(04)
     i              risa05                      sal(05)
     i              risa06                      sal(06)
     i              risa07                      sal(07)
     i              risa08                      sal(08)
     i              risa09                      sal(09)
     i              risa10                      sal(10)
     i              risa11                      sal(11)
     i              risa12                      sal(12)
     i              risa13                      sal(13)
      *
      *  Saldo-register - Avdelingsrekkefølge
      *
     irhsal2r
     i              risa01                      sal(01)
     i              risa02                      sal(02)
     i              risa03                      sal(03)
     i              risa04                      sal(04)
     i              risa05                      sal(05)
     i              risa06                      sal(06)
     i              risa07                      sal(07)
     i              risa08                      sal(08)
     i              risa09                      sal(09)
     i              risa10                      sal(10)
     i              risa11                      sal(11)
     i              risa12                      sal(12)
     i              risa13                      sal(13)
      *
     c     dummy         tag
      *
     c     les           tag
      *
B001 c                   if        rhpsrt = 'K'
 001 c                   read      rhsal1r                                10
X001 c                   else
 001 c                   read      rhsal2r                                10
E001 c                   endif
      *
B001 c  n10              do                                                              .....
 001  *
 001 c                   eval      wtype = ritype
 001  *
B002 c                   if        w_firm> l_firm
 002 c                   eval      *in10 = *on
E002 c                   endif
 001  *
B002 c                   if        rhpsrt = 'K'                                          .....
B003 c                   if        rikont > rhpktt                                           .
 003 c                   eval      *in10 = *on                                               .
E003 c                   endif                                                               .
E002 c                   endif                                                           .....
 001  *
B002 c                   if        rhpsrt = 'A'                                          .....
B003 c                   if        riavde > rhpavt                                           .
 003 c                   eval      *in10 = *on                                               .
E003 c                   endif                                                               .
E002 c                   endif                                                           .....
 001  *
E001 c                   enddo                                                           .....
      *
B001 c   10              do                                                              .....
 001 c                   eval      *inlr = *on                                               .
 001 c                   move      *hival        nybrd                                       .
 001 c                   goto      brudde                                       FERDIG       .
E001 c                   enddo                                                           .....
      *
      * Sjekk om brudd i kontrollbegrepet
      *
     c     brudd         tag
      *
     c                   eval      nyavd = riavde
     c                   eval      nyavdo = riavde
     c                   eval      nykto = rikont
     c                   move      rispes        nysps
      *
      * Test mot utvalg, men ikke hvis slutt
      *
      * Sjekk kontonr. fra/til
      *
B001 c                   if        nykto < rhpktf or                                     .....
B001 c                             nykto > rhpktt                                        .....
 001 c                   goto      neste                                                     .
E001 c                   endif                                                           .....
      *
      * Sjekk avdeling fra/til
      *
B001 c                   if        nyavd < rhpavf or                                     .....
B001 c                             nyavd > rhpavt                                        .....
 001 c                   goto      neste                                                     .
E001 c                   endif                                                           .....
      *
      * Første gang - ikke test på brudd
      *
B001 c                   if        gmbrd = *zeros                                        .....
 001 c                   eval      gmbrd = nybrd                                             .
 001 c                   eval      gmavdo = nyavdo                                           .
E001 c                   endif                                                           .....
      *
      * Test hele bruddbegrepet - hvis like, summer laveste nivå
      * dersom konto-rekkefølge, nullstill avd i bruddbegrep
      *
B001 c                   if        rhpsrt = 'K'                                          .....
 001 c                   eval      nyavdo = nyavd                                            .
 001 c                   eval      nyavd = *zeros                                            .
E001 c                   endif                                                           .....
      *
B001 c                   if        nybrd = gmbrd                                         .....
 001 c                   exsr      rsum                                                      .
 001 c                   goto      neste                                                     .
E001 c                   endif                                                           .....
      *
     c     brudde        tag
      *
      * Brudd på spesifikasjon
      *
     c                   exsr      brsps
      *
      * Brudd på konto eller LR
      *
B001 c                   if        nykto <> gmkto                                        .....
 001 c                   exsr      brkto                                                     .
X001 c                   else                                                                .
B002 c                   if        *inlr = *on
 002 c                   exsr      brkto                                                     .
E002 c                   endif
E001 c                   endif                                                           .....
      *
      * Brudd på gruppe eller LR
      *
B001 c                   if        nyavd <> gmavd                                        .....
 001 c                             or nygrp <> gmgrp                                     .....
 001 c                   exsr      brgrp                                                     .
X001 c                   else                                                                .
B002 c                   if        *inlr = *on
 002 c                   exsr      brgrp                                                     .
E002 c                   endif
E001 c                   endif                                                           .....
      *
      * Brudd på klasse eller LR
      *
B001 c                   if        nyavd <> gmavd                                        .....
 001 c                             or nykla <> gmkla                                     .....
 001 c                   exsr      brkla                                                     .
X001 c                   else                                                                .
B002 c                   if        *inlr = *on
 002 c                   exsr      brkla                                                     .
E002 c                   endif
E001 c                   endif                                                           .....
      *
      * Brudd på avdeling eller LR - (kun hvis sortert på avdeling)
      *
B001 c                   if        rhpsrt = 'A'                                          .....
B002 c                   if        nyavd <> gmavd                                            .
 002 c                   exsr      bravd                                                     .
X002 c                   else                                                                .
B003 c                   if        *inlr = *on
 003 c                   exsr      bravd                                                     .
E003 c                   endif
E002 c                   endif                                                               .
E001 c                   endif                                                           .....
      *
      * Summer til L1-nivå
      *
B001 c                   if        *in10 = *off
 001 c                   exsr      rsum
E001 c                   endif
      *
      * Flytt nytt brudd-begrep til gammelt
      *
B001 c                   if        *in10 = *off
 001 c                   eval      gmbrd = nybrd
 001 c                   eval      gmavdo = nyavdo
E001 c                   endif
      *
     c     neste         tag
      *
B001 c                   if        *in10 = *on
 001 c                   goto      slutt
E001 c                   endif
      *
     c                   goto      les
      *
     c     slutt         tag
      *
      * Beregn differanser debet/kredit - skriv siste side
      *
     c     lrbevd        add       lrbevk        lrdifp
     c     lrsald        add       lrsalk        lrdifh
      *
     c                   add       1             totsid
      *
     c                   write     skrivt
      *
      /eject
      *
      ****************************************************************
      *   Subrutine for behandling av alle aktuelle recordtyper      *
      ****************************************************************
      *
     c     rsum          begsr
     c                   exsr      hsum
      *
      * Recordtype 1  - saldo
      *
B001 c                   if        wtype = 1                                             .....
 001  *                                                                 .
 001  * Saldo i år                                                      .
 001  *                                                                 .
B002 c                   if        riraar = rhprÅr                                    .....  .
     c                   exsr      hsum
 002 c                   add       bev           l1beÅr                                   .  .
 002 c                   add       sum           l1saÅr                                   .  .
X002 c                   else                                                             .  .
 002  *                                                              .  .
 002  * Saldo i fjor                                                 .  .
 002  *                                                              .  .
B003 c                   if        riraar = prfjo                                         .  .
     c                   exsr      hsum
 003 c                   add       bev           l1befj                                   .  .
 003 c                   add       sum           l1safj                                   .  .
E003 c                   endif                                                            .  .
E002 c                   endif                                                        .....  .
 001  *                                                                 .
E001 c                   endif                                                           .....
      *
      * Recordtype 3  - budsjett
      *
B001 c                   if        wtype = 3                                             .....
 001  *                                                                 .
 001  * Budsjett i år                                                   .
 001  *                                                          .....  .
B002 c                   if        riraar = rhprÅr                                        .  .
     c                   exsr      hsum
 002 c                   add       bev           l1buÅr                                   .  .
 002 c                   add       sum           l1busÅ                                   .  .
X002 c                   else                                                             .  .
 002  *                                                              .  .
 002  * Budsjett i fjor                                              .  .
 002  *                                                              .  .
B003 c                   if        riraar = prfjo                                         .  .
     c                   exsr      hsum
 003 c                   add       bev           l1bufj                                   .  .
 003 c                   add       sum           l1busf                                   .  .
E003 c                   endif                                                            .  .
 002  *                                                              .  .
E002 c                   endif                                                       .....   .
 001  *                                                                 .
E001 c                   endif                                                           .....
      *
      * Recordtype 4  - alternativt budsjett
      *
B001 c                   if        wtype = 4                                             .....
 001  *                                                                 .
 001  * Budsjett i år                                                   .
 001  *                                                                 .
B002 c                   if        riraar = rhprÅr                                    .....  .
     c                   exsr      hsum
 002 c                   add       bev           l1buÅr                                   .  .
 002 c                   add       sum           l1busÅ                                   .  .
X002 c                   else                                                             .  .
 002  *                                                              .  .
 002  * Budsjett i fjor                                              .  .
 002  *                                                              .  .
B003 c                   if        riraar = prfjo                                         .  .
     c                   exsr      hsum
 003 c                   add       bev           l1bufj                                   .  .
 003 c                   add       sum           l1busf                                   .  .
E003 c                   endif                                                            .  .
 002  *                                                              .  .
E002 c                   endif                                                        .....  .
 001  *                                                                 .
E001 c                   endif                                                           .....
      *
      /eject
      *
     c                   endsr
      ****************************************************************
      *   Subrutine for beregning av denne periode og hittil         *
      ****************************************************************
      *
     c     hsum          begsr
      *
     c                   z-add     0             bev
     c                   z-add     0             sum
      *
     c                   z-add     1             n
      *
     c                   add       risa00        sum                            IB
      *
      * Summer periode fra 1 - til denne periode
      *
B001 c                   dou       n > rhpper                                            .....
 001  *                                                                 .
 001 c                   add       sal(n)        sum                                         .
 001  *                                                                 .
 001  * Summer bevegelse for periode fra  - til                         .
 001  *                                                                 .
B002 c                   if        n >= rhppef                                        .....  .
B003 c                   if        n <= rhppet                                            .  .
 003 c                   add       sal(n)        bev                                      .  .
E003 c                   endif                                                            .  .
E002 c                   endif                                                        .....  .
 001  *                                                                 .
 001 c                   add       1             n                                           .
E001 c                   enddo                                                           .....
      *
     c                   endsr
      *
      /eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på spesifikasjon         *
      ****************************************************************
      *
     c     brsps         begsr
      *
     c                   z-add     l1beÅr        l1bevp
     c                   z-add     l1saÅr        l1salh
      *
      * Sammenligning mot budsjett
      *
B001 c                   if        rhpsml = 'B'                                          .....
 001  *                                                                 .
 001 c                   z-add     l1buÅr        l1samp                                      .
 001 c                   z-add     l1busÅ        l1samh                                      .
 001  *                                                                 .
E001 c                   endif                                                           .....
      *
      * Sammenligning mot fjorår
      *
B001 c                   if        rhpsml = 'F'                                          .....
 001  *                                                                 .
 001 c                   z-add     l1befj        l1samp                                      .
 001 c                   z-add     l1safj        l1samh                                      .
 001  *                                                                 .
E001 c                   endif                                                           .....
      *
      * Sammenligning mot gjennomsnitt
      *
B001 c                   if        rhpsml = 'G'                                          .....
 001  *                                                                 .
 001 c     l1salh        div(h)    rhpper        l1samp                                      .
 001 c                   z-add     l1salh        l1samh                                      .
E001 c                   endif                                                           .....
      *
      * Beregn differanser
      *
     c     l1bevp        sub       l1samp        difp
     c     l1salh        sub       l1samh        difh
      *
      * Beregn brukt/oppnådd
      *
B001 c                   if        rhpavv = 'P'                                          .....
 001 c                   z-add     l1samp        samp                                        .
 001 c                   z-add     l1samh        samh                                        .
 001 c                   exsr      brukt                                                     .
E001 c                   endif                                                           .....
      *
      * Adder til neste nivå
      *
     c                   add       l1bevp        l2bevp
     c                   add       l1salh        l2salh
     c                   add       l1samp        l2samp
     c                   add       l1samh        l2samh
      *
      * Summer for siste side
      *
B001 c                   if        l1bevp > *zero                                        .....
 001 c                   add       l1bevp        lrbevd                                      .
X001 c                   else                                                                .
 001 c                   add       l1bevp        lrbevk                                      .
E001 c                   endif                                                           .....
      *
B001 c                   if        l1salh > *zero                                        .....
 001 c                   add       l1salh        lrsald                                      .
X001 c                   else                                                                .
 001 c                   add       l1salh        lrsalk                                      .
E001 c                   endif                                                           .....
      *
      * Hent tekstrecord fra kontoplan-register
      *
     c                   move      gmkto         p_kont
     c                   move      gmsps         p_spes
     c                   move      gmavdo        p_avde
      *
 001 c                   call      'RS740R'                                      gruppe-
     c                   parm                    p_stat
     c                   parm                    p_kont
     c                   parm                    p_spes
     c                   parm                    p_avde
     c                   parm                    p_text
      *
 001 c                   move      p_text        wtext                                    .  .
      *
      * Test om alle beløpsfelt = 0
      *
B001 c                   if        l1salh = *zeros and                                   .....
B002 c                             l1bevp = *zeros and                                       .
B003 c                             l1samh = *zeros and                                       .
B004 c                             l1samp = *zeros                                           .
 004 c                   goto      l1null                                                    .
E004 c                   endif                                                               .
      *
      * Skriv linje
      *
     c                   add       1             totkto
     c                   add       1             antsps
     c                   add       1             antkto
      *
B001 c   30              do                                                              .....
 001 c                   exsr      skriv                                                     .
 001 c                   eval      *in30 = *off                                              .
E001 c                   enddo                                                           .....
      *
     c                   write     skriv1
      *
      * Nullstill arbeidsfelt på L1-nivå
      *
     c     l1null        tag
      *
     c                   eval      l1bevp = *zeros
     c                   eval      l1salh = *zeros
     c                   eval      l1samp = *zeros
     c                   eval      l1samh = *zeros
      *
     c                   eval      l1beÅr = *zeros
     c                   eval      l1befj = *zeros
      *
     c                   eval      l1buÅr = *zeros
     c                   eval      l1bufj = *zeros
      *
     c                   eval      l1saÅr = *zeros
     c                   eval      l1safj = *zeros
      *
     c                   eval      l1busÅ = *zeros
     c                   eval      l1busf = *zeros
      *
     c                   endsr
      *
      /eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på konto                 *
      ****************************************************************
      *
     c     brkto         begsr
      *
      * Beregn differanser
      *
     c     l2bevp        sub       l2samp        difp
     c     l2salh        sub       l2samh        difh
      *
      * Beregn brukt/oppnådd
      *
B001 c                   if        rhpavv = 'P'                                          .....
 001 c                   z-add     l2samp        samp                                        .
 001 c                   z-add     l2samh        samh                                        .
 001 c                   exsr      brukt                                                     .
E001 c                   endif                                                           .....
      *
      * Test om linjen skal skrives
      *
B001 c                   if        antsps > 1                                            .....
 001  *                                                                 .
 001  * Test om alle beløpsfelt = 0                                     .
 001  *                                                                 .
B002 c                   if        l2salh = *zeros and                                .....  .
B003 c                             l2bevp = *zeros and                                    .  .
B004 c                             l2samh = *zeros and                                    .  .
B005 c                             l2samp = *zeros                                        .  .
 005 c                   goto      l2null                                                 .  .
E005 c                   endif                                                            .  .
 001  *                                                                 .
B002 c   30              do                                                           .....  .
 002 c                   exsr      skriv                                                  .  .
 001 c                   eval      *in30 = *off                                              .
E002 c                   enddo                                                        .....  .
 001  *
 001 c                   add       1             antkto                                      .
 001 c                   write     skriv2                                                    .
 001  *                                                                 .
E001 c                   endif                                                           .....
      *
      * Adder til neste nivå
      *
     c                   add       l2bevp        l3bevp
     c                   add       l2salh        l3salh
     c                   add       l2samp        l3samp
     c                   add       l2samh        l3samh
      *
      * Nullstill arbeidsfelt på L2-nivå
      *
     c     l2null        tag
      *
     c                   eval      antsps = *zeros
     c                   eval      l2bevp = *zeros
     c                   eval      l2salh = *zeros
     c                   eval      l2samp = *zeros
     c                   eval      l2samh = *zeros
      *
     c                   endsr
      *
      /eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på kontogruppe           *
      ****************************************************************
      *
     c     brgrp         begsr
      *
      * Kontogruppe skrives bare hvis minst en konto er skrevet
      *
B001 c                   if        antkto > *zeros                                       .....
 001  *                                                                 .
 001  * Beregn differanser                                              .
 001  *                                                                 .
 001 c     l3bevp        sub       l3samp        difp                                        .
 001 c     l3salh        sub       l3samh        difh                                        .
 001  *                                                                 .
 001  * Beregn brukt/oppnådd
 001  *                                                                 .
B002 c                   if        rhpavv = 'P'                                       .....  .
 002 c                   z-add     l3samp        samp                                     .  .
 002 c                   z-add     l3samh        samh                                     .  .
 002 c                   exsr      brukt                                                  .  .
E002 c                   endif                                                        .....  .
 001  *                                                                 .
 001  * Hent gruppe-tekst fra koderegisteret                            .
 001  *                                                                 .
 001 c                   move      gmgrp         p_tkod                                      .
 001  *                                                                 .
 001 c                   call      'RS720R'                                      gruppe-
     c                   parm                    p_stat
     c                   parm                    p_tkod
     c                   parm                    p_ttxt
 001  *                                                                 .
 002 c                   movel     p_ttxt        grtext                           ikke
 001  *                                                                 .
 001  * Test om linjen skal skrives                                     .
 001  *                                                                 .
B002 c                   if        rhpkgs = 'J'                                       .....  .
 002  *                                                              .  .
B003 c   30              do                                                               .  .
 003 c                   exsr      skriv                                                  .  .
 001 c                   eval      *in30 = *off                                              .
E003 c                   enddo                                                            .  .
 002  *                                                              .  .
 002 c                   write     skriv3                                                 .  .
E002 c                   endif                                                        .....  .
 001  *                                                                 .
E001 c                   endif                                                           .....
      *
      * Adder til neste nivå
      *
     c                   add       l3bevp        l4bevp
     c                   add       l3salh        l4salh
     c                   add       l3samp        l4samp
     c                   add       l3samh        l4samh
      *
      * Nullstill arbeidsfelt på L3-nivå
      *
     c     l3null        tag
      *
     c                   eval      antkto = *zeros
     c                   eval      l3bevp = *zeros
     c                   eval      l3salh = *zeros
     c                   eval      l3samp = *zeros
     c                   eval      l3samh = *zeros
      *
     c                   endsr
      *
      /eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på lontoklasse           *
      ****************************************************************
      *
     c     brkla         begsr
      *
      * Beregn differanser
      *
     c     l4bevp        sub       l4samp        difp
     c     l4salh        sub       l4samh        difh
      *
      * Beregn brukt/oppnådd
      *
B001 c                   if        rhpavv = 'P'                                          .....
 001 c                   z-add     l4samp        samp                                        .
 001 c                   z-add     l4samh        samh                                        .
 001 c                   exsr      brukt                                                     .
E001 c                   endif                                                           .....
      *
      * Hent klasse-tekst fra koderegisteret
      *
     c                   move      gmkla         p_skod
      *
     c                   call      'RS719R'                                      klasse-
     c                   parm                    p_stat
     c                   parm                    p_skod
     c                   parm                    p_stxt
      *
 001 c                   movel     p_stxt        kltext
      *
      * Test om linjen skal skrives
      *
B001 c                   if        rhpkks = 'J'                                          .....
 001  *                                                                 .
B002 c   30              do                                                                  .
 002 c                   exsr      skriv                                                     .
 001 c                   eval      *in30 = *off                                              .
E002 c                   enddo                                                               .
 001  *                                                                 .
 001 c                   write     skriv4                                                    .
E001 c                   endif                                                           .....
      *
      * Adder til neste nivå
      *
     c                   add       l4bevp        l5bevp
     c                   add       l4salh        l5salh
     c                   add       l4samp        l5samp
     c                   add       l4samh        l5samh
      *
      * Nullstill arbeidsfelt på L4-nivå
      *
     c     l4null        tag
      *
     c                   eval      l4bevp = *zeros
     c                   eval      l4salh = *zeros
     c                   eval      l4samp = *zeros
     c                   eval      l4samh = *zeros
      *
     c                   endsr
      *
      /eject
      *
      ****************************************************************
      *   Subrutine for beregning ved brudd på avdeling              *
      ****************************************************************
      *
     c     bravd         begsr
      *
      * Beregn differanser
      *
     c     l5bevp        sub       l5samp        difp
     c     l5salh        sub       l5samh        difh
      *
      * Beregn brukt/oppnådd
      *
B001 c                   if        rhpavv = 'P'                                          .....
 001 c                   z-add     l5samp        samp                                        .
 001 c                   z-add     l5samh        samh                                        .
 001 c                   exsr      brukt                                                     .
E001 c                   endif                                                           .....
      *
      * Hent avdelingstekst fra koderegisteret
      *
     c                   move      gmavd         p_gkod
      *
     c                   call      'RS707R'                                      avdelings-
     c                   parm                    p_stat
     c                   parm                    p_gkod
     c                   parm                    p_gtxt
      *
 001 c                   move      p_gkod        avgkod
 001 c                   move      p_gtxt        avtext
      *
      * Skriv heading og linje
      *
B001 c   30              do                                                              .....
 001 c                   exsr      skriv                                                     .
 001 c                   eval      *in30 = *off                                              .
E001 c                   enddo                                                           .....
      *
     c                   write     skriv5
      *
      * Hent ny avdelingstekst fra koderegisteret og skriv ny heading
      *
B001 c  n10              do                                                              .....
 001  *                                                                 .
     c                   move      nyavd         p_gkod
      *
     c                   call      'RS707R'                                      avdelings-
     c                   parm                    p_stat
     c                   parm                    p_gkod
     c                   parm                    p_gtxt
      *
 001 c                   move      p_gkod        avgkod
 001 c                   move      p_gtxt        avtext
 001  *                                                                 .
 001 c                   exsr      skriv                                                     .
 001  *                                                                 .
E001 c                   enddo                                                           .....
      *
      * Nullstill arbeidsfelt på L5-nivå
      *
     c     l5null        tag
      *
     c                   eval      l5bevp = *zeros
     c                   eval      l5salh = *zeros
     c                   eval      l5samp = *zeros
     c                   eval      l5samh = *zeros
      *
     c                   endsr
      *
      /eject
      *
      ****************************************************************
      *   Subrutine for feregning av brukt/oppnådd                   *
      ****************************************************************
      *
     c     brukt         begsr
      *
      * Denne periode
      *
     c                   eval      *in16 = *off
     c                   eval      *in17 = *off
B001 c                   if        samp <> *zero                                         .....
 001 c     difp          div(h)    samp          wpro1                                       .
 001 c     wpro1         mult(h)   100           prop                                        .
 001 c                   add       100           prop                                        .
 001  *                                                                 .
X001 c                   else                                                                .
 001  *                                                                 .
B002 c                   if        difp <> *zero                                      .....  .
 002 c                   eval      *in16 = *on                                            .  .
X002 c                   else                                                             .  .
 002 c                   z-add     100           prop                                     .  .
E002 c                   endif                                                        .....  .
 001  *                                                                 .
E001 c                   endif                                                           .....
      *
      * Hittil
      *
B001 c                   if        samh <> *zero                                         .....
 001  *                                                                 .
 001 c     difh          div(h)    samh          wpro1                                       .
 001 c     wpro1         mult(h)   100           proh                                        .
 001 c                   add       100           proh                                        .
 001  *                                                                 .
X001 c                   else                                                                .
 001  *                                                                 .
B002 c                   if        difh <> *zero                                      .....  .
 002 c                   eval      *in17 = *on                                            .  .
X002 c                   else                                                             .  .
 002 c                   z-add     100           proh                                     .  .
E002 c                   endif                                                        .....  .
 001  *                                                                 .
E001 c                   endif                                                           .....
      *
     c                   endsr
      *
      ****************************************************************
      *   Subrutine for å skrive heading                             *
      ****************************************************************
      *
     c     skriv         begsr
      *
     c                   add       1             totsid
     c                   write     head1
     c                   write     head3
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
     c                   eval      totkto = *zeros
      *
     c                   eval      risa01 = *zeros
      *
      * Behandle parameter
      *
     c     rhprÅr        sub       1             prfjo
      *
B001 c                   if        rhpsml = 'B'                                          .....
 001 c                   eval      *in11 = *on                                               .
E001 c                   endif                                                           .....
      *
B001 c                   if        rhpsml = 'F'                                          .....
 001 c                   eval      *in12 = *on                                               .
E001 c                   endif                                                           .....
      *
B001 c                   if        rhpsml = 'G'                                          .....
 001 c                   eval      *in13 = *on                                               .
E001 c                   endif                                                           .....
      *
B001 c                   if        rhpavv = 'D'                                          .....
 001 c                   eval      *in14 = *on                                               .
E001 c                   endif                                                           .....
      *
B001 c                   if        rhpavv = 'P'                                          .....
 001 c                   eval      *in15 = *on                                               .
E001 c                   endif                                                           .....
      *
B001 c                   if        rhpsrt = 'A'                                          .....
 001 c                   eval      *in18 = *on                                               .
E001 c                   endif                                                           .....
      *
B001 c                   if        rhppef <> rhppet                                      .....
 001 c                   eval      *in19 = *on                                               .
E001 c                   endif                                                           .....
      *
      * Sett startverdier
      *
     c                   eval      nybrd = *zeros
     c                   eval      nyavdo = *zeros
     c                   eval      gmbrd = *zeros
     c                   eval      gmavdo = *zeros
      *
     c                   eval      w_firm = l_firm
      *
B001 c                   if        rhpsrt = 'K'                                          .....
 001 c     rikey1        setll     rhsal1r                                                   .
 001  *                                                                 .
X001 c                   else                                                                .
 001  *                                                                 .
 001 c                   move      rhpavf        riavde                                      .
 001 c     rikey2        setll     rhsal2r                                                   .
E001 c                   endif                                                           .....
      *
      * Hent avdelingstekst fra koderegisteret
      *
     c                   move      rhpavf        p_gkod
      *
     c                   call      'RS707R'                                      avdelings-
     c                   parm                    p_stat
     c                   parm                    p_gkod
     c                   parm                    p_gtxt
      *
 001 c                   move      p_gkod        avgkod
 001 c                   move      p_gtxt        avtext
      *
      * Skriv heading på første side
      *
     c                   write     head1
      *
     c                   z-add     1             totsid
     c                   eval      antkto = *zeros
     c                   eval      antsps = *zeros
      *
     c                   write     head3
      *
      * Key for SALDOREGISTER - KONTO
      *
     c     rikey1        klist
     c                   kfld                    w_firm
     c                   kfld                    rikont
     c                   kfld                    rispes
     c                   kfld                    riavde
     c                   kfld                    riraar
     c                   kfld                    ritype
      *
      * Key for SALDOREGISTER - AVDELING
      *
     c     rikey2        klist
     c                   kfld                    w_firm
     c                   kfld                    riavde
     c                   kfld                    rikont
     c                   kfld                    rispes
     c                   kfld                    riraar
     c                   kfld                    ritype
      *
     c                   endsr
