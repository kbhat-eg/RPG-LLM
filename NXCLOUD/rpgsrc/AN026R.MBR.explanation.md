# AN025R Program Documentation

## Purpose

The `AN025R` program is responsible for processing entries from a system file (likely a registry of libraries or objects) to determine which libraries should be included in a backup operation. For each qualifying entry, it invokes a CL program (`AN025C`) to perform the backup, passing relevant parameters.

This program is typically run as part of a broader system backup process, and is designed to support both data and program libraries (see historical comments regarding save file handling).

---

## File and Data Definitions

- **File Declaration**
  - `asysl1` is declared as an externally-described file with a key, renamed record format to `asysl1r`. This file contains the system register entries to be processed.

- **Variables**
  - `p_savf` (1 char): Save file indicator/parameter. Historically set to blank for program libraries, but recent changes allow for save file use with all library types.
  - `asysl1_syst`: Used as the key field for reading the system file; typed like field `assyst`.
  - `w_bibl`: Working variable to hold the library name; typed like `assyst`.

---

## Main Processing Flow

### Initialization

- Both `w_bibl` and `asysl1_syst` are initialized to blank.
- The file is positioned to the start using `setll` with the key `asysl1_key` (which is based on `asysl1_syst`).
- The first record is read.

### Main Loop

- The program iterates through the `asysl1` file until EOF (`*in62 = *on`).
- For each record:
  - It checks if `asskod = 'B'`. This field likely flags records that should be included in the backup (e.g., 'B' for "Backup").
  - If so:
    - The library name (`assyst`) is copied to `w_bibl`.
    - The CL program `AN025C` is called with two parameters: `p_savf` and `w_bibl`.
      - `p_savf`: Current save file indicator (its value is set in the *INZSR subroutine).
      - `w_bibl`: The library to be backed up.
- The loop continues until all records are processed.

### Program Termination

- The LR indicator (`*inlr`) is set to `*on` to close files and end the program.

---

## Subroutines

### *INZSR (Initialization Subroutine)

- Sets `p_savf` to blank. This is a default; the value may be interpreted by `AN025C` to determine whether to use a save file.
- Defines the key list `asysl1_key` for file access, containing `asysl1_syst`.
- Defines the program's entry parameter list, accepting `p_savf` as an input parameter.

---

## Special Considerations & Design Notes

- **Save File Handling:**  
  Historical comments clarify that previously, program libraries could not be backed up via save files, so `p_savf` was set to blank. This restriction was lifted (see version 6.11 comments), so the code is now written to support both data and program libraries for backup via save file.

- **Modular Design:**  
  The actual backup logic is delegated to the CL program `AN025C`, keeping this RPG program focused on file processing and orchestration. This separation supports easier maintenance and allows backup logic to evolve independently.

- **Keyed Access:**  
  The program uses a keyed logical file for efficient processing, starting at a specific key value (though initially blank), which could support partial processing if needed.

- **Parameter Passing:**  
  The program is designed to be called with a parameter (`p_savf`), allowing external control over the save file behavior.

---

## External Dependencies

- **File `asysl1`:**  
  Contains the list of libraries or system entries to be considered for backup. The structure must include at least the fields `assyst` (library name) and `asskod` (flag for backup).

- **CL Program `AN025C`:**  
  Receives `p_savf` and `w_bibl` as parameters and performs the actual backup operation.

---

## Business/Domain Logic

- Only records marked with `asskod = 'B'` are eligible for backup. This field is central to the programâ€™s filtering logic.
- The program is designed to be run as part of a system backup procedure, ensuring all relevant libraries (as marked in the system file) are processed for backup.
- Changes in save file handling reflect evolving operational requirements; ensure that any changes in backup policy are reflected in the values passed to `p_savf` and the logic in `AN025C`.

---

## Conventions and Patterns

- **Versioned Comments:**  
  The codebase uses structured comments to track changes and rationale, which is important for understanding why certain logic exists (e.g., save file handling).
- **Separation of Concerns:**  
  The RPG program is responsible for orchestration, while the actual backup is handled externally.
- **Parameterization:**  
  Entry parameters and externalized backup logic allow flexibility and reuse.

---

## Summary

`AN025R` is a key orchestration program for the system backup process, scanning a registry of libraries and invoking a backup operation for each eligible entry. It is designed with flexibility, modularity, and maintainability in mind, and interacts closely with the system file `asysl1` and the CL backup program `AN025C`.