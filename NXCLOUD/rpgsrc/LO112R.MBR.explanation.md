# Program Documentation: LO112R (ASLAGR)

## Overview

**Program:** LO112R  
**System:** ASLAGR  
**Purpose:**  
This program is responsible for moving a parameter record from one member in a source register (`PLUKK-1-LINJE-REGISTER`) to a new member in a target register (`PLUKK-2-LINJE-REGISTER`). This is typically part of a batch or job-queue process for handling printout jobs or similar batch operations.

The logic ensures that only records relevant to the current workstation and user are processed, and it handles the transition of records between registers, including the deletion of the source record after a successful move.

---

## File Definitions

- **LPM1L1**: Input Primary file, keyed, referencing `LPM1PFR`, record format renamed to `LPM1L1R`.
- **LPM1LU**: Update file, keyed, referencing `LPM1PFR`, record format renamed to `LPM1LUR`.
- **LPM2LU**: Update file, keyed, referencing `LPM2PFR`, record format renamed to `LPM2LUR`.

**Note:** The files represent two line registers (PLUKK-1 and PLUKK-2) and are used for staging and processing batch records.

---

## Data Structures

### Work Fields

- **LDAMBR**: 10A, Member name (for file/member naming in dynamic processing)
- **LDABOK**: 1A, Book identifier (used when forming member names)
- **LDAFIR**: 3P0, Company or firm number
- **LDALST**: 6P0, Last number (likely used for last processed/order number)

### User Data Section

- **LDVLG1, LDVLG2, LDVLG3**: Control flags/fields for inter-program communication or CL process signaling.
- **LDMEMB**: Target member name for new processing.
- **DSWSID, DSUSER**: Workstation ID and user ID for filtering relevant records.

---

## Key Lists

- **PM1KEY**: Composite key for `PLUKK-1-LINJE-REGISTER` (Company, Workstation, User, Last Number)
- **PM2KEY**: Key for `PLUKK-2-LINJE-REGISTER` (Company)

---

## Main Processing Logic

### Initialization

- **INZSR Subroutine**:  
  - Resets key work fields (`WCQNNN`, `WCNUMM`).
  - Defines key field relationships for file operations.
  - Sets up key lists for both source and target files.

### Record Processing

#### 1. **Pre-processing and Filtering**

- **Reset Control Fields:**  
  - `LDVLG1`, `LDVLG2` set to zero; `LDMEMB` blanked.
- **Record Existence Check:**  
  - If the primary input record is not found (`*IN01 = *OFF`), the program jumps to the end.
- **Workstation/User Filtering:**  
  - Only processes records matching the current workstation (`DSWSID`) and user (`DSUSER`).

#### 2. **Parameter Transfer Logic**

- **Set Start Flag:**  
  - `LDVLG1` set to 1 to indicate the routine should start `LOORDC`.
- **Batch Queue Check:**  
  - If `LK1VG0` equals 2, set `LDVLG1` to 2 to indicate job should run from a job queue.
- **Copy Record:**  
  - Data from the current record in PLUKK-1 is moved to the corresponding fields in PLUKK-2.
  - If the target record does not exist, it is written to PLUKK-2.

#### 3. **Source Record Deletion**

- **Delete Original Record:**  
  - After a successful move, the original record in PLUKK-1 is deleted to prevent duplicate processing.

#### 4. **Batch Continuation Logic**

- **Multiple Runs Check:**  
  - If the order number (`LK1ONR`) is zero, the logic assumes multiple orders will be processed.
  - Calls program `LØ900R` to retrieve the last number for the file/member.
  - Prepares new member name and sets flags to indicate the process should repeat for the next batch.

#### 5. **Program Termination**

- **Set LR:**  
  - Sets the Last Record indicator to terminate the program after processing.
- **End Label (`XSLUTT`):**  
  - Provides a clean exit point for the program.

---

## Business/Domain-Specific Notes

- **Registers (`PLUKK-1`, `PLUKK-2`):**  
  These likely represent staging areas for batch or print processing, where records are first prepared in one register and then moved to another for further processing or output.

- **Member Handling:**  
  The use of member names and dynamic member creation suggests that each batch/job or user session may get a unique member for isolation or performance.

- **Job Queue Processing:**  
  The flags (`LDVLG1`, `LDVLG2`, `LDVLG3`) are used to signal to controlling CL or other programs whether to start a new job, continue processing, or handle job queue logic.

- **Workstation/User Filtering:**  
  Ensures that only records relevant to the current session are processed, supporting multi-user or multi-session batch operations.

---

## Relationships and Interactions

- **External Program Call (`LØ900R`):**  
  Used to retrieve the last number for a file/member, likely for sequencing or batching control.
- **CL Integration:**  
  Several fields are explicitly mentioned as being used in CL procedures, indicating tight integration with job control scripts.
- **File/member naming conventions:**  
  The logic for forming member names is domain-specific and must be followed for correct operation.

---

## Conventions and Design Patterns

- **Key List Usage:**  
  Key lists (`KLIST`, `KFLD`) are used for composite key management, a common pattern in this codebase.
- **Record Move/Delete Pattern:**  
  The program consistently moves records from source to target and deletes the source, ensuring no duplicates and single ownership of records.
- **Flag Fields for Inter-Program Communication:**  
  Control fields are used to communicate state and instructions to CL or other RPG programs in the batch chain.

---

## Summary

LO112R is a utility program for moving parameter records between two register files, with logic for filtering based on workstation and user, handling batch job sequencing, and ensuring clean transitions between processing stages. It relies on a set of conventions for key management, file/member naming, and inter-program signaling, and is tightly integrated into a broader batch or print-processing workflow.