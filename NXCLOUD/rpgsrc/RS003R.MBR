      /TITLE  ASOKON: Kontroll av sist brukte kontaktpersonnummer
     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  System. . . . . : ASOKON                                       *
      *  Program . . . . : RS003R                                       *
      *  Beskrivelse . . : Henter sist brukte kontaktpersonnummer       *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Spesialversjon. :                                              *
      *  Tilpasset for . :                                              *
      *                                                                 *
      *  Referanse  Dato   Endringsbeskrivelse                     Sign.*
      *  --------- ------  ---------------------------------------------*
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     fraa4l1    if   e           k disk    rename(raa4pfr:raa4l1r)
     fraa4lu    uf   e           k disk    rename(raa4pfr:raa4lur)
     frukpl2    if   e           k disk    rename(rukppfr:rukpl2r)
      *
     d p_retk          s              1
     d p_4pnr          s                   like(ra4pnr)
     d w_firm          s                   like(ra4fir)
     d w_test          s                   like(p_retk)
     d w_4pnr          s                   like(ra4pnr)
     d w_kpnr          s                   like(rukpnr)
      *
     d rukpl2_kpnr     s                   like(rukpnr)
     d raa4l1_4aar     s                   like(ra4aar)
     d raa4lu_4aar     s                   like(ra4aar)
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Hent sist brukte kpnrenummer fra koderegister                  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c                   move      p_retk        w_test
     c                   eval      p_retk = *blank
      *
     c                   eval      raa4l1_4aar = 0                                           .
     c     raa4l1_key    chain     raa4l1r                            90
      *
      * Nei: Legger inn kode for ikke funnet
      *
     c                   if        *in90 = *on                                           .....
     c                   move      'N'           p_retk                                      .
     c                   goto      xslutt                                                    .
     c                   endif                                                           .....
      *
      * Ja:  Oppdaterer sist brukte nummer
      *
     c                   if        w_test = *blank                                       .....
     c                   eval      w_4pnr = ra4pnr + 1                                       .
     c                   endif                                                           .....
      *
     c                   if        w_test = 'S'                                          .....
     c                             and p_4pnr = ra4pnr                                       .
     c                   eval      w_4pnr = ra4pnr - 1                                       .
     c                   endif                                                           .....
      *
     c                   if        w_test = 'K'                                          .....
     c                   eval      w_4pnr = p_4pnr                                           .
     c                   endif                                                           .....
      *
      * Sjekker om sist brukte kontaktpersonnummer finnes
      * i kontaktpersonregisteret - hvis ja, finn neste ledige              neste ledig.
      *
     c                   eval      w_kpnr = w_4pnr
      *
     c     finnes        tag
      *
     c                   eval      rukpl2_kpnr = w_kpnr
     c     rukpl2_key    chain     rukpl2r                            90
     c                   if        *in90 = *off                                          .....
     c                   eval      w_kpnr = w_kpnr + 1                                       .
     c                   goto      finnes                                                    .
     c                   endif                                                           .....
      *
      * Oppdater sist bruket kontaktpersonnummer
      *
     c                   eval      raa4lu_4aar = 0                                           .
     c     raa4lu_key    chain     raa4lur                            90
      *
     c                   if        *in90 = *off                                          .....
      *
     c                   if        w_kpnr > ra4pnr                                       .....
     c                   eval      ra4pnr = w_kpnr                                           .
     c                   endif                                                           .....
      *
     c                   if        w_test = 'S'                                          .....
     c                             and p_4pnr = ra4pnr                                       .
     c                   eval      ra4pnr = w_4pnr                                           .
     c                   endif                                                           .....
      *
     c                   update    raa4lur                                                   .
     c                   endif                                                           .....
      *
     c                   eval      p_4pnr = ra4pnr                                           .
     c                   eval      p_retk = ' '
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Avslutt program                                                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Subrutine for initiering av program                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      *  Tar inn parameter fra forrige program
      *
     c     *entry        plist
     c                   parm                    p_retk
     c                   parm                    w_firm
     c                   parm                    p_4pnr
      *
      *
      * Key for statuskode 1
      *
     c     raa1l1_key    klist
     c                   kfld                    w_firm
      *
      * Key for statuskode 4
      *
     c     raa4l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    raa4l1_4aar
      *
      * Key for statuskode 4
      *
     c     raa4lu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    raa4lu_4aar
      *
      * Key for kontaktpersonregister
      *
     c     rukpl2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rukpl2_kpnr
      *
     c                   endsr
