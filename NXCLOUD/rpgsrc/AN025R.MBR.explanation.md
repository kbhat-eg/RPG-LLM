# Program Overview

**Program Name:** AN025R  
**Primary Purpose:** Reads and processes file groups for backup. This program also includes environment-based logic for selecting which databases to include in the backup, rather than relying on a single, fixed library.

---

## Key Points

1. **Parameterized Save Method**  
   - The program accepts one parameter, `p_savf`, indicating whether save files should be used:  
     - `0`: No save files.  
     - `1`: Use save files.  

2. **Immediate Library Backups**  
   - Two libraries, `ADB` and `QS36F`, are saved unconditionally at the start of the program.  
   - In each case, the program calls the CL program `AN025C` and passes along the parameter `p_savf` plus the library name to be backed up.

3. **File Group Backup (Commented Out in This Version)**  
   - The code includes references (currently commented) to read file groups from a file named `AFILL1`.  
   - For each record, the logic would build a backup library name and call `AN025C`.  
   - These lines have been commented out (marked with `***`), indicating the file group approach may no longer be active or may require specific conditions to operate.

4. **Environment-Based Backup**  
   - The program then reads from another file, referenced as `AMILL1` (renamed from `AMILPFR` via `rename`), which corresponds to an environment list.  
   - Each environment value (`ARMILJ`) identifies which databases should be included in the backup for that environment.  
   - For each non-blank environment entry, the program calls a second CL program, `AN027C`, passing two parameters:  
     - `p_savf` (the same “use save file” indicator)  
     - `ARMILJ` (the environment identifier)

5. **CL Program Interactions**  
   - **AN025C**: Handles the backup of a single library. Decides whether to create and use a save file based on `p_savf`.  
   - **AN027C**: Handles environment-based backups. The program passes in the environment ID to process multiple environment-specific libraries.

6. **Program Termination**  
   - Once all libraries and environments have been processed, the program sets `*INLR` to `*ON`, signaling normal termination.

---

## Notes on Design Decisions

- **Multiple Backup Sources**  
  While `ADB` and `QS36F` are always saved, additional backups may come from reading environment-specific files. This modular approach allows different environments to maintain separate lists of databases while still leveraging a common backup routine.
  
- **Commented Logic for File Group Backup**  
  The original intention to read file groups from `AFILL1` (checking `AGBACK` and `AGFGRP`) is commented out. This suggests either a phased-out approach or a reserved feature that can be re-enabled if needed.

- **Renaming With `rename(amilpfr:amill1r)`**  
  This rename indicates the file format or record format from `AMILPFR` is referenced within the program as `AMILL1R`. It’s part of a convention in this codebase to unify file naming patterns when dealing with multi-environment logic.

- **Parameter `p_savf`**  
  Centralizing the decision to use or not use save files makes the entire backup process flexible. Individual calls to CL modules do not duplicate logic regarding the type of backup medium.

---

## Interactions with Other Modules and Data Sources

- **CL Programs**  
  - `AN025C`: Invoked for each library, with parameters for the save-file decision and the target library name.  
  - `AN027C`: Invoked for each relevant environment (using the environment identifier).

- **Files Read by the Program**  
  - `AMILL1` (`AMILPFR` / `AMILL1R`): Environment file containing information about which databases to back up.  
  - (Commented) `AFILL1`: Would be used for file group backup logic if uncommented.

---

## Flow Summary

1. Initialize variables, especially the flag (`p_savf`) indicating save-file usage.  
2. Immediately back up the fixed libraries `ADB` and `QS36F` via `AN025C`.  
3. (Commented) Optionally read file groups from `AFILL1` and back them up using `AN025C`.  
4. Read environment records from `AMILL1`:  
   - For each non-blank environment, call `AN027C` to process environment-specific backup.  
5. End the program execution (`*INLR = *ON`).