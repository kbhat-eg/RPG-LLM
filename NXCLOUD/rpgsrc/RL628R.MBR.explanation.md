# RPG Program Overview: RL628R - "Utskrift av Leverandørregister - parameter"
This ILE RPG program is designed for use on IBM i (AS/400) systems to handle the parameter entry and validation for generating supplier (leverandør) register printouts. It appears to be the front-end parameter validation and setup for a larger supplier listing or reporting system.

The documentation and comments are in Norwegian. Below is a structured explanation, with special care to help onboarding developers understand the different program sections, variables, and logic.

---

## 1. Program Metadata and Documentation

The title and comment block at the top give useful metadata:
- **RL628R:** The name of the program.
- **Description:** Handles parameters for printing the supplier register.
- **Change Notes:** Lists changes with version and author.
- **Indicator Use:** Explains which indicators (`*INnn`) are used for what (e.g., error flags, subroutine markers, file status, etc.).

---

## 2. File Declarations

```rpg
fausrl1    if   e           k disk
frl628d    cf   e             workstn
```
- **ausrl1:** Disk file, keyed, input file (likely user or authority master).
- **rl628d:** Workstation file (display file, probably with the main parameter entry screen).

---

## 3. Variable and Data Structure Declarations

### Standalone Fields
- Various single-value, user, and company fields, e.g. `wpakod`, `wpdat1`, `w_firm`, `w_user`.

### Parameter Data Structure
This large block is a parameter "record" (structure), including:
- **pdato, paarf, paart, pperf, ppert:** Date and period parameters.
- **pavdf/t, pkatf/t, pself/t, plnrf/t, lev:** From-to ranges for department, category, salesperson, number, and a 10-element array for specific suppliers.
- **pdisf/t:** District from/to.
- **plagf/t:** Warehouse from/to.
- **psagr, psabe, pktid, pktdg, pkgrn, pedat:** Status flags and limits (balance, credit check, dates).
- **pnota, pkper, ptlf, pkomp, psald, pkjop:** Output formatting options.
- **pkats, pavds, psels, psort:** Sorting options.
- **petik, ptype, prabk, ppsla, pssal:** Label type, list type, discount categories, etc.
- **l_wsid, l_user, l_firm, l_fnav:** User/company info.

Some are marked with version/E-level indicators (e.g., `E5.40`, `NAS01`, `EAS01`) for feature tracking.

---

## 4. Main Program Logic

### a. Tags/Labels for Flow Control

E.g., `dummy tag`, `a2taga tag`, `xslutt tag`.

---

### b. Screen Handling

```rpg
c                   exfmt     a2bld
```
Displays and processes the `a2bld` format (from display file) for parameter entry.

---

### c. Resetting Error Indicators

After screen input, error flags (*IN31-*IN48) are reset to *OFF, clearing out prior validation errors.

---

### d. User Actions & Validation

1. **Exit (F3):**
   ```rpg
   c                   if        *inkc = *on
   c                   move      '1'           p_in03
   c                   goto      xslutt
   c                   endif
   ```
   - If F3 (exit) pressed, set exit flag and go to program end.

2. **Date Validation:**
   - If the entered date is zero, set it to current date.
   - Use `test(d)` to validate date format; if invalid, set error indicator and re-display screen.

3. **Range Validations:**
   - For each "from" and "to" field (supplier number, department, category, district), check that "from" is not greater than "to".
   - If error, set the corresponding indicator, go back to screen entry.

4. **Special Field Validations:**
   - For "notater" (notes) and sorting options: Only allow 'J' (yes) or blank (' ').

---

### e. Parameter Assignment

After validation, move screen fields to the parameter data structure, e.g.:
```rpg
c                   move      a2plnf        plnrf
...
c                   move      a2psrt        psort
```
Many fields are commented out—possibly unused or only populated for specific reports/features.

---

### f. Program End Handling

```rpg
c     xslutt        tag
c                   eval      *inlr = *on
c                   return
```
- Standard RPG program exit (sets LR indicator to close files and return).

---

## 5. Initialization Subroutine (`*inzsr`)

Runs at program start:
- Sets up local variables, ranges (e.g., "from" = 0, "to" = 999...).
- Loads user/company info from passed parameters.
- Loads user record from disk file (`ausrl1`) via a keyed chain to get authority/department (if required).
- Handles department protection: if user is limited to a department, sets both "from" and "to" to that department and indicates protected.
- Sets up default output options and parameters.
- Defines the parameter passing list (`plist`).

---

## 6. Indicators (`*INxx` Usage)

The initial comments organize indicator usage, e.g.:
- Function keys: KA (F1 - company select), KC (F3 - Exit)
- 31-59: Error and screen feedback
- 60-69: File/operation status
- 70-89: Work indicators (subroutines, etc.)
- 90-99: Used for standard subroutines

---

## 7. Notes on Versioning and Feature Flags

A number of fields and code lines are marked with feature/version codes (e.g., `E5.40`, `NAS01`, `EAS01`). This helps you track customization or customer-specific features.

---

## 8. Typical Program Flow

1. Initialization subroutine runs.
2. Parameter entry screen is displayed.
3. User enters criteria; program validates fields.
4. If any error, flags and returns to screen.
5. On F3 (exit), or valid entry, map input fields to parameter structure.
6. Exit program, returning parameters to the calling process.

---

## 9. General Remarks

- Some fields and checks are commented out, likely due to configuration or feature toggling.
- All user input is rigorously validated for logical consistency.
- Design follows old-school RPG (fixed-format), but the logic is clear and annotated.

---

## 10. Onboarding Tips

- **Start with the parameter structure:** Understand each field, especially the "from/to" ranges.
- **Refer to the display file (`rl628d`):** To see how `a2bld` is laid out and which fields users actually enter.
- **Pay attention to error indicators:** They control which messages or input fields are flagged for re-entry.
- **Explore subsequent programs:** This is a parameter entry pre-step; the actual supplier printing and selection logic is likely in a called program.

---

**In summary:**  
This RPG program is a parameter entry and validation layer for supplier register reporting. Its structure and logic are well-annotated, providing robust validation, range enforcement, and feature-based field handling. Most business logic is in the validations and parameter assignments, with the display file providing the user interface.