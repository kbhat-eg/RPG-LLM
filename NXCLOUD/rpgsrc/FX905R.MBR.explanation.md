## Program Overview

This RPG program, FX905R, is part of the ASOFAK system and is responsible for maintaining the conversion table for product groups ("Konv.tabell varegruppe, vedlikehold - param"). The code is primarily a parameter maintenance interface, acting as a front-end to validate user input and then delegate further processing to another program (FX906R).

### Structure and Workflow

#### Display File
- The program uses a workstation display file `FX905D` (see `ffx905d cf e workstn`). All user interaction is managed via this display file, specifically through the format `b1bld`.

#### Local Data Area (LDA)
- The program references fields from the LDA (positions 944–946 for `l_firm` and 951–980 for `l_fnav`). `l_firm` is used to initialize the local variable `w_firm`, which likely represents the current company or division context.

#### Main Variables
- `b_feil`: Error flag, signals if input validation fails.
- `w_firm`: Local copy of the firm identifier, initialized from the LDA.

#### Main Program Flow

1. **Initial Display and Input Loop**
    - The program repeatedly displays the main screen (`exfmt b1bld`) and processes user input.
    - The entry point for the main loop is labeled `b1taga`.

2. **Function Key Handling**
    - Checks if the user pressed function keys mapped to `*INKC` or `*INKL` (commonly F3=Exit, F12=Cancel in Scandinavian IBM shops).
    - If so, branches to program termination (`goto avslutt`).

3. **Input Validation**
    - Calls the subroutine `sjekk_input` after each input.
    - If validation fails (`b_feil = *on`), redisplays the screen for correction.

4. **Delegation to Maintenance Program**
    - On valid input, calls the maintenance program `FX906R`, passing `w_firm` and `b1kode` as parameters.
    - After the call, the main loop restarts, allowing further operations or corrections.

5. **Program Termination**
    - On exit, sets LR (`*INLR = *ON`) and returns.

### Subroutines

#### `sjekk_input`
- Validates the input field `b1kode`.
- Only allows values 0 or 1.
- If invalid, sets indicator `*IN31` (likely to trigger a field-level error message in the display file) and sets the error flag.

#### `*INZSR` (Initialization Subroutine)
- Initializes `w_firm` from the LDA (`l_firm`).
- Ensures that the program always works within the correct company context.

### Design Decisions and Conventions

- **Separation of Concerns**: This program acts as a parameter validator and delegator. The actual maintenance logic is in `FX906R`, promoting modularity and reuse.
- **Error Handling**: Uses a combination of a local error flag (`b_feil`) and display file indicators (`*IN31`) for user feedback.
- **LDA Usage**: Relies on the Local Data Area for context (firm/company), a common pattern in legacy IBM i applications for session context.
- **Function Key Handling**: Uses indicators for function keys, conforming to standard IBM i UI conventions.

### Interactions with Other Modules

- **FX906R**: The maintenance logic for the conversion table is encapsulated in this external program. This program passes the firm context and the selected code (`b1kode`) to `FX906R`.
- **Display File (FX905D)**: The user interface is defined in the display file, which must have fields and indicators matching those referenced here (e.g., `b1kode`, `*IN31`, `b1bld`).

### Business/Domain Logic

- **Product Group Conversion Table**: The code is part of a system for managing product group conversions, likely mapping external product group codes to internal ones or supporting business rules for categorization.
- **Parameter Selection (`b1kode`)**: The user is expected to select a parameter (likely an action or a type), and only two options are valid (0 or 1). The meaning of these codes would be defined by business requirements.

### Summary

FX905R is a simple, robust front-end parameter handler for the product group conversion table maintenance process. It ensures only valid input is passed to the core logic (FX906R), manages user interaction, and maintains session context via the LDA. Its structure is typical for legacy IBM i applications, emphasizing modularity, clear error signaling, and adherence to established UI conventions.