```markdown
## Overview

This legacy RPG (Report Program Generator) program, named **RR612R**, is written for the IBM i (previously AS/400) platform. Its primary function is to calculate comparison figures (`sammenligningstall`) for financial/accounting data over a set of periods. The source code includes Norwegian comments and descriptive variable naming consistent with a finance/accounting application.

---

## Control Specification (`H` spec)

```rpg
h option(*nodebugio) datedit(*dmy)
```
- `*NODEBUGIO`: Disables debug input/output.
- `DATEDIT(*DMY)`: Sets default date format to `DD/MM/YY`.

---

## File Specification (`F` spec)

```rpg
frrf9l1    if   e           k disk    rename(rrf9pfr:rrf9l1r)
frrf9l2    if   e           k disk    rename(rrf9pfr:rrf9l2r)
```
- Defines two externally described, keyed disk files.
- Both physical files are based on `rrf9pfr` but are renamed for different logical views (`rrf9l1r`, `rrf9l2r`).

---

## Data Declarations (`D` spec)

### Main Table

```rpg
d sal             s             11  2 dim(14)
```
- **`sal`**: Array of 14 decimal numbers (likely holding period balances for 13 periods + total).

### Field Layouts

A mix of unnamed fields (used as part of a User Data Structure `UDS`) and named working fields.

- Examples:
    - `rhprap` ... `rhphel` ... `rhpnul`: Likely fields from a record format for financial values, periods, types, etc.
    - `l_user`, `l_firm`: Identifies user and firm.
    - `bev`, `bevp`, `salh`, `sum`: Work fields to accumulate balances/movements.
    - `w_firm`, `w_9avd`, `w_9sln`: Working variables for keys (firm, division, line).
    - `rrf9l1_9rap` etc.: Fields used for key lists when reading from files.

---

## Input Specifications (`I` spec)

```rpg
irrf9l1r
i              rr9s01                      sal(01)
...
i              rr9s00                      sal(14)
```
- Maps specific fields (`rr9s01`–`rr9s13` and `rr9s00`) from the file into the corresponding elements of the `sal` array.
- This is done for both logical files, meaning files are read into this standard buffer.

---

## Main Procedure Logic (`C` spec)

### Reading Records and Initial Setup

- Logic is selected (`select...when...other...endsl`) based on the content of `rhpsrt`.
    - If `rhpsrt` is blank, use the first logical file; otherwise, use the second.

- Uses key lists (`rrf9l1_key`, `rrf9l2_key`) to position to the correct record.

### Main Loop (`dow *in60 = *off`)

For each qualifying record:

1. **Type Check:**  
   If `rr9typ` is not 1, the record is skipped.

2. **Year Check:**  
   If `rr9aar` does not match `rhprår`, the record is skipped.

3. **Movement and Sum Calculation:**
   - Zeroes out `bev` (movement) and `sum` (sum).
   - Initializes `n` (loop counter).
   - Adds value from period 14 (`sal(14)`) to `sum`.
   - For periods 1 through the current period (`rhpper`):
        - Adds each period's value (`sal(n)`) to `sum`.
        - If the period number is within the interval `[rhppef, rhppet]`, it is also added to `bev`.
   - After the loop, aggregates running totals: `bevp` and `salh`.

4. **Reads Next Record:**  
    Uses either logical file based on `rhpsrt`, and ends the loop when EOF is reached.

5. **End Processing:**  
   Sets LR (`*inlr = *on`) to end the program.

---

## Initialization Subroutine (`*INZSR`)

- **Parameter List:** Receives working variables (division, line, movement, sum) as parameters.
- **Set Initial Values:**  
   - Copies the firm code from `l_firm` to `w_firm`.
   - Builds key lists for the two logical files (by firm, report, division, and line).

---

## Key Techniques Illustrated

- **Indexed/Array Processing:**  
  Uses arrays to handle period-based values across fiscal periods.

- **Keyed File Access:**  
  Employs key lists (`klist`, `kfld`) for efficient record access in logical files.

- **Conditional Record Handling:**  
  Skips or processes records based on type, fiscal year, and record content.

- **Summation/Accumulation:**  
  Aggregates data for running totals and period movements.

- **Modularization:**  
  Uses a subroutine for initialization and parameter handling.

---

## Summary

**RR612R** is a financial routine that reads period-based balances from logical files, filtering and accumulating values according to specified types, years, and periods. The program is structured to handle both line- and division-based reporting, using arrays for period values and key lists for file access. Its design is typical of traditional RPG batch processing in Norwegian finance/accounting contexts.
```