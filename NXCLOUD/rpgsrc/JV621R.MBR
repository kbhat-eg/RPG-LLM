6.37 h option(*nodebugio) datedit(*dmy-) decedit('0.')
6.37 h DftActgrp(*No) BndDir('CGIDEV2/CGIDEV2')
6.37  /copy hspecsbnd
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASVADM
      * Program . . . . : JV621R
      * Beskrivelse . . : Batch program som overfører nye varer som passer
      *                   til utvalgsmasken til eget vareregister.
      *                   Programmet skriver ut kontroll- og journalliste.
      *
7.01  * Spesialversjon. : Skal kun behandle en vare ved kall fra JV128R
7.01  * Tilpasset for . : Mestergruppen
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       250899 HKO  Nytt program
      *       090200 HKO  Henter alternativ varegruppe fra varegruppe-
      *                   referanse-register
      *       141200 HKO  Erstattet varetekst-2 med varegruppe i utskriften,
      *                   og endret sortering til leverandør, varegruppe og
      *                   varetekst
      *       101202 HKO  Lagt inn grossistløsning
      *       120803 HKO  Endret rekkefølge for oppretting av EAN-nummer
      *       060903 HKO  Lagt inn logikk for merking av innkjøpsenhet og
      *                   prisbokenhet i EVR
      *       141003 HKO  Utelater utgåtte varer
      *       211003 HKO  Skriver Nobb utgår-dato og cross docking
      *                   informasjon til vare
      *       090605 HKO  Behandler EAN-nr fra prisgivende leverandør.
      *                   Overfører EAN-nr mindre enn 12 siffer
      *       170605 HKO  Oppretter priser på leveringstyper med aktive
      *                   betingelser eller påslagskalkyle
      *       090805 HKO  Håndterer individuell rekkefølge på salgsenheter,
      *                   innkjøpsenheter og prisbokenheter.
      *                   Skriver lengde, bredde, høyde, vekt og volum til
      *                   vare-enhet i EVR
      *       130905 HKO  Overstyring til skaffevare som parameter
      *       111005 HKO  Oppretter PSE på EVR-vare dersom PSE er overstyrt
      *                   på enhet i VA
      *       200106 HKO  Endret logikk for skriving til EAN-register
      *       230306 HKO  Oppdaterer med overstyrt varegruppe
      *       140907 BOF  Enhet blir oppdatert på EAN-reg.
      *       280508 BOF  Gammel pris i VA blir oppd. hvis den finnes.
5.60  *       181108 BOF  Justering på oppdatering av ean-reg.
5.61  *       210109 BOF  Hvis jxgdat = *loval, så legges dagens dato
5.70  *       191108 BOF  Utvidet med prisgruppe
5.71  *       130509 BOF  Hovedlager får L andre får ihht. kode
6.11  * 6.10  110709 bof  Utivdet eannr til 14 og brukt std. oppslag
6.12  *       260809 bof  Endret statuskode fra num. til alfa.
6.13  *       260809 bof  Ryddet i epic, upcn mm.  (fjernet fra JVARPF)
6.14  *       030909 bof  Utvidet med sortimentskode
6.15  *       100909 bof  Lagt ut pakningsklasse
6.16  *       240909 bof  Utvidet med pakn.info pr. lev +++
6.17  *       300410 bof  Hindre at feilm.kommer når den ikke skal
6.18  *       110510 bof  Hvis GTIN ikke ligger på prisgiver,tas produsent
6.18  *                   sin GTIN.
6.19  *       120510 bof  Lagt inn eann på vare-pris igjen,skal utgå når alt
6.19  *                   rundt xml-formatet et på plass
6.1a  *       211010 bof  GTIN. hvis gtin finnes på annen vare,så blankes dette
6.1b  *       101110 bof  Hvis prisgiver ikke har gtin på enhet,så overf.
      *                   vareeiers.
6.1c  *       101110 bof  Justert på vtyp på lager når VA skaffev. + endr.dato mm
os71  * os71  151210 bsa  Lagt inn korreksjoner på SQL pga. OS/400 feil
os71  *                   Det er også lagt inn endring på SQL,
os71  *                   som er nødvendig ved overgang til v6.1
6.1d  *       250310 bof  korreksjon av prisgiver på oppd. vveppf
6.1e  *       041111 bof  korr av prisgiver på oppd. vveppf - test pakn<>000
6.20  *       130411 bof  Utvidet vare-pris med prisgiver
6.21  *       060112 bof  Når Lagervare opprettes så beregnes i best/ordre.
6.22  *       260713 bof  Nullstilt prisgruppe på gml.pris
6.23  *       061213 bof  Fjernet krav om at lager kjøres for å få dannet lager
6.24  * 6.20  030414 bof  Kun overføre gtin for gjeldende prisgiver
6.25  * 6.20  311016 bof  Feilretting vedr. pris med både lety + prgr.
6.30  *       280114 bof  Utvidet nøkkel med lev.nr i JVPKPF
6.30  *                   Fjernet JVPPPF (data er flyttet JVPKPF)
6.32  *       140314 bof  Lagt inn test på fra /til dato på pakning
6.33  *       270314 bof  Hvis pris har utgått, skal den ikke brukes
6.34  *       250614 bkv  Ta med Ledetid. Leverandør må være angitt
6.35  *       140714 bof  Utvidet med flere priser pr. dato, velg pris ut
6.35  *                   fra dato i parameter. også parm. for utg.priser
6.36  *       060814 bof  Utvidelse med fraktbetingelse
6.37  * 6.30  210814 bsa  Innført PDF og excel på listevalg
6.38  * R6.30 120914 bsa  Utvidet parameterliste til FO798R.
6.39  * 6.30  280115 bsa  Skriver til datakø for å trigge java sniffer
6.3a  * 6.30  220514 BKV  Utvidet parameterliste til FÅ707R
6.3q  *       260515 bof  Datoformat sql
6.3x  * 6.30  040615 bof  utvidet parm i forb. med prgr. på betingelse
6.3y  * 6.30  050815 bof  utv. parm i forb. med prgr. på frakt + oppdat.
6.3z  * 6.30  110316 BKV  rettet feil i test på dagens dato
6.3c  * 6.30  020816 bof  Feilretting vedr. test på til prisdato.
6.3d  * 6.30  020816 bsa  Skriver kun ei linje, ikke repeter samme info.
6.3e  * R6.30 180816 bsa  Rokkert på rekkefølge av close printerfile
6.3f  * 6.30  010816 bof  Utvalg gjøres via JVLEPF, erstattet JVPRPF
6.3g  * 6.30  140917 nho  Endret tekst som var feil
6.3h  * 6.30  071117 bof  Lagt ut nobbpris til vvprpf
6.3i  * 6.30  130918 bof  Utvidet med trelast sortiment
6.3j  * 6.30  101218 bof  feilretting vedr. nobbnr,modnr,lev.vnr på varekort
6.3s  * R6.30 150119 bof  Nullstiller variabler.
6.3t  * R6.30 170419 bkv  Fyller variabler.
6.3u  * R6.30 130819 bof  Omregning av nobbpris i vvprpf
7.01  *       200421 bof  switch,Sett varetype varekort=L, alle lager = S
7.02  * R6.30 150419 bsa  Innfører parameter om vare skal opprettes
7.02  *                   i tabell for utstillingsvarer.
7.03  * R7.10 100821 bof  Feilretting i utplukk hvis leverandør i parm.
8.01  *PRG2   150622 bof  Utvidet prisgruppe fra 1 til 2 posisjoner
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fjvprpf    if   e           k disk
6.3f fjvlepf    if   e           k disk
      *
     fjvarl9    if   e           k disk    rename(jvarpfr:jvarl9r)
     fjvarl1    if   e           k disk    rename(jvarpfr:jvarl1r)
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fvvprlr    if   e           k disk    rename(vvprpfr:vvprlrr)
6.16 fvvepl2    uf   e           k disk    rename(vveppfr:vvepl2r)
5.60 fvvenlr    if   e           k disk    rename(vvenpfr:vvenlrr)
     fjvdtl1    if   e           k disk    rename(jvdtpfr:jvdtl1r)
     fjvprl1    if   e           k disk    rename(jvprpfr:jvprl1r)
     fjvpkl2    if   e           k disk    rename(jvpkpfr:jvpkl2r)
     fvvarlu    uf a e           k disk    rename(vvarpfr:vvarlur)
     fvvprlu    uf a e           k disk    rename(vvprpfr:vvprlur)
     fvvenlu    uf a e           k disk    rename(vvenpfr:vvenlur)
6.16 fvveplu    uf a e           k disk    rename(vveppfr:vveplur)
     fvvaslu    uf   e           k disk    rename(vvaspfr:vvaslur)
     fveanl1    if   e           k disk    rename(veanpfr:veanl1r)
     fveanlu    uf a e           k disk    rename(veanpfr:veanlur)
6.3i fvvlelu    uf a e           k disk    rename(vvlepfr:vvlelur)
     ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
     fvlaglu    uf a e           k disk    rename(vlagpfr:vlaglur)
     fjsokl1    if   e           k disk    rename(jsokpfr:jsokl1r)
     fvsokl1    if   e           k disk    rename(vsokpfr:vsokl1r)
     fvsoklu    uf a e           k disk    rename(vsokpfr:vsoklur)
     fjwprlu    uf   e           k disk    rename(jwprpfr:jwprlur)
     fjvdtlu    uf a e           k disk    rename(jvdtpfr:jvdtlur)
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
     fjlevl1    if   e           k disk    rename(jlevpfr:jlevl1r)
     fvogrl1    if   e           k disk    rename(vogrpfr:vogrl1r)
     fvhgrl1    if   e           k disk    rename(vhgrpfr:vhgrl1r)
     fvugrl1    if   e           k disk    rename(vugrpfr:vugrl1r)
     fvltpl1    if   e           k disk    rename(vltppfr:vltpl1r)
5.70 fra30l1    if   e           k disk    rename(ra30pfr:ra30l1r)
5.70 fra10l1    if   e           k disk    rename(ra10pfr:ra10l1r)
6.14 fjsorl1    if   e           k disk    rename(jsorpfr:jsorl1r)
6.34 fmltilr    if   e           k disk    rename(mltipfr:mltilrr)
6.37 faforl1    if   e           k disk    rename(aforpfr:aforl1r)
6.3f fjvlel3    if   e           k disk    rename(jvlepfr:jvlel3r)
6.3f fjvkhl1    if   e           k disk    rename(jvkhpfr:jvkhl1r)
7.02 fvutslu    uf a e           k disk    rename(vutspfr:vutslur)
7.02 fvvepl1    if   e           k disk    rename(vveppfr:vvepl1r)
      *
     fjv621p    o    e             printer
6.37 f                                     usropn
      *
      * Definering av parametre
      *
6.35 d p_list          s             50
7.01 d p_vare          s                   like(jvvare)
7.02 d p_vuts          s              1
     d p_skaf          s              1  0
     d p_kntr          s              1  0
      *
     d p_firm          s              3  0
     d p_ldor          s                   like(jvldor)
     d p_ogrp          s                   like(jvogrp)
     d p_hgrp          s                   like(jvhgrp)
     d p_ugrp          s                   like(jvugrp)
     d p_pgiv          s                   like(jvldor)
      *
      * Definering av Local data area
      *
     d                uds
6.37 d l_poff                584    584
6.37 d l_utqm                585    594
6.37 d l_bach                595    635
6.37 d l_arch                636    636  0
6.37 d l_skje                637    637  0
6.37 d l_exlp                639    639  0
6.37 d l_mail                640    640  0
6.37 d l_prfi                750    750  0
6.37 d l_outq                810    819
6.37 d l_copy                838    843  0
6.37 d l_ruti                800    809
     d l_wsid                901    910
     d l_user                911    920
6.37 d l_filg                931    933
6.37 d l_firm                944    946  0
6.37 d l_avde                947    950  0
6.37 d l_fnav                951    980
7.02 d l_lage               1001   1002  0
      *
      * Datastruktur for parameterliste -inn
      *
     d                 ds
6.35 d d_list                        50
     d  d_firm                        3  0 overlay(d_list)
     d  d_ldor                        6  0 overlay(d_list:4)
     d  d_ogrp                        2  0 overlay(d_list:10)
     d  d_hgrp                        2  0 overlay(d_list:12)
     d  d_ugrp                        3  0 overlay(d_list:14)
     d  d_pgiv                        6  0 overlay(d_list:17)
     d  d_skaf                        1  0 overlay(d_list:23)
     d  d_kntr                        1  0 overlay(d_list:24)
8.01 d  d_prgr                        2    overlay(d_list:25)
8.01 d  d_osor                       10    overlay(d_list:27)
8.01 d  d_dato                         d   overlay(d_list:37)  datfmt(*iso)
8.01 d  d_utgp                        1  0 overlay(d_list:48)
8.01 d  d_dumm                        1    overlay(d_list:49)
      *
      * Definering av variabler i nøkler
      *
     d jvarl9_ldor     s                   like(jvldor)
     d jvarl1_vare     s                   like(jvvare)
     d vvarl1_vare     s                   like(vvvare)
     d vvprlr_vare     s                   like(vpvare)
6.20 d vvprlr_ldor     s                   like(vpldor)
5.70 d vvprlr_prgr     s                   like(vpprgr)
     d vvprlr_enhe     s                   like(vpenhe)
     d vvprlr_lety     s                   like(vplety)
     d vvprlr_pdat     s                   like(vppdat)
5.60 d vvenlr_vare     s                   like(vevare)
5.60 d vvenlr_enhe     s                   like(veenhe)
6.16 d vvepl2_pgti     s                   like(vepgti)
6.11 d vvenlu_vare     s                   like(vevare)
6.11 d vvenlu_enhe     s                   like(veenhe)
6.16 d vveplu_pvar     s                   like(vepvar)
6.16 d vveplu_penh     s                   like(vepenh)
6.16 d vveplu_pldo     s                   like(vepldo)
6.3i d vvlelu_lvnr     s                   like(vvlvnr)
6.3i d vvlelu_lldo     s                   like(vvlldo)
     d vvaslu_vare     s                   like(vvvare)
     d jvdtl1_dvar     s                   like(jvdvar)
     d jvprl1_vare     s                   like(jxvare)
     d jvprl1_ldor     s                   like(jxldor)
     d jvpkl2_vare     s                   like(jwvare)
6.30 d jvpkl2_ldor     s                   like(jwldor)
     d jvpkl2_enhe     s                   like(jwenhe)
     d veanl1_eann     s                   like(vxeann)
5.60 d veanlu_eann     s                   like(vxeann)
     d vlaglu_vare     s                   like(vlvare)
5.70 d vlaglu_lage     s                   like(vllage)
     d jsokl1_vare     s                   like(jsvare)
     d vsokl1_vare     s                   like(vsvare)
     d vsokl1_stek     s                   like(vsstek)
     d jwprlu_vare     s                   like(jbvare)
     d jvdtlu_dvar     s                   like(jvdvar)
     d jlevl1_ldor     s                   like(jlldor)
     d vogrl1_oogr     s                   like(vgoogr)
     d vhgrl1_hogr     s                   like(vghogr)
     d vhgrl1_hhgr     s                   like(vghhgr)
     d vugrl1_uogr     s                   like(vguogr)
     d vugrl1_uhgr     s                   like(vguhgr)
     d vugrl1_uugr     s                   like(vguugr)
6.14 d jsorl1_osor     s                   like(jsosor)
6.34 d mltilr_ogrp     s                   like(mcogrp)
6.34 d mltilr_hgrp     s                   like(mchgrp)
6.34 d mltilr_ugrp     s                   like(mcugrp)
6.34 d mltilr_ldor     s                   like(mcldor)
6.34 d mltilr_vare     s                   like(mcvare)
6.34 d mltilr_lage     s                   like(mclage)
6.34 d mltilr_crdo     s                   like(mccrdo)
6.37 d aforl1_ruti     s                   like(afruti)
6.3f d jvlel3_lldo     s                   like(jvlldo)
7.03 d*jvlel3_lvnr     s                   like(jvlvnr)
6.3f d jvkhl1_kvnr     s                   like(jvkvnr)
7.02 d vutslu_tlag     s                   like(vutlag)
7.02 d vutslu_tvar     s                   like(vutvar)
7.02 d vvepl1_pvar     s                   like(vepvar)
7.02 d vvepl1_penh     s                   like(vepenh)
7.02 d vvepl1_pldo     s                   like(vepldo)
      *
      * Definering av variable
      *
     d b_EOF           s              1    inz(*off)
5.70 d b_lety          s              1    inz(*off)
5.70 d b_oppd          s              1    inz(*off)
6.1b d b_gtin          s              1    inz(*off)
6.32 d b_pakn          s              1    inz(*off)
6.3i d b_logv          s              1    inz(*off)
      *
     d w_firm          s              3  0
     d w_lety          s              1  0
     d w_gprk          s              1  0
6.12 d w_osts          s              1
     d w_bvty          s              1
     d w_blet          s              1  0
     d w_bbet          s             35
     d w_udat          s               d   datfmt(*iso)
     d w_utim          s               t   timfmt(*iso)
     d w_dekn          s              5  2
     d w_enh           s              3
     d w_enh1          s              3
     d w_enh2          s              3
     d w_enh3          s              3
     d w_eni1          s              3
     d w_eni2          s              3
     d w_eni3          s              3
     d w_enp1          s              3
     d w_enp2          s              3
     d w_enp3          s              3
     d w_gdat          s               d   datfmt(*iso)
     d w_grpr          s              9  2
     d w_ifak          s              8  6
     d w_midl          s              1  0
     d w_inpr          s              9  2
     d w_kbel          s              7  2
     d w_kfak          s              8  6
     d w_kopr          s              9  2
     d w_ntpr          s              8  2
     d w_ofp1          s             12  6
     d w_ofp2          s             12  6
     d w_ofp3          s             12  6
     d w_ofv2          s             12  6
     d w_ofv3          s             12  6
     d w_ofi1          s             12  6
     d w_ofi2          s             12  6
     d w_ofi3          s             12  6
     d w_ppko          s              1
     d w_pvty          s              1
     d w_plet          s              1  0
     d w_sfak          s              8  6
     d w_s1im          s              9  2
     d w_s1pr          s              9  2
     d w_s2im          s              9  2
     d w_s2pr          s              9  2
     d w_s3im          s              9  2
     d w_s3pr          s              9  2
8.01 d w_prut          s                   like(vpprgr)
8.01 d w_pgbe          s                   like(vpprgr)
8.01 d w_prgr          s                   like(vpprgr)
6.36 d w_ffak          s              8  6
6.36 d w_inp2          s              9  2
6.36 d w_pdat          s                   like(jwodat)
6.36 d w_utgp          s              1  0
8.01 d w_pgfr          s                   like(vpprgr)
6.3y d w_oppd          s              1
      *
     d w_bldo          s                   like(jvldor)
     d w_bhgr          s                   like(jvogrp)
     d w_bogr          s                   like(jvhgrp)
     d w_bugr          s                   like(jvugrp)
     d w_bmod          s                   like(jvmodn)
     d w_bvar          s                   like(jvvare)
     d w_eldo          s                   like(jvldor)
     d w_ldor          s                   like(jvldor)
     d w_lvar          s                   like(jvlvar)
     d w_pogr          s                   like(jvogrp)
     d w_phgr          s                   like(jvhgrp)
     d w_pugr          s                   like(jvugrp)
     d w_pldo          s                   like(jvldor)
     d w_pmod          s                   like(jvmodn)
     d w_pvar          s                   like(jvvare)
     d w_kmod          s                   like(jlkmod)
6.19 d w_eann          s                   like(jxeann)
     d w_crdo          s                   like(jxcrdo)
     d w_enhs          s                   like(vguens)
     d w_enhl          s                   like(vguenl)
5.60 d w_enhe          s                   like(veenhe)
6.18 d w_gtin          s                   like(jwgtin)
6.34 d w_pkla          s                   like(jwpkla)
6.34 d w_best          s                   like(jwbest)
6.1a d wwpvar          s                   like(vepvar)
6.1a d wwpenh          s                   like(vepenh)
6.1a d wwpgti          s                   like(vepgti)
6.1b d w_enum          s                   like(jlenum)
6.3i d w_lv_vare       s                   like(jvvare)
6.3i d w_lv_modn       s                   like(jvmodn)
6.3i d w_lv_nobb       s                   like(jvnobb)
6.3i d w_lv_lldo       s                   like(jvlldo)
6.3i d w_lv_llva       s                   like(jvllva)
6.3i d w_lv_luda       s                   like(jvluda)
6.3i d w_lv_enum       s                   like(jlenum)
      *
6.3d d dt2prg          s                   like(d3prgr)
6.3d d dt2lty          s                   like(d3lety)
6.3d d dt2enh          s                   like(vepenh)
6.3d d dt2inp          s                   like(d2inpr)
6.3d d dt2kop          s                   like(d2kopr)
6.3d d dt2s1p          s                   like(d2s1pr)
6.3d d dt2s1i          s                   like(d2s1im)
6.3d d dt2dek          s                   like(d2dekn)
6.3d  *
6.3d d ds2prg          s                   like(d3prgr)
6.3d d ds2lty          s                   like(d3lety)
6.3d d ds2enh          s                   like(vepenh)
6.3d d ds2sap          s                   like(d3sapr)
6.3d d ds2sai          s                   like(d3saim)
6.3d  *
6.3d d ds3prg          s                   like(d3prgr)
6.3d d ds3lty          s                   like(d3lety)
6.3d d ds3enh          s                   like(vepenh)
6.3d d ds3sap          s                   like(d3sapr)
6.3d d ds3sai          s                   like(d3saim)
6.3d  *
6.3d d di1prg          s                   like(d4prgr)
6.3d d di1lty          s                   like(d4lety)
6.3d d di1enh          s                   like(vepenh)
6.3d d di1inp          s                   like(d4inpr)
6.3d d di1kop          s                   like(d4kopr)
6.3d  *
6.3d d di2prg          s                   like(d4prgr)
6.3d d di2lty          s                   like(d4lety)
6.3d d di2enh          s                   like(vepenh)
6.3d d di2inp          s                   like(d4inpr)
6.3d d di2kop          s                   like(d4kopr)
6.3d  *
6.3d d di3prg          s                   like(d4prgr)
6.3d d di3lty          s                   like(d4lety)
6.3d d di3enh          s                   like(vepenh)
6.3d d di3inp          s                   like(d4inpr)
6.3d d di3kop          s                   like(d4kopr)
      *
6.37 d p_mail          s              1
6.37 d p_kund          s              6  0
6.37 d p_kpro          s              6  0
6.37 d p_numm          s              8  0
6.38 d p_suff          s              2  0
6.37 d p_selg          s              4  0
6.37 d p_serv          s             35
6.37 d p_stat          s              1
6.37 d p_kule          s              1
6.37 d p_navn          s             30
6.37 d p_emal          s             50
6.37 d p_ema2          s             50
6.38 d p_ema3          s             50
6.38 d p_kopi          s             50
6.37 d p_emne          s             50
6.37 d p_txt1          s             50
6.37 d p_txt2          s             50
6.37 d p_txt3          s             50
6.37 d p_txt4          s             50
6.37 d p_pers          s             50
6.37 d p_inif          s             40
6.37 d p_in03          s              1
6.37 d p_btyp          s            100
6.37 d p_ok            s              1
6.37 d p_lr            s              1
6.37 d p_str_in        s            512
6.37 d p_str_out       s            512
6.39 d p_filg          s             10
6.39 d p_xmlf          s            256
6.37 d w_tek1          s             75
6.37 d w_lnav          s             50
6.37 d w_mvak          s              3
6.37 d w_dspl          s            100
6.37 d w_jkey          s             41
6.37 d w_jstat         s              2  0
6.37 d w_jtext         s            200
6.37 d w_pdf           s              1  0
6.37 d w_pdf_ds        s            512
6.37 d w_rtyp          s             50
6.37 d w_dato2         s             12  0
6.37 d w_ddmy          s              6  0
6.37 d w_tids          s              6  0
6.37 d w_ruti          s             10
6.37 d w_txt1          s             75
6.37 d w_mime          s             24
6.37 d w_date          s               d   datfmt(*iso)
6.37 d w_1fnav         s             50
6.37 d w_1fad1         s             50
6.37 d w_1fad2         s             50
6.37 d w_prfi          s              1  0
6.37 d w_ffir          s              3  0
6.37 d w_fnav          s             30
6.37 d w_fad1          s             30
6.37 d w_fad2          s             30
6.37 d w_fste          s             30
6.37 d w_fftx          s             30
6.37 d w_tfax          s              8
6.37 d w_ftlf          s             11
6.37 d w_ffax          s             11
6.3a d w_mail          s             50
6.3a d w_weba          s             50
6.37 d w_pemne         s             75
6.37 d w_ptxt1         s             75
6.37 d w_ptxt2         s             75
6.37 d w_ptxt3         s             75
6.37 d w_ptxt4         s             75
6.37 d w_ppers         s             75
6.37 d w_avde          s              4  0
6.37 d w_mtxt          s            300
6.37 d h_valu          s             15
6.37 d d_valu          s             50
6.37 d d_type          s             10
      *
6.37 d b_excl          s              1    inz(*off)
      *
6.37 d splfname2       s             10a
6.37 d jobname2        s             10a
6.37 d username2       s             10a
6.37 d jobnbr2         s              6a
6.37 d splfnbr2        s             10i 0
6.37 d splfname3       s             10a
6.37 d jobname3        s             10a
6.37 d username3       s             10a
6.37 d jobnbr3         s              6a
6.37 d splfnbr3        s             10i 0
6.37 d p_tagg0         s             20
6.37 d p_tagg0val      s             50
6.37 d p_tagg1         s             20
6.37 d p_tagg1val      s             50
6.37 d p_tagg2         s             20
6.37 d p_tagg2val      s             50
6.37 d p_tagg3         s             20
6.37 d p_tagg3val      s             50
6.37 d p_tagg4         s             20
6.37 d p_tagg4val      s             50
6.37 d p_tagg5         s             20
6.37 d p_tagg5val      s             50
6.37 d p_tagg6         s             20
6.37 d p_tagg6val      s             50
6.37 d p_tagg7         s             20
6.37 d p_tagg7val      s             50
6.37 d p_tagg8         s             20
6.37 d p_tagg8val      s             50
6.37 d p_tagg9         s             20
6.37 d p_tagg9val      s             50
6.37 d p_refn          s             50
6.37 d p_dspl          s            100
6.37  *
6.37 d qsprilsp        pr                  extpgm('QSPRILSP')
6.37 d rcvvar                     32767a   options(*varsize)
6.37 d rcvvarlen                     10i 0 const
6.37 d format                         8a   const
6.37 d errorcode                  32767a   options(*varsize)
6.37  *
6.37 d sprl0100        ds
6.37 d  bytesrtn                     10i 0
6.37 d  bytesavl                     10i 0
6.37 d  splfname                     10a
6.37 d  jobname                      10a
6.37 d  username                     10a
6.37 d  jobnbr                        6a
6.37 d  splfnbr                      10i 0
6.37 d  systemname                    8a
6.37 d  createdate                    7a
6.37 d                                1a
6.37 d  createtime                    6a
6.37  *
6.37 d errorcode       ds
6.37 d  bytesprov                    10i 0 inz(0)
6.37 d  byteavail                    10i 0 inz(0)
      *
6.37  *
6.37 d XML_Output      s            256a   Varying
6.37 d XML_path        s            256a   Varying
6.37 d                                     Inz('/home/asp/print/adb')
6.37 d jasper_mal      s            256a
6.37 d jasper_logo     s            256a   varying
6.37 d tmpdate         s               D
6.37 d tmptime         s               T
6.37 d crlf            c                   const(X'0d25')
6.37  *
6.37 d d_pdf_ds        ds
6.37 d  d_xmlm                       75
6.37 d  d_jasm                       75
6.37 d  d_logo                       75
6.37 d  d_path                      100
6.37 d  d_emal                       50
6.37 d  d_fifo                       75
6.37 d  d_fkop                        1
6.39 d  d_dtaq                        1
6.39 d  d_sign                        1
6.37  /copy prototypeb
6.37  /copy usec
      *
7.01 d u_701           s              1    inz(*off)                            Endring 7.10
      *
7.01  * Definering av eksterne prg
7.01  *
7.01   dcl-s co402_verdi1  char(1);
7.01   dcl-s co402_verdi2  char(2048);
7.01   DCL-PR CO402R EXTPGM('CO402R');
7.01     p_filgrp            char(3)     const;
7.01     p_firm              packed(3:0) const;
7.01     p_lager             packed(2:0) const;
7.01     p_nokkel            char(50)    const;
7.01     p_verdi1            char(1);
7.01     p_verdi2            char(2048);
7.01   END-PR;
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.3q C/Exec SQL
6.3q C+  Set Option DatFmt=*ISO
6.3q C/End-Exec
      *
      * Utskrift av header
      *
     c                   exsr      hode
7.01 c                   if        p_vare <> *blank
7.01  * Skal kun behandle en vare (fra JV128R)
7.01 c                   exsr      en_vare
7.01 c                   else
      *
      * Behandling av kontrolliste/journalliste, og utskrift av deltajlinjer
      *
     c                   exsr      behandling
7.01 c                   endif
6.37  * Generer xml for videre utskrift
6.37 c                   if        l_poff = '1' and
6.37 c                             b_excl = *off
6.37 c                   exsr      spoolnbr
6.3d c                   close     jv621p
6.3d c                   exsr      xml_create
6.37 c                   exsr      pdf_preview
6.37 c                   endif
6.37  * Excel rapport
6.37 c                   if        l_poff = '1' and
6.37 c                             b_excl = *on
6.37 c                   exsr      xml_end
6.37  * Hvis EXCEL må vi forhåndsvise linken, slik at vi får den opp i browser
6.37 c                   exsr      pdf_preview
6.37 c                   endif
6.37  * Avslutt jobbiden
6.37 c                   if        l_poff = '1'
6.37 c                   call      'AB710R'
6.37 c                   parm                    l_bach
6.37 c                   endif
      *
      * Avslutt
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering og utskrift av hode-opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hode          begsr
      *
      * Legger inn arb.stasjon og bruker i faste felter
      *
     c                   eval      a1firm = w_firm
     c                   eval      a1user = l_user
     c                   eval      a1wsid = l_wsid
     c     *dmy          move      w_udat        a1date
     c     *hms          move      w_utim        a1time
     c                   if        p_kntr = 1
     c                   eval      a1otxt = 'Kontrolliste'
     c                   else
     c                   eval      a1otxt = 'Journalliste'
     c                   endif
      *
      * Henter firmaopplysninger
      *
     c     afirl1_key    chain     afirl1r
     c                   eval      a1fnav = aafnav
      *
      * Henter parametre med beskrivelse
      *
     c                   eval      a2ldor = p_ldor
     c                   eval      a2pgiv = p_pgiv
     c                   eval      a2ogrp = p_ogrp
     c                   eval      a2hgrp = p_hgrp
     c                   eval      a2ugrp = p_ugrp
5.70 c                   eval      a2prgr = d_prgr
6.14 c                   eval      a2osor = d_osor
6.14 c                   eval      jsorl1_osor = d_osor
6.14 c     jsorl1_key    chain     jsorl1                             38
6.14 c                   if        %found(jsorl1)
6.14 c                   eval      a2stxt = jsotxt
6.14 c                   endif
      *
     c                   if        p_ldor <> 0
     c                   eval      jlevl1_ldor = p_ldor
     c     jlevl1_key    chain     jlevl1
     c                   if        %found
     c                   eval      a2lnav = jlnavn
     c                   eval      w_kmod = jlkmod
     c                   endif
     c                   endif
      *
     c                   if        p_pgiv <> 0
     c                   eval      jlevl1_ldor = p_pgiv
     c     jlevl1_key    chain     jlevl1
     c                   if        %found
6.1b c                   eval      w_enum = jlenum
     c                   eval      a2pnav = jlnavn
     c                   endif
     c                   endif
      *
     c                   if        p_ugrp <> 0
     c                   eval      vugrl1_uogr = p_ogrp
     c                   eval      vugrl1_uhgr = p_hgrp
     c                   eval      vugrl1_uugr = p_ugrp
     c     vugrl1_key    chain     vugrl1
     c                   if        %found
     c                   eval      a2utxt = vgutxt
     c                   endif
     c                   endif
      *
     c                   if        p_hgrp <> 0 and
     c                             p_ugrp =  0
     c                   eval      vhgrl1_hogr = p_ogrp
     c                   eval      vhgrl1_hhgr = p_hgrp
     c     vhgrl1_key    chain     vhgrl1
     c                   if        %found
     c                   eval      a2utxt = vghtxt
     c                   endif
     c                   endif
      *
     c                   if        p_ogrp <> 0 and
     c                             p_hgrp =  0
     c                   eval      vogrl1_oogr = p_ogrp
     c     vogrl1_key    chain     vogrl1
     c                   if        %found
     c                   eval      a2utxt = vgotxt
     c                   endif
     c                   endif
      *
      * Skriver heading
      *
6.37 c                   if        b_excl = *off
     c                   write     a1hdr
     c                   write     a2hdr
     c                   write     a3hdr
6.37 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for lesing og behandling av varer for leverandør eller
      * prisgiver
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandling    begsr
      *
     c                   if        p_ldor = 0
     c/exec sql
     c+ declare prisfil cursor for
     c+ select v.jvldor,
     c+        v.jvogrp,
     c+        v.jvhgrp,
     c+        v.jvugrp,
     c+        v.jvtek1,
     c+        v.jvvare,
6.3f c+        p.jvlvnr,
6.3f c+        p.jvlldo,
6.3t c+        p.jvllva,
6.3t c+        p.jvluda
6.3f c+ from   jvarpf as v inner join jvlepf as p on
6.3f c+        v.jvvare = p.jvlvnr
os71 c+        inner join jvdtpf as d on
os71 c+        v.jvvare = d.jvdvar
6.3f c+ where  p.jvlldo = :p_pgiv and
     c+        d.jvdhko = 0
6.3f c+ order by p.jvlldo, v.jvogrp, v.jvhgrp, v.jvugrp, v.jvtek1
     c+ for read only
     c/end-exec
     c/exec sql
     c+ open prisfil
     c/end-exec
     c                   endif
      *
     c                   if        p_ldor = 0
      *
     c                   dow       b_EOF = *off
      *
     c/exec sql
     c+ fetch prisfil
     c+ into  :jvldor,
     c+       :jvogrp,
     c+       :jvhgrp,
     c+       :jvugrp,
     c+       :jvtek1,
     c+       :jvvare,
6.3f c+       :jvlvnr,
6.3f c+       :jvlldo,
6.3t c+       :jvllva,
6.3t c+       :jvluda
     c/end-exec
      *
     c                   if        sqlcod = 100 or sqlstt = '02000'
     c                   leave
     c                   endif
      *
6.3f c                   eval      jvarl1_vare = jvlvnr
     c     jvarl1_key    chain     jvarl1
     c                   if        %found
     c                   exsr      behandl_vare
     c                   endif
      *
     c                   enddo
      *
     c                   else
      *
6.3f c                   eval      jvlel3_lldo = p_ldor
6.3f c     jvlel3_key    setll     jvlel3
6.3f c     jvlel3_key    reade     jvlel3
     c                   dow       not %eof
      *
6.3f c                   if        jvlvei = 1
6.3f c                   eval      jvarl1_vare = jvlvnr
6.3f c     jvarl1_key    chain     jvarl1
6.3f c                   if        %found
6.3f c                   exsr      behandl_vare
6.3f c                   endif
6.3f c                   endif
      *
6.3f c     jvlel3_key    reade     jvlel3
     c                   enddo
      *
     c                   endif
      *
     c                   if        p_ldor = 0
     c/exec sql
     c+ close prisfil
     c/end-exec
     c                   endif
      *
     c                   endsr
7.01  *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.01  * Subrutine for å behandle en vare
7.01  * prisgiver
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.01  *
7.01 c     en_vare       begsr
7.01  *
7.01 c                   eval      jvarl1_vare = p_vare
7.01 c     jvarl1_key    chain     jvarl1
7.01 c                   if        %found
7.01 c                   exsr      behandl_vare
7.01 c                   endif
7.01  *
7.01 c                   endsr
7.01  *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av varer som mather utplukkskriteriene
      * Behandler utskrift av detaljlinje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandl_vare  begsr
      *
      * Sjekker om varene skal være med på utplukket
      *
     c                   if        p_ogrp <> 0 and
     c                             p_ogrp <> jvogrp
     c                   leavesr
     c                   endif
      *
     c                   if        p_hgrp <> 0 and
     c                             p_hgrp <> jvhgrp
     c                   leavesr
     c                   endif
      *
     c                   if        p_ugrp <> 0 and
     c                             p_ugrp <> jvugrp
     c                   leavesr
     c                   endif
6.33  *
6.33  * hvis pris har utgått skal den ikke vises
6.33  *
6.33 c                   eval      jvprl1_vare = jvvare
6.3f c                   eval      jvprl1_ldor = jvlldo
6.35 c     jvprl1_key    setll     jvprl1
6.35 c     jvprl1_key    reade     jvprl1
6.35 c                   dow       not %eof(jvprl1)
6.35 c                   if        d_dato >= jxgdat
6.35 c                   if        d_utgp =  0      and
6.35 c                             jxtdat <> *loval and
6.3c c                             jxtdat <= w_udat
6.33 c                   leavesr
6.33 c                   endif
6.35 c                   leave
6.35 c                   endif
6.35 c     jvprl1_key    reade     jvprl1
6.35 c                   enddo
      *
     c                   if        jvstat = 4 or
     c                             jvudat <> *loval and
     c                             jvudat < w_udat
     c                   leavesr
     c                   endif
      *
     c                   eval      vvarl1_vare = jvvare
     c     vvarl1_key    chain     vvarl1
     c                   if        %found
     c                   leavesr
     c                   endif
      *
     c                   eval      jvdtl1_dvar = jvvare
     c     jvdtl1_key    chain     jvdtl1
     c                   if        not %found or
     c                             jvdhko = 1
     c                   leavesr
     c                   endif
      *
     c                   if        p_skaf = 1
     c                   eval      jvdsko = 1
     c                   endif
      *
      * Kaller sub-program for å sjekke status og hente data
      *
     c                   eval      w_lety = 0
5.70 c                   eval      w_prgr = *blank
     c                   eval      w_gprk = 0
      *
     c                   exsr      hent_data
      *
      * Oppdaterer EV og VA dersom journalliste
      *
     c                   if        p_kntr = 0
     c                   exsr      oppdater
     c                   endif
5.70  *
5.70  * hvis oppdatering ikke har gått bra på vare lev.type=0 og prgr = blan
5.70  * så skal det ikke skje mer med varen
6.17 c                   if        b_oppd = *off    and
6.17 c                             p_kntr = 0
5.70 c                   exsr      skr_feil
5.70 c                   goto      end_behand
5.70 c                   endif
      *
      * Skriver detaljlinje på kvittering/journalliste.
      *
     c                   exsr      detalj
      *
      * Behandler priser/kalkyler på andre leveringstyper
      *
     c     vltpl1_key    setll     vltpl1
     c     vltpl1_key    reade     vltpl1
     c                   dow       not %eof
     c                   if        vylety <> 0
     c                   exsr      leveringstype
     c                   endif
     c     vltpl1_key    reade     vltpl1
     c                   enddo
5.70  *
5.70  * Behandler priser/kalkyler på andre prisgrupper
5.70  * med leveringstype = 0
5.70  *
5.70 c     ra30l1_key    setll     ra30l1
5.70 c     ra30l1_key    reade     ra30l1
5.70 c                   dow       not %eof
5.70 c                   eval      w_lety = 0
5.70 c                   eval      b_lety = *off
5.70 c                   if        redkod <> *blank
5.70 c                   exsr      prisgruppe
5.70 c                   endif
5.70 c     ra30l1_key    reade     ra30l1
5.70 c                   enddo
      *
      * Sjekker om gammel pris finnes i VA - legger denne inn i EVR
6.35  * Dette takles nå med priser pr. dato i JVPRPF
6.35  *
6.35 c*                  eval      jvprl1_vare = jvvare
6.35 c*                  eval      jvprl1_ldor = w_ldor
6.35 c*    jvprl1_key    chain     jvprl1
6.35 c*                  if        %found
6.35 c*                  if        (jxtdat =  *loval) or
6.35 c*                            (jxtdat <> *loval and
6.35 c*                            jxtdat > w_dato)
6.35 c*                  if        jxgdat > w_udat  and
6.35 c*                            jxgpri > 0
6.35 c*                  exsr      gml_pris
6.35 c*                  endif
6.35 c*                  endif
6.35 c*                  endif
6.35  *
7.02  * Hvis enkeltvare og merket som den skal opprettes i utstillingstabell
7.02  *
7.02 c                   if        p_vare <> *blanks and
7.02 c                             p_vuts = '1'
7.02 c                   exsr      ex_vuts
7.02 c                   endif
6.35  *
6.35 c     end_behand    endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å hente data/kalkyle og status på vare/leveringstype
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_data     begsr
6.3y c                   eval      w_oppd = '1'
      *
     c                   call      'JV750R'
      *
     c                   parm                    p_firm
     c                   parm                    jvvare
5.70 c                   parm                    w_prgr
     c                   parm                    p_pgiv
     c                   parm                    jvdpko
     c                   parm                    jvdsko
     c                   parm                    w_lety
     c                   parm                    w_gprk
6.35 c                   parm                    w_pdat
6.35 c                   parm                    w_utgp
      *
     c                   parm                    w_osts
      *
     c                   parm                    w_ldor
     c                   parm                    w_lvar
     c                   parm                    w_eldo
     c                   parm                    w_grpr
     c                   parm                    w_gdat
      *
     c                   parm                    w_enh
     c                   parm                    w_enh1
     c                   parm                    w_enh2
     c                   parm                    w_enh3
     c                   parm                    w_eni1
     c                   parm                    w_eni2
     c                   parm                    w_eni3
     c                   parm                    w_enp1
     c                   parm                    w_enp2
     c                   parm                    w_enp3
     c                   parm                    w_ofp1
     c                   parm                    w_ofp2
     c                   parm                    w_ofp3
     c                   parm                    w_ofv2
     c                   parm                    w_ofv3
     c                   parm                    w_ofi1
     c                   parm                    w_ofi2
     c                   parm                    w_ofi3
      *
     c                   parm                    w_bldo
     c                   parm                    w_bogr
     c                   parm                    w_bhgr
     c                   parm                    w_bugr
     c                   parm                    w_bmod
     c                   parm                    w_bvar
     c                   parm                    w_bvty
     c                   parm                    w_blet
     c                   parm                    w_bbet
     c                   parm                    w_ntpr
     c                   parm                    w_ifak
      *
     c                   parm                    w_pogr
     c                   parm                    w_phgr
     c                   parm                    w_pugr
     c                   parm                    w_pldo
     c                   parm                    w_pmod
     c                   parm                    w_pvar
     c                   parm                    w_ppko
     c                   parm                    w_pvty
     c                   parm                    w_plet
     c                   parm                    w_kfak
     c                   parm                    w_kbel
     c                   parm                    w_sfak
      *
     c                   parm                    w_midl
     c                   parm                    w_inpr
     c                   parm                    w_kopr
     c                   parm                    w_s1pr
     c                   parm                    w_s1im
     c                   parm                    w_s2pr
     c                   parm                    w_s2im
     c                   parm                    w_s3pr
     c                   parm                    w_s3im
     c                   parm                    w_dekn
5.70 c                   parm                    w_prut
6.36 c                   parm                    w_ffak
6.36 c                   parm                    w_inp2
6.3x c                   parm                    w_pgbe
6.3y c                   parm                    w_pgfr
6.3y c                   parm                    w_oppd
      *
6.36 c                   eval(h)   w_inp2 = w_inpr * w_ffak
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppdaterer av EV og VA
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppdater      begsr
      *
6.12 c                   if        w_osts <> *blank
     c                   leavesr
     c                   endif
      *
6.31  * sjekk om det er logistikkvare
6.3t c                   eval      b_logv = *off
6.3t c                   eval      w_lv_vare  = *blank
6.3t c                   eval      w_lv_modn  = 0
6.3t c                   eval      w_lv_nobb  = 0
6.3t c                   eval      w_lv_lldo  = 0
6.3t c                   eval      w_lv_llva  = *blank
6.3t c                   eval      w_lv_luda  = *loval
6.3t c                   eval      w_lv_enum  = 0
6.31 c                   eval      jvkhl1_kvnr = jvvare
6.31 c     jvkhl1_key    chain     jvkhl1
6.31 c                   if        %found(jvkhl1)
6.31 c                   exsr      finn_logivar
6.31 c                   endif
      *
      * Henter EAN-nr og cross-docking informasjon fra pris
      *
     c                   eval      w_crdo = 0
6.19 c                   eval      w_eann = 0
      *
     c                   eval      jvprl1_vare = jvvare
     c                   eval      jvprl1_ldor = w_ldor
     c     jvprl1_key    chain     jvprl1
     c                   if        %found
6.33 c                   if        (jxtdat =  *loval) or
6.33 c                             (jxtdat <> *loval and
6.3c c                             jxtdat >= w_udat)
6.19 c                   eval      w_eann = jxeann
     c                   eval      w_crdo = jxcrdo
     c                   endif
6.33 c                   endif
      *
      * Henter statistikkenhet og lagerenhet fra varegruppe
      *
     c                   eval      w_enhs = *blank
     c                   eval      w_enhl = *blank
      *
     c                   eval      vugrl1_uogr = jvogrp
     c                   eval      vugrl1_uhgr = jvhgrp
     c                   eval      vugrl1_uugr = jvugrp
     c     vugrl1_key    chain     vugrl1
     c                   if        %found
     c                   eval      w_enhs = vguens
     c                   eval      w_enhl = vguenl
     c                   endif
      *
     c                   if        w_enhs = *blank or
     c                             w_enhl = *blank
     c                   eval      vhgrl1_hogr = jvogrp
     c                   eval      vhgrl1_hhgr = jvhgrp
     c     vhgrl1_key    chain     vhgrl1
     c                   if        %found
     c                   if        w_enhs = *blank
     c                   eval      w_enhs = vghens
     c                   endif
     c                   if        w_enhl = *blank
     c                   eval      w_enhl = vghenl
     c                   endif
     c                   endif
     c                   endif
      *
      * Oppretter EVR vare
      *
     c                   clear                   vvarlur
      *
     c                   eval      vvfirm = p_firm
     c                   eval      vvvare = jvvare
     c                   eval      vvtek1 = jvtek1
     c                   eval      vvtek2 = jvtek2
     c                   eval      vvogrp = jvogrp
     c                   eval      vvhgrp = jvhgrp
     c                   eval      vvugrp = jvugrp
6.14 c                   eval      vvsort = jvsort
     c                   eval      vvahgr = 0
     c                   eval      vvaugr = 0
     c                   eval      vvldor = w_eldo
6.3j c*                  if        b_logv = *on
6.3j c*                  eval      vvlvar = *blank
6.3j c*                  eval      vvnmod = w_lv_modn
6.3j c*                  eval      vvnlev = w_lv_lvar
6.3j c*                  eval      vvnobb = w_lv_nobb
6.3j c*                  else
     c                   eval      vvlvar = w_lvar
     c                   eval      vvnobb = jvnobb
     c                   eval      vvnmod = jvmodn
     c                   eval      vvnlev = w_ldor
6.3j c*                  endif
     c                   eval      vvkpri = jvdpko
     c                   eval      vvvtyp = 'L'
     c                   eval      vvenhe = w_enh1
     c                   eval      vvdesi = 2
     c                   eval      vvkstr = 00
     c                   eval      vvcrdo = w_crdo
     c                   eval      vvenhs = w_enhs
     c                   eval      vvenhl = w_enhl
     c                   eval      vvenps = *blank
     c                   eval      vvnuda = jvudat
     c                   eval      vveusr = l_user
      *
     c                   if        jvete1 <> *blank
     c                   eval      vvtek1 = jvete1
     c                   eval      vvtek2 = jvete2
     c                   endif
      *
     c                   if        jveogr <> 0 and
     c                             jvehgr <> 0 and
     c                             jveugr <> 0
     c                   eval      vvogrp = jveogr
     c                   eval      vvhgrp = jvehgr
     c                   eval      vvugrp = jveugr
     c                   endif
      *
     c                   if        jvdsko = 1
     c                   eval      vvvtyp = 'S'
     c                   endif
7.01  * dette overstyrer evt. alle andre parametersettinger
7.01 c                   if        u_701 = *on
7.01 c                   eval      vvvtyp = 'L'
7.01 c                   endif
      *
     c                   if        vvenhs = *blank or
     c                             vvenhs <> w_enh1 and
     c                             vvenhs <> w_enh2 and
     c                             vvenhs <> w_enh3 and
     c                             vvenhs <> w_eni1 and
     c                             vvenhs <> w_eni2 and
     c                             vvenhs <> w_eni3
     c                   eval      vvenhs = w_enh1
     c                   endif
      *
     c                   if        vvenhl = *blank or
     c                             vvenhl <> w_enh1 and
     c                             vvenhl <> w_enh2 and
     c                             vvenhl <> w_enh3 and
     c                             vvenhl <> w_eni1 and
     c                             vvenhl <> w_eni2 and
     c                             vvenhl <> w_eni3
     c                   eval      vvenhl = w_enh1
     c                   endif
      *
     c                   eval      jvpkl2_vare = jvvare
6.30 c                   eval      jvpkl2_ldor = p_pgiv
     c     jvpkl2_key2   setll     jvpkl2
     c     jvpkl2_key2   reade     jvpkl2
     c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
6.32 c                             jwpakn <> '000'
      *
     c                   if        jwpsen = 1
     c                   eval      vvenps = jwenhe
     c                   leave
     c                   endif
6.32 c                   endif
     c     jvpkl2_key2   reade     jvpkl2
     c                   enddo
      *
     c                   call      'VK700R'
     c                   parm                    p_firm
     c                   parm                    vvogrp
     c                   parm                    vvhgrp
     c                   parm                    vvugrp
     c                   parm                    vvldor
     c                   parm                    vvahgr
     c                   parm                    vvaugr
      *
     c                   time                    vvodat
     c                   time                    vvedat
     c                   time                    vvetim
      *
     c                   write     vvarlur
      *
5.70 c                   eval      b_oppd = *on
      *
      * Oppretter EVR vare-enhet
      *
     c                   exsr      oppr_enhet
      *
      * Oppretter EVR vare-pris
      *
     c                   exsr      oppr_pris
      *
6.3i  * Oppretter Vare-leverandør EVR
6.3i  *
6.3i c                   exsr      oppr_vare_lev
6.3i  *
      * Fjerner vare fra register over slettede varer
      *
     c                   eval      vvaslu_vare = jvvare
     c     vvaslu_key    chain     vvaslur
     c                   if        %found
     c                   delete    vvaslur
     c                   endif


      *
      * Oppretter vare i hovedlager dersom det er lagervare, og denne
      * ikke finnes i hovedlager fra før.
      *
6.23 c     fstsl1_key    chain     fstsl1
6.23 c*                  if        %found
6.23 c*                            faalag = 1
5.70  *
5.70 c     ra10l1_key    setll     ra10l1
5.70 c     ra10l1_key    reade     ra10l1
     c                   dow       not %eof(ra10l1)
5.70  *
5.70 c                   clear                   vlaglur
5.70 c                   eval      vlaglu_vare = jvvare
5.70 c                   eval      vlaglu_lage = rajkod
5.70 c     vlaglu_key    chain     vlaglu
5.70 c                   if        not %found(vlaglu)
      *
6.34 c                   exsr      sjekk_ledtid
      *
5.70 c                   eval      vlfirm = w_firm
5.70 c                   eval      vlvare = jvvare
5.70 c                   eval      vllage = rajkod
5.70 c                   eval      vlenhl = vvenhl
5.70 c                   eval      vltrda = w_udat
5.71 c                   if        vllage = faahla
5.71 c                   eval      vlvtyp = 'L'
5.71 c                   else
5.71 c                   if        faavty = *blank
5.71 c                   eval      vlvtyp = 'S'
5.71 c                   else
5.70 c                   eval      vlvtyp = faavty
5.71 c                   endif
5.70 c                   endif
6.1c  * hvis VA sier skaffevare, blir det S uansett
6.1c c                   if        jvdsko = 1
6.1c c                   eval      vlvtyp = 'S'
6.1c c                   endif
7.01  * dette overstyrer evt. alle andre parametersettinger
7.01 c                   if        u_701 = *on
7.01 c                   eval      vlvtyp = 'S'
7.01 c                   endif
6.1c c                   time                    vlodat
6.1c c                   time                    vlotim
6.1c c                   time                    vledat
6.1c c                   time                    vletim
6.1c c                   eval      vlousr = l_user
6.1c c                   eval      vleusr = l_user
5.70 c                   write     vlaglur
5.70 c                   endif
5.70  *
5.70 c     ra10l1_key    reade     ra10l1
5.70 c                   enddo
6.23  *
6.23  * Hvis lager kjøres, så oppdateres div lagerakkumulatorer
6.23  *
6.23 c     fstsl1_key    chain     fstsl1
6.23 c                   if        %found and
6.23 c                             faalag = 1
6.21  *
6.21  * Oppdaterer ordre-akkumulatorer
6.21  *
6.21 c                   call      'FO761R'
6.21 c                   parm                    w_firm
6.21 c                   parm                    jvvare
6.21  *
6.21  * Oppdaterer bestillings-akkumulatorer
6.21  *
6.21 c                   call      'LA921R'
6.21 c                   parm                    w_firm
6.21 c                   parm                    jvvare
5.70  *
     c                   endif
      *
      * Oppretter søketekster i EVR lik modulstikkord og egne søketekster
      * Søketeksten blir ikke kopiert over dersom den allerede finnes i
      * EVR søketekstregister
      *
     c                   eval      jsokl1_vare = jvvare
     c     jsokl1_key    setll     jsokl1
     c     jsokl1_key    reade     jsokl1
     c                   dow       not %eof
     c                   if        jsokod = 'L' or
     c                             jsokod = 'M' and
     c                             w_kmod = 1
     c                   eval      vsokl1_vare = jsvare
     c                   eval      vsokl1_stek = jsstek
     c     vsokl1_key    chain     vsokl1
     c                   if        not %found
     c                   eval      vsfirm = w_firm
     c                   eval      vsvare = jsvare
     c                   eval      vsstek = jsstek
     c                   write     vsoklur
     c                   endif
     c                   endif
     c     jsokl1_key    reade     jsokl1
     c                   enddo
      *
      * Oppdaterer søketekst mot vare i EVR
      *
     c                   call      'VV750R'
     c                   parm                    w_firm
     c                   parm                    jvvare
      *
6.13 c                   if        jvean1 <> 0
6.11  *
6.13  * sjekker om ean-nr allerede ligger på vare  enhet
6.13  * hvis ikke så legges den i generelt ean-nr register
6.11  *
6.16 c                   eval      vvepl2_pgti = jvean1
6.16 c     vvepl2_key    chain     vvepl2
6.16 c                   if        not %found(vvepl2)
6.11  *
5.60 c                   clear                   veanlur
5.60 c                   eval      veanl1_eann = jvean1
5.60 c     veanl1_key    chain     veanl1
5.60 c                   if        not %found
     c                   eval      vxfirm = w_firm
     c                   eval      vxvare = jvvare
5.60 c                   eval      vxenhe = *blank
     c                   eval      vxeann = jvean1
     c                   eval      vxeusr = l_user
     c                   time                    vxtime
     c                   time                    vxedat
     c                   time                    vxetim
     c                   write     veanlur
5.60 c                   else
5.60 c                   if        vxvare <> jvvare
5.60 c                   eval      veanlu_eann = jvean1
5.60 c     veanlu_key    chain     veanlur
5.60 c                   if        %found(veanlu)
5.60 c                   eval      vxvare = jvvare
5.60 c                   eval      vxenhe = *blank
5.60 c                   time                    vxetim
5.60 c                   time                    vxedat
5.60 c                   update    veanlur
5.60 c                   endif
5.60 c                   endif
5.60 c                   endif
      *
6.11 c                   endif
      *
     c                   endif
6.19 c                   if        w_eann <> 0
6.19  * Ean-nr fra varepris
6.19  * sjekker om ean-nr allerede ligger på vare  enhet
6.19  * hvis ikke så legges den i generelt ean-nr register
6.19  *
6.19 c                   eval      vvepl2_pgti = w_eann
6.19 c     vvepl2_key    chain     vvepl2
6.19 c                   if        not %found(vvepl2)
6.19  *
6.19 c                   clear                   veanlur
6.19 c                   eval      veanl1_eann = w_eann
6.19 c     veanl1_key    chain     veanl1
6.19 c                   if        not %found
6.19 c                   eval      vxfirm = w_firm
6.19 c                   eval      vxvare = jvvare
6.19 c                   eval      vxenhe = *blank
6.19 c                   eval      vxeann = w_eann
6.19 c                   eval      vxeusr = l_user
6.19 c                   time                    vxtime
6.19 c                   time                    vxedat
6.19 c                   time                    vxetim
6.19 c                   write     veanlur
6.19 c                   else
6.19 c                   if        vxvare <> jvvare
6.19 c                   eval      veanlu_eann = w_eann
6.19 c     veanlu_key    chain     veanlur
6.19 c                   if        %found(veanlu)
6.19 c                   eval      vxvare = jvvare
6.19 c                   eval      vxenhe = *blank
6.19 c                   time                    vxetim
6.19 c                   time                    vxedat
6.19 c                   update    veanlur
6.19 c                   endif
6.19 c                   endif
6.19 c                   endif
6.19  *
6.19 c                   endif
6.19  *
6.19 c                   endif
      *
      * Fjerner rad fra midlertidig prisendrings-register
      *
     c                   eval      jwprlu_vare = jvvare
     c     jwprlu_key    chain     jwprlur
     c                   if        %found
     c                   delete    jwprlur
     c                   endif
      *
      * Legger varen på Hold, og endrer til skaffevare dersom dette er valgt
      *
     c                   clear                   jvdtlur
      *
     c                   eval      jvdtlu_dvar = jvvare
     c     jvdtlu_key    chain     jvdtlur
      *
     c                   eval      jvdhko = 1
     c                   if        p_skaf = 1
     c                   eval      jvdsko = 1
     c                   endif
      *
     c                   if        %found
     c                   update    jvdtlur
     c                   else
     c                   eval      jvdfir = w_firm
     c                   eval      jvdvar = jvvare
     c                   write     jvdtlur
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppretting av enheter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppr_enhet    begsr
      *
     c                   clear                   vvenlur
      *
      * Salgsenhet-1
      *
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
     c                   eval      vefirm = w_firm
     c                   eval      vevare = jvvare
     c                   eval      veenhe = w_enh1
     c                   eval      vesaen = 1
     c                   eval      veinen = 0
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
     c                   eval      veeusr = l_user
      *
     c                   time                    veodat
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   select
     c                   when      veenhe = w_eni1
     c                   eval      veinen = 1
     c                   when      veenhe = w_eni2
     c                   eval      veinen = 2
     c                   when      veenhe = w_eni3
     c                   eval      veinen = 3
     c                   endsl
      *
     c                   select
     c                   when      veenhe = w_enp1
     c                   eval      vepben = 1
     c                   when      veenhe = w_enp2
     c                   eval      vepben = 2
     c                   when      veenhe = w_enp3
     c                   eval      vepben = 3
     c                   endsl
      *
     c                   eval      jvpkl2_vare = vevare
6.30 c                   eval      jvpkl2_ldor = p_pgiv
     c                   eval      jvpkl2_enhe = veenhe
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
6.32 c                             jwpakn <> '000'
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   write     vvenlur
6.16  *
6.16  * oppretter vare-pakning-prisgiver
6.16 c                   exsr      oppr_vep
      *
      * Salgsenhet-2
      *
     c                   if        w_enh2 <> *blank
      *
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_enh2
     c                   eval      vesaen = 2
     c                   eval      veinen = 0
     c                   eval      vepben = 0
     c                   eval      veomre = w_ofv2
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   select
     c                   when      veenhe = w_eni1
     c                   eval      veinen = 1
     c                   when      veenhe = w_eni2
     c                   eval      veinen = 2
     c                   when      veenhe = w_eni3
     c                   eval      veinen = 3
     c                   endsl
      *
     c                   select
     c                   when      veenhe = w_enp1
     c                   eval      vepben = 1
     c                   when      veenhe = w_enp2
     c                   eval      vepben = 2
     c                   when      veenhe = w_enp3
     c                   eval      vepben = 3
     c                   endsl
      *
     c                   eval      jvpkl2_vare = vevare
6.30 c                   eval      jvpkl2_ldor = p_pgiv
     c                   eval      jvpkl2_enhe = veenhe
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
6.32 c                             jwpakn <> '000'
6.32  *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   write     vvenlur
6.16  *
6.16  * oppretter vare-pakning-prisgiver
6.16 c                   exsr      oppr_vep
      *
     c                   endif
      *
      * Salgsenhet-3
      *
     c                   if        w_enh3 <> *blank
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_enh3
     c                   eval      vesaen = 3
     c                   eval      veinen = 0
     c                   eval      vepben = 0
     c                   eval      veomre = w_ofv3
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   select
     c                   when      veenhe = w_eni1
     c                   eval      veinen = 1
     c                   when      veenhe = w_eni2
     c                   eval      veinen = 2
     c                   when      veenhe = w_eni3
     c                   eval      veinen = 3
     c                   endsl
      *
     c                   select
     c                   when      veenhe = w_enp1
     c                   eval      vepben = 1
     c                   when      veenhe = w_enp2
     c                   eval      vepben = 2
     c                   when      veenhe = w_enp3
     c                   eval      vepben = 3
     c                   endsl
      *
     c                   eval      jvpkl2_vare = vevare
6.30 c                   eval      jvpkl2_ldor = p_pgiv
     c                   eval      jvpkl2_enhe = veenhe
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
6.32 c                             jwpakn <> '000'
6.32  *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   write     vvenlur
6.16  *
6.16  * oppretter vare-pakning-prisgiver
6.16 c                   exsr      oppr_vep
      *
     c                   endif
      *
      * Innkjøpsenhet-1
      *
     c                   if        w_eni1 <> *blank and
     c                             w_eni1 <> w_enh1 and
     c                             w_eni1 <> w_enh2 and
     c                             w_eni1 <> w_enh3
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_eni1
     c                   eval      vesaen = 0
     c                   eval      veinen = 1
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   eval      jvpkl2_vare = vevare
6.30 c                   eval      jvpkl2_ldor = p_pgiv
     c                   eval      jvpkl2_enhe = veenhe
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
6.32 c                             jwpakn <> '000'
6.32  *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      veomre = w_ofi1
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   write     vvenlur
      *
6.24  * oppretter vare-pakning-prisgiver
6.24 c                   exsr      oppr_vep
      *
     c                   endif
      *
      * Innkjøpsenhet-2
      *
     c                   if        w_eni2 <> *blank and
     c                             w_eni2 <> w_enh1 and
     c                             w_eni2 <> w_enh2 and
     c                             w_eni2 <> w_enh3
      *
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_eni2
     c                   eval      vesaen = 0
     c                   eval      veinen = 2
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   eval      jvpkl2_vare = vevare
6.30 c                   eval      jvpkl2_ldor = p_pgiv
     c                   eval      jvpkl2_enhe = veenhe
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
6.32 c                             jwpakn <> '000'
6.32  *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      veomre = w_ofi2
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   write     vvenlur
6.24  *
6.24  * oppretter vare-pakning-prisgiver
6.24 c                   exsr      oppr_vep
      *
     c                   endif
      *
      * Innkjøpsenhet-3
      *
     c                   if        w_eni3 <> *blank and
     c                             w_eni3 <> w_enh1 and
     c                             w_eni3 <> w_enh2 and
     c                             w_eni3 <> w_enh3
      *
6.34 c                   eval      w_gtin = 0
6.34 c                   eval      w_pkla = *blank
6.34 c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_eni3
     c                   eval      vesaen = 0
     c                   eval      veinen = 3
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   eval      jvpkl2_vare = vevare
6.30 c                   eval      jvpkl2_ldor = p_pgiv
     c                   eval      jvpkl2_enhe = veenhe
6.32 c     jvpkl2_key    setll     jvpkl2
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   dow       not %eof
6.32  *
6.32  * sjekker fra / tildato
6.32 c                   exsr      sjekk_pkdato
6.32 c                   if        b_pakn = *on  and
6.32 c                             jwpakn <> '000'
6.32  *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      veomre = w_ofi3
6.34 c                   eval      w_gtin = jwgtin
6.34 c                   eval      w_pkla = jwpkla
6.34 c                   eval      w_best = jwbest
     c                   endif
6.32 c     jvpkl2_key    reade     jvpkl2
6.32 c                   enddo
      *
     c                   write     vvenlur
6.24  *
6.24  * oppretter vare-pakning-prisgiver
6.24 c                   exsr      oppr_vep
      *
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppretting av vare-pris på leveringstype
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppr_pris     begsr
      *
     c                   clear                   vvprlur
      *
      * Salgsenheter
      *
     c                   eval      vpfirm = p_firm
     c                   eval      vpvare = jvvare
6.20 c                   eval      vpldor = w_eldo
5.70 c                   eval      vpprgr = w_prgr
     c                   eval      vplety = w_lety
     c                   eval      vpenhe = w_enh1
     c                   eval      vpsapr = w_s1pr
     c                   eval      vpkopr = w_kopr
     c                   eval      vpinpr = w_inpr
6.36 c                   eval      vpinp2 = w_inp2
6.3h c                   eval      vpnopr = w_grpr
     c                   eval      vpbupr = 0
     c                   eval      vpeusr = l_user
      *
5.61 c                   if        w_gdat = *loval
5.61 c                   time                    vppdat
5.61 c                   else
     c                   eval      vppdat = w_gdat
5.61 c                   endif
     c                   time                    vpedat
     c                   time                    vpetim
      *
     c                   write     vvprlur
      *
     c                   if        w_s2pr <> 0
     c                   eval      vpenhe = w_enh2
     c                   eval      vpsapr = w_s2pr
     c                   eval(h)   vpkopr = w_kopr * w_ofv2
     c                   eval(h)   vpinpr = w_inpr * w_ofv2
6.36 c                   eval(h)   vpinp2 = w_inp2 * w_ofv2
6.3u c                   eval      vpnopr = w_grpr * w_ofv2
     c                   write     vvprlur
     c                   endif
      *
     c                   if        w_s3pr <> 0
     c                   eval      vpenhe = w_enh3
     c                   eval      vpsapr = w_s3pr
     c                   eval(h)   vpkopr = w_kopr * w_ofv3
     c                   eval(h)   vpinpr = w_inpr * w_ofv3
6.36 c                   eval(h)   vpinp2 = w_inp2 * w_ofv3
6.3u c                   eval      vpnopr = w_grpr * w_ofv3
     c                   write     vvprlur
     c                   endif
      *
      * Innkjøpsenheter
      *
     c                   if        w_eni1 <> *blank and
     c                             w_eni1 <> w_enh1 and
     c                             w_eni1 <> w_enh2 and
     c                             w_eni1 <> w_enh3
     c                   eval      vpenhe = w_eni1
     c                   eval      vpsapr = 0
     c                   eval(h)   vpkopr = w_kopr * w_ofi1
     c                   eval(h)   vpinpr = w_inpr * w_ofi1
6.36 c                   eval(h)   vpinp2 = w_inp2 * w_ofi1
6.3u c                   eval(h)   vpnopr = w_grpr * w_ofi1
     c                   write     vvprlur
     c                   endif
      *
     c                   if        w_eni2 <> *blank and
     c                             w_eni2 <> w_enh1 and
     c                             w_eni2 <> w_enh2 and
     c                             w_eni2 <> w_enh3
     c                   eval      vpenhe = w_eni2
     c                   eval      vpsapr = 0
     c                   eval(h)   vpkopr = w_kopr * w_ofi2
     c                   eval(h)   vpinpr = w_inpr * w_ofi2
6.36 c                   eval(h)   vpinp2 = w_inp2 * w_ofi2
6.3u c                   eval(h)   vpnopr = w_grpr * w_ofi2
     c                   write     vvprlur
     c                   endif
      *
     c                   if        w_eni3 <> *blank and
     c                             w_eni3 <> w_enh1 and
     c                             w_eni3 <> w_enh2 and
     c                             w_eni3 <> w_enh3
     c                   eval      vpenhe = w_eni3
     c                   eval      vpsapr = 0
     c                   eval(h)   vpkopr = w_kopr * w_ofi3
     c                   eval(h)   vpinpr = w_inpr * w_ofi3
6.36 c                   eval(h)   vpinp2 = w_inp2 * w_ofi3
6.3u c                   eval(h)   vpnopr = w_grpr * w_ofi3
     c                   write     vvprlur
     c                   endif
      *
     c                   endsr
6.3i  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3i  * Subrutine for oppretting av vare-leverandør
6.3i  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3i  *
6.3i c     oppr_vare_lev begsr
6.3i  *
      *
6.3i c                   clear                   vvlelur
6.3i  *
6.3i c                   eval      vvlelu_lvnr = jvvare
6.3i c                   eval      vvlelu_lldo = w_eldo
6.3i c     vvlelu_key    chain     vvlelu
6.31 c                   if        b_logv = *on
6.3i c                   eval      vvlnob = w_lv_nobb
6.3i c                   eval      vvlmod = w_lv_modn
6.3i c                   eval      vvllva = w_lv_llva
6.3i c                   eval      vvluda = w_lv_luda
6.3i c                   eval      vvlnle = w_lv_lldo
6.31 c                   else
6.3i c                   eval      vvlnob = jvnobb
6.3i c                   eval      vvlmod = jvmodn
6.3i c                   eval      vvllva = jvllva
6.3i c                   eval      vvluda = jvluda
6.3i c                   eval      vvlnle = jvlldo
6.31 c                   endif
6.3i c                   eval      vvleus = l_user
6.3i c                   time                    vvleda
6.3i c                   time                    vvleti
6.3i c                   if        %found(vvlelu)
6.3i c                   update    vvlelur
6.3i c                   else
6.3t c                   eval      vvlous = l_user
6.3t c                   time                    vvloda
6.3t c                   time                    vvloti
6.3i c                   eval      vvlfir = l_firm
6.3i c                   eval      vvlvnr = vvlelu_lvnr
6.3i c                   eval      vvlldo = vvlelu_lldo
6.3i c                   write     vvlelur
6.3i c                   endif
6.3i  *
6.3i c                   endsr
6.3i  *
6.3i  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3i  * Finn info om logistikkvare for riktig prisgiver
6.3i  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3i  *
6.3i c     finn_logivar  begsr
6.3i  *
6.3t c*                   eval      b_logv = *off
6.3t c*                   eval      w_lv_vare  = *blank
6.3t c*                   eval      w_lv_modn  = 0
6.3t c*                   eval      w_lv_nobb  = 0
6.3t c*                   eval      w_lv_lldo  = 0
6.3t c*                   eval      w_lv_llva  = *blank
6.3t c*                   eval      w_lv_luda  = *loval
6.3t c*                   eval      w_lv_enum  = 0
6.3i c/exec sql
6.3i c+ select jvvare,
6.3i c+        jvmodn,
6.3i c+        jvnobb,
6.3i c+        jvlldo,
6.3i c+        jvllva,
6.3i c+        jvluda,
6.3i c+        jlenum
     c+ into   :w_lv_vare,
     c+        :w_lv_modn,
     c+        :w_lv_nobb,
     c+        :w_lv_lldo,
     c+        :w_lv_llva,
     c+        :w_lv_luda,
     c+        :w_lv_enum
6.3i c+ from   jvlepf
6.3i c+ inner join jvarpf on jvlvnr = jvvare
6.3i c+ inner join jlevpf on jlldor = jvlldo
6.3i c+ where  jvlldo = :w_ldor and
6.3i c+        jvlvnr =
6.3i c+ (select jvquno from jvklpf where jvqvnr = :jvvare
     c+                              and jvqfir = :w_firm
6.3i c+         and jvqldo = :w_ldor fetch first 1 rows only)
6.3i c/end-exec
6.3i c
6.3i  *
6.3i c                   if        sqlcod = 100 or sqlstt = '02000'
6.3i c                   leavesr
6.3i c                   endif
6.3i c                   if        sqlcod <> 0
6.3i c                   leavesr
6.3i c                   endif
6.3i  *
6.3i c                   eval      b_logv = *on
6.3i  *
6.3i c                   endsr
6.3i  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift av detaljlinje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     detalj        begsr
6.37  * Nullstiller alle "gamle" verdier, så de ikke skal ligge igjen i regneark
6.37 c                   if        b_excl = *on
6.37 c                   exsr      exc_clear
6.37 c                   endif
6.37  *
      * Flytter felter til kvitteringsvariable
      *
     c                   eval      d1osts = w_osts
     c                   eval      d1ogrp = jvogrp
     c                   eval      d1hgrp = jvhgrp
     c                   eval      d1ugrp = jvugrp
6.14 c                   eval      d1sort = jvsort
     c                   eval      d1vare = jvvare
     c                   eval      d1nobb = jvnobb
     c                   eval      d1lvar = w_lvar
     c                   eval      d1beti = w_bbet
     c                   eval      d1lety = w_lety
5.70 c                   eval      d1prgr = w_prgr
     c                   eval      d1enh1 = w_enh1
     c                   eval      d1inpr = w_inpr
     c                   eval      d1kopr = w_kopr
     c                   eval      d1s1pr = w_s1pr
     c                   eval      d1s1im = w_s1im
     c                   eval      d1dekn = w_dekn
     c                   eval      d1pkod = jvdpko
     c                   eval      d1vtyp = *blank
      *
     c                   if        jvete1 <> *blank
     c                   eval      d1tek1 = jvete1
     c                   else
     c                   eval      d1tek1 = jvtek1
     c                   endif
      *
     c                   if        jveogr <> 0 and
     c                             jvehgr <> 0 and
     c                             jveugr <> 0
     c                   eval      d1ogrp = jveogr
     c                   eval      d1hgrp = jvehgr
     c                   eval      d1ugrp = jveugr
     c                   endif
      *
     c                   if        jvdsko = 1
     c                   eval      d1vtyp = 'S'
     c                   endif
      *
      * Henter navn på prisgivende leverandør
      *
     c                   eval      d1lnav = *blank
     c                   eval      jlevl1_ldor = w_ldor
     c     jlevl1_key    chain     jlevl1
     c                   if        %found
     c                   eval      d1lnav = jlnavn
     c                   endif
      *
      * Skriv detaljlinje
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d1dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
      * Salgsenhet-2
      *
     c                   if        w_enh2 <> *blank
     c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
     c                   eval      d3enhe = w_enh2
     c                   eval      d3sapr = w_s2pr
     c                   eval      d3saim = w_s2im
6.3d  *
6.3d c                   eval      ds2lty = w_lety
6.3d c                   eval      ds2prg = w_prgr
6.3d c                   eval      ds2enh = w_enh2
6.3d c                   eval      ds2sap = w_s2pr
6.3d c                   eval      ds2sai = w_s2im
6.3d  *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d3dtl                                30
     c                   exsr      overflow
     c                   endif
6.37 c                   endif
      *
      * Salgsenhet-3
      *
     c                   if        w_enh3 <> *blank
     c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
     c                   eval      d3enhe = w_enh3
     c                   eval      d3sapr = w_s3pr
     c                   eval      d3saim = w_s3im
6.3d  *
6.3d c                   eval      ds3lty = w_lety
6.3d c                   eval      ds3prg = w_prgr
6.3d c                   eval      ds3enh = w_enh3
6.3d c                   eval      ds3sap = w_s3pr
6.3d c                   eval      ds3sai = w_s3im
6.3d  *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d3dtl                                30
     c                   exsr      overflow
     c                   endif
6.37 c                   endif
      *
      * Innkjøpsenhet-1
      *
     c                   if        w_eni1 <> *blank and
     c                             w_eni1 <> w_enh1 and
     c                             w_eni1 <> w_enh2 and
     c                             w_eni1 <> w_enh3
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4lety = w_lety
     c                   eval      d4enhe = w_eni1
     c                   eval      d4inpr = w_inpr * w_ofi1
     c                   eval      d4kopr = w_kopr * w_ofi1
      *
6.3d c                   eval      di1prg = w_prgr
6.3d c                   eval      di1lty = w_lety
6.3d c                   eval      di1enh = w_eni1
6.3d c                   eval      di1inp = w_inpr * w_ofi1
6.3d c                   eval      di1kop = w_kopr * w_ofi1
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d4dtl                                30
     c                   exsr      overflow
     c                   endif
6.37 c                   endif
      *
      * Innkjøpsenhet-2
      *
     c                   if        w_eni2 <> *blank and
     c                             w_eni2 <> w_enh1 and
     c                             w_eni2 <> w_enh2 and
     c                             w_eni2 <> w_enh3
     c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4enhe = w_eni2
     c                   eval      d4inpr = w_inpr * w_ofi2
     c                   eval      d4kopr = w_kopr * w_ofi2
      *
6.3d c                   eval      di2lty = w_lety
6.3d c                   eval      di2prg = w_prgr
6.3d c                   eval      di2enh = w_eni2
6.3d c                   eval      di2inp = w_inpr * w_ofi2
6.3d c                   eval      di2kop = w_kopr * w_ofi2
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d4dtl                                30
     c                   exsr      overflow
     c                   endif
6.37 c                   endif
      *
      * Innkjøpsenhet-3
      *
     c                   if        w_eni3 <> *blank and
     c                             w_eni3 <> w_enh1 and
     c                             w_eni3 <> w_enh2 and
     c                             w_eni3 <> w_enh3
     c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4enhe = w_eni3
     c                   eval      d4inpr = w_inpr * w_ofi3
     c                   eval      d4kopr = w_kopr * w_ofi3
      *
6.3d c                   eval      di3lty = w_lety
6.3d c                   eval      di3prg = w_prgr
6.3d c                   eval      di3enh = w_eni3
6.3d c                   eval      di3inp = w_inpr * w_ofi3
6.3d c                   eval      di3kop = w_kopr * w_ofi3
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d4dtl                                30
     c                   exsr      overflow
     c                   endif
6.37 c                   endif
6.3d  *
6.3d c                   if        b_excl = *on
6.3d c                   exsr      xml_detal
6.3d c                   endif
      *
     c                   endsr
      *
5.70  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.70  * Subrutine utskrift av feillinje - hvis ikke oppd.
5.70  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.70  *
5.70 c     skr_feil      begsr
6.3d  *
6.3d  * Nullstiller alle "gamle" verdier, så de ikke skal ligge igjen i regneark
6.3d  *
6.3d c                   if        b_excl = *on
6.3d c                   exsr      exc_clear2
6.3d c                   endif
5.70  *
5.70  * Flytter felter til kvitteringsvariable
5.70  *
5.70 c                   eval      d5osts = w_osts
5.70 c                   eval      d5ogrp = jvogrp
5.70 c                   eval      d5hgrp = jvhgrp
5.70 c                   eval      d5ugrp = jvugrp
5.70 c                   eval      d5vare = jvvare
5.70 c                   eval      d5nobb = jvnobb
5.70 c                   eval      d5lvar = w_lvar
5.70 c** 6.3g            eval      d5text = 'Påslag mangler på std. prisgr.'
6.3g c                   eval      d5text = 'Betingelse mangler på std. prisgr.'
6.37 c                   if        b_excl = *on
6.37 c                   exsr      xml_detal
6.37 c                   else
5.70 c                   write     d5dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70  *
5.70 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av overflow
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     overflow      begsr
      *
     c                   if        *in30 = *on
     c                   write     a1hdr
     c                   write     a3hdr
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av priser/kalkyler på andre leveringstyper
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     leveringstype begsr
5.70  *
5.70  * Behandler priser/kalkyler på andre prisgrupper
5.70  * med valgt leveringstype
5.70  *
5.70 c     ra30l1_key    setll     ra30l1
5.70 c     ra30l1_key    reade     ra30l1
5.70 c                   dow       not %eof
5.70 c                   if        redkod <> *blank
5.70 c                   eval      w_lety = vylety
5.70 c                   eval      b_lety = *on
5.70 c                   exsr      prisgruppe
5.70 c                   endif
5.70 c     ra30l1_key    reade     ra30l1
5.70 c                   enddo
      *
      * Henter kalkulerte verdier for leveringstype
      *
     c                   eval      w_lety = vylety
6.25 c                   eval      w_prgr = *blank
     c                   eval      w_gprk = 0
      *
     c                   exsr      hent_data
      *
      * Avbryter dersom det ikke ble funnet kalkyle på valgt
      * leveringstype
      *
6.12 c                   if        w_osts <> *blank
     c                   leavesr
     c                   endif
      *
     c                   if        w_blet = 0 and
     c                             w_plet = 0
     c                   leavesr
     c                   endif
6.3d  * Nullstiller "gamle" verdier, så de ikke skal ligge igjen i regneark
6.3d c                   if        b_excl = *on
6.3d c                   exsr      exc_clear2
6.3d c                   endif
      *
      * Oppretter priser på leveringstype
      *
     c                   if        p_kntr = 0
     c                   exsr      oppr_pris
     c                   endif
      *
      * Skriv til detaljlinje
      *
      * Salgsenhet-1
      *
     c                   eval      d2lety = w_lety
5.70 c                   eval      d2prgr = w_prgr
     c                   eval      d2enh1 = w_enh1
     c                   eval      d2inpr = w_inpr
5.70 c                   eval      d2kopr = w_kopr
     c                   eval      d2s1pr = w_s1pr
     c                   eval      d2s1im = w_s1im
     c                   eval      d2dekn = w_dekn
     c                   eval      d2lety = w_lety
      *
6.3d c                   eval      dt2prg = w_prgr
6.3d c                   eval      dt2enh = w_enh1
6.3d c                   eval      dt2inp = w_inpr
6.3d c                   eval      dt2kop = w_kopr
6.3d c                   eval      dt2s1p = w_s1pr
6.3d c                   eval      dt2s1i = w_s1im
6.3d c                   eval      dt2dek = w_dekn
6.3d c                   eval      dt2lty = w_lety
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d2dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
      *
      * Salgsenhet-2
      *
     c                   if        w_enh2 <> *blank
     c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
     c                   eval      d3enhe = w_enh2
     c                   eval      d3sapr = w_s2pr
     c                   eval      d3saim = w_s2im
      *
6.3d c                   eval      ds2lty = w_lety
6.3d c                   eval      ds2prg = w_prgr
6.3d c                   eval      ds2enh = w_enh2
6.3d c                   eval      ds2sap = w_s2pr
6.3d c                   eval      ds2sai = w_s2im
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d3dtl                                30
     c                   exsr      overflow
6.37 c                   endif
     c                   endif
      *
      * Salgsenhet-3
      *
     c                   if        w_enh3 <> *blank
     c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
     c                   eval      d3enhe = w_enh3
     c                   eval      d3sapr = w_s3pr
     c                   eval      d3saim = w_s3im
      *
6.3d c                   eval      ds3lty = w_lety
6.3d c                   eval      ds3prg = w_prgr
6.3d c                   eval      ds3enh = w_enh3
6.3d c                   eval      ds3sap = w_s3pr
6.3d c                   eval      ds3sai = w_s3im
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d3dtl                                30
     c                   exsr      overflow
6.37 c                   endif
     c                   endif
      *
      * Innkjøpsenhet-1
      *
     c                   if        w_eni1 <> *blank and
     c                             w_eni1 <> w_enh1 and
     c                             w_eni1 <> w_enh2 and
     c                             w_eni1 <> w_enh3
     c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4enhe = w_eni1
     c                   eval      d4inpr = w_inpr * w_ofi1
     c                   eval      d4kopr = w_kopr * w_ofi1
      *
6.3d c                   eval      di1prg = w_prgr
6.3d c                   eval      di1lty = w_lety
6.3d c                   eval      di1enh = w_eni1
6.3d c                   eval      di1inp = w_inpr * w_ofi1
6.3d c                   eval      di1kop = w_kopr * w_ofi1
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
     c                   endif
      *
      * Innkjøpsenhet-2
      *
     c                   if        w_eni2 <> *blank and
     c                             w_eni2 <> w_enh1 and
     c                             w_eni2 <> w_enh2 and
     c                             w_eni2 <> w_enh3
     c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4enhe = w_eni2
     c                   eval      d4inpr = w_inpr * w_ofi2
     c                   eval      d4kopr = w_kopr * w_ofi2
      *
6.3d c                   eval      di2prg = w_prgr
6.3d c                   eval      di2lty = w_lety
6.3d c                   eval      di2enh = w_eni2
6.3d c                   eval      di2inp = w_inpr * w_ofi2
6.3d c                   eval      di2kop = w_kopr * w_ofi2
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
     c                   endif
      *
      * Innkjøpsenhet-3
      *
     c                   if        w_eni3 <> *blank and
     c                             w_eni3 <> w_enh1 and
     c                             w_eni3 <> w_enh2 and
     c                             w_eni3 <> w_enh3
     c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4enhe = w_eni3
     c                   eval      d4inpr = w_inpr * w_ofi3
     c                   eval      d4kopr = w_kopr * w_ofi3
      *
6.3d c                   eval      di3prg = w_prgr
6.3d c                   eval      di3lty = w_lety
6.3d c                   eval      di3enh = w_eni3
6.3d c                   eval      di3inp = w_inpr * w_ofi3
6.3d c                   eval      di3kop = w_kopr * w_ofi3
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
     c                   endif
      *
     c                   endsr
5.70  *
5.70  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.70  * Subrutine for behandling av priser/kalkyler på andre prisgrupper
5.70  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.70  *
5.70 c     prisgruppe    begsr
5.70  *
5.70  * Henter kalkulerte verdier for leveringstype
5.70  *
5.70 c                   eval      w_prgr = redkod
5.70 c                   eval      w_gprk = 0
5.70  *
5.70 c                   exsr      hent_data
5.70  *
5.70  * Avbryter dersom det ikke ble funnet kalkyle på valgt
5.70  * leveringstype
5.70  *
6.12 c                   if        w_osts <> *blank
5.70 c                   leavesr
5.70 c                   endif
5.70  *
6.3x c                   if        w_prut = *blank  and
6.3x c                             w_pgbe = *blank  and
6.3x c                             w_pgfr = *blank
5.70 c                   leavesr
5.70 c                   endif
5.70  *
5.70 c                   if        b_lety = *on and
5.70 c                             w_blet = 0 and
5.70 c                             w_plet = 0
5.70 c                   leavesr
5.70 c                   endif
6.3d  * Nullstiller "gamle" verdier, så de ikke skal ligge igjen i regneark
6.3d c                   if        b_excl = *on
6.3d c                   exsr      exc_clear2
6.3d c                   endif
5.70  *
5.70  * Oppretter priser på leveringstype
5.70  *
5.70 c                   if        p_kntr = 0
5.70 c                   exsr      oppr_pris
5.70 c                   endif
5.70  *
5.70  * Skriv til detaljlinje
5.70  *
5.70  * Salgsenhet-1
5.70  *
5.70 c                   eval      d2lety = w_lety
5.70 c                   eval      d2prgr = w_prgr
5.70 c                   eval      d2enh1 = w_enh1
5.70 c                   eval      d2inpr = w_inpr
5.70 c                   eval      d2kopr = w_kopr
5.70 c                   eval      d2s1pr = w_s1pr
5.70 c                   eval      d2s1im = w_s1im
5.70 c                   eval      d2dekn = w_dekn
      *
6.3d c                   eval      dt2lty = w_lety
6.3d c                   eval      dt2prg = w_prgr
6.3d c                   eval      dt2enh = w_enh1
6.3d c                   eval      dt2inp = w_inpr
6.3d c                   eval      dt2kop = w_kopr
6.3d c                   eval      dt2s1p = w_s1pr
6.3d c                   eval      dt2s1i = w_s1im
6.3d c                   eval      dt2dek = w_dekn
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
5.70 c                   write     d2dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70  *
5.70  *
5.70  * Salgsenhet-2
5.70  *
5.70 c                   if        w_enh2 <> *blank
5.70 c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
5.70 c                   eval      d3enhe = w_enh2
5.70 c                   eval      d3sapr = w_s2pr
5.70 c                   eval      d3saim = w_s2im
      *
6.3d c                   eval      ds2lty = w_lety
6.3d c                   eval      ds2prg = w_prgr
6.3d c                   eval      ds2enh = w_enh2
6.3d c                   eval      ds2sap = w_s2pr
6.3d c                   eval      ds2sai = w_s2im
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
5.70 c                   write     d3dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70 c                   endif
5.70  *
5.70  * Salgsenhet-3
5.70  *
5.70 c                   if        w_enh3 <> *blank
5.70 c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
5.70 c                   eval      d3enhe = w_enh3
5.70 c                   eval      d3sapr = w_s3pr
5.70 c                   eval      d3saim = w_s3im
      *
6.3d c                   eval      ds3lty = w_lety
6.3d c                   eval      ds3prg = w_prgr
6.3d c                   eval      ds3enh = w_enh3
6.3d c                   eval      ds3sap = w_s3pr
6.3d c                   eval      ds3sai = w_s3im
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
5.70 c                   write     d3dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70 c                   endif
5.70  *
5.70  * Innkjøpsenhet-1
5.70  *
5.70 c                   if        w_eni1 <> *blank and
5.70 c                             w_eni1 <> w_enh1 and
5.70 c                             w_eni1 <> w_enh2 and
5.70 c                             w_eni1 <> w_enh3
5.70 c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
5.70 c                   eval      d4enhe = w_eni1
5.70 c                   eval      d4inpr = w_inpr * w_ofi1
5.70 c                   eval      d4kopr = w_kopr * w_ofi1
      *
6.3d c                   eval      di1prg = w_prgr
6.3d c                   eval      di1lty = w_lety
6.3d c                   eval      di1enh = w_eni1
6.3d c                   eval      di1inp = w_inpr * w_ofi1
6.3d c                   eval      di1kop = w_kopr * w_ofi1
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
5.70 c                   write     d4dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70 c                   endif
5.70  *
5.70  * Innkjøpsenhet-2
5.70  *
5.70 c                   if        w_eni2 <> *blank and
5.70 c                             w_eni2 <> w_enh1 and
5.70 c                             w_eni2 <> w_enh2 and
5.70 c                             w_eni2 <> w_enh3
5.70 c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
5.70 c                   eval      d4enhe = w_eni2
5.70 c                   eval      d4inpr = w_inpr * w_ofi2
5.70 c                   eval      d4kopr = w_kopr * w_ofi2
      *
6.3d c                   eval      di2prg = w_prgr
6.3d c                   eval      di2lty = w_lety
6.3d c                   eval      di2enh = w_eni2
6.3d c                   eval      di2inp = w_inpr * w_ofi2
6.3d c                   eval      di2kop = w_kopr * w_ofi2
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
5.70 c                   write     d4dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70 c                   endif
5.70  *
5.70  * Innkjøpsenhet-3
5.70  *
5.70 c                   if        w_eni3 <> *blank and
5.70 c                             w_eni3 <> w_enh1 and
5.70 c                             w_eni3 <> w_enh2 and
5.70 c                             w_eni3 <> w_enh3
5.70 c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
5.70 c                   eval      d4enhe = w_eni3
5.70 c                   eval      d4inpr = w_inpr * w_ofi3
5.70 c                   eval      d4kopr = w_kopr * w_ofi3
      *
6.3d c                   eval      di3prg = w_prgr
6.3d c                   eval      di3lty = w_lety
6.3d c                   eval      di3enh = w_eni3
6.3d c                   eval      di3inp = w_inpr * w_ofi3
6.3d c                   eval      di3kop = w_kopr * w_ofi3
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
5.70 c                   write     d4dtl                                30
5.70 c                   exsr      overflow
6.37 c                   endif
5.70 c                   endif
5.70  *
5.70 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av priser/kalkyler på gammel pris i VA
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     gml_pris      begsr
      *
     c                   eval      w_lety = 0
6.22 c                   eval      w_prgr = *blank
     c                   eval      w_gprk = 1
      *
     c                   exsr      hent_data
      *
      * Avbryter dersom det ikke ble funnet kalkyle på gammel Nobb.pris
      *
6.12 c                   if        w_osts <> *blank
     c                   leavesr
     c                   endif
6.3d  * Nullstiller "gamle" verdier, så de ikke skal ligge igjen i regneark
6.3d c                   if        b_excl = *on
6.3d c                   exsr      exc_clear2
6.3d c                   endif
      * sjekker om det finnes pris på denne datoen allerede
      *
     c                   eval      vvprlr_vare = jvvare
6.20 c                   eval      vvprlr_ldor = w_eldo
5.70 c                   eval      vvprlr_prgr = w_prgr
     c                   eval      vvprlr_enhe = w_enh1
     c                   eval      vvprlr_lety = w_lety
     c                   eval      vvprlr_pdat = w_gdat
     c     vvprlr_key    chain     vvprlr
     c                   if        %found(vvprlr)
     c                   leavesr
     c                   endif
      *
      * Oppretter priser på gammel Nobb.pris
      *
     c                   if        p_kntr = 0
     c                   exsr      oppr_pris
     c                   endif
      *
      * Skriv til detaljlinje
      *
      * Salgsenhet-1
      *
     c                   eval      d2lety = w_lety
5.70 c                   eval      d2prgr = w_prgr
     c                   eval      d2enh1 = w_enh1
     c                   eval      d2inpr = w_inpr
     c                   eval      d2kopr = w_kopr
     c                   eval      d2s1pr = w_s1pr
     c                   eval      d2s1im = w_s1im
     c                   eval      d2dekn = w_dekn
      *
6.3d c                   eval      dt2lty = w_lety
6.3d c                   eval      dt2prg = w_prgr
6.3d c                   eval      dt2enh = w_enh1
6.3d c                   eval      dt2inp = w_inpr
6.3d c                   eval      dt2kop = w_kopr
6.3d c                   eval      dt2s1p = w_s1pr
6.3d c                   eval      dt2s1i = w_s1im
6.3d c                   eval      dt2dek = w_dekn
      *
6.37 c                   if        b_excl = *on
6.37 c                   exsr      xml_detal
6.37 c                   else
     c                   write     d2dtl                                30
     c                   exsr      overflow
6.37 c                   endif
      *
      *
      * Salgsenhet-2
      *
     c                   if        w_enh2 <> *blank
     c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
     c                   eval      d3enhe = w_enh2
     c                   eval      d3sapr = w_s2pr
     c                   eval      d3saim = w_s2im
      *
6.3d c                   eval      ds2lty = w_lety
6.3d c                   eval      ds2prg = w_prgr
6.3d c                   eval      ds2enh = w_enh2
6.3d c                   eval      ds2sap = w_s2pr
6.3d c                   eval      ds2sai = w_s2im
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d3dtl                                30
     c                   exsr      overflow
6.37 c                   endif
     c                   endif
      *
      * Salgsenhet-3
      *
     c                   if        w_enh3 <> *blank
     c                   eval      d3lety = w_lety
5.70 c                   eval      d3prgr = w_prgr
     c                   eval      d3enhe = w_enh3
     c                   eval      d3sapr = w_s3pr
     c                   eval      d3saim = w_s3im
      *
6.3d c                   eval      ds3lty = w_lety
6.3d c                   eval      ds3prg = w_prgr
6.3d c                   eval      ds3enh = w_enh3
6.3d c                   eval      ds3sap = w_s3pr
6.3d c                   eval      ds3sai = w_s3im
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d3dtl                                30
     c                   exsr      overflow
6.37 c                   endif
     c                   endif
      *
      * Innkjøpsenhet-1
      *
     c                   if        w_eni1 <> *blank and
     c                             w_eni1 <> w_enh1 and
     c                             w_eni1 <> w_enh2 and
     c                             w_eni1 <> w_enh3
     c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4enhe = w_eni1
     c                   eval      d4inpr = w_inpr * w_ofi1
     c                   eval      d4kopr = w_kopr * w_ofi1
      *
6.3d c                   eval      di1lty = w_lety
6.3d c                   eval      di1prg = w_prgr
6.3d c                   eval      di1enh = w_eni1
6.3d c                   eval      di1inp = w_inpr * w_ofi1
6.3d c                   eval      di1kop = w_kopr * w_ofi1
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
     c                   endif
      *
      * Innkjøpsenhet-2
      *
     c                   if        w_eni2 <> *blank and
     c                             w_eni2 <> w_enh1 and
     c                             w_eni2 <> w_enh2 and
     c                             w_eni2 <> w_enh3
     c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4enhe = w_eni2
     c                   eval      d4inpr = w_inpr * w_ofi2
     c                   eval      d4kopr = w_kopr * w_ofi2
      *
6.3d c                   eval      di2lty = w_lety
6.3d c                   eval      di2prg = w_prgr
6.3d c                   eval      di2enh = w_eni2
6.3d c                   eval      di2inp = w_inpr * w_ofi2
6.3d c                   eval      di2kop = w_kopr * w_ofi2
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
     c                   endif
      *
      * Innkjøpsenhet-3
      *
     c                   if        w_eni3 <> *blank and
     c                             w_eni3 <> w_enh1 and
     c                             w_eni3 <> w_enh2 and
     c                             w_eni3 <> w_enh3
     c                   eval      d4lety = w_lety
5.70 c                   eval      d4prgr = w_prgr
     c                   eval      d4enhe = w_eni3
     c                   eval      d4inpr = w_inpr * w_ofi3
     c                   eval      d4kopr = w_kopr * w_ofi3
      *
6.3d c                   eval      di3lty = w_lety
6.3d c                   eval      di3prg = w_prgr
6.3d c                   eval      di3enh = w_eni3
6.3d c                   eval      di3inp = w_inpr * w_ofi3
6.3d c                   eval      di3kop = w_kopr * w_ofi3
      *
6.3d c                   if        b_excl = *off
6.3d c**                 exsr      xml_detal
6.3d c**                 else
     c                   write     d4dtl                                30
     c                   exsr      overflow
6.37 c                   endif
     c                   endif
      *
     c                   endsr
6.16  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.16  * Subrutine for å dann vare-enhet-prisgiver
6.30  * Riktig JVPKPF er lest, så det skal bare være å skrive til vveppf
6.30  * Skriver kun til den valgte prisgiver
6.16  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.16  *
6.16 c     oppr_vep      begsr
6.30  *
6.30  *  Riktig JVPKPF er lest, så det skal bare være å skrive til vveppf
6.30  *
6.34 c                   eval      wwpgti = w_gtin
6.30  *
6.30 c                   eval      wwpvar      = vevare
6.30 c                   eval      wwpenh      = veenhe
6.30 c                   exsr      rydd_ean
6.30  *
     c                   clear                   vveplur
6.30 c                   eval      vveplu_pvar = vevare
6.30 c                   eval      vveplu_penh = veenhe
6.30 c                   eval      vveplu_pldo = w_eldo
6.30 c     vveplu_key    chain     vveplu
6.34 c                   eval      vepkla = w_pkla
6.34 c                   eval      vepbes = w_best
6.34 c                   eval      vepgti = w_gtin
6.30 c                   if        %found(vveplu)
6.30 c                   eval      vepeus = l_user
6.30 c                   time                    vepeti
6.30 c                   time                    vepeda
6.30 c                   update    vveplur
6.30 c                   else
6.30 c                   eval      vepfir = w_firm
6.30 c                   eval      vepvar = vveplu_pvar
6.30 c                   eval      vepenh = vveplu_penh
6.30 c                   eval      vepldo = vveplu_pldo
6.30 c                   eval      vepeus = l_user
6.30 c                   time                    vepeti
6.30 c                   time                    vepeda
6.30 c                   eval      vepous = l_user
6.30 c                   time                    vepoti
6.30 c                   time                    vepoda
6.30 c                   write     vveplur
6.30 c                   endif
6.30  *
6.16 c                   endsr
6.16  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.16  * Subrutine for å dann vare-enhet-prisgiver
6.16  * Leser vare pakning og legger ut info pr. lev. på vare-enhet
6.16  * gtin, pakningsklasse, best.bar enhet på de lev. som knyttet
6.16  * til reskontro.
6.16  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.16  * HER ER GAMMEL LOGIKK - DEN BØR IKKE VÆRE NØDVENDIG LENGER
6.16 c*    oppr_vep      begsr
6.30  *
6.30 c*                  eval      w_gtin = 0
6.30  *
6.30  * finner GTIN for produsent for denne enheten
6.30  *
6.30 c*                  eval      jvpkl2_vare = vevare
6.30 c*                  eval      jvpkl2_ldor = jvldor
6.30 c*    jvpkl2_key2   setll     jvpkl2
6.30 c*    jvpkl2_key2   reade     jvpkl2
6.30 c*                  dow       not %eof
6.30  *
6.30 c*                  if        jwenhe = veenhe  and
6.30 c*                            jwpakn  <> '000'
6.30 c*                  eval      w_gtin = jwgtin
6.30 c*                  endif
6.30 c*    jvpkl2_key2   reade     jvpkl2
6.30 c*                  enddo
6.30  *
6.30  * Prøver å finne gtin for valgt prisgiver
6.30  *
6.30 c*                  eval      jvpkl2_vare = vevare
6.30 c*                  eval      jvpkl2_ldor = p_pgiv
6.30 c*    jvpkl2_key2   setll     jvpkl2
6.30 c*    jvpkl2_key2   reade     jvpkl2
6.30 c*                  dow       not %eof
6.30  *
6.30 c*                  if        jwenhe = veenhe  and
6.30 c*                            jwpakn  <> '000'
      *
6.30 c*                  eval      jlevl1_ldor = jwldor
6.30 c*    jlevl1_key    chain     jlevl1
6.30 c*                  if        %found(jlevl1) and
6.30 c*                            jlenum <> 0
6.30  *
6.30 c*                  if        jwgtin = 0
6.30 c*                  eval      wwpgti = w_gtin
6.30 c*                  else
6.30 c*                  eval      wwpgti = jwgtin
6.30 c*                  endif
6.30 c*                  eval      wwpvar      = vevare
6.30 c*                  eval      wwpenh      = veenhe
6.30 c*                  exsr      rydd_ean
6.30  *
6.30 c*                  eval      vveplu_pvar = vevare
6.30 c*                  eval      vveplu_penh = veenhe
6.30 c*                  eval      vveplu_pldo = w_eldo
6.30 c*    vveplu_key    chain     vveplu
6.31 c**                 eval      vepkla = jwpkla
6.30 c*                  eval      vepbes = jwbest
6.30 c*                  if        wwpgti <> 0
6.30 c*                  eval      vepgti = wwpgti
6.30 c*                  eval      b_gtin = *on
6.30 c*                  endif
6.30 c*                  if        %found(vveplu)
6.30 c*                  eval      vepeus = l_user
6.30 c*                  time                    vepeti
6.30 c*                  time                    vepeda
6.30 c*                  update    vveplur
6.30 c*                  else
6.30 c*                  eval      vepfir = w_firm
6.30 c*                  eval      vepvar = vveplu_pvar
6.30 c*                  eval      vepenh = vveplu_penh
6.30 c*                  eval      vepldo = vveplu_pldo
6.30 c*                  eval      vepeus = l_user
6.30 c*                  time                    vepeti
6.30 c*                  time                    vepeda
6.30 c*                  eval      vepous = l_user
6.30 c*                  time                    vepoti
6.30 c*                  time                    vepoda
6.30 c*                  write     vveplur
6.30 c*                  endif
6.30  *
6.30 c*                  endif
6.30 c*                  endif
6.30  *
6.30 c*    jvpkl2_key2   reade     jvpkl2
6.30 c*                  enddo
6.30  *
6.16 c*                  endsr
      *
6.11  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.11  * Subrutine for å rydde ean-nr på veanpf som ligger på vvenpf
6.11  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.11  *
6.11 c     rydd_ean      begsr
6.11  *
6.18 c                   if        wwpgti = 0
6.18 c                   leavesr
6.18 c                   endif
6.16 c                   eval      veanlu_eann = wwpgti
6.11 c     veanlu_key    chain     veanlu
6.11 c                   if        %found(veanlu)
6.11 c                   delete    veanlur
6.11 c                   endif
6.1a  *
6.1a  * sjekker om gtin ligger på annen vare-sletter denne
6.1a  * eller at det ligger på samme vare, men forskj. enhet.
6.1a  *
6.1a c                   eval      vvepl2_pgti = wwpgti
6.1a c     vvepl2_key    setll     vvepl2
6.1a c     vvepl2_key    reade     vvepl2
6.1a c                   dow       not %eof(vvepl2)
6.1a c                   if        vepvar <> wwpvar
6.1a c                   eval      vepgti = 0
6.1a c                   endif
6.1a c                   if        vepvar = wwpvar and
6.1a c                             vepenh <> wwpenh
6.1a c                   eval      vepgti = 0
6.1a c                   endif
6.1a c                   update    vvepl2r
6.1a c     vvepl2_key    reade     vvepl2
6.1a c                   enddo
6.1a  *
6.11 c                   endsr
      *
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  * Subrutine for å sjekke om dato er innenfor fra /til dato
6.32  * hvis *loval i begge datoer = ok
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  *
6.32 c     sjekk_pkdato  begsr
6.32  *
6.32 c                   eval      b_pakn = *on
6.32  *
6.32 c                   if        jwfdat = *loval and
6.32 c                             jwtdat = *loval
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.3z c                   if        jwfdat <= w_udat and
6.3z c                             jwtdat >  w_udat
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.32 c                   if        jwfdat = *loval  and
6.3z c                             jwtdat >  w_udat
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.3z c                   if        jwfdat <= w_udat and
6.32 c                             jwtdat =  *loval
6.32 c                   leavesr
6.32 c                   endif
6.32  *
6.32 c                   eval      b_pakn = *off
6.32  *
6.32 c                   endsr
6.32  *
6.34  *
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  * Subrutine for å sjekke om det finnes lede tid for denne varen
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  *
6.34 c     sjekk_ledtid  begsr
6.34  *
6.34  * Mest mulig spesifikt søk
6.34  *
6.34 c                   eval      mltilr_ogrp = vvogrp
6.34 c                   eval      mltilr_hgrp = vvhgrp
6.34 c                   eval      mltilr_ugrp = vvugrp
6.34 c                   eval      mltilr_ldor = vvldor
6.34 c                   eval      mltilr_vare = ''
6.34 c                   eval      mltilr_lage = rajkod
6.34 c                   eval      mltilr_crdo = 0
6.34 c     mltilr_key    chain     mltilr
6.34 c                   if        %found
6.34 c                   eval      vlltid = mcltid
6.34 c                   leavesr
6.34 c                   endif
      *  start med lager
6.34 c                   eval      mltilr_ogrp = vvogrp
6.34 c                   eval      mltilr_hgrp = vvhgrp
6.34 c                   eval      mltilr_ugrp = 0
6.34 c                   eval      mltilr_ldor = vvldor
6.34 c                   eval      mltilr_vare = ''
6.34 c                   eval      mltilr_lage = rajkod
6.34 c                   eval      mltilr_crdo = 0
6.34 c     mltilr_key    chain     mltilr
6.34 c                   if        %found
6.34 c                   eval      vlltid = mcltid
6.34 c                   leavesr
6.34 c                   endif
      *
6.34 c                   eval      mltilr_ogrp = vvogrp
6.34 c                   eval      mltilr_hgrp = 0
6.34 c                   eval      mltilr_ugrp = 0
6.34 c                   eval      mltilr_ldor = vvldor
6.34 c                   eval      mltilr_vare = ''
6.34 c                   eval      mltilr_lage = rajkod
6.34 c                   eval      mltilr_crdo = 0
6.34 c     mltilr_key    chain     mltilr
6.34 c                   if        %found
6.34 c                   eval      vlltid = mcltid
6.34 c                   leavesr
6.34 c                   endif
      *
6.34 c                   eval      mltilr_ogrp = 0
6.34 c                   eval      mltilr_hgrp = 0
6.34 c                   eval      mltilr_ugrp = 0
6.34 c                   eval      mltilr_ldor = vvldor
6.34 c                   eval      mltilr_vare = ''
6.34 c                   eval      mltilr_lage = rajkod
6.34 c                   eval      mltilr_crdo = 0
6.34 c     mltilr_key    chain     mltilr
6.34 c                   if        %found
6.34 c                   eval      vlltid = mcltid
6.34 c                   leavesr
6.34 c                   endif
      * slutt med lager
      * start uten lager
6.34 c                   eval      mltilr_ogrp = vvogrp
6.34 c                   eval      mltilr_hgrp = vvhgrp
6.34 c                   eval      mltilr_ugrp = 0
6.34 c                   eval      mltilr_ldor = vvldor
6.34 c                   eval      mltilr_vare = ''
6.34 c                   eval      mltilr_lage = 0
6.34 c                   eval      mltilr_crdo = 0
6.34 c     mltilr_key    chain     mltilr
6.34 c                   if        %found
6.34 c                   eval      vlltid = mcltid
6.34 c                   leavesr
6.34 c                   endif
      *
6.34 c                   eval      mltilr_ogrp = vvogrp
6.34 c                   eval      mltilr_hgrp = 0
6.34 c                   eval      mltilr_ugrp = 0
6.34 c                   eval      mltilr_ldor = vvldor
6.34 c                   eval      mltilr_vare = ''
6.34 c                   eval      mltilr_lage = 0
6.34 c                   eval      mltilr_crdo = 0
6.34 c     mltilr_key    chain     mltilr
6.34 c                   if        %found
6.34 c                   eval      vlltid = mcltid
6.34 c                   leavesr
6.34 c                   endif
      *
6.34  *
6.34  *
6.34  * Minst mulig spesifikt søk
6.34  *
6.34 c                   eval      mltilr_ogrp = 0
6.34 c                   eval      mltilr_hgrp = 0
6.34 c                   eval      mltilr_ugrp = 0
6.34 c                   eval      mltilr_ldor = vvldor
6.34 c                   eval      mltilr_vare = ''
6.34 c                   eval      mltilr_lage = 0
6.34 c                   eval      mltilr_crdo = 0
6.34 c     mltilr_key    chain     mltilr
6.34 c                   if        %found
6.34 c                   eval      vlltid = mcltid
6.34 c                   leavesr
6.34 c                   endif
      * ferdig
6.34  *
6.34 c                   endsr
      *
      *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Nullst. alle var., så det ikke blir liggende "gamle" verdier    *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     exc_clear     begsr
6.37  * D1DTL
6.37 c                   eval      d1osts = *blanks
6.37 c                   eval      d1ogrp = 0
6.37 c                   eval      d1hgrp = 0
6.37 c                   eval      d1ugrp = 0
6.37 c                   eval      d1tek1 = *blanks
6.37 c                   eval      d1sort = *blanks
6.37 c                   eval      d1vare = *blanks
6.37 c                   eval      d1nobb = 0
6.37 c                   eval      d1lvar = *blanks
6.37 c                   eval      d1lnav = *blanks
6.37 c                   eval      d1beti = *blanks
6.37 c                   eval      d1lety = 0
6.37 c                   eval      d1prgr = *blanks
6.37 c                   eval      d1enh1 = *blanks
6.37 c                   eval      d1inpr = 0
6.37 c                   eval      d1kopr = 0
6.37 c                   eval      d1s1pr = 0
6.37 c                   eval      d1s1im = 0
6.37 c                   eval      d1dekn = 0
6.37 c                   eval      d1pkod = *blanks
6.37 c                   eval      d1vtyp = *blank
6.37  * D2DTL - salgsenhet 1
6.3d c                   eval      dt2prg = *blanks
6.3d c                   eval      dt2lty = 0
6.3d c                   eval      dt2enh = *blanks
6.3d c                   eval      dt2inp = 0
6.3d c                   eval      dt2kop = 0
6.3d c                   eval      dt2s1p = 0
6.3d c                   eval      dt2s1i = 0
6.3d c                   eval      dt2dek = 0
6.37  * D3DTL - salgsenhet 2
6.3d c                   eval      ds2prg = *blanks
6.3d c                   eval      ds2lty = 0
6.3d c                   eval      ds2enh = *blanks
6.3d c                   eval      ds2sap = 0
6.3d c                   eval      ds2sai = 0
6.37  * D3DTL - salgsenhet 3
6.3d c                   eval      ds3prg = *blanks
6.3d c                   eval      ds3lty = 0
6.3d c                   eval      ds3enh = *blanks
6.3d c                   eval      ds3sap = 0
6.3d c                   eval      ds3sai = 0
6.3d  * D4DTL - innkjøpsenhet 1
6.3d c                   eval      di1prg = *blanks
6.3d c                   eval      di1lty = 0
6.3d c                   eval      di1enh = *blanks
6.3d c                   eval      di1inp = 0
6.3d c                   eval      di1kop = 0
6.3d  * D4DTL - innkjøpsenhet 2
6.3d c                   eval      di2prg = *blanks
6.3d c                   eval      di2lty = 0
6.3d c                   eval      di2enh = *blanks
6.3d c                   eval      di2inp = 0
6.3d c                   eval      di2kop = 0
6.3d  * D4DTL - innkjøpsenhet 3
6.3d c                   eval      di3prg = *blanks
6.3d c                   eval      di3lty = 0
6.3d c                   eval      di3enh = *blanks
6.3d c                   eval      di3inp = 0
6.3d c                   eval      di3kop = 0
6.37  * D5DTL
6.37 c                   eval      d5osts = *blanks
6.3d c                   eval      d5ogrp = 0
6.3d c                   eval      d5hgrp = 0
6.3d c                   eval      d5ugrp = 0
6.3d c                   eval      d5tek1 = *blanks
6.3d c                   eval      d5vare = *blanks
6.3d c                   eval      d5nobb = 0
6.3d c                   eval      d5lvar = *blanks
6.3d c                   eval      d5lnav = *blanks
6.37 c                   eval      d5text = *blanks
6.37  *
6.37 c                   endsr
6.3d  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.3d  * Nullst. alle var., så det ikke blir liggende "gamle" verdier    *
6.3d  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.3d c     exc_clear2    begsr
6.37  * D2DTL - salgsenhet 1
6.3d c                   eval      dt2prg = *blanks
6.3d c                   eval      dt2lty = 0
6.3d c                   eval      dt2enh = *blanks
6.3d c                   eval      dt2inp = 0
6.3d c                   eval      dt2kop = 0
6.3d c                   eval      dt2s1p = 0
6.3d c                   eval      dt2s1i = 0
6.3d c                   eval      dt2dek = 0
6.3d  * D3DTL - salgsenhet 2
6.3d c                   eval      ds2prg = *blanks
6.3d c                   eval      ds2lty = 0
6.3d c                   eval      ds2enh = *blanks
6.3d c                   eval      ds2sap = 0
6.3d c                   eval      ds2sai = 0
6.3d  * D3DTL - salgsenhet 3
6.3d c                   eval      ds3prg = *blanks
6.3d c                   eval      ds3lty = 0
6.3d c                   eval      ds3enh = *blanks
6.3d c                   eval      ds3sap = 0
6.3d c                   eval      ds3sai = 0
6.3d  * D4DTL - innkjøpsenhet 1
6.3d c                   eval      di1prg = *blanks
6.3d c                   eval      di1lty = 0
6.3d c                   eval      di1enh = *blanks
6.3d c                   eval      di1inp = 0
6.3d c                   eval      di1kop = 0
6.3d  * D4DTL - innkjøpsenhet 2
6.3d c                   eval      di2prg = *blanks
6.3d c                   eval      di2lty = 0
6.3d c                   eval      di2enh = *blanks
6.3d c                   eval      di2inp = 0
6.3d c                   eval      di2kop = 0
6.3d  * D4DTL - innkjøpsenhet 3
6.3d c                   eval      di3prg = *blanks
6.3d c                   eval      di3lty = 0
6.3d c                   eval      di3enh = *blanks
6.3d c                   eval      di3inp = 0
6.3d c                   eval      di3kop = 0
6.3d  * D5DTL
6.3d c                   eval      d5osts = *blanks
6.3d c                   eval      d5ogrp = 0
6.3d c                   eval      d5hgrp = 0
6.3d c                   eval      d5ugrp = 0
6.3d c                   eval      d5tek1 = *blanks
6.3d c                   eval      d5vare = *blanks
6.3d c                   eval      d5nobb = 0
6.3d c                   eval      d5lvar = *blanks
6.3d c                   eval      d5lnav = *blanks
6.37 c                   eval      d5text = *blanks
6.3d  *
6.3d c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Finner spool som er generert av jobben
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     spoolnbr      begsr
6.37  /Free
6.37
6.37           QSPRILSP( SPRL0100
6.37                   : %size(SPRL0100)
6.37                   : 'SPRL0100'
6.37                   : errorcode );
6.37  /End-free
6.37 c*
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Kaller eget program for generering av xml fil. Eget pgm         *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_create    begsr
6.37  *
6.37 c                   eval      splfname2 = *blanks
6.37 c                   eval      splfname3 = *blanks
6.37 c                   eval      jobname2 = *blanks
6.37 c                   eval      jobname3 = *blanks
6.37 c                   eval      username2 = *blanks
6.37 c                   eval      username3 = *blanks
6.37 c                   eval      jobnbr2 = *blanks
6.37 c                   eval      jobnbr3 = *blanks
6.37 c                   eval      splfnbr2 = *zeros
6.37 c                   eval      splfnbr3 = *zeros
6.37 c                   eval      p_btyp = 'DELVARE'
6.37 c                   eval      p_dspl = 'Nye varer til EVR - kjørt +
6.37 c                                       dato: '+ %char(udate)
6.37 c                   eval      p_refn = 'EVR-' + %char(udate)
6.37 c                   eval      p_tagg0 = *blanks
6.37 c                   eval      p_tagg0val = *blanks
6.37 c                   eval      p_tagg1 = *blanks
6.37 c                   eval      p_tagg1val = *blanks
6.37 c                   eval      p_tagg2 = *blanks
6.37 c                   eval      p_tagg2val = *blanks
6.37 c                   eval      p_tagg3 = *blanks
6.37 c                   eval      p_tagg3val = *blanks
6.37 c                   eval      p_tagg4 = *blanks
6.37 c                   eval      p_tagg4val = *blanks
6.37 c                   eval      p_tagg5 = *blanks
6.37 c                   eval      p_tagg5val = *blanks
6.37 c                   eval      p_tagg6 = *blanks
6.37 c                   eval      p_tagg6val = *blanks
6.37 c                   eval      p_tagg7 = *blanks
6.37 c                   eval      p_tagg7val = *blanks
6.37 c                   eval      p_tagg8 = *blanks
6.37 c                   eval      p_tagg8val = *blanks
6.37 c                   eval      p_tagg9 = *blanks
6.37 c                   eval      p_tagg9val = *blanks
6.37  *
6.37 c                   call      'AP627R'
6.37 c                   PARM                    splfname
6.37 c                   PARM                    jobname
6.37 c                   PARM                    username
6.37 c                   PARM                    jobnbr
6.37 c                   PARM                    splfnbr
6.37 c                   PARM                    splfname2
6.37 c                   PARM                    jobname2
6.37 c                   PARM                    username2
6.37 c                   PARM                    jobnbr2
6.37 c                   PARM                    splfnbr2
6.37 c                   PARM                    splfname3
6.37 c                   PARM                    jobname3
6.37 c                   PARM                    username3
6.37 c                   PARM                    jobnbr3
6.37 c                   PARM                    splfnbr3
6.37 c                   parm                    p_tagg0
6.37 c                   parm                    p_tagg0val
6.37 c                   parm                    p_tagg1
6.37 c                   parm                    p_tagg1val
6.37 c                   parm                    p_tagg2
6.37 c                   parm                    p_tagg2val
6.37 c                   parm                    p_tagg3
6.37 c                   parm                    p_tagg3val
6.37 c                   parm                    p_tagg4
6.37 c                   parm                    p_tagg4val
6.37 c                   parm                    p_tagg5
6.37 c                   parm                    p_tagg5val
6.37 c                   parm                    p_tagg6
6.37 c                   parm                    p_tagg6val
6.37 c                   parm                    p_tagg7
6.37 c                   parm                    p_tagg7val
6.37 c                   parm                    p_tagg8
6.37 c                   parm                    p_tagg8val
6.37 c                   parm                    p_tagg9
6.37 c                   parm                    p_tagg9val
6.37 c                   PARM                    l_bach
6.37 c                   PARM                    p_btyp
6.37 c                   PARM                    p_refn
6.37 c                   PARM                    p_dspl
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML/jasper integrasjon - Skjermvisning           *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     pdf_preview   begsr
6.37 c                   if        l_skje = 1 or
6.37 c                             b_excl = *on
6.37  * Vi kaller program for launch av PDF i browser
6.37 c                   call      'AP621R'
6.37 c                   parm                    l_bach
6.37  *
6.37 c                   endif
6.37  *
6.37 c                   endsr
6.37  *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML/jasper integrasjon - Miljø variabler         *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_envm      begsr
6.37  *
6.37 c                   eval      w_rtyp = 'XsltCommand'
6.37 c                   eval      w_mime = 'application/vnd.ms-excel'
6.37 c                   eval      d_jasm = *blank
6.37  *
6.37  /Free
6.37       // Finne nytt batch nummer
6.37           UpdHTMLVar('BatchNo':               w_jkey);
6.37           UpdHTMLVar('Batchtype':            'EXCEL');
6.37           UpdHTMLVar('Username':              l_user);
6.37           WrtSection('Topp');
6.37       // Finn report command variabler
6.37           UpdHTMLVar('User':                l_user);
6.37           UpdHTMLVar('PW':                     ' ');
6.37           UpdHTMLVar('IPAdr':                  ' ');
6.37           UpdHTMLVar('Schema':        'ADB'+l_filg);
6.37           UpdHTMLVar('Companyno':    %char(l_firm));
6.37           WrtSection('Credential');
6.37       // Finn report command variabler
6.37           UpdHTMLVar('Reportcommandtype':   w_rtyp);
6.37       //  UpdHTMLVar('Jaspertemplate':      d_jasm);
6.37           UpdHTMLVar('Logo':                   ' ');
6.37           UpdHTMLVar('Keepspool':           'true');
6.37           UpdHTMLVar('Xsltschemapath':         ' ');
6.37           UpdHTMLVar('Mimetype':            w_mime);
6.37           WrtSection('ReportCommand');
6.37  /End-free
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML integrasjon - Heading                        *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_head      begsr
6.37  *
6.37 c                   eval      aforl1_ruti = l_ruti
6.37 c     aforl1_key    chain     aforl1r
6.37  * Hvis mail skal skrives, må vi hente mail informasjon
6.37  *
6.37 c                   if        l_mail = 1
6.37 c                   eval      p_kule = 'L'
6.37 c                   eval      p_kund = vvldor
6.37 c                   eval      p_kpro = *zeros
6.37 c                   eval      p_numm = *zeros
6.38 c                   eval      p_suff = *zeros
6.37 c                   eval      p_selg = *zeros
6.37 c                   eval      p_in03 = *off
6.37  * Henter ut mailserver
6.37 c                   eval      p_serv = *blank
6.37 c                   eval      p_stat = *blank
6.37 c                   call      'AM705C'
6.37 c                   parm                    p_serv
6.37 c                   parm                    p_stat
6.37  *
6.37 c                   call      'FO798R'
6.37 c                   parm                    p_kule
6.37 c                   parm                    p_kund
6.37 c                   parm                    p_kpro
6.37 c                   parm                    p_numm
6.38 c                   parm                    p_suff
6.37 c                   parm                    p_selg
6.37 c                   parm                    p_navn
6.37 c                   parm                    p_emal
6.38 c                   parm                    p_ema2
6.38 c                   parm                    p_ema3
6.37 c                   parm                    p_emne
6.37 c                   parm                    p_txt1
6.37 c                   parm                    p_txt2
6.37 c                   parm                    p_txt3
6.37 c                   parm                    p_txt4
6.37 c                   parm                    p_pers
6.38 c                   parm                    p_kopi
6.37 c                   parm                    p_inif
6.37 c                   parm                    p_in03
6.37  * Scann av strenger
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_emne        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_pemne
6.37  * Scann av strenger
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_txt1        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_ptxt1
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_txt2        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_ptxt2
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_txt3        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_ptxt3
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_txt4        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_ptxt4
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     p_pers        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_ppers
6.37  *
6.37 c                   eval      w_mtxt = %trim(w_ptxt1) + crlf +
6.37 c                                      %trim(w_ptxt2) + crlf +
6.37 c                                      %trim(w_ptxt3) + crlf +
6.37 c                                      %trim(w_ptxt4) + crlf +
6.37 c                                      %trim(w_ppers)
6.37  *
6.38 c                   if        p_kopi = *blanks
6.38 c                   eval      p_kopi = d_emal
6.37 c                   endif
6.37  *
6.37 c                   if        p_in03 = *off
6.37  *
6.37  /Free
6.37       // Skriv mailinformasjon
6.38           WrtSection('MailCommandStart');
6.38      //   UpdHTMLVar('Receivers':           p_emal);
6.38           if %Trim(p_emal)<> *blanks;
6.38           UpdHTMLVar('Receivers':           p_emal);
6.38           WrtSection('MailReceiver');
6.38           endif;
6.30           if %Trim(p_ema2)<> *blanks;
6.38           UpdHTMLVar('Receivers':           p_ema2);
6.38           WrtSection('MailReceiver');
6.38           endif;
6.38           if %Trim(p_ema3)<> *blanks;
6.38           UpdHTMLVar('Receivers':           p_ema3);
6.38           WrtSection('MailReceiver');
6.38           endif;
6.37           UpdHTMLVar('CC':                     ' ');
6.38           UpdHTMLVar('BCC':                 p_kopi);
6.38           UpdHTMLVar('Sender':              p_kopi);
6.37           UpdHTMLVar('Subject':             w_pemne);
6.37           UpdHTMLVar('Message':             w_mtxt);
6.37           UpdHTMLVar('SMTPServer':          p_serv);
6.37           UPDHTMLVar('SMTPUser':               ' ');
6.37           UPDHTMLVar('SMTPPw':                 ' ');
6.38       //  WrtSection('MailCommand');
6.38           WrtSection('MailCommandEnd');
6.37  /End-free
6.37 c                   endif
6.37 c                   endif
6.37  * Scann av strenger
6.30 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     aftxt1        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_txt1
6.37  *
6.37  * Vi må oversette aktuelle tekster til "xml" tegn - Firma
6.37 c                   eval      w_1fnav = *blank
6.37 c                   eval      w_1fad1 = *blank
6.37 c                   eval      w_1fad2 = *blank
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     w_fnav        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_1fnav
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     w_fad1        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_1fad1
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     w_fad2        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_1fad2
6.37  *
6.37  /Free
6.37
6.37       // Skriv firmavariabler
6.37           UpdHTMLVar('Reporttext':            w_txt1);
6.37           UpdHTMLVar('Subheader':                ' ');
6.37           UpdHTMLVar('CompanyName':          w_1fnav);
6.37           UpdHTMLVar('Companyadress1':       w_1fad1);
6.37           UpdHTMLVar('Companyadress2':       w_1fad2);
6.37           UpdHTMLVar('Companypostalcode':        ' ');
6.37           UpdHTMLVar('Companypostoffice':     w_fste);
6.37           UpdHTMLVar('Companyphone':          w_ftlf);
6.37           UpdHTMLVar('Companyfax':            w_ffax);
6.37           UpdHTMLVar('Companyorgno':   %char(aafftn));
6.37           UpdHTMLVar('Companygiro':    %char(aafbgi));
6.37           UpdHTMLVar('Companyemail':          aamail);
6.37           UpdHTMLVar('Companywebpage': %trim(aaweba));
6.37
6.37           test(de) *dmy w_ddmy;
6.37           if %error;
6.37           tmpdate = *loval;
6.37           else;
6.37           tmpdate = %date(w_ddmy : *dmy);
6.37           endif;
6.37           UpdHTMLVar('Creationdate':   %char(tmpdate : *iso));
6.37
6.37           test(te) *hms w_tids;
6.37           if %error;
6.37           tmptime = *loval;
6.37           else;
6.37           tmptime = %time(w_tids : *hms);
6.37           endif;
6.37           UpdHTMLVar('Creationtime': %char(tmptime : *hms));
6.37           WrtSection('DocumentInformation');
6.37
6.37           WrtSection('FreedefHeader');
6.37
6.37  /End-free
6.37  *
6.37  * D1DTL
6.37 c                   eval      h_valu='Status'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Overgruppe'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Hovedgruppe'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Undergruppe'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Sort'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Varetekst'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Varenr'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Nobb-nr'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Lev.varenr'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Leverandør'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Betingelse'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Prisgrp'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Lev.type'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Enhet'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Innkj.pris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Kostpris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Salgspris eks.mva'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Salgspris ink.mva'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='DG'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='P'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Varetype'
6.37 c                   exsr      xml_head_val
6.37  * D2DTL -salgspris 1
6.37 c                   eval      h_valu='Prisgrp'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Lev.type'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Enhet'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Innkj.pris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Kostpris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Salgspris eks.mva'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Salgspris ink.mva'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='DG'
6.37 c                   exsr      xml_head_val
6.3d  * D3DTL - salgsprisenhet 2
6.37 c                   eval      h_valu='Prisgrp'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Lev.type'
6.37 c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Enhet (s2)'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Salgspris eks.mva'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Salgspris ink.mva'
6.37 c                   exsr      xml_head_val
6.3d  * D3DTL - salgsprisenhet 3
6.3d c                   eval      h_valu='Prisgrp'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Lev.type'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Enhet (s3)'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Salgspris eks.mva'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Salgspris ink.mva'
6.3d c                   exsr      xml_head_val
6.3d  * D4DTL - innkjøpsenhet 1
6.37 c                   eval      h_valu='Prisgrp'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Lev.type'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Enhet (i1)'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Innkj.pris'
6.37 c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Kostpris'
6.37 c                   exsr      xml_head_val
6.3d  * D4DTL - innkjøpsenhet 2
6.3d c                   eval      h_valu='Prisgrp'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Lev.type'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Enhet (i2)'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Innkj.pris'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Kostpris'
6.3d c                   exsr      xml_head_val
6.3d  * D4DTL - innkjøpsenhet 3
6.3d c                   eval      h_valu='Prisgrp'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Lev.type'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Enhet (i3)'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Innkj.pris'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Kostpris'
6.3d c                   exsr      xml_head_val
6.37  * D5DTL
6.37 c                   eval      h_valu='Status'
6.37 c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Overgruppe'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Hovedgruppe'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Undergruppe'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Varetekst'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Varenummer'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='NOBB'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Lev.varenr'
6.3d c                   exsr      xml_head_val
6.3d c                   eval      h_valu='Lev.varenavn'
6.3d c                   exsr      xml_head_val
6.37 c                   eval      h_valu='Årsak'
6.37 c                   exsr      xml_head_val
6.37  *
6.37  /Free
6.37
6.37       // Avslutt headervalues
6.37           WrtSection('HeaderLineEnd');
6.37
6.37  /End-free
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML integrasjon - Heading                        *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_head_val  begsr
6.37  *
6.37  /Free
6.37
6.37       // Skriv headervalue
6.37           UpdHTMLVar('Headervalue':  %trim(h_valu));
6.37           WrtSection('HeaderLineValue');
6.37
6.37  /End-free
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML integrasjon - detaljlinjer                   *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_detal     begsr
6.37  *
6.37  /Free
6.37
6.37       // Skriv detaljer
6.37           WrtSection('DetailLineStart');
6.37
6.37           WrtSection('FreedefLine');
6.37
6.37  /End-free
6.37  *
6.37  * D1DTL
6.37  *
6.37  * Varetekst
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     d1tek1        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_tek1
6.37  * Leverandørnavn
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     d1lnav        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_lnav
6.37  *
6.37  * Så skriver vi de forskjellige linjene
6.37  *
6.37  * Status
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1osts)
6.37 c                   exsr      xml_line_val
6.37  * Overgruppe
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1ogrp)
6.37 c                   exsr      xml_line_val
6.37  * Hovedgruppe
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1hgrp)
6.37 c                   exsr      xml_line_val
6.37  * Undegruppe
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1ugrp)
6.37 c                   exsr      xml_line_val
6.37  * Sort
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1sort)
6.37 c                   exsr      xml_line_val
6.37  * Varetekst
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(w_tek1)
6.37 c                   exsr      xml_line_val
6.37  * Varenummer
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1vare)
6.37 c                   exsr      xml_line_val
6.37  * Nobbnummer
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1nobb)
6.37 c                   exsr      xml_line_val
6.37  * Leverandørens varenummer
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1lvar)
6.37 c                   exsr      xml_line_val
6.37  * Leverandørnavn
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(w_lnav)
6.37 c                   exsr      xml_line_val
6.37  * Betingelse
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1beti)
6.37 c                   exsr      xml_line_val
6.37  * Prisgruppe
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1prgr)
6.37 c                   exsr      xml_line_val
6.37  * Leveringstype
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1lety)
6.37 c                   exsr      xml_line_val
6.37  * Enhet
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1enh1)
6.37 c                   exsr      xml_line_val
6.37  * Innkjøpspris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1inpr)
6.37 c                   exsr      xml_line_val
6.37  * Kostpris
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1kopr)
6.37 c                   exsr      xml_line_val
6.37  * Salgspris eks mva
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1s1pr)
6.37 c                   exsr      xml_line_val
6.37  * Salgspris ink mva
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1s1im)
6.37 c                   exsr      xml_line_val
6.37  * Dekningsgrad
6.37 c                   eval      d_type='Numeric'
6.37 c                   eval      d_valu=%char(d1dekn)
6.37 c                   exsr      xml_line_val
6.37  * Priskode ?
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1pkod)
6.37 c                   exsr      xml_line_val
6.37  * Varetype
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d1vtyp)
6.37 c                   exsr      xml_line_val
6.37  *
6.37  * D2DTL - salgsprisenhet 1
6.37  *
6.37  * Prisgruppe
6.37  *
6.37 c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(dt2prg)
6.37 c                   exsr      xml_line_val
6.37  * Leveringstype
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(dt2lty)
6.37 c                   exsr      xml_line_val
6.37  * Enhet
6.37 c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(dt2enh)
6.37 c                   exsr      xml_line_val
6.37  * Innkjøpspris
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(dt2inp)
6.37 c                   exsr      xml_line_val
6.37  * Kostpris
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(dt2kop)
6.37 c                   exsr      xml_line_val
6.37  * Salgspris eks mva
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(dt2s1p)
6.37 c                   exsr      xml_line_val
6.37  * Salgspris ink mva
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(dt2s1i)
6.37 c                   exsr      xml_line_val
6.37  * Dekningsgrad
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(dt2dek)
6.37 c                   exsr      xml_line_val
6.37  *
6.3d  * D3DTL - salgsprisenhet 2
6.37  *
6.37  * Prisgruppe
6.37  *
6.37 c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(ds2prg)
6.37 c                   exsr      xml_line_val
6.37  * Leveringstype
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(ds2lty)
6.37 c                   exsr      xml_line_val
6.37  * Enhet
6.37 c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(ds2enh)
6.37 c                   exsr      xml_line_val
6.37  * Salgspris eks mva
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(ds2sap)
6.37 c                   exsr      xml_line_val
6.37  * Salgspris ink mva
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(ds2sai)
6.37 c                   exsr      xml_line_val
6.3d  *
6.3d  * D3DTL - salgsprisenhet 3
6.3d  *
6.3d  * Prisgruppe
6.3d  *
6.3d c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(ds3prg)
6.3d c                   exsr      xml_line_val
6.3d  * Leveringstype
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(ds3lty)
6.3d c                   exsr      xml_line_val
6.3d  * Enhet
6.3d c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(ds3enh)
6.3d c                   exsr      xml_line_val
6.3d  * Salgspris eks mva
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(ds3sap)
6.3d c                   exsr      xml_line_val
6.3d  * Salgspris ink mva
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(ds3sai)
6.3d c                   exsr      xml_line_val
6.37  *
6.37  * D4DTL - innkjøpsenhet 1
6.37  *
6.37  * Prisgruppe
6.37  *
6.37 c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(di1prg)
6.37 c                   exsr      xml_line_val
6.37  * Leveringstype
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(di1lty)
6.37 c                   exsr      xml_line_val
6.37  * Enhet
6.37 c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(di1enh)
6.37 c                   exsr      xml_line_val
6.37  * Innkjøpspris
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(di1inp)
6.37 c                   exsr      xml_line_val
6.37  * Kostpris
6.37 c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(di1kop)
6.37 c                   exsr      xml_line_val
6.3d  *
6.3d  * D4DTL - innkjøpsenhet 2
6.3d  *
6.3d  * Prisgruppe
6.3d  *
6.3d c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(di2prg)
6.3d c                   exsr      xml_line_val
6.3d  * Leveringstype
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(di2lty)
6.3d c                   exsr      xml_line_val
6.3d  * Enhet
6.3d c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(di2enh)
6.3d c                   exsr      xml_line_val
6.3d  * Innkjøpspris
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(di2inp)
6.3d c                   exsr      xml_line_val
6.3d  * Kostpris
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(di2kop)
6.3d c                   exsr      xml_line_val
6.3d  *
6.3d  * D4DTL - innkjøpsenhet 3
6.3d  *
6.3d  * Prisgruppe
6.3d  *
6.3d c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(di3prg)
6.3d c                   exsr      xml_line_val
6.3d  * Leveringstype
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(di3lty)
6.3d c                   exsr      xml_line_val
6.3d  * Enhet
6.3d c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(di3enh)
6.3d c                   exsr      xml_line_val
6.3d  * Innkjøpspris
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(di3inp)
6.3d c                   exsr      xml_line_val
6.3d  * Kostpris
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(di3kop)
6.3d c                   exsr      xml_line_val
6.37  *
6.37  * D5DTL
6.37  *
6.37  * Status
6.37  *
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d5osts)
6.37 c                   exsr      xml_line_val
6.3d  * Overgruppe
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(d5ogrp)
6.3d c                   exsr      xml_line_val
6.3d  * Hovedgruppe
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(d5hgrp)
6.3d c                   exsr      xml_line_val
6.3d  * Undergruppe
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(d5ugrp)
6.3d c                   exsr      xml_line_val
6.3d  * Varetekst
6.3d c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(d5tek1)
6.3d c                   exsr      xml_line_val
6.3d  * Varenummer
6.3d c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(d5vare)
6.3d c                   exsr      xml_line_val
6.3d  * NOBB nummer
6.3d c                   eval      d_type='Numeric'
6.3d c                   eval      d_valu=%char(d5nobb)
6.3d c                   exsr      xml_line_val
6.3d  * Lev.varenummer
6.3d c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(d5lvar)
6.3d c                   exsr      xml_line_val
6.3d  * Lev.varetekst
6.3d c                   eval      d_type='Char'
6.3d c                   eval      d_valu=%trim(d5lnav)
6.3d c                   exsr      xml_line_val
6.37  * Årsak
6.37 c                   eval      d_type='Char'
6.37 c                   eval      d_valu=%trim(d5text)
6.37 c                   exsr      xml_line_val
6.37  *
6.37  /Free
6.37
6.37       // Skriv avslutning
6.37
6.37           WrtSection('DetailLineEnd');
6.37
6.37  /End-free
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML integrasjon - Linjer                         *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_line_val  begsr
6.37  *
6.37  /Free
6.37
6.37       // Skriv linevalue
6.37           UpdHTMLVar('type':         %trim(d_type));
6.37           UpdHTMLVar('Linevalue':    %trim(d_valu));
6.37           WrtSection('DetailLineValue');
6.37
6.37  /End-free
6.37  *
6.37 c                   endsr
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37  * Subrutiner for XML integrasjon - Slutt                          *
6.37  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.37 c     xml_end       begsr
6.37  *
6.37  /Free
6.37           WrtSection('EndExcelLines');
6.37  /End-free
6.37  *
6.37  * Hvis denne ikke skal arkiveres, lages ikke archive tagg.
6.37  *
6.37 c                   if        l_arch = 1
6.37  * Lag tag for vising i arkivklienten
6.37 c                   eval      w_dspl = *blank
6.37 c                   eval      w_dspl = 'Nye varer til EVR'
6.37  *
6.37 c                   eval      p_str_in = *blank
6.37 c                   eval      p_lr = '0'
6.37 c                   movel     w_dspl        p_str_in
6.37 c                   call      'AP613R'
6.37 c                   parm                    p_str_in
6.37 c                   parm                    p_str_out
6.37 c                   parm                    p_lr
6.37 c                   movel     p_str_out     w_dspl
6.37  /Free
6.37       // Skriv metattags
6.37
6.37           UpdHTMLVar('Displaytag':     %trim(w_dspl));
6.37           WrtSection('ArchiveCommandStart');
6.37
6.37           UpdHTMLVar('Metavalue':                ' ');
6.37           UpdHTMLVar('Metakey':              'EXCEL');
6.37           WrtSection('MetaTag');
6.37
6.37           UpdHTMLVar('Metavalue':             l_user);
6.37           UpdHTMLVar('Metakey':             'BRUKER');
6.37           WrtSection('MetaTag');
6.37
6.37           UpdHTMLVar('Metavalue': %char(w_date:*iso));
6.37           UpdHTMLVar('Metakey':               'DATO');
6.37           WrtSection('MetaTag');
6.37
6.37           UpdHTMLVar('Metavalue':             w_txt1);
6.37           UpdHTMLVar('Metakey':         'RUTINETEKST');
6.37           WrtSection('MetaTag');
6.37
6.37           WrtSection('ArchiveCommandEnd');
6.37  /End-free
6.37  *
6.37 c                   endif
6.37  *
6.37  /Free
6.37           WrtSection('Footer');
6.37  /End-free
6.37  *
6.37 c                   eval      XML_Output = XML_path + l_filg +'/'+
6.37 c                             'JV621_'+ %trim(w_jkey) + '.xml'
6.37  *
6.37 c                   callp     WrtHtmlToStmf(XML_Output: 819)
6.39  * Skriver til datakø for å aktivere sniffer, hvis dataq er aktiv
6.39 c                   if        d_dtaq = '1'
6.39 c                   eval      p_xmlf = xml_output
6.39 c                   eval      p_filg = 'ADB'+l_filg
6.39 c                   call      'AP629C'
6.39 c                   parm                    p_filg
6.39 c                   parm                    p_xmlf
6.39 c                   endif
6.37  *
6.37 c                   endsr
7.02  *
7.02  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.02  * Subrutine for å oprette vare i utstillingstabell
7.02  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
7.02  *
7.02 c     ex_vuts       begsr
7.02  * Finn GTIN nuummer
7.02 c                   eval      vvepl1_pvar = p_vare
7.02 c                   eval      vvepl1_penh = w_enh1
7.02 c                   eval      vvepl1_pldo = p_pgiv
7.02 c     vvepl1_key    chain     vvepl1
7.02 c                   if        not %found
7.02 c                   eval      vepgti = 0
7.02 c                   endif
7.02  * Prøver med GTIN fra hovedlavenrandør
7.02 c                   if        vepgti = 0
7.02 c                   eval      vvepl1_pvar = p_vare
7.02 c                   eval      vvepl1_penh = w_enh1
7.02 c                   eval      vvepl1_pldo = vvldor
7.02 c     vvepl1_key    chain     vvepl1
7.02 c                   if        not %found
7.02 c                   eval      vepgti = 0
7.02 c                   endif
7.02 c                   endif
7.02  *
7.02 c                   eval      vutslu_tvar = p_vare
7.02 c     vutslu_key    chain     vutslur
7.02  *
7.02 c                   if        not %found
7.02 c                   eval      vutfir = w_firm
7.02 c                   eval      vutlag = vutslu_tlag
7.02 c                   eval      vutvar = vutslu_tvar
7.02  *
7.02 c                   eval      vutpls = 'Automatisk opprettet'
7.02 c                   eval      vutldo = p_pgiv
7.02 c                   move      vepgti        vutgti
7.02 c                   eval      vutenh = w_enh1
7.02  *
7.02 c                   time                    vutoda
7.02 c                   time                    vutoti
7.02 c                   eval      vutous = l_user
7.02 c                   time                    vuteda
7.02 c                   time                    vuteti
7.02 c                   eval      vuteus = l_user
7.02  *
7.02 c                   write     vutslur
7.02 c                   endif
7.02  *
7.02 c                   endsr
7.02  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_list
7.01 c                   parm                    p_vare
7.02 c                   parm                    p_vuts
      *
      * Key for les på vare
      *
     c     jvarl9_key    klist
     c                   kfld                    jvarl9_ldor
      *
      * Key for oppslag på vare
      *
     c     jvarl1_key    klist
     c                   kfld                    jvarl1_vare
      *
      * Key for oppslag på EVR-vare
      *
     c     vvarl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl1_vare
      *
      * Key for oppslag på varepris
      *
     c     vvprlr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvprlr_vare
6.20 c                   kfld                    vvprlr_ldor
5.70 c                   kfld                    vvprlr_prgr
     c                   kfld                    vvprlr_enhe
     c                   kfld                    vvprlr_lety
     c                   kfld                    vvprlr_pdat
6.37  *
6.37  * Key for rutineregisteret
6.37  *
6.37 c     aforl1_key    klist
6.37 c                   kfld                    aforl1_ruti
5.60  *
5.60  * Key for oppslag på vare enhet
5.60  *
5.60 c     vvenlr_key    klist
5.60 c                   kfld                    w_firm
5.60 c                   kfld                    vvenlr_vare
5.60 c                   kfld                    vvenlr_enhe
6.11  *
6.11  * Key for oppslag på vare enhet  pr. eann
6.11  *
6.16 c     vvepl2_key    klist
6.11 c                   kfld                    w_firm
6.16 c                   kfld                    vvepl2_pgti
6.11  *
6.11  * Key for oppdatering på vare enhet
6.11  *
6.11 c     vvenlu_key    klist
6.11 c                   kfld                    w_firm
6.11 c                   kfld                    vvenlu_vare
6.11 c                   kfld                    vvenlu_enhe
6.16  *
6.16  * Key for oppdatering på vare enhet prisgiver
6.16  *
6.16 c     vveplu_key    klist
6.16 c                   kfld                    w_firm
6.16 c                   kfld                    vveplu_pvar
6.16 c                   kfld                    vveplu_penh
6.16 c                   kfld                    vveplu_pldo
      *
      * Key for oppslag på vare-detalj
      *
     c     jvdtl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jvdtl1_dvar
      *
      * Key for oppslag på vare-pris
      *
     c     jvprl1_key    klist
     c                   kfld                    jvprl1_vare
     c                   kfld                    jvprl1_ldor
      *
      * Key for les på vare-pakning
      *
     c     jvpkl2_key    klist
     c                   kfld                    jvpkl2_vare
6.30 c                   kfld                    jvpkl2_ldor
     c                   kfld                    jvpkl2_enhe
      *
     c     jvpkl2_key2   klist
     c                   kfld                    jvpkl2_vare
6.30 c                   kfld                    jvpkl2_ldor
      *
      * Key for oppdatering av register over slettede varer
      *
     c     vvaslu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvaslu_vare
      *
      * Key for oppslag på EAN
      *
     c     veanl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    veanl1_eann
5.60  *
5.60  * Key for oppdat. på EAN
5.60  *
5.60 c     veanlu_key    klist
5.60 c                   kfld                    w_firm
5.60 c                   kfld                    veanlu_eann
      *
      * Key for oppslag på lager
      *
     c     vlaglu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vlaglu_vare
5.70 c                   kfld                    vlaglu_lage
      *
      * Key for les på søketekst
      *
     c     jsokl1_key    klist
     c                   kfld                    jsokl1_vare
      *
      * Key for oppslag på EVR-søketekst
      *
     c     vsokl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vsokl1_vare
     c                   kfld                    vsokl1_stek
      *
      * Key for oppdatering av midlertidig pris
      *
     c     jwprlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jwprlu_vare
      *
      * Key for oppdatering av vare-detalj
      *
     c     jvdtlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jvdtlu_dvar
      *
      * Key for oppslag på firma
      *
     c     afirl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på OFAK-kode
      *
     c     fstsl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på leverandør
      *
     c     jlevl1_key    klist
     c                   kfld                    jlevl1_ldor
      *
      * Key for oppslag på overgruppe
      *
     c     vogrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vogrl1_oogr
      *
      * Key for oppslag på hovedgruppe
      *
     c     vhgrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vhgrl1_hogr
     c                   kfld                    vhgrl1_hhgr
      *
      * Key for oppslag på undergruppe
      *
     c     vugrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vugrl1_uogr
     c                   kfld                    vugrl1_uhgr
     c                   kfld                    vugrl1_uugr
6.14  *
6.14  * Key for oppslag på sortimentskode
6.14  *
6.14 c     jsorl1_key    klist
6.14 c                   kfld                    jsorl1_osor
      *
      *
      * Key for les på leveringstype
      *
     c     vltpl1_key    klist
     c                   kfld                    w_firm
5.70  *
5.70  * Key for les på prisgruppe
5.70  *
5.70 c     ra30l1_key    klist
5.70 c                   kfld                    w_firm
5.70  *
5.70  * Key for les på lager
5.70  *
5.70 c     ra10l1_key    klist
5.70 c                   kfld                    w_firm
6.34  *
6.34  * Key for les på abc parameter
6.34  *
6.34 c     mltilr_key    klist
6.34 c                   kfld                    w_firm
6.34 c                   kfld                    mltilr_ogrp
6.34 c                   kfld                    mltilr_hgrp
6.34 c                   kfld                    mltilr_ugrp
6.34 c                   kfld                    mltilr_ldor
6.34 c                   kfld                    mltilr_vare
6.34 c                   kfld                    mltilr_lage
6.34 c                   kfld                    mltilr_crdo
6.3f  *
6.3f  * Key for les på vare-leverandør
6.3f  *
6.3f c     jvlel3_key    klist
6.3f c                   kfld                    jvlel3_lldo
7.03 c*                  kfld                    jvlel3_lvnr
      *
6.3i  * Key for oppdatering av vare-leverandør i EVR
6.3i  *
6.3i c     vvlelu_key    klist
6.3i c                   kfld                    w_firm
6.3i c                   kfld                    vvlelu_lvnr
6.3i c                   kfld                    vvlelu_lldo
6.3i  *
6.3i  * Key for les av logistikkvare
6.3i  *
6.3i c     jvkhl1_key    klist
6.3i c                   kfld                    w_firm
6.3i c                   kfld                    jvkhl1_kvnr
7.02  *
7.02  * Key for oppdatering av utstillingstabell
7.02  *
7.02 c     vutslu_key    klist
7.02 c                   kfld                    w_firm
7.02 c                   kfld                    vutslu_tlag
7.02 c                   kfld                    vutslu_tvar
7.02  *
7.02  * Key for oppdatering på vare enhet prisgiver
7.02  *
7.02 c     vvepl1_key    klist
7.02 c                   kfld                    w_firm
7.02 c                   kfld                    vvepl1_pvar
7.02 c                   kfld                    vvepl1_penh
7.02 c                   kfld                    vvepl1_pldo

      *
      * Splitter datastruktur i enkelt-parametre
      *
     c                   eval      d_list = p_list
     c                   eval      p_firm = d_firm
     c                   eval      p_ldor = d_ldor
     c                   eval      p_ogrp = d_ogrp
     c                   eval      p_hgrp = d_hgrp
     c                   eval      p_ugrp = d_ugrp
     c                   eval      p_pgiv = d_pgiv
     c                   eval      p_skaf = d_skaf
     c                   eval      p_kntr = d_kntr
6.36 c                   eval      w_pdat = d_dato
6.36 c                   eval      w_utgp = d_utgp
7.02 c                   eval      vutslu_tlag = l_lage
      *
     c                   eval      w_firm = p_firm
      *
      * Henter dagens dato og klokkelslett
      *
     c                   time                    w_udat
     c                   time                    w_utim
6.37  * Sjekk om vi skal bruke XML generering av dokumenter
6.37  * NB KUN hvis EXCEL rapport. Hvis ikke skal det dannes PDF av spoolfile
6.37  *
6.37 c                   if        l_poff = '1' and
6.37 c                             l_exlp = 1
6.37 c                   eval      b_excl = *off
6.37 c                   eval      w_pdf = 0
6.37 c                   eval      w_pdf_ds = *blanks
6.37 c                   eval      w_ruti = l_ruti
6.37  *
6.37 c                   call      'AP609R'
6.37 c                   parm                    w_ruti
6.37 c                   parm                    w_pdf
6.37 c                   parm                    w_pdf_ds
6.37 c                   eval      d_pdf_ds = w_pdf_ds
6.37  * PROA er aktivert
6.37 c                   if        w_pdf = 1 and
6.37 c                             %trim(d_xmlm) <> *blanks
6.37 c                   eval      w_jkey = l_bach
6.37  *
6.37  * Hent inn xml templaten
6.37  *
6.37 c                   callp     GetHTMLIFS(d_xmlm :'<AS400>')
6.37  *
6.37  * Finn hvor xml'en skal legges
6.37  *
6.37 c                   eval      XML_path = *blanks
6.37 c                   eval      XML_path = %trim(d_path)
6.37  *
6.37  * Jobbnummer er allerede generert i AP600R. Overføres i *lda
6.37  *
6.37 c                   time                    w_date
6.37 c                   time                    w_dato2
6.37 c                   movel     w_dato2       w_tids
6.37 c                   move      w_dato2       w_ddmy
6.37  * Vi logger at utskriftprogrammet har startet
6.37 c                   eval      w_jstat = 10
6.37 c                   eval      w_jtext = 'Excel av nye varer til EVR +
6.37 c                                        har startet'
6.37 c                   call      'AB705R'
6.37 c                   parm                    l_bach
6.37 c                   parm                    w_jstat
6.37 c                   parm                    w_jtext
6.37  * Vi skriver xml for miljø formater
6.37 c                   exsr      xml_envm
6.37 c                   exsr      xml_head
6.37 c                   eval      b_excl = *on
6.37 c                   else
6.37  * Vi logger at noe er galt med parametrene
6.37 c                   eval      w_jstat = 20
6.37 c                   eval      w_jtext = 'Finner ikke path til xml !!! +
6.37 c                             Sjekk rutineregister !'
6.37 c                   call      'AB705R'
6.37 c                   parm                    l_bach
6.37 c                   parm                    w_jstat
6.37 c                   parm                    w_jtext
6.37 c                   endif
6.37  *
6.37  *  Hent inn firma/avd. opplysninger dersom
6.37  *  kode for det er satt i rutineregister
6.37  *
6.37 c                   if        l_prfi = 1 or
6.37 c                             l_prfi = 2
6.37 c                   eval      w_prfi = l_prfi
6.37 c                   eval      w_ffir = w_firm
6.37 c                   eval      w_avde = l_avde
6.37  *
6.37 c                   call      'FÅ707R'
6.37 c                   parm                    w_prfi
6.37 c                   parm                    w_ffir
6.37 c                   parm                    w_avde
6.37 c                   parm                    w_fnav
6.37 c                   parm                    w_fad1
6.37 c                   parm                    w_fad2
6.37 c                   parm                    w_fste
6.37 c                   parm                    w_fftx
6.37 c                   parm                    w_tfax
6.37 c                   parm                    w_ftlf
6.37 c                   parm                    w_ffax
6.3a c                   parm                    w_mail
6.3a c                   parm                    w_weba
6.37 c                   endif
6.37  *
6.37 c                   else
6.37 c                   eval      b_excl = *off
6.37 c                   endif
6.37  *
6.37 c                   if        b_excl = *off
6.37 c                   open      jv621p
6.37 c                   endif
      *
7.01  *
7.01  * Endring 6.31
7.01  *
7.01   CallP CO402R(l_filg:w_firm:0:'JV621R_701':
7.01                    co402_verdi1:co402_verdi2);
7.01   if co402_verdi1 = '1';
7.01     u_701 = *on;
7.01   endif;
     c                   endsr
