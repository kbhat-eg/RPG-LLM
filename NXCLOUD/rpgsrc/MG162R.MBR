     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASVADM
      * Program . . . . : mg162R
      * Beskrivelse . . : Motta prisforslag i XLNETT
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       150222 bof  Nytt program
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     fmg162d    cf   e             workstn
      *
      * Local data area
      *
     d                uds
     d l_firm                944    946  0
      *
      *
      * Datastruktur for parameterliste -ut
      *
      * Definering av variable i nøkler
6.34 d ds_vpfust     E ds                  extName(vpfust)
6.34 d vpfu_uid      e                     extfld(uid)
      *
      * Definering av variable
      *
     d b_feil          s              1    inz(*off)
     d b_frst          s              1    inz(*off)
     d b_eof           s              1    inz(*off)
      *
     d w_udat          s               d   datfmt(*iso)
      *
     d w_firm          s              3  0
     d p_jkey          s             41
     d w_jtxt          s            200
     d w_jsta          s              2  0
     d w_stat          s              1

      *
6.3q C/Exec SQL
6.3q C*+  Set Option DatFmt=*ISO , commit=*none
6.3q C+  Set Option DatFmt=*ISO
6.3q C/End-Exec
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B1 Behandle åpningsbildet
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     b1tag         tag
      *
      * Behandler bildet
      *
     c                   exfmt     b1bld
      *
      * Behandling av standard funksjonstaster
      *
     c                   select
     c                   when      *inkc or *inkl
     c                   goto      avslutt
     c                   endsl
      *
      * kaller cl som gjør clrpfm + cpyf
6.20 c                   call      'MG162C'
     c
6.33  **  prisforslag
6.34 c*                   exsr      rydd_prisf
6.34  **
6.34  **
6.34 c*                   exsr      dann_prisf

      *
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  * Subrutine for å rydde prisforslag
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  *
6.34 c*     rydd_prisf    begsr
6.34  ** prisprofile
6.34 c*/exec sql
6.34 c*+ delete
6.34 c*+ from   vpfost
6.34 c*/end-exec
       //exec sql commit;
       //exec sql
       //   alter TABLE vpfost
       //     alter column uid
       //     set generated always as identity
       //     set cycle
       //     restart with 1;
       //
6.34 c*                   endsr
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  * Subrutine for å rydde prisforslag
6.34  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.34  *
6.34 c*     dann_prisf    begsr
     c*
6.34  ** prisforslag
      *
       //           exec sql
       //    Close c1;
       //
       //
       //  //Declare the campaign_cursor
       //  exec sql
       //    Declare c1 cursor for
6.31   //      select
       //vpffir,
       //vpfvar,
       //vpfprg,
6.39   //vpffda,
6.39   //vpftda,
6.39   //vpfsko,
6.39   //vpfen1,
6.39   //vpfin1,
6.39   //vpfko1,
6.39   //vpfor1,
6.39   //vpfen2,
6.39   //vpfin2,
6.39   // vpfko2,
6.39   // vpfor2,
6.39   // vpfen3,
6.39   // vpfin3,
6.39   // vpfko3,
6.39   // vpfor3,
6.39   // vpfver,
6.39   // vpftms,
6.39   // vpffid,
6.39   // vpfoda,
6.39   // vpfoti,
6.39   // vpfeda,
6.39   // vpfeti,
6.39   //  vpfeus
6.31   //      from vpfust;
       //  //Open the cursor
       //  exec sql
       //    Open c1;
       //
       //  if sqlcod <> 0 and sqlcod <> 100;
6.34 c*                   eval      w_jtxt = *blank
6.34 c*                   eval      w_jtxt = 'vpfost ' +
6.34 c*                             %char(sqlcod)
6.34 c*                   exsr      feil
6.34 c*                   leavesr
       //  endif;
       //
       ////Fetch data in a loop
       //Dou b_eof = *on;
       //  exec sql
6.31   //  Fetch c1 INTO
       // :vpffir,
       // :vpfvar,
       // :vpfprg,
6.39   // :vpffda,
6.39   // :vpftda,
6.39   // :vpfsko,
6.39   // :vpfen1,
6.39   // :vpfin1,
6.39   // :vpfko1,
6.39   // :vpfor1,
6.39   // :vpfen2,
6.39   // :vpfin2,
6.39   // :vpfko2,
6.39   // :vpfor2,
6.39   // :vpfen3,
6.39   // :vpfin3,
6.39   // :vpfko3,
6.39   // :vpfor3,
6.39   // :vpfver,
6.39   // :vpftms,
6.39   // :vpffid,
6.39   // :vpfoda,
6.39   // :vpfoti,
6.39   // :vpfeda,
6.39   // :vpfeti,
6.39   // :vpfeus;
       //
       //  if sqlcod <> 0;
       //    if sqlcod = 100;
       //      leavesr;
       //    endif;
       //  if sqlcod <> 100;
     c*                   eval      w_jtxt = *blank
6.34 c*                   eval      w_jtxt = 'vpfost ' +
6.34 c*                             %char(sqlcod)
6.34 c*                   exsr      feil
6.34 c*                   leavesr
       //  endif;
       //  endif;
       //
6.34 c*/exec sql
6.34 c*+ insert into vpfost (
     c*+ vpffir,
     c*+ vpfvar,
     c*+ vpfprg,
6.39 c*+ vpffda,
6.39 c*+ vpftda,
6.39 c*+ vpfsko,
6.39 c*+ vpfen1,
6.39 c*+ vpfin1,
6.39 c*+ vpfko1,
6.39 c*+ vpfor1,
6.39 c*+ vpfen2,
6.39 c*+ vpfin2,
6.39 c*+ vpfko2,
6.39 c*+ vpfor2,
6.39 c*+ vpfen3,
6.39 c*+ vpfin3,
6.39 c*+ vpfko3,
6.39 c*+ vpfor3,
6.39 c*+ vpfver,
6.39 c*+ vpftms,
6.39 c*+ vpffid,
6.39 c*+ vpfoda,
6.39 c*+ vpfoti,
6.39 c*+ vpfeda,
6.39 c*+ vpfeti,
6.39 c*+  vpfeus)
6.34 c*+ select 0,
     c*+ :vpfvar,
     c*+ :vpfprg,
6.39 c*+ :vpffda,
6.39 c*+ :vpftda,
6.39 c*+ :vpfsko,
6.39 c*+ :vpfen1,
6.39 c*+ :vpfin1,
6.39 c*+ :vpfko1,
6.39 c*+ :vpfor1,
6.39 c*+ :vpfen2,
6.39 c*+ :vpfin2,
6.39 c*+ :vpfko2,
6.39 c*+ :vpfor2,
6.39 c*+ :vpfen3,
6.39 c*+ :vpfin3,
6.39 c*+ :vpfko3,
6.39 c*+ :vpfor3,
6.39 c*+ :vpfver,
6.39 c*+ :vpftms,
6.39 c*+ :vpffid,
6.39 c*+ :vpfoda,
6.39 c*+ :vpfoti,
6.39 c*+ :vpfeda,
6.39 c*+ :vpfeti,
6.39 c*+ :vpfeus
6.34 c*+   from vpfust
6.34 c*/end-exec
6.34 c*                   if        sqlcod <> 0
6.34 c*                   eval      w_jtxt = *blank
6.34 c*                   eval      w_jtxt = 'vpfost ' +
6.34 c*                             %char(sqlcod)
6.34 c*                   exsr      feil
6.34 c*                   leavesr
6.34 c*                   endif
       //     enddo;
       //
       //exec sql commit;
6.34  *
6.34 c*                   endsr
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c*     feil          begsr
      **
     c*                   eval      w_jtxt = w_jtxt +
     c*                                      'Feil med SQL ' + %char(sqlcod)
     c*                   eval      w_jsta = 10
     c*                   call      'AB705R  '
     c*                   parm                    p_jkey
     c*                   parm                    w_jsta
     c*                   parm                    w_jtxt
     c*                   eval      w_stat = '1'
     c*                   endsr

      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      *
      * Initiering av skjermfelter
      *
     c                   eval      w_firm = l_firm
      *
     c                   time                    w_udat
      *
     c                   endsr
      *
