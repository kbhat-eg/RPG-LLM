# Program Overview

This RPG program (JO740R) operates on an IBM i (AS/400) system. Its purpose is to **reset ("nullstille") certain fields** for records in a physical file where a status field (`jokode`) has a specific value (`3`) and another field (`jovkod`) is zero. The program processes all relevant records for a given company (`firm`), as indicated by data in the system's *Local Data Area* (LDA).

## Sections Breakdown

---

### Header and File Declaration

```rpg
h option(*nodebugio) datedit(*dmy)
```
- Sets compile options:
  - *nodebugio*: No debug input/output.
  - *datedit*: Date format is day/month/year.

```rpg
fjmatlu    uf   e           k disk    rename(jmatpfr:jmatlur)
```
- `jmatlu` is the file name, with:
  - `u` (update), `f` (full procedural), `e` (externally described), `k` (keyed).
  - Disk file.
  - Renames record format from `jmatpfr` to `jmatlur`.

---

### Data Definitions

**Local Data Area Access**
```rpg
d                uds
d l_firm                944    946  0
```
- First line allows access to the LDA (User Data Space).
- `l_firm`: a 3-character numeric field, which will extract the "firm" number from positions 944 to 946 in the LDA.

**Variables**
```rpg
d w_firm                              like(jofirm)
```
- `w_firm`: Work variable for firm, same type as `jofirm` (presumably a field from the file).

---

### Main Logic (Hovedprogram)

```rpg
c     jmatlu_key    setll     jmatlu
c     jmatlu_key    reade     jmatlur                                90
c                   dow       *in90 = *off
```
- Positions the file (`setll`) and reads the first record for the keyed selection (`reade`). If not found, indicator `*in90` is set on.
- The loop (`dow *in90 = *off`) continues while records are found.

**Processing each record:**
```rpg
c                   if        jokode = 3 and
c                             jovkod = 0
c                   eval      jokode = 0
c                   eval      joldo2 = 0
c                   eval      jovar2 = *blank
c                   update    jmatlur
c                   else
c                   unlock    jmatlu
c                   endif
```
- If `jokode` equals 3 and `jovkod` equals 0:
  - Set `jokode` to 0.
  - Set `joldo2` to 0.
  - Set `jovar2` to blanks.
  - Update the record.
- Else: Just unlock the record (no changes).

```rpg
c     jmatlu_key    reade     jmatlur                                90
c                   enddo
```
- Continue to read next record and repeat until all are processed.

---

### Program Termination

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Tag for program end (`avslutt`).
- Sets Last Record Indicator (`*inlr`) on, closing files and cleaning up.
- Returns from the program.

---

### Initialization Subroutine (`*inzsr`)

```rpg
c     *inzsr        begsr
```
- This is the initialization routine, automatically executed at program start.

**Key Definition for File:**
```rpg
c     jmatlu_key    klist
c                   kfld                    w_firm
```
- Defines the key list for file access; the key field is `w_firm`.

**Get Firm from LDA:**
```rpg
c                   eval      w_firm = l_firm
```
- Sets `w_firm` to the value read from the Local Data Area.

```rpg
c                   endsr
```
- End of subroutine.

---

## Summary and Flow

1. **Initialization**: Reads the current firm ID from LDA; sets it as the key for processing.
2. **Main Loop**:
   - Reads all records for that firm from `jmatlu`.
   - If `jokode` is 3 and `jovkod` is 0:
     - Resets certain fields to zero/blanks.
     - Writes the change to the database.
   - Otherwise, unlocks the record.
3. **Exit**: Cleans up and ends.

---

## Common Terms

- **jokode, jovkod, joldo2, jovar2**: File fields. `jokode` is a status code; `joldo2`, `jovar2` are fields reset by this program.
- **LDA**: Local Data Area, a storage area in IBM i for passing user or environment-specific data, like current firm.
- **Keyed File Access**: Uses the firm number as the selection key (via `klist`). Only records for the specified firm are processed.

---

## Purpose

This program is typically run as a utility to "clear the match" for items (varer) with an update status of 3 â€” that is, setting their status and associated fields back to "empty" if a certain secondary condition is met. It is specific for each company (`firm`) as defined in the Local Data Area.