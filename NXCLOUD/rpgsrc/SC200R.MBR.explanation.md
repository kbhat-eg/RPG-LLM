# Overview

This RPG program (SB200R) is a maintenance utility for the "budget-level register" (budsjett-nivå-register) in a system called ASSTAT. The program uses subfiles on a display file to allow users to view, change, or manage budget level records.

Below is a breakdown and explanation organized by area:

---

## Header and File Definitions

- `/title` and header comments: Document module name, date, description, and changes.
- `h` spec: Sets date edit to DMY and disables debug I/O.
- `f` specs:
  - `sc200d`: Workstation (display file), using subfile `b1sfl` in `b2ctl` format.
  - `slnil1`: Input file keyed, holds main budget level records (physical file or logical file).
  - `slnilu`: Update file, similar to above but for updating.

---

## Data Definitions (`d` specs)

- Arrays: `mld` and `rpt`, for messages and report lines.
- User Profile variables: `l_user`, `l_firm`, `l_fnav` for user, firm number, and user name.
- `w_kode` data structure: 12-digit structure broken into specific components for mapping keys/fields.
- Subfile control variables: `spge01`, `srrn01`, `sfrn01`, `ssrn01` track subfile page, records, etc.
- Misc: Variables for copying keys and tracking selection.

---

## Main Control Flow

The mainline C-spec code implements an interactive subfile maintenance screen, with a mixture of display and immediate edit/update logic.

- `b2taga` / `b2tagb`: Program tags for controlling flow with `goto` (old RPG style menu loop).
- Display the command area, then move to working with the subfile (`write b2cmd`, `exsr xdsp01`).
- `*inkc` / `*inke`: Exit program or refresh subfile.
- Subfile navigation: Handles page up (`*in10`), home (`*in21`), and subfile positioning (`b2kode`).
- Subfile selection processing: For each subfile record, checks for option '5' (display record), calls `xf0win` to handle the view, updates subfile display.

---

## Subroutines

### `xslutt`
- Ends the program (`*inlr = *on`), returns control.

### `xf0win`
- Handles the "view" action for a record (`valg = '5'`).
- Reads the selected record, sets up window values, displays using `exfmt`, optionally calls another program (`SC210R`), and resets subfile option if necessary.

### `xclr01`
- Clears the subfile: resets page and record counters, writes the subfile control format to clear out the subfile on-screen.

### `xcrt01`
- Loads up to 10 new records into the subfile starting from the last record shown.
- Each visible record is loaded with data and descriptive text found via a table lookup (`hntarr`).

### `xdsp01`
- Displays the subfile (conditional display indicators are set for record or page state).

### `hntarr`
- Populates up to three result variables (`r1`,`r2`,`r3`) with numbers corresponding to the parts of `w_kode` structure (based on their values, using many `ifeq` checks).
- These numbers are used to retrieve text descriptions for the subfile from the array `rpt`.

### `*inzsr` (initialization subroutine)
- Initializes keys, copy variables, and sets up the initial subfile view.

---

## Data Tables

At the bottom are tables and comments indicating:
- Option codes (e.g., Ny post = 001, Endring = 002, Vise = 003...), describing what each code means in the UI.
- Sorting order keys (e.g., Avdeling = 11/Division, Lager = 12/Warehouse, etc.), mapping code numbers to their textual description.

---

## Key RPG/AS400 Concepts Used

- **Subfiles**: Technique for managing lists on green-screen interfaces.
- **Display Control**: `exfmt`/`write` for user screens.
- **Indicators/Keys**: Classic RPG method for controlling events and records.
- **External Calls**: Calls to other programs (`CALL 'SC210R'`).
- **Field Decomposition**: Use of data structures (`w_kode`) to individually address digits of a compound key.
- **Table lookups**: Using arrays (`rpt`) and result indexes (`r1`, `r2`, `r3`) to map codes to textual descriptions for display.

---

## Typical User Flow

1. The user starts in a subfile screen listing budget-level records.
2. User can page, search, or home.
3. User may select a record with option '5' for "Vise" (view) – launches a windowed detail display.
4. Program manages refresh, load, clear, and display of subfile records in batches (paging).
5. Subroutines keep the data consistent, fetch textual info, and perform lookups based on code decomposition logic.

---

## Notes for Onboarding

- Code is in classic (fixed-format) RPG IV, not free-form. If you are used to free-form RPG, you’ll need to pay attention to column rules.
- Control flow uses tags and GOTO, which are legacy approaches, but still common in maintenance/green-screen applications.
- The heart of the program is subfile maintenance, so learn about subfile mechanics if unfamiliar.
- The field decomposition in `w_kode` and its use to look up descriptions is central to how the program translates codes into human-readable text.

---

## Summary

This is a classic RPG maintenance program for a master data table ("budget level register") that uses subfiles and a lookup array to let users maintain, view, and work with records in a green-screen environment. The logic is robust but implemented with older RPG idioms, so modernizing would involve refactoring for clarity, modularity, and use of free-form RPG.