# RPG Source Code Explanation

This RPG program is designed to generate GTIN (Global Trade Item Number) identifiers based on either a NOBB number or other input parameters. It includes logic for creating 13-digit GTIN codes and 14-digit EAN codes, with subroutines for calculating check digits and initializing variables.

---

## Program Metadata

- **System:** ASOFAK
- **Program Name:** Fï¿½901R
- **Description:** Generates GTIN numbers based on NOBB numbers.
- **Versioning Notes:** Comments indicate updates, like fixing calculation errors.

---

## Definitions and Data Structures

### Arrays

- **eana13, ean13:** Arrays for 12 and 13 digit EAN/GTIN codes.
- **eana14, ean14:** Arrays for 13 and 14 digit codes.
- **Additional variables:** Used for intermediate calculations, such as `weannr`, `weanna`, `weanop`, etc.

### Parameters

- **p_gtin:** Output GTIN (14 characters)
- **p_nobb:** Input NOBB number (8 characters)
- **p_type:** Type indicator ('1' or '2') to determine the code generation method.

### Variables

- **w_eann, w_gtin, w_eanr14, w_eanr13:** Work variables for intermediate processing of codes.
- **w_eaop, w_easf, w_ea00, w_ea02:** Used for check digit calculations and sum totals.
- **Additional internal variables for control and calculations.**

---

## Main Logic Overview

### Generating GTIN Based on Type

- **Type '1'**:
  - Loads the NOBB number (`p_nobb`) into `wwvar8`.
  - Moves this to `weannr`.
  - Calls subroutine `ean_13` to generate the 13-digit GTIN.
  - Transfers the result to `p_gtin`.

- **Type '2'**:
  - Initializes `w_eanr14` with zeroes.
  - Loads the NOBB number into `w_eanr14`.
  - Calls subroutine `ean_14` to generate the 14-digit code.
  - Transfers the result to `p_gtin`.

### Program Termination
- Sets the `*INLR` indicator to *ON* to mark the end of the program.
- Returns control to the caller.

---

## Subroutine: `ean_13` (Calculate 13-Digit EAN)

- Initializes control variables.
- Copies input number to internal arrays.
- Calculates the check digit:
  - Sums specific digits with weights (alternating sum).
  - Multiplies partial sums for weighted sum.
- Adds a correction factor to determine the check digit.
- Completes calculation, resulting in a valid 13-digit GTIN with check digit.

---

## Subroutine: `ean_14` (Calculate 14-Digit EAN)

- Similar purpose as `ean_13`, but for 14-digit EAN codes.
- Uses different arrays and calculation logic.
- Calculates the check digit for 14-digit codes.
- Ensures correct check digit (0-9) is calculated by adjusting the sum.

---

## Initialization Subroutine: `*inzsr`

- Clears all internal working variables.
- Prepares the program state.
- Accepts input parameters for NOBB number, GTIN, and type.

---

## Summary

This program automates the creation of GTIN/EAN codes based on provided NOBB numbers. It ensures the generated code conforms to the EAN checksum standards by employing dedicated subroutines for check digit calculations. It is adaptable for different code lengths (13 or 14 digits) depending on the type specified.

---

## Usage

- Call with parameters:
  - `p_nobb` (input NOBB number)
  - `p_type` ('1' for GTIN13, '2' for GTIN14)
- Read back `p_gtin` with the generated code.

---

This overview provides a comprehensive understanding of the program's structure and logic, facilitating easy onboarding for RPG developers.