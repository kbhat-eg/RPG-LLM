# IG097R – Navision Setup Web-Service Parameter Maintenance

## Overview

This program (`IG097R`) is responsible for maintaining (viewing/updating) web-service integration parameters for the Navision ERP system, on a per-company basis. It is typically used by system administrators to set up or modify credentials and endpoint information required for the IBM i system to communicate with Navision web services.

The program is interactive (workstation file driven) and operates on a configuration file (`ILNKST`, renamed as `ILNKIUR`) that stores the relevant parameters per company (`firm`). This is part of the broader `ASNAVIOKO` system.

---

## File Definitions

- **ILNKIU**  
  Physical file (user open, keyed, disk) – holds the Navision web-service parameter records, one per company.  
  Renamed as `ILNKIUR` in this program for record format references.

- **IG097D**  
  Display file (workstation) – provides the user interface for viewing and editing the parameters.

---

## Data Structures

- **Local Data Area (LDA) Fields**  
  - `l_user` (positions 911–920): Current user profile.
  - `l_firm` (positions 944–946): Current company number.
  - `l_fnav` (positions 951–980): Company name.

- **Working Variables**  
  - `w_firm`: Company number, used as the key for file operations.
  - `w_date`: Current date (ISO format), for audit fields.
  - `w_time`: Current time (ISO format), for audit fields.

---

## Program Flow

### Initialization (`*INZSR`)

- Builds the key list for accessing/updating the parameter file using `w_firm`.
- Initializes working variables from LDA:
    - `w_firm` ← `l_firm`
    - `a1fnav` (display field) ← `l_fnav`
- Captures current date and time for later use in audit fields.

### Main Logic

1. **Load Parameters**
    - `CHAIN` to `ILNKIU` using `w_firm` as key.
    - If found:
        - Loads all relevant parameter fields from the file into display/input fields (`a1wusr`, `a1wpas`, etc.).
    - If not found:
        - Clears all parameter display fields to blanks.

2. **User Interaction**
    - `EXFMT` displays the parameter screen and allows editing.

3. **Process User Input**
    - If the user presses `F3` (`*INKC`), the program terminates.

4. **Save Changes**
    - Attempts another `CHAIN` to see if the record exists.
    - If not found:
        - Populates all fields from the screen and audit fields, then `WRITE` to create a new record.
    - If found:
        - Updates all fields from the screen and audit fields, then `UPDATE` to modify the existing record.

5. **End Program**
    - Sets LR and returns.

---

## Field/Parameter Details

The following parameters are maintained per company:

- **a1wusr**: Web-service user name.
- **a1wpas**: Web-service password.
- **a1lmal**: Web-service endpoint/mail URL.
- **a1lreq**: Web-service request template or endpoint.
- **a1lres**: Web-service response template or endpoint.
- **a1lsrv**: Web-service server address.
- **Audit Fields**: Date, time, and user are set at each update/insert.

---

## Design Notes & Conventions

- **Auditability**: Every insert/update records the current date, time, and user for tracking changes.
- **LDA Usage**: User and company context is passed via the LDA, which is standard in this system for session-level state.
- **Keying**: All parameter records are keyed by company (`w_firm`).
- **Display File**: The display file (`IG097D`) is used for all user interaction. Field names prefixed with `a1` correspond to screen fields.
- **Error Handling**: There is no explicit error handling for file I/O failures; this is consistent with legacy code in this application area.
- **Exit Handling**: The program uses `F3` to exit and sets LR for clean termination.

---

## Integration Points

- **Navision ERP**: The parameters maintained here are consumed by other programs/modules responsible for actual web-service calls to Navision.
- **Other Programs**: This maintenance program is typically launched from a system administrator menu or as part of a setup workflow.

---

## Business Context

- **Multi-Company Support**: The program supports multiple companies/firms, each with its own set of integration parameters.
- **Security**: Credentials are stored in the parameter file; ensure appropriate file/object-level security is in place.
- **Scandinavian Localization**: Some field names and comments are in Norwegian (e.g., "oppsett" = setup, "firma" = company).

---

## Summary

This program is a standard maintenance screen for integration parameters, tailored for the Navision web-service interface. It ensures that each company's configuration is up-to-date, supporting secure and auditable integration between IBM i and Navision. The code follows established conventions for file handling, LDA usage, and interactive data entry in this system.