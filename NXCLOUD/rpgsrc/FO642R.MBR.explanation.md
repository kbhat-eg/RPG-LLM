# RPG Program FO642R – Explanation

This RPG program is designed for the IBM i (AS/400) platform using the ILE RPG language in fixed-format. It appears to be a parameter entry and validation program for generating a "kjøreliste" (run/drive list), likely in a logistics, transport, or order management context. The program includes screen handling, data validation, and calls to other programs for printing, job handling, and lookups.

Below is an explanation of the key sections of the code:

---

## 1. Header Specifications

```rpg
h datedit(*dmy.) option(*nodebugio)
```

- **h-spec**: Sets date format to day-month-year and disables debug IO for performance.

---

## 2. Documentation (Comments)

The block of comments describes:
- Purpose: "Utskrift av kjøreliste" (Print Drive/Run List).
- System, program ID, description, version history, and author notes.
- History mentions adaptation for new GUI and replacement of an underlying program.

---

## 3. File Declarations (F-Specs)

```rpg
ffo642d    cf   e             workstn
fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
fra07pf    if   e           k disk    rename(ra07pfr:ra07pfr)
fra25lr    if   e           k disk    rename(ra25pfr:ra25lrr)
```

- **fo642d**: Display file for interactive input.
- **votyl1**, **ra07pf**, **ra25lr**: Input files (order type, department, route), renamed for easier reference.

---

## 4. Data Declarations (D-Specs)

Many stand-alone fields and data structures are declared here.

- General work fields: `w_firm`, `w_atxt`, `w_navn`
- Key fields for chaining to files: `ra07pf_firm`, `ra07pf_gkod`, etc.
- Data structures for file member and parameter input (`ldambr`, `ldprec` with overlays for easy sub-field access).
- Local Data Area (`lda`, with fields like `l_ruti`, `l_chgv`, `l_sfir` for program control).

---

## 5. Main Logic

### a. Parameter Entry Loop

```rpg
c     b1tag         tag
...
c                   exfmt     b1bld
```
- Tags mark the beginning of the main user interaction loop.
- Blanks and default values are set for all input fields.
- `exfmt b1bld` displays the input screen and receives user input.

### b. Handling Function Keys

```rpg
c                   select
c                   when      *inkc
c                   goto      xslutt
c                   when      *inkd
c                   exsr      spørring
c                   goto      b1tagb
c                   endsl
```
- Function keys (F3=Exit, F4=Inquiry) are handled.
- F4 triggers a "spørring" (lookup/inquiry) subroutine.

### c. Validation

For each key input parameter (order type, department, route, dates):

- **Order Type**: If entered, validates existence in `votyl1r` file. If not found, sets error indicator and restarts input.
- **Department**: Validates both from and to department fields against `ra07pfr`.
- **Route**: Validates both from and to route fields against `ra25lrr`.
- **Dates**: Ensures dates are not zero, are valid, and `from` date is not after `to` date. Adjusts values or sets errors as needed.

### d. Moving Fields to Parameter Structure

Input values are moved into the parameter data structure (`ldprec` and overlays) for use by other programs.

```rpg
c                   move      b1otyp        ldotyp
...
c                   move      b1tkjo        ldtkjo
c                   move      b1vari        ldvari
```

### e. External Program Calls

- **AP600R**: Called for output/print routines, passing routine code, change flag, and batch indicators.
- **FA920R**: Retrieves latest file member number.
- **FO643C**: Probably the main processing/selection subprogram, receives parameters, file member info, and selection flag.

---

## 6. Subroutines

### a. spørring (Inquiry)

Handles lookup/inquiry actions for various fields triggered by function key (F4). Calls the relevant program for each field:

- Order type: Calls `VA550R`
- Departments: Calls `RA507R`
- Routes: Calls `RA525R`

Parameters are passed and results are returned for display/selection.

### b. *inzsr (Initialization)

- Defines LDA (Local Data Area) for output.
- Resets batch/selection flags and counters.
- Sets up key fields for files, pulling firm number from LDA and applying it as necessary for future file accesses.

---

## 7. Key Lists (KLIST)

Defines keys for chained file access, improving readability and reliability.

---

## 8. Program End

```rpg
c     xslutt        tag
c                   eval      *inlr = *on
c                   return
```
- Sets LR (last record indicator) and exits the program cleanly.

---

# Summary

**FO642R** is a traditional IBM i RPG program for entering, validating, and passing parameters related to "kjøreliste" generation. It:
- Interacts with the user via a display file for parameter entry.
- Validates all input via chained access to master files.
- Supports inquiry (lookups) for each critical field.
- Sets up and passes parameters to other programs for output and file generation.
- Conforms to standard RPG programming structures with clear separation of validation, processing, and subroutines.

This type of program is often central in batch or interactive logistics applications on IBM i systems. Its structure allows for easy update/extension, with all file accesses well defined and key management handled through overlays and data structures.