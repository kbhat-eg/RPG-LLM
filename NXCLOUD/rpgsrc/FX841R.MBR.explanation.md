# FX841R – Delete Prices per Supplier / Subcontractor

## Overview

**Program:** FX841R  
**System:** ASOFAK  
**Description:**  
This program provides a workstation interface for deleting price records associated with a supplier or subcontractor. It serves as a front-end, handling user input, validating supplier numbers, and invoking a backend update program (FX842R) to perform the actual deletion. The program also allows inquiry of supplier details via a call to RL500R.

Business context: This is typically used by administrative personnel to maintain the supplier price list, ensuring that obsolete or incorrect price entries can be efficiently removed.

---

## File and Data Definitions

### Files

- **rlevl1**: Physical file containing supplier records, renamed as `rlevl1r` in this program. Used for validation and display of supplier names.
- **fx841d**: Display file (workstation), provides the user interface for input and messages.

### Data Areas

- **Local Data Area (LDA):**  
  - `l_firm` (positions 944–946): Holds the current firm number, used for context-sensitive operations.

### Key Variables

- `rlevl1_levr`: Local variable for the supplier number, used as a key for file lookups.
- `b_feil`: Error indicator (1 char), set to *on if input validation fails.
- `w_firm`, `w_levr`: Work variables for firm and supplier number, used in program calls and lookups.

---

## Main Program Flow

### 1. **Initialization (`*inzsr`)**

- Loads the current firm number from the LDA into `w_firm`.
- Defines the key list (`rlevl1_key`) for accessing the supplier master file (`rlevl1`).

### 2. **Main Interaction Loop (`b1taga` Tag)**

- **Display Screen:**  
  Uses `EXFMT` to display the primary screen (`b1bld`) and accept user input.
- **Function Key Handling:**  
  - `*INKC` or `*INKL`: Exit program.
  - `*INKD`: Inquiry mode; invokes the `spørring` subroutine (see below).
- **Input Validation:**  
  Calls `sjekk_input` to validate the supplier number.
  - If invalid, resets error state and redisplays the screen.
- **Deletion Request:**  
  - Sets `w_levr` from screen field `b1ldor` (supplier number).
  - Calls program `FX842R` to perform the deletion, passing firm and supplier as parameters.
  - Clears input fields and redisplays the screen for further action.

### 3. **Exit (`avslutt` Tag)**

- Sets LR indicator and returns, ending the program.

---

## Subroutines

### A. **Supplier Inquiry (`spørring`)**

- Triggered by function key (F4, `*INKD`).
- If the field in focus is the supplier number (`w_afld = 'B1LDOR'`):
  - Sets `w_levr` from input field.
  - Calls `RL500R` (presumably a supplier inquiry program), passing firm, supplier, and a text field for supplier name.
  - Returns to the main loop.

### B. **Input Validation (`sjekk_input`)**

- Resets error indicators and clears the supplier name field.
- Sets `rlevl1_levr` from input field.
- Performs a keyed CHAIN to `rlevl1` using the composite key (`w_firm`, `rlevl1_levr`).
  - If not found (`*IN90 = *ON`):
    - Sets error indicator, and signals error on the display file.
    - Supplier name remains blank.
  - If found:
    - Populates the supplier name field (`b1tek1`) from the record.
- Returns to main loop.

---

## External Program Calls

- **FX842R:**  
  Called with firm and supplier number to perform the actual deletion of price records. This is the backend update program; FX841R is the front-end.

- **RL500R:**  
  Called for supplier inquiry, returns supplier name for display.

---

## Design Notes and Conventions

- **Screen Handling:**  
  The program uses a single-screen loop, redisplaying after each operation or error, which is a standard pattern for legacy workstation RPG programs.
- **Error Handling:**  
  Uses a single-byte error flag (`b_feil`) and display file indicators for field error highlighting.
- **Key List Convention:**  
  The key list `rlevl1_key` is defined in the initialization subroutine and used for all supplier file accesses, ensuring consistent key usage.
- **Separation of Concerns:**  
  The actual deletion logic is encapsulated in FX842R, keeping this program focused on user interaction, validation, and control flow.
- **Inquiry Subroutine:**  
  The inquiry logic is modularized for potential reuse or extension, and currently only supports supplier number inquiry.

---

## Integration Points

- **Data Files:**  
  - `rlevl1` (Supplier Master): Used for validation and to display supplier names.
- **Display File:**  
  - `fx841d`: Provides the UI for operator interaction.
- **Other Programs:**  
  - `FX842R`: Handles deletion of price records.
  - `RL500R`: Supplier inquiry.

---

## Special Considerations

- **Firm Context:**  
  All operations are firm-specific, with the firm number loaded from the LDA at program start.
- **Error Messaging:**  
  Field errors are signaled via indicator *IN31, and the supplier name field is cleared on error for clarity.
- **Localization:**  
  The code and comments are in Norwegian; field and variable names reflect business terms in use (e.g., `leverandør` for supplier).

---

## Summary

FX841R is a user-interactive program for deleting supplier-related price records. It validates user input against the supplier master, provides inquiry capabilities, and delegates data modification to a backend program. The program adheres to established RPG workstation patterns, with clear separation between UI, validation, and update logic, and is tightly integrated with the firm's master data and business processes.