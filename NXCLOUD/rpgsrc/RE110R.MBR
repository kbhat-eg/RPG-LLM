     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *                                                                       *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RE110R                                              *
      * Beskrivelse . . : Oppdaterer kunder fra Externe systemer              *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
      * V5.00     141103  Endret                                         HFL  *
      * V5.40     160106  Oppdatering rettet.                            HFL  *
5.60  * R5.60 AMD 271107  Lagt inn løsning for kontroll av grense for         *
      *                   almenningsrabatter                                  *
      * R5.60     161208  Lagt inn opddatering av alfasøkregister        KOB  *
6.10  * R6.10     060510  Lagt inn sporingsinformasjon                   BSA  *
6.20  * R6.20     140611  Memosaldo er flyttet til egen fil              BSA  *
6.30  * R6.30     110914  Saldofelt flyttet fra RKUN til RKME (rkkjal)   BSA  *
      *                                                                       *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     fre0kpf    ip  ae           k disk
     fraa1l1    if   e           k disk    rename(raa1pfr:raa1l1r)
6.20 frkmelu    uf a e           k disk    rename(rkmepfr:rkmelur)
6.20 f                                     prefix(rx:2)
     frkunlu    uf a e           k disk    rename(rkunpfr:rkunlur)
      *
     d lo              c                   'abcdefghijklmnopqrstuvwxyzæøåÆØÅ'
     d uh              c                   'ABCDEFGHIJKLMNOPQRSTUVWXYZ²ÔÖ²ÔÖ'
      *
      * LOCAL DATA
     d                uds
     d l_user                911    920
     d l_firm                944    946  0
     d l_navn                951    980
      *
     d w_alfa          s                   like(rkalfa)
     d w_adr2          s                   like(rkadr2)
     d w_avde          s                   like(rkavde)
     d w_betb          s                   like(rkbetb)
     d w_betm          s                   like(rkbetm)
     d w_bgir          s                   like(rkbgir)
     d w_dist          s                   like(rkdist)
     d w_eanf          s                   like(rkeanf)
     d w_eank          s                   like(rkeank)
     d w_edik          s                   like(rkedik)
     d w_ekgb          s                   like(rkekgb)
     d w_emal          s                   like(rkemal)
     d w_facn          s                   like(rkfacn)
     d w_fagb          s                   like(rkfagb)
     d w_fagr          s                   like(rkfagr)
     d w_faku          s                   like(rkfaku)
     d w_fcop          s                   like(rkfcop)
     d w_firm          s                   like(rkfirm)
     d w_frgb          s                   like(rkfrgb)
     d w_frie          s                   like(rkfrie)
     d w_frsk          s                   like(rkfrsk)
     d w_ftnr          s                   like(rkftnr)
     d w_gate          s                   like(rkgate)
     d w_inkk          s                   like(rkinkk)
     d w_katg          s                   like(rkkatg)
     d w_kjØr          s                   like(rkkjØr)
     d w_koku          s                   like(rkkoku)
     d w_komn          s                   like(rkkomn)
     d w_kres          s                   like(rkkres)
     d w_kund          s                   like(rkkund)
     d w_ladr          s                   like(rkladr)
     d w_lagr          s                   like(rklagr)
     d w_land          s                   like(rkland)
     d w_lbet          s                   like(rklbet)
     d w_mkod          s                   like(rkmkod)
     d w_mobn          s                   like(rkmobn)
     d w_navn          s                   like(rknavn)
     d w_ocop          s                   like(rkocop)
     d w_ordb          s                   like(rkordb)
     d w_pcop          s                   like(rkpcop)
     d w_pers          s                   like(rkpers)
     d w_ponr          s                   like(rkponr)
     d w_prpa          s                   like(rkprpa)
     d w_ptab          s                   like(rkptab)
     d w_purr          s                   like(rkpurr)
     d w_rabk          s                   like(rkrabk)
     d w_rasp          s                   like(rkrasp)
     d w_renk          s                   like(rkrenk)
     d w_samf          s                   like(rksamf)
     d w_samm          s                   like(rksamm)
     d w_sekv          s                   like(rksekv)
     d w_sent          s                   like(rksent)
     d w_slgr          s                   like(rkslgr)
     d w_spav          s                   like(rkspav)
     d w_sped          s                   like(rksped)
     d w_spfa          s                   like(rkspfa)
     d w_spl1          s                   like(rkspl1)
     d w_spl2          s                   like(rkspl2)
     d w_spl3          s                   like(rkspl3)
     d w_spl4          s                   like(rkspl4)
     d w_spl5          s                   like(rkspl5)
     d w_sprk          s                   like(rksprk)
     d w_sted          s                   like(rksted)
     d w_tilb          s                   like(rktilb)
     d w_tlfn          s                   like(rktlfn)
     d w_tlfx          s                   like(rktlfx)
     d w_valk          s                   like(rkvalk)
      *
     d rkunlu_kund     s                   like(rkkund)
      *
      * Sjekk firma
      *
     c                   if        rkfirm <> l_firm                             Innenfor grenser
     c                   goto      slutt
     c                   endif
      *
      * Sjekk mot kontogrenser
      *
     c                   if        rkkund <= ra1hkt or                          Innenfor grenser
     c                             rkkund > ra1hrs                               FOR KUNDER
     c                   goto      slutt
     c                   endif
      *
     c                   eval      rkfirm = l_firm                              Firma
     c                   eval      w_firm = l_firm                              Firma
     c                   eval      w_kund = rkkund                              Kunde
     c                   eval      w_navn = rknavn                              Navn
     c                   eval      w_gate = rkgate                              Gate
     c                   eval      w_tlfn = rktlfn                              Telefon
     c                   eval      w_lagr = rklagr                              Lager
     c                   eval      w_slgr = rkslgr                              Selger
     c                   eval      w_dist = rkdist                              Distrikt
     c                   eval      w_katg = rkkatg                              Kategori
     c                   eval      w_betb = rkbetb                              Betalingsbetingelse
     c                   eval      w_betm = rkbetm                              Betalingsmåte
     c                   eval      w_bgir = rkbgir                              Bankgiro
     c                   eval      w_renk = rkrenk                              Rentekode
     c                   eval      w_faku = rkfaku                              Faktura kundenr.
     c                   eval      w_valk = rkvalk                              Valutakode
     c                   eval      w_sprk = rksprk                              Sperrekode
     c                   eval      w_mkod = rkmkod                              MVA-kode
     c                   eval      w_ladr = rkladr                              Leveringsadresse
     c                   eval      w_lbet = rklbet                              Leveringsbetingelse
     c                   eval      w_land = rkland                              Landkode
     c                   eval      w_sped = rksped                              Speditørnummer
     c                   eval      w_sted = rksted                              Sted
     c                   eval      w_frie = rkfrie                              Frie koder
     c                   eval      w_ponr = rkponr                              Postnummer
     c                   eval      w_samm = rksamm                              Generalnotamerke
     c                   eval      w_ptab = rkptab                              Påslagstabell
     c                   eval      w_spfa = rkspfa                              Spesifiser faktureri
     c                   eval      w_adr2 = rkadr2                              Mellomadresse
     c                   eval      w_alfa = rkalfa                              Alfa søkefelt
      *
     c                   if        w_alfa = *blank                                                .
     c                   movel     rknavn        rkalfa                         Alfa søkefelt     .
     c                   endif                                                                    .
      *
      * Konvertere alfafelt til store bokstaver
      *
     c     lo:uh         xlate     rkalfa        rkalfa
      *
     c                   eval      w_facn = rkfacn                              Faktoringnummer
     c                   eval      w_avde = rkavde                              Avdeling
     c                   eval      w_kjØr = rkkjØr                              Kjørerute
     c                   eval      w_ordb = rkordb                              Ordrebekreftelse
     c                   eval      w_kres = rkkres                              Kredittsperre
     c                   eval      w_purr = rkpurr                              Purrekode
     c                   eval      w_spav = rkspav                              Spesialavtale
     c                   eval      w_prpa = rkprpa                              Pris/Pakkseddel
     c                   eval      w_samf = rksamf                              Generalnota
     c                   eval      w_fagb = rkfagb                              Fakturagebyr
     c                   eval      w_ekgb = rkekgb                              Ekspedisjonsgebyr
     c                   eval      w_frgb = rkfrgb                              Fraktgebyr
     c                   eval      w_tlfx = rktlfx                              Telefaksnummer
     c                   eval      w_rasp = rkrasp                              Rabattsperre
     c                   eval      w_frsk = rkfrsk                              Frie statistikk-kode
     c                   eval      w_pers = rkpers                              Kontaktperson
     c                   eval      w_ftnr = rkftnr                              Foretaksnummer
     c                   eval      w_spl1 = rkspl1                              Spesifiser lønn 1
     c                   eval      w_spl2 = rkspl2                              Spesifiser lønn 2
     c                   eval      w_spl3 = rkspl3                              Spesifiser lønn 3
     c                   eval      w_spl4 = rkspl4                              Spesifiser lønn 4
     c                   eval      w_spl5 = rkspl5                              Spesifiser lønn 5
     c                   eval      w_sekv = rksekv                              Fakturasekvens
     c                   eval      w_fagr = rkfagr                              Autogiro Fakturagren
     c                   eval      w_sent = rksent                              Autogiro Fullmakt se
     c                   eval      w_tilb = rktilb                              Tilbudsnummer
     c                   eval      w_ocop = rkocop                              Antall ordre
     c                   eval      w_pcop = rkpcop                              Antall pakkseddler
     c                   eval      w_fcop = rkfcop                              Antall faktura
     c                   eval      w_edik = rkedik                              EDI-kode
     c                   eval      w_eank = rkeank                              EAN-kunde
     c                   eval      w_eanf = rkeanf                              EAN-fakturakunde
     c                   eval      w_inkk = rkinkk                              Inkassokode
     c                   eval      w_komn = rkkomn                              Kommunenummer
     c                   eval      w_koku = rkkoku                              Konsernkunde
     c                   eval      w_mobn = rkmobn                              Mobilnummer
     c                   eval      w_emal = rkemal                              E-mail adresse
      *
     c                   eval      rkunlu_kund = rkkund
     c     rkunlu_key    chain     rkunlu
      *
E5.40c                   if        %found                                       ...................
      * Oppdaterer kunde
      *
     c                   eval      rknavn = w_navn                              Navn              .
     c                   eval      rkgate = w_gate                              Gate              .
     c                   eval      rkadr2 = w_adr2                              Mellomadresse     .
     c                   eval      rkponr = w_ponr                              Postnummer        .
     c                   eval      rksted = w_sted                              Sted              .
      *
     c                   if        w_tlfn <> *blank                                               .
     c                   eval      rktlfn = w_tlfn                              Telefon           .
     c                   endif                                                                    .
      *
     c                   if        w_lagr <> *zero                                                .
     c                   eval      rklagr = w_lagr                              Lager             .
     c                   endif                                                                    .
      *
     c                   if        w_slgr <> *zero                                                .
     c                   eval      rkslgr = w_slgr                              Selger            .
     c                   endif                                                                    .
      *
     c                   if        w_dist <> *zero                                                .
     c                   eval      rkdist = w_dist                              Distrikt          .
     c                   endif                                                                    .
      *
     c                   if        w_katg <> *zero                                                .
     c                   eval      rkkatg = w_katg                              Kategori          .
     c                   endif                                                                    .
      *
     c                   if        w_betb <> *zero                                                .
     c                   eval      rkbetb = w_betb                              Betalingsbetingels.
     c                   endif                                                                    .
      *
     c                   if        w_betm <> *zero                                                .
     c                   eval      rkbetm = w_betm                              Betalingsmåte     .
     c                   endif                                                                    .
      *
     c                   if        w_bgir <> *zero                                                .
     c                   eval      rkbgir = w_bgir                              Bankgiro          .
     c                   endif                                                                    .
      *
     c                   if        w_renk <> *zero                                                .
     c                   eval      rkrenk = w_renk                              Rentekode         .
     c                   endif                                                                    .
      *
     c                   if        w_faku <> *zero                                                .
     c                   eval      rkfaku = w_faku                              Faktura kundenr.  .
     c                   endif                                                                    .
      *
     c                   if        w_valk <> *blank                                               .
     c                   eval      rkvalk = w_valk                              Valutakode        .
     c                   endif                                                                    .
      *
     c                   if        w_sprk <> *blank                                               .
     c                   eval      rksprk = w_sprk                              Sperrekode        .
     c                   endif                                                                    .
      *
     c                   if        w_mkod <> *zero                                                .
     c                   eval      rkmkod = w_mkod                              MVA-kode          .
     c                   endif                                                                    .
      *
     c                   if        w_ladr <> *zero                                                .
     c                   eval      rkladr = w_ladr                              Leveringsadresse  .
     c                   endif                                                                    .
      *
     c                   if        w_lbet <> *zero                                                .
     c                   eval      rklbet = w_lbet                              Leveringsbetingelse
     c                   endif                                                                    .
      *
     c                   if        w_land <> *blank                                               .
     c                   eval      rkland = w_land                              Landkode          .
     c                   endif                                                                    .
      *
     c                   if        w_sped <> *zero                                                .
     c                   eval      rksped = w_sped                              Speditørnummer    .
     c                   endif                                                                    .
      *
     c                   if        w_frie <> *blank                                               .
     c                   eval      rkfrie = w_frie                              Frie koder        .
     c                   endif                                                                    .
      *
     c                   if        w_samm <> *blank                                               .
     c                   eval      rksamm = w_samm                              Generalnotamerke .
     c                   endif                                                                    .
      *
     c                   if        w_ptab <> *zero                                                .
     c                   eval      rkptab = w_ptab                              Påslagstabell     .
     c                   endif                                                                    .
      *
     c                   if        w_spfa <> *zero                                                .
     c                   eval      rkspfa = w_spfa                              Spesifiser faktureri
     c                   endif                                                                    .
      *
     c                   if        w_alfa <> *blank                                               .
     c                   eval      rkalfa = w_alfa                              Alfa søkefelt     .
     c                   endif                                                                    .
      *
     c                   if        rkalfa = *blank                                                .
     c                   movel     rknavn        rkalfa                         Alfa søkefelt     .
      *
     c     lo:uh         xlate     rkalfa        rkalfa
      *
     c                   endif                                                                    .
      *
     c                   if        w_facn <> *zero                                                .
     c                   eval      rkfacn = w_facn                              Faktoringnummer   .
     c                   endif                                                                    .
      *
     c                   if        w_avde <> *zero                                                .
     c                   eval      rkavde = w_avde                              Avdeling          .
     c                   endif                                                                    .
      *
     c                   if        w_kjØr <> *zero                                                .
     c                   eval      rkkjØr = w_kjØr                              Kjørerute         .
     c                   endif                                                                    .
      *
     c                   if        w_ordb <> *zero                                                .
     c                   eval      rkordb = w_ordb                              Ordrebekreftelse  .
     c                   endif                                                                    .
      *
     c                   if        w_kres <> *zero                                                .
     c                   eval      rkkres = w_kres                              Kredittsperre     .
     c                   endif                                                                    .
      *
     c                   if        w_purr <> *zero                                                .
     c                   eval      rkpurr = w_purr                              Purrekode         .
     c                   endif                                                                    .
      *
     c                   if        w_spav <> *zero                                                .
     c                   eval      rkspav = w_spav                              Spesialavtale     .
     c                   endif                                                                    .
      *
     c                   if        w_prpa <> *zero                                                .
     c                   eval      rkprpa = w_prpa                              Pris/Pakkseddel   .
     c                   endif                                                                    .
      *
     c                   if        w_samf <> *zero                                                .
     c                   eval      rksamf = w_samf                              Generalnota       .
     c                   endif                                                                    .
      *
     c                   if        w_ekgb <> *zero                                                .
     c                   eval      rkekgb = w_ekgb                              Ekspedisjonsgebyr .
     c                   endif                                                                    .
      *
     c                   if        w_frgb <> *zero                                                .
     c                   eval      rkfrgb = w_frgb                              Fraktgebyr        .
     c                   endif                                                                    .
      *
     c                   if        w_tlfx <> *blank                                               .
     c                   eval      rktlfx = w_tlfx                              Telefaksnummer    .
     c                   endif                                                                    .
      *
     c                   if        w_rasp <> *zero                                                .
     c                   eval      rkrasp = w_rasp                              Rabattsperre      .
     c                   endif                                                                    .
      *
     c                   if        w_frsk <> *blank                                               .
     c                   eval      rkfrsk = w_frsk                              Frie statistikk-kode
     c                   endif                                                                    .
      *
     c                   if        w_pers <> *blank                                               .
     c                   eval      rkpers = w_pers                              Kontaktperson     .
     c                   endif                                                                    .
      *
     c                   if        w_ftnr <> *zero                                                .
     c                   eval      rkftnr = w_ftnr                              Foretaksnummer    .
     c                   endif                                                                    .
      *
     c                   if        w_spl1 <> *blank                                               .
     c                   eval      rkspl1 = w_spl1                              Spesifiser lønn 1 .
     c                   endif                                                                    .
      *
     c                   if        w_spl2 <> *blank                                               .
     c                   eval      rkspl2 = w_spl2                              Spesifiser lønn 2 .
     c                   endif                                                                    .
      *
     c                   if        w_spl3 <> *blank                                               .
     c                   eval      rkspl3 = w_spl3                              Spesifiser lønn 3 .
     c                   endif                                                                    .
      *
     c                   if        w_spl4 <> *blank                                               .
     c                   eval      rkspl4 = w_spl4                              Spesifiser lønn 4 .
     c                   endif                                                                    .
      *
     c                   if        w_spl5 <> *blank                                               .
     c                   eval      rkspl5 = w_spl5                              Spesifiser lønn 5 .
     c                   endif                                                                    .
      *
     c                   if        w_sekv <> *zero                                                .
     c                   eval      rksekv = w_sekv                              Fakturasekvens    .
     c                   endif                                                                    .
      *
     c                   if        w_fagr <> *zero                                                .
     c                   eval      rkfagr = w_fagr                              Autogiro Fakturagren
     c                   endif                                                                    .
      *
     c                   if        w_sent <> *zero                                                .
     c                   eval      rksent = w_sent                              Autogiro Fullmakt se
     c                   endif                                                                    .
      *
     c                   if        w_tilb <> *zero                                                .
     c                   eval      rktilb = w_tilb                              Tilbudsnummer     .
     c                   endif                                                                    .
      *
     c                   if        w_ocop <> *zero                                                .
     c                   eval      rkocop = w_ocop                              Antall ordre      .
     c                   endif                                                                    .
      *
     c                   if        w_pcop <> *zero                                                .
     c                   eval      rkpcop = w_pcop                              Antall pakkseddler.
     c                   endif                                                                    .
      *
     c                   if        w_fcop <> *zero                                                .
     c                   eval      rkfcop = w_fcop                              Antall faktura    .
     c                   endif                                                                    .
      *
     c                   if        w_edik <> *blank                                               .
     c                   eval      rkedik = w_edik                              EDI-kode          .
     c                   endif                                                                    .
      *
     c                   if        w_eank <> *zero                                                .
     c                   eval      rkeank = w_eank                              EAN-kunde         .
     c                   endif                                                                    .
      *
     c                   if        w_eanf <> *zero                                                .
     c                   eval      rkeanf = w_eanf                              EAN-fakturakunde  .
     c                   endif                                                                    .
      *
     c                   if        w_inkk <> *blank                                               .
     c                   eval      rkinkk = w_inkk                              Inkassokode       .
     c                   endif                                                                    .
      *
     c                   if        w_komn <> *zero                                                .
     c                   eval      rkkomn = w_komn                              Kommunenummer     .
     c                   endif                                                                    .
      *
     c                   if        w_koku <> *zero                                                .
     c                   eval      rkkoku = w_koku                              Konsernkunde      .
     c                   endif                                                                    .
      *
     c                   if        w_mobn <> *blank                                               .
     c                   eval      rkmobn = w_mobn                              Mobilnummer       .
     c                   endif                                                                    .
      *
     c                   if        w_emal <> *blank                                               .
     c                   eval      rkemal = w_emal                              E-mail adresse    .
     c                   endif                                                                    .
      *
T5.00c                   if        rkbetb = *zero                               Bruk standard     .
T5.00c                   eval      rkbetb = ra1bek                              Saldo             .
T5.00c                   endif                                                                    .
      *
E5.00c                   else                                                   ...................
      *
      * Ikke funnet, lager ny kunde
      *
     c                   eval      rksald = *zeros                              Saldo             .
     c                   eval      rkkjØp = *zeros                              Kjøp              .
     c                   eval      rkktid = *zeros                              Kredittid         .
     c                   eval      rkkjØf = *zeros                              Kjøp i fjor       .
     c                   eval      rkmems = *zeros                              Memosaldo         .
6.20 c**                 eval      rkmema = *zeros                              Memosaldo         .
6.20 c**                 eval      rkkjal = *zeros                              Memosaldo         .
5.60 c                   eval      rkgral = *zeros                              Memosaldo         .
      *
E5.00c                   if        rkbetb = *zero                               Bruk standard     .
E5.00c                   eval      rkbetb = ra1bek                              Saldo             .
     c                   endif                                                                    .
      *
     c                   time                    rkndat
     c                   time                    rkntim
     c                   eval      rknsig = l_user
      *
     c                   endif                                                  ...................
      *
6.10 c*                  time                    rkedat
6.10 c*                  time                    rketim
6.10 c*                  eval      rkesig = l_user
6.10 c                   time                    rk2dpt
6.10 c                   eval      rkepgm = 'RE110R    '
      *
     c                   if        not%found
     c                   write     rkunlur                                      Skriv kunde
6.20  * Vi legger ut memosaldo
6.20 c     rkunlu_key    chain     rkmelu
6.20  *
6.20 c                   if        not %found
6.20 c                   eval      rxfirm = l_firm
6.20 c                   eval      rxkund = rkkund
6.20 c                   eval      rxmems = *zero
6.20 c                   eval      rxmema = *zero
6.30 c                   eval      rxkjal = *zero
6.20 c                   time                    rxmeda
6.20 c                   time                    rxmoda
6.20 c                   time                    rxmeti
6.20 c                   time                    rxmoti
6.20 c                   eval      rxmeus = l_user
6.20 c                   write     rkmelur                                      Skriv memosaldo
6.20 c                   endif
6.20  *
     c                   else
     c                   update    rkunlur                                      Oppdater kunde
     c                   endif
      *
      * Oppdater alfasøk-register
      *
     c                   call      'RK750R'
     c                   parm                    rkfirm
     c                   parm                    rkkund
      *
     c     slutt         tag
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     *inzsr        begsr
      *
      * Key for statuskode 1
      *
     c     raa1l1_key    klist
     c                   kfld                    w_firm
      *
     c     rkunlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunlu_kund
      *
      * Legge inn firmanummer og navn fra LDA
      *
     c                   eval      w_firm = l_firm
      *
     c     raa1l1_key    chain     raa1l1                             60
      *
     c                   endsr
      * ----------------------------------------
