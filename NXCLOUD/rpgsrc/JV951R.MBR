     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : JV951R
      * Beskrivelse . . : Vare, oppretter vare-query-fil VA status
      *
      *                   Oppretter fil for QUERY-formål som inneholder
      *                   varenr. vgrp  prisgivende leverandør og modul  og
      *                   statuskode.
      *
      *                   Programmet kalles via JV951C for først å tømme
      *                   vare-query-filen
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       190908 bof  Nytt program
6.10  *       070311 nho  2 parametere lagt inn til call av 750R
6.11  *       270112 bof  status fra num til alfa
6.30  *       050615 bof  Uvidet parm. til jv750r
6.3x  * 6.30  040615 bof  utvidet parm i forb. med prgr. på betingelse
6.3y  * 6.30  050815 bof  utv. parm i forb. med prgr. på frakt + oppdat.
7.01  * 7.00  070220 bof  utv. parm i i jv750r
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fjlevl3    if   e           k disk    rename(jlevpfr:jlevl3r)
     fjvdtl1    if   e           k disk    rename(jvdtpfr:jvdtl1r)
      *
     fjvaqpf    o  a e           k disk    rename(jvaqpfr:jvaqpfr)
      *
      * Definering av Local data area
      *
     d                uds
     d l_firm                944    946  0
      *
      * Definering av variable i nøkler
      *
     d jlevl3_enum     s                   like(jlenum)
     d jvdtl1_dvar     s                   like(jvdvar)
      *
      * Definering av variable
      *
     d b_oppr          s              1    inz(*off)
      *
     d w_udat          s               d   datfmt(*iso)
     d w_mvap          s              6  2
     d w_mvat          s              5  4
     d w_mvaf          s             10  9
     d w_kode          s              1  0
6.10 d w_prgr          s              1
5.70 d w_prut          s              1
7.01 d w_utgp          s              1  0
6.3x d w_pgbe          s              1
6.30 d w_ffak          s              8  6
6.30 d w_inp2          s              9  2
6.3y d w_pgfr          s              1
6.3y d w_oppd          s              1
      *
     d w_grpr          s              9  2
     d w_gdat          s               d   datfmt(*iso)
7.01 d w_pdat          s               d   datfmt(*iso)
     d w_enhe          s              3
     d w_enh1          s              3
     d w_enh2          s              3
     d w_enh3          s              3
     d w_eni1          s              3
     d w_eni2          s              3
     d w_eni3          s              3
     d w_enp1          s              3
     d w_enp2          s              3
     d w_enp3          s              3
     d w_ofp1          s             12  6
     d w_ofp2          s             12  6
     d w_ofp3          s             12  6
     d w_ofv2          s             12  6
     d w_ofv3          s             12  6
     d w_ofi1          s             12  6
     d w_ofi2          s             12  6
     d w_ofi3          s             12  6
     d w_bldo          s              6  0
     d w_bogr          s              2  0
     d w_bhgr          s              2  0
     d w_bugr          s              3  0
     d w_bmod          s              8  0
     d w_bvar          s             15
     d w_bvty          s              1
     d w_blet          s              1  0
     d w_bbet          s             35
     d w_ntpr          s              8  2
     d w_ifak          s              8  6
     d w_pogr          s              2  0
     d w_phgr          s              2  0
     d w_pugr          s              3  0
     d w_pldo          s              6  0
     d w_pmod          s              8  0
     d w_pvar          s             15
     d w_ppko          s              1
     d w_pvty          s              1
     d w_plet          s              1  0
     d w_kfak          s              8  6
     d w_kbel          s              7  2
     d w_sfak          s              8  6
     d w_midl          s              1  0
     d w_inpr          s              9  2
     d w_kopr          s              9  2
     d w_s1pr          s              9  2
     d w_s1im          s              9  2
     d w_s2pr          s              9  2
     d w_s2im          s              9  2
     d w_s3pr          s              9  2
     d w_s3im          s              9  2
     d w_dekn          s              5  2
     d w_ste1          s             35
     d w_ste2          s             35
     d w_ste3          s             35
     d w_ste4          s             35
     d w_ste5          s             35
     d w_pkod          s              1
     d w_skod          s              1  0
     d w_lety          s              1  0
     d w_gprk          s              1  0
     d w_eldo          s                   like(vvldor)
6.11 d w_osts          s              1
     d w_lvar          s                   like(vvlvar)
     d w_xxxx          s                   like(vvldor)
      *
     d w_firm          s                   like(vvfirm)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
      * Leser hele vareregisteret
      *
     c     vvarl1_key    setll     vvarl1
     c     vvarl1_key    reade     vvarl1                                 90
     c                   dow       *in90 = *off
      *
      * Initierer flagg for oppdatering
      *
     c                   eval      b_oppr = *off
      *
      *
     c                   exsr      behandling
      *
      * Oppretter vare i vare-query-registeret dersom den ikke allerede er
      * opprettet
      *
     c                   if        b_oppr = *off
     c                   write     jvaqpfr
     c                   endif
      *
      * Initierer før neste les
      *
     c                   clear                   jvaqpfr
      *
     c     vvarl1_key    reade     vvarl1                                 90
     c                   enddo
      *
      * Avslutt program
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine som henter prisinformasjon pr. enhet
      * Oppretter vare i vare-query-fil pr. enhet pr. leveringstype
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandling    begsr
      *
     c                   eval      jvdtl1_dvar = vvvare
     c     jvdtl1_key    chain     jvdtl1
      *
     c                   exsr      hent_pris
      *
     c                   eval      jvosts = w_osts
      *
     c                   write     jvaqpfr
      *
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine som henter status kode for overf. fra VA til EVR
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     c     hent_pris     begsr
      ** henter lev. fra VA
     c                   eval      jlevl3_enum = vvldor
     c     jlevl3_key    chain     jlevl3
      *
      * Henter salgspris fra fellesprogram
      *
     c                   eval      w_pkod = jvdpko
     c                   eval      w_skod = jvdsko
     c                   eval      w_lety = 0
     c                   eval      w_gprk = 0
     c                   eval      w_xxxx = 0
6.3y c                   eval      w_oppd = *blank
7.01 c                   time                    w_pdat
7.01 c                   eval      w_utgp = 1
      *
     c                   call      'JV750R'
     c                   parm                    w_firm
     c                   parm                    vvvare
6.10 c                   parm                    w_prgr
     c                   parm                    jlldor
     c                   parm                    w_pkod
     c                   parm                    w_skod
     c                   parm                    w_lety
     c                   parm                    w_gprk
7.01 c                   parm                    w_pdat
7.01 c                   parm                    w_utgp
      *
     c                   parm                    w_osts
      *
     c                   parm                    w_xxxx
     c                   parm                    w_lvar
     c                   parm                    w_eldo
     c                   parm                    w_grpr
     c                   parm                    w_gdat
      *
     c                   parm                    w_enhe
     c                   parm                    w_enh1
     c                   parm                    w_enh2
     c                   parm                    w_enh3
     c                   parm                    w_eni1
     c                   parm                    w_eni2
     c                   parm                    w_eni3
     c                   parm                    w_enp1
     c                   parm                    w_enp2
     c                   parm                    w_enp3
     c                   parm                    w_ofp1
     c                   parm                    w_ofp2
     c                   parm                    w_ofp3
     c                   parm                    w_ofv2
     c                   parm                    w_ofv3
     c                   parm                    w_ofi1
     c                   parm                    w_ofi2
     c                   parm                    w_ofi3
      *
     c                   parm                    w_bldo
     c                   parm                    w_bogr
     c                   parm                    w_bhgr
     c                   parm                    w_bugr
     c                   parm                    w_bmod
     c                   parm                    w_bvar
     c                   parm                    w_bvty
     c                   parm                    w_blet
     c                   parm                    w_bbet
     c                   parm                    w_ntpr
     c                   parm                    w_ifak
      *
     c                   parm                    w_pogr
     c                   parm                    w_phgr
     c                   parm                    w_pugr
     c                   parm                    w_pldo
     c                   parm                    w_pmod
     c                   parm                    w_pvar
     c                   parm                    w_ppko
     c                   parm                    w_pvty
     c                   parm                    w_plet
     c                   parm                    w_kfak
     c                   parm                    w_kbel
     c                   parm                    w_sfak
      *
     c                   parm                    w_midl
     c                   parm                    w_inpr
     c                   parm                    w_kopr
     c                   parm                    w_s1pr
     c                   parm                    w_s1im
     c                   parm                    w_s2pr
     c                   parm                    w_s2im
     c                   parm                    w_s3pr
     c                   parm                    w_s3im
     c                   parm                    w_dekn
6.10 c                   parm                    w_prut
6.30 c                   parm                    w_ffak
6.30 c                   parm                    w_inp2
6.3x c                   parm                    w_pgbe
6.3y c                   parm                    w_pgfr
6.3y c                   parm                    w_oppd
      *
      *
     c                   endsr
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for les på vareregister
      *
     c     vvarl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for les på lev. VA
      *
     c     jlevl3_key    klist
     c                   kfld                    jlevl3_enum
      *
     c     jvdtl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jvdtl1_dvar
      *
      *
      * Henter firma fra LDA
      *
     c                   eval      w_firm = l_firm
      *
      * Henter mva-faktor
      *
     c                   time                    w_udat
      *
     c                   call      'FÅ705R'
     c                   parm                    w_firm
     c                   parm                    w_udat
     c                   parm                    w_mvap
     c                   parm                    w_mvat
     c                   parm                    w_mvaf
      *
     c                   endsr
