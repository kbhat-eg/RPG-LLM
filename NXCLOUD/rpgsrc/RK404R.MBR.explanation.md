# Documentation: RK404R – Customer Deletion Parameter Handler

## Overview

**Program:** RK404R  
**System:** ASOKON  
**Description:**  
This program serves as a parameter handler for customer deletion (Sletting av kunder) based on customer category ranges. It is primarily used to gather user input for a "from–to" customer category interval, validate the input, and prepare parameters for a subsequent batch update program (RK405C, currently commented out).

**Business Context:**  
The program is part of a workflow for mass-updating or deleting customers filtered by category within a specified company. It is invoked from a display file (workstation) and is designed to be used interactively by operators with knowledge of customer categories and company codes.

---

## Structure and Flow

### 1. Initialization

- **Indicators:**  
  The program follows a strict indicator convention, detailed in the comments, to standardize UI, error handling, file I/O, and subroutine control. This is important for maintainability and for developers to quickly locate the purpose of each indicator.

- **Local Data Area (LDA) Usage:**  
  Several fields are mapped to specific positions in the LDA. These are used for passing parameters between programs and for session persistence.

- **Key Variables:**
  - `l_katf`, `l_katt`: Customer category "from" and "to" (LDA positions 300–307)
  - `l_utfy`: Confirmation flag (LDA 308)
  - `l_firm`: Company number (LDA 944–946)
  - `w_firm`, `w_in03`: Working variables for company and function key status

---

### 2. Screen Handling and User Input

- **Display File:**  
  The program uses the `rk404d` display file, with the main screen format `A2BLD` for parameter selection.

- **Main Loop (`a2taga`):**
  - Presents the parameter selection screen (`exfmt a2bld`).
  - Resets error indicator `*in31`.
  - Checks for function key F3 (exit, `*inkc`):  
    - Sets `w_in03` to '1' and exits.
  - Validates that "category from" is not greater than "category to":  
    - If invalid, sets error indicator `*in31` and redisplays the screen.

---

### 3. Parameter Preparation

- On valid input:
  - Stores user input in LDA for downstream use (`l_katf`, `l_katt`, `l_utfy`).
  - (Commented out) Calls the batch update program `RK405C` with the exit flag as a parameter. This would be the next step in the workflow, performing the actual update or deletion.

---

### 4. Program Termination

- **Tag `xslutt`:**
  - Sets LR indicator (`*inlr`) to end the program and return control.

---

### 5. Initialization Subroutine (`*inzsr`)

- Accepts the exit flag (`w_in03`) as a parameter.
- Initializes session variables:
  - Sets the working company number from LDA.
  - Sets the confirmation flag to 'J' (default "yes").
  - Resets the exit flag and category range to full interval (0–9999).

---

## Design Decisions & Conventions

- **Indicator Usage:**  
  The codebase uses a disciplined indicator mapping, with ranges reserved for specific purposes (UI, errors, file I/O, subroutines). This avoids conflicts and makes debugging easier.

- **LDA for Parameter Passing:**  
  The use of specific LDA positions for parameters is a legacy integration pattern, allowing seamless data sharing between interactive and batch programs.

- **Screen-Driven Workflow:**  
  All user interaction is handled via a single display format. Error feedback is immediate, and the user cannot proceed with invalid parameters.

- **Batch/Interactive Separation:**  
  The actual update logic resides in a separate batch program (RK405C), keeping the parameter entry logic isolated and maintainable.

---

## External Interactions

- **Display File (`rk404d`):**  
  Handles all user-facing input.

- **Batch Program (`RK405C`):**  
  Intended to be called after parameter collection to perform the update. This call is currently commented out, possibly for testing or because the update is handled elsewhere.

- **Local Data Area:**  
  Used for parameter persistence and inter-program communication.

---

## Noteworthy Points

- **Error Handling:**  
  Error states are indicated by setting `*in31`, which likely triggers error messages or field protection on the display.

- **Exit Logic:**  
  Exit via F3 is handled early, and the program gracefully returns after setting relevant flags.

- **Extensibility:**  
  The modular design (parameter entry → batch processing) allows for easy changes to either the input logic or the update logic without impacting the other.

- **Localization/Customization:**  
  Comments and field names are in Norwegian, reflecting the local business context and user base.

---

## Summary

RK404R is a parameter entry and validation program for customer deletion/updating by category within a company. It is designed for robust user interaction, strict indicator management, and smooth handoff to batch processing. The code is straightforward, with business rules enforced at the UI level and integration via LDA and external batch calls.