## RPG Program: EAN-Number Validation (J�700R)

This program validates EAN-13 and EAN-14 numbers, checking whether the provided number has a valid format by verifying its check digit. If the EAN number is invalid, the program returns '1' in the return code.

---

### 1. **Header Specifications**

```rpg
h option(*nodebugio) datedit(*dmy)
```
- **option(*nodebugio):** Disables debug support for I/O operations.
- **datedit(*dmy):** Date format is day/month/year.

---

### 2. **Comments and Program Information**

- **Beskrivelse:** "EAN-nummer kontroll" — EAN number check.
- The program checks a supplied EAN number, returning '1' in the return code parameter if the format is invalid.
- Version `6.11` extended support to 14-digit EAN numbers.

---

### 3. **Declarations**

#### **Arrays (Used for EAN digit calculations)**
```rpg
d eana13          s              1    dim(12)
d ean13           s              1  0 dim(12)
d eana14          s              1    dim(13)
d ean14           s              1  0 dim(13)
```
- Arrays to hold digits of EAN numbers (character and numeric).

#### **Parameters**
```rpg
d p_eann          s             14  0
d p_rkod          s              1
```
- `p_eann`: Input EAN number (up to 14 digits)
- `p_rkod`: Return code (set to '1' if invalid)

#### **Work Variables**
```rpg
d w_eann          s             14
d w_eanr14        s             13
d w_eanr13        s             12
d w_eaop          s              1  0
d w_easf          s              3  0
d w_ea00          s              3  0
d w_ea02          s              3  0
```
- Used for manipulation, intermediate results, and check digit calculations.

---

### 4. **Main Logic**

#### **Copy Parameters**
```rpg
move      p_eann        w_eaop
move      p_eann        w_eann
```
- Copies input EAN to work variables.

#### **Select Block: EAN Type Detection**
```rpg
select
  when %subst(w_eann:1:2) = '00'
    movel     w_eann        w_eanr14
    exsr      eansjk14
  when %subst(w_eann:1:1) = '0'
    eval      w_eanr13 = %subst(w_eann:2:12)
    exsr      eansjk13
  other
    movel     w_eann        w_eanr14
    exsr      eansjk14
endsl
```
- Analyzes the input EAN:
  - If it starts with '00': treat as EAN-14 and validate.
  - If it starts with '0': treat as EAN-13 and validate (excluding first digit).
  - Else: treat as EAN-14 and validate.

#### **Validation Result**
```rpg
if        w_easf <> w_eaop
  eval      p_rkod = '1'
endif
```
- If the calculated check digit is not equal to the one provided in the original number, set return code to '1' (invalid).

#### **Program End**
```rpg
eval      *inlr = *on
return
```
- Standard RPG logic to end the program and return.

---

### 5. **Subroutines**

#### **eansjk13: Calculate EAN-13 Check Digit**
- Converts input to arrays
- Sums appropriate digits:
  - Odd positions (even index, 2,4,...,12): sum and multiply by 3.
  - Even positions (odd index, 1,3,...,11): sum without multiplication.
- Final calculation:
  - Subtract total sum modulus 10 from 10.
  - If the result is 10, use 0 as the check digit.

#### **eansjk14: Calculate EAN-14 Check Digit**
- Similar to EAN-13, but for 14-digit numbers.
- The algorithm follows the weighting method used in EAN-14 specs.

#### **Initialization Subroutine (\*inzsr)**
- Initializes all work variables and parameters.
- Defines parameter list (\*entry) for expected inputs.

---

### 6. **Parameter List**
```rpg
*entry        plist
parm                    p_eann
parm                    p_rkod
```
- Input: EAN number (max 14 digits)
- Output: Return code (blank = valid, '1' = invalid)

---

## **Summary**

- The program receives an EAN number and checks if it is a valid EAN-13 or EAN-14.
- It calculates the correct check digit and compares it to the input.
- If the check digit does not match, `p_rkod` is set to '1'.
- Otherwise, the EAN is considered valid (return code remains blank).

---

### **Typical Use Case**
Call the program with an EAN number and a return code variable. After execution:
- If `return_code = '1'` ➔ input EAN is invalid.
- If `return_code = ' '` ➔ input EAN is valid.

---

### **Further Notes**

- The logic assumes certain enterprise conventions (e.g., EAN-14 numbers starting with '00').
- Handles both 13 and 14-digit EANs per their respective standards.
- No display or file I/O: pure validation logic for use as a service or in batch processing.

---

#### **If you need deeper detail into any section or a walk-through for EAN check digit logic, let me know!**