# RPG Program Explanation: FO526R (ASOFAK: Display Customer Information)

## Overview

This program is written in traditional ILE RPG (fixed-format RPG IV), and its main function is to **display customer information** ("Vise kunde-opplysninger"). The code interacts with a display file (a workstation `WORKSTN`), a physical file (`RKUNL1` - customer master), and several subprograms for customer search and display.  

The business logic involves entering/searching for a customer, displaying customer details, and invoking "drill down" programs based on user actions.

---

## File Declarations

- `FO526D`: Display file for user interface, declared as `CF` (Workstation file).
- `RKUNL1`: Customer master file. Input file, externally described, with a rename (`rkunpfr:rkunl1r`). Accessed with key.

---

## Data Definitions

### Parameters

- `p_retu` (1)      : Used for return code/status between programs.
- `p_firm` (3,0)    : Company number parameter passed into this program.

### Local Data Area (LDA) Fields

- `l_user` (911-920): Stores the user profile.
- `l_firm` (944-946): Stores company number.
- `l_fnav` (951-980): Stores user's full name.

### Key Variables

- `w_firm`         : Same type as `rkfirm` (company number).
- `rkunl1_kund`    : Same type as `rkkund` (customer number, for key access).

### Working Variables

- `w_retu` (1)     : Return/status code for subprogram results.
- `w_otyp` (2)     : Object type (usage depends on called programs).
- `w_kund`         : Stores the current customer number displayed.
- `w_navn`         : Stores customer name.

---

## Main Control Flow

### Initialization (`*INZSR` Subroutine)

- Clears fields (`w_retu`, `w_otyp`).
- Copies company number from LDA to working key variable.
- Builds key list (`rkunl1_key`) for customer file.

### Main Input Loop (Tags: `b1tag`, `b1taga`, `b1tagb`)

- **`b1tag`/`b1taga`**: Resets all relevant fields.
    - Clears function key indicator 41 (likely “invalid customer” indicator).
    - Resets customer and address fields.

- **`b1tagb`**: 
    - Waits for user input via `exfmt b1bld` (the main display format).
    - Handles function keys:
        - **F3 (`*INKC`)**: Exit program (`goto avslutt`).
        - **F4 (`*INKD`)**: Call inquiry subprogram `RK500R` to search/select customer; populates keys and name.

### Customer Validation (`b1tag0`)

- If user entered customer number differs from previously loaded:
    - Sets up key, chains to customer file.
    - If not found (`*IN90`), sets error indicators and restarts loop.
    - If found, loads address fields from file and proceeds.

### Selection Handling

- Based on `b1valg` (user menu selection):
    - **01**: Calls subprograms for (customer/order/line) inquiries (`VA556R`, then `FO510R` if applicable).
    - **02**: Similar call flow for (customer/item) inquiries.
    - Return to input loop afterwards.

### Program Exit (`avslutt` tag)

- Ends the program (`*INLR = *ON`).

---

## Notable Indicators

- `*IN31`, `*IN41`: Status indicators for things like error messages or field highlights.
- `*IN90`: File status indicator for "record not found" on customer master.
- `*INKC`, `*INKD`: Function key indicators for F3 (exit) and F4 (customer inquiry).

---

## Subroutine and Keylist Details

- **Keylist `rkunl1_key`**: Used to chain to `RKUNL1` with `w_firm` and `rkunl1_kund` as keys.
- **Parameter List `*ENTRY`**: Handles receive parameters from caller (e.g., return code, company).

---

## Program Structure Flow Diagram

```plaintext
Initialization (*INZSR)
  |
Main Loop (b1tag)
  |
  +-- Reset fields (b1taga)
  |
  +-- Display screen / input (b1tagb)
        |
        +-- F3? --> Exit
        +-- F4? --> Customer inquiry subprogram
        +-- Customer number entered?
                 |
                 +-- Not found: error, return to input
                 +-- Found: load data
                     |
                     +-- Selection?
                             |
                             +-- 01: Call order/line programs
                             +-- 02: Call item programs
```

---

## File and Program Relationships

- **This RPG** acts as a driver, reading (and displaying) customer data, and invoking:
    - `RK500R`: Customer search
    - `VA556R` / `FO510R`: Further details by selection

---

## Key Takeaways

- This is a **customer information inquiry interface** for IBM i (AS/400) green screen.
- It uses traditional RPG, external display files, and subprogram calls.
- User can enter customer number, search, view details, and navigate to additional programs for deeper inquiries.
- Extensive use of traditional indicators and fixed-format logic.

---

If you are onboarding:  
- Familiarize yourself with the display file (`FO526D`), customer master file (`RKUNL1`), the external subprograms, and the special indicators used for display logic.
- The main logic loop is driven by the use of tags and GOTOs, which is typical for RPG programs of this era.  
- Changing or expanding logic for new options would involve modifying the main selection handling and possibly updating the display file.