# RPG Program LO614R â€“ Explanation

This program, written in RPG/400 (ILE RPG), processes and prints an "alert list" (varselliste) for suppliers, based on orders in a set of files. It is tailored to Norwegian business requirements (as evidenced by the comments and field names), focusing on printing supplier-specific order information with various selection and filtering options.

## High-Level Overview

- **Program Objective**: Print an "alert list" (varselliste) to suppliers, stemming from order data. It prints a report listing relevant orders and order lines that meet certain criteria (dates, statuses, etc).
- **Input**: Several database files (order headers, order lines, product files, supplier register, etc.).
- **Output**: Printer file (report).
- **Parameters**: Selections on department/warehouse, supplier, date, type of date, and more, passed as program parameters.
- **Main Steps**:
  1. Initialize and set parameter values.
  2. Loop through order headers (filtered by criteria).
  3. For each, check type/status/dates.
  4. If criteria are met, print header info, process lines, print line and total info.

---

## Section-by-Section Explanation

### 1. **Header Specifications**

```rpg
h decedit('0,') datedit(*dmy.)
h option(*nodebugio)
```
- **decedit / datedit**: Sets the decimal and date editing format for output.
- **option(*nodebugio)**: Disables certain debug info for I/O fields.

---

### 2. **File Declarations**

```rpg
flohel1    if   e           k disk    rename(lohepfr:lohel1r)
flodtl1    if   e           k disk    rename(lodtpfr:lodtl1r)
fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
fvltyl1    if   e           k disk    rename(vltypfr:vltyl1r)
fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
flo614p    o    e             printer
```

- Multiple files are declared, all as externally-described disk files (most likely DDS or SQL tables).
- Files appear to correspond to:
  - Order headers (`lohel1`)
  - Order lines (`lodtl1`)
  - Order type register (`votyl1`)
  - Line type register (`vltyl1`)
  - Item register (`vvarl1`)
  - Supplier register (`rlevl1`)
  - Report printer file (`lo614p`)

---

### 3. **Parameter and Data Area Declarations**

```rpg
d p_ldor          s                   like(loldor)
d p_dato          s              6  0
d p_dagr          s              3  0
d p_onbe          s              1  0
d p_lage          s                   like(lolage)
```
- Program parameters:
  - `p_ldor` - Supplier
  - `p_dato` - Date for selection
  - `p_dagr` - Number of days to add to p_dato (for "due date" logic)
  - `p_onbe` - Type of date: e.g. requested or confirmed
  - `p_lage` - Warehouse

```rpg
d                uds
d l_firm                944    946  0
```
- **Local Data Area (LDA)**: Used to retrieve the company number (`l_firm`). LDA is a system area for sharing values across programs.

---

### 4. **Key Variables and Work Fields**

Key fields for each file are defined for use in keyed operations (setll, chain, etc.), as well as various work fields for data manipulation and transfer between files and the report.

---

### 5. **Initialization (*inzsr Subroutine)**

```rpg
c     *inzsr        begsr
  ...
c                   endsr
```
- **Parameter list (*entry plist)**: Receives the values for all input parameters.
- **Key lists**: For each file, a key list is constructed (using KLIST/KFLD), which defines the key fields to be used for file access.
- **Sets Company/Division (`w_firm`)**: Reads the value from LDA.

---

### 6. **Main Logic**

```rpg
c     *dmy          move      p_dato        w_dato_p
c     w_dato_p      adddur    p_dagr:*d     w_dato_p
```
- Converts the input date parameter and adds the specified duration to get the critical date for testing (typically for "due date" or similar logic).

#### **Processing Order Headers**

```rpg
c     lohel1_key    setll     lohel1
c                   read      lohel1
c                   dow       not %eof
   ...
c                   read      lohel1
c                   enddo
```
- Loops through the order header file.
- For each header, several checks are made:
  - **Same Company?** Skips if company differs from `w_firm`.
  - **Order Type:** Uses the order type file to check if the order is active/acknowledged.
  - **Warehouse filter:** If a specific warehouse is selected, only process matches.
  - **Supplier filter:** Same logic as above, but for supplier.
  - **Date checks:** Based on the date type and due dates, determines if the order should be processed.

#### **If Everything OK:**

```rpg
c                   exsr      xhodet
c                   exsr      xlinje
c                   exsr      xtotal
```
- For a valid order header:
  - Write heading (`xhodet`)
  - Process order lines (`xlinje`)
  - Write totals (`xtotal`)

---

### 7. **Order Header Subroutine (`xhodet`)**

- **Date Handling**: Determines which date to use/display (requested or confirmed delivery, etc.).
- **Supplier Info**: Looks up supplier information and moves it to print fields.
- **Delivery Address**: If exists, moves info for print.
- **Reference Numbers:** Checks for supplier refs and customer order number.
- **Other fields:** Populates other report headings.
- **Writes header record** to the output (printer) file.

---

### 8. **Order Line Subroutine (`xlinje`)**

- For each order header, reads all associated order lines:
  - **Line Type:** Uses the line type table for additional info.
  - **Order Type Filtering:** Skips lines based on type.
  - **Text Line Filtering:** Skips or processes lines flagged as text-only.
  - **Product Info:** Looks up product data (may call another RPG program `VL710R` for extended attributes).
  - **Quantity Formatting:** Handles variable decimal logic for quantities.
  - **Printing:** Writes either item lines or text lines to report.

---

### 9. **Totals Subroutine (`xtotal`)**

- Writes totals record to report.

---

### 10. **Tags and Control Flow**

- Several `tag` and `goto` statements (`xnyles`, `xforbi`, etc.) are used for skipping specific processing based on the logic above.

---

### 11. **End of Program**

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
```
- Turns on the last record indicator, ending the program.

---

## **General Notes**

- **Indicator Usage**: The program uses classic RPG indicators (`*inxx`) for flow control, formatting, and conditional writing.
- **Legacy Style**: Program is written in RPG/400 (fixed format), using subroutines for modularity.
- **Testing for *loval/*blank/*zero**: Used to check uninitialized or empty fields.
- **Multi-File Coordination**: Data is enriched by looking up related info from multiple files.
- **External Calls**: The program uses a `call` to another program (`VL710R`) to gather additional product info.

---

## **Summary Table**

| Section         | Purpose                                                                                 |
|-----------------|-----------------------------------------------------------------------------------------|
| File Decls      | Connects program to data sources and output                                             |
| Params          | Sets up criteria for order selection                                                    |
| Initialization  | Builds key lists, gets company number                                                   |
| Main Loop       | Steps through order headers, filters, and processes valid orders                        |
| `xhodet`        | Prints order header info with supplier/address/reference data                           |
| `xlinje`        | Reads and prints each order line; enriches with product data and handles text lines     |
| `xtotal`        | Prints total info for the order                                                         |
| End/Control     | Handles looping, skips, and program completion                                          |

---

## **For Onboarding**

- **Business Logic**: The program is highly centered on business rules for printing supplier notices from orders.
- **Customization**: To adapt or extend, understand the record layouts, and pay attention to the parameter-based filtering logic.
- **Debugging**: Use indicators and tags to trace logic flow.
- **Extensibility**: Functions for product lookups and line handling could be modularized further in modern RPG.

---

If you need details about specific fields, file layouts, or the external program `VL710R`, you will need the corresponding DDS or DDL and program source.