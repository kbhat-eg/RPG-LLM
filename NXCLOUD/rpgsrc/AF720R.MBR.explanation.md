```markdown
## Overview

This RPG (Report Program Generator) program is written in the "traditional" or "fixed-format" style, commonly used on the IBM i (AS/400) platform. The program's primary purpose is to write a log of FTP transfers, as described in the comments.

### Key Elements and Structure

- **Program Name:** AF720R
- **Description:** Writes a log for FTP transfer (in Norwegian: "Skrive logg for FTP overføring")
- **Data Files Used:**
  - `afthlu` (header file)
  - `aftllu` (line/item file)
  - `aflopf` (source data file)
- **Local Data Area:** Used for retrieving context information like company, group, and user.

---

## File Declarations

```rpg
fafthlu    uf a e           k disk    rename(afthpfr:afthlur)
faftllu    uf a e           k disk    rename(aftlpfr:aftllur)
faflopf    if a e             disk      rename(aflopf:aflopfr)
```
- Declares three physical files to be used in the program, with `rename` to specify the record format.
    - `afthlu` → record format `afthlur` (header)
    - `aftllu` → record format `aftllur` (line)
    - `aflopf` → record format `aflopfr` (source data)

---

## Data Definitions

### Local Data Area (LDA) Fields

```rpg
d                uds
d l_firm                944    946  0
d l_fgr                 931    933
d l_user                911    920
```
- `uds` signals use of the User Data Structure (i.e., LDA).
- Extracts:
  - `l_firm`: Company number (positions 944-946)
  - `l_fgr`: Group (positions 931-933)
  - `l_user`: User ID (positions 911-920)

### Working Variables

```rpg
d w_firm          s                   like(adhfir)
d w_uidn          s                   like(adhuid)
d w_tell          s                   like(adllin) INZ(1)
```
- `w_firm`: Holds company number, same type as `adhfir`
- `w_uidn`: Holds unique timestamp/user ID, same type as `adhuid`
- `w_tell`: Line counter for log lines, initialized to 1

### Parameters

```rpg
d p_navn          s                   like(adhnav)
d p_kom1          s                   like(adhkom)
d p_stat          s                   like(adhsta)
```
- `p_navn`: Parameter for name
- `p_kom1`: Parameter for comment 1
- `p_stat`: Parameter for status

---

## Main Program Flow

### 1. Write Header Record

```rpg
c                   read      afthlur
c                   eval      adhfir = w_firm
c                   eval      adhnav = p_navn
c                   eval      w_uidn = %timestamp
c                   eval      adhuid = w_uidn
c                   eval      adhusr = l_user
c                   eval      adhkom = p_kom1
c                   eval      adhsta = p_stat
c                   write     afthlur
```
- Reads the header record file (afthlur) to position it.
- Sets fields for the new header:
    - Company number, name, unique ID (timestamp), user, comment, and status.
- Writes a new header record.

---

### 2. Write Line Records

```rpg
c                   read      aftllur
c                   read      aflopf
c                   dou       %eof
c                   movel     SrcDta        adltxt
c                   eval      adlfir = w_firm
c                   eval      adlnav = p_navn
c                   eval      adluid = w_uidn
c                   eval      adllin = w_tell
c                   write     aftllur
c                   eval      w_tell = w_tell + 1
c                   read      aflopf
c                   enddo
```
- Reads line and source data files.
- Loops until end-of-file (`%eof`) on `aflopf`.
- For each line:
    - Moves `SrcDta` (source data, field in aflopf) to `adltxt` (text field for aftllur).
    - Sets relevant fields for company, name, UID, and line number.
    - Writes a new line record.
    - Increments line counter.
    - Reads next source data record.

---

### 3. Program End

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Tag for program end.
- Sets LR (Last Record) indicator to signal program cleanup.
- Returns.

---

## Initialization Subroutine

```rpg
c     *inzsr        begsr
c     *entry        plist
c                   parm                    p_navn
c                   parm                    p_kom1
c                   parm                    p_stat
c                   eval      w_firm = l_firm
c                   endsr
```
- Begins at program start:
    - Defines the parameter list (to be passed in when the program is called).
    - Copies the company number from the LDA into `w_firm`.

---

## Summary

- **Initialization:** Gets parameters and sets up working variables from the LDA.
- **Header:** Writes one header record for the FTP log using information from parameters and LDA.
- **Lines:** For each record in the source file, writes a corresponding log line with sequential numbering.
- **End:** Properly closes the program and performs cleanup.

---

### Tips for Onboarding

- **File/Field Names:** Prefixes indicate purpose (`adh` for header, `adl` for line, etc.).
- **Use of LDA:** Company/user info is passed implicitly via LDA.
- **Parameters:** When calling this program, three parameters (name, comment, status) must be provided.
- **Legacy Style:** The program uses fixed-format RPG with traditional cycle control and subroutines.

If you are unfamiliar with the field definitions (what is in `afthlur`, `aftllur`, `aflopf`), you’ll want to review those physical files to understand the field mapping in more depth.
```