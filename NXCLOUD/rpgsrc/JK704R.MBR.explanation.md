# JK703R Program Explanation

## 1. Program Purpose  
This RPG ILE program, **JK703R**, reads all logistics items from a conversion‐line file and for each item it calls another subprogram (**JK702R**) to adjust the item master in the “VA” system.

---

## 2. Header Specifications  
- `OPTION(*NODEBUGIO)`  
  Disables debug I/O traps.  
- `DATEEDIT(*DMY)`  
  Uses day–month–year format in date fields.

---

## 3. File Declarations  
```rpg
Fjvkhl1    IF   E           K   DISK    RENAME(jvkhpfr:jvkhl1r)  
Fjvarl1    IF   E           K   DISK    RENAME(jvarpfr:jvarl1r)  
Fafpslr    IF   E           K   DISK    RENAME(afpspfr:afpslrr)  
```  
- **jvkhl1**: Logistics‐conversion lines (external, keyed).  
- **jvarl1**: VA item master lines (external, keyed).  
- **afpslr**: Properties file for build/cobuilder activation.

---

## 4. Local Data Area (UDS)  
```rpg
D     uds            UDS  
D     l_filg                  931    933  
D     l_firm                  944    946  0  
```  
- **l_filg**: File identifier for properties lookup.  
- **l_firm**: Company number.

---

## 5. Keyed Variables and Working Storage  
```rpg
D jvarl1_vare   S   LIKE(jvvare)   // Holds item number for chain lookup  
D afpslr_ufil   S   LIKE(l_filg)    // File id for properties file  
D afpslr_uide   S   LIKE(afuide)    // User ID for properties file  

D w_firm        S   LIKE(jvkfir)    // Company key for main file  
D w_ldor        S   LIKE(jvldor)    // Build/cobuilder activation code  
D w_ldox        S              6   // Temp for activation code  
D w_vare        S   LIKE(jvvare)    // Item number to pass to subprogram  
D w_dumm        S              1   INZ('*') // Dummy parameter  
```

---

## 6. Main Processing Loop  
1. **Set Lower Limit**  
   ```rpg
   SETLL jvkhl1
   ```  
   Positions file pointer at first record in **jvkhl1**.

2. **Read Each Record**  
   ```rpg
   READE jvkhl1;
   DOW NOT %EOF(jvkhl1)
   ```
   Loops until end‐of‐file.

3. **Prepare Chain Lookup**  
   ```rpg
   EVAL jvarl1_vare = jvkvnr
   CHAIN jvarl1
   ```
   Copies the item number from the logistics file to `jvarl1_vare` and attempts to retrieve the corresponding VA master record.

4. **Conditional Subprogram Call**  
   ```rpg
   IF %FOUND(jvarl1)
     CALL 'JK702R'
       PARM jvvare
       PARM w_ldor
       PARM w_dumm
   ENDIF
   ```
   If the VA record exists, calls **JK702R** passing:  
   - `jvvare` (item number)  
   - `w_ldor` (activation code)  
   - `w_dumm` (dummy flag)

5. **Continue Loop**  
   ```rpg
   READE jvkhl1
   ENDDO
   ```

6. **Program Cleanup**  
   ```rpg
   EVAL *INLR = *ON
   RETURN
   ```

---

## 7. Initialization Subroutine (*INZSR)  
Runs automatically at program start to set up key lists and retrieve activation settings:

1. **Define Key Lists**  
   - **jvkhl1_key**: Uses `w_firm`  
   - **jvarl1_key**: Uses `jvarl1_vare`  
   - **afpslr_key**: Uses `afpslr_ufil` and `afpslr_uide`

2. **Initialize Working Variables**  
   ```rpg
   EVAL w_firm        = l_firm
   EVAL w_ldox        = *BLANK
   EVAL afpslr_ufil   = l_filg
   EVAL afpslr_uide   = 'LOGILEV   '
   ```

3. **Retrieve Activation Code**  
   ```rpg
   CHAIN afpslrr
   IF %FOUND(afpslr)
     EVAL w_ldox = afudss       // Read activation flag from properties
   ENDIF

   IF w_ldox = *BLANK
     EVAL w_ldox = '900099'     // Default activation code
   ENDIF

   MOVE w_ldox w_ldor
   ```

After *INZSR ends, the main loop can use `w_ldor` to pass the correct activation setting to **JK702R**.