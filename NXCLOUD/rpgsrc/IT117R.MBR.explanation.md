## Overview

This program (IT117R) updates or manages seller information in the NAV domain, specifically keyed by a code field (“ikod”) on the RA09LU file. It processes external requests through different commands — INSERT, UPDATE, DELETE — sent via program parameters. Records are created, modified, or removed as needed, and a status flag is returned to indicate success.

## Business Purpose

• The program is part of the “ASNAVIOKO” system and communicates with the RA09LU physical file to maintain “selgere” (sales representatives) from an external NAV source.  
• It populates or updates fields related to the sales representative, such as their description, email, and mobile number.  
• The program responds to the calling application’s commands to either set up a new record (when it does not already exist), update an existing one, or remove it.  

## Data Files and Structures

• RA09LU (renamed to RA09LUR in the file specification):  
  – Keyed by a firm identifier (RAIFIR) and a seller code (RAIKOD).  
  – Contains contact-related fields (e.g., RAIEMA for email, RAIMOB for mobile).  
• Parameter DS (d_parm):  
  – Parses incoming external data into local variables (d_ikod, d_besk, d_mail, d_mobn).

## Program Flow

1. The main logic is driven by the parameter p_comd, which can be INSERT, UPDATE, or DELETE.  
2. Before acting on the command, two subroutines are called to “clean up” or parse the input data:  
   - RED_NUM: (Currently a placeholder; would normalize numeric values if needed).  
   - RED_FLT: Converts the 4-digit code (d_ikod) to a properly formatted numeric (w_ikod).  
3. The selected command subroutine is then executed:  
   - INSERT (nyrec):  
     - Checks if the record exists in RA09LU.  
     - If not found, writes a new record with the provided details.  
   - UPDATE (oppdrec):  
     - Locates the existing record, then updates with the new description, email, mobile, and timestamps.  
   - DELETE (sletrec):  
     - Locates the existing record, then removes it from RA09LU.  
4. Each operation sets the status parameter (p_stat) to ‘1’ on successful completion.

## Subroutines

### NYREC (Insert Logic)
• Initializes local variables with the parameters (firm number p_firm and code w_ikod).  
• Searches RA09LU by primary key (firm + code).  
• If not found, writes a fresh record, populating:  
  - `RAIFIR` (firm)  
  - `RAIKOD` (code)  
  - `RAITXT`, `RAIEMA`, `RAIMOB`, etc.  
  - Timestamps (`RAIDAT`/`RAITIM`) and user (`RAIUSR`)  
• Returns status “1” (success).

### OPPDREC (Update Logic)
• Locates the existing record by firm and code.  
• If found, updates the description, email, mobile, modified timestamp, and user.  
• Returns status “1” if the record was updated.

### SLETREC (Delete Logic)
• Searches for the record identified by firm and code.  
• If found, issues a DELETE on RA09LU.  
• Status is set to “1” afterward.

### RED_NUM
• Intended to replace blank or invalid values in numeric fields with zero. Currently unused in this code but reserved for potential normalization.

### RED_FLT
• Converts the text-based 4-digit code (d_ikod) in the DS parameter to a numeric field (w_ikod).  
• Ensures the main subroutines always work with a numeric code internally.

### *INZSR (Initialization)
• Receives the program parameters into local variables (p_firm, p_comd, etc.).  
• Builds the key list (ra09lu_key) for RA09LU references.  
• Sets the current date and time in w_date and w_time for any needed logging or audit fields.

## Notable Details

• The code deliberately sets many related numeric fields (like `RAIKTO`, `RAIMVA`, etc.) to zero upon insert. This indicates a standardized initialization that may be required for new seller entries.  
• Field “RAIRSK” was previously set to zero but was later removed (marked out with “7.01”) to avoid overwriting certain risk values.  
• The status parameter p_stat is used as a single-character flag for success, toggling to ‘1’ when the operation completes correctly.  
• The *PSSR subroutine (general error handler) clears p_stat and forces the program to end in an error condition.

## Integration Points

• Externally, this module is called from other programs or processes passing in firm identifiers, commands, and seller data (such as seller code, email, and mobile).  
• Internally, it relies on the RA09LU file for persistent storage, driven by the firm and code as the primary key.  
• The record format RA09LUR is a rename of the physical file RA09LU, ensuring it can be referenced in code segments (READ, WRITE, CHAIN, etc.) without conflict.

## Conclusion

IT117R centralizes the creation, updating, and deletion of NAV seller records in the RA09LU file. By using the parameter data structure and the three main command subroutines (nyrec, oppdrec, sletrec), it enforces consistent handling of both new and existing sellers. The use of timestamps and user identifiers in each operation helps ensure proper audit tracking, while p_stat provides a straightforward success indicator back to the caller.