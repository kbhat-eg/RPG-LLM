pdf  h option(*nodebugio) datedit(*dmy.) decedit('0.')
pdf  h DftActgrp(*No) BndDir('CGIDEV2/CGIDEV2')
pdf   /copy hspecsbnd
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Program . . . . : BO930R
      * Beskrivelse . . : Utskrift av Pakkseddel
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
3.11  * 3.11  310800 AMD  Lagt inn mulighet for utprint av avdelingsnavn
3.11  *                   i stedet for firmanavn dersom ønskelig
3.33  * R3.33 310501 AMD  Lagt inn utskrift av telefon/fax/mobil.
3.34  * R3.34 031202 AMD  Lagt inn styring av pris på pakkseddel utfra
3.34  *                   kode i kunderegister
5.22  * R5.22 031203 AMD  Skrive tekst 2 dersom den finnes i varereg.
5.22  *                   + lagt inn utskrift av leveringstype
5.22  *                   + lagt inn skråstrek mellom telefon / telefax
5.41  * R5.41 150605 AMD  Hente styring på firmaopplysninger fra LDA.
pdf   * R6.10 220311 bsa  Lagt inn funksjonalitet for eksport til XML
pdf   *                   format for videre arkivering og utskrift.
6.20  * R6.20 100511 bsa  Lagger ut rutinetekst som metatagg.
6.21  * R6.20 250511 bsa  Scann av rekvisisjonsnummer
6.22  * R6.22 291112 amd  Test for om pris skulle skrives på pakkseddel
6.22  *                   var snudd motsatt vei på en av plassene i pgm
6.22  *                   Ingen anmerkning er gjort på linjenivå her
6.23  * R6.20 041212 bsa  Legger ut nytt unikt refno, utvidet metatagger
6.24  * R6.20 071212 bsa  Strukturendring av og nye xml tagger
6.25  * R6.20 030113 bsa  Ednring av std oppbygging av refno
6.26  * R6.20 170513 bsa  Feil i pris på pakkseddel
6.27  * R6.20 140415 bsa  0 stiller minne for gjenbruk av XML info
6.30  * 6.30  120914 BKV  Henter overstyrt info fra kundeprosjekt
6.31  * 6.30  051214 Bsa  Utvidet parameterliste til FÅ707R
6.32  * 6.30  280115 bsa  Skriver til datakø for å trigge java sniffer
6.33  * 6.30  201015 bsa  Legger ut avdeling som tagg for arkiveringsformål.
6.34  * 6.30  281015 bsa  Bruker feil metatagg
7.01  * K000  130121 bsa  Legger ut lagertekst og ikke kun nr i XML.
7.02  * K000  140521 bsa  Legger ut suffix pga scanning til compello
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *                                                                 *
      *  BRUK AV INDIKATORER                                            *
      *                                                                 *
      *       LR = Avslutt program                                      *
      *    60-69 = Fileindikatorer chain etc.                           *
      *    70-79 = Arbeidsindikatorer i sub-rutiner                     *
      *    80-89 = Arbeidsindikatorer ordinære                          *
      *    90-99 = Benyttes ved std. sub-rutiner                        *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     FVOTYL1    IF   E           K DISK    RENAME(VOTYPFR:VOTYL1R)
     FBMHEL1    IF   E           K DISK    RENAME(BMHEPFR:BMHEL1R)
     FBMDTL1    IF   E           K DISK
     Frkunl1    IF   E           K DISK    RENAME(RKUNPFR:rkunl1r)
     FVVARL1    IF   E           K DISK    RENAME(VVARPFR:VVARL1R)
     FAFORL1    IF   E           K DISK    RENAME(AFORPFR:AFORL1R)
pdf  fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
6.24 fra09l1    if   e           k disk    rename(ra09pfr:ra09l1r)
6.24 fra07pf    if   e           k disk
6.30 ffkprl1    if   e           k disk    rename(fkprpfr:fkprl1r)
7.01 fra10l1    if   e           k disk    rename(ra10pfr:ra10l1r)
      *
     FBO930P    O    E             PRINTER
      *
      *-----------------------------
      * Henter inn data fra LDA
      *-----------------------------
      *
     D                UDS
pdf  d l_poff                584    584
pdf  d l_utqm                585    594
pdf  d l_bach                595    635
pdf  d l_arch                636    636  0
pdf  d l_skje                637    637  0
pdf  d l_land                638    638  0
pdf  d l_exlp                639    639  0
pdf  d l_mail                640    640  0
5.41 D  l_prfi               750    750  0
     D  l_ruti               800    809
pdf  d  l_outq               810    819
pdf  d l_copy                838    843  0
     D  l_alin               856    858  0
pdf  d  l_wsid               901    910
pdf  d  l_user               911    920
pdf  d  l_filg               931    933
     D  l_firm               944    946  0
6.33 d  l_avde               947    950  0
      *
      * Definering av variabler i nøkler
6.24 d ra09l1_ikod     s                   like(raikod)
6.24 d ra07pf_avde     s                   like(ragkod)
6.30 d fkprl1_kund     s                   like(flkund)
6.30 d fkprl1_kpro     s                   like(flkpro)
7.01 d ra10l1_jkod     s                   like(rajkod)
      *
      * Definering av variable
      *
3.11 d w_prfi          s              1  0
3.11 d w_ffir          s              3  0
3.11 d w_avde          s              4  0
3.11 d w_fnav          s             30
3.11 d w_fad1          s             30
3.11 d w_fad2          s             30
3.11 d w_fste          s             30
3.11 d w_fftx          s             30
3.11 d w_tfax          s              8
3.11 d w_ftlf          s             11
3.11 d w_ffax          s             11
3.33 d w_tlfn          s             20
3.33 d w_tlfx          s             20
3.33 d w_mobn          s             20
6.23 d w_refn          s             50
     d wpcbda          s               d   datfmt(*iso)
     d wpcfda          s               d   datfmt(*iso)
6.24 d w_selgn         s             16
6.24 d x_mobn          s             12
6.31 d w_mail          s             50
6.31 d w_weba          s             50
7.01 d w_ltxt          s             50
      *
6.24 d                 ds
6.24 d x_mobi                        12
6.24 d  d_tegn                        1    overlay(x_mobi:1)
6.24 d  d_mobn                       11    overlay(x_mobi:2)
pdf   *
pdf   * Definering av parametre
pdf   *
pdf  d p_serv          s             35
pdf  d p_stat          s              1
pdf  d p_mail          s              1
pdf  d p_kund          s              6  0
pdf  d p_kpro          s              6  0
pdf  d p_numm          s              6  0
pdf  d p_selg          s              4  0
pdf  d p_kule          s              1
pdf  d p_navn          s             30
pdf  d p_emal          s             50
pdf  d p_ema2          s             50
pdf  d p_emne          s             50
pdf  d p_txt1          s             50
pdf  d p_txt2          s             50
pdf  d p_txt3          s             50
pdf  d p_txt4          s             50
pdf  d p_pers          s             50
pdf  d p_inif          s             40
pdf  d p_in03          s              1
pdf  d p_ok            s              1
pdf  d p_lr            s              1
pdf  d p_str_in        s            512
pdf  d p_str_out       s            512
6.32 d p_filg          s             10
6.32 d p_xmlf          s            256
      *
pdf  d w_bpri          s              9  2
pdf  d w_pris          s              5
      *
pdf  d b_pdfp          s              1    inz(*off)
pdf  d b_topt          s              1    inz(*off)
pdf  d b_bott          s              1    inz(*off)
pdf  d b_rest          s              1    inz(*off)
pdf  d x_numm          s             15
7.02 d x_suff          s              3
pdf  d x_vref          s             25
pdf  d x_betb          s             42
pdf  d w_bdat          s               d   datfmt(*iso)
pdf  d w_date          s               d   datfmt(*iso)
pdf  d w_kode          s              1
pdf  d w_firm          s                   like(bnfirm)
pdf  d w_fell          s              6
pdf  d w_type          s              2
pdf  d w_fast          s             10
pdf  d w_ruti          s             10
pdf  d w_numm          s              6  0
pdf  d w_pdf           s              1  0
pdf  d w_jnav          s             15
pdf  d w_jkey          s             41
pdf  d w_txt           s             35
pdf  d w_pdf_ds        s            512
pdf  d w_mtxt          s            200
pdf  d w_jstat         s              2  0
pdf  d w_jtext         s            200
pdf  d w_spol          s              5
pdf  d w_land          s              9
pdf  d w_str_in        s            512
pdf  d w_str_out       s            512
pdf  d w_x             s              3  0
pdf  d w_path          s            256
pdf  d w_emal          s             50
pdf  d w_draw1         s             10
pdf  d w_draw2         s             10
pdf  d w_dspl          s            100
pdf  d w_tek1          s            512
pdf  d w_tek2          s            512
pdf  d w_tek0          s            512
pdf  d w_1dref         s            512
pdf  d w_1fnav         s             50
pdf  d w_1fad1         s             50
pdf  d w_1fad2         s             50
pdf  d w_1navn         s             50
pdf  d w_1gate         s             50
pdf  d w_1adr2         s             50
pdf  d w_2navn         s             50
pdf  d w_2adr1         s             50
pdf  d w_2adr2         s             50
6.21 d w_rekv          s             50
pdf  d w_copy          s              3  0
6.24 d w_lmtx          s             50
6.24 d w_lbtx          s             50
6.24 d w_ddeno         s                   like(ragkod)
6.24 d w_dnavn         s             50
6.24 d w_dadr1         s             50
6.24 d w_dadr2         s             50
6.24 d w_dpcde         s                   like(ragpnr)
6.24 d w_dpstd         s             50
6.24 d w_dphon         s                   like(ragtlf)
6.24 d w_dfaxn         s                   like(ragfax)
6.24 d w_ldat          s              6  0
6.24 d w_lddt          s              6  0
pdf   *
pdf  d XML_Output      s            256a   Varying
pdf  d XML_path        s            256a   Varying
pdf  d                                     Inz('/home/asp/print/adb')
pdf  d jasper_mal      s            256a   inz('file:/home/asp/print/maler/+
pdf  d                                     pakkseddel/PAKKSEDDEL.jasper')
pdf  d jasper_logo     s            256a   Varying
pdf  d tmpdate         s               D
pdf  d tmptime         s               T
pdf  d crlf            c                   const(X'0d25')
pdf   *
pdf  d d_pdf_ds        ds
pdf  d  d_xmlm                       75
pdf  d  d_jasm                       75
pdf  d  d_logo                       75
pdf  d  d_path                      100
pdf  d  d_emal                       50
6.32 d  d_fifo                       75
6.32 d  d_kopi                        1
6.32 d  d_dtaq                        1
6.32 d  d_sign                        1
pdf   /copy prototypeb
pdf   /copy usec
      *
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Definering av formater                                          *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Benyttede formater
      * - - - - - - - - - -
      *
      * A1HDR  - Heading A1 på rapport
      * A4HDR  - Heading A4 på rapport, Ordrehode over varelinje
      * D1DET  - Detail  D1 på rapport, Varelinje
      * E1DET  - Detail  E1 på rapport, Tekstlinje
      * T1TOT  - Total   T1 på rapport
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * A1HDR Behandle heading A1                                       *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Dersom det ikke ble funnet
      * noen headingpost, avsluttes
      * programmet med en gang.
      *
     C     *IN60         CABEQ     '1'           XSLUTT
3.34  *
3.34  * Nullstilling
3.34  *
3.34 c                   eval      *in55 = *off
      *
      * Hente inn kunderegister
      *
     C                   MOVE      BNKUND        WWKUND
     C     KEY04         CHAIN     rkunl1r                            64
     C                   MOVE      BNKUND        A1KUND
     C                   MOVE      RKKATG        A1KATG
     C                   MOVE      RKNAVN        A1NAVN
     C                   MOVE      RKGATE        A1GATE
     C                   MOVE      RKADR2        A1ADR2
     C                   MOVE      RKSTED        A1STED
6.30  * Slå opp på kundeprosjekt for å finne om prosjekt er
6.30  * overstyrer verdi på kunde
6.30 c                   if        BNKPRO > 0
6.30 c                   eval      fkprl1_kund = BNKUND
6.30 c                   eval      fkprl1_kpro = BNKPRO
6.30 c     fkprl1_key    chain     fkprl1
6.30 c                   if        %found(fkprl1)
3.34  *
3.34  * Skal pris droppes på pakkseddel
3.34  *
3.34 c                   if        flprpa = 1
3.34 c                   eval      *in55  = *on
3.34 c                   endif
6.30 c                   endif
6.30 C                   else
3.34  *
3.34  * Skal pris droppes på pakkseddel
3.34  *
3.34 c                   if        rkprpa = 1
3.34 c                   eval      *in55  = *on
3.34 c                   endif
6.30 c                   endif
6.30  *
      *
      *  Hent tekst for selger
      *
     C                   CALL      'RS709R'
     C                   PARM                    wpretk
     C                   PARM                    bnselg
     C                   PARM                    a1stxt
      *
     C                   MOVE      WPNUMM        A1NUMM
      *
      * Hente inn betalingsbetingelser
      *
     C                   exsr      sbbetb
      *
      * Er det registrert
      * leveringsadresse?
      *
     C                   MOVE      *OFF          *IN31
     C     BNNAVN        IFNE      *BLANK                                                .....
     C                   MOVE      *ON           *IN31                                       .
     C                   MOVE      BNNAVN        A2NAVN                                      .
     C                   MOVE      BNADR1        A2ADR1                                      .
     C                   MOVE      BNADR2        A2ADR2                                      .
     C                   MOVE      BNSTED        A2STED                                      .
     C                   ENDIF                                                           .....
      *
      * Er det registrert
      * leveringsdato?
      *
     C                   MOVE      *OFF          *IN32
     C     BNLDAT        IFNE      *loval
6.24 c     *dmy          move      bnldat        w_ldat
     C                   MOVE      *ON           *IN32
6.24 c                   else
6.24 c     *dmy          move      w_date        w_ldat
     C                   ENDIF
      *
      * Er det registrert
      * kundens referanse?
      *
     C                   MOVE      *OFF          *IN33
     C     BNDREF        IFNE      *BLANK
     C                   MOVE      *ON           *IN33
     C                   MOVE      BNDREF        A1DREF
     C                   ENDIF
      *
      * Er det registrert
      * leveringsmåte?
      *
     C                   MOVE      *OFF          *IN34
     C     BNLMTX        IFNE      *BLANK
     C                   MOVE      *ON           *IN34
     C                   MOVE      BNLMTX        A1LMTX
     C                   ENDIF
      *
      * Snu dato
      *
     c                   eval      a1bdat = 0
     c                   eval      a1ldat = 0
      *
     c                   if        bnbdat <> *loval
     c     *dmy          move      bnbdat        a1bdat
     c                   endif
      *
     c                   if        bnldat <> *loval
     c     *dmy          move      bnldat        a1ldat
     c                   endif
      *
      * Er det registrert
      * rekvisisjon?
      *
     C                   MOVE      *OFF          *IN38
     C     BNREKV        IFNE      *BLANK
     C                   MOVE      *ON           *IN38
     C                   MOVE      BNREKV        A1REKV
     C                   ENDIF
3.33  *
3.33  * Hente inn telefon/fax/mobil fra kunde
3.33  *
3.33 c                   call      'FÅ710R'
3.33 c                   parm                    wwfirm
3.33 c                   parm                    a1kund
3.33 c                   parm                    bnkpro
3.33 c                   parm                    w_tlfn
3.33 c                   parm                    w_tlfx
3.33 c                   parm                    w_mobn
3.33 c                   eval      a1tlfn = w_tlfn
3.33 c                   eval      a1tlfx = w_tlfx
3.33 c                   eval      a1mobn = w_mobn
      *
      * Flytte øvrige felter
      *
     C                   MOVE      '/00'         A1SUFF
      *
     C                   MOVE      BNWSID        A1WSID
     C                   MOVE      BNTIME        A1TIME
     C                   MOVE      BNORNR        A1ORNR
     C                   MOVE      BNSELG        A1SELG
     C***                MOVE      BNBETB        A1BETB
     c**                 MOVE      BNVREF        A1VREF
6.24  *
6.24 C                   eval      x_mobi = *blank
6.24 C                   eval      x_mobn = *blank
6.24  *
6.24 C                   eval      ra09l1_ikod = bnselg
6.24 C     ra09l1_key    chain     ra09l1
6.24 C                   if        raimob <> *blank
6.24 C                   move      '/'           d_tegn
6.24 C                   move      raimob        d_mobn
6.24 C                   move      x_mobi        x_mobn
6.24 C                   endif
6.24  *
3.11  *
3.11  *  Hent inn firma/avd. opplysninger dersom
3.11  *  kode for det er satt i rutineregister
3.11  *
5.41 c                   if        l_prfi = 1 or
5.41 c                             l_prfi = 2
5.41 c                   eval      w_prfi = l_prfi
3.11 c                   eval      w_ffir = bnfirm
3.11 c                   eval      w_avde = bnavde
3.11  *
3.11 c                   call      'FÅ707R'
3.11 c                   parm                    w_prfi
3.11 c                   parm                    w_ffir
3.11 c                   parm                    w_avde
3.11 c                   parm                    w_fnav
3.11 c                   parm                    w_fad1
3.11 c                   parm                    w_fad2
3.11 c                   parm                    w_fste
3.11 c                   parm                    w_fftx
3.11 c                   parm                    w_tfax
3.11 c                   parm                    w_ftlf
3.11 c                   parm                    w_ffax
6.31 c                   parm                    w_mail
6.31 c                   parm                    w_weba
3.11  *
3.11 c                   eval      a1fnav = w_fnav
3.11 c                   eval      a1fad1 = w_fad1
3.11 c                   eval      a1fad2 = w_fad2
3.11 c                   eval      a1fste = w_fste
3.11 c                   eval      a1fftx = w_fftx
3.11 c                   eval      a1tfax = w_tfax
3.11 c                   eval      a1ftlf = w_ftlf
3.11 c                   eval      a1ffax = w_ffax
3.11 c                   eval      *in42  = *on
3.11 C                   endif
pdf   *
pdf  c     afirl1_key    chain     afirl1r
pdf   *
5.22  *
5.22  * Legger inn '/' mellom
5.22  * telefon og telefax
5.22  *
5.22 c                   eval      a1skra =  ' '
5.22 c                   if        a1ftlf <> *blank and
5.22 c                             a1ffax <> *blank
5.22 c                   eval      a1skra =  '/'
5.22 c                   endif
6.24  * Hent inn avdelingsinfo - uavhengig av om dette ligger i firmatagger
6.24 c                   exsr      hnt_avde
      *
      * Skrive heading
      *
pdf  c                   if        b_pdfp = *off
     C                   Z-ADD     0             WLTELL
     C                   WRITE     A1HDR
pdf  c                   else
pdf   * Vi skriver til XML taggene for heading
pdf  c                   exsr      xml_head
pdf  c                   endif
      *
      * Skriv heading over
      * varelinjer
      *
     C     VAOSAM        IFEQ      *ZERO
pdf  c                   if        b_pdfp = *off
     C                   ADD       2             WLTELL
     C                   WRITE     A4HDR                                30
     C                   END
pdf  c                   endif
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * D1DET Behandle detail D1                                        *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Lese file
      *
     C                   MOVE      *ZERO         WWLINE
     C     KEY02         SETLL     BMDTL1
     C                   READ      BMDTL1                                 15
     C                   MOVE      BMWSID        SAWSID
      *
      * Nullstilling av variabler
      *
     C                   MOVE      *ZERO         D1ANT0
     C                   MOVE      *ZERO         D1ANT1
     C                   MOVE      *ZERO         D1ANT2
     C                   MOVE      *ZERO         D1ANT3
5.22 c                   move      *zero         d1lety
      *
     C     SAWSID        DOWEQ     BNWSID                                                .....
     C     *IN15         CABEQ     '1'           XEND01                         EOF          .
      *
     C     BMVARE        COMP      *BLANK                                 22
      *
      * Oppslag mot vareregister
      *
     C                   MOVE      BMVARE        WWVARE
     C     KEY11         CHAIN     VVARL1R                            69
      *
      * Test på antall desimaler
      *
     C     VVDESI        COMP      0                                      50
     C     VVDESI        COMP      1                                      51
     C     VVDESI        COMP      2                                      52
     C     VVDESI        COMP      3                                      53
     C   50              Z-ADD     BMANTA        D1ANT0
     C   51              Z-ADD     BMANTA        D1ANT1
     C   52              Z-ADD     BMANTA        D1ANT2
     C   53              Z-ADD     BMANTA        D1ANT3
      *
      *  Skriver ut varelinje
      *
     C                   MOVE      BMVARE        D1VARE
     C                   MOVEL     BMTEK1        D1TEK1
     C                   MOVE      BMENH1        D1ENH1
     C                   Z-ADD     BMsapr        D1sapr
5.22 c                   z-add     bmlety        d1lety
      *
     C     BMSUMS        IFLT      *ZERO
     C                   MULT      -1            D1ANT0
     C                   MULT      -1            D1ANT1
     C                   MULT      -1            D1ANT2
     C                   MULT      -1            D1ANT3
     C                   MULT      -1            D1sapr
     C                   END
      *
pdf  c                   if        b_pdfp = *off
     C                   ADD       1             WLTELL
     C  N22              WRITE     D1DET                                30
5.22  *
5.22  * Skriv varelinje for tekst 2
5.22  * dersom den er oppgitt
5.22  *
5.22 c                   if        bmtek2 <> *blank
5.22 c                   add       1             wltell
5.22 c                   eval      d1tek2 = bmtek2
5.22 c                   write     d1det2                               30
5.22 c                   endif
5.22  *
5.22  * Er det overflow ?
5.22  *
5.22 C     *IN30         IFEQ      *ON
5.22 C                   WRITE     A1HDR
5.22 C                   Z-ADD     0             WLTELL
5.22 C                   ENDIF
pdf   * Skriver XML tagger for detaljer
pdf  c                   else
pdf  c                   exsr      xml_deta
pdf  c                   endif
      *
      *  Skriver ut tekstlinje
      *
     C                   MOVE      BMVARE        E1VARE
     C                   MOVEL     BMTEK1        E1TEK1
     C                   MOVEL     BMTEK2        E1TEK2
pdf  c                   if        b_pdfp = *off
     C   22              WRITE     E1DET                                30
      *
      * Er det overflow ?
      *
     C     *IN30         IFEQ      *ON
     C                   WRITE     A1HDR
     C                   Z-ADD     0             WLTELL
     C                   ENDIF
pdf   * Skriver XML tagger for tekstlinjer
pdf  c                   else
pdf  c                   if        *in22 = *on
pdf  c                   exsr      xml_text
pdf  c                   endif
pdf  c                   endif
      *
     C                   READ      BMDTL1                                 15
     C                   MOVE      BMWSID        SAWSID
     C                   ENDDO
      *
     C     XEND01        TAG
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * T1TOT Behandle total T1                                         *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Finne ut om det er
      * plass til å skrive
      * avslutning uten å
      * skifte til ny side
      * først.
      *
      * Trekker ut heading
      *
     C     l_alin        SUB       24            WLTEST
      *
      * Trekker ut antall
      * linjer skrevet
      *
     C                   SUB       WLTELL        WLTEST
      *
      * Trekker ut plassbehov
      * for avslutning
      *
     C                   SUB       15            WLTEST
      *
      * Skrive ny heading ?
      *
pdf  c                   if        b_pdfp = *off
     C     WLTEST        IFLT      0
     C                   WRITE     A1HDR
     C                   Z-ADD     0             WLTELL
     C                   ENDIF
      *
      * Skrive totalsum
      *
     C                   WRITE     T1TOT                                30
pdf  c                   endif
pdf  c                   if        b_pdfp = *on
pdf  c                   exsr      xml_endpackl
pdf  c                   endif
     C                   GOTO      XSLUTT
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Avslutt program                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     C     XSLUTT        TAG
pdf   *
pdf  c                   if        b_pdfp = *on
pdf   * Skriv xml fila på disk
pdf  c                   exsr      xml_end
pdf   * Avslutt jobbiden
pdf  c                   call      'AB710R'
pdf  c                   parm                    l_bach
pdf   *
pdf  c                   endif
pdf   *
     C                   SETON                                        LR
      *
     C/EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Sjekk/Hent tekst for betalingsbetingelser         RS203R       *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *
     C     SBBETB        BEGSR
      *
     c                   eval      wpcbda = *loval
     c                   eval      wpcfda = *loval
      *
     c                   call      'FÅ703R'
     c                   parm                    wwfirm
     c                   parm                    bnbetb
     c                   parm                    wpcbda
     c                   parm                    wpretk
     c                   parm                    wpcfda
     c                   parm                    wpctx1
     c                   parm                    wpctx2
      *
     C                   MOVE      *BLANK        A1BTX1
     C                   MOVE      *BLANK        A1BTX2
      *
     C     WPRETK        IFEQ      *BLANK
     C                   MOVEL     WPCTX1        A1BTX1
     C                   MOVEL     WPCTX2        A1BTX2
     C                   ENDIF
      *
     C                   ENDSR
      *
     C/EJECT
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Miljø variabler         *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_envm      begsr
pdf   *
pdf  c**                 if        l_skje = 1
pdf  c**                 eval      w_spol = 'true'
pdf  c**                 else
pdf  c                   eval      w_spol = 'false'
pdf  c**                 endif
pdf   *
pdf   /Free
pdf        // Finne nytt batch nummer
pdf            UpdHTMLVar('BatchNo':               w_jkey);
pdf            UpdHTMLVar('Batchtype':       'PAKKSEDDEL');
pdf            UpdHTMLVar('Username':              l_user);
pdf            WrtSection('Topp');
pdf        // Finn report command variabler
pdf            UpdHTMLVar('User':                l_user);
pdf            UpdHTMLVar('PW':                     ' ');
pdf            UpdHTMLVar('IPAdr':                  ' ');
pdf            UpdHTMLVar('Schema':        'ADB'+l_filg);
pdf            UpdHTMLVar('Companyno':    %char(l_firm));
6.33           UpdHTMLVar('Departmentnoarkiv': %char(l_avde));
pdf            WrtSection('Credential');
pdf        // Finn report command variabler
pdf            UpdHTMLVar('Jaspertemplate':      d_jasm);
pdf            UpdHTMLVar('Logo':           jasper_logo);
pdf            UpdHTMLVar('Keepspool':           w_spol);
pdf            WrtSection('ReportCommand');
pdf   /End-free
pdf   *
pdf   * Hvis skjermvisning skal ikke PDF skrives
pdf   *
pdf  c                   if        l_skje = 0 and
pdf  c                             l_mail = 0
pdf   * Hvis *ARKIV er valgt som skriver, skal det ikke skrives ut
pdf  c                   if        l_utqm <> '*ARKIV'
pdf   *
pdf  c                   if        l_land = 1
pdf  c                   eval      w_land = 'LANDSCAPE'
pdf  c                   else
pdf  c                   eval      w_land = 'PORTRAIT'
pdf  c                   endif
pdf   * Sjekk at valgt outq støttes av skriveren. Kan skli gjennom hvis
pdf   * jobben legges på jobbkø.
pdf  c                   eval      p_ok = '0'
pdf  c                   call      'AP612R'
pdf  c                   parm                    l_filg
pdf  c                   parm                    l_outq
pdf  c                   parm                    p_ok
pdf   * Hvis feil utkø, logges dette i transaksjonsloggen
pdf  c                   if        p_ok = '0'
pdf  c                   eval      w_jstat = 20
pdf  c                   eval      w_jtext = 'Ugyldig utkø '+ l_outq + ' er val+
pdf  c                             gt. Ingen utskrift er generert. Utskrift kan+
pdf  c                              arkiveres.'
pdf  c                   call      'AB705R'
pdf  c                   parm                    l_bach
pdf  c                   parm                    w_jstat
pdf  c                   parm                    w_jtext
pdf  c                   else
pdf   * Hent inn skuffinformasjon for skriveren
pdf  c                   eval      w_draw1 = *blank
pdf  c                   eval      w_draw2 = *blank
pdf  c                   call      'AP611R'
pdf  c                   parm                    l_filg
pdf  c                   parm                    l_outq
pdf  c                   parm                    w_draw1
pdf  c                   parm                    w_draw2
pdf   *
pdf  c                   if        l_copy > 0
pdf  c                   eval      w_copy = l_copy
pdf  c                   else
pdf  c                   eval      w_copy = 1
pdf  c                   endif
pdf   *
pdf   /Free
pdf        // Finn print informasjon
pdf            UpdHTMLVar('Printername':         l_outq);
pdf            UpdHTMLVar('Copies':        %char(w_copy));
pdf            UpdHTMLVar('Papersource':        w_draw1);
pdf            UpdHTMLVar('Lastpagedrawer':         ' ');
pdf            UpdHTMLVar('Duplex':             'false');
pdf            UpdHTMLVar('Quality':                ' ');
pdf            UpdHTMLVar('Sorting':                ' ');
pdf            UpdHTMLVar('Staple':              'true');
pdf            UPDHTMLVar('Alignment':           w_land);
pdf            WrtSection('PrintCommand');
pdf   /End-free
pdf  c                   endif
pdf  c                   endif
pdf  c                   endif
pdf   *
pdf  c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Heading                 *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_head      begsr
pdf   *
pdf  c                   eval      w_str_in = *blanks
pdf  c                   eval      w_str_out = *blanks
pdf  c                   eval      w_mtxt = *blanks
7.01 c**                 eval      x_numm = %char(a1numm)+a1suff
7.01 c                   eval      x_suff = '/00'
7.01 c                   eval      x_numm = %char(a1ornr) + x_suff
6.24 c**                 eval      x_vref = %char(a1selg)+' '+bnvref
6.24 c                   eval      w_selgn = %trim(%char(a1selg) + x_mobi)
pdf  c                   eval      x_betb = a1btx1 + ' ' + a1btx2
pdf   * Vi må oversette aktuelle tekster til "xml" tegn - Firma
pdf  c                   eval      w_1fnav = *blank
pdf  c                   eval      w_1fad1 = *blank
pdf  c                   eval      w_1fad2 = *blank
pdf  c                   eval      w_1navn = *blank
pdf  c                   eval      w_1gate = *blank
pdf  c                   eval      w_1adr2 = *blank
pdf  c                   eval      w_2navn = *blank
pdf  c                   eval      w_2adr1 = *blank
pdf  c                   eval      w_2adr2 = *blank
6.21 c                   eval      w_rekv = *blank
      *
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     a1fnav        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_1fnav
      *
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     a1fad1        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_1fad1
      *
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     a1fad2        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_1fad2
      *
      * Vi må oversette aktuelle tekster til "xml" tegn - Partner
      *
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     a1navn        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_1navn
      *
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     a1gate        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_1gate
      *
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     a1adr2        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_1adr2
      *
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     a1dref        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_1dref
      *
6.21 c                   eval      p_lr = '0'
6.21 c                   movel     a1rekv        p_str_in
6.21 c                   call      'AP613R'
6.21 c                   parm                    p_str_in
6.21 c                   parm                    p_str_out
6.21 c                   parm                    p_lr
6.21 c                   movel     p_str_out     w_rekv
pdf   * Sjekk om priser skal skrives ut på dokumentet
pdf  c                   if        *in55 = *on
6.26 c                   eval      w_pris = 'false'
pdf  c                   else
6.26 c                   eval      w_pris = 'true'
pdf  c                   endif
      * Avdelingsinformasjon - navn
6.24 c                   eval      p_str_in = *blank
6.24 c                   eval      p_lr = '0'
6.24 c                   movel     w_dnavn       P_str_in
6.24 c                   call      'AP613R'
6.24 c                   parm                    p_str_in
6.24 c                   parm                    p_str_out
6.24 c                   parm                    p_lr
6.24 c                   movel     p_str_out     w_dnavn
      * Avdelingsinformasjon - adresse
6.24 c                   eval      p_str_in = *blank
6.24 c                   eval      p_lr = '0'
6.24 c                   movel     w_dadr1       P_str_in
6.24 c                   call      'AP613R'
6.24 c                   parm                    p_str_in
6.24 c                   parm                    p_str_out
6.24 c                   parm                    p_lr
6.24 c                   movel     p_str_out     w_dadr1
      * Avdelingsinformasjon - adresse 2
6.24 c                   eval      p_str_in = *blank
6.24 c                   eval      p_lr = '0'
6.24 c                   movel     w_dadr2       P_str_in
6.24 c                   call      'AP613R'
6.24 c                   parm                    p_str_in
6.24 c                   parm                    p_str_out
6.24 c                   parm                    p_lr
6.24 c                   movel     p_str_out     w_dadr2
      * Avdelingsinformasjon - poststed
6.24 c                   eval      p_str_in = *blank
6.24 c                   eval      p_lr = '0'
6.24 c                   movel     w_dpstd       P_str_in
6.24 c                   call      'AP613R'
6.24 c                   parm                    p_str_in
6.24 c                   parm                    p_str_out
6.24 c                   parm                    p_lr
6.24 c                   movel     p_str_out     w_dpstd
pdf   /Free
pdf
pdf        // Skriv firmavariabler
6.20           UpdHTMLVar('Reporttext':            a1txt1);
pdf            UpdHTMLVar('CompanyName':          w_1fnav);
pdf            UpdHTMLVar('Companyadress1':       w_1fad1);
pdf            UpdHTMLVar('Companyadress2':       w_1fad2);
pdf            UpdHTMLVar('Companypostalcode':        ' ');
pdf            UpdHTMLVar('Companypostoffice':     a1fste);
pdf            UpdHTMLVar('Companyphone':          a1ftlf);
pdf            UpdHTMLVar('Companyfax':            a1ffax);
pdf            UpdHTMLVar('Companyorgno':   %char(aafftn));
pdf            UpdHTMLVar('Companygiro':    %char(aafbgi));
6.31           UpdHTMLVar('Companyemail':   %trim(w_mail));
6.31           UpdHTMLVar('Companywebpage': %trim(w_weba));
6.24           WrtSection('Company');
6.24
6.24           UpdHTMLVar('Departmentno':    %char(bnavde));
6.24           UpdHTMLVar('Departmentname':        w_dnavn);
6.24           UpdHTMLVar('Departmentadress1':     w_dadr1);
6.24           UpdHTMLVar('Departmentadress2':     w_dadr2);
6.24           UpdHTMLVar('Departmentpostalcode':      ' ');
6.24           UpdHTMLVar('Departmentpostoffice':  w_dpstd);
6.24           UpdHTMLVar('Departmentphone':       w_dphon);
6.24           UpdHTMLVar('Departmentfax':         w_dfaxn);
6.24           WrtSection('Department');
pdf
pdf            test(de) *dmy a1bdat;
pdf            if %error;
pdf            tmpdate = *loval;
pdf            else;
pdf            tmpdate = %date(a1bdat : *dmy);
pdf            endif;
pdf            UpdHTMLVar('Creationdate':   %char(tmpdate : *iso));
pdf            test(te) *hms a1time;
pdf            if %error;
pdf            tmptime = *loval;
pdf            else;
pdf            tmptime = %time(a1time : *hms);
pdf            endif;
pdf            UpdHTMLVar('Creationtime': %char(tmptime : *hms));
6.24           WrtSection('Creation');
pdf
pdf        // Skriv partnerinfo (kunde)
pdf            UpdHTMLVar('Partnerno':      %char(a1kund));
pdf            UpdHTMLVar('Partnercategory':%char(a1katg));
pdf            UpdHTMLVar('Partnername':          w_1navn);
pdf            UpdHTMLVar('Partneradress1':       w_1gate);
pdf            UpdHTMLVar('Partneradress2':       w_1adr2);
pdf            UpdHTMLVar('Partnerpostalcode':        ' ');
pdf            UpdHTMLVar('Partnerpostoffice':     a1sted);
pdf            UpdHTMLVar('Partnerphone':          a1tlfn);
pdf            UpdHTMLVar('Partnercellphone':      a1mobn);
pdf            UpdHTMLVar('Partnerfax':            rktlfx);
7.02    //     UpdHTMLVar('Salesdocumentno':%char(a1ornr));
7.01           UpdHTMLVar('Salesdocumentno':       x_numm);
pdf            UpdHTMLVar('Partnerrefname':       w_1dref);
pdf            UpdHTMLVar('Partnerrefphone':          ' ');
pdf            UpdHTMLVar('Partnerrefmail':           ' ');
6.21           UpdHTMLVar('Requisitionno':         w_rekv);
pdf            WrtSection('Partner');
pdf
pdf        // Selger informasjon
6.24    //     UpdHTMLVar('Salesrefno':     %char(a1selg));
6.24           UpdHTMLVar('Salesrefno':           w_selgn);
pdf            UpdHTMLVar('Salesrefname':          a1stxt);
6.24           UpdHTMLVar('Salesrefemail':         raiema);
6.24           UpdHTMLVar('Salesrefcellphone':     raimob);
pdf            WrtSection('SalesRef');
pdf   /End-free
pdf   *
pdf  c                   if        %trim(a2navn) <> *blank
pdf   * Vi må oversette aktuelle tekster til "xml" tegn - Prosjekt
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     a2navn        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_2navn
      *
pdf  c                   eval      p_lr = '0'
pdf  c                   eval      p_str_in = *blank
pdf  c                   movel     a2adr1        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_2adr1
      *
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     a2adr2        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_2adr2
      *
6.24 c                   eval      p_str_in = *blank
6.24 c                   eval      p_lr = '0'
6.24 c                   movel     bnlbtx        p_str_in
6.24 c                   call      'AP613R'
6.24 c                   parm                    p_str_in
6.24 c                   parm                    p_str_out
6.24 c                   parm                    p_lr
6.24 c                   movel     p_str_out     w_lbtx
pdf   *
pdf   /Free
pdf        // Prosjekt informasjon
pdf            UpdHTMLVar('Projectno':      %char(bnkpro));
pdf            UpdHTMLVar('Projectname':          w_2navn);
pdf            UpdHTMLVar('Projectadress1':       w_2adr1);
pdf            UpdHTMLVar('Projectadress2':       w_2adr2);
pdf            UpdHTMLVar('Projectpostalcode':        ' ');
pdf            UpdHTMLVar('Projectpostoffice':     a2sted);
pdf            WrtSection('Project');
pdf   /End-free
pdf  c                   endif
      * Henter inn lagertekst
7.01 c                   eval      w_ltxt = *blanks
7.01 c                   eval      ra10l1_jkod = bnlage
7.01 c     ra10l1_key    chain     ra10l1
7.01 c                   if        not %found
7.01 c                   eval      rajtxt = *blank
7.01 c                   endif
7.01  *
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     rajtxt        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_ltxt
pdf   /Free
6.24           UpdHTMLVar('Currency':              bnvalk);
6.24           UpdHTMLVar('Discountcat':    %char(bnrkat));
6.24           UpdHTMLVar('Agent':          %char(bnsped));
6.24           WrtSection('InfoHead1');
pdf
6.24           UpdHTMLVar('Deliverymethod':               w_lmtx);
6.24           test(de) *dmy w_ldat;
6.24           if %error;
6.24           tmpdate = *loval;
6.24           else;
6.24           tmpdate = %date(w_ldat : *dmy);
6.24           endif;
6.24           UpdHTMLVar('Deliverydate':   %char(tmpdate : *iso));
6.24           UpdHTMLVar('Deliverytype':           %char(bnlety));
6.24           UpdHTMLVar('Deliveryterms':                 w_lbtx);
6.24           UpdHTMLVar('Drivingroute':           %char(bnkjor));
6.24           WrtSection('DeliveryInfo');
pdf
6.24           UpdHTMLVar('District':       %char(bndist));
6.24           UpdHTMLVar('Warehouse':      %char(bnlage));
6.24           UpdHTMLVar('Documenttype':          bnotyp);
pdf
pdf            test(de) *dmy a1bdat;
pdf            if %error;
pdf            tmpdate = *loval;
pdf            else;
pdf            tmpdate = %date(a1bdat : *dmy);
pdf            endif;
pdf            UpdHTMLVar('Deliverydate': %char(tmpdate : *iso));
pdf            UpdHTMLVar('Paymentcondition':            x_betb);
pdf            UpdHTMLVar('Deliverymethod':              a1lmtx);
pdf            UpdHTMLVar('Showprice':                   w_pris);
6.24           WrtSection('InfoHead2');
pdf
pdf        //  Legg ut 'heading' på linje
pdf            WrtSection('PacknoteLines');
pdf
pdf   /End-free
pdf   *
pdf  c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Detaljer                *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_deta      begsr
pdf   * Vi må oversette aktuelle tekster til "xml" tegn - Varetekster
pdf  c                   eval      w_tek1 = *blank
pdf  c                   eval      w_tek2 = *blank
      *
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     d1tek1        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_tek1
pdf   *
pdf  c                   if        bmtek2 <> *blank
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     bmtek2        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_tek2
pdf  c                   endif
pdf   * Håndtere riktig antall desimaler
pdf  c                   if        *in50 = *on
pdf  c                   callp     updHTMLVar('Quantity':%char(d1ant0))
pdf  c                   callp     updHTMLVar('NoDecimals':        '0')
pdf  c                   elseif    *in51 = *on
pdf  c                   callp     updHTMLVar('Quantity':%char(d1ant1))
pdf  c                   callp     updHTMLVar('NoDecimals':        '1')
pdf  c                   elseif    *in52 = *on
pdf  c                   callp     updHTMLVar('Quantity':%char(d1ant2))
pdf  c                   callp     updHTMLVar('NoDecimals':        '2')
pdf  c                   elseif    *in53 = *on
pdf  c                   callp     updHTMLVar('Quantity':%char(d1ant3))
pdf  c                   callp     updHTMLVar('NoDecimals':        '3')
pdf  c                   endif
pdf   *
pdf  c                   eval      w_bpri = d1sapr
pdf  c                   if        *in55 = *on
pdf  c                   eval      w_pris = 'false'
pdf  c                   else
pdf  c                   eval      w_pris = 'true'
pdf  c                   endif
6.24  *
6.24 c                   if        bnldat <> *loval
6.24 c     *dmy          move      bnldat        w_lddt
6.24 c                   else
6.24 c                   eval      w_lddt = w_ldat
6.24 c                   endif
pdf   *
pdf   /Free
pdf        // Skriv detaljer
pdf            UpdHTMLVar('Itemno':             d1vare);
pdf            UpdHTMLVar('Text1':              w_tek1);
pdf            UpdHTMLVar('Text2':              w_tek2);
pdf            UpdHTMLVar('Unit':                d1enh1);
pdf            UpdHTMLVar('Priceexvat':   %char(w_bpri));
pdf            UpdHTMLVar('Linetype':    %char(d1lety));
pdf            UpdHTMLVar('Bookingno':             ' ');
pdf            UpdHTMLVar('Storage':     %char(bnlage));
pdf            UpdHTMLVar('Nobbno':      %char(vvnobb));
6.24           UpdHTMLVar('Currency':            bnvalk);
6.24           UpdHTMLVar('Lineno':        %char(bmline));
7.01     //    UpdHTMLVar('Warehouse':    %char(bnlage));
7.01           UpdHTMLVar('Warehouse':    %trim(w_ltxt));
7.24
6.24           test(de) *dmy w_lddt;
6.24           if %error;
6.24           tmpdate = *loval;
6.24           else;
6.24           tmpdate = %date(w_lddt : *dmy);
6.24           endif;
6.24           UpdHTMLVar('Deliverydate': %char(tmpdate : *iso));
6.24           UpdHTMLVar('Partneritemno':          ' ');
6.24           UpdHTMLVar('Campaign':            bmkamp);
6.24           UpdHTMLVar('Gtin':                   '0');
pdf            WrtSection('Line');
pdf
pdf   /End-free
pdf   *
pdf  c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Tekstlinjer             *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_text      begsr
pdf   *
pdf  c                   eval      w_tek1 = *blank
pdf  c                   eval      w_tek2 = *blank
pdf  c                   movel     bmtek1        d1tek1
pdf  c                   movel     bmtek2        d1tek2
pdf   * Vi må oversette aktuelle tekster til "xml" tegn - Tekstlinjer
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     d1tek1        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_tek1
      *
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '0'
pdf  c                   movel     d1tek2        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_tek2
pdf  c                   eval      w_tek0 = %trim(w_tek1) + ' ' + %trim(w_tek2)
      *
pdf   /Free
pdf            UpdHTMLVar('Text1':       %trim(w_tek0));
pdf            UpdHTMLVar('Text2':                 ' ');
pdf            WrtSection('TextLine');
pdf   /End-free
pdf   *
pdf  c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Siste tagg for pakks    *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_endpackl  begsr
pdf   *
pdf   /Free
pdf        // Skriv siste ordinære linjetagg
pdf            WrtSection('EndPackLines');
pdf
pdf   /End-free
pdf   *
pdf  c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Slutt                   *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_end       begsr
pdf   *
pdf   /Free
pdf            WrtSection('EndPackDocument');
pdf   /End-free
pdf   *
pdf   * Hvis denne ikke skal arkiveres, lages ikke archive tagg.
pdf   *
pdf  c                   if        l_arch = 1
pdf   * Lag tag for visning i arkivklienten
pdf  c                   eval      w_dspl = *blank
6.34 c                   eval      w_dspl = 'Pakkseddel: ' + %char(a1ornr) +
pdf  c                             ' Kunde: ' +  %trim(%char(bnkund) + ' - ' +
pdf  c                             %trim(a1navn))
pdf   *
pdf  c                   eval      p_str_in = *blank
pdf  c                   eval      p_lr = '1'
pdf  c                   movel     w_dspl        p_str_in
pdf  c                   call      'AP613R'
pdf  c                   parm                    p_str_in
pdf  c                   parm                    p_str_out
pdf  c                   parm                    p_lr
pdf  c                   movel     p_str_out     w_dspl
6.23  * Referansetagg
6.23 c                   eval      w_refn = *blank
6.25 c**                 eval      w_refn = 'PA-' + %char(a1numm) +
6.25 c**                           '-'+ %char(%subdt(w_date:*years))
6.34 c                   eval      w_refn = %char(%subdt(w_date:*years)) +
6.25 c                                      %char(a1ornr)
6.23  *
pdf   /Free
pdf        // Skriv metattags
pdf
6.23           UpdHTMLVar('Refno':          %trim(w_refn));
pdf            UpdHTMLVar('Displaytag':     %trim(w_dspl));
pdf            WrtSection('ArchiveCommandStart');
pdf
6.34    //     UpdHTMLVar('Metavalue':      %char(a1numm));
6.34           UpdHTMLVar('Metavalue':      %char(a1ornr));
pdf            UpdHTMLVar('Metakey':   'PAKKSEDDELNUMMER');
pdf            WrtSection('MetaTag');
pdf
pdf            UpdHTMLVar('Metavalue':      %char(a1kund));
pdf            UpdHTMLVar('Metakey':         'KUNDENUMMER');
pdf            WrtSection('MetaTag');
pdf
pdf            UpdHTMLVar('Metavalue':            w_1navn);
pdf            UpdHTMLVar('Metakey':          'KUNDENAVN');
pdf            WrtSection('MetaTag');
pdf
pdf            UpdHTMLVar('Metavalue':      %char(a1ornr));
pdf            UpdHTMLVar('Metakey':        'ORDRENUMMER');
pdf            WrtSection('MetaTag');
6.23
6.23           UpdHTMLVar('Metavalue':             l_ruti);
6.23           UpdHTMLVar('Metakey':             'RUTINE');
6.23           WrtSection('MetaTag');
6.20
6.20           UpdHTMLVar('Metavalue':             a1txt1);
6.20           UpdHTMLVar('Metakey':         'RUTINETEKST');
6.20           WrtSection('MetaTag');
6.23
6.23           UpdHTMLVar('Metavalue':             l_wsid);
6.23           UpdHTMLVar('Metakey':             'SKJERM');
6.23           WrtSection('MetaTag');
pdf
pdf            UpdHTMLVar('Metavalue':             l_user);
pdf            UpdHTMLVar('Metakey':             'BRUKER');
pdf            WrtSection('MetaTag');
pdf
pdf            UpdHTMLVar('Metavalue': %char(w_date:*iso));
pdf            UpdHTMLVar('Metakey':               'DATO');
pdf            WrtSection('MetaTag');
6.23
6.23           UpdHTMLVar('Metavalue':      %char(l_firm));
6.23           UpdHTMLVar('Metakey':              'FIRMA');
6.23           WrtSection('MetaTag');
pdf
6.34           UpdHTMLVar('Metavalue':      %char(a1numm));
6.34           UpdHTMLVar('Metakey':    'HANDTERMINALREF');
6.34           WrtSection('MetaTag');
pdf
pdf            WrtSection('ArchiveCommandEnd');
pdf   /End-free
pdf   *
pdf  c                   endif
pdf   *
pdf   /Free
pdf            WrtSection('Footer');
pdf   /End-free
pdf   *
pdf  c                   eval      XML_Output = XML_path + l_filg +'/'+
pdf  c                             'Pakk_'+ %trim(w_jkey) + '.xml'
pdf   *
pdf  c                   callp     WrtHtmlToStmf(XML_Output: 819)
6.32  * Skriver til datakø for å aktivere sniffer, hvis dataq er aktiv
6.32 c                   if        d_dtaq = '1'
6.32 c                   eval      p_xmlf = xml_output
6.32 c                   eval      p_filg = 'ADB'+l_filg
6.32 c                   call      'AP629C'
6.32 c                   parm                    p_filg
6.32 c                   parm                    p_xmlf
6.32 c                   endif
pdf   *
pdf  c                   endsr
6.24  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.24  * Subrutiner for XML/jasper integrasjon - Detaljer                *
6.24  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.24 c     hnt_avde      begsr
6.24  * Hent inn avdelingsinformasjon
6.24 c
6.24 c                   eval      w_ddeno = bnavde
6.24 c                   eval      w_dnavn = *blank
6.24 c                   eval      w_dadr1 = *blank
6.24 c                   eval      w_dadr2 = *blank
6.24 c                   eval      w_dpcde = *zeros
6.24 c                   eval      w_dpstd = *blank
6.24 c                   eval      w_dphon = *blank
6.24 c                   eval      w_dfaxn = *blank
6.24  *
6.24 c                   eval      ra07pf_avde = bnavde
6.24 c     ra07pf_key    chain     ra07pfr                            90
6.24 c                   if        *in90  = *off
6.24 c                   eval      w_dnavn = ragtxt
6.24 c                   eval      w_dadr1 = ragadr
6.24 c                   eval      w_dadr2 = ragad2
6.24 c                   eval      w_dpcde = ragpnr
6.24 c                   eval      w_dpstd = (%char(ragpnr) + ' ' + ragste)
6.24 c                   if        ragtlf <> *blank
6.24 c                   eval      w_dphon = ragtlf
6.24 c                   endif
6.24 c                   if        ragfax <> *blank
6.24 c                   eval      w_dfaxn = ragfax
6.24 c                   endif
6.24 c                   endif
6.24  *
6.24 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     C     *INZSR        BEGSR
      *
      *  Nullstilling av felter som ikke kan redefineres
      *
     C                   MOVE      *BLANK        WPRETK            1
     C                   MOVE      *ZERO         WPKRAB            4 2
      *
      *  Redefinering av felter
      *
     C     *LIKE         DEFINE    A1BTX1        WPCTX1
     C     *LIKE         DEFINE    A1BTX2        WPCTX2
     C     *LIKE         DEFINE    BNKUND        WWKUND
     C     *LIKE         DEFINE    BNAARR        WPAARR
     C     *LIKE         DEFINE    BNWSID        WPWSID
     C     *LIKE         DEFINE    BNNUMM        WPNUMM
     C     *LIKE         DEFINE    BNFIRM        WWFIRM
     C     *LIKE         DEFINE    BNAARR        WWAARR
     C     *LIKE         DEFINE    BNWSID        WWWSID
     C     *LIKE         DEFINE    BNNUMM        WWNUMM
     C     *LIKE         DEFINE    BMLINE        WWLINE
     C     *LIKE         DEFINE    BMWSID        SAWSID
     C     *LIKE         DEFINE    VAOFIR        OTYFIR
     C     *LIKE         DEFINE    VAOTYP        OTYTYP
     C     *LIKE         DEFINE    BMVARE        WWVARE
      *
     C                   MOVE      *BLANK        WWRUTI           10
     C                   MOVE      *ZERO         WLTELL            3 0
     C                   MOVE      *ZERO         WLTEST            3 0
      *
      * Parameterliste
      *
     C     *ENTRY        PLIST
     C                   PARM                    WPAARR
     C                   PARM                    WPWSID
     C                   PARM                    WPNUMM
     C                   PARM                    WPKODE            1 0
      *
      *  Key for file : ORDRE-TYPE-REGISTER
      *
     C     OTYKEY        KLIST
     C                   KFLD                    OTYFIR
     C                   KFLD                    OTYTYP
      *
      *
      * Key for Heading-file
      *
     C     KEY01         KLIST
     C                   KFLD                    WWFIRM
     C                   KFLD                    WWAARR
     C                   KFLD                    WWWSID
     C                   KFLD                    WWNUMM
      *
      * Key for Detalj-file
      *
     C     KEY02         KLIST
     C                   KFLD                    WWFIRM
     C                   KFLD                    WWAARR
     C                   KFLD                    WWWSID
     C                   KFLD                    WWNUMM
     C                   KFLD                    WWLINE
      *
      * Key for formular-register
      *
     C     KEY03         KLIST
     C                   KFLD                    WWRUTI
      *
      * Key for kunderegister
      *
     C     KEY04         KLIST
     C                   KFLD                    WWFIRM
     C                   KFLD                    WWKUND
      *
      * Key for firmaregister
      *
     C     KEY06         KLIST
     C                   KFLD                    WWFIRM
      *
      * Key for vare-register
      *
     C     KEY11         KLIST
     C                   KFLD                    WWFIRM
     C                   KFLD                    WWVARE
pdf   * Key for firmaregister
pdf   *
pdf  c     afirl1_key    klist
pdf  c                   kfld                    wwfirm
6.24  *
6.24  * Key for oppslag på avdelings-register
6.24  *
6.24 c     ra07pf_key    klist
6.24 c                   kfld                    w_firm
6.24 c                   kfld                    ra07pf_avde
6.24  * Key for posisjonering på selgere
6.24  *
6.24 c     ra09l1_key    klist
6.24 c                   kfld                    wwfirm
6.24 c                   kfld                    ra09l1_ikod
7.01  *
7.01  * Key for oppslag på lagerregister
7.01  *
7.01 c     ra10l1_key    klist
7.01 c                   kfld                    w_firm
7.01 c                   kfld                    ra10l1_jkod
6.30  *
6.30  * Key for oppslag på kundeprosjekt
6.30  *
6.30 c     fkprl1_key    klist
6.30 c                   kfld                    wwfirm
6.30 c                   kfld                    fkprl1_kund
6.30 c                   kfld                    fkprl1_kpro
      *
      *  Legger inn firmanummer i nøkklene
      *
     C                   MOVE      WWFIRM        OTYFIR
      *
      * Hente inn ordrehode
      *
     C                   MOVE      l_firm        WWFIRM
     C                   MOVE      WPAARR        WWAARR
     C                   MOVE      WPWSID        WWWSID
     C                   MOVE      *ZERO         WWNUMM
      *
     C     KEY01         CHAIN     BMHEL1R                            60
      *
      * Sjekke om det er retur,
      * *IND45 settes på
      *
     C                   MOVE      *OFF          *IN45
     C                   MOVE      BNOTYP        OTYTYP
     C     OTYKEY        CHAIN     VOTYL1R                            62
     C     VAOKRE        IFEQ      '-'
     C                   MOVE      *ON           *IN45
     C                   ENDIF
      *
      * Hente inn rutinenavn
      * og meldingstekst
      *
     C                   MOVE      l_ruti        WWRUTI
      *
     C     KEY03         CHAIN     AFORL1R                            63
     C  N63              MOVE      AFTXT1        A1TXT1
     C  N63              MOVE      AFMLD1        T1MLD1
      *
pdf   * Sjekk om vi skal bruke JASPER og XML generering av dokumenter
pdf  c                   if        l_poff = '1'
pdf  c                   eval      b_pdfp = *off
pdf  c                   eval      b_topt = *off
pdf  c                   eval      b_bott = *off
pdf  c                   eval      b_rest = *off
pdf  c                   eval      w_pdf = 0
pdf  c                   eval      w_pdf_ds = *blanks
pdf  c                   eval      w_ruti = l_ruti
pdf   *
pdf  c                   call      'AP609R'
pdf  c                   parm                    w_ruti
pdf  c                   parm                    w_pdf
pdf  c                   parm                    w_pdf_ds
pdf  c                   eval      d_pdf_ds = w_pdf_ds
pdf   * Vi skal kjøre med jasper
pdf  c                   if        w_pdf = 1 and
pdf  c                             %trim(d_xmlm) <> *blanks
pdf  c                   eval      p_mail = '0'
pdf  c                   eval      w_jkey = l_bach
pdf   *
pdf   * Hent inn xml templaten
pdf   *
pdf  c                   callp     GetHTMLIFS(d_xmlm :'<AS400>')
6.27 c                   callp     ClrHtmlBuffer
pdf   *
pdf   * Finn hvor xml'en skal legges
pdf   *
pdf  c                   eval      XML_path = *blanks
pdf  c                   eval      XML_path = %trim(d_path)
pdf   *
pdf   * Finn path til logo
pdf   *
pdf  c                   eval      jasper_logo = *blanks
pdf  c                   eval      jasper_logo = %trim(d_logo)
pdf   *
pdf   * Jobbnummer er allerede generert i AP600R. Overføres i *lda
pdf   *
pdf   * Vi logger ar utskriftprogrammet har startet
pdf  c                   eval      w_jstat = 10
pdf  c                   eval      w_jtext = 'Utskrift av pakkseddel fra RT har+
pdf  c                                       startet'
pdf  c                   call      'AB705R'
pdf  c                   parm                    l_bach
pdf  c                   parm                    w_jstat
pdf  c                   parm                    w_jtext
pdf   * Vi skriver xml for miljø formater
pdf  c                   exsr      xml_envm
pdf  c                   eval      b_pdfp = *on
pdf   *
pdf  c                   endif
pdf   * Hvis et eller annet er galt med parametrene, logges og kjør uten PROA
pdf  c                   if        %trim(d_xmlm) = *blanks
pdf  c                   eval      b_pdfp = *off
pdf   * Vi logger at noe er galt med parametrene
pdf  c                   eval      w_jstat = 20
pdf  c                   eval      w_jtext = 'Finner ikke path til xml !!! +
pdf  c                             Sjekk rutineregister !'
pdf  c                   call      'AB705R'
pdf  c                   parm                    l_bach
pdf  c                   parm                    w_jstat
pdf  c                   parm                    w_jtext
pdf  c                   endif
pdf   *
pdf  c                   else
pdf  c                   eval      b_pdfp = *off
pdf  c                   endif
      *
pdf  c                   time                    w_date
      *
     C                   ENDSR
      *
