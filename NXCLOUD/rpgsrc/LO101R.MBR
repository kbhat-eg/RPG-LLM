     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  System. . . . . : ASLAGR
      *  Program . . . . : LO101R
      *  Beskrivelse . . : Registrering av Best./Innkjøp, Opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Spesialversjon. :
      *  Tilpasset for . :
      *
      *  Referanse  Dato   Endringsbeskrivelse                     Sign.
      *  --------- ------  ------------------------------------------------
      *  V5.50     200307  Lagt inn kontroll av lev. fakturanr.    KOB
      *  6.10      170609  Oppdatert med sporingsinformasjon       BSA
6.11  *   6.11     220911  Leveringsmåtetekst kom ikke med         AMD
6.20  *  6.20      151110  Fjernet prosjekt, akt.,konto og spes    NHO
      *                    Arb. ordre legges inn, oppdaterer også
      *                    underprosjekt og aktivitet
6.21  *  6.20      180412  Skal kunne endre fakturautsteder        bof
6.22  *  6.20      110113  Hvis per.utfylt, brukes test bilagsnr   bof
6.23  *  6.20 sst  181113  Rettet opp i logikk ver prosjekt(6.20)
6.30  *  6.30      290314  Ny kode for forsendelsesmåte bestilling bof
6.nu  *  6.30      280514  Endring vedr. nummerutvidelse           bof
6.31  *  6.30      160914  Endring av momskoder på linjenivå dersom
6.31  *                    ordrehodet endres fra pliktig til fritt
6.31  *                    eller motsatt.
6.32  *  6.30      300515  Legger prosjekt som input og F4.
6.33  *  6.30      040615  Fjerner arbeidsordre fra F10 bildet
6.34  *  6.30      231116  Ny mva håndtering.
6.35  *  6.30      140818  Lagt inn validring på endel felter som  bsa
6.35  *                    normalt kommer fra EDI.                 bsa
7.01  *  6.30  bsa 211116  Feil feilmedling blir kalt ved sjekk av lager +
7.01  *                    overlapping på skjermbildet. Fjernet felt.
7.xx  *  7.00  bsa 030316  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
7.02  *  6.30      090419  Hent avdeling fra lager hvis nyopprettet og
7.02  *                    lager avviker fra brukers default lager.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fanuml1    if   e           k disk    rename(anumpfr:anuml1r)
     flstsl1    if   e           k disk    rename(lstspfr:lstsl1r)
     flohel1    if   e           k disk    rename(lohepfr:lohel1r)
     flohelu    uf   e           k disk    rename(lohepfr:lohelur)
     fsihel1    if   e           k disk    rename(sihepfr:sihel1r)
5.50 frltrl7    if   e           k disk    rename(rltrpfr:rltrl7r)
6.31 fvmval1    if   e           k disk    rename(vmvapfr:vmval1r)
6.31 fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
6.31 fvltyl1    if   e           k disk    rename(vltypfr:vltyl1r)
6.31 flodtlu    uf   e           k disk    rename(lodtpfr:lodtlur)
6.35 frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
6.35 frp1pl1    if   e           k disk    rename(rp1ppfr:rp1pl1r)
6.35 fsihela    if   e           k disk    rename(sihepfr:sihelar)
     flo101d    cf   e             workstn
      *
      * Data struktur for leveringsbetingelse
      *
     d                 ds
     d d_lbtx                        75
     d  d_ltx1                       25    overlay(d_lbtx)
     d  d_ltx2                       25    overlay(d_lbtx:26)
     d  d_ltx3                       25    overlay(d_lbtx:51)
6.35  *
6.35 d                 ds
6.35 d d_bkida                       25
6.35 d  d_bk24                       24    overlay(d_bkida:1)
6.35 d  d_bk23                       23    overlay(d_bkida:1)
6.35 d  d_bk22                       22    overlay(d_bkida:1)
6.35 d  d_bk21                       21    overlay(d_bkida:1)
6.35 d  d_bk20                       20    overlay(d_bkida:1)
6.35 d  d_bk19                       19    overlay(d_bkida:1)
6.35 d  d_bk18                       18    overlay(d_bkida:1)
6.35 d  d_bk17                       17    overlay(d_bkida:1)
6.35 d  d_bk16                       16    overlay(d_bkida:1)
6.35 d  d_bk15                       15    overlay(d_bkida:1)
6.35 d  d_bk14                       14    overlay(d_bkida:1)
6.35 d  d_bk13                       13    overlay(d_bkida:1)
6.35 d  d_bk12                       12    overlay(d_bkida:1)
6.35 d  d_bk11                       11    overlay(d_bkida:1)
6.35 d  d_bk10                       10    overlay(d_bkida:1)
6.35 d  d_bk09                        9    overlay(d_bkida:1)
6.35 d  d_bk08                        8    overlay(d_bkida:1)
6.35 d  d_bk07                        7    overlay(d_bkida:1)
6.35 d  d_bk06                        6    overlay(d_bkida:1)
6.35 d  d_bk05                        5    overlay(d_bkida:1)
6.35 d  d_bk04                        4    overlay(d_bkida:1)
6.35 d  d_bk03                        3    overlay(d_bkida:1)
6.35 d  d_bk02                        2    overlay(d_bkida:1)
6.35 d  d_bk01                        1    overlay(d_bkida:1)
      *
      * Local Data Area
      *
     d                uds
     d  l_user               911    920
7.02 d l_filg                931    933
     d l_firm                944    946  0
     d l_fnav                951    980
7.02 d l_lage               1001   1002  0
      *
      * Definering av parametre
      *
     d p_stat          s              1
     d p_firm          s                   like(lofirm)
     d p_numm          s                   like(lonumm)
     d p_suff          s                   like(losuff)
6.35 d p_tall          s             24
6.35 d p_ksif          s              1  0
7.02 d p_nybe          s              1
      *
      * Definering av variable i nøkler
      *
     d anuml1_fast     s                   like(anfast)
     d anuml1_fell     s                   like(anfell)
     d anuml1_type     s                   like(antype)
     d lohelu_numm     s                   like(lonumm)
     d lohelu_suff     s                   like(losuff)
     d lohel1_numm     s                   like(lonumm)
     d lohel1_suff     s                   like(losuff)
     d sihel1_aarr     s                   like(shaarr)
     d sihel1_binr     s                   like(shbinr)
     d sihel1_numm     s                   like(shnumm)
     d sihel1_suff     s                   like(shsuff)
5.50 d rltrl7_levr     s                   like(rolevr)
5.50 d rltrl7_raar     s                   like(roraar)
5.50 d rltrl7_lfak     s                   like(rolfak)
6.31 d lodtlu_numm     s                   like(ldnumm)
6.31 d lodtlu_suff     s                   like(ldsuff)
6.31 d vvarl1_vare     s                   like(vvvare)
6.31 d vltyl1_ltyp     s                   like(valtyp)
6.31 d vmval1_mkod     s                   like(vamkod)
6.35 d rlevl1_levr     s                   like(rllevr)
6.35 d rp1pl1_1pro     s                   like(rp1pro)
6.35 d sihela_aarr     s                   like(shaarr)
6.35 d sihela_lena     s                   like(shlena)
      *
      * Definering av variable
      *
     d w_firm          s                   like(lofirm)
     d w_lage          s                   like(lolage)
     d w_text          s             20
     d w_adrs          s             30
     d w_ponr          s              4  0
     d w_pste          s             30
     d w_avde          s              4  0
     d w_feil          s              1
     d w_dato_alf      s             10
     d w_elag          s                   like(lolage)
     d w_cbda          s                   like(lobdat)
     d w_cfda          s                   like(loffda)
     d w_crab          s              4  2
     d w_ctx1          s                   like(c2btx1)
     d w_ctx2          s                   like(c2btx2)
     d w_gtxt          s                   like(c2avtx)
     d w_itxt          s                   like(c2intx)
     d w_jtxt          s                   like(c2latx)
6.32 d w_kont          s              5  0
6.20 d*w_ktx1          s                   like(c3kotx)
6.20 d*w_ktx2          s                   like(c3kotx)
6.20 d w_akti          s                   like(c3akti)
6.20 d w_proj          s                   like(c3proj)
6.20 d w_upro          s                   like(c3upro)
6.20 d w_ktx1          s                   like(c3prtx)
6.20 d w_ktx2          s                   like(c3prtx)
7.01 d w_prt1          s             30
     d w_pdat          s              8  0
     d w_pomr          s             10  6
     d w_ptxt          s                   like(c2vatx)
     d w_ptx1          s                   like(c3prtx)
     d w_ptx2          s                   like(c3prtx)
     d w_qtxt          s                   like(c2lmtx)
     d w_retk          s              1
     d w_rtx1          s                   like(c2ltx1)
     d w_rtx2          s                   like(c2ltx2)
     d w_rtx3          s                   like(c2ltx3)
6.32 d w_spes          s              4  0
6.20 d*w_akti          s              4  0
6.20 d*w_utxt          s                   like(c3aktx)
     d w_vtxt          s                   like(c2sptx)
6.nu d w_slut          s              8  0
6.nu d w_strt          s              8  0
6.35 d w_mld1          s             50
6.35 d w_mld2          s             50
6.35 d w_svar          s              1
6.35 d w_in12          s              1  0
6.35 d w_bkid          s             25
6.35 d w_ksif          s              1  0
6.35 d w_posi          s              2  0
6.35 d w_ffda          s                   like(shfkda)
6.35 d w_fada          s                   like(shfkda)
      *
6.35 d c_digi          s             15    inz('0123456789, ')
      *
6.35 d b_bkid          s              1    inz(*off)
      *
7.02 d u_s702          s              1    inz(*off)                            Skifte lager
7.02  *
7.02  * Definering av eksterne prg
7.02  *
7.02   dcl-s co402_verdi1  char(1);
7.02   dcl-s co402_verdi2  char(2048);
7.02   DCL-PR CO402R EXTPGM('CO402R');
7.02     p_filgrp            char(3)     const;
7.02     p_firm              packed(3:0) const;
7.02     p_lager             packed(2:0) const;
7.02     p_nokkel            char(50)    const;
7.02     p_verdi1            char(1);
7.02     p_verdi2            char(2048);
7.02   END-PR;
7.02  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  C2 Behandler vedlikehold av faste opplysninger - bilde 1
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     c2taga        tag
      *
      *  Hent opplysninger fra BESTILLINGS-HODE-REGISTER
      *
     c     lohel1_key    chain     lohel1r
B001 c                   if        %found
 001 c                   eval      c2mkod = lomkod
 001 c                   eval      c2avde = loavde
 001 c                   eval      c2innk = loinnk
 001 c                   eval      c2lage = lolage
 001 c                   eval      w_elag = lolage
 001 c                   eval      c2betb = lobetb
 001 c                   eval      c2valk = lovalk
 001 c                   eval      c2sped = losped
 001 c                   eval      c2lmat = lolmat
 001 c                   eval      c2lmtx = lolmtx
 001 c                   eval      c2lbet = lolbet
 001 c                   eval      d_lbtx = lolbtx
 001 c                   eval      c2ltx1 = d_ltx1
 001 c                   eval      c2ltx2 = d_ltx2
 001 c                   eval      c2ltx3 = d_ltx3
E001 c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Hent tekstopplysninger faste data
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   exsr      sbavde
     c                   exsr      sbinnk
     c                   exsr      sblagr
     c                   exsr      sbbetb
     c                   exsr      sbvalk
     c                   exsr      sbsped
6.11 c                   exsr      sbform
      *
     c                   eval      w_arow = 0
     c                   eval      w_acol = 0
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Behandler skjermbilde  C2
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Send alt
      *
     c     c2tagb        tag
     c                   exfmt     c2bld
      *
      *  F3=Avslutt subprogram
      *
B001 c                   if        *inkc = *on
 001 c                   eval      p_stat = '9'
 001 c                   goto      xslutt
E001 c                   endif
      *
      *  F4=Spørring
      *
B001 c                   if        *inkd = *on
 001 c                   exsr      sp_input
 001 c                   goto      c2tagb
E001 c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Behandler sjekking av opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Sjekk,  Finnes avdeling i KODE-REGISTER
      *
     c                   eval      c2avtx = *blank
B001 c                   if        c2avde <> 0
 001 c                   exsr      sbavde
B002 c                   if        w_retk <> *blank
 002 c                   move      *on           *in32
 002 c                   goto      c2tagb
E002 c                   endif
E001 c                   endif
      *
      *  Sjekk,  Finnes innkjøper i KODE-REGISTER
      *
     c                   eval      c2intx = *blank
B001 c                   if        c2innk <> 0
 001 c                   exsr      sbinnk
B002 c                   if        w_retk <> *blank
 002 c                   move      *on           *in33
 002 c                   goto      c2tagb
E002 c                   endif
E001 c                   endif
      *
      *  Sjekk,  Finnes lager i KODE-REGISTER
      *
     c                   exsr      sblagr
B001 c                   if        w_feil = *on
 001 c                   eval      *in34 = *on
 001 c                   goto      c2tagb
E001 c                   endif
      *
      *  Sjekk,  Finnes betalingsbetingelser i KODE-REGISTER
      *
     c                   eval      c2btx1 = *blank
     c                   eval      c2btx2 = *blank
B001 c                   if        c2betb <> 0
 001 c                   exsr      sbbetb
B002 c                   if        w_retk <> *blank
 002 c                   move      *on           *in35
 002 c                   goto      c2tagb
E002 c                   endif
E001 c                   endif
      *
      *  Sjekk,  Finnes valutakode i KODE-REGISTER
      *
     c                   eval      c2vatx = *blank
B001 c                   if        c2valk <> *blank
 001 c                   exsr      sbvalk
B002 c                   if        w_retk <> *blank
 002 c                   move      *on           *in36
 002 c                   goto      c2tagb
E002 c                   endif
E001 c                   endif
      *
      *  Sjekk,  Finnes speditør i KODE-REGISTER
      *
     c                   eval      c2sptx = *blank
B001 c                   if        c2sped <> 0
 001 c                   exsr      sbsped
B002 c                   if        w_retk <> *blank
 002 c                   move      *on           *in37
 002 c                   goto      c2tagb
E002 c                   endif
E001 c                   endif
      *
      *  Sjekk,  Finnes forsendelsesmåtekode i KODE-REGISTER
      *
B001 c                   if        c2lmat <> 0
B002 c                   if        c2lmat <> lolmat
 002 c                   exsr      sbform
B003 c                   if        w_retk <> *blank
 003 c                   move      *on           *in38
 003 c                   goto      c2tagb
E003 c                   endif
E002 c                   endif
E001 c                   endif
      *
      *  Sjekk,  Finnes leveringsbetingelseskode i KODE-REGISTER
      *
B001 c                   if        c2lbet <> 0
B002 c                   if        c2lbet <> lolbet
 002 c                   exsr      sblevb
B003 c                   if        w_retk <> *blank
 003 c                   move      *on           *in40
 003 c                   goto      c2tagb
E003 c                   endif
E002 c                   endif
E001 c                   endif
      *
      *  Dersom noen valg er endret, sendt bilde pånytt
      *
B001 c                   if        c2avde <> loavde
 001 c                             or c2innk <> loinnk
 001 c                             or c2lage <> lolage
 001 c                             or c2betb <> lobetb
 001 c                             or c2valk <> lovalk
 001 c                             or c2sped <> losped
 001 c                             or c2lmat <> lolmat
 001 c                             or c2lbet <> lolbet
 001 c                   eval      loavde = c2avde
 001 c                   eval      loinnk = c2innk
 001 c                   eval      lolage = c2lage
 001 c                   eval      lobetb = c2betb
 001 c                   eval      lovalk = c2valk
 001 c                   eval      losped = c2sped
 001 c                   eval      lolmat = c2lmat
 001 c                   eval      lolbet = c2lbet
 001 c                   goto      c2tagb
E001 c                   endif
6.31  * Sjekk om momskode på ordrehodet er endret
6.31 c                   if        c2mkod <> lomkod
6.31 c                   exsr      endr_mva
6.31 c                   endif
      *
      *  Oppdaterer BESTILLINGS-HODE-REGISTER
      *
     c     lohelu_key    chain     lohelur
B001 c                   if        %found
 001 c                   eval      lomkod = c2mkod
 001 c                   eval      loavde = c2avde
 001 c                   eval      loinnk = c2innk
 001 c                   eval      lolage = c2lage
 001 c                   eval      lobetb = c2betb
 001 c                   eval      lovalk = c2valk
 001 c                   eval      losped = c2sped
 001 c                   eval      lolmat = c2lmat
 001 c                   eval      lolmtx = c2lmtx
 001 c                   eval      lolbet = c2lbet
 001 c                   eval      d_ltx1 = c2ltx1
 001 c                   eval      d_ltx2 = c2ltx2
 001 c                   eval      d_ltx3 = c2ltx3
 001 c                   eval      lolbtx = d_lbtx
6.10 c                   time                    loedat
6.10 c                   time                    loetim
6.10 c                   eval      loeusr = l_user
 001 c                   update    lohelur
E001 c                   endif
      *
      *
B001 c                   if        lolage <> w_elag
 001 c                   call      'LO732R'
 001 c                   parm                    w_firm
 001 c                   parm                    lohel1_numm
 001 c                   parm                    lohel1_suff
 001 c                   parm                    lootyp
 001 c                   parm                    w_elag
E001 c                   endif
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  C3 Behandler vedlikehold av faste opplysninger - bilde 2
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     c3taga        tag
      *
      *  Hent opplysninger fra BESTILLINGS-HODE-REGISTER
      *
     c                   eval      c3fkda = 0
     c                   eval      c3ffda = 0
      *
     c     lohel1_key    chain     lohel1r
B001 c                   if        %found
 001  *
B002 c                   if        lofkda <> *loval
 002 c     *dmy          move      lofkda        c3fkda
E002 c                   endif
 001  *
B002 c                   if        loffda <> *loval
 002 c     *dmy          move      loffda        c3ffda
E002 c                   endif
 001  *
 001 c                   movel     lobitx        c3bitx
 002 c                   move      loperi        c3peri
 001 c                   eval      c3binr = lobinr
 001 c                   eval      c3bkid = lokidi
 001 c                   eval      c3totf = lototf
 001 c                   eval      c3kref = lokref
6.20 c**                 eval      c3upro = loupro
6.33 c**                 eval      c3arbo = loarbo
6.20 c**                 eval      c3proj = loproj
6.23 c                   eval      c3proj = loproj
6.20 c**                 eval      c3akti = loakti
6.23 c                   eval      c3akti = loakti
6.20 c**                 eval      c3kont = lokont
6.20 c**                 eval      c3spes = lospes
 001 c                   eval      c3flev = loflev
 001 c                   eval      c3sfak = losfak
 001 c                   eval      c3flow = loflow
E001 c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Behandler henting av opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Hent,   Tekst for prosjekt
      *
6.20 c**                 exsr      sbproj
6.23 c                   if        c3proj <> *blank
6.23 c                   exsr      sbproj
6.23 c                   endif
6.33 c**                 if        c3arbo <> *blank
6.33 c                   if        1 = 2
6.20 c                   exsr      sbarbo
6.23 c                   endif
6.20  **
6.20  ** Hent,   Tekst for aktivitet
6.20  **
6.20 c**                 exsr      sbakti
      *
6.20  ** Hent,   Tekst for konto
6.20  **
6.20 c**                 exsr      sbkont
6.20  **
6.20  ** Hent,   Tekst for kostnadsbærer
6.20  **
6.20 c**                 exsr      sbspes
6.20  **
6.20 c**                 eval      w_arow = 0
6.20 c**                 eval      w_acol = 0
6.20  **
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Behandler skjermbilde  C3
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Send alt
      *
     c     c3tagb        tag
     c                   exfmt     c3bld
      *
      *  F3=Gå tilbake til forrige bilde
      *
     c                   if        *inkc = *on
     c                   goto      c2taga
     c                   endif
      *
      *  F4=Spørring
      *
B001 c                   if        *inkd = *on
 001 c                   exsr      sp_input
 001 c                   goto      c3tagb
E001 c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Behandler sjekking av opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Sjekk,  Er bilagsnummer utfylt
      *
B001 c                   if        c3binr < w_strt
B002 c                   if        c3binr > w_slut
 002 c                   move      *on           *in30
 002 c                   goto      c3tagb
E002 c                   endif
E001 c                   endif
      *
      *  Sjekk,  Er bilagsnummer brukt før.
      *
6.22 c                   if        c3peri <> 0
6.22 c                   move      c3peri        sihel1_aarr
6.22 c                   movel     20            sihel1_aarr
6.22 c                   else
     c                   move      lodate        w_dato_alf
     c                   movel     w_dato_alf    sihel1_aarr
6.22 c                   endif
     c                   eval      sihel1_binr = c3binr
     c                   z-add     0             sihel1_numm
     c                   z-add     0             sihel1_suff
      *
     c     sihel1_key    setll     sihel1
     c                   read      sihel1                                 61
     c     *in61         cabeq     *on           binok
     c     shfirm        cabne     w_firm        binok
     c     shaarr        cabne     sihel1_aarr   binok
     c     shbinr        cabne     sihel1_binr   binok
      *
     c                   move      *on           *in38
     c                   goto      c3tagb
      *
     c     binok         tag
5.50  *
5.50  * Er leverandørens fakturanummer brukt før ?
5.50  *
5.50 c                   if        c3sfak <> *blank
5.50  *
5.50 c                   eval      rltrl7_levr = loldor
5.50 c                   eval      rltrl7_raar = *year
5.50 c                   eval      rltrl7_lfak = c3sfak
5.50 c     rltrl7_key    chain     rltrl7
5.50  *
5.50 c                   if        %found
5.50 c                   move      *on           *in55
5.50 c                   goto      c3tagb
5.50 c                   endif
5.50  *
5.50 c                   endif
6.35  *
6.35  *  Sjekk,  Er dette gyldig KID nummer ?
6.35  *
6.35 c                   if        %trim(c3bkid) <> *blanks
6.35 c                   eval      w_bkid = %trim(c3bkid)
6.35  *  Må være kun numerisk eller blanke
6.35 c                   eval      b_bkid = *off
6.35 c                   if        %check(c_digi : w_bkid) > *zero
6.35 c**                 leavesr
6.35 c                   else
6.35 c                   eval      b_bkid = *on
6.35 c                   endif
6.35  *  Beregn moduluskontroll - sjekkes mot tallet
6.35 c                   if        b_bkid = *on
6.35 c                   eval      w_posi = %len(%trim(w_bkid))
6.35 c                   eval      d_bkida = %trim(w_bkid)
6.35 c                   if        w_posi = 25
6.35 c                   move      d_bk24        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:25:1))
6.35 c                   elseif    w_posi = 24
6.35 c                   move      d_bk23        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:24:1))
6.35 c                   elseif    w_posi = 23
6.35 c                   move      d_bk22        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:23:1))
6.35 c                   elseif    w_posi = 22
6.35 c                   move      d_bk21        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:22:1))
6.35 c                   elseif    w_posi = 21
6.35 c                   move      d_bk20        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:21:1))
6.35 c                   elseif    w_posi = 20
6.35 c                   move      d_bk19        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:20:1))
6.35 c                   elseif    w_posi = 19
6.35 c                   move      d_bk18        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:19:1))
6.35 c                   elseif    w_posi = 18
6.35 c                   move      d_bk17        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:18:1))
6.35 c                   elseif    w_posi = 17
6.35 c                   move      d_bk16        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:17:1))
6.35 c                   elseif    w_posi = 16
6.35 c                   move      d_bk15        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:16:1))
6.35 c                   elseif    w_posi = 15
6.35 c                   move      d_bk14        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:15:1))
6.35 c                   elseif    w_posi = 14
6.35 c                   move      d_bk13        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:14:1))
6.35 c                   elseif    w_posi = 13
6.35 c                   move      d_bk12        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:13:1))
6.35 c                   elseif    w_posi = 12
6.35 c                   move      d_bk11        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:12:1))
6.35 c                   elseif    w_posi = 11
6.35 c                   move      d_bk10        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:11:1))
6.35 c                   elseif    w_posi = 10
6.35 c                   move      d_bk09        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:10:1))
6.35 c                   elseif    w_posi = 9
6.35 c                   move      d_bk08        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:9:1))
6.35 c                   elseif    w_posi = 8
6.35 c                   move      d_bk07        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:8:1))
6.35 c                   elseif    w_posi = 7
6.35 c                   move      d_bk06        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:7:1))
6.35 c                   elseif    w_posi = 6
6.35 c                   move      d_bk05        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:6:1))
6.35 c                   elseif    w_posi = 5
6.35 c                   move      d_bk04        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:5:1))
6.35 c                   elseif    w_posi = 4
6.35 c                   move      d_bk03        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:4:1))
6.35 c                   elseif    w_posi = 3
6.35 c                   move      d_bk02        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:3:1))
6.35 c                   elseif    w_posi = 2
6.35 c                   move      d_bk01        p_tall
6.35 c                   eval      w_ksif = %int(%subst(d_bkida:2:1))
6.35 c                   endif
6.35  *
6.35 c                   call      'AK720R'
6.35 c                   parm                    p_tall
6.35 c                   parm                    p_ksif
6.35  *
6.35 c                   if        w_ksif <> %int(p_ksif)
6.35 c                   eval      b_bkid = *off
6.35 c                   endif
6.35  *
6.35 c                   endif
6.35  *
6.35 c                   if        b_bkid = *off
6.35 c                   eval      w_mld1 = 'KID nummer er ikke gyldig !'
6.35 c                   eval      w_mld2 = 'Skal dette aksepteres ?          '
6.35 c                   eval      w_svar = 'N'
6.35 c                   call      'AA007R'
6.35 c                   parm                    w_mld1
6.35 c                   parm                    w_mld2
6.35 c                   parm                    w_svar
6.35 c                   parm                    w_in12
6.35 c                   if        w_in12 = 1 or
6.35 c                             w_svar = 'N'
6.35 c                   goto      c3tagb
6.35 c                   endif
6.35 c                   endif
6.35  *
6.35 c                   endif
      *
      *  Sjekk,  Fakturadato
      *
B001 c                   if        c3fkda <> 0
 001 c     *dmy          test(d)                 c3fkda                 31
B002 c                   if        *in31 = *on
 002 c                   goto      c3tagb
6.35 c                   else
6.35 c     *dmy          move      c3fkda        w_fada
E002 c                   endif
E001 c                   endif
      *
      *  Sjekk,  Forfallsdato
      *
B001 c                   if        c3ffda <> 0
 001 c     *dmy          test(d)                 c3ffda                 32
B002 c                   if        *in32 = *on
 002 c                   goto      c3tagb
6.35 c                   else
6.35 c     *dmy          move      c3ffda        w_ffda
E002 c                   endif
E001 c                   endif
6.35  *
6.35  *  Sjekk,  Hvis fakturadato er større enn forfallsdato gi varsel
6.35  *
6.35 c                   if        w_fada > w_ffda
6.35 c                   eval      w_mld1 = 'Fakturadato er senere enn forfall'
6.35 c                   eval      w_mld2 = 'Skal dette aksepteres ?          '
6.35 c                   eval      w_svar = 'N'
6.35 c                   call      'AA007R'
6.35 c                   parm                    w_mld1
6.35 c                   parm                    w_mld2
6.35 c                   parm                    w_svar
6.35 c                   parm                    w_in12
6.35 c                   if        w_in12 = 1 or
6.35 c                             w_svar = 'N'
6.35 c                   goto      c3tagb
6.35 c                   endif
6.35 c                   endif
6.35  *
6.35  *  Sjekk,  Er angitt fakturautsteder gyldig ihht leverandøregister
6.35  *
6.35 c                   if        c3flev <> 0
6.35 c                   eval      rlevl1_levr = c3flev
6.35 c     rlevl1_key    chain     rlevl1
6.35 c                   if        not %found
6.35 c                   eval      w_mld1 = 'Fakturautsteder finnes ikke i leve-
6.35 c                             randørregister !'
6.35 c                   eval      w_mld2 = 'Skal dette aksepteres ?          '
6.35 c                   eval      w_svar = 'J'
6.35 c                   call      'AA007R'
6.35 c                   parm                    w_mld1
6.35 c                   parm                    w_mld2
6.35 c                   parm                    w_svar
6.35 c                   parm                    w_in12
6.35  *
6.35 c                   if        w_in12 = 1 or
6.35 c                             w_svar = 'N'
6.35 c                   goto      c3tagb
6.35 c                   endif
6.35 c                   endif
6.35 c                   endif
6.35  *
6.35  *  Sjekk,  Er angitt fakturanummer benyttet tidligere på denne leverandøren ?
6.35  *
6.35 c                   if        %trim(c3sfak) <> *blanks
6.35 c                   eval      sihela_aarr = %subdt(lobdat:*years)
6.35 c                   eval      sihela_lena = lolena
6.35 c     sihela_key    setll     sihela
6.35 c     sihela_key    reade     sihela
6.35 c                   dow       not %eof
6.35 c                   if        %trim(shlfnr) = %trim(c3sfak)
6.35 c                   eval      w_mld1 = 'Fakturanunmmer registrert tidlige-
6.35 c                             re på leverandør !'
6.35 c                   eval      w_mld2 = 'Skal dette aksepteres ?          '
6.35 c                   eval      w_svar = 'J'
6.35 c                   call      'AA007R'
6.35 c                   parm                    w_mld1
6.35 c                   parm                    w_mld2
6.35 c                   parm                    w_svar
6.35 c                   parm                    w_in12
6.35  *
6.35 c                   if        w_in12 = 1 or
6.35 c                             w_svar = 'N'
6.35 c                   goto      c3tagb
6.35 c                   endif
6.35 c                   endif
6.35 c     sihela_key    reade     sihela
6.35 c                   enddo
6.35 c                   endif
      *
      *  Sjekk,  Finnes prosjekt i KONTO-REGISTER
      *
6.35  *  Ny sjekk mot gyldig prosjekt
6.35 c                   if        %trim(c3proj) <> *blanks
6.35 c                   eval      rp1pl1_1pro = c3proj
6.35 c     rp1pl1_key    chain     rp1pl1
6.35 c                   if        not %found
6.35 c                   eval      w_mld1 = 'Prosjektnummer er ikke gyldig !'
6.35 c                   eval      w_mld2 = 'Skal dette aksepteres ?          '
6.35 c                   eval      w_svar = 'J'
6.35 c                   call      'AA007R'
6.35 c                   parm                    w_mld1
6.35 c                   parm                    w_mld2
6.35 c                   parm                    w_svar
6.35 c                   parm                    w_in12
6.35  *
6.35 c                   if        w_in12 = 1 or
6.35 c                             w_svar = 'N'
6.35 c                   goto      c3tagb
6.35 c                   endif
6.35 c                   endif
6.35  *
6.35 c                   endif
      *
     c                   eval      c3prtx = *blank
6.20 c**                 if        c3proj <> 0
6.33 c**                 if        c3arbo <> *blank
6.35 c                   if        1 = 2
6.20 c**                 if        c3proj <> loproj
6.20 c**                 if        c3upro <> loupro
6.33 c**                 if        c3arbo <> loarbo
 002 c**                 exsr      sbproj
6.23 c                   exsr      sbproj
6.35 c**                 exsr      sbarbo
B003 c                   if        w_retk <> *blank
 003 c                   move      *on           *in34
 003 c                   goto      c3tagb
E003 c                   endif
6.33 c**                 endif
6.35 c                   endif
      *
6.20  ** Sjekk,  Finnes aktivitet i KODE-REGISTER
6.20  **
6.20 c**                 eval      c3aktx = *blank
6.20 c**                 if        c3akti <> *blank
6.20 c**                 if        c3akti <> loakti
6.20 c**                 exsr      sbakti
6.20 c**                 if        w_retk <> *blank
6.20 c**                 move      *on           *in35
6.20 c**                 goto      c3tagb
6.20 c**                 endif
6.20 c**                 endif
6.20 c**                 endif
      *
      *  Sjekk,  Finnes konto i KONTO-REGISTER
      *
6.20 c**                 eval      c3kotx = *blank
6.20 c**                 if        c3kont <> 0
6.20 c**                 if        c3kont <> lokont
6.20 c**                 exsr      sbkont
6.20 c**                 if        w_retk <> *blank
6.20 c**                 move      *on           *in36
6.20 c**                 goto      c3tagb
6.20 c**                 endif
6.20 c**                 endif
6.20 c**                 endif
      *
      *  Oppdaterer BESTILLINGS-HODE-REGISTER
      *
     c     lohelu_key    chain     lohelur
B001 c                   if        %found
 001  *
 001 c                   eval      lofkda = *loval
 001 c                   eval      loffda = *loval
 001  *
B002 c                   if        c3fkda <> 0
 002 c     *dmy          move      c3fkda        lofkda
E002 c                   endif
 001  *
B002 c                   if        c3ffda <> 0
 002 c     *dmy          move      c3ffda        loffda
E002 c                   endif
 001  *
 001 c                   eval      lobinr = c3binr
 001 c                   eval      lobitx = c3bitx
 001 c                   eval      lokidi = c3bkid
 001 c                   eval      lobitx = c3bitx
 001 c                   eval      lototf = c3totf
 001 c                   eval      lokref = c3kref
     c                   eval      loproj = c3proj
6.33 c**                 eval      loarbo = c3arbo
6.33 c                   eval      loarbo = *blanks
     c                   eval      loakti = c3akti
6.20 c**                 eval      loupro = c3upro
6.20 c**                 eval      lokont = c3kont
6.20 c**                 eval      lospes = c3spes
6.21 c                   eval      loflev = c3flev
 001 c                   eval      losfak = c3sfak
 001 c                   eval      loflow = c3flow
 002 c                   move      c3peri        loperi
6.10 c                   time                    loedat
6.10 c                   time                    loetim
6.10 c                   eval      loeusr = l_user
 001 c                   update    lohelur
E001 c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Spørring på inputfelter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sp_input      begsr
      *
      *  Spørring på bilde 1
      *
     c                   if        w_arcd = 'C2BLD'
      *
      *  Spørring på avdeling
      *
     c                   if        w_afld = 'C2AVDE'
     c                   call      'RA507R'
     c                   parm                    w_firm
     c                   parm                    c2avde
     c                   parm                    c2avtx
     c                   goto      end_sp
     c                   endif
      *
      *  Spørring på innkjøper (selger)
      *
     c                   if        w_afld = 'C2INNK'
     c                   call      'RA509R'
     c                   parm                    w_firm
     c                   parm                    c2innk
     c                   parm                    c2intx
     c                   goto      end_sp
     c                   endif
      *
      *  Spørring på lager
      *
     c                   if        w_afld = 'C2LAGE'
     c                   call      'RA510R'
     c                   parm                    w_firm
     c                   parm                    c2lage
     c                   parm                    c2latx
     c                   goto      end_sp
     c                   endif
      *
      *  Spørring på betalingsbetingelse
      *
     c                   if        w_afld = 'C2BETB'
     c                   call      'RA503R'
     c                   parm                    w_firm
     c                   parm                    c2betb
     c                   parm                    c2btx1
     c                   eval      c2btx2 = *blank
     c                   goto      end_sp
     c                   endif
      *
      *  Spørring på valuta
      *
     c                   if        w_afld = 'C2VALK'
     c                   call      'RA516R'
     c                   parm                    w_firm
     c                   parm                    c2valk
     c                   parm                    c2vatx
     c                   goto      end_sp
     c                   endif
      *
      *  Spørring på speditør
      *
     c                   if        w_afld = 'C2SPED'
     c                   call      'RA522R'
     c                   parm                    w_firm
     c                   parm                    c2sped
     c                   parm                    c2sptx
     c                   goto      end_sp
     c                   endif
      *
      *  Spørring på forsendelsemåte
      *
     c                   if        w_afld = 'C2LMAT'
6.30 c                   call      'RA533R'
     c                   parm                    w_firm
     c                   parm                    c2lmat
     c                   parm                    c2lmtx
     c                   goto      end_sp
     c                   endif
      *
      *  Spørring på leveringsbetingelse
      *
     c                   if        w_afld = 'C2LBET'
     c                   call      'RA518R'
     c                   parm                    w_firm
     c                   parm                    c2lbet
     c                   parm                    c2ltx1
     c                   eval      c2ltx2 = *blank
     c                   eval      c2ltx3 = *blank
     c                   goto      end_sp
     c                   endif
     c                   endif
      *
      *  Spørring på bilde 2
      *
     c                   if        w_arcd = 'C3BLD'
      *
      *  Spørring på fakturaleverandør
      *
     c                   if        w_afld = 'C3FLEV'
     c                   call      'RL500R'
     c                   parm                    w_firm
     c                   parm                    c3flev
     c                   parm                    c3flna
     c                   goto      end_sp
     c                   endif
      *
      *  Spørring på prosjekt
      *
6.32 c                   if        w_afld = 'C3PROJ'
6.32 c                   call      'RP500R'
6.32 c                   parm                    w_firm
6.32 c                   parm                    c3proj
6.32 c                   parm                    w_akti
6.32 c                   parm                    w_kont
6.32 c                   parm                    w_spes
6.32 c                   parm                    c3prtx
6.32 c                   goto      end_sp
6.32 c                   endif
      *
6.33  *  Spørring på Arb.ordre
6.33  *
6.33 c*                  if        w_afld = 'C3ARBO'
6.33 c*                  call      'RP602R'
6.33 c*                  parm                    w_firm
6.33 c*                  parm                    c3arbo
6.33 c*                  goto      end_sp
6.33 c*                  endif
      *
6.20  ** Spørring på aktivitet
6.20  **
6.20 c**                 if        w_afld = 'C3AKTI'
6.20 c**                 call      'RA521R'
6.20 c**                 parm                    w_firm
6.20 c**                 parm                    c3akti
6.20 c**                 parm                    c3aktx
6.20 c**                 goto      end_sp
6.20 c**                 endif
      *
      *  Spørring på konto
      *
6.20 c**                 if        w_afld = 'C3KONT'
6.20 c**                 call      'RH500R'
6.20 c**                 parm                    w_firm
6.20 c**                 parm                    c3kont
6.20 c**                 parm                    w_spes
6.20 c**                 parm                    w_avde
6.20 c**                 parm                    c3kotx
6.20 c**                 goto      end_sp
6.20 c**                 endif
      *
      *  Spørring på kostnadsbærer
      *
6.20 c**                 if        w_afld = 'C3SPES'
6.20 c**                 call      'RA528R'
6.20 c**                 parm                    w_firm
6.20 c**                 parm                    c3spes
6.20 c**                 parm                    c3sptx
6.20 c**                 goto      end_sp
6.20 c**                 endif
     c                   endif
      *
     c     end_sp        endsr
      *
6.31  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.31  * Endring av mva-kode på linje-nivå
6.31  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.31  *
6.31 c     endr_mva      begsr
6.31  *
6.31 c                   eval      lodtlu_numm = lonumm
6.31 c                   eval      lodtlu_suff = losuff
6.31  *
6.31 c     lodtlu_key    setll     lodtlu
6.31 c     lodtlu_key    reade     lodtlu
6.31 c                   dow       not %eof
6.31  *
6.31  * Behandler ikke tekstlinjer
6.31  *
6.31 c                   eval      vltyl1_ltyp = ldltyp
6.31 c     vltyl1_key    chain     vltyl1
6.31  *
6.31 c                   if        valktx <> 0
6.31 c                   goto      neste_linje
6.31 c                   endif
6.31  *
6.31  * Oppslag på vareregister
6.31  *
6.31 c                   eval      vvarl1_vare = ldvare
6.31 c     vvarl1_key    chain     vvarl1
6.31  *
6.31  * Endring av momskode på linjenivå
6.31  *
6.31 c                   if        c2mkod = 1
6.31 c                   eval      ldomva = '0'
6.31 c                   else
6.34 c                   if        c2mkod = 2
6.34 c                   eval      vmval1_mkod = vvkmva
6.34 c     vmval1_key    chain     vmval1
6.34 c                   if        %found
6.34 c                   eval      ldomva = vamkui
6.34 c                   endif
6.34 c                   else
6.31  * Sjekk evnt overstyring fra varen
6.31 c                   eval      vmval1_mkod = vvkmva
6.31 c     vmval1_key    chain     vmval1
6.31 c                   if        %found
6.31 c                   eval      ldomva = vamkla
6.31 c                   else
6.31 c                   eval      ldomva = '1'
6.31 c                   select
6.31 c                   when      vvkmva = 1
6.31 c                   eval      ldomva = '0'
6.31 c                   when      vvkmva = 2
6.31 c                   eval      ldomva = 'I'
6.31 c                   when      vvkmva = 3
6.31 c                   eval      ldomva = 'K'
6.31 c                   endsl
6.31 c                   endif
6.34 c                   endif
6.31 c                   endif
6.31  *
6.31 c                   time                    ldedat
6.11 c                   time                    ldetim
6.31 c                   eval      ldeusr = l_user
6.31 c                   update    lodtlur
6.31  *
6.31 c     neste_linje   tag
6.31  *
6.31 c     lodtlu_key    reade     lodtlu
6.31 c                   enddo
6.31  *
6.31 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Sjekk/Hent tekst for kontonummer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.20 c**   sbkont        begsr
6.20  **
6.20 c**                 z-add     c3kont        w_kont
6.20 c**                 call      'RS740R'
6.20 c**                 parm                    w_retk
6.20 c**                 parm                    w_kont
6.20 c**                 parm                    c3spes
6.20 c**                 parm                    loavde
6.20 c**                 parm                    w_ktx1
6.20  **
6.20 c**                 eval      c3kotx = *blank
6.20  **
6.20 c**                 if        w_retk = *blank
6.20 c**                 movel     w_ktx1        c3kotx
6.20 c**                 endif
6.20  **
6.20 c**                 endsr
6.20  **
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Sjekk/Hent tekst for kostnadsbærer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.20 c**   sbspes        begsr
6.20  **
6.20 c**                 call      'RS728R'
6.20 c**                 parm                    w_retk
6.20 c**                 parm                    c3spes
6.20 c**                 parm                    c3sptx
6.20  **
6.20 c**                 if        w_retk <> *blank
6.20 c**                 movel     *blank        c3sptx
6.20 c**                 endif
6.20  **
6.20 c**                 endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Sjekk/Hent tekst for prosjekt
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.20 c**   sbproj        begsr
      *
6.20 c**                 eval      w_kont = 0
6.20 c**                 eval      w_spes = 0
6.20  **
6.20 c**                 call      'RS770R'
6.20 c**                 parm                    w_retk
6.20 c**                 parm                    c3proj
6.20 c**                 parm                    c3akti
6.20 c**                 parm                    w_kont
6.20 c**                 parm                    w_spes
6.20 c**                 parm                    w_ptx1
6.20 c**                 parm                    w_ptx2
6.20  **
6.20 c**                 eval      c3prtx = *blank
6.20  **
6.20 c**                 if        w_retk = *blank
6.20 c**                 movel     w_ptx1        c3prtx
6.20 c**                 endif
6.20  **
6.20 c**                 endsr
6.23 c     sbproj        begsr
6.23  *
6.23 c                   call      'RS880R'
6.23 c                   parm                    w_retk
6.23 c                   parm                    c3proj
6.23 c                   parm                    c3upro
6.23 c                   parm                    w_ptx1
6.23 c                   parm                    w_ptx2
6.23  *
6.23 c                   eval      c3prtx = *blank
7.01 c*                  eval      c3prt1 = *blank
6.23  *
6.23 c                   if        w_retk =  *blank
6.23 c                   if        w_ptx1 <> *blank
7.01 c*                  movel     w_ptx1        c3prt1
6.23 c                   endif
6.23 c                   if        w_ptx2 <> *blank
6.23 c                   movel     w_ptx2        c3prtx
rp s c                   endif
rp s c                   endif
6.23  *
6.23 c                   endsr
6.20 c
6.20  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.20  *  Sjekk/Hent tekst for arbeidsordre
6.20  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.20 c     sbarbo        begsr
6.20  *
6.20 c                   eval      w_proj = *blanks
6.20 c                   eval      w_upro = *blanks
6.20 c                   eval      w_akti = *blanks
6.20  **
6.20 c                   call      'RS882R'
6.20 c                   parm                    w_retk
6.33 c*                  parm                    c3arbo
6.20 c                   parm                    w_proj
6.20 c                   parm                    w_upro
6.20 c                   parm                    w_akti
6.20 c                   parm                    w_ptx1
6.20 c                   parm                    w_ptx2
6.20 c                   parm                    w_prt1
6.20  **
6.20 c                   eval      c3prtx = *blank
6.20  **
6.20 c                   if        w_retk = *blank
6.20 c                   movel     w_ptx1        c3prtx
6.20 c                   movel     w_proj        c3proj
6.20 c                   movel     w_upro        c3upro
6.20 c                   movel     w_akti        c3akti
7.01 c*                  movel     w_prt1        c3prt1
6.20 c                   endif
6.20  **
6.20 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Sjekk/Hent tekst for betalingsbetigelser
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbbetb        begsr
      *
     c                   call      'FÅ703R'
     c                   parm                    w_firm
     c                   parm                    c2betb
     c                   parm                    w_cbda
     c                   parm                    w_retk
     c                   parm                    w_cfda
     c                   parm                    w_ctx1
     c                   parm                    w_ctx2
      *
     c                   eval      c2btx1 = *blank
     c                   eval      c2btx2 = *blank
      *
B001 c                   if        w_retk = *blank
 001 c                   movel     w_ctx1        c2btx1
 001 c                   movel     w_ctx2        c2btx2
E001 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Sjekk/Hent tekst for avdeling
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbavde        begsr
      *
     c                   eval      c2avtx = *blank
     c                   call      'RS707R'
     c                   parm                    w_retk
     c                   parm                    c2avde
     c                   parm                    w_gtxt
     c                   eval      c2avtx = *blank
      *
B001 c                   if        w_retk = *blank
 001 c                   movel     w_gtxt        c2avtx
E001 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Sjekk/Hent tekst for innkjøper
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbinnk        begsr
      *
     c                   call      'RS709R'
     c                   parm                    w_retk
     c                   parm                    c2innk
     c                   parm                    w_itxt
      *
     c                   eval      c2intx = *blank
      *
B001 c                   if        w_retk = *blank
 001 c                   movel     w_itxt        c2intx
E001 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Sjekk/Hent tekst for lager
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sblagr        begsr
      *
     c                   eval      w_lage = c2lage
      *
     c                   call      'FÅ720R'
     c                   parm                    w_firm
     c                   parm                    w_lage
     c                   parm                    w_text
     c                   parm                    w_adrs
     c                   parm                    w_ponr
     c                   parm                    w_pste
     c                   parm                    w_avde
     c                   parm                    w_feil
      *
     c                   eval      c2latx = *blank
      *
B001 c                   if        w_feil = *off
 001 c                   eval      c2latx = w_text
E001 c                   endif
7.02  *
7.02  * Hent avdeling fra overstyrt lager, hvis nyopprettelse
7.02 c                   if        u_s702 = *on
7.02 c                   if        p_nybe = '1' and
7.02 c                             c2lage <> l_lage and
7.02 c                             l_lage <> 0
7.02 c                   eval      c2avde = w_avde
7.02 c                   exsr      sbavde
7.02 c                   endif
7.02 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Sjekk/Hent tekst for valuta
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbvalk        begsr
      *
     c                   call      'RS716R'
     c                   parm                    w_retk
     c                   parm                    c2valk
     c                   parm                    w_ptxt
      *
     c                   eval      c2vatx = *blank
      *
B001 c                   if        w_retk = *blank
 001 c                   movel     w_ptxt        c2vatx
E001 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Sjekk/Hent tekst for forsendelsesmåte
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbform        begsr
      *
6.30 c                   call      'RS731R'
     c                   parm                    w_retk
     c                   parm                    c2lmat
     c                   parm                    w_qtxt
      *
     c                   eval      c2lmtx = *blank
      *
B001 c                   if        w_retk = *blank
 001 c                   movel     w_qtxt        c2lmtx
E001 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Sjekk/Hent tekst for leveringsbetingelse
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sblevb        begsr
      *
     c                   call      'RS718R'
     c                   parm                    w_retk
     c                   parm                    c2lbet
     c                   parm                    w_rtx1
     c                   parm                    w_rtx2
     c                   parm                    w_rtx3
      *
     c                   eval      c2ltx1 = *blank
     c                   eval      c2ltx2 = *blank
     c                   eval      c2ltx3 = *blank
      *
B001 c                   if        w_retk = *blank
 001 c                   movel     w_rtx1        c2ltx1
 001 c                   movel     w_rtx2        c2ltx2
 001 c                   movel     w_rtx3        c2ltx3
E001 c                   endif
      *
     c                   endsr
      *
6.20  **- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.20  ** Sjekk/Hent tekst for aktivitet
6.20  **- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.20  **
6.20 c**   sbakti        begsr
6.20  **
6.20 c**                 call      'RS721R'
6.20 c**                 parm                    w_retk
6.20 c**                 parm                    c3akti
6.20 c**                 parm                    w_utxt
6.20  **
6.20  **
6.20 c**                 eval      c3aktx = *blank
6.20  **
6.20 c**                 if        w_retk = *blank
6.20 c**                 movel     w_utxt        c3aktx
6.20 c**                 endif
6.20  **
6.20 c**                 endsr
6     *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Sjekk/Hent tekst for speditør
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sbsped        begsr
      *
     c                   call      'RS722R'
     c                   parm                    w_retk
     c                   parm                    c2sped
     c                   parm                    w_vtxt
      *
     c                   eval      c2sptx = *blank
      *
B001 c                   if        w_retk = *blank
 001 c                   movel     w_vtxt        c2sptx
E001 c                   endif
      *
     c                   endsr
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      *  Nullstilling av felter som ikke kan redefineres
      *
     c                   eval      w_retk = *blank
     c                   eval      p_stat = *blank
     c                   eval      w_dato_alf = *blank
      *
6.20 c**                 eval      w_kont = 0
      *
6.20 c**                 eval      w_spes = 0
     c                   eval      w_crab = 0
     c                   eval      w_pdat = 0
     c                   eval      w_pomr = 0
      *
     c                   eval      w_strt = 0
     c                   eval      w_slut = 0
      *
      *  Key for les av NUMMER
      *
     c     anuml1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    anuml1_fell
     c                   kfld                    anuml1_type
     c                   kfld                    anuml1_fast
      *
      *  Key for les av STATUS-KODER
      *
     c     lstsl1_key    klist
     c                   kfld                    w_firm
      *
      *  Key for les av BESTILLINGS-HODE
      *
     c     lohel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lohel1_numm
     c                   kfld                    lohel1_suff
      *
      *  Key for oppdatering av BESTILLINGS-HODE
      *
     c     lohelu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lohelu_numm
     c                   kfld                    lohelu_suff
      *
      * Key for les av HISTORISK FAKTURA
      *
     c     sihel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    sihel1_aarr
     c                   kfld                    sihel1_binr
     c                   kfld                    sihel1_numm
     c                   kfld                    sihel1_suff
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Tar inn parameter fra forrige program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *entry        plist
     c                   parm                    p_stat
     c                   parm                    p_firm
     c                   parm                    p_numm
     c                   parm                    p_suff
7.02 c                   parm                    p_nybe
5.50  *
5.50  * Key for leverandørposteringer
5.50  *
5.50 c     rltrl7_key    klist
5.50 c                   kfld                    w_firm
5.50 c                   kfld                    rltrl7_levr
5.50 c                   kfld                    rltrl7_raar
5.50 c                   kfld                    rltrl7_lfak
6.31  *
6.31  * Key for vare
6.31  *
6.31 c     vvarl1_key    klist
6.31 c                   kfld                    w_firm
6.31 c                   kfld                    vvarl1_vare
6.31  *
6.31  * Key for linjetype
6.31  *
6.31 c     vltyl1_key    klist
6.31 c                   kfld                    w_firm
6.31 c                   kfld                    vltyl1_ltyp
6.31  *
6.31  * Key for bestillingslinjer
6.31  *
6.31 c     lodtlu_key    klist
6.31 c                   kfld                    w_firm
6.31 c                   kfld                    lodtlu_numm
6.31 c                   kfld                    lodtlu_suff
6.31  *
6.31  * Key for oppdat av mva kode
6.31  *
6.31 c     vmval1_key    klist
6.31 c                   kfld                    w_firm
6.31 c                   kfld                    vmval1_mkod
6.35  *
6.35  * Key for oppslag på leverandør
6.35  *
6.35 c     rlevl1_key    klist
6.35 c                   kfld                    w_firm
6.35 c                   kfld                    rlevl1_levr
6.35  *
6.35  * Key for oppslag på prosjektnummer
6.35  *
6.35 c     rp1pl1_key    klist
6.35 c                   kfld                    w_firm
6.35 c                   kfld                    rp1pl1_1pro
6.35  *
6.35  * Key for historikk
6.35  *
6.35 c     sihela_key    klist
6.35 c                   kfld                    w_firm
6.35 c                   kfld                    sihela_aarr
6.35 c                   kfld                    sihela_lena
      *
      *  Legger inn verdier i nøklene
      *
     c                   move      l_firm        w_firm
      *
     c                   eval      lohel1_numm = p_numm
     c                   eval      lohel1_suff = p_suff
     c                   eval      lohelu_numm = p_numm
     c                   eval      lohelu_suff = p_suff
      *
      *  Henter statusopplysninger
      *
     c     lstsl1_key    chain     lstsl1r
      *
     c                   eval      anuml1_fell = laabin
     c                   eval      anuml1_type = *blank
     c                   eval      anuml1_fast = *blank
     c     anuml1_key    chain     anuml1
B001 c                   if        %found
 001 c                   eval      w_strt = annfom
 001 c                   eval      w_slut = anntom
X001 c                   else
 001 c                   eval      w_strt = 0
 001 c                   eval      w_slut = 0
E001 c                   endif
      *
7.02  *
7.02  * Hent avdeling fra lager hvis nyopprettet og
7.02  *  lager avviker fra brukers default lager.
7.02  *
7.02   CallP CO402R(l_filg:w_firm:0:'LO101_702':
7.02   co402_verdi1:co402_verdi2);
7.02   if co402_verdi1 = '1';
7.02     u_s702 = *on;
7.02   endif;
7.02  *
     c                   endsr
