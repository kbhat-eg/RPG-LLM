```markdown
# Overview

This ILE RPG program, named `RC650R`, manages the entry, verification, and storage of parameters related to the printing of debt collection notices ("inkassovarsel"). It is designed for interactive use, validating input fields, and storing/retrieving user parameters from files and the user Local Data Area (LDA). The program interacts with several files for customer and parameter lookups and handles display file interactions.

---

## High-Level Flow

1. **Initialization**: On program start (`*inzsr` subroutine), parameters are either loaded from previous saved values (if present) or set to defaults.
2. **Screen Interaction**: The user is presented with a screen (`a2bld`) to enter/modify print criteria parameters.
3. **Validation**: Various checks are performed on the entered data (dates, ranges, codes).
4. **Parameter Storage**: Valid data is packed into a data structure and stored for later batch processing.
5. **Exit**: Program ends after either saving parameters or upon user request.

---

## Key Components

### 1. File Declarations

- **Files used**:  
  - `rkunl1` and `rca0l1`: Customer master files, renamed for local use.
  - `rkwapf`: Parameter storage file (user parameters).
  - `rc650d`: Display file (workstation, interactive screen).

### 2. Data Structures

- **Parameter block (`pparam`)**:  
  The main parameter area (bytes 300–490), with fields for company number, user, dates, customer ranges, etc.  
  Individual fields (`pfirm`, `pkdat`, etc.) are overlays into the parameter block.

- **Local variables**:  
  - `l_user`, `l_firm`, `l_fnav`: User, company, and company name from LDA.
  - `w_firm`, `wkun`, etc.: Working variables for field and key manipulations.

- **Arrays**:  
  - `kun(10)`: Up to 10 individual customer numbers.

### 3. Indicator Usage

- Explicit use of RPG indicators:  
  - `KA` = F1: Select company  
  - `KC` = F3: Exit  
  - `LR`: Last record/exit  
  - Others for errors and file status

---

## Main Program Flow

1. **Initialization (`*inzsr`)**
    - Loads previous parameters from `rkwapf` if present; otherwise, sets up default values.
    - Gets LDA info for company/user.

2. **Parameter Input Screen**
    - Label `a2bld`, then shows the parameter selection screen (`exfmt a2bld`).
    - Clears error indicators.

3. **User Exit**
    - If F3 pressed (`*inkc = *on`), sets return value and exits.

4. **Validation Section**
    - **Run date (`a2pkda`)**: If empty, defaults to system date. Must be a valid date.
    - **Reminder/Collection date (`a2pfda`)**: Same logic as above.
    - **Days allowed (`a2plop`)**: Must not exceed 50.
    - **Document type (`a2pkod`)**: Must be 'I' (collection) or 'P' (reminder).
    - **Print receipt (`a2pskr`)**: Must be 'J' (yes) or blank.
    - **Range checks**: For division numbers, customer categories, and salespeople, FROM must not exceed TO.
    - **Customer range (`a2pknf`–`a2pknt`)**: Same logic.
    - **Individual customer checks**: Each non-zero entry in `kun` array is checked for existence in the customer master.
        - If not found, error indicator is set and user is prompted to correct.

5. **Parameter Block Update**
    - After validation, screen variables are copied into the parameter block (`pparam` and overlays).

6. **Parameter Save to File (`rkwapf`)**
    - The relevant company/user key is built.
    - If a record exists, it is updated; otherwise, a new one is written.

7. **Program Exit**
    - Sets LR indicator and returns.

---

## Subroutine: *inzsr

- **Purpose**: Initialize the program on entry.
    - Attempts to load previous parameters for the user/company from `rkwapf`.
    - If not found, assigns defaults (e.g., all ranges set to full, codes set to initial state).
    - Builds entry parameter block (`pparam`) with either previous or default data.
    - Sets up key lists for later use.

---

## Comments and Maintenance Notes

- **Change Log**: Comment header tracks changes and their justifications, e.g., increase in allowed days for reminders, logic for print receipt, retrieval of last used parameters.
- **Norwegian Terms**: Many variable names and comments are in Norwegian (`purring`=reminder, `inkasso`=collection, etc.).
- **Indicators**: Traditional RPG indicators (`*inxx`) are heavily used for both user interaction and error handling.
- **Error Handling**: Looping back to input upon validation failures using indicator logic and `goto`.

---

## Typical User Scenario

1. User invokes the program; previous parameter choices are loaded if present.
2. User is shown a screen to enter selection criteria for notices.
3. On pressing Enter, all logic checks are performed.
4. If errors are found, the user is informed and can correct them.
5. When all is correct, parameters are recorded for subsequent batch processing.

---

## Modernization Notes

- This is classic (fixed-format) RPG IV code.
- Modern RPG (RPGLE/free) would use built-in types, structured error handling, and less indicator logic.
- The code is well-commented for maintainers, especially valuable given its age and Norwegian business context.

---

## Key Takeaways for Onboarding

- **Focus on the parameter block (`pparam`)** and how it overlays to many fields.
- Understand the flow of data between the screen, internal variables, and persistent file storage (`rkwapf`).
- Pay attention to the validation logic—most user errors will trigger indicators and redisplay the screen.
- The linkage to customer master files (`rkunl1`) is for validation only (not selection).
- If new fields are added, update overlays and storage logic accordingly.
```