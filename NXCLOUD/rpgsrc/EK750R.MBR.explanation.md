```markdown
## Overview

This RPG/400 (ILE RPG) program, named **EK750R**, is designed to check if a customer (by various identifiers) is associated with a "bonus agreement" in the system. If a relevant bonus agreement is found, it returns a flag indicating this status. 

The program operates as a subroutine called from elsewhere, utilizing several input/output parameters. Database access is performed on two files: `ekboi1` and `ekboid`, which likely contain information about bonus agreements at different levels (customer, project, etc).

---

## High-Level Program Flow

1. **Parameter Initialization**: Receives parameters for company, customer numbers, project number, and an output bonus flag.
2. **Checks for Bonus Agreement in Order**:
    - Checks by "invoice customer" (`bkun`).
    - If not found: checks by "customer" (`kund`) + "project" (`kpro`).
    - If still not found: checks by "customer" only (`kpro = 0`).
3. **Sets Output Parameter**: If any match is found, sets the output bonus flag (`p_bonu`) to `*on`.
4. **Ends Program**: Sets the last record indicator (`*inlr = *on`) and returns.

---

## Detailed Breakdown

### File Declarations

```rpg
fekboi1    if   e           k disk    rename(ekbost:ekboi1r)
fekboid    if   e           k disk    rename(ekbost:ekboidr)
```
- **ekboi1**: Accesses `ekbost` (renamed as `ekboi1r`), keyed disk file.
- **ekboid**: Accesses `ekbost` (renamed as `ekboidr`), also keyed.

These are database files for looking up bonus agreements.

---

### Variable and Parameter Definitions

- `p_firm`, `p_bkun`, `p_kund`, `p_kpro`: Input parameters, types mimic relevant database fields.
- `p_bonu`: Output parameter, 1-character flag.
- Key variables mirror parameters for database keys.
- `w_firm`: Local variable for company.

---

### Main Logic

#### Initialization

```rpg
c                   eval      p_bonu = *off
```
- Resets the output indicator to "no bonus found".

#### Lookup by Invoice Customer

```rpg
c                   eval      ekboi1_bkun = p_bkun
c     ekboi1_key    chain     ekboi1
c                   if        %found
c                   eval      p_bonu = *on
c                   goto      avslutt
c                   endif
```
- Looks up `ekboi1` by company (`w_firm`) and invoice customer.
- If found, sets `p_bonu` to *on and exits.

#### Lookup by Customer + Project

```rpg
c                   if        p_kund <> 0
c                   eval      ekboid_kund = p_kund
c                   eval      ekboid_kpro = p_kpro
c     ekboid_key    chain     ekboid
c                   if        %found
c                   eval      p_bonu = *on
c                   goto      avslutt
c                   endif
```
- If `p_kund` is not zero, tries to find a bonus agreement for this customer and project.

#### Lookup by Customer Only

```rpg
c                   if        p_kpro <> 0
c                   eval      ekboid_kund = p_kund
c                   eval      ekboid_kpro = 0
c     ekboid_key    chain     ekboid
c                   if        %found
c                   eval      p_bonu = *on
c                   goto      avslutt
c                   endif
c                   endif
```
- If no match with project, but project is nonzero, tries customer with project=0 (i.e., customer-level agreement).

---

### Program Exit

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- `avslutt` is the program's exit point: closes files and returns to caller.

---

### Subroutine: *inzsr (Initialization and Parameter Mapping)

```rpg
c     *inzsr        begsr
c     *entry        plist
c                   parm                    p_firm
c                   parm                    p_bkun
c                   parm                    p_kund
c                   parm                    p_kpro
c                   parm                    p_bonu
...
c                   eval      w_firm = p_firm
c                   endsr
```
- Maps the parameters from the call interface.
- Sets up key lists for file operations.
- Stores the firm parameter in a local variable.

---

## Summary of Logic

1. **Check if there is a bonus for invoice customer**.
2. **If not**, check for customer + project.
3. **If not**, check for customer only.
4. **If any is found**, set output flag to ON.
5. **Return the result to the caller**.

---

## Onboarding Notes

- **Inputs**: Company number, invoice customer, customer, project, output flag.
- **Outputs**: `p_bonu` is set to "on" if bonus found, "off" otherwise.
- **Files**: `ekboi1` and `ekboid` must be available and keyed as expected.
- **Reference**: Business logic is set by the order of checks for bonus agreements.
- **Extensibility**: If new agreement types or priorities are added, extend the logic accordingly.

---
```