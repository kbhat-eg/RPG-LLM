      /TITLE  ASOFAK Ordreinngang, skjermbilde med valg
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : FP800R
      * Beskrivelse . . : Ordreinngang, Skjermbilde med valg
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      * R3.10 080300 AMD  Det oppsto timestampfeil når jobben ble kjørt
      *                   fra jobbkø.  Korrigering er lagt inn
3.11  * R3.11 220900 AMD  Selgernr. utvidet fra 2 til 4 posisjoner
      * R3.31 020101 AMD  Utvidet med en ordretype til + lagt inn mulighet
      *                   for seleksjon også på historisk fakt.reg.
      *                   Endringer ikke anmerket på linjenivå
5.51  * R5.51 020107 AMD  Utvidet med mulighet til også å kunne
      *                   selektere på infokode
7.xx  * 7.00  290316 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     fra07pf    if   e           k disk    rename(ra07pfr:ra07pfr)
     fra09l1    if   e           k disk    rename(ra09pfr:ra09l1r)
     fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
     ffp800d    cf   e             workstn
      *
      * Definering av Local data area
      *
     d                uds
     d l_firm                944    946  0
      *
      * Definering av variabler i nøkler
      *
      *
      * Definering av variable
      *
     d b_feil          s              1    inz(*off)
      *
      *
     d w_fdat          s               d   datfmt(*iso)
     d w_tdat          s               d   datfmt(*iso)
     d w_udat          s               d   datfmt(*iso)
     d w_firm          s              3  0
     d w_stxt          s             30
     d w_atxt          s             30
5.51 d w_itxt          s             35
     d w_time          s               z
     d w_timestamp     s             26  0
     d w_timem         s             13  0
     d d_memb          s              9
      *
      * Datastruktur for parameterliste -ut
      *
     d                 ds
5.51 d d_list                       128
     d  d_firm                        3  0 overlay(d_list)
     d  d_hist                        1    overlay(d_list:4)
     d  d_oiar                        1    overlay(d_list:5)
     d  d_bong                        1    overlay(d_list:6)
3.11 d  d_selg                        4  0 overlay(d_list:7)
3.11 d  d_avde                        4  0 overlay(d_list:11)
3.11 d  d_hot1                        2    overlay(d_list:15)
3.11 d  d_hot2                        2    overlay(d_list:17)
3.11 d  d_hot3                        2    overlay(d_list:19)
3.11 d  d_hot4                        2    overlay(d_list:21)
3.11 d  d_hot5                        2    overlay(d_list:23)
3.11 d  d_hot6                        2    overlay(d_list:25)
3.11 d  d_hvlg                        1    overlay(d_list:27)
3.11 d  d_oot1                        2    overlay(d_list:28)
3.11 d  d_oot2                        2    overlay(d_list:30)
3.11 d  d_oot3                        2    overlay(d_list:32)
3.11 d  d_oot4                        2    overlay(d_list:34)
3.11 d  d_oot5                        2    overlay(d_list:36)
3.11 d  d_oot6                        2    overlay(d_list:38)
3.11 d  d_ovlg                        1    overlay(d_list:40)
3.11 d  d_bot1                        2    overlay(d_list:41)
3.11 d  d_bot2                        2    overlay(d_list:43)
3.11 d  d_bot3                        2    overlay(d_list:45)
3.11 d  d_bot4                        2    overlay(d_list:47)
3.11 d  d_bot5                        2    overlay(d_list:49)
3.11 d  d_bot6                        2    overlay(d_list:51)
3.11 d  d_bvlg                        1    overlay(d_list:53)
5.51 d  d_inf1                        2    overlay(d_list:54)
5.51 d  d_inf2                        2    overlay(d_list:56)
5.51 d  d_inf3                        2    overlay(d_list:58)
5.51 d  d_inf4                        2    overlay(d_list:60)
5.51 d  d_inf5                        2    overlay(d_list:62)
5.51 d  d_inf6                        2    overlay(d_list:64)
5.51 d  d_ivlg                        1    overlay(d_list:66)
5.51 d  d_fdat                         d   overlay(d_list:67) datfmt(*iso)
5.51 d  d_tdat                         d   overlay(d_list:77) datfmt(*iso)
5.51 d  d_dvlg                        1    overlay(d_list:87)
5.51 d  d_dumy                       15    overlay(d_list:88)
5.51 d  d_sort                        1    overlay(d_list:103)
5.51 d  d_ityp                        2    overlay(d_list:104)
      *
      * Definering av nøkkel-felt
      *
     d ra07pf_avde     s                   like(b1avde)
     d ra09l1_selg     s                   like(b1selg)
     d votyl1_otyp     s                   like(vaotyp)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B1 Behandle åpningsbildet
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Initierer bildet
      *
      *
      * Behandler bildet
      *
     c     b1taga        tag
     c                   exfmt     b1bld
      *
      * Behandling av standard funksjonstaster
      *
     c                   select
     c                   when      *inkc
     c                   goto      avslutt
     c                   when      *inkd
     c                   exsr      spØrring
     c                   goto      b1taga
     c                   endsl
      *
      * Sjekker input-felter
      *
     c                   eval      d_hist = b1hist
     c                   eval      d_oiar = b1oiar
     c                   eval      d_bong = b1bong
     c                   eval      d_selg = b1selg
     c                   eval      d_avde = b1avde
     c                   eval      d_hot1 = b1hot1
     c                   eval      d_hot2 = b1hot2
     c                   eval      d_hot3 = b1hot3
     c                   eval      d_hot4 = b1hot4
     c                   eval      d_hot5 = b1hot5
     c                   eval      d_hot6 = b1hot6
     c                   eval      d_hvlg = b1hvlg
     c                   eval      d_oot1 = b1oot1
     c                   eval      d_oot2 = b1oot2
     c                   eval      d_oot3 = b1oot3
     c                   eval      d_oot4 = b1oot4
     c                   eval      d_oot5 = b1oot5
     c                   eval      d_oot6 = b1oot6
     c                   eval      d_ovlg = b1ovlg
     c                   eval      d_bot1 = b1bot1
     c                   eval      d_bot2 = b1bot2
     c                   eval      d_bot3 = b1bot3
     c                   eval      d_bot4 = b1bot4
     c                   eval      d_bot5 = b1bot5
     c                   eval      d_bot6 = b1bot6
     c                   eval      d_bvlg = b1bvlg
5.51 c                   eval      d_inf1 = b1inf1
5.51 c                   eval      d_inf2 = b1inf2
5.51 c                   eval      d_inf3 = b1inf3
5.51 c                   eval      d_inf4 = b1inf4
5.51 c                   eval      d_inf5 = b1inf5
5.51 c                   eval      d_inf6 = b1inf6
5.51 c                   eval      d_ivlg = b1ivlg
     c                   eval      d_dvlg = b1dvlg
     c                   eval      d_sort = *blank
     c                   eval      d_ityp = *blank
     c                   eval      d_dumy = *blank
      *
     c                   exsr      sjekk_inp
      *
     c                   if        b_feil = *on
     c                   eval      b_feil = *off
     c                   goto      b1taga
     c                   endif
      *
      * Kaller utskriftprogrammet
      *
      * Lag membernavn for wohepf
     c                   time                    w_time
     c                   move      w_time        w_timestamp
     c                   move      w_timestamp   w_timem
     c
     c                   movel     w_timem       d_memb
     c                   movel     'W'           d_memb
     c
     c                   call      'FP800C'
     c                   parm                    d_list
     c                   parm                    d_memb
      *
     c                   goto      b1taga
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Behandling av spørringer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     spØrring      begsr
      *
      * Ordretype
      *
     c                   if        w_afld = 'B1HOT1'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1hot1
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1HOT2'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1hot2
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1HOT3'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1hot3
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1HOT4'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1hot4
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1HOT5'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1hot5
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1HOT6'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1hot6
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1OOT1'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1oot1
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1OOT2'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1oot2
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1OOT3'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1oot3
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1OOT4'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1oot4
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1OOT5'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1oot5
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1OOT6'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1oot6
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1BOT1'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1bot1
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1BOT2'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1bot2
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1BOT3'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1bot3
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1BOT4'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1Bot4
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1BOT5'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1bot5
     c                   goto      end_spØrr
     c                   endif
      *
     c                   if        w_afld = 'B1BOT6'
     c                   call      'VA550R'
     c                   parm                    w_firm
     c                   parm                    b1bot6
     c                   goto      end_spØrr
     c                   endif
5.51  *
5.51  * Infotyper
5.51  *
5.51 c                   if        w_afld = 'B1INF1'
5.51 c                   call      'VA540R'
5.51 c                   parm                    w_firm
5.51 c                   parm                    b1inf1
5.51 c                   parm                    w_itxt
5.51 c                   goto      end_spØrr
5.51 c                   endif
5.51  *
5.51 c                   if        w_afld = 'B1INF2'
5.51 c                   call      'VA540R'
5.51 c                   parm                    w_firm
5.51 c                   parm                    b1inf2
5.51 c                   parm                    w_itxt
5.51 c                   goto      end_spØrr
5.51 c                   endif
5.51  *
5.51 c                   if        w_afld = 'B1INF3'
5.51 c                   call      'VA540R'
5.51 c                   parm                    w_firm
5.51 c                   parm                    b1inf3
5.51 c                   parm                    w_itxt
5.51 c                   goto      end_spØrr
5.51 c                   endif
5.51  *
5.51 c                   if        w_afld = 'B1INF4'
5.51 c                   call      'VA540R'
5.51 c                   parm                    w_firm
5.51 c                   parm                    b1inf4
5.51 c                   parm                    w_itxt
5.51 c                   goto      end_spØrr
5.51 c                   endif
5.51  *
5.51 c                   if        w_afld = 'B1INF5'
5.51 c                   call      'VA540R'
5.51 c                   parm                    w_firm
5.51 c                   parm                    b1inf5
5.51 c                   parm                    w_itxt
5.51 c                   goto      end_spØrr
5.51 c                   endif
5.51  *
5.51 c                   if        w_afld = 'B1INF6'
5.51 c                   call      'VA540R'
5.51 c                   parm                    w_firm
5.51 c                   parm                    b1inf6
5.51 c                   parm                    w_itxt
5.51 c                   goto      end_spØrr
5.51 c                   endif
      *
      * Selger
      *
     c                   if        w_afld = 'B1SELG'
     c                   call      'RA509R'
     c                   parm                    w_firm
     c                   parm                    b1selg
     c                   parm                    w_stxt
     c                   goto      end_spØrr
     c                   endif
      *
      * Avdeling
      *
     c                   if        w_afld = 'B1AVDE'
     c                   call      'RA507R'
     c                   parm                    w_firm
     c                   parm                    b1avde
     c                   parm                    w_atxt
     c                   goto      end_spØrr
     c                   endif
      *
     c     end_spØrr     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekker input-felter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_inp     begsr
      *
     c                   eval      b_feil = *off
3.10 c                   eval      w_fdat = *loval
3.10 c                   eval      w_tdat = *loval
      *
      *
      * Kontroll av inntastet dato
      *
     c                   if        b1fdat <> 0
     c     *dmy          test(d)                 b1fdat                 46
     c                   if        *in57  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   if        b1tdat <> 0
     c     *dmy          test(d)                 b1tdat                 48
     c                   if        *in59  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   if        b1tdat <> 0 and
     c                             b1fdat = 0
     c     *dmy          move      w_udat        b1fdat
     c                   endif
      *
     c                   if        b1fdat <> 0
     c     *dmy          move      b1fdat        w_fdat
     c                   if        b1tdat <> 0
     c     *dmy          move      b1tdat        w_tdat
     c                   else
     c                   eval      w_tdat = *loval
     c                   endif
     c                   if        w_fdat > w_tdat
     c                   eval      *in58  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      d_fdat = w_fdat
     c                   eval      d_tdat = w_tdat
      *
      * Kontroll selger-nummer
      *
     c                   eval      ra09l1_selg = b1selg
     c                   if        b1selg <> 0
     c     ra09l1_key    chain     ra09l1                             61
     c                   if        *in61 <> *off
     c                   eval      *in38  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
      * Kontroll avdelings-nummer
      *
     c                   eval      ra07pf_avde = b1avde
     c                   if        b1avde <> 0
     c     ra07pf_key    chain     ra07pf                             61
     c                   if        *in61 <> *off
     c                   eval      *in39  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
      * Kontroll ordre-typene
      *
     c                   eval      votyl1_otyp = b1hot1
     c                   if        b1hot1 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in31  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1hot2
     c                   if        b1hot2 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in32  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1hot3
     c                   if        b1hot3 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in33  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1hot4
     c                   if        b1hot4 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in34  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1hot5
     c                   if        b1hot5 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in35  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1hot6
     c                   if        b1hot6 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in36  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1oot1
     c                   if        b1oot1 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in41  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1oot2
     c                   if        b1oot2 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in42  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1oot3
     c                   if        b1oot3 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in43  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1oot4
     c                   if        b1oot4 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in44  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1oot5
     c                   if        b1oot5 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in45  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1oot6
     c                   if        b1oot6 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in46  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1bot1
     c                   if        b1bot1 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in51  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1bot2
     c                   if        b1bot2 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in52  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1bot3
     c                   if        b1bot3 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in53  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1bot4
     c                   if        b1bot4 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in54  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1bot5
     c                   if        b1bot5 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in55  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c                   eval      votyl1_otyp = b1bot6
     c                   if        b1bot6 <> '  '
     c     votyl1_key    chain     votyl1                             61
     c                   if         *in61 <> *off
     c                   eval      *in56  = *on
     c                   eval      b_feil = *on
     c                   goto      end_sjekk
     c                   endif
     c                   endif
      *
     c     end_sjekk     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Henter firmakode fra LDA
      *
     c                   eval      w_firm = l_firm
     c                   eval      d_firm = l_firm
      *
      * Key for oppslag på avdelingsregister
      *
     c     ra07pf_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ra07pf_avde
      *
      * Key for oppslag på selgerregister
      *
     c     ra09l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ra09l1_selg
      *
      * Key for oppslag på ordretypr-register
      *
     c     votyl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    votyl1_otyp
      *
      * Initierer bildet
      *
     c                   eval      b1selg = *zeros
     c                   eval      b1hist = '1'
     c                   eval      b1oiar = '1'
     c                   eval      b1bong = '1'
      *
      * Henter dagens dato
      *
     c                   time                    w_udat
      *
     c                   endsr
