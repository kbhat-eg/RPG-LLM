# RL400R – Vendor Deletion Parameter Entry

## Overview

**RL400R** is an interactive RPG program used within the ASOKON system to collect parameters for deleting vendors (leverandører) based on user input. The program presents a selection screen, validates input criteria (including date ranges), and then calls a processing program (`RL400C`) to perform the actual deletion logic.

The program is designed for use by operations or administrative staff, allowing them to specify which vendors should be deleted based on their registration date or other criteria.

---

## Program Structure

### File Declarations

- **AUSRL1**: Input file, keyed, likely used for user or firm validation.
- **RL400D**: Workstation file for screen I/O (interactive display).

### Data Area (LDA) Usage

- The program extracts several fields from the local data area (LDA):
    - `l_user`: User ID (positions 911–920)
    - `l_firm`: Firm number (positions 944–946)
    - `l_fnav`: User's full name (positions 951–980)

These are used to pre-populate or validate screen fields and enforce firm-based data segregation.

### Working Variables

- `w_firm`: Firm number (numeric, 3 digits)
- `w_in03`: Flag to indicate user exit (character, 1)
- `w_type`: Print type/parameter type (character, 1)
- `w_edat`: "Older than date" (ISO date)
- `w_ndat`: "Vendors registered after" date (ISO date, T5.00 enhancement)

### Indicator Usage

The program follows a strict indicator convention:
- **KA** (F1): Firm selection
- **KC** (F3): Exit
- **LR**: Program end
- **30**: Field protection for display
- **31–59**: Error/warning indicators
- **60–69**: File indicators
- **70–79**: Subroutine work indicators
- **80–89**: General work indicators
- **90–99**: Standard subroutine indicators

### Main Processing Flow

1. **Initialization (`*INZSR`)**
    - Loads firm number from LDA into working variable.
    - Sets default print type to `'J'`.
    - Clears the exit flag.

2. **Parameter Screen Display**
    - Displays the A2BLD screen (parameter entry).
    - Resets error indicators.

3. **User Exit Handling**
    - If F3 (KC) is pressed, sets the exit flag and branches to program end.

4. **Date Validation**
    - Validates the "Older than date" (`a2edat`) field using `TEST(D)` with DMY format.
    - If invalid, sets error indicator and redisplays the screen.

5. **"Registered After" Date Validation (T5.00 Enhancement)**
    - If the field is zero, uses *HIVAL (highest possible date) to indicate "no lower bound".
    - Otherwise, validates the date. If invalid, sets error indicator and redisplays the screen.

6. **Type Validation**
    - Ensures the print/type field (`a2type`) is either `'J'` or `'N'`. Otherwise, sets error indicator and redisplays.

7. **Parameter Passing and Call**
    - On valid input, moves values to working variables.
    - Calls `RL400C`, passing:
        - Exit flag
        - Print/type
        - "Older than" date
        - "Registered after" date

8. **Program End**
    - Sets LR indicator and returns.

---

## Business/Domain-Specific Logic

- **Vendor Deletion Criteria**: Users can specify vendors to be deleted based on:
    - Registered before a certain date (`a2edat`)
    - Registered after a certain date (`a2ndat`, T5.00 enhancement)
- **Print/Type Selection**: Only two types are valid: `'J'` and `'N'`. The meaning of these codes is defined elsewhere in the business logic but likely refers to different output or processing modes.
- **Firm Segregation**: All operations are firm-specific, using the firm number from the LDA for context.

---

## Design Decisions & Conventions

- **Indicator Usage**: The program uses a well-documented, tightly controlled indicator range for various purposes, which is a common pattern in this codebase for maintainability.
- **Screen Handling**: Error conditions are handled by setting specific indicators and redisplaying the screen, allowing for user correction.
- **Parameter Passing**: The program acts as a front-end, collecting and validating parameters before passing them to the batch/processing program (`RL400C`).
- **Date Handling**: Uses ISO date format internally, but accepts DMY input from the user interface.

---

## External Interactions

- **RL400C**: The main processing logic for vendor deletion is encapsulated in this called program. RL400R only collects and validates parameters.
- **AUSRL1**: Used for user/firm validation or context (not directly manipulated in the provided code).
- **RL400D**: The display file presenting the A2BLD screen for user interaction.

---

## Version Notes

- **T5.00 (V5.00, 2023-04-03)**: Enhancement to prevent deletion of vendors registered after a certain date (`a2ndat`). This ensures new vendors (post a specified date) are not accidentally deleted.

---

## Summary

RL400R is a parameter-entry and validation program for vendor deletion operations. It ensures that only valid, business-appropriate criteria are passed to the deletion routine, with strong user feedback and error handling. The program is tightly integrated with firm-based security and follows established codebase conventions for indicators and parameter handling. All destructive operations are performed by the called program, not directly within RL400R.