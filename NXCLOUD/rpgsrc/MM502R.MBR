     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASLOGI
      * Program . . . . : mm502R
      * Beskrivelse . . : Prognose pr. uke   24 uker
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       291104 bø   Nytt program
5.50  *       041206 bø   Mulig å endre lager - endret dds
5.50  *       310507 bø   Utvidet b.punkt, m.meng,mini til 3 desimaler
5.50  *       040607 bø   Fjernet 6 felter for å få plass til en des. på prognos
5.50  *       060607 bø   Viser stat.antall ved F11,                        gnos
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = Avslutt program
      *       10 = Rollup
      *       11 = Rolldown
      *       12 = Sfldsp
      *       13 = Sfldspctl
      *       14 = Sflclr
      *       15 = Sflend
      *       21 = Home-key
      *       22 = Plassering av cursor
      *       30 = Protect av felter ved vise
      *    31-79 = Varsle m/feilmeldinger/skjermindikatorer
      *    80-99 = Arbeidsindikatorer
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fmprulr    if   e           k disk    rename(mprupfr:mprulrr)
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fvlagl1    if   e           k disk    rename(vlagpfr:vlagl1r)
      *
     fmm502d    cf   e             workstn
     f                                     INFDS(INFDS)
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Diverse datastrukturer
      *
4.01 D INFDS           DS
4.01 D  ROLL             *STATUS
      *
      * Definering av variabler i nøkler
      *
     d mprulr_aar      s                   like(mraar)
     d mprulr_uke      s                   like(mruke)
     d vvarl1_vare     s                   like(vvvare)
     d vlagl1_vare     s                   like(vlvare)
     d vlagl1_lage     s                   like(vllage)
      *
      * Definering av variable
      *
     d a_uke           s              2  0 DIM(26)
     d a_aar           s              4  0 DIM(26)
     d i               s              2  0
     d w_tell          s              3  0
     d w_anta          s             11  3
     d w_ants          s             11  3
     d w_anti          s             11  3
     d w_20            s              2  0
     d w_firm          s                   like(mrfirm)
     d w_vare          s                   like(mrvare)
     d w_lage          s                   like(mrlage)
     d w_uke           s                   like(mruke)
     d w_ukin          s                   like(mruke)
     d w_aar           s                   like(mraar)
     d w_paar          s              4  0
     d w_puke          s              2  0
     d w_fdatu         s               d   datfmt(*iso)
     d w_tdatu         s               d   datfmt(*iso)
     d w_stat          s              1
     d b_glat          s              1    inz(*off)
     d b_stat          s              1    inz(*off)
      *
     d p_vare          s                   like(mrvare)
     d p_lage          s                   like(mrlage)
     d p_uke           s                   like(mruke)
     d p_aar           s                   like(mraar)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B2CTL Behandle åpningsbildet med subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Send Alt
      *
      *
     c                   exsr      xc2bld
      * Avslutt program
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å behandle bilde for ny/endring/vise (C2BLD)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xc2bld        begsr
      *
     c     c2taga        tag
5.50 c                   eval      w_lage = c1lage
     c                   exsr      dann_uketab
     c                   eval      w_tell = w_ukin
      *
     c     c2tagb        tag
     c                   eval      i = 1
     c                   dow       i < 25
     c                   eval      mprulr_aar  = a_aar(i)
     c                   eval      mprulr_uke  = a_uke(i)
     c     mprulr_key    chain     mprulr
      *
     c                   if        not %found(mprulr)
     c                   eval      mraar  = w_aar
     c                   eval      mruke  = mprulr_uke
     c                   eval      mrantp = 0
     c                   eval      mrantp = 0
     c                   eval      mrantg = 0
     c                   eval      mrants = 0
     c                   eval      mranti = 0
     c                   endif
      *
     c                   select
     c                   when      a_uke(1)  = mruke
     c                   eval      c2aa01 = a_aar(1)
     c                   eval      c2uk01 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap01 = w_anta
     c                   eval      c2as01 = w_ants
     c                   eval      c2ai01 = w_anti
     c                   when      a_uke(2)  = mruke
     c                   eval      c2aa02 = a_aar(2)
     c                   eval      c2uk02 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap02 = w_anta
     c                   eval      c2as02 = w_ants
     c                   eval      c2ai02 = w_anti
     c                   when      a_uke(3)  = mruke
     c                   eval      c2aa03 = a_aar(3)
     c                   eval      c2uk03 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap03 = w_anta
     c                   eval      c2as03 = w_ants
     c                   eval      c2ai03 = w_anti
     c                   when      a_uke(4)  = mruke
     c                   eval      c2aa04 = a_aar(4)
     c                   eval      c2uk04 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap04 = w_anta
     c                   eval      c2as04 = w_ants
     c                   eval      c2ai04 = w_anti
     c                   when      a_uke(5)  = mruke
     c                   eval      c2aa05 = a_aar(5)
     c                   eval      c2uk05 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap05 = w_anta
     c                   eval      c2as05 = w_ants
     c                   eval      c2ai05 = w_anti
     c                   when      a_uke(6)  = mruke
     c                   eval      c2aa06 = a_aar(6)
     c                   eval      c2uk06 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap06 = w_anta
     c                   eval      c2as06 = mrants
     c                   eval      c2ai06 = mranti
     c                   when      a_uke(7)  = mruke
     c                   eval      c2aa07 = a_aar(7)
     c                   eval      c2uk07 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap07 = w_anta
     c                   eval      c2as07 = w_ants
     c                   eval      c2ai07 = w_anti
     c                   when      a_uke(8)  = mruke
     c                   eval      c2aa08 = a_aar(8)
     c                   eval      c2uk08 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap08 = w_anta
     c                   eval      c2as08 = w_ants
     c                   eval      c2ai08 = w_anti
     c                   when      a_uke(9)  = mruke
     c                   eval      c2aa09 = a_aar(9)
     c                   eval      c2uk09 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap09 = w_anta
     c                   eval      c2as09 = w_ants
     c                   eval      c2ai09 = w_anti
     c                   when      a_uke(10)  = mruke
     c                   eval      c2aa10 = a_aar(10)
     c                   eval      c2uk10 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap10 = w_anta
     c                   eval      c2as10 = w_ants
     c                   eval      c2ai10 = w_anti
     c                   when      a_uke(11)  = mruke
     c                   eval      c2aa11 = a_aar(11)
     c                   eval      c2uk11 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap11 = w_anta
     c                   eval      c2as11 = w_ants
     c                   eval      c2ai11 = w_anti
     c                   when      a_uke(12)  = mruke
     c                   eval      c2aa12 = a_aar(12)
     c                   eval      c2uk12 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap12 = w_anta
     c                   eval      c2as12 = w_ants
     c                   eval      c2ai12 = w_anti
     c                   when      a_uke(13)  = mruke
     c                   eval      c2aa13 = a_aar(13)
     c                   eval      c2uk13 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap13 = w_anta
     c                   eval      c2as13 = w_ants
     c                   eval      c2ai13 = w_anti
     c                   when      a_uke(14)  = mruke
     c                   eval      c2aa14 = a_aar(14)
     c                   eval      c2uk14 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap14 = w_anta
     c                   eval      c2as14 = w_ants
     c                   eval      c2ai14 = w_anti
     c                   when      a_uke(15)  = mruke
     c                   eval      c2aa15 = a_aar(15)
     c                   eval      c2uk15 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap15 = w_anta
     c                   eval      c2as15 = w_ants
     c                   eval      c2ai15 = w_anti
     c                   when      a_uke(16)  = mruke
     c                   eval      c2aa16 = a_aar(16)
     c                   eval      c2uk16 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap16 = w_anta
     c                   eval      c2as16 = w_ants
     c                   eval      c2ai16 = w_anti
     c                   when      a_uke(17)  = mruke
     c                   eval      c2aa17 = a_aar(17)
     c                   eval      c2uk17 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap17 = w_anta
     c                   eval      c2as17 = w_ants
     c                   eval      c2ai17 = w_anti
     c                   when      a_uke(18)  = mruke
     c                   eval      c2aa18 = a_aar(18)
     c                   eval      c2uk18 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap18 = w_anta
     c                   eval      c2as18 = w_ants
     c                   eval      c2ai18 = w_anti
     c                   when      a_uke(19)  = mruke
     c                   eval      c2aa19 = a_aar(19)
     c                   eval      c2uk19 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap19 = w_anta
     c                   eval      c2as19 = w_ants
     c                   eval      c2ai19 = w_anti
     c                   when      a_uke(20)  = mruke
     c                   eval      c2aa20 = a_aar(20)
     c                   eval      c2uk20 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap20 = w_anta
     c                   eval      c2as20 = w_ants
     c                   eval      c2ai20 = w_anti
     c                   when      a_uke(21)  = mruke
     c                   eval      c2aa21 = a_aar(21)
     c                   eval      c2uk21 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap21 = w_anta
     c                   eval      c2as21 = w_ants
     c                   eval      c2ai21 = w_anti
     c                   when      a_uke(22)  = mruke
     c                   eval      c2aa22 = a_aar(22)
     c                   eval      c2uk22 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap22 = w_anta
     c                   eval      c2as22 = w_ants
     c                   eval      c2ai22 = w_anti
     c                   when      a_uke(23)  = mruke
     c                   eval      c2aa23 = a_aar(23)
     c                   eval      c2uk23 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap23 = w_anta
     c                   eval      c2as23 = w_ants
     c                   eval      c2ai23 = w_anti
     c                   when      a_uke(24)  = mruke
     c                   eval      c2aa24 = a_aar(24)
     c                   eval      c2uk24 = mruke
     c                   eval      c2uk24 = mruke
     c                   exsr      hent_anta
     c                   eval      c2ap23 = w_anta
     c                   eval      c2as24 = w_ants
     c                   eval      c2ai24 = w_anti
     c                   endsl
      *
     c                   eval      i = i + 1
      *
     c                   enddo
      *
     c     ferdig        tag
      *
     c                   exfmt     c2bld
      *
     c                   if        *inkc or *inkl
     c                   goto      end_c2bld
     c                   endif
     c                   if        *inkj
     c                   if        b_stat = *off
     c                   if        b_glat = *off
     c                   eval      b_glat = *on
     c                   eval      c1text = 'Glattet   '
     c                   else
     c                   eval      b_glat = *off
     c                   eval      c1text = 'Vanlig    '
     c                   endif
     c                   endif
     c                   goto      c2tagb
     c                   endif
     c                   if        *inkk
     c                   if        b_stat = *off
     c                   eval      b_stat = *on
     c                   eval      c1enht = 'Stat. Enhet'
     c                   eval      c1enhs = vvenhs
     c                   else
     c                   eval      b_stat = *off
     c                   eval      c1enht = 'Lager enhet '
     c                   eval      c1enhs = vvenhl
     c                   endif
     c                   goto      c2tagb
     c                   endif
     c                   if        ROLL = 1123
     c                   if        a_uke(1) < 9
     c                   eval      w_20  = a_uke(1) - 8
     c                   eval      w_uke = 52 + w_20
     c                   eval      w_aar = a_aar(1) - 1
     c                   else
     c                   eval      w_uke = a_uke(1) - 8
     c                   eval      w_aar = a_aar(1)
     c                   endif
     c                   goto      c2taga
     c                   endif
     c                   if        ROLL   =  1122
     c                   if        a_uke(1) > 43
     c                   eval      w_20  = a_uke(1) + 8
     c                   eval      w_uke = w_20 - 52
     c                   eval      w_aar = a_aar(1) + 1
     c                   else
     c                   eval      w_uke = a_uke(1) + 8
     c                   eval      w_aar = a_aar(1)
     c                   endif
     c                   goto      c2taga
     c                   endif
     c
      *
     c     end_c2bld     tag
     c                   exsr      nullstill
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å danne tabell med alle ukene som det spørres på
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     dann_uketab   begsr
      *
     c                   exsr      nullstill
      *
     c                   eval      a_uke(1) = w_uke
     c                   eval      a_aar(1) = w_aar
      *
     c                   eval      i = 2
     c                   dow       i < 25
     c                   if        w_uke = 52
      * hvis 53 uker, må man sørge for å skifte til uke 1 og nytt år her !
     c                   eval      w_uke    = 1
     c                   eval      a_uke(i) = 1
     c                   eval      w_aar    = w_aar + 1
     c                   eval      a_aar(i) = w_aar
     c                   eval      i = i +1
     c                   else
     c                   eval      w_uke = w_uke + 1
     c                   eval      a_uke(i) = w_uke
     c                   eval      a_aar(i) = w_aar
     c                   eval      i = i +1
     c                   endif
      *
     c                   enddo
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å nullstille felter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     nullstill     begsr
     c                   eval      c2aa01 = 0
     c                   eval      c2uk01 = 0
     c                   eval      c2ap01 = 0
     c                   eval      c2as01 = 0
     c                   eval      c2ai01 = 0
     c                   eval      c2aa02 = 0
     c                   eval      c2uk02 = 0
     c                   eval      c2ap02 = 0
     c                   eval      c2as02 = 0
     c                   eval      c2ai02 = 0
     c                   eval      c2aa03 = 0
     c                   eval      c2uk03 = 0
     c                   eval      c2ap03 = 0
     c                   eval      c2as03 = 0
     c                   eval      c2ai03 = 0
     c                   eval      c2aa04 = 0
     c                   eval      c2uk04 = 0
     c                   eval      c2ap04 = 0
     c                   eval      c2as04 = 0
     c                   eval      c2ai04 = 0
     c                   eval      c2aa05 = 0
     c                   eval      c2uk05 = 0
     c                   eval      c2ap05 = 0
     c                   eval      c2as05 = 0
     c                   eval      c2ai05 = 0
     c                   eval      c2aa06 = 0
     c                   eval      c2uk06 = 0
     c                   eval      c2ap06 = 0
     c                   eval      c2as06 = 0
     c                   eval      c2ai06 = 0
     c                   eval      c2aa07 = 0
     c                   eval      c2uk07 = 0
     c                   eval      c2ap07 = 0
     c                   eval      c2as07 = 0
     c                   eval      c2ai07 = 0
     c                   eval      c2aa08 = 0
     c                   eval      c2uk08 = 0
     c                   eval      c2ap08 = 0
     c                   eval      c2as08 = 0
     c                   eval      c2ai08 = 0
     c                   eval      c2aa09 = 0
     c                   eval      c2uk09 = 0
     c                   eval      c2ap09 = 0
     c                   eval      c2as09 = 0
     c                   eval      c2ai09 = 0
     c                   eval      c2aa10 = 0
     c                   eval      c2uk10 = 0
     c                   eval      c2ap10 = 0
     c                   eval      c2as10 = 0
     c                   eval      c2ai10 = 0
     c                   eval      c2aa11 = 0
     c                   eval      c2uk11 = 0
     c                   eval      c2ap11 = 0
     c                   eval      c2as11 = 0
     c                   eval      c2ai11 = 0
     c                   eval      c2aa12 = 0
     c                   eval      c2uk12 = 0
     c                   eval      c2ap12 = 0
     c                   eval      c2as12 = 0
     c                   eval      c2ai12 = 0
     c                   eval      c2aa13 = 0
     c                   eval      c2uk13 = 0
     c                   eval      c2ap13 = 0
     c                   eval      c2as13 = 0
     c                   eval      c2ai13 = 0
     c                   eval      c2aa14 = 0
     c                   eval      c2uk14 = 0
     c                   eval      c2ap14 = 0
     c                   eval      c2as14 = 0
     c                   eval      c2ai14 = 0
     c                   eval      c2aa15 = 0
     c                   eval      c2uk15 = 0
     c                   eval      c2ap15 = 0
     c                   eval      c2as15 = 0
     c                   eval      c2ai15 = 0
     c                   eval      c2aa16 = 0
     c                   eval      c2uk16 = 0
     c                   eval      c2ap16 = 0
     c                   eval      c2as16 = 0
     c                   eval      c2ai16 = 0
     c                   eval      c2aa17 = 0
     c                   eval      c2uk17 = 0
     c                   eval      c2ap17 = 0
     c                   eval      c2as17 = 0
     c                   eval      c2ai17 = 0
     c                   eval      c2aa18 = 0
     c                   eval      c2uk18 = 0
     c                   eval      c2ap18 = 0
     c                   eval      c2as18 = 0
     c                   eval      c2ai18 = 0
     c                   eval      c2aa19 = 0
     c                   eval      c2uk19 = 0
     c                   eval      c2ap19 = 0
     c                   eval      c2as19 = 0
     c                   eval      c2ai19 = 0
     c                   eval      c2aa20 = 0
     c                   eval      c2uk20 = 0
     c                   eval      c2ap20 = 0
     c                   eval      c2as20 = 0
     c                   eval      c2ai20 = 0
     c                   eval      c2aa21 = 0
     c                   eval      c2uk21 = 0
     c                   eval      c2ap21 = 0
     c                   eval      c2as21 = 0
     c                   eval      c2ai21 = 0
     c                   eval      c2aa22 = 0
     c                   eval      c2uk22 = 0
     c                   eval      c2ap22 = 0
     c                   eval      c2as22 = 0
     c                   eval      c2ai22 = 0
     c                   eval      c2aa23 = 0
     c                   eval      c2uk23 = 0
     c                   eval      c2ap23 = 0
     c                   eval      c2as23 = 0
     c                   eval      c2ai23 = 0
     c                   eval      c2aa24 = 0
     c                   eval      c2uk24 = 0
     c                   eval      c2ap24 = 0
     c                   eval      c2as24 = 0
     c                   eval      c2ai24 = 0
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for p hente hvilket antall ut fra hvilken funksjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_anta     begsr
      *
     c                   eval      w_anta = 0
     c                   eval      w_ants = 0
     c                   eval      w_anti = 0
      *
     c                   if        b_stat = *on
     c                   eval(h)   w_anta = mrantt
     c                   eval      w_ants = mrants
     c                   eval      w_anti = mranti
     c                   else
     c                   if        b_glat = *off
     c                   eval(h)   w_anta = mrantp
     c                   else
     c                   eval(h)   w_anta = mrantg
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for posisjonering på prognose
      *
     c     mprulr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    w_vare
     c                   kfld                    w_lage
     c                   kfld                    mprulr_aar
     c                   kfld                    mprulr_uke
      *
      * Key for les av vare
      *
     c     vvarl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl1_vare
      *
      * Key for les av lager
      *
     c     vlagl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vlagl1_vare
     c                   kfld                    vlagl1_lage
      *
     C     *ENTRY        PLIST
     C                   PARM                    p_vare
     C                   PARM                    p_lage
     C                   PARM                    p_aar
     C                   PARM                    p_uke
      *
      * Henter verdier fra LDA, og initierer skjermbildet
      *
     c                   eval      w_firm = l_firm
     c                   eval      w_vare = p_vare
     c                   eval      w_lage = p_lage
     c                   eval      w_aar  = p_aar
     c                   eval      w_uke  = p_uke
     c                   eval      w_ukin = p_uke
      *
     c                   movel     p_vare        c1vare
     c                   movel     p_vare        vvarl1_vare
     c     vvarl1_key    chain     vvarl1
     c                   if        %found(vvarl1)
     c                   movel     vvtek1        c1navn
     c                   eval      c1enht = 'Lager enhet '
     c                   eval      c1enhs = vvenhl
     c                   else
     c                   eval      c1navn = 'Ukjent vare'
     c                   endif
     c                   eval      c1lage = w_lage
      *
     c                   eval      c1text = 'Vanlig    '
      *
     c                   endsr
