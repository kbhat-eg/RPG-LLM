# Explanation of the RPG Source Code

## Overview

This RPG IV (ILE RPG) program calculates the day of the week for a given date. The day is returned as a number (1-7), where the mapping depends on the calculation (typically 1 = Monday, 7 = Sunday, but could differ depending on the logic).

The program is named `MP701R` and is designed to be called with two parameters:
- An input date (`p_dato`) using ISO format (`YYYY-MM-DD`)
- An output single-digit number (`p_uked`) representing the weekday

## Header Specifications

```rpg
h option(*nodebugio) datedit(*dmy) datfmt(*iso)
```
- `option(*nodebugio)`: Disables debug input/output.
- `datedit(*dmy)`: Sets default date edit to Day-Month-Year, but overridden locally by `datfmt(*iso)`.
- `datfmt(*iso)`: Sets default date format to ISO (yyyy-mm-dd).

## Data Definitions

### Parameters

```rpg
d p_dato          s               d   datfmt(*iso)
d p_uked          s              1  0
```
- `p_dato`: Input parameter, date type, ISO format.
- `p_uked`: Output parameter, 1-digit numeric, holds calculated weekday.

### Local Variables

```rpg
d Impdate         s               d   datfmt(*iso)
d DayOfWk         s             11P 0
```
- `ImpDate`: Local variable to store the input date.
- `DayOfWk`: Local variable for intermediate weekday calculation.

## Main Calculation Logic

```rpg
c                   eval      ImpDate = p_dato
```
- Assigns the input date to the local variable `ImpDate`.

```rpg
c     ImpDate       subdur    D'1998-08-01' DayOfWk:*D
c                   Div       7             DayOfWk
c                   Mvr                     DayOfWk
```
- `subdur ImpDate D'1998-08-01' DayOfWk:*D`: Calculates the number of days between `ImpDate` and the constant date `1998-08-01`, stores the result in `DayOfWk`.
- `Div 7 DayOfWk`: Divides `DayOfWk` by 7, but in RPG, after a division, the remainder is stored (not the quotient) for use with `Mvr` (Move Remainder).
- `Mvr DayOfWk`: Moves the remainder from the last division statement into `DayOfWk`. Therefore, after these operations, `DayOfWk` holds the number of days since a reference date, modulo 7, i.e., the day of the week as a number between 0 and 6.

```rpg
c                   If        DayOfWk > 0
c                   eval      p_uked = DayOfWk
c                   else
c                   eval      p_uked = DayOfWk + 7
c                   endif
```
- If `DayOfWk` is greater than zero, assign it directly to `p_uked`.
- If it's zero or negative (which can happen for dates before the reference), add 7. Ensures the result is always positive and between 1 and 7.

## Program Ending

```rpg
c     avslutt       tag

c                   eval      *inlr = *on
c                   return
```
- Labels the end of normal processing with `avslutt`.
- Sets the Last Record indicator (`*inlr`) to ON, which tells RPG to clean up and close files when the program ends.
- Returns from the program.

## Subroutine: Initialization

```rpg
c     *inzsr        begsr
      ...
c                   endsr
```
- `*inzsr` is the *initialization subroutine*, automatically called at program start.
- Handles parameter list setup:
    - `*ENTRY PLIST` defines the program's parameter list.
    - `PARM p_dato` links the first parameter as the input date.
    - `PARM p_uked` links the second parameter as the output weekday.

## Summary

- Input is a date (in ISO format).
- Program computes the numeric weekday (1-7) using a simple calculation based on the number of days since August 1, 1998.
- The result is returned in the output parameter.
- The program uses simple arithmetic to determine the day of week, relying on the reference date `1998-08-01` as a known weekday.
- No file I/O or display I/O is present; meant for use as a callable routine.

## Notes

- The choice of reference date is arbitrary but crucial; it must have a known weekday for the logic to work correctly. The program assumes the weekday calculation aligns based on this anchor.
- This style of RPG is considered "fixed-format" RPG IV, not the modern /free format, but is still readable for those familiar with the language.

---

**In summary:**  
This program is a utility to determine the day of the week for a given date, returning a number 1 through 7, using modular arithmetic on the difference in days from a reference date. It's a classic example of parameter-driven batch RPG programming.