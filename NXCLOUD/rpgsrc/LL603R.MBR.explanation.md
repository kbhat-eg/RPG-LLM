# LL603R – Inventory Listing Printout

This program, named LL603R, prints an item (vare) inventory listing based on various sorting and grouping options. It reads inventory records, accumulates totals, handles grouping logic, and outputs formatted data to a printer file. Below is an explanation of its purpose, structure, and key behaviors.

---

## Purpose and General Flow

- The primary purpose is to produce a detailed report of items in inventory (varebeholdning).  
- It reads records from a file named LWA1L1 (the main inventory file) and looks up descriptive or grouping data in related files (VVARL1, VOGRL1, VHGRL1, VUGRL1).  
- While iterating over the inventory records, it checks for breaks in item numbers, warehouses, and item groups, printing appropriate headings and detail lines in a structured manner.  
- Summaries are printed whenever there is a logical break (e.g., when the next record’s item number changes, or a different warehouse, group, or sub-group is encountered).

---

## Data Sources and Relationships

1. **LWA1L1**: Main inventory records containing fields like:  
   - MLVARE (item number)  
   - MLLAGE (warehouse)  
   - MLOGRP (over-group)  
   - MLHGRP (main group)  
   - MLUGRP (sub-group)  
   - Various quantity fields (MLINNG, MLSALG, MLUTTA, etc.)  

2. **VVARL1**: Item master data (looked up by item number), providing descriptive text (VVTEK1) and additional attributes (VVENHL, VVFIRM, etc.).

3. **VOGRL1**, **VHGRL1**, **VUGRL1**: Contain descriptive information for over-groups, main groups, and sub-groups, respectively. The program reads these when a new group identifier is encountered, so it can print the corresponding group name instead of just a code.

4. **LL603P**: Printer file where the final report is written. It contains record formats such as:  
   - A1HDR (general report heading)  
   - A2HDR (warehouse heading)  
   - A3HDR (over-group heading)  
   - A4HDR (main group heading)  
   - A5HDR (sub-group heading)  
   - D1DET (detail line)  
   - T1SUM (totals by item)  

---

## Parameters and Sorting Logic

- The program receives a parameter data structure where fields like P_SORT, P_BRUD, and various “from”/“to” group parameters control how records are filtered or sorted.  
- The P_SORT value (1, 2, 3, or 4) indicates whether sorting is by item number only, or includes grouping by over-group, main group, sub-group, or warehouse.  
- P_BRUD indicates whether to accumulate and print totals for each item when multiple warehouses are used, or if each item/warehouse combination is treated individually.  

---

## Headings and Break Control

The code uses subroutines to handle break logic and print headings:

1. **A1HDR** – The main report heading, written once at the start (and on page overflow).  
2. **A2HDR** – Prints a heading when the warehouse changes, if the sorting mode requires it.  
3. **A3HDR** – Handles a break on over-group, prints the over-group heading.  
4. **A4HDR** – Handles a break on the main group.  
5. **A5HDR** – Handles a break on the sub-group.

Each break subroutine updates internal “work” variables (W_LAGE, W_OOGR, W_HHGR, W_UUGR, etc.) and retrieves descriptive text. If a lookup fails, it falls back to a generic “Ukjent” (unknown) label.

---

## Detail Lines and Totals

- After each record is read from LWA1L1, the program fetches descriptive data from VVARL1 and populates a detail format (D1DET) with items such as:  
  - D1HIIN = MLINNG (opening inventory)  
  - D1HISA = MLSALG + MLUTTA (sales or usage)  
  - D1BEHL = MLBEHL (on-hand balance)  
  - D1IORD = MLPAKK + MLOORD (items on order)  
- It writes D1DET to the printer file.  
- If P_BRUD = 0 (accumulate totals per item across all warehouses), it updates a temporary total structure (T1HIIN, T1HISA, T1HIJU, etc.). The subroutine SUM_T1 prints those totals whenever the item number changes.

---

## Page Overflow Handling

- The **OVERFLOW** subroutine writes the main heading format (A1HDR) again, ensuring the top of a new page has the proper title information.

---

## Call to FØ720R (Warehouse Lookup)

- When starting a new warehouse heading (A2HDR), the program calls “FØ720R” to retrieve warehouse-related descriptions, addresses, postal numbers, etc.  
- The call sets a variable (B_FEIL) if the warehouse is not recognized; in that case, the heading displays “Ukjent lager.”

---

## Key Observations

- The program uses multiple “break” subroutines corresponding to different grouping levels: warehouse, over-group, main group, and sub-group. This allows flexible sorting.  
- Conditional statements recognize when a new record crosses a boundary, triggers the appropriate heading, and resets relevant totals or counters.  
- The code renames record formats to separate the physical file record (e.g., LWA1L1) from the program’s usage (lwa1l1r), indicating a common practice of isolating the file definitions from the actual field usage in the program.  
- The logic for printing (using “write … 30” control level) indicates that record formats are often conditioned by indicators to handle spacing/formatting.  

---

## Summary

LL603R is a printable inventory listing program that reads main inventory data, looks up descriptive information from item/group files, and outputs a structured, multi-level report. The core of the program revolves around recognizing breaks in item and group codes, printing group headings, and optionally accumulating totals for each item across multiple warehouses. This modular approach, with distinct subroutines for each heading type and a shared overflow routine, illustrates a classic multi-level break reporting pattern in RPG.