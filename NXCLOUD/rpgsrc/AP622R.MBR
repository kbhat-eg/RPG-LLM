      /TITLE  Skjermvisning av PDF utskrifter
     H DECEDIT('0.') DATEDIT(*DMY.) option(*nodebugio)
     h DftActgrp(*No)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Program . . . . : AP622R
      * Beskrivelse . . : Skjermvisning av PDF/scann fra arkiv
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- - - - - - - - - - - - - - - - - - - - - - - - - -
      *       020610 BSA  Nytt program
6.20  *       301112 BSA  Endret spørremetode. Erstatter "placeholders" med verdier
6.21  *       101212 BSA  For kort dokumenttype
6.22  *       020113 BSA  Lager kun linken, resten legges på i AP628R
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     fafpslr    if   e           k disk    rename(afpspfr:afpslrr)
      *
      * Definering av parametre
      *
6.21 d p_type          s             50
     d P_soar          s              4
     d p_sonr          s              6
6.20 d p_refn          s             50
     d p_soks          s            123
      *
     d w_bet1          s             33
     d w_bet2          s             30
     d w_bet3          s             30
     d w_bet4          s             30
      *
      * Definering av variabler i nøkler
      *
     d afpslr_ufil     s                   like(l_filg)
     d afpslr_uide     s                   like(afuide)
      *
      * Definering av variable
      *
     d w_date          s               d   datfmt(*iso)
     d w_brpt          s             60
6.20 d w_str_in        s            512
6.20 d w_pos           s              5  0
6.20 d prvpath         s            512
      *
      * - - - - - - - - - - - - - -
      * Henter inn data fra LDA
      * - - - - - - - - - - - - - -
      *
     d                uds
     d l_ruti                800    809
     d l_outq                810    819
     d l_wsid                901    910
     d l_user                911    920
     d l_filg                931    933
     d l_firm                944    946  0
      *
      * Definering av variabler i nøkler
      *
      *
      * Definering av variable
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Vi bygger opp path til PDF og launcher browser                  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c                   eval      w_brpt = *blanks
      * Finn først hvilken type dokument vi skal ha tak i
6.20 c                   exsr      gen_sokurl
6.20 c                   if        1 = 2
     c                   select
     c                   when      p_type = 'FAKTURA   '
     c                   exsr      ex_faktura
     c                   when      p_type = 'BILAG     '
     c                   exsr      ex_bilag
     c                   when      p_type = 'PAKKSEDDEL'
     c                   exsr      ex_pakkseddel
     c                   when      p_type = 'xxxxxxxxxx'
     c*                  exsr      ex_ingfakt
     c                   endsl
6.20 c                   endif
      *
      * Må avslutte hvis path er blank
      *
     c                   if        %trim(prvpath) <> *blanks
6.20 c**                 eval      p_soks='start '+%trim(prvpath)+%Trim(w_brpt)
6.22 c**                 eval      p_soks='start '+%trim(prvpath)
6.22 c                   eval      p_soks = %trim(prvpath)
     c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Avslutt program                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c                   eval      *inlr = *on
     c                   return
      *
6.20  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.20  * Bygger opp søkestreng i arkivet for faktura                     *
6.20  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
6.20  *
6.20 c     gen_sokurl    begsr
6.20  *
6.20  * Søkestrengen skal bestå av firma, type og referansenummer
6.20  *
6.20 c                   eval      w_str_in = %trim(prvpath)
6.20  *
      /Free
       //  Erstatt placeholders med verdier fra parameterlista

           w_pos = %scan('{fi}':w_str_in);
           if w_pos > 0;
              w_str_in = %subst(w_str_in:1:w_pos-1)
                     + %char(l_firm)
                     + %subst(w_str_in:w_pos+4);
           endif;

           w_pos = %scan('{ty}':w_str_in);
           if w_pos > 0;
              w_str_in = %subst(w_str_in:1:w_pos-1)
                     + %trim(p_type)
                     + %subst(w_str_in:w_pos+4);
           endif;

           w_pos = %scan('{ref}':w_str_in);
           if w_pos > 0;
              w_str_in = %subst(w_str_in:1:w_pos-1)
                     + %trim(p_refn)
                     + %subst(w_str_in:w_pos+5);
           endif;

      /End-Free
6.20  *
6.20 c                   eval      prvpath = %trim(w_str_in)
6.20  *
6.20 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Bygger opp søkestreng i arkivet for faktura                     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     ex_faktura    begsr
      *
      * Søkestrengen skal bestå av type, firma, år og nummer
      *
     c                   eval      w_bet1 = 'FA^&NR='+ p_sonr
     c                   eval      w_bet2 = '^&FI='+ %char(l_firm)
     c                   eval      w_bet3 = '^&AR='+ p_soar
     c                   eval      w_bet4 = *blanks
     c                   eval      w_brpt = %Trim(w_bet1)+%trim(w_bet2)+
     c                             %trim(w_bet3)+%trim(w_bet4)
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Bygger opp søkestreng i arkivet for faktura                     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     ex_bilag      begsr
      *
      * Søkestrengen skal bestå av type, firma, år og nummer
      *
     c                   eval      w_bet1 = 'BI^&NR='+ p_sonr
     c                   eval      w_bet2 = '^&FI='+ %char(l_firm)
     c                   eval      w_bet3 = '^&AR='+ p_soar
     c                   eval      w_bet4 = *blanks
     c                   eval      w_brpt = %Trim(w_bet1)+%trim(w_bet2)+
     c                             %trim(w_bet3)+%trim(w_bet4)
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Bygger opp søkestreng i arkivet for pakkseddel                  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     ex_pakkseddel begsr
      *
      * Søkestrengen skal bestå av type, firma, år og nummer
      *
     c                   eval      w_bet1 = 'PA^&NR='+ p_sonr
     c                   eval      w_bet2 = '^&FI='+ %char(l_firm)
     c                   eval      w_bet3 = '^&AR='+ p_soar
     c                   eval      w_bet4 = *blanks
     c                   eval      w_brpt = %Trim(w_bet1)+%trim(w_bet2)+
     c                             %trim(w_bet3)+%trim(w_bet4)
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      * Parameterliste
      *
     c     *entry        plist
     c                   parm                    p_type
6.20 c                   parm                    p_refn
6.20 c**                 parm                    p_soar
6.20 c**                 parm                    p_sonr
     c                   parm                    p_soks
      *
      * Key for propertiesfil
      *
     c     afpslr_key    klist
     c                   kfld                    afpslr_ufil
     c                   kfld                    afpslr_uide
      *
      *---------------------------------------------------------------
      *
     c                   time                    w_date
      *
      * Hent inn path til preview
      *
     c                   eval      afpslr_ufil = l_filg
     c                   eval      afpslr_uide = 'ARCHPATH  '
     c     afpslr_key    chain     afpslrr
     c                   if        %found
     c                   eval      prvpath = *blanks
     c                   movel     afudss        prvpath
     c                   endif
      *
     c                   endsr
      *
