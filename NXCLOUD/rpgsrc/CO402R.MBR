**FREE
CTL-OPT MAIN(CO402R) OPTION(*nodebugio : *SRCSTMT);
CTL-OPT datedit(*dmy);
CTL-OPT datfmt(*iso);
CTL-OPT dftactgrp(*no);

DCL-PR CO402R EXTPGM('CO402R');
  p_filgrp            char(3)     const;
  p_firm              packed(3:0) const;
  p_lager             packed(2:0) const;
  p_nokkel            char(50)    const;
  p_verdi1            char(1);
  p_verdi2            char(2048);
END-PR;

DCL-PR P_GETCHAIN extpgm('GETCHAIN');
    p_filgrp2          char(3);
    p_chain            char(3);
  END-Pr;


//      * System  . . . . : AS
//      * Program . . . . : CO402R
//      * Beskrivelse . . : NX tilpassninger
//      *
//      * Programmet får inn en parameter for tilpassning.
//      *   filgruppe
//      *   firma
//      *   lager
//      *   nøkkel
//      * Programmet retunerer verdien som angir om tilpassning er
//      * aktivert eller ikke
//      *   verdi1
//      *
//      * verdi1 vil typisk være 0 eller 1, men kan ha andre verdier hvis behov
//      *
//      * Hvis ikke verdi1 ikke finnes settes nøkkelverdi til '0'
//      *
//      * verdi2 er evt mer info tilhørende verdi1
//      *
//      * Ref.   Dato  Sign Endringsbeskrivelse
//      * ----- ------ ---- -------------------------------------------------
//      *       220191 BKV  Nytt program
//      *       010721 SST  Utvidet med kjede.


DCL-PROC CO402R;
  DCL-PI *N;
    p_filgrp            char(3)     const;
    p_firm              packed(3:0) const;
    p_lager             packed(2:0) const;
    p_nokkel            char(50)    const;
    p_verdi1            char(1);
    p_verdi2            char(2048);
  END-PI;

  dcl-s w_verdi1  char(1)  inz('0');
  dcl-s w_verdi2  char(2048) inz(*blank);
  dcl-s w_chain   char(3)  inz('   ');
  dcl-s w_filgr   char(3)  inz('   ');
  dcl-s p_filgrp2   char(3)  ;

  p_verdi1 = w_verdi1;
  p_verdi2 = w_verdi2;
  p_filgrp2 = p_filgrp;

//_______________________ Filgruppe _________________________________________________

  EXEC SQL SELECT Verdi1, Verdi2 into :w_verdi1, :w_verdi2 FROM SKTIST
              WHERE
    Filgruppe = :p_filgrp and Firma = :p_firm and Lager = :p_lager AND Nokkel = :p_nokkel;

  if (sqlcod >= 0 and sqlcod <> 100);
    p_verdi1 = w_verdi1;
    p_verdi2 = w_verdi2;
  endif;
//_______________________ Kjede     _________________________________________________

  if (sqlcod = 100);
    w_filgr = p_filgrp2;
    callp p_GETCHAIN(w_filgr:w_chain);

//    EXEC SQL SELECT afgkjd into :w_chain FROM afgrst
//                WHERE
//    afgfgr = :p_filgrp2 and afgsrv = w_srv;
//      if (sqlcod >= 0 and sqlcod <> 100);
        EXEC SQL SELECT Verdi1, Verdi2 into :w_verdi1, :w_verdi2 FROM SKTIST
                 WHERE
        Filgruppe = :w_chain  and Firma = :p_firm and Lager = :p_lager AND Nokkel = :p_nokkel;

        if (sqlcod >= 0 and sqlcod <> 100);
          p_verdi1 = w_verdi1;
          p_verdi2 = w_verdi2;
        endif;
//      endif;
  endif;

//_______________________ Alle      _________________________________________________



// Fant ikke noe for filgruppe, prøver med blank filgruppe
  if (sqlcod = 100);
    EXEC SQL SELECT Verdi1, Verdi2 into :w_verdi1, :w_verdi2 FROM SKTIST
                WHERE
    Filgruppe = ''  and Firma = :p_firm and Lager = :p_lager AND Nokkel = :p_nokkel;

    if (sqlcod >= 0 and sqlcod <> 100);
      p_verdi1 = w_verdi1;
      p_verdi2 = w_verdi2;
    endif;
    endif;


  *inlr = *on ;
END-PROC;

