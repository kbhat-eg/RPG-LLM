     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOKON
      * Program . . . . : RR510R
      * Beskrivelse . . : Resultatrapport - saldi, spørring
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       070402 KOB  Nytt program
      *       110602 KOB  Fjernet periode 13 pga plassmangel i skjermbildet
      *V5.60 40309 KOB  Korrigert test av prosent ved stor negativ differanse
6.30  *       080118 NHO  Endret startpos på linjenr
7.xx  * 7.xx  040516 bsa  Endringer reltart til ny GUI. NB Kan kun gjelde DDS
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = Avslutt program
      *       10 = Roll
      *       11 = Rolldown
      *       12 = Sfldsp
      *       13 = Sfldspctl
      *       14 = Sflclr
      *       15 = Sflend
      *       21 = Home-key
      *       22 = Plassering av cursor
      *       30 = Protect av felter ved vise
      *    31-79 = Varsle m/feilmeldinger/skjermindikatorer
      *    80-99 = Arbeidsindikatorer
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     frrf0l1    if   e           k disk    rename(rrf0pfr:rrf0l1r)
     frrf9l1    if   e           k disk    rename(rrf9pfr:rrf9l1r)
     frrf9l2    if   e           k disk    rename(rrf9pfr:rrf9l2r)
     frrf9l3    if   e           k disk    rename(rrf9pfr:rrf9l3r)
     frr510d    cf   e             workstn sfile(b1sfl:w_srrn)
      *
      * Definering av arrays
      *
     d txt             s             25    dim(9) ctdata perrcd(1)               TEKSTER
     d isa             s             11  2 dim(14)                               SALDOMATRISE
     d wrk             s             11  2 dim(13)                               ARBEIDSARRAY
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av variabler i nøkler
      *
     d rrf0l1_0rap     s                   like(rr0rap)
      *
     d rrf9l1_9rap     s                   like(rr9rap)
     d rrf9l1_9lin     s                   like(rr9lin)
     d rrf9l1_9avd     s                   like(rr9avd)
     d rrf9l1_9aar     s                   like(rr9aar)
     d rrf9l1_9typ     s                   like(rr9typ)
      *
     d rrf9l2_9rap     s                   like(rr9rap)
     d rrf9l2_9lin     s                   like(rr9lin)
     d rrf9l2_9avd     s                   like(rr9avd)
      *
     d rrf9l3_9rap     s                   like(rr9rap)
     d rrf9l3_9lin     s                   like(rr9lin)
      *
      *
      * Definering av variable
      *
     d w_stel          s              4  0
     d w_spge          s              4  0
     d w_srrn          s              4  0
     d w_sfrn          s                   like(w_srrn)
     d w_ssrn          s                   like(w_srrn)
      *
     d w_seqe          s              1
     d b_eof           s              1    inz(*off)
     d b_valg_ok       s              1    inz(*off)
      *
     d s_9lin          s                   like(rr9lin)
     d s_9avd          s                   like(rr9avd)
     d s_9typ          s                   like(rr9typ)
     d s_9txt          s                   like(rr9txt)
     d s_9aar          s                   like(b29aar)
     d s_9per          s                   like(b29per)
      *
     d wk1hlp          s              5
     d wk1typ          s              1  0
     d wk2hlp          s              5
     d wk2typ          s              1  0
     d wk3typ          s              1  0
     d wk4typ          s              1  0
      *
     d wp9rap          s                   like(rr9rap)
     d wp9aar          s                   like(rr9aar)
     d wp9per          s                   like(b29per)
      *
     d saml            s             11  2
     d diff            s             11  2
     d pros            s              5  1
     d m               s              2  0
     d n               s              2  0
      *
     d w_firm          s                   like(rr9fir)
     d w_9rap          s                   like(rr9rap)
     d w_text          s             30
     d w_sabe          s              1  0
     d w_sude          s              1
     d w_dper          s                   like(b19per)
     d w_hitt          s                   like(b19hit)
      *
     d p_gkod          s                   like(rr9lin)
     d p_Ækod          s                   like(rr9avd)
     d p_tx20          s             20
     d p_stat          s              1
     d p_9lin          s                   like(rr9lin)
     d p_0rap          s                   like(rr0rap)
     d p_9rap          s                   like(rr9rap)
     d p_9avd          s                   like(rr9avd)
     d p_text          s             30
      *
     d w2k100          s             11  2
     d w2k101          s             11  2
     d w2k102          s             11  2
     d w2k103          s             11  2
     d w2k104          s             11  2
     d w2k105          s             11  2
     d w2k106          s             11  2
     d w2k107          s             11  2
     d w2k108          s             11  2
     d w2k109          s             11  2
     d w2k110          s             11  2
     d w2k111          s             11  2
     d w2k112          s             11  2
     d w2k113          s             11  2
     d w2k114          s             11  2
     d w2k200          s             11  2
     d w2k201          s             11  2
     d w2k202          s             11  2
     d w2k203          s             11  2
     d w2k204          s             11  2
     d w2k205          s             11  2
     d w2k206          s             11  2
     d w2k207          s             11  2
     d w2k208          s             11  2
     d w2k209          s             11  2
     d w2k210          s             11  2
     d w2k211          s             11  2
     d w2k212          s             11  2
     d w2k213          s             11  2
     d w2k214          s             11  2
      *
      * Definering av konstanter
      *
     d c_sfil          s              2  0 inz(12)
      *
      * Forklaring på 9avdielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      * w_stel - Subfile-teller
      * w_spge - Sidestørrelse i subfile (page)
      * w_srrn - Relativt recordnummer i subfile
      * w_sfrn - Første recordnummer på siden
      * w_ssrn - Siste  recordnummer på siden
      * w_curn - Current recordnummer på siden
      * w_virn - Vis den side som inneholder denne record.
      * w_afld - Aktivt feltnavn
      * w_arow - Aktiv rad for cursor
      * w_acol - Aktiv kolonne for cursor
      *
      * Benyttede skjermbilder.
      *
      * - - - - - - - - - - - - - - - - -
      * B1SFL  - B1 Subfile - record
      * B2CTL  - B2 Subfile - control record
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      *
      * Redefinering til array's
      *
     irrf9l1r
     i              rr9s01                      isa(1)
     i              rr9s02                      isa(2)
     i              rr9s03                      isa(3)
     i              rr9s04                      isa(4)
     i              rr9s05                      isa(5)
     i              rr9s06                      isa(6)
     i              rr9s07                      isa(7)
     i              rr9s08                      isa(8)
     i              rr9s09                      isa(9)
     i              rr9s10                      isa(10)
     i              rr9s11                      isa(11)
     i              rr9s12                      isa(12)
     i              rr9s13                      isa(13)
     i              rr9s00                      isa(14)
      *
      * Redefinering til array's
      *
     irrf9l2r
     i              rr9s01                      isa(1)
     i              rr9s02                      isa(2)
     i              rr9s03                      isa(3)
     i              rr9s04                      isa(4)
     i              rr9s05                      isa(5)
     i              rr9s06                      isa(6)
     i              rr9s07                      isa(7)
     i              rr9s08                      isa(8)
     i              rr9s09                      isa(9)
     i              rr9s10                      isa(10)
     i              rr9s11                      isa(11)
     i              rr9s12                      isa(12)
     i              rr9s13                      isa(13)
     i              rr9s00                      isa(14)
      *
      * Redefinering til array's
      *
     irrf9l3r
     i              rr9s01                      isa(1)
     i              rr9s02                      isa(2)
     i              rr9s03                      isa(3)
     i              rr9s04                      isa(4)
     i              rr9s05                      isa(5)
     i              rr9s06                      isa(6)
     i              rr9s07                      isa(7)
     i              rr9s08                      isa(8)
     i              rr9s09                      isa(9)
     i              rr9s10                      isa(10)
     i              rr9s11                      isa(11)
     i              rr9s12                      isa(12)
     i              rr9s13                      isa(13)
     i              rr9s00                      isa(14)
      *
     c     dummy         tag
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B2CTL Behandle åpningsbildet med subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Send Alt
      *
     c     b2taga        tag
      *
     c                   write     b2cmd
      *
      * Bare data
      *
     c     b2tagb        tag
      *
     c                   exsr      dsp_subfile
      *
      * Behandling av funksjonstaster
      *
     c                   select
     c                   when      *inkc or *inkl
     c                   goto      avslutt
     c                   when      *inke
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *inkf
     c                   if        w_seqe = 'L'
     c                   if        w_sude = 'S'
     c                   eval      w_sude = 'D'
     c                   else
     c                   eval      w_sude = 'S'
     c                   endif
     c                   endif
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *in10
     c                   exsr      crt_subfile
     c                   goto      b2tagb
     c                   when      *in11
     c                   exsr      bck_subfile
     c                   goto      b2tagb
     c                   when      *in21
     c                   eval      *in22 = *on
     c                   goto      b2taga
     c                   endsl
      *
      * Poster
      *
     c                   if        *inkh
     c                   call      'RH510R'
     c                   goto      b2tagb
     c                   endif
      *
      * Posisjonering
      *
     c                   if        b29avd <> 0 or
     c                             b29lin <> 0
     c                   exsr      posisjoner
     c                   goto      b2tagb
     c                   endif
      *
      * Nytt år/periode
      *
     c                   if        b29aar <> s_9aar or
     c                             b29per <> s_9per
     c                   exsr      forny
     c                   eval      s_9per = b29per
     c                   eval      s_9aar = b29aar
     c                   eval      v1aar1 = b29aar
     c                   eval      v1aar2 = b29aar
     c                   goto      b2tagb
     c                   endif
      *
      * Behandling av subfile
      *
     c                   exsr      subfile
      *
     c                   if        b_valg_ok = *on
     c                   goto      avslutt
     c                   endif
      *
     c                   goto      b2taga
      *
      * Avslutt program
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for fornying av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     forny         begsr
      *
     c                   if        w_sfrn <> 0
     c     w_sfrn        chain     b1sfl
     c                   endif
      *
6.30  *
6.30  * Nytt år/periode
6.30  *
6.30 c                   if        b29aar <> s_9aar or
6.30 c                             b29per <> s_9per
6.30 c                   eval      b19lin = 0
6.30 c                   endif
6.30  *
     c                   eval      s_9lin = b19lin
     c                   eval      w_dper = 0
     c                   eval      w_hitt = 0
      *
     c                   select
     c                   when      w_seqe = 'L'
     c                   eval      rrf9l1_9lin = b19lin
     c     rrf9l1_key    setll     rrf9l1
     c                   when      w_seqe = 'A'
     c                   eval      rrf9l2_9avd = b19avd
     c     rrf9l2_key    setll     rrf9l2
     c                   endsl
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c     end_forny     endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for posisjonering i subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     posisjoner    begsr
      *
     c                   eval      s_9lin = 0                                                .
      *
      * Posisjoner startverdi på linje
      *
     c                   if        b29lin <> 0
     c                   eval      w_seqe = 'L'
     c                   eval      rrf9l1_9lin = b29lin
     c                   eval      rrf9l1_9avd = b29avd
     c     rrf9l1_key    setll     rrf9l1
     c                   goto      end_pos
     c                   endif
      *
      * Posisjoner startverdi på avdeling
      *
     c                   if        b29avd <> 0
     c                   eval      w_seqe = 'A'
     c                   eval      w_sude = 'D'
     c                   eval      rrf9l2_9avd = b29avd
     c                   eval      rrf9l2_9lin = 0
     c     rrf9l2_key    setll     rrf9l2
     c                   goto      end_pos
     c                   endif
      *
     c     end_pos       tag
      *
      * Blanker subfile, og fyller opp i.h.t. posisjonering
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
      * Blanker posisjoneringsfelter
      *
     c                   eval      b29avd = 0
     c                   eval      b29lin = 0
      *
     c                   endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     subfile       begsr
      *
     c                   if        *in22 = *off
     c                   eval      *in22 = *on
     c                   else
     c                   eval      *in22 = *off
     c                   endif
      *
     c                   if        w_curn > 0
     c                   eval      w_virn = w_curn
     c                   endif
      *
      * Leser og behandler subfile
      *
     c                   do        w_ssrn
     c                   readc     b1sfl
      *
     c                   if        %eof
     c                   leave
     c                   endif
      *
     c                   eval      *in22 = *off
     c                   eval      w_virn = w_srrn
      *
      * Vise post
      *
     c                   if        b1valg = 5
     c                   eval      c19avd = b19avd
     c                   eval      c19lin = b19lin
     c                   eval      c29txt = b19txt
     c                   exsr      xc2bld
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
     c                   eval      b1valg = 0
     c                   update    b1sfl
      *
     c                   enddo
      *
     c     end_subfile   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * C2BLD Behandle bilde for vise                                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xc2bld        begsr
      *
     c     c2tagb        tag
      *
     c                   exsr      nullstill
      *
     c                   exsr      xc2les
      *
     c     c2tagc        tag
      *
     c                   exfmt     c2bld
      *
      * Endre kolonne
      *
     c                   if        *inki = *on
     c                   exsr      xv1win
     c                   exsr      xkolon
     c                   goto      c2tagb
     c                   endif
      *
      * Forrige år
      *
     c                   if        *inke = *on
     c                   eval      v1aar1 = v1aar1 - 1
     c                   eval      v1aar2 = v1aar2 - 1
     c                   exsr      xkolon
     c                   goto      c2tagb
     c                   endif
      *
      * Neste år
      *
     c                   if        *inkf = *on
     c                   eval      v1aar1 = v1aar1 + 1
     c                   eval      v1aar2 = v1aar2 + 1
     c                   exsr      xkolon
     c                   goto      c2tagb
     c                   endif
      *
      * Saldo/bevegelse
      *
     c                   if        *inkg = *on
      *
     c                   if        w_sabe = 1
     c                   eval      w_sabe = 2
     c                   goto      c2tagb
     c                   else
     c                   eval      w_sabe = 1
     c                   goto      c2tagb
     c                   endif
     c                   endif
      *
     c     *inkc         cabeq     *on           c2tag1
     c     *inkl         cabeq     *on           c2tag1
     c     *in30         cabeq     *on           c2tag1
      *
      * Oppdater subfile
      *
     c     c2tag1        tag
      *
     c                   eval      b29avd = *zero
     c                   eval      b29lin = *zero
     c                   move      *off          *in30
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * V1WIN Behandle bilde for endring av kolonne                     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xv1win        begsr
      *
     c                   exfmt     v1win
      *
     c     *inkc         cabeq     *on           v1tag1
     c     *inkl         cabeq     *on           v1tag1
      *
      *
     c     v1tag1        tag
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * XC2LES Leser file og flytter felter til C2BLD                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xc2les        begsr
      *
      * Henter data inn fra saldomatrise og
      * plasserer i skjermbilde
      *
     c                   eval      rrf9l3_9lin = c19lin
      *
      * Summert
      *
     c                   if        w_sude = 'S'
      *
     c     rrf9l3_key    setll     rrf9l3
     c     rrf9l3_key    reade     rrf9l3                                 16
      *
     c                   dow       *in16 = *off
      *
     c                   select
     c                   when      rr9typ = wk1typ and rr9aar = v1aar1
     c                   goto      xkol1s
      *
     c                   when      rr9typ = wk2typ and rr9aar = v1aar2
     c                   goto      xkol2s
      *
     c                   other
     c                   goto      neste
     c                   endsl
      *
      * Kolonne 1
      *
     c     xkol1s        tag
      *
     c                   eval      w2k100 = w2k100 + isa(14)
     c                   eval      w2k101 = w2k101 + isa(1)
     c                   eval      w2k102 = w2k102 + isa(2)
     c                   eval      w2k103 = w2k103 + isa(3)
     c                   eval      w2k104 = w2k104 + isa(4)
     c                   eval      w2k105 = w2k105 + isa(5)
     c                   eval      w2k106 = w2k106 + isa(6)
     c                   eval      w2k107 = w2k107 + isa(7)
     c                   eval      w2k108 = w2k108 + isa(8)
     c                   eval      w2k109 = w2k109 + isa(9)
     c                   eval      w2k110 = w2k110 + isa(10)
     c                   eval      w2k111 = w2k111 + isa(11)
     c                   eval      w2k112 = w2k112 + isa(12)
     c                   eval      w2k113 = w2k113 + isa(13)
     c                   xfoot     isa           c2k114
     c                   eval      w2k114 = w2k114 + c2k114
      *
     c                   goto      neste
      *
     c     xkol2s        tag
      *
      * Kolonne 2
      *
     c                   eval      w2k200 = w2k200 + isa(14)
     c                   eval      w2k201 = w2k201 + isa(1)
     c                   eval      w2k202 = w2k202 + isa(2)
     c                   eval      w2k203 = w2k203 + isa(3)
     c                   eval      w2k204 = w2k204 + isa(4)
     c                   eval      w2k205 = w2k205 + isa(5)
     c                   eval      w2k206 = w2k206 + isa(6)
     c                   eval      w2k207 = w2k207 + isa(7)
     c                   eval      w2k208 = w2k208 + isa(8)
     c                   eval      w2k209 = w2k209 + isa(9)
     c                   eval      w2k210 = w2k210 + isa(10)
     c                   eval      w2k211 = w2k211 + isa(11)
     c                   eval      w2k212 = w2k212 + isa(12)
     c                   eval      w2k213 = w2k213 + isa(13)
     c                   xfoot     isa           c2k214
     c                   eval      w2k214 = w2k214 + c2k214
      *
     c     neste         tag
      *
     c     rrf9l3_key    reade     rrf9l3                                 16
     c                   enddo
      *
      * Hente inn avdelingstekst
      *
     c                   movel     txt(2)        c2gtxt
      *
     c                   if        w_sabe = 1
     c                   eval      c2k100 = w2k100
     c                   eval      c2k101 = w2k101
     c                   eval      c2k102 = w2k102
     c                   eval      c2k103 = w2k103
     c                   eval      c2k104 = w2k104
     c                   eval      c2k105 = w2k105
     c                   eval      c2k106 = w2k106
     c                   eval      c2k107 = w2k107
     c                   eval      c2k108 = w2k108
     c                   eval      c2k109 = w2k109
     c                   eval      c2k110 = w2k110
     c                   eval      c2k111 = w2k111
     c                   eval      c2k112 = w2k112
     c                   eval      c2k114 = w2k113 + w2k114
      *
     c                   eval      c2k200 = w2k200
     c                   eval      c2k201 = w2k201
     c                   eval      c2k202 = w2k202
     c                   eval      c2k203 = w2k203
     c                   eval      c2k204 = w2k204
     c                   eval      c2k205 = w2k205
     c                   eval      c2k206 = w2k206
     c                   eval      c2k207 = w2k207
     c                   eval      c2k208 = w2k208
     c                   eval      c2k209 = w2k209
     c                   eval      c2k210 = w2k210
     c                   eval      c2k211 = w2k211
     c                   eval      c2k212 = w2k212
     c                   eval      c2k214 = w2k213 + w2k214
     c                   endif
      *
     c                   if        w_sabe = 2
     c                   eval      c2k100 = w2k100
     c                   eval      c2k101 = c2k100 + w2k101
     c                   eval      c2k102 = c2k101 + w2k102
     c                   eval      c2k103 = c2k102 + w2k103
     c                   eval      c2k104 = c2k103 + w2k104
     c                   eval      c2k105 = c2k104 + w2k105
     c                   eval      c2k106 = c2k105 + w2k106
     c                   eval      c2k107 = c2k106 + w2k107
     c                   eval      c2k108 = c2k107 + w2k108
     c                   eval      c2k109 = c2k108 + w2k109
     c                   eval      c2k110 = c2k109 + w2k110
     c                   eval      c2k111 = c2k110 + w2k111
     c                   eval      c2k112 = c2k111 + w2k112
     c                   eval      c2k114 = c2k112 + w2k113
      *
     c                   eval      c2k200 = w2k200
     c                   eval      c2k201 = c2k200 + w2k201
     c                   eval      c2k202 = c2k201 + w2k202
     c                   eval      c2k203 = c2k202 + w2k203
     c                   eval      c2k204 = c2k203 + w2k204
     c                   eval      c2k205 = c2k204 + w2k205
     c                   eval      c2k206 = c2k205 + w2k206
     c                   eval      c2k207 = c2k206 + w2k207
     c                   eval      c2k208 = c2k207 + w2k208
     c                   eval      c2k209 = c2k208 + w2k209
     c                   eval      c2k210 = c2k209 + w2k210
     c                   eval      c2k211 = c2k210 + w2k211
     c                   eval      c2k212 = c2k211 + w2k212
     c                   eval      c2k214 = c2k212 + w2k213
     c                   endif
      *
     c                   endif
      *
     c/eject
      *
      * Detaljert
      *
     c                   if        w_sude = 'D'
      *
     c                   eval      rrf9l1_9lin = c19lin
     c                   eval      rrf9l1_9avd = c19avd
     c                   eval      rrf9l1_9typ = wk1typ
     c                   eval      rrf9l1_9aar = v1aar1
     c     rrf9l1_key    chain     rrf9l1                             60
      *
     c                   if        %found
      *
     c                   if        w_sabe = 1
     c                   eval      c2k100 = isa(14)
     c                   eval      c2k101 = isa(1)
     c                   eval      c2k102 = isa(2)
     c                   eval      c2k103 = isa(3)
     c                   eval      c2k104 = isa(4)
     c                   eval      c2k105 = isa(5)
     c                   eval      c2k106 = isa(6)
     c                   eval      c2k107 = isa(7)
     c                   eval      c2k108 = isa(8)
     c                   eval      c2k109 = isa(9)
     c                   eval      c2k110 = isa(10)
     c                   eval      c2k111 = isa(11)
     c                   eval      c2k112 = isa(12)
     c                   xfoot     isa           c2k114
     c                   endif
      *
     c                   if        w_sabe = 2
     c                   eval      c2k100 = isa(14)
     c                   eval      c2k101 = c2k100 + isa(1)
     c                   eval      c2k102 = c2k101 + isa(2)
     c                   eval      c2k103 = c2k102 + isa(3)
     c                   eval      c2k104 = c2k103 + isa(4)
     c                   eval      c2k105 = c2k104 + isa(5)
     c                   eval      c2k106 = c2k105 + isa(6)
     c                   eval      c2k107 = c2k106 + isa(7)
     c                   eval      c2k108 = c2k107 + isa(8)
     c                   eval      c2k109 = c2k108 + isa(9)
     c                   eval      c2k110 = c2k109 + isa(10)
     c                   eval      c2k111 = c2k110 + isa(11)
     c                   eval      c2k112 = c2k111 + isa(12)
     c                   eval      c2k114 = c2k112
     c                   endif
      *
     c                   endif
      *
      * Kolonne 2
      *
     c                   eval      rrf9l1_9typ = wk2typ
     c                   eval      rrf9l1_9aar = v1aar2
     c     rrf9l1_key    chain     rrf9l1                             60
      *
     c                   if        %found
      *
     c                   if        w_sabe = 1
     c                   eval      c2k200 = isa(14)
     c                   eval      c2k201 = isa(1)
     c                   eval      c2k202 = isa(2)
     c                   eval      c2k203 = isa(3)
     c                   eval      c2k204 = isa(4)
     c                   eval      c2k205 = isa(5)
     c                   eval      c2k206 = isa(6)
     c                   eval      c2k207 = isa(7)
     c                   eval      c2k208 = isa(8)
     c                   eval      c2k209 = isa(9)
     c                   eval      c2k210 = isa(10)
     c                   eval      c2k211 = isa(11)
     c                   eval      c2k212 = isa(12)
     c                   xfoot     isa           c2k214
     c                   endif
      *
     c                   if        w_sabe = 2
     c                   eval      c2k200 = isa(14)
     c                   eval      c2k201 = c2k200 + isa(1)
     c                   eval      c2k202 = c2k201 + isa(2)
     c                   eval      c2k203 = c2k202 + isa(3)
     c                   eval      c2k204 = c2k203 + isa(4)
     c                   eval      c2k205 = c2k204 + isa(5)
     c                   eval      c2k206 = c2k205 + isa(6)
     c                   eval      c2k207 = c2k206 + isa(7)
     c                   eval      c2k208 = c2k207 + isa(8)
     c                   eval      c2k209 = c2k208 + isa(9)
     c                   eval      c2k210 = c2k209 + isa(10)
     c                   eval      c2k211 = c2k210 + isa(11)
     c                   eval      c2k212 = c2k211 + isa(12)
     c                   eval      c2k214 = c2k212
     c                   endif
      *
     c                   endif
      *
      * Hente inn avdelingstekst
      *
     c                   move      b19avd        p_gkod
     c                   call      'RS707R'
     c                   parm                    p_stat
     c                   parm                    p_gkod
     c                   parm                    p_tx20
      *
     c                   move      p_gkod        c19avd
     c                   movel     p_tx20        c2gtxt
      *
     c                   endif
      *
      * Kolonne 3
      *
     c                   eval      c2k300 = c2k100 - c2k200
     c                   eval      c2k301 = c2k101 - c2k201
     c                   eval      c2k302 = c2k102 - c2k202
     c                   eval      c2k303 = c2k103 - c2k203
     c                   eval      c2k304 = c2k104 - c2k204
     c                   eval      c2k305 = c2k105 - c2k205
     c                   eval      c2k306 = c2k106 - c2k206
     c                   eval      c2k307 = c2k107 - c2k207
     c                   eval      c2k308 = c2k108 - c2k208
     c                   eval      c2k309 = c2k109 - c2k209
     c                   eval      c2k310 = c2k110 - c2k210
     c                   eval      c2k311 = c2k111 - c2k211
     c                   eval      c2k312 = c2k112 - c2k212
     c                   eval      c2k314 = c2k114 - c2k214
      *
      * Kolonne 4
      *
     c                   eval      diff = c2k300
     c                   eval      saml = c2k200
     c                   exsr      brukt
     c                   eval      c2k400 = pros
      *
     c                   eval      diff = c2k301
     c                   eval      saml = c2k201
     c                   exsr      brukt
     c                   eval      c2k401 = pros
      *
     c                   eval      diff = c2k302
     c                   eval      saml = c2k202
     c                   exsr      brukt
     c                   eval      c2k402 = pros
      *
     c                   eval      diff = c2k303
     c                   eval      saml = c2k203
     c                   exsr      brukt
     c                   eval      c2k403 = pros
      *
     c                   eval      diff = c2k304
     c                   eval      saml = c2k204
     c                   exsr      brukt
     c                   eval      c2k404 = pros
      *
     c                   eval      diff = c2k305
     c                   eval      saml = c2k205
     c                   exsr      brukt
     c                   eval      c2k405 = pros
      *
     c                   eval      diff = c2k306
     c                   eval      saml = c2k206
     c                   exsr      brukt
     c                   eval      c2k406 = pros
      *
     c                   eval      diff = c2k307
     c                   eval      saml = c2k207
     c                   exsr      brukt
     c                   eval      c2k407 = pros
      *
     c                   eval      diff = c2k308
     c                   eval      saml = c2k208
     c                   exsr      brukt
     c                   eval      c2k408 = pros
      *
     c                   eval      diff = c2k309
     c                   eval      saml = c2k209
     c                   exsr      brukt
     c                   eval      c2k409 = pros
      *
     c                   eval      diff = c2k310
     c                   eval      saml = c2k210
     c                   exsr      brukt
     c                   eval      c2k410 = pros
      *
     c                   eval      diff = c2k311
     c                   eval      saml = c2k211
     c                   exsr      brukt
     c                   eval      c2k411 = pros
      *
     c                   eval      diff = c2k312
     c                   eval      saml = c2k212
     c                   exsr      brukt
     c                   eval      c2k412 = pros
      *
     c                   eval      diff = c2k314
     c                   eval      saml = c2k214
     c                   exsr      brukt
     c                   eval      c2k414 = pros
      *
     c                   endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for tømming av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     clr_subfile   begsr
      *
     c                   eval      *in14 = *on
     c                   write     b2ctl
     c                   eval      *in14 = *off
      *
     c                   eval      *in15 = *off
     c                   eval      w_srrn = 0
     c                   eval      w_sfrn = 0
     c                   eval      w_ssrn = 0
     c                   eval      w_spge = 0
      *
     c                   eval      w_dper = 0
     c                   eval      w_hitt = 0
      *
     c                   endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å fylle opp subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     crt_subfile   begsr
      *
     c                   eval      w_spge = w_spge + c_sfil
     c                   eval      w_srrn = w_ssrn
      *
     c                   dou       w_srrn = w_spge
      *
     c                   select
     c                   when      w_seqe = 'L'
     c                   read      rrf9l1
     c                   when      w_seqe = 'A'
     c                   read      rrf9l2
     c                   endsl
      *
     c                   if        %eof or
     c                             rr9fir  > w_firm or
     c                             rr9rap  > p_0rap
     c                   eval      *in15 = *on
     c                   leave
     c                   endif
      *
      * Sjekk koder
      *
     c                   if        rr9kod = 'N' or
     c                             rr9nul = 'N' or
     c                             rr9nul = 'J'
     c                   iter
     c                   endif
      *
      * Aktuelt år ?
      *
     c                   if        rr9aar <> b29aar
     c                   iter
     c                   endif
      *
      * Aktuell record-type ?
      *
     c                   if        rr9typ <> s_9typ
     c                   iter
     c                   endif
      *
      * Detaljert
      *
     c                   if        w_sude = 'D'
      *
     c                   eval      b1valg = *zeros
     c                   eval      b19avd = rr9avd
     c                   eval      b19lin = rr9lin
     c                   eval      b19txt = rr9txt
      *
     c                   exsr      beregn_sum
      *
     c                   eval      b19per = w_dper
     c                   eval      b19hit = w_hitt
      *
     c                   eval      w_srrn = w_srrn + 1
      *
     c                   write     b1sfl
      *
     c                   eval      w_dper = 0
     c                   eval      w_hitt = 0
      *
     c                   endif
      *
      * Summert
      *
     c                   if        w_sude = 'S'
      *
     c                   if        rr9lin <> s_9lin and
     c                             s_9lin <> 0
      *
     c                   eval      b1valg = *zeros
     c                   eval      b19avd = s_9avd
     c                   eval      b19lin = s_9lin
     c                   eval      b19txt = s_9txt
      *
     c                   eval      b19per = w_dper
     c                   eval      b19hit = w_hitt
      *
     c                   eval      w_srrn = w_srrn + 1
      *
     c                   write     b1sfl
      *
     c                   eval      w_dper = 0
     c                   eval      w_hitt = 0
      *
     c                   endif
      *
     c                   eval      s_9lin = rr9lin
     c                   eval      s_9txt = rr9txt
     c                   exsr      beregn_sum
      *
     c                   endif
      *
     c                   enddo
      *
      * Hvis summert og eof, legg ut siste linje
      *
     c                   if        w_sude = 'S' and
     c                             s_9lin <> 0  and
     c                             *in15 = *on
      *
     c                   eval      b1valg = *zeros
     c                   eval      b19avd = s_9avd
     c                   eval      b19lin = s_9lin
     c                   eval      b19txt = s_9txt
      *
     c                   eval      b19per = w_dper
     c                   eval      b19hit = w_hitt
      *
     c                   eval      w_srrn = w_srrn + 1
      *
     c                   write     b1sfl
      *
     c                   eval      s_9lin = 0
     c                   eval      w_dper = 0
     c                   eval      w_hitt = 0
      *
     c                   endif
      *
     c                   if        w_srrn > w_ssrn
     c                   eval      w_sfrn = w_ssrn + 1
     c                   endif
      *
     c                   eval      w_ssrn = w_srrn
     c                   eval      w_virn = w_sfrn
      *
     c                   endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å bla tilbake en side i subfilen
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     bck_subfile   begsr
      *
     c                   if        *in15
     c                   select
     c                   when      w_seqe = 'L'
     c     rrf9l1_key    setgt     rrf9l1
     c                   readp     rrf9l1
     c                   when      w_seqe = 'A'
     c     rrf9l2_key    setgt     rrf9l2
     c                   readp     rrf9l2
     c                   endsl
     c                   endif
      *
      * Leser tilbake en side
      *
     c                   eval      s_9lin = 0
     c                   eval      w_stel = 0
      *
     c                   dou       w_stel = w_ssrn + c_sfil
      *
     c                   select
     c                   when      w_seqe = 'L'
     c                   readp     rrf9l1
     c                   when      w_seqe = 'A'
     c                   readp     rrf9l2
     c                   endsl
      *
     c                   if        %eof or
     c                             rr9fir <> w_firm or
     c                             rr9rap <> p_0rap
     c                   leave
     c                   endif
      *
      * Ta bare med verdier > 0
      *
     c                   select
     c                   when      w_seqe = 'A' and
     c                             rr9avd = 0
     c                   iter
     c                   endsl
      *
      * Sjekk koder
      *
     c                   if        rr9kod = 'N' or
     c                             rr9nul = 'N'
     c                   iter
     c                   endif
      *
      * Aktuelt år ?
      *
     c                   if        rr9aar <> b29aar
     c                   iter
     c                   endif
      *
      * Aktuell record-type ?
      *
     c                   if        rr9typ <> s_9typ
     c                   iter
     c                   endif
      *
      * Detaljert
      *
     c                   if        w_sude = 'D'
     c                   eval      w_stel = w_stel + 1
     c                   endif
      *
      * Summert
      *
     c                   if        w_sude = 'S'
      *
     c                   if        rr9lin <> s_9lin and
     c                             s_9lin <> 0
      *
     c                   eval      w_stel = w_stel + 1
     c                   endif
      *
     c                   eval      s_9lin = rr9lin
     c                   endif
      *
     c                   select
     c                   when      w_seqe = 'L'
     c                   eval      rrf9l1_9lin = rr9lin
     c                   when      w_seqe = 'A'
     c                   eval      rrf9l2_9avd = rr9avd
     c                   endsl
      *
     c                   enddo
      *
     c                   if        %eof
     c                   select
     c                   when      w_seqe = 'L'
     c     rrf9l1_key    setll     rrf9l1
     c                   when      w_seqe = 'A'
     c     rrf9l2_key    setll     rrf9l2
     c                   endsl
     c                   endif
      *
      * Blanker og fyller opp subfile
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c                   endsr
      *
     c/eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for display av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     dsp_subfile   begsr
      *
     c                   if        w_srrn <> 0
     c                   eval      *in12 = *on
     c                   else
     c                   write     b2cmd
     c                   endif
      *
     c                   eval      *in13 = *on
     c                   exfmt     b2ctl
      *
     c                   eval      *in12 = *off
     c                   eval      *in13 = *off
      *
     c                   endsr
      *
      /eject
      *
      * Subrutine for beregning av differanse i %
      *
     c     brukt         begsr
      *
     c                   if        saml <> *zero
      *
     c                   if        diff / saml * 100 > 9999 or
     c                             diff / saml * 100 < -9999
     c                   eval      pros = 9999
     c                   else
     c                   eval(h)   pros  = diff / saml * 100
     c                   eval      pros = pros + 100
     c                   endif
      *
     c                   else
      *
     c                   if        diff <> *zero
     c                   eval      pros = *zeros
     c                   else
     c                   eval      pros = 100
     c                   endif
      *
     c                   endif
      *
     c                   endsr
      *
      *
      /eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Beregn sum denne periode og hittil i år                         *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     beregn_sum    begsr
      *
     c                   if        b29per = *zero
     c                   eval      w_hitt = w_hitt + isa(14)
      *
     c                   else
      *
     c                   eval      m = b29per
      *
     c                   eval      w_dper = w_dper + isa(m)
      *
     c                   eval      w_hitt = w_hitt + isa(14)
      *
     c     1             do        b29per        n
     c                   eval      w_hitt = w_hitt + isa(n)
     c                   enddo
      *
     c                   endif
      *
     c                   endsr
      *
     c/eject
      *
      * Subrutine for nullstilling av  akkumulatorer
      *
     c     nullstill     begsr
      *
     c                   eval      c2k100 = *zeros
     c                   eval      c2k101 = *zeros
     c                   eval      c2k102 = *zeros
     c                   eval      c2k103 = *zeros
     c                   eval      c2k104 = *zeros
     c                   eval      c2k105 = *zeros
     c                   eval      c2k106 = *zeros
     c                   eval      c2k107 = *zeros
     c                   eval      c2k108 = *zeros
     c                   eval      c2k109 = *zeros
     c                   eval      c2k110 = *zeros
     c                   eval      c2k111 = *zeros
     c                   eval      c2k112 = *zeros
     c***                eval      c2k113 = *zeros
     c                   eval      c2k114 = *zeros
      *
     c                   eval      c2k200 = *zeros
     c                   eval      c2k201 = *zeros
     c                   eval      c2k202 = *zeros
     c                   eval      c2k203 = *zeros
     c                   eval      c2k204 = *zeros
     c                   eval      c2k205 = *zeros
     c                   eval      c2k206 = *zeros
     c                   eval      c2k207 = *zeros
     c                   eval      c2k208 = *zeros
     c                   eval      c2k209 = *zeros
     c                   eval      c2k210 = *zeros
     c                   eval      c2k211 = *zeros
     c                   eval      c2k212 = *zeros
     c***                eval      c2k213 = *zeros
     c                   eval      c2k214 = *zeros
      *
     c                   eval      w2k100 = *zeros
     c                   eval      w2k101 = *zeros
     c                   eval      w2k102 = *zeros
     c                   eval      w2k103 = *zeros
     c                   eval      w2k104 = *zeros
     c                   eval      w2k105 = *zeros
     c                   eval      w2k106 = *zeros
     c                   eval      w2k107 = *zeros
     c                   eval      w2k108 = *zeros
     c                   eval      w2k109 = *zeros
     c                   eval      w2k110 = *zeros
     c                   eval      w2k111 = *zeros
     c                   eval      w2k112 = *zeros
     c                   eval      w2k113 = *zeros
     c                   eval      w2k114 = *zeros
      *
     c                   eval      w2k200 = *zeros
     c                   eval      w2k201 = *zeros
     c                   eval      w2k202 = *zeros
     c                   eval      w2k203 = *zeros
     c                   eval      w2k204 = *zeros
     c                   eval      w2k205 = *zeros
     c                   eval      w2k206 = *zeros
     c                   eval      w2k207 = *zeros
     c                   eval      w2k208 = *zeros
     c                   eval      w2k209 = *zeros
     c                   eval      w2k210 = *zeros
     c                   eval      w2k211 = *zeros
     c                   eval      w2k212 = *zeros
     c                   eval      w2k213 = *zeros
     c                   eval      w2k214 = *zeros
      *
     c                   endsr
      /eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppdatering av kolonneheading
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xkolon        begsr
      *
      * Legger opp heading
      * over to første kolonner
      *
     C                   select
     c                   when      v1inh1 = 'R'
     c                   movel     txt(5)        c2hed1
     c                   move      1             wk1typ
     c                   when      v1inh1 = 'B'
     c                   movel     txt(6)        c2hed1
     c                   move      3             wk1typ
     c                   when      v1inh1 = 'A'
     c                   movel     txt(7)        c2hed1
     c                   move      4             wk1typ
     c                   endsl
      *
     C                   select
     c                   when      v1inh2 = 'R'
     c                   movel     txt(5)        c2hed2
     c                   move      1             wk2typ
     c                   when      v1inh2 = 'B'
     c                   movel     txt(6)        c2hed2
     c                   move      3             wk2typ
     c                   when      v1inh2 = 'A'
     c                   movel     txt(7)        c2hed2
     c                   move      4             wk2typ
     c                   endsl
      *
     c                   movel     txt(8)        c2hed3
     c                   movel     txt(9)        c2hed4
      *
      * Legger opp årstall
      * i de to første kolonner
      *
     c                   movel     v1aar1        wk1hlp
     c                   movel     v1aar2        wk2hlp
     c                   move      wk1hlp        c2hed1
     c                   move      wk2hlp        c2hed2
      *
     c                   endsr
      /eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
     c     *entry        plist
     c                   parm                    p_0rap                         Rapport
      *
      * Key for les av rapport
      *
     c     rrf0l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rrf0l1_0rap
      *
      * Key for posisjonering på linje
      *
     c     rrf9l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rrf9l1_9rap
     c                   kfld                    rrf9l1_9lin
     c                   kfld                    rrf9l1_9avd
     c                   kfld                    rrf9l1_9aar
     c                   kfld                    rrf9l1_9typ
      *
      * Key for les av linje
      *
     c     rrf9l3_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rrf9l3_9rap
     c                   kfld                    rrf9l3_9lin
      *
      * Key for posisjonering på avdeling
      *
     c     rrf9l2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rrf9l2_9rap
     c                   kfld                    rrf9l2_9avd
     c                   kfld                    rrf9l2_9lin
      *
      * Henter firmanummer fra LDA
      *
     c                   eval      w_firm = l_firm
      *
     c                   eval      rrf9l1_9rap = p_0rap
     c                   eval      rrf9l2_9rap = p_0rap
     c                   eval      rrf9l3_9rap = p_0rap
     c                   eval      rrf0l1_0rap = p_0rap
      *
     c                   eval      *in22 = *on
      *
      * Posisjonerer databasen, og fyller opp subfile
      *
     c                   eval      wk1typ = *zero
     c                   eval      wk2typ = *zero
     c                   eval      wk3typ = *zero
     c                   eval      wk4typ = *zero
     c                   eval      n = *zero
     c                   eval      wk1hlp = *blank
     c                   eval      wk2hlp = *blank
      *
      * Legge inn år/periode
      *
     c                   move      *month        b29per
     c                   move      *year         b29aar
      *
     c                   move      b29aar        s_9aar
     c                   move      b29per        s_9per
      *
      * Legge inn record-type
      *
     c                   move      1             s_9typ
      *
      * Legge inn standard valg for kolonner
      *
     c                   move      'R'           v1inh1
     c                   move      'B'           v1inh2
     c                   move      b29aar        v1aar1
     c                   move      b29aar        v1aar2
      *
     c                   exsr      xkolon
      *
      * Legge inn kode som viser første sett av kommandotaster
      *
      * Legge inn kode for saldo/bevegelse
      *
     c                   eval      w_sabe = 1
      *
      * Legge inn kode for sum/detalj
      *
     c                   move      'S'           w_sude
      *
      * Hent inn rapporttekst
      *
     c     rrf0l1_key    chain     rrf0l1                             63                     .
      *
     c                   eval      b20rap = rr0rap
     c                   eval      b20txt = rr0txt
     c                   eval      c10rap = rr0rap
     c                   eval      c20txt = rr0txt
      *
     c                   eval      w_seqe = 'L'
     c                   eval      rrf9l1_9rap = rr0rap
     c                   eval      rrf9l1_9lin = 0
     c                   eval      rrf9l1_9avd = 0
     c     rrf9l1_key    setll     rrf9l1
     c                   exsr      crt_subfile
      *
     c                   endsr
      /eject
**
   Spørring på saldo       001
Sum alle avdelinger        002
Ledig ...                  003
Ledig ...                  004
 Regnskap                  005
 Budsjett                  006
 Alt.buds                  007
  Differanse               008
 Brukt/oppnådd             009
