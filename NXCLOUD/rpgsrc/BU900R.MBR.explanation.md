# RPG Program Explanation: BU900R

This source code is for an IBM i (AS/400) ILE RPG program named **BU900R**. Its main purpose is to **prepare and call an export program (BU700C) with specific parameters** related to a retail (butikk/PC-kasse) system. It reads in parameters, processes them as required, and passes them to another program for actual data export.

---

## Header and Documentation

- **`h option(*nodebugio) datedit(*dmy)`**
  - `*nodebugio`: Disables debugging of input/output operations.
  - `datedit(*dmy)`: Sets the default date format to day/month/year for input/output editing.

- **Comments block**
  - Describes the program, its creator, date (2022-06-04), and purpose ("Eksport av tabeller til PC-kasse" = Export of tables to the PC register/point of sale system).

---

## Parameter Definitions

These variables will be received as parameters when the program is called.

```rpg
d p_dlib          s             10
d p_kass          s              3
d p_firm          s              3
d p_dato          s              8
d p_time          s              6
```

- **p_dlib**: Library name (10 characters)
- **p_kass**: Register number or POS ID (3 characters)
- **p_firm**: Company code (3 characters)
- **p_dato**: Date as an 8-character string (e.g., YYYYMMDD)
- **p_time**: Time as a 6-character string (e.g., HHMMSS)

---

## Working Variable Definitions

```rpg
d w_firm          s              3  0
d w_dato          s               d   datfmt(*iso)
d w_time          s               t   timfmt(*iso)
d w_dato_8        s              8  0
d w_time_6        s              6  0
```

- **w_firm**: Numeric company code, 3 digits
- **w_dato**: Date variable in ISO format (`*iso`)
- **w_time**: Time variable in ISO format (`*iso`)
- **w_dato_8**: 8-digit numeric date
- **w_time_6**: 6-digit numeric time

---

## Main Program Logic

1. **Prepare Parameters for Export**

   - Move `p_firm` (character) to `w_firm` (numeric).
   - Move `p_dato` to `w_dato_8` (numeric).
   - If `w_dato_8` is not zero:
     - Convert `p_dato` (character) into `w_dato` (date) using `*ymd0` format.
   - Move `p_time` to `w_time_6` (numeric).
   - If `w_time_6` is not zero:
     - Convert `w_time_6` into `w_time` (time) using `*hms` format.

2. **Call Export Program (`BU700C`)**

   - Pass the following parameters to `BU700C`:
     - `p_dlib` (library)
     - `p_kass` (register)
     - `w_firm` (company code, as numeric)
     - `w_dato` (date, as ISO date)
     - `w_time` (time, as ISO time)

3. **Exit Program**

   - Sets LR (`*inlr`) on for end-of-job cleanup.
   - Returns.

---

## Initialization Subroutine (`*inzsr`)

This subroutine is executed automatically at program start.

- **Defines the parameter list (`plist`)** so that the parameters are properly received when the program is called.
- Each `parm` statement in `*inzsr` binds an external parameter to a variable.

---

## Summary

- **BU900R** is responsible for receiving parameters, performing format conversions (especially for date and time), and calling another program (`BU700C`) to execute the export logic.
- All data validation/conversion is handled before the call, ensuring the export program receives correctly typed parameters.
- The structure is typical of "wrapper" or "dispatcher" RPG programs that mediate between higher-level processes and specialized exports.

---

### Key Points for Onboarding

- You may need to update/add parameter handling if the calling interface changes.
- Date and time conversions are critical to ensure data is formatted correctly for `BU700C`.
- The main export logic is **not** in this program, but in `BU700C`; this program is a preparatory/front-end module.
- If extending, maintain the logic around parameter validation and conversion to avoid runtime errors.