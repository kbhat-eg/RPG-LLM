# RPG Program AA017R - Number Series Maintenance  
This program is a classic IBM i (AS/400) ILE RPG program for maintaining number series ("nummerserier") in a database. It's designed for interactive use with an application display file (DDS-based screens with subfiles and control records).

## High-Level Purpose

- **Maintain number series**: Create, update, display, copy, and delete number series records in the database.
- **Support for 8-digit series**: Recent changes allow certain series to use up to 8 digits, with checks against a status register.
- **User interface**: Uses a subfile-based screen for listing and working with number series.
- **Navigation**: Supports scrolling, positioning, and editing in the subfile.

---

## 1. Program Structure

- **Header (`H`) specification**:  
  - `*NODEBUGIO`: No debugging for I/O operations.  
  - `*DMY` date editing: Dates in DD/MM/YY format.

- **File Declarations (`F`)**:  
  - Logical and physical files for number series (various views/keys for different operations).  
  - Display file (`AA017D`) for interactive screens using subfiles.  
  - Data structures for feedback from display (`INDS`).

- **Data Definitions (`D`)**:
  - **LDA (Local Data Area)** mapping for user, company, etc.
  - **Feedback data structures** for display file handling.
  - **Variables** for keys, internal work fields, and flags/indicators.

---

## 2. Special Comments

- **Indicators** are mapped (e.g. `*IN10` = rollup, `*IN11` = rolldown, etc.)
- **Screen layouts** are described (B1SFL, B2CTL, etc.)

---

## 3. Main Program Loop

The core logic has an interactive loop for the subfile-based screen. The main tags indicate a cycle:

- `b2taga` / `b2tagb`:  
  - `write b2cmd`: Output command key screen (function keys, etc.).
  - `exsr dsp_subfile`: Display the current subfile page.

- **Function Keys Processing** (`SELECT/WHEN`):
  - `*INKC`, `*INKL`: Exit (goto `avslutt`)
  - `*INKE`: Refresh (exsr `forny` and redisplay)
  - `*INKF`: Create new row (`xc1bld` subroutine - creation window)
  - `*IN10`: Page Down (create/next subfile page)
  - `*IN11`: Page Up (back one subfile page)
  - `*IN21`: Home key (move cursor to entry fields)
  - **Otherwise**: If position fields filled, position using `posisjoner` subroutine.

- **Subfile maintenance**:  
  - `exsr subfile`: Handles user actions on the current subfile page.

- **Exit**:  
  - Tag `avslutt`: Set `*INLR` to *ON (end RPG program).

---

## 4. Key Subroutines

### `forny` (Refresh Subfile)
- Repositions and reloads the subfile based on the current selection/key.

### `posisjoner` (Position within Subfile)
- Allows positioning based on company (`firm`) or identifier (`fell`).
- Reinitializes subfile content after repositioning.

### `subfile` (Process Subfile Rows)
- Loops through subfile rows (readc)
- Handles actions:
  - **2**: Edit (calls `xc2bld`)
  - **3**: Copy (calls `xk1win`)
  - **4**: Delete (calls `xd1win`)
  - **5**: View (calls `xc2bld` for view-only)
- Updates screen and subfile as needed after each line.

### `xc1bld` (New Row Creation Screen)
- Shows window for creating a new number series entry.
- Validates input, checks for duplicates, and then calls `xc2bld` for further maintenance.

### `xc2bld` (Display/Create/Edit/View Row)
- Handles the edit/view screen for a number series row.
- Validates fields, checks ranges, and enforces business rules:
  - High/low number checks (no overlap)
  - Only particular series allow 8 digits
  - Updates or inserts the row as appropriate.

### `xd1win` (Delete Row Confirmation)
- Display confirmation window and deletes the number series row if confirmed.

### `xk1win` (Copy Row)
- Presents copy dialog and logic to duplicate an existing series under new keys.

### `clr_subfile` / `crt_subfile` (Clear/Create Subfile)
- Clear subfile (write control record with clear indicators)
- Create next page of subfile lines (for scrolling or after position/refresh)

### `bck_subfile` (Scroll Back Subfile)
- Scrolling logic to back up one page in the subfile (Page Up).

### `dsp_subfile` (Display Subfile)
- Shows the B2CTL screen and manages cursor positioning.

---

## 5. Init (`*INZSR` subroutine)

- Sets up all key lists for file access.
- Reads status registers (for 8-digit numbers check).
- Positions to the start and loads the first subfile page.

---

## 6. File Usage

- **anuml1/anuml2/anumlr/anumlu**: Logical files over the number series base physical file. Used for reading/positioning/editing under different keys (by firm, identifier, etc.).
- **fstsl1/lstsl1/bstsl1**: Status files to check if certain number series are eligible for 8 digits.

---

## 7. User Actions & Flow

**The user interface supports:**
- Listing all number series in a subfile, with paging.
- Positioning within the list using identifier/company fields.
- Creating new number series entries.
- Editing, copying, deleting, or viewing series via function code per line.
- Input validation, duplicate prevention, and business logic (such as only certain series allow 8 digits).

---

## 8. Indicators & Special Fields

- Many *INxx indicators control screen appearance and user input (e.g., message line, protect fields).
- Internal variables keep track of subfile paging, record numbers, and user selection/action.

---

## 9. Business Rules Highlights

- Only specific series (by identifier) permit use of 8 digits.
- Number ranges must be valid (low number < high number, no overlap with shared series).
- Prevents duplicate entries on create & copy.
- Ensures data is always updated in the subfile after changes.

---

## 10. Comments & Change Log

- The top section includes a detailed change log and business explanations (in Norwegian), as well as indicator and field usage explanations.

---

## 11. Summary

This is a well-organized, traditional, interactive RPG program for maintaining number series in a multi-company environment, with a strong focus on validation, user feedback, and efficient subfile handling, supporting advanced functions such as copy, delete, range checks, and conditional 8-digit numbering. The code is verbose but clear, using subroutines extensively, and comments are in Norwegian.

---

## Onboarding Tips

- **Read the comments**: They describe both logic and business rules in detail.
- **Understand the subfile pattern**: Core to the UI.
- **Familiarize with indicator usage**: RPG uses *INxx for almost everything GUI-related.
- **Business logic is enforced in subroutines**, especially around editing/creating rows and range checks.
- **Status files logic**: Understand when 8-digit series are allowed.
- **Display file** (`AA017D`): Know the screen layouts, as the screens (`B1SFL`, `B2CTL`, etc.) connect directly to the code.

This should allow a developer new to this program to get oriented quickly and understand how to both maintain and extend it.