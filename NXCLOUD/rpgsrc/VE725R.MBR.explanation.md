```markdown
## Program Overview

This ILE RPG program, named `VE725R`, retrieves product information (item number, NOBB number, and unit) based on a supplied GTIN/EAN number and company identifier. It returns these details along with a status flag indicating if the lookup was successful.

Key functions:
- Input: `firma` (company), `eannr` (GTIN/EAN number)
- Output: `vare` (item number), `enhet` (unit), `nobb` (NOBB number), `status` (1=ok, blank=not found)

---

## File Declarations

Each file is defined as an externally-described file (`IF`), end of file enabled (`E`), keyed access (`K`), and references a specific record format:
- `vvepl2` (`vveppfr` as `vvepl2r`): Likely a product-unit cross-reference.
- `veanl1` (`veanpfr` as `veanl1r`): Probably EAN/GTIN to item cross-reference.
- `vvarl1` (`vvarpfr` as `vvarl1r`) and `jvarl1` (`jvarpfr` as `jvarl1r`): Item master records (for different divisions or system areas).
- `jvpkl3` and `jvppl2`: Additional reference files, possibly for packaging or alternate GTIN management.

---

## Variable Definitions

- **Key variables**: Used in chained access to each file, e.g. `vvepl2_pfir`, `vvepl2_pgti`.
- **Parameter variables**: The six main parameters passed in/out to the program:
  - `p_firm`: company
  - `p_eann`: EAN/GTIN number
  - `p_vare`: item number (output)
  - `p_enhe`: unit (output)
  - `p_nobb`: NOBB-number (output)
  - `p_stat`: status flag (output, 1=ok)

---

## Mainline Logic

1. **Initialize Output Parameters**
   - Set `p_vare` and `p_enhe` to blank, `p_nobb` to zero, and `p_stat` to blank.

2. **Check for Null EAN**
   - If `p_eann` (input EAN) is zero, exit immediately.

3. **Primary Lookup: Product-Unit Register**
   - Set keys (`vvepl2_pfir`, `vvepl2_pgti`) and do a `CHAIN` on `vvepl2`.
   - If found, move item and unit to outputs, set status to '1'.

4. **Secondary Lookup: EAN Register**
   - If not found above, set keys and `CHAIN` `veanl1` for company and EAN.
   - If found, move item to output, set status to '1'.

5. **Lookup NOBB Number**
   - If status is '1' (found in either previous step), set `vvarl1_vare` and `CHAIN` `vvarl1` using company and item number.
   - If found, move NOBB number to output.

6. **Alternate Area Lookup (VA system)**
   - If not found in the first two places, attempt to find GTIN/EAN for the VA system (newer logic in version 6.30).
   - (Earlier logic for `jvppl2` is commented out.)
   - Set `jvpkl3_gtin` to input EAN and `CHAIN` `jvpkl3`.
   - If found, move item to output and set status to '1'.
   - Attempt to get NOBB number from `jvarl1` using item number (from VA area).

7. **Program End**
   - Set *INLR (last record indicator) to *ON to end the program.

---

## Parameter List Setup (*INZSR Subroutine)

- Defines the parameter list and how internal variables map to RPG parameters.
- Sets up RPG key lists (`KLIST`) for each logical file, specifying which fields make up the key for each `CHAIN` operation.

---

## Error Handling

- The program uses status flags and blanks to indicate not found conditions.
- There is no explicit error message handling; outputs will be blank or zero if not found.

---

## Notes

- **NOBB Number**: A unique product identification number used in the Norwegian building and construction market.
- **GTIN/EAN**: Global Trade Item Number / European Article Number (barcodes).
- **CHAIN**: RPG operation to randomly fetch a record by key.
- **%FOUND**: Built-in function to check if the previous file operation found a record.

---

## Summary Table

| Input(s)    | Where it looks           | Output(s) if found     | Fallback     |
|-------------|--------------------------|------------------------|--------------|
| firma/eannr | vvepl2 (product/unit)    | vare/enhet/stat='1'    | veanl1 (ean) |
| firma/eannr | veanl1 (ean register)    | vare/stat='1'          | VA system    |
| p_vare      | vvarl1                   | nobb                   |              |
| firma/eannr | jvpkl3 (VA system, GTIN) | vare/stat='1'          |              |
| p_vare      | jvarl1 (VA system)       | nobb                   |              |

---

## Code Flow Visual

```text
Begin
   ↓
Init outputs (blank/zero)
   ↓
If EAN input = 0 → Exit
   ↓
Try vvepl2 (Product/Unit cross) by company+EAN
   ↓    Yes: set outputs and status '1'
   |    ↓
   |  Try vvarl1 for NOBB by item
   ↓ No
Try veanl1 (EAN register) by company+EAN
   ↓    Yes: set outputs and status '1'
   |    ↓
   |  Try vvarl1 for NOBB by item
   ↓ No
Try VA area: jvpkl3 by EAN
   ↓    Yes: set outputs and status '1'
        ↓
     Try jvarl1 for NOBB by item
End (set INLR)
```

---

## Why is this code written this way?

- To maintain compatibility with multiple product master sources (main vs. VA).
- To provide a single interface for item lookup by EAN/GTIN, regardless of product origin.
- The logic is stepwise: primary source first, then fallback to alternates, ensuring robustness.

---

## Key Terms

- **CHAIN**: Retrieve disk records by key.
- **KLIST/KFLD**: Key lists/fields, used for keyed access.
- **%FOUND**: Returns *ON if previous CHAIN succeeded.
- **NOBB**: Norwegian Building and Construction product number.
- **GTIN/EAN**: Barcoding standards.
- **INLR**: End program and release open files.

---

## Version Notes

- Lines prefixed with `6.30` or `*` indicate changes or additions for a specific version or functionality.
- VA (likely "Vareadministrasjon") is a specific area/system added for new packaging routines.

---

## Onboarding Tips

- Understand your company's product master architecture (main and VA areas).
- When debugging, test with EANs that exist in both main and VA to see the fallback logic.
- To extend, add new sources by following the established conditional chain.
```
