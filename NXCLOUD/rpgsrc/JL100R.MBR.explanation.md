# IBM ILE RPG Program JL100R – Explanation

This RPG program implements a maintenance screen for suppliers ("Leverandør, vedlikehold") with subfile support for searching, displaying, creating, updating, copying, and deleting supplier records. It’s a typical DDS-based (5250 green-screen) interactive program centered around database files and subfile-driven screens.

Below is a detailed walkthrough of the program’s structure, data, and logic.

---

## 1. **Header and Description**

The comments at the top describe:
- The system, program ID, and a functional description.
- Revision history for maintainers, including dates and code changes.
- References to indicator usage (what function keys or indicators like LR, IN10–IN99 are used for).

---

## 2. **File Declarations**

```rpg
fjlevl1    if   e           k disk    rename(jlevpfr:jlevl1r)
fjlevl2    if   e           k disk    rename(jlevpfr:jlevl2r)
fjlevlr    if   e           k disk    rename(jlevpfr:jlevlrr)
fjle9lr    if   e           k disk    rename(jle9pfr:jle9lrr)
fjlevlu    uf a e           k disk    rename(jlevpfr:jlevlur)
fjle9lu    uf a e           k disk    rename(jle9pfr:jle9lur)
frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
fjl100d    cf   e             workstn sfile(b1sfl:w_srrn)
f                                     infds(dspfbk)
```

- **Database Files** (jlevl1, jlevl2, etc): Logical/physical files for supplier master, additional registers.
- **Subfile**: `j100d` is a display file supporting subfile mode (`sfile(...)`).
- **INFDS**: Used for access to low-level display feedback (e.g. cursor pos).

---

## 3. **Variables and Data Structures**

- **Local Data Area (LDA)**: Standard location for user, company/firm, etc. (extracted from the LDA).
- **Display Feedback Structure**: Holds cursor info.
- **Supplier Keys**: Temporary variables to hold keys for chains/read operations.
- **Subfile Control Variables**: `w_fcrn`, `w_srrn`, etc., manage paging/records in subfile.
- **Flags/Indicators**: Like `b_oppr`, `b_forn`, `b_anul`, etc. mark states for add, refresh, cancel, etc.

---

## 4. **Subfile Window/Page Management**

The variables like `w_fcrn`, `w_srrn`, etc. help manage which records appear in the subfile and the current position/page. This supports paging/scrolling in the display.

---

## 5. **Constants**

```rpg
d c_sfil s 2 0 inz(13)
```
- Subfile page size: 13 records per subfile page.

---

## 6. **Program Logic: Mainline**

The main processing loop (`b2taga`/`b2tagb`) waits for user interaction, displays subfiles, and interprets function keys (F-keys) or commands. Actions are handled depending on the function key pressed (Add, Update, Delete, Search, Paging, etc.).

### **Function Key Handling**
- **F3/F12/Exit**: End program.
- **F5 (forny)**: Refresh.
- **F6 (ny rad)**: Add new record.
- **F10/F11**: Page up/down.
- **F9 (gjenta søk)**: Repeat last search.
- **Positioning/Search**: If user entered positioning fields, move to correct place.

---

## 7. **Subroutines**

### **forny**
- Refreshes the subfile based on last state: search or logical/physical order.

### **søk**
- Handles advanced search: calls external program AS701R to parse search text into up to 5 search strings.
- Refreshes subfile based on these search parameters.

### **posisjoner**
- Moves directly to a supplier or to a name depending on the input fields.

### **subfile**
- Processes a "page" of subfile interaction, such as selection of a row for Edit, Copy, Delete, View, or links to related programs (contacts, GS1 location).
- For each row, checks what the user did and acts accordingly.

### **xc1bld**
- Handles the "Create new" screen. Handles logic for prevent duplicate key, validation, and then calls editing.

### **xc1msg**
- Shows a message window if trying to create a record which already exists.

### **xc2bld**
- Handles "Edit/View" supplier entry.
- Loads data for editing, allows update, validates input, and writes changes back to file.

### **xd1win**
- Handles the "Delete" window: fetch, prompt for confirm, then delete supplier record.

### **xk1win**
- Handles the "Copy" window: similar to Add but starts with another record as template.

### **clr_subfile**
- Clears the subfile from screen/buffer, resets subfile pointers.

### **crt_subfile**
- Builds/fills the subfile from the database, using either:
  - Search cursor/criteria (via embedded SQL)
  - Logical/physical file (reads).

### **bck_subfile**
- Scrolls subfile page backward (page up).

### **dsp_subfile**
- Manages display of the subfile window, enables indicators for subfile control records.

### **\*inzsr**
- Initialization subroutine:
  - Sets up key lists for chain/read/setll operations.
  - Loads firm/company from LDA.
  - Optionally calls external program 'CO402R' to configure some flags.
  - Fills subfile with initial data.

---

## 8. **Special/External Calls**

- **AS701R**: Parses raw search text into up to 5 search patterns for SQL LIKE statements.
- **CO402R**: Configuration/program options, used to enable/disable certain screen features.
- **JL110R, JL111R**: Jump to related contact and GS1 location programs.
- **RL500R**: Used to select customer (EVR) for linking supplier to customer.

---

## 9. **Embedded SQL**

Used for advanced text search in the main supplier file. Constructs a dynamic cursor query matching up to five LIKE-pattern search tokens (case-insensitive, concatenates several fields to allow flexible multi-field searching).

---

## 10. **Indicator Usage**

Indicators (e.g. *IN10, *IN11) are used for subfile and screen control, error/status flags, etc. Comments document their purpose.

---

## 11. **Display File (DDS) Integration**

References to screen formats:
- **B1SFL**: Main supplier subfile.
- **B2CTL/B2CMD**: Subfile controls/screens for commands.
- **C1BLD/C2BLD**: Create/Edit/Display Supplier screens.
- **K1WIN/D1WIN**: Windows for copy/delete confirmations.
- **C1MSG**: Informational window when attempting to add a duplicate record.

---

## 12. **General Remarks**

- **Modularized with subroutines**: Clear separation of each function in maintenance cycle.
- **Extensive use of external programs**: For search parsing, configuration, and drill-downs.
- **SQL Integrated**: For flexible search.
- **Traditional RPG IV style**: Uses both legacy and newer RPG IV/ILE syntax.
- **Change history and structure**: Well documented, with major enhancements tracked.

---

## 13. **Typical User Flow**

1. Program starts, initializes, and loads the current list of suppliers into a subfile.
2. User can scroll, search, position, or use function keys for operations (add, edit, copy, delete, drill-down).
3. All operations occur on subfile entries, with updates flowing back to the database. Related data (contacts, GS1 location) is accessible.
4. Adding or copying uses dedicated popups, with validation and feedback.
5. Program ends gracefully on exit F-keys.

---

## 14. **Onboarding Advice**

- **Understand Subfile Handling**: The central interaction is the subfile (paging, searching, selecting).
- **Indicator Mapping**: Pay attention to what each indicator is connected to in the DDS.
- **Key Lists and Database Chains**: Note how all database access is based on key lists for setll/chain/read.
- **External Programs**: Know what each called program (AS701R, JL110R, etc.) does.
- **Search Logic**: Embedded SQL is used for robust, multi-field search with flexible input.

---

**Summary**:  
This is a classic supplier maintenance ("master file") RPG program using the green-screen subfile architecture. It allows users to search, browse, and maintain supplier data, including links to related tables. The program structure is modular, with clear subroutines for each function, leverages embedded SQL for searching, and is heavily documented for future maintainers. 

Familiarity with RPG's traditional cycle, indicators, and DDS-based subfile programming is essential for effective onboarding and maintenance.