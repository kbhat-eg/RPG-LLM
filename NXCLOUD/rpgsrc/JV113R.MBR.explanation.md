# RPG Program JV113R — Alternative Item Number Maintenance

This program (JV113R) is designed for interactive maintenance of alternative item numbers in an IBM i (AS/400) environment using ILE RPG. It uses subfiles for list display and supports create, read, update, delete, and copy operations via workstation screens.

## 1. **Header and Documentation**

- `h option(*nodebugio) datedit(*dmy)`  
  Specifies debug and date format options.

- Extensive **comment block** describes:
    - Program/system name, purpose, and change log
    - Use of indicators: LR, function keys, subfile operations, and custom indicators (see the indicator map in comments)
    - Explanation of common variables and screen usage

## 2. **File Declarations**

- Files **JV113d** (display/workstation, i.e., screen), `jvarl3`, `jvall1`, `jvall2`, `jvallr`, `jvallu` for database access (DISK).
- Subfile `b1sfl` is defined on the workstation file.
- Display file uses an *information data structure* (`dspfbk`) to handle display feedback (e.g., cursor position).

## 3. **Data Definitions**

- **User data structure (LDA)**: For user, company, and program name (`l_user`, `l_firm`, `l_fnav`).
- **Cursor/counter variables**: Track subfile records, pages, and positions.
- **Work variables**: For navigation, sequence, error flags, and current keys.
- **Constants**: Such as number of lines per page (`c_sfil`).
- **Key variables**: For building record keys for chain/setll/read/readp operations.

## 4. **Field and Subfile Documentation**

- Comments explain the purpose of variables used for subfile control (e.g., `w_fcrn` = first record number on page).
- Subfile screens used (B1SFL, B2CTL, etc.) are listed.

## 5. **Main Processing Loop**

### The mainline logic falls into a tag/branch structure:

- **Tag `b2taga`**:  
  Initial step; write command screen.

- **Tag `b2tagb`**:  
  - Calls `dsp_subfile` to display the subfile.

- **Function Key Handling via `select/when`**:
    - Exit on F3/F12
    - Refresh (`forny`)
    - Add (`xc1bld`)
    - Roll up/down subfile page (`crt_subfile`, `bck_subfile`)
    - Home-key navigation
- **Positioning:** If position fields are entered, call `posisjoner` subroutine.

- **Subfile handling:**  
  Calls `subfile` subroutine to process entries.

- **Program end:**  
  Sets LR on and returns.

## 6. **Subroutines**

### a. **forny** — Refresh Subfile
- Reposition in data based on first record number.
- Uses the sequence to determine key, positions with setll.
- Clears and recreates the subfile.

### b. **posisjoner** — Subfile Positioning
- Positions based on type or alternative.
- Resets subfile and positional fields after positioning.

### c. **subfile** — Process Subfile Entries
- Toggles a work indicator.
- Reads the subfile (readc loop), processes each entry for:
    - Edit (valg = 2): Calls `xc2bld`
    - Copy (3): Calls `xk1win`
    - Delete (4): Calls `xd1win`
    - Display (5): Calls `xc2bld` in display mode
- If changes made (`b_forn` on), refreshes subfile.

### d. **xc1bld** — New Row Entry
- Handles screen for new entry.
- Validates, checks for duplicates, and calls main maintenance subroutine (`xc2bld`).

### e. **xc1msg** — Entry Exists Prompt
- If entry already exists, shows message window.
- Can be cancelled with F12/F3.

### f. **xc2bld** — Edit/Display Row
- Shows edit/display screen and writes changes to file.
- Handles input validation, update/insert logic, and subfile refresh triggers.

### g. **xd1win** — Delete Row
- Reads record, shows delete window, deletes if confirmed.

### h. **xk1win** — Copy Row
- Fills copy screen, validates input, checks for duplicate key, calls maintenance subroutine to create the copy.

### i. **clr_subfile** — Clear Subfile
- Clears/initializes the subfile and related variables.

### j. **crt_subfile** — Create Subfile Page
- Fills the subfile with up to one page of records, controlled by `c_sfil`.

### k. **bck_subfile** — Page Back Subfile
- Pages backward in subfile by `c_sfil` lines.

### l. **dsp_subfile** — Display Subfile
- Formats and shows the control screen for subfile.

### m. **\*inzsr** — Program Initialization
- Entry point: receives parameters, positions files, and initializes subfile display.

### **Key Lists**
- Defines KLISTs for all needed file I/O operations.

---

## 7. **Indicators Used**
- *Input and output indicators are extensively used* for display file communication (subfile control, navigation, error display, etc.)

---

## 8. **General Workflow**

1. **Startup**: Receives parameters (item number, selection).
2. **Displays subfile**: Fills with alternative numbers.
3. **User can**:
    - Page, position, select entry (edit/copy/delete/view), or add new.
    - Use function keys for navigation and actions.
4. **After operation**: Subfile is refreshed if needed.
5. **Exit**: On F3/F12, program ends.

---

## 9. **Summary Table: Important Variables and Usage**

| Variable      | Purpose                               |
|---------------|---------------------------------------|
| `w_bnob`      | Current item number                   |
| `w_srrn`      | Relative record number in subfile     |
| `b1valg`      | User action in subfile row            |
| `b_forn`      | Refresh subfile flag                  |
| `b_oppr`      | "Add" mode indicator                  |
| `b1btyp/bvar` | Current keys in subfile               |
| `jvallu/jvall1/2/r` | File buffers for I/O            |
| `*inxx`       | Display file indicators (see comments)|
| `c_sfil`      | Subfile page size constant (13)       |

---

## 10. **Common Scenarios and Controls**

- Subfile supports **add, edit, copy, delete, and view**.
- Use of `select/when` for function key handling is idiomatic in RPG.
- Subroutines are used for clarity and modularity.

---

## 11. **Important Notes for Onboarding**

- **Subfile structure and navigation**: Review the display file (DDS) for B1SFL, B2CTL, etc.
- **Indicator usage**: Check display DDS for mapping of *INxx indicators to buttons/fields.
- **Key lists**: Understand how key lists (`klist`) work for database record access.
- **Enhancements**: To modernize, consider RPG IV free-format and modular data access.

---

**In summary, this program provides a robust and classic RPG subfile-based maintenance facility for alternative item numbers, with full navigation and data management capabilities.**