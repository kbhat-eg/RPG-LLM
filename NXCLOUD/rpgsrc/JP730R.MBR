     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASVADM
      * Program . . . . : JP730R
      * Beskrivelse . . : Oppdater fra NIB, betingelser/rabattelementer
      *
      *                   Oppdaterer/oppretter betingelser/rabattelem.
      *                   fra Norgros/NIB (XML-format)
      *
      *                   Regler for oppdat. som for innlesning fra
      *                   NOBB kontrakt
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       151105 GRo  Nytt program
6.20  *       110914 bof  Hvis Farveringen, så aktiviseres det på bet.-nivå
6.3x  *       160915 bof  Utvidet med prisgruppe på betingelse
6.32  *       281019 bof  Skal ikke sjekke mot JBEWPF ELLER JRAWPF I NIB OPPD.
8.01  *PRG2   140622 BOF  Utvidet prisgruppe fra 1 til 2 posisjoner
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fnxbepf    uf   e           k disk
     fjvarl3    if   e           k disk    rename(jvarpfr:jvarl3r)
     fjbetl1    if   e           k disk    rename(jbetpfr:jbetl1r)
     fjbetla    if   e           k disk    rename(jbetpfr:jbetlar)
     fjbetlu    uf a e           k disk    rename(jbetpfr:jbetlur)
     fjraelu    uf a e           k disk    rename(jraepfr:jraelur)
     fjstsl1    if   e           k disk    rename(jstspfr:jstsl1r)
6.3x fjbewl1    if   e           k disk    rename(jbewpfr:jbewl1r)
6.3x fjrawl1    if   e           k disk    rename(jrawpfr:jrawl1r)
     f                                     prefix(jpw:3)
6.3x fra30l1    if   e           k disk    rename(ra30pfr:ra30l1r)
      *
      * Definering av parametre
      *
     d p_firm          s              3  0
      *
      * Definering av Local Data Area
      *
     d                uds
     d l_user                911    920
      *
      *  Dataelementer leverandør
      *
     d                 ds
     d d_lrec                        20
     d  d_levn                        6    overlay(d_lrec:1)
     d   d_levn_num                   6  0 overlay(d_levn:1)
     d  d_stat                        1    overlay(d_lrec:7)
     d   d_stat_num                   1  0 overlay(d_stat:1)
      *
      *  Dataelementer betingelse
      *
     d                 ds
     d d_brec                       150
     d  d_ogrp                        2    overlay(d_brec:1)
     d   d_ogrp_num                   2  0 overlay(d_ogrp:1)
     d  d_hgrp                        2    overlay(d_brec:3)
     d   d_hgrp_num                   2  0 overlay(d_hgrp:1)
     d  d_ugrp                        3    overlay(d_brec:5)
     d   d_ugrp_num                   3  0 overlay(d_ugrp:1)
     d  d_modn                        8    overlay(d_brec:8)
     d   d_modn_num                   8  0 overlay(d_modn:1)
     d  d_vare                        8    overlay(d_brec:16)
     d  d_nobb                        8    overlay(d_brec:24)
     d   d_nobb_num                   8  0 overlay(d_nobb:1)
     d  d_leve                        1    overlay(d_brec:32)
     d   d_leve_num                   1  0 overlay(d_leve:1)
     d  d_bkey                       10    overlay(d_brec:33)
     d   d_bkey_num                  10  0 overlay(d_bkey:1)
     d  d_btxt                       35    overlay(d_brec:43)
     d  d_bfda                       10    overlay(d_brec:78)
     d   d_bfda_iso                    d   overlay(d_bfda:1) datfmt(*iso)
     d  d_btda                       10    overlay(d_brec:88)
     d   d_btda_iso                    d   overlay(d_btda:1) datfmt(*iso)
     d  d_bakt                        1    overlay(d_brec:98)
     d   d_bakt_num                   1  0 overlay(d_bakt:1)
     d  d_boda                       10    overlay(d_brec:99)
     d   d_boda_iso                    d   overlay(d_boda:1) datfmt(*iso)
     d  d_beda                       10    overlay(d_brec:109)
     d  d_beti                       10    overlay(d_brec:119)
      *
      *  Dataelementer rabattelement
      *
     d                 ds
     d d_rrec                       150
     d  d_rkey                       10    overlay(d_rrec:1)
     d   d_rkey_num                  10  0 overlay(d_rkey:1)
     d  d_rtxt                       35    overlay(d_rrec:11)
     d  d_regl                        1    overlay(d_rrec:46)
     d  d_verd                       10    overlay(d_rrec:47)
     d   d_verd_hex                   7    overlay(d_verd:1)
     d   d_verd_hel                   7  0 overlay(d_verd_hex:1)
     d   d_verd_dex                   2    overlay(d_verd:9)
     d   d_verd_des                   2  2 overlay(d_verd_dex:1)
     d  d_rfda                       10    overlay(d_rrec:57)
     d   d_rfda_iso                    d   overlay(d_rfda:1) datfmt(*iso)
     d  d_rtda                       10    overlay(d_rrec:67)
     d   d_rtda_iso                    d   overlay(d_rtda:1) datfmt(*iso)
     d  d_rakt                        1    overlay(d_rrec:68)
     d   d_rakt_num                   1  0 overlay(d_rakt:1)
     d  d_roda                       10    overlay(d_rrec:69)
     d   d_roda_iso                    d   overlay(d_roda:1) datfmt(*iso)
     d  d_reda                       10    overlay(d_rrec:79)
     d  d_reti                       10    overlay(d_rrec:89)
      *
      * Definering av variable i nøkler
      *
     d jvarl3_nobb     s                   like(jvnobb)
     d jbetl1_ldor     s                   like(jpldor)
6.3x d jbetl1_prgr     s                   like(jpprgr)
     d jbetl1_ogrp     s                   like(jpogrp)
     d jbetl1_hgrp     s                   like(jphgrp)
     d jbetl1_ugrp     s                   like(jpugrp)
     d jbetl1_modn     s                   like(jpmodn)
     d jbetl1_vare     s                   like(jpvare)
     d jbetl1_vtyp     s                   like(jpvtyp)
     d jbetl1_lety     s                   like(jplety)
     d jbetl1_rsts     s                   like(jprsts)
     d jbetl1_line     s                   like(jpline)
     d jbetla_ldor     s                   like(jpldor)
6.3x d jbetla_prgr     s                   like(jpprgr)
     d jbetla_ogrp     s                   like(jpogrp)
     d jbetla_hgrp     s                   like(jphgrp)
     d jbetla_ugrp     s                   like(jpugrp)
     d jbetla_modn     s                   like(jpmodn)
     d jbetla_vare     s                   like(jpvare)
     d jbetla_vtyp     s                   like(jpvtyp)
     d jbetla_lety     s                   like(jplety)
     d jbetla_rsts     s                   like(jprsts)
     d jbetla_beti     s                   like(jpbeti)
     d jbetlu_ldor     s                   like(jpldor)
6.3x d jbetlu_prgr     s                   like(jpprgr)
     d jbetlu_ogrp     s                   like(jpogrp)
     d jbetlu_hgrp     s                   like(jphgrp)
     d jbetlu_ugrp     s                   like(jpugrp)
     d jbetlu_modn     s                   like(jpmodn)
     d jbetlu_vare     s                   like(jpvare)
     d jbetlu_vtyp     s                   like(jpvtyp)
     d jbetlu_lety     s                   like(jplety)
     d jbetlu_rsts     s                   like(jprsts)
     d jbetlu_line     s                   like(jpline)
     d jraelu_eldo     s                   like(jpeldo)
6.3x d jraelu_eprg     s                   like(jpeprg)
     d jraelu_eogr     s                   like(jpeogr)
     d jraelu_ehgr     s                   like(jpehgr)
     d jraelu_eugr     s                   like(jpeugr)
     d jraelu_emod     s                   like(jpemod)
     d jraelu_evar     s                   like(jpevar)
     d jraelu_evty     s                   like(jpevty)
     d jraelu_elet     s                   like(jpelet)
     d jraelu_ebrs     s                   like(jpebrs)
     d jraelu_ebli     s                   like(jpebli)
6.3x d jbewl1_ldor     s                   like(jpldor)
6.3x d jbewl1_prgr     s                   like(jpprgr)
6.3x d jbewl1_ogrp     s                   like(jpogrp)
6.3x d jbewl1_hgrp     s                   like(jphgrp)
6.3x d jbewl1_ugrp     s                   like(jpugrp)
6.3x d jbewl1_modn     s                   like(jpmodn)
6.3x d jbewl1_vare     s                   like(jpvare)
6.3x d jbewl1_vtyp     s                   like(jpvtyp)
6.3x d jbewl1_lety     s                   like(jplety)
6.3x d jbewl1_rsts     s                   like(jprsts)
6.3x d jbewl1_line     s                   like(jpline)
6.3x d jrawl1_eldo     s                   like(jpeldo)
6.3x d jrawl1_eprg     s                   like(jpeprg)
6.3x d jrawl1_eogr     s                   like(jpeogr)
6.3x d jrawl1_ehgr     s                   like(jpehgr)
6.3x d jrawl1_eugr     s                   like(jpeugr)
6.3x d jrawl1_emod     s                   like(jpemod)
6.3x d jrawl1_evar     s                   like(jpevar)
6.3x d jrawl1_evty     s                   like(jpevty)
6.3x d jrawl1_elet     s                   like(jpelet)
6.3x d jrawl1_ebrs     s                   like(jpebrs)
6.3x d jrawl1_ebli     s                   like(jpebli)
      *
      * Definering av variable
      *
     d b_inlr          s              1
     d b_kild          s              1    inz(*off)
     d b_lfel          s              1    inz(*off)
     d b_bfel          s              1    inz(*off)
     d b_rfel          s              1    inz(*off)
     d b_blnk          s              1    inz(*off)
     d b_negv          s              1    inz(*off)
6.3x d b_prgr          s              1    inz(*off)
6.3x d b_akti_be       s              1    inz(*off)
6.3x d b_akti          s              1    inz(*off)
6.3x d b_endr          s              1    inz(*off)
      *
     d w_stda          s              3  0
     d w_slda          s              3  0
     d w_welm          s            400
     d w_wlen          s              3  0
      *
     d w_decp          s              3  0
     d w_minp          s              3  0
      *
     d w_ever          s                   like(jpever)
     d w_vare          s                   like(jpvare)
      *
     d w_str_i         s            400
     d w_str_u         s            400
     d w_posi          s              4  0
     d w_posu          s              4  0
     d w_str_x         s              1
      *
     d w_firm          s              3  0
     d w_elin          s                   like(jpelin)
     d w_edat          s                   like(jpedat)
     d w_etim          s                   like(jpetim)
6.3x d w_eldo          s                   like(jpeldo)
6.3x d w_eogr          s                   like(jpeogr)
6.3x d w_prgr          s                   like(jpprgr)
     d w_ogrp          s                   like(jpogrp)
     d w_hgrp          s                   like(jphgrp)
     d w_ugrp          s                   like(jpugrp)
     d w_modn          s                   like(jpmodn)
6.3x d w_ehgr          s                   like(jpehgr)
6.3x d w_eugr          s                   like(jpeugr)
6.3x d w_emod          s                   like(jpemod)
6.3x d w_evar          s                   like(jpevar)
6.3x d w_evty          s                   like(jpevty)
6.3x d w_elet          s                   like(jpelet)
     d w_ebrs          s                   like(jpebrs)
     d w_ebli          s                   like(jpebli)
     d w_erst          s                   like(jperst)
6.3x d w_erae          s                   like(jperae)
6.3x d w_eeus          s                   like(jpeeus)
6.3x d w_eoda          s                   like(jpeoda)
6.3x d w_eeda          s                   like(jpeeda)
6.3x d w_eeti          s                   like(jpeeti)
6.21 d w_efda          s                   like(jpefda)
6.21 d w_etda          s                   like(jpetda)
6.3x  *
6.3x d w_ldor_b        s                   like(jpldor)
6.3x d w_ogrp_b        s                   like(jpogrp)
6.3x d w_hgrp_b        s                   like(jphgrp)
6.3x d w_ugrp_b        s                   like(jpugrp)
6.3x d w_modn_b        s                   like(jpmodn)
6.3x d w_vare_b        s                   like(jpvare)
6.3x d w_vtyp_b        s                   like(jpvtyp)
6.3x d w_lety_b        s                   like(jplety)
6.3x d w_rsts_b        s                   like(jprsts)
6.3x d w_line_b        s                   like(jpline)
6.3x d w_beti_b        s                   like(jpbeti)
6.3x d w_fdat_b        s                   like(jpfdat)
6.3x d w_tdat_b        s                   like(jptdat)
6.3x d w_dato_b        s                   like(jpdato)
6.3x d w_akti_b        s                   like(jpakti)
6.3x d w_odat_b        s                   like(jpodat)
6.3x d w_edat_b        s                   like(jpedat)
6.3x d w_etim_b        s                   like(jpetim)
6.3x d w_eusr_b        s                   like(jpeusr)
6.3x  *
6.3x d s_ldor          s                   like(jpldor)
6.3x d s_eldo          s                   like(jpeldo)
6.3x  *
      *
      *  Konstanter
      *
     d c_apos          c                   x'7D'
     d c_digits        c                   ' 0123456789'
     d c_nsep          c                   ','
     d c_ever_max      c                   9999999,99
      *
     d c_NIBk          c                   '0'
     d c_NVk           c                   '3'
      *
      * XML string konstanter
      *
     d c_xsle          c                   '</'
     d c_xend          c                   '>'
      *
      * XML feltnavn - meldingsspesifikke
      *
      * Hovedstruktur - Avsender
      *
     d c_xstr          c                   '<Avsender>'
     d c_kild          c                   '<Kilde>'
      *
      * Substruktur #1 - Leverandør
      *
     d c_levr_s        c                   '<Lev>'
     d c_levr_e        c                   '</Lev>'
     d c_levn          c                   '<Lev_nr>'
     d c_stat          c                   '<Status>'
      *
      * Substruktur #2 - Betingelse
      *
     d c_beti_s        c                   '<Betingelse>'
     d c_beti_e        c                   '</Betingelse>'
     d c_ogrp          c                   '<Ogrp>'
     d c_hgrp          c                   '<Hgrp>'
     d c_ugrp          c                   '<Ugrp>'
     d c_modn          c                   '<Modulnr>'
     d c_nibn          c                   '<NIBnr>'
     d c_nobb          c                   '<NOBBnr>'
     d c_ltyp          c                   '<Leveringstype>'
     d c_keyn          c                   '<Key>'
     d c_teks          c                   '<Tekst>'
     d c_fdat          c                   '<Fra_dato>'
     d c_tdat          c                   '<Til_dato>'
     d c_akti          c                   '<Aktivisert>'
     d c_opda          c                   '<Oppr_dato>'
     d c_enda          c                   '<Endr_dato>'
     d c_entd          c                   '<Endr_tidspunkt>'
      *
      * Substruktur #3 - Rabattelement
      *
     d c_raba_s        c                   '<Rabattelement>'
     d c_raba_e        c                   '</Rabattelement>'
     d c_rkey          c                   '<Key>'
     d c_rtek          c                   '<Tekst>'
     d c_regt          c                   '<Regel>'
     d c_verd          c                   '<Verdi>'
     d c_rfda          c                   '<Fra_dato>'
     d c_rtda          c                   '<Til_dato>'
     d c_rakt          c                   '<Aktivisert>'
     d c_roda          c                   '<Oppr_dato>'
     d c_reda          c                   '<Endr_dato>'
     d c_reti          c                   '<Endr_tidspunkt>'
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   eval      b_inlr = *on
     c                   time                    w_edat
     c                   time                    w_etim
      *
      * Leser XML-fil betingelse
      *
     c                   read      nxbepfr
     c                   dow       not %eof(nxbepf)
      *
     c                   if        b_kild = *on
     c                   if        %subst(nxbeti:1:5) = c_levr_s
     c                   exsr      beh_levr
     c                   endif
     c                   endif
      *
      *  Finn gyldig avsender/kilde
      *
     c                   eval      w_stda = %scan(c_xend:nxbeti:1)
     c                   eval      w_slda = %scan(c_xsle:nxbeti:w_stda)
     c                   eval      w_stda = w_stda + 1
      *
     c                   eval      w_wlen = *zero
     c                   eval      w_welm = *blank
     c                   if        w_slda > w_stda
     c                   eval      w_wlen = w_slda - w_stda
     c                   eval      w_welm = %subst(nxbeti:w_stda:w_wlen)
     c                   endif
      *
     c                   select
     c                   when      %subst(nxbeti:1:7) = c_kild
     c                   exsr      uttr_kild
     c                   endsl
      *
     c                   delete    nxbepfr
      *
     c                   read      nxbepfr
     c                   enddo
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av avsenderelement : Kilde
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_kild     begsr
      *
     c                   eval      b_kild = *off
      *
     c                   if        %trim(w_welm) = c_NIBk
     c                   eval      b_kild = *on
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av leverandørinformasjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     beh_levr      begsr
      *
     c                   eval      b_lfel = *off
     c                   exsr      levr_init
      *
     c                   dow       not %eof(nxbepf)
      *
      *  Start på betingelse
      *
     c                   if        %subst(nxbeti:1:12) = c_beti_s
     c                   if        b_lfel = *off
     c                   exsr      beh_beti
     c                   endif
     c                   endif
      *
      *  Slutt på leverandørelement
      *
     c                   if        %subst(nxbeti:1:6) = c_levr_e
     c                   exsr      rydd_levr
     c                   leave
     c                   endif
      *
      *  Enkeltelement leverandørnivå herfra
      *
     c                   eval      w_stda = %scan(c_xend:nxbeti:1)
     c                   eval      w_slda = %scan(c_xsle:nxbeti:w_stda)
     c                   eval      w_stda = w_stda + 1
      *
     c                   eval      w_wlen = *zero
     c                   eval      w_welm = *blank
     c                   if        w_slda > w_stda
     c                   eval      w_wlen = w_slda - w_stda
     c                   eval      w_welm = %subst(nxbeti:w_stda:w_wlen)
     c                   endif
      *
     c                   select
     c                   when      %subst(nxbeti:1:8) = c_levn
     c                   exsr      uttr_levn
     c                   exsr      slett_raba
     c                   when      %subst(nxbeti:1:8) = c_stat
     c                   exsr      uttr_stat
     c                   endsl
      *
     c                   delete    nxbepfr
      *
     c                   read      nxbepfr
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av leverandørinformasjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     levr_init     begsr
      *
     c                   eval      d_lrec = *blank
     c                   eval      d_levn_num = *zero
     c                   eval      d_stat_num = *zero
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av lev.element : Lev.nr.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_levn     begsr
      *
     c                   eval      d_levn_num = *zero
      *
     c                   if        %check(c_digits : w_welm) = 0
     c                   evalr     d_levn = %trim(w_welm)
     c                   eval      d_levn = %xlate(' ':'0':d_levn)
     c                   else
     c                   eval      b_lfel = *on
     c                   endif
      *
     c                   if        d_levn_num = *zero
     c                   eval      b_lfel = *on
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av lev.element : Status
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_stat     begsr
      *
     c                   eval      d_stat_num = *zero
      *
     c                   if        w_wlen = 1
     c                   if        %check(c_digits : w_welm) = 0
     c                   eval      d_stat = %trim(w_welm)
     c                   endif
     c                   endif
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelsesinformasjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     beh_beti      begsr
      *
     c                   eval      b_bfel = *off
     c                   eval      d_brec = *blank
     c                   exsr      beti_init
      *
     c                   dow       not %eof(nxbepf)
      *
      *  Slutt på betingelse
      *
     c                   if        %subst(nxbeti:1:13) = c_beti_e
     c                   exsr      skr_beti
     c                   leave
     c                   endif
      *
      *  Start på rabattelement
      *
     c                   if        %subst(nxbeti:1:15) = c_raba_s
     c                   if        b_lfel = *off
     c                   if        b_bfel = *off
     c                   exsr      beh_raba
     c                   endif
     c                   endif
     c                   endif
      *
      *  Enkeltelement betingelse herfra
      *
     c                   eval      w_stda = %scan(c_xend:nxbeti:1)
     c                   eval      w_slda = %scan(c_xsle:nxbeti:w_stda)
     c                   eval      w_stda = w_stda + 1
      *
     c                   eval      w_wlen = *zero
     c                   eval      w_welm = *blank
     c                   if        w_slda > w_stda
     c                   eval      w_wlen = w_slda - w_stda
     c                   eval      w_welm = %subst(nxbeti:w_stda:w_wlen)
     c                   endif
      *
     c                   select
     c                   when      %subst(nxbeti:1:6) = c_ogrp
     c                   exsr      uttr_ogrp
     c                   when      %subst(nxbeti:1:6) = c_hgrp
     c                   exsr      uttr_hgrp
     c                   when      %subst(nxbeti:1:6) = c_ugrp
     c                   exsr      uttr_ugrp
     c                   when      %subst(nxbeti:1:9) = c_modn
     c                   exsr      uttr_modn
     c                   when      %subst(nxbeti:1:7) = c_nibn
     c                   exsr      uttr_nibn
     c                   when      %subst(nxbeti:1:8) = c_nobb
     c                   exsr      uttr_nobb
     c                   when      %subst(nxbeti:1:15) = c_ltyp
     c                   exsr      uttr_ltyp
     c                   when      %subst(nxbeti:1:5) = c_keyn
     c                   exsr      uttr_keyn
     c                   when      %subst(nxbeti:1:7) = c_teks
     c                   exsr      uttr_teks
     c                   when      %subst(nxbeti:1:10) = c_fdat
     c                   exsr      uttr_fdat
     c                   when      %subst(nxbeti:1:10) = c_tdat
     c                   exsr      uttr_tdat
     c                   when      %subst(nxbeti:1:12) = c_akti
     c                   exsr      uttr_akti
     c                   when      %subst(nxbeti:1:11) = c_opda
     c                   exsr      uttr_opda
     c                   when      %subst(nxbeti:1:11) = c_enda
     c                   exsr      uttr_enda
     c                   when      %subst(nxbeti:1:16) = c_entd
     c                   exsr      uttr_entd
     c                   endsl
      *
     c                   delete    nxbepfr
      *
     c                   read      nxbepfr
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av betingelsesinformasjon
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     beti_init     begsr
      *
     c                   eval      d_brec = *blank
     c                   eval      d_ogrp_num = *zero
     c                   eval      d_hgrp_num = *zero
     c                   eval      d_ugrp_num = *zero
     c                   eval      d_modn_num = *zero
     c                   eval      d_nobb_num = *zero
     c                   eval      d_leve_num = *zero
     c                   eval      d_bkey_num = *zero
     c                   eval      d_bakt_num = *zero
      *
     c                   eval      d_bfda_iso = *loval
     c                   eval      d_btda_iso = *loval
     c                   eval      d_boda_iso = *loval
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Overgruppe
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_ogrp     begsr
      *
     c                   if        %check(c_digits : w_welm) = 0
     c                   evalr     d_ogrp = %trim(w_welm)
     c                   eval      d_ogrp = %xlate(' ':'0':d_ogrp)
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Hovedgruppe
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_hgrp     begsr
      *
     c                   if        %check(c_digits : w_welm) = 0
     c                   evalr     d_hgrp = %trim(w_welm)
     c                   eval      d_hgrp = %xlate(' ':'0':d_hgrp)
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Undergruppe
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_ugrp     begsr
      *
     c                   if        %check(c_digits : w_welm) = 0
     c                   evalr     d_ugrp = %trim(w_welm)
     c                   eval      d_ugrp = %xlate(' ':'0':d_ugrp)
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Modulnr.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_modn     begsr
      *
     c                   if        %check(c_digits : w_welm) = 0
     c                   evalr     d_modn = %trim(w_welm)
     c                   eval      d_modn = %xlate(' ':'0':d_modn)
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : NIB-nr.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_nibn     begsr
      *
     c                   if        w_wlen = 8
     c                   if        %check(c_digits : w_welm) = 0
     c                   eval      d_vare = %trim(w_welm)
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : NOBB-nr.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_nobb     begsr
      *
     c                   if        %check(c_digits : w_welm) = 0
     c                   evalr     d_nobb = %trim(w_welm)
     c                   eval      d_nobb = %xlate(' ':'0':d_nobb)
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Leveringstype
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_ltyp     begsr
      *
     c                   eval      d_leve_num = *zero
      *
     c                   if        w_wlen = 1
     c                   if        %check(c_digits : w_welm) = 0
     c                   eval      d_leve = %trim(w_welm)
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Key (linjenr.)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_keyn     begsr
      *
     c                   if        %check(c_digits : w_welm) = 0
     c                   evalr     d_bkey = %trim(w_welm)
     c                   eval      d_bkey = %xlate(' ':'0':d_bkey)
     c                   else
     c                   eval      b_bfel = *on
     c                   endif
      *
     c                   if        d_bkey_num = *zero
     c                   eval      b_bfel = *on
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Betingelsestekst
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_teks     begsr
      *
     c                   eval      w_str_i = *blank
     c                   eval      w_str_i = %trim(w_welm)
     c                   exsr      konv_XML_esc
     c                   eval      d_btxt = %trim(w_str_u)
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Fra-dato
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_fdat     begsr
      *
     c                   if        w_wlen = 10
     c                   eval      d_bfda = %trim(w_welm)
     c                   else
     c                   eval      d_bfda_iso = *loval
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Til-dato
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_tdat     begsr
      *
     c                   if        w_wlen = 10
     c                   eval      d_btda = %trim(w_welm)
     c                   else
     c                   eval      d_btda_iso = *loval
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Aktivisert
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_akti     begsr
      *
     c                   eval      d_bakt_num = *zero
      *
     c                   if        w_wlen = 1
     c                   if        %check(c_digits : w_welm) = 0
     c                   eval      d_bakt = %trim(w_welm)
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Opprettet dato
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_opda     begsr
      *
     c                   if        w_wlen = 10
     c                   eval      d_boda = %trim(w_welm)
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Endr.dato
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_enda     begsr
      *
     c                   if        w_wlen = 10
     c                   eval      d_beda = %trim(w_welm)
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av betingelseselem. : Endr.tidspunkt
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_entd     begsr
      *
     c                   if        w_wlen = 8
     c                   eval      d_beti = %trim(w_welm)
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Oppdaterer betingelse
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     skr_beti      begsr
      *
     c                   if        b_lfel = *on or
     c                             b_bfel = *on
     c                   leavesr
     c                   endif
      *
     c                   if        jaanob = 1
     c                   if        d_nobb_num <> *zero
     c                   eval      w_vare = d_nobb
     c                   else
     c                   eval      w_vare = *blank
     c                   endif
     c                   else
     c                   eval      w_vare = d_vare
     c                   endif
      *
     c                   clear                   jbetlur
      *
     c                   eval      jbetlu_ldor = d_levn_num
6.3x c                   eval      jbetlu_prgr = *blank
     c                   eval      jbetlu_ogrp = d_ogrp_num
     c                   eval      jbetlu_hgrp = d_hgrp_num
     c                   eval      jbetlu_ugrp = d_ugrp_num
     c                   eval      jbetlu_modn = d_modn_num
     c                   eval      jbetlu_vare = w_vare
     c                   eval      jbetlu_vtyp = *blank
     c                   eval      jbetlu_lety = 0
     c                   eval      jbetlu_rsts = 0
     c                   eval      jbetlu_line = d_bkey_num
     c     jbetlu_key    chain     jbetlur
      *
     c                   if        not %found
     c                   eval      jbetla_ldor = d_levn_num
6.3x c                   eval      jbetla_prgr = *blank
     c                   eval      jbetla_ogrp = d_ogrp_num
     c                   eval      jbetla_hgrp = d_hgrp_num
     c                   eval      jbetla_ugrp = d_ugrp_num
     c                   eval      jbetla_modn = d_modn_num
     c                   eval      jbetla_vare = w_vare
     c                   eval      jbetla_vtyp = *blank
     c                   eval      jbetla_lety = 0
     c                   eval      jbetla_rsts = 0
     c                   eval      jbetla_beti = d_btxt
     c     jbetla_key    chain     jbetla
     c                   if        %found
     c                   eval      jbetlu_ldor = jpldor
6.3x c                   eval      jbetlu_prgr = jpprgr
     c                   eval      jbetlu_ogrp = jpogrp
     c                   eval      jbetlu_hgrp = jphgrp
     c                   eval      jbetlu_ugrp = jpugrp
     c                   eval      jbetlu_modn = jpmodn
     c                   eval      jbetlu_vare = jpvare
     c                   eval      jbetlu_vtyp = *blank
     c                   eval      jbetlu_lety = 0
     c                   eval      jbetlu_rsts = jprsts
     c                   eval      jbetlu_line = jpline
     c     jbetlu_key    chain     jbetlur
     c                   endif
     c                   endif
      *
6.3x c                   eval      jpprgr = *blank
     c                   eval      jpogrp = d_ogrp_num
     c                   eval      jphgrp = d_hgrp_num
     c                   eval      jpugrp = d_ugrp_num
     c                   eval      jpmodn = d_modn_num
     c                   eval      jpvare = w_vare
     c                   eval      jprsts = 0
     c                   eval      jpline = d_bkey_num
     c                   eval      jpbeti = d_btxt
     c                   eval      jpfdat = *loval
     c                   eval      jptdat = *loval
     c                   eval      jpdato = *loval
     c                   eval      jpeusr = l_user
     c                   eval      jpetim = w_etim
     c                   eval      jpedat = w_edat
      * sjekker om dette har vært aktivisert tidligere
6.32 c*                  exsr      sjekk_akti
6.3x c                   if        b_akti = *on
6.3x c                   eval      jpakti = 1
6.3x c                   endif
      *
6.20 c                   if        d_levn_num = 214384
6.20 c                   eval      jpakti = 1
6.20 c                   endif
     c                   if        %found(jbetlu)
     c                   update    jbetlur
     c                   else
     c                   eval      jpfirm = w_firm
     c                   eval      jpldor = d_levn_num
     c                   time                    jpodat
     c                   write     jbetlur
     c                   endif
6.3x  *
6.3x  * verdier fra betingelse til evt. prisgruppe
6.3x  *
6.3x c                   eval      w_ldor_b = jpldor
6.3x c                   eval      w_ogrp_b = jpogrp
6.3x c                   eval      w_hgrp_b = jphgrp
6.3x c                   eval      w_ugrp_b = jpugrp
6.3x c                   eval      w_modn_b = jpmodn
6.3x c                   eval      w_vare_b = jpvare
6.3x c                   eval      w_vtyp_b = jpvtyp
6.3x c                   eval      w_lety_b = jplety
6.3x c                   eval      w_rsts_b = jprsts
6.3x c                   eval      w_line_b = jpline
6.3x c                   eval      w_beti_b = jpbeti
6.3x c                   eval      w_fdat_b = jpfdat
6.3x c                   eval      w_tdat_b = jptdat
6.3x c                   eval      w_dato_b = jpdato
6.3x c                   eval      w_akti_b = jpakti
6.3x c                   eval      w_odat_b = jpodat
6.3x c                   eval      w_edat_b = jpedat
6.3x c                   eval      w_etim_b = jpetim
6.3x c                   eval      w_eusr_b = jpeusr
6.3x  *
6.3x c     ra30l1_key    setll     ra30l1
6.3x c     ra30l1_key    reade     ra30l1
6.3x c                   dow       not %eof(ra30l1)
6.3x  *
6.32 c*                  exsr      sjekk_prgr_be
6.3x c                   if        b_prgr = *on
6.3x  *
6.3x  * Oppdaterer/oppretter betingelse
6.3x  *
6.3x c                   clear                   jbetlur
6.3x  *
6.3x c                   eval      jbetlu_ldor = w_ldor_b
6.3x c                   eval      jbetlu_prgr = redkod
6.3x c                   eval      jbetlu_ogrp = w_ogrp_b
6.3x c                   eval      jbetlu_hgrp = w_hgrp_b
6.3x c                   eval      jbetlu_ugrp = w_ugrp_b
6.3x c                   eval      jbetlu_modn = w_modn_b
6.3x c                   eval      jbetlu_vare = w_vare_b
6.3x c                   eval      jbetlu_vtyp = w_vtyp_b
6.3x c                   eval      jbetlu_lety = w_lety_b
6.3x c                   eval      jbetlu_rsts = w_rsts_b
6.3x c                   eval      jbetlu_line = w_line_b
6.3x c                   eval      jbetla_beti = w_beti_b
6.3x c     jbetlu_key    chain     jbetlur
6.3x  *
6.3x  *
6.3x c                   eval      jpbeti = w_beti_b
6.3x c                   eval      jpfdat = w_fdat_b
6.3x c                   eval      jptdat = w_tdat_b
6.3x c                   eval      jpdato = w_dato_b
6.3x c                   eval      jpeusr = w_eusr_b
6.3x c                   eval      jpetim = w_etim_b
6.3x c                   eval      jpedat = w_edat_b
6.3x c                   if        b_akti_be = *on
6.3x c                   eval      jpakti = 1
6.3x c                   endif
6.3x  *
6.3x c                   if        %found(jbetlu)
6.3x c                   update    jbetlur
6.3x c                   else
6.3x c                   eval      jpfirm = w_firm
6.3x c                   eval      jpldor = jbetlu_ldor
6.3x c                   eval      jpprgr = jbetlu_prgr
6.3x c                   eval      jpogrp = jbetlu_ogrp
6.3x c                   eval      jphgrp = jbetlu_hgrp
6.3x c                   eval      jpugrp = jbetlu_ugrp
6.3x c                   eval      jpmodn = jbetlu_modn
6.3x c                   eval      jpvare = jbetlu_vare
6.3x c                   eval      jpvtyp = jbetlu_vtyp
6.3x c                   eval      jplety = jbetlu_lety
6.3x c                   eval      jprsts = jbetlu_rsts
6.3x c                   eval      jpline = jbetlu_line
6.3x c                   eval      jpbeti = jbetla_beti
6.3x c                   time                    jpodat
6.3x c                   write     jbetlur
6.3x c                   endif
6.3x  *
6.3x c                   endif
6.3x  *
6.3x c     ra30l1_key    reade     ra30l1
6.3x c                   enddo
6.3x
6.3x  *
6.3x c                   endsr
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av rabattelementinfo.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     beh_raba      begsr
      *
     c                   eval      b_rfel = *off
     c                   eval      d_rrec = *blank
     c                   exsr      raba_init
      *
     c                   dow       not %eof(nxbepf)
      *
      *  Slutt på rabattelement
      *
     c                   if        %subst(nxbeti:1:16) = c_raba_e
     c                   exsr      skr_raba
     c                   exsr      skr_raba_pg
     c                   leave
     c                   endif
      *
      *  Enkeltelement rabattelem. herfra
      *
     c                   eval      w_stda = %scan(c_xend:nxbeti:1)
     c                   eval      w_slda = %scan(c_xsle:nxbeti:w_stda)
     c                   eval      w_stda = w_stda + 1
      *
     c                   eval      w_wlen = *zero
     c                   eval      w_welm = *blank
     c                   if        w_slda > w_stda
     c                   eval      w_wlen = w_slda - w_stda
     c                   eval      w_welm = %subst(nxbeti:w_stda:w_wlen)
     c                   endif
      *
     c                   select
     c                   when      %subst(nxbeti:1:5) = c_rkey
     c                   exsr      uttr_rkey
     c                   when      %subst(nxbeti:1:7) = c_rtek
     c                   exsr      uttr_rtek
     c                   when      %subst(nxbeti:1:7) = c_regt
     c                   exsr      uttr_regt
     c                   when      %subst(nxbeti:1:7) = c_verd
     c                   exsr      uttr_verd
     c                   when      %subst(nxbeti:1:10) = c_rfda
     c                   exsr      uttr_rfda
     c                   when      %subst(nxbeti:1:10) = c_rtda
     c                   exsr      uttr_rtda
     c                   when      %subst(nxbeti:1:12) = c_rakt
     c                   exsr      uttr_rakt
     c                   when      %subst(nxbeti:1:11) = c_roda
     c                   exsr      uttr_roda
     c                   when      %subst(nxbeti:1:11) = c_reda
     c                   exsr      uttr_reda
     c                   when      %subst(nxbeti:1:16) = c_reti
     c                   exsr      uttr_reti
     c                   endsl
      *
     c                   delete    nxbepfr
      *
     c                   read      nxbepfr
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av rabattelementinfo.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     raba_init     begsr
      *
     c                   eval      d_rrec = *blank
     c                   eval      d_rkey_num = *zero
     c                   eval      d_verd_hel = *zero
     c                   eval      d_verd_des = *zero
     c                   eval      d_rakt_num = *zero
      *
     c                   eval      d_rfda_iso = *loval
     c                   eval      d_rtda_iso = *loval
     c                   eval      d_roda_iso = *loval
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av rabattelem.elem. : Key (linjenr.)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_rkey     begsr
      *
     c                   if        %check(c_digits : w_welm) = 0
     c                   evalr     d_rkey = %trim(w_welm)
     c                   eval      d_rkey = %xlate(' ':'0':d_bkey)
     c                   else
     c                   eval      b_rfel = *on
     c                   endif
      *
     c                   if        d_rkey_num = *zero
     c                   eval      b_rfel = *on
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av rabattelem.elem. : Rabattelem.tekst
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_rtek     begsr
      *
     c                   eval      w_str_i = *blank
     c                   eval      w_str_i = %trim(w_welm)
     c                   exsr      konv_XML_esc
     c                   eval      d_rtxt = %trim(w_str_u)
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av rabattelem.elem. : Regel
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_regt     begsr
      *
     c                   eval      w_str_i = *blank
     c                   eval      w_str_i = %trim(w_welm)
     c                   exsr      konv_XML_esc
     c                   eval      d_regl = %trim(w_str_u)
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av rabattelem.elem. : Verdi
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_verd     begsr
      *
     c                   if        w_wlen = 0
     c                   eval      d_verd_hel = *zero
     c                   eval      d_verd_des = *zero
     c                   eval      w_ever = *zero
     c                   leavesr
     c                   endif
      *
     c                   eval      w_minp = %scan('-':w_welm:1)
     c                   if        w_minp > *zero
     c                   eval      b_negv = *on
     c                   eval      w_welm = %xlate('-':'0':w_welm)
     c                   else
     c                   eval      b_negv = *off
     c                   endif
      *
     c                   eval      w_decp = %scan(c_nsep:w_welm:1)
     c                   if        w_decp = 0
     c                   evalr     d_verd_hex = %trim(%subst(w_welm:1))
     c                   eval      d_verd_hex = %xlate(' ':'0':d_verd_hex)
     c                   eval      d_verd_des = *zero
     c                   eval      w_ever = d_verd_hel
     c                   else
     c                   evalr     d_verd_hex = %trim(%subst(w_welm:1:w_decp-1))
     c                   eval      d_verd_hex = %xlate(' ':'0':d_verd_hex)
     c                   evalr     d_verd_dex = %trim(%subst(w_welm:w_decp+1))
     c                   eval      d_verd_dex = %xlate(' ':'0':d_verd_dex)
     c                   if        (d_verd_hel + d_verd_des) > c_ever_max
     c                   eval      w_ever = *zero
     c                   else
     c                   eval(h)   w_ever = (d_verd_hel + d_verd_des)
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av rabattelen.elem. : Fra-dato
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_rfda     begsr
      *
     c                   if        w_wlen = 10
     c                   eval      d_rfda = %trim(w_welm)
     c                   else
     c                   eval      d_rfda_iso = *loval
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av rabattelem.elem. : Til-dato
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_rtda     begsr
      *
     c                   if        w_wlen = 10
     c                   eval      d_rtda = %trim(w_welm)
     c                   else
     c                   eval      d_rtda_iso = *loval
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av rabattelem.elem. : Aktivisert
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_rakt     begsr
      *
     c                   eval      d_rakt_num = *zero
      *
     c                   if        w_wlen = 1
     c                   if        %check(c_digits : w_welm) = 0
     c                   eval      d_rakt = %trim(w_welm)
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av rabattelem.elem. : Opprettet dato
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_roda     begsr
      *
     c                   if        w_wlen = 10
     c                   eval      d_roda = %trim(w_welm)
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av rabattelem.elem. : Endr.dato
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_reda     begsr
      *
     c                   if        w_wlen = 10
     c                   eval      d_reda = %trim(w_welm)
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av rabattelem.elem. : Endr.tidspunkt
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     uttr_reti     begsr
      *
     c                   if        w_wlen = 8
     c                   eval      d_reti = %trim(w_welm)
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Oppdaterer rabattelement
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     skr_raba      begsr
      *
     c                   if        b_lfel = *on or
     c                             b_bfel = *on or
     c                             b_rfel = *on
     c                   leavesr
     c                   endif
      *
     c                   clear                   jraelur
      *
     c                   eval      jpereg = d_regl
     c                   eval      jpever = d_verd_hel + d_verd_des
      *
     c                   if        b_negv = *on
     c                   eval      jpever = jpever * -1
     c                   endif
      *
     c                   if        jaanob = 1
     c                   if        d_nobb_num <> *zero
     c                   eval      w_vare = d_nobb
     c                   else
     c                   eval      w_vare = *blank
     c                   endif
     c                   else
     c                   eval      w_vare = d_vare
     c                   endif
      *
     c                   eval      w_elin = w_elin + 1
      *
     c                   eval      jpefir = w_firm
     c                   eval      jpeldo = d_levn_num
     c                   eval      jpeogr = d_ogrp_num
     c                   eval      jpehgr = d_hgrp_num
     c                   eval      jpeugr = d_ugrp_num
     c                   eval      jpemod = d_modn_num
     c                   eval      jpevar = w_vare
     c                   eval      jpebrs = 0
     c                   eval      jpebli = d_rkey_num
     c                   eval      jperst = 0
     c                   eval      jpelin = w_elin
     c                   eval      jperae = d_rtxt
     c                   eval      jpefda = *loval
     c                   eval      jpetda = *loval
     c                   eval      jpeeus = l_user
      *
6.3x c                   eval      w_prgr = *blank
     c                   exsr      sjekk_endr
     c                   if        jpwakt = 1  and
     c                             jpwrae = jperae
     c                   eval      jpeakt = 1
     c                   endif
      *
     c                   time                    jpeoda
     c                   time                    jpeeda
     c                   time                    jpeeti
      *
     c                   write     jraelur
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for tilbakestilling av XML-escape tegn i tekstfelt
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     konv_XML_esc  begsr
      *
     c                   eval      w_posi = 0
     c                   eval      w_posu = 0
     c                   eval      w_str_u = *blank
     c                   eval      b_blnk = *off
      *
     c                   dow       w_posi < 395 and
     c                             b_blnk = *off
     c                   eval      w_posi = w_posi + 1
     c                   if        %subst(w_str_i:w_posi) = *blank
     c                   eval      b_blnk = *on
     c                   else
     c                   eval      w_str_x = %subst(w_str_i:w_posi:1)
     c                   if        w_posu < 395
     c                   select
     c                   when      %subst(w_str_i:w_posi:5) = '&amp;'
     c                   eval      w_posu = w_posu + 1
     c                   eval      %subst(w_str_u:w_posu:1) = '&'
     c                   eval      w_posi = w_posi + 4
      *
     c                   when      %subst(w_str_i:w_posi:4) = '&lt;'
     c                   eval      w_posu = w_posu + 1
     c                   eval      %subst(w_str_u:w_posu:1) = '<'
     c                   eval      w_posi = w_posi + 3
      *
     c                   when      %subst(w_str_i:w_posi:4) = '&gt;'
     c                   eval      w_posu = w_posu + 1
     c                   eval      %subst(w_str_u:w_posu:1) = '>'
     c                   eval      w_posi = w_posi + 3
      *
     c                   when      %subst(w_str_i:w_posi:6) = '&apos;'
     c                   eval      w_posu = w_posu + 1
     c                   eval      %subst(w_str_u:w_posu:1) = c_apos
     c                   eval      w_posi = w_posi + 5
      *
     c                   when      %subst(w_str_i:w_posi:6) = '&quot;'
     c                   eval      w_posu = w_posu + 1
     c                   eval      %subst(w_str_u:w_posu:1) = '"'
     c                   eval      w_posi = w_posi + 5
      *
     c                   other
     c                   eval      w_posu = w_posu + 1
     c                   eval      %subst(w_str_u:w_posu:1) = w_str_x
      *
     c                   endsl
     c                   endif
     c                   endif
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for rydding av betingelser/rab. pr. lev. - ikke endret
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     rydd_levr     begsr
      *
      * Sletter gamle "ikke egne" betingelser og rabattelementer for
      * leverandør
      *
     c                   eval      jbetlu_ldor = d_levn_num
     c     jbetlu_key2   setll     jbetlu
     c     jbetlu_key2   reade     jbetlur
     c                   dow       not %eof
      *
     c                   if        jprsts = 0 and
     c                             jpedat <> w_edat and
     c                             jpetim <> w_etim
      *
     c                   delete    jbetlur
      *
     c                   eval      jraelu_eldo = jpldor
6.3x c                   eval      jraelu_eprg = jpprgr
     c                   eval      jraelu_eogr = jpogrp
     c                   eval      jraelu_ehgr = jphgrp
     c                   eval      jraelu_eugr = jpugrp
     c                   eval      jraelu_emod = jpmodn
     c                   eval      jraelu_evar = jpvare
     c                   eval      jraelu_evty = jpvtyp
     c                   eval      jraelu_elet = jplety
     c                   eval      jraelu_ebrs = jprsts
     c                   eval      jraelu_ebli = jpline
     c     jraelu_key    setll     jraelu
     c     jraelu_key    reade     jraelur
     c                   dow       not %eof
     c                   delete    jraelur
     c     jraelu_key    reade     jraelur
     c                   enddo
      *
     c                   endif
      *
     c     jbetlu_key2   reade     jbetlur
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for sletting av rabattelem. for lev.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     slett_raba    begsr
      *
     c                   eval      jraelu_eldo = d_levn_num
     c     jraelu_key2   setll     jraelu
     c     jraelu_key2   reade     jraelur
     c                   dow       not %eof
     c                   if        jperst = 0
     c                   delete    jraelur
     c                   endif
     c     jraelu_key2   reade     jraelur
     c                   enddo
      *
     c                   endsr
6.3x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3x  * Subrutine for å sjekke om rabattelement har hatt prisgruppe tidligere
6.3x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3x  *
6.32 c*     sjekk_prgr    begsr
6.32  **
6.32 c*                   eval      b_prgr = *off
6.32  **
6.32 c*                   eval      jrawl1_eldo = jpeldo
6.32 c*                   eval      jrawl1_eprg = redkod
6.32 c*                   eval      jrawl1_eogr = jpeogr
6.32 c*                   eval      jrawl1_ehgr = jpehgr
6.32 c*                   eval      jrawl1_eugr = jpeugr
6.32 c*                   eval      jrawl1_emod = jpemod
6.32 c*                   eval      jrawl1_evar = jpevar
6.32 c*                   eval      jrawl1_evty = jpevty
6.32 c*                   eval      jrawl1_elet = jpelet
6.32 c*                   eval      jrawl1_ebrs = jpebrs
6.32 c*                   eval      jrawl1_ebli = jpebli
6.32 c*     jrawl1_key    chain     jrawl1
6.32 c*                   if        %found(jrawl1)
6.32 c*                   eval      b_prgr = *on
6.32 c**                  exsr      skriv
6.32 c*                   endif
6.32  **
6.32 c*                   endsr
6.3x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3x  * Subrutine for å sjekke om betingelse har hatt prisgruppe tidligere
6.3x  * som har vært aktivisert
6.3x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3x  *
6.32 c*     sjekk_prgr_be begsr
6.32  **
6.32 c*                   eval      b_prgr = *off
6.32 c*                   eval      b_akti_be = *off
6.32  **
6.32 c*                   eval      jbewl1_ldor = w_ldor_b
6.32 c*                   eval      jbewl1_prgr = redkod
6.32 c*                   eval      jbewl1_ogrp = w_ogrp_b
6.32 c*                   eval      jbewl1_hgrp = w_hgrp_b
6.32 c*                   eval      jbewl1_ugrp = w_ugrp_b
6.32 c*                   eval      jbewl1_modn = w_modn_b
6.32 c*                   eval      jbewl1_vare = w_vare_b
6.32 c*                   eval      jbewl1_vtyp = w_vtyp_b
6.32 c*                   eval      jbewl1_lety = w_lety_b
6.32 c*                   eval      jbewl1_rsts = w_rsts_b
6.32 c*                   eval      jbewl1_line = w_line_b
6.32 c*     jbewl1_key    chain     jbewl1
6.32 c*                   if        %found(jbewl1)
6.32 c*                   eval      b_prgr = *on
6.32 c*                   if        jpakti = 1
6.22 c*                   eval      b_akti_be = *on
6.22 c*                   endif
6.32 c**                  exsr      skriv
6.32 c*                   endif
6.32  **
6.32 c*                   endsr
6.3x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3x  * Subrutine for å sjekke om betingelse har vært aktivisert tidligere
6.3x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3x  *
6.32 c*     sjekk_akti    begsr
6.32  **
6.32 c*                   eval      b_akti    = *off
6.32  **
6.32 c*                   eval      jbewl1_ldor = jpldor
6.32 c*                   eval      jbewl1_prgr = *blank
6.32 c*                   eval      jbewl1_ogrp = jpogrp
6.32 c*                   eval      jbewl1_hgrp = jphgrp
6.32 c*                   eval      jbewl1_ugrp = jpugrp
6.32 c*                   eval      jbewl1_modn = jpmodn
6.32 c*                   eval      jbewl1_vare = jpvare
6.32 c*                   eval      jbewl1_vtyp = jpvtyp
6.32 c*                   eval      jbewl1_lety = jplety
6.32 c*                   eval      jbewl1_rsts = jprsts
6.32 c*                   eval      jbewl1_line = jpline
6.32 c*     jbewl1_key    chain     jbewl1
6.32 c*                   if        %found(jbewl1) and
6.32 c*                             jpakti = 1
6.32 c*                   eval      b_akti = *on
6.32 c*                   endif
6.32  **
6.32 c*                   endsr
6.32  *
6.3x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3x  * Subrutine for oppdatering av rabattelement pr. prisgruppe
6.3x  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.3x  *
6.3x c     skr_raba_pg   begsr
6.3x  *
6.3x  * behandler alle prisgruper
6.3x  *
6.3x  *
6.3x c     ra30l1_key    setll     ra30l1
6.3x c     ra30l1_key    reade     ra30l1
6.3x c                   dow       not %eof(ra30l1)
6.3x  *
6.32 c*                   exsr      sjekk_prgr
6.3x c                   if        b_prgr = *on
6.3x  *
6.3x  * Sjekker om betingelse finnes for element
6.3x  *
6.3x c                   eval      jbetl1_ldor = w_eldo
6.3x c                   eval      jbetl1_prgr = redkod
6.3x c                   eval      jbetl1_ogrp = w_eogr
6.3x c                   eval      jbetl1_hgrp = w_ehgr
6.3x c                   eval      jbetl1_ugrp = w_eugr
6.3x c                   eval      jbetl1_modn = w_emod
6.3x c                   eval      jbetl1_vare = w_evar
6.3x c                   eval      jbetl1_vtyp = w_evty
6.3x c                   eval      jbetl1_lety = w_elet
6.3x c                   eval      jbetl1_rsts = w_erst
6.3x c                   eval      jbetl1_line = w_ebli
6.3x c     jbetl1_key    chain     jbetl1
6.3x c                   if        not %found
6.3x c                   leavesr
6.3x c                   endif
6.3x  *
6.3x c                   eval      jpefir = w_firm
6.3x c                   eval      jpeldo = w_eldo
6.3x c                   eval      jpeprg = redkod
6.3x c                   eval      jpeogr = w_eogr
6.3x c                   eval      jpehgr = w_ehgr
6.3x c                   eval      jpeugr = w_eugr
6.3x c                   eval      jpemod = w_emod
6.3x c                   eval      jpevar = w_evar
6.3x c                   eval      jpevty = w_evty
6.3x c                   eval      jpelet = w_elet
6.3x c                   eval      jpebrs = w_ebrs
6.3x c                   eval      jpebli = w_ebli
6.3x c                   eval      jperst = w_erst
6.3x c                   eval      jpelin = w_elin
6.3x c                   eval      jperae = w_erae
6.3x c                   eval      jpefda = w_efda
6.3x c                   eval      jpetda = w_etda
6.3x c                   eval      jpeeus = w_eeus
6.3x c                   eval      jpeoda = w_eoda
6.3x c                   eval      jpeeda = w_eeda
6.3x c                   eval      jpeeti = w_eeti
6.3x  *
6.3x c                   eval      w_prgr = redkod
6.3x c                   exsr      sjekk_endr
6.3x c                   if        jpwakt = 1 and
6.3x c                             jpwrae = jperae
6.3x c                   eval      jpeakt = 1
6.3x c                   endif
6.3x  *
6.3x c                   time                    jpeoda
6.3x c                   time                    jpeeda
6.3x c                   time                    jpeeti
6.3x  *
6.3x c                   write     jraelur
6.3x  *
6.3x c                   endif
6.3x  *
6.3x c     ra30l1_key    reade     ra30l1
6.3x c                   enddo
6.3x
6.3x  *
6.3x c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å sjekke om det har vært endring i rabattelementet
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_endr    begsr
      *
     c                   eval      b_endr = *off
      *
     c                   eval      jrawl1_eldo = jpeldo
6.3x c                   eval      jrawl1_eprg = w_prgr
     c                   eval      jrawl1_eogr = jpeogr
     c                   eval      jrawl1_ehgr = jpehgr
     c                   eval      jrawl1_eugr = jpeugr
     c                   eval      jrawl1_emod = jpemod
     c                   eval      jrawl1_evar = jpevar
     c                   eval      jrawl1_evty = jpevty
     c                   eval      jrawl1_elet = jpelet
     c                   eval      jrawl1_ebrs = jpebrs
     c                   eval      jrawl1_ebli = jpebli
     c     jrawl1_key    chain     jrawl1
     c                   if        %found(jrawl1)
     c                   if        d_rtxt <> jperae
     c                   eval      b_endr = *on
     c                   endif
     c                   endif
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_firm
      *
      * Key for oppslag på vare
      *
     c     jvarl3_key    klist
     c                   kfld                    jvarl3_nobb
      *
      * Key for oppslag på betingelse
      *
     c     jbetl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jbetl1_ldor
6.3x c                   kfld                    jbetl1_prgr
     c                   kfld                    jbetl1_ogrp
     c                   kfld                    jbetl1_hgrp
     c                   kfld                    jbetl1_ugrp
     c                   kfld                    jbetl1_modn
     c                   kfld                    jbetl1_vare
     c                   kfld                    jbetl1_vtyp
     c                   kfld                    jbetl1_lety
     c                   kfld                    jbetl1_rsts
     c                   kfld                    jbetl1_line
      *
     c     jbetla_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jbetla_ldor
     c                   kfld                    jbetla_ogrp
     c                   kfld                    jbetla_hgrp
     c                   kfld                    jbetla_ugrp
     c                   kfld                    jbetla_modn
     c                   kfld                    jbetla_vare
     c                   kfld                    jbetla_vtyp
     c                   kfld                    jbetla_lety
     c                   kfld                    jbetla_rsts
     c                   kfld                    jbetla_beti
6.3x c                   kfld                    jbetla_prgr
      *
      * Key for oppdatering av betingelser
      *
     c     jbetlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jbetlu_ldor
6.3x c                   kfld                    jbetlu_prgr
     c                   kfld                    jbetlu_ogrp
     c                   kfld                    jbetlu_hgrp
     c                   kfld                    jbetlu_ugrp
     c                   kfld                    jbetlu_modn
     c                   kfld                    jbetlu_vare
     c                   kfld                    jbetlu_vtyp
     c                   kfld                    jbetlu_lety
     c                   kfld                    jbetlu_rsts
     c                   kfld                    jbetlu_line
      *
     c     jbetlu_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    jbetlu_ldor
      *
      * Key for oppdatering av rabattelement
      *
     c     jraelu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jraelu_eldo
6.3x c                   kfld                    jraelu_eprg
     c                   kfld                    jraelu_eogr
     c                   kfld                    jraelu_ehgr
     c                   kfld                    jraelu_eugr
     c                   kfld                    jraelu_emod
     c                   kfld                    jraelu_evar
     c                   kfld                    jraelu_evty
     c                   kfld                    jraelu_elet
     c                   kfld                    jraelu_ebrs
     c                   kfld                    jraelu_ebli
      *
     c     jraelu_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    jraelu_eldo
      *
      * Key for oppslag på status
      *
     c     jstsl1_key    klist
     c                   kfld                    w_firm
6.3x  *
6.3x  * Key for les av backupfil for å sjekke endringer
6.3x  *
6.3x c     jrawl1_key    klist
6.3x c                   kfld                    w_firm
6.3x c                   kfld                    jrawl1_eldo
6.3x c                   kfld                    jrawl1_eprg
6.3x c                   kfld                    jrawl1_eogr
6.3x c                   kfld                    jrawl1_ehgr
6.3x c                   kfld                    jrawl1_eugr
6.3x c                   kfld                    jrawl1_emod
6.3x c                   kfld                    jrawl1_evar
6.3x c                   kfld                    jrawl1_evty
6.3x c                   kfld                    jrawl1_elet
6.3x c                   kfld                    jrawl1_ebrs
6.3x c                   kfld                    jrawl1_ebli
6.3x  *
6.3x  * Key for les av backupfil betingelser for å sjekke endringer
6.3x  *
6.3x c     jbewl1_key    klist
6.3x c                   kfld                    w_firm
6.3x c                   kfld                    jbewl1_ldor
6.3x c                   kfld                    jbewl1_prgr
6.3x c                   kfld                    jbewl1_ogrp
6.3x c                   kfld                    jbewl1_hgrp
6.3x c                   kfld                    jbewl1_ugrp
6.3x c                   kfld                    jbewl1_modn
6.3x c                   kfld                    jbewl1_vare
6.3x c                   kfld                    jbewl1_vtyp
6.3x c                   kfld                    jbewl1_lety
6.3x c                   kfld                    jbewl1_rsts
6.3x c                   kfld                    jbewl1_line
5.70  *
5.70  * Key for les på prisgruppe
5.70  *
5.70 c     ra30l1_key    klist
5.70 c                   kfld                    w_firm
      *
      * Henter firma fra parameter
      *
     c                   eval      w_firm = p_firm
      *
     c     jstsl1_key    chain     jstsl1
      *
     c                   endsr
