# JU501R Program Documentation

## Overview

The `JU501R` program is a module within the ASVADM system, designed to retrieve and display details about a specific "modul" (module/item) based on input parameters. It consolidates information from several related master files, including module, supplier, producer, and group data, and presents them on a workstation display.

This program is typically invoked with a firm number and a module number as parameters, and it constructs a detailed view by joining data from multiple sources.

---

## File Dependencies

The program interacts with the following physical files (all renamed for local use):

- **jmodpfr → jmodl1r**: Module master file (primary lookup).
- **jlevpfr → jlevl1r**: Supplier (leverandør) master file.
- **jpropfr → jprol1r**: Producer (produsent) master file.
- **vugrpfr → vugrl1r**: Grouping (undergruppe) master file.
- **ju501d**: Workstation display file for presenting consolidated information.

---

## Parameters and Data Areas

- **p_firm**: Input parameter for the firm number.
- **p_modn**: Input parameter for the module number (item identifier).
- **l_fnav**: Field in the user data space (local data area), not actively used in this program.

---

## Key Variables

- **jmodl1_vare**: Holds the module number for lookups in the module master file.
- **jlevl1_ldor**: Supplier number for supplier master lookup.
- **jprol1_prod**: Producer number for producer master lookup.
- **vugrl1_uogr**, **vugrl1_uhgr**, **vugrl1_uugr**: Grouping keys for group master lookup.
- **w_firm**: Local copy of the firm number parameter.

---

## Main Logic Flow

### 1. Initialization (`*inzsr` subroutine)

- Receives parameters (`p_firm`, `p_modn`).
- Initializes working variables.
- Sets up key lists for file lookups:
    - `jmodl1_key`: Module number.
    - `jlevl1_key`: Supplier number.
    - `jprol1_key`: Producer number.
    - `vugrl1_key`: Firm + group identifiers.

### 2. Main Processing

- **Module Lookup**: 
    - Uses `p_modn` to retrieve the module record from `jmodl1`.
    - If not found, program terminates immediately.

- **Data Extraction**: 
    - Copies key fields from the module master record into local variables for display.
    - Dates are moved using `move` (due to possible date formatting).

- **Supplier Name Lookup**: 
    - If supplier number (`c2ldor`) is not zero, fetches the supplier name from `jlevl1`.
    - Sets `c2lnav` to the supplier name if found.

- **Producer Name Lookup**: 
    - If producer number (`c2prod`) is not zero, fetches the producer name from `jprol1`.
    - Sets `c2pnav` to the producer name if found.

- **Group Description Lookup**: 
    - If group number (`c2ugrp`) is not zero, fetches group description from `vugrl1` using firm and group keys.
    - Sets `c2utxt` to the group text if found.

- **Display**: 
    - Presents the consolidated information on the workstation display (`exfmt c2bld`).

### 3. Program Termination

- Sets LR indicator to *ON and returns.

---

## Design Notes and Conventions

- **Key Lists (`klist`)**: All file lookups use named key lists, defined in the initialization subroutine for clarity and maintainability.
- **Early Exit**: Program terminates immediately if the primary module record is not found.
- **Data Consolidation**: All related data (supplier, producer, group) is only fetched if the corresponding key is non-zero, avoiding unnecessary I/O.
- **Display Preparation**: All display fields are explicitly cleared or set to blanks before optional lookups, ensuring no residual data from previous runs.
- **Parameter Handling**: Parameters are received in the initialization subroutine and copied to working variables for use in key lists and lookups.

---

## Business/Domain Logic

- The program is tailored for a business environment where items/modules are associated with suppliers, producers, and multiple group hierarchies.
- It is designed to provide a quick, consolidated view of an item's core details and its relational context within the master data.
- The naming conventions (`modn`, `ldor`, `prod`, `ugrp`, etc.) align with Norwegian business terminology (modul, leverandør, produsent, undergruppe).

---

## External Relationships

- **File Dependencies**: The program is tightly coupled to the master files mentioned above. Any changes to these files’ structures or keys will require updates here.
- **Display File**: The workstation display file (`ju501d`) must contain the format `c2bld` and fields matching the variables loaded in the program.

---

## Summary Table: Key Lookups

| Data Source | Key Fields Used                | Purpose                                  |
|-------------|-------------------------------|-------------------------------------------|
| jmodl1      | module number                 | Core module/item details                  |
| jlevl1      | supplier number               | Supplier name                            |
| jprol1      | producer number               | Producer name                            |
| vugrl1      | firm + group hierarchy        | Group description                        |

---

## Error Handling

- If the module is not found, the program exits without any display.
- If related records (supplier, producer, group) are not found, their display fields remain blank.

---

## Extensibility

- To extend for additional related information, replicate the lookup pattern: add a new key list in the initialization subroutine and add a conditional lookup in the main logic.
- For batch processing or integration, consider refactoring to separate data retrieval from display logic.

---

## Summary

`JU501R` acts as a master data viewer for modules/items, providing a consolidated snapshot by joining several core master files. It is optimized for interactive use, with minimal error handling and a focus on quick data retrieval and display. The program structure and key usage are consistent with standard IBM RPG/400 practices, but the business logic and file relationships are specific to the ASVADM system and its Norwegian business context.