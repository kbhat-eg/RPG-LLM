     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASVADM
      * Program . . . . : JV622R
      * Beskrivelse . . : Batch program som overfører tjeneste varer som passer
      *                   til utvalgsmasken til eget vareregister.
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       270814 BKV  Nytt program
      *       280814 BKV  Fjernet overføring til lager
6.30  *       090914 BKV  Lagt inn overøring til lager
      *                   Lagt inn pris 0
6.31  *       170914 BKV  Advarsel om ugyldige enheter
6.32  *       081014 BKV  Omregningsfaktor satt til 1
      *                   Mulighet for 5 enheter, var 3
6.33  *       131014 BKV  Pris på enhet 4 og 5
8.01  *PRG2   150622 bof  Utvidet prisgruppe fra 1 til 2 posisjoner
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fjvprpf    if   e           k disk
      *
     fjvarlc    if   e           k disk    rename(jvarpfr:jvarlcr)
6.33 fvvprl1    if   e           k disk    rename(vvprpfr:vvprl1r)
     fvvepl2    uf   e           k disk    rename(vveppfr:vvepl2r)
     fjvpkl2    if   e           k disk    rename(jvpkpfr:jvpkl2r)
     fjvpklr    if   e           k disk    rename(jvpkpfr:jvpklrr)
     fvvarlu    uf a e           k disk    rename(vvarpfr:vvarlur)
6.30 fvvprlu    uf a e           k disk    rename(vvprpfr:vvprlur)
     fvvenlu    uf a e           k disk    rename(vvenpfr:vvenlur)
     fvveplu    uf a e           k disk    rename(vveppfr:vveplur)
     fvvaslu    uf   e           k disk    rename(vvaspfr:vvaslur)
     fveanl1    if   e           k disk    rename(veanpfr:veanl1r)
     fveanlu    uf a e           k disk    rename(veanpfr:veanlur)
6.30 fvlaglu    uf a e           k disk    rename(vlagpfr:vlaglur)
     fjsokl1    if   e           k disk    rename(jsokpfr:jsokl1r)
     fvsokl1    if   e           k disk    rename(vsokpfr:vsokl1r)
     fvsoklu    uf a e           k disk    rename(vsokpfr:vsoklur)
     fjwprlu    uf   e           k disk    rename(jwprpfr:jwprlur)
     fjvdtlu    uf a e           k disk    rename(jvdtpfr:jvdtlur)
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
     fjlevl1    if   e           k disk    rename(jlevpfr:jlevl1r)
     fvogrl1    if   e           k disk    rename(vogrpfr:vogrl1r)
     fvhgrl1    if   e           k disk    rename(vhgrpfr:vhgrl1r)
     fvugrl1    if   e           k disk    rename(vugrpfr:vugrl1r)
     fra10l1    if   e           k disk    rename(ra10pfr:ra10l1r)
     fmltilr    if   e           k disk    rename(mltipfr:mltilrr)
     fjvpkl1    if   e           k disk    rename(jvpkpfr:jvpkl1r)
6.31 fvenhl1    if   e           k disk    rename(venhpfr:venhl1r)
      *
      *
      * Definering av parametre
      *
      *
     d p_firm          s              3  0
     d p_ogrp          s                   like(jvogrp)
     d p_hgrp          s                   like(jvhgrp)
     d p_ugrp          s                   like(jvugrp)
     d p_vare          s                   like(jvvare)
     d p_antw          s              5  0
     d p_antu          s              5  0
6.31 d p_enhm          s             15
      *
      * Definering av Local data area
      *
     d                uds
     d l_wsid                901    910
     d l_user                911    920
      *
      * parameterliste -inn
      *
     d  d_firm         s              3  0
     d  d_ogrp         s                   like(jvogrp)
     d  d_hgrp         s                   like(jvhgrp)
     d  d_ugrp         s                   like(jvugrp)
     d  d_vare         s                   like(jvvare)
     d  d_antw         s              5  0
     d  d_antu         s              5  0
6.31 d  d_enhm         s             15
      *
      * Definering av variabler i nøkler
      *
     d jvarl1_vare     s                   like(jvvare)
     d vvarlu_vare     s                   like(vvvare)
     d vvprlr_vare     s                   like(vpvare)
     d vvprlr_ldor     s                   like(vpldor)
     d vvprlr_prgr     s                   like(vpprgr)
     d vvprlr_enhe     s                   like(vpenhe)
     d vvprlr_lety     s                   like(vplety)
     d vvprlr_pdat     s                   like(vppdat)
     d vvepl2_pgti     s                   like(vepgti)
     d vvenlu_vare     s                   like(vevare)
     d vvenlu_enhe     s                   like(veenhe)
     d vveplu_pvar     s                   like(vepvar)
     d vveplu_penh     s                   like(vepenh)
     d vveplu_pldo     s                   like(vepldo)
     d vvaslu_vare     s                   like(vvvare)
     d jvprl1_ldor     s                   like(jxldor)
     d jvpkl2_vare     s                   like(jwvare)
     d jvpkl2_ldor     s                   like(jwldor)
     d jvpklr_pakn     s                   like(jwpakn)
     d jvpkl2_enhe     s                   like(jwenhe)
     d veanl1_eann     s                   like(vxeann)
     d veanlu_eann     s                   like(vxeann)
6.30 d vlaglu_vare     s                   like(vlvare)
6.30 d vlaglu_lage     s                   like(vllage)
     d jsokl1_vare     s                   like(jsvare)
     d vsokl1_vare     s                   like(vsvare)
     d vsokl1_stek     s                   like(vsstek)
     d jwprlu_vare     s                   like(jbvare)
     d jvdtlu_dvar     s                   like(jvdvar)
     d jlevl1_ldor     s                   like(jlldor)
     d vogrl1_oogr     s                   like(vgoogr)
     d vhgrl1_hogr     s                   like(vghogr)
     d vhgrl1_hhgr     s                   like(vghhgr)
     d vugrl1_uogr     s                   like(vguogr)
     d vugrl1_uhgr     s                   like(vguhgr)
     d vugrl1_uugr     s                   like(vguugr)
     d mltilr_ogrp     s                   like(mcogrp)
     d mltilr_hgrp     s                   like(mchgrp)
     d mltilr_ugrp     s                   like(mcugrp)
     d mltilr_ldor     s                   like(mcldor)
     d mltilr_vare     s                   like(mcvare)
     d mltilr_lage     s                   like(mclage)
     d mltilr_crdo     s                   like(mccrdo)
     d jvarlc_ogrp     s                   like(jvogrp)
     d jvarlc_hgrp     s                   like(jvhgrp)
     d jvarlc_ugrp     s                   like(jvugrp)
     d jvpkl1_vare     s                   like(jwvare)
     d jvpkl1_ldor     s                   like(jwldor)
6.33 d vvprl1_ldor     s                   like(vpldor)
6.33 d vvprl1_vare     s                   like(vpvare)
6.33 d vvprl1_prgr     s                   like(vpprgr)
6.33 d vvprl1_enhe     s                   like(vpenhe)
6.31 d venhl1_eenh     s                   like(vaeenh)
      *
      * Definering av variable
      *
     d b_EOF           s              1    inz(*off)
     d b_lety          s              1    inz(*off)
     d b_oppd          s              1    inz(*off)
     d b_gtin          s              1    inz(*off)
     d b_pakn          s              1    inz(*off)
      *
     d w_firm          s              3  0
     d w_lety          s              1  0
     d w_gprk          s              1  0
     d w_osts          s              1
     d w_bvty          s              1
     d w_blet          s              1  0
     d w_bbet          s             35
     d w_udat          s               d   datfmt(*iso)
     d w_utim          s               t   timfmt(*iso)
     d w_dekn          s              5  2
     d w_enh           s              3
     d w_enh1          s              3
     d w_enh2          s              3
     d w_enh3          s              3
6.32 d w_enh4          s              3
6.32 d w_enh5          s              3
     d w_eni1          s              3
     d w_eni2          s              3
     d w_eni3          s              3
     d w_gtin          s                   like(vepgti)
     d w_gdat          s               d   datfmt(*iso)
     d w_grpr          s              9  2
     d w_ifak          s              8  6
     d w_midl          s              1  0
     d w_inpr          s              9  2
     d w_kbel          s              7  2
     d w_kfak          s              8  6
     d w_kopr          s              9  2
     d w_ntpr          s              8  2
     d w_ofp1          s             12  6
     d w_ofp2          s             12  6
     d w_ofp3          s             12  6
     d w_ofi1          s             12  6
     d w_ofi2          s             12  6
     d w_ofi3          s             12  6
     d w_ppko          s              1
     d w_pvty          s              1
     d w_plet          s              1  0
     d w_sfak          s              8  6
8.01 d w_prut          s              2
8.01 d w_prgr          s              2
     d w_dato          s                   like(jwodat)
     d w_ffak          s              8  6
     d w_inp2          s              9  2
     d w_pdat          s                   like(jwodat)
     d w_utgp          s              1  0
      *
     d w_bldo          s                   like(jvldor)
     d w_bhgr          s                   like(jvogrp)
     d w_bogr          s                   like(jvhgrp)
     d w_bugr          s                   like(jvugrp)
     d w_bmod          s                   like(jvmodn)
     d w_bvar          s                   like(jvvare)
     d w_lvar          s                   like(jvlvar)
     d w_pogr          s                   like(jvogrp)
     d w_phgr          s                   like(jvhgrp)
     d w_pugr          s                   like(jvugrp)
     d w_pldo          s                   like(jvldor)
     d w_pmod          s                   like(jvmodn)
     d w_pvar          s                   like(jvvare)
     d w_kmod          s                   like(jlkmod)
     d w_eann          s                   like(jxeann)
     d w_crdo          s                   like(jxcrdo)
     d w_enhs          s                   like(vguens)
     d w_enhl          s                   like(vguenl)
     d w_enhe          s                   like(veenhe)

     d w_pkla          s                   like(jwpkla)
     d w_best          s                   like(jwbest)
     d wwpvar          s                   like(vepvar)
     d wwpenh          s                   like(vepenh)
     d wwpgti          s                   like(vepgti)
     d w_enum          s                   like(jlenum)
6.31 d w_enmm          s              3
6.31 d w_enm1          s              3
6.31 d w_enm2          s              3
6.31 d w_enm3          s              3
6.31 d w_enm4          s              3
6.31 d w_enm5          s              3
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   eval      d_antw = 0
     c                   eval      d_antu = 0
      *
      * Utskrift av header
      *
     c                   exsr      hode
      *
      * Behandling av kontrolliste/journalliste, og utskrift av deltajlinjer
      *
     c                   exsr      behandling
6.31 c                   exsr      skriv_enhet
      *
      * Avslutt
      *
     c                   eval      p_antw = d_antw
     c                   eval      p_antu = d_antu
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering og utskrift av hode-opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hode          begsr
      *
      * Henter firmaopplysninger
      *
     c     afirl1_key    chain     afirl1r
      *
     c                   if        d_ugrp <> 0
     c                   eval      vugrl1_uogr = d_ogrp
     c                   eval      vugrl1_uhgr = d_hgrp
     c                   eval      vugrl1_uugr = d_ugrp
     c     vugrl1_key    chain     vugrl1
     c                   if        %found

     c                   endif
     c                   endif
      *
     c                   if        d_hgrp <> 0 and
     c                             d_ugrp =  0
     c                   eval      vhgrl1_hogr = d_ogrp
     c                   eval      vhgrl1_hhgr = d_hgrp
     c     vhgrl1_key    chain     vhgrl1
     c                   if        %found

     c                   endif
     c                   endif
      *
     c                   if        d_ogrp <> 0 and
     c                             d_hgrp =  0
     c                   eval      vogrl1_oogr = d_ogrp
     c     vogrl1_key    chain     vogrl1
     c                   if        %found
      *
     c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for lesing og behandling av varer for leverandør eller
      * prisgiver
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandling    begsr
      *
     c                   eval      jvarlc_ogrp = d_ogrp
     c                   eval      jvarlc_hgrp = d_hgrp
     c                   eval      jvarlc_ugrp = d_ugrp
      *
     c                   select
     c                   when      d_ugrp <> 0
     c     jvarlc_key1   setll     jvarlc
     c     jvarlc_key1   reade     jvarlc
     c                   when      d_hgrp <> 0
     c     jvarlc_key2   setll     jvarlc
     c     jvarlc_key2   reade     jvarlc
     c                   other
     c     jvarlc_key3   setll     jvarlc
     c     jvarlc_key3   reade     jvarlc
     c                   endsl
      *
     c                   dow       not %eof
     c                   if        d_vare <> ''
     c                   if        jvvare <> d_vare
     c                   goto      neste
     c                   endif
     c                   endif
      *
     c                   exsr      behandl_vare
      *
     c     neste         tag
     c                   select
     c                   when      d_ugrp <> 0
     c     jvarlc_key1   reade     jvarlc
     c                   when      d_hgrp <> 0
     c     jvarlc_key2   reade     jvarlc
     c                   other
     c     jvarlc_key3   reade     jvarlc
     c                   endsl
      *
     c                   enddo

      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Logge de enhenten som ikke ble overført
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.31 c     log_enhet     begsr
      *
     c                   if        w_enm1 = '' or w_enm1 = w_enmm
     c                   eval      w_enm1 = w_enmm
     c                   leavesr
     c                   elseif    w_enm2 = '' or w_enm2 = w_enmm
     c                   eval      w_enm2 = w_enmm
     c                   leavesr
     c                   elseif    w_enm3 = '' or w_enm3 = w_enmm
     c                   eval      w_enm3 = w_enmm
     c                   leavesr
     c                   elseif    w_enm4 = '' or w_enm4 = w_enmm
     c                   eval      w_enm4 = w_enmm
     c                   leavesr
     c                   elseif    w_enm5 = '' or w_enm5 = w_enmm
     c                   eval      w_enm5 = w_enmm
     c                   leavesr
     c                   endif
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Enheter ikke overført blir lagt i retur parameter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.31 c     skriv_enhet   begsr
      *

     c                   if        w_enm1 <> ''
     c                   eval      p_enhm = w_enm1
     c                   endif
     c                   if        w_enm2 <> ''
     c                   eval      p_enhm = p_enhm+','+w_enm2
     c                   endif
     c                   if        w_enm3 <> ''
     c                   eval      p_enhm = p_enhm+','+w_enm3
     c                   endif
     c                   if        w_enm4 <> ''
     c                   eval      p_enhm = p_enhm+','+w_enm4
     c                   endif
     c                   if        w_enm5 <> ''
     c                   eval      p_enhm = p_enhm+','+w_enm5
     c                   endif
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av varer som mather utplukkskriteriene
      * Behandler utskrift av detaljlinje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandl_vare  begsr
      *
     c
      *
      * Sjekker om varene skal være med på utplukket
      *
     c                   if        d_ogrp <> 0 and
     c                             d_ogrp <> jvogrp
     c                   leavesr
     c                   endif
      *
     c                   if        d_hgrp <> 0 and
     c                             d_hgrp <> jvhgrp
     c                   leavesr
     c                   endif
      *
     c                   if        d_ugrp <> 0 and
     c                             d_ugrp <> jvugrp
     c                   leavesr
     c                   endif
      *
      * Kaller sub-program for å sjekke status og hente data
      *
     c                   eval      w_lety = 0
     c                   eval      w_prgr = *blank
     c                   eval      w_gprk = 0
      *
     c*                  exsr      hent_data
      *
      * Oppdaterer EV og VA
      *
     c                   exsr      oppdater
      *
     c     end_behand    endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppdaterer av EV og VA
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppdater      begsr
      *
     c*                  if        w_osts <> *blank
     c*                  leavesr
     c*                  endif
      *
      * Henter EAN-nr og cross-docking informasjon fra pris
      *
     c                   eval      w_crdo = 0
     c                   eval      w_eann = 0
      *
      *
      * Henter statistikkenhet og lagerenhet fra varegruppe
      *
     c                   eval      w_enhs = *blank
     c                   eval      w_enhl = *blank
      *
     c                   eval      vugrl1_uogr = jvogrp
     c                   eval      vugrl1_uhgr = jvhgrp
     c                   eval      vugrl1_uugr = jvugrp
     c     vugrl1_key    chain     vugrl1
     c                   if        %found
     c                   eval      w_enhs = vguens
     c                   eval      w_enhl = vguenl
     c                   endif
      *
     c                   if        w_enhs = *blank or
     c                             w_enhl = *blank
     c                   eval      vhgrl1_hogr = jvogrp
     c                   eval      vhgrl1_hhgr = jvhgrp
     c     vhgrl1_key    chain     vhgrl1
     c                   if        %found
     c                   if        w_enhs = *blank
     c                   eval      w_enhs = vghens
     c                   endif
     c                   if        w_enhl = *blank
     c                   eval      w_enhl = vghenl
     c                   endif
     c                   endif
     c                   endif
      *
      * Oppretter EVR vare
      *
     c                   clear                   vvarlur
      *
     c                   eval      vvfirm = d_firm
     c                   eval      vvvare = jvvare
      *
      * sjekk om varen finnes
     c                   eval      vvarlu_vare = jvvare
     c     vvarlu_key    chain     vvarlu

     c                   eval      vvtek1 = jvtek1
     c                   eval      vvtek2 = jvtek2
     c                   eval      vvogrp = jvogrp
     c                   eval      vvhgrp = jvhgrp
     c                   eval      vvugrp = jvugrp
     c                   eval      vvsort = jvsort
     c                   eval      vvahgr = 0
     c                   eval      vvaugr = 0
6.30 c                   eval      vvldor = 0
     c                   eval      vvlvar = jvlvar
     c                   eval      vvnobb = jvnobb
     c                   eval      vvnmod = jvmodn
6.30 c                   eval      vvnlev = 0
     c                   eval      vvkpri = jvdpko
     c                   eval      vvvtyp = 'T'
     c                   eval      vvdesi = 2
     c                   eval      vvkstr = 00
     c                   eval      vvcrdo = w_crdo
     c                   eval      vvenps = *blank
     c                   eval      vvnuda = jvudat
     c                   eval      vveusr = l_user
      *
     c                   if        jvete1 <> *blank
     c                   eval      vvtek1 = jvete1
     c                   eval      vvtek2 = jvete2
     c                   endif
      *
     c                   if        jveogr <> 0 and
     c                             jvehgr <> 0 and
     c                             jveugr <> 0
     c                   eval      vvogrp = jveogr
     c                   eval      vvhgrp = jvehgr
     c                   eval      vvugrp = jveugr
     c                   endif
      *
      *
     c                   eval      jvpkl2_vare = jvvare
     c                   eval      jvpkl2_ldor = jvldor

     c                   eval      jvpklr_pakn = '000'
     c     jvpklr_key    chain     jvpklr
     c                   if        %found(jvpklr)
     c                   eval      vvenhl = jwenhe
     c                   eval      vvenhs = jwenhe
     c                   eval      vvenhe = jwenhe
     c                   endif

     c     jvpkl2_key2   setll     jvpkl2
     c     jvpkl2_key2   reade     jvpkl2
     c                   dow       not %eof
      *
      * sjekker fra / tildato
     c                   exsr      sjekk_pkdato
     c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
      *
     c                   if        jwpsen = 1
     c                   eval      vvenps = jwenhe
     c                   leave
     c                   endif
     c                   endif
     c     jvpkl2_key2   reade     jvpkl2
     c                   enddo
      *
     c                   time                    vvedat
     c                   time                    vvetim
      *
     c                   if        not %found(vvarlu)
     c                   eval      vvousr = l_user
     c                   time                    vvodat
     c                   time                    vvotim
     c                   write     vvarlur
     c                   eval      d_antw = d_antw + 1
     c                   else
     c                   update    vvarlur
     c                   eval      d_antu = d_antu + 1
     c                   endif
      *
     c                   eval      b_oppd = *on
      *
      * Oppretter EVR vare-enhet
      *
     c                   exsr      finn_enhet
     c                   exsr      oppr_enhet
      *
      * Oppretter EVR vare-pris
      *
6.30 c                   exsr      oppr_pris
      *
      * Fjerner vare fra register over slettede varer
      *
     c                   eval      vvaslu_vare = jvvare
     c     vvaslu_key    chain     vvaslur
     c                   if        %found
     c                   delete    vvaslur
     c                   endif

6.30  * Oppretter vare på lager
6.30  *
6.30  *
6.30 c     ra10l1_key    setll     ra10l1
6.30 c     ra10l1_key    reade     ra10l1
6.30 c                   dow       not %eof(ra10l1)
6.30  *
6.30 c                   clear                   vlaglur
6.30 c                   eval      vlaglu_vare = jvvare
6.30 c                   eval      vlaglu_lage = rajkod
6.30 c     vlaglu_key    chain     vlaglu
6.30 c                   if        not %found(vlaglu)

6.30 c                   eval      vlfirm = w_firm
6.30 c                   eval      vlvare = jvvare
6.30 c                   eval      vllage = rajkod
6.30 c                   eval      vlenhl = vvenhl
6.30 c                   eval      vltrda = w_udat
6.30 c                   eval      vlvtyp = 'T'
6.30 c                   time                    vlodat
6.30 c                   time                    vlotim
6.30 c                   time                    vledat
6.30 c                   time                    vletim
6.30 c                   eval      vlousr = l_user
6.30 c                   eval      vleusr = l_user
6.30 c                   write     vlaglur
6.30 c                   endif
6.30  *
6.30 c     ra10l1_key    reade     ra10l1
6.30 c                   enddo
6.30  *
6.30  *
      *
      * Oppretter søketekster i EVR lik modulstikkord og egne søketekster
      * Søketeksten blir ikke kopiert over dersom den allerede finnes i
      * EVR søketekstregister
      *
     c                   eval      jsokl1_vare = jvvare
     c     jsokl1_key    setll     jsokl1
     c     jsokl1_key    reade     jsokl1
     c                   dow       not %eof
     c                   if        jsokod = 'L' or
     c                             jsokod = 'M' and
     c                             w_kmod = 1
     c                   eval      vsokl1_vare = jsvare
     c                   eval      vsokl1_stek = jsstek
     c     vsokl1_key    chain     vsokl1
     c                   if        not %found
     c                   eval      vsfirm = w_firm
     c                   eval      vsvare = jsvare
     c                   eval      vsstek = jsstek
     c                   write     vsoklur
     c                   endif
     c                   endif
     c     jsokl1_key    reade     jsokl1
     c                   enddo
      *
      * Oppdaterer søketekst mot vare i EVR
      *
     c                   call      'VV750R'
     c                   parm                    w_firm
     c                   parm                    jvvare
      *
     c                   if        jvean1 <> 0
      *
      * sjekker om ean-nr allerede ligger på vare  enhet
      * hvis ikke så legges den i generelt ean-nr register
      *
     c                   eval      vvepl2_pgti = jvean1
     c     vvepl2_key    chain     vvepl2
     c                   if        not %found(vvepl2)
      *
     c                   clear                   veanlur
     c                   eval      veanl1_eann = jvean1
     c     veanl1_key    chain     veanl1
     c                   if        not %found
     c                   eval      vxfirm = w_firm
     c                   eval      vxvare = jvvare
     c                   eval      vxenhe = *blank
     c                   eval      vxeann = jvean1
     c                   eval      vxeusr = l_user
     c                   time                    vxtime
     c                   time                    vxedat
     c                   time                    vxetim
     c                   write     veanlur
     c                   else
     c                   if        vxvare <> jvvare
     c                   eval      veanlu_eann = jvean1
     c     veanlu_key    chain     veanlur
     c                   if        %found(veanlu)
     c                   eval      vxvare = jvvare
     c                   eval      vxenhe = *blank
     c                   time                    vxetim
     c                   time                    vxedat
     c                   update    veanlur
     c                   endif
     c                   endif
     c                   endif
      *
     c                   endif
      *
     c                   endif
     c                   if        w_eann <> 0
      * Ean-nr fra varepris
      * sjekker om ean-nr allerede ligger på vare  enhet
      * hvis ikke så legges den i generelt ean-nr register
      *
     c                   eval      vvepl2_pgti = w_eann
     c     vvepl2_key    chain     vvepl2
     c                   if        not %found(vvepl2)
      *
     c                   clear                   veanlur
     c                   eval      veanl1_eann = w_eann
     c     veanl1_key    chain     veanl1
     c                   if        not %found
     c                   eval      vxfirm = w_firm
     c                   eval      vxvare = jvvare
     c                   eval      vxenhe = *blank
     c                   eval      vxeann = w_eann
     c                   eval      vxeusr = l_user
     c                   time                    vxtime
     c                   time                    vxedat
     c                   time                    vxetim
     c                   write     veanlur
     c                   else
     c                   if        vxvare <> jvvare
     c                   eval      veanlu_eann = w_eann
     c     veanlu_key    chain     veanlur
     c                   if        %found(veanlu)
     c                   eval      vxvare = jvvare
     c                   eval      vxenhe = *blank
     c                   time                    vxetim
     c                   time                    vxedat
     c                   update    veanlur
     c                   endif
     c                   endif
     c                   endif
      *
     c                   endif
      *
     c                   endif
      *
      * Fjerner rad fra midlertidig prisendrings-register
      *
     c                   eval      jwprlu_vare = jvvare
     c     jwprlu_key    chain     jwprlur
     c                   if        %found
     c                   delete    jwprlur
     c                   endif
      *
      * Legger varen på Hold, og endrer til skaffevare dersom dette er valgt
      *
     c                   clear                   jvdtlur
      *
     c                   eval      jvdtlu_dvar = jvvare
     c     jvdtlu_key    chain     jvdtlur
      *
     c                   eval      jvdhko = 1

      *
     c                   if        %found
     c                   update    jvdtlur
     c                   else
     c                   eval      jvdfir = w_firm
     c                   eval      jvdvar = jvvare
     c                   write     jvdtlur
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppretting av enheter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppr_enhet    begsr
      *
6.31 c                   eval      venhl1_eenh = w_enh1
6.31 c     venhl1_key    chain     venhl1
6.31 c                   if        not %found
6.31 c                   eval      w_enmm = w_enh1
6.31 c                   exsr      log_enhet
6.31 c*                  goto      enh2
6.31 c                   endif
      *
     c                   clear                   vvenlur
      *
      * Salgsenhet-1
      *
      * sjekk om enhet finnes
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_enh1
     c     vvenlu_key    chain     vvenlu
      *
     c                   eval      w_gtin = 0
     c                   eval      w_pkla = *blank
     c                   eval      w_best = 0
      *
     c                   eval      vefirm = w_firm
     c                   eval      vevare = jvvare
     c                   eval      veenhe = w_enh1
     c                   eval      vesaen = 1
     c                   eval      veinen = 0
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   select
     c                   when      veenhe = w_eni1
     c                   eval      veinen = 1
     c                   when      veenhe = w_eni2
     c                   eval      veinen = 2
     c                   when      veenhe = w_eni3
     c                   eval      veinen = 3
     c                   endsl
      *

     c                   eval      jvpkl2_vare = vevare
     c                   eval      jvpkl2_ldor = jvldor
     c                   eval      jvpkl2_enhe = veenhe
     c     jvpkl2_key    setll     jvpkl2
     c     jvpkl2_key    reade     jvpkl2
     c                   dow       not %eof
      *
      * sjekker fra / tildato
     c                   exsr      sjekk_pkdato
     c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      w_gtin = jwgtin
     c                   eval      w_pkla = jwpkla
     c                   eval      w_best = jwbest
     c                   endif
     c     jvpkl2_key    reade     jvpkl2
     c                   enddo
      *
     c                   eval      veeusr = l_user
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      veousr = l_user
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
      *
      * oppretter vare-pakning-prisgiver
     c                   exsr      oppr_vep
      *
      * Salgsenhet-2
      *
     c     enh2          tag
     c                   if        w_enh2 <> *blank
      *
6.31 c                   eval      venhl1_eenh = w_enh2
6.31 c     venhl1_key    chain     venhl1
6.31 c                   if        not %found
6.31 c                   eval      w_enmm = w_enh2
6.31 c                   exsr      log_enhet
6.31 c*                  goto      enh3
6.31 c                   endif
      *
      *
      * sjekk om enhet finnes
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_enh2
     c     vvenlu_key    chain     vvenlu
      *
     c                   eval      w_gtin = 0
     c                   eval      w_pkla = *blank
     c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_enh2
     c                   eval      vesaen = 2
     c                   eval      veinen = 0
     c                   eval      vepben = 0
6.32 c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   select
     c                   when      veenhe = w_eni1
     c                   eval      veinen = 1
     c                   when      veenhe = w_eni2
     c                   eval      veinen = 2
     c                   when      veenhe = w_eni3
     c                   eval      veinen = 3
     c                   endsl
      *
     c                   eval      jvpkl2_vare = vevare
     c                   eval      jvpkl2_ldor = jvldor
     c                   eval      jvpkl2_enhe = veenhe
     c     jvpkl2_key    setll     jvpkl2
     c     jvpkl2_key    reade     jvpkl2
     c                   dow       not %eof
      *
      * sjekker fra / tildato
     c                   exsr      sjekk_pkdato
     c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
      *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      w_gtin = jwgtin
     c                   eval      w_pkla = jwpkla
     c                   eval      w_best = jwbest
     c                   endif
     c     jvpkl2_key    reade     jvpkl2
     c                   enddo
      *
     c                   eval      veeusr = l_user
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   eval      veeusr = l_user
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      veousr = l_user
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
      *
      * oppretter vare-pakning-prisgiver
     c                   exsr      oppr_vep
      *
     c                   endif
      *
      * Salgsenhet-3
      *
     c     enh3          tag
     c                   if        w_enh3 <> *blank
      *
6.31 c                   eval      venhl1_eenh = w_enh3
6.31 c     venhl1_key    chain     venhl1
6.31 c                   if        not %found
6.31 c                   eval      w_enmm = w_enh3
6.31 c                   exsr      log_enhet
6.31 c*                  goto      enhi1
6.31 c                   endif
      *
      *
      * sjekk om enhet finnes
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_enh3
     c     vvenlu_key    chain     vvenlu
      *
     c                   eval      w_gtin = 0
     c                   eval      w_pkla = *blank
     c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_enh3
     c                   eval      vesaen = 3
     c                   eval      veinen = 0
     c                   eval      vepben = 0
6.32 c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   select
     c                   when      veenhe = w_eni1
     c                   eval      veinen = 1
     c                   when      veenhe = w_eni2
     c                   eval      veinen = 2
     c                   when      veenhe = w_eni3
     c                   eval      veinen = 3
     c                   endsl
      *
     c                   eval      jvpkl2_vare = vevare
     c                   eval      jvpkl2_ldor = jvldor
     c                   eval      jvpkl2_enhe = veenhe
     c     jvpkl2_key    setll     jvpkl2
     c     jvpkl2_key    reade     jvpkl2
     c                   dow       not %eof
      *
      * sjekker fra / tildato
     c                   exsr      sjekk_pkdato
     c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
      *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      w_gtin = jwgtin
     c                   eval      w_pkla = jwpkla
     c                   eval      w_best = jwbest
     c                   endif
     c     jvpkl2_key    reade     jvpkl2
     c                   enddo
      *
     c                   eval      veeusr = l_user
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      veousr = l_user
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
      *
      * oppretter vare-pakning-prisgiver
     c                   exsr      oppr_vep
      *
     c                   endif
6.32  *
6.32  * Salgsenhet-4
6.32  *
     c     enh4          tag
     c                   if        w_enh4 <> *blank
      *
     c                   eval      venhl1_eenh = w_enh4
     c     venhl1_key    chain     venhl1
     c                   if        not %found
     c                   eval      w_enmm = w_enh4
     c                   exsr      log_enhet
     c                   endif
      *
      *
      * sjekk om enhet finnes
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_enh4
     c     vvenlu_key    chain     vvenlu
      *
     c                   eval      w_gtin = 0
     c                   eval      w_pkla = *blank
     c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_enh4
     c                   eval      vesaen = 4
     c                   eval      veinen = 0
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   eval      jvpkl2_vare = vevare
     c                   eval      jvpkl2_ldor = jvldor
     c                   eval      jvpkl2_enhe = veenhe
     c     jvpkl2_key    setll     jvpkl2
     c     jvpkl2_key    reade     jvpkl2
     c                   dow       not %eof
      *
      * sjekker fra / tildato
     c                   exsr      sjekk_pkdato
     c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
      *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      w_gtin = jwgtin
     c                   eval      w_pkla = jwpkla
     c                   eval      w_best = jwbest
     c                   endif
     c     jvpkl2_key    reade     jvpkl2
     c                   enddo
      *
     c                   eval      veeusr = l_user
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      veousr = l_user
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
      *
      * oppretter vare-pakning-prisgiver
     c                   exsr      oppr_vep
      *
     c                   endif
6.32  *
6.32  * Salgsenhet-5
6.32  *
     c     enh5          tag
     c                   if        w_enh5 <> *blank
      *
     c                   eval      venhl1_eenh = w_enh5
     c     venhl1_key    chain     venhl1
     c                   if        not %found
     c                   eval      w_enmm = w_enh5
     c                   exsr      log_enhet
     c                   endif
      *
      *
      * sjekk om enhet finnes
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_enh5
     c     vvenlu_key    chain     vvenlu
      *
     c                   eval      w_gtin = 0
     c                   eval      w_pkla = *blank
     c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_enh5
     c                   eval      vesaen = 5
     c                   eval      veinen = 0
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   eval      jvpkl2_vare = vevare
     c                   eval      jvpkl2_ldor = jvldor
     c                   eval      jvpkl2_enhe = veenhe
     c     jvpkl2_key    setll     jvpkl2
     c     jvpkl2_key    reade     jvpkl2
     c                   dow       not %eof
      *
      * sjekker fra / tildato
     c                   exsr      sjekk_pkdato
     c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
      *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      w_gtin = jwgtin
     c                   eval      w_pkla = jwpkla
     c                   eval      w_best = jwbest
     c                   endif
     c     jvpkl2_key    reade     jvpkl2
     c                   enddo
      *
     c                   eval      veeusr = l_user
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      veousr = l_user
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
      *
      * oppretter vare-pakning-prisgiver
     c                   exsr      oppr_vep
      *
     c                   endif

      *
      * Innkjøpsenhet-1
      *
     c     enhi1         tag
     c                   if        w_eni1 <> *blank and
     c                             w_eni1 <> w_enh1 and
     c                             w_eni1 <> w_enh2 and
     c                             w_eni1 <> w_enh3
      *
6.31 c                   eval      venhl1_eenh = w_eni1
6.31 c     venhl1_key    chain     venhl1
6.31 c                   if        not %found
6.31 c                   eval      w_enmm = w_eni1
6.31 c                   exsr      log_enhet
6.31 c*                  goto      enhi2
6.31 c                   endif
      *
      *
      * sjekk om enhet finnes
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_eni1
     c     vvenlu_key    chain     vvenlu

     c                   eval      w_gtin = 0
     c                   eval      w_pkla = *blank
     c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_eni1
     c                   eval      vesaen = 0
     c                   eval      veinen = 1
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   eval      jvpkl2_vare = vevare
     c                   eval      jvpkl2_ldor = jvldor
     c                   eval      jvpkl2_enhe = veenhe
     c     jvpkl2_key    setll     jvpkl2
     c     jvpkl2_key    reade     jvpkl2
     c                   dow       not %eof
      *
      * sjekker fra / tildato
     c                   exsr      sjekk_pkdato
     c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
      *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      veomre = w_ofi1
     c                   eval      w_gtin = jwgtin
     c                   eval      w_pkla = jwpkla
     c                   eval      w_best = jwbest
     c                   endif
     c     jvpkl2_key    reade     jvpkl2
     c                   enddo
      *
     c                   eval      veeusr = l_user
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      veousr = l_user
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
      *
      * oppretter vare-pakning-prisgiver
     c                   exsr      oppr_vep
      *
     c                   endif
      *
      * Innkjøpsenhet-2
      *
     c     enhi2         tag
     c                   if        w_eni2 <> *blank and
     c                             w_eni2 <> w_enh1 and
     c                             w_eni2 <> w_enh2 and
     c                             w_eni2 <> w_enh3
      *
6.31 c                   eval      venhl1_eenh = w_eni2
6.31 c     venhl1_key    chain     venhl1
6.31 c                   if        not %found
6.31 c                   eval      w_enmm = w_eni2
6.31 c                   exsr      log_enhet
6.31 c*                  goto      enhi3
6.31 c                   endif
      *
      * sjekk om enhet finnes
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_eni2
     c     vvenlu_key    chain     vvenlu
      *
     c                   eval      w_gtin = 0
     c                   eval      w_pkla = *blank
     c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_eni2
     c                   eval      vesaen = 0
     c                   eval      veinen = 2
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   eval      jvpkl2_vare = vevare
     c                   eval      jvpkl2_ldor = jvldor
     c                   eval      jvpkl2_enhe = veenhe
     c     jvpkl2_key    setll     jvpkl2
     c     jvpkl2_key    reade     jvpkl2
     c                   dow       not %eof
      *
      * sjekker fra / tildato
     c                   exsr      sjekk_pkdato
     c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
      *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      veomre = w_ofi2
     c                   eval      w_gtin = jwgtin
     c                   eval      w_pkla = jwpkla
     c                   eval      w_best = jwbest
     c                   endif
     c     jvpkl2_key    reade     jvpkl2
     c                   enddo
      *
     c                   eval      veeusr = l_user
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      veousr = l_user
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
      *
      * oppretter vare-pakning-prisgiver
     c                   exsr      oppr_vep
      *
     c                   endif
      *
      * Innkjøpsenhet-3
      *
     c     enhi3         tag
     c                   if        w_eni3 <> *blank and
     c                             w_eni3 <> w_enh1 and
     c                             w_eni3 <> w_enh2 and
     c                             w_eni3 <> w_enh3
      *
6.31 c                   eval      venhl1_eenh = w_eni3
6.31 c     venhl1_key    chain     venhl1
6.31 c                   if        not %found
6.31 c                   eval      w_enmm = w_eni3
6.31 c                   exsr      log_enhet
6.31 c*                  goto      enhf
6.31 c                   endif
      *
      * sjekk om enhet finnes
     c                   eval      vvenlu_vare = jvvare
     c                   eval      vvenlu_enhe = w_eni3
     c     vvenlu_key    chain     vvenlu
      *
     c                   eval      w_gtin = 0
     c                   eval      w_pkla = *blank
     c                   eval      w_best = 0
      *
     c                   eval      veenhe = w_eni3
     c                   eval      vesaen = 0
     c                   eval      veinen = 3
     c                   eval      vepben = 0
     c                   eval      veomre = 1
     c                   eval      veleng = 0
     c                   eval      vebred = 0
     c                   eval      vehoyd = 0
     c                   eval      vevekt = 0
     c                   eval      vevolu = 0
      *
     c                   eval      jvpkl2_vare = vevare
     c                   eval      jvpkl2_ldor = jvldor
     c                   eval      jvpkl2_enhe = veenhe
     c     jvpkl2_key    setll     jvpkl2
     c     jvpkl2_key    reade     jvpkl2
     c                   dow       not %eof
      *
      * sjekker fra / tildato
     c                   exsr      sjekk_pkdato
     c                   if        b_pakn = *on  and
     c                             jwpakn <> '000'
      *
     c                   eval      veleng = jwleng
     c                   eval      vebred = jwbred
     c                   eval      vehoyd = jwhoyd
     c                   eval(h)   vevekt = jwvekt / 1000
     c                   eval      vevolu = jwvolu
     c                   eval      veomre = w_ofi3
     c                   eval      w_gtin = jwgtin
     c                   eval      w_pkla = jwpkla
     c                   eval      w_best = jwbest
     c                   endif
     c     jvpkl2_key    reade     jvpkl2
     c                   enddo
      *
     c                   eval      veeusr = l_user
     c                   time                    veedat
     c                   time                    veetim
      *
     c                   if        %found(vvenlu)
     c                   update    vvenlur
     c                   else
     c                   eval      veousr = l_user
     c                   time                    veodat
     c                   write     vvenlur
     c                   endif
      *
      * oppretter vare-pakning-prisgiver
     c                   exsr      oppr_vep
      *
     c                   endif
     c     enhf          tag
      *
     c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å dann vare-enhet-prisgiver
      * Riktig JVPKPF er lest, så det skal bare være å skrive til vveppf
      * Skriver kun til den valgte prisgiver
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppr_vep      begsr
      *
      *  Riktig JVPKPF er lest, så det skal bare være å skrive til vveppf
      *
     c                   eval      wwpgti = w_gtin
      *
     c                   eval      wwpvar      = vevare
     c                   eval      wwpenh      = veenhe
     c                   exsr      rydd_ean
      *
     c                   clear                   vveplur
     c                   eval      vveplu_pvar = vevare
     c                   eval      vveplu_penh = veenhe
6.30 c                   eval      vveplu_pldo = 0
     c     vveplu_key    chain     vveplu
     c                   eval      vepkla = w_pkla
     c                   eval      vepbes = w_best
     c                   eval      vepgti = w_gtin
     c                   if        %found(vveplu)
     c                   eval      vepeus = l_user
     c                   time                    vepeti
     c                   time                    vepeda
     c                   update    vveplur
     c                   else
     c                   eval      vepfir = w_firm
     c                   eval      vepvar = vveplu_pvar
     c                   eval      vepenh = vveplu_penh
     c                   eval      vepldo = vveplu_pldo
     c                   eval      vepeus = l_user
     c                   time                    vepeti
     c                   time                    vepeda
     c                   eval      vepous = l_user
     c                   time                    vepoti
     c                   time                    vepoda
     c                   write     vveplur
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å rydde ean-nr på veanpf som ligger på vvenpf
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     rydd_ean      begsr
      *
     c                   if        wwpgti = 0
     c                   leavesr
     c                   endif
     c                   eval      veanlu_eann = wwpgti
     c     veanlu_key    chain     veanlu
     c                   if        %found(veanlu)
     c                   delete    veanlur
     c                   endif
      *
      * sjekker om gtin ligger på annen vare-sletter denne
      * eller at det ligger på samme vare, men forskj. enhet.
      *
     c                   eval      vvepl2_pgti = wwpgti
     c     vvepl2_key    setll     vvepl2
     c     vvepl2_key    reade     vvepl2
     c                   dow       not %eof(vvepl2)
     c                   if        (vepvar <> wwpvar) or
     c                             (vepvar = wwpvar and
     c                             vepenh <> wwpenh)
     c                   if        vepvar <> wwpvar
     c                   eval      vepgti = 0
     c                   endif
     c                   if        vepvar = wwpvar and
     c                             vepenh <> wwpenh
     c                   eval      vepgti = 0
     c                   endif
     c                   time                    vepeda
     c                   time                    vepeti
     c                   update    vvepl2r
     c                   endif
     c     vvepl2_key    reade     vvepl2
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å sjekke om dato er innenfor fra /til dato
      * hvis *loval i begge datoer = ok
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_pkdato  begsr
      *
     c                   eval      b_pakn = *on
      *
     c                   if        jwfdat = *loval and
     c                             jwtdat = *loval
     c                   leavesr
     c                   endif
      *
     c                   if        jwfdat <= w_dato and
     c                             jwtdat >  w_dato
     c                   leavesr
     c                   endif
      *
     c                   if        jwfdat = *loval  and
     c                             jwtdat >  w_dato
     c                   leavesr
     c                   endif
      *
     c                   if        jwfdat <= w_dato and
     c                             jwtdat =  *loval
     c                   leavesr
     c                   endif
      *
     c                   eval      b_pakn = *off
      *
     c                   endsr

      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for finne enhet 1
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     finn_enhet    begsr
      *
     c                   eval      w_enhe = *blank
     c                   eval      w_enh1 = *blank
     c                   eval      w_enh2 = *blank
     c                   eval      w_enh3 = *blank
6.33 c                   eval      w_enh4 = *blank
6.33 c                   eval      w_enh5 = *blank
     c                   eval      w_eni1 = *blank
     c                   eval      w_eni2 = *blank
     c                   eval      w_eni3 = *blank
      *
      * Leser vare-pakning for å sjekke om enhet er gyldig enhet på varen
      *
     c                   eval      jvpkl1_vare = jvvare
     c                   eval      jvpkl1_ldor = jvldor
     c     jvpkl1_key    setll     jvpkl1
     c     jvpkl1_key    reade     jvpkl1
     c                   dow       not %eof
      *
     c                   if        jwpakn = '000'
     c                   eval      w_enhe = jwenhe
     c                   else
      *
     c                   select
     c                   when      w_enh1 = *blank
     c                   eval      w_enh1 = jwenhe
     c                   when      w_enh1 <> *blank and
     c                             w_enh2 = *blank
     c                   eval      w_enh2 = jwenhe
     c                   when      w_enh1 <> *blank and
     c                             w_enh2 <> *blank and
     c                             w_enh3 = *blank
     c                   eval      w_enh3 = jwenhe
     c                   when      w_enh1 <> *blank and
     c                             w_enh2 <> *blank and
     c                             w_enh3 <> *blank and
     c                             w_enh4 = *blank
     c                   eval      w_enh4 = jwenhe
     c                   when      w_enh1 <> *blank and
     c                             w_enh2 <> *blank and
     c                             w_enh3 <> *blank and
     c                             w_enh4 <> *blank and
     c                             w_enh5 = *blank
     c                   eval      w_enh5 = jwenhe
     c                   leave
     c                   endsl
      *
     c                   if        jwbest = 1  and
     c                             jwgtin <> 0
     c                   select
     c                   when      w_eni1 = *blank
     c                   eval      w_eni1 = jwenhe
     c                   when      w_eni1 <> *blank and
     c                             w_eni2 = *blank
     c                   eval      w_eni2 = jwenhe
     c                   when      w_eni1 <> *blank and
     c                             w_eni2 <> *blank and
     c                             w_eni3 = *blank
     c                   eval      w_eni3 = jwenhe
     c                   endsl
     c                   endif
     c                   endif
      *
     c     jvpkl1_key    reade     jvpkl1
     c                   enddo
      *
     c                   if        w_enhe <> *blank
      *
      * sjekke om 000 er lik en av enhetene, hvis så OK
     c                   if        w_enhe = w_enh1 or
     c                             w_enhe = w_enh2 or
     c                             w_enhe = w_enh3 or
     c                             w_enhe = w_enh4 or
     c                             w_enhe = w_enh5
     c                   leavesr
     c                   endif
      * sjekker hvilken enhet skal byttes ut.
     c                   if        w_enh1 = *blank
     c                   eval      w_enh1 = w_enhe
     c                   leavesr
     c                   endif
     c                   if        w_enh2 = *blank
     c                   eval      w_enh2 = w_enhe
     c                   leavesr
     c                   endif
     c                   if        w_enh3 = *blank
     c                   eval      w_enh3 = w_enhe
     c                   leavesr
     c                   endif
     c                   if        w_enh4 = *blank
     c                   eval      w_enh4 = w_enhe
     c                   leavesr
     c                   endif
     c                   if        w_enh5 = *blank
     c                   eval      w_enh5 = w_enhe
     c                   leavesr
     c                   endif
      * ingen ledig plass
      * her må man legge prisenhet i enht 5
     c                   eval      w_enh5 = w_enhe
      *
      * hvis innkjøpsenhet 1 (det er kun det som skal oppdateres) = blank
      * så settes innkjøpsenhet lik salgsenhet1.
      *
     c                   if        w_eni1 = *blank
     c                   eval      w_eni1 = w_enh1
     c                   endif
      *
     c                   endif
      *
     c     pse_enhet     tag
      *
     c                   endsr
      *
6.30  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  * Subrutine for oppretting av vare-pris på leveringstype
6.30  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  *
6.30 c     oppr_pris     begsr
6.30  *
      * sjekker om det finnes pris på denne datoen allerede
      *
6.33 c*                  eval      vvprl3_vare = jvvare
6.33 c*                  eval      vvprl3_ldor = 0
6.33 c*    vvprl3_key    chain     vvprl3
6.33 c*                  if        %found(vvprl3)
6.33 c*                  leavesr
6.33 c*                  endif
      *
6.30 c                   clear                   vvprlur
6.30  *
6.30  * Salgsenheter
6.30  *
6.30 c                   eval      vpfirm = p_firm
6.30 c                   eval      vpvare = jvvare
6.30 c                   eval      vpldor = 0
6.30 c                   eval      vpprgr = w_prgr
6.30 c                   eval      vplety = w_lety
6.30 c                   eval      vpenhe = w_enh1
6.30 c                   eval      vpsapr = 0
6.30 c                   eval      vpkopr = 0
6.30 c                   eval      vpinpr = 0
6.30 c                   eval      vpinp2 = 0
6.30 c                   eval      vpbupr = 0
6.30 c                   eval      vpeusr = l_user
     c                   eval      vpousr = l_user
6.30  *
6.30 c                   time                    vppdat
6.30 c                   time                    vpedat
6.30 c                   time                    vpetim
     c                   time                    vpodat
     c                   time                    vpotim
      *
6.33 c                   eval      vvprl1_ldor = 0
6.33 c                   eval      vvprl1_vare = jvvare
6.33 c                   eval      vvprl1_prgr = ''
6.33 c                   eval      vvprl1_enhe = w_enh1
6.33 c     vvprl1_key    chain     vvprl1
6.33 c                   if        not(%found)
6.30 c                   write     vvprlur
6.33 c                   endif
      *
6.33 c                   eval      vvprl1_enhe = w_enh2
6.33 c     vvprl1_key    chain     vvprl1
6.33 c                   if        not(%found)
6.33 c                   if        w_enh2 <> ''
     c                   eval      vpenhe = w_enh2
     c                   eval      vpsapr = 0
     c                   eval(h)   vpkopr = 0
     c                   eval(h)   vpinpr = 0
6.36 c                   eval(h)   vpinp2 = 0
     c                   write     vvprlur
     c                   endif
6.33 c                   endif
      *
6.33 c                   eval      vvprl1_enhe = w_enh3
6.33 c     vvprl1_key    chain     vvprl1
6.33 c                   if        not(%found)
6.33 c                   if        w_enh3 <> ''
     c                   eval      vpenhe = w_enh3
     c                   eval      vpsapr = 0
     c                   eval(h)   vpkopr = 0
     c                   eval(h)   vpinpr = 0
6.36 c                   eval(h)   vpinp2 = 0
     c                   write     vvprlur
     c                   endif
6.33 c                   endif
      *
6.33 c                   eval      vvprl1_enhe = w_enh4
6.33 c     vvprl1_key    chain     vvprl1
6.33 c                   if        not(%found)
6.33 c                   if        w_enh4 <> ''
6.33 c                   eval      vpenhe = w_enh4
6.33 c                   eval      vpsapr = 0
6.33 c                   eval(h)   vpkopr = 0
6.33 c                   eval(h)   vpinpr = 0
6.33 c                   eval(h)   vpinp2 = 0
6.33 c                   write     vvprlur
6.33 c                   endif
6.33 c                   endif
      *
6.33 c                   eval      vvprl1_enhe = w_enh5
6.33 c     vvprl1_key    chain     vvprl1
6.33 c                   if        not(%found)
6.33 c                   if        w_enh5 <> ''
6.33 c                   eval      vpenhe = w_enh5
6.33 c                   eval      vpsapr = 0
6.33 c                   eval(h)   vpkopr = 0
6.33 c                   eval(h)   vpinpr = 0
6.33 c                   eval(h)   vpinp2 = 0
6.33 c                   write     vvprlur
6.33 c                   endif
6.33 c                   endif
      *
6.30 c                   endsr

      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_firm
     c                   parm                    p_ogrp
     c                   parm                    p_hgrp
     c                   parm                    p_ugrp
     c                   parm                    p_vare
     c                   parm                    p_antw
     c                   parm                    p_antu
     c                   parm                    p_enhm
      *
      * Flytter inngående parametre til utgående.
      *
     c                   eval      d_firm = p_firm

     c                   eval      d_ogrp = p_ogrp
     c                   eval      d_hgrp = p_hgrp
     c                   eval      d_ugrp = p_ugrp
     c                   eval      d_vare = p_vare
      *
      * Key for les på vare m/varegruppe
      *
     c     jvarlc_key1   klist
     c                   kfld                    jvarlc_ogrp
     c                   kfld                    jvarlc_hgrp
     c                   kfld                    jvarlc_ugrp
      *
     c     jvarlc_key2   klist
     c                   kfld                    jvarlc_ogrp
     c                   kfld                    jvarlc_hgrp
      *
     c     jvarlc_key3   klist
     c                   kfld                    jvarlc_ogrp

      *
      * Key for oppslag på vare
      *
     c     jvarl1_key    klist
     c                   kfld                    jvarl1_vare
      *
      * Key for oppslag på EVR-vare
      *
     c     vvarlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarlu_vare
      *
      * Key for les av vare-pris pr. leverandør  vare
      *
     c     vvprl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvprl1_vare
     c                   kfld                    vvprl1_ldor
     c                   kfld                    vvprl1_prgr
     c                   kfld                    vvprl1_enhe
      *
      * Key for oppslag på vare pakning
      *
      *
     c     jvpkl1_key    klist
     c                   kfld                    jvpkl1_vare
     c                   kfld                    jvpkl1_ldor
      *
      * Key for oppslag på vare enhet  pr. eann
      *
     c     vvepl2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvepl2_pgti
      *
      * Key for oppdatering på vare enhet
      *
     c     vvenlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvenlu_vare
     c                   kfld                    vvenlu_enhe
      *
      * Key for oppdatering på vare enhet prisgiver
      *
     c     vveplu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vveplu_pvar
     c                   kfld                    vveplu_penh
     c                   kfld                    vveplu_pldo
      *
      * Key for les på vare-pakning
      *
     c     jvpkl2_key    klist
     c                   kfld                    jvpkl2_vare
     c                   kfld                    jvpkl2_ldor
     c                   kfld                    jvpkl2_enhe
      *
     c     jvpkl2_key2   klist
     c                   kfld                    jvpkl2_vare
     c                   kfld                    jvpkl2_ldor
      *
     c     jvpklr_key    klist
     c                   kfld                    jvpkl2_vare
     c                   kfld                    jvpkl2_ldor
     c                   kfld                    jvpklr_pakn

      *
      * Key for oppdatering av register over slettede varer
      *
     c     vvaslu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvaslu_vare
      *
      * Key for oppslag på EAN
      *
     c     veanl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    veanl1_eann
      *
      * Key for oppdat. på EAN
      *
     c     veanlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    veanlu_eann
      *
      * Key for les på søketekst
      *
     c     jsokl1_key    klist
     c                   kfld                    jsokl1_vare
      *
      * Key for oppslag på EVR-søketekst
      *
     c     vsokl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vsokl1_vare
     c                   kfld                    vsokl1_stek
      *
      * Key for oppdatering av midlertidig pris
      *
     c     jwprlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jwprlu_vare
      *
      * Key for oppdatering av vare-detalj
      *
     c     jvdtlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    jvdtlu_dvar
      *
      * Key for oppslag på firma
      *
     c     afirl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på OFAK-kode
      *
     c     fstsl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på leverandør
      *
     c     jlevl1_key    klist
     c                   kfld                    jlevl1_ldor
      *
      * Key for oppslag på overgruppe
      *
     c     vogrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vogrl1_oogr
      *
      * Key for oppslag på hovedgruppe
      *
     c     vhgrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vhgrl1_hogr
     c                   kfld                    vhgrl1_hhgr
      *
      * Key for oppslag på undergruppe
      *
     c     vugrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vugrl1_uogr
     c                   kfld                    vugrl1_uhgr
     c                   kfld                    vugrl1_uugr
6.30  *
6.30  * Key for oppslag på lager
6.30  *
6.30 c     vlaglu_key    klist
6.30 c                   kfld                    w_firm
6.30 c                   kfld                    vlaglu_vare
6.30 c                   kfld                    vlaglu_lage
      *
      * Key for les på lager
      *
     c     ra10l1_key    klist
     c                   kfld                    w_firm
      *
      * Key for les på abc parameter
      *
     c     mltilr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    mltilr_ogrp
     c                   kfld                    mltilr_hgrp
     c                   kfld                    mltilr_ugrp
     c                   kfld                    mltilr_ldor
     c                   kfld                    mltilr_vare
     c                   kfld                    mltilr_lage
     c                   kfld                    mltilr_crdo
      *
      * Key for oppslag på enhet
      *
6.31 c     venhl1_key    klist
6.31 c                   kfld                    w_firm
6.31 c                   kfld                    venhl1_eenh
      *
     c                   eval      w_firm = d_firm
      *
      * Henter dagens dato og klokkelslett
      *
     c                   time                    w_udat
     c                   time                    w_utim
      *
     c                   endsr
