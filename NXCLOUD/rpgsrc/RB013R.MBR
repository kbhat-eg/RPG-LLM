     h datedit(*dmy.) option(*nodebugio)
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      * System. . . . . : ASOKON                                              *
      * Summering av salgskonto pr dag
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     ffqfwl1    if   e           k disk    rename(fqfwpfr:fqfwl1r)
     fra01l1    if   e           k disk    rename(ra01pfr:ra01l1r)
     ffoffut    o    e             disk    rename(foffutr:foffutl)
      *
     d w_belØ          s                   like(ffbelp)
     d w_belp          s                   like(ffbelp)
     d w_tell          s              1  0
     d brude1          s              1
     d bruke1          s              1
     d w_test          s                   like(ffdkto)
      *
610  d fqfwl1_firm     s                   like(fffirm)
610  d fqfwl1_bdat     s                   like(ffbdat)
610  d fqfwl1_dkto     s                   like(ffdkto)
610  d fqfwl1_ckto     s                   like(ffckto)
610  d fqfwl1_bilk     s                   like(ffbilk)
     d fqfwl1_dbkr     s                   like(ffdbkr)
     d ra01l1_firm     s                   like(raafir)
     d ra01l1_akod     s                   like(raakod)
610   *
610  d w_bdat          s                   like(ffbdat)
610  d w_dkto          s                   like(ffdkto)
610  d w_ckto          s                   like(ffckto)
610  d w_bilk          s                   like(ffbilk)
610  d w_dbkr          s                   like(ffdbkr)
610   *
610  d x_dato          s                   like(ffbdat)
610  d x_kond          s                   like(ffdkto)
610  d x_konc          s                   like(ffckto)
610  d x_bilk          s                   like(ffbilk)
610  d x_dbkr          s                   like(ffdbkr)
6.11 d                uds
6.11 d l_user                911    920
6.11 d l_firm                944    946  0
      *
      *
      * Key for fordelings-parametre
610  c     fqfwl1_key    klist
610  c                   kfld                    fqfwl1_firm
610  c                   kfld                    fqfwl1_bdat
610  c                   kfld                    fqfwl1_dbkr
610  c                   kfld                    fqfwl1_dkto
610  c                   kfld                    fqfwl1_ckto
610  c                   kfld                    fqfwl1_bilk
      * Key for posisjonering på bilagskode
      *
     c     ra01l1_key    klist
     c                   kfld                    ra01l1_firm
     c                   kfld                    ra01l1_akod
      *
      /eject
610  c                   eval      ra01l1_firm = l_firm
      *
610  c                   eval      fqfwl1_firm = l_firm
610  c*                  eval      fqfwl1_bdat = *zero
6.10 c                   eval      fqfwl1_dkto = *zero
6.10 c                   eval      fqfwl1_ckto = *zero
6.10 c                   eval      fqfwl1_bilk = *zero
6.10 c                   eval      fqfwl1_dbkr = *blank
      *
610  c     fqfwl1_key    setll     fqfwl1
610   **********************************************************************
     c     nyles         tag
610   *
610  c                   read      fqfwl1                                 15
610   *
     c                   eval      w_belp = ffbelp
610   * Eof
610  c                   if        *in15  = '1'
610  c                   move      *on           *inlr
610  c                   goto      ut
610  c                   endif
      *
      * Test på inneværend firma
      *
     c                   if        fqfwl1_firm <> fffirm
610  c                   move      *on           *inlr
610  c                   goto      ut
610  c                   endif
610   *
      * Ta vare på brudd første gang
610  c                   if        w_tell = 0
     c                   eval      w_bdat = ffbdat
     c                   eval      w_dkto = ffdkto
     c                   eval      w_ckto = ffckto
     c                   eval      w_bilk = ffbilk
     c                   eval      w_dbkr = ffdbkr
610  c                   eval      w_tell = 1
     c                   eval      x_dato = ffbdat
     c                   eval      x_kond = ffdkto
     c                   eval      x_konc = ffckto
     c                   eval      x_bilk = ffbilk
     c                   eval      x_dbkr = ffdbkr
610  c                   endif
6.10  *
      * Sjekk om brudd på bilagsdato
     c
6.10 c                   if        w_bdat <>  ffbdat
610  c                   eval      x_bilk = ffbilk
610  c                   eval      x_kond = ffdkto
610  c                   eval      x_konc = ffckto
610  c                   eval      x_dato = ffbdat
610  c                   eval      x_dbkr = ffdbkr
      *
610  c                   readp     fqfwl1                                 15
     c                   eval      ra01l1_akod = ffbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      fftext = raatxt
      *
     c                   eval      ffbelp =  w_belØ
     c                   write     foffutl
610  c                   read      fqfwl1                                 15
     c                   if        ffdkto > 9999 or
     c                             ffckto > 9999
     c                   if        *in15 = '1'
610  c                   move      *on           *inlr
     c                   goto      slutt
     c                   endif
     c                   write     foffutl
     c                   move      'A'           brude1
     c                   endif
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
      *
     c                   eval      ffdbkr = x_dbkr
     c                   eval      w_dbkr = ffdbkr
     c                   eval      ffbilk = x_bilk
     c                   eval      w_bilk = ffbilk
     c                   eval      ffdkto = x_kond
     c                   eval      w_dkto = ffdkto
     c                   eval      ffckto = x_konc
     c                   eval      w_ckto = ffckto
     c                   eval      ffbdat = x_dato
     c                   eval      w_bdat = ffbdat
      *
     c                   eval      w_bdat = ffbdat
     c                   eval      w_dkto = ffdkto
     c                   eval      w_ckto = ffckto
     c                   eval      w_bilk = ffbilk
     c                   eval      w_dbkr = ffdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
610   *
      * Sjekk om brudd på Debet/Kredit
     c     brukd         tag
6.10 c                   if        w_dbkr <>  ffdbkr
     c                   if        ffckto > 9999 or
     c                             ffdkto > 9999
     c                   readp     fqfwl1                                 15
     c                   eval      ffbelp = w_belØ
     c                   write     foffutl
     c                   read      fqfwl1                                 15
     c                   goto      neickto
     c                   endif
     c                   if        ffckto < 9999 and
     c                             w_test < 9999
     c                   readp     fqfwl1                                 15
     c                   eval      ffbelp = w_belØ
     c                   eval      w_test = 0
     c                   write     foffutl
     c                   read      fqfwl1                                 15
     c                   endif
     c     neickto       tag
610  c                   eval      x_dbkr = ffdbkr
610  c                   eval      x_bilk = ffbilk
610  c                   eval      x_kond = ffdkto
610  c                   eval      x_konc = ffckto
     c                   if        brude1 = 'A'
     c                   endif
     c                   eval      ra01l1_akod = ffbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      fftext = raatxt
     c                   eval      w_belØ = *zero
     c                   z-add     ffbelp        w_belØ
     c                   eval      ffdbkr = x_dbkr
     c                   eval      w_dbkr = ffdbkr
     c                   eval      w_dkto = ffdkto
     c                   eval      w_ckto = ffckto
     c                   eval      w_bilk = ffbilk
nina c                   eval      w_bdat = ffbdat
     c                   goto      nyles
6.10 c                   endif
610   *
      * Sjekk om brudd på konto /debet
     c
6.10 c                   if        w_dkto <>  ffdkto
610  c                   eval      x_dbkr = ffdbkr
610  c                   eval      x_bilk = ffbilk
610  c                   eval      x_kond = ffdkto
610  c                   eval      x_konc = ffckto
      *
610  c                   readp     fqfwl1                                 15
     c                   eval      ra01l1_akod = ffbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      fftext = raatxt
      *
     c                   eval      ffbelp =  w_belØ
     c                   write     foffutl
ugle c                   eval      w_test = ffdkto
terj c                   eval      w_dbkr = ffdbkr
     c     brudeb        tag
610  c                   read      fqfwl1                                 15
     c                   if        ffdkto > 9999 or
     c                             ffckto > 9999
     c                   if        *in15 = '1'
610  c                   move      *on           *inlr
     c                   goto      slutt
     c                   endif
     c                   write     foffutl
     c                   eval      w_test = ffdkto
nina c                   eval      w_dbkr = ffdbkr
     c                   move      'A'           brude1
     c                   goto      brudeb
     c                   endif
     c                   if        brude1 = 'A' and
     c                             ffdbkr > x_dbkr
     c                   goto      brukd
     c                   goto      nyles
     c                   endif
      *
     c                   eval      ffdbkr = x_dbkr
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
      *
     c                   eval      ffdbkr = x_dbkr
     c                   eval      w_dbkr = ffdbkr
     c                   eval      ffbilk = x_bilk
     c                   eval      w_bilk = ffbilk
     c                   eval      ffdkto = x_kond
     c                   eval      w_dkto = ffdkto
     c                   eval      ffckto = x_konc
     c                   eval      w_ckto = ffckto
      *
     c                   eval      w_dkto = ffdkto
     c                   eval      w_ckto = ffckto
     c                   eval      w_bilk = ffbilk
     c                   eval      w_dbkr = ffdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
610   *
      * Sjekk om brudd på konto /kredit
     c
6.10 c                   if        w_ckto <>  ffckto
610  c                   eval      x_dbkr = ffdbkr
610  c                   eval      x_bilk = ffbilk
610  c                   eval      x_kond = ffdkto
610  c                   eval      x_konc = ffckto
      *
610  c                   readp     fqfwl1                                 15
     c                   eval      ra01l1_akod = ffbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      fftext = raatxt
      *
     c                   eval      ffbelp =  w_belØ
     c                   write     foffutl
test c                   eval      w_test = ffckto
nina c                   eval      w_dbkr = ffdbkr
nina c                   eval      x_dbkr = ffdbkr
     c     brukeb        tag
610  c                   read      fqfwl1                                 15
     c                   if        ffdkto > 9999 or
     c                             ffckto > 9999
     c                   if        *in15 = '1'
610  c                   move      *on           *inlr
     c                   goto      slutt
     c                   endif
     c                   write     foffutl
test c*                  eval      w_test = ffdkto
test c** lav             eval      w_test = ffdkto
lav  c                   if        ffdkto > 9999
lav  c                   eval      w_test = ffdkto
lav  c                   else
lav  c                   eval      w_test = ffckto
lav  c                   endif
lav  c***                eval      w_test = ffdkto
nina c                   eval      w_dbkr = ffdbkr
nina c                   eval      x_dbkr = ffdbkr
     c                   move      'A'           bruke1
     c                   goto      brukeb
     c                   endif
     c*                  eval      w_belØ = *zero
6.10 c*                  z-add     w_belp        w_belØ
     c                   if        bruke1 = 'A' and
nina c**                           ffdbkr < x_dbkr
nina c                             ffdbkr <> x_dbkr
     c                   goto      brukd
     c                   goto      nyles
     c                   endif
      *
     c                   eval      ffdbkr = x_dbkr
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
      *
     c                   eval      ffdbkr = x_dbkr
     c                   eval      w_dbkr = ffdbkr
     c                   eval      ffbilk = x_bilk
     c                   eval      w_bilk = ffbilk
     c                   eval      ffdkto = x_kond
     c                   eval      w_dkto = ffdkto
     c                   eval      ffckto = x_konc
     c                   eval      w_ckto = ffckto
      *
     c                   eval      w_dkto = ffdkto
     c                   eval      w_ckto = ffckto
     c                   eval      w_bilk = ffbilk
     c                   eval      w_dbkr = ffdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
610   *
      * Sjekk om brudd på bilagskode
     c
6.10 c                   if        w_bilk <>  ffbilk
610  c                   eval      x_bilk = ffbilk
610  c                   eval      x_dbkr = ffdbkr
610  c                   readp     fqfwl1                                 15
     c                   eval      ra01l1_akod = ffbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      fftext = raatxt
     c                   eval      ffbelp =  w_belØ
     c                   write     foffutl
610  c                   read      fqfwl1                                 15
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
     c                   eval      ffbilk = x_bilk
     c                   eval      w_bilk = ffbilk
     c                   eval      ffdbkr = x_dbkr
     c                   eval      w_dbkr = ffdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
     c                   add       ffbelp        w_belØ
      *
      ******************************************************
      *  AVSLUTT DENNE TRANS                               *
      ******************************************************
      *
     c     ut            tag
610  c                   if        *inlr = '0'
610  c                   goto      nyles
610  c                   endif
      *
     c                   if        *inlr  =  '1'   and
     c                             w_belØ > 0
610  c                   readp     fqfwl1                                 15
     c                   eval      ra01l1_akod = ffbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      fftext = raatxt
     c                   eval      ffbelp =  w_belØ
     c                   write     foffutl
610  c                   endif
     c     slutt         tag
      *
     c/eject
      *
