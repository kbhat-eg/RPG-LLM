     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  System. . . . . :
      *  Program . . . . : AX220R
      *  Beskrivelse . . : AVDELING   Legger ut XML til SAF-T
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Spesialversjon. :
      *  Tilpasset for . :
      *
Versj *Uts   Dato Usr Referanse Beskrivelse
      *____________________________________________________________________________________________
      *K00-200420               START FOR VERSJON K00
7.00  *K00 200420 SST NXS-4426  Utrulling av SAFT-Rapporter til alle kundene
      *
      *
      *
      *____________________________________________________________________________________________
      *  Dette programmet henter data fra ADBxxx/ra07PF m/ragfir = Firma
      *
     fra07l1    if   e           k disk    rename(ra07pfr:ra07l1r)
     frxmll1    if   e           k disk    rename(rxmlpfr:rxmll1r)
      *
     faxmlut    o    e             disk
      *
      *
     d w_firm          s                       like(ragfir)
     d ra07l1_gkod     s                       like(ragkod)
      *
     d rxmll1_head     s                       like(axhead)
     d rxmll1_linj     s                       like(axlinj)
      *
     d text            s             50
     d i               s              9S 0
     d w_x_dat         s             10A
      *
     d p_perfm         s              2
     d p_perfa         s              4
     d p_pertm         s              2
     d p_perta         s              4
     d p_pfm           s              2S 0
     d p_pfa           s              4S 0
     d p_ptm           s              2S 0
     d p_pta           s              4S 0
     d p_hcom          s             50
      *
     d                uds
     d l_firm                944    946  0
     d l_user                911    920
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Start
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     start         tag
      *
     c                   read      ra07l1
     c                   if        not %eof(ra07l1) and
     c                             ragfir = l_firm
      *
      *  Skriver ANALYSIS Type Table (Start record)  (OBS!)
      *
     c                   eval      rxmll1_head  = 'ANALYSIS'
     c                   eval      rxmll1_linj  = 100
     c     rxmll1_key    chain     rxmll1
     c                   if        %found(rxmll1 )
     c                   eval      xmlrec = axxmlt
     c*>OBS!             write     axmlutr
     c                   endif
      *
      *  Skriver ANALYSIS TypeTableEntry
      *
     c     Details       tag
      *
     c                   eval      rxmll1_linj  = 200
     c     rxmll1_key    chain     rxmll1
     c                   if        %found(rxmll1 )
     c                   eval      xmlrec = axxmlt
     c                   write     axmlutr
     c                   endif
      *
      *   Skriver ANALYSIS  Type
      *
     c                   eval      rxmll1_linj  = 300
     c     rxmll1_key    chain     rxmll1
     c                   if        %found(rxmll1 )
     c                   movel     'A'           text
     c                   exsr      redut
     c                   endif
      *
      *   Skriver ANALYSIS  Type Description
      *
     c                   eval      rxmll1_linj  = 400
     c     rxmll1_key    chain     rxmll1
     c                   if        %found(rxmll1 )
     c                   movel     'Avdeling'    text
     c                   exsr      redut
     c                   endif
      *
      *   Skriver ANALYSIS  ID
      *
     c                   eval      rxmll1_linj  = 500
     c     rxmll1_key    chain     rxmll1
     c                   if        %found(rxmll1 )
     c                   movel     ragkod        text
     c                   exsr      redut
     c                   endif
      *
      *   Skriver ANALYSIS  ID  Description
      *
     c                   eval      rxmll1_linj  = 600
     c     rxmll1_key    chain     rxmll1
     c                   if        %found(rxmll1 )
     c                   movel     ragtxt        text
     c                   exsr      redut
     c                   endif
      *
      *   Skriver ANALYSIS  Start Date
      *
     c                   eval      rxmll1_linj  = 700
     c     rxmll1_key    chain     rxmll1
     c                   if        %found(rxmll1 )
     c                   movel     ragdat        text
     c                   eval      w_x_dat = text
     c                   eval      xmlrec = %subst(axxmlt:1:i-1) +
     c                             %trim(w_x_dat) +
     c                             %subst(axxmlt:i+3:50)
     c                   exsr      redut
     c                   endif
      *
      *   Skriver ANALYSIS  Aktiv/Passiv
      *
     c                   eval      rxmll1_linj  = 800
     c     rxmll1_key    chain     rxmll1
     c                   if        %found(rxmll1 )
     c                   movel     'Active'      text
     c                   exsr      redut
     c                   endif
      *
      *   /TableEntry
      *
     c                   eval      rxmll1_linj  = 900
     c     rxmll1_key    chain     rxmll1
     c                   if        %found(rxmll1 )
     c                   eval      xmlrec = axxmlt
     c                   write     axmlutr
     c                   endif
      *
      *   Les neste avdelings-kode
      *
     c                   read      ra07l1
     c                   if        not %eof(ra07l1) and
     c                             ragfir = l_firm
      *
     c                   goto      Details
     c                   endif
      *
      *   /End Analysis Type Table   (OBS!)
      *
     c                   eval      rxmll1_linj  = 1000
     c     rxmll1_key    chain     rxmll1
     c                   if        %found(rxmll1 )
     c                   eval      xmlrec = axxmlt
     c*OBS!              write     axmlutr
     c                   endif
      *
     c                   endif
      *
     c                   eval      *inlr = *on
     c                   return
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  Rediger og skriv xml-melding
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     redut         begsr
      *
     c                   if        axmaop = 'M' or
     c                             text  <> *blank
     c                   eval      i = %scan('?V?':axxmlt)
     c                   if        i > 0
     c                   if        axtype = 'F'
     c                   eval      xmlrec = %subst(axxmlt:1:i-1) +
     c                             %trim(axfast) +
     c                             %subst(axxmlt:i+3:50)
     c                   goto      TWrite
     c                   endif
      *
     c                   eval      xmlrec = %subst(axxmlt:1:i-1) +
     c                             %trim(text) +
     c                             %subst(axxmlt:i+3:50)
     c                   goto      TWrite
     c                   endif
      *
     c                   eval      i = %scan('?F?':axxmlt)
     c                   if        i > 0
     c                   eval      xmlrec = %subst(axxmlt:1:i-1) +
     c                             %trim(axfast) +
     c                             %subst(axxmlt:i+3:50)
     c                   goto      TWrite
     c                   endif
      *
     c     TWrite        tag
     c                   write     axmlutr
     c                   endif
     c                   eval      text = *blank
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     *inzsr        begsr
      *
     c     ra07l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ra07l1_gkod
      *
     c     rxmll1_key    klist
     c                   kfld                    rxmll1_head
     c                   kfld                    rxmll1_linj
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *                           Legger inn verdier i felter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     *dtaara       define                  ax000par        100
     c     *lock         in        *dtaara
     c                   eval      p_perfm = %subst(ax000par:1:2)
     c                   eval      p_perfa = %subst(ax000par:3:4)
     c                   eval      p_pertm = %subst(ax000par:7:2)
     c                   eval      p_perta = %subst(ax000par:9:4)
     c                   eval      p_hcom  = %subst(ax000par:13:50)
      *
     c                   move      p_perfm       p_pfm
     c                   move      p_perfa       p_pfa
     c                   move      p_pertm       p_ptm
     c                   move      p_perta       p_pta
      *
     c                   movel     'ANALYSIS'    rxmll1_head
     c                   move      *zero         rxmll1_linj
      *
     c                   eval      w_firm      = l_firm
     c                   eval      ra07l1_gkod = *zero
     c     ra07l1_key    setll     ra07l1
      *
     c                   endsr
