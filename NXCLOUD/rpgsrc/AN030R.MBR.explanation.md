# AN030R â€“ Parameter Entry Program Documentation

## Overview

**Program:** AN030R  
**System:** ASPGPL  
**Description:** This program is responsible for collecting and preparing job scheduling parameters from the user, which are then passed to a CL program (AN032C) for job plan entry generation. The program is designed for interactive use and is part of a batch job planning subsystem.

---

## Structure and Flow

### 1. File Declarations

```rpg
fan030d    cf   e             workstn
```
- **AN030D** is the display file (workstation file) used for user interaction. All screen input/output is managed via this file.

---

### 2. Data Structures

```rpg
d                 ds
d d_valg                       128
d  d_time                        6  0 overlay(d_valg)
d  d_udag                        4    overlay(d_valg:7)
```
- **d_valg**: 128-byte data structure, used as a parameter block for passing data to the CL program.
- **d_time**: 6-digit numeric (0 decimals), overlays the start of d_valg, used to store the job start time.
- **d_udag**: 4-character field, overlays d_valg at position 7, used to store the day of the week.

**Design Note:** The use of overlays allows packing multiple parameters into a single buffer for ease of parameter passing to the called CL program.

---

### 3. Main Logic

#### Initialization

```rpg
b1tag         tag
eval      b1ttmm = 0500
eval      b1udag = '*SUN'
```
- **b1ttmm** and **b1udag** are initialized with default values (time = 0500, day = *SUN). These are likely display/input fields on the panel.

#### User Input Loop

```rpg
b1taga        tag
b1tagb        tag
exfmt     b1bld
```
- Displays the input screen (format **b1bld**) and waits for user input.

#### Function Key Handling

```rpg
if        *inkc = *on
goto      slutt   // Exit program
endif

if        *inkl = *on
goto      b1tag   // Cancel and reinitialize input
endif
```
- **F3 (Exit):** If function key indicator KC is on, exit the program.
- **F12 (Cancel):** If function key indicator KL is on, return to the initial input state.

#### Preparing Parameters

```rpg
movel     b1ttmm        d_time
eval      d_udag = b1udag
```
- Moves user input (time and day) to the parameter structure (**d_time** and **d_udag**), which overlays **d_valg**.

#### Calling the Job Plan Generator

```rpg
start         tag
call      'AN032C'
parm                    d_valg
```
- Calls the CL program **AN032C**, passing the packed parameter structure (**d_valg**) for further processing (job plan entry generation).

#### Program Termination

```rpg
slutt         tag
eval      *inlr = *on
return
```
- Properly closes the program and releases resources.

---

### 4. Initialization Subroutine

```rpg
*inzsr        begsr
eval      d_time = *zero
eval      d_udag = *blank
endsr
```
- Ensures that **d_time** and **d_udag** are cleared at program start.

---

## Business/Domain Logic

- **Purpose:** Collect job scheduling parameters (time and day) from the user for batch job planning.
- **Parameters:** The time and day fields are packed into a single buffer (**d_valg**) for compatibility with the downstream CL program (**AN032C**).
- **Screen Handling:** The program expects the user to confirm or cancel input via standard function keys (F3/F12).
- **Job Plan Generation:** Actual creation or updating of job plan entries is handled by the called CL program, not by this RPG program.

---

## Conventions and Design Decisions

- **Overlayed Data Structure:** Using overlays for **d_time** and **d_udag** within **d_valg** allows for easy parameter passing and future extensibility without changing the interface to **AN032C**.
- **Function Key Indicators:** Standard IBM i practice is used for function key handling, with indicator variables (e.g., *INKC, *INKL).
- **Separation of Concerns:** This program is strictly for user input and parameter preparation; all business logic for job plan entry is delegated to the CL program.

---

## External Dependencies

- **Display File (AN030D):** Defines the screen formats and field mappings for user interaction.
- **CL Program (AN032C):** Receives the parameter structure and performs the actual job plan entry generation.

---

## Summary

**AN030R** is a user-facing RPG program for collecting job scheduling parameters, preparing them in a structured format, and passing them to a CL program for processing. The code is straightforward, with clear separation between user interaction, parameter preparation, and business logic execution. The use of overlayed data structures for parameter passing is a key design pattern in this codebase.