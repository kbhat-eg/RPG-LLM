# Documentation for RPG Program HR150R

## Overview

**Program:** HR150R  
**System:** ASLAGR  
**Description:**  
This program is designed for radio terminal transactions related to "plukking" (picking) and order registration in a warehouse/logistics environment. It manages the display and processing of orders eligible for picking, provides inquiry and selection facilities, and integrates with several other modules for order validation, status checks, and logging.

The program is interactive, using subfiles to present lists of orders and detailed screens for order information and error handling. It is tailored for use with hand-held radio terminals but can be used from standard workstations as well.

---

## Key Features and Business Logic

- **Order Picking Registration:**  
  Lists orders ready for picking, allows selection, and processes the picking operation.
- **Order Inquiry:**  
  Provides facilities to view and inquire about order details.
- **Status Checking:**  
  Interacts with status and order modules to ensure only valid orders are processed.
- **Suffix Handling:**  
  Handles order suffixes, especially in multi-location warehouses.
- **User/Location Specific Logic:**  
  Filters and processes orders based on user and warehouse (lager).
- **Integration with Other Modules:**  
  Calls external programs for status checks (`FU706R`), order processing (`HR151R`), and customer/project lookup (`RS750R`, `FO500R`).

---

## Structure and Flow

### File Declarations

- **Physical Files:**  
  - `fohell`, `fohelr`: Order headers, for listing and inquiry.
  - `fkprl1`: Customer/project information.
  - `fstsl1`: Status codes.
  - `votyl1`: Order type codes.
  - `lwpll2`: Picked order log.
  - `fusrl1`: User information.
  - `fodtl1`: Order detail lines (for suffix/warehouse logic).

- **Display File:**  
  - `hr150d`: Workstation display file with subfile (`b1sfl`).

### Indicator Usage

- **LR:** End of program.
- **10, 12-16, 30:** Screen control, subfile navigation, and field protection.
- **31-79:** Error and warning signals.
- **80-89:** Work indicators.

### Main Program Flow

1. **Initialization (`*INZSR`):**
   - Reads parameters from the local data area (firm, user, warehouse).
   - Sets up key lists for file access.
   - Loads initial subfile with orders ready for picking.

2. **Display and User Interaction Loop:**
   - Main loop (`b2taga`/`b2tagb`) handles display and user input.
   - Processes function keys (e.g., exit, refresh, create subfile).
   - Handles order inquiry and selection via subfile.

3. **Order Selection and Processing:**
   - Validates order number and suffix.
   - Checks order status and readiness for picking.
   - Calls external programs for further processing or logging.
   - Refreshes subfile as needed.

4. **Subfile Handling:**
   - `clr_subfile`: Clears the subfile.
   - `crt_subfile`: Fills the subfile with eligible orders.
   - `dsp_subfile`: Displays the subfile control screen.
   - `subfile`: Handles user actions within the subfile.

5. **Order Inquiry and Error Handling:**
   - `xc2bld`: Detailed order inquiry display.
   - `xf1bld`: Handles "order not found" or "order not ready" scenarios.
   - `xg1bld`: Handles "order already picked" scenarios.

6. **Suffix Resolution (`sjekk_suff`):**
   - Finds the correct suffix for an order based on the user's warehouse.

---

## Special/Non-obvious Design Elements

### Subfile Paging and Positioning

- Paging is managed with variables like `w_srrn` (current record), `w_spge` (page size), `w_sfrn` (first record on page), and `w_ssrn` (last record on page).
- The subfile is filled in pages (`c_sfil`, typically 3 records per page).

### Suffix and Warehouse Logic

- Orders may have multiple suffixes (e.g., for different warehouses).
- When entering an order number, the correct suffix is determined by searching order detail lines for the user's warehouse (`sjekk_suff`).

### Status and Order Type Validation

- Before allowing picking, the program checks:
  - If the order is ready for picking (via external call to `FU706R`).
  - If the order type is valid for picking (using `votyl1`).
  - If the order is not already picked or in use.
- Status codes and order types are maintained in separate reference files.

### Integration with Other Programs

- **`FU706R`:** Checks order status, returns a status code for processing.
- **`HR151R`:** Handles the actual picking registration.
- **`RS750R`:** Retrieves customer/project information.
- **`FO500R`:** Used for order inquiry/search.

### Field and Indicator Conventions

- The code uses a consistent approach for error/warning indicators (`b_feil`, `*IN31`, `*IN32`).
- Temporary fields are initialized before use to prevent display of stale data.

---

## Display Screens

- **B1SFL:** Main order list subfile.
- **B2CTL/B2CMD:** Subfile control and command screens.
- **C2BLD:** Order inquiry screen.
- **F1BLD/G1BLD:** Error/information screens for "order not found" or "not on order".

---

## Key Subroutines

### `forny`
Refreshes the subfile (clears and reloads the list of orders).

### `subfile`
Handles subfile interaction, including user selection and order inquiry.

### `xc2bld`
Displays detailed information about an order, including customer/project details.

### `xf1bld`
Handles cases where an order is not found or not ready for picking, sets error indicators and displays the appropriate message.

### `xg1bld`
Handles cases where an order has already been picked, informs the user.

### `clr_subfile` / `crt_subfile`
Clear and fill the subfile, respectively, with logic to filter orders based on status, type, and user/location.

### `dsp_subfile`
Handles the display of the subfile and its control screen.

### `sjekk_suff`
Finds the correct suffix for an order based on the warehouse assigned to the user.

---

## Relationships to Other Modules

- **Order Status/Type:**  
  Relies on `votyl1` and `fstsl1` for valid order types and statuses.
- **User/Location:**  
  Uses `fusrl1` to determine the current user's warehouse.
- **Customer/Project:**  
  Looks up customer and project info via `fkprl1` and `RS750R`.
- **Order Processing:**  
  Calls `HR151R` to register picking.
- **Order Inquiry:**  
  Integrates with `FO500R` for advanced order inquiries.
- **Order Detail:**  
  Uses `fodtl1` for suffix and detailed order line lookups.

---

## Version History & Customizations

- The code includes detailed in-line change history, indicating:
  - Expansion of logging with year fields.
  - Extended suffix and number series handling.
  - Changes for multi-position price groups.
  - Logic for direct order input and status checking.
  - Enhancements for suffix/warehouse lookups.

---

## Summary

This program is a central component for managing warehouse order picking via radio terminals. It tightly integrates with the broader order management system, enforces business rules for order readiness, and provides user-friendly facilities for order inquiry and selection. The codebase uses standard RPG practices for file handling, subfile management, and program modularity, but also includes domain-specific logic for suffix handling, order validation, and integration with external modules.

**When onboarding:**  
- Focus on understanding the relationships between orders, users, warehouses, and statuses.
- Review the external programs for status and order processing (`FU706R`, `HR151R`).
- Familiarize yourself with the subfile paging and selection logic.
- Pay attention to the indicator conventions and error handling patterns used throughout the code.