# Program LO630R Documentation

## Overview

**LO630R** is an interactive RPG program used in the ASLAGR system to facilitate the printing of a control list ("kontroll-liste"). The program collects user-specified parameters via workstation screens, validates them, and then initiates the process of generating the list. It coordinates with several other programs and data sources, and is tailored for a Norwegian business context, as indicated by field names and comments.

## Business Purpose

- **Main Function:** Collect parameters for generating a control list (typically related to orders or invoices), validate the input, and pass the parameters to batch/reporting programs that produce the actual output.
- **Domain:** Order processing, with specific focus on order types, ranges (order numbers, supplier numbers), and date intervals.
- **Key Business Rules:** 
  - Only certain order types (invoice/credit types) are valid for processing.
  - The program ensures that the "from" date is not after the "to" date.
  - If the upper bound for ranges (order number, supplier number, date) is left blank, all values up to the system maximum are included.

## Program Structure

### File and Data Definitions

- **Display File:** `LO630D` (WORKSTN) is used for interactive input/output.
- **Database File:** `VOTYL1` (renamed from VOTYPFR) is accessed for order type validation.
- **Local Data Area (LDA):** Used for sharing data between programs.
- **Parameter Data Structures:** Used to collect and pass user input to downstream processes.

### Key Data Structures

- **Parameter Input (`DSPREC`):** Holds all user-entered parameters.
- **Order Type Key (`OTYKEY`):** Composite key for order type validation (company + order type).
- **LDA Fields:** Used for inter-program communication, including routine names and company number.

### Main Flow

#### 1. Parameter Entry Screen

- **Tag:** `B1TAG` / `B1TAGA` / `B1TAGB`
- **Fields:** Order type, order number range, supplier number range, date range.
- **Validation:**
  - F3 exits.
  - Order type is validated against `VOTYL1`.
  - Only invoice/credit order types are allowed (checked via `VAOAKK`).
  - "From" date must not be after "to" date.
  - If upper bounds are zero, set to system maximums.

#### 2. Sorting/Selection Options Screen

- **Tag:** `C1TAG` / `C1TAGA` / `C1TAGB`
- **Fields:** Sorting criteria and selection flags.
- **Validation:** F3 returns to parameter input.

#### 3. Parameter Preparation

- User input is mapped to the parameter data structure (`DSPREC` and related fields).
- System maximums are assigned for open-ended ranges.

#### 4. Job Submission and Report Generation

- **Routine Setup:** The LDA is updated with the routine name (`LO136`) and a flag indicating whether only information is to be fetched.
- **Call to Reporting Program:** Calls `AP600R` (previously `AP100R`) to generate the report, passing routine and control parameters.
- **Job Queue Option:** If F4 is pressed, sets a flag to submit the job to a queue.
- **File Member Numbering:** Calls `LØ900R` to get the latest file member number for output file management.
- **Subprogram Call:** Calls `LO632C` with the complete parameter block for further processing.

#### 5. Program Termination

- **Tag:** `XSLUTT`
- **Action:** Sets LR indicator and returns.

#### 6. Initialization Subroutine

- **Tag:** `*INZSR`
- **Actions:**
  - Defines the local data area for output.
  - Resets working fields.
  - Sets up LIKE definitions for date and key fields.
  - Populates company number in keys.

## Notable Design Decisions and Conventions

- **Tag-based Navigation:** Uses RPG's `TAG` and `GOTO` for screen flow control, which is typical in legacy interactive RPG.
- **Indicator Usage:** Uses classic RPG indicators (`*INxx`) for screen and logic control.
- **Parameter Passing:** Uses data structures to group parameters for calls to other programs, which simplifies maintenance and extensibility.
- **System Maximums:** Open-ended ranges are handled by assigning special values (e.g., 999999 for order/supplier numbers, *HIVAL for dates).
- **LDA for Inter-Program Communication:** Routine names and flags are written to the LDA, following a system-wide convention for passing control information.
- **Order Type Validation:** Only allows processing for specific order types, reflecting a business rule that only invoice/credit orders are relevant.
- **File Member Management:** Output file member numbers are managed via a dedicated subroutine/program (`LØ900R`), indicating a modular approach to output management.

## External Interactions

- **Display File (`LO630D`):** For user interaction.
- **Order Type File (`VOTYL1`):** For validating order types.
- **Reporting Program (`AP600R`):** Main report generator, called with user parameters.
- **File Numbering Program (`LØ900R`):** Retrieves/assigns output file member numbers.
- **Subprogram (`LO632C`):** Handles further processing/output based on the collected parameters.

## Error Handling and User Guidance

- **Invalid Input:** Returns to the relevant input screen with indicators set for error display.
- **Exit Options:** F3 allows the user to exit from either screen.
- **Job Queue Submission:** F4 enables the user to submit the job to a batch queue.

## Version History and Customization

- The header comments document significant changes, e.g. switching to `AP600R`, handling of deviations, and adaptations for number expansion.
- The program is designed for easy adaptation to future business requirements by centralizing parameter handling and using modular calls.

## Summary Table

| Component          | Role/Interaction                         |
|--------------------|------------------------------------------|
| LO630D             | Display file for user interaction        |
| VOTYL1             | Order type validation                    |
| AP600R             | Report generation (batch/print)          |
| LØ900R             | File/member numbering                    |
| LO632C             | Parameter hand-off/subsequent processing |
| LDA                | Inter-program communication              |

---

**Note:** This program is a typical example of legacy RPG interactive programs in a Scandinavian business environment, with strong reliance on data areas, indicators, and modular batch/reporting integration. The code is well-annotated, and business logic is tightly coupled to order processing and reporting requirements.