# IT010R Program Documentation

## Overview

**Program:** IT010R  
**System:** ASNAVIOKO  
**Description:**  
This program reads country codes (`landkoder`) from the physical file `ra12PF` and writes them to a target system by invoking a standard write program (`IT001R`). The program is part of an integration or migration solution, likely related to country code master data.

**Business Context:**  
The program is designed to extract all country code records for a specific firm from the source file and transfer them to another system or process, using a standardized interface. This is part of a data synchronization or import routine, possibly for onboarding or updating master data in a new application (notably, the program name `NexstepImportLandkoder` suggests integration with a system called Nexstep).

---

## Structure and Key Logic

### File Definitions

- **`fra12l1`**:  
  This is a keyed logical file over the physical file `ra12PF`, renamed locally as `ra12l1r`. This file contains country code records.

### Local Data Area

- **`l_firm`**:  
  Extracted from the user data space (positions 944-946), representing the firm identifier. This is used to filter records relevant to the current firm.

### Key Variables

- **`ra12l1_lkod`**:  
  Local variable used as a key for country code (`ralkod`), initialized to blank at program start.

### Parameter Data Structure

- **`d_parm`**:  
  Data structure to pass parameters to the called program (`IT001R`):
    - `d_kode` (2): Country code
    - `d_besk` (40): Country description

### Working Variables

- **`w_firm`**: Current firm number (3 digits)
- **`w_prog`**: Program name for logging or interface identification
- **`w_comd`**: Command/action indicator (e.g., 'Insert')
- **`w_parm`**: Parameter buffer, holds the packed parameter structure for the call
- **`w_date`, `w_time`**: Not used in the main logic, reserved for date/time stamps if needed
- **`w_rpgp`**: Program identifier (for logging/audit)

---

## Main Program Flow

### Initialization (`*INZSR` Subroutine)

- **Key List Setup:**  
  The key list `ra12l1_key` is defined for positioning in the file using `w_firm` and `ra12l1_lkod`.
- **Working Variable Initialization:**  
  - `w_firm` is set from `l_firm` (user data area).
  - `w_prog` is set to `'NexstepImportLandkoder'`.
  - `w_comd` is set to `'Insert'`.
  - `w_rpgp` is set to `'IT010R'` (this program's name).

### Main Loop

1. **Positioning:**  
   The program positions the file cursor to the first record for the firm using the key list (firm + blank country code).
2. **Reading Records:**  
   Reads each record in `ra12l1` while not end-of-file and the firm matches `w_firm`.
3. **Parameter Preparation:**  
   For each record:
   - Moves the country code (`ralkod`) to `d_kode`.
   - Moves the country description (`raltxt`) to `d_besk`.
   - Packs `d_parm` into `w_parm`.
4. **Calling the Write Program:**  
   Calls `IT001R`, passing:
   - `w_firm`
   - `w_prog`
   - `w_comd`
   - `w_parm`
   - `w_rpgp`
   This standardizes the interface for writing/importing country code data.
5. **Continue Reading:**  
   Reads the next record and continues the loop.

### Program Termination

- Sets LR indicator (`*INLR`) to `*ON` to close files and end the program.

---

## Design Decisions and Conventions

- **Standardized Interface:**  
  All data is passed to the write program (`IT001R`) using a fixed set of parameters, including a command string (`Insert`), program name, and a packed parameter buffer. This allows the write program to be reused for different types of data and operations.
- **Key List Usage:**  
  The use of a key list (`ra12l1_key`) with both firm and country code allows for efficient positioning and ensures only relevant records are processed.
- **Data Area Usage:**  
  The firm number is pulled from a fixed position in the user data area, which is a common pattern in legacy RPG applications for session context.
- **Naming Conventions:**  
  Variable and field names are in Norwegian, reflecting the business domain and data (e.g., `landkoder` = country codes, `beskrivelse` = description).
- **No Debug I/O:**  
  The `h option(*nodebugio)` directive signals that the program disables certain debug features for file I/O, likely for performance or production stability.

---

## External Dependencies

- **Physical File:**  
  `ra12PF` (accessed via logical file `fra12l1`)
- **Called Program:**  
  `IT001R` is responsible for processing the imported data (insert/update or further integration).
- **User Data Area:**  
  Assumes `l_firm` is correctly set in the user data area before program start.

---

## Summary

The IT010R program is a batch utility for exporting all country codes for a specific firm from the legacy master file and inserting them into a target system via a standardized interface. The process is modular, with clear separation between data reading and writing, facilitating maintainability and reuse in larger data migration or integration workflows.