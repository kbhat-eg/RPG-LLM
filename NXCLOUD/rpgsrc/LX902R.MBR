     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASLAGR
      * Program . . . . : LX902R
      * Beskrivelse . . : Retter referanse i vhispf
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       030615 bkv  Nytt program. Kopi av LX895R
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fvhisl1    if   e           k disk    rename(vhispfr:vhisl1r)
     fvhislu    uf   e           k disk    rename(vhispfr:vhislur)
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
     d l_firm                944    946  0
      *
      * Definering av variable i nøkler
      *
     d vhislu_firm     s                   like(vhfirm)
     d vhislu_lage     s                   like(vhlage)
     d vhislu_vare     s                   like(vhvare)
     d vhislu_dato     s                   like(vhdato)
     d vhislu_time     s                   like(vhtime)
     d vhislu_sekv     s                   like(vhsekv)
      *
      * Definering av variable
      *
     d w_refr          s             20
     d w_numa          s              8
     d w_lina          s              4
     d len             s              3  0
     d st              s              3  0
     d w_8x            s              8
     d w_4x            s              4
     d w_leng          s              2  0
     d w_posi          s              2  0
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   read      vhisl1
     c                   dow       not %eof(vhisl1)
      *
     c                   if        %subst(vhrefr:1:2) = 'B:' and
     c                             %subst(vhrefr:12:2) <> 'L:'
     c                   exsr      behandle
     c                   endif
      *
     c                   if        %subst(vhrefr:1:2) = 'O:' and
     c                             %subst(vhrefr:12:2) <> 'L:'
     c                   exsr      behandleO
     c                   endif
     c                   read      vhisl1
     c                   enddo
      *

      *
      * Avslutt program
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å rette refranse i B
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandle      begsr
      *
     c                   eval      w_refr = %subst(vhrefr:3:16)
     c                   eval      w_posi = %scan('L':w_refr)
     c                   if        w_posi = 0
     c                   leavesr
     c                   endif
     c                   eval      w_numa = %trim(%subst(w_refr:1:w_posi-1))
     c                   eval      w_lina =
     c                             %trim(%subst(w_refr:w_posi+2:w_posi-1))
      * utleder numm
     c                   eval      len     = %len(%trim(w_numa))
     c                   if        len     > 0
     c                   eval      st = 9 - len
     c                   eval      w_8x  = *blank
     c                   eval      %subst(w_8x:st:len) = %subst(w_numa:1:len)
     c                   eval      w_numa = w_8x
     c                   endif
     c                   eval      w_numa = %xlate(' ':'0':w_numa)
      *
      * utleder line
     c                   eval      len     = %len(%trim(w_lina))
     c                   if        len     > 0
     c                   eval      st = 5 - len
     c                   eval      w_4x  = *blank
     c                   eval      %subst(w_4x:st:len) = %subst(w_lina:1:len)
     c                   eval      w_lina = w_4x
     c                   endif
     c                   eval      w_lina = %xlate(' ':'0':w_lina)
      *
      * oppdaterer referanse
      *
      *
     c                   eval      vhislu_firm = vhfirm
     c                   eval      vhislu_lage = vhlage
     c                   eval      vhislu_vare = vhvare
     c                   eval      vhislu_dato = vhdato
     c                   eval      vhislu_time = vhtime
     c                   eval      vhislu_sekv = vhsekv
     c     vhislu_key    chain     vhislur
     c                   if        %found(vhislu)
     c                   eval      vhrefr = 'B:' + w_numa +
     c                                      ' L:' + w_lina
     c                   time                    vhedat
     c                   time                    vhetim
     c                   eval      vheusr = l_user
     c                   update    vhislur
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å rette referanse i en O:
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandleO     begsr
      *
     c                   eval      w_refr = %subst(vhrefr:3:16)
     c                   eval      w_posi = %scan('L':w_refr)
     c                   if        w_posi = 0
     c                   leavesr
     c                   endif
     c                   eval      w_numa = %trim(%subst(w_refr:1:w_posi-1))
     c                   eval      w_lina =
     c                             %trim(%subst(w_refr:w_posi+2:w_posi-1))
      * utleder numm
     c                   eval      len     = %len(%trim(w_numa))
     c                   if        len     > 0
     c                   eval      st = 9 - len
     c                   eval      w_8x  = *blank
     c                   eval      %subst(w_8x:st:len) = %subst(w_numa:1:len)
     c                   eval      w_numa = w_8x
     c                   endif
     c                   eval      w_numa = %xlate(' ':'0':w_numa)
      *
      * utleder line
     c                   eval      len     = %len(%trim(w_lina))
     c                   if        len     > 0
     c                   eval      st = 5 - len
     c                   eval      w_4x  = *blank
     c                   eval      %subst(w_4x:st:len) = %subst(w_lina:1:len)
     c                   eval      w_lina = w_4x
     c                   endif
     c                   eval      w_lina = %xlate(' ':'0':w_lina)
      *
      * oppdaterer referanse
      *
      *
     c                   eval      vhislu_firm = vhfirm
     c                   eval      vhislu_lage = vhlage
     c                   eval      vhislu_vare = vhvare
     c                   eval      vhislu_dato = vhdato
     c                   eval      vhislu_time = vhtime
     c                   eval      vhislu_sekv = vhsekv
     c     vhislu_key    chain     vhislur
     c                   if        %found(vhislu)
     c                   eval      vhrefr = 'O:' + w_numa +
     c                                      ' L:' + w_lina
     c                   time                    vhedat
     c                   time                    vhetim
     c                   eval      vheusr = l_user
     c                   update    vhislur
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for oppdatering av lagerbok
      *
     c     vhislu_key    klist
     c                   kfld                    vhislu_firm
     c                   kfld                    vhislu_lage
     c                   kfld                    vhislu_vare
     c                   kfld                    vhislu_dato
     c                   kfld                    vhislu_time
     c                   kfld                    vhislu_sekv
      *
      * Henter firma
      *
      *
     c                   endsr
