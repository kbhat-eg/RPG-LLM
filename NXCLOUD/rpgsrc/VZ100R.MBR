     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : VZ100R
      * Beskrivelse . . : Prisfoslag spørring (enkel vedlikehold)
      *                   kun sletting pr. nå - hvis mer funksjonalitet
      *                   må det spekkes hva.
9.01  * Spesialversjon. :
9.01  * Tilpasset for . : Mestergruppen
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       250122 bof  Nytt program
8.01  *       090822 bof  Små justeringer, fjernet cloes stmt
8.02  *       021222 bof  Endret DDS ihht til GUI, alltid vis = IN30 på
8.03  *       170124 bsa  Liten justering GUI.
8.04  *       281024 bof  Tillate sletting v/Lars Ole

      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = Avslutt program
      *       10 = Roll
      *       11 = Rolldown
      *       12 = Sfldsp
      *       13 = Sfldspctl
      *       14 = Sflclr
      *       15 = Sflend
      *       21 = Home-key
      *       22 = Plassering av cursor
      *       30 = Protect av felter ved vise
      *    31-79 = Varsle m/feilmeldinger/skjermindikatorer
      *    80-99 = Arbeidsindikatorer
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fvpfoir    if   e           k disk    rename(vpfost:vpfoirr)
     fvpfoiu    uf a e           k disk    rename(vpfost:vpfoiur)
     fvpfoi1    if   e           k disk    rename(vpfost:vpfoi1r)
     fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fvltpl1    if   e           k disk    rename(vltppfr:vltpl1r)
5.70 fra30l1    if   e           k disk    rename(ra30pfr:ra30l1r)
     fvvenl1    if   e           k disk    rename(vvenpfr:vvenl1r)
6.20 frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
9.01 ffusrl1    if   e           k disk    rename(fusrpfr:fusrl1r)
6.20 fvogrl1    if   e           k disk    rename(vogrpfr:vogrl1r)
6.20 fvhgrl1    if   e           k disk    rename(vhgrpfr:vhgrl1r)
6.20 fvugrl1    if   e           k disk    rename(vugrpfr:vugrl1r)
6.20 fjvarl1    if   e           k disk    rename(jvarpfr:jvarl1r)
      *
     fVZ100d    cf   e             workstn sfile(b1sfl:w_srrn)
     f                                     infds(dspfbk)
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
     d l_firm                944    946  0
     d l_fnav                951    980
6.22 d l_lagr               1001   1002  0
      *
      * Definering av Information Data Structure - display feedback
      *
     d dspfbk          ds
     d  d_fcrn               378    379I 0
      *
      * Definering av variable i nøkler
      *
6.20 d vogrl1_oogr     s                   like(vgoogr)
6.20 d vhgrl1_hogr     s                   like(vghogr)
6.20 d vhgrl1_hhgr     s                   like(vghhgr)
6.20 d vugrl1_uogr     s                   like(vguogr)
6.20 d vugrl1_uhgr     s                   like(vguhgr)
6.20 d vugrl1_uugr     s                   like(vguugr)
6.20 d rlevl1_levr     s                   like(rllevr)
     d vpfoir_fvar     s                   like(vpfvar)
5.70 d vpfoir_fprg     s                   like(vpfprg)
     d vpfoir_ffda     s                   like(vpffda)
     d vpfoir_ftda     s                   like(vpftda)
     d vpfoiu_fvar     s                   like(vpfvar)
5.70 d vpfoiu_fprg     s                   like(vpfprg)
     d vpfoiu_ffda     s                   like(vpffda)
     d vpfoiu_ftda     s                   like(vpftda)
     d vvarl1_fvar     s                   like(vvvare)
     d jvarl1_vare     s                   like(jvvare)
5.70 d ra30l1_dkod     s                   like(redkod)
     d vvenl1_vare     s                   like(vevare)
     d vvenl1_enhe     s                   like(veenhe)
9.01 d fusrl1_user     s                   like(fbuser)
      *
      * Definering av variable
      *
     d w_fcrn          s              4  0
     d w_stel          s              4  0
     d w_spge          s              4  0
     d w_srrn          s              4  0
     d w_sfrn          s                   like(w_srrn)
     d w_ssrn          s                   like(w_srrn)
      *
6.20 d w_gtxt          s                   like(vgutxt)
6.20 d w_lnav          s                   like(rlnavn)
6.20 d w_ogrp          s                   like(vguogr)
6.20 d w_hgrp          s                   like(vguhgr)
6.20 d w_ugrp          s                   like(vguugr)
6.22 d w_lagr          s              2  0
     d w_seqe          s              1
6.21 d w_mvak          s              1
6.21 d w_mvtx          s             30
6.21 d w_mvas          s              6  2
6.21 d w_mvat          s              5  4
6.21 d w_mvaf          s             10  9
6.21 d w_date          s               d   datfmt(*iso)
6.21 d w_bpro          s              5  2
6.21 d w_stat          s              1
6.21 d w_filt          s              1  0
6.21 d w_lety          s              1  0 inz(0)
      *
     d b_oppr          s              1    inz(*off)
     d b_forn          s              1    inz(*off)
     d b_anul          s              1    inz(*off)
     d b_feil          s              1    inz(*off)
6.21 d b_enh1          s              1    inz(*off)
6.21 d b_enh2          s              1    inz(*off)
6.21 d b_enh3          s              1    inz(*off)
6.21 d b_nytt          s              1    inz(*off)
9.01 d b_mast          s              1    inz(*off)
9.01 d b_prok          s              1    inz(*off)
     d b_open_sok      s              1    inz(*off)
      *
     d w_udat          s               d   datfmt(*iso)
     d w_ffda          s              6  0
     d w_ftda          s              6  0
     d w_etxt          s             35
5.70 d w_ptxt          s             35
     d sqlquery        s           4096
      *
     d w_firm          s                   like(vpffir)
     d w_fvar          s                   like(vpfvar)
     d w_fsko          s                   like(vpfsko)
     d w_tek1          s                   like(jvtek1)
     d w_ltxt          s                   like(vybesk)
     d w_bup1          s                   like(vpfor1)
     d w_bup2          s                   like(vpfor2)
     d w_bup3          s                   like(vpfor3)
5.70 d w_fprg          s                   like(vpfprg)
5.70 d w_fprgx         s                   like(vpfprg)
9.01 d w_mld1          s             50
      *
     d w_ffda_w        s                   like(vpffda)
     d w_ftda_w        s                   like(vpftda)
      *
     d s_fvar          s                   like(vpfvar)
5.70 d s_fprg          s                   like(vpfprg)
     d s_ffda          s              6  0
     d s_ftda          s              6  0

      *
      * Definering av konstanter
      *
     d c_sfil          s              2  0 inz(17)
      *
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      * w_fcrn - Første recordnummer på siden
      * w_stel - Subfile-teller
      * w_spge - Sidestørrelse i subfile (page)
      * w_srrn - Relativt recordnummer i subfile
      * w_sfrn - Første recordnummer på siste side
      * w_ssrn - Siste recordnummer på siste side
      * w_curn - Current recordnummer på siden
      * w_virn - Side og cursorplassering som skal vises
      * w_afld - Aktivt feltnavn
      * w_arow - Aktiv rad for cursor
      * w_acol - Aktiv kolonne for cursor
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      * B1SFL  - B1 Subfile - record
      * B2CTL  - B2 Subfile - control record
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      * C1BLD  - C1 Skjermbilde for innlegging av nøkkel ved oppretting
      * C1MSG  - C1 Meleingsbilde for C1BLD
6.23  * C2MSG  - C2 Meldingsbilde for avslutning
      * C2BLD  - C2 Skjermbilde for opprette/endre/vise
      * D1WIN  - D1 Vindu for slette (Delete)
      * K1WIN  - K1 Vindu for kopiere
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B2CTL Behandle åpningsbildet med subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Send Alt
      *
     c     b2taga        tag
      *
     c                   write     b2cmd
      *
      * Bare data
      *
     c     b2tagb        tag
      *
     c                   exsr      dsp_subfile                                  DSP SFL
      *
      * Behandling av funksjonstaster
      *
     c                   select
     c                   when      *inka
     c                   exsr      xf1win
     c                   exsr      forny
     c                   goto      b2taga
     c                   when      *inkc or *inkl
     c                   goto      avslutt
     c                   when      *inkd
     c                   exsr      spØrring
     c                   goto      b2tagb
     c                   when      *inke
     c                   exsr      forny
     c                   goto      b2tagb
     c                   when      *in10
     c                   exsr      crt_subfile
     c                   goto      b2tagb
     c                   when      *in11
     c                   exsr      bck_subfile
     c                   goto      b2tagb
     c                   when      *in21
     c                   eval      *in22 = *on
     c                   goto      b2taga
     c                   endsl
      *
      *
6.20  * Posisjonering
6.20  *
6.20 c                   if        b2fvar <> *blank or
6.20 c                             b2fprg <> *blank or
6.20 c                             b2fdat <> 0 or
6.20 c                             b2tdat <> 0 or
6.20 c                             b2fsko <> *blank
6.20 c                   exsr      sØk
6.20 c                   goto      b2tagb
6.20 c                   endif
6.20  *
      *
      * Behandling av subfile
      *
     c                   exsr      subfile
      *
     c                   goto      b2taga
      *
      * Avslutt program
      *
     c     avslutt       tag
      *
     c/exec sql
     c+ close STMT
     c/end-exec
     c                   CLOSE     *aLL

     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for fornying av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     forny         begsr
      *
     c                   if        w_fcrn <> 0
     c     w_fcrn        chain     b1sfl
     c                   endif
      *
     c                   eval      b_open_sok = *on
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
     c     end_forny     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for søking i subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sØk           begsr
      *
      *
6.45 c                   select
6.45 c                   when      b2fdat <> 0
6.45 c                   eval      w_seqe = 'F'
     c                   eval      w_ffda = b2fdat
     c     *dmy          move      w_ffda        w_ffda_w
6.45 c                   when      b2tdat <> 0
6.45 c                   eval      w_seqe = 'T'
     c                   eval      w_ftda = b2tdat
     c     *dmy          move      w_ftda        w_ftda_w
6.45 c                   when      b2fsko <> *blank
6.45 c                   eval      w_seqe = 'S'
     c                   eval      w_fsko = b2fsko
6.45 c                   when      b2fvar <> *blank
6.45 c                   eval      w_seqe = 'V'
     c                   eval      w_fvar = b2fvar
6.45 c                   other
6.45 c                   eval      w_seqe = ' '
6.45 c                   eval      w_fprg = b2fprg
6.45 c                   endsl
6.45 c                   eval      b_open_sok = *on
6.45  *
      * Blanker subfile, og fyller opp i.h.t. søk
      *
     c                   eval      *in22 = *off
      *
     c                   exsr      clr_subfile
     c                   exsr      crt_subfile
      *
      * Blanker søkefelt
      *
     c                   eval      b2fprg = *blank
     c                   eval      b2fvar = *blank
     c                   eval      b2fdat = 0
     c                   eval      b2tdat = 0
     c                   eval      b2fsko = *Blank
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     subfile       begsr
      *
     c                   eval      b_forn = *off
      *
     c                   if        *in22 = *off
     c                   eval      *in22 = *on
     c                   else
     c                   eval      *in22 = *off
     c                   endif
      *
     c                   eval      w_virn = w_fcrn
      *
      * Leser og behandler subfile
      *
     c                   do        w_ssrn
     c                   readc     b1sfl
      *
     c                   if        %eof
     c                   leave
     c                   endif
      *
     c                   eval      *in22 = *off
     c                   eval      w_virn = w_srrn
      *
      * Endre
      *
     c                   if        b1valg = 2
9.01 c                   if        b_mast = *off
9.01 c                   eval      w_fprg = b1fprg
9.01 c                   exsr      sjekk_fprg2
9.01 c                   endif
9.01 c                   if        b_prok = *off
6.20 c                   eval      c1fdat = b1fdat
6.20 c                   eval      c1tdat = b1tdat
6.20 c                   eval      c1fvar = b1fvar
6.20 c                   eval      c1fprg = b1fprg
     c                   exsr      xc2bld
9.01 c                   endif
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
      * Kopier
      *
     c*                   if        b1valg = 3
9.01 c*                   if        b_mast = *off
9.01 c*                   eval      w_fprg = b1fprg
9.01 c*                   exsr      sjekk_fprg1
9.01 c*                   endif
9.01 c*                   if        b_prok = *off
6.20 c*                   eval      k1ffda = b1fdat
6.20 c*                   eval      k1ftda = b1tdat
6.20 c*                   eval      k1vare = b1fvar
6.20 c*                   eval      k1fprg = b1fprg
     c*                   exsr      xk1win
9.01 c*                   endif
     c*                   eval      b1valg = 0
     c*                   update    b1sfl
     c*                   iter
     c*                   endif
      *
       //Slett
       //
8.04 c                   if        b1valg = 4
8.04 c                   if        b_mast = *off
8.04 c                   eval      w_fprg = b1fprg
8.04 c                   exsr      sjekk_fprg2
8.04 c                   endif
8.04 c                   if        b_prok = *off
8.04 c                   eval      d1fdat = b1fdat
8.04 c                   eval      d1tdat = b1tdat
8.04 c                   eval      d1fvar = b1fvar
8.04 c                   eval      d1fprg = b1fprg
8.04 c                   exsr      xd1win
8.04 c                   endif
8.04 c                   eval      b1valg = 0
8.04 c                   update    b1sfl
8.04 c                   iter
8.04 c                   endif
      *
      * Vis
      *
     c                   if        b1valg = 5
6.20 c                   eval      c1fdat = b1fdat
6.20 c                   eval      c1tdat = b1tdat
6.20 c                   eval      c1fvar = b1fvar
6.20 c                   eval      c1fprg = b1fprg

     c                   exsr      xc2bld
     c                   eval      b1valg = 0
     c                   update    b1sfl
     c                   iter
     c                   endif
      *
     c                   enddo
      *
     c                   if        b_forn = *on
     c                   exsr      forny
     c                   endif
      *
     c     end_subfile   endsr
      *
      ** - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      ** Subrutine for behandling av skjermbilde for ny rad (C1BLD)
      ** - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      **
     c*     xc1bld        begsr
      **
     c*                   eval      b_oppr = *on
     c*                   eval      b_forn = *off
      **
9.01 c*                   if        b_mast = *off
9.01 c*                   eval      c1fprg = w_fprgx
9.01 c*                   else
9.01 c*                   eval      c1fprg = w_fprgx
9.01 c*                   endif
6.20 c*                   eval      c1ogrp = b2ogrp
6.20 c*                   eval      c1hgrp = b2hgrp
6.20 c*                   eval      c1ugrp = b2ugrp
6.20 c*                   eval      c1ldor = b2ldor
     c*                   eval      c1fvar = b2fvar
     c*                   eval      c1lety = b2lety
     c*                   eval      c1fdat = b2fdat
     c*                   eval      c1ftim = 0
     c*                   eval      c1tdat = b2tdat
     c*                   eval      c1ttim = 2400
      **
     c*                   exsr      hent_info
      **
     c*     c1taga        tag
      **
     c*                   exfmt     c1bld
      **
      ** Behandling av funksjonstaster
      **
     c*                   select
     c*                   when      *inkc or *inkl
     c*                   goto      end_c1bld
     c*                   when      *inkd
     c*                   exsr      spØrring
     c*                   goto      c1taga
     c*                   endsl
      **
6.20 c*                   if        c1ogrp = 0 and
6.20 c*                             c1ldor = 0 and
6.20 c**                  if        c1fvar = *blank and
6.20 c*                             c1fvar = *blank and
     c*                             c1lety = 0 and
     c*                             c1fdat = 0 and
     c*                             c1tdat = 0
     c*                   goto      end_c1bld
     c*                   endif
9.01  ** sjekker om man prøver å kopiere til annen filgruppe
9.01  **
9.01 c*                   if        b_mast = *off
9.01 c*                   if        c1fprg =  *blank
9.01 c*                   exsr      PG_varsel2
9.01 c*                   goto      c1taga
9.01 c*                   endif
9.01 c*                   if        c1fprg <> w_fprgx
9.01 c*                   exsr      PG_varsel2
9.01 c*                   goto      c1taga
9.01 c*                   endif
9.01 c*                   endif
      **
      ** Sjekker input
      **
     c*                   if        c1ttim = 0
     c*                   eval      c1ttim = 2400
     c*                   endif
      **
6.20 c*                   eval      w_ogrp = c1ogrp
6.20 c*                   eval      w_hgrp = c1hgrp
6.20 c*                   eval      w_ugrp = c1ugrp
6.20 c*                   eval      w_ldor = c1ldor
     c*                   eval      w_fvar = c1fvar
5.70 c*                   eval      w_fprg = c1fprg
     c*                   eval      w_lety = c1lety
     c*                   eval      w_ffda = c1fdat
     c*                   eval      w_ftim = c1ftim * 100
     c*                   eval      w_ftda = c1tdat
     c*                   eval      w_ttim = c1ttim * 100
     c*                   exsr      sjekk_input
     c*                   if        b_feil = *on
     c*                   goto      c1taga
     c*                   endif
      **
      ** Sender opp informasjonsbildet dersom rad finnes fra før
      **
6.20 c*                   eval      vpfoir_ogrp = c1ogrp
6.20 c*                   eval      vpfoir_hgrp = c1hgrp
6.20 c*                   eval      vpfoir_ugrp = c1ugrp
6.20 c*                   eval      vpfoir_ldor = c1ldor
     c*                   eval      vpfoir_fvar = c1fvar
     c*                   eval      vpfoir_fprg = c1fprg
     c*                   eval      vpfoir_lety = c1lety
     c*     *dmy          move      c1fdat        vpfoir_ffda
     c*     *dmy          move      c1tdat        vpfoir_ftda
     c*                   eval      w_ftim = c1ftim * 100
     c*     *hms          move      w_ftim        vpfoir_ftim
     c*                   eval      w_ttim = c1ttim * 100
     c*     *hms          move      w_ttim        vpfoir_ttim
     c*     vpfoir_key    chain     vpfoir                             90
     c*                   if        *in90 = *off
     c*                   exsr      xc1msg
     c*                   if        b_anul = *on
     c*                   goto      c1taga
     c*                   endif
     c*                   endif
      **
      ** Kaller vedlikeholdsprogram
      **
     c*                   exsr      xc2bld
      **
6.20 c*                   eval      c1ogrp = 0
6.20 c*                   eval      c1hgrp = 0
6.20 c*                   eval      c1ugrp = 0
6.20 c*                   eval      c1ldor = 0
6.20 c*                   eval      c1gtxt = *blank
6.20 c*                   eval      c1lnav = *blank
     c*                   eval      c1fvar = *blank
5.70 c*                   eval      c1fprg = *blank
     c*                   eval      c1tek1 = *blank
     c*                   eval      c1lety = 0
     c*                   eval      c1ltxt = *blank
     c*                   eval      c1fdat = 0
     c*                   eval      c1ftim = 0
     c*                   eval      c1tdat = 0
     c*                   eval      c1ttim = 2400
      **
     c*                   goto      c1taga
      **
     c*     end_c1bld     tag
      **
     c*                   eval      b_oppr = *off
     c*                   eval      b2fvar = *blank
5.70 c*                   eval      b2fprg = *blank
     c*                   eval      b2lety = 0
     c*                   eval      b2fdat = 0
     c*                   eval      b2tdat = 0
      **
     c*                   if        b_forn = *on
     c*                   exsr      forny
     c*                   endif
      **
     c*                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for utlegging av opprettelsesmelding
      * Meldingsbildet legges ut dersom det forsøkes å opprette en rad som
      * finnes fra før.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      **
     c*     xc1msg        begsr
      **
     c*                   eval      b_anul = *off
      **
     c*                   exfmt     c1msg
      **
      ** Behandling av funksjonstaster
      **
     c*                   if        *inkc or *inkl
     c*                   eval      b_anul = *on
     c*                   goto      end_c1msg
     c*                   endif
      **
     c*     end_c1msg     endsr
      **
6.23  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.23  * Subrutine for utlegging av melding for oppdatering
6.23  * Meldingsbildet legges ut pom pris er endret for kun en enhet
6.23  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.23  *
6.23 c     xc2msg        begsr
6.23  *
6.23 c                   eval      b_anul = *off
6.23  *
6.23 c                   exfmt     c2msg
6.23  *
6.23  * Behandling av funksjonstaster
6.23  *
6.23 c                   if        *inkc or *inkl
6.23 c                   eval      b_anul = *on
6.23 c                   goto      end_c2msg
6.23 c                   endif
6.23  *
6.23 c     end_c2msg     endsr
6.23  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * C2BLD Behandle bilde for ny - endring - vise
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xc2bld        begsr
      *
     c                   eval      w_arow = 0
     c                   eval      w_acol = 0
      *
6.20 c                   eval      vpfoir_fprg = c1fprg
6.20 c                   eval      vpfoir_fvar = c1fvar
     c                   eval      w_ffda = c1fdat
     c     *dmy          move      w_ffda        vpfoir_ffda
     c                   eval      w_ftda = c1tdat
     c     *dmy          move      w_ftda        vpfoir_ftda
     c     vpfoir_key    chain     vpfoir                             90
      *
8.01 c                   if        %found(vpfoir)
      *
     c                   eval      *in80  = *off
     c                   eval      c2fsko = vpfsko
     c                   eval      c2fen1 = vpfen1
     c                   eval      c2for1 = vpfor1

     c                   eval      C2fko1 = vpfko1
6.21 c                   eval      c2fin1 = vpfin1
     c                   eval      c2fen2 = vpfen2
     c                   eval      c2for2 = vpfor2
     c                   eval      C2fko2 = vpfko2
6.21 c                   eval      c2fin2 = vpfin2
     c                   eval      c2fen3 = vpfen3
     c                   eval      c2for3 = vpfor3
     c                   eval      C2fko3 = vpfko3
6.21 c                   eval      c2fin3 = vpfin3
     c                   eval      c2eusr = vpfeus
9.07 c                   eval      c2sver = vpfver
9.07 c                   eval      c2ffid = vpffid
9.07 c                   eval      c2ftms = vpftms
      *
     c                   eval      c2sap1 = 0
     c                   eval      c2sap2 = 0
     c                   eval      c2omr2 = 0
     c                   eval      c2sap3 = 0
     c                   eval      c2omr3 = 0
      *
     c     *dmy          move      vpfeda        c2edat
9.09 c*                   if        vtsvid <> 0
9.11 c*                   eval      c2prof = *blank
9.11 c*                   eval      c2web  = *blank
9.09 c*/exec sql
9.11 c*+ select a.CAMPAIGN_PROFILE_CODE, b.MARKETING_CHANNEL_WEB
9.11 c*+ into :c2prof, :c2web
9.11 c*+ from xkavst a
9.11 c*+ inner join xkafst b on a.id = b.CAMPAIGN_LINE_ID
9.11 c*+ where b.uid = :vtsvid
9.11 c*+                  fetch first 1 rows only
9.09 c*/end-exec
      *
     c                   else
      *
     c                   eval      *in80  = *on
     c                   eval      c2fsko = *blank
     c                   eval      c2for1 = 0
     c                   eval      C2fko1 = 0
6.21 c                   eval      c2fin1 = 0
     c                   eval      c2for2 = 0
     c                   eval      C2fko2 = 0
6.21 c                   eval      c2fin2 = 0
     c                   eval      c2for3 = 0
     c                   eval      C2fko3 = 0
6.21 c                   eval      c2fin3 = 0
     c                   eval      c2edat = 0
9.05 c                   eval      c2sdat = 0
     c                   eval      c2eusr = *blank
9.09 c                   eval      c2web  = *blank
9.11 c                   eval      c2prof = *blank
      *
     c                   eval      w_fvar = c1fvar
     c                   call      'VP715R'
     c                   parm                    w_firm
     c                   parm                    w_fvar
     c                   parm                    c1fprg
6.22 c                   parm                    w_lagr
     c                   parm                    w_lety
     c                   parm                    w_udat
     c                   parm                    c2fen1
     c                   parm                    c2sap1
     c                   parm                    w_bup1
     c                   parm                    c2fen2
     c                   parm                    c2sap2
     c                   parm                    w_bup2
     c                   parm                    c2omr2
     c                   parm                    c2fen3
     c                   parm                    c2sap3
     c                   parm                    w_bup3
     c                   parm                    c2omr3
      *
     c                   endif
      *
     c*                   if        b1valg = 3
     c*                   eval      c1fvar = k1vare
     c*                   eval      c1fprg = k1fprg
     c*                   eval      c1fdat = k1ffda
     c*                   eval      c1tdat = k1ftda
     c*                   endif
      *
     c*                   if        b1valg = 5  or b1valg = 2
     c                   eval      *in30 = *on
     c*                   endif
      *
      * Henter beskrivelse av nivå
      *
     c                   exsr      hent_info
      *
      * Behandler bildet
      *
     c     c2taga        tag
      *
     c                   exfmt     c2bld
      *
     c                   if        *inkc or *inkl or *in30
     c                   goto      end_c2bld
     c                   endif
      *
     c                   eval      w_fvar = c1fvar
      *
      * Validering av input
9.05  *
9.05  * sendt dato
9.05  **
9.05 c*                   if        c2sdat <> 0
9.05 c*     *dmy          test(d)                 c2sdat                 50
9.05 c*                   if        *in50 = *on
9.05 c*                   goto      c2taga
9.05 c*                   endif
9.05 c*                   endif
      **
     c*                   if        c2for1 = 0 and
     c*                             c2for2 = 0 and
     c*                             c2for3 = 0
     c*                   eval      *in31 = *on
     c*                   goto      c2taga
     c*                   endif
6.20  **
6.20 c*     c4taga        tag
      **
     c*                   if        c2fen1 <> *blank
     c*                   eval      vvenl1_vare = w_fvar
     c*                   eval      vvenl1_enhe = c2fen1
     c*     vvenl1_key    chain     vvenl1                             91
     c*                   if        *in91 = *on
     c*                   eval      *in32 = *on
     c*                   goto      c2taga
     c*                   endif
     c*                   endif
      **
     c*                   if        c2for1 <> 0 and
     c*                             c2fen1 = *blank
     c*                   eval      *in33 = *on
     c*                   goto      c2taga
     c*                   endif
      **
     c*                   if        c2fen2 <> *blank
     c*                   eval      vvenl1_vare = w_fvar
     c*                   eval      vvenl1_enhe = c2fen2
     c*     vvenl1_key    chain     vvenl1                             91
     c*                   if        *in91 = *on
     c*                   eval      *in34 = *on
     c*                   goto      c2taga
     c*                   endif
     c*                   endif
      **
     c*                   if        c2for2 <> 0 and
     c*                             c2fen2 = *blank
     c*                   eval      *in35 = *on
     c*                   goto      c2taga
     c*                   endif
      **
     c*                   if        c2fen3 <> *blank
     c*                   eval      vvenl1_vare = w_fvar
     c*                   eval      vvenl1_enhe = c2fen3
     c*     vvenl1_key    chain     vvenl1                             91
     c*                   if        *in91 = *on
     c*                   eval      *in36 = *on
     c*                   goto      c2taga
     c*                   endif
     c*                   endif
      **
     c*                   if        c2for3 <> 0 and
     c*                             c2fen3 = *blank
     c*                   eval      *in37 = *on
     c*                   goto      c2taga
     c*                   endif
      **
      ** Organiserer input
      **
     c*                   if        c2for1 = 0
     c*                   eval      c2fen1 = *blank
     c*                   eval      C2fko1 = 0
     c*                   endif
      **
     c*                   if        c2for2 = 0
     c*                   eval      c2fen2 = *blank
     c*                   eval      C2fko2 = 0
     c*                   endif
      **
     c*                   if        c2for3 = 0
     c*                   eval      c2fen3 = *blank
     c*                   eval      C2fko3 = 0
     c*                   endif
      **
     c*                   if        c2for2 = 0 and
     c*                             c2for3 <> 0
     c*                   eval      c2fen2 = c2fen3
     c*                   eval      c2for2 = c2for3
     c*                   eval      C2fko2 = C2fko3
     c*                   eval      c2fen3 = *blank
     c*                   eval      c2for3 = 0
     c*                   eval      C2fko3 = 0
     c*                   endif
      **
     c*                   if        c2for1 = 0 and
     c*                             c2for2 <> 0
     c*                   eval      c2fen1 = c2fen2
     c*                   eval      c2for1 = c2for2
     c*                   eval      C2fko1 = C2fko2
     c*                   eval      c2fen2 = c2fen3
     c*                   eval      c2for2 = c2for3
     c*                   eval      C2fko2 = C2fko3
     c*                   eval      c2fen3 = *blank
     c*                   eval      c2for3 = 0
     c*                   eval      C2fko3 = 0
     c*                   endif
      *
      *
      * Oppdatering av rad  skal ikke være oppdatering her
      *
     c*                   clear                   vpfoiur
      **
     c*                   eval      vpfoiu_fvar = c1fvar
     c*                   eval      vpfoiu_fprg = c1fprg
     c*     *dmy          move      c1fdat        vpfoiu_ffda
     c*     *dmy          move      c1tdat        vpfoiu_ftda
     c*     vpfoiu_key    chain     vpfoiur                            90
      **
     c*                   eval      vpfsko = c2fsko
     c*                   eval      vpfen1 = c2fen1
     c*                   eval      vpfor1 = c2for1
6.20 c*                   eval      vtpro1 = c2pro1
     c*                   eval      vpfko1 = C2fko1
6.21 c*                   eval      vpfin1 = c2fin1
     c*                   eval      vpfen2 = c2fen2
     c*                   eval      vpfor2 = c2for2
     c*                   eval      vpfko2 = C2fko2
6.21 c*                   eval      vpfin2 = c2fin2
     c*                   eval      vpfen3 = c2fen3
     c*                   eval      vpfor3 = c2for3
     c*                   eval      vpfko3 = C2fko3
6.21 c*                   eval      vpfin3 = c2fin3
9.05 c*                   if        c2sdat <> 0
9.05 c*     *dmy          move      c2sdat        vtsdat
9.05 c*                   else
9.05 c*                   eval      vtsdat = *loval
9.05 c*                   endif
     c*                   eval      vteusr = l_user
      **
     c*                   time                    vtetim
     c*                   time                    vpfeda
      **
     c*                   if        *in90 = *off
     c*                   update    vpfoiur
     c*                   else
     c*                   eval      vtfirm = w_firm
     c*                   eval      vpfvar = c1fvar
     c*                   eval      vpfprg = c1fprg
     c*     *dmy          move      c1fdat        vpffda
     c*     *dmy          move      c1tdat        vpftda
6.10 c*                   time                    vtodat
6.10 c*                   time                    vtotim
6.10 c*                   eval      vtousr = l_user
     c*                   write     vpfoiur
     c*                   endif
      *
      * Oppdater subfile
      *
     c                   if        b1valg = 2
     c                   eval      b1fsko = c2fsko
     c                   eval      b1fen1 = c2fen1
     c                   eval      b1for1 = c2for1
     c                   endif
      *
     c                   if        b_oppr = *on or
     c                             b1valg = 3
     c                   eval      b_forn = *on
     c                   endif
      *
     c     end_c2bld     tag
      *
     c                   eval      *in30  = *off
6.20 c                   eval      *in48  = *off
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av slette-bildet (D1WIN)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xd1win        begsr
      *
     c                   eval      vpfoir_fvar = d1fvar
     c                   eval      vpfoir_fprg = d1fprg
     c                   eval      w_ffda = d1fdat
     c     *dmy          move      w_ffda        vpfoir_ffda
     c                   eval      w_ftda = d1tdat
     c     *dmy          move      w_ftda        vpfoir_ftda
     c     vpfoir_key    chain     vpfoir                             90
      *
     c                   exfmt     d1win
      *
     c                   if        *inkc or *inkl
     c                   goto      end_d1win
     c                   endif
      *
     c                   eval      b_forn = *on
      *
      * Sletter rad
      *
     c                   eval      vpfoiu_fvar = d1fvar
     c                   eval      vpfoiu_fprg = d1fprg
     c     *dmy          move      w_ffda        vpfoiu_ffda
     c     *dmy          move      w_ftda        vpfoiu_ftda
     c     vpfoiu_key    chain     vpfoiur                            90
     c                   delete    vpfoiur
      *
     c     end_d1win     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * F1 Behandle bilde for bla-alternativer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xf1win        begsr
      *
      *  Send Alt
      *
     c     f1taga        tag
     c                   exfmt     f1win
      *
      * Behandling av funksjonstaster
      *
     c                   select
     c                   when      *inkc or *inkl
     c                   goto      end_f1win
     c                   when      *inkd
     c                   exsr      spØrring
     c                   goto      f1taga
     c                   endsl
      *
      *
     c     end_f1win     endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å behandle kopierings-bildet (K1WIN)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c*     xk1win        begsr
      **
      ** Tar vare på nøkkel til rad det skal kopieres fra
      **
     c*                   eval      s_fvar = k1vare
5.70 c*                   eval      s_fprg = k1fprg
     c*                   eval      s_ffda = k1ffda
     c*                   eval      s_ftda = k1ftda
      **
      ** Fyller kopierings-bildet
      **
     c*                   eval      vpfoir_fvar = k1vare
5.70 c*                   eval      vpfoir_fprg = k1fprg
     c*                   eval      vpfoir_lety = k1lety
     c*     *dmy          move      k1ffda        vpfoir_ffda
     c*     *dmy          move      k1ftda        vpfoir_ftda
     c*     vpfoir_key    chain     vpfoir                             90
      **
9.01 c*                   if        b_mast = *off
9.01 c*                   eval      k1fprg = w_fprgx
9.01 c*                   eval      s_fprg = w_fprgx
9.01 c*                   goto      k1tagc
9.01 c*                   endif
      **
     c*                   eval      k2ffda = k1ffda
     c*                   eval      k2ftim = k1ftim
     c*                   eval      k2ftda = k1ftda
     c*                   eval      k2ttim = k1ttim
      **
     c*     k1taga        tag
      **
     c*                   exfmt     k1win
      **
     c*                   if        *inkc or *inkl
     c*                   goto      end_k1win
     c*                   endif
      **
      ** Spørring
      **
     c*                   if        *inkd = *on
     c*                   exsr      spØrring
     c*                   goto      k1taga
     c*                   endif
      *
      **
      ** Sjekker input
      **
      **
     c*                   eval      w_fvar = k1vare
5.70 c*                   eval      w_fprg = k1fprg
     c*                   eval      w_ffda = k1ffda
     c*                   eval      w_ftda = k1ftda
     c*                   exsr      sjekk_input
     c*                   if        b_feil = *on
     c*                   goto      k1taga
     c*                   endif
      **
      ** Sjekker om rad finnes fra før
      **
     c*                   eval      vpfoir_fvar = k1vare
     c*                   eval      vpfoir_fprg = k1fprg
     c*     *dmy          move      k1ffda        vpfoir_ffda
     c*     *dmy          move      k1ftda        vpfoir_ftda
     c*     vpfoir_key    chain     vpfoir                             90
     c*                   if        *in90 = *off
     c*                   eval      *in32 = *on
     c*                   goto      k1taga
     c*                   endif
      **
      ** Kaller vedlikeholdsprogram
9.01 c*     k1tagc        tag
      **
     c*                   eval      c1fvar = s_fvar
5.70 c*                   eval      c1fprg = s_fprg
     c*                   eval      c1fdat = s_ffda
     c*                   eval      c1ftim = s_ftim
     c*                   eval      c1tdat = s_ftda
     c*                   eval      c1ttim = s_ttim
      **
     c*                   exsr      xc2bld
      **
     c*     end_k1win     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for tømming av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     clr_subfile   begsr
      *
     c                   eval      *in14 = *on
     c                   write     b2ctl
     c                   eval      *in14 = *off
      *
     c                   eval      *in15 = *off
     c                   eval      w_srrn = 0
     c                   eval      w_sfrn = 0
     c                   eval      w_ssrn = 0
     c                   eval      w_spge = 0
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Fyll opp subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     crt_subfile   begsr
      *
     c                   eval      w_spge = w_spge + c_sfil
     c                   eval      w_srrn = w_ssrn
     c                   if        b_open_sok = *on
     c/exec sql
     c+ close STMT
     c/end-exec
      *
     c                   eval      sqlquery  = 'select +
6.45 c                             vpfvar, +
6.45 c                             vpfprg, +
6.45 c                             vpffda, +
6.45 c                             vpftda, +
6.45 c                             vpfsko, +
6.45 c                             vpfen1, +
6.45 c                             vpfin1, +
6.45 c                             vpfko1, +
6.45 c                             vpfor1, +
6.45 c                             vpfen2, +
6.45 c                             vpfin2, +
6.45 c                             vpfko2, +
6.45 c                             vpfor2, +
6.45 c                             vpfen3, +
6.45 c                             vpfko3, +
6.45 c                             vpfor3, +
6.45 c                             vpfver, +
6.45 c                             jvtek1, +
6.45 c                             jvogrp, +
6.45 c                             jvhgrp, +
6.45 c                             jvugrp  +
6.45 c                             from   vpfost a  +
6.45 c                             inner join jvarpf b on vpfvar = jvvare  '
      *
     c                   select
     c                   when      w_seqe = 'F'
     c                   eval      sqlquery  = %trim(sqlquery)  +
     c                             ' where  vpffda >= ?  '
     c                   when      w_seqe = 'T'
     c                   eval      sqlquery  = %trim(sqlquery)  +
6.48 c                             ' where  vpftda >= ?  '
     c                   when      w_seqe = 'S'
     c                   eval      sqlquery  = %trim(sqlquery)  +
6.48 c                             ' where  vpfsko >= ?  '
     c                   when      w_seqe = 'V'
     c                   eval      sqlquery  = %trim(sqlquery)  +
6.48 c                             ' where  vpfvar >= ?  '
     c                   other
     c                   eval      sqlquery  = %trim(sqlquery)      +
6.48 c                             ' where  vpfprg >= ?  '
     c                   endsl
      * filter
     c                   if        f1fprg <> *blank
     c                   eval      sqlquery  = %trim(sqlquery)      +
6.48 c                             ' and  vpfprg = ?  '
     c                   endif
     c                   if        f1ogrp <> 0
     c                   eval      sqlquery  = %trim(sqlquery)      +
6.48 c                             ' and  jvogrp = ?  '
     c                   endif
     c                   if        f1hgrp <> 0
     c                   eval      sqlquery  = %trim(sqlquery)      +
6.48 c                             ' and  jvhgrp = ?  '
     c                   endif
     c                   if        f1ugrp <> 0
     c                   eval      sqlquery  = %trim(sqlquery)      +
6.48 c                             ' and  jvugrp = ?  '
     c                   endif
      * order by
     c                   select
     c                   when      w_seqe = 'F'
     c                   eval      sqlquery  = %trim(sqlquery)      +
     c                             ' order by vpffda, vpfprg   +
     c                             , vpfvar  for read only'
     c                   when      w_seqe = 'T'
     c                   eval      sqlquery  = %trim(sqlquery)  +
6.48 c                             ' order by vpftda, vpfprg  +
     c                             , vpfvar  for read only'
     c                   when      w_seqe = 'S'
     c                   eval      sqlquery  = %trim(sqlquery)  +
6.48 c                             ' order by vpfsko, vpfvar, vpfprg ' +
     c                             '   for read only'
     c                   when      w_seqe = 'V'
     c                   eval      sqlquery  = %trim(sqlquery)  +
6.48 c                             ' order by vpfvar, vpfprg  ' +
     c                             '   for read only'
     c                   other
     c                   eval      sqlquery  = %trim(sqlquery)      +
     c                               ' order by vpfprg   +
     c                             , vpfvar, vpffda, vpftda  '  +
     c                             '  for read only'
     c                   endsl
     c
     c/exec sql
     c+ PREPARE SQL_STMT FROM :sqlquery
     c/end-exec
     c
     c/exec sql
     c+ DECLARE STMT CURSOR FOR SQL_STMT
     c/end-exec
     c                   if        sqlcod < 0
     c                   eval      *in15 = *on
     c                   leavesr
     c                   endif
      * sjekk filter
     c                   eval      w_filt = 0
     c                   if        f1fprg <> *blank and
     c                             f1ogrp <> 0 and
     c                             f1hgrp <> 0 and
     c                             f1ugrp <> 0
     c                   eval      w_filt = 8
     c                   endif
     c                   if        f1fprg <> *blank and
     c                             f1ogrp <> 0 and
     c                             f1hgrp <> 0 and
     c                             f1ugrp = 0
     c                   eval      w_filt = 9
     c                   endif
     c                   if        f1fprg <> *blank and
     c                             f1ogrp <> 0 and
     c                             f1hgrp = 0 and
     c                             f1ugrp = 0
     c                   eval      w_filt = 6
     c                   endif
     c                   if        f1fprg <> *blank and
     c                             f1ogrp = 0 and
     c                             f1hgrp = 0 and
     c                             f1ugrp = 0
     c                   eval      w_filt = 5
     c                   endif
     c                   if        f1fprg =  *blank and
     c                             f1ogrp <> 0 and
     c                             f1hgrp <> 0 and
     c                             f1ugrp <> 0
     c                   eval      w_filt = 4
     c                   endif
     c                   if        f1fprg =  *blank and
     c                             f1ogrp <> 0 and
     c                             f1hgrp <> 0 and
     c                             f1ugrp = 0
     c                   eval      w_filt = 3
     c                   endif
     c                   if        f1fprg =  *blank and
     c                             f1ogrp <> 0 and
     c                             f1hgrp = 0 and
     c                             f1ugrp = 0
     c                   eval      w_filt = 2
     c                   endif
     c                   if        f1fprg =  *blank and
     c                             f1ogrp = 0 and
     c                             f1hgrp = 0 and
     c                             f1ugrp = 0
     c                   eval      w_filt = 1
     c                   endif

      *
     c                   select
     c                   when      w_seqe = 'F'
     c                   select
     c                   when      w_filt = 8
     c/exec sql
     c+ OPEN STMT using :w_ffda_w, :f1fprg,:f1ogrp,:f1hgrp,:f1ugrp
     c/end-exec
     c                   when      w_filt = 7
     c/exec sql
     c+ OPEN STMT using :w_ffda_w, :f1fprg,:f1ogrp,:f1hgrp
     c/end-exec
     c                   when      w_filt = 6
     c/exec sql
     c+ OPEN STMT using :w_ffda_w, :f1fprg,:f1ogrp
     c/end-exec
     c                   when      w_filt = 5
     c/exec sql
     c+ OPEN STMT using :w_ffda_w, :f1fprg
     c/end-exec
     c                   when      w_filt = 4
     c/exec sql
     c+ OPEN STMT using :w_ffda_w, :f1ogrp,:f1hgrp,:f1ugrp
     c/end-exec
     c                   when      w_filt = 3
     c/exec sql
     c+ OPEN STMT using :w_ffda_w, :f1ogrp,:f1hgrp
     c/end-exec
     c                   when      w_filt = 2
     c/exec sql
     c+ OPEN STMT using :w_ffda_w, :f1ogrp
     c/end-exec
     c                   when      w_filt = 1
     c/exec sql
     c+ OPEN STMT using :w_ffda_w
     c/end-exec

     c                   other
     c/exec sql
     c+ OPEN STMT using :w_ffda_w
     c/end-exec
     c                   endsl

     c                   when      w_seqe = 'T'
     c                   select
     c                   when      w_filt = 8
     c/exec sql
     c+ OPEN STMT using :w_ftda_w, :f1fprg,:f1ogrp,:f1hgrp,:f1ugrp
     c/end-exec
     c                   when      w_filt = 7
     c/exec sql
     c+ OPEN STMT using :w_ftda_w, :f1fprg,:f1ogrp,:f1hgrp
     c/end-exec
     c                   when      w_filt = 6
     c/exec sql
     c+ OPEN STMT using :w_ftda_w, :f1fprg,:f1ogrp
     c/end-exec
     c                   when      w_filt = 5
     c/exec sql
     c+ OPEN STMT using :w_ftda_w, :f1fprg
     c/end-exec
     c                   when      w_filt = 4
     c/exec sql
     c+ OPEN STMT using :w_ftda_w, :f1ogrp,:f1hgrp,:f1ugrp
     c/end-exec
     c                   when      w_filt = 3
     c/exec sql
     c+ OPEN STMT using :w_ftda_w, :f1ogrp,:f1hgrp
     c/end-exec
     c                   when      w_filt = 2
     c/exec sql
     c+ OPEN STMT using :w_ftda_w, :f1ogrp
     c/end-exec
     c                   when      w_filt = 1
     c/exec sql
     c+ OPEN STMT using :w_ftda_w
     c/end-exec
     c                   other
     c/exec sql
     c+ OPEN STMT using  :w_ftda_w
     c/end-exec
     c                   endsl
     c                   when      w_seqe = 'S'
     c                   select
     c                   when      w_filt = 8
     c/exec sql
     c+ OPEN STMT using :b2fsko, :f1fprg,:f1ogrp,:f1hgrp,:f1ugrp
     c/end-exec
     c                   when      w_filt = 7
     c/exec sql
     c+ OPEN STMT using :b2fsko, :f1fprg,:f1ogrp,:f1hgrp
     c/end-exec
     c                   when      w_filt = 6
     c/exec sql
     c+ OPEN STMT using :b2fsko, :f1fprg,:f1ogrp
     c/end-exec
     c                   when      w_filt = 5
     c/exec sql
     c+ OPEN STMT using :b2fsko, :f1fprg
     c/end-exec
     c                   when      w_filt = 4
     c/exec sql
     c+ OPEN STMT using :b2fsko, :f1ogrp,:f1hgrp,:f1ugrp
     c/end-exec
     c                   when      w_filt = 3
     c/exec sql
     c+ OPEN STMT using :b2fsko, :f1ogrp,:f1hgrp
     c/end-exec
     c                   when      w_filt = 2
     c/exec sql
     c+ OPEN STMT using :b2fsko, :f1ogrp
     c/end-exec
     c                   when      w_filt = 1
     c/exec sql
     c+ OPEN STMT using :b2fsko
     c/end-exec
     c                   other
     c/exec sql
     c+ OPEN STMT using  :b2fsko
     c/end-exec
     c                   endsl
     c                   when      w_seqe = 'V'
     c                   select
     c                   when      w_filt = 8
     c/exec sql
     c+ OPEN STMT using :b2fvar, :f1fprg,:f1ogrp,:f1hgrp,:f1ugrp
     c/end-exec
     c                   when      w_filt = 7
     c/exec sql
     c+ OPEN STMT using :b2fvar, :f1fprg,:f1ogrp,:f1hgrp
     c/end-exec
     c                   when      w_filt = 6
     c/exec sql
     c+ OPEN STMT using :b2fvar, :f1fprg,:f1ogrp
     c/end-exec
     c                   when      w_filt = 5
     c/exec sql
     c+ OPEN STMT using :b2fvar, :f1fprg
     c/end-exec
     c                   when      w_filt = 4
     c/exec sql
     c+ OPEN STMT using :b2fvar, :f1ogrp,:f1hgrp,:f1ugrp
     c/end-exec
     c                   when      w_filt = 3
     c/exec sql
     c+ OPEN STMT using :b2fvar, :f1ogrp,:f1hgrp
     c/end-exec
     c                   when      w_filt = 2
     c/exec sql
     c+ OPEN STMT using :b2fvar, :f1ogrp
     c/end-exec
     c                   when      w_filt = 1
     c/exec sql
     c+ OPEN STMT using :b2fvar
     c/end-exec
     c                   other
     c/exec sql
     c+ OPEN STMT using  :b2fvar
     c/end-exec
     c                   endsl
     c                   other
     c                   select
     c                   when      w_filt = 8
     c/exec sql
     c+ OPEN STMT using :b2fprg, :f1fprg,:f1ogrp,:f1hgrp,:f1ugrp
     c/end-exec
     c                   when      w_filt = 7
     c/exec sql
     c+ OPEN STMT using :b2fprg, :f1fprg,:f1ogrp,:f1hgrp
     c/end-exec
     c                   when      w_filt = 6
     c/exec sql
     c+ OPEN STMT using :b2fprg, :f1fprg,:f1ogrp
     c/end-exec
     c                   when      w_filt = 5
     c/exec sql
     c+ OPEN STMT using :b2fprg, :f1fprg
     c/end-exec
     c                   when      w_filt = 4
     c/exec sql
     c+ OPEN STMT using :b2fprg, :f1ogrp,:f1hgrp,:f1ugrp
     c/end-exec
     c                   when      w_filt = 3
     c/exec sql
     c+ OPEN STMT using :b2fprg, :f1ogrp,:f1hgrp
     c/end-exec
     c                   when      w_filt = 2
     c/exec sql
     c+ OPEN STMT using :b2fprg, :f1ogrp
     c/end-exec
     c                   when      w_filt = 1
     c/exec sql
     c+ OPEN STMT using  :b2fprg
     c/end-exec
     c                   other
     c/exec sql
     c+ OPEN STMT using  :b2fprg
     c/end-exec
     c                   endsl
      *
     c                   endsl                                                  b_open_sok
     c                   endif

      *
     c                   dou       w_srrn = w_spge
     c/exec sql
     c+                  fetch STMT
     c+                  into  :vpfvar,
6.45 c+                        :vpfprg,
6.45 c+                        :vpffda,
6.45 c+                        :vpftda,
6.45 c+                        :vpfsko,
6.45 c+                        :vpfen1,
6.45 c+                        :vpfin1,
6.45 c+                        :vpfko1,
6.45 c+                        :vpfor1,
6.45 c+                        :vpfen2,
6.45 c+                        :vpfin2,
6.45 c+                        :vpfko2,
6.45 c+                        :vpfor2,
     c+                        :vpfen3,
     c+                        :vpfko3,
     c+                        :vpfor3,
     c+                        :vpfver,
     c+                        :jvtek1,
     c+                        :jvogrp,
     c+                        :jvhgrp,
     c+                        :jvugrp
     c/end-exec
     c                   if        sqlcod = 100 or sqlstt = '02000'
     c                   eval      *in15 = *on
6.46 c                   leave
     c                   endif
     c                   if        sqlcod < 0
     c                   eval      *in15 = *on
     c                   leavesr
     c                   endif
      *
9.01  * test på egen prisgruppe
9.01 c                   if        b_mast = *off
9.01  * sjekk alle ikke master
9.01 c                   if        w_fprgx <> *blank and
9.01 c                             vpfprg <> *blank and
9.01 c                             vpfprg <> w_fprgx
9.01 c                   iter
9.01 c                   endif
9.01 c                   endif
      *
     c                   eval      w_srrn = w_srrn + 1
      *
     c                   eval      b1fvar = vpfvar
     c                   eval      b1fprg = vpfprg
     c                   eval      b1tek1 = jvtek1
     c                   eval      b1ogrp = jvogrp
     c                   eval      b1hgrp = jvhgrp
     c                   eval      b1ugrp = jvugrp
     c                   eval      b1fsko = vpfsko
     c                   eval      b1fen1 = vpfen1
     c                   eval      b1for1 = vpfor1
      *
     c                   if        vpffda <> *loval
     c     *dmy          move      vpffda        b1fdat
     c                   else
     c                   eval      b1fdat = 0
     c                   endif
     c                   if        b1tdat <> *loval
     c     *dmy          move      vpftda        b1tdat
     c                   else
     c                   eval      b1tdat = 0
     c                   endif
      *
     c                   write     b1sfl
      *
     c                   enddo
      *
     c                   if        w_srrn > w_ssrn
     c                   eval      w_sfrn = w_ssrn + 1
     c                   endif
      *
     c                   eval      w_ssrn = w_srrn
     c                   eval      w_virn = w_sfrn
      *
     c                   eval      b_open_sok = *off
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å bla tilbake en side i subfilen
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     bck_subfile   begsr
     c
     c                   endsr
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for display av subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     dsp_subfile   begsr
      *
     c                   if        w_srrn <> 0
     c                   eval      *in12 = *on
     c                   else
     c                   write     b2cmd
     c                   endif
      *
     c                   eval      *in13 = *on
     c                   exfmt     b2ctl
      *
     c                   eval      *in12 = *off
     c                   eval      *in13 = *off
      *
     c                   eval      w_fcrn = d_fcrn
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av spørring
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     spØrring      begsr
      *
      *
6.20  * Overgruppe
6.20  *
6.20 c                   if        w_afld = 'F1OGRP'
6.20 c                   call      'VG510R'
6.20 c                   parm                    w_firm
6.20 c                   parm                    f1ogrp
6.20 c                   parm                    f1otxt
6.20 c                   leavesr
6.20 c                   endif
6.20  *
6.20  * Hovedgruppe
6.20  *
6.20 c                   if        w_afld = 'F1HGRP'
6.20 c                   call      'VG511R'
6.20 c                   parm                    w_firm
6.20 c                   parm                    F1ogrp
6.20 c                   parm                    F1hgrp
6.20 c                   parm                    F1Htxt
6.20 c                   leavesr
6.20 c                   endif
6.20  *
6.20  * Undergruppe
6.20  *
6.20  *
6.20 c                   if        w_afld = 'F1UGRP'
6.20 c                   call      'VG512R'
6.20 c                   parm                    w_firm
6.20 c                   parm                    f1ogrp
6.20 c                   parm                    f1hgrp
6.20 c                   parm                    f1ugrp
6.20 c                   parm                    f1utxt
6.20 c                   leavesr
6.20 c                   endif
6.20  *
5.70  * Prisgruppe
5.70  *
5.70 c*                   if        w_afld = 'K1FPRG'
9.03 c*                   call      'RA530RX'
5.70 c*                   parm                    w_firm
5.70 c*                   parm                    K2fprg
5.70 c*                   parm                    w_ptxt
5.70 c*                   leavesr
5.70 c*                   endif
      *
     c     end_spØrr     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Sjekker inntastede verdier, og henter beskrivelser
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     sjekk_input   begsr
      *
     c                   eval      b_feil = *off
      *
     c                   eval      w_tek1 = *blank
     c                   eval      w_ltxt = *blank
6.20 c                   eval      w_gtxt = *blank
6.20 c                   eval      w_lnav = *blank
      *
9.01  *
9.01  * Sjekker input master-prisgruppe
9.01  *
9.01 c                   if        b_mast = *off and
9.01 c                             c1fprg <> *blank and
9.01 c                             c1fprg <> w_fprgx
9.01 c                   eval      *in52 = *on
9.01 c                   leavesr
9.01 c                   endif
      *
     c     end_sjekk     endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Henter beskrivelse
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hent_info     begsr
      *
     c                   eval      c1tek1 = *blank


      **
6.20  ** Undergruppe-tekst
6.20  **
6.20 c*                   if        c1ugrp <> 0
6.20 c*                   eval      vugrl1_uogr = c1ogrp
6.20 c*                   eval      vugrl1_uhgr = c1hgrp
6.20 c*                   eval      vugrl1_uugr = c1ugrp
6.20 c*     vugrl1_key    chain     vugrl1                             91
6.20 c*                   if        *in91 = *off
6.20 c*                   eval      c1gtxt = vgutxt
6.20 c*                   goto      vgrtxt
6.20 c*                   endif
6.20 c*                   endif
6.20  **
6.20  ** Hovedgruppe-tekst
6.20  **
6.20 c*                   if        c1hgrp <> 0 and
6.20 c*                             c1ogrp <> 0
6.20 c*                   eval      vhgrl1_hogr = c1ogrp
6.20 c*                   eval      vhgrl1_hhgr = c1hgrp
6.20 c*     vhgrl1_key    chain     vhgrl1                             91
6.20 c*                   if        *in91 = *off
6.20 c*                   eval      c1gtxt = vghtxt
6.20 c*                   goto      vgrtxt
6.20 c*                   endif
6.20 c*                   endif
6.20  **
6.20  ** Overgruppe-tekst
6.20  **
6.20 c*                   if        c1ogrp <> 0
6.20 c*                   eval      vogrl1_oogr = c1ogrp
6.20 c*     vogrl1_key    chain     vogrl1                             91
6.20 c*                   if        *in91 = *off
6.20 c*                   eval      c1gtxt = vgotxt
6.20 c*                   eval      b_feil = *on
6.20 c*                   endif
6.20 c*                   endif
6.20  **
6.20 c*     vgrtxt        tag
6.20  **
6.20  ** Leverandør
6.20  **
6.20 c*                   if        c1ldor <> 0
6.20 c*                   eval      rlevl1_levr = c1ldor
6.20 c*     rlevl1_key    chain     rlevl1                             91
6.20 c*                   if        *in91 = *off
6.20 c*                   eval      c1lnav = rlnavn
6.20 c*                   endif
6.20 c*                   endif
      *
      * Varenummer
      *
     c                   if        c1fvar <> *blank
     c                   eval      jvarl1_vare = c1fvar
     c     jvarl1_key    chain     jvarl1                             91
     c                   if        *in91 = *off
     c                   eval      c1tek1 = jvtek1
     c                   endif
     c                   endif
5.70  *
5.70  * Prisgruppe
5.70  *
5.70 c                   if        c1fprg <> *blank
5.70 c                   eval      ra30l1_dkod = c1fprg
5.70 c     ra30l1_key    chain     ra30l1                             91
5.70 c                   if        *in91 = *off
5.70 c                   eval      c1ptxt = redtxt
5.70 c                   endif
5.70 c                   endif
      *
     c                   endsr
6.21  *
6.21  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.21  * Subrutine for initiering av program
6.21  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.21  *
6.21 c*     auto_beregn   begsr
6.21  **
6.21 c*                   eval      b_nytt = *on
6.21  **
6.21 c*                   if        b_enh1 = *on
6.21  ** hvis enhet1 er fylt ut.
6.21 c*                   if        c2fen2 <>*blank and
6.21 c*                             c2for2 = 0
6.21 c*                   eval      c2for2 = c2for1 * c2omr2
6.21 c*                   eval      C2fko2 = C2fko1 * c2omr2
6.21 c*                   eval      c2fin2 = c2fin1 * c2omr2
6.21 c*                   endif
6.21 c*                   if        c2fen3 <>*blank and
6.21 c*                             c2for3 = 0
6.21 c*                   eval      c2for3 = c2for1 * c2omr3
6.21 c*                   eval      C2fko3 = C2fko1 * c2omr3
6.21 c*                   eval      c2fin3 = c2fin1 * c2omr3
6.21 c*                   endif
6.21  **
6.21 c*                   endif
6.21 c*                   if        b_enh2 = *on
6.21  ** hvis enhet2 er fylt ut.
6.21 c*                   if        c2fen1 <>*blank and
6.21 c*                             c2for1 = 0
6.21 c*                   eval      c2for1 = c2for2 / c2omr2
6.21 c*                   eval      C2fko1 = C2fko2 / c2omr2
6.21 c*                   eval      c2fin1 = c2fin2 / c2omr2
6.21 c*                   endif
6.21 c*                   if        c2fen3 <>*blank and
6.21 c*                             c2for3 = 0
6.21 c*                   eval      c2for3 = (c2for2 / c2omr2) * c2omr3
6.21 c*                   eval      C2fko3 = (C2fko2 / c2omr2) * c2omr3
6.21 c*                   eval      c2fin3 = (c2fin2 / c2omr2) * c2omr3
6.21 c*                   endif
6.21  **
6.21 c*                   endif
6.21  **
6.21 c*                   if        b_enh3 = *on
6.21  ** hvis enhet2 er fylt ut.
6.21 c*                   if        c2fen1 <>*blank and
6.21 c*                             c2for1 = 0
6.21 c*                   eval      c2for1 = c2for3 / c2omr3
6.21 c*                   eval      C2fko1 = C2fko3 / c2omr3
6.21 c*                   eval      c2fin1 = c2fin3 / c2omr3
6.21 c*                   endif
6.21 c*                   if        c2fen2 <>*blank and
6.21 c*                             c2for2 = 0
6.21 c*                   eval      c2for2 = (c2for3 / c2omr3) * c2omr2
6.21 c*                   eval      C2fko2 = (C2fko3 / c2omr3) * c2omr2
6.21 c*                   eval      c2fin2 = (c2fin3 / c2omr3) * c2omr2
6.21 c*                   endif
6.21  **
6.21 c*                   endif
6.21  **
6.21 c*                   endsr
      *
9.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
9.01  * Sjekker om bruker har lov til å kopiere prisgruppen
9.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
9.01  *
9.01 c     sjekk_fprg1   begsr
6.01 c                   eval      b_prok = *off
9.01  *
9.01 c                   if        w_fprg <> *blank and
9.01 c                             w_fprg <> w_fprgx
9.01 c                   eval      b_prok = *on
9.01 c                   exsr      PG_varsel1
9.01 c                   endif
9.01  *
9.01 c                   endsr
9.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
9.01  * Sjekker om bruker har lov til å endre/slette - prisgruppen
9.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
9.01  *
9.01 c     sjekk_fprg2   begsr
6.01 c                   eval      b_prok = *off
9.01  *
9.01 c                   if        w_fprg <> *blank and
9.01 c                             w_fprg <> w_fprgx
9.01 c                   eval      b_prok = *on
9.01 c                   exsr      PG_varsel2
9 01 c                   endif
9.01  *
9.01 c                   if        w_fprg =  *blank
9.01 c                   eval      b_prok = *on
9.01 c                   exsr      PG_varsel2
9.01 c                   endif
9.01  *
9.01 c                   endsr
9.01  *
9.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
9.01  * Varsel vedr styring av vedlikehold av prisgruppe
9.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
9.01  *
9.01 c     PG_varsel1    begsr
9.01  *
9.01 c                   eval      w_mld1 = 'Du kan kun kopiere  +
9.01 c                                       egne eller felles pri+
9.01 c                                       sgrupper.'
9.01 c                   call      'AA005R'
9.01 c                   parm                    w_mld1
9.01  *
9.01 c                   endsr
9.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
9.01  * Varsel vedr styring av vedlikehold av prisgruppe
9.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
9.01  *
9.01 c     PG_varsel2    begsr
9.01  *
9.01 c                   eval      w_mld1 = 'Du kan kun +
9.01 c                                       endre/slette egne +
9.01 c                                       prisgrupper'
9.01 c                   call      'AA005R'
9.01 c                   parm                    w_mld1
9.01  *
9.01 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
6.20  * Key for oppslag på leverandør
6.20  *
6.20 c     rlevl1_key    klist
6.20 c                   kfld                    w_firm
6.20 c                   kfld                    rlevl1_levr
6.20  *
6.20  * Key for oppslag på overgruppe
6.20  *
6.20 c     vogrl1_key    klist
6.20 c                   kfld                    w_firm
6.20 c                   kfld                    vogrl1_oogr
6.20  *
6.20  * Key for oppslag på hovedgruppe
6.20  *
6.20 c     vhgrl1_key    klist
6.20 c                   kfld                    w_firm
6.20 c                   kfld                    vhgrl1_hogr
6.20 c                   kfld                    vhgrl1_hhgr
6.20  *
6.20  * Key for oppslag på undergruppe
6.20  *
6.20 c     vugrl1_key    klist
6.20 c                   kfld                    w_firm
6.20 c                   kfld                    vugrl1_uogr
6.20 c                   kfld                    vugrl1_uhgr
6.20 c                   kfld                    vugrl1_uugr
      *
      * Key for oppslag på tilbudspriser
      *
     c     vpfoir_key    klist
     c                   kfld                    w_firm
5.70 c                   kfld                    vpfoir_fprg
     c                   kfld                    vpfoir_fvar
     c                   kfld                    vpfoir_ffda
     c                   kfld                    vpfoir_ftda
      *
      * Key for oppdatering av tilbudspriser
      *
     c     vpfoiu_key    klist
     c                   kfld                    w_firm
6.20 c                   kfld                    vpfoiu_fprg
     c                   kfld                    vpfoiu_fvar
     c                   kfld                    vpfoiu_ffda
     c                   kfld                    vpfoiu_ftda
     c
      * Key for oppslag på vare
      *
     c     vvarl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl1_fvar
      * Key for oppslag på vare
      *
     c     jvarl1_key    klist
     c                   kfld                    jvarl1_vare

5.70  *
5.70  * Key for oppslag på prisgruppe
5.70  *
5.70 c     ra30l1_key    klist
5.70 c                   kfld                    w_firm
5.70 c                   kfld                    ra30l1_dkod
      *
      * Key for oppslag på vare-enhet
      *
     c     vvenl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvenl1_vare
     c                   kfld                    vvenl1_enhe
9.01  *
9.01  * Key for oppslag på bruker
9.01  *
9.01 c     fusrl1_key    klist
9.01 c                   kfld                    w_firm
9.01 c                   kfld                    fusrl1_user
      *
      *
      * Henter firmanummer fra LDA
      *
     c                   eval      w_firm = l_firm
6.22 c                   eval      w_lagr = l_lagr
9.01  *
9.01  * Henter prisgruppe
9.01  *
9.01 c                   call      'VL711R   '
9.01 c                   parm                    w_fprgx
9.01  *
9.01  * Henter opplysninger fra ofak bruker
9.01  *
9.01 c                   eval      fusrl1_user = l_user
9.01 c     fusrl1_key    chain     fusrl1
9.01 c                   if        fbko19 = 1
9.01 c                   eval      b_mast = *on
9.01 c                   endif
9.01  *
6.21  *
6.21  * Hent mva % for beregning av tilbudspris inkl. mva
6.21  *
6.21 c                   eval      w_stat = *blank
6.21 c                   eval      w_mvak = '3'
6.21 c                   time                    w_date
6.21  *
6.21 c                   call      'RS205R'
6.21 c                   parm                    w_stat
6.21 c                   parm                    w_mvak
6.21 c                   parm                    w_mvtx
6.21 c                   parm                    w_date
6.21 c                   parm                    w_mvas
6.21 c                   parm                    w_mvat
6.21 c                   parm                    w_mvaf
6.21 c                   parm                    w_bpro
      *
      *
      * Initierer skjermbilde
      *
     c                   eval      *in22 = *on
      *
      * Henter dages dato
      *
     c                   time                    w_udat
      *
      * Posisjonerer databasen, og fyller opp subfile
     c                   eval      s_fvar = *blank
     c                   eval      b_open_sok = *on
      *
     c                   exsr      crt_subfile
      *
     c                   endsr
