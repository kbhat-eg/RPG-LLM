     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : FR604R
      * Beskrivelse . . : Rabattmatrise, utskrift av kryssreferanse
      *                   Rapport som inneholder kryssreferanse mellom
      *                   rabattkategori og varegruppe
      *
      *                   Programmet er begrenset til å håndtere 24
      *                   rabattkategorier
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       220999 HKO  Nytt program
      *       200300 HKO  Lagt inn leverandør som nivå i rabattmatrisen
      *       180204 HKO  Kryssreferanse mellom rabattkategori og varegruppe
      *                   Lagt inn valg av rabattkategori
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fra06pf    if   e           k disk    rename(ra06pfr:ra06pfr)
     fvogrl1    if   e           k disk    rename(vogrpfr:vogrl1r)
     fvhgrl1    if   e           k disk    rename(vhgrpfr:vhgrl1r)
     fvugrl1    if   e           k disk    rename(vugrpfr:vugrl1r)
     ffrabl5    if   e           k disk    rename(frabpfr:frabl5r)
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
      *
     ffr604p    o    e             printer
      *
      * Definering av parametre
      *
     d p_list          s             16
      *
      * Definering av arrayer
      *
     d a_rkat          s              3  0 dim(24) perrcd(1) ctdata              Array søketekst
     d a_rab1          s              4  2 dim(24) perrcd(1) ctdata              Array søketekst
     d a_rab2          s              4  2 dim(24) perrcd(1) ctdata              Array søketekst
     d a_rabn          s              4  2 dim(24) perrcd(1) ctdata              Array søketekst
     d a_rabb          s              4  2 dim(24) perrcd(1) ctdata              Array søketekst
     d a_rabt          s              4  2 dim(24) perrcd(1) ctdata              Array søketekst
     d a_dekn          s              4  2 dim(24) perrcd(1) ctdata              Array søketekst
      *
      * Definering av LDA
      *
     d                uds
     d l_wsid                901    910
     d l_user                911    920
      *
      * Datastruktur for parameterliste -inn
      *
     d                 ds
     d d_list                        16
     d  d_firm                        3  0 overlay(d_list: 1)
     d  d_rkaf                        3  0 overlay(d_list: 4)
     d  d_rkat                        3  0 overlay(d_list: 7)
      *
      * Definering av variable i nøkler
      *
     d vogrl1_oogr     s                   like(vgoogr)
     d vhgrl1_hogr     s                   like(vghogr)
     d vhgrl1_hhgr     s                   like(vghhgr)
     d vugrl1_uogr     s                   like(vguogr)
     d vugrl1_uhgr     s                   like(vguhgr)
     d vugrl1_uugr     s                   like(vguugr)
      *
      * Definering av variable
      *
     d b_fØrste        s              1    inz(*on)
     d b_oflw          s              1    inz(*off)
      *
     d x               s              2  0
     d w_utim          s              6  0
     d w_sum1          s              4  0
     d w_sum2          s              4  0
     d w_sumn          s              4  0
     d w_sumb          s              4  0
     d w_sumt          s              4  0
     d w_sumd          s              4  0
      *
     d w_firm          s                   like(frfirm)
      *
     d s_ogrp          s                   like(frogrp)
     d s_hgrp          s                   like(frhgrp)
     d s_ugrp          s                   like(frugrp)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Fyller opp array for rabattkategori (x-akse)
      *
     c                   eval      x = 0
      *
     c     ra06pf_key    setll     ra06pf
     c     ra06pf_key    reade     ra06pf
     c                   dow       not %eof
      *
     c                   if        rafkod = 0 or
     c                             d_rkaf <> 0 and
     c                             rafkod < d_rkaf or
     c                             d_rkat <> 0 and
     c                             rafkod > d_rkat
     c                   goto      les_neste
     c                   endif
      *
     c                   eval      x = x + 1
     c                   if        x > 24
     c                   leave
     c                   endif
      *
     c                   eval      a_rkat(x) = rafkod
      *
     c     les_neste     tag
      *
     c     ra06pf_key    reade     ra06pf
     c                   enddo
      *
      * Skriver Header
      *
     c                   exsr      hode
      *
      * Leser rabattmatrise, og skriver detaljlinjer
      *
     c     frabl5_key    setll     frabl5
     c     frabl5_key    reade     frabl5
     c                   dow       not %eof
      *
     c                   if        frrkat <> 0 and
     c                             frogrp <> 0 and
     c                             frenhe = *blank and
     c                             frlety = 0
      *
     c                   if        b_fØrste = *off
     c                   if        frogrp <> s_ogrp or
     c                             frhgrp <> s_hgrp or
     c                             frugrp <> s_ugrp
     c                   exsr      detalj
     c                   endif
     c                   endif
      *
     c                   exsr      utplukk
      *
     c                   eval      b_fØrste = *off
     c                   eval      s_ogrp = frogrp
     c                   eval      s_hgrp = frhgrp
     c                   eval      s_ugrp = frugrp
      *
     c                   endif
      *
     c     frabl5_key    reade     frabl5
     c                   enddo
      *
     c                   if        b_fØrste = *off and
     c                             frrkat <> 0 and
     c                             frogrp <> 0
     c                   if        frogrp <> s_ogrp or
     c                             frhgrp <> s_hgrp or
     c                             frugrp <> s_ugrp
     c                   exsr      detalj
     c                   endif
     c                   endif
      *
      * Avslutter program
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering og utskrift av hode-opplysninger
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hode          begsr
      *
      * Legger inn arb.stasjon og bruker i faste felter
      *
     c                   eval      a1firm = w_firm
     c                   eval      a1user = l_user
     c                   eval      a1wsid = l_wsid
     c                   eval      a1date = udate
      *
     c                   time                    w_utim
     c                   eval      a1time = w_utim
      *
      * Henter firmaopplysninger
      *
     c     afirl1_key    chain     afirl1r                            90
     c                   eval      a1fnav = aafnav
      *
      * Henter overskrift
      *
     c                   eval      a1rkat1 = a_rkat(1)
     c                   eval      a1rkat2 = a_rkat(2)
     c                   eval      a1rkat3 = a_rkat(3)
     c                   eval      a1rkat4 = a_rkat(4)
     c                   eval      a1rkat5 = a_rkat(5)
     c                   eval      a1rkat6 = a_rkat(6)
     c                   eval      a1rkat7 = a_rkat(7)
     c                   eval      a1rkat8 = a_rkat(8)
     c                   eval      a1rkat9 = a_rkat(9)
     c                   eval      a1rkat10 = a_rkat(10)
     c                   eval      a1rkat11 = a_rkat(11)
     c                   eval      a1rkat12 = a_rkat(12)
     c                   eval      a1rkat13 = a_rkat(13)
     c                   eval      a1rkat14 = a_rkat(14)
     c                   eval      a1rkat15 = a_rkat(15)
     c                   eval      a1rkat16 = a_rkat(16)
     c                   eval      a1rkat17 = a_rkat(17)
     c                   eval      a1rkat18 = a_rkat(18)
     c                   eval      a1rkat19 = a_rkat(19)
     c                   eval      a1rkat20 = a_rkat(20)
     c                   eval      a1rkat21 = a_rkat(21)
     c                   eval      a1rkat22 = a_rkat(22)
     c                   eval      a1rkat23 = a_rkat(23)
     c                   eval      a1rkat24 = a_rkat(24)
      *
      * Skriver heading
      *
     c                   write     a1hdr
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for utplukk til array
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     utplukk       begsr
      *
      * Finner posisjon i X-aksen (rabattkategori)
      *
     c                   eval      x = 1
     c     frrkat        lookup    a_rkat(x)                              90
     c                   if        *in90 = *off
     c                   leavesr
     c                   endif
      *
      * Fyller X-aksen med rabatt-1, rabatt-2, rabatt-N, rabatt-T og
      * dekningsgrad
      *
     c                   eval      a_rab1(x) = frrab1
     c                   eval      a_rab2(x) = frrab2
     c                   eval      a_rabn(x) = frrabn
     c                   eval      a_rabb(x) = frrabb
     c                   eval      a_rabt(x) = frrabt
      *
     c                   if        frdekn = 100
     c                   eval      a_dekn(x) = 99,99
     c                   else
     c                   eval      a_dekn(x) = frdekn
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for utplukk og utskrift av detaljlinje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     detalj        begsr
      *
     c                   xfoot     a_rab1        w_sum1
     c                   xfoot     a_rab2        w_sum2
     c                   xfoot     a_rabn        w_sumn
     c                   xfoot     a_rabb        w_sumb
     c                   xfoot     a_rabt        w_sumt
     c                   xfoot     a_dekn        w_sumd
      *
     c                   if        w_sum1 = 0 and
     c                             w_sum2 = 0 and
     c                             w_sumn = 0 and
     c                             w_sumb = 0 and
     c                             w_sumt = 0 and
     c                             w_sumd = 0
     c                   leavesr
     c                   endif
      *
      * Fyller beskrivelseslinje med varegruppe-informasjon
      *
     c                   eval      d1ogrp = s_ogrp
     c                   eval      d1hgrp = s_hgrp
     c                   eval      d1ugrp = s_ugrp
     c                   eval      d1besk = *blank
      *
     c                   select
     c                   when      d1ugrp <> 0
     c                   eval      vugrl1_uogr = s_ogrp
     c                   eval      vugrl1_uhgr = s_hgrp
     c                   eval      vugrl1_uugr = s_ugrp
     c     vugrl1_key    chain     vugrl1
     c                   if        %found
     c                   eval      d1besk = vgutxt
     c                   endif
     c                   when      d1hgrp <> 0
     c                   eval      vhgrl1_hogr = s_ogrp
     c                   eval      vhgrl1_hhgr = s_hgrp
     c     vhgrl1_key    chain     vhgrl1
     c                   if        %found
     c                   eval      d1besk = vghtxt
     c                   endif
     c                   other
     c                   eval      vogrl1_oogr = s_ogrp
     c     vogrl1_key    chain     vogrl1
     c                   if        %found
     c                   eval      d1besk = vgotxt
     c                   endif
     c                   endsl
      *
      * Skriver beskrivelseslinje
      *
     c                   write     d1dtl                                30
     c                   eval      b_oflw = *off
     c                   if        *in30 = *on
     c                   eval      b_oflw = *on
     c                   endif
      *
      * Skriver ut detaljlinjer for rabatt-1
      *
     c                   if        w_sum1 <> 0
      *
     c                   eval      d1rab_txt = 'Rabatt-1:'
      *
     c                   eval      d1rab1  = a_rab1(1)
     c                   eval      d1rab2  = a_rab1(2)
     c                   eval      d1rab3  = a_rab1(3)
     c                   eval      d1rab4  = a_rab1(4)
     c                   eval      d1rab5  = a_rab1(5)
     c                   eval      d1rab6  = a_rab1(6)
     c                   eval      d1rab7  = a_rab1(7)
     c                   eval      d1rab8  = a_rab1(8)
     c                   eval      d1rab9  = a_rab1(9)
     c                   eval      d1rab10 = a_rab1(10)
     c                   eval      d1rab11 = a_rab1(11)
     c                   eval      d1rab12 = a_rab1(12)
     c                   eval      d1rab13 = a_rab1(13)
     c                   eval      d1rab14 = a_rab1(14)
     c                   eval      d1rab15 = a_rab1(15)
     c                   eval      d1rab16 = a_rab1(16)
     c                   eval      d1rab17 = a_rab1(17)
     c                   eval      d1rab18 = a_rab1(18)
     c                   eval      d1rab19 = a_rab1(19)
     c                   eval      d1rab20 = a_rab1(20)
     c                   eval      d1rab21 = a_rab1(21)
     c                   eval      d1rab22 = a_rab1(22)
     c                   eval      d1rab23 = a_rab1(23)
     c                   eval      d1rab24 = a_rab1(24)
      *
     c                   write     d1dtl_rab                            30
     c                   exsr      overflow
      *
     c                   endif
      *
      * Skriver ut detaljlinjer for rabatt-2
      *
     c                   if        w_sum2 <> 0
      *
     c                   eval      d1rab_txt = 'Rabatt-2:'
      *
     c                   eval      d1rab1  = a_rab2(1)
     c                   eval      d1rab2  = a_rab2(2)
     c                   eval      d1rab3  = a_rab2(3)
     c                   eval      d1rab4  = a_rab2(4)
     c                   eval      d1rab5  = a_rab2(5)
     c                   eval      d1rab6  = a_rab2(6)
     c                   eval      d1rab7  = a_rab2(7)
     c                   eval      d1rab8  = a_rab2(8)
     c                   eval      d1rab9  = a_rab2(9)
     c                   eval      d1rab10 = a_rab2(10)
     c                   eval      d1rab11 = a_rab2(11)
     c                   eval      d1rab12 = a_rab2(12)
     c                   eval      d1rab13 = a_rab2(13)
     c                   eval      d1rab14 = a_rab2(14)
     c                   eval      d1rab15 = a_rab2(15)
     c                   eval      d1rab16 = a_rab2(16)
     c                   eval      d1rab17 = a_rab2(17)
     c                   eval      d1rab18 = a_rab2(18)
     c                   eval      d1rab19 = a_rab2(19)
     c                   eval      d1rab20 = a_rab2(20)
     c                   eval      d1rab21 = a_rab2(21)
     c                   eval      d1rab22 = a_rab2(22)
     c                   eval      d1rab23 = a_rab2(23)
     c                   eval      d1rab24 = a_rab2(24)
      *
     c                   write     d1dtl_rab                            30
     c                   exsr      overflow
      *
     c                   endif
      *
      * Skriver ut detaljlinjer for rabatt-N
      *
     c                   if        w_sumn <> 0
      *
     c                   eval      d1rab_txt = 'Rabatt-N:'
      *
     c                   eval      d1rab1  = a_rabn(1)
     c                   eval      d1rab2  = a_rabn(2)
     c                   eval      d1rab3  = a_rabn(3)
     c                   eval      d1rab4  = a_rabn(4)
     c                   eval      d1rab5  = a_rabn(5)
     c                   eval      d1rab6  = a_rabn(6)
     c                   eval      d1rab7  = a_rabn(7)
     c                   eval      d1rab8  = a_rabn(8)
     c                   eval      d1rab9  = a_rabn(9)
     c                   eval      d1rab10 = a_rabn(10)
     c                   eval      d1rab11 = a_rabn(11)
     c                   eval      d1rab12 = a_rabn(12)
     c                   eval      d1rab13 = a_rabn(13)
     c                   eval      d1rab14 = a_rabn(14)
     c                   eval      d1rab15 = a_rabn(15)
     c                   eval      d1rab16 = a_rabn(16)
     c                   eval      d1rab17 = a_rabn(17)
     c                   eval      d1rab18 = a_rabn(18)
     c                   eval      d1rab19 = a_rabn(19)
     c                   eval      d1rab20 = a_rabn(20)
     c                   eval      d1rab21 = a_rabn(21)
     c                   eval      d1rab22 = a_rabn(22)
     c                   eval      d1rab23 = a_rabn(23)
     c                   eval      d1rab24 = a_rabn(24)
      *
     c                   write     d1dtl_rab                            30
     c                   exsr      overflow
      *
     c                   endif
      *
      * Skriver ut detaljlinjer for rabatt-B
      *
     c                   if        w_sumb <> 0
      *
     c                   eval      d1rab_txt = 'Rabatt-B:'
      *
     c                   eval      d1rab1  = a_rabb(1)
     c                   eval      d1rab2  = a_rabb(2)
     c                   eval      d1rab3  = a_rabb(3)
     c                   eval      d1rab4  = a_rabb(4)
     c                   eval      d1rab5  = a_rabb(5)
     c                   eval      d1rab6  = a_rabb(6)
     c                   eval      d1rab7  = a_rabb(7)
     c                   eval      d1rab8  = a_rabb(8)
     c                   eval      d1rab9  = a_rabb(9)
     c                   eval      d1rab10 = a_rabb(10)
     c                   eval      d1rab11 = a_rabb(11)
     c                   eval      d1rab12 = a_rabb(12)
     c                   eval      d1rab13 = a_rabb(13)
     c                   eval      d1rab14 = a_rabb(14)
     c                   eval      d1rab15 = a_rabb(15)
     c                   eval      d1rab16 = a_rabb(16)
     c                   eval      d1rab17 = a_rabb(17)
     c                   eval      d1rab18 = a_rabb(18)
     c                   eval      d1rab19 = a_rabb(19)
     c                   eval      d1rab20 = a_rabb(20)
     c                   eval      d1rab21 = a_rabb(21)
     c                   eval      d1rab22 = a_rabb(22)
     c                   eval      d1rab23 = a_rabb(23)
     c                   eval      d1rab24 = a_rabb(24)
      *
     c                   write     d1dtl_rab                            30
     c                   exsr      overflow
      *
     c                   endif
      *
      * Skriver ut detaljlinjer for rabatt-T
      *
     c                   if        w_sumt <> 0
      *
     c                   eval      d1rab_txt = 'Rabatt-T:'
      *
     c                   eval      d1rab1  = a_rabt(1)
     c                   eval      d1rab2  = a_rabt(2)
     c                   eval      d1rab3  = a_rabt(3)
     c                   eval      d1rab4  = a_rabt(4)
     c                   eval      d1rab5  = a_rabt(5)
     c                   eval      d1rab6  = a_rabt(6)
     c                   eval      d1rab7  = a_rabt(7)
     c                   eval      d1rab8  = a_rabt(8)
     c                   eval      d1rab9  = a_rabt(9)
     c                   eval      d1rab10 = a_rabt(10)
     c                   eval      d1rab11 = a_rabt(11)
     c                   eval      d1rab12 = a_rabt(12)
     c                   eval      d1rab13 = a_rabt(13)
     c                   eval      d1rab14 = a_rabt(14)
     c                   eval      d1rab15 = a_rabt(15)
     c                   eval      d1rab16 = a_rabt(16)
     c                   eval      d1rab17 = a_rabt(17)
     c                   eval      d1rab18 = a_rabt(18)
     c                   eval      d1rab19 = a_rabt(19)
     c                   eval      d1rab20 = a_rabt(20)
     c                   eval      d1rab21 = a_rabt(21)
     c                   eval      d1rab22 = a_rabt(22)
     c                   eval      d1rab23 = a_rabt(23)
     c                   eval      d1rab24 = a_rabt(24)
      *
     c                   write     d1dtl_rab                            30
     c                   exsr      overflow
      *
     c                   endif
      *
      * Skriver ut detaljlinjer for dekningsgrad
      *
     c                   if        w_sumd <> 0
      *
     c                   eval      d1rab_txt = 'DG......:'
      *
     c                   eval      d1rab1  = a_dekn(1)
     c                   eval      d1rab2  = a_dekn(2)
     c                   eval      d1rab3  = a_dekn(3)
     c                   eval      d1rab4  = a_dekn(4)
     c                   eval      d1rab5  = a_dekn(5)
     c                   eval      d1rab6  = a_dekn(6)
     c                   eval      d1rab7  = a_dekn(7)
     c                   eval      d1rab8  = a_dekn(8)
     c                   eval      d1rab9  = a_dekn(9)
     c                   eval      d1rab10 = a_dekn(10)
     c                   eval      d1rab11 = a_dekn(11)
     c                   eval      d1rab12 = a_dekn(12)
     c                   eval      d1rab13 = a_dekn(13)
     c                   eval      d1rab14 = a_dekn(14)
     c                   eval      d1rab15 = a_dekn(15)
     c                   eval      d1rab16 = a_dekn(16)
     c                   eval      d1rab17 = a_dekn(17)
     c                   eval      d1rab18 = a_dekn(18)
     c                   eval      d1rab19 = a_dekn(19)
     c                   eval      d1rab20 = a_dekn(20)
     c                   eval      d1rab21 = a_dekn(21)
     c                   eval      d1rab22 = a_dekn(22)
     c                   eval      d1rab23 = a_dekn(23)
     c                   eval      d1rab24 = a_dekn(24)
      *
     c                   write     d1dtl_rab                            30
     c                   exsr      overflow
      *
     c                   endif
      *
      * Tømmer arrayer
      *
     c                   eval      a_rab1 = 0
     c                   eval      a_rab2 = 0
     c                   eval      a_rabn = 0
     c                   eval      a_rabb = 0
     c                   eval      a_rabt = 0
     c                   eval      a_dekn = 0
      *
     c     end_detalj    endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for overflow
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     overflow      begsr
      *
     c                   if        *in30 = *on or
     c                             b_oflw = *on
     c                   write     a1hdr
     c                   eval      b_oflw = *off
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Paramtre
      *
     c     *entry        plist
     c                   parm                    p_list
      *
      * Key for les på rabattkategori
      *
     c     ra06pf_key    klist
     c                   kfld                    w_firm
      *
      * Key for les på rabattmatriste
      *
     c     frabl5_key    klist
     c                   kfld                    w_firm
      *
      * Key for les på firma
      *
     c     afirl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på overgruppe
      *
     c     vogrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vogrl1_oogr
      *
      * Key for oppslag på hovedgruppe
      *
     c     vhgrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vhgrl1_hogr
     c                   kfld                    vhgrl1_hhgr
      *
      * Key for oppslag på undergruppe
      *
     c     vugrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vugrl1_uogr
     c                   kfld                    vugrl1_uhgr
     c                   kfld                    vugrl1_uugr
      *
      *
      * Flytter parameter til datasturuktur
      *
     c                   eval      d_list = p_list
      *
      * Henter firma fra datastruktur
      *
     c                   eval      w_firm = d_firm
      *
     c                   endsr
