# RPG Program LP100R: Explanation and Program Walkthrough

This document explains the ILE RPG program LP100R, focusing on its structure, key logic, and how it manages supplier distribution lists (leverandør distribusjonsliste) and their maintenance. It is designed to ease onboarding for new developers.

---

## 1. Purpose and High-level Function

**LP100R** is a maintenance program for supplier distribution lists. It manages the creation, updating, inquiry/viewing, copying, and deletion of supplier distribution records, primarily interacting with subfiles (display files for handling multiple records on-screen).

---

## 2. Structure Overview

### - Header & Documentation

- `h option(*nodebugio) datedit(*dmy)`: program options, date format.
- Extensive comments provide a changelog and usage notes (in Norwegian).

### - File Declarations (`F-Specs`)

Different physical and logical files are defined for input, update, etc., such as:
- `lldilr`, `lldil1`, `lldilu`, etc.: Supplier distribution master.
- `rlevl1`: Supplier master for name lookup.
- `votyl1`: (From 6.20) Order type validation.
- `lp100d`: Workstation file with subfile support (`sfile(b1sfl:w_srrn)`).

### - Data Definitions (`D-Specs`)

Defines variables for working storage, keys, and subfile record handling:
- Subfile record variables (`w_srrn`, `w_spge`, etc.).
- Work fields for supplier, warehouse, type, format, recipient, etc.
- Arrays, local data area fields (user, firm, etc.).
- Constants, e.g., `c_sfil` for subfile page size.

### - Indicator Usage

Classic RPG uses indicators (`*INxx`). The comments document their usage (e.g., `*IN10` for Roll, `*IN30` for protecting fields).

---

## 3. Key Functionality and Flow

### A. Main Loop

The main interactive logic is built around a loop/dispatcher handling function keys (like F3=Exit, F4=Prompt, F6=Create, etc.).  
It controls the program’s flow using a combination of `select/when` and gotos to labeled tags.

**Key Operations:**
- **Display and refresh subfile**: Show lists, handle paging.
- **Create, Change, Copy, Delete, View records**: Each function is routed to a dedicated subroutine.
- **Positioning**: Allows direct navigation to a supplier by number.
- **Validation**: Extensive checks on required keys and field combinations.
- **Subfile processing**: Handles screen-to-database synchronization.

### B. Subfile Management

A subfile is a temporary list on the display that can show, edit, and manipulate multiple records at once.
- `clr_subfile`: Clears the subfile.
- `crt_subfile`: Fills the subfile page.
- `subfile`: Processes user actions on subfile rows (edit, copy, delete, view).

### C. CRUD and Supporting Routines

#### Create New Record (`xc1bld`)
- Displays entry screen.
- Validates input, checks for existing records (prevents duplicates unless copying).
- Calls update logic (`xc2bld`).

#### Edit/View Record (`xc2bld`)
- Loads the record, sets up fields for maintenance.
- Handles special combinations/validations according to business rules.
- Updates or writes the record back.

#### Copy Record (`xk1win`)
- Loads a source record into a copy dialog.
- Validates and then triggers new record creation.

#### Delete Record (`xd1win`)
- Shows a confirmation window, then deletes the record from both primary and NEB (EDI info) tables.

### D. Prompting (Lookup) Windows

When the user presses specific function keys:
- Calls external programs to select suppliers, warehouses, order types, etc.
- Returns values for population in the screen fields.

### E. Hardcoded Value Lookup Windows

- Several windows (F1WIN) present lists of valid hardcoded values (type, form, recipient) for lookup and selection.

### F. Support Routines

- `hent_lag`: Fetches warehouse info, handles invalid codes.
- `hnt_neb`: Retrieves NEB (EDI-related) info for the record.

---

## 4. Notable Business Rules and Validations

- **Key fields must be present** (supplier number, warehouse code).
- **Combos of type/form/recipient validated** against a hardcoded set of legal combinations (FTP, EDI, NORGROS, etc).
- **Order type and order info** codes are validated against their respective lookup files.
- **Copying and creation prevent overwriting unless confirmed by the user.**
- **Formatting**: Special handling ensures warehouse field is always two digits (e.g., leading zero).

---

## 5. External Program Calls

- `RL500R`: Used for supplier lookup.
- `RA510R`: Used for warehouse lookup.
- `VA550R`: Used for order type lookup.
- `VA540R`: Used for order info type lookup.
- `FØ720R`: Used for fetching warehouse details.
- `AF100C`: FTP processing.

These facilitate lookup or maintenance actions, populating relevant fields on the screens.

---

## 6. Subfile & Screen Notes

### Subfile Variables

- `w_srrn`, `w_spge`, `w_sfrn`, `w_ssrn`: Manage subfile paging, current/first/last record on page.
- `b1sfl`: Subfile record format.
- `b2ctl`: Subfile control format.

### Screens/Windows

- Various formats (`B1SFL`, `C1BLD`, `C2BLD`, `D1WIN`, `F1WIN`, etc.) handle create, edit, delete, copy, and prompt dialogs.

---

## 7. Program Initialization (`*inzsr`)

- Initializes key lists for file access.
- Copies current firm number into working storage.
- Optionally sets a user flag for special logic via a call to `CO402R`.
- Positions the database and pre-loads the first subfile page.

---

## 8. RPG Style and Modernization

- Classic fixed-form RPG with some free format (`dcl-s`, `DCL-PR`).
- Heavy use of indicators, tags, and gotos.
- Code is well-structured with clear comments and logical separation by subroutine.

---

## 9. Version-Specific Enhancements

- Marked by e.g., `6.10`, `6.20`, `8.01` - each denotes changes for added features or bugfixes (e.g., NEB, new formats, validations).

---

## 10. Key Takeaways for Onboarding

- **Understanding subfiles** and how user actions map to database operations is critical.
- **Indicator usage** maps to screen fields, flow control, and error highlighting.
- **Validation logic** is both hardcoded and table-driven.
- **External calls** handle most lookup (prompt) dialogs.
- **Pay special attention to version comments** for areas with business rule changes.

---

## 11. Example Use Cases

1. **User wants to add a new supplier distribution**:
   - F6 triggers `xc1bld` for creation; fields are validated, and record is written if valid and unique.

2. **User wants to change a record**:
   - Selects from subfile (val = 2), triggers `xc2bld`, edits fields, updates record.

3. **User wants to delete**:
   - Selects Delete (val = 4), triggers confirmation window, record(s) deleted if confirmed.

4. **User wants to copy**:
   - Selects Copy (val = 3), brings up `xk1win`, target info entered, new record created as a copy.

5. **User wants to look up valid values** (type, format, recipient, etc.):
   - F4 or equivalent on a field brings up hardcoded or programmatic value lookup.

---

## 12. Final Notes

- This program is a core part of supplier EDI/distribution configuration.
- Maintenance and enhancements are tracked by detailed header changelogs.
- The program is highly interactive, and understanding the screen flow (DSPF) and subfile logic is essential.

For efficient onboarding:
- Get familiar with the subfile workflow and indicator mapping.
- Refer to the version comments when troubleshooting or enhancing related business logic.
- Use the external program calls as entry points for investigating lookup and value prompt logic.

---

**End of Explanation**