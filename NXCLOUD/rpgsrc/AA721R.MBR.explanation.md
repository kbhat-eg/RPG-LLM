# Program Documentation: AA721R

## Overview

**Program Name:** AA721R  
**System:** ASPGPL  
**Description:**  
This program manages user interactions for selecting a printer or output queue (utk√∏) within the system. It presents a workstation display to the user, processes their input, and performs validation or defaulting logic based on the type of selection (printer, output queue, or printer control actions). The program is typically invoked as part of a larger workflow that requires user selection of print resources or administrative printer actions.

---

## Structure and Flow

### 1. File Declaration

```rpg
faa721d    cf   e             workstn
```
- **faa721d** is defined as a workstation file, which is used for user interaction (display/input).

---

### 2. Parameter Definitions

```rpg
d p_pf03          s              1
d p_prid          s             10
d p_type          s              1
```
- **p_pf03**: Exit indicator (set if user presses F3).
- **p_prid**: Printer or output queue identifier (10 characters).
- **p_type**: Type of operation (single character, values: '5', '6', '8', '9').

---

### 3. Working Variable

```rpg
d w_sjek          s              1
```
- **w_sjek**: Used as a status or validation flag, especially when validating printer operations.

---

### 4. Main Input Handling (Tag: a1taga)

#### User Interaction

- The program displays a screen (`exfmt a1bld`) and waits for user input.
- Resets `p_pf03` and `w_sjek` before each display.

#### Exit Handling

```rpg
if *inkc = *on
   eval p_pf03 = '1'
   goto xslutt
endif
```
- If the user presses F3 (function key C), set `p_pf03` to '1' and exit.

#### Input Assignment

```rpg
eval p_prid = a1prid
```
- Assigns input field `a1prid` (from display file) to `p_prid`.

---

### 5. Business Logic by Type

#### a. Printer Selection (`p_type = '5'`)

```rpg
if p_type = '5'
   if p_prid = *blank
      eval p_prid = '*PRT'
   endif
endif
```
- If the type is printer and no printer is entered, default to `*PRT` (likely the system default printer).

#### b. Output Queue Selection (`p_type = '6'`)

```rpg
if p_type = '6'
   if p_prid = *blank
      eval p_prid = '*ALL'
   endif
endif
```
- If the type is output queue and no queue is entered, default to `*ALL` (all output queues).

#### c. Printer Start/Stop (`p_type = '8'` or `'9'`)

```rpg
if p_type = '8' or p_type = '9'
   if p_prid <> *blank
      eval w_sjek = *blank
      call 'AQPRTC'
      parm w_sjek
      parm p_prid
      if w_sjek <> *blank
         eval *in31 = *on
         goto a1taga
      endif
   endif
endif
```
- If the type is to start or stop a printer, and a printer is specified:
    - Calls program `AQPRTC` (printer control checker) with parameters `w_sjek` and `p_prid`.
    - If `w_sjek` is not blank after the call, an error or special condition occurred. Indicator 31 is set (likely to display an error message on the screen), and the input panel is redisplayed.

---

### 6. Program Exit (Tag: xslutt)

```rpg
eval *inlr = *on
return
```
- Sets the last record indicator to end the program cleanly.

---

### 7. Initialization Subroutine (*inzsr)

#### Parameter List Setup

```rpg
*entry plist
parm p_pf03
parm p_prid
parm p_type
```
- Parameters are received from the caller: exit indicator, printer/output queue ID, and operation type.

---

## Domain/Business-Specific Logic

- **Printer/Output Queue Handling:**  
  The program distinguishes between printers and output queues using `p_type`. It applies sensible defaults (`*PRT` for printers, `*ALL` for output queues) when no specific resource is entered.

- **Printer Control Validation:**  
  For start/stop actions, the program validates the existence or state of the printer by calling `AQPRTC`. If validation fails, the user is prompted again.

---

## Interactions with Other Components

- **Display File (`faa721d`):**  
  Used to present the interface and receive user input. The record format `a1bld` is referenced for display.

- **External Program (`AQPRTC`):**  
  Called for printer validation during start/stop actions. Returns status in `w_sjek`.

- **Calling Program:**  
  Receives and returns parameters for further processing based on user selection.

---

## Notable Design Conventions

- **Use of GOTO and Tags:**  
  The code uses tags (`a1taga`, `xslutt`) and `goto` for control flow, a common pattern in legacy RPG for handling repeated input or error recovery.

- **Indicator Usage:**  
  Function key and error indicators (`*inkc`, `*in31`) are used for user input handling and error signaling.

- **Parameter Passing:**  
  The program is designed to be called with parameters and to return status and user selections to the caller.

---

## Summary

AA721R is a user interaction module for selecting and validating printers or output queues, as well as handling printer control actions. It enforces business rules for defaulting and validation, and integrates with external modules for printer validation. The program follows established conventions for error handling and user prompting within the context of the ASPGPL system.