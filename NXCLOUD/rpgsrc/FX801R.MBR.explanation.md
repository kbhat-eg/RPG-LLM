# Program FX801R: Fjerner slettede varer fra lager-register

This RPG program is designed to clean up the inventory register by removing entries related to deleted items. It operates within the **ASOFAK** system, specifically tailored to maintain the integrity of stock data by ensuring that obsolete or deleted stock items are purged from the stock register.

## Purpose and Business Domain Context

In the business domain, inventory management systems often need periodic cleanup routines to prevent stale or invalid data from affecting stock calculations, reporting, or downstream processes. This program automates the removal of inventory entries associated with items marked as deleted, ensuring that the stock register reflects only active items.

## Program Structure Overview

The program follows a typical RPG cycle with an initialization subroutine, a main processing loop, and cleanup logic:

1. **Initialization (`*inzsr`)**: Sets up key lists used for efficient data access.
2. **Main Processing Loop**:
   - Reads entries from the stock register (`vlagl1`).
   - For each stock item, attempts to locate the corresponding item record (`vvarl1`) to determine if it is marked as deleted.
   - If the item is found and identified as deleted, the corresponding stock record is deleted from the register (`vlaglur`).
3. **Cleanup and Termination**:
   - Ends the main loop and program, setting the last indicator (`*inlr`) to signal proper cleanup.

## Data Areas and Variables

- **Local Data Area (`l_firm`)**: Stores the current firm or company code, used to filter records.
- **Key Variables**:
  - `vlagl1_key`, `vvarl1_key`, `vlaglu_key`: Key lists for accessing stock register, item master data, and stock updates respectively.
  - `vvarl1_vare`, `vlaglu_vare`: Variables holding item identifiers during processing.
  - `w_firm`: Holds the current firm code, initialized from the local data area.

## Data Access Patterns

- **Setll / Reade**: Used to locate records in the stock register (`vlagl1`) and item master (`vvarl1`) based on keys.
- **Chain**: Retrieves detailed item data to check if an item is marked as deleted.
- **Delete**: Removes stock register entries (`vlaglur`) if the associated item is flagged as deleted.

## Business Logic and Non-Obvious Design Decisions

- The program relies on the `vvarl1` record to determine if an item has been deleted. This implies an underlying business rule that deleted items are flagged within the item master data.
- The deletion of stock register entries is conditional on the item being marked as deleted, preventing accidental removal of active stock.
- The use of key lists (`klist`) and key fields (`kfld`) for access ensures efficient data retrieval, especially important in large datasets.

## Interactions with Other Modules and Data Sources

- **Stock Register (`vlagl1`)**: The main source of stock data, representing current stock entries.
- **Item Master (`vvarl1`)**: Contains metadata about each item, including deletion status.
- **Stock Update (`vlaglur`)**: Temporary or working record used to delete stock entries when necessary.

## Summary

This program is a maintenance routine that ensures the stock register remains accurate by removing entries for items that have been marked as deleted in the item master. It uses efficient data access techniques, adheres to business rules about item status, and maintains data integrity within the inventory management system.