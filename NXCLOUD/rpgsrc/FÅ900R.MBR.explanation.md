```markdown
# RPG Program Explained: EAN Number Control (`FÃ˜900R`)

This RPG (ILE RPG/400) program validates EAN (European Article Number) barcodes of either 13 or 14 digits. The source code is well-commented, mostly in Norwegian.

---

## 1. Header and Metadata

- `h option(*nodebugio) datedit(*dmy)`
  - Specifies program options and date format for data editing.
- The comment header describes the program:
  - **Purpose:** Checks if a given EAN number is valid. Returns '1' in the return code if the EAN number is invalid.
  - **History & Version:** Shows maintenance and extension history (e.g., support for 14 position EANs added in 2009).

---

## 2. Data Definitions

### Arrays

- `eana13`, `ean13`, `eana14`, `ean14`  
  Arrays for holding the digits of the EAN number as characters and numerics (0 decimals).  
  - `eana13(12)`, `ean13(12)`: For 13-digit EANs (excluding check digit).
  - `eana14(13)`, `ean14(13)`: For 14-digit EANs (excluding check digit).

### Parameters

- `p_eann` (14,0): Input EAN number as packed numeric (up to 14 digits).
- `p_rkod` (1): Output return code ('1' indicates error).

### Working Variables

- `w_eann`: Work variable for the EAN number (14 char).
- `w_eanr14`/`w_eanr13`: Work variables for rightmost 13/12 digits (used for calculation).
- `w_eaop`, `w_easf`, `w_ea00`, `w_ea02`: Various calculation intermediates.

---

## 3. Main Logic

### Outline

1. **Input Assignment**
   - Moves the input EAN to work fields.

2. **EAN Prefix Handling**
   - `select` block analyzes the start of the EAN:
     - **IF starts with '00':** 14-digit EAN (includes '00' prefix).
     - **ELSE IF starts with '0':** 13-digit EAN (skip leading '0').
     - **ELSE:** Assume 14-digit EAN.
   - Based on this, prepares the relevant substring and calls a subroutine (`eansjk14` or `eansjk13`) to calculate/check the control digit.

3. **Return Code Setting**
   - Compares the expected check digit (`w_easf`) against the input digit (`w_eaop`). If they don't match, sets `p_rkod` to '1'.

4. **End-of-Program**
   - Sets LR indicator (*inlr = *on) for program end and returns.

---

## 4. Subroutines

### a. `eansjk13` (13-Digit EAN Calculation)

- **Purpose:** Calculate the control digit for a 13-digit EAN.
- **Logic:**
  - Split into arrays (`movea`).
  - Apply EAN-13 calculation:
    - Sum even-positioned digits (array positions 2,4,6,8,10,12), multiply by 3.
    - Add odd-positioned digits (1,3,5,7,9,11).
    - Calculate modulo and subtract from 10 to get check digit (if 10, set to 0).

### b. `eansjk14` (14-Digit EAN Calculation)

- **Purpose:** Calculate the control digit for a 14-digit EAN.
- **Logic:**
  - Similar to 13-digit, but with 13 digits processed.
  - Odd positions (1,3,5...) are multiplied by 3; even positions (2,4,6...) are added afterwards.

### c. `*inzsr` (Initialization Subroutine)

- **Purpose:** Set all working variables and arrays to zero or blank state when the program starts.
- **Handles entry parameter setup:**
  - Declares input/output parameter variables.
  - Sets output code (`p_rkod`) to blank.

---

## 5. Parameter List

- The program expects:
  - **Input:** Packed 14-digit EAN number.
  - **Output:** 1-character result code ('1' if invalid, blank if valid).

---

## 6. Flow Summary

1. The EAN number is handed to the program via parameters.
2. The program decides which EAN validation algorithm to use (13 or 14 digits) based on EAN prefix.
3. It computes the expected check digit using the appropriate algorithm.
4. If the calculated check digit does not match the check digit in the input, it returns '1' as an error code.
5. If valid, it returns blank.

---

## 7. EAN Validation Notes

- **EAN-13:** 12 data digits + 1 check digit. Check digit is computed as per the standard algorithm.
- **EAN-14:** 13 data digits + 1 check digit. Similar logic applies, but with one extra digit.

---

## 8. Typical Usage

Suppose invoked as a called program from another application, passing the EAN and receiving the result code.

---

## 9. Key Takeaways for Developers

- **Extensible Design:** Easily supports both EAN-13 and EAN-14.
- **Separation of Logic:** Validation algorithms isolated in subroutines.
- **Clear Error Handling:** Single-character return code.
- **Legacy RPG Style:** Uses MOVE, MOVEA, and EVAL instructions; modern RPG IV would likely use more native variable assignments and procedures.

---

**In summary:**  
This program is a robust, legacy-style RPG utility for checking the validity (format) of both 13 and 14-digit EAN barcodes, reporting errors via a simple return code.
```