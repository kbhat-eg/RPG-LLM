# RPG Program Explanation: Utskrift av leverandøretiketter – Parameter

This program is written in ILE RPG (RPG/400 or RPG IV) and is part of a system for printing supplier (leverandør) labels based on user-defined parameters. Its primary function is to collect, validate, and process input criteria for which suppliers should be included, and call subprograms for searching and validation.

Below is an overview of the code, section by section, with explanations of the logic and structure.

---

## **1. Header and Documentation Section**

The initial section is a standard RPG documentation header, describing the program's purpose, system, version history, and indicator usage conventions. Notably:
- **Program:** RL622R
- **System:** ASOKON
- **Description:** Printing supplier labels – parameter selection
- **Change history and indicator usage:** The documentation describes which indicators are used for what kind of logic (exit, field protection, warnings, etc.).

---

## **2. File Declarations**

```rpg
fausrl1    if   e           k disk
frl622d    cf   e             workstn
T5.50frlevlr    if   e           k disk    rename(rlevpfr:rlevlrr)
```
- **ausrl1**: Input file (disk, keyed access) - likely a user profile file.
- **rl622d**: Workstation file (display file for screen interaction).
- **rlevlr**: Input file (disk, keyed access) - supplier master, renamed for local usage.

---

## **3. Variable and Data Structure Declarations**

- Declares working fields, such as counters, keys, and parameters (`wlev`, `wpakod`, `wpdat1`, etc.).
- Long parameter list in a data structure used to store all selection criteria for printout (dates, account ranges, departments, categories, sellers, customer numbers, districts, warehouses, flags for display control, etc.).
- Arrays, such as `kun(21)`, hold up to 21 individual supplier numbers for explicit selection.

---

## **4. Main Processing Logic**

### **A. Initialization**
```rpg
*inzsr begsr
...
endsr
```
- Sets default values for all selection parameters (min/max, blank, zero).
- Loads user-specific defaults (from `ausrl1`, keyed by user ID).
- Determines if access should be restricted to certain departments based on user flags.

### **B. Parameter Screen Interaction**
```rpg
exfmt a2bld
```
- Displays the main parameter selection screen (`a2bld`) for the user to enter criteria.

### **C. Exit/Function Key Handling**
```rpg
if *inkc = *on 
  move '1' p_in03
  goto xslutt
endif
```
- If F3/Exit key is pressed, set a return code and jump to program end.

### **D. Inquiry/Subroutine Calls**
```rpg
if *inkd = *on
  exsr spr_rut
  goto a2taga
endif
```
- If the Inquiry key is pressed, call a search subroutine to look up values for the active field.

### **E. Input/Range Validations**
Validates user-entered ranges:
- Supplier number (`a2plnf` ≤ `a2plnt`) – Indicator *IN32 on error.
- Department (`a2pavf` ≤ `a2pavt`) – Indicator *IN33 on error.
- Category, District, etc.

### **F. Individual Supplier Validation Loop**
If individual supplier selection is used (up to 21 slots), verify each supplier exists in the supplier master:
```rpg
dou n > 21
  if kun(n) <> *zeros
    move kun(n) rlevlr_levr
    rlevlr_key chain rlevlr
    if not %found
      ...
      goto a2taga
    endif
  endif
  eval n = n + 1
enddo
```
- For each supplier number entered, a chain/read is done against the supplier file. If not found, set a corresponding screen indicator and return to the input screen.

### **G. Label Type Validation**
Checks that the entered label type is allowed (must be 1, 3, or 4); otherwise, indicator *IN37 is set and program returns to the input screen.

### **H. Parameter Storage**
Moves validated screen values into the formal parameter data structure for use by processing/print routines.

---

## **5. Subroutine: Inquiry (Look-up Assistance)**

`spr_rut` subroutine supports field lookups in the parameter panel:

- For each field (supplier, department, category, district, warehouse, and all 21 individual suppliers), checks which field currently has focus (`w_afld`), prepares the appropriate value, and calls external programs (like `RL500R`, `RA507R`, `RA514R`, `RA508R`, `RA510R`, `RK500R`) for look-up and validation.
- Parameters are passed by reference, so changes come back to the main program.
- Screen indicators are set to highlight updated fields on the return.

Example:
```rpg
if w_afld = 'A2PLNF'
  eval p_levr = a2plnf
  call 'RL500R'
  parm w_firm
  parm p_levr
  parm p_tx30
  eval a2plnf = p_levr
  eval *in57 = *on
  goto end_spr_rut
endif
```

---

## **6. Program Termination**

Program ends cleanly by setting the LR (last record) indicator and returning:

```rpg
xslutt tag
eval *inlr = *on
return
```

---

## **7. Indicator Usage**

The documentation comments at the top describe the use of indicators for various program states:
- F1, F3 → Function keys (select company, exit).
- LR → Program termination.
- 30-39 → Field protection
- 31-59 → Validation/errors/screen markers.
- 70-89 → Work indicators (subroutines, etc.).
- 90-99 → Subroutine-specific indicators.

---

## **8. Version/Feature Notes**

The code is extensively versioned and annotated for customer-specific modifications and releases.

Features include:
- Laser printing of labels.
- Inclusion of contact person on labels.
- Selection of up to 21 individual suppliers.
- Support for new GUI versions.

---

## **Summary for New Developers**

- This program builds and validates the filter/parameter set for a supplier label print routine.
- The user interacts with a screen to set ranges and options for which suppliers to print labels for.
- The program performs validation on all entered values and supports look-up assistance (F4, etc.) for user convenience.
- After validation, the parameters are prepared for use by subsequent processing steps (such as actual label printing).
- The code is well-documented, with clear indicator and flow control usage, making maintenance and enhancement relatively straightforward for those familiar with RPG.

---

### **Tips**
- Familiarize yourself with the indicator usage conventions.
- Understand the structure of parameter passing and external program call semantics in RPG.
- Note the areas where version-specific logic or customer modifications have been added.
- You'll likely interact with or maintain the display files (`rl622d`) and external programs (`RL500R`, etc.) as part of this workflow.