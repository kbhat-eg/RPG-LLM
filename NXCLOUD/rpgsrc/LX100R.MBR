     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASLAGR
      * Program . . . . : LX100R
      * Beskrivelse . . : Oppdatering av meldingskode basert på status
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       151209 BSA  Nytt program
6.3q  *       260515 bof  Datoformat sql
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fledipf    if   e           k disk
      *
      * Definering av parametre
      *
     d b_EOF           s              1    inz(*off)
      *
     d w_kode          s              1
     d w_anta          s              9  0
      *
      * Definering av Local data area
      *
     d                uds
     d l_ruti                800    809
     d l_alin                856    858  0
     d l_wsid                901    910
     d l_user                        10
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
6.3q C/Exec SQL
6.3q C+  Set Option DatFmt=*ISO
6.3q C/End-Exec
      *
      *
      * Oppdaterer meldingskode
      *
     c                   exsr      behandling
      *
      * Avslutt
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av poster som matcher utplukkskriteriene
      * Behandler utskrift av detaljlinje
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandling    begsr
      *
     c/exec sql
     c+ set option commit=*none
     c/end-exec
      *
      * Finner først antall poster
      *
     c/exec sql
     c+ declare sok cursor for
     c+ select count(*) as w_anta
     c+ from ledipf
     c+ where  listat  = '7' or
     c+        listat  = '9'
     c+ for read only
     c/end-exec
      *
      * Utfør uthenting av poster
      *
     c/exec sql
     c+ open sok
     c/end-exec
      *
      *
     c/exec sql
     c+ fetch sok
     c+ into :w_anta
     c/end-exec
      *
      * Oppdater kode med status 7 (slettede poster)
      *
     c                   if        w_anta < 1
     c                   eval      *inlr = *on
     c                   return
     c                   endif
      * Kun for å sjekke om jeg har fått retur
     c                   eval      w_kode = 'S'
      *
     c/exec sql
     c+ update ledipf
     c+ set    likode  = :w_kode
     c+ where  listat  = '7'
     c/end-exec
      *
      * Oppdatering har ikke fungert
      *
     c                   if        sqlcod = 100 or sqlstt = '02000'
     c                   eval      *inlr = *on
     c                   return
     c                   endif
      *
      * Oppdater kode med status 9 (godkjente poster)
      *
     c                   eval      w_kode = 'G'
      *
     c/exec sql
     c+ update ledipf
     c+ set    likode  = :w_kode
     c+ where  listat  = '9'
     c/end-exec
      *
      * Oppdatering har ikke fungert
      *
     c                   if        sqlcod = 100 or sqlstt = '02000'
     c                   eval      *inlr = *on
     c                   return
     c                   endif
      *
      * Sletter alle poster eldre enn '2009-01-01'
      *
     c/exec sql
     c+ delete from ledipf
     c+ where limdat < '2008-12-31' and
     c+        likode  <> ' '
     c/end-exec
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Henter dagens dato
      *
     c**                 time                    w_udat
      *
     c                   endsr
