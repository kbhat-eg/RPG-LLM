      /TITLE  ASOKON Oversikt over filer til remittering totalt
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      * System  . . . . : ASOKON                                        *
      * Program . . . . : GL106R                                        *
      * Beskrivelse . . : Oversikt over filer til remittering totalt    *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      * Spesialversjon. :                                               *
      * Tilpasset for . :                                               *
      *                                                                 *
      * Referanse  Dato   Endringsbeskrivelse                      Sign.*
      * --------- ------  ----------------------------------------------*
      *           161194  Nytt program november-1994               RH   *
      *                                                                 *
      * 19088     190898  Rettet feilen m.h.p. 0000 i postnummer   RH   *
      *                   ved remittering lønn.  Banken ("Kassa")  RH   *
      *                   tolker dette som et postnummer!               *
      *                                                                 *
      * 15098     150998  Lagt inn mulighet for å velge batch som  RH   *
      *                   skal sendes bank.  Ved valg av flere     RH   *
      *                   batcher, vil det være kontroll på at     RH   *
      *                   "de" har samme bankforbindelse. Bankkode RH   *
      *                   vil nå bli vist på hver subfilelinje.    RH   *
      *                                                                 *
      * 28098     280998  Feil ved overføring av forslag.  Alle    RH   *
      *                   forslag ble overført, og ikke bare det   RH   *
      *                   forslaget som var valgt. Dette skyldtes  RH   *
      *                   en "etterlevning" fra tidligere versjon  RH   *
      *                   av rutinen, hvor kommando F6 sendte ALLE RH   *
      *                   forslag ut på file DIRREM.               RH   *
      *                                                                 *
      * 12059     120599  Feil ved overføring av forslag.  Dersom  RH   *
      *                   et forslag består av både NOK og VAL, så RH   *
      *                   blir det dannet 2 BETFOR99.  Begge må    RH   *
      *                   derfor leses!                            RH   *
      *                                                                 *
      * 02099     020999  Fjerner nullstilling av teller.          RH   *
      *                                                                 *
      * 07060     070600  Viser Start og Slutt på Sekvensteller:   RH   *
      *                                                                 *
      * 22060     220600  Tester på om overføring er aktivt, før   RH   *
      *                   forslag blir overført til banken.        RH   *
      *                                                                 *
      * 30060     300600  Test fra 220600 skal kun utføres dersom  RH   *
      *                   samlefil.                                RH   *
      *                                                                 *
      * 26071     260701  Lagt inn test på om teller går "rundt".  RH   *
      *                                                                 *
      * 27093     270903  Godtar likevel "0000" i postnummer for   RH   *
      *                   KLINK (ref endring 19088).               RH   *
      *                                                                 *
      * 13113     131103  Feil i utplukk fra samlefile             RH   *
      *                                                                 *
      * 09123     091203  Feil i program deresom wpsekv går        RH   *
      *                   "rundt".                                 RH   *
6.10  *           091110  Wpsekv skal starte på 0 etter 9999       NHO  *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      *  BRUK AV INDIKATORER                                            *
      *                                                                 *
      *       KC = F3  = Exit                                           *
      *       KF = F6  = Overfør batcen(e) til DIRREM                   *
      *       KL = F12 = Annuller                                       *
      *                                                                 *
      *       LR = Avslutt program                                      *
      *       10 = Roll                                                 *
      *       12 = Sfldsp                                               *
      *       13 = Sfldspctl                                            *
      *       14 = Sflclr                                               *
      *       15 = Sflend                                               *
      *       16 = Readc 16 on, no more records                         *
      *       30 = Protect av felter ved vise                           *
      *    31-59 = Varsle m/feilmeldinger/skjermindikatorer             *
      *    60-69 = Fileindikatorer chain etc.                           *
      *    70-79 = Arbeidsindikatorer i sub-rutiner                     *
      *    80-89 = Arbeidsindikatorer ordinære                          *
      *    90-99 = Benyttes ved std. sub-rutiner                        *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     fgx00pf    uf   e           k disk
     fgx01pf    uf   e           k disk
     fgx02pf    uf   e           k disk
     fgx03pf    uf   e           k disk
     fgu04l1    if   e           k disk
     f                                     rename(gu04pfr:gu04ufr)
     fgx04pf    uf   e           k disk
     f                                     rename(gu04pfr:gu04xfr)
     fgx21pf    uf   e           k disk
     fgu22l1    if   e           k disk
     f                                     rename(gu22pfr:gu22ufr)
     fgx22pf    uf   e           k disk
     f                                     rename(gu22pfr:gu22xfr)
     fgu23l1    if   e           k disk
     f                                     rename(gu23pfr:gu23ufr)
     fgx23pf    uf   e           k disk
     f                                     rename(gu23pfr:gu23xfr)
     fgx99pf    uf   e           k disk
     fgfaspf    if   e           k disk
     fdirrem    o  a e             disk
     fgl106d    cf   e             workstn
     f                                     sfile(b1sfl:srrn01)
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Definering av felter                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      *     nn - er 01 for subfile 01,
      *             02 for subfile 02,
      *             03 for subfile 03, o.s.v.
      * SRRNnn - Relativt recordnummer i subfile
      * SPGEnn - Sidestørrelse i subfile (page)
      * SFRNnn - Første recordnummer på siden
      * SSRNnn - Siste  recordnummer på siden
      * SVRNnn - Vis den side som inneholder denne record.
      *
      * Forklaring på spesielle felter
      * som benyttes ved windows.
      * - - - - - - - - - - - - - - - - -
      *
      * w_arow - Actual line, angir startlinje for vindu.
      * w_acol - Actual posision, angir startposisjon for vindu.
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      *
      *
      * SUBFILE-1
      * B1SFL  - B1 Subfile - record
      * B2CTL  - B2 Subfile - control record
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      *
15098d fgr             s              3    dim(50)
15098d fir             s              3  0 dim(50)
15098d ubf             s              3  0 dim(50)
13113d rid             s              4    dim(50)
      /eject
      *
      * Datastruktur for dagens dato, på format åååå.mm.dd:
      *
     d                 ds
     d dsdato                         8  0
     d  dsuÅr                         4  0 overlay(dsdato)
     d  dsumnd                        2  0 overlay(dsdato:5)
     d  dsudag                        2  0 overlay(dsdato:7)
      *
      * Datastruktur for BETFOR00:
      *
     d                 ds
     d dsb00a                        80
     d  gdhde0                        5    overlay(dsb00a)
     d  gdhrid                        4    overlay(dsb00a:6)
     d  gdhde1                        4    overlay(dsb00a:10)
     d  gdhtrs                        6  0 overlay(dsb00a:14)
     d  gdhde2                       51    overlay(dsb00a:20)
     d  gdhskf                        4  0 overlay(dsb00a:71)
     d gdhde3                 75    320
     d  dsb00b                       80    overlay(gdhde3:7)
     d  dsb00c                       80    overlay(gdhde3:87)
     d  dsb00d                       80    overlay(gdhde3:167)
      *
      * Datastruktur for BETFOR01:
      *
     d                 ds
     d dsb01a                        80
     d  gdade0                        5    overlay(dsb01a)
     d  gdarid                        4    overlay(dsb01a:6)
     d  gdade1                        4    overlay(dsb01a:10)
     d  gdatrs                        6  0 overlay(dsb01a:14)
     d  gdade2                       51    overlay(dsb01a:20)
     d  gdaskf                        4  0 overlay(dsb01a:71)
     d gdade3                 75     94
     d dsb01b                 81    160
     d  gdafgr                        3    overlay(dsb01b:15)
     d  gdade4                       10    overlay(dsb01b:18)
     d  gdafir                        3  0 overlay(dsb01b:28)
     d gdade5                111    320
     d  dsb01c                       80    overlay(gdade5:51)
     d  dsb01d                       80    overlay(gdade5:131)
      *
      * Datastruktur for BETFOR02:
      *
     d                 ds
     d dsb02a                        80
     d  gdbde0                        5    overlay(dsb02a)
     d  gdbrid                        4    overlay(dsb02a:6)
     d  gdbde1                        4    overlay(dsb02a:10)
     d  gdbtrs                        6  0 overlay(dsb02a:14)
     d  gdbde2                       51    overlay(dsb02a:20)
     d  gdbskf                        4  0 overlay(dsb02a:71)
     d gdbde3                 75    320
     d  dsb02b                       80    overlay(gdbde3:7)
     d  dsb02c                       80    overlay(gdbde3:87)
     d  dsb02d                       80    overlay(gdbde3:167)
      *
      * Datastruktur for BETFOR03:
      *
     d                 ds
     d dsb03a                        80
     d  gdcde0                        5    overlay(dsb03a)
     d  gdcrid                        4    overlay(dsb03a:6)
     d  gdcde1                        4    overlay(dsb03a:10)
     d  gdctrs                        6  0 overlay(dsb03a:14)
     d  gdcde2                       51    overlay(dsb03a:20)
     d  gdcskf                        4  0 overlay(dsb03a:71)
     d gdcde3                 75    320
     d  dsb03b                       80    overlay(gdcde3:7)
     d  dsb03c                       80    overlay(gdcde3:87)
     d  dsb03d                       80    overlay(gdcde3:167)
      *
      * Datastruktur for BETFOR04:
      *
     d                 ds
     d dsb04a                        80
     d  gddde0                        5    overlay(dsb04a)
     d  gddrid                        4    overlay(dsb04a:6)
     d  gddde1                        4    overlay(dsb04a:10)
     d  gddtrs                        6  0 overlay(dsb04a:14)
     d  gddde2                       51    overlay(dsb04a:20)
     d  gddskf                        4  0 overlay(dsb04a:71)
     d gddde3                 75    130
     d dsb04b                 81    160
     d  gddfgr                        3    overlay(dsb04b:51)
     d  gddfir                        3  0 overlay(dsb04b:54)
     d  gddubf                        3  0 overlay(dsb04b:57)
     d  gddbfl                        5  0 overlay(dsb04b:60)
     d gddde4                145    320
     d  dsb04c                       80    overlay(gddde4:17)
     d  dsb04d                       80    overlay(gddde4:97)
      *
      * Datastruktur for BETFOR21:
      *
     d                 ds
     d dsb21a                        80
     d  gdjde0                        5    overlay(dsb21a)
     d  gdjrid                        4    overlay(dsb21a:6)
     d  gdjde1                        4    overlay(dsb21a:10)
     d  gdjtrs                        6  0 overlay(dsb21a:14)
     d  gdjde2                       51    overlay(dsb21a:20)
     d  gdjskf                        4  0 overlay(dsb21a:71)
     d gdjde3                 75     94
     d dsb21b                 81    160
     d  gdjfgr                        3    overlay(dsb21b:15)
     d  gdjde4                       10    overlay(dsb21b:18)
     d  gdjfir                        3  0 overlay(dsb21b:28)
     d gdjde5                111    320
     d  dsb21c                       80    overlay(gdjde5:51)
     d   gdjpnr                       4  0 overlay(dsb21c:59)
     d    pnralf                      4    overlay(gdjpnr)
     d  dsb21d                       80    overlay(gdjde5:131)
      *
      * Datastruktur for BETFOR22:
      *
     d                 ds
     d dsb22a                        80
     d  gdkde0                        5    overlay(dsb22a)
     d  gdkrid                        4    overlay(dsb22a:6)
     d  gdkde1                        4    overlay(dsb22a:10)
     d  gdktrs                        6  0 overlay(dsb22a:14)
     d  gdkde2                       51    overlay(dsb22a:20)
     d  gdkskf                        4  0 overlay(dsb22a:71)
     d gdkde3                 75    282
     d  dsb22b                       80    overlay(gdkde3:7)
     d  dsb22c                       80    overlay(gdkde3:87)
     d dsb22d                241    320
     d  gdkubf                        3  0 overlay(dsb22d:43)
     d  gdkde4                       35    overlay(dsb22d:46)
      *
      * Datastruktur for BETFOR23:
      *
     d                 ds
     d dsb23a                        80
     d  gdlde0                        5    overlay(dsb23a)
     d  gdlrid                        4    overlay(dsb23a:6)
     d  gdlde1                        4    overlay(dsb23a:10)
     d  gdltrs                        6  0 overlay(dsb23a:14)
     d  gdlde2                       51    overlay(dsb23a:20)
     d  gdlskf                        4  0 overlay(dsb23a:71)
     d gdlde3                 75    242
     d  dsb23b                       80    overlay(gdlde3:7)
     d  dsb23c                       80    overlay(gdlde3:87)
     d dsb23d                241    320
     d  gdlfgr                        3    overlay(dsb23d:3)
     d  gdlfir                        3  0 overlay(dsb23d:6)
     d  gdlubf                        3  0 overlay(dsb23d:9)
     d  gdlbfl                        5  0 overlay(dsb23d:12)
     d  gdlde4                       64    overlay(dsb23d:17)
      *
      * Datastruktur for BETFOR99:
      *
     d                 ds
     d dsb99a                        80
     d  gdzde0                        5    overlay(dsb99a)
     d  gdzrid                        4    overlay(dsb99a:6)
     d  gdzde1                        4    overlay(dsb99a:10)
     d  gdztrs                        6  0 overlay(dsb99a:14)
     d  gdzde2                       51    overlay(dsb99a:20)
     d  gdzskf                        4  0 overlay(dsb99a:71)
     d gdzde3                 75    103
     d dsb99b                 81    160
     d  gdzatr                        5  0 overlay(dsb99b:24)
     d gdzde4                109    320
     d  dsb99c                       80    overlay(gdzde4:53)
     d  dsb99d                       80    overlay(gdzde4:133)
      *
      * Datastruktur for klokkeslett:
      *
     d                 ds
     d dsklok                         6  0
     d  dstime                        2  0 overlay(dsklok)
     d  dsminu                        2  0 overlay(dsklok:3)
     d  dsseku                        2  0 overlay(dsklok:5)
      *
      * Henter firmanavn.
      *
     d                uds
     d dsfgrp                931    933
     d dsfirm                944    946  0
     d dsfnav                951    980
      *---------------------------------------------------------------------
      * Stand Alone Fields - TOP
      *---------------------------------------------------------------------
     d i               s              2  0
     d sfrn01          s                   like(srrn01)
     d sfrn02          s                   like(srrn02)
     d spge01          s              3  0
     d spge02          s              3  0
     d srrn01          s              4  0
     d srrn02          s              4  0
     d ssrn01          s                   like(srrn01)
     d ssrn02          s                   like(srrn02)
     d w_arow          s              2  0
     d w_acol          s              3  0
     d wpakti          s              1
     d wpbank          s              2
     d wpbfnr          s              3  0
     d wpbygg          s              1
     d wpdagl          s              6  0
     d wpdato          s              8  0
     d wpfgrp          s              3
     d wpfirm          s              3  0
     d wpfler          s              2
     d wpfyst          s              4  0
     d wpin03          s              1  0
     d wpin12          s              1  0
09123d wpflag          s              1  0
     d wpkomm          s              4
     d wplist          s              1
     d wppost          s              1  0
     d wpsekv          s              4  0
     d wpslet          s              2
     d wptest          s              2
     d wptime          s              6  0
     d wpvalg          s              1
     d wpvent          s              6  0
     d wpzfgr          s                   like(gdzfgr)
     d wpzfir          s                   like(gdzfir)
     d wpzrid          s                   like(gdzrid)
     d wpzubf          s                   like(gdzubf)
      *---------------------------------------------------------------------
      * Stand Alone Fields - BOTTOM
      *---------------------------------------------------------------------
      /eject
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Åpningsbilde med alle forslag sendes opp dersom WPLIST er Blank *
      * Dersom WPLIST er utfylt med verdi, så betyr dette at dette pgm. *
      * kalles opp i fra GL105R (Utplukksprogram) for å overføre et     *
      * forslag direkte.                                                *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Tester på verdi i WPLIST:
      *
     c                   if        wplist = '1'
      *                                                      .          .
15098c                   call      'GL108R'
     c                   exsr      xoverf
     c                   goto      xslutt
     c                   endif
      *
      * Send Alt
      *
     c     b2taga        tag
     c                   write     b2cmd
      *
      * Bare data
      *
     c     b2tagb        tag
      * Avslutt program ved F12.                                        .
      **         *INKL     CABEQ*ON       XSLUTT                        .
     c                   exsr      xdsp01
      *
      * F3=Avslutt program i fra subfile program.
      *
     c                   if        *inkc = *on
15098c                   eval      wpkomm = *blanks
     c                   goto      xslutt
     c                   endif
      *
      * Forny
      *
     c                   if        *inke = *on
     c                   if        sfrn01 <> *zero
     c     sfrn01        chain     b1sfl                              60
     c                   endif
      *                                                                 .
      * Klokkeslettet må legges ut på nytt for å få tilbakestilt        .
      * hjelpesekvensteller i GL107R.  I GL107R er det test på om TIME  .
      * er den samme som ved sist oppkall.  Dersom TIME på tellerfile   .
      * ikke er lik TIME som sendes inn som parameter, så vil hjelpe-   .
      * sekvensteller bli tilbakestilt.                                 .
      *                                                                 .
     c                   time                    wptime
      * Les fra start på filen:                                         .
     c                   eval      wpzfgr = *blanks
     c     key01         setll     gx99pf
     c                   exsr      xclr01
     c                   exsr      xcrt01
     c                   if        sfrn01 <> *zero
     c                   goto      b2tagb
     c                   else
     c                   goto      b2taga
     c                   endif
     c                   endif
      *
      * F6=Oveføre forslag fra samlefile til DIRREM.
      *
     c                   if        *inkf = *on
15098 *                                                        .
15098 *  Tømmer DIRREM                                         .
15098 *                                                        .
15098c                   call      'GL108R'
      *                                                        .
     c                   exsr      xoverf
      *                                                        .
     c                   eval      wpzfgr = *blanks
     c     key01         setll     gx99pf
     c                   exsr      xclr01
     c                   exsr      xcrt01
     c                   goto      xslutt
      *                                                        .        .
     c                   endif
      *
      * Roll
      *
     c                   if        *in10 = *on
     c                   exsr      xcrt01
     c                   goto      b2tagb
     c                   endif
      *
      * Posisjoner
      * startverdi
      *
     c                   if        b2valg = *blank
     c                   if        b2zfgr <> *blanks
     c                   movel     b2zfgr        wpzfgr
     c     key01         setll     gx99pf
     c                   exsr      xclr01
     c                   exsr      xcrt01
     c                   eval      b2zfgr = *blanks
     c                   goto      b2tagb
     c                   endif
     c                   endif
      *
      * Tester på om linjenr. er valgt.
      *
     c                   if        b2valg <> ' '
     c                   if        b2zfgr = *blanks
     c                   move      *on           *in31
     c                   goto      b2tagb
     c                   endif
     c                   endif
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Behandling av subfile                                           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Sjekk om valg
      * er foretatt i
      * subfile
      *
15098c                   eval      i = 0
     c                   do        ssrn01
     c                   readc     b1sfl                                  16
      *                                                                 .
     c                   if        *in16 = *on
     c                   leave
     c                   endif
15098 *                                                                 .
15098 * Velg batch(er) som skal sendes:                                 .
15098 *                                                                 .
15098c                   if        b1valg = '1'
      *                                                           .     .
      * Tester på om kommunikasjon til banken er aktiv.           .     .
      * Den kan ikke være aktiv av andre rutiner:                 .     .
      *                                                           .     .
22060c                   eval      wpakti = *blanks
      *                                                           .     .
22060c     dsfirm        chain     gfaspf                             60
22060c                   if        *in60 = *off
22060 *          GEFKOM    ANDNE'PC  '                       .    .     .
22060 *                    CALL 'GL156C'                     .    .     .
22060 *                    PARM           WPAKTI             .    .     .
      *                                                      .    .     .
      * Rutine mot banken er aktiv!  Avslutt!                .    .     .
      *                                                      .    .     .
22060 *          WPAKTI    CABEQ'1'       XSLUTT             .    .     .
      *                                                      .    .     .
22060c                   endif
      *                                                           .     .
15098 * Frigjør subfile                                           .     .
15098 *                                                           .     .
15098c                   move      srrn01        w_virn
15098c                   eval      b1valg = *blank
15098c                   update    b1sfl
      *                                                           .     .
15098c                   movel     b1zfgr        wpfgrp
15098c                   movel     b1zfir        wpfirm
      *                                                           .     .
15098 * Legger bankkode i fra subfile over i et hjelpefelt.       .     .
15098 * Dersom feltet allerede inneholder en ANNEN banktype,      .     .
15098 * så skal det gis feilmelding.  Det kan kun velges å        .     .
15098 * sende transaksjoner til en type bank om gangen:           .     .
      *                                                           .     .
15098c                   if        wptest = *blanks
15098c                   movel     b1zban        wptest
15098c                   endif
      *                                                           .     .
15098 * Sender opp feilmelding på at det er valgt batcher med     .     .
15098 * forskjellige bankforbindelser:                            .     .
      *                                                           .     .
15098c                   if        wptest <> b1zban
15098c                   eval      w_arow = 4
15098c                   eval      w_acol = 39
15098c                   exfmt     a2win
      *                                                      .    .
15098c                   eval      wpzfgr = *blanks
15098c                   eval      wpzfir = 0
15098c                   eval      wpzubf = 0
15098c                   eval      wpzrid = *blanks
15098c                   eval      spge01 = 0
15098c                   eval      srrn01 = 0
15098c                   eval      spge02 = 0
15098c                   eval      srrn02 = 0
15098c                   eval      wptest = *blanks
15098c                   eval      i = 0
15098c                   eval      fgr = *blanks
13113c                   eval      rid = *blanks
15098c                   eval      fir = 0
15098c                   eval      ubf = 0
15098c                   time                    wptime
      *tømmer/fyller opp subfile på nytt                     .    .
15098c     key01         setll     gx99pf
15098c                   exsr      xclr01
15098c                   exsr      xcrt01
15098c                   goto      b2taga
15098 *                                                      .    .     .
15098c                   else
15098 *                                                      .    .     .
15098 * Oppdaterer tabell med filgruppe, firma og forslaget  .    .     .
15098 * som skal sendes bank:                                .    .     .
15098 *                                                      .    .     .
15098c                   eval      i = i + 1
15098c                   movel     b1zfgr        fgr(i)
13113c                   movel     b1zrid        rid(i)
15098c                   eval      fir(i) = b1zfir
15098c                   eval      ubf(i) = b1zubf
15098 *                                                      .    .     .
15098c                   endif
      *                                                           .     .
15098c                   iter
15098c                   endif
      *                                                                 .
      * Vise forslagsposter.                                            .
      *                                                                 .
     c                   if        b1valg = '5'
      *                                                        .        .
      * Frigjør subfile                                        .        .
      *                                                        .        .
     c                   move      srrn01        w_virn
     c                   eval      b1valg = *blank
     c                   update    b1sfl
      *                                                        .        .
      * Kaller opp eget program for forespørsel på batch,      .        .
      * dette må gjøres for å kunne override databasefile      .        .
      * dersom filgruppe er en annen enn *CURLIB.              .        .
     c                   movel     '5'           wpvalg
     c                   if        gdzfgr <> dsfgrp
     c                   call      'GL107C'
     c                   parm                    b1zfgr
     c                   parm                    b1zfir
     c                   parm                    b1zrid
     c                   parm                    b1zubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   else
     c                   call      'GL107R'
     c                   parm                    b1zfgr
     c                   parm                    b1zfir
     c                   parm                    b1zrid
     c                   parm                    b1zubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   endif
      * Avslutt program ved F12.                               .        .
     c     wpin12        cabeq     1             xslutt
     c                   iter
     c                   endif
      *                                                                 .
      * Slette batch.                                                   .
      *                                                                 .
     c                   if        b1valg = '4'
      *                                                        .        .
      * Frigjør subfile                                        .        .
      *                                                        .        .
     c                   move      srrn01        w_virn
     c                   eval      b1valg = *blank
     c                   update    b1sfl
      *                                                        .        .
      * Sender opp "angre"-bilde:                              .        .
      *                                                        .        .
     c                   if        wpslet = *blanks
     c                   eval      w_arow = 4
     c                   eval      w_acol = 39
     c                   exfmt     a1win
     c                   endif
      *                                                        .        .
      * Avslutt program ved F12.                               .        .
      ***        *INKL     CABEQ*ON       XSLUTT               .        .
     c                   if        *inkc = *on
     c                   iter
     c                   endif
      *                                                        .        .
      * Sender opp "vente"-bilde:                              .        .
      *                                                        .        .
     c                   if        wpslet = *blanks
     c                   eval      w_arow = 6
     c                   eval      w_acol = 35
     c                   write     b2win
     c                   endif
      *                                                        .        .
      * Setter "flagg" for å fortelle om det er foretatt       .        .
      * sletting av batcher.  I subfile oppdateres på nytt.    .        .
      *                                                        .        .
     c                   movel     'JA'          wpslet
      * Kaller opp eget program for å slette batch.  Dette     .        .
      * må gjøres for å kunne override databasefile dersom     .        .
      * filgruppe er en annen enn *CURLIB.                     .        .
     c                   movel     '4'           wpvalg
     c                   if        gdzfgr <> dsfgrp
     c                   call      'GL107C'
     c                   parm                    b1zfgr
     c                   parm                    b1zfir
     c                   parm                    b1zrid
     c                   parm                    b1zubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   else
     c                   call      'GL107R'
     c                   parm                    b1zfgr
     c                   parm                    b1zfir
     c                   parm                    b1zrid
     c                   parm                    b1zubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   endif
      * Avslutt program ved F12.                               .        .
     c     wpin12        cabeq     1             xslutt
     c                   iter
     c                   endif
      *                                                                 .
     c                   enddo
      *
      * Overfører valgte forslag til remittering:
      *
15098c                   if        i <> 0
15098 *                                                          .
15098c                   call      'GL108R'
15098c                   movel     '1'           wplist
15098 *                                                          .
15098c                   dou       i = 0
15098c                   movel     fgr(i)        wpzfgr
13113c                   movel     rid(i)        wpzrid
15098c                   eval      wpzfir = fir(i)
15098c                   eval      wpzubf = ubf(i)
15098c                   exsr      xoverf
15098c                   eval      i = i - 1
15098c                   enddo
15098 *                                                          .
15098c                   goto      xslutt
15098c                   endif
      *
      * Dersom det er foretatt sletting må subfile tømmes,
      * fylles opp, og deretter vises.
      *
     c                   if        wpslet = 'JA'
     c                   eval      wpslet = *blanks
     c                   eval      wpzfgr = *blanks
      *                                                      .
      * Nåværende tidspunkt må legges ut på nytt for å få    .
      * tilbakestilt hjelpesekvensteller i GL107R.  Dersom   .
      * det er avvik mellom TIME i parameter og TIME på file,.
      * så blir denne telleren tilbakestilt.                 .
      *                                                      .
     c                   time                    wptime
      *                                                      .
     c     key01         setll     gx99pf
     c                   exsr      xclr01
     c                   exsr      xcrt01
     c                   endif
      *
     c                   goto      b2taga
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Avslutt program                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Tøm subfile                                                     *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xclr01        begsr
     c                   move      *on           *in14
     c                   write     b2ctl
     c                   move      *off          *in14
      *
     c                   move      *off          *in15
     c                   eval      srrn01 = 0
     c                   eval      sfrn01 = 0
     c                   eval      ssrn01 = 0
     c                   eval      spge01 = 0
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Fyll opp subfile-1                                              *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xcrt01        begsr
     c                   eval      spge01 = spge01 + 12
     c                   eval      srrn01 = ssrn01
      *
     c                   dou       srrn01 = spge01
     c                   read      gx99pf                                 15
     c     *in15         cabeq     *on           xend01
      *Display-felter                                                   .
     c                   eval      srrn01 = srrn01 + 1
     c                   movel     gdzrid        b1zrid
     c                   movel     gdzfgr        b1zfgr
     c                   eval      b1zfir = gdzfir
     c                   eval      b1zubf = gdzubf
     c                   movel     gdziuk        b1ziuk
     c                   eval      b1ztot = gdztot
     c                   eval      b1sekv = 0
     c                   eval      b1zskf = 0
      *
      * Henter type bankforbindelse:
      *
     c                   eval      wpbank = *blanks
      *
15098c                   call      'GL200C'
15098c                   parm                    gdzfgr
15098c                   parm                    gdzfir
15098c                   parm                    wpbygg
15098c                   parm                    wpbank
      *
     c                   movel     wpbank        b1zban
      *
      * Henter siste hjelpesekvensnummer:
      *
     c                   movel     'P'           wpvalg
     c                   if        gdzfgr <> dsfgrp
     c                   call      'GL107C'
     c                   parm                    gdzfgr
     c                   parm                    gdzfir
     c                   parm                    gdzrid
     c                   parm                    gdzubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   else
     c                   call      'GL107R'
     c                   parm                    gdzfgr
     c                   parm                    gdzfir
     c                   parm                    gdzrid
     c                   parm                    gdzubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   endif
      *Beregner sekvensnummer                                           .
     c                   exsr      xsekve
      *
      * Oppdaterer siste hjelpesekvensnummer:
      *
     c                   movel     'T'           wpvalg
     c                   if        gdzfgr <> dsfgrp
     c                   call      'GL107C'
     c                   parm                    gdzfgr
     c                   parm                    gdzfir
     c                   parm                    gdzrid
     c                   parm                    gdzubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   else
     c                   call      'GL107R'
     c                   parm                    gdzfgr
     c                   parm                    gdzfir
     c                   parm                    gdzrid
     c                   parm                    gdzubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   endif
      *                                                                 .
     c                   write     b1sfl
     c                   enddo
      *
     c     xend01        tag
      *
     c                   if        srrn01 > ssrn01
     c                   eval      sfrn01 = ssrn01 + 1
     c                   endif
      *
     c                   eval      ssrn01 = srrn01
     c                   eval      w_virn = sfrn01
      *
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Display subfile                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xdsp01        begsr
      *
     c                   if        srrn01 <> 0
     c                   move      *on           *in12
     c                   endif
      *
     c                   move      *on           *in13
     c                   exfmt     b2ctl
     c                   move      *off          *in12
     c                   move      *off          *in13
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for å overføre AU-filer ("DIRADD") til DIRREM         *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xoverf        begsr
      *
02099 *******************  Z-ADD0         A1OVPO
      *
      * Det må her skilles på om programmet kalles opp m/u parameter-
      * liste.  Dersom PLIST er blank vil det si at alle forslag på
      * samlefilen skal behandles.  Dersom PLIST er utfylt vil det si
      * at det er kun ett forslag som blir sendt over til remittering.
      *
     c                   if        wplist = *blanks
     c     *inkc         cabeq     *on           b2taga
      * Feltet WPZFGR er en del av nøkkelen som brukes i SETLL .
      * på filen.  De andre nøkkelfeltene er allerede blanket. .
      * Nøkkel må bære "Blank" for å kunne posisjonerer seg på .
      * den første posten i filen.                             .
     c                   eval      wpzfgr = *blanks
     c                   else
     c     *inkc         cabeq     *on           endovf
     c                   endif
      *
      * LESER BETFOR99-transer:
      *
      *
      * Legger ut ventemelding mellom hver batch:
      *
     c                   if        wplist <> '1'
     c                   eval      w_arow = 8
     c                   eval      w_acol = 31
     c                   else
     c                   eval      w_arow = 6
     c                   eval      w_acol = 6
     c                   endif
      *
     c                   write     c2win
      *
     c     key01         setll     gx99pf
      *
13113c                   if        i <> 0
13113c     key01         reade     gx99pf                                 60
13113c                   else
     c                   read      gx99pf                                 60
13113c                   endif
      *
      * Legger "1" inn i variabel WPPOST for å "flagge" at det
      * er poster til overføring.  Denne blir senere brukt til
      * å teste på i CL-rutinen (GL106C) om ICF-kommunikasjon
      * skal starte opp:
      *
     c                   if        *in60 = *off
      *                                                        .
     c                   eval      wppost = 1
      *                                                        .
15098c                   movel     gdzfgr        wpfgrp
15098c                   movel     gdzfir        wpfirm
      *                                                        .
     c                   endif
      *
      *
     c                   dow       *in60 = *off
      *                                                        .
      * Kaller opp GL107C for å rydde opp på RUBFPF og RLTRPF  .
      * henholdsvis forslagsfile og leverandørtransaksjoner.   .
      * Samtidig returneres det med sist brukte sekvensnummer, .
      * med test på om det er EGET eller FELLES som skal brukes.
      *                                                        .
     c                   movel     'O'           wpvalg
     c                   if        gdzfgr <> dsfgrp
     c                   call      'GL107C'
     c                   parm                    gdzfgr
     c                   parm                    gdzfir
     c                   parm                    gdzrid
     c                   parm                    gdzubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   else
     c                   call      'GL107R'
     c                   parm                    gdzfgr
     c                   parm                    gdzfir
     c                   parm                    gdzrid
     c                   parm                    gdzubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   endif
      *                                                        .
      * Tildeler riktig sekvensnummer samtidig som samlefile   .
      * blir overført til remittering DIRREM.                  .
      *                                                        .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                        .
07060c                   eval      wpsekv = wpsekv + 1
07060c                   eval      wpdagl = wpdagl + 1
      *                                                        .
07060c                   eval      c7fost = wpsekv
07060c                   eval      c7dast = wpdagl
      *                                                        .
07060c                   eval      w_arow = 11
07060c                   eval      w_acol = 6
07060c                   exfmt     c7win
      *                                                        .
07060c                   eval      c7fost = c7fost - 1
07060c                   eval      c7dast = c7dast - 1
      *                                                        .
07060c                   eval      wpsekv = c7fost
07060c                   eval      wpdagl = c7dast
      *                                                        .
     c                   exsr      xdirre
      *                                                        .
      * Kaller opp GL107C for å legge tilbake sist brukte      .
      * sekvensnummer:                                         .
      *                                                        .
     c                   movel     'S'           wpvalg
     c                   if        gdzfgr <> dsfgrp
     c                   call      'GL107C'
     c                   parm                    gdzfgr
     c                   parm                    gdzfir
     c                   parm                    gdzrid
     c                   parm                    gdzubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   else
     c                   call      'GL107R'
     c                   parm                    gdzfgr
     c                   parm                    gdzfir
     c                   parm                    gdzrid
     c                   parm                    gdzubf
     c                   parm                    wpvalg
     c                   parm                    wpin12
     c                   parm                    wpsekv
     c                   parm                    wpdagl
     c                   parm                    wpdato
     c                   parm                    wptime
     c                   endif
      *                                                        .
      * Dersom WPLIST er utfylt, så skal denne subrutinen      .
      * XOVERF kun kjøres en gang for å legge ut forslaget:    .
      *                                                        .
12059 * Dersom VALUTA og NOK i d.s. forslaget, så må BETFOR99  .
12059 * lese en gang til:                                      .
      *                                                        .
28098c                   if        wplist <> '1'
     c                   read      gx99pf                                 60
      *                                                      . .        .
28098c                   else
12059 *FØR key01b        reade     gx99pf                                 60
28098 ****FØR Stjernet     MOVE *ON       *IN60              . .        .
13113c     key01         reade     gx99pf                                 60
      *                                                      . .        .
28098c                   endif
      *                                                        .
     c                   enddo
      *
      * Totalt antall overførte poster:
      *
     c                   if        wplist <> '1'
     c                   eval      w_arow = 10
     c                   eval      w_acol = 27
     c                   else
     c                   eval      w_arow = 8
     c                   eval      w_acol = 10
     c                   endif
      *
      * Dersom det IKKE er poster som skal overføres, så skal heller
      * IKKE kommunikasjon starte opp:
      *
     c                   if        a1ovpo = 0
     c                   eval      wpkomm = *blanks
     c                   goto      endovf
     c                   endif
      *
      * Dersom det IKKE er ICF-kommunikasjon, så sendes bilde C3WIN
      * opp når alle forslag er lagt ut på DIRREM (I=0).
      * Ved ICF-kommunikasjon vil overføring starte umiddelbart:
      *
     c                   if        wpkomm <> 'ICF '
      *                                                             .
28098c                   if        i = 1
     c                   exfmt     c3win
28098c                   endif
      *                                                             .
     c                   else
     c                   write     c6win
      * Venter i 5 sekunder:                                        .
     c                   time                    dsklok
     c                   eval      dsseku = dsseku + 5
     c                   if        dsseku > 59
     c                   eval      dsseku = dsseku - 59
     c                   eval      dsminu = dsminu + 1
     c                   if        dsminu > 59
     c                   eval      dsminu = dsminu - 59
     c                   eval      dstime = dstime + 1
     c                   if        dstime > 23
     c                   eval      dstime = dstime - 23
     c                   endif
     c                   endif
     c                   endif
      *                                                             .
     c                   time                    wpvent
     c                   dow       wpvent < dsklok
     c                   time                    wpvent
     c                   enddo
     c                   endif
      *
     c     endovf        tag
     c                   endsr
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for å overføre til remittering - DIRREM.              *
      * Tildeler først sekvensnummer:                                   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     xdirre        begsr
      *
     c                   eval      wpfyst = wpsekv
      *
      * BETFOR00 - GX00PF.  Finnes både for innenlands og
      * utenlands poster.
      *
     c     key03         setll     gx00pf
     c     key03         reade     gx00pf                                 61
     c                   dow       *in61 = *off
      *                                                      .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                      .
     c                   eval      wpsekv = wpsekv + 1
      *                                                      .
6.10 c****               if        wpsekv = 0
6.10 c****                         and gefban <> 'KK'
6.10 c****               eval      wpsekv = 1
6.10 c****               endif
      *                                                      .
     c                   eval      gdhskf = wpsekv
     c                   eval      wpdagl = wpdagl + 1
     c                   eval      gdhtrs = wpdagl
      *                                                      .
     c                   movel     umonth        gdhde1
     c                   move      uday          gdhde1
      *                                                      .
     c                   movel     dsb00a        gdqrem
     c                   write     dirremfr
     c                   movel     dsb00b        gdqrem
     c                   write     dirremfr
     c                   movel     dsb00c        gdqrem
     c                   write     dirremfr
     c                   movel     dsb00d        gdqrem
     c                   write     dirremfr
      *                                                      .
     c                   eval      a1ovpo = a1ovpo + 1
     c                   delete    gu00pfr
     c     key03         reade     gx00pf                                 61
     c                   enddo
      *
      * Behandler innenlands poster:
      *
     c                   if        gdzrid = 'TBII'
      *                                                           .
      * BETFOR21 - GX21PF                                         .
      *                                                           .
     c     key03         setll     gx21pf
     c     key03         reade     gx21pf                                 61
     c                   dow       *in61 = *off
      *                                                        .  .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                        .  .
     c                   eval      wpsekv = wpsekv + 1
      *                                                        .  .
6.10 c***                if        wpsekv = 0
6.10 c***                          and gefban <> 'KK'
6.10 c***                eval      wpsekv = 1
6.10 c***                endif
      *                                                        .  .
     c                   eval      gdjskf = wpsekv
     c                   eval      wpdagl = wpdagl + 1
     c                   eval      gdjtrs = wpdagl
     c                   eval      a1ovpo = a1ovpo + 1
      *                                                        .  .
     c                   movel     umonth        gdjde1
     c                   move      uday          gdjde1
      *                                                        .  .
      * Tester på om postnummer er 0000.  I såfall må det      .  .
      * legges ut blankt p.g.a. "KASSA":                       .  .
      *                                                        .  .
19088c                   if        gdjpnr = 0
19088c**** ref 27093     eval      pnralf = *blanks
19088c                   endif
      *                                                        .  .
      *                                                        .  .
      * Skriver 4 remitteringstransaksjoner:                   .  .
      *                                                        .  .
     c                   movel     dsb21a        gdqrem
     c                   write     dirremfr
     c                   movel     dsb21b        gdqrem
     c                   write     dirremfr
     c                   movel     dsb21c        gdqrem
     c                   write     dirremfr
     c                   movel     dsb21d        gdqrem
     c                   write     dirremfr
      *                                                        .  .
      * BETFOR22 - GU22L1                                      .  .
      *                                                        .  .
     c     key05         setll     gx22pf
     c     key05         reade     gx22pf                                 62
     c                   dow       *in62 = *off
      *
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *
     c                   eval      wpsekv = wpsekv + 1
      *                                                      . .  .
6.10 c***                if        wpsekv = 0
6.10 c***                          and gefban <> 'KK'
6.10 c***                eval      wpsekv = 1
6.10 c***                endif
      *                                                      . .  .
     c                   eval      gdkskf = wpsekv
     c                   eval      wpdagl = wpdagl + 1
     c                   eval      gdktrs = wpdagl
     c                   eval      a1ovpo = a1ovpo + 1
      *                                                      . .  .
     c                   movel     umonth        gdkde1
     c                   move      uday          gdkde1
      *                                                      . .  .
      * Skriver 4 remitteringstransaksjoner:                 . .  .
      *                                                      . .  .
     c                   movel     dsb22a        gdqrem
     c                   write     dirremfr
     c                   movel     dsb22b        gdqrem
     c                   write     dirremfr
     c                   movel     dsb22c        gdqrem
     c                   write     dirremfr
     c                   movel     dsb22d        gdqrem
     c                   write     dirremfr
      *                                                      . .  .
     c                   delete    gu22xfr
     c     key05         reade     gx22pf                                 62
     c                   enddo
      *                                                        .  .
      * BETFOR23 - GU23L1                                      .  .
      *                                                        .  .
     c     key05         setll     gx23pf
     c     key05         reade     gx23pf                                 62
     c                   dow       *in62 = *off
      *                                                        .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                        .
     c                   eval      wpsekv = wpsekv + 1
      *                                                      . .  .
6.10 c***                if        wpsekv = 0
6.10 c***                          and gefban <> 'KK'
6.10 c***                eval      wpsekv = 1
6.10 c***                endif
      *                                                      . .  .
     c                   eval      gdlskf = wpsekv
     c                   eval      wpdagl = wpdagl + 1
     c                   eval      gdltrs = wpdagl
     c                   eval      a1ovpo = a1ovpo + 1
      *                                                      . .  .
     c                   movel     umonth        gdlde1
     c                   move      uday          gdlde1
      *                                                      . .  .
      * Skriver 4 remitteringstransaksjoner:                 . .  .
      *                                                      . .  .
     c                   movel     dsb23a        gdqrem
     c                   write     dirremfr
     c                   movel     dsb23b        gdqrem
     c                   write     dirremfr
     c                   movel     dsb23c        gdqrem
     c                   write     dirremfr
     c                   movel     dsb23d        gdqrem
     c                   write     dirremfr
      *                                                      . .  .
     c                   delete    gu23xfr
     c     key05         reade     gx23pf                                 62
     c                   enddo
      *                                                        .  .
     c                   delete    gu21pfr
     c     key03         reade     gx21pf                                 61
     c                   enddo
      *                                                           .
     c                   endif
      *
      * Behandler utenlands poster:
      *
     c                   if        gdzrid = 'TBIU'
      *                                                           .
      * BETFOR01 - GX01PF                                         .
      *                                                        .  .
     c     key03         setll     gx01pf
     c     key03         reade     gx01pf                                 61
     c                   dow       *in61 = *off
      *
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *
     c                   eval      wpsekv = wpsekv + 1
      *                                                        .  .
6.10 c***                if        wpsekv = 0
6.10 c***                          and gefban <> 'KK'
6.10 c***                eval      wpsekv = 1
6.10 c***                endif
      *                                                        .  .
     c                   eval      gdaskf = wpsekv
     c                   eval      wpdagl = wpdagl + 1
     c                   eval      gdatrs = wpdagl
     c                   eval      a1ovpo = a1ovpo + 1
      *                                                        .  .
     c                   movel     umonth        gdade1
     c                   move      uday          gdade1
      *                                                        .  .
      * Skriver 4 remitteringstransaksjoner:                   .  .
     c                   movel     dsb01a        gdqrem
     c                   write     dirremfr
     c                   movel     dsb01b        gdqrem
     c                   write     dirremfr
     c                   movel     dsb01c        gdqrem
     c                   write     dirremfr
     c                   movel     dsb01d        gdqrem
     c                   write     dirremfr
      *                                                        .  .
      * BETFOR02 - GX02PF                                      .  .
     c     key04         setll     gx02pf
     c     key04         reade     gx02pf                                 62
     c                   dow       *in62 = *off
      *                                                      . .  .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                      . .  .
     c                   eval      wpsekv = wpsekv + 1
      *                                                      . .  .
6.10 c***                if        wpsekv = 0
6.10 c***                          and gefban <> 'KK'
6.10 c***                eval      wpsekv = 1
6.10 c***                endif
      *                                                      . .  .
     c                   eval      gdbskf = wpsekv
     c                   eval      wpdagl = wpdagl + 1
     c                   eval      gdbtrs = wpdagl
     c                   eval      a1ovpo = a1ovpo + 1
      *                                                      . .  .
     c                   movel     umonth        gdbde1
     c                   move      uday          gdbde1
      *                                                      . .  .
      * Skriver 4 remitteringstransaksjoner:                 . .  .
     c                   movel     dsb02a        gdqrem
     c                   write     dirremfr
     c                   movel     dsb02b        gdqrem
     c                   write     dirremfr
     c                   movel     dsb02c        gdqrem
     c                   write     dirremfr
     c                   movel     dsb02d        gdqrem
     c                   write     dirremfr
      *                                                      . .  .
     c                   delete    gu02pfr
     c     key04         reade     gx02pf                                 62
     c                   enddo
      *                                                        .  .
      * BETFOR03 - GX03PF                                      .  .
     c     key04         setll     gx03pf
     c     key04         reade     gx03pf                                 62
     c                   dow       *in62 = *off
      *                                                      . .  .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                        .
     c                   eval      wpsekv = wpsekv + 1
      *                                                      . .  .
6.10 c***                if        wpsekv = 0
6.10 c***                          and gefban <> 'KK'
6.10 c***                eval      wpsekv = 1
6.10 c***                endif
      *                                                      . .  .
     c                   eval      gdcskf = wpsekv
     c                   eval      wpdagl = wpdagl + 1
     c                   eval      gdctrs = wpdagl
     c                   eval      a1ovpo = a1ovpo + 1
      *                                                      . .  .
     c                   movel     umonth        gdcde1
     c                   move      uday          gdcde1
      *                                                      . .  .
      * Skriver 4 remitteringstransaksjoner:                 . .  .
     c                   movel     dsb03a        gdqrem
     c                   write     dirremfr
     c                   movel     dsb03b        gdqrem
     c                   write     dirremfr
     c                   movel     dsb03c        gdqrem
     c                   write     dirremfr
     c                   movel     dsb03d        gdqrem
     c                   write     dirremfr
      *                                                      . .  .
     c                   delete    gu03pfr
     c     key04         reade     gx03pf                                 62
     c                   enddo
      * BETFOR04 - GU04L1                                      .  .
     c     key04         setll     gx04pf
     c     key04         reade     gx04pf                                 62
     c                   dow       *in62 = *off
      *                                                      . .  .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                      . .  .
     c                   eval      wpsekv = wpsekv + 1
      *                                                      . .  .
6.10 c***                if        wpsekv = 0
6.10 c***                          and gefban <> 'KK'
6.10 c***                eval      wpsekv = 1
6.10 c***                endif
      *                                                      . .  .
     c                   eval      gddskf = wpsekv
     c                   eval      wpdagl = wpdagl + 1
     c                   eval      gddtrs = wpdagl
     c                   eval      a1ovpo = a1ovpo + 1
      *                                                      . .  .
     c                   movel     umonth        gddde1
     c                   move      uday          gddde1
      *                                                      . .  .
      * Skriver 4 remitteringstransaksjoner:                 . .  .
     c                   movel     dsb04a        gdqrem
     c                   write     dirremfr
     c                   movel     dsb04b        gdqrem
     c                   write     dirremfr
     c                   movel     dsb04c        gdqrem
     c                   write     dirremfr
     c                   movel     dsb04d        gdqrem
     c                   write     dirremfr
      *                                                      . .  .
     c                   delete    gu04xfr
     c     key04         reade     gx04pf                                 62
     c                   enddo
      *                                                        .  .
     c                   delete    gu01pfr
     c     key03         reade     gx01pf                                 61
     c                   enddo
      *                                                           .
     c                   endif
      *
      * BETFOR99 - GX99PF må også oppdaterer med sekvensnummer:
      * GX99PF er inneværende post når denne subrutinen kalles
      * opp, d.v.s. det er ikke behov for å lese posten på nytt!
      *
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *
     c                   eval      wpsekv = wpsekv + 1
      *
6.10 c***                if        wpsekv = 0
6.10 c***                          and gefban <> 'KK'
6.10 c***                eval      wpsekv = 1
6.10 c***                endif
      *
     c                   eval      gdzskf = wpsekv
     c                   eval      wpdagl = wpdagl + 1
     c                   eval      gdztrs = wpdagl
      *
      *  Tester på om sekvensteller har "gått rundt":
      *
26071c                   if        wpsekv < wpfyst
26071c                   eval      gdzatr = 9999 - wpfyst
26071c                   eval      gdzatr = gdzatr + wpsekv
26071c                   else
     c                   eval      gdzatr = wpsekv - wpfyst
26071c                   endif
      *
09123c                   if        wpflag = 1
09123c                   eval      gdzatr = gdzatr + 1
09123c                   eval      wpflag = 0
09123c                   endif
      *
     c                   eval      a1ovpo = a1ovpo + 1
      *
     c                   movel     umonth        gdzde1
     c                   move      uday          gdzde1
      *
      * Skriver 4 remitteringstransaksjoner:
     c                   movel     dsb99a        gdqrem
     c                   write     dirremfr
     c                   movel     dsb99b        gdqrem
     c                   write     dirremfr
     c                   movel     dsb99c        gdqrem
     c                   write     dirremfr
     c                   movel     dsb99d        gdqrem
     c                   write     dirremfr
      *
      *
     c                   delete    gu99pfr
      *
      * Legger ut ventemelding mellom hver batch:
      *
     c                   write     c2win
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for å tildele sekvensnummer.                          *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     xsekve        begsr
      *
      * Start sekvensnummer:
      *
     c                   eval      b1sekv = wpsekv + 1
      *
      * BETFOR00 - GX00PF.  Finnes både for innenlands og
      * utenlands poster.
      *
     c     key02         setll     gx00pf
     c     key02         reade     gx00pf                                 61
     c                   dow       *in61 = *off
      *
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *
     c                   eval      wpsekv = wpsekv + 1
     c     key02         reade     gx00pf                                 61
     c                   enddo
      *
      * Behandler innenlands poster:
      *
     c                   if        gdzrid = 'TBII'
      *                                                           .
      * BETFOR21 - GX21PF                                         .
      *                                                           .
     c     key02         setll     gx21pf
     c     key02         reade     gx21pf                                 61
     c                   dow       *in61 = *off
      *                                                           .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                           .
     c                   eval      wpsekv = wpsekv + 1
     c     key02         reade     gx21pf                                 61
     c                   enddo
      *                                                           .
      * BETFOR22 - GU22L1                                         .
      *                                                           .
     c     key02         setll     gu22l1
     c     key02         reade     gu22l1                                 61
     c                   dow       *in61 = *off
      *                                                           .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                           .
     c                   eval      wpsekv = wpsekv + 1
     c     key02         reade     gu22l1                                 61
     c                   enddo
      *                                                           .
      * BETFOR23 - GU23L1                                         .
      *                                                           .
     c     key02         setll     gu23l1
     c     key02         reade     gu23l1                                 61
     c                   dow       *in61 = *off
      *                                                           .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                           .
     c                   eval      wpsekv = wpsekv + 1
     c     key02         reade     gu23l1                                 61
     c                   enddo
      *                                                           .
     c                   endif
      *
      * Behandler utenlands poster:
      *
     c                   if        gdzrid = 'TBIU'
      *                                                           .
      * BETFOR01 - GX01PF                                         .
      *                                                           .
     c     key02         setll     gx01pf
     c     key02         reade     gx01pf                                 61
     c                   dow       *in61 = *off
      *                                                           .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                           .
     c                   eval      wpsekv = wpsekv + 1
     c     key02         reade     gx01pf                                 61
     c                   enddo
      *                                                           .
      * BETFOR02 - GX02PF                                         .
      *                                                           .
     c     key02         setll     gx02pf
     c     key02         reade     gx02pf                                 61
     c                   dow       *in61 = *off
      *                                                           .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                           .
     c                   eval      wpsekv = wpsekv + 1
     c     key02         reade     gx02pf                                 61
     c                   enddo
      *                                                           .
      * BETFOR03 - GX03PF                                         .
      *                                                           .
     c     key02         setll     gx03pf
     c     key02         reade     gx03pf                                 61
     c                   dow       *in61 = *off
      *                                                           .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                           .
     c                   eval      wpsekv = wpsekv + 1
     c     key02         reade     gx03pf                                 61
     c                   enddo
      *                                                           .
      * BETFOR04 - GU04L1                                         .
     c     key02         setll     gu04l1
     c     key02         reade     gu04l1                                 61
     c                   dow       *in61 = *off
      *                                                           .
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *                                                           .
     c                   eval      wpsekv = wpsekv + 1
     c     key02         reade     gu04l1                                 61
     c                   enddo
      *                                                           .
     c                   endif
      *
      * Det er allerede lest en BETFOR99-transaksjon.  Teller økes
      * således med 1.
      *
09123c                   if        wpsekv = 9999
09123c                   eval      wpsekv = -1
09123c                   eval      wpflag = 1
09123c                   endif
      *
     c                   eval      wpsekv = wpsekv + 1
      *
     c                   eval      b1zskf = wpsekv
      *
     c                   endsr
      *
      /eject
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
     c     *inzsr        begsr
      *
      * Parameterliste.  Den vil kun være utfylt dersom rutinen
      * kalles opp i fra GL105R, d.v.s. overføring kjøres direkte.
      * Utplukket blir da IKKE liggende på samlefile.
      *
     c     *entry        plist
     c                   parm                    wpfgrp
     c                   parm                    wpfirm
     c                   parm                    wpbfnr
     c                   parm                    wpkomm
     c                   parm                    wppost
      *
      * Variabler som brukes ved oppkall av GL107R.
      *
     c                   eval      wpfler = *blanks
     c                   eval      wpslet = *blanks
     c                   eval      wpsekv = 0
     c                   eval      wpdagl = 0
     c                   eval      wpfyst = 0
     c                   eval      wpin12 = 0
     c                   eval      wpvalg = *blanks
      *
22060c                   eval      wpakti = *blanks
      *
     c                   eval      dsudag = uday
     c                   eval      dsumnd = umonth
     c                   eval      dsuÅr = 2000
     c                   eval      dsuÅr = dsuÅr + uyear
     c                   if        uyear >= 80
     c                   eval      dsuÅr = 1900
     c                   eval      dsuÅr = dsuÅr + uyear
     c                   endif
     c                   movel     dsdato        wpdato
      *
     c                   time                    wptime
      *
     c                   eval      spge01 = 0
     c                   eval      srrn01 = 0
     c                   eval      spge02 = 0
     c                   eval      srrn02 = 0
     c                   eval      w_arow = 4
     c                   eval      w_acol = 26
     c                   eval      wpin03 = 0
     c                   eval      wpin12 = 0
     c                   eval      wpvent = 0
     c                   eval      wplist = *blanks
15098 * Koder som brukes ved kall av GL200C:
15098c                   movel     'N'           wpbygg
15098c                   eval      wpbank = *blanks
15098c                   eval      wptest = *blanks
15098 * Teller til tabell
15098c                   eval      i = 0
      *
      *
      *
      *
      * Parameterlisten inn i programmet er kun utfylt dersom det
      * kalles opp i fra GL105R.  Dette betyr at overføring kjøres
      * direkte, og at forslaget på samlefile blir sendt "over" med
      * en gang etter at det er lagt ut på samlefile.  Verdier i fra
      * parameterliste legges over i KEY01 samtidig som "flagg" settes
      * for å indikerer type kjøring:
      *
     c                   if        wpfgrp <> *blanks
     c                   movel     '1'           wplist
     c                   movel     wpfgrp        wpzfgr
     c                   eval      wpzfir = wpfirm
     c                   eval      wpzubf = wpbfnr
     c                   endif
      *
      * Key for file GX99PF
      *
     c     key01         klist
     c                   kfld                    wpzfgr
     c                   kfld                    wpzfir
     c                   kfld                    wpzubf
     c                   kfld                    wpzrid
      *
      * Key for file GX99PF
      *
12059c     key01b        klist
12059c                   kfld                    wpzfgr
12059c                   kfld                    wpzfir
12059c                   kfld                    wpzubf
      *
      * Henter type kommunikasjon firma skal benytte:
      *
     c     dsfirm        chain     gfaspf                             60
     c                   if        *in60 = *off
     c                   movel     gefkom        wpkomm
     c                   endif
      *
22060c                   eval      wpakti = *blanks
      *
22060c     dsfirm        chain     gfaspf                             60
22060c                   if        *in60 = *off
30060c                             and wplist <> '1'
22060c                             and gefkom <> 'PC  '
22060c                   call      'GL156C'
22060c                   parm                    wpakti
      *                                                      .
      * Rutine mot banken er aktiv!  Avslutt!                .
      *                                                      .
22060c                   if        wpakti = '1'
22060c                   movel     'END '        wpkomm
22060c                   goto      xslutt
22060c                   endif
      *                                                      .
22060c                   endif
      *
      * Posisjonerer med Filegruppe/Firma/Rutine-id og forslagsnummer
      * på file "Avslutninfstransaksjon".  Feltene for Filgruppe, Firma
      * og Forslagsnummer er kun utfylt dersom program kalles opp med
      * utfylt parameterliste:
      *
     c     key01         setll     gx99pf
      *
      * Fyller opp subfile: (Sender ventemelding):
      *
     c                   if        wplist = *blanks
     c                   eval      w_arow = 4
     c                   eval      w_acol = 39
     c                   write     c5win
     c                   exsr      xcrt01
     c                   endif
      *
      * Key for AU-filer:
      *
     c     key02         klist
     c                   kfld                    b1zfgr
     c                   kfld                    b1zfir
     c                   kfld                    b1zrid
     c                   kfld                    b1zubf
      *
      * Key for behandling av AU-filer, med nøkkelverdi i fra GX99PF:
      *
     c     key03         klist
     c                   kfld                    gdzfgr
     c                   kfld                    gdzfir
     c                   kfld                    gdzrid
     c                   kfld                    gdzubf
      *
      * Key for behandling av AU-filer (Utenlands), med verdier i fra
      * GX01PF.
      *
     c     key04         klist
     c                   kfld                    gdafgr
     c                   kfld                    gdafir
     c                   kfld                    gdarid
     c                   kfld                    gdaubf
     c                   kfld                    gdatel
      *
      * Key for behandling av AU-filer (Innenlands), med verdier i fra
      * GX21PF.
      *
     c     key05         klist
     c                   kfld                    gdjfgr
     c                   kfld                    gdjfir
     c                   kfld                    gdjrid
     c                   kfld                    gdjubf
     c                   kfld                    gdjtel
      *
     c                   endsr
      *
