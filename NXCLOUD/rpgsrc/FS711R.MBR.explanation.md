```markdown
## Overview

This RPG (Report Program Generator) program, named `FS710R`, is used to **log deleted order lines** from a source order line file into a deleted order lines register. The comments and documentation (some in Norwegian) help describe the program's change history and logic.

### Program Intent

- **Reads an order line record** (that is about to be deleted).
- **Copies all its fields** into a deleted-order-lines file (`fdeslu`).
- **Adds trace/audit info** such as user, workstation, current date/time.
- Handles multiple calls in one job; it is careful not to prematurely set LR (last record indicator).

---

## Header Specifications

```rpg
h option(*nodebugio) datedit(*dmy)
```
- `*nodebugio`: Disables interactive debug I/O.
- `datedit(*dmy)`: Specifies day-month-year format for date fields.

---

## File Definitions

```rpg
ffodtl1    if   e           k disk    rename(fodtpfr:fodtl1r)
ffdeslu    o  a e           k disk    rename(fdespfr:fdeslur)
```
- `fodtl1`: Input file, keyed, disk file (Order Line).
- `fdeslu`: Output/add file, keyed, disk file (Deleted Order Line Register).
- `rename`: Uses internal record format names.

---

## Data Structure Definitions

### Work Fields (from User Data Space)
```rpg
d                uds
d l_wsid                901    910
d l_user                911    920
```
- Reads workstation ID and user from the user space (positions 901-910, 911-920).

### Parameters Entering the Program
```rpg
d p_firm          s                   like(fsfirm)
6.NU d p_numm     s                   like(fsnumm)
d p_suff          s                   like(fssuff)
d p_line          s                   like(fsline)
d p_spgm          s                   like(fsspgm)
8.01 d p_inlr     s              1
```
- Company (firm), order number, suffix, line number, calling program, and whether to set LR.

### Key Variables for File Accesses
```rpg
d fodtl1_numm     s                   like(fdnumm)
d fodtl1_suff     s                   like(fdsuff)
d fodtl1_line     s                   like(fdline)
```
- Used to hold values for building keys to access the order line file.

---

## Main Logic

### Early Exit for "File Close" Call
```rpg
8.01  if        p_inlr = *on
8.01      goto      xslutt
8.01  endif
```
- If parameter `p_inlr` is *ON, jumps to program exit, to only set LR (used when program called at end-of-job to close files).

### Fetch the Order Line To Be Deleted
```rpg
8.02 eval      fodtl1_line = p_line
     fodtl1_key    chain     fodtl1r
```
- Sets up the line number, then performs a `CHAIN` to fetch the order line by key.

### If Found, Copy Fields Into Deleted Register
```rpg
if        %found
   eval      fsfirm = fdfirm
   eval      fsnumm = fdnumm
   ... [Many fields copied 1:1]
   time                    fsslda
   time                    fsslti
   eval      fsspgm = p_spgm
   eval      fsslws = l_wsid
   eval      fsslus = l_user
   ... [Additional audit fields]
   write     fdeslur
endif
```
- If found, copies all fields from the fetched record into the deleted lines output format.
- Sets current time (twice) and several fields for program, workstation, and user.
- Several audit and trace fields are also filled using current date/time and user.
- Finally, writes the record to the deleted order line file.

---

## Program Exit

```rpg
xslutt        tag

if        p_inlr = *on
   eval      *inlr = *on
endif

return
```
- Label for program exit.
- If `p_inlr` is *ON, sets the special `*INLR` indicator to close files and reclaim storage.
- Returns control.

---

## Initialization Subroutine (*INZSR)

- Sets up key lists for file access.
- Receives parameters from previous program call via `*ENTRY PLIST`.
- Stores parameters into work fields.
- Notably, order line is not set here; that is handled in the mainline.

---

## Summary Table

| File   | Direction | Purpose                       |
|--------|-----------|------------------------------|
| fodtl1 | Input     | Source order line            |
| fdeslu | Output    | Deleted order line register  |

| Key Parameters    | Description           |
|-------------------|----------------------|
| p_firm            | Company              |
| p_numm            | Order number         |
| p_suff            | Order suffix         |
| p_line            | Line number          |
| p_spgm            | Calling program name |
| p_inlr            | End-of-job indicator |

---

## Usage Scenario

This program is typically called:
- **When an order line is to be deleted**: It records the full detail in the deleted lines register for auditing/recovery.
- **At the end of a batch/job**: It is called with `p_inlr = *ON` to close the files gracefully.

---

## Key Points for Onboarding

- The program is almost entirely mechanical: copies an order line to the deleted register with full audit info.
- The extensive `eval` block ensures all details are preserved.
- Special care is taken not to close files (set LR) until all relevant calls are finished.
- Audit fields and traceability are a priority, with timestamps and user/workstation info set on every write.

---

## Change History (From Comments)

- Expanded audit fields, added price group, company code expansion, and other traceability improvements across versions.
- The program's behavior and call protocol are well-documented in the header.

---
```