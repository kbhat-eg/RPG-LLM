     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASSTAT
      * Program . . . . : SF852R
      * Beskrivelse . . : Salgsstatistikk, eksport til fil
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       211101 HKO  Nytt program
      *       220402 HKO  Kommuniserer parameter via datastruktur
      *       030502 HKO  Legger ut statistikkenhet og antall i.h.t. denne
      *       190602 HKO  Tilpasset nytt recordformat.
      *                   Legger ut alle varer uavhengig av om varen har
      *                   nobbnr.
      *       120603 HKO  Plukker på ikke tidligere rapporterte salg og
      *                   merker rapporteret salg i statistikken
      *       190104 HKO  Tilpasset nytt recordformat.
      *       280105 HKO  Tar med bongnr
      *       190602 HKO  Tilpasset nytt recordformat (versjon B)
6.11  *       220611 bof  Utvidet ean-nr til 14 posisjoner og nytt oppslag
6.12  *       070911 bof  Tilpasset nytt recordformat (versjon C) utvidet B
6.13  *       210812 bof  Tilpasset nytt recordformat (versjon D)
6.13  *                   Tar med pakksedler - disse merkes med P i d_pakk
6.14  *       271112 bof  Lagt på test avdeling, endret les av ordre
6.21  *       021013 bof  Erstatter hextegn '05' med blank, gir forskyvninger
6.30  *       070514 bof  Tilpasset nytt recordformat (versjon E)
6.31  *       080914 bof  Tilpasset nytt recordformat (versjon F)
6.32  *       271014 bof  Ved pakkseddel så nullstill bilnr og fakt.dato +
6.32  *                   legger ut akk.type
6.nu  *       230414 bof  sjekket mtp. nummerutvidelse
6.33  *       161116 bof  Pakkseddel mangler best.nr, lev.nr + nobb.lev
6.35  *       170217 bof  Sjekk er bare varenr legges ut.
6.36  *       020517 bkv  Erstatter hextegn '0D' med blank, gir forskyvninger
6.37  *       261017 bof  Erstatter hextegn '05'/'0D' på d_bpla gir forskyvn.
6.38  *       140218 bof  Endret utlegg av endret dato d_edat (sydd inn 290719)
6.38  * 6.30  170918 bkv  Utvidet med trelast sortiment
6.39  *       060618 bof  Utvidet med "Kilde salg" SFKILD  (sydd inn 290919)
6.3a  * 6.30  170918 bkv  Utvidet med trelast sortiment
      *
7.01  *K00    100720 bof  NXS-3880 Utvidelse lev.dato + forsend.måte + ord.type
7.02  *K00    100120 bof  NXS-3880 Justering vedr. kreditnota og antall/og alle beløp
7.03  *K00    040920 bof  NXS-3880 Feilretting vedr. lev.dato fra pakkseddel + feil enhet
7.04  *K00    150920 bof  NXS-3880 Justering på rabatt vedr kreditnota
7.05  *K00    091120 bof  REQ0425851 Legger ikke ut kamp. på pakkseddel
7.06  *K00    091120 bof  INCT0137851 Fjerner utlegg av mail-adr. skaper sporadisk prob.
      *
8.01  *       060422 bof  Erstatter hextegn '05'/'0D' på d_knav/d_bnav gir forskyvn.
8.02  *       151222 bof  Hvis gtin finnes på stat bruk dette, ellers vv713r
8.03  *PRG2   160622 bsa  Utvidet prisgruppe fra 1 til 2 posisjoner
8.04  *       050325 bof  Endre hent gtin
8.05  *       070325 bof  Konvertere enkelte hex verdier til blank
8.06  *       070325 bof  Konvertere enkelte hex verdier små æøå til store ÆØÅ
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fsstalh    uf   e           k disk    rename(sstapfr:sstalhr)
      *
     fjlevl3    if   e           k disk    rename(jlevpfr:jlevl3r)
     frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
     frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
     fra07l1    if   e           k disk    rename(ra07pfr:ra07l1r)
     fra09l1    if   e           k disk    rename(ra09pfr:ra09l1r)
     fra11pf    if   e           k disk    rename(ra11pfr:ra11pfr)
7.01 fra17l1    if   e           k disk    rename(ra17pfr:ra17pfr)
6.12 frukrl1    if   e           k disk    rename(rukrpfr:rukrl1r)
     ffkprl1    if   e           k disk    rename(fkprpfr:fkprl1r)
6.13 ffodtl1    if   e           k disk    rename(fodtpfr:fodtl1r)
6.14 ffoheld    if   e           k disk    rename(fohepfr:foheldr)
6.13 fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
7.02 fvltyl1    if   e           k disk    rename(vltypfr:vltyl1r)
6.13 fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
6.30 fvtill5    if   e           k disk    rename(vtilpfr:vtill5r)
6.38 fvvlel1    if   e           k disk    rename(vvlepfr:vvlel1r)
8.04 fjvpkl1    if   e           k disk    rename(jvpkpfr:jvpkl1r)
      *
     fsonopf    o  a e           k disk
      *
      * Definering av parametre
      *
     d p_list          s             40
      *
      * Definering av Local data area
      *
     d                uds
     d l_fnav                951    970
      *
      * Datastruktur for parameterliste -inn
      *
     d                 ds
     d d_list                        40
     d  d_firm                        3  0 overlay(d_list:1)
     d  d_avde                        4  0 overlay(d_list:4)
     d  d_fdat                         d   overlay(d_list:8)  datfmt(*iso)
     d  d_tdat                         d   overlay(d_list:18) datfmt(*iso)
     d  d_tidl                        1  0 overlay(d_list:28)
      *
      * Definering av statistikkfil
      *
     d                 ds
6.31 d d_stat                      1000
6.30 d  d_vers                        1    overlay(d_stat:1) inz('F')           Versjon
     d  d_nobb                        8  0 overlay(d_stat:2)                    Nobbnr
     d  d_eann                       13  0 overlay(d_stat:10)                   EAN-nr
     d  d_mean                       15    overlay(d_stat:23)                   EAN-lok.nr. medlem
     d  d_vare                       15    overlay(d_stat:38)                   Varenr
     d  d_tek1                       35    overlay(d_stat:53)                   Varetekst 1
     d  d_vgrp                        7  0 overlay(d_stat:88)                   Varegruppe
     d  d_kund                       10  0 overlay(d_stat:95)                   Kunde
     d  d_knav                       35    overlay(d_stat:105)                  Kundenavn
     d  d_kean                       15    overlay(d_stat:140)                  Kunde EAN-lok.nr.
     d  d_korg                       15    overlay(d_stat:155)                  Kunde org.nr.
     d  d_kkat                        4  0 overlay(d_stat:170)                  Kundekategori
     d  d_ktxt                       35    overlay(d_stat:174)                  Kundekategori-tekst
     d  d_bkun                       10  0 overlay(d_stat:209)                  Betalende kunde
     d  d_bnav                       35    overlay(d_stat:219)                  Bet. kundenavn
     d  d_bean                       15    overlay(d_stat:254)                  Bet. EAN-lok.nr.
     d  d_borg                       15    overlay(d_stat:269)                  Bet. org.nr.
     d  d_bkka                        4  0 overlay(d_stat:284)                  Bet. kundekategori
     d  d_bktx                       35    overlay(d_stat:288)                  Bet. kundekat-tekst
     d  d_boor                       15    overlay(d_stat:323)                  Bonuskunde org.nr.
     d  d_kjed                       35    overlay(d_stat:338)                  Kjede
     d  d_bpla                       35    overlay(d_stat:373)                  Byggeplass
     d  d_kpnr                       35    overlay(d_stat:408)                  Kundens prosjektnr.
     d  d_dato                        8  0 overlay(d_stat:443)                  Salgsdato/Ordredato
     d  d_sumb                       13    overlay(d_stat:451)                  Sum brutto
     d  d_sumn                       13    overlay(d_stat:464)                  Sum netto
     d  d_sumr                       13    overlay(d_stat:477)                  Sum rabatt
     d  d_sumk                       13    overlay(d_stat:490)                  Sum kost
     d  d_enhe                        3    overlay(d_stat:503)                  Enhet
     d  d_anta                       13    overlay(d_stat:506)                  Antall
     d  d_kpri                        1    overlay(d_stat:519)                  Priskode
     d  d_skaf                        1    overlay(d_stat:520)                  Skaffevare ?
     d  d_klev                        1    overlay(d_stat:521)                  Korrekt levert ?
     d  d_lmat                        2    overlay(d_stat:522)                  Leveringsmåte
     d  d_nldo                        6  0 overlay(d_stat:524)                  Leverandør (Nobb)
     d  d_ldor                        6  0 overlay(d_stat:530)                  Leverandør
     d  d_lnav                       35    overlay(d_stat:536)                  Leverandør-navn
     d  d_sabh                       10    overlay(d_stat:571)                  Saksbehandler
     d  d_sabn                       35    overlay(d_stat:581)                  Saksbehandler-navn
     d  d_ordr                       10    overlay(d_stat:616)                  Ordrenr
     d  d_orln                       10    overlay(d_stat:626)                  Ordre-linjenr
     d  d_bong                       15    overlay(d_stat:636)                  Bongnr
     d  d_bdat                        8  0 overlay(d_stat:651)                  Fakturadato
     d  d_edat                        8  0 overlay(d_stat:659)                  Endringsdato
6.12 d  d_kema                       50    overlay(d_stat:667)                  Kunde email
6.12 d  d_kknr                       25  0 overlay(d_stat:717)                  Kort nr
6.13 d  d_pakk                        1    overlay(d_stat:742)                  Pakkseddel
6.13 d  d_suff                        2    overlay(d_stat:743)                  Suffix
6.30 d  d_gate                       35    overlay(d_stat:745)                  Adresse1
6.30 d  d_ponr                        4    overlay(d_stat:780)                  Postnr
6.30 d  d_sted                       35    overlay(d_stat:784)                  Sted
6.30 d  d_padr                       35    overlay(d_stat:819)                  Prosjekt.adr
6.30 d  d_kamp                        5    overlay(d_stat:854)                  Kampanjenr
6.30 d  d_kfda                         d   overlay(d_stat:859)                  Kamp.fra dato
6.30 d  d_ktda                         d   overlay(d_stat:869)                  Kamp.til dato
6.31 d  d_benr                       10    overlay(d_stat:879)                  Best.nr
6.31 d  d_bsuf                       10    overlay(d_stat:889)                  Best.suff
6.31 d  d_blin                       10    overlay(d_stat:899)                  Best.linje
6.31 d  d_binr                       10    overlay(d_stat:909)                  Bilagsnr.
6.31 d  d_koda                         d   overlay(d_stat:919)                  Kasse oppr.dato
6.31 d  d_koti                         t   overlay(d_stat:929)                  Kasse oppr.tidspkt
6.32 d  d_oakk                        1    overlay(d_stat:939)                  Akkumulator-type
6.39 d  d_kild                        3    overlay(d_stat:940)                  Kilde salg
7.01 d  d_ldat                         d   overlay(d_stat:943)                  Leveringsdato
7.01 d  d_fmat                        2  0 overlay(d_stat:953)                  Forsendelsesmåte
7.01 d  d_lmtx                       20    overlay(d_stat:955)                  Fors.måte tekst
7.01 d  d_otyp                        2    overlay(d_stat:975)                  Ordretype
      *
6.30  * lengde 1000 *
      * Definering av variable i nøkler
      *
     d sstalh_erap     s                   like(sferap)
     d jlevl3_enum     s                   like(jlenum)
     d rkunl1_kund     s                   like(rkkund)
6.12 d rukrl1_kkun     s                   like(rukkun)
6.12 d rukrl1_kpro     s                   like(rukpro)
6.12 d rukrl1_ktyp     s                   like(ruktyp)
6.12 d rukrl1_ktsq     s                   like(ruktsq)
     d rlevl1_levr     s                   like(rllevr)
     d ra07l1_gkod     s                   like(ragkod)
     d ra09l1_ikod     s                   like(raikod)
     d ra11pf_kkod     s                   like(rakkod)
7.01 d ra17l1_qkod     s                   like(raqkod)
     d fkprl1_kund     s                   like(flkund)
     d fkprl1_kpro     s                   like(flkpro)
6.14 d foheld_bdat     s                   like(fobdat)
6.14 d fodtl1_numm     s                   like(fdnumm)
6.14 d fodtl1_suff     s                   like(fdsuff)
6.13 d votyl1_otyp     s                   like(vaotyp)
7.02 d vltyl1_ltyp     s                   like(valtyp)
6.13 d vvarl1_vare     s                   like(vvvare)
6.30 d vtill5_kamp     s                   like(vtkamp)
6.30 d vtill5_vare     s                   like(vtvare)
6.30 d vtill5_prgr     s                   like(vtprgr)
6.30 d vtill5_lety     s                   like(vtlety)
8.04 d jvpkl1_vare     s                   like(jwvare)
8.04 d jvpkl1_ldor     s                   like(jwldor)
      *
      * Definering av variable
      *
     d w_dato          s              8
     d w_vgrp          s              7
     d w_ogrp          s              2
     d w_hgrp          s              2
     d w_ugrp          s              3
     d w_numm          s             12
     d w_tell          s              1  0
6.11 d w_east          s              1
6.11 d w_eann          s             14  0
      *
     d w_firm          s                   like(sffirm)
     d w_sumb          s                   like(sfsumb)
     d w_sumr          s                   like(sfsumb)
     d w_sumn          s                   like(sfsumb)
     d w_sumk          s                   like(sfsumk)
     d w_anta          s                   like(sfanta)
6.13 d w_rkr1          s             11  2
6.13 d w_rkr2          s             11  2
6.13 d w_rkro          s             11  2
6.13 d w_beln          s             11  2
6.13 d w_belw          s             11  2
6.13 d w_vtyp          s              1
6.13 d w_date          s                   like(foedat)
6.13 d w_da01          s                   like(foedat)
6.20 d w_udat          s               d   datfmt(*iso)
6.39 d w_ddat          s               d   datfmt(*iso)
6.20 d w_ldor          s                   like(vvldor)
9.03 d w_enum          s                   like(vvldor)
6.21 d b_inlr          s              1    inz(*off)
6.38 d w_lv_nobb       s                   like(vvlnob)
6.38 d w_lv_modn       s                   like(vvlmod)
6.38 d w_lv_lldo       s                   like(vvlnle)
6.38 d w_lv_llva       s                   like(vvllva)
7.05 d w_kamp          s                   like(sfkamp)
7.05 d w_vare          s                   like(sfvare)
7.05 d w_prgr          s                   like(sfprgr)
7.05 d w_lety          s                   like(sflety)
7.05 d w_orda          s                   like(sforda)
5.32 d w_latx          s             20
5.32 d w_adrs          s             30
5.32 d w_ponr          s              4  0
5.32 d w_pste          s             30
5.32 d w_avde          s              4  0
5.32 d b_feil          s              1    inz(*off)
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   time                    w_ddat
      * Leser salgsstatistikk, og oppretter eksportfil
      *
     c                   if        d_tidl = 0
     c                   eval      sstalh_erap = 0
     c     sstalh_key    setll     sstalh
     c     sstalh_key    reade     sstalhr
     c                   else
     c     sstalh_key2   setll     sstalh
     c     sstalh_key2   reade     sstalhr
     c                   endif
      *
     c                   dow       not %eof
      *
     c                   exsr      oppdater
      *
     c                   if        d_tidl = 0
     c     sstalh_key    reade     sstalhr
     c                   else
     c     sstalh_key2   reade     sstalhr
     c                   endif
      *
     c                   enddo
      *
     c                   exsr      pakkseddel
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for oppretting av eksportfil
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     oppdater      begsr
      *
      *
      * Test på avdeling
      *
     c                   if        d_avde <> 0 and
     c                             d_avde <> sfsavd
     c                   unlock    sstalh
     c                   leavesr
     c                   endif
      *
      *
      * Test på dato
      *
     c                   if        d_fdat <> *loval and
     c                             sforda < d_fdat or
     c                             d_tdat <> *loval and
     c                             sforda > d_tdat
     c                   unlock    sstalh
     c                   leavesr
     c                   endif
      *
      * Henter statistikkinformasjon
      *
6.32 c                   eval      d_oakk = '9'
     c                   eval      d_nobb = sfnobb
     c                   eval      d_eann = 0
     c                   eval      d_mean = l_fnav
     c                   eval      d_vare = sfvare
     c                   eval      d_tek1 = sftek1
6.21 c     x'05':' '     xlate     d_tek1        d_tek1
6.36 c     x'0D':' '     xlate     d_tek1        d_tek1
     c                   eval      d_vgrp = 0
     c                   eval      d_kund = sfvkun
     c                   eval      d_knav = *blank
6.30 c                   eval      d_gate = *blank
6.30 c                   eval      d_ponr = *blank
6.30 c                   eval      d_sted = *blank
6.30 c                   eval      d_padr = *blank
     c                   eval      d_kean = *blank
     c                   eval      d_korg = *blank
     c                   eval      d_kkat = 0
     c                   eval      d_ktxt = *blank
     c                   eval      d_bkun = sffkun
     c                   eval      d_bnav = *blank
     c                   eval      d_bean = *blank
     c                   eval      d_borg = *blank
     c                   eval      d_bkka = 0
     c                   eval      d_bktx = *blank
     c                   eval      d_boor = *blank
     c                   eval      d_kjed = *blank
     c                   eval      d_bpla = *blank
     c                   eval      d_kpnr = *blank
     c                   eval      d_dato = 0
     c                   eval      d_sumb = *blank
     c                   eval      d_sumr = *blank
     c                   eval      d_sumn = *blank
     c                   eval      d_sumk = *blank
     c                   eval      d_enhe = sfenhe
     c                   eval      d_anta = *blank
     c                   eval      d_kpri = sfkpri
     c                   eval      d_skaf = '0'
     c                   eval      d_klev = *blank
     c                   eval      d_lmat = '04'
     c                   eval      d_nldo = 0
     c                   eval      d_ldor = sfldor
6.30  *
6.30 c                   eval      d_kfda  = *loval
6.30 c                   eval      d_ktda  = *loval
6.30 c                   eval      d_kamp = sfkamp
6.30 c                   if        d_kamp <> *blank
7.05 c                   eval      w_kamp = sfkamp
7.05 c                   eval      w_vare = sfvare
7.05 c                   eval      w_prgr = sfprgr
7.05 c                   eval      w_lety = sflety
7.05 c                   eval      w_orda = sforda
6.30 c                   exsr      finn_kamp
6.30 c                   endif
6.31 c                   eval      d_benr = %trim(%editc(sfbenr:'Z'))
6.31 c                   eval      d_bsuf = %trim(%editc(sfbsuf:'Z'))
6.31 c                   eval      d_blin = %trim(%editc(sfblin:'Z'))
6.31 c                   eval      d_binr = %trim(%editc(sfbinr:'Z'))
6.31 c                   eval      d_lnav = *blank
6.31 c                   eval      d_sabh = *blank
6.31 c                   eval      d_sabn = *blank
6.31 c                   eval      d_ordr = %trim(%editc(sfornr:'Z'))
6.31 c                   eval      d_orln = %trim(%editc(sforli:'Z'))
6.31 c                   eval      d_koda = sfkoda
6.31 c                   eval      d_koti = sfkoti
     c                   eval      d_bong = sfbong
6.39 c                   eval      d_kild = sfkild
7.01 c                   eval      d_ldat = sfldat
7.01 c                   eval      d_fmat = sflmat
7.01 c                   eval      d_otyp = sfotyp
     c                   eval      d_bdat = 0
     c                   eval      d_edat = 0
      *
     c     *iso0         move      sforda        w_dato
     c                   move      w_dato        d_dato
      *
     c     *iso0         move      sfbida        w_dato
     c                   move      w_dato        d_bdat
      *
6.38 c*                   if        sfdate <> *loval
6.38 c*     *iso0         move      sfdate        w_dato
6.38 c*                   move      w_dato        d_edat
6.38 c                   if        sfpada <> *loval
6.38 c     *iso0         move      sfpada        w_dato
6.38 c                   move      w_dato        d_edat
6.38 c                   else
6.38 c                   eval      d_edat = d_bdat
6.38 c                   endif
8.04  *
8.04  * Leverandør
8.04  *
8.04 c                   if        sfldor <> 0
8.04  *
8.04 c                   eval      w_tell = 0
8.04  *
8.04 c                   eval      jlevl3_enum = sfldor
8.04 c     jlevl3_key    setll     jlevl3
8.04 c     jlevl3_key    reade     jlevl3
8.04 c                   dow       not %eof
8.04 c                   eval      w_tell = w_tell + 1
8.04 c                   if        w_tell > 1
8.04 c                   leave
8.04 c                   endif
8.04 c     jlevl3_key    reade     jlevl3
8.04 c                   enddo
8.04  *
8.04 c                   if        w_tell = 1
8.04 c                   eval      d_nldo = jlldor
8.04 c                   endif
8.04 c                   endif
      *
      * EAN-nummer
      *
6.11  *
6.11  * Kaller program for henting av ean-nr
6.11  *
9.03 c                   eval      d_eann = 0
9.03 c                   if        sfeann <> 0 and
9.03 c                             sfeann < 10000000000000
9.03 c                   eval      d_eann = sfeann
9.03 c                   else
8.04  *
8.04 c                   if        jlldor <> 0 and
8.04 c                             sfvare <> *blank
8.04 c                   eval      jvpkl1_vare = sfvare
8.04 c                   eval      jvpkl1_ldor = jlldor
8.04 c     jvpkl1_key    setll     jvpkl1
8.04 c     jvpkl1_key    reade     jvpkl1
8.04 c                   dow       not %eof
8.04 c                   if        jwenhe = sfenhe and
8.04 c                             jwgtin < 9999999999999
8.04 c                   eval      d_eann = jwgtin
8.04 c                   leave
8.04 c                   ENDIF
8.04 c     jvpkl1_key    reade     jvpkl1
8.04 c                   enddo
8.04 c                   endif
8.04 c                   endif
8.04 c*                   eval      w_enum = 0
8.04 c*/exec sql
8.04 c*+ select jlenum
8.04 c*+ into   :w_enum
8.04 c*+ from   jlevpf
8.04 c*+ inner join jvlepf on jlldor = jvlldo
8.04 c*+ where  jvlvnr = :sfnobb  and
8.04 c*+        jvlvei = 1
8.04 c*+ fetch first 1 rows only
8.04 c*/end-exec
8.04 c*                   if        w_enum <> 0
8.04 c*                   call      'VE713R'
8.04 c*                   parm                    w_firm
8.04 c*                   parm                    w_enum
8.04 c*                   parm                    sfvare
8.04 c*                   parm                    sfenhe
8.04 c*                   parm                    w_eann
8.04 c*                   parm                    w_east
8.04 c*                   if        w_eann < 10000000000000
8.04 c*                   eval      d_eann = w_eann
8.04 c*                   else
8.04 c*                   eval      d_eann = 0
8.04 c*                   endif
8.04 c*                   endif

      *
      * Varegruppe
      *
     c                   move      sfogrp        w_ogrp
     c                   move      sfhgrp        w_hgrp
     c                   move      sfugrp        w_ugrp
     c                   eval      w_vgrp = w_ogrp + w_hgrp + w_ugrp
     c                   move      w_vgrp        d_vgrp
      *
      * Vare-kunde
      *
     c                   eval      rkunl1_kund = sfvkun
     c     rkunl1_key    chain     rkunl1
     c                   if        %found
     c                   eval      d_knav = rknavn
8.01 c     x'05':' '     xlate     d_knav        d_knav
8.01 c     x'0D':' '     xlate     d_knav        d_knav
7.06 c*                  eval      d_kema = rkemal
6.30 c                   eval      d_gate = rkgate
8.01 c     x'05':' '     xlate     d_gate        d_gate
8.01 c     x'0D':' '     xlate     d_gate        d_gate
6.30 c                   movel     rkponr        d_ponr
6.30 c                   eval      d_sted = rksted
     c                   if        rkkatg <> 0
     c                   eval      d_kkat = rkkatg
     c                   eval      ra11pf_kkod = rkkatg
     c     ra11pf_key    chain     ra11pf
     c                   if        %found
     c                   eval      d_ktxt = raktxt
     c                   endif
     c                   endif
     c                   if        rkeank <> 0
     c                   movel     rkeank        d_kean
     c                   endif
     c                   if        rkftnr <> 0
     c                   movel     rkftnr        d_korg
     c                   endif
     c                   endif
7.01  *
7.01  * finner forsendelsesmåte tekst
7.01  *
7.01 c                   eval      ra17l1_qkod = sflmat
7.01 c     ra17l1_key    chain     ra17l1
7.01 c                   if        %found(ra17l1)
7.01 c                   eval      d_lmtx = raqtxt
7.01 c                   else
7.01 c                   eval      d_lmtx = *blank
7.01 c                   endif
      *
      * Faktura-kunde
      *
     c                   eval      rkunl1_kund = sffkun
     c     rkunl1_key    chain     rkunl1
     c                   if        %found
     c                   eval      d_bnav = rknavn
8.01 c     x'05':' '     xlate     d_bnav        d_bnav
8.01 c     x'0D':' '     xlate     d_bnav        d_bnav
     c                   if        rkkatg <> 0
     c                   eval      d_bkka = rkkatg
     c                   eval      ra11pf_kkod = rkkatg
     c     ra11pf_key    chain     ra11pf
     c                   if        %found
     c                   eval      d_bktx = raktxt
     c                   endif
     c                   endif
     c                   if        rkeank <> 0
     c                   movel     rkeank        d_bean
     c                   endif
     c                   if        rkftnr <> 0
     c                   movel     rkftnr        d_borg
     c                   endif
     c                   endif
      *
      * Kundeprosjekt
      *
     c                   if        sfkpro <> 0
     c                   eval      fkprl1_kund = sfvkun
     c                   eval      fkprl1_kpro = sfkpro
     c     fkprl1_key    chain     fkprl1
     c                   if        %found
     c                   eval      d_bpla = flnavn
6.37 c     x'05':' '     xlate     d_bpla        d_bpla
6.37 c     x'0D':' '     xlate     d_bpla        d_bpla
     c                   eval      d_kpnr = flepro
6.37 c     x'05':' '     xlate     d_kpnr        d_kpnr
6.37 c     x'0D':' '     xlate     d_kpnr        d_kpnr
6.30 c                   eval      d_padr = fladr1
6.37 c     x'05':' '     xlate     d_padr        d_padr
6.37 c     x'0D':' '     xlate     d_padr        d_padr
     c                   if        flboku <> 0
     c                   eval      rkunl1_kund = flboku
     c     rkunl1_key    chain     rkunl1
     c                   if        %found
     c                   movel     rkftnr        d_boor
     c                   endif
     c                   endif
     c                   endif
     c                   endif
6.12  *
6.12  * Kundens Dnb-kort-nr
6.12  *
6.12 c                   eval      d_kknr = 0
6.12 c                   eval      rukrl1_kkun = sfvkun
6.12 c                   eval      rukrl1_kpro = sfkpro
6.12 c                   eval      rukrl1_ktyp = 5
6.12 c                   eval      rukrl1_ktsq = 0
6.12 c     rukrl1_key    chain     rukrl1
6.12 c                   if        %found(rukrl1) and
6.12 c                             rukknr <> 0
6.12 c                   eval      d_kknr = rukknr
6.12 c                   else
6.12 c                   eval      rukrl1_kpro = 0
6.12 c     rukrl1_key    chain     rukrl1
6.12 c                   if        %found(rukrl1) and
6.12 c                             rukknr <> 0
6.12 c                   eval      d_kknr = rukknr
6.12 c                   endif
6.12 c                   endif
      *
      * Beløp og antall
      *
     c                   eval      w_sumb = sfsumb
     c                   eval      w_numm = *blank
      *
     c                   if        w_sumb >= 0
     c                   move      w_sumb        w_numm
     c                   else
     c                   eval      w_sumb = w_sumb * -1
     c                   move      w_sumb        w_numm
     c                   movel     '-'           w_numm
     c                   endif
      *
     c                   eval      d_sumb = %subst(w_numm:1:10) + ',' +
     c                                      %subst(w_numm:11:2)
      *
     c                   eval      w_sumr = sfrab1 + sfrab2 + sfrabo
     c                   eval      w_numm = *blank
      *
     c                   if        w_sumr >= 0
     c                   move      w_sumr        w_numm
     c                   else
     c                   eval      w_sumr = w_sumr * -1
     c                   move      w_sumr        w_numm
     c                   movel     '-'           w_numm
     c                   endif
      *
     c                   eval      d_sumr = %subst(w_numm:1:10) + ',' +
     c                                      %subst(w_numm:11:2)
      *
     c                   eval      w_sumn = sfsumb -
     c                                      sfrab1 - sfrab2 - sfrabo
     c                   eval      w_numm = *blank
      *
     c                   if        w_sumn >= 0
     c                   move      w_sumn        w_numm
     c                   else
     c                   eval      w_sumn = w_sumn * -1
     c                   move      w_sumn        w_numm
     c                   movel     '-'           w_numm
     c                   endif
      *
     c                   eval      d_sumn = %subst(w_numm:1:10) + ',' +
     c                                      %subst(w_numm:11:2)
      *
     c                   eval      w_sumk = sfsumk
     c                   eval      w_numm = *blank
      *
     c                   if        w_sumk >= 0
     c                   move      w_sumk        w_numm
     c                   else
     c                   eval      w_sumk = w_sumk * -1
     c                   move      w_sumk        w_numm
     c                   movel     '-'           w_numm
     c                   endif
      *
     c                   eval      d_sumk = %subst(w_numm:1:10) + ',' +
     c                                      %subst(w_numm:11:2)
      *
     c                   eval      w_anta = sfanta
     c                   eval      w_numm = *blank
      *
     c                   if        w_anta >= 0
     c                   move      w_anta        w_numm
     c                   else
     c                   eval      w_anta = w_anta * -1
     c                   move      w_anta        w_numm
     c                   movel     '-'           w_numm
     c                   endif
      *
     c                   eval      d_anta = %subst(w_numm:1:9) + ',' +
     c                                      %subst(w_numm:10:3)
      *
      * Skaffevare
      *
     c                   if        sfvtyp = 'S'
     c                   eval      d_skaf = '1'
     c                   endif
      *
      * Leveringsmåte
      *
     c                   if        sflety = 1
     c                   eval      d_lmat = '02'
     c                   endif
8.04  **
8.04  ** Leverandør
8.04  **
8.04 c*                   if        sfldor <> 0
8.04  **
8.04 c*                   eval      w_tell = 0
8.04  **
8.04 c*                   eval      jlevl3_enum = sfldor
8.04 c*     jlevl3_key    setll     jlevl3
8.04 c*     jlevl3_key    reade     jlevl3
8.04 c*                   dow       not %eof
8.04 c*                   eval      w_tell = w_tell + 1
8.04 c*                   if        w_tell > 1
8.04 c*                   leave
8.04 c*                   endif
8.04 c*     jlevl3_key    reade     jlevl3
8.04 c*                   enddo
8.04  **
8.04 c*                   if        w_tell = 1
8.04 c*                   eval      d_nldo = jlldor
8.04 c*                   endif
      *
     c                   eval      rlevl1_levr = sfldor
     c     rlevl1_key    chain     rlevl1
     c                   if        %found
     c                   eval      d_lnav = rlnavn
     c                   endif
      *
      * Saksbehandler
      *
     c                   if        sfselg <> 0
     c                   eval      d_sabh = %trim(%editc(sfselg:'Z'))
     c                   eval      ra09l1_ikod = sfselg
     c     ra09l1_key    chain     ra09l1
     c                   if        %found
     c                   eval      d_sabn = raitxt
     c                   endif
     c                   endif
      *
      * nye felter
      *
     c                   eval      d_pakk = *blank
     c                   eval      d_suff = *blank
8.06  * konvertere små æøå til store ÆØÅ
8.06 c     x'C0':'Æ'     xlate     d_stat        d_stat
8.06 c     x'6A':'Ø'     xlate     d_stat        d_stat
8.06 c     x'D0':'Å'     xlate     d_stat        d_stat
8.05  * konvertere fremmede hexverdier
8.05 c     x'3F':' '     xlate     d_stat        d_stat
8.05 c     x'2A':' '     xlate     d_stat        d_stat
8.05 c     x'1C':' '     xlate     d_stat        d_stat
8.05 c     x'1A':' '     xlate     d_stat        d_stat
8.05 c     x'05':' '     xlate     d_stat        d_stat
8.05 c     x'00':' '     xlate     d_stat        d_stat
8.05 c     x'41':' '     xlate     d_stat        d_stat
8.05 c     x'36':' '     xlate     d_stat        d_stat
8.05 c     x'35':' '     xlate     d_stat        d_stat
8.05 c     x'30':' '     xlate     d_stat        d_stat
8.05 c     x'28':' '     xlate     d_stat        d_stat
8.05 c     x'22':' '     xlate     d_stat        d_stat
8.05  *
      * Skriver til fil
      *
     c                   eval      no_rad = d_stat
      *
     c                   write     sonopfr
      *
      * Merker salget med at det er rapportert
      *
     c                   eval      sferap = 1
      *
     c                   update    sstalhr
      *
     c                   endsr
6.13  *
6.14  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.14  * Subrutine for å danne pakksedler, legger ut i samme format
6.14  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.14  *
6.14 c     pakkseddel    begsr
6.14  *
6.14 c                   eval      w_da01 = %date
6.14 c     w_da01        subdur    1:*months     w_da01
6.14  *
6.14 c                   eval      foheld_bdat = w_da01
6.14 c     foheld_key    setll     foheld
6.14 c                   read      foheld
6.14  *
6.14 c                   dow       not %eof(foheld)
6.14  *
6.14 c                   if        fobdat >= w_da01
6.14  *  sjekker ordretype
6.14 c                   eval      votyl1_otyp = footyp
6.14 c     votyl1_key    chain     votyl1
6.14 c                   if        %found(votyl1) and
6.32 c                             vaoakk > 0
      *
6.14  * leser alle varer på ordre
6.14 c                   eval      fodtl1_numm = fonumm
6.14 c                   eval      fodtl1_suff = fosuff
6.14 c     fodtl1_key    setll     fodtl1
6.14 c     fodtl1_key    reade     fodtl1
6.14 c                   dow       not %eof(fodtl1)
6.14  *
6.14  * Sjekker om lager er overstyrt på linjenivå - henter avdeling
6.14  *
6.14 c                   eval      w_avde = foavde
6.14  *
6.14 c                   if        fdlage <> folage
6.14 c                   eval      b_feil = *off
6.14 c                   call      'FÅ720R'
6.14 c                   parm                    w_firm
6.14 c                   parm                    fdlage
6.14 c                   parm                    w_latx
6.14 c                   parm                    w_adrs
6.14 c                   parm                    w_ponr
6.14 c                   parm                    w_pste
6.14 c                   parm                    w_avde
6.14 c                   parm                    b_feil
6.14 c                   endif
      *
6.14  * sjekker avdeling
      *
6.14 c                   if        d_avde <> 0 and
6.14 c                             d_avde <> w_avde
6.14 c                   goto      nxt_fodt
6.14 c                   endif
      *
      *
      *
6.35 c                   if        fdvare <> *blank
6.14 c                   exsr      dann_pakk
6.35 c                   endif
6.14  *
6.14 c     nxt_fodt      tag
6.14  *
6.14 c     fodtl1_key    reade     fodtl1
6.14 c                   enddo
6.14  *
6.14 c                   endif
6.14  *
6.14 c                   endif
6.14  *
6.14 c                   read      foheld
6.14 c                   enddo
6.14  *
6.14 c                   endsr
6.13  *
6.13  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.13  * Subrutine for å danne pakkseddel
6.13  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.13  *
6.13 c     dann_pakk     begsr
6.32  *
6.32 c                   eval      d_stat = *blank
6.32  *
6.13  *
6.13 c                   eval      vvarl1_vare = fdvare
6.13 c     vvarl1_key    chain     vvarl1
6.13  *
6.13  * Henter statistikkinformasjon
6.13  *
6.32 c                   move      vaoakk        d_oakk
6.13 c                   eval      d_nobb = fdnobb
6.13 c                   eval      d_eann = 0
6.13 c                   eval      d_mean = l_fnav
6.13 c                   eval      d_vare = fdvare
6.13 c                   eval      d_tek1 = fdtek1
6.21 c     x'05':' '     xlate     d_tek1        d_tek1
6.36 c     x'0D':' '     xlate     d_tek1        d_tek1
6.13 c                   eval      d_vgrp = 0
6.13 c                   if        folkun <> 0
6.13 c                   eval      d_kund = folkun
6.13 c                   else
6.13 c                   eval      d_kund = fokund
6.13 c                   endif
6.13 c                   eval      d_knav = *blank
6.13 c                   eval      d_kean = *blank
6.13 c                   eval      d_korg = *blank
6.13 c                   eval      d_kkat = 0
6.13 c                   eval      d_ktxt = *blank
6.13 c                   eval      d_bkun = fokund
6.13 c                   eval      d_bnav = *blank
6.13 c                   eval      d_bean = *blank
6.13 c                   eval      d_borg = *blank
6.13 c                   eval      d_bkka = 0
6.13 c                   eval      d_bktx = *blank
6.13 c                   eval      d_boor = *blank
6.13 c                   eval      d_kjed = *blank
6.13 c                   eval      d_bpla = *blank
6.13 c                   eval      d_kpnr = *blank
6.13 c                   eval      d_dato = 0
6.13 c                   eval      d_sumb = *blank
6.13 c                   eval      d_sumr = *blank
6.13 c                   eval      d_sumn = *blank
6.13 c                   eval      d_sumk = *blank
7.03 c                   eval      d_enhe = fdenh1
6.13 c                   eval      d_anta = *blank
6.13 c                   eval      d_kpri = fdkpri
6.13 c                   eval      d_skaf = '0'
6.13 c                   eval      d_klev = *blank
6.13 c                   eval      d_lmat = '04'
6.13 c                   eval      d_nldo = 0
6.13 c                   eval      d_ldor = fdldor
6.13 c                   eval      d_lnav = *blank
6.13 c                   eval      d_sabh = *blank
6.13 c                   eval      d_sabn = *blank
6.13 c                   eval      d_ordr = %trim(%editc(fdnumm:'Z'))
6.13 c                   eval      d_orln = %trim(%editc(fdline:'Z'))
6.13 c                   eval      d_suff = %trim(%editc(fdsuff:'Z'))
6.13 c                   eval      d_bong = *blank
6.39 c                   if        fofsys <> *blank
6.39 c                   eval      d_kild = fofsys
6.39 c                   else
6.39 c                   eval      d_kild = 'ORD'
6.39 c                   endif
7.03 c                   if        fdldat <> *loval
7.01 c                   eval      d_ldat = fdldat
7.03 c                   else
7.03 c                   eval      d_ldat = foldat
7.03 c                   endif
7.01 c                   eval      d_fmat = folmat
7.01 c                   eval      d_lmtx = folmtx
7.01 c                   eval      d_otyp = footyp
6.13 c                   eval      d_bdat = 0
6.13 c                   eval      d_edat = 0
6.38 c                   if        d_oakk = '1'
6.38 c                   if        fobdat <> *loval
6.38 c     *iso0         move      fobdat        w_dato
6.38 c                   move      w_dato        d_edat
6.38 c                   endif
6.38 c                   endif
6.38 c                   if        d_oakk = '2'
6.38 c                   if        fopada <> *loval
6.38 c     *iso0         move      fopada        w_dato
6.38 c                   move      w_dato        d_edat
6.38 c                   endif
6.38 c                   endif
6.38 c                   if        d_edat = 0
6.38 c     *iso0         move      w_ddat        w_dato
6.38 c                   move      w_dato        d_edat
6.38 c                   endif
      *
6.32 c                   eval      d_binr = *blank
6.33 c                   eval      d_benr = %trim(%editc(fdbenr:'Z'))
6.33 c                   eval      d_bsuf = %trim(%editc(fdbsuf:'Z'))
6.33 c                   eval      d_blin = %trim(%editc(fdblin:'Z'))
6.13  *
6.13 c     *iso0         move      fobdat        w_dato
6.13 c                   move      w_dato        d_dato
6.13  *
6.32 c*    *iso0         move      fofkda        w_dato
6.32 c*                  move      w_dato        d_bdat
6.13  *
6.13 c                   time                    w_date
6.13 c                   if        foedat <> *loval
6.13 c     *iso0         move      foedat        w_dato
6.13 c                   move      w_dato        d_bdat
6.32 c                   endif
6.32 c*                  eval      d_edat = d_bdat
6.32 c*                  endif
8.04  *
8.04  * Leverandør
8.04  *
8.04 c                   if        fdldor <> 0
8.04  *
8.04 c                   eval      w_tell = 0
8.04  *
8.04 c                   eval      jlevl3_enum = fdldor
8.04 c     jlevl3_key    setll     jlevl3
8.04 c     jlevl3_key    reade     jlevl3
8.04 c                   dow       not %eof
8.04 c                   eval      w_tell = w_tell + 1
8.04 c                   if        w_tell > 1
8.04 c                   leave
8.04 c                   endif
8.04 c     jlevl3_key    reade     jlevl3
8.04 c                   enddo
     c                   endif
6.13  *
6.13  * EAN-nummer
6.13  *
6.13  *
6.13  * Kaller program for henting av ean-nr
6.13  *
9.03 c                   eval      d_eann = 0
9.03 c                   if        fdeann <> 0 and
9.03 c                             fdeann < 10000000000000
9.03 c                   eval      d_eann = fdeann
9.03 c                   else
8.04 c                   if        jlldor <> 0 and
8.04 c                             fdvare <> *blank
8.04 c                   eval      jvpkl1_vare = fdvare
8.04 c                   eval      jvpkl1_ldor = jlldor
8.04 c     jvpkl1_key    setll     jvpkl1
8.04 c     jvpkl1_key    reade     jvpkl1
8.04 c                   dow       not %eof
8.04 c                   if        jwenhe = fdenh1  and
8.04 c                             jwgtin < 9999999999999
8.04 c                   eval      d_eann = jwgtin
8.04 c                   leave
8.04 c                   ENDIF
8.04 c     jvpkl1_key    reade     jvpkl1
8.04 c                   enddo
8.04 c                   endif
8.04 c                   endif
8.04 c*                   eval      w_enum = 0
8.04 c*/exec sql
8.04 c*+ select jlenum
8.04 c*+ into   :w_enum
8.04 c*+ from   jlevpf
8.04 c*+ inner join jvlepf on jlldor = jvlldo
8.04 c*+ where  jvlvnr = :fdnobb  and
8.04 c*+        jvlvei = 1
8.04 c*+ fetch first 1 rows only
8.04 c*/end-exec
8.04 c*                   if        w_enum <> 0
8.04 c*                   call      'VE713R'
8.04 c*                   parm                    w_firm
8.04 c*                   parm                    w_enum
8.04 c*                   parm                    fdvare
8.04 c*                   parm                    fdenh1
8.04 c*                   parm                    w_eann
8.04 c*                   parm                    w_east
8.04 c*                   if        w_eann < 10000000000000
8.04 c*                   eval      d_eann = w_eann
8.04 c*                   else
8.04 c*                   eval      d_eann = 0
8.04 c*                   endif
8.04 c*                   endif
6.13  *
6.13  * Varegruppe
6.13  *
6.13 c                   move      fdogrp        w_ogrp
6.13 c                   move      fdhgrp        w_hgrp
6.13 c                   move      fdugrp        w_ugrp
6.13 c                   eval      w_vgrp = w_ogrp + w_hgrp + w_ugrp
6.13 c                   move      w_vgrp        d_vgrp
6.13  *
6.13  * Vare-kunde
6.13  *
6.13 c                   eval      rkunl1_kund = d_kund
6.13 c     rkunl1_key    chain     rkunl1
6.13 c                   if        %found
6.13 c                   eval      d_knav = rknavn
8.01 c     x'05':' '     xlate     d_knav        d_knav
8.01 c     x'0D':' '     xlate     d_knav        d_knav
6.30 c                   eval      d_gate = rkgate
8.01 c     x'05':' '     xlate     d_gate        d_gate
8.01 c     x'0D':' '     xlate     d_gate        d_gate
6.30 c                   movel     rkponr        d_ponr
6.30 c                   eval      d_sted = rksted
7.06 c*                  eval      d_kema = rkemal
6.13 c                   if        rkkatg <> 0
6.13 c                   eval      d_kkat = rkkatg
6.13 c                   eval      ra11pf_kkod = rkkatg
6.13 c     ra11pf_key    chain     ra11pf
6.13 c                   if        %found
6.13 c                   eval      d_ktxt = raktxt
6.13 c                   endif
6.13 c                   endif
6.13 c                   if        rkeank <> 0
6.13 c                   movel     rkeank        d_kean
6.13 c                   endif
6.13 c                   if        rkftnr <> 0
6.13 c                   movel     rkftnr        d_korg
6.13 c                   endif
6.13 c                   endif
7.01 c                   eval      ra17l1_qkod = folmat
7.01 c     ra17l1_key    chain     ra17l1
7.01 c                   if        %found(ra17l1)
7.01 c                   eval      d_lmtx = raqtxt
7.01 c                   else
7.01 c                   eval      d_lmtx = *blank
7.01 c                   endif
6.13  *
6.13  * Faktura-kunde
6.13  *
6.13 c                   eval      rkunl1_kund = d_bkun
6.13 c     rkunl1_key    chain     rkunl1
6.13 c                   if        %found
6.13 c                   eval      d_bnav = rknavn
8.01 c     x'05':' '     xlate     d_bnav        d_bnav
8.01 c     x'0D':' '     xlate     d_bnav        d_bnav
6.13 c                   if        rkkatg <> 0
6.13 c                   eval      d_bkka = rkkatg
6.13 c                   eval      ra11pf_kkod = rkkatg
6.13 c     ra11pf_key    chain     ra11pf
6.13 c                   if        %found
6.13 c                   eval      d_bktx = raktxt
6.13 c                   endif
6.13 c                   endif
6.13 c                   if        rkeank <> 0
6.13 c                   movel     rkeank        d_bean
6.13 c                   endif
6.13 c                   if        rkftnr <> 0
6.13 c                   movel     rkftnr        d_borg
6.13 c                   endif
6.13 c                   endif
6.13  *
6.13  * Kundeprosjekt
6.13  *
6.13 c                   if        fokpro <> 0
6.13 c                   eval      fkprl1_kund = d_kund
6.13 c                   eval      fkprl1_kpro = fokpro
6.13 c     fkprl1_key    chain     fkprl1
6.13 c                   if        %found
6.13 c                   eval      d_bpla = flnavn
6.37 c     x'05':' '     xlate     d_bpla        d_bpla
6.37 c     x'0D':' '     xlate     d_bpla        d_bpla
6.13 c                   eval      d_kpnr = flepro
6.37 c     x'05':' '     xlate     d_kpnr        d_kpnr
6.37 c     x'0D':' '     xlate     d_kpnr        d_kpnr
6.30 c                   eval      d_padr = fladr1
6.37 c     x'05':' '     xlate     d_padr        d_padr
6.37 c     x'0D':' '     xlate     d_padr        d_padr
6.13 c                   if        flboku <> 0
6.13 c                   eval      rkunl1_kund = flboku
6.13 c     rkunl1_key    chain     rkunl1
6.13 c                   if        %found
6.13 c                   movel     rkftnr        d_boor
6.13 c                   endif
6.13 c                   endif
6.13 c                   endif
6.13 c                   endif
6.13  *
6.13  * Kundens Dnb-kort-nr
6.13  *
6.13 c                   eval      d_kknr = 0
6.13 c                   eval      rukrl1_kkun = d_kund
6.13 c                   eval      rukrl1_kpro = fokpro
6.13 c                   eval      rukrl1_ktyp = 5
6.13 c                   eval      rukrl1_ktsq = 0
6.13 c     rukrl1_key    chain     rukrl1
6.13 c                   if        %found(rukrl1) and
6.13 c                             rukknr <> 0
6.13 c                   eval      d_kknr = rukknr
6.13 c                   else
6.13 c                   eval      rukrl1_kpro = 0
6.13 c     rukrl1_key    chain     rukrl1
6.13 c                   if        %found(rukrl1) and
6.13 c                             rukknr <> 0
6.13 c                   eval      d_kknr = rukknr
6.13 c                   endif
6.13 c                   endif
7.05  * legger ut kamp.kode
7.05 c                   eval      d_kamp = *blank
7.05 c                   eval      d_kfda = *loval
7.05 c                   eval      d_ktda = *loval
7.05 c                   eval      d_kamp = fdkamp
7.05 c                   if        d_kamp <> *blank
7.05 c                   eval      w_kamp = fdkamp
7.05 c                   eval      w_vare = fdvare
7.05 c                   eval      w_prgr = fdprgr
7.05 c                   eval      w_lety = fdlety
7.05 c                   if        fobdat <> *loval
7.05 c                   eval      w_orda = fobdat
7.05 c                   else
7.05 c                   eval      w_orda = fdodat
7.05 c                   endif
7.05 c                   exsr      finn_kamp
7.05 c                   endif
7.02  *
7.02  * henter linje type for å sjekke om det påvirker fortegn
7.02 c                   eval      vltyl1_ltyp = fdltyp
7.02 c     vltyl1_key    chain     vltyl1r                            90
6.13  *
6.13  * Beløp og antall
6.13  *
6.13 c                   eval      w_sumb = fdsapr * fdanta
6.13 c                   eval      w_numm = *blank
7.02  * setter evt. på fortegn hvis neg. ordre
7.02 c                   if        vaokre = '-'
7.02 c                   eval      w_sumb = w_sumb * -1
7.02 c                   endif
7.02 c                   if        valktx = 0 and valkre = '-'
7.02 c                   eval      w_sumb = w_sumb * -1
7.02 c                   endif
6.13  *
6.13 c                   if        w_sumb >= 0
6.13 c                   move      w_sumb        w_numm
6.13 c                   else
6.13 c                   eval      w_sumb = w_sumb * -1
6.13 c                   move      w_sumb        w_numm
6.13 c                   movel     '-'           w_numm
6.13 c                   endif
6.13  *
6.13 c                   eval      d_sumb = %subst(w_numm:1:10) + ',' +
6.13 c                                      %subst(w_numm:11:2)
7.04  * setter av evt. fortegn av for videre beregning
7.04 c*                   if        vaokre = '-'
7.04 c*                   eval      w_sumb = w_sumb * -1
7.04 c*                   endif
7.04 c*                   if        valktx = 0 and valkre = '-'
7.04 c*                   eval      w_sumb = w_sumb * -1
7.04 c*                   endif
7.04  * setter w_sumb på nytt
7.04 c                   eval      w_sumb = fdsapr * fdanta
6.13  *
6.13  *Beregner sfrab1, sfrab2 og sfrabo
6.13  *
6.13 c                   eval(h)   w_rkr1 = (w_sumb * fdrab1) / 100
6.13 c                   eval      w_belw =  w_sumb - w_rkr1
6.13 c                   eval(h)   w_rkr2 = (w_belw * fdrab2) / 100
6.13 c                   eval      w_beln = fdsums - w_rkr1 - w_rkr2
6.13 c                   if        vvkord = 0
6.13 c                   eval(h)   w_rkro = (w_beln * forabp) / 100
6.13 c                   endif
6.13  *
6.13  *
6.13 c                   eval      w_sumr = w_rkr1 + w_rkr2 + w_rkro
6.13 c                   eval      w_numm = *blank
7.04  * setter  evt. på fortegn hvis neg. ordre
7.02 c                   if        vaokre = '-'
7.02 c                   eval      w_sumr = w_sumr * -1
7.02 c                   endif
7.02 c                   if        valktx = 0 and valkre = '-'
7.02 c                   eval      w_sumr = w_sumr * -1
7.02 c                   endif
6.13  *
6.13 c                   if        w_sumr >= 0
6.13 c                   move      w_sumr        w_numm
6.13 c                   else
6.13 c                   eval      w_sumr = w_sumr * -1
6.13 c                   move      w_sumr        w_numm
6.13 c                   movel     '-'           w_numm
6.13 c                   endif
6.13  *
6.13 c                   eval      d_sumr = %subst(w_numm:1:10) + ',' +
6.13 c                                      %subst(w_numm:11:2)
6.13  *
7.04  * setter av evt. fortegn av for videre beregning
7.04 c*                   if        vaokre = '-'
7.04 c*                   eval      w_sumr = w_sumr * -1
7.04 c*                   endif
7.04 c*                   if        valktx = 0 and valkre = '-'
7.04 c*                   eval      w_sumr = w_sumr * -1
7.04 c*                   endif
      *
6.13 c                   eval      w_sumn = (fdsapr * fdanta) -
6.13 c                                      w_rkr1 - w_rkr2 - w_rkro
6.13 c                   eval      w_numm = *blank
7.02  * setter evt. på fortegn hvis neg. ordre
7.02 c                   if        vaokre = '-'
7.02 c                   eval      w_sumn = w_sumn * -1
7.02 c                   endif
7.02 c                   if        valktx = 0 and valkre = '-'
7.02 c                   eval      w_sumn = w_sumn * -1
7.02 c                   endif
6.13  *
6.13 c                   if        w_sumn >= 0
6.13 c                   move      w_sumn        w_numm
6.13 c                   else
6.13 c                   eval      w_sumn = w_sumn * -1
6.13 c                   move      w_sumn        w_numm
6.13 c                   movel     '-'           w_numm
6.13 c                   endif
6.13  *
6.13 c                   eval      d_sumn = %subst(w_numm:1:10) + ',' +
6.13 c                                      %subst(w_numm:11:2)
6.13  *
7.02  * setter evt. fortegn av for videre beregning
7.04 c*                   if        vaokre = '-'
7.04 c*                   eval      w_sumn = w_sumn * -1
7.04 c*                   endif
7.04 c*                   if        valktx = 0 and valkre = '-'
7.04 c*                   eval      w_sumn = w_sumn * -1
7.04 c*                   endif
      *
6.13 c                   eval      w_sumk = fdkopr * fdanta
6.13 c                   eval      w_numm = *blank
7.02  * setter evt. på fortegn hvis neg. ordre
7.02 c                   if        vaokre = '-'
7.02 c                   eval      w_sumk = w_sumk * -1
7.02 c                   endif
7.02 c                   if        valktx = 0 and valkre = '-'
7.02 c                   eval      w_sumk = w_sumk * -1
7.02 c                   endif
6.13  *
6.13 c                   if        w_sumk >= 0
6.13 c                   move      w_sumk        w_numm
6.13 c                   else
6.13 c                   eval      w_sumk = w_sumk * -1
6.13 c                   move      w_sumk        w_numm
6.13 c                   movel     '-'           w_numm
6.13 c                   endif
6.13  *
6.13 c                   eval      d_sumk = %subst(w_numm:1:10) + ',' +
6.13 c                                      %subst(w_numm:11:2)
7.02  * setter evt. fortegn av for videre beregning
7.04 c*                   if        vaokre = '-'
7.04 c*                   eval      w_sumk = w_sumk * -1
7.04 c*                   endif
7.04 c*                   if        valktx = 0 and valkre = '-'
7.04 c*                   eval      w_sumk = w_sumk * -1
7.04 c*                   endif
7.02  *
7.02  * teste på ordretype vaokre
7.02  *
7.02 c                   if        vaokre = '-'
7.02 c                   eval      fdanta = fdanta * -1
7.02 c                   endif
7.02 c                   if        valktx = 0 and valkre = '-'
7.02 c                   eval      fdanta = fdanta * -1
7.02 c                   endif
      *
6.13 c                   eval      w_anta = fdanta
6.13 c                   eval      w_numm = *blank
6.13  *
6.13 c                   if        w_anta >= 0
6.13 c                   move      w_anta        w_numm
6.13 c                   else
6.13 c                   eval      w_anta = w_anta * -1
6.13 c                   move      w_anta        w_numm
6.13 c                   movel     '-'           w_numm
6.13 c                   endif
6.13  *
6.13 c                   eval      d_anta = %subst(w_numm:1:9) + ',' +
6.13 c                                      %subst(w_numm:10:3)
6.13  *
6.13  *
6.13  * Kaller program for henting av varetype
6.13  *
6.13 c                   call      'VL710R'
6.13 c                   parm                    w_firm
6.13 c                   parm                    fdvare
6.13 c                   parm                    fdlage
6.13 c                   parm                    w_vtyp
6.20 c                   parm                    w_udat
6.20 c                   parm                    w_ldor
6.20 c                   parm                    b_inlr
6.38 c                   parm                    w_lv_nobb
6.38 c                   parm                    w_lv_modn
6.38 c                   parm                    w_lv_lldo
6.38 c                   parm                    w_lv_llva
6.13  *
6.13 c                   if        w_vtyp = 'S'
6.13 c                   eval      d_skaf = '1'
6.13 c                   endif
6.13  *
6.13  * Leveringsmåte
6.13  *
6.13 c                   if        fdlety = 1
6.13 c                   eval      d_lmat = '02'
6.13 c                   endif
8.04  **
8.04  ** Leverandør
8.04  **
8.04 c*                   if        fdldor <> 0
8.04  **
8.04 c*                   eval      w_tell = 0
8.04  **
8.04 c*                   eval      jlevl3_enum = fdldor
8.04 c*     jlevl3_key    setll     jlevl3
8.04 c*     jlevl3_key    reade     jlevl3
8.04 c*                   dow       not %eof
8.04 c*                   eval      w_tell = w_tell + 1
8.04 c*                   if        w_tell > 1
8.04 c*                   leave
8.04 c*                   endif
8.04 c*     jlevl3_key    reade     jlevl3
8.04 c*                   enddo
6.13  *
6.13 c                   if        w_tell = 1
6.13 c                   eval      d_nldo = jlldor
6.13 c                   endif
6.13  *
6.13 c                   eval      rlevl1_levr = fdldor
6.13 c     rlevl1_key    chain     rlevl1
6.13 c                   if        %found
6.13 c                   eval      d_lnav = rlnavn
6.13 c                   endif
6.13  *
6.13 c*                   endif
6.13  *
6.13  * Saksbehandler
6.13  *
6.13 c                   if        foselg <> 0
6.13 c                   eval      d_sabh = %trim(%editc(foselg:'Z'))
6.13 c                   eval      ra09l1_ikod = foselg
6.13 c     ra09l1_key    chain     ra09l1
6.13 c                   if        %found
6.13 c                   eval      d_sabn = raitxt
6.13 c                   endif
6.13 c                   endif
6.13  *
6.13  * nye felter
6.13  *
6.13 c                   eval      d_pakk = 'P'
6.13 c                   move      fdsuff        d_suff
8.06  * konvertere små æøå til store ÆØÅ
8.06 c     x'C0':'Æ'     xlate     d_stat        d_stat
8.06 c     x'6A':'Ø'     xlate     d_stat        d_stat
8.06 c     x'D0':'Å'     xlate     d_stat        d_stat
8.05  * konvertere fremmede hexverdier
8.05 c     x'3F':' '     xlate     d_stat        d_stat
8.05 c     x'2A':' '     xlate     d_stat        d_stat
8.05 c     x'1C':' '     xlate     d_stat        d_stat
8.05 c     x'1A':' '     xlate     d_stat        d_stat
8.05 c     x'05':' '     xlate     d_stat        d_stat
8.05 c     x'00':' '     xlate     d_stat        d_stat
8.05 c     x'41':' '     xlate     d_stat        d_stat
8.05 c     x'36':' '     xlate     d_stat        d_stat
8.05 c     x'35':' '     xlate     d_stat        d_stat
8.05 c     x'30':' '     xlate     d_stat        d_stat
8.05 c     x'28':' '     xlate     d_stat        d_stat
8.05 c     x'22':' '     xlate     d_stat        d_stat
6.13  *
6.13  * Skriver til fil
6.13  *
6.13 c                   eval      no_rad = d_stat
6.13  *
6.13 c                   write     sonopfr
6.13  *
6.13  *
6.13 c                   endsr
6.30  *
6.30  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  * Subrutine for å finne tilbud
6.30  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.30  *
6.30 c     finn_kamp     begsr
6.30  *
7.05 c                   eval      vtill5_kamp = w_kamp
7.05 c                   eval      vtill5_vare = w_vare
7.05 c                   eval      vtill5_prgr = w_prgr
7.05 c                   eval      vtill5_lety = w_lety
6.30 c     vtill5_key    setll     vtill5
6.30 c     vtill5_key    reade     vtill5
6.30 c                   dow       not %eof(vtill5)
7.05 c                   if        w_orda >= vtfdat and
7.05 c                             w_orda <= vttdat
     c                   eval      d_kfda = vtfdat
     c                   eval      d_ktda = vttdat
6.30 c                   leavesr
6.30 c                   endif
6.30 c     vtill5_key    reade     vtill5
6.30 c                   enddo
6.30  *
6.30 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_list
      *
      * Key for les på salgsstatistikk
      *
     c     sstalh_key    klist
     c                   kfld                    w_firm
     c                   kfld                    sstalh_erap
      *
     c     sstalh_key2   klist
     c                   kfld                    w_firm
      *
      * Key for les på leverandør LVR
      *
     c     jlevl3_key    klist
     c                   kfld                    jlevl3_enum
      *
      * Key for oppslag på kunde
      *
     c     rkunl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl1_kund
      *
      * Key for oppslag på leverandør
      *
     c     rlevl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl1_levr
      *
      * Key for oppslag på avdeling
      *
     c     ra07l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ra07l1_gkod
      *
      * Key for oppslag på selger
      *
     c     ra09l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ra09l1_ikod
      *
      * Key for oppslag på kundekategori
      *
     c     ra11pf_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ra11pf_kkod
7.01  *
7.01  * Key for oppslag på Forsendelsesmåte
7.01  *
7.01 c     ra17l1_key    klist
7.01 c                   kfld                    w_firm
7.01 c                   kfld                    ra17l1_qkod
6.12  *
6.12  * Key for oppslag på kunde kort register
6.12  *
6.12 c     rukrl1_key    klist
6.12 c                   kfld                    w_firm
6.12 c                   kfld                    rukrl1_kkun
6.12 c                   kfld                    rukrl1_kpro
6.12 c                   kfld                    rukrl1_ktyp
6.12 c                   kfld                    rukrl1_ktsq
      *
      * Key for oppslag på kunde-prosjekt
      *
     c     fkprl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fkprl1_kund
     c                   kfld                    fkprl1_kpro
6.13  *
6.13  * Key les på ordre-linje
6.13  *
6.13 c     fodtl1_key    klist
6.13 c                   kfld                    w_firm
6.13 c                   kfld                    fodtl1_numm
6.13 c                   kfld                    fodtl1_suff
6.13  *
6.13  * Key oppslag på ordre-hode
6.13  *
6.13 c     foheld_key    klist
6.13 c                   kfld                    w_firm
6.13 c                   kfld                    foheld_bdat
6.13  *
6.13  * Key oppslag på ordre-type
6.13  *
6.13 c     votyl1_key    klist
6.13 c                   kfld                    w_firm
6.13 c                   kfld                    votyl1_otyp
7.02  *
7.02  * Key for file : LINJE-TYPE-REGISTER
7.02  *
7.02 c     vltyl1_key    klist
7.02 c                   kfld                    w_firm
7.02 c                   kfld                    vltyl1_ltyp
6.13  *
6.13  * Key oppslag på vare
6.13  *
6.13 c     vvarl1_key    klist
6.13 c                   kfld                    w_firm
6.13 c                   kfld                    vvarl1_vare
6.30  *
6.30  * Key oppslag på tilbud
6.30  *
6.30 c     vtill5_key    klist
6.30 c                   kfld                    w_firm
6.30 c                   kfld                    vtill5_kamp
6.30 c                   kfld                    vtill5_vare
6.30 c                   kfld                    vtill5_prgr
6.30 c                   kfld                    vtill5_lety
8.04  *
8.04  * Key for les på vare pakning
8.04  *
8.04 c     jvpkl1_key    klist
8.04 c                   kfld                    jvpkl1_vare
8.04 c                   kfld                    jvpkl1_ldor
      *
      *
      * Kopierer parameter tildatastruktur
      *
     c                   eval      d_list = p_list
      *
     c                   eval      w_firm = d_firm
      *
     c                   endsr
