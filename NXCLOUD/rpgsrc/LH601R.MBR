pdf  h option(*nodebugio) datedit(*dmy.) decedit('0.')
pdf  h DftActgrp(*No) BndDir('CGIDEV2/CGIDEV2')
pdf   /copy hspecsbnd
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASLAGR
      * Program . . . . : LH601R
      * Beskrivelse . . : Utskrift av bestilling-forslag - forslagsnr.sort
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset Lor . :
      *
      * Referanse  Dato   Endringsbeskrivelse                      Sign.
      * --------- ------  --------------------------------------------------
      *           240100  Nytt program                             ASK
      *           120307  Utvidet med noen felter                  BOF
      *           300707  Noe info til toppen og endring på
      *                   feltrekkefølge (ønske fra Zeiner)        BOF
      *           020807  Ønsket også beløpsgense fra parm i heading
6.10  * R6.10 130710 bsa  Lagt inn omsetning siste 3 måneder + abc koden
6.10  *                   fra lager.
pdf   * R6.10 130710 bsa  Lagt inn funksjonalitet for eksport til XML
pdf   *                   format for videre arkivering og utskrift.
6.11  * R6.10 011010 bsa  Tillegg av faste tagger. Display tag + ordrenummer
6.11  *                   hvis den finnes.
6.12  * R6.10 011010 bsa  Hvis konvtertering av spesialtegn, legges til flere tegn
6.12  *                   som kan gjøre at noen av disse faller utenfor pga av felt-
6.12  *                   lengde.
6.13  * R6.10 071010 bsa  Legger inn test om gyldig utkø. Hvis ikke, legger vi ikke
6.13  *                   ut "printer kommand" tagger.
6.14  * R6.10 211010 bsa  Kaller eget program for scann av tegn.
6.15  * R6.10 041110 bsa  Div. manglende info.
6.16  * R6.10 160311 bsa  Ved valg av *ARKIV som skriver skal den kun arkiveres
6.20  * 6.20 070211 nho  Byttet ut fil mpspxx med vlagxx
6.21  * R6.20 100511 bsa  Lagger ut rutinetekst som metatagg.
6.22  * R6.20 130511 bsa  Scann av email strenger.
6.23  * R6.20 181212 bsa  Hardkodet duplex til true. Settes false som resten av malene
6.24  * R6.20 191212 bsa  Mangler firmainformasjon om email og web side
6.25  * R6.20 041212 bsa  Legger ut nytt unikt refno, utvidet metatagger
6.26  * R6.20 041013 bsa  Endrer logikken for oppbygging av refno
6.27  * R6.20 030315 bsa  Sorterer lista på samme måte som skjermbildeporogram
6.nu  * R6.30 260514 bof  utvidet par. ihht. nummerutvidelse
6.30  * R6.30 120914 bsa  Utvidet parameterliste til FO798R. Håndtering av
6.30  *                   flere mailfelter.
6.31  * 6.30  051214 Bsa  Utvidet parameterliste til FÅ707R
6.32  * 6.30  280115 bsa  Skriver til datakø for å trigge java sniffer
6.33  * 6.30  050615 bsa  Nullstill minne for bruk av XML
6.34  * 6.30  271015 bsa  Mangler tagg for printcommand.
6.35  * 6.30  031215 bsa  Legger ut avdeling som tagg for arkiveringsformål.
6.36  * 6.30  181215 bsa  Sender med info til mail. Lages ikke i mailprog.
6.37  * 6.30  240718 bof  Test at d1disp ikke blir for stor.
6.38  * 6.30  081018 bof  Utvidet med trelast sortiment
8.01  *PRG2   220622 BOF  Utvidet prisgruppe fra 1 til 2 posisjoner - COMP
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
     fvlagl1    if   e           k disk    rename(vlagpfr:vlagl1r)
     flstsl1    if   e           k disk    rename(lstspfr:lstsl1r)
6.27 flfdtl4    if   e           k disk    rename(lfdtpfr:lfdtl4r)
6.27 f*fdtl1    if   e           k disk    rename(lfdtpfr:lfdtl1r)
6.21 faforl1    if   e           k disk    rename(aforpfr:aforl1r)
     flfhelr    if   e           k disk    rename(lfhepfr:lfhelrr)
     fmppalr    if   e           k disk    rename(mppapfr:mppalrr)
6.10 fsstali    if   e           k disk    rename(sstapfr:sstalir)
pdf  fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
6.15 fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
      *
     flh601p    o    e             printer
      *
      * Parameter-inn
      *
     d                 ds
6.nu d d_prec                        17
6.nu d  d_fbes                        8  0 overlay(d_prec)
6.nu d  d_tbes                        8  0 overlay(d_prec:9)
6.nu d  d_sort                        1  0 overlay(d_prec:17)
      *
      * Local Data Area
      *
     d                uds
pdf  d l_poff                584    584
6.16 d l_utqm                585    594
pdf  d l_bach                595    635
pdf  d l_arch                636    636  0
pdf  d l_skje                637    637  0
pdf  d l_land                638    638  0
pdf  d l_exlp                639    639  0
pdf  d l_mail                640    640  0
pdf  d l_prfi                750    750  0
pdf  d l_ruti                800    809
pdf  d l_outq                810    819
6.15 d l_copy                838    843  0
6.25 d l_wsid                901    910
pdf  d l_user                911    920
pdf  d l_filg                931    933
     d l_firm                944    946  0
pdf  d l_avde                947    950  0
     d l_fnav                951    980
      *
      * Definering av variable i nøkler
      *
     d lfdtl1_line     s                   like(lfline)
     d lfdtl1_numm     s                   like(lfnumm)
6.27 d lfdtl4_vare     s                   like(lfvare)
6.27 d lfdtl4_numm     s                   like(lfnumm)
     d rlevl1_levr     s                   like(rllevr)
     d vlagl1_vare     s                   like(vlvare)
     d vlagl1_lage     s                   like(vllage)
     d vlaglx_vare     s                   like(vlvare)
     d lfhelr_numm     s                   like(lhnumm)
     d mppalr_ldor     s                   like(mpldor)
     d mppalr_lnum     s                   like(mplnum)
6.10 d sstali_vare     s                   like(sfvare)
6.10 d xstali_vare     s                   like(sfvare)
6.10 d sstali_lage     s                   like(sflage)
6.10 d xstali_lage     s                   like(sflage)
6.10 d sstali_paar     s                   like(sfpaar)
6.10 d sstali_puke     s                   like(sfpuke)
pdf  d vvarl1_vare     s                   like(vvvare)
pdf   *
pdf   * Definering av parametre
pdf   *
pdf  d p_mail          s              1
pdf  d p_kund          s              6  0
pdf  d p_kpro          s              6  0
6.nu d p_numm          s              8  0
6.30 d p_suff          s              2  0
pdf  d p_selg          s              4  0
pdf  d p_serv          s             35
pdf  d p_stat          s              1
pdf  d p_kule          s              1
pdf  d p_navn          s             30
pdf  d p_emal          s             50
pdf  d p_ema2          s             50
6.30 d p_ema3          s             50
6.30 d p_kopi          s             50
pdf  d p_emne          s             50
pdf  d p_txt1          s             50
pdf  d p_txt2          s             50
pdf  d p_txt3          s             50
pdf  d p_txt4          s             50
pdf  d p_pers          s             50
pdf  d p_inif          s             40
pdf  d p_in03          s              1
6.13 d p_ok            s              1
6.14 d p_lr            s              1
6.14 d p_str_in        s            512
6.14 d p_str_out       s            512
6.32 d p_filg          s             10
6.32 d p_xmlf          s            256
      *
      * Definering av øvrige variable
      *
     d w_firm          s                   like(laafir)
     d w_parm          s             19
     d w_udat          s               d   datfmt(*iso)
6.10 d w_fdat          s               d   datfmt(*iso)
6.10 d w_paar          s              4  0
6.10 d w_puke          s              2  0
6.10 d w_stat          s              1
6.38 d w_vtyp          s              1
6.38 d w_nobb          s                   like(vvnobb)
6.38 d w_ldor          s              6  0
6.38 d w_utda          s                   like(vvedat)
6.38 d w_lv_nobb       s                   like(vvnobb)
6.38 d w_lv_modn       s                   like(vvnmod)
6.38 d w_lv_lldo       s                   like(vvldor)
6.38 d w_lv_llva       s                   like(vvlvar)

pdf   *
pdf  d b_pdfp          s              1    inz(*off)
pdf  d b_topt          s              1    inz(*off)
pdf  d b_bott          s              1    inz(*off)
6.38 d b_inlr          s              1    inz(*off)
pdf  d x_numm          s             15
pdf  d x_vref          s             25
pdf  d x_betb          s             42
pdf  d w_bdat          s               d   datfmt(*iso)
pdf  d w_date          s               d   datfmt(*iso)
pdf  d w_kode          s              1
pdf  d w_fell          s              6
pdf  d w_type          s              2
pdf  d w_fast          s             10
pdf  d w_ruti          s             10
pdf  d w_tell          s              6  0
pdf  d w_pdf           s              1  0
pdf  d w_jnav          s             15
pdf  d w_jkey          s             41
pdf  d w_txt           s             35
pdf  d w_head          s             50
pdf  d w_pdf_ds        s            512
pdf  d w_mtxt          s            200
pdf  d w_jstat         s              2  0
pdf  d w_spol          s              5
pdf  d w_land          s              9
pdf  d w_jtext         s            200
pdf  d w_str_in        s            512
pdf  d w_str_out       s            512
pdf  d w_x             s              3  0
pdf  d w_path          s            256
pdf  d w_emal          s             50
pdf  d w_prfi          s              1  0
pdf  d w_ffir          s              3  0
pdf  d w_avde          s              4  0
pdf  d w_fnav          s             30
pdf  d w_fad1          s             30
pdf  d w_fad2          s             30
pdf  d w_fste          s             30
pdf  d w_fftx          s             30
pdf  d w_tfax          s              8
pdf  d w_ftlf          s             11
pdf  d w_ffax          s             11
pdf  d w_dato          s             12  0
pdf  d w_time          s              6  0
pdf  d w_ddmy          s              6  0
6.11 d w_dspl          s            100
6.14 d w_tek1          s            512
6.14 d w_tek2          s            512
6.12 d w_1fnav         s             50
6.12 d w_1fad1         s             50
6.12 d w_1fad2         s             50
6.12 d w_1navn         s             50
6.12 d w_1gate         s             50
6.12 d w_1adr2         s             50
6.12 d w_navn          s             50
6.12 d w_gate          s             50
6.12 d w_adr2          s             50
6.15 d w_copy          s              3  0
6.21 d a1txt1          s                   like(aftxt1)
6.22 d w_ptxt1         s             50
6.22 d w_ptxt2         s             50
6.22 d w_ptxt3         s             50
6.22 d w_ptxt4         s             50
6.22 d w_ppers         s             50
6.25 d w_refn          s             50
6.31 d w_mail          s             50
6.31 d w_weba          s             50
pdf   *
pdf  d XML_Output      s            256a   Varying
pdf  d XML_path        s            256a   Varying
pdf  d                                     Inz('/home/asp/print/adb')
pdf  d jasper_mal      s            256a
pdf  d jasper_logo     s            256a   Varying
pdf  d tmpdate         s               D
pdf  d tmptime         s               T
6.22 d crlf            c                   const(X'0d25')
pdf   *
pdf  d d_pdf_ds        ds
pdf  d  d_xmlm                       75
pdf  d  d_jasm                       75
pdf  d  d_logo                       75
pdf  d  d_path                      100
pdf  d  d_emal                       50
6.32 d  d_fifo                       75
6.32 d  d_fkop                        1
6.32 d  d_dtaq                        1
6.32 d  d_sign                        1
pdf   /copy prototypeb
pdf   /copy usec
pdf   *
      *
      * - - - - - - - - - -
      * Benyttede formater
      * - - - - - - - - - -
      *
      * A1HDR  - Heading A1 på rapport
      * D1DET  - Detail  D1 på rapport
      * T1TOT  - Total   T1 på rapport
      *
      *
      * Lese file
      *
6.27 c*    lfdtl1_key    setll     lfdtl1
6.27 c*                  read      lfdtl1                                 90
6.27 c     lfdtl4_key    setll     lfdtl4
6.27 c                   read      lfdtl4                                 90
      *
     c                   exsr      heading
      *
     c                   dow       *in90 = *off
      *
     c                   if        lfnumm > d_tbes or
     c                             lfnumm < d_fbes
     c                   goto      les_slutt
     c                   endif
      *
     c                   exsr      det_sub
      *
6.27 c                   read      lfdtl4                                 90
6.27 c*                  read      lfdtl1                                 90
     c                   enddo
      *
     c     les_slutt     tag
      *
      * Skrive total
      *
pdf  c                   if        b_pdfp = *off
     c                   write     t1tot                                30
pdf   * Skriver XML tagger for detaljer
pdf  c                   else
pdf  c                   exsr      xml_total
pdf  c                   endif
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *
     c     xslutt        tag
pdf   * Hvis xml gen, må vi kvittere med siste vanlige linjetag
pdf  c                   if        b_pdfp = *on
pdf  c                   exsr      xml_endsuggl
pdf   * Skriv xml fila på disk
pdf  c                   exsr      xml_end
pdf   * Hvis forhåndvisning må vi kjøre linken
pdf  c                   if        l_skje = 1 and
pdf  c                             l_bach = w_jkey
pdf  c                   exsr      pdf_preview
pdf  c                   endif
pdf   * Avslutt jobbiden
pdf  c                   call      'AB710R'
pdf  c                   parm                    l_bach
pdf  c                   endif
      *
     c                   eval      *inlr = *on
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av detaljpost
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     det_sub       begsr
pdf   * Gjør oppslag, og hent inn info til xml fila
pdf  c                   if        b_pdfp = *on
pdf  c                   eval      vvarl1_vare = lfvare
pdf  c     vvarl1_key    chain     vvarl1
pdf  c                   endif
pdf   *
     c                   eval      vlagl1_lage = lflage
     c                   eval      vlagl1_vare = lfvare
     c     vlagl1_key    chain     vlagl1
     c                   if        %found(vlagl1)
     c                   eval      d1mini = vlmini
     c                   eval      d1maks = vlmaks
     c                   eval      d1behl = vlbehl
6.37 c                   if        (vlbehl + vlbbes -
6.37 c                                      vlpakk - vloord)
6.37 c                             > 999999
6.37 c                   eval      d1disp = 999999
6.37 c                   else
     c                   eval      d1disp = vlbehl + vlbbes -
     c                                      vlpakk - vloord
6.37 c                   endif
     c                   eval      d1bmin = vlbmin
6.10 c                   eval      d1oms3 = 0
6.10 c                   eval      d1abcc = vlkabc
     c                   else
     c                   eval      d1mini = 0
     c                   eval      d1maks = 0
     c                   eval      d1behl = 0
     c                   eval      d1disp = 0
     c                   eval      d1bmin = 0
6.10 c                   eval      d1oms3 = 0
6.10 c                   eval      d1abcc = *blanks
     c                   endif
     c                   exsr      les_lagr
     c                   eval      d1enh1 = lfenh1
      *
      * sjekker om sperre på oppd. fra prognose er lagt inn.
6.20 c                   eval      vlagl1_vare = lfvare
6.20 c                   eval      vlagl1_lage = lflage
6.20 c     vlagl1_key    chain     vlagl1
6.20 c                   if        vlstda <> *loval and
6.20 c                             vlstda > w_udat
     c                   eval      d1manu = 'M'
     c                   else
     c                   eval      d1manu = *blank
     c                   endif
6.38  * henter info om logistikk-vare
6.38 c                   call      'VL710R'
6.38 c                   parm                    w_firm
6.38 c                   parm                    lfvare
6.38 c                   parm                    lflage
6.38 c                   parm                    w_vtyp
6.38 c                   parm                    w_utda
6.38 c                   parm                    w_ldor
6.38 c                   parm                    b_inlr
6.38 c                   parm                    w_lv_nobb
6.38 c                   parm                    w_lv_modn
6.38 c                   parm                    w_lv_lldo
6.38 c                   parm                    w_lv_llva
      *
      * Nytt forslagsnummer?
      *
     c*                  if        lfnumm <> d1numm
     c*                  eval      d1numm = lfnumm
     c*                  eval      *in40 = *off
     c*                  eval      *in41 = *off
     c*                  else
     c*                  eval      *in40 = *on
     c*                  endif
      *
      * Behandle record
      *
     c                   eval      d1line = lfline
     c                   eval      d1lvar = lflvar
     c                   movel     lfvare        d1vare
     c                   eval      d1tek1 = lftek1
     c                   eval      d1anta = lfanta
6.10  * Henter omsetning siste 3 måneder
6.10 c                   exsr      les_oms
6.10  *
     c                   eval      t1post = t1post + 1
pdf  c                   if        b_pdfp = *off
     c                   write     d1det                                30
pdf   * Skriver XML tagger for detaljer
pdf  c                   else
pdf  c                   exsr      xml_deta
pdf  c                   endif
      *
      * Er det overflow ?
      *
     c                   if        *in30 = *on
pdf  c                   if        b_pdfp = *off
     c                   write     a1hdr
pdf  c                   endif
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for lesing av lagerregister
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     les_lagr      begsr
      *
     c                   eval      d1totl = 0
      *
     c                   eval      vlaglx_vare = lfvare
     c     vlaglx_key    setll     vlagl1
     c     vlaglx_key    reade     vlagl1
      *
     c                   dow       not %eof(vlagl1)
      *
     c                   eval      d1totl = d1totl + vlbehl
      *
     c     vlaglx_key    reade     vlagl1
     c                   enddo
      *
     c                   endsr
6.10  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.10  * Subrutine for lesing av lagerregister
6.10  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.10  *
6.10 c     les_oms       begsr
6.10  *
6.10 c                   eval      d1oms3 = 0
6.10  * Finn dato 3 måneder tilbake
6.10 c                   eval      w_fdat = w_udat - %months(3)
6.10 c                   eval      w_stat = *blank
6.10 c                   eval      w_paar = 0
6.10 c                   eval      w_puke = 0
6.10  *
6.10 c                   call      'AX711R'
6.10 c                   parm                    w_fdat
6.10 c                   parm                    w_paar
6.10 c                   parm                    w_puke
6.10 c                   parm                    w_stat
6.10  *
6.10 c                   if        w_puke > 52
6.10 c                   eval      w_puke = 52
6.10 c                   endif
6.10  *
6.10 c                   eval      xstali_vare = lfvare
6.10 c                   eval      xstali_lage = lflage
6.10 c                   eval      sstali_vare = lfvare
6.10 c                   eval      sstali_lage = lflage
6.10 c                   eval      sstali_paar = w_paar
6.10 c                   eval      sstali_puke = w_puke
6.10 c     sstali_key    setll     sstali
6.10 c     xstali_key    reade     sstali
6.10  *
6.10 c                   dow       not %eof(sstali)
6.10  *
6.10 c                   if        sflety = 0
6.10 c                   eval      d1oms3 = d1oms3 + sfanta
6.10 c                   endif
6.10  *
6.10 c     xstali_key    reade     sstali
6.10 c                   enddo
6.10  *
6.10 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for å skrive heading
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     heading       begsr
      *
     c                   eval      rlevl1_levr = lfldor
     c     rlevl1_key    chain     rlevl1r                            91
     c                   if        *in91 = *off
     c                   eval      a1ldor = lfldor
     c                   movel     rlnavn        a1lnav
     c                   else
     c                   movel     'UKJENT LEV.' a1lnav
     c                   endif
     c                   eval      a1numm = lfnumm
     c                   eval      a1lage = lflage
      *
pdf  c                   if        b_pdfp = *off
     c                   write     a1hdr
pdf  c                   else
pdf   * Vi skriver til XML taggene for heading
pdf  c                   exsr      xml_head
pdf  c                   endif
      *
     c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Miljø variabler         *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_envm      begsr
pdf   * Hvis skjermvisning skal vi ikke lagre i spoolfile
pdf  c                   if        l_skje = 1
pdf  c                   eval      w_spol = 'true'
pdf  c                   else
pdf  c                   eval      w_spol = 'false'
pdf  c                   endif
pdf   *
pdf   /Free
pdf        // Finne nytt batch nummer
pdf            UpdHTMLVar('BatchNo':               w_jkey);
pdf            UpdHTMLVar('Batchtype': 'BESTILLINGSFORSLAG');
pdf            UpdHTMLVar('Username':              l_user);
pdf            WrtSection('Topp');
pdf        // Finn report command variabler
pdf            UpdHTMLVar('User':                l_user);
pdf            UpdHTMLVar('PW':                     ' ');
pdf            UpdHTMLVar('IPAdr':                  ' ');
pdf            UpdHTMLVar('Schema':        'ADB'+l_filg);
pdf            UpdHTMLVar('Companyno':    %char(l_firm));
6.35           UpdHTMLVar('Departmentnoarkiv': %char(l_avde));
pdf            WrtSection('Credential');
pdf        // Finn report command variabler
pdf            UpdHTMLVar('Jaspertemplate':      d_jasm);
pdf            UpdHTMLVar('Logo':           jasper_logo);
pdf            UpdHTMLVar('Keepspool':           w_spol);
pdf            WrtSection('ReportCommand');
pdf   /End-free
pdf   *
pdf   * Hvis skjermvisning skal ikke PDF skrives
pdf   *
pdf  c                   if        l_skje = 0 and
pdf  c                             l_mail = 0
6.16  * Hvis *ARKIV er valgt som skriver, skal det ikke skrives ut
6.16 c                   if        l_utqm <> '*ARKIV'
pdf   *
pdf  c                   if        l_land = 1
pdf  c                   eval      w_land = 'LANDSCAPE'
pdf  c                   else
pdf  c                   eval      w_land = 'PORTRAIT'
pdf  c                   endif
6.13  * Sjekk at valgt outq støttes av skriveren. Kan skli gjennom hvis
6.13  * jobben legges på jobbkø.
6.13 c                   eval      p_ok = '0'
6.13 c                   call      'AP612R'
6.13 c                   parm                    l_filg
6.13 c                   parm                    l_outq
6.13 c                   parm                    p_ok
6.13  * Hvis feil utkø, logges dette i transaksjonsloggen
6.13 c                   if        p_ok = '0'
6.13 c                   eval      w_jstat = 20
6.13 c                   eval      w_jtext = 'Ugyldig utkø '+ l_outq + ' er val+
6.13 c                             gt. Ingen utskrift er generert. Utskrift kan+
6.13 c                              arkiveres.'
6.13 c                   call      'AB705R'
6.13 c                   parm                    l_bach
6.13 c                   parm                    w_jstat
6.13 c                   parm                    w_jtext
6.13 c                   else
6.15  *
6.15 c                   if        l_copy > 0
6.15 c                   eval      w_copy = l_copy
6.15 c                   else
6.15 c                   eval      w_copy = 1
6.15 c                   endif
6.13  *
pdf   *
pdf   /Free
pdf        // Finn print informasjon
pdf            UpdHTMLVar('Printername':         l_outq);
615            UpdHTMLVar('Copies':        %char(w_copy));
pdf            UpdHTMLVar('Papersource':            ' ');
6.34           UpdHTMLVar('Lastpagedrawer':             ' ');
6.23    //     UpdHTMLVar('Duplex':              'true');
6.23           UpdHTMLVar('Duplex':             'false');
pdf            UpdHTMLVar('Quality':                ' ');
pdf            UpdHTMLVar('Sorting':                ' ');
pdf            UpdHTMLVar('Staple':              'true');
pdf            UPDHTMLVar('Alignment':           w_land);
pdf            WrtSection('PrintCommand');
pdf   /End-free
6.13 c                   endif
6.16 c                   endif
pdf  c                   endif
pdf   *
pdf  c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Heading                 *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_head      begsr
pdf   *
pdf  c                   eval      w_str_in = *blanks
pdf  c                   eval      w_str_out = *blanks
pdf  c                   eval      x_numm = %char(a1numm)
pdf  c                   eval      w_head = 'Utskrift av bestilling-forslag'
pdf   *
pdf   * Hvis mail skal skrives, må vi hente mail informasjon
pdf   *
pdf  c                   if        l_mail = 1
pdf  c                   eval      p_kule = 'L'
pdf  c                   eval      p_kund = lfldor
pdf  c                   eval      p_kpro = *zeros
pdf  c                   eval      p_numm = *zeros
6.30 c                   eval      p_suff = *zeros
6.36 c**                 eval      p_selg = *zeros
6.36 c                   eval      p_selg = lhselg
pdf  c                   eval      p_in03 = *off
6.36 c                   eval      p_emne = 'Bestillingsforslag '+%char(lhnumm)+
6.36 c                             ' fra '+%trim(aafnav)
pdf   * Henter ut mailserver
pdf  c                   eval      p_serv = *blank
pdf  c                   eval      p_stat = *blank
pdf  c                   call      'AM705C'
pdf  c                   parm                    p_serv
pdf  c                   parm                    p_stat
pdf   *
pdf  c                   call      'FO798R'
pdf  c                   parm                    p_kule
pdf  c                   parm                    p_kund
pdf  c                   parm                    p_kpro
pdf  c                   parm                    p_numm
6.30 c                   parm                    p_suff
pdf  c                   parm                    p_selg
pdf  c                   parm                    p_navn
pdf  c                   parm                    p_emal
6.30 c                   parm                    p_ema2
6.30 c                   parm                    p_ema3
pdf  c                   parm                    p_emne
pdf  c                   parm                    p_txt1
pdf  c                   parm                    p_txt2
pdf  c                   parm                    p_txt3
pdf  c                   parm                    p_txt4
pdf  c                   parm                    p_pers
6.30 c                   parm                    p_kopi
pdf  c                   parm                    p_inif
pdf  c                   parm                    p_in03
6.22  * Scann av strenger
6.22  *
6.22 c                   eval      p_str_in = *blank
6.22 c                   eval      p_lr = '0'
6.22 c                   movel     p_txt1        p_str_in
6.22 c                   call      'AP613R'
6.22 c                   parm                    p_str_in
6.22 c                   parm                    p_str_out
6.22 c                   parm                    p_lr
6.22 c                   movel     p_str_out     w_ptxt1
6.22  *
6.22 c                   eval      p_str_in = *blank
6.22 c                   eval      p_lr = '0'
6.22 c                   movel     p_txt2        p_str_in
6.22 c                   call      'AP613R'
6.22 c                   parm                    p_str_in
6.22 c                   parm                    p_str_out
6.22 c                   parm                    p_lr
6.22 c                   movel     p_str_out     w_ptxt2
6.22  *
6.22 c                   eval      p_str_in = *blank
6.22 c                   eval      p_lr = '0'
6.22 c                   movel     p_txt3        p_str_in
6.22 c                   call      'AP613R'
6.22 c                   parm                    p_str_in
6.22 c                   parm                    p_str_out
6.22 c                   parm                    p_lr
6.22 c                   movel     p_str_out     w_ptxt3
6.22  *
6.22 c                   eval      p_str_in = *blank
6.22 c                   eval      p_lr = '0'
6.22 c                   movel     p_txt4        p_str_in
6.22 c                   call      'AP613R'
6.22 c                   parm                    p_str_in
6.22 c                   parm                    p_str_out
6.22 c                   parm                    p_lr
6.22 c                   movel     p_str_out     w_ptxt4
6.22  *
6.22 c                   eval      p_str_in = *blank
6.22 c                   eval      p_lr = '0'
6.22 c                   movel     p_pers        p_str_in
6.22 c                   call      'AP613R'
6.22 c                   parm                    p_str_in
6.22 c                   parm                    p_str_out
6.22 c                   parm                    p_lr
6.22 c                   movel     p_str_out     w_ppers
6.22  *
6.22 c                   eval      w_mtxt = %trim(w_ptxt1) + crlf +
6.22 c                                      %trim(w_ptxt2) + crlf +
6.22 c                                      %trim(w_ptxt3) + crlf +
6.22 c                                      %trim(w_ptxt4) + crlf +
6.22 c                                      %trim(w_ppers)
6.22 c**
6.22 c**                 eval      w_mtxt = p_txt1+p_txt2+p_txt3+p_txt4
pdf   *
6.30 c                   if        p_kopi = *blanks
6.30 c                   eval      p_kopi = d_emal
pdf  c                   endif
pdf   *
pdf  c                   if        p_in03 = *off
pdf   *
pdf   /Free
pdf        // Skriv mailinformasjon
6.30           WrtSection('MailCommandStart');
6.30       //  UpdHTMLVar('Receivers':           p_emal);
6.30           if %Trim(p_emal)<> *blanks;
6.30           UpdHTMLVar('Receivers':           p_emal);
6.30           WrtSection('MailReceiver');
6.30           endif;
6.30           if %Trim(p_ema2)<> *blanks;
6.30           UpdHTMLVar('Receivers':           p_ema2);
6.30           WrtSection('MailReceiver');
6.30           endif;
6.30           if %Trim(p_ema3)<> *blanks;
6.30           UpdHTMLVar('Receivers':           p_ema3);
6.30           WrtSection('MailReceiver');
6.30           endif;
pdf            UpdHTMLVar('CC':                     ' ');
6.30           UpdHTMLVar('BCC':                 p_kopi);
6.30           UpdHTMLVar('Sender':              p_kopi);
pdf            UpdHTMLVar('Subject':             p_emne);
pdf            UpdHTMLVar('Message':             w_mtxt);
pdf            UpdHTMLVar('SMTPServer':          p_serv);
pdf            UPDHTMLVar('SMTPUser':               ' ');
pdf            UPDHTMLVar('SMTPPw':                 ' ');
6.30      //   WrtSection('MailCommand');
6.30           WrtSection('MailCommandEnd');
pdf   /End-free
pdf  c                   endif
pdf  c                   endif
pdf   * Vi må oversette aktuelle tekster til "xml" tegn - Firma
6.12 c                   eval      w_1fnav = *blank
6.12 c                   eval      w_1fad1 = *blank
6.12 c                   eval      w_1fad2 = *blank
6.12 c                   eval      w_1navn = *blank
6.12 c                   eval      w_1gate = *blank
6.12 c                   eval      w_1adr2 = *blank
      *
6.14 c                   eval      p_str_in = *blank
6.14 c                   eval      p_lr = '0'
6.14 c                   movel     a1fnav        p_str_in
6.14 c                   call      'AP613R'
6.14 c                   parm                    p_str_in
6.14 c                   parm                    p_str_out
6.14 c                   parm                    p_lr
6.14 c                   movel     p_str_out     a1fnav
6.14 c                   movel     p_str_out     w_1fnav
      *
6.14 c                   eval      p_str_in = *blank
6.14 c                   eval      p_lr = '0'
6.14 c                   movel     w_fad1        p_str_in
6.14 c                   call      'AP613R'
6.14 c                   parm                    p_str_in
6.14 c                   parm                    p_str_out
6.14 c                   parm                    p_lr
6.14 c                   movel     p_str_out     w_fad1
6.14 c                   movel     p_str_out     w_1fad1
      *
6.14 c                   eval      p_str_in = *blank
6.14 c                   eval      p_lr = '0'
6.14 c                   movel     w_fad2        p_str_in
6.14 c                   call      'AP613R'
6.14 c                   parm                    p_str_in
6.14 c                   parm                    p_str_out
6.14 c                   parm                    p_lr
6.14 c                   movel     p_str_out     w_fad2
6.14 c                   movel     p_str_out     w_1fad2
      *
      * Vi må oversette aktuelle tekster til "xml" tegn - Partner
      *
6.14 c                   eval      p_str_in = *blank
6.14 c                   eval      p_lr = '0'
6.14 c                   movel     rlnavn        p_str_in
6.14 c                   call      'AP613R'
6.14 c                   parm                    p_str_in
6.14 c                   parm                    p_str_out
6.14 c                   parm                    p_lr
6.14 c                   movel     p_str_out     rlnavn
6.14 c                   movel     p_str_out     w_navn
      *
6.14 c                   eval      p_str_in = *blank
6.14 c                   eval      p_lr = '0'
6.14 c                   movel     rlgate        p_str_in
6.14 c                   call      'AP613R'
6.14 c                   parm                    p_str_in
6.14 c                   parm                    p_str_out
6.14 c                   parm                    p_lr
6.14 c                   movel     p_str_out     rlgate
6.14 c                   movel     p_str_out     w_gate
      *
6.14 c                   eval      p_str_in = *blank
6.14 c                   eval      p_lr = '0'
6.14 c                   movel     rladr2        p_str_in
6.14 c                   call      'AP613R'
6.14 c                   parm                    p_str_in
6.14 c                   parm                    p_str_out
6.14 c                   parm                    p_lr
6.14 c                   movel     p_str_out     rladr2
6.14 c                   movel     p_str_out     w_adr2
pdf   /Free
pdf
pdf        // Skriv firmavariabler
6.21           UpdHTMLVar('Reporttext':            a1txt1);
6.12           UpdHTMLVar('CompanyName':          w_1fnav);
6.12           UpdHTMLVar('Companyadress1':       w_1fad1);
6.12           UpdHTMLVar('Companyadress2':       w_1fad2);
pdf            UpdHTMLVar('Companypostalcode':        ' ');
pdf            UpdHTMLVar('Companypostoffice':     w_fste);
pdf            UpdHTMLVar('Companyphone':          w_ftlf);
pdf            UpdHTMLVar('Companyfax':            w_ffax);
615            UpdHTMLVar('Companyorgno':   %char(aafftn));
615            UpdHTMLVar('Companygiro':    %char(aafbgi));
6.31           UpdHTMLVar('Companyemail':   %trim(w_mail));
6.31           UpdHTMLVar('Companywebpage': %trim(w_weba));
pdf
pdf            test(de) *dmy w_ddmy;
pdf            if %error;
pdf            tmpdate = *loval;
pdf            else;
pdf            tmpdate = %date(w_ddmy : *dmy);
pdf            endif;
pdf            UpdHTMLVar('Creationdate':   %char(tmpdate : *iso));
pdf
pdf            test(te) *hms w_time;
pdf            if %error;
pdf            tmptime = *loval;
pdf            else;
pdf            tmptime = %time(w_time : *hms);
pdf            endif;
pdf            UpdHTMLVar('Creationtime': %char(tmptime : *hms));
pdf            WrtSection('Company');
pdf
pdf        // Skriv partnerinfo (kunde)
pdf            UpdHTMLVar('Partnerno':        %char(lfldor));
pdf            UpdHTMLVar('Partnercategory':  %char(rlkatg));
6.12           UpdHTMLVar('Partnername':             w_navn);
6.12           UpdHTMLVar('Partneradress1':          w_gate);
6.12           UpdHTMLVar('Partneradress2':          w_adr2);
pdf            UpdHTMLVar('Partnerpostalcode':%char(rlponr));
pdf            UpdHTMLVar('Partnerpostoffice':       rlsted);
pdf            UpdHTMLVar('Partnerphone':            rltlfn);
pdf            UpdHTMLVar('Partnercellphone':        rlmobn);
pdf            UpdHTMLVar('Partnerfax':              rltlfx);
pdf            UpdHTMLVar('Partnerrefname':          rlpers);
pdf            UpdHTMLVar('Partnerrefphone':         rlmobn);
pdf            UpdHTMLVar('Partnerrefmail':          rlemal);
pdf            WrtSection('Partner');
pdf   /End-free
pdf   *
pdf   /Free
pdf            UpdHTMLVar('Documentno':            x_numm);
pdf            UpdHTMLVar('Limit':          %char(a1gbel));
pdf            UpdHTMLVar('Storage':        %char(a1lage));
pdf            UpdHTMLVar('Documentheading':      w_head);
pdf            WrtSection('DocumentInformation');
pdf   /End-free
pdf
pdf   *
pdf   /Free
pdf        //  Legg ut 'heading' på linje
pdf            WrtSection('SuggestionLines');
pdf   /End-free
pdf   *
pdf  c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Detaljer                *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_deta      begsr
pdf   *
6.38  * sjekk logistikk-vare
6.38 c                   eval      w_nobb = 0
6.38 c                   if        w_lv_nobb <> 0
6.38 c                   eval      w_nobb = w_lv_nobb
6.38 c                   else
6.38 c                   eval      w_nobb = vvnobb
6.38 c                   endif
pdf   * Vi må oversette aktuelle tekster til "xml" tegn - Varetekster
6.12 c                   eval      w_tek1 = *blank
6.12 c                   eval      w_tek2 = *blank
      *
6.14 c                   eval      p_str_in = *blank
6.14 c                   eval      p_lr = '0'
6.14 c                   movel     d1tek1        p_str_in
6.14 c                   call      'AP613R'
6.14 c                   parm                    p_str_in
6.14 c                   parm                    p_str_out
6.14 c                   parm                    p_lr
6.14 c                   movel     p_str_out     d1tek1
6.14 c                   movel     p_str_out     w_tek1
      *
6.14 c                   eval      p_str_in = *blank
6.14 c                   eval      p_lr = '0'
6.14 c                   movel     vvtek2        p_str_in
6.14 c                   call      'AP613R'
6.14 c                   parm                    p_str_in
6.14 c                   parm                    p_str_out
6.14 c                   parm                    p_lr
6.14 c                   movel     p_str_out     w_tek2
pdf   *
pdf   /Free
pdf        // Skriv detaljer
pdf            UpdHTMLVar('Lineno':      %char(d1line));
pdf            UpdHTMLVar('SupplierItemno':     d1lvar);
pdf            UpdHTMLVar('Itemno':             d1vare);
6.12           UpdHTMLVar('Text1':              w_tek1);
6.12           UpdHTMLVar('Text2':              w_tek2);
pdf            UpdHTMLVar('Mininstorage': %char(d1mini));
pdf            UpdHTMLVar('Maxinstorage': %char(d1maks));
pdf            UpdHTMLVar('Availableinstorage':%char(d1disp));
pdf            UpdHTMLVar('Totalavailable': %char(d1totl));
pdf            UpdHTMLVar('Onhandinventory': %char(d1behl));
pdf            UpdHTMLVar('Quantity':      %char(d1anta));
pdf            UpdHTMLVar('Unit':                d1enh1);
pdf            UpdHTMLVar('Minorder':      %char(d1bmin));
pdf            UpdHTMLVar('Turnover':      %char(d1oms3));
pdf            UpdHTMLVar('Abccode':             d1abcc);
6.38           UpdHTMLVar('Nobbno':       %char(w_nobb));
pdf            WrtSection('Line');
pdf
pdf   /End-free
pdf   *
pdf  c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Total                   *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_total     begsr
pdf   *
pdf   /Free
pdf        // Skriv sumlinje
pdf            UpdHTMLVar('Sumlines':          %char(t1post));
pdf            WrtSection('TotalLine');
pdf
pdf   /End-free
pdf   *
pdf  c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Siste tagg for plukkl   *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_endsuggl  begsr
pdf   *
pdf   /Free
pdf        // Skriv siste ordinære linjetagg
pdf            WrtSection('EndSuggestionLines');
pdf
pdf   /End-free
pdf   *
pdf  c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Slutt                   *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     xml_end       begsr
pdf   *
pdf   /Free
pdf            WrtSection('EndSuggestionDocument');
pdf   /End-free
pdf   *
pdf   * Hvis denne ikke skal arkiveres, lages ikke archive tagg.
pdf   *
pdf  c                   if        l_arch = 1
6.11  * Lag tag for vising i arkivklienten
6.11 c                   eval      w_dspl = *blank
6.11 c                   eval      w_dspl = 'Bestillingsforslag :' +
6.11 c                             %char(a1numm) + '  Levarandør: ' +
6.11 c                             %trim(%char(a1ldor)) + ' - ' +
6.11 c                             %trim(rlnavn)
6.11  *
6.14 c                   eval      p_str_in = *blank
6.14 c                   eval      p_lr = '0'
6.14 c                   movel     w_dspl        p_str_in
6.14 c                   call      'AP613R'
6.14 c                   parm                    p_str_in
6.14 c                   parm                    p_str_out
6.14 c                   parm                    p_lr
6.14 c                   movel     p_str_out     w_dspl
6.25  * Referansetagg
6.25 c                   eval      w_refn = *blank
6.26 c                   eval      w_refn = %char(%subdt(w_date:*years)) +
6.26 c                             %char(a1numm)
pdf   /Free
pdf        // Skriv metattags
6.11
6.25           UpdHTMLVar('Refno':          %trim(w_refn));
6.11           UpdHTMLVar('Displaytag':     %trim(w_dspl));
pdf            WrtSection('ArchiveCommandStart');
6.11
pdf            UpdHTMLVar('Metavalue':      %char(a1numm));
pdf            UpdHTMLVar('Metakey': 'BESTILLINGSFORSLAG');
pdf            WrtSection('MetaTag');
pdf
pdf            UpdHTMLVar('Metavalue':             l_user);
pdf            UpdHTMLVar('Metakey':             'BRUKER');
pdf            WrtSection('MetaTag');
pdf
pdf            UpdHTMLVar('Metavalue': %char(w_date:*iso));
pdf            UpdHTMLVar('Metakey':               'DATO');
pdf            WrtSection('MetaTag');
pdf
pdf            UpdHTMLVar('Metavalue':      %char(a1ldor));
pdf            UpdHTMLVar('Metakey':         'LEVERANDØR');
pdf            WrtSection('MetaTag');
pdf
6.12           UpdHTMLVar('Metavalue':             w_navn);
pdf            UpdHTMLVar('Metakey':     'LEVERANDØRNAVN');
pdf            WrtSection('MetaTag');
6.21
6.21           UpdHTMLVar('Metavalue':             a1txt1);
6.21           UpdHTMLVar('Metakey':         'RUTINETEKST');
6.21           WrtSection('MetaTag');
6.25
6.25           UpdHTMLVar('Metavalue':             l_ruti);
6.25           UpdHTMLVar('Metakey':             'RUTINE');
6.25           WrtSection('MetaTag');
6.25
6.25           UpdHTMLVar('Metavalue':      %char(l_firm));
6.25           UpdHTMLVar('Metakey':              'FIRMA');
6.25           WrtSection('MetaTag');
6.25
6.25           UpdHTMLVar('Metavalue':             l_wsid);
6.25           UpdHTMLVar('Metakey':             'SKJERM');
6.25           WrtSection('MetaTag');
pdf
pdf            WrtSection('ArchiveCommandEnd');
pdf   /End-free
pdf   *
pdf  c                   endif
pdf   *
pdf   /Free
pdf            WrtSection('Footer');
pdf   /End-free
pdf   *
pdf  c                   eval      XML_Output = XML_path + l_filg +'/'+
pdf  c                             'Bfors_'+ %trim(w_jkey) + '.xml'
pdf   *
pdf  c                   callp     WrtHtmlToStmf(XML_Output: 819)
6.32  * Skriver til datakø for å aktivere sniffer, hvis dataq er aktiv
6.32 c                   if        d_dtaq = '1'
6.32 c                   eval      p_xmlf = xml_output
6.32 c                   eval      p_filg = 'ADB'+l_filg
6.32 c                   call      'AP629C'
6.32 c                   parm                    p_filg
6.32 c                   parm                    p_xmlf
6.32 c                   endif
pdf   *
pdf  c                   endsr
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf   * Subrutiner for XML/jasper integrasjon - Skjermvisning           *
pdf   * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
pdf  c     pdf_preview   begsr
pdf   *
pdf   * Vi kaller program for launch av PDF i browser
pdf  c                   call      'AP621R'
pdf  c                   parm                    w_jkey
pdf   *
pdf  c                   endsr
pdf   *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for leverandør-register
      *
     c     rlevl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl1_levr
      *
      * Key for statusregister
      *
     c     lstsl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for BESTILLING-HODE-REGISTER
      *
     c     lfdtl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lfdtl1_numm
     c                   kfld                    lfdtl1_line
6.27  *
6.27  * Key for BESTILLING-HODE-REGISTER
6.27  *
6.27 c     lfdtl4_key    klist
6.27 c                   kfld                    w_firm
6.27 c                   kfld                    lfdtl4_numm
6.27 c                   kfld                    lfdtl4_vare
      *
      * Key for BESTILLING-HODE-REGISTER
      *
     c     lfhelr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lfhelr_numm
      *
      *  Key for les av bestillingsparameter
      *
     c     mppalr_key    klist
     c                   kfld                    w_firm
     c                   kfld                    mppalr_ldor
     c                   kfld                    mppalr_lnum
      *
      * Key for lagerregister
      *
     c     vlagl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vlagl1_vare
     c                   kfld                    vlagl1_lage
      *
      * Key for lagerregister
      *
     c     vlaglx_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vlaglx_vare
6.10  *
6.10  *  Key for statistikkregister
6.10  *
6.10 c     sstali_key    klist
6.10 c                   kfld                    w_firm
6.10 c                   kfld                    sstali_vare
6.10 c                   kfld                    sstali_lage
6.10 c                   kfld                    sstali_paar
6.10 c                   kfld                    sstali_puke
6.10  *
6.10  *  Key for statistikkregister
6.10  *
6.10 c     xstali_key    klist
6.10 c                   kfld                    w_firm
6.10 c                   kfld                    xstali_vare
6.10 c                   kfld                    xstali_lage
pdf   *
pdf   *  Key for vareregister
pdf   *
pdf  c     vvarl1_key    klist
pdf  c                   kfld                    w_firm
pdf  c                   kfld                    vvarl1_vare
6.15  *
6.15  * Key for firmaregister
6.15  *
6.15 c     afirl1_key    klist
6.15 c                   kfld                    w_firm
6.21  *
6.21  * Key for formular-register
6.21  *
6.21 C     aforl1_key    klist
6.21 C                   kfld                    w_ruti
6.21  *
6.21  * Hente inn rutinenavn
6.21  * og meldingstekst
6.21  *
6.21 c                   eval      w_ruti = l_ruti
6.21  *
6.21 C     aforl1_key    chain     aforl1r                            69
6.21 C  n69              move      aftxt1        a1txt1
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *  Tar inn parameter fra forrige program                          *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *entry        plist
     c                   parm                    w_parm
      *
     c                   eval      d_prec = w_parm
     c                   eval      a1fnav = l_fnav
     c                   time                    w_udat
      *
      * Legge inn key
      *
     c                   eval      a1firm = l_firm
     c                   eval      w_firm = l_firm
     c                   eval      lfdtl1_numm = d_fbes
     c                   eval      lfhelr_numm = d_fbes
6.27 c                   eval      lfdtl4_numm = d_fbes
6.27 c                   eval      lfdtl4_vare = *blanks
      *
      * slår opp mot parameter og henter vekt og beløpsgrense
      *
     c     lfhelr_key    chain     lfhelr
     c                   if        %found(lfhelr)
     c                   eval      mppalr_ldor = lhldor
     c                   eval      mppalr_lnum = lhlnum
     c     mppalr_key    chain     mppalr
     c                   if        %found(mppalr)
     c                   eval      a1gbel = mpgbel
     c                   else
     c                   eval      a1gbel = 0
     c                   endif
     c                   endif
      *
      * Hent opplysninger fra LAGER-STATUS-KODER
      *
     c     lstsl1_key    chain     lstsl1r                            69
pdf   *
pdf   * Sjekk om vi skal bruke JASPER og XML generering av dokumenter
pdf  c                   if        l_poff = '1'
pdf  c                   eval      b_pdfp = *off
pdf  c                   eval      b_topt = *off
pdf  c                   eval      b_bott = *off
pdf  c                   eval      w_pdf = 0
pdf  c                   eval      w_pdf_ds = *blanks
pdf  c                   eval      w_ruti = l_ruti
pdf   *
pdf  c                   call      'AP609R'
pdf  c                   parm                    w_ruti
pdf  c                   parm                    w_pdf
pdf  c                   parm                    w_pdf_ds
pdf  c                   eval      d_pdf_ds = w_pdf_ds
pdf   * Vi skal kjøre med jasper
pdf  c                   if        w_pdf = 1 and
pdf  c                             %trim(d_xmlm) <> *blanks
pdf  c                   eval      p_mail = '0'
pdf  c                   eval      w_jkey = l_bach
pdf   *
pdf   * Hent inn xml templaten
pdf   *
pdf  c                   callp     GetHTMLIFS(d_xmlm :'<AS400>')
6.33 c                   callp     ClrHtmlBuffer
pdf   *
pdf   * Finn hvor xml'en skal legges
pdf   *
pdf  c                   eval      XML_path = *blanks
pdf  c                   eval      XML_path = %trim(d_path)
pdf   *
pdf   * Finn path til logo
pdf   *
pdf  c                   eval      jasper_logo = *blanks
pdf  c                   eval      jasper_logo = %trim(d_logo)
pdf   *
pdf   * Jobbnummer er allerede generert i AP600R. Overføres i *lda
pdf   *
pdf  c                   time                    w_date
pdf   * Vi logger ar utskriftprogrammet har startet
pdf  c                   eval      w_jstat = 10
pdf  c                   eval      w_jtext = 'Utskrift av bestillingsforslag ha+
pdf  c                                       r startet'
pdf  c                   call      'AB705R'
pdf  c                   parm                    l_bach
pdf  c                   parm                    w_jstat
pdf  c                   parm                    w_jtext
pdf   * Vi skriver xml for miljø formater
pdf  c                   exsr      xml_envm
pdf  c                   eval      b_pdfp = *on
pdf   *
pdf  c                   endif
pdf   * Hvis et eller annet er galt med parametrene, logges og kjør uten PROA
pdf  c                   if        %trim(d_xmlm) = *blanks
pdf  c                   eval      b_pdfp = *off
pdf   * Vi logger at noe er galt med parametrene
pdf  c                   eval      w_jstat = 20
pdf  c                   eval      w_jtext = 'Finner ikke path til xml !!! +
pdf  c                             Sjekk rutineregister !'
pdf  c                   call      'AB705R'
pdf  c                   parm                    l_bach
pdf  c                   parm                    w_jstat
pdf  c                   parm                    w_jtext
pdf  c                   endif
pdf   *
pdf   *  Hent inn firma/avd. opplysninger dersom
pdf   *  kode for det er satt i rutineregister
pdf   *
pdf  c                   if        l_prfi = 1 or
pdf  c                             l_prfi = 2
pdf  c                   eval      w_prfi = l_prfi
pdf  c                   eval      w_ffir = w_firm
pdf  c                   eval      w_avde = l_avde
pdf   *
pdf  c                   call      'FÅ707R'
pdf  c                   parm                    w_prfi
pdf  c                   parm                    w_ffir
pdf  c                   parm                    w_avde
pdf  c                   parm                    w_fnav
pdf  c                   parm                    w_fad1
pdf  c                   parm                    w_fad2
pdf  c                   parm                    w_fste
pdf  c                   parm                    w_fftx
pdf  c                   parm                    w_tfax
pdf  c                   parm                    w_ftlf
pdf  c                   parm                    w_ffax
6.31 c                   parm                    w_mail
6.31 c                   parm                    w_weba
pdf  c                   endif
      *
pdf  c                   time                    w_dato
pdf  c                   movel     w_dato        w_time            6 0
pdf  c                   move      w_dato        w_ddmy
      *
pdf  c                   else
pdf  c                   eval      b_pdfp = *off
pdf  c                   endif
      *
6.15  * Slår opp etter firmainformasjon
6.15  *
6.15 c     afirl1_key    chain     afirl1r
      *
     c                   endsr
