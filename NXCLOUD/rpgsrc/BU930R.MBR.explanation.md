```markdown
# RPG Program Explanation: BU930R

This RPG (Report Program Generator) code is a traditional, fixed-format ILE RPG (RPG IV) source file designed to fetch stock balances (`lager-beholdning`) for a shop system (`Butikk`). Here is a structured explanation for new developers:

---

## 1. Header and Documentation

- **System/Program Identification**:  
  - System: `ASSHOP`
  - Program: `BU930R`
  - Description: Fetches stock balances for a store.

- **Change History**:  
  - Initial version by HKO on 25.06.2004.

---

## 2. Compile and Edit Options

```rpg
h option(*nodebugio) datedit(*dmy)
```
- `option(*nodebugio)`: Suppresses the generation of debug I/O information.
- `datedit(*dmy)`: Date editing for any date fields (not explicitly used in the code shown).

---

## 3. Parameter Definitions

These variables are used for passing data in and out of the program.

```rpg
d p_firm      s     3
d p_vare      s    15
d p_lage      s     2  0
d p_enhe      s     3
d p_behl      s    11  3
d p_bbes      s    11  3
d p_pakk      s    11  3
d p_disp      s    11  3
```

- `p_firm`: Company/Firm ID (3-character string)
- `p_vare`: Item/Article number (15-character string)
- `p_lage`: Warehouse/location (2-digit integer)
- `p_enhe`: Unit of measure (3-character string)
- `p_behl`: Stock balance (11-digit number, 3 decimals)
- `p_bbes`: Reserved stock (11-digit number, 3 decimals)
- `p_pakk`: Packed stock (11-digit number, 3 decimals)
- `p_disp`: Available for dispatch (11-digit number, 3 decimals)

These variables will be populated by the program and/or by the called program.

---

## 4. Local Variable

```rpg
d w_firm      s     3  0
```
- `w_firm`: Local numeric variable to hold the firm ID as a 3-digit number. (Though declared as numeric, it is assigned from `p_firm`, which is a string.)

---

## 5. Main Program Logic

### a. Move Parameter to Local Variable

```rpg
c                   move      p_firm        w_firm
```
- Moves the value from `p_firm` (string) to `w_firm` (numeric). This may be necessary if the called program expects a numeric firm ID.

### b. Call External Program

```rpg
c                   call      'VL700R'
c                   parm                    w_firm
c                   parm                    p_vare
c                   parm                    p_lage
c                   parm                    p_enhe
c                   parm                    p_behl
c                   parm                    p_bbes
c                   parm                    p_pakk
c                   parm                    p_disp
```
- Calls another program, `VL700R`.
- Passes the local and parameter variables as arguments to `VL700R`.
- Inputs: probably `w_firm`, `p_vare`, `p_lage`, `p_enhe`
- Outputs: likely `p_behl`, `p_bbes`, `p_pakk`, `p_disp` (to be filled by `VL700R`).

### c. Program End and Cleanup

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Sets the LR (last record) indicator on (`*inlr = *on`), which tells RPG to clean up (close files, clear resources, etc.) and ends the program.

---

## 6. Subroutine: Initialization

### *INZSR Subroutine

```rpg
c     *inzsr        begsr
...
c                   endsr
```
- The `*INZSR` subroutine runs automatically at program initialization.
- Sets up the parameter list for entry into the program (i.e., defines what will be received when called from elsewhere).
- Each `parm` statement defines the parameters the program expects, matching the parameter variables defined earlier.

---

## 7. Entry Parameter List

```rpg
c     *entry        plist
c                   parm                    p_firm
c                   parm                    p_vare
c                   parm                    p_lage
c                   parm                    p_enhe
c                   parm                    p_behl
c                   parm                    p_bbes
c                   parm                    p_pakk
c                   parm                    p_disp
```
- Defines the exact interface for calls to this program: the order, type, and variables to expect.

---

## 8. Summary

- **Purpose**: Makes a call to an external program (`VL700R`) to retrieve stock information for a particular item, unit, and warehouse for a firm.
- **Input/Output**: Uses parameters to interface both for being called and for calling the next program.
- **Design**: Simple "wrapper" or mediator program, handling parameter format, setup, and call; results are passed back via parameters.

---

## 9. Key Concepts for New Developers

- **Parameter Passing**: Both ways (into and out of the program, and to the called program).
- **Subroutine Usage**: `*INZSR` is always run at program start for initialization.
- **Fixed-format RPG**: This program uses the traditional C-spec, D-spec, etc. layout.

---

**Tip:** If you want to adapt or debug, focus on:
- The data types and lengths expected by both this program and `VL700R`.
- Ensuring correct movement/conversion between string and numeric formats (notably `w_firm` and `p_firm`).
- How the calling application provides or expects the eight parameters.

---
```