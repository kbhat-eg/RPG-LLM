# RPG Source Code Explanation

This RPG code is written in the /FREE format and is designed to run on IBM i (AS/400) systems. The program appears to be part of a solution dealing with "Kontaktpersoner" (contacts/persons), specifically reading from a file via parameters. The code has Norwegian comments and variable names. Below is a section-by-section explanation:

---

## Header and Declaration Section

```rpg
h option(*nodebugio) datedit(*dmy)
```
- **h option(*nodebugio)**: The program won't include debug information for database input/output operations.
- **datedit(*dmy)**: Date editing will use the day/month/year format.

---

## File Declarations

```rpg
frk790d    cf   e             workstn
```
- **frk790d**: Declares a display file (workstation file, DSPF) for user interface interactions.

---

## Data Definitions

### Data Area

```rpg
d                uds
d l_firm                944    946  0
```
- Declares that the program will use the **local data area (LDA)**. 
- **l_firm**: 3-character (positions 944-946) field from the LDA, usually holds the firm or company number.

### Variables

```rpg
d b_feil          s              1    inz(*off)
d w_firm          s              3  0
```
- **b_feil**: 1-character status variable, initial value OFF. Used to indicate error status.
- **w_firm**: 3-digit numeric variable for the firm number.

---

## Main Program Flow

### Opening Screen Logic (`B1 Behandle åpningsbildet`)

```rpg
c     b1taga        tag
c                   exfmt     b1bld
```
- **b1taga tag**: Label for the start of the main screen processing.
- **exfmt b1bld**: Formats and displays the main screen (b1bld record format from the display file).

#### Function Key Handling

```rpg
c                   select
c                   when      *inkc or *inkl
c                   goto      avslutt
c                   endsl
```
- Reacts to function keys (e.g., F3/Exit or F12/Cancel).
- If such keys are pressed, the program jumps to the "avslutt" (exit) logic.

#### Input Field Validation

```rpg
c                   exsr      sjekk_input
c                   if        b_feil = *on
c                   goto      b1taga
c                   endif
```
- Calls the **sjekk_input** subroutine to validate screen input.
- If error detected (**b_feil = *on**), redisplays the screen for correction.

#### Default Field Initialization

```rpg
c                   if        b1fldr = *blank
c                   eval      b1fldr = 'PRIS_INN'
c                   endif
```
- If the **b1fldr** field is empty, it is set to a default value 'PRIS_INN'.

#### Calling External Programs

```rpg
c                   call      'RK791C'
c                   parm                    b1file
c                   parm                    b1fldr
c                   parm                    b_feil
```
- Calls the program 'RK791C', passing **b1file**, **b1fldr**, and **b_feil** as parameters.
- If this call results in an error (b_feil = *on), shows an error screen and returns to the main screen.

```rpg
c                   if        b_feil = *on
c                   exfmt     b1msg
c                   goto      b1taga
c                   endif
```

- If **b_feil** is ON after the call, display a message screen (b1msg) and return to the main input screen.

#### Chain to Control Program

```rpg
c                   call      'RK791R'
```
- Calls another control program 'RK791R' for further processing.

---

## Exit Logic

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- **avslutt tag**: Label for exit point.
- **eval *inlr = *on**: Closes files, ends the program gracefully.
- **return**: Exits the program.

---

## Subroutines

### `sjekk_input` — Input Field Validation

```rpg
c     sjekk_input   begsr
c                   eval      b_feil = *off
c                   if        b1file = *blank
c                   eval      b_feil = *on
c                   endif
c                   endsr
```
- Resets error flag (**b_feil**) to OFF.
- If **b1file** is blank, sets **b_feil** to ON.
- Ends subroutine.

### *inzsr — Initialization Subroutine

```rpg
c     *inzsr        begsr
c                   eval      w_firm = l_firm
c                   eval      b1fldr = 'PRIS_INN'
c                   endsr
```
- Runs at program start.
- Gets the firm number from the LDA and sets **w_firm**.
- Initializes **b1fldr** to 'PRIS_INN'.

---

## Summary

**Overall Flow:**  
1. Screen is shown to the user for input.
2. User input is validated; if invalid, the screen is shown again.
3. If input is valid, another program is called for data retrieval.
4. If error occurs during retrieval, the message is shown and user can correct input.
5. After successful data retrieval, a control program is called.
6. User may exit at any time with function keys.

**Best Use:**  
This program is a typical IBM i batch interface program for data validation and processing, modular by calling separate programs for business logic and error messaging. 

**Customization:**  
Adaptable for various screens, files, or logic, following the established error handling, subroutine, and user interface model.