# Program Overview

This ILE RPG (RPG IV) program, LP500R, is a workstation (interactive) program built as part of the "ASLAGR" system. Its function is a **display inquiry of supplier distribution** ("spørring på leverandørdistribusjon"). It uses a subfile-based screen to display and select codes relevant to different distribution types.

## Structure & Flow

### File Specification (`F-Spec`)

```rpg
flp500d    cf   e             workstn sfile(b1sfl:w_srrn)
```
- Declares file `LP500D` as a display device file with a subfile (`b1sfl`) using `w_srrn` as the relative record number for navigation.

---

### Data & Variable Definitions (`D-Spec`)

Arrays to hold codes (from compile-time data):
```rpg
d a_type          s             20    dim(20) ctdata perrcd(1)
d a_form          s             20    dim(20) ctdata perrcd(1)
d a_mott          s             20    dim(20) ctdata perrcd(1)
```
- `a_type`, `a_form`, `a_mott`: Each is an array of 20 elements of 20-character strings, loaded via compile-time data at the bottom of the source.

Parameters and control variables:
- `p_firm`, `p_type`, `p_kode`: Input parameters, possibly company, type, and code.
- Various `w_*` variables: Used for subfile control (page size, current, first, last record numbers), record selection, and navigation.
- `b_valg_ok`: Boolean flag if a selection has been made.

Constant:
- `c_sfil`: Subfile page size (initialized to 8).

---

### Control Information

**Indicator Usage**
The comments document which indicators (`*INxx`) are used for what. For example:
- `*IN10` = Roll key
- `*IN14` = SFLCLR (clear subfile)
- `*IN16` = ReadC (no more records)
- `*IN21` = Home key
- `*IN22` = Cursor positioning

---

### Main Processing

#### Main Loop and Key Handling

**Program Entry:**
- The program starts at tag `b2taga`, displays initial screen (`b2cmd`), calls a subroutine to display the subfile, then processes user function keys.

**Function Key Handling:**
- `<F3>`/`<F12>` (`*INKC`, `*INKL`): Exit program.
- `<ROLL UP>` (`*IN10`): Calls subroutine to create/fill the next page of the subfile.
- `<HOME>` (`*IN21`): Sets cursor home and redisplays the command keys.

After handling keys, a subroutine processes the subfile for selection events. If an item is selected (`b_valg_ok = *on`), program exits.

---

### Subroutines

#### Subfile Processing (`subfile`)

- Reads changed records from subfile (`readc b1sfl`).
- If no more records, leaves the loop.
- If a record is selected (`b1valg = 1`), stores the code into `p_kode`, sets `b_valg_ok` to on, and exits.

#### Clear Subfile (`clr_subfile`)

- Sets indicator 14 on to clear subfile, writes the control record, then resets subfile counters and indicators.

#### Create/Fill Subfile (`crt_subfile`)

- Advances page size and initializes variables.
- Fills the subfile with up to 20 items per array (`a_type`, `a_form`, or `a_mott` depending on `w_seqe`).
- For each item, it increments counters, writes to the subfile, and stops after 20 or when max per page is reached.
- Sets various navigation/positioning counters.

#### Display Subfile (`dsp_subfile`)

- If there is data, sets indicator for display; otherwise, writes command screen.
- Sets/clears appropriate indicators and displays the subfile control record.

#### Initialization Subroutine (`*INZSR`)

- Loads parameters from the parameter list (`plist`).
- Sets up initial display screen and determines which array to use for the subfile based on `p_type`.
- Calls create subfile to load the first page.

---

### Compile-Time Array Data

At the end, compile-time data fills the three arrays:

- `a_type`: FTP, LU0, SNA, etc.
- `a_form`: EDI, WEBTRADE, etc.
- `a_mott`: IBM, INTERNETT, JERNIA-X25, etc.

Each set of 20 lines (3 blocks, separated by `**`) is loaded into its respective array.

---

## Subfiles Management

- **Subfile** is a mechanism to display a list of items on an interactive screen, allowing for paging and selection.
- **w_srrn**: current record in subfile.
- Controls for paging and navigation are handled by the variables and indicators described above.

---

## Key Fields

- `b1sfl`: Subfile record format
- `b2ctl`: Subfile control format
- `b2cmd`: Command key screen

---

## Comments About Norwegian Notes

- Several comments and names are Norwegian (e.g., "Bruk av indikatorer" = "Use of indicators", "Beskrivelse" = "Description", "leverandørdistribusjon" = "supplier distribution").

---

## Summary

- On program entry, the type of codes to display is determined (`TYPE`, `FORMAT`, or `MOTTAKER`).
- A subfile is filled from the relevant array and displayed.
- User may page through, select an entry (which is returned in `p_kode`), or exit.
- Indicators and subfile control variables manage the display and selection logic.

This is a classic interactive subfile selection program, typical in IBM i (AS/400) environments, leveraging RPG IV's structured features.