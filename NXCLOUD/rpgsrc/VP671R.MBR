     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOFAK
      * Program . . . . : VP671R
      * Beskrivelse . . : Prisfil til kunder
      *
      * Mot Holte-prosjekt kjøres det enn så lenge LA-Lund format. Dette
      * har imidlertid en begrensning på 6-siffers varegruppe. Så fort vi
      * har nytt ASP recordformat klart skal dette sendes Holte Prosjekt
      * v/Hroar Johannesen, og så implementerer han dette i Anbudxx
      *
      * Mot Nettopp Norge (Corrado) og regneark-formatet oversettes
      * Ææ, Øø, og Åå til ansi hex-verdi før de skrives til fil.
      *
      * Logikk for utsendelse av kun endringer er midlertidig fjernet fra
      * programmet. Må endres slik at VP900R returnerer dato for siste
      * endring som har påviket prisen som returneres, for så å teste på
      * denne......
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
8.xx  *       120422 bsa  Nytt program - kopi av VP682R en 120422
      *       310599 HKO  Nytt program
      *       210999 HKO  Tilpasset nytt Nobb prisformat
      *       060100 HKO  Legger ut hele omregningsfaktorer i regnearket
      *       070100 HKO  Tilpasset ny recordbeskrivelse på BYGGDATA
      *       200100 HKO  Lagt inn recordformat for HS-FAKTURA
      *       210100 HKO  Lagt inn recordformat for ENTREKA
      *       170400 HKO  Bruttopris hentes ikke fra opprinnelig pris, men
      *                   fra salgspris. Dette gjør at bruttopris i tillegg
      *                   til salgspris før rabatter kan være lik
      *                   avtalt pris eller tilbudspris. Rabattene vil da
      *                   være eventuelle rabatter på disse.
      *       280400 HKO  Utvidet enhet i recordformat BYGGDATA med
      *                   priskode
      *       171000 HKO  Lagt rabattgruppe inn i regneark
      *       240101 HKO  Leser varesortiment via utplukksfil
      *                   Dersom leverandør er valgt utelatt ved varesort-
      *                   iment tas heller ikke leverandør med i sorteringen
      *       220302 HKO  Rettet feil ved presentasjon av total rabatt hvor
      *                   rabatt-2 inngår
      *       091002 HKO  Lagt inn recordformat for NOBB_INT
      *       110703 HKO  Lagt inn leverandørnavn i REGNEARK-formatet
      *       201003 GRO  Lagt til direktepris m.m. i recordformat BYGGDATA
      *       010604 HKO  Lagt inn EAN-nr i REGNEARK-formatet
      *       120804 HKO  Endret parameter ved kall til VP900R
      *       041104 HKO  Endret parameter ved kall til VP900R
      *       070205 HKO  Utelater utgåtte varer
      *       200405 GRO  Lagt inn ny feltbasert outputfil
      *       020805 HKO  Endret les mot vare-enhet for å finne prisbok-
      *                   enheter og salgsenheter
      *       030406 HKO  Henter kun gammelt varenr på bakgrunn av matching
      *       260606 HKO  Henter pris på bakgrunn av valgt leveringstype
      *       050907 BOF  Endret les av vare hvis leverandør er valgt
5.60  *       231008 BOF  Utvidet med BYGGMANN format
5.61  *       231008 BOF  Lagt komma i regneark i stedet for punktum
5.62  *       010610 BOF  Justert til BYGGDATAWI med konv. æøå, BYGGDATA
5.62  *                   som før.
5.70  * PRGR  311008 bof  Utvidet med prisgruppe
      * 6.10  230609 BSA  Oppdatert med sporingsinformasjon
6.11  * 6.10  290609 bof  Utivdet eannr til 14 og brukt std. oppslag
6.12  *       161109 BOF  Lagt inn BYGGOFFICE som format
6.13  *       060111 BOF  konv også vtekst2 i BYGGDATAWI
6.14  *       180811 BOF  Legger ut netto-pris i BYGGDATA-formular
6.15  *       281111 BOF  Nytt format IBX Catalgue
6.20  * 6.20  021110 bof  Utvidet med utg.dato pr. lager
6.21  * 6.20  030411 bof  Utvidet vvprpf med prisgiver
6.22  * 6.20  020511 bof  Utvidet med varegr./lev.nr + prosent på vtilpf
6.23  * 6.20  190511 bø   Utvidet vl710r med div. info
6.24  * 6.20  070312 BOF  Justering på hente tilbudspris vareruppe og leverandør
6.25  * 6.20  040512 BOF  Rettet feil på siste kolonne for regneark
6.26  * 6.20  071112 BOF  Rettelse vedr. enhet i IBX-formatet
6.27  * 6.20  281112 BOF  Rettet feil vedr regneark som ikke skilte på linjer
6.27  *                   Måtte utvide FIRAPF
6.28  * 6.20  281112 BOF  Endret i priser på BYGGDATA i hht. til spec fra BYGGDATA
6.28  *                   (rettelse av 6.14).
6.29  * 6.20  060814 BOF  Endret Holte format til ; (semikolon) separert fil
6.nu  *       160614 bof  Endret ihht. nummerutvidelse
6.30  * 6.30  040416 BOF  Nytt format REGNEARKPO - unngå ÆØÅ problematikk
6.31  * 6.30  170918 bkv  Utvidet med trelast sortiment
6.32  * 6.32  150819 HKO  Nytt komplett filformat for eksport av vare- og
6.32  *                   prisinformasjon via Logiq. Logiq oversette til eks.
6.32  *                   EHF-format og til Tradeshift (IBX) eller til
6.32  *                   andre formater hvor kunde forventer å motta
6.32  *                   digital varekatalog.
6.32  *                   Logiq beriker med eventuell manglende informasjon
7.01  * 7.01  190607 RHO  (GRO) Lagt til utvidet BYGGDATA-format-Gipling
7.02  * 7.02  050907 BOF  Lagt til ny variant av BYGGDATA-format
7.03  * 7.03  220911 BOF  ÆØÅ problemer, prøver med konv. av ÆØÅ
7.03X * 7.03  261115 BOF  Fjernet 7.03. De kan bruke BYGGDATAWI
7.04  * 7.04  030517 bof  Endret i utlegg av nettopris BYGGDATA (som 6.20)
7.05  * 7.05  020817 bof  Variant av BA-KaLK format (BA-KALK2)
7.06  * 7.06  041017 hko  Variant av Byggdata format (BYGGDATAM2)
7.06  * 7.06              Identisk med Byggdata_2, men med priser i M2
7.07  * 7.07  171217 bof  Variant av EXCEL format (REGNEARKM2) priser i M2
7.08  *k00  030620 BOF NXS-1195  kompilert pga tab.utvidelse
7.09  * 7.09              Tatt vekk kode som ikke trengs når QDLS ikke brukes
7.10  * 7.10  040220 bkv  Lagt inn støtte for REGNEARKS. Bruker bare salgsenhet
      *
8.01  * 8.xx  120422 bsa  Utvidet parameter med GLN nummer.
8.02  * 8.xx  220617 bof  Nytt parameter, kun nobb.nr
8.03  * 8.xx  070623 bsa  Hvis GLN nummer til lager, benytt dette lagernummer
8.02  *PRG2   150622 bsa  Utvidet prisgruppe fra 1 til 2 posisjoner
      *
9.01  *       150110 BOF  Lagt på lev.navn bakerst på BYGGDATA format
9.02  *       060510 BOF  Konv. av æøå
9.04  *       010610 BOF  Justert til BYGGDATAWI med konv. æøå, BYGGDATA
9.04  *                   som før.
9.05  *       080311 BOF  Hvis neg.rabatt gjør om feltet til minus foran
9.06  * Spesialversjon. : Midl. endret slik at nettopris legges ut på
9.06  *                   HS-faktura. Skal endres når Hinfo har rettet
9.06  *                   sitt program.
9.06  *                   Midl. endret slik at alternativt varenr blir
9.06  *                   med som som gammelt varenr
9.06  * Tilpasset for . : HEIMDAL SAG
9.07  *       150416 bof  REGNEARK2, bruke prisenhet(enh1) +  FPAK(enh2)
9.0x  *       090516 bof  Hvis lager utfylt i paramter, så send med dette i VP900R
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     ffstsl1    if   e           k disk    rename(fstspfr:fstsl1r)
     frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
     ffkprl1    if   e           k disk    rename(fkprpfr:fkprl1r)
     fvvarl9    if   e           k disk    rename(vvarpfr:vvarl9r)
     fvvarla    if   e           k disk    rename(vvarpfr:vvarlar)
9.07 fvvarl1    if   e           k disk    rename(vvarpfr:vvarl1r)
     fvvenl3    if   e           k disk    rename(vvenpfr:vvenl3r)
     fvvenl2    if   e           k disk    rename(vvenpfr:vvenl2r)
9.07 fvvenl1    if   e           k disk    rename(vvenpfr:vvenl1r)
     fvvprl1    if   e           k disk    rename(vvprpfr:vvprl1r)
     fvugrl1    if   e           k disk    rename(vugrpfr:vugrl1r)
     fvpkol1    if   e           k disk    rename(vpkopfr:vpkol1r)
     frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
     fvtill1    if   e           k disk    rename(vtilpfr:vtill1r)
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
     ffkdilu    uf   e           k disk    rename(fkdipfr:fkdilur)
     fvshel1    if   e           k disk    rename(vshepfr:vshel1r)
     ffipxl1    if   e           k disk    rename(fipxpfr:fipxl1r)
6.15 fjvarl1    if   e           k disk    rename(jvarpfr:jvarl1r)
6.32 fjvlml1    if   e           k disk    rename(jvlmpfr:jvlml1r)
     ffipxlu    uf a e           k disk    rename(fipxpfr:fipxlur)
6.31 fvvlel1    if   e           k disk    rename(vvlepfr:vvlel1r)
8.01 fmjlol2    if   e           k disk    rename(mjlopfr:mjlol2r)
8.01 fvlagl1    if   e           k disk    rename(vlagpfr:vlagl1r)
     fvvawpf    if   e           k disk
      *
     ffibspf    uf a e           k disk
     ffibdpf    uf a e           k disk
     ffinnpf    uf a e           k disk
     ffircpf    uf a e           k disk
     ffihppf    uf a e           k disk
     ffinopf    uf a e           k disk
     ffinipf    uf a e           k disk
     ffirapf    uf a e           k disk
     ffiskpf    uf a e           k disk
     ffih1pf    uf a e           k disk
     ffih2pf    uf a e           k disk
     ffietpf    uf a e           k disk
6.12 ffibopf    uf a e           k disk
6.15 ffibxpf    uf a e           k disk
6.32 ffilqpf    uf a e           k disk
7.01 ffibypf    uf a e           k disk
7.02 ffibzpf    uf a e           k disk
      *
      * Definering av datastrukturer
      *
      *  Datastruktur - parametre inn til VP900R
      *
     d                 ds
     d hirec                        120
     d  hifirm                        3  0 overlay(hirec)
     d  hirkat                        3  0 overlay(hirec:4)
     d  hikund                        6  0 overlay(hirec:7)
     d  hikpro                        6  0 overlay(hirec:13)
     d  hivare                       15    overlay(hirec:19)
     d  hilety                        1  0 overlay(hirec:34)
     d  hienhe                        3    overlay(hirec:35)
     d  hidato                         d   overlay(hirec:38) datfmt(*iso)
     d  hitime                         t   overlay(hirec:48) timfmt(*iso)
6.nu d  hinumm                        8  0 overlay(hirec:56)
6.nu d  hikode                        1    overlay(hirec:64)
6.nu d  hidekn                        5  2 overlay(hirec:65)
6.nu d  hiavgf                        1  0 overlay(hirec:70)
6.nu d  hipriv                        1  0 overlay(hirec:71)
6.nu d  hitilb                        1    overlay(hirec:72)
6.nu d  hiskaf                        1    overlay(hirec:73)
6.nu d  hildor                        6  0 overlay(hirec:74)
6.nu d  hisapr                        9  2 overlay(hirec:80)
6.nu d  hikopr                        9  2 overlay(hirec:89)
8.02 d  hiprgr                        2    overlay(hirec:98)
8.02 d  hilage                        2  0 overlay(hirec:100)
9.0x d* hilage                        2  0 overlay(hirec:99)
     d  hiinlr                        1    overlay(hirec:120)
      *
      *  Datastruktur - parametre ut fra VP900R
      *
     d                 ds
     d horec                         80
     d  hokpri                        1    overlay(horec:2)
     d  hooppr                        9  2 overlay(horec:3)
     d  hosapr                        9  2 overlay(horec:12)
     d  horab1                        5  2 overlay(horec:30)
     d  horab2                        5  2 overlay(horec:35)
     d  hoomva                        1    overlay(horec:70)
8.02 d  hoprgr                        2    overlay(horec:71)
      *
      *  Recordbeskrivelse ASP standard pris-recordformat
      *
     d                 ds
     d* d_asp                        128
     d*  d_asp_fill1                   1    overlay(d_asp:  1) inz(*blank)
     d*  d_asp_vare                   15    overlay(d_asp:  2)
     d*  d_asp_tek1                   30    overlay(d_asp: 17)
     d*  d_asp_eann                   13    overlay(d_asp: 47)
     d*  d_asp_fill2                   6    overlay(d_asp: 60) inz('******')
     d*  d_asp_fdat                    6  0 overlay(d_asp: 66)
     d*  d_asp_enh1                    3    overlay(d_asp: 72)
     d*  d_asp_fill4                   1    overlay(d_asp: 75) inz(*blank)
     d*  d_asp_fill5                   9  2 overlay(d_asp: 76) inz(0)
     d*  d_asp_ntpr                    9  2 overlay(d_asp: 85)
     d*  d_asp_fill6                   4    overlay(d_asp: 94) inz(*blank)
     d*  d_asp_sapr                    9  2 overlay(d_asp: 98)
     d*  d_asp_fill7                  17    overlay(d_asp:107) inz(*blank)
     d*  d_asp_hgpr                    2    overlay(d_asp:124)
     d*  d_asp_ugrp                    3    overlay(d_asp:126)
      *
      *  Recordbeskrivelse BA-KALK pris-recordformat
      *
     d                 ds
     d d_bs                         210
     d  d_bs_vare                    15    overlay(d_bs:  1)
     d  d_bs_gvar                    15    overlay(d_bs: 16)
     d  d_bs_nobb                     8  0 overlay(d_bs: 31)
     d  d_bs_ogrp                     2  0 overlay(d_bs: 39)
     d  d_bs_hgrp                     2  0 overlay(d_bs: 41)
     d  d_bs_ugrp                     3  0 overlay(d_bs: 43)
     d  d_bs_utxt                    40    overlay(d_bs: 46)
     d  d_bs_vtxt                    72    overlay(d_bs: 86)
     d  d_bs_enh1                     4    overlay(d_bs:158)
     d  d_bs_fdat                     8  0 overlay(d_bs:162)
     d  d_bs_rgrp                     7    overlay(d_bs:170) inz(*blank)
     d  d_bs_pkod                     6    overlay(d_bs:177)
     d  d_bs_sapr                     9  2 overlay(d_bs:183)
     d  d_bs_ntpr                     9  2 overlay(d_bs:192)
     d  d_bs_dipr                     9  2 overlay(d_bs:201) inz(0)
     d  d_bs_lkod                     1    overlay(d_bs:210)
      *
      *  Recordbeskrivelse BYGGDATA pris-recordformat
      *
     d                 ds
9.01 d d_bd                         261
     d  d_bd_ogrp                     2  0 overlay(d_bd:  1)
     d  d_bd_hgrp                     2  0 overlay(d_bd:  3)
     d  d_bd_ugrp                     3  0 overlay(d_bd:  5)
     d  d_bd_fill1                    1    overlay(d_bd:  8) inz(';')
     d  d_bd_eann                    13  0 overlay(d_bd:  9)
     d  d_bd_fill2                    1    overlay(d_bd: 22) inz(';')
     d  d_bd_vare                     8    overlay(d_bd: 23)
     d  d_bd_fill3                    1    overlay(d_bd: 31) inz(';')
     d  d_bd_utxt                    35    overlay(d_bd: 32)
     d  d_bd_fill4                    1    overlay(d_bd: 67) inz(';')
     d  d_bd_vtx1                    35    overlay(d_bd: 68)
     d  d_bd_fill5                    1    overlay(d_bd:103) inz(';')
     d  d_bd_grpr                     9  2 overlay(d_bd:104)
     d  d_bd_fill6                    1    overlay(d_bd:113) inz(';')
     d  d_bd_sapr                     9  2 overlay(d_bd:114)
     d  d_bd_fill7                    1    overlay(d_bd:123) inz(';')
     d  d_bd_enh1                     5    overlay(d_bd:124)
     d  d_bd_fill8                    1    overlay(d_bd:129) inz(';')
     d  d_bd_gvar                     8    overlay(d_bd:130)
     d  d_bd_fill9                    1    overlay(d_bd:138) inz(';')
     d  d_bd_vtx2                    35    overlay(d_bd:139)
     d  d_bd_fill10                   4    overlay(d_bd:174) inz(';;;;')
9.05 d  d_bd_raba                     4    overlay(d_bd:178)
     d  d_bd_fill11                   1    overlay(d_bd:182) inz(';')
     d  d_bd_nobb                     8  0 overlay(d_bd:183)
     d  d_bd_fill12                   1    overlay(d_bd:191) inz(';')
     d  d_bd_nlev                     6  0 overlay(d_bd:192)
     d  d_bd_fill13                   1    overlay(d_bd:198) inz(';')
     d  d_bd_nmod                     8  0 overlay(d_bd:199)
     d  d_bd_fill14                   1    overlay(d_bd:207) inz(';')
     d  d_bd_pkod                     1    overlay(d_bd:208)
     d  d_bd_fill15                   1    overlay(d_bd:209) inz(';')
     d  d_bd_vtyp                    10    overlay(d_bd:210)
     d  d_bd_fill16                   1    overlay(d_bd:220) inz(';')
     d  d_bd_fabp                     9  2 overlay(d_bd:221)
9.01 d  d_bd_fill17                   1    overlay(d_bd:230) inz(';')
9.01 d  d_bd_lnav                    30    overlay(d_bd:231)
      *
7.01  *
7.01  *  Recordbeskrivelse BYGGDATA pris-recordformat (utvidet)
7.01  *
7.01 d                 ds
7.01 d d_bdu                        239
7.01 d  d_bdu_copy                  229    overlay(d_bdu:  1)
7.01 d  d_bdu_fill17                  1    overlay(d_bdu:230) inz(';')
7.01 d  d_bdu_netp                    9  2 overlay(d_bdu:231)
7.02  *
7.02  *  Recordbeskrivelse BYGGDATA m/kundepris siste kolonne (utvidet)
7.02  *
7.02 d                 ds
7.02 d d_bd2                        230
7.02 d  d_bd2_copy                  220    overlay(d_bd2:  1)
7.02 d  d_bd2_netp                    9  2 overlay(d_bd2:221)
7.02 d  d_bd2_fill17                  1    overlay(d_bd2:230) inz(';')
      *
      *  Recordbeskrivelse CORRADO pris-recordformat
      *
     d                 ds
     d d_nn                         189
     d  d_nn_vare                    15    overlay(d_nn:  1)
     d  d_nn_fill1                    1    overlay(d_nn: 16) inz(X'05')
     d  d_nn_nobb                     8  0 overlay(d_nn: 17)
     d  d_nn_fill2                    1    overlay(d_nn: 25) inz(X'05')
     d  d_nn_vtx1                    35    overlay(d_nn: 26)
     d  d_nn_fill3                    1    overlay(d_nn: 61) inz(X'05')
     d  d_nn_vtx2                    35    overlay(d_nn: 62)
     d  d_nn_fill4                    1    overlay(d_nn: 97) inz(X'05')
     d  d_nn_enh1                     3    overlay(d_nn: 98)
     d  d_nn_fill5                    1    overlay(d_nn:101) inz(X'05')
     d  d_nn_ntpr                    10    overlay(d_nn:102)
     d  d_nn_fill6                    1    overlay(d_nn:112) inz(X'05')
     d  d_nn_sapr                    10    overlay(d_nn:113)
     d  d_nn_fill7                    1    overlay(d_nn:123) inz(X'05')
     d  d_nn_fnav                    30    overlay(d_nn:124)
     d  d_nn_fill8                    1    overlay(d_nn:154) inz(X'05')
     d  d_nn_utxt                    35    overlay(d_nn:155)
      *
      *  Recordbeskrivelse FRIKALK pris-recordformat
      *
     d                 ds
     d d_rc                         210
     d  d_rc_nobd                     6  0 overlay(d_rc:  1)
     d  d_rc_nobb                     8  0 overlay(d_rc:  7)
     d  d_rc_vare                    15    overlay(d_rc: 15)
     d  d_rc_gvar                    15    overlay(d_rc: 30)
     d  d_rc_ogrp                     2  0 overlay(d_rc: 45)
     d  d_rc_hgrp                     2  0 overlay(d_rc: 47)
     d  d_rc_ugrp                     3  0 overlay(d_rc: 49)
     d  d_rc_fill                     3    overlay(d_rc: 52) inz(*blank)
     d  d_rc_utxt                    35    overlay(d_rc: 55)
     d  d_rc_vtx1                    35    overlay(d_rc: 90)
     d  d_rc_vtx2                    35    overlay(d_rc:125)
     d  d_rc_enh1                     3    overlay(d_rc:160)
     d  d_rc_fdat                     8  0 overlay(d_rc:163)
     d  d_rc_tdat                     8  0 overlay(d_rc:171) inz(0)
     d  d_rc_rgrp                    10    overlay(d_rc:179) inz(*blank)
     d  d_rc_sapr                     9  2 overlay(d_rc:189)
     d  d_rc_ntpr                     9  2 overlay(d_rc:198)
     d  d_rc_pkod                     3    overlay(d_rc:207)
      *
      *  Recordbeskrivelse HOLTE pris-recordformat (LA.Lund-format)
      *
     d                 ds
     d d_hp                         158
     d  d_hp_ogrp                     2  0 overlay(d_hp:  1)
     d  d_hp_hgrp                     2  0 overlay(d_hp:  3)
     d  d_hp_ugrp                     2  0 overlay(d_hp:  5)
6.29 d  d_hp_fill1                    6    overlay(d_hp:  7) inz(';')
     d  d_hp_vare                    13    overlay(d_hp: 13)
6.29 d  d_hp_fill2                    1    overlay(d_hp: 26) inz(';')
     d  d_hp_utxt                    35    overlay(d_hp: 27)
6.29 d  d_hp_fill3                    1    overlay(d_hp: 62) inz(';')
     d  d_hp_vtxt                    65    overlay(d_hp: 63)
6.29 d  d_hp_fill4                    1    overlay(d_hp:128) inz(';')
     d  d_hp_ntpr                     9  2 overlay(d_hp:129)
6.29 d  d_hp_fill5                   11    overlay(d_hp:138) inz(';')
     d  d_hp_enh1                    10    overlay(d_hp:149)
      *
      *  Recordbeskrivelse NOBB pris-recordformat
      *
     d                 ds
     d d_nobb                        74
     d  d_nobb_fill                   6    overlay(d_nobb: 1) inz(*blank)
     d  d_nobb_nobd                   6  0 overlay(d_nobb: 7)
     d  d_nobb_vare                  15    overlay(d_nobb:13)
     d  d_nobb_nobb                   8  0 overlay(d_nobb:28)
     d  d_nobb_pakn                   3    overlay(d_nobb:36) inz('000')
     d  d_nobb_pris                   9  2 overlay(d_nobb:39)
     d  d_nobb_fdat                   8  0 overlay(d_nobb:48)
     d  d_nobb_tdat                   8  0 overlay(d_nobb:56)
     d  d_nobb_pkod                   3    overlay(d_nobb:64)
     d  d_nobb_edat                   8  0 overlay(d_nobb:67)
      *
      * Definering av NOBB integrasjonsformat - varerecord
      *
     d                 ds
     d d_nvar                       252
     d  d_nvar_vtyp                   2    overlay(d_nvar:1)   inz('1,')
     d  d_nvar_nobb                   8  0 overlay(d_nvar:3)
     d  d_nvar_fil1                   1    overlay(d_nvar:11)  inz(',')
     d  d_nvar_modn                   8  0 overlay(d_nvar:12)
     d  d_nvar_fil2                   1    overlay(d_nvar:20)  inz(',')
     d  d_nvar_vgrp                   7    overlay(d_nvar:21)
     d   d_nvar_ogrp                  2  0 overlay(d_nvar_vgrp  )
     d   d_nvar_hgrp                  2  0 overlay(d_nvar_vgrp:3)
     d   d_nvar_ugrp                  3  0 overlay(d_nvar_vgrp:5)
     d  d_nvar_fil3                   2    overlay(d_nvar:28)  inz(',"')
     d  d_nvar_tek1                  35    overlay(d_nvar:30)
     d  d_nvar_fil4                   3    overlay(d_nvar:65)  inz('","')
     d  d_nvar_tek2                  35    overlay(d_nvar:68)
     d  d_nvar_fil5                   3    overlay(d_nvar:103) inz('","')
     d  d_nvar_mte1                  35    overlay(d_nvar:106)
     d  d_nvar_fil6                   3    overlay(d_nvar:141) inz('","')
     d  d_nvar_mte2                  35    overlay(d_nvar:144)
     d  d_nvar_fil7                   2    overlay(d_nvar:179) inz('",')
     d  d_nvar_eann                  13  0 overlay(d_nvar:181)
     d  d_nvar_fil8                   2    overlay(d_nvar:194) inz(',"')
     d  d_nvar_pvar                  15    overlay(d_nvar:196)
     d  d_nvar_fil9                   3    overlay(d_nvar:211) inz('","')
     d  d_nvar_lvar                  15    overlay(d_nvar:214)
     d  d_nvar_fil10                  2    overlay(d_nvar:229) inz('",')
     d  d_nvar_ldor                   6  0 overlay(d_nvar:231)
     d  d_nvar_fil11                  1    overlay(d_nvar:237) inz(',')
     d  d_nvar_prod                   6  0 overlay(d_nvar:238)
     d  d_nvar_fil12                  1    overlay(d_nvar:244) inz(',')
     d  d_nvar_adat                   8    overlay(d_nvar:245)
      *
      * Definering av NOBB integrasjonsformat - pakningsrecord
      *
     d                 ds
     d d_npak                       252
     d  d_npak_etyp                   3    overlay(d_npak:1)   inz('2,"')
     d  d_npak_pakn                   3    overlay(d_npak:4)
     d  d_npak_fil1                   3    overlay(d_npak:7)   inz('","')
     d  d_npak_enhe                   3    overlay(d_npak:10)
     d  d_npak_fil2                   2    overlay(d_npak:13)  inz('",')
     d  d_npak_ofak_w                 7  4 overlay(d_npak:15)
     d  d_npak_fil3                   1    overlay(d_npak:22)  inz(',')
     d  d_npak_bred                   6  0 overlay(d_npak:23)
     d  d_npak_fil4                   1    overlay(d_npak:29)  inz(',')
     d  d_npak_leng                   6  0 overlay(d_npak:30)
     d  d_npak_fil5                   1    overlay(d_npak:36)  inz(',')
     d  d_npak_hoyd                   6  0 overlay(d_npak:37)
     d  d_npak_fil6                   1    overlay(d_npak:43)  inz(',')
     d  d_npak_vekt                   9  0 overlay(d_npak:44)
     d  d_npak_fil7                   1    overlay(d_npak:53)  inz(',')
     d  d_npak_volu                   8  5 overlay(d_npak:54)
     d  d_npak_fil8                   1    overlay(d_npak:62)  inz(',')
     d  d_npak_anta                   8  2 overlay(d_npak:63)
     d  d_npak_fil9                   1    overlay(d_npak:71)  inz(',')
     d  d_npak_eean                  13  0 overlay(d_npak:72)
     d  d_npak_fil10                  1    overlay(d_npak:85)  inz(',')
     d  d_npak_ofak                  10  4 overlay(d_npak:86)
     d  d_npak_fil11                  1    overlay(d_npak:96)  inz(',')
     d  d_npak_edun                  14  0 overlay(d_npak:97)
     d  d_npak_fil12                  1    overlay(d_npak:111) inz(',')
     d  d_npak_best                   1  0 overlay(d_npak:112)
     d  d_npak_fil13                  2    overlay(d_npak:113) inz(',"')
     d  d_npak_paks                   3    overlay(d_npak:115)
     d  d_npak_fil14                  2    overlay(d_npak:118) inz('",')
     d  d_npak_antp                   8  0 overlay(d_npak:120)
      *
      * Definering av NOBB integrasjosnformat - prisrecord
      *
     d                 ds
     d d_npri                       252
     d  d_npri_ptyp                   2    overlay(d_npri:1)  inz('3,')
     d  d_npri_pris                   9  2 overlay(d_npri:3)
     d  d_npri_fil1                   1    overlay(d_npri:12) inz(',')
     d  d_npri_gdat                   8  0 overlay(d_npri:13)
     d  d_npri_fil2                   1    overlay(d_npri:21) inz(',')
     d  d_npri_pldo                   6  0 overlay(d_npri:22)
     d  d_npri_fil3                   2    overlay(d_npri:28) inz(',"')
     d  d_npri_plva                  15    overlay(d_npri:30)
     d  d_npri_fil4                   2    overlay(d_npri:45) inz('",')
     d  d_npri_inpr                   9  2 overlay(d_npri:47)
     d  d_npri_fil5                   1    overlay(d_npri:56) inz(',')
     d  d_npri_kopr                   9  2 overlay(d_npri:57)
     d  d_npri_fil6                   1    overlay(d_npri:66) inz(',')
     d  d_npri_sapr                   9  2 overlay(d_npri:67)
     d  d_npri_fil7                   1    overlay(d_npri:76) inz(',')
     d  d_npri_tdat                   8  0 overlay(d_npri:77)
      *
      *  Recordbeskrivelse REGNEARK
      *
     d                 ds
6.27 d d_ra                         300
     d  d_ra_vare                    15    overlay(d_ra:  1)
     d  d_ra_fill1                    1    overlay(d_ra: 16) inz(X'05')
     d  d_ra_nobb                     8  0 overlay(d_ra: 17)
     d  d_ra_fill2                    1    overlay(d_ra: 25) inz(X'05')
     d  d_ra_fill3                    1    overlay(d_ra: 26) inz('"')
     d  d_ra_vtx1                    35    overlay(d_ra: 27)
     d  d_ra_fill4                    1    overlay(d_ra: 62) inz('"')
     d  d_ra_fill5                    1    overlay(d_ra: 63) inz(X'05')
     d  d_ra_fill6                    1    overlay(d_ra: 64) inz('"')
     d  d_ra_vtx2                    35    overlay(d_ra: 65)
     d  d_ra_fill7                    1    overlay(d_ra:100) inz('"')
     d  d_ra_fill8                    1    overlay(d_ra:101) inz(X'05')
     d  d_ra_fill9                    1    overlay(d_ra:102) inz('"')
     d  d_ra_pkod                     5    overlay(d_ra:103)
     d  d_ra_fill10                   1    overlay(d_ra:108) inz('"')
     d  d_ra_fill11                   1    overlay(d_ra:109) inz(X'05')
     d  d_ra_raba                     6    overlay(d_ra:110)
     d  d_ra_fill12                   1    overlay(d_ra:116) inz(X'05')
     d  d_ra_fill13                   1    overlay(d_ra:117) inz('"')
     d  d_ra_enh1                     3    overlay(d_ra:118)
     d  d_ra_fill14                   1    overlay(d_ra:121) inz('"')
     d  d_ra_fill15                   1    overlay(d_ra:122) inz(X'05')
     d  d_ra_s1pr                    10    overlay(d_ra:123)
     d  d_ra_fill16                   1    overlay(d_ra:133) inz(X'05')
     d  d_ra_n1pr                    10    overlay(d_ra:134)
     d  d_ra_fill17                   1    overlay(d_ra:144) inz(X'05')
     d  d_ra_fill18                   1    overlay(d_ra:145) inz('"')
     d  d_ra_enh2                     3    overlay(d_ra:146)
     d  d_ra_fill19                   1    overlay(d_ra:149) inz('"')
     d  d_ra_fill20                   1    overlay(d_ra:150) inz(X'05')
     d  d_ra_n2pr                    10    overlay(d_ra:151)
     d  d_ra_fill21                   1    overlay(d_ra:161) inz(X'05')
     d  d_ra_omr2                    13    overlay(d_ra:162)
     d  d_ra_fill22                   1    overlay(d_ra:175) inz(X'05')
     d  d_ra_fill23                   1    overlay(d_ra:176) inz('"')
     d  d_ra_enh3                     3    overlay(d_ra:177)
     d  d_ra_fill24                   1    overlay(d_ra:180) inz('"')
     d  d_ra_fill25                   1    overlay(d_ra:181) inz(X'05')
     d  d_ra_n3pr                    10    overlay(d_ra:182)
     d  d_ra_fill26                   1    overlay(d_ra:192) inz(X'05')
     d  d_ra_omr3                    13    overlay(d_ra:193)
     d  d_ra_fill27                   1    overlay(d_ra:206) inz(X'05')
     d  d_ra_vgrp                     7    overlay(d_ra:207)
     d  d_ra_fill28                   1    overlay(d_ra:214) inz(X'05')
     d  d_ra_fill29                   1    overlay(d_ra:215) inz('"')
     d  d_ra_utxt                    35    overlay(d_ra:216)
     d  d_ra_fill30                   1    overlay(d_ra:251) inz('"')
     d  d_ra_fill31                   1    overlay(d_ra:252) inz(X'05')
6.11 d  d_ra_eann                    14  0 overlay(d_ra:253)
6.25 d  d_ra_fill32                   1    overlay(d_ra:267) inz(X'05')
6.25 d  d_ra_fill33                   1    overlay(d_ra:268) inz('"')
6.25 d  d_ra_lnav                    30    overlay(d_ra:269)
6.25 d  d_ra_fill34                   1    overlay(d_ra:299) inz('"')
6.27 d  d_ra_fill35                   1    overlay(d_ra:300) inz(X'05')
      *
      *  Recordbeskrivelse SALGSSUPP pris-recordformat
      *
     d                 ds
     d d_sk                         161
     d  d_sk_vare                    12    overlay(d_sk:  1)
     d  d_sk_vtx1                    30    overlay(d_sk: 13)
     d  d_sk_vtx2                    30    overlay(d_sk: 43)
     d  d_sk_ogrp                     2  0 overlay(d_sk: 73)
     d  d_sk_hgrp                     2  0 overlay(d_sk: 75)
     d  d_sk_ugrp                     3  0 overlay(d_sk: 77)
     d  d_sk_fill                     1    overlay(d_sk: 80) inz(*blank)
     d  d_sk_utxt                    30    overlay(d_sk: 81)
     d  d_sk_enh1                     3    overlay(d_sk:111)
     d  d_sk_sapr                     9  2 overlay(d_sk:114)
     d  d_sk_ntpr                     9  2 overlay(d_sk:123)
     d  d_sk_lnav                    30    overlay(d_sk:132)
      *
      *  Recordbeskrivelse HS-FAKTURA pris-recordformat
      *
     d                 ds
     d d_h1                         131
     d  d_h1_gros                     4  0 overlay(d_h1:  1) inz(9999)
     d  d_h1_vare                    13    overlay(d_h1:  5)
     d  d_h1_vtx1                    35    overlay(d_h1: 19)
     d  d_h1_fill1                    1    overlay(d_h1: 54)
     d  d_h1_vtx2                    12    overlay(d_h1: 55)
     d  d_h1_fill2                    1    overlay(d_h1: 67)
     d  d_h1_enh1                     3    overlay(d_h1: 68)
     d  d_h1_fill3                    3    overlay(d_h1: 71)
     d  d_h1_sapr                     9    overlay(d_h1: 74)
     d  d_h1_rgrp                     6  0 overlay(d_h1: 83) inz(0)
     d  d_h1_fill4                   12    overlay(d_h1: 89)
     d  d_h1_rkod                     1  0 overlay(d_h1:101) inz(1)
     d  d_h1_utxt                    30    overlay(d_h1:102)
      *
     d d_h2                          19
     d  d_h2_gros                     4  0 overlay(d_h2:  1) inz(9999)
     d  d_h2_fill1                    2    overlay(d_h2:  5)
     d  d_h2_vare                     8    overlay(d_h2:  7)
     d  d_h2_raba                     5    overlay(d_h2: 15)
      *
      *  Recordbeskrivelse ENTREKA pris-recordformat
      *
     d                 ds
     d d_et                          98
     d  d_et_vare                     8    overlay(d_et: 1)
     d  d_et_vtx1                    35    overlay(d_et: 9)
     d  d_et_fill                     1    overlay(d_et:44)
     d  d_et_vtx2                    35    overlay(d_et:45)
     d  d_et_ntpr                    10    overlay(d_et:80)
     d  d_et_enh1                     3    overlay(d_et:90)
     d  d_et_raba                     6    overlay(d_et:93)
5.60  *
5.60  *  Recordbeskrivelse BYGGMANN pris-recordformat
5.60  *
5.60 d                 ds
5.60 d d_bm                         107
5.60 d  d_bm_vare                     8    overlay(d_bm: 1)
5.60 d  d_bm_vtx1                    40    overlay(d_bm: 9)
5.60 d  d_bm_enh1                     5    overlay(d_bm:49)
5.60 d  d_bm_ntpr                    12    overlay(d_bm:54)
6.12  *
6.12  *  Recordbeskrivelse BYGGOFFICE pris-recordformat
6.12  *
6.12 d                 ds
6.12 d d_bo                         167
6.12 d  d_bo_vare                    10    overlay(d_bo:  1)
6.12 d  d_bo_fill1                    1    overlay(d_bo: 11) inz(';')
6.12 d  d_bo_nobb                     8  0 overlay(d_bo: 12)
6.12 d  d_bo_fill2                    1    overlay(d_bo: 20) inz(';')
6.12 d  d_bo_vtx1                    35    overlay(d_bo: 21)
6.12 d  d_bo_vtx2                    35    overlay(d_bo: 56)
6.12 d  d_bo_fill3                    1    overlay(d_bo: 91) inz(';')
6.12 d  d_bo_enh1                     5    overlay(d_bo: 92)
6.12 d  d_bo_fill4                    1    overlay(d_bo: 97) inz(';')
6.12 d  d_bo_ogrp                     2  0 overlay(d_bo: 98)
6.12 d  d_bo_hgrp                     2  0 overlay(d_bo:100)
6.12 d  d_bo_ugrp                     3  0 overlay(d_bo:102)
6.12 d  d_bo_fill5                    1    overlay(d_bo:105) inz(';')
6.12 d  d_bo_utxt                    40    overlay(d_bo:106)
6.12 d  d_bo_fill6                    1    overlay(d_bo:146) inz(';')
6.12 d  d_bo_sapr                     9  2 overlay(d_bo:147)
6.12 d  d_bo_fill7                    1    overlay(d_bo:156) inz(';')
6.12 d  d_bo_ntpr                     9  2 overlay(d_bo:157)
6.12 d  d_bo_fill8                    1    overlay(d_bo:166) inz(';')
6.15  *
6.15  *  Recordbeskrivelse IBX Catalgoue
6.15  *
6.15 d                 ds
6.15 d d_bx                         500
6.15 d  d_bx_nobb                     8    overlay(d_bx:  1)
6.15 d  d_bx_fill1                    1    overlay(d_bx:  9) inz(X'05')
6.15 d  d_bx_vtx1                    35    overlay(d_bx: 10)
6.15 d  d_bx_vtx2                    35    overlay(d_bx: 45)
6.15 d  d_bx_fill2                    1    overlay(d_bx: 80) inz(X'05')
6.15 d  d_bx_ltxt                   256    overlay(d_bx: 81)
6.15 d  d_bx_fill3                    1    overlay(d_bx:337) inz(X'05')
6.15 d  d_bx_enh1                     3    overlay(d_bx:338)
6.15 d  d_bx_fill4                    1    overlay(d_bx:341) inz(X'05')
6.15 d  d_bx_ltid                     4  0 overlay(d_bx:342)
6.15 d  d_bx_fill5                    1    overlay(d_bx:346) inz(X'05')
6.15 d  d_bx_unsp                     8    overlay(d_bx:347)
6.15 d  d_bx_fill6                    1    overlay(d_bx:355) inz(X'05')
6.15 d  d_bx_ostr                    15    overlay(d_bx:356)
6.15 d  d_bx_fill7                    1    overlay(d_bx:371) inz(X'05')
6.15 d  d_bx_bint                    15    overlay(d_bx:372)
6.15 d  d_bx_fill8                    1    overlay(d_bx:387) inz(X'05')
6.15 d  d_bx_ntpr                    15    overlay(d_bx:388)
6.15 d  d_bx_fill9                    1    overlay(d_bx:403) inz(X'05')
6.15 d  d_bx_valu                     3    overlay(d_bx:404)
6.15 d  d_bx_fil10                    1    overlay(d_bx:407) inz(X'05')
6.15 d  d_bx_mvap                     2  0 overlay(d_bx:408)
6.15 d  d_bx_fil11                    1    overlay(d_bx:410) inz(X'05')
6.15 d  d_bx_risk                     3    overlay(d_bx:411)
6.15 d  d_bx_fil12                    1    overlay(d_bx:414) inz(X'05')
6.15 d  d_bx_hms                      3    overlay(d_bx:415)
6.15 d  d_bx_fil13                    1    overlay(d_bx:418) inz(X'05')
6.15  *
6.15  *  Recordbeskrivelse IBX Catalgoue
6.15  *
6.15 d                 ds
6.15 d d_bxo                        500
6.15 d  d_bxo_nob                    30    overlay(d_bxo:  1)
6.15 d  d_bxo_fil1                    1    overlay(d_bxo: 31) inz(X'05')
6.15 d  d_bxo_tx1                    30    overlay(d_bxo: 32)
6.15 d  d_bxo_fil2                    1    overlay(d_bxo: 62) inz(X'05')
6.15 d  d_bxo_ltx                    30    overlay(d_bxo: 63)
6.15 d  d_bxo_fil3                    1    overlay(d_bxo: 93) inz(X'05')
6.15 d  d_bxo_enh                    30    overlay(d_bxo: 94)
6.15 d  d_bxo_fil4                    1    overlay(d_bxo:124) inz(X'05')
6.15 d  d_bxo_lti                    30    overlay(d_bxo:125)
6.15 d  d_bxo_fil5                    1    overlay(d_bxo:155) inz(X'05')
6.15 d  d_bxo_uns                    30    overlay(d_bxo:156)
6.15 d  d_bxo_fil6                    1    overlay(d_bxo:186) inz(X'05')
6.15 d  d_bxo_ost                    30    overlay(d_bxo:187)
6.15 d  d_bxo_fil7                    1    overlay(d_bxo:217) inz(X'05')
6.15 d  d_bxo_int                    30    overlay(d_bxo:218)
6.15 d  d_bxo_fil8                    1    overlay(d_bxo:248) inz(X'05')
6.15 d  d_bxo_sap                    30    overlay(d_bxo:249)
6.15 d  d_bxo_fil9                    1    overlay(d_bxo:279) inz(X'05')
6.15 d  d_bxo_val                    30    overlay(d_bxo:280)
6.15 d  d_bxo_fi10                    1    overlay(d_bxo:310) inz(X'05')
6.15 d  d_bxo_mva                    30    overlay(d_bxo:311)
6.15 d  d_bxo_fi11                    1    overlay(d_bxo:341) inz(X'05')
6.15 d  d_bxo_ris                    30    overlay(d_bxo:342)
6.15 d  d_bxo_fi12                    1    overlay(d_bxo:372) inz(X'05')
6.15 d  d_bxo_hms                    30    overlay(d_bxo:373)
6.15 d  d_bxo_fi14                    1    overlay(d_bxo:403) inz(X'05')
      *
      * Definering av parametre
      *
     d p_vsor          s             10
     d p_sval          s              1  0
     d p_tval          s              1  0
     d p_2val          s              1  0
     d p_bval          s              1  0
8.02 d p_nval          s              1  0
8.01 d p_lgln          s             13  0
      *
     d p_firm          s                   like(vvfirm)
     d p_kund          s                   like(rkkund)
     d p_kpro          s                   like(flkpro)
     d p_ogrp          s                   like(vvogrp)
     d p_hgrp          s                   like(vvhgrp)
     d p_ugrp          s                   like(vvugrp)
     d p_ldor          s                   like(vvldor)
     d p_rfmt          s                   like(fhrfmt)
     d p_endr          s                   like(fhendr)
     d p_dat2          s                   like(fhdato)
     d p_lety          s                   like(fhlety)
     d p_dato          s                   like(fhdato)
     d p_ftis          s                   like(fhftis)
     d p_lage          s              2  0
      *
      * Definering av variabler i nøkler
      *
     d rkunl1_kund     s                   like(rkkund)
     d fkprl1_kund     s                   like(flkund)
     d fkprl1_kpro     s                   like(flkpro)
     d vvarl9_ogrp     s                   like(vvogrp)
     d vvarl9_hgrp     s                   like(vvhgrp)
     d vvarl9_ugrp     s                   like(vvugrp)
     d vvarl9_ldor     s                   like(vvldor)
     d vvarla_ogrp     s                   like(vvogrp)
     d vvarla_hgrp     s                   like(vvhgrp)
     d vvarla_ugrp     s                   like(vvugrp)
     d vvarla_ldor     s                   like(vvldor)
     d vvenl3_vare     s                   like(vevare)
     d vvenl3_pben     s                   like(vepben)
     d vvenl2_vare     s                   like(vevare)
     d vvenl2_saen     s                   like(vesaen)
9.07 d vvarl1_vare     s                   like(vvvare)
9.07 d vvenl1_vare     s                   like(vevare)
9.07 d vvenl1_enhe     s                   like(veenhe)
     d vugrl1_uogr     s                   like(vguogr)
     d vugrl1_uhgr     s                   like(vguhgr)
     d vugrl1_uugr     s                   like(vguugr)
     d vpkol1_pkod     s                   like(vapkod)
     d rlevl1_levr     s                   like(rllevr)
     d fkdilu_kund     s                   like(fhkund)
     d fkdilu_kpro     s                   like(fhkpro)
6.22 d vtill1_ogrp     s                   like(vtogrp)
6.22 d vtill1_hgrp     s                   like(vthgrp)
6.22 d vtill1_ugrp     s                   like(vtugrp)
6.22 d vtill1_ldor     s                   like(vtldor)
     d vtill1_vare     s                   like(vtvare)
5.70 d vtill1_prgr     s                   like(vtprgr)
     d vtill1_lety     s                   like(vtlety)
     d vvprl1_vare     s                   like(vpvare)
6.20 d vvprl1_ldor     s                   like(vpldor)
5.70 d vvprl1_prgr     s                   like(vpprgr)
     d vvprl1_enhe     s                   like(vpenhe)
     d vvprl1_lety     s                   like(vplety)
     d vshel1_vsor     s                   like(vcvsor)
     d fipxl1_kund     s                   like(fiukun)
     d fipxl1_sort     s                   like(fiusor)
     d fipxl1_vare     s                   like(fiuvar)
     d fipxlu_kund     s                   like(fiukun)
     d fipxlu_sort     s                   like(fiusor)
     d fipxlu_vare     s                   like(fiuvar)
6.15 d jvarl1_vare     s                   like(jvvare)
6.32 d jvlml1_mvnr     s                   like(jvmvnr)
6.32 d jvlml1_mldo     s                   like(jvmldo)
6.32 d jvlml1_mtyp     s                   like(jvmtyp)
8.01 d mjlol2_eann     s                   like(mjeann)
8.01 d vlagl1_vare     s                   like(vlvare)
8.01 d vlagl1_lage     s                   like(vllage)
      *
      * Definering av variable
      *
     d b_svgr          s              1
     d b_sldo          s              1
     d b_stek          s              1
5.70 d b_till          s              1    inz(*off)
6.20 d b_inlr          s              1    inz(*off)
      *
6.20 d w_ddat          s               d   datfmt(*iso)
6.20 d w_udat          s               d   datfmt(*iso)
6.22 d w_pldo          s                   like(vpldor)
     d w_dato_ymd      s              6  0
     d w_dato_iso0     s              8  0
     d w_dato_alf      s              8
     d w_belo_alf      s              9
     d w_raba_alf      s              5
     d w_omre_alf      s             12
     d w_ogrp_alf      s              2
     d w_hgrp_alf      s              2
     d w_ugrp_alf      s              3
     d w_raba          s              5  2
     d x               s              1  0
8.02 d w_prgr          s              2
5.70 d w_lage          s              2  0
5.70 d w_avde          s              4  0
6.23 d w_vtyp          s                   like(vvvtyp)
6.23 d w_ldor          s                   like(vvldor)
6.31 d w_lv_nobb       s                   like(vvlnob)
6.31 d w_lv_modn       s                   like(vvlmod)
6.31 d w_lv_nlev       s                   like(vvnlev)
6.31 d w_lv_lldo       s                   like(vvlnle)
6.31 d w_lv_llva       s                   like(vvllva)
      *
     d w_firm          s                   like(vvfirm)
     d w_enh1          s                   like(veenhe)
     d w_enh2          s                   like(veenhe)
     d w_enh3          s                   like(veenhe)
9.07 d w_enhw          s                   like(veenhe)
     d w_enhe          s                   like(veenhe)
     d w_omr1          s                   like(veomre)
     d w_omr2          s                   like(veomre)
     d w_omr3          s                   like(veomre)
9.07 d w_omrw          s                   like(veomre)
     d w_gvar          s                   like(vvvare)
     d w_ptxt          s                   like(vaptxt)
     d w_fnav          s                   like(aafnav)
     d w_utxt          s                   like(vgutxt)
6.32 d w_unsp          s                   like(vgufri)
     d w_sapr          s                   like(vpsapr)
     d w_s1pr          s                   like(vpsapr)
     d w_ntpr          s                   like(vpsapr)
     d w_n1pr          s                   like(vpsapr)
     d w_n2pr          s                   like(vpsapr)
     d w_n3pr          s                   like(vpsapr)
6.32 d w_murl          s                   like(jvmurl)
6.11 d w_east          s              1
6.11 d w_eann          s             14  0
6.15 d w_stat          s              1
6.15 d w_ekod          s              1
6.15 d w_etxt          s             30
6.15 d w_dato          s               d   datfmt(*iso)
6.15 d w_mvap          s              6  2
6.15 d w_mvat          s              5  4
6.15 d w_mvaf          s             10  9
6.32 d w_linj          s              8  0
6.32 d w_kmva          s              2
6.32 d w_vgrp          s              7  0
      *
     d s_ogrp          s                   like(vvogrp)
     d s_hgrp          s                   like(vvhgrp)
     d s_ugrp          s                   like(vvugrp)
     d s_vare          s                   like(vvvare)
      *
     d                uds
     d  l_wsid               901    910
6.32 d l_fgrp                931    933
     d  l_user               911    920
     d  l_firm               944    946  0
5.70 d l_lage               1001   1002  0
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Hovedprogram
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
7.10 C/Exec SQL
7.10 C+  Set Option DatFmt=*ISO, commit=*none
7.10 C+  , DlyPrp=*YES, SRTSEQ=*LANGIDSHR, LANGID=NOR
7.10 C/End-Exec
      *
      * Dersom kunde/kundeprosjekt skal ha NOBB pris-recordformat, og nobb
      * deltakernummer ikke ligger i statusregisteret, avsluttes
      * behandingen
      *
     c     fstsl1_key    chain     fstsl1                             90
      *
     c                   if        p_rfmt = 'NOBB' or
     c                             p_rfmt = 'NOBB_INT'
     c                   if        *in90 or faanod = 0
     c                   goto      avslutt
     c                   endif
     c                   endif
      *
      * Henter firmaopplysninger
      *
     c     afirl1_key    chain     afirl1r                            90
      *
      * Oppretter variabel med firmanavn hvor Ææ, Øø og Åå er oversatt til
      * ANSI-verdier
      *
     c                   eval      w_fnav = aafnav
      *
     c     'Æ':X'46'     xlate     w_fnav        w_fnav
     c     'æ':X'A0'     xlate     w_fnav        w_fnav
     c     'Ø':X'77'     xlate     w_fnav        w_fnav
     c     'ø':X'90'     xlate     w_fnav        w_fnav
     c     'Å':X'2A'     xlate     w_fnav        w_fnav
     c     'å':X'EF'     xlate     w_fnav        w_fnav
      *
      * Henter kundeinformasjon
      *
     c                   eval      rkunl1_kund = p_kund
     c     rkunl1_key    chain     rkunl1                             90
      *
      * Skriver overskriftsrad til prisfil dersom recordformat er CORRADO
6.30  * eller REGNEARK / REGNEARKPO
      *
     c                   select
     c                   when      p_rfmt = 'CORRADO'
     c                   eval      nn_rad = %trim('Varenr' + X'05' +
     c                                            'Nobbnr' + X'05' +
     c                                            'Varetekst 1' + X'05' +
     c                                            'Varetekst 2' + X'05' +
     c                                            'Enh' + X'05' +
     c                                            'Nettopris' + X'05' +
     c                                            'Bruttopris' + X'05' +
     c                                            'Leverand'+X'90'+'r' + X'05' +
     c                                            'Varegruppe')
     c                   write     finnpfr
6.30 c                   when      p_rfmt = 'REGNEARK' or
7.07 c                             p_rfmt = 'REGNEARKPO' or
0.07 c                             p_rfmt = 'REGNEARKM2'
     c                   eval      ra_rad = %trim('Varenr' + X'05' +
     c                                            'Nobbnr' + X'05' +
     c                                            'Varetekst 1' + X'05' +
     c                                            'Varetekst 2' + X'05' +
     c                                            'Kode' + X'05' +
     c                                            'Rabatt' + X'05' +
     c                                            'Enh1' + X'05' +
     c                                            'Bruttopris enh1' + X'05' +
     c                                            'Nettopris enh1' + X'05' +
     c                                            'Enh2' + X'05' +
     c                                            'Nettopris enh2' + X'05' +
     c                                            'Omr. volum enh2' + X'05' +
     c                                            'Enh3' + X'05' +
     c                                            'Nettopris enh3' + X'05' +
     c                                            'Omr. volum enh3' + X'05' +
     c                                            'Varegrp.' + X'05' +
     c                                            'Varegruppe-tekst' + X'05' +
     c                                            'EAN-nr' + X'05' +
     c                                            'Leverandør')
     c     'ø':X'90'     xlate     ra_rad        ra_rad
     c                   write     firapfr
6.32 c                   when      p_rfmt = 'LOGIQ'
6.32 c                   exsr      logiq_hode
     c                   endsl
      *
      * Behandling avhengig av vareutplukk utplukksvalg
      *
     c                   select
     c                   when      p_ogrp <> 0
     c                   exsr      behandl_vgrp
     c                   when      p_ldor <> 0
     c                   exsr      behandl_ldor
     c                   when      p_vsor <> *blank
     c                   exsr      behandl_vsor
     c                   other
     c                   exsr      behandl_tot
     c                   endsl
      *
      * Oppdaterer kunde distribusjonsliste med prisdato siste forsendelse
      * og unik nøkkel (timestamp) for forsendelsen.
      *
     c                   eval      fkdilu_kund = p_kund
     c                   eval      fkdilu_kpro = p_kpro
     c     fkdilu_key    chain     fkdilur                            92
     c                   if        *in92 = *off
     c                   eval      fhdato = p_dato
     c                   eval      fhftis = p_ftis
6.10 c                   time                    fhedat
6.10 c                   time                    fhetim
6.10 c                   eval      fheusr = l_user
     c                   update    fkdilur
     c                   endif
      *
      * Avslutt
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av utplukk på varegruppe og leverandør
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandl_vgrp  begsr
      *
      * Posisjonerer og leser i vareregister i.h.t. utplukk
      *
     c                   if        p_ldor = 0
      *
     c                   eval      vvarl9_ogrp = p_ogrp
     c                   eval      vvarl9_hgrp = p_hgrp
     c                   eval      vvarl9_ugrp = p_ugrp
     c                   eval      vvarl9_ldor = p_ldor
      *
     c                   select
     c                   when      p_ldor <> 0
     c     vvarl9_key1   setll     vvarl9
     c     vvarl9_key1   reade     vvarl9                                 90
     c                   when      p_ugrp <> 0
     c     vvarl9_key2   setll     vvarl9
     c     vvarl9_key2   reade     vvarl9                                 90
     c                   when      p_hgrp <> 0
     c     vvarl9_key3   setll     vvarl9
     c     vvarl9_key3   reade     vvarl9                                 90
     c                   other
     c     vvarl9_key4   setll     vvarl9
     c     vvarl9_key4   reade     vvarl9                                 90
     c                   endsl
      *
     c                   else
      *
     c                   eval      vvarla_ogrp = p_ogrp
     c                   eval      vvarla_hgrp = p_hgrp
     c                   eval      vvarla_ugrp = p_ugrp
     c                   eval      vvarla_ldor = p_ldor
      *
     c                   select
     c                   when      p_ugrp <> 0
     c     vvarla_key2   setll     vvarla
     c     vvarla_key2   reade     vvarla                                 90
     c                   when      p_hgrp <> 0
     c     vvarla_key3   setll     vvarla
     c     vvarla_key3   reade     vvarla                                 90
     c                   other
     c     vvarla_key4   setll     vvarla
     c     vvarla_key4   reade     vvarla                                 90
     c                   endsl
     c                   endif
      *
     c                   dow       *in90 = *off
8.01  *
8.01  * Hvis medfølgende GLN nummer, sjekk at varen finnes på lager
8.01  *
8.01 c                   if        p_lgln <> 0 and
8.01 c                             w_lage <> 0
8.01 c                   eval      vlagl1_vare = vvvare
8.01 c     vlagl1_key    chain     vlagl1
8.01 c                   if        not %found
8.01 c                   goto      neste_vgrp
8.01 c                   endif
8.01 c                   endif
8.01  *
     c                   exsr      behandling
      *
8.01 c     neste_vgrp    tag
      *
     c                   if        p_ldor = 0
      *
     c                   select
     c                   when      p_ldor <> 0
     c     vvarl9_key1   reade     vvarl9                                 90
     c                   when      p_ugrp <> 0
     c     vvarl9_key2   reade     vvarl9                                 90
     c                   when      p_hgrp <> 0
     c     vvarl9_key3   reade     vvarl9                                 90
     c                   other
     c     vvarl9_key4   reade     vvarl9                                 90
     c                   endsl
      *
     c                   else
      *
     c                   select
     c                   when      p_ugrp <> 0
     c     vvarla_key2   reade     vvarla                                 90
     c                   when      p_hgrp <> 0
     c     vvarla_key3   reade     vvarla                                 90
     c                   other
     c     vvarla_key4   reade     vvarla                                 90
     c                   endsl
      *
     c                   endif
      *
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av utplukk på leverandør
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandl_ldor  begsr
      *
      * Leser hele vareregisteret, og plukker varer tilhørende leverandør
      *
     c     vvarl9_key5   setll     vvarl9
     c     vvarl9_key5   reade     vvarl9                                 90
      *
     c                   dow       *in90 = *off
      *
     c                   if        vvldor <> p_ldor
     c                   goto      les_neste
     c                   endif
8.01  *
8.01  * Hvis medfølgende GLN nummer, sjekk at varen finnes på lager
8.01  *
8.01 c                   if        p_lgln <> 0 and
8.01 c                             w_lage <> 0
8.01 c                   eval      vlagl1_vare = vvvare
8.01 c     vlagl1_key    chain     vlagl1
8.01 c                   if        not %found
8.01 c                   goto      les_neste
8.01 c                   endif
8.01 c                   endif
8.01  *
     c                   exsr      behandling
      *
     c     les_neste     tag
      *
     c     vvarl9_key5   reade     vvarl9                                 90
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av utplukk på varesortiment
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandl_vsor  begsr
      *
      * Kaller utplukksprogram
      *
     c                   eval      b_svgr = *on
     c                   eval      b_sldo = *off
     c                   eval      b_stek = *on
      *
     c                   call      'VD700R'
     c                   parm                    w_firm
     c                   parm                    p_vsor
     c                   parm                    b_svgr
     c                   parm                    b_sldo
     c                   parm                    b_stek
     c                   parm                    w_lage
      *
      * Leser utplukksfil som inneholder alle varer i sortimentet
      *
     c                   eval      s_vare = *blank
      *
     c                   read      vvawpf                                 90
     c                   dow       *in90 = *off
      *
     c                   if        vvvare <> s_vare
     c                   exsr      behandling
     c                   endif
      *
     c                   eval      s_vare = vvvare
      *
     c                   read      vvawpf                                 90
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for behandling av utplukk på hele vareregisteret
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandl_tot   begsr
      *
     c     vvarl9_key5   setll     vvarl9
     c     vvarl9_key5   reade     vvarl9                                 90
      *
     c                   dow       *in90 = *off
8.01  *
8.01  * Hvis medfølgende GLN nummer, sjekk at varen finnes på lager
8.01  *
8.01 c                   if        p_lgln <> 0 and
8.01 c                             w_lage <> 0
8.01 c                   eval      vlagl1_vare = vvvare
8.01 c     vlagl1_key    chain     vlagl1
8.01 c                   if        not %found
8.01 c                   goto      neste_tot
8.01 c                   endif
8.01 c                   endif
      *
     c                   exsr      behandling
      *
8.01 c     neste_tot     tag
      *
     c     vvarl9_key5   reade     vvarl9                                 90
     c                   enddo
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for utskrift av vareinformasjon til prisfil
      * Rutinen styrer utskrift til forskjellige pris-recordformat
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     behandling    begsr
      *
      * Siling av varer.
      * Diversevarer utelates
      * Skaffevarer skal kun være med dersom dette er valgt.
      * Varer merket 'ikke prisdistribusjon' og utgåtte varer utelates.
      *
5.70 c                   call      'VL710R'
5.70 c                   parm                    w_firm
5.70 c                   parm                    vvvare
5.70 c                   parm                    w_lage
6.23 c                   parm                    w_vtyp
6.23 c                   parm                    w_udat
6.23 c                   parm                    w_ldor
6.23 c                   parm                    b_inlr
6.31 c                   parm                    w_lv_nobb
6.31 c                   parm                    w_lv_modn
6.31 c                   parm                    w_lv_lldo
6.31 c                   parm                    w_lv_llva
      *
6.23 c                   if        w_vtyp = 'D'
     c                   leavesr
     c                   endif
      *
     c                   if        p_sval = 0 and
6.23 c                             w_vtyp = 'S'
     c                   leavesr
     c                   endif
      *
     c                   if        vvkpdi = 1
     c                   leavesr
     c                   endif
      *
6.20 c                   if        w_udat <> *loval and
6.20 c                             w_udat <= w_ddat
     c                   leavesr
     c                   endif
8.02  * paramter for om kun nobb-nr
8.02 c                   if        p_nval = 1
8.02 c                   if        vvvare < '10000000' or
8.02 c                             vvvare > '90000000'
8.02 c                   leavesr
8.02 c                   endif
8.02 c                   endif
      *
      * Behandling dersom 'kun endringer' er valgt
      * Behandler kun varer hvor prisendringsdato er >= dato for forrige
      * kjøring.
      *
     c***                if        p_endr = 1 and
     c***                          p_dat2 <> *loval
     c***                if        vvspda < p_dat2
     c***                leavesr
     c***                endif
     c***                endif
      *
      * Henter enheter fra vare
      *
     c                   exsr      enheter
      *
      * Henter undergruppetekst ved brudd på hovedgruppe/undergruppe
      *
     c                   if        vvogrp <> s_ogrp or
     c                             vvhgrp <> s_hgrp or
     c                             vvugrp <> s_ugrp
      *
     c                   eval      w_utxt = *blank
6.32 c                   eval      w_unsp = *blank
      *
     c                   eval      vugrl1_uogr = vvogrp
     c                   eval      vugrl1_uhgr = vvhgrp
     c                   eval      vugrl1_uugr = vvugrp
     c     vugrl1_key    chain     vugrl1                             92
     c                   if        *in92 = *off
     c                   eval      w_utxt = vgutxt
6.32 c                   eval      w_unsp = vgufri
     c                   endif
      *
     c                   eval      s_ogrp = vvogrp
     c                   eval      s_hgrp = vvhgrp
     c                   eval      s_ugrp = vvugrp
      *
     c                   endif
      *
      * Felles initiering av prisberegningsprogram
      *
     c                   eval      hifirm = p_firm
     c                   eval      hirkat = 0
     c                   eval      hikund = p_kund
     c                   eval      hikpro = p_kpro
     c                   eval      hivare = vvvare
     c                   eval      hilety = p_lety
     c                   eval      hienhe = *blank
     c                   eval      hidato = p_dato
     c                   eval      hitime = *loval
5.70 c                   eval      hiprgr = w_prgr
9.0x c                   eval      hilage = w_lage
     c                   eval      hinumm = 0
     c                   eval      hikode = *blank
     c                   eval      hidekn = 0
     c                   eval      hitilb = *off
     c                   eval      hiavgf = 0
     c                   eval      hipriv = 0
     c                   eval      hiskaf = *off
     c                   eval      hildor = 0
     c                   eval      hisapr = 0
     c                   eval      hikopr = 0
     c                   eval      hiinlr = *on
      *
     c                   if        p_tval = 0
     c                   eval      hitilb = *on
     c                   endif
      *
      * Skriver til prisfil avhengig av pris-recordformat
      *
     c                   select
7.05 c                   when      p_rfmt = 'BA-KALK' or
7.05 c                             p_rfmt = 'BA-KALK2'
     c                   exsr      ba_kalk
     c                   when      p_rfmt = 'BYGGDATA'
     c                   exsr      byggdata
5.62 c                   when      p_rfmt = 'BYGGDATAWI'
5.62 c                   exsr      byggdatawi
     c                   when      p_rfmt = 'CORRADO'
     c                   exsr      corrado
     c                   when      p_rfmt = 'FRIKALK'
     c                   exsr      frikalk
     c                   when      p_rfmt = 'HOLTE'
     c                   exsr      holte
     c                   when      p_rfmt = 'NOBB'
     c                   exsr      nobb
     c                   when      p_rfmt = 'NOBB_INT'
     c                   exsr      nobb_int
6.30 c                   when      p_rfmt = 'REGNEARK' or
7.07 c                             p_rfmt = 'REGNEARKPO' or
7.07 c                             p_rfmt = 'REGNEARKM2'
     c                   exsr      regneark
7.10 c                   when      p_rfmt = 'REGNEARKX' or
7.10 c                             p_rfmt = 'REGNEARKS'
7.10 c                   exsr      regneark
     c                   when      p_rfmt = 'SALGSSUPP'
     c                   exsr      salgssupport
     c                   when      p_rfmt = 'HS-FAKTURA'
     c                   exsr      hs_faktura
     c                   when      p_rfmt = 'ENTREKA'
     c                   exsr      entreka
     c                   when      p_rfmt = 'INTFILE'
     c                   exsr      intfile
5.60 c                   when      p_rfmt = 'BYGGMANN'
5.60 c                   exsr      byggmann
6.12 c                   when      p_rfmt = 'BYGGOFFICE'
6.12 c                   exsr      byggoffice
6.15 c                   when      p_rfmt = 'IBX'
6.15 c                   exsr      ibxcatalogue
6.32 c                   when      p_rfmt = 'LOGIQ'
6.32 c                   exsr      logiq
7.01 c                   when      p_rfmt = 'BYGGDATA_U'
7.01 c                   exsr      byggdata
7.02 c                   when      p_rfmt = 'BYGGDATA_2' or
7.06 c                             p_rfmt = 'BYGGDATAM2'
7.02 c                   exsr      byggdata
     c                   endsl
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for henting av enheter
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     enheter       begsr
      *
     c                   eval      w_enh1 = *blank
     c                   eval      w_enh2 = *blank
     c                   eval      w_enh3 = *blank
     c                   eval      w_omr1 = 0
     c                   eval      w_omr2 = 0
     c                   eval      w_omr3 = 0
9.07  * kun hvis format REGNEARK2
9.07 c                   if        p_rfmt = 'REGNEARK2'
9.07  *
9.07  * hvis prisenhet <> enhet1, så settes prisenhet lik enhet 1
9.07  *
9.07 c                   exsr      sjekk_saen1
9.07  *
9.07  * sjekker om pris.saml.enhet <> 1.salgsenhet
9.07  *
9.07 c                   if        w_enhw <> *blank and
9.07 c                             vvenps  <> *blank  and
9.07 c                             vvenps  <> w_enhw
9.07  * finn omregning  på vvenps
9.07 c                   eval      vvenl1_vare = vvvare
9.07 c                   eval      vvenl1_enhe = vvenps
9.07 c     vvenl1_key    chain     vvenl1
9.07 c                   if        %found(vvenl1)
9.07 c                   eval      w_enh1 = veenhe
9.07 c                   eval      w_omr1 = veomre
9.07 c                   endif
9.07  * finn omregning  på 1.salgsenhet
9.07 c                   eval      vvenl1_vare = vvvare
9.07 c                   eval      vvenl1_enhe = w_enhw
9.07 c     vvenl1_key    chain     vvenl1
9.07 c                   if        %found(vvenl1)
9.07 c                   eval      w_enh2 = veenhe
9.07 c                   eval      w_omr2 = veomre
9.07 c                   endif
9.07 c                   if        w_enh1 <> *blank
9.07 c                   goto      omr_enh
9.07 c                   endif
9.07 c                   endif
9.07 c                   endif
      *
      * Leser prisbok-enheter på vare, og henter prisinformasjon
      *
9.07 c                   eval      w_enh1 = *blank
9.07 c                   eval      w_enh2 = *blank
9.07 c                   eval      w_enh3 = *blank
9.07 c                   eval      w_omr1 = 0
9.07 c                   eval      w_omr2 = 0
9.07 c                   eval      w_omr3 = 0
9.07 c                   eval      x = 0
7.10  * REGNEARKS bruker kun salgseneht
      *
     c                   eval      x = 0
      *
7.06 c                   if        p_rfmt <> 'BYGGDATAM2' and
7.07 c                             p_rfmt <> 'REGNEARKM2' and
7.10 c                             p_rfmt <> 'REGNEARKS'
7.06  *
     c                   eval      vvenl3_vare = vvvare
     c                   eval      vvenl3_pben = 1
     c     vvenl3_key    setll     vvenl3
     c     vvenl3_key2   reade     vvenl3                                 92
     c                   dow       *in92 = *off and
     c                             x < 3
      *
     c                   eval      x = x + 1
      *
     c                   select
     c                   when      x = 1
     c                   eval      w_enh1 = veenhe
     c                   eval      w_omr1 = veomre
     c                   when      x = 2
     c                   eval      w_enh2 = veenhe
     c                   eval      w_omr2 = veomre
     c                   when      x = 3
     c                   eval      w_enh3 = veenhe
     c                   eval      w_omr3 = veomre
     c                   endsl
      *
     c     vvenl3_key2   reade     vvenl3                                 92
     c                   enddo
      *
7.06 c                   endif
      *
      * Dersom prisbokenheter ikke ble funnet, eller dersom priser ikke
      * ble funnet på prisbokenheter, hentes priser på salgsenheter
      *
     c                   if        x = 0
      *
     c                   eval      vvenl2_vare = vvvare
     c                   eval      vvenl2_saen = 1
     c     vvenl2_key    setll     vvenl2
     c     vvenl2_key2   reade     vvenl2                                 92
     c                   dow       *in92 = *off and
     c                             x < 3
      *
     c                   eval      x = x + 1
      *
     c                   select
     c                   when      x = 1
     c                   eval      w_enh1 = veenhe
     c                   eval      w_omr1 = veomre
     c                   when      x = 2
     c                   eval      w_enh2 = veenhe
     c                   eval      w_omr2 = veomre
     c                   when      x = 3
     c                   eval      w_enh3 = veenhe
     c                   eval      w_omr3 = veomre
     c                   endsl
      *
     c     vvenl2_key2   reade     vvenl2                                 92
     c                   enddo
      *
     c                   endif
      *
      * Finner omregningsfaktorer
      *
9.07 c     omr_enh       tag
     c                   if        w_omr1 <> 0
     c                   eval      w_omr2 = w_omr2 / w_omr1
     c                   eval      w_omr3 = w_omr3 / w_omr1
     c                   endif
      *
     c     end_enheter   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift til BA-KALK pris-recordformat
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     ba_kalk       begsr
7.05  *
7.05  * hvis BA-KALK2 og M2 er enhet på varen, så bruk denne
7.05  * hvis den ikke finnes, som i dag.
7.05 c                   if        p_rfmt = 'BA-KALK2'
7.05 c                   if        w_enh1 = 'M2' or
7.05 c                             w_enh2 = 'M2' or
7.05 c                             w_enh3 = 'M2'
7.05 c                   eval      hienhe = 'M2'
7.05 c                   else
7.05 c                   eval      hienhe = w_enh1
7.05 c                   endif
7.05 c                   else
      *
      * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
      *
     c                   eval      hienhe = w_enh1
7.05 c                   endif
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_sapr = hosapr
     c                   eval      w_ntpr = hosapr
      *
     c                   if        horab1 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
     c                   endif
      *
      * Henter beskrivelse av priskode
      *
     c                   eval      w_ptxt = *blank
      *
     c                   if        hokpri <> *blank
     c                   eval      vpkol1_pkod = hokpri
     c     vpkol1_key    chain     vpkol1                             92
     c                   if        *in92 = *off
     c                   eval      w_ptxt = vaptxt
     c                   endif
     c                   endif
      *
      * Flytter verdier til prisrecord
      *
     c                   eval      d_bs_vare = vvvare
6.31 c                   if        w_lv_nobb > 0
6.31 c                   eval      d_bs_nobb = w_lv_nobb
6.31 c                   else
     c                   eval      d_bs_nobb = vvnobb
6.31 c                   endif
     c                   eval      d_bs_ogrp = vvogrp
     c                   eval      d_bs_hgrp = vvhgrp
     c                   eval      d_bs_ugrp = vvugrp
     c                   eval      d_bs_utxt = w_utxt
7.05 c                   eval      d_bs_enh1 = hienhe
7.05 c*                  eval      d_bs_enh1 = w_enh1
     c                   eval      d_bs_fdat = w_dato_iso0
     c                   eval      d_bs_pkod = w_ptxt
     c                   eval      d_bs_sapr = 0
     c                   eval      d_bs_ntpr = w_ntpr
     c                   eval      d_bs_lkod = *blank
      *
     c                   exsr      gml_varenr
     c                   eval      d_bs_gvar = w_gvar
      *
     c                   if        p_2val = 1
     c                   eval      d_bs_vtxt = vvtek1
     c                   else
     c                   eval      d_bs_vtxt = %trim(vvtek1) + ' ' +
     c                                          %trim(vvtek2)
     c                   endif
      *
     c                   if        p_bval = 0
     c                   eval      d_bs_sapr = w_sapr
     c                   endif
      *
6.23 c                   if        w_vtyp = 'L'
6.23 c                   eval      d_bs_lkod = w_vtyp
     c                   endif
      *
      * Skriver til prisfil
      *
     c                   eval      bs_rad = d_bs
     c                   write     fibspfr
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift til BYGGDATA pris-recordformat
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     byggdata      begsr
      *
7.06  * Dersom BYGGDATAM2 og M2 er enhet på varen, så benyttes M2 som
7.06  * enhet det skal hentes priser fra
7.06  *
7.06 c                   if        p_rfmt = 'BYGGDATAM2'  and
7.06 c                             w_enh1 <> 'M2'
7.06 c                   if        w_enh2 = 'M2' or
7.06 c                             w_enh3 = 'M2'
7.06 c                   eval      w_enh1 = 'M2'
7.06 c                   eval      w_enh2 = *blank
7.06 c                   eval      w_enh3 = *blank
7.06 c                   endif
7.06 c                   endif
      *
      * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
      *
     c                   eval      hienhe = w_enh1
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_sapr = hosapr
     c                   eval      w_ntpr = hosapr
      *
     c                   if        horab1 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
     c                   endif
      *
     c                   eval      w_raba = horab1
      *
     c                   if        horab2 <> 0 and
     c                             w_sapr <> 0
     c                   eval(h)   w_raba = (w_sapr - w_ntpr) * 100 / w_sapr
     c                   endif
      *
      * Flytter verdier til prisrecord
      *
     c                   eval      d_bd_ogrp = vvogrp
     c                   eval      d_bd_hgrp = vvhgrp
     c                   eval      d_bd_ugrp = vvugrp
     c                   eval      d_bd_eann = 0
     c                   eval      d_bd_vare = vvvare
     c                   eval      d_bd_utxt = w_utxt
     c                   eval      d_bd_vtx1 = vvtek1
     c                   eval      d_bd_enh1 = w_enh1
     c                   eval      d_bd_grpr = 0
     c                   eval      d_bd_sapr = 0
     c                   eval      d_bd_vtx2 = *blank
9.05 c                   eval      d_bd_raba = '0000'
6.31 c                   if        w_lv_nobb > 0
6.31 c                   eval      d_bd_nobb = w_lv_nobb
6.31 c                   eval      d_bd_nmod = w_lv_modn
5.31 c                   eval      d_bd_nlev = w_lv_lldo
6.31 c                   else
     c                   eval      d_bd_nobb = vvnobb
     c                   eval      d_bd_nlev = vvnlev
     c                   eval      d_bd_nmod = vvnmod
6.31 c                   endif
     c                   eval      d_bd_pkod = hokpri
6.23 c                   eval      d_bd_vtyp = w_vtyp
     c                   eval      d_bd_fabp = 0
9.01 c                   eval      rlevl1_levr = vvldor
9.01 c     rlevl1_key    chain     rlevl1
9.01 c                   if        %found
9.01 c                   eval      d_bd_lnav = rlnavn
9.01 c                   else
9.01 c                   eval      d_bd_lnav = *blank
9.01 c                   endif
6.11  *
6.11  * Kaller program for henting av ean-nr
6.11  *
6.11 c                   call      'VE711R'
6.11 c                   parm                    w_firm
6.11 c                   parm                    vvvare
6.11 c                   parm                    w_enh1
6.11 c                   parm                    w_eann
6.11 c                   parm                    w_east
6.11 c                   move      w_eann        d_bd_eann
      *
     c                   if        p_2val = 0
     c                   eval      d_bd_vtx2 = vvtek2
     c                   endif
      *
     c                   if        p_bval = 0
     c                   eval      d_bd_grpr = w_sapr
7.04 c***                eval      d_bd_sapr = w_sapr
7.04 c                   eval      d_bd_sapr = w_ntpr
9.05 c                   if        w_raba < 0
9.05 c                   eval      w_raba = w_raba * -1
9.05 c                   move      w_raba        d_bd_raba
9.05 c                   movel     '-'           d_bd_raba
9.05 c                   else
     c                   move      w_raba        d_bd_raba
9.05 c                   endif
     c                   else
     c                   eval      d_bd_grpr = w_ntpr
     c                   endif
      *
     c                   exsr      gml_varenr
     c                   eval      d_bd_gvar = w_gvar
      *
      * Finner direktepris/fabrikkpris
      *
6.14 c*                  eval      d_bd_fabp = d_bd_sapr
6.28 c                   eval      d_bd_fabp = 0
      *
     c                   eval      vvprl1_vare = vvvare
9.0x c                   eval      vvprl1_ldor = w_ldor
5.70 c                   eval      vvprl1_prgr = w_prgr
     c                   eval      vvprl1_enhe = w_enh1
     c                   eval      vvprl1_lety = 1
     c     vvprl1_key    chain     vvprl1
5.70 c                   if        not %found(vvprl1)
5.70 c                   eval      vvprl1_prgr = *blank
5.70 c     vvprl1_key    chain     vvprl1
5.70 c                   endif
      *
5.70 c                   if        %found(vvprl1)
6.22 c                   eval      w_pldo = vpldor
      *
     c                   eval      hilety = 1
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      d_bd_fabp = hosapr
     c                   eval      hilety = p_lety
      *
     c                   endif
      *
      * Skriver til prisfil
      *
7.02 c                   select
7.01 c                   when      p_rfmt = 'BYGGDATA_U'
7.01 c                   movel     d_bd          d_bdu
7.01 c                   eval      d_bdu_netp = w_ntpr
7.01 c                   eval      by_rad = d_bdu
7.01 c                   write     fibypfr
7.02 c                   when      p_rfmt = 'BYGGDATA_2' or
7.06 c                             p_rfmt = 'BYGGDATAM2'
7.02 c                   movel     d_bd          d_bd2
7.02 c                   eval      d_bd2_netp = w_ntpr
7.02 c                   eval      bz_rad = d_bd2
7.02 c                   write     fibzpfr
7.02 c                   other
     c                   eval      bd_rad = d_bd
     c                   write     fibdpfr
7.02 c                   endsl
      *
     c                   endsr
      *
5.62  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.62  * Subrutine utskrift til BYGGDATA pris-recordformat
5.62  * med konvertering av ÆØÅ til Windows tegn
5.62  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.62  *
5.62 c     byggdatawi    begsr
5.62  *
5.62  * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
5.62  *
5.62 c                   eval      hienhe = w_enh1
5.62  *
9.0x c                   call      'VP90XR'
5.62 c                   parm                    hirec
5.62 c                   parm                    horec
5.62  *
5.62 c                   eval      w_sapr = hosapr
5.62 c                   eval      w_ntpr = hosapr
5.62  *
5.62 c                   if        horab1 <> 0
5.62 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
5.62 c                   endif
5.62 c                   if        horab2 <> 0
5.62 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
5.62 c                   endif
5.62  *
5.62 c                   eval      w_raba = horab1
5.62  *
5.62 c                   if        horab2 <> 0 and
5.62 c                             w_sapr <> 0
5.62 c                   eval(h)   w_raba = (w_sapr - w_ntpr) * 100 / w_sapr
5.62 c                   endif
5.62  *
5.62  * Flytter verdier til prisrecord
5.62  *
5.62 c                   eval      d_bd_ogrp = vvogrp
5.62 c                   eval      d_bd_hgrp = vvhgrp
5.62 c                   eval      d_bd_ugrp = vvugrp
5.62 c                   eval      d_bd_eann = 0
5.62 c                   eval      d_bd_vare = vvvare
5.62 c                   eval      d_bd_utxt = w_utxt
7.03xc*    'Æ':X'46'     xlate     d_bd_utxt     d_bd_utxt
7.03xc*    'æ':X'A0'     xlate     d_bd_utxt     d_bd_utxt
7.03xc*    'Ø':X'77'     xlate     d_bd_utxt     d_bd_utxt
7.03xc*    'ø':X'90'     xlate     d_bd_utxt     d_bd_utxt
7.03xc*    'Å':X'2A'     xlate     d_bd_utxt     d_bd_utxt
7.03xc*    'å':X'EF'     xlate     d_bd_utxt     d_bd_utxt
     c                   eval      d_bd_vtx1 = vvtek1
5.62 c                   eval      d_bd_enh1 = w_enh1
5.62 c                   eval      d_bd_grpr = 0
5.62 c                   eval      d_bd_sapr = 0
5.62 c                   eval      d_bd_vtx2 = *blank
9.05 c                   eval      d_bd_raba = '0000'
6.31 c                   if        w_lv_nobb > 0
6.31 c                   eval      d_bd_nobb = w_lv_nobb
6.31 c                   eval      d_bd_nmod = w_lv_modn
5.31 c                   eval      d_bd_nlev = w_lv_nlev
6.31 c                   else
5.62 c                   eval      d_bd_nobb = vvnobb
5.62 c                   eval      d_bd_nlev = vvnlev
5.62 c                   eval      d_bd_nmod = vvnmod
6.31 c                   endif
5.62 c                   eval      d_bd_pkod = hokpri
6.23 c                   eval      d_bd_vtyp = w_vtyp
5.62 c                   eval      d_bd_fabp = 0
9.01 c                   eval      rlevl1_levr = vvldor
9.01 c     rlevl1_key    chain     rlevl1
9.01 c                   if        %found
9.01 c                   eval      d_bd_lnav = rlnavn
9.04 c     'Æ':X'46'     xlate     d_bd_lnav     d_bd_lnav
9.04 c     'æ':X'A0'     xlate     d_bd_lnav     d_bd_lnav
9.04 c     'Ø':X'77'     xlate     d_bd_lnav     d_bd_lnav
9.04 c     'ø':X'90'     xlate     d_bd_lnav     d_bd_lnav
9.04 c     'Å':X'2A'     xlate     d_bd_lnav     d_bd_lnav
9.04 c     'å':X'EF'     xlate     d_bd_lnav     d_bd_lnav
9.01 c                   else
9.01 c                   eval      d_bd_lnav = *blank
9.01 c                   endif
6.11  *
6.11  * Kaller program for henting av ean-nr
6.11  *
6.11 c                   call      'VE711R'
6.11 c                   parm                    w_firm
6.11 c                   parm                    vvvare
6.11 c                   parm                    w_enh1
6.11 c                   parm                    w_eann
6.11 c                   parm                    w_east
6.11 c                   move      w_eann        d_bd_eann
5.62  *
5.62 c                   if        p_2val = 0
5.62 c                   eval      d_bd_vtx2 = vvtek2
5.62 c                   endif
6.13 c     'Æ':X'46'     xlate     d_bd_vtx2     d_bd_vtx2
6.13 c     'æ':X'A0'     xlate     d_bd_vtx2     d_bd_vtx2
6.13 c     'Ø':X'77'     xlate     d_bd_vtx2     d_bd_vtx2
6.13 c     'ø':X'90'     xlate     d_bd_vtx2     d_bd_vtx2
6.13 c     'Å':X'2A'     xlate     d_bd_vtx2     d_bd_vtx2
6.13 c     'å':X'EF'     xlate     d_bd_vtx2     d_bd_vtx2
5.62  *
5.62 c                   if        p_bval = 0
5.62 c                   eval      d_bd_grpr = w_sapr
6.28 c                   eval      d_bd_sapr = w_sapr
9.05 c                   if        w_raba < 0
9.05 c                   eval      w_raba = w_raba * -1
9.05 c                   move      w_raba        d_bd_raba
9.05 c                   movel     '-'           d_bd_raba
9.05 c                   else
5.62 c                   move      w_raba        d_bd_raba
9.05 c                   endif
5.62 c                   else
5.62 c                   eval      d_bd_grpr = w_ntpr
5.62 c                   endif
5.62  *
5.62 c                   exsr      gml_varenr
5.62 c                   eval      d_bd_gvar = w_gvar
5.62  *
5.62  * Finner direktepris/fabrikkpris
5.62  *
6.28 c                   eval      d_bd_fabp = 0
5.62  *
5.62 c                   eval      vvprl1_vare = vvvare
9.0x c                   eval      vvprl1_ldor = w_ldor
5.70 c                   eval      vvprl1_prgr = w_prgr
5.62 c                   eval      vvprl1_enhe = w_enh1
5.62 c                   eval      vvprl1_lety = 1
5.62 c     vvprl1_key    chain     vvprl1
5.70 c                   if        not %found(vvprl1)
5.70 c                   eval      vvprl1_prgr = *blank
5.70 c     vvprl1_key    chain     vvprl1
5.70 c                   endif
      *
5.70 c                   if        %found(vvprl1)
5.62  *
5.62 c                   eval      hilety = 1
5.62  *
9.0x c                   call      'VP90XR'
5.62 c                   parm                    hirec
5.62 c                   parm                    horec
5.62  *
5.62 c                   eval      d_bd_fabp = hosapr
5.62 c                   eval      hilety = p_lety
5.62  *
5.62 c                   endif
5.62  *
5.62  * Skriver til prisfil
5.62  *
5.62 c                   eval      bd_rad = d_bd
5.62 c                   write     fibdpfr
5.62  *
5.62 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift til CORRADO pris-recordformat
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     corrado       begsr
      *
      * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
      *
     c                   eval      hienhe = w_enh1
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_sapr = hosapr
     c                   eval      w_ntpr = hosapr
      *
     c                   if        horab1 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
     c                   endif
      *
      * Flytter verdier til prisrecord
      *
     c                   eval      d_nn_vare = vvvare
6.31 c                   if        w_lv_nobb > 0
6.31 c                   eval      d_nn_nobb = w_lv_nobb
6.31 c                   else
     c                   eval      d_nn_nobb = vvnobb
6.31 c                   endif
     c                   eval      d_nn_vtx1 = vvtek1
     c                   eval      d_nn_vtx2 = *blank
     c                   eval      d_nn_enh1 = w_enh1
     c                   eval      d_nn_ntpr = '0000000,00'
     c                   eval      d_nn_sapr = '0000000,00'
     c                   eval      d_nn_fnav = w_fnav
     c                   eval      d_nn_utxt = w_utxt
      *
     c                   if        p_2val = 0
     c                   eval      d_nn_vtx2 = vvtek2
     c                   endif
      *
     c                   if        w_ntpr <> 0
     c                   move      w_ntpr        w_belo_alf
     c                   eval      d_nn_ntpr = %subst(w_belo_alf:1:7) + ','+
     c                                         %subst(w_belo_alf:8:2)
     c                   endif
      *
     c                   if        p_bval = 0 and
     c                             w_sapr <> 0
     c                   move      w_sapr        w_belo_alf
     c                   eval      d_nn_sapr = %subst(w_belo_alf:1:7) + ','+
     c                                         %subst(w_belo_alf:8:2)
     c                   endif
      *
      * Oversetter Ææ, Øø og Åå til ANSI-verdier
      *
     c                   if        d_nn_vtx1 <> *blank
     c     'Æ':X'46'     xlate     d_nn_vtx1     d_nn_vtx1
     c     'æ':X'A0'     xlate     d_nn_vtx1     d_nn_vtx1
     c     'Ø':X'77'     xlate     d_nn_vtx1     d_nn_vtx1
     c     'ø':X'90'     xlate     d_nn_vtx1     d_nn_vtx1
     c     'Å':X'2A'     xlate     d_nn_vtx1     d_nn_vtx1
     c     'å':X'EF'     xlate     d_nn_vtx1     d_nn_vtx1
     c                   endif
      *
     c                   if        d_nn_vtx2 <> *blank
     c     'Æ':X'46'     xlate     d_nn_vtx2     d_nn_vtx2
     c     'æ':X'A0'     xlate     d_nn_vtx2     d_nn_vtx2
     c     'Ø':X'77'     xlate     d_nn_vtx2     d_nn_vtx2
     c     'ø':X'90'     xlate     d_nn_vtx2     d_nn_vtx2
     c     'Å':X'2A'     xlate     d_nn_vtx2     d_nn_vtx2
     c     'å':X'EF'     xlate     d_nn_vtx2     d_nn_vtx2
     c                   endif
      *
     c                   if        d_nn_utxt <> *blank
     c     'Æ':X'46'     xlate     d_nn_utxt     d_nn_utxt
     c     'æ':X'A0'     xlate     d_nn_utxt     d_nn_utxt
     c     'Ø':X'77'     xlate     d_nn_utxt     d_nn_utxt
     c     'ø':X'90'     xlate     d_nn_utxt     d_nn_utxt
     c     'Å':X'2A'     xlate     d_nn_utxt     d_nn_utxt
     c     'å':X'EF'     xlate     d_nn_utxt     d_nn_utxt
     c                   endif
      *
      * Skriver til prisfil
      *
     c                   eval      nn_rad = d_nn
     c                   write     finnpfr
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift til FRIKALK pris-recordformat
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     frikalk       begsr
      *
      * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
      *
     c                   eval      hienhe = w_enh1
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_sapr = hosapr
     c                   eval      w_ntpr = hosapr
      *
     c                   if        horab1 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
     c                   endif
      *
      * Henter beskrivelse av priskode
      *
     c                   eval      w_ptxt = *blank
      *
     c                   if        hokpri <> *blank
     c                   eval      vpkol1_pkod = hokpri
     c     vpkol1_key    chain     vpkol1                             92
     c                   if        *in92 = *off
     c                   eval      w_ptxt = vaptxt
     c                   endif
     c                   endif
      *
      * Flytter verdier til prisrecord
      *
     c                   eval      d_rc_nobd = faanod
6.31 c                   if        w_lv_nobb > 0
6.31 c                   eval      d_rc_nobb = w_lv_nobb
6.31 c                   else
     c                   eval      d_rc_nobb = vvnobb
6.31 c                   endif
     c                   eval      d_rc_vare = vvvare
     c                   eval      d_rc_ogrp = vvogrp
     c                   eval      d_rc_hgrp = vvhgrp
     c                   eval      d_rc_ugrp = vvugrp
     c                   eval      d_rc_utxt = w_utxt
     c                   eval      d_rc_vtx1 = vvtek1
     c                   eval      d_rc_vtx2 = *blank
     c                   eval      d_rc_enh1 = w_enh1
     c                   eval      d_rc_fdat = w_dato_iso0
     c                   eval      d_rc_sapr = 0
     c                   eval      d_rc_ntpr = w_ntpr
     c                   eval      d_rc_pkod = w_ptxt
      *
     c                   exsr      gml_varenr
     c                   eval      d_rc_gvar = w_gvar
      *
     c                   if        p_2val = 0
     c                   eval      d_rc_vtx2 = vvtek2
     c                   endif
      *
     c                   if        p_bval = 0
     c                   eval      d_rc_sapr = w_sapr
     c                   endif
      *
      * Skriver til prisfil
      *
     c                   eval      rc_rad = d_rc
     c                   write     fircpfr
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift til HOLTE pris-recordformat
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     holte         begsr
      *
      * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
      *
     c                   eval      hienhe = w_enh1
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_sapr = hosapr
     c                   eval      w_ntpr = hosapr
      *
     c                   if        horab1 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
     c                   endif
      *
      * Flytter verdier til prisrecord
      *
     c                   eval      d_hp_ogrp = vvogrp
     c                   eval      d_hp_hgrp = vvhgrp
     c***                eval      d_hp_ugrp = vvugrp
     c                   movel     vvugrp        d_hp_ugrp
     c                   eval      d_hp_vare = vvvare
     c                   eval      d_hp_utxt = w_utxt
     c                   eval      d_hp_ntpr = w_ntpr
     c                   eval      d_hp_enh1 = w_enh1
      *
     c                   if        p_2val = 1
     c                   eval      d_hp_vtxt = vvtek1
     c                   else
     c                   eval      d_hp_vtxt = %trim(vvtek1) + ' ' +
     c                                         %trim(vvtek2)
     c                   endif
      *
      * Skriver til prisfil
      *
     c                   eval      hp_rad = d_hp
     c                   write     fihppfr
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift til NOBB pris-recordformat
      * Forutsetter at varen har nobb-nummer utfylt
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     nobb          begsr
      *
      * Sjekker om varen har nobb-nummer
      *
6.31 c                   if        w_lv_nobb > 0
6.31 c                   else
     c                   if        vvnobb = 0
     c                   goto      end_nobb
     c                   endif
6.31 c                   endif
      *
      * Henter varenes vareenhet (pakningskode '000' i LVR)
      *
     c                   eval      w_enhe = *blank
      *
     c                   call      'FO712C'
     c                   parm                    w_firm
     c                   parm                    vvvare
     c                   parm                    w_enhe
      *
     c                   if        w_enhe = *blank
     c                   goto      end_nobb
     c                   endif
      *
     c                   if        w_enhe <> w_enh1 and
     c                             w_enhe <> w_enh2 and
     c                             w_enhe <> w_enh3
     c                   goto      end_nobb
     c                   endif
      *
      * Kaller prisberegningsprogram for vareenhet, og finner salgspriser
      *
     c                   eval      hienhe = w_enhe
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_ntpr = hosapr
     c                   if        horab1 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
     c                   endif
      *
      * Henter beskrivelse av priskode
      *
     c                   eval      w_ptxt = *blank
      *
     c                   if        hokpri <> *blank
     c                   eval      vpkol1_pkod = hokpri
     c     vpkol1_key    chain     vpkol1                             92
     c                   if        *in92 = *off
     c                   eval      w_ptxt = vaptxt
     c                   endif
     c                   endif
      *
      * Flytter verdier til prisrecord
      *
     c                   eval      d_nobb_nobd = faanod
     c                   eval      d_nobb_vare = vvvare
6.31 c                   if        w_lv_nobb > 0
6.31 c                   eval      d_nobb_nobb = w_lv_nobb
6.31 c                   else
     c                   eval      d_nobb_nobb = vvnobb
6.31 c                   endif
     c                   eval      d_nobb_pris = w_ntpr
     c                   eval      d_nobb_fdat = w_dato_iso0
     c                   eval      d_nobb_tdat = 0
     c                   eval      d_nobb_pkod = w_ptxt
     c                   eval      d_nobb_edat = w_dato_iso0
      *
      * Dersom kundens pris er tilbudspris, hentes forfallsdato på tilbudet
      *
     c                   if        p_tval = 1 and
     c                             hokpri = 'T'
      *
5.70 c                   eval      b_till = *off
      *
6.22 c                   eval      vtill1_ogrp = 0
6.22 c                   eval      vtill1_hgrp = 0
6.22 c                   eval      vtill1_ugrp = 0
6.22 c                   eval      vtill1_ldor = 0
     c                   eval      vtill1_vare = vvvare
5.70 c                   eval      vtill1_prgr = w_prgr
     c                   eval      vtill1_lety = 0
     c     vtill1_key    setll     vtill1
     c     vtill1_key    reade     vtill1                                 92
     c                   dow       *in92 = *off
     c                   if        p_dato >= vtfdat and
     c                             p_dato <= vttdat
     c                   if        w_enhe = vtenh1 or
     c                             w_enhe = vtenh2 or
     c                             w_enhe = vtenh3
     c     *iso0         move      vttdat        w_dato_alf
     c                   move      w_dato_alf    d_nobb_tdat
5.70 c                   eval      b_till = *on
     c                   leave
     c                   endif
     c                   endif
     c     vtill1_key    reade     vtill1                                 92
     c                   enddo
5.70  *
5.70 c                   if        b_till = *off
5.70  *
5.70 c                   eval      vtill1_vare = vvvare
5.70 c                   eval      vtill1_prgr = *blank
5.70 c                   eval      vtill1_lety = 0
5.70 c     vtill1_key    setll     vtill1
5.70 c     vtill1_key    reade     vtill1                                 92
5.70 c                   dow       *in92 = *off
5.70 c                   if        p_dato >= vtfdat and
5.70 c                             p_dato <= vttdat
5.70 c                   if        w_enhe = vtenh1 or
5.70 c                             w_enhe = vtenh2 or
5.70 c                             w_enhe = vtenh3
5.70 c     *iso0         move      vttdat        w_dato_alf
5.70 c                   move      w_dato_alf    d_nobb_tdat
5.70 c                   eval      b_till = *on
5.70 c                   leave
5.70 c                   endif
5.70 c                   endif
5.70 c     vtill1_key    reade     vtill1                                 92
5.70 c                   enddo
5.70 c                   endif
6.22  * Dersom tilbud ikke ble funnet på oppgitt vare/prisgruppe/leveringstupe
6.22  * sjekkes varegruppe / leverandør
6.22  *
6.22  *  overgruppe,hovedgruppe,undergruppe
6.22  *
6.22 c                   if        b_till = *off
6.24 c                   eval      vtill1_prgr = w_prgr
6.24 c                   exsr      tilb_sjekk
6.24 c                   if        b_till = *off and
6.24 c                             w_prgr <> *blank
6.24 c                   eval      vtill1_prgr = *blank
6.24 c                   exsr      tilb_sjekk
6.24 c                   endif
6.24 c                   endif
      *
     c                   endif
      *
      * Skriver til prisfil
      *
     c                   eval      nobb_rad = d_nobb
     c                   write     finopfr
      *
     c     end_nobb      endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift til NOBB integrasjonsformat
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     nobb_int      begsr
      *
      * Sjekker om varen har nobb-nummer
      *
6.31 c                   if        w_lv_nobb > 0
6.31 c                   else
     c                   if        vvnobb = 0
     c                   goto      end_nobbint
     c                   endif
6.31 c                   endif
      *
      * Skriver til vare-record
      *
6.31 c                   if        w_lv_nobb > 0
6.31 c                   eval      d_nvar_nobb = w_lv_nobb
6.31 c                   eval      d_nvar_modn = w_lv_modn
6.31 c                   else
     c                   eval      d_nvar_nobb = vvnobb
     c                   eval      d_nvar_modn = vvnmod
6.31 c                   endif
     c                   eval      d_nvar_ogrp = vvogrp
     c                   eval      d_nvar_hgrp = vvhgrp
     c                   eval      d_nvar_ugrp = vvugrp
     c                   eval      d_nvar_tek1 = vvtek1
     c                   eval      d_nvar_tek2 = vvtek2
     c                   eval      d_nvar_mte1 = *blank
     c                   eval      d_nvar_mte2 = *blank
     c                   eval      d_nvar_eann = 0
     c                   eval      d_nvar_pvar = *blank
     c                   eval      d_nvar_lvar = vvvare
     c                   eval      d_nvar_ldor = faanod
     c                   eval      d_nvar_prod = 0
      *
     c     *iso0         move      vvodat        d_nvar_adat
      *
6.11  * Kaller program for henting av ean-nr
6.11  *
6.11 c                   call      'VE711R'
6.11 c                   parm                    w_firm
6.11 c                   parm                    vvvare
6.11 c                   parm                    w_enh1
6.11 c                   parm                    w_eann
6.11 c                   parm                    w_east
6.11 c                   move      w_eann        d_nvar_eann
      *
     c                   eval      ni_rad = d_nvar
     c                   write     finipfr
      *
      * Skriver til paknings-record
      *
     c                   eval      d_npak_pakn = '000'
     c                   eval      d_npak_enhe = w_enh1
     c                   eval      d_npak_ofak_w = 1
     c                   eval      d_npak_bred = 0
     c                   eval      d_npak_leng = 0
     c                   eval      d_npak_hoyd = 0
     c                   eval      d_npak_vekt = 0
     c                   eval      d_npak_volu = 0
     c                   eval      d_npak_anta = 1
     c                   eval      d_npak_eean = d_nvar_eann
     c                   eval      d_npak_ofak = 1
     c                   eval      d_npak_edun = 0
     c                   eval      d_npak_best = 1
     c                   eval      d_npak_paks = *blank
     c                   eval      d_npak_antp = 0
      *
     c                   eval      ni_rad = d_npak
     c                   write     finipfr
      *
      * Kaller prisberegningsprogram for enhe-1, og finner priser
      *
     c                   eval      hienhe = w_enh1
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_sapr = hosapr
     c                   eval      w_ntpr = hosapr
      *
     c                   if        horab1 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
     c                   endif
      *
      * Skriver til pris-record
      *
     c                   eval      d_npri_pris = w_ntpr
     c                   eval      d_npri_gdat = w_dato_iso0
     c                   eval      d_npri_pldo = d_nvar_ldor
     c                   eval      d_npri_plva = d_nvar_lvar
     c                   eval      d_npri_inpr = w_ntpr
     c                   eval      d_npri_kopr = w_ntpr
     c                   eval      d_npri_sapr = w_ntpr
     c                   eval      d_npri_tdat = 0
      *
     c                   if        p_bval = 0
     c                   eval      d_npri_sapr = w_sapr
     c                   endif
      *
      * Dersom kundens pris er tilbudspris, hentes forfallsdato på tilbudet
      *
     c                   if        p_tval = 1 and
     c                             hokpri = 'T'
      *
     c                   eval      vtill1_vare = vvvare
     c                   eval      vtill1_lety = 0
     c     vtill1_key    setll     vtill1
     c     vtill1_key    reade     vtill1                                 92
     c                   dow       *in92 = *off
     c                   if        p_dato >= vtfdat and
     c                             p_dato <= vttdat
     c                   if        w_enh1 = vtenh1 or
     c                             w_enh1 = vtenh2 or
     c                             w_enh1 = vtenh3
     c     *iso0         move      vttdat        w_dato_alf
     c                   move      w_dato_alf    d_npri_tdat
     c                   leave
     c                   endif
     c                   endif
     c     vtill1_key    reade     vtill1                                 92
     c                   enddo
      *
     c                   endif
      *
     c                   eval      ni_rad = d_npri
     c                   write     finipfr
      *
     c     end_nobbint   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift til REGNEARK-format
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     regneark      begsr
      *
7.07  * Dersom REGNEARKM2 og M2 er enhet på varen, så benyttes M2 som
7.07  * enhet det skal hentes priser fra
7.07  *
7.07 c                   if        p_rfmt = 'REGNEARKM2'  and
7.07 c                             w_enh1 <> 'M2'
7.07 c                   if        w_enh2 = 'M2' or
7.07 c                             w_enh3 = 'M2'
7.07 c                   eval      w_enh1 = 'M2'
7.07 c                   eval      w_enh2 = *blank
7.07 c                   eval      w_enh3 = *blank
7.07 c                   endif
7.07 c                   endif
      *
      * Kaller prisberegningsprogram for enhet-1 og finner salgspriser og
      * rabatt
      *
     c                   eval      hienhe = w_enh1
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_s1pr = hosapr
     c                   eval      w_n1pr = hosapr
      *
     c                   if        horab1 > 0
     c                   eval(h)   w_n1pr = w_n1pr - (w_n1pr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_n1pr = w_n1pr - (w_n1pr * horab2 / 100)
     c                   endif
      *
     c                   eval      w_raba = horab1
      *
     c                   if        horab2 <> 0 and
     c                             w_s1pr <> 0
     c                   eval(h)   w_raba = (w_s1pr - w_n1pr) * 100 / w_s1pr
     c                   endif
      *
      * Kaller prisberegningsprogram for enhet-2 og finner salgspris
      *
     c                   eval      w_n2pr = 0
      *
     c                   if        w_enh2 <> *blank
      *
     c                   eval      hienhe = w_enh2
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_n2pr = hosapr
     c                   if        horab1 > 0
     c                   eval(h)   w_n2pr = w_n2pr - (w_n2pr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_n2pr = w_n2pr - (w_n2pr * horab2 / 100)
     c                   endif
      *
     c                   endif
      *
      * Kaller prisberegningsprogram for enhet-3 og finner salgspris
      *
     c                   eval      w_n3pr = 0
      *
     c                   if        w_enh3 <> *blank
      *
     c                   eval      hienhe = w_enh3
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_n3pr = hosapr
     c                   if        horab1 > 0
     c                   eval(h)   w_n3pr = w_n3pr - (w_n3pr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_n3pr = w_n3pr - (w_n3pr * horab2 / 100)
     c                   endif
      *
     c                   endif
      *
      * Flytter verdier til prisrecord
      *
     c                   eval      d_ra_vare = vvvare
6.31 c                   if        w_lv_nobb > 0
6.31 c                   eval      d_ra_nobb = w_lv_nobb
6.31 c                   else
     c                   eval      d_ra_nobb = vvnobb
6.31 c                   endif
     c                   eval      d_ra_vtx1 = vvtek1
     c                   eval      d_ra_vtx2 = *blank
     c                   eval      d_ra_pkod = *blank
5.61 c                   eval      d_ra_raba = '000,00'
     c                   eval      d_ra_enh1 = w_enh1
5.61 c                   eval      d_ra_n1pr = '0000000,00'
5.61 c                   eval      d_ra_s1pr = '0000000,00'
     c                   eval      d_ra_enh2 = w_enh2
5.61 c                   eval      d_ra_n2pr = '0000000,00'
5.61 c                   eval      d_ra_omr2 = '000000,000000'
     c                   eval      d_ra_enh3 = w_enh3
5.61 c                   eval      d_ra_n3pr = '0000000,00'
5.61 c                   eval      d_ra_omr3 = '000000,000000'
     c                   eval      d_ra_vgrp = '0000000'
     c                   eval      d_ra_utxt = w_utxt
     c                   eval      d_ra_eann = 0
     c                   eval      d_ra_lnav = *blank
      *
     c                   if        p_2val = 0
     c                   eval      d_ra_vtx2 = vvtek2
     c                   endif
      *
     c                   if        hokpri <> *blank
     c                   eval      vpkol1_pkod = hokpri
     c     vpkol1_key    chain     vpkol1                             92
     c                   if        *in92 = *off
     c                   eval      d_ra_pkod = vaptxt
     c                   endif
     c                   endif
      *
     c                   if        vvogrp <> 0
     c                   move      vvogrp        w_ogrp_alf
     c                   move      vvhgrp        w_hgrp_alf
     c                   move      vvugrp        w_ugrp_alf
     c                   eval      d_ra_vgrp = w_ogrp_alf + w_hgrp_alf +
     c                                         w_ugrp_alf
     c                   endif
      *
     c                   if        p_bval = 0 and
     c                             w_raba <> 0
     c                   move      w_raba        w_raba_alf
5.61 c                   eval      d_ra_raba = %subst(w_raba_alf:1:3) + ','+
     c                                         %subst(w_raba_alf:4:2)
     c                   endif
      *
     c                   if        p_bval = 0 and
     c                             w_s1pr <> 0
     c                   move      w_s1pr        w_belo_alf
5.61 c                   eval      d_ra_s1pr = %subst(w_belo_alf:1:7) + ','+
     c                                         %subst(w_belo_alf:8:2)
     c                   endif
      *
     c                   if        w_n1pr <> 0
     c                   move      w_n1pr        w_belo_alf
5.61 c                   eval      d_ra_n1pr = %subst(w_belo_alf:1:7) + ','+
     c                                         %subst(w_belo_alf:8:2)
     c                   endif
      *
      * Enhet-2
      *
     c                   if        w_enh2 <> *blank
      *
     c                   if        w_n2pr <> 0
     c                   move      w_n2pr        w_belo_alf
5.61 c                   eval      d_ra_n2pr = %subst(w_belo_alf:1:7) + ','+
     c                                         %subst(w_belo_alf:8:2)
     c                   endif
      *
     c                   if        w_omr2 <> 0
     c                   move      w_omr2        w_omre_alf
5.61 c                   eval      d_ra_omr2 = %subst(w_omre_alf:1:6) + ','+
     c                                         %subst(w_omre_alf:7:6)
     c                   endif
      *
     c                   endif
      *
      * Enhet-3
      *
     c                   if        w_enh3 <> *blank
      *
     c                   if        w_n3pr <> 0
     c                   move      w_n3pr        w_belo_alf
5.61 c                   eval      d_ra_n3pr = %subst(w_belo_alf:1:7) + ','+
     c                                         %subst(w_belo_alf:8:2)
     c                   endif
      *
     c                   if        w_omr3 <> 0
     c                   move      w_omr3        w_omre_alf
5.61 c                   eval      d_ra_omr3 = %subst(w_omre_alf:1:6) + ','+
     c                                         %subst(w_omre_alf:7:6)
     c                   endif
      *
     c                   endif
      *
6.11  * Kaller program for henting av ean-nr
6.11  *
6.11 c                   call      'VE711R'
6.11 c                   parm                    w_firm
6.11 c                   parm                    vvvare
6.11 c                   parm                    w_enh1
6.11 c                   parm                    w_eann
6.11 c                   parm                    w_east
     c                   eval      d_ra_eann = w_eann
      *
     c                   if        vvldor <> 0
     c                   eval      rlevl1_levr = vvldor
     c     rlevl1_key    chain     rlevl1
     c                   if        %found
     c                   eval      d_ra_lnav = rlnavn
     c                   endif
     c                   endif
6.30  *
7.07 c                   if        p_rfmt = 'REGNEARK'  or
7.07 c                             p_rfmt = 'REGNEARKM2'
      *
      * Oversetter Ææ, Øø og Åå til ANSI-verdier
      *
7.09 c*                  if        d_ra_vtx1 <> *blank
7.09 c*    'Æ':X'46'     xlate     d_ra_vtx1     d_ra_vtx1
7.09 c*    'æ':X'A0'     xlate     d_ra_vtx1     d_ra_vtx1
7.09 c*    'Ø':X'77'     xlate     d_ra_vtx1     d_ra_vtx1
7.09 c*    'ø':X'90'     xlate     d_ra_vtx1     d_ra_vtx1
7.09 c*    'Å':X'2A'     xlate     d_ra_vtx1     d_ra_vtx1
7.09 c*    'å':X'EF'     xlate     d_ra_vtx1     d_ra_vtx1
7.09 c*                  endif
      *
7.09 c*                  if        d_ra_vtx2 <> *blank
7.09 c*    'Æ':X'46'     xlate     d_ra_vtx2     d_ra_vtx2
7.09 c*    'æ':X'A0'     xlate     d_ra_vtx2     d_ra_vtx2
7.09 c*    'Ø':X'77'     xlate     d_ra_vtx2     d_ra_vtx2
7.09 c*    'ø':X'90'     xlate     d_ra_vtx2     d_ra_vtx2
7.09 c*    'Å':X'2A'     xlate     d_ra_vtx2     d_ra_vtx2
7.09 c*    'å':X'EF'     xlate     d_ra_vtx2     d_ra_vtx2
7.09 c*                  endif
      *
7.09 c*                  if        d_ra_utxt <> *blank
7.09 c*    'Æ':X'46'     xlate     d_ra_utxt     d_ra_utxt
7.09 c*    'æ':X'A0'     xlate     d_ra_utxt     d_ra_utxt
7.09 c*    'Ø':X'77'     xlate     d_ra_utxt     d_ra_utxt
7.09 c*    'ø':X'90'     xlate     d_ra_utxt     d_ra_utxt
7.09 c*    'Å':X'2A'     xlate     d_ra_utxt     d_ra_utxt
7.09 c*    'å':X'EF'     xlate     d_ra_utxt     d_ra_utxt
7.09 c*                  endif
      *
7.09 c*                  if        d_ra_lnav <> *blank
7.09 c*    'Æ':X'46'     xlate     d_ra_lnav     d_ra_lnav
7.09 c*    'æ':X'A0'     xlate     d_ra_lnav     d_ra_lnav
7.09 c*    'Ø':X'77'     xlate     d_ra_lnav     d_ra_lnav
7.09 c*    'ø':X'90'     xlate     d_ra_lnav     d_ra_lnav
7.09 c*    'Å':X'2A'     xlate     d_ra_lnav     d_ra_lnav
7.09 c*    'å':X'EF'     xlate     d_ra_lnav     d_ra_lnav
7.09 c*                  endif
6.30  *
6.30 c                   endif
      *
      * Skriver til prisfil
      *
7.10 c                   if        p_rfmt = 'REGNEARKX' or
7.10 c                             p_rfmt = 'REGNEARKS'
7.10 c/exec sql
7.10 c+ insert into  VP682PF (
7.10 c+   VVVARE, VVNOBB, VVTEK1, VVTEK2, VAPTXT
7.10 c+  , FDRAB1,  VVENHE1,  VPSAPR1,  VPNOPR1
7.10 c+  , VVENHE2,  VEOMRE2,  VPNOPR2
7.10 c+  , VVENHE3,  VEOMRE3,  VPNOPR3
7.10 c+  , VVOGRP, VVHGRP, VVUGRP
7.10 c+ ,  VGRPT, VEPGTI, RLNAVN
7.10 c+ )
7.10 c+ VALUES (
7.10 c+   :d_ra_vare, :d_ra_nobb, :d_ra_vtx1, :d_ra_vtx2, :d_ra_pkod
7.10 c+  ,:d_ra_raba, :d_ra_enh1, :d_ra_s1pr, :d_ra_n1pr
7.10 c+  , :d_ra_enh2, :d_ra_omr2, :d_ra_n2pr
7.10 c+  , :d_ra_enh3, :d_ra_omr3, :d_ra_n3pr
7.10 c+  ,:vvogrp, :vvhgrp, :vvugrp
7.10 c+  , :d_ra_utxt, :d_ra_eann, :d_ra_lnav
7.10 c+ )
7.10 c/end-exec
7.10 c                   else
     c                   eval      ra_rad = d_ra
     c                   write     firapfr
7.10 c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift til SALGSSUPPORT pris-recordformat
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     salgssupport  begsr
      *
      * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
      *
     c                   eval      hienhe = w_enh1
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_sapr = hosapr
     c                   eval      w_ntpr = hosapr
      *
     c                   if        horab1 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
     c                   endif
      *
      * Flytter verdier til prisrecord
      *
     c                   eval      d_sk_vare = vvvare
     c                   eval      d_sk_vtx1 = vvtek1
     c                   eval      d_sk_vtx2 = *blank
     c                   eval      d_sk_ogrp = vvogrp
     c                   eval      d_sk_hgrp = vvhgrp
     c                   eval      d_sk_ugrp = vvugrp
     c                   eval      d_sk_utxt = w_utxt
     c                   eval      d_sk_enh1 = w_enh1
     c                   eval      d_sk_sapr = 0
     c                   eval      d_sk_ntpr = w_ntpr
     c                   eval      d_sk_lnav = *blank
      *
     c                   if        p_2val = 0
     c                   eval      d_sk_vtx2 = vvtek2
     c                   endif
      *
     c                   if        p_bval = 0
     c                   eval      d_sk_sapr = w_sapr
     c                   endif
      *
      * Henter leverandør-navn
      *
     c                   if        vvldor <> 0
     c                   eval      rlevl1_levr = vvldor
     c     rlevl1_key    chain     rlevl1                             92
     c                   if        *in92 = *off
     c                   eval      d_sk_lnav = rlnavn
     c                   endif
     c                   endif
      *
      * Skriver til prisfil
      *
     c                   eval      sk_rad = d_sk
     c                   write     fiskpfr
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift til HS-FAKTURA pris-recordformat
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     hs_faktura    begsr
      *
      * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
      *
     c                   eval      hienhe = w_enh1
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_sapr = hosapr
     c                   eval      w_ntpr = hosapr
      *
     c                   if        horab1 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
     c                   endif
      *
     c                   eval      w_raba = horab1
      *
     c                   if        horab2 <> 0 and
     c                             w_sapr <> 0
     c                   eval(h)   w_raba = (w_sapr - w_ntpr) * 100 / w_sapr
     c                   endif
      *
      * Flytter verdier til prisrecord (vare)
      *
     c                   eval      d_h1_vare = vvvare
     c                   eval      d_h1_vtx1 = vvtek1
     c                   eval      d_h1_vtx2 = vvtek2
     c                   eval      d_h1_enh1 = w_enh1
     c                   eval      d_h1_utxt = w_utxt
     c                   eval      d_h1_sapr = *blank
      *
9.06 c                   move      w_ntpr        w_belo_alf
9.06 c*                  move      w_sapr        w_belo_alf
     c                   eval      d_h1_sapr = %subst(w_belo_alf:2:6) + ','+
     c                                         %subst(w_belo_alf:8:2)
      *
      * Skriver til prisfil
      *
     c                   eval      h1_rad = d_h1
     c                   write     fih1pfr
      *
      * Flytter verdier til prisrecord (rabatt)
      *
     c                   eval      d_h2_vare = vvvare
     c                   eval      d_h2_raba = *blank
      *
     c                   move      w_raba        w_raba_alf
     c                   eval      d_h2_raba = %subst(w_raba_alf:2:2) + ','+
     c                                         %subst(w_raba_alf:4:2)
      *
      * Skriver til prisfil
      *
     c                   eval      h2_rad = d_h2
     c                   write     fih2pfr
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine utskrift til ENTREKA pris-recordformat
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     entreka       begsr
      *
      * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
      *
     c                   eval      hienhe = w_enh1
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      w_sapr = hosapr
     c                   eval      w_ntpr = hosapr
      *
     c                   if        horab1 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
     c                   endif
     c                   if        horab2 > 0
     c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
     c                   endif
      *
     c                   eval      w_raba = horab1
      *
     c                   if        horab2 <> 0 and
     c                             w_sapr <> 0
     c                   eval(h)   w_raba = (w_sapr - w_ntpr) * 100 / w_sapr
     c                   endif
      *
      * Flytter verdier til prisrecord
      *
     c                   eval      d_et_vare = vvvare
     c                   eval      d_et_vtx1 = vvtek1
     c                   eval      d_et_vtx2 = vvtek2
     c                   eval      d_et_ntpr = *blank
     c                   eval      d_et_enh1 = w_enh1
     c                   eval      d_et_raba = *blank
      *
     c                   move      w_ntpr        w_belo_alf
     c                   eval      d_et_ntpr = %subst(w_belo_alf:1:7) + ','+
     c                                         %subst(w_belo_alf:8:2)
      *
     c                   move      w_raba        w_raba_alf
     c                   eval      d_et_raba = %subst(w_raba_alf:1:3) + ','+
     c                                         %subst(w_raba_alf:4:2)
      *
      * Skriver til prisfil
      *
     c                   eval      et_rad = d_et
     c                   write     fietpfr
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine oppdat. av feltbasert intern fil (INTFILE)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     intfile       begsr
      *
      * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
      *
     c                   clear                   fipxlur
     c                   eval      hienhe = w_enh1
      *
9.0x c                   call      'VP90XR'
     c                   parm                    hirec
     c                   parm                    horec
      *
     c                   eval      fipxl1_kund = p_kund
     c                   eval      fipxl1_sort = p_vsor
     c                   eval      fipxl1_vare = vvvare
     c     fipxl1_key    chain     fipxl1
      *
     c                   if        not %found
     c                   eval      fiufir = w_firm
     c                   eval      fiukun = p_kund
     c                   eval      fiusor = p_vsor
     c                   eval      fiuvar = vvvare
     c                   endif
      *
     c                   eval      vshel1_vsor = p_vsor
     c     vshel1_key    chain     vshel1
     c                   if        %found
     c                   eval      fiubes = vcbesk
     c                   else
     c                   eval      fiubes = *blank
     c                   endif
      *
6.31 c                   if        w_lv_nobb > 0
6.31 c                   eval      fiunob = w_lv_nobb
6.31 c                   else
     c                   eval      fiunob = vvnobb
6.31 c                   endif
     c                   eval      fiute1 = vvtek1
     c                   eval      fiute2 = vvtek2
     c                   eval      fiuenh = w_enh1
     c                   eval      fiusap = hosapr
     c                   eval      fiura1 = horab1
     c                   eval      fiura2 = horab2
     c                   eval      fiukpr = hokpri
      *
     c                   time                    fiudat
     c                   time                    fiutim
     c                   eval      fiuusr = l_user
      *
     c                   eval      fipxlu_kund = p_kund
     c                   eval      fipxlu_sort = p_vsor
     c                   eval      fipxlu_vare = vvvare
     c     fipxlu_key    chain     fipxlu
     c                   if        %found
     c                   update    fipxlur
     c                   else
     c                   write     fipxlur
     c                   endif
      *
     c                   endsr
5.60  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.60  * Subrutine utskrift til BYGGMANN pris-recordformat
5.60  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
5.60  *
5.60 c     byggmann      begsr
5.60  *
5.60  * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
5.60  *
5.60 c                   eval      hienhe = w_enh1
5.60  *
9.0x c                   call      'VP90XR'
5.60 c                   parm                    hirec
5.60 c                   parm                    horec
5.60  *
5.60 c                   eval      w_sapr = hosapr
5.60 c                   eval      w_ntpr = hosapr
5.60  *
5.60 c                   if        horab1 > 0
5.60 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
5.60 c                   endif
5.60 c                   if        horab2 > 0
5.60 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
5.60 c                   endif
5.60  *
5.60  *
5.60  *
5.60  * Flytter verdier til prisrecord
5.60  *
5.60 c                   eval      d_bm_vare = vvvare
5.60 c                   eval      d_bm_vtx1 = vvtek1
5.60 c                   eval      d_bm_ntpr = *blank
5.60 c                   eval      d_bm_enh1 = w_enh1
5.60  *
5.60 c                   move      w_ntpr        w_belo_alf
5.60 c                   eval      d_bm_ntpr = '00'+ %subst(w_belo_alf:1:7)+
5.60 c                                         ',' +
5.60 c                                         %subst(w_belo_alf:8:2)
5.60  *
5.60  *
5.60  * Skriver til prisfil
5.60  *
5.60 c                   eval      et_rad = d_bm
5.60 c                   write     fietpfr
5.60  *
5.60 c                   endsr
6.12  *
6.12  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.12  * Subrutine utskrift til BYGGOFFICE pris-recordformat
6.12  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.12  *
6.12 c     byggoffice    begsr
6.12  *
6.12  * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
6.12  *
6.12 c                   eval      hienhe = w_enh1
6.12  *
9.0x c                   call      'VP90XR'
6.12 c                   parm                    hirec
6.12 c                   parm                    horec
6.12  *
6.12 c                   eval      w_sapr = hosapr
6.12 c                   eval      w_ntpr = hosapr
6.12  *
6.12 c                   if        horab1 > 0
6.12 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
6.12 c                   endif
6.12 c                   if        horab2 > 0
6.12 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
6.12 c                   endif
6.12  *
6.12 c                   eval      w_raba = horab1
6.12  *
6.12 c                   if        horab2 <> 0 and
6.12 c                             w_sapr <> 0
6.12 c                   eval(h)   w_raba = (w_sapr - w_ntpr) * 100 / w_sapr
6.12 c                   endif
6.12  *
6.12  * Flytter verdier til prisrecord
6.12  *
6.12 c                   eval      d_bo_ogrp = vvogrp
6.12 c                   eval      d_bo_hgrp = vvhgrp
6.12 c                   eval      d_bo_ugrp = vvugrp
6.12 c                   eval      d_bo_vare = vvvare
6.31 c                   if        w_lv_nobb > 0
6.31 c                   eval      d_bo_nobb = w_lv_nobb
6.31 c                   else
6.12 c                   eval      d_bo_nobb = vvnobb
6.31 c                   endif
6.12 c                   eval      d_bo_utxt = w_utxt
6.12 c                   eval      d_bo_vtx1 = vvtek1
6.12 c                   eval      d_bo_vtx2 = vvtek2
6.12 c                   eval      d_bo_enh1 = w_enh1
6.12 c                   eval      d_bo_sapr = w_sapr
6.12 c                   eval      d_bo_ntpr = w_ntpr
6.12  *
6.12  * Skriver til prisfil
6.12  *
6.12 c                   eval      bo_rad = d_bo
6.12 c                   write     fibopfr
6.12  *
6.12 c                   endsr
6.15  *
6.15  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.15  * Subrutine utskrift til ibx catalogue
6.15  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.15  *
6.15 c     ibxcatalogue  begsr
6.15  *
6.15 c                   if        vgufri = *blank
6.15 c                   leavesr
6.15 c                   endif
6.15  *
6.15  * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
6.15  *
6.15 c                   eval      hienhe = w_enh1
6.15  *
9.0x c                   call      'VP90XR'
6.15 c                   parm                    hirec
6.15 c                   parm                    horec
6.15  *
6.15 c                   eval      w_sapr = hosapr
6.15 c                   eval      w_ntpr = hosapr
6.15  *
6.15 c                   if        horab1 > 0
6.15 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
6.15 c                   endif
6.15 c                   if        horab2 > 0
6.15 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
6.15 c                   endif
6.15  *
6.15 c                   eval      w_raba = horab1
6.15  *
6.15 c                   if        horab2 <> 0 and
6.15 c                             w_sapr <> 0
6.15 c                   eval(h)   w_raba = (w_sapr - w_ntpr) * 100 / w_sapr
6.15 c                   endif
6.15  * henter evt. lang varetekst
6.15 c                   eval      jvarl1_vare = vvvare
6.15 c     jvarl1_key    chain     jvarl1
6.15 c                   time                    w_dato
6.15  *
6.15 c                   eval      w_ekod = '3'
6.15 c                   if        vvkmva =  1
6.15 c                   eval      w_ekod = '4'
6.15 c                   endif
6.15 c                   if        vvkmva =  2
6.15 c                   eval      w_ekod = 'H'
6.15 c                   endif
6.15  * henter mva sats
6.15 c                   call      'RS755R'
6.15 c                   parm                    w_stat
6.15 c                   parm                    w_ekod
6.15 c                   parm                    w_etxt
6.15 c                   parm                    w_dato
6.15 c                   parm                    w_mvap
6.15 c                   parm                    w_mvat
6.15 c                   parm                    w_mvaf
6.15  *
6.15  * enhetskonverting
6.15  *
6.15 c                   eval      d_bx_enh1 = *blank
6.15 c                   select
6.15 c                   when      w_enh1 = 'ARK'
6.15 c                   eval      d_bx_Enh1 = 'LEF'
6.15 c                   when      w_enh1 = 'BØT'
6.15 c                   eval      d_bx_Enh1 = 'BJ '
6.15 c                   when      w_enh1 = 'BK '
6.15 c                   eval      d_bx_Enh1 = 'CG '
6.15 c                   when      w_enh1 = 'BLO'
6.15 c                   eval      d_bx_Enh1 = 'D64'
6.15 c                   when      w_enh1 = 'BNT'
6.15 c                   eval      d_bx_Enh1 = 'BE '
6.15 c                   when      w_enh1 = 'BOX'
6.15 c                   eval      d_bx_Enh1 = 'BX '
6.15 c                   when      w_enh1 = 'BUL'
6.15 c                   eval      d_bx_Enh1 = 'VQ '
6.15 c                   when      w_enh1 = 'CEN'
6.15 c                   eval      d_bx_Enh1 = 'CEN'
6.15 c                   when      w_enh1 = 'CM '
6.15 c                   eval      d_bx_Enh1 = 'CMT'
6.15 c                   when      w_enh1 = 'DSP'
6.15 c                   eval      d_bx_Enh1 = 'DSP'
6.15 c                   when      w_enh1 = 'DUS'
6.15 c                   eval      d_bx_Enh1 = 'DSZ'
6.15 c                   when      w_enh1 = 'ESK'
6.15 c                   eval      d_bx_Enh1 = 'BX '
6.15 c                   when      w_enh1 = 'FAT'
6.15 c                   eval      d_bx_Enh1 = 'BLL'
6.15 c                   when      w_enh1 = 'FL '
6.15 c                   eval      d_bx_Enh1 = 'BO '
6.15 c                   when      w_enh1 = 'G  '
6.15 c                   eval      d_bx_Enh1 = 'GRM'
6.15 c                   when      w_enh1 = 'HL '
6.15 c                   eval      d_bx_Enh1 = 'HLT'
6.15 c                   when      w_enh1 = 'PLA'
6.15 c                   eval      d_bx_Enh1 = 'PG '
6.15 c                   when      w_enh1 = 'KAN'
6.15 c                   eval      d_bx_Enh1 = 'CA '
6.15 c                   when      w_enh1 = 'KAS'
6.15 c                   eval      d_bx_Enh1 = 'CS '
6.15 c                   when      w_enh1 = 'KG '
6.15 c                   eval      d_bx_Enh1 = 'KGM'
6.15 c                   when      w_enh1 = 'KOL'
6.15 c                   eval      d_bx_Enh1 = 'KOL'
6.15 c                   when      w_enh1 = 'KRT'
6.15 c                   eval      d_bx_Enh1 = 'CT '
6.15 c                   when      w_enh1 = 'KVL'
6.15 c                   eval      d_bx_Enh1 = 'CL '
6.15 c                   when      w_enh1 = 'LAS'
6.15 c                   eval      d_bx_Enh1 = 'NL '
6.15 c                   when      w_enh1 = 'LGD'
6.15 c                   eval      d_bx_Enh1 = 'LN '
6.15 c                   when      w_enh1 = 'LM '
6.15 c                   eval      d_bx_Enh1 = 'MTR'
6.15 c                   when      w_enh1 = 'LTR'
6.15 c                   eval      d_bx_Enh1 = 'LTR'
6.15 c                   when      w_enh1 = 'M  '
6.15 c                   eval      d_bx_Enh1 = 'MTR'
6.15 c                   when      w_enh1 = 'MIL'
6.15 c                   eval      d_bx_Enh1 = 'MIL'
6.15 c                   when      w_enh1 = 'MM '
6.15 c                   eval      d_bx_Enh1 = 'MMT'
6.15 c                   when      w_enh1 = 'MPK'
6.15 c                   eval      d_bx_Enh1 = 'CZ '
6.15 c                   when      w_enh1 = 'M2 '
6.15 c                   eval      d_bx_Enh1 = 'MTK'
6.15 c                   when      w_enh1 = 'M3 '
6.15 c                   eval      d_bx_Enh1 = 'MTQ'
6.15 c                   when      w_enh1 = 'PAK'
6.15 c                   eval      d_bx_Enh1 = 'PK '
6.15 c                   when      w_enh1 = 'PAL'
6.15 c                   eval      d_bx_Enh1 = 'PF '
6.15 c                   when      w_enh1 = 'PAR'
6.15 c                   eval      d_bx_Enh1 = 'PR '
6.15 c                   when      w_enh1 = 'PAT'
6.15 c                   eval      d_bx_Enh1 = 'CQ '
6.15 c                   when      w_enh1 = 'PLA'
6.15 c                   eval      d_bx_Enh1 = 'PG '
6.15 c                   when      w_enh1 = 'POS'
6.15 c                   eval      d_bx_Enh1 = 'BG '
6.15 c                   when      w_enh1 = 'PP '
6.15 c                   eval      d_bx_Enh1 = 'PP '
6.15 c                   when      w_enh1 = 'RØR'
6.15 c                   eval      d_bx_Enh1 = 'Z28'
6.15 c                   when      w_enh1 = 'RUL'
6.15 c                   eval      d_bx_Enh1 = 'RO '
6.15 c                   when      w_enh1 = 'SEK'
6.15 c                   eval      d_bx_Enh1 = 'SA '
6.15 c                   when      w_enh1 = 'SET'
6.15 c                   eval      d_bx_Enh1 = 'SET'
6.15 c                   when      w_enh1 = 'SNL'
6.15 c                   eval      d_bx_Enh1 = 'SO '
6.15 c                   when      w_enh1 = 'SPA'
6.26 c                   eval      d_bx_Enh1 = 'BJ '
6.15 c                   when      w_enh1 = 'STK'
6.15 c                   eval      d_bx_Enh1 = 'EA '
6.15 c                   when      w_enh1 = 'TON'
6.15 c                   eval      d_bx_Enh1 = 'TNE'
6.15 c                   when      w_enh1 = 'TRM'
6.15 c                   eval      d_bx_Enh1 = 'RL '
6.15 c                   when      w_enh1 = 'TUB'
6.15 c                   eval      d_bx_Enh1 = 'TU '
6.15 c                   endsl
6.15  *
6.15  *
6.15  * Flytter verdier til prisrecord
6.15  *
6.15 c                   movel     vvvare        d_bx_nobb
6.15 c                   eval      d_bx_vtx1 = vvtek1
6.15 c                   eval      d_bx_vtx2 = vvtek2
6.15 c                   if        jvftxt <> *blank
6.15 c                   eval      d_bx_ltxt = jvftxt
6.15 c                   else
6.15 c                   eval      d_bx_ltxt = %trim(vvtek1) + ' ' +
6.15 c                                         %trim(vvtek2)
6.15 c                   endif
6.15 c                   eval      d_bx_ltid = 1
6.15 c                   eval      d_bx_unsp = vgufri
6.15 c                   eval      d_bx_ostr = '1'
6.15 c                   eval      d_bx_bint = '1'
6.15 c                   eval      d_bx_valu = 'NOK'
6.15 c                   eval      d_bx_mvap = w_mvap
6.15 c                   eval      d_bx_risk = 'NEI'
6.15 c                   eval      d_bx_hms  = *blank
6.15  *
6.15 c                   if        w_ntpr <> 0
6.15 c                   move      w_ntpr        w_belo_alf
6.15 c                   eval      d_bx_ntpr = %subst(w_belo_alf:1:7) + ','+
6.15 c                                         %subst(w_belo_alf:8:2)
6.15 c                   endif
6.15  * Skriver til prisfil
6.15  *
6.15 c                   eval      bx_rad = d_bx
6.15 c                   write     fibxpfr
6.15  *
6.15 c                   endsr
      *
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  * Subrutine utskrift av overskrifter i logiq varekatalog
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  *
6.32 c     logiq_hode    begsr
6.32  *
6.32  * Overskrift hode-informasjon
6.32  *
6.32 c***                eval      lq_rad = '"' +
6.32 c***                                   'Avsender orgnr' + '";"' +
6.32 c***                                   'Mottager orgnr' + '";"' +
6.32 c***                                   'Mottager GLN-nr' + '";"' +
6.32 c***                                   'Katalognavn' + '";"' +
6.32 c***                                   'Kundens prosjektnr' + '";"' +
6.32 c***                                   'Katalognr' + '";"' +
6.32 c***                                   'Katalogspråk' + '";"' +
6.32 c***                                   'Aksjonskode' + '";"' +
6.32 c***                                   'Katalogdato' + '";"' +
6.32 c***                                   'Gyldig fra dato' + '";"' +
6.32 c***                                   'Kundenr' + '";"' +
6.32 c***                                   'Kundenavn' + '";"' +
6.32 c***                                   'Prosjektnr' + '";"' +
6.32 c***                                   'Prosjektnavn' + '";"' +
6.32 c***                                   'Prosjekt adr1' + '";"' +
6.32 c***                                   'Prosjekt adr2' + '";"' +
6.32 c***                                   'Prosjekt postadr' + '";"' +
6.32 c***                                   'Prosjekt kontaktperson' + '"'
6.32  *
6.32 c***                write     filqpfr
6.32  *
6.32  * Hode-informasjon
6.32  *
6.32 c                   eval      lq_rad = %trim(%editc(aafftn:'Z')) + ';' +
6.32 c                                      %trim(%editc(rkftnr:'Z')) + ';' +
6.32 c                                      %trim(%editc(rkeank:'Z')) + ';"' +
6.32 c                                      'NXVarekatalog' + '";"' +
6.32 c                                      %trim(flepro) + '";"' +
6.32 c                                      %trim(l_fgrp) + '-05' + '";"' +
6.32 c                                      'NO' + '";"' +
6.32 c                                      'Replace' + '";"' +
6.32 c                                      %char(w_ddat:*iso) + '";"' +
6.32 c                                      %char(p_dato:*iso) + '";' +
6.32 c                                      %trim(%editc(rkkund:'Z')) + ';"' +
6.32 c                                      %trim(rknavn) + '";' +
6.32 c                                      %trim(%editc(flkpro:'Z')) + ';"' +
6.32 c                                      %trim(flnavn) + '";"' +
6.32 c                                      %trim(fladr1) + '";"' +
6.32 c                                      %trim(fladr2) + '";"' +
6.32 c                                      %trim(%editc(flponr:'Z')) + '";"' +
6.32 c                                      %trim(flkprs) + '"'
6.32  *
6.32 c                   write     filqpfr
6.32  *
6.32  * Overskrift linje-informasjon
6.32  *
6.32 c***                eval      lq_rad = '"' +
6.32 c***                                   'Linjenr' + '";"' +
6.32 c***                                   'Varenr' + '";"' +
6.32 c***                                   'Bestillbarindikator' + '";"' +
6.32 c***                                   'Bestillingsenhet' + '";"' +
6.32 c***                                   'Nettopris' + '";"' +
6.32 c***                                   'Valutaskode' + '";"' +
6.32 c***                                   'GTIN' + '";"' +
6.32 c***                                   'UNSPSC' + '";"' +
6.32 c***                                   'Varegruppe' + '";"' +
6.32 c***                                   'Varegruppenavn' + '";"' +
6.32 c***                                   'Produktnavn' + '";"' +
6.32 c***                                   'Nobbnr' + '";"' +
6.32 c***                                   'Rabatt %' + '";"' +
6.32 c***                                   'MVA-sats' + '";"' +
6.32 c***                                   'Erstatter vare' + '";"' +
6.32 c***                                   'Erstatter produktnavn' + '";"' +
6.32 c***                                   'URL produktbilde' + '"'
6.32  *
6.32 c***                write     filqpfr
6.32  *
6.32 c                   endsr
6.32  *
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  * Subrutine utskrift til Logiq varekatalog
6.32  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.32  *
6.32 c     logiq         begsr
6.32  *
6.32  * Kaller prisberegningsprogram for enhet-1, og finner salgspriser
6.32  *
6.32 c                   eval      hienhe = w_enh1
6.32  *
6.32 c                   call      'VP900R'
6.32 c                   parm                    hirec
6.32 c                   parm                    horec
6.32  *
6.32 c                   eval      w_sapr = hosapr
6.32 c                   eval      w_ntpr = hosapr
6.32  *
6.32 c                   if        horab1 > 0
6.32 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab1 / 100)
6.32 c                   endif
6.32 c                   if        horab2 > 0
6.32 c                   eval(h)   w_ntpr = w_ntpr - (w_ntpr * horab2 / 100)
6.32 c                   endif
6.32  *
6.32 c                   eval      w_raba = horab1
6.32  *
6.32 c                   if        horab2 <> 0 and
6.32 c                             w_sapr <> 0
6.32 c                   eval(h)   w_raba = (w_sapr - w_ntpr) * 100 / w_sapr
6.32 c                   endif
6.32  *
6.32  * Henter GTIN
6.32  *
6.32 c                   call      'VE711R'
6.32 c                   parm                    w_firm
6.32 c                   parm                    vvvare
6.32 c                   parm                    w_enh1
6.32 c                   parm                    w_eann
6.32 c                   parm                    w_east
6.32  *
6.32  * Henter mva kode
6.32  *
6.32 c                   select
6.32 c                   when      vvkmva = 0
6.32 c                   eval      w_kmva = 'S'
6.32 c                   when      vvkmva = 1
6.32 c                   eval      w_kmva = 'E'
6.32 c                   when      vvkmva = 2
6.32 c                   eval      w_kmva = 'H'
6.32 c                   when      vvkmva = 3
6.32 c                   eval      w_kmva = 'AA'
6.32 c                   endsl
6.32  *
6.32  * Varegruppe
6.32  *
6.32 c                   eval      w_vgrp = vvogrp * 100000 +
6.32 c                                      vvhgrp * 1000 +
6.32 c                                      vvugrp
6.32  *
6.32  * URL produktbilde
6.32  *
6.32 c                   eval      w_murl = *blank
6.32  *
6.32 c                   eval      jvlml1_mvnr = vvvare
6.32 c                   eval      jvlml1_mldo = vvnlev
6.32 c                   eval      jvlml1_mtyp = 'PB'
6.32 c     jvlml1_key    chain     jvlml1
6.32 c                   if        %found
6.32 c                   eval      w_murl = jvmurl
6.32 c                   else
6.32 c     jvlml1_key2   setll     jvlml1
6.32 c     jvlml1_key2   reade     jvlml1
6.32 c                   dow       not %eof
6.32 c                   if        jvmtyp = 'PB'
6.32 c                   eval      w_murl = jvmurl
6.32 c                   leave
6.32 c                   endif
6.32 c     jvlml1_key2   reade     jvlml1
6.32 c                   enddo
6.32 c                   endif
6.32  *
6.32  * Skriver varekatalog-linje
6.32  *
6.32 c                   eval      w_linj = w_linj + 1
6.32  *
6.32 c                   eval      lq_rad = %trim(%editc(w_linj:'Z')) + ';"' +
6.32 c                             %trim(vvvare) + '";"' +
6.32 c                             'Ja' + '";"' +
6.32 c                             %trim(w_enh1) + '";' +
6.32 c                             %trim(%editc(w_ntpr:'4')) + ';"' +
6.32 c                             'NOK' + '";"' +
6.32 c                             %trim(%editc(w_eann:'Z')) + '";"' +
6.32 c                             %trim(w_unsp) + '";"' +
6.32 c                             %trim(%editc(w_vgrp:'Z')) + '";"' +
6.32 c                             %trim(w_utxt) + '";"' +
6.32 c                             %trim(vvtek1) + ' ' + %trim(vvtek2) + '";' +
6.32 c                             %trim(%editc(vvnobb:'Z')) + ';' +
6.32 c                             %trim(%editc(w_raba:'4')) + ';"' +
6.32 c                             %trim(w_kmva) + '";"' +
6.32 c                             '";"' + '";"' +
6.32 c                             %trim(w_murl) + '"'
6.32  *
6.32 c                   write     filqpfr
6.32  *
6.32 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine som henter gammelt varenummer for vare
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     gml_varenr    begsr
9.06  *
9.06 c                   eval      w_gvar = *blank
9.06 c                   if        vvavar <> *blank
9.06 c                   eval      w_gvar = vvavar
9.06 c                   leavesr
9.06 c                   endif
      *
      * Gammelt varenummer. Dersom varen kommer fra VA hentes eventuelt
      * eventuelt gammelt varenummer fra matche-registeret.
      *
     c                   eval      w_gvar = *blank
      *
     c                   if        vvvare >= '10000000' and
     c                             vvvare <  '90000000'
     c                   call      'FO710C'
     c                   parm                    w_firm
     c                   parm                    vvvare
     c                   parm                    w_gvar
     c                   endif
      *
     c                   endsr
6.24  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.24  * Subrutine for å hente sjekke om det finnes tilbud på varegr.nivå
6.24  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.24  *
6.24 c     tilb_sjekk    begsr
6.24  *
6.24 c                   if        b_till = *off
6.24 c                   eval      vtill1_ogrp = vvogrp
6.24 c                   eval      vtill1_hgrp = vvhgrp
6.24 c                   eval      vtill1_ugrp = vvugrp
6.24 c                   eval      vtill1_ldor = 0
6.24 c                   eval      vtill1_lety = 0
6.24 c                   eval      vtill1_vare = *blank
6.24 c                   exsr      hent_tilb
6.24 c                   endif
6.24  *  overgruppe,hovedgruppe
6.24 c                   if        b_till = *off
6.24 c                   eval      vtill1_ugrp = 0
6.24 c                   exsr      hent_tilb
6.24 c                   endif
6.24  *  overgruppe
6.24 c                   if        b_till = *off
6.24 c                   eval      vtill1_hgrp = 0
6.24 c                   exsr      hent_tilb
6.24 c                   endif
6.24  *  overgruppe,hovedgruppe,undergruppe, leverandør
6.24 c                   if        b_till = *off
6.24 c                   eval      vtill1_ogrp = vvogrp
6.24 c                   eval      vtill1_hgrp = vvhgrp
6.24 c                   eval      vtill1_ugrp = vvugrp
6.24 c                   eval      vtill1_ldor = w_pldo
6.24 c                   exsr      hent_tilb
6.24 c                   endif
6.24  *  overgruppe,hovedgruppe              leverandør
6.24 c                   if        b_till = *off
6.24 c                   eval      vtill1_ugrp = 0
6.24 c                   exsr      hent_tilb
6.24 c                   endif
6.24  *  overgruppe                          leverandør
6.24 c                   if        b_till = *off
6.24 c                   eval      vtill1_hgrp = 0
6.24 c                   exsr      hent_tilb
6.24 c                   endif
6.24  *  leverandør
6.24 c                   if        b_till = *off
6.24 c                   eval      vtill1_ogrp = 0
6.24 c                   exsr      hent_tilb
6.24 c                   endif
6.24 c                   endsr
6.22  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.22  * Subrutine for å hente tilbudspris på varegruppe/leverandørnivå
6.22  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
6.22  *
6.22 c     hent_tilb     begsr
6.22  *
6.22 c                   eval      b_till = *off
6.22 c     vtill1_key    setll     vtill1
6.22 c     vtill1_key    reade     vtill1                                 90
6.22 c                   dow       *in90 = *off
6.22 c                   if        p_dato >= vtfdat and
6.22 c                             p_dato <= vttdat
6.22  *
6.22 c                   eval      b_till = *on
6.22 c     *iso0         move      vttdat        w_dato_alf
6.22 c                   move      w_dato_alf    d_nobb_tdat
6.22  *
6.22 c                   leave
6.22  *
6.22 c                   endif
6.22 c     vtill1_key    reade     vtill1                                 90
6.22 c                   enddo
6.22  *
6.22 c                   endsr
      *
9.07  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
9.07  * Subrutine for å sjekke salgsenhet 1
9.07  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
9.07  *
9.07 c     sjekk_saen1   begsr
9.07  *
9.07 c                   eval      w_enhw = *blank
9.07  *
9.07 c                   eval      vvenl2_vare = vvvare
9.07 c                   eval      vvenl2_saen = 1
9.07 c     vvenl2_key    chain     vvenl2
9.07 c                   if        %found(vvenl2)
9.07 c                   eval      w_enhw = veenhe
9.07 c                   endif
9.07  * leser også vare for å få med alle felter
9.07 c                   eval      vvarl1_vare = vvvare
9.07 c     vvarl1_key    chain     vvarl1
9.07  *
9.07 c                   endsr
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_firm
     c                   parm                    p_kund
     c                   parm                    p_kpro
     c                   parm                    p_vsor
     c                   parm                    p_ogrp
     c                   parm                    p_hgrp
     c                   parm                    p_ugrp
     c                   parm                    p_ldor
     c                   parm                    p_rfmt
     c                   parm                    p_endr
     c                   parm                    p_dat2
     c                   parm                    p_sval
     c                   parm                    p_tval
     c                   parm                    p_2val
     c                   parm                    p_bval
     c                   parm                    p_lety
     c                   parm                    p_dato
     c                   parm                    p_lage
     c                   parm                    p_ftis
8.02 c                   parm                    p_nval
8.01 c                   parm                    p_lgln
      *
      * Key for oppslag på ofak-koderegister (statuskoder)
      *
     c     fstsl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for oppslag på kunderegister
      *
     c     rkunl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rkunl1_kund
      *
      * Key for oppslag på kundeprosjekt
      *
     c     fkprl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fkprl1_kund
     c                   kfld                    fkprl1_kpro
      *
      * Key for les på vareregister
      *
     c     vvarl9_key1   klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl9_ogrp
     c                   kfld                    vvarl9_hgrp
     c                   kfld                    vvarl9_ugrp
     c                   kfld                    vvarl9_ldor
      *
     c     vvarl9_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl9_ogrp
     c                   kfld                    vvarl9_hgrp
     c                   kfld                    vvarl9_ugrp
      *
     c     vvarl9_key3   klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl9_ogrp
     c                   kfld                    vvarl9_hgrp
      *
     c     vvarl9_key4   klist
     c                   kfld                    w_firm
     c                   kfld                    vvarl9_ogrp
      *
     c     vvarl9_key5   klist
     c                   kfld                    w_firm
      *
      * Key for les på vareregister  lev. først
      *
      *
     c     vvarla_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    vvarla_ldor
     c                   kfld                    vvarla_ogrp
     c                   kfld                    vvarla_hgrp
     c                   kfld                    vvarla_ugrp
      *
     c     vvarla_key3   klist
     c                   kfld                    w_firm
     c                   kfld                    vvarla_ldor
     c                   kfld                    vvarla_ogrp
     c                   kfld                    vvarla_hgrp
      *
     c     vvarla_key4   klist
     c                   kfld                    w_firm
     c                   kfld                    vvarla_ldor
     c                   kfld                    vvarla_ogrp
9.07  *
9.07 c     vvarl1_key    klist
9.07 c                   kfld                    w_firm
9.07 c                   kfld                    vvarl1_vare
      *
      * Key for les på vare-enhet-register m/prisbok-enhet
      *
     c     vvenl3_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvenl3_vare
     c                   kfld                    vvenl3_pben
      *
     c     vvenl3_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    vvenl3_vare
      *
      * Key for les på vare-enhet-register m/salgsenhet
      *
     c     vvenl2_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvenl2_vare
     c                   kfld                    vvenl2_saen
      *
     c     vvenl2_key2   klist
     c                   kfld                    w_firm
     c                   kfld                    vvenl2_vare
9.07  *
9.07 c     vvenl1_key    klist
9.07 c                   kfld                    w_firm
9.07 c                   kfld                    vvenl1_vare
9.07 c                   kfld                    vvenl1_enhe
      *
      * Key for oppslag på undergruppe-register
      *
     c     vugrl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vugrl1_uogr
     c                   kfld                    vugrl1_uhgr
     c                   kfld                    vugrl1_uugr
      *
      * Key for oppslag på priskode-register
      *
     c     vpkol1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vpkol1_pkod
      *
      * Key for oppslag på leverandør-register
      *
     c     rlevl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl1_levr
      *
      * Key for les på tilbuds-register
      *
     c     vtill1_key    klist
     c                   kfld                    w_firm
6.22 c                   kfld                    vtill1_ogrp
6.22 c                   kfld                    vtill1_hgrp
6.22 c                   kfld                    vtill1_ugrp
6.22 c                   kfld                    vtill1_ldor
     c                   kfld                    vtill1_vare
5.70 c                   kfld                    vtill1_prgr
     c                   kfld                    vtill1_lety
      *
      * Key for oppdatering av kunde-distribusjonsliste
      *
     c     fkdilu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fkdilu_kund
     c                   kfld                    fkdilu_kpro
      *
      * Key for les på vare-pris-register
      *
     c     vvprl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vvprl1_vare
6.20 c                   kfld                    vvprl1_ldor
5.70 c                   kfld                    vvprl1_prgr
     c                   kfld                    vvprl1_enhe
     c                   kfld                    vvprl1_lety
      *
      * Key for oppslag på firmaregister
      *
     c     afirl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for les på generert feltbasert vare/prisfil
      *
     c     fipxl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fipxl1_kund
     c                   kfld                    fipxl1_sort
     c                   kfld                    fipxl1_vare
      *
      * Key for oppdat. på generert feltbasert vare/prisfil
      *
     c     fipxlu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fipxlu_kund
     c                   kfld                    fipxlu_sort
     c                   kfld                    fipxlu_vare
      *
      * Key for oppslag på varesortiment-hode
      *
     c     vshel1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    vshel1_vsor
6.15  *
6.15  * Key for oppslag på vare fra VA
6.15  *
6.15 c     jvarl1_key    klist
6.15 c                   kfld                    jvarl1_vare
      *
6.32  * Key for oppslag på Vare leverandør media VA
6.32  *
6.32 c     jvlml1_key    klist
6.32 c                   kfld                    jvlml1_mvnr
6.32 c                   kfld                    jvlml1_mldo
6.32 c                   kfld                    jvlml1_mtyp
      *
6.32 c     jvlml1_key2   klist
6.32 c                   kfld                    jvlml1_mvnr
8.01  *
8.01  * Key for oppslag på logistikkpunkt
8.01  *
8.01 c     mjlol2_key    klist
8.01 c                   kfld                    w_firm
8.01 c                   kfld                    mjlol2_eann
8.01  *
8.01  * Key for oppslag på lager
8.01  *
8.01 c     vlagl1_key    klist
8.01 c                   kfld                    w_firm
8.01 c                   kfld                    vlagl1_vare
8.01 c                   kfld                    vlagl1_lage
      *
      * Splitter datastruktur i variable
      *
     c                   eval      w_firm = p_firm
      *
     c     *ymd          move      p_dato        w_dato_ymd
     c     *iso0         move      p_dato        w_dato_alf
     c                   move      w_dato_alf    w_dato_iso0
      *
      * Henter dagens dato
      *
6.20 c                   time                    w_ddat
8.03  * Denne er flyttet, da det overstyrte evnt lager til GLN
5.70 c                   if        p_lage <> 0
5.70 c                   eval      w_lage = p_lage
5.70 c                   else
5.70 c                   eval      w_lage = l_lage
5.70 c                   endif
8.01  *
8.01  * Sjekk om det er prisliste tilnyttet lager
8.01  *
8.01 c                   if        p_lage = 0  and
8.01 c                             p_lgln <> 0
8.01 c                   eval      mjlol2_eann = p_lgln
8.01 c     mjlol2_key    chain     mjlol2
8.01 c                   if        %found
8.01 c                   eval      w_lage = mjlage
8.01 c                   eval      vlagl1_lage = mjlage
8.01 c                   endif
8.01 c                   endif
6.15  *
6.15  * overskrift på iBX format
6.15  *
6.15 c                   if        p_rfmt = 'IBX'
6.15 c                   eval      d_bxo_nob = 'Vendor Product No  '
6.15 c                   eval      d_bxo_tx1 = 'Product Name       '
6.15 c                   eval      d_bxo_ltx = 'Product Description'
6.15 c                   eval      d_bxo_enh = 'Unit'
6.15 c                   eval      d_bxo_lti = 'Lead Time'
6.15 c                   eval      d_bxo_uns = 'UNSPSC'
6.15 c                   eval      d_bxo_ost = 'Minimum Order Quantity'
6.15 c                   eval      d_bxo_int = 'Lot Size'
6.15 c                   eval      d_bxo_sap = 'Price'
6.15 c                   eval      d_bxo_val = 'Currency'
6.15 c                   eval      d_bxo_mva = 'Buyer-Specific Field-13'
6.15 c                   eval      d_bxo_ris = 'Buyer-Specific Field-14'
6.15 c                   eval      d_bxo_hms = 'Buyer-Specific Field-15'
6.15 c                   eval      bx_rad = d_bxo
6.15 c                   write     fibxpfr
6.15 c                   endif
5.70  *
5.70  * Henter prisgruppe
5.70  *
5.70 c                   eval      w_avde = 0
5.70 c                   call      'VL712R   '
5.70 c                   parm                    w_firm
5.70 c                   parm                    w_lage
5.70 c                   parm                    w_avde
5.70 c                   parm                    w_prgr
      *
     c                   endsr
