# Program Documentation: FX820R (ASOFAK FIX)

## Overview

**System:** ASOFAK  
**Program:** FX820R  
**Description:**  
This program updates the "alternative product group" fields in the product master files. Specifically, it copies the main group (`vvhgrp`) and subgroup (`vvugrp`) fields to their corresponding alternative fields (`vvahgr`, `vvaugr`) for all records in both the active product register and the deleted product register.

This is a batch update utility, typically run as a one-off or as part of a data consistency/cleanup operation.

---

## Business Context

- **Product Grouping:**  
  Products are categorized into main groups and subgroups. There exist parallel fields for "alternative" grouping, possibly for secondary categorization, legacy support, or migration purposes.
- **Data Sources:**  
  - **Active Product Register:** Physical file `VVARPFR` (renamed as `VVARLUR` in this program)
  - **Deleted Product Register:** Physical file `VVASPFR` (renamed as `VVASLUR` in this program)
- **Tracking:**  
  The program updates tracking/audit fields: date (`vvedat`), time (`vvetim`), and user (`vveusr`) upon each record update.

---

## File Definitions

```rpg
fvvarlu    uf   e           k disk    rename(vvarpfr:vvarlur)
fvvaslu    uf   e           k disk    rename(vvaspfr:vvaslur)
```
- `vvarlur`: Active product register (logical or physical file)
- `vvaslur`: Deleted product register (logical or physical file)
- Both files are processed sequentially for all records.

---

## LDA (Local Data Area) Usage

```rpg
d                uds
6.10 d l_user                911    920
d l_firm                944    946  0
```
- **l_user:** User ID running the program, used for audit purposes.
- **l_firm:** Company code, loaded into local variable `w_firm` during initialization.

---

## Main Logic

### 1. Update Active Product Register

- **Loop:** Reads every record in `vvarlur`.
- **Update:**  
  - Copies `vvhgrp` (main group) to `vvahgr` (alternative main group).
  - Copies `vvugrp` (subgroup) to `vvaugr` (alternative subgroup).
  - Sets audit fields:  
    - `vvedat`: Current date (timestamp)
    - `vvetim`: Current time (timestamp)
    - `vveusr`: User from LDA
  - Updates the record.

### 2. Update Deleted Product Register

- **Loop:** Reads every record in `vvaslur`.
- **Update:**  
  - Same field updates and audit logic as for active register.

---

## Program Structure

1. **Initialization (`*inzsr`):**
   - Loads company code from LDA into `w_firm` (not used further in this program, but may be a convention for future extensions or logging).

2. **Main Processing:**
   - Sequentially processes active then deleted product registers, updating group fields and audit info.

3. **Termination:**
   - Sets LR indicator (`*inlr = *on`) to close files and end the program cleanly.

---

## Notable Design Decisions & Conventions

- **Field Renaming:**  
  Files are renamed upon declaration to allow for local naming conventions and possibly for compatibility with multiple environments or file versions.
- **Audit Trail:**  
  Every update sets the date, time, and user fields, ensuring traceability of changes.
- **Batch Processing:**  
  No selection or filtering; every record is updated. This assumes all records must have their alternative group fields synchronized with the main group fields.
- **LDA Usage:**  
  User and firm information are retrieved from the LDA, a common convention in this system for user context and multi-company support.
- **No Error Handling:**  
  The program assumes all reads and updates succeed; error handling is likely managed at a higher level or considered unnecessary for this batch utility.

---

## Interactions with Other Modules

- **Data Files:**  
  The program directly updates the product master files. Any downstream processes or reports relying on the alternative group fields will see the updated values after this program runs.
- **Audit/Tracking:**  
  If there are audit logs or triggers on the product files, those may be activated by these updates.

---

## Summary Table

| File      | Description                  | Fields Updated         |
|-----------|------------------------------|------------------------|
| vvarlur   | Active product register      | vvahgr, vvaugr, vvedat, vvetim, vveusr |
| vvaslur   | Deleted product register     | vvahgr, vvaugr, vvedat, vvetim, vveusr |

---

## Typical Use Case

- Data migration or cleanup to ensure all products (active and deleted) have their alternative group fields synchronized with their primary group fields.
- May be scheduled as part of a maintenance window or executed manually by operations.

---

## Revision History

- **150200 HKO:** Initial version.
- **290609 BSA (v6.10):** Added tracking information (audit fields).

---

## Conclusion

This program is a straightforward batch utility for synchronizing alternative product group fields across both active and deleted product registers, ensuring consistency and auditability in the ASOFAK system. It follows established conventions for file handling, audit tracking, and LDA usage within this codebase.