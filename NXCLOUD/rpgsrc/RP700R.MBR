     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Inputrecord:
      * prosjnr.  Felt      Ny verdi
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fxl_prosj  up   f  512        disk
     frpxllu    uf a e           k disk    rename(rpxlpfr:rpxllur)
     frp1pl1    if   e           k disk    rename(rp1ppfr:rp1pl1r)
     frp2ul1    if   e           k disk    rename(rp2upfr:rp2ul1r)
     frp3al1    if   e           k disk    rename(rp3apfr:rp3al1r)
     frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
     filonl1    if   e           k disk    rename(ilonpfr:ilonl1r)
     fra07l1    if   e           k disk    rename(ra07pfr:ra07l1r)
6.34 fra09l1    if   e           k disk    rename(ra09pfr:ra09l1r)
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
     d l_filg                931    933
     d l_firm                944    946  0
     d l_fnav                951    980
      *
     d Lo              c                   'abcdefghijklmnopqrstuvwxyzæøå'
     d Up              c                   'ABCDEFGHIJKLMNOPQRSTUVWXYZÆØÅ'
      *
      * Definering av variabler i nøkler
      *
     d rpxllu_pros     s                   like(rp1pro)
     d rpxllu_upro     s                   like(rp2upr)
     d rpxllu_akti     s                   like(rp3akt)
      *
     d rp1pl1_pros     s                   like(rp1pro)
      *
     d rp2ul1_pros     s                   like(rp1pro)
     d rp2ul1_upro     s                   like(rp2upr)
      *
     d rp3al1_pros     s                   like(rp1pro)
     d rp3al1_upro     s                   like(rp2upr)
     d rp3al1_akti     s                   like(rp3akt)
      *
     d rkunl1_firm     s                   like(rkfirm)
     d rkunl1_kund     s                   like(rkkund)
      *
     d ilonl1_kli      s                   like(ilrkli)
     d ilonl1_lnr      s                   like(ilrlnr)
      *
6.34 d ra09l1_fir      s                   like(raifir)
6.34 d ra09l1_kod      s                   like(raikod)
      *
     d ra07l1_frm      s                   like(ragfir)
     d ra07l1_kod      s                   like(ragkod)
      *
      * Definering av variable
      *
     d i               s              3  0
     d j               s              3  0
     d d_ppro          s              6
     d d_ptxt          s             30
     d d_ptx2          s             30
     d d_pfra          s             10
     d d_ptil          s             10
     d d_pprl          s              5
     d d_pavd          s              4
     d d_pknr          s              6
     d d_pBin          s             13
     d d_pbut          s             13
     d d_ptyp          s              1
     d d_psta          s              1
     d d_pupr          s              1
     d d_pakt          s              1
     d d_uupr          s              6
     d d_utxt          s             30
     d d_utx2          s             30
     d d_ufra          s             10
     d d_util          s             10
     d d_uprl          s              5
     d d_uavd          s              4
     d d_uknr          s              6
     d d_ukrf          s             30
     d d_utlf          s             15
     d d_uepo          s             60
     d d_uBin          s             13
     d d_ubut          s             13
     d d_uakt          s              1
     d d_usta          s              1
     d d_aakt          s              6
     d d_atxt          s             30
     d d_atx2          s             30
     d d_afra          s             10
     d d_atil          s             10
     d d_aprl          s              5
     d d_aavd          s              4
     d d_aknr          s              6
     d d_akrf          s             30
     d d_atlf          s             15
     d d_aepo          s             60
     d d_aBin          s             13
     d d_abut          s             13
     d d_asta          s              1
      *
     d w_feil          s            100
     d w_rec           s            512
     d w_firm          s                        like(rp1frm)
     d w_feildato      s              1         inz(*off)
     d w_dx            s             10
     d w_dat           s              6  0
     d w_dax           s              6
     d w_iso           s               d        datfmt(*iso)
     d w_prlslg        s              1         inz('S')
      *
     IXL_Prosj  ns  01
     I                                  1  512  prosj
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  NBNBNBNBNBNB!!!!!!!!!!
     c                   if        %subst(prosj:1:5) = ';;;;;'    or
     c                             %subst(prosj:1:8) = 'PROSJEKT' or
     c                             %subst(prosj:1:8) = 'Prosjekt'
     c                   goto      end
     c                   endif
     c                   eval      i = %scan('            ':prosj)
     c                   eval      %subst(prosj:i:5) = ';;;;;'
     c                   eval      w_rec = prosj
      * Æ,Ø,Å
     c                   eval      prosj = %xlate(x'77':'Ø':prosj)
     c                   eval      prosj = %xlate(x'2A':'Å':prosj)
     c                   eval      prosj = %xlate(x'46':'Æ':prosj)
     c                   eval      prosj = %xlate(x'EF':'å':prosj)
     c                   eval      prosj = %xlate(x'90':'ø':prosj)
     c                   eval      prosj = %xlate(x'A0':'æ':prosj)
      *  Dummy '>'  Dette var bare i starten for å unngå headinglinjer
      *             Disse ble borte når jeg fjernet " mellom feltene
     c*                  eval      i = %scan(';':prosj)
     c*                  eval      prosj  = %subst(prosj:i+1:512-i)
      *
      *  prosjektnummer
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_ppro = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
     c*                  eval      w_kund = %int(%trim(d_kund))
      *  prosjekt tekst 1
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_ptxt = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  prosjekt tekst 2
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_ptx2 = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Start dato
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_pfra = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Slutt dato
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_ptil = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Prosjektleder
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_pprl = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Avdeling
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_pavd = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Kundenummer
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_pknr = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Budsjetterte inntekter
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_pbin = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  budsjetterte utgifter
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_pbut = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Prosjekttype
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_ptyp = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Status
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_psta = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Bruke underprosjekt
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_pupr = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Bruke Aktivitet
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_pakt = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *
      *  Dummy, skift mellom prosejkt og underprosjekt
     c                   eval      i = %scan(';':prosj)
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  ________________________________________________________________
      *
      *  Underprosjektnummer
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_uupr = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Underprosjekt tekst 1
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_utxt = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Underprosjekt tekst 2
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_utx2 = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Start dato
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_ufra = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Slutt dato
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_util = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Prosjektleder
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_uprl = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Avdeling
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_uavd = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Kundenummer
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_uknr = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Kundens ref.
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_ukrf = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Telefon
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_utlf = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Mail adresse
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_uepo = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Budsjetterte inntekter
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_ubin = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  budsjetterte utgifter
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_ubut = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Bruke Aktivitet
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_uakt = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Status
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_usta = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *
      *  Dummy, skift mellom underprosjekt og aktivitet
     c                   eval      i = %scan(';':prosj)
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  ________________________________________________________________
      *
      *  Aktivitet
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_aakt = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Aktivetet tekst 1
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_atxt = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Aktivitet tekst 2
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_atx2 = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Start dato
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_afra = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Slutt dato
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_atil = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Prosjektleder
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_aprl = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Avdeling
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_aavd = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Kundenummer
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_aknr = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Kundens ref.
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_akrf = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Telefon
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_atlf = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Mail adresse
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_aepo = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Budsjetterte inntekter
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_abin = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  budsjetterte utgifter
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_abut = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  Status
     c                   eval      i = %scan(';':prosj)
     c                   eval      d_asta = %trim(%subst(prosj:1:i-1))
     c                   eval      prosj  = %subst(prosj:i+1:512-i)
      *  ________________________________________________________________
      *
      *  Sjekk om Prosjekt, underprosjekt eller aktivitet finnes fra før
      *
     c                   eval      w_feil = *blank
     c                   eval      rp1pl1_pros = d_ppro
     c     rp1pl1_key    chain     rp1pl1
     c                   if        %found(rp1pl1)
     c                   eval      w_feil = 'P1'
     c                   endif
      *
     c                   eval      rp2ul1_pros = d_ppro
     c                   eval      rp2ul1_upro = d_uupr
     c     rp2ul1_key    chain     rp2ul1
     c                   if        %found(rp2ul1)
     c                   eval      w_feil = %trim(w_feil) + ',P2'
     c                   endif
      *
     c                   eval      rp3al1_pros = d_ppro
     c                   eval      rp3al1_upro = d_uupr
     c                   eval      rp3al1_akti = d_aakt
     c     rp3al1_key    chain     rp3al1
     c                   if        %found(rp3al1)
     c                   eval      w_feil = %trim(w_feil) + ',P3'
     c                   endif
      *  ________________________________________________________________
      *  Prosjekt fra dato
     c                   eval      w_dx = d_pfra
     c                   exsr      testdato
     c                   if        w_feildato = *on
     c                   eval      w_feil = %trim(w_feil) + ',P4'
     c                   else
     c                   move      w_iso         d_pfra
     c                   endif
      *  ________________________________________________________________
      *  Prosjekt til dato
     c                   eval      w_dx = d_ptil
     c                   exsr      testdato
     c                   if        w_feildato = *on
     c                   eval      w_feil = %trim(w_feil) + ',P5'
     c                   else
     c                   move      w_iso         d_ptil
     c                   endif
      *  ________________________________________________________________
      *  Prosjektleder
     c                   if        d_pprl <> *blank
6.34 c                   if        w_PrlSlg = 'P'
     c                   eval      ilonl1_kli  = l_firm
     c                   eval      ilonl1_lnr  = %int(%trim(d_pprl))
     c     ilonl1_key    chain     ilonl1
     c                   if        not %found(ilonl1)
     c                   eval      w_feil = %trim(w_feil) + ',P6'
     c                   endif
6.34 c                   else
6.34 c                   eval      ra09l1_fir  = l_firm
6.34 c                   eval      ra09l1_kod  = %int(%trim(d_pprl))
6.34 c     ra09l1_key    chain     ra09l1
6.34 c                   if        not%found(ra09l1)
     c                   eval      w_feil = %trim(w_feil) + ',P6'
6.34 c                   endif
6.34 c                   endif
     c                   else
     c                   eval      w_feil = %trim(w_feil) + ',P6'
     c                   endif
      *  ________________________________________________________________
      *  Avdeling
     c                   eval      ra07l1_kod  = %int(%trim(d_pavd))
     c     ra07l1_key    chain     ra07l1
     c                   if        not %found(ra07l1)
     c                   eval      w_feil = %trim(w_feil) + ',P7'
     c                   endif
      *  ________________________________________________________________
      *  Kundenr
     c                   eval      rkunl1_firm = *zero
     c                   eval      rkunl1_kund = %int(%trim(d_pknr))
     c     rkunl1_key    chain     rkunl1
     c                   if        not %found(rkunl1)
     c                   eval      w_feil = %trim(w_feil) + ',P8'
     c                   endif
      *  ________________________________________________________________
      *  Prosjekttype
     c                   if        d_ptyp <> 'K'
     c                             and d_ptyp <> 'I'
     c                   eval      w_feil = %trim(w_feil) + ',P9'
     c                   endif
      *  ________________________________________________________________
      *  Status
     c                   if        d_psta <> ' '
     c                             and d_psta <> 'A'
     c                   eval      w_feil = %trim(w_feil) + ',P10'
     c                   endif
      *  ________________________________________________________________
      *  Deles i Underprosjekt
     c                   if        d_pupr <> ' '
     c                             and d_pupr <> 'J'
     c                   eval      w_feil = %trim(w_feil) + ',P11'
     c                   endif
      *  ________________________________________________________________
      *  Deles i Aktivitet
     c                   if        d_pakt <> ' '
     c                             and d_pakt <> 'J'
     c                   eval      w_feil = %trim(w_feil) + ',P12'
     c                   endif
      *  ________________________________________________________________
      *  ==========================  Underprosjekt  =====================
      *  ________________________________________________________________
      *  Under Prosjekt fra dato
     c                   if        d_ufra <> *blank
     c                   eval      w_dx = d_ufra
     c                   exsr      testdato
     c                   if        w_feildato = *on
     c                   eval      w_feil = %trim(w_feil) + ',U4'
     c                   else
     c                   move      w_iso         d_ufra
     c                   endif
     c                   endif
      *  ________________________________________________________________
      *  Under Prosjekt til dato
     c                   if        d_util <> *blank
     c                   eval      w_dx = d_util
     c                   exsr      testdato
     c                   if        w_feildato = *on
     c                   eval      w_feil = %trim(w_feil) + ',U5'
     c                   else
     c                   move      w_iso         d_util
     c                   endif
     c                   endif
      *  ________________________________________________________________
      *  Prosjektleder
     c                   if        d_uprl <> *blank
6.34 c                   if        w_PrlSlg = 'P'
     c                   eval      ilonl1_kli  = l_firm
     c                   eval      ilonl1_lnr  = %int(%trim(d_uprl))
     c     ilonl1_key    chain     ilonl1
     c                   if        not %found(ilonl1)
     c                   eval      w_feil = %trim(w_feil) + ',U6'
     c                   endif
6.34 c                   else
6.34 c                   eval      ra09l1_fir  = l_firm
6.34 c                   eval      ra09l1_kod  = %int(%trim(d_uprl))
6.34 c     ra09l1_key    chain     ra09l1
6.34 c                   if        not%found(ra09l1)
     c                   eval      w_feil = %trim(w_feil) + ',U6'
6.34 c                   endif
6.34 c                   endif
6.34 c                   endif
      *  ________________________________________________________________
      *  Avdeling
     c                   if        d_Uavd <> *blank
     c                   eval      ra07l1_kod  = %int(%trim(d_Uavd))
     c     ra07l1_key    chain     ra07l1
     c                   if        not %found(ra07l1)
     c                   eval      w_feil = %trim(w_feil) + ',U7'
     c                   endif
     c                   endif
      *  ________________________________________________________________
      *  Kundenr
     c                   if        d_Uknr <> *blank
     c                   eval      rkunl1_firm = *zero
     c                   eval      rkunl1_kund = %int(%trim(d_uknr))
     c     rkunl1_key    chain     rkunl1
     c                   if        not %found(rkunl1)
     c                   eval      w_feil = %trim(w_feil) + ',U8'
     c                   endif
     c                   endif
      *  ________________________________________________________________
      *  Status
     c                   if        d_usta <> ' '
     c                             and d_usta <> 'A'
     c                   eval      w_feil = %trim(w_feil) + ',U10'
     c                   endif
      *  ________________________________________________________________
      *  Deles i Aktivitet
     c                   if        d_uakt <> ' '
     c                             and d_uakt <> 'J'
     c                   eval      w_feil = %trim(w_feil) + ',U12'
     c                   endif
      *  ________________________________________________________________
      *  ==========================  Aktivitet   ========================
      *  ________________________________________________________________
      *  Aktivitet fra dato
     c                   if        d_afra <> *blank
     c                   eval      w_dx = d_afra
     c                   exsr      testdato
     c                   if        w_feildato = *on
     c                   eval      w_feil = %trim(w_feil) + ',A4'
     c                   else
     c                   move      w_iso         d_afra
     c                   endif
     c                   endif
      *  ________________________________________________________________
      *  Aktivitet til dato
     c                   if        d_atil <> *blank
     c                   eval      w_dx = d_atil
     c                   exsr      testdato
     c                   if        w_feildato = *on
     c                   eval      w_feil = %trim(w_feil) + ',A5'
     c                   else
     c                   move      w_iso         d_atil
     c                   endif
     c                   endif
      *  ________________________________________________________________
      *  Prosjektleder
     c                   if        d_aprl <> *blank
6.34 c                   if        w_PrlSlg = 'P'
     c                             and d_aprl <> *blank
     c                   eval      ilonl1_kli  = l_firm
     c                   eval      ilonl1_lnr  = %int(%trim(d_aprl))
     c     ilonl1_key    chain     ilonl1
     c                   if        not %found(ilonl1)
     c                   eval      w_feil = %trim(w_feil) + ',A6'
     c                   endif
6.34 c                   else
6.34 c                   eval      ra09l1_fir  = l_firm
6.34 c                   eval      ra09l1_kod  = %int(%trim(d_aprl))
6.34 c     ra09l1_key    chain     ra09l1
6.34 c                   if        not%found(ra09l1)
     c                   eval      w_feil = %trim(w_feil) + ',A6'
6.34 c                   endif
6.34 c                   endif
6.34 c                   endif
      *  ________________________________________________________________
      *  Avdeling
     c                   if        d_aavd <> *blank
     c                   eval      ra07l1_kod  = %int(%trim(d_aavd))
     c     ra07l1_key    chain     ra07l1
     c                   if        not %found(ra07l1)
     c                   eval      w_feil = %trim(w_feil) + ',A7'
     c                   endif
     c                   endif
      *  ________________________________________________________________
      *  Kundenr
     c                   if        d_aknr <> *blank
     c                   eval      rkunl1_firm = *zero
     c                   eval      rkunl1_kund = %int(%trim(d_aknr))
     c     rkunl1_key    chain     rkunl1
     c                   if        not %found(rkunl1)
     c                   eval      w_feil = %trim(w_feil) + ',A8'
     c                   endif
     c                   endif
      *  ________________________________________________________________
      *  Status
     c                   if        d_asta <> ' '
     c                             and d_asta <> 'A'
     c                   eval      w_feil = %trim(w_feil) + ',A10'
     c                   endif
      *
     c                   time                    d_dato
     c                   eval      d_user = l_user
     c                   eval      d_feil = w_feil
      *
     c                   write     rpxllur
      *
      * _________________________________________________________________
      *
     c                   eval      i = %scan('           ':w_rec)
     c                   eval      w_rec = %subst(w_rec:1:i) + ';' +
     c                                     %trim(w_Feil)
     c                   eval      prosj = w_rec
     c                   except    xl_upd
      *
      *
     c     end           tag
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for test av dato
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     c     testdato      begsr
     c
      *  Er dato av format 'ddmmåå eller ååmmdd'?
     c                   select
     c                   when      %subst(w_dx:7:4) = *blank
     c                   if        %subst(w_dx:6:5) = *blank
     c                   eval      w_dat = %int(%trim(%subst(w_dx:1:5)))
     c                   else
     c                   eval      w_dat = %int(%trim(%subst(w_dx:1:6)))
     c                   endif
      *    Format ddmmyy eller yymmdd
     c     *dmy          test (d)                w_dat                  41
     c                   if        *in41 = *off
     c     *dmy          move      w_dat         w_iso
     c                   else
     c     *ymd          test (d)                w_dat                  41
     c                   if        *in41 = *off
     c     *ymd          move      w_dat         w_iso
     c                   else
     c                   eval      w_feildato = *on
     c                   endif
     c                   endif
     c                   leavesr
      *
     c     format_2      tag
      *  Er dato av format 'dd.mm.åå eller dd-mm-åå'?
     c                   when      %subst(w_dx:9:2) = *blank
     c                             and %subst(w_dx:7:2) > '17'
     c                             and %subst(w_dx:7:2) < '40'
     c                             and %subst(w_dx:1:2) < '32'
     c                             and (%subst(w_dx:3:1) = '.'
     c                              or  %subst(w_dx:3:1) = '-')
     c                   eval      w_dax = %subst(w_dx:1:2) +
     c                                     %subst(w_dx:4:2) +
     c                                     %subst(w_dx:7:2)
     c                   eval      w_dat = %int(w_dax)
     c     *dmy          test (d)                w_dat                  41
     c                   if        *in41 = *off
     c     *dmy          move      w_dat         w_iso
     c                   else
     c                   eval      w_feildato = *on
     c                   endif
     c                   leavesr
      *  __________________________________________________________________
      *  Er dato av format 'dd.mm.åååå eller dd-mm-åååå'?
     c                   when      %subst(w_dx:9:2) <> *blank
     c                             and %subst(w_dx:7:4) > '2000'
     c                             and %subst(w_dx:7:4) < '2040'
     c                             and (%subst(w_dx:3:1) = '.'
     c                              or  %subst(w_dx:3:1) = '-')
     c                   eval      w_dax = %subst(w_dx:1:2) +
     c                                     %subst(w_dx:4:2) +
     c                                     %subst(w_dx:9:2)
     c                   eval      w_dat = %int(w_dax)
     c     *dmy          test (d)                w_dat                  41
     c                   if        *in41 = *off
     c     *dmy          move      w_dat         w_iso
     c                   else
     c                   eval      w_feildato = *on
     c                   endif
     c                   leavesr
      *  __________________________________________________________________
      *  Er dato av format 'åååå.mm.dd eller åååå-mm-dd'?
     c                   when      %subst(w_dx:9:2) <> *blank
     c                             and %subst(w_dx:1:4) > '2000'
     c                             and %subst(w_dx:1:4) < '2040'
     c                             and (%subst(w_dx:5:1) = '.'
     c                              or  %subst(w_dx:5:1) = '-')
     c                   eval      w_dax = %subst(w_dx:9:2) +
     c                                     %subst(w_dx:6:2) +
     c                                     %subst(w_dx:3:2)
     c                   eval      w_dat = %int(w_dax)
     c     *dmy          test (d)                w_dat                  41
     c                   if        *in41 = *off
     c     *dmy          move      w_dat         w_iso
     c                   else
     c                   eval      w_feildato = *on
     c                   endif
     c                   leavesr
      *
     c                   other
     c                   goto      format_2
     c                   eval      w_feildato = *on
     c                   endsl
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for posisjonering på prosj
      *
     c     rkunl1_key    klist
     c                   kfld                    rkunl1_firm
     c                   kfld                    rkunl1_kund
      *
     c     rp1pl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rp1pl1_pros
      *
     c     rp2ul1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rp2ul1_pros
     c                   kfld                    rp2ul1_upro
      *
     c     rp3al1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rp3al1_pros
     c                   kfld                    rp3al1_upro
     c                   kfld                    rp3al1_akti
      *
      * Key for oppslag på Prosjektleder
      *
     c     ilonl1_key    klist
     c                   kfld                    ilonl1_kli
     c                   kfld                    ilonl1_lnr
6.34  *
6.34  * Key for oppslag på Selger
6.34  *
6.34 c     ra09l1_key    klist
6.34 c                   kfld                    ra09l1_fir
6.34 c                   kfld                    ra09l1_kod
      *
      * Key for oppslag på avdeling
      *
     c     ra07l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ra07l1_kod
      *
     c                   eval      w_firm = l_firm
      *
     c                   endsr
      *
     oxl_prosj  E            xl_upd
     o                       prosj
