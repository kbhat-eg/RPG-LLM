# LL600R – Inventory List Print Parameters

## Overview

**LL600R** is a parameter handling program for the inventory list report ("Utskrift av varebeholdningsliste"). Its main function is to present a selection screen to the user, validate the selection criteria, and prepare a parameter string for downstream processing. This program is typically invoked as the first step in the inventory list reporting workflow, gathering and validating all user input before the actual report generation.

## Structure and Flow

### 1. File Declarations

- **rlevl1** and **ra26l1**: Logical files over supplier (`rlevpfr`) and buyer/handler (`ra26pfr`) master tables. Used for validation of supplier and handler codes.
- **ll600d**: Display file for the selection screen (workstation file).

### 2. Data Areas and Variables

- **Local Data Area**: Used to retrieve company number (`l_firm`) and company name (`l_fnav`).
- **Parameter Data Structure (`p_prec`)**: 128-byte structure containing all selection criteria, overlayed with individual fields for each parameter (from/to item, warehouse, groupings, supplier, handler, sort order, etc.).
- **Working Variables**: For company number, field texts, parameter string, etc.

### 3. Indicator Usage

- **KC**: F3=Exit
- **LR**: End of program
- **30-59**: Screen/validation indicators
- **70-79**: Work indicators in subroutines
- **80-89**: General work indicators
- **90-99**: File indicators (chain status, etc.)

### 4. Main Processing Logic

#### Selection Screen Loop

- **a1taga**: Main input loop.
  - Presents the parameter screen (`exfmt a1bld`).
  - Handles function keys:
    - **F3 (Exit)**: Sets return code and exits.
    - **F4 (Inquiry)**: Invokes the `sp_input` subroutine for lookups based on the active field.
  - **Validations**:
    - Ensures "from" values are not greater than "to" values for all ranges (item, warehouse, groups).
    - Validates supplier and handler codes via keyed lookup.
    - Checks that sort order and break type are within allowed values.
    - Sets corresponding error indicators for the screen if validation fails.
  - If all validations pass, copies input values to the parameter structure (`p_prec`) and exits.

#### Subroutine: `sp_input` (Inquiry)

- Handles F4 lookups for all fields on the selection screen.
- Calls external programs for lookups:
  - **VV500R**: Item master
  - **VG510R**: Overgroup register
  - **VG511R**: Main group register
  - **VG512R**: Subgroup register
  - **RA510R**: Warehouse register
  - **RL500R**: Supplier register
  - **RA526R**: Handler/purchaser register
- Each call passes the company number and relevant field, and retrieves the description for display.

#### Subroutine: `*inzsr` (Initialization)

- Sets up key lists for supplier and handler validation.
- Retrieves entry parameters (return code and parameter string).
- Initializes all selection criteria to their default values (full ranges).
- Retrieves company number from the local data area.

### 5. Parameter Passing

- On successful completion, the program populates a 128-byte parameter string (`w_parm`), containing all validated selection criteria, for use by subsequent report processing programs.

## Business/Domain Logic

- The program is tightly coupled to the inventory reporting process, enforcing all business rules for valid selection criteria.
- It supports filtering by item number, warehouse, groupings (overgroup, main group, sub group), supplier, handler, sort order, and break type.
- All range fields are validated to ensure logical "from" and "to" relationships.
- Supplier and handler codes must exist in their respective master files.
- Sort order and break type are restricted to allowed values (1–5 for sort, 0–1 for break).

## Interactions with Other Modules

- **External Programs**: For F4 lookups, the program calls a set of inquiry programs (VV500R, VG510R, etc.), which are responsible for returning valid codes and descriptions for the selection fields.
- **Master Files**: Validates supplier and handler codes against their master tables via direct keyed access.
- **Downstream Processing**: The parameter string output is intended for use by the report generation program, ensuring all necessary criteria are passed in a validated, consistent format.

## Notable Design Decisions & Conventions

- **Parameter Overlay**: Uses a single 128-byte structure with overlays for each field, simplifying parameter passing to downstream programs.
- **Screen Indicator Usage**: Error and status indicators are mapped to specific screen fields for user feedback, following a clear convention.
- **Inquiry Subroutine**: Centralized handling of all F4 lookups, making it easy to maintain and extend.
- **Default Ranges**: On entry, all selection ranges are initialized to their widest values, ensuring that the default report includes all data unless restricted by the user.
- **Localization**: Variable and comment text is in Norwegian, reflecting the business context and user base.

## Summary

LL600R is a parameter entry and validation module for inventory list reporting. It ensures that all user selections are valid, provides lookup assistance, and prepares a validated parameter structure for downstream reporting. Its design emphasizes robustness, user guidance, and integration with the broader inventory management solution.