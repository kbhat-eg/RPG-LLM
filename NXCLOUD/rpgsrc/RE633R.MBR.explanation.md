# RPG Program Explanation: RE633R – "Inntasting av brukerid" (User ID Input)

This RPG program is designed to handle the input and validation of a user ID, likely as part of a sign-on or user validation routine. Here is a breakdown of the main sections and logic:

---

## **File Declarations**

```rpg
fre633d    cf   e             workstn
fausrl1    if   e           k disk    rename(ausrpfr:ausrl1r)
```
- `re633d` — A workstation file for display I/O (screen).
- `ausrl1` — A physical file (likely "user register"), opened for input, keyed access, and externally described. It's renamed internally for use in the program.

---

## **Main Logic**

### Initialization and Entry

- The program expects two parameters: `w_kode` (1 char) and `w_user` (10 chars).

```rpg
c     *entry        plist
c                   parm                    w_kode            1
c                   parm                    w_user           10
```
- This is the program's parameter list (passed from a calling program).

### *inzsr – Initialization Subroutine

```rpg
c     *inzsr        begsr
c                   move      *blank        w_kode            1
c     *like         define    abuser        ausrl1_user
c     ausrl1_key    klist
c                   kfld                    ausrl1_user
c                   endsr
```

- Initializes `w_kode` as blank.
- Sets up a key list for file access, using `ausrl1_user` as the key field.
- `*like` copies the definition (data type and length) of `ausrl1_user` to `abuser`.

---

## **User ID Input and Validation**

### Main Input Loop

```rpg
c     a1tagb        tag
c                   exfmt     a1win
```
- Marks the start of the main loop (`a1tagb`).
- Displays and receives data on screen format `a1win`.

### Exit Conditions (F3/F12 pressed)

```rpg
c     *inkc         ifeq      *on
c     *inkl         oreq      *on
c                   move      '1'           w_kode
c                   goto      xslutt
c                   endif
```
- If F3 (`*INKC`) or F12 (`*INKL`) is pressed, set `w_kode` to '1' and jump to the program end (`xslutt`).

### User Existence in User Register

```rpg
c                   move      a1user        ausrl1_user
c     ausrl1_key    chain     ausrl1                             60
c     *in60         ifeq      *on
c                   move      *on           *in31
c                   goto      a1tagb
c                   endif
```
- Moves the entered user ID (`a1user`) to the key field `ausrl1_user`.
- Chains to `ausrl1` (user register) with this key to check if the user exists.
    - If not found (`*IN60`), sets an error indicator (`*IN31`), and returns to input (`goto a1tagb`).

### On Success

```rpg
c                   move      a1user        w_user
```
- On successful validation (user exists), moves the user input to the output parameter `w_user`.

---

## **Program End**

```rpg
c     xslutt        tag
c                   move      *on           *inlr
c                   return
```
- End-of-program logic; sets last record indicator (`*INLR`) to end the program and return to caller.

---

## **Summary Table**

| Section              | Purpose                                                 |
|----------------------|--------------------------------------------------------|
| File Declarations    | Define workstation and user register (database) files  |
| *entry plist         | Define input/output parameters for the program         |
| *inzsr               | Initialize variables, key lists                        |
| a1tagb loop          | Handle user input and validate user ID                 |
| F3/F12 logic         | Allow user to exit with return code                    |
| User check (chain)   | Verify if the entered user ID exists in register       |
| xslutt               | Handle program exit and cleanup                        |

---

## **Common Variables / Fields**

- `a1user` – User ID entered on display.
- `w_kode` – Return code (output parameter), '1' if exited abnormally.
- `w_user` – Output parameter for the verified user ID.
- `ausrl1_user` – Key field for database lookup.
- `*INKC`, `*INKL` – Function key indicators for F3/F12.
- `*IN60` – Indicator for chain not found (user not found).
- `*IN31` – Internal indicator (typically mapped to error display on screen).

---

## **How Program Flows**

1. **Input shown**: The user is prompted to enter a user ID.
2. **User presses Enter**: The program tries to find the user in the "user register" file.
    - **If user not found**: Error indicator is set, and the input screen is shown again.
3. **User presses F3/F12**: The program returns to the caller with `w_kode = '1'`.
4. **User found**: The entered user ID is passed back to the caller in `w_user`.
5. **Program ends**: Cleans up and returns control.

---

## **Summary**

This program is a classic green-screen (5250 terminal) RPG routine that validates user input against a user database, and handles basic exit/error scenarios using IBM i indicators and standard logic. It’s modular, with proper use of subroutines, and is ready to interact with other programs using parameters.