# RPG Source Code Explanation

This RPG program (ASOKON/RK986R) is a classic ILE RPG (RPG IV) application designed to facilitate data extraction for “Zirius” (likely an external system or application) via a workstation display file. It's well-annotated with both broad and detailed comments, making the flow straightforward to understand. Below, we break down its structure, logic, and main components.

---

## Header Specifications

```rpg
h option(*nodebugio) datedit(*dmy)
```
- **option(*nodebugio):** Removes certain debug information for I/O operations, often used in production.
- **datedit(*dmy):** Specifies "day/month/year" date formatting for date operations.

---

## File Declarations

```rpg
frk986d    cf   e             workstn
```
- **frk986d:** The display file (WORKSTN device type) used to interact with the user (screens/forms).

---

## Data Definitions

```rpg
d                uds
d rpfirm                300    310  0
d rprdat                          d   datfmt(*iso)
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980
d p_in03          s              1
```
- These D-specs define data fields, likely mapped to the display or some database.
    - **uds:** User Data Structure.
    - **rpfirm, rprdat, l_user, l_firm, l_fnav:** Variables mapped to specific positions/lengths, possibly from a data area or communication area.
    - **p_in03:** A 1-character stand-alone field, used for parameter passing and function key detection.

---

## Indicator Usage

Detailed in the comments:
- **KC:** Indicator for F3=Exit.
- **LR:** End of program.
- **30:** Field protection.
- **31-99:** Various ranges for warnings, file operations, and subroutine work indicators.

---

## Main Program Logic

### Initialization & Display Loop

#### Entry Tag

```rpg
c     a2tagb        tag
```
- Label/tag used for looping control.

#### Screen Field Initialization

```rpg
c                   eval      a2zlfa = 'N'
c                   eval      a2zlbu = 'N'
```
- Sets initial values for selection options (likely “Invoice Posts” and “Shop Posts”) to ‘N’ (No).

#### Display Screen

```rpg
c                   exfmt     a2bld
```
- Displays the screen record format `a2bld` and waits for user input.

---

### Function Key Handling

```rpg
c                   if        *inkc = *on
c                   move      '1'           p_in03
c                   goto      xslutt
c                   endif
```
- If F3 (exit) is pressed (indicator KC), set `p_in03` to ‘1’ and jump to program end (`xslutt`).

---

### Handling Selections

#### Zirius Invoice Posts

```rpg
c                   if        a2zlfa = 'J'
c                   call      'RZ001C'
c                   goto      a2tagb
c                   endif
```
- If the user selects "invoice posts" (`a2zlfa` = ‘J’), call external program `RZ001C` and then redisplay selection screen.

#### Zirius Shop Posts

```rpg
c                   if        a2zlbu = 'J'
c                   call      'RZ002C'
c                   goto      a2tagb
c                   endif
```
- If "shop posts" (`a2zlbu` = ‘J’) is selected, call `RZ002C` and loop back.

#### Loop Control

```rpg
c                   goto      a2tagb
```
- If neither selected, redisplay screen.

---

### Program End

#### Exit Tag

```rpg
c     xslutt        tag
c                   eval      *inlr = *on
c                   return
```
- Tag for program termination.
- Set LR (last record) indicator to end the program.
- `return` exits the program.

---

## Initialization Subroutine

```rpg
c     *inzsr        begsr
c                   eval      p_in03 = ' '
c     *entry        plist
c                   parm                    p_in03
c                   endsr
```
- *INZSR is the Initialization Subroutine, automatically called once at program start.
- Initializes `p_in03` to blank.
- Defines parameter list: if called as a program, it accepts `p_in03` as a parameter.

---

## Key Points

- **User Interface:** Employs a display file, showing options to the user and responding to function keys.
- **Main Loop:** User repeatedly presented with selection screen until they exit (F3).
- **Action Triggers:** Calls external programs (`RZ001C` and `RZ002C`) to perform the actual extraction work based on user selection.
- **Indicators:** Heavily relies on classic RPG indicators for screen control and program logic.
- **Modernization Note:** This is traditional, fixed-format RPG IV; newer free-format RPG is more readable and maintainable.

---

## Summary Diagram

```plaintext
PROGRAM START
   |
[INITIALIZE]
   |
[a2tagb:]
   |
[RESET OPTIONS]
   |
[DISPLAY SCREEN a2bld]
   |
   |--(F3)---YES---> [SET p_in03='1'] --> [EXIT / xslutt]
   |
   |--(a2zlfa='J')--YES---> [CALL RZ001C] ---> [LOOP a2tagb]
   |
   |--(a2zlbu='J')--YES---> [CALL RZ002C] ---> [LOOP a2tagb]
   |
[DEFAULT] ---> [LOOP a2tagb]
```

---

## Summary

This is a menu-driven extraction trigger program for Zirius, handling two main tasks and supporting a clean exit for the user. The actual processing is delegated to other called programs. The code is a good example of a traditional, menu-driven RPG application on IBM i platforms.