# RPG Program JV600R: Onboarding Explanation

## Overview

This RPG program (`JV600R`) is part of an IBM i (AS/400) application. It's used for printing a product register and acts as a parameter program, most likely supporting a GUI front end and other batch/report routines.

### Main Purpose

- Allows a user to fill in parameters for a "product register" printout.
- Validates input fields.
- Calls a print program (`JV600C`) with a parameter structure.
- Handles function key requests for "lookup" or queries for several fields.
- Reads company information from the Local Data Area (LDA).

---

## Program Structure

### Global Specifications

#### Header line (`H` spec)
```rpg
h option(*nodebugio) datedit(*dmy)
```
- `*NODEBUGIO`: Disables debug I/O for efficiency.
- `datedit(*dmy)`: Date fields use Day-Month-Year format.

#### File Definitions (`F` specs)
```rpg
fjlevl1    if   e           k disk    rename(jlevpfr:jlevl1r)
Fjv600d    cf   e             workstn
```
- `jlevl1` (renamed record format): Input keyed file for supplier lookups.
- `jv600d`: Workstation file for the display (DDS-based screen).

---

### Data Definitions (`D` specs)

#### Local Data Area (LDA)
```rpg
d                uds
d l_firm                944    946  0
```
- Reads company number (`l_firm`) from positions 944-946 of the LDA.

#### Parameter Structure for JV600C
```rpg
d                 ds
d d_list                       120
d  d_firm                        3  0 overlay(d_list)
d  d_valg                        1  0 overlay(d_list:4)
...
d  d_edaf                         d   overlay(d_list:65) datfmt(*iso)
d  d_edat                         d   overlay(d_list:75) datfmt(*iso)
```
- `d_list`: A 120-byte structure used to pass parameters to the print program.
- Individual fields (`d_firm`, `d_valg`, etc.) overlay `d_list` for convenient access.

#### Product Group Structure
```rpg
d                 ds
d d_vgrp                         7  0
d  d_ogrp                        2  0 overlay(d_vgrp)
d  d_hgrp                        2  0 overlay(d_vgrp:3)
d  d_ugrp                        3  0 overlay(d_vgrp:5)
```
- Used for handling product group ranges.

#### Key Variables and Others
- Various fields for user input, queries, error tracking, temporary storage, etc.

---

### Main Processing Loop (`C` specs)

#### Initial Entry – Main Screen Handling

```rpg
c     b1tag         tag

c                   exfmt     b1bld
```
- Enters display format `b1bld`, the main screen for user input.

#### Function Key Processing

```rpg
c                   select
c                   when      *inkc or *inkl
c                   goto      avslutt
c                   when      *inkd
c                   exsr      spørring
c                   goto      b1tag
c                   endsl
```
- Handles function keys:
  - F3/F12 (assumed): Exit program (`goto avslutt`).
  - F6: Executes subroutine `spørring` (lookup / query).
  - Otherwise, continues.

#### Input Validation

```rpg
c                   exsr      sjekk_input
c                   if        b_feil = *on
c                   goto      b1tag
c                   endif
```
- Runs `sjekk_input` to validate entered fields.
- If an error is set, re-displays the screen.

#### Parameter Copy and Call

```rpg
c                   exsr      flytt_par
c                   call      'JV600C'
c                   parm                    d_list
c                   goto      b1tag
```
- Prepares parameter structure.
- Calls report/print program (`JV600C`), passing the parameter structure.
- Redisplays the input screen afterwards.

---

### End Program Section

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Releases program resources and exits.

---

## Subroutines

### Lookup Handling (`spørring`)

Handles F6/lookup logic for various input fields, often by calling "helper" programs for pop-up selection dialogs. For instance:

```rpg
c                   if        w_afld = 'B1LDOR'
c                   call      'JL500R'
c                   parm                    b1ldor
c                   parm                    w_navn
c                   goto      end_spørr
c                   endif
```
- If active field is supplier, calls program `JL500R` for a supplier lookup.

Similar logic is used for product groups and items, calling programs such as `VG510R`, `VG511R`, `VG512R`, and `JV500R`, populating the relevant field and accompanying text.

### Input Validation (`sjekk_input`)

This subroutine checks a variety of business rules to confirm input ranges are valid.

- **Supplier check:** Uses a `CHAIN` to verify supplier exists.
- **Product group range validation:** Ensures that start <= end for groups and that higher-level group fields aren't filled if lower-level is empty.
- **Item validation:** Ensure item range is valid and start <= end.
- **Date validation:** Ensures date fields are valid and in correct order.

If errors are found, the `b_feil` flag is set, and an error indicator (`*inXX`) is used for display file error handling.

### Parameter Population (`flytt_par`)

Transfers user input fields into the `d_list` structure to be forwarded to the print program, converting dates and text as necessary, and blanking or defaulting unused fields.

---

### Program Initialization (`*inzsr`)

- Sets up the key list for supplier lookup.
- Fetches company number from LDA.
- Initializes relevant fields.

---

## Key Fields Overview

- **b1ldor:** Supplier number
- **b1ogrf, b1hgrf, b1ugrf:** Product group "from", "to", and subgroup for range 1.
- **b1ogrt, b1hgrt, b1ugrt:** Product group range 2.
- **b1varf, b1vart:** Item number "from" and "to"
- **b1edaf, b1edat:** Date "from" and "to".
- **b1valg:** Report selection/variant.
- **b1eusr:** Operator/user.

---

## Program Flow Summary

1. Fetch company info and initialize variables.
2. Display main parameter entry screen.
3. Wait for user:
    - On F3/F12: exit.
    - On F6: run field lookup helper.
    - Otherwise, validate fields (`sjekk_input`).
4. If all fields valid:
    - Copy data to parameter structure.
    - Call print/report program.
    - Re-display parameter entry for further runs.
5. On exit, release resources.

---

## Practical Usage

- **The program is often called interactively** by a user who wants to print product registers/reports for a combination of suppliers, product groups, items, and dates.
- **It helps ensure correct, valid input** before generating the report.
- **It uses "helper" programs** to assist the user in picking correct suppliers, groups, and items.

---

## Notes for Developers

- **Display file `JV600D`** describes the input/output screens (see DDS for details).
- **All field names prefixed `b1`** are screen fields.
- **Indicators like `*in31`, `*in32`** are error flags for screen feedback.
- **You must have source for helper programs (`JL500R`, `VG5xxR`, `JV500R`)** to understand lookup logic.
- **Date handling uses DMY format** for validation and conversion.
- **Exit status handling and next-prompt logic** are classic "display file" program patterns.

---

## Recommended Next Steps

- Review the display file (DDS) to understand the user interface.
- Review the called programs for lookup (e.g., group/item helper programs) for full context.
- Walk through a debug session, using breakpoints at key routines (`sjekk_input`, `flytt_par`) to observe data flow.
- Understand any enhancements (see comments with versions like `7.00  010816 bsa`) that may affect the fields used.

---

**In summary:**  
This program is a robust parametric front-end for a product register print routine, built with standard RPG/400 patterns, focused on data validation, user queries, and batch program invocation. It's modular and relies heavily on subprogram calls for lookup and reporting.