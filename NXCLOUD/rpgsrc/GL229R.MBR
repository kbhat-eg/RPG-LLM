      /TITLE  ASOKON Arbeid med returfiler
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      * System  . . . . : ASOKON                                        *
      * Program . . . . : GL229R                                        *
      * Beskrivelse . . : Sletter historikk.                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      * Spesialversjon. :                                               *
      * Tilpasset for . :                                               *
      *                                                                 *
      * Referanse  Dato   Endringsbeskrivelse                      Sign.*
      * --------- ------  ----------------------------------------------*
      *           270600  Nytt program.                            RH   *
      *                                                                 *
      * 30011     300101  Legger sonekontonummer ut i feltet       RH   *
      *                   for bankgironummer.                      RH   *
      *                                                                 *
      * 23017     230107  Feil i årstall (århundre), dvs det ble   RH   *
      *                   "00" når rutinen kjøres i Januar.        RH   *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     fgavtl2    if   e           k disk
     fgbtrl1    uf   e           k disk
      *
      * Henter firmanavn.
      *
     d lda            uds
     d l_user                911    920
     d l_filg                931    933
     d l_firm                944    946  0
      *
      * Datastruktur for dato:
      *
     d                 ds
     d dsdato                         8  0
     d  dsdatÅ                        4  0 overlay(dsdato)
     d  dsdatm                        2  0 overlay(dsdato:5)
     d  dsdatd                        2  0 overlay(dsdato:7)
      *
     d wpgiro          s                   like(gfgiro)
     d wpmnd           s              2  0
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * B2CTL Behandle åpningsbildet med subfile                        *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Send Alt
      *
     c     a000          tag
      *
     c     key02         setll     gbtrl1
     c     key02         reade     gbtrl1                                 60
      *
     c                   dow       *in60 = *off
      *                                                        .
     c                   if        gfdato <= dsdato
     c                   delete    gbtrpfr
     c                   endif
      *                                                        .
     c     key02         reade     gbtrl1                                 60
     c                   enddo
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
     c     *dtaara       define    *lda          lda
      *
E5.00 * Beregner dato 1 mnd tilbake i tid:
      *
     c                   eval      dsdatÅ = 2000
     c                   move      uyear         dsdatÅ
     c                   eval      dsdatm = umonth
     c                   eval      dsdatd = uday
      *
E5.00c                   eval      wpmnd = umonth - 1
      *
     c                   if        wpmnd = 0
     c                   eval      dsdatÅ = uyear - 1
23017c                   movel     2             dsdatÅ
     c                   eval      dsdatm = 12
     c                   goto      xut
     c                   endif
      *
     c                   if        wpmnd = -1
     c                   eval      dsdatÅ = uyear - 1
     c                   eval      dsdatm = 11
     c                   goto      xut
     c                   endif
      *
     c                   if        wpmnd = -2
     c                   eval      dsdatÅ = uyear - 1
     c                   eval      dsdatm = 10
     c                   goto      xut
     c                   endif
      *
     c                   eval      dsdatm = wpmnd
      *
     c     xut           tag
      *
      * Key til bruk på avtaleregister - GAVTL2, hente gironummer:
      *
     c     key01         klist
     c                   kfld                    l_filg
     c                   kfld                    l_firm
      *
      * Key til bruk på returfiler - GBTRL1, leses på giro-/løpenummer:
      *
     c     key02         klist
     c                   kfld                    wpgiro
      *
      * Henter gironummer ut i fra pålogget filgruppe/firmanummer.
      * Ved IKKE TILSLAG settes *IN40 *ON for å indikere at pgm.
      * må avsluttes.  Dersom bankgironummer IKKE finnes brukes
      * postgironummer.  Den samme logikken brukes i program
      * GL109R, som legger ut data på file GBTRPF, d.v.s. post-
      * gironummer brukes i nøkkel feltet KUN dersom bankgironr.
      * IKKE er utfylt:
      *
     c     key01         setll     gavtl2
     c     key01         reade     gavtl2                                 60
      *
     c                   if        *in60 = *on
     c                   move      *on           *in40
     c                   eval      wpgiro = 0
     c                   goto      xslutt
     c                   endif
      *
     c                   if        gcbgir <> 0
     c                   eval      wpgiro = gcbgir
     c                   else
     c                   eval      wpgiro = gcpgir
     c                   endif
      *
      * Bruker SONEKONTONUMMER (GCSKTO) i fra faste data,
      * i steden for BANKKONTONUMMER (GCBGIR).
      *
30011c                   eval      wpgiro = gcskto
      *
      *
     c     xutinz        tag
      *
     c                   endsr
      *
