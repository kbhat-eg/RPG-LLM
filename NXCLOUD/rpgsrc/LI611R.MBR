7.01 h decedit('0.') datedit(*ymd-) option(*nodebugio)
7.01 h DftActgrp(*No) BndDir('CGIDEV2/CGIDEV2')
      *
7.01  /copy hspecsbnd
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Program . . . . : LI611R
      * Beskrivelse . . : Utskrift av EDI-Pakkseddel
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      * 7.00  270919 Bsa  Nytt program
7.01  * 7.00  300919 Bsa  Innfører PROA utskrift av dokumentet
      *
8.01  *K0000  230621 BSA  Utvidet meldingsnummer fra 6-8 siffer
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fafirl1    if   e           k disk    rename(afirpfr:afirl1r)
     faforl1    if   e           k disk    rename(aforpfr:aforl1r)
     flphoi1    if   e           k disk    rename(lphost:lphoi1r)
     flpkoir    if   e           k disk    rename(lpkost:lpkoirr)
     flpklir    if   e           k disk    rename(lpklst:lpklirr)
     flppai1    if   e           k disk    rename(lppast:lppai1r)
      *
     fli611p    o    e             printer
      *
      * Parameter-inn
      *
     d                 ds
     d d_prec                        45
     d  d_firm                        3  0 overlay(d_prec)
     d  d_type                        4    overlay(d_prec:4)
8.01 d  d_mnum                        8  0 overlay(d_prec:8)
     d  d_aarr                        4  0 overlay(d_prec:16)
     d  d_paid                       17    overlay(d_prec:20)
     d  d_pver                        3  0 overlay(d_prec:37)
      *
      * Local Data Area LDA
      *
     d                uds
7.01 d l_poff                584    584
7.01 d l_utqm                585    594
7.01 d l_bach                595    635
7.01 d l_arch                636    636  0
7.01 d l_skje                637    637  0
7.01 d l_land                638    638  0
7.01 d l_exlp                639    639  0
7.01 d l_mail                640    640  0
     d l_ruti                800    809
7.01 d l_outq                810    819
7.01 d l_copy                838    843  0
7.01 d l_wsid                901    910
7.01 d l_user                911    920
7.01 d l_filg                931    933
     d l_firm                944    946  0
7.01 d l_avde                947    950  0
      *
      *
      * Definering av variable i nøkler
      *
     d aforl1_ruti     s                   like(afruti)
     d lphoi1_type     s                   like(phtype)
     d lphoi1_mnum     s                   like(phmnum)
     d lphoi1_aarr     s                   like(phaarr)
     d lphoi1_paid     s                   like(phpaid)
     d lphoi1_pver     s                   like(phpver)
      *
     d lpkoir_type     s                   like(phtype)
     d lpkoir_mnum     s                   like(phmnum)
     d lpkoir_aarr     s                   like(phaarr)
     d lpkoir_paid     s                   like(phpaid)
     d lpkoir_pver     s                   like(phpver)
      *
     d lpklir_type     s                   like(pltype)
     d lpklir_mnum     s                   like(plmnum)
     d lpklir_aarr     s                   like(plaarr)
     d lpklir_paid     s                   like(plpaid)
     d lpklir_pver     s                   like(plpver)
     d lpklir_fsni     s                   like(plfsni)
     d lpklir_fniv     s                   like(plfniv)
      *
     d lppai1_type     s                   like(phtype)
     d lppai1_mnum     s                   like(phmnum)
     d lppai1_aarr     s                   like(phaarr)
     d lppai1_paid     s                   like(phpaid)
     d lppai1_pver     s                   like(phpver)
     d lppai1_paty     s                   like(pppaty)
      *
      * Definering av variable i parametre
      *
     d p_prec          s             45
      *
7.01 d p_mail          s              1
7.01 d p_kund          s              6  0
7.01 d p_kpro          s              6  0
7.01 d p_numm          s              8  0
7.01 d p_suff          s              2  0
7.01 d p_selg          s              4  0
7.01 d p_serv          s             35
7.01 d p_stat          s              1
7.01 d p_kule          s              1
7.01 d p_navn          s             30
7.01 d p_emal          s             50
7.01 d p_ema2          s             50
7.01 d p_ema3          s             50
7.01 d p_kopi          s             50
7.01 d p_emne          s             50
7.01 d p_txt1          s             50
7.01 d p_txt2          s             50
7.01 d p_txt3          s             50
7.01 d p_txt4          s             50
7.01 d p_pers          s             50
7.01 d p_inif          s             40
7.01 d p_in03          s              1
7.01 d p_ok            s              1
7.01 d p_lr            s              1
7.01 d p_str_in        s            512
7.01 d p_str_out       s            512
7.01 d p_filg          s             10
7.01 d p_xmlf          s            256
      *
7.01 d b_pdfp          s              1    inz(*off)
7.01 d b_koli          s              1    inz(*off)
      *
      * Definering av øvrige variable
      *
     d w_firm          s                   like(phfirm)
     d w_sscc          s             18  0
7.01 d w_date          s               d   datfmt(*iso)
7.01 d w_ruti          s             10
7.01 d w_pdf           s              1  0
7.01 d w_jkey          s             41
7.01 d w_pdf_ds        s            512
7.01 d w_mtxt          s            300
7.01 d w_jstat         s              2  0
7.01 d w_jtext         s            200
7.01 d w_land          s              9
7.01 d w_spol          s              5
7.01 d w_str_in        s            512
7.01 d w_str_out       s            512
7.01 d w_draw1         s             25
7.01 d w_dspl          s            250
7.01 d w_navn          s            100
7.01 d w_adr1          s            100
7.01 d w_adr2          s            100
7.01 d w_sted          s            100
7.01 d w_fnav          s            100
7.01 d w_fad1          s            100
7.01 d w_fad2          s            100
7.01 d w_fste          s            100
7.01 d w_mnav          s            100
7.01 d w_mad1          s            100
7.01 d w_mad2          s            100
7.01 d w_mste          s            100
7.01 d w_copy          s              3  0
7.01 d w_skuf          s             25
7.01 d w_dtray         s             10
7.01 d w_gtray         s             10
7.01 d w_lvar          s             50
7.01 d w_ptxt1         s             75
7.01 d w_ptxt2         s             75
7.01 d w_ptxt3         s             75
7.01 d w_ptxt4         s             75
7.01 d w_ppers         s             75
7.01 d w_pemne         s             75
7.01 d w_1fnav         s            100
7.01 d w_1fad1         s            100
7.01 d w_1fad2         s            100
7.01 d w_1fste         s            100
7.01 d w_refn          s             50
7.01 d w_tek1          s            512
7.01 d w_tek2          s            512
      *
7.01 d XML_Output      s            256a   Varying
7.01 d XML_path        s            256a   Varying
7.01 d                                     Inz('/home/asp/print/adb')
7.01 d jasper_mal      s            256a   inz('file:/home/asp/print/maler/+
7.01 d                                     tilbud/TILBUD.jasper')
7.01 d jasper_logo     s            256a   varying
7.01 d tmpdate         s               D
7.01 d tmptime         s               T
7.01 d crlf            c                   const(X'0d25')
7.01  *
7.01 d d_pdf_ds        ds
7.01 d  d_xmlm                       75
7.01 d  d_jasm                       75
7.01 d  d_logo                       75
7.01 d  d_path                      100
7.01 d  d_emal                       50
7.01 d  d_fifo                       75
7.01 d  d_kopi                        1
7.01 d  d_dtaq                        1
7.01 d  d_sign                        1
7.01  /copy prototypeb
7.01  /copy usec
      *
      * Definering av Konstanter
      *
     d c_01            c                   'Pakkseddelnr:'
     d c_02            c                   'Pakkseddel:'
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Definering av formater
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * A1HDR  - Heading A1 på rapport
      * K1HDR  - Heading K1 på rapport, Kolli
      * D1DET  - Detail  D1 på rapport, Varelinje
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Styre-rutine
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Hent EDI meldings-hode
      *
     c     lphoi1_key    chain     lphoi1
     c                   if        not %found
     c                   goto      end_pgm
     c                   endif
      *
     c     *dmy          move      phodat        a1dato
     c     *hms          move      photim        a1time
      *
     c                   eval      a1fnav = *blank
     c                   eval      a1fad1 = *blank
     c                   eval      a1fad2 = *blank
     c                   eval      a1fste = *blank
     c                   eval      a1paid = phpaid
      *
     c                   eval      a1mnav = *blank
     c                   eval      a1mad1 = *blank
     c                   eval      a1mad2 = *blank
     c                   eval      a1mste = *blank
      *
     c                   eval      lppai1_paty = 'BY'
     c     lppai1_key    chain     lppai1
     c                   if        %found
     c                   eval      a1eank = %trim(pppart)
     c                   endif
      *
     c                   eval      lppai1_paty = 'DP'
     c     lppai1_key    chain     lppai1
     c                   if        %found
     c                   eval      a1mnav = ppnavn
     c                   eval      a1mad1 = ppadr1
     c                   eval      a1mad2 = ppadr2
     c                   eval      a1mste = %trim(ppponr) + ' ' + %trim(ppsted)
     c                   eval      a1eanm = %trim(pppart)
     c                   endif
      *
     c                   eval      lppai1_paty = 'SU'
     c     lppai1_key    chain     lppai1
     c                   if        %found
     c                   eval      a1fnav = ppnavn
     c                   eval      a1fad1 = ppadr1
     c                   eval      a1fad2 = ppadr2
     c                   eval      a1fste = %trim(ppponr) + ' ' + %trim(ppsted)
     c                   eval      a1eanl = %trim(pppart)
     c                   endif
      * Skriv heading
7.01 c                   if        b_pdfp = *off
     c                   write     a1hdr
7.01 c                   else
7.01  * Vi skriver til XML taggene for heading
7.01 c                   exsr      xml_head
7.01 c                   endif
      *
      * Les alle kolli på pakkseddelen
      *
     c                   eval      w_sscc = 0
     c                   eval      lpkoir_type = phtype
     c                   eval      lpkoir_mnum = phmnum
     c                   eval      lpkoir_aarr = phaarr
     c                   eval      lpkoir_paid = phpaid
     c                   eval      lpkoir_pver = phpver
     c     lpkoir_key    setll     lpkoir
     c     lpkoir_key    reade     lpkoir
     c                   dow       not %eof
     c                   if        posscc <> w_sscc
     c                   eval      w_sscc = posscc
     c                   eval      k1sscc = posscc
     c                   eval      k1koty = pokoty
     c                   eval      k1hoyd = pohoyd
     c                   eval      k1leng = poleng
     c                   eval      k1bred = pobred
     c                   eval      k1volu = povolu
     c                   eval      k1bvkt = pobvkt
     c                   eval      k1bvkt = pobvkt
      * Skriv til lista
7.01 c                   if        b_pdfp = *off
     c                   write     k1hdr                                30
     c   30              write     a1hdr
     c                   write     d1hdr
7.01 c                   else
7.01 c                   exsr      xml_kol_head
7.01 c                   endif
     c                   endif
      *
     c                   eval      lpklir_type = potype
     c                   eval      lpklir_mnum = pomnum
     c                   eval      lpklir_aarr = poaarr
     c                   eval      lpklir_paid = popaid
     c                   eval      lpklir_pver = popver
     c                   eval      lpklir_fsni = pofsni
     c                   eval      lpklir_fniv = pofniv
     c     lpklir_key    setll     lpklir
     c     lpklir_key    reade     lpklir
     c                   dow       not %eof
     c                   eval      d1nobb = plnobb
     c                   eval      d1navn = plnavn
     c                   eval      d1benr = plnumm
     c                   eval      d1blin = plblin
     c                   eval      d1bant = plbant
     c                   eval      d1pant = plpant
      *
7.01 c                   if        b_pdfp = *off
     c                   write     d1det                                30
     c   30              write     a1hdr
     c   30              write     k1hdr
7.01 c                   else
7.01 c                   exsr      xml_deta
7.01 c                   endif
      *
     c     lpklir_key    reade     lpklir
     c                   enddo
      *
     c     lpkoir_key    reade     lpkoir
     c                   enddo
      *
      * Avslutt program
      *
     c     end_pgm       tag
      *
7.01 c                   if        b_pdfp = *on
7.01  * Skriv xml fila på disk
7.01 c                   exsr      xml_end
7.01  * Hvis forhåndvisning må vi kjøre linken
7.01 c                   if        l_skje = 1 and
7.01  * Kun preview hvis en ordre er valgt
7.01 c                             l_bach = w_jkey
7.01 c                   exsr      pdf_preview
7.01 c                   endif
7.01 c                   endif
      *
     c                   eval      *inlr = *on
     c                   return
      *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01  * Subrutiner for XML/jasper integrasjon - Miljø variabler         *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01 c     xml_envm      begsr
7.01  *
7.01  * Hvis skjermvisning skal vi ikke lagre i spoolfile
7.01 c                   if        l_skje = 1
7.01 c                   eval      w_spol = 'true'
7.01 c                   else
7.01 c                   eval      w_spol = 'false'
7.01 c                   endif
7.01  *
7.01  /Free
7.01       // Finne nytt batch nummer
7.01           UpdHTMLVar('BatchNo':             w_jkey);
7.01           UpdHTMLVar('Batchtype': 'EDI PAKKSEDDEL');
7.01           UpdHTMLVar('Username':            l_user);
7.01           WrtSection('Topp');
7.01       // Finn credential variabler
7.01           UpdHTMLVar('IPAdr':                  ' ');
7.01           UpdHTMLVar('User':                l_user);
7.01           UpdHTMLVar('PW':                     ' ');
7.01           UpdHTMLVar('Schema':        'ADB'+l_filg);
7.01           UpdHTMLVar('Companyno':    %char(l_firm));
7.01           UpdHTMLVar('Departmentnoarkiv': %char(l_avde));
7.01           WrtSection('Credential');
7.01       // Finn report command variabler
7.01           UpdHTMLVar('Jaspertemplate':      d_jasm);
7.01           UpdHTMLVar('Logo':           jasper_logo);
7.01           UpdHTMLVar('Keepspool':           w_spol);
7.01           WrtSection('ReportCommand');
7.01  /End-free
7.01  *
7.01  * Hvis skjermvisning eller e-mail skal ikke PDF skrives
7.01  *
7.01 c                   if        l_skje = 0 and
7.01 c                             l_mail = 0
7.01  * Hvis *ARKIV er valgt som skriver, skal det ikke skrives ut
7.01 c                   if        l_utqm <> '*ARKIV'
7.01  *
7.01 c                   if        l_land = 1
7.01 c                   eval      w_land = 'LANDSCAPE'
7.01 c                   else
7.01 c                   eval      w_land = 'PORTRAIT'
7.01 c                   endif
7.01  * Sjekk at valgt outq støttes av skriveren. Kan skli gjennom hvis
7.01  * jobben legges på jobbkø.
7.01 c                   eval      p_ok = '0'
7.01 c                   call      'AP612R'
7.01 c                   parm                    l_filg
7.01 c                   parm                    l_outq
7.01 c                   parm                    p_ok
7.01  * Hvis feil utkø, logges dette i transaksjonsloggen
7.01 c                   if        p_ok = '0'
7.01 c                   eval      w_jstat = 20
7.01 c                   eval      w_jtext = 'Ugyldig utkø '+ l_outq + ' er val+
7.01 c                             gt. Ingen utskrift er generert. Utskrift kan+
7.01 c                              arkiveres.'
7.01 c                   call      'AB705R'
7.01 c                   parm                    l_bach
7.01 c                   parm                    w_jstat
7.05 c                   parm                    w_jtext
7.01 c                   else
7.01  * Hent inn skuffinformasjon for skriveren
7.01 c                   eval      w_dtray = *blank
7.01 c                   eval      w_gtray = *blank
7.01 c                   call      'AP611R'
7.01 c                   parm                    l_filg
7.01 c                   parm                    l_outq
7.01 c                   parm                    w_dtray
7.01 c                   parm                    w_gtray
7.01  * Hent inn skuffinformasjon for skriveren - default inskuff
7.01 c                   eval      w_draw1 = *blank
7.01 c                   movel     w_dtray       w_skuf
7.01 c                   call      'AP614R'
7.01 c                   parm                    l_outq
7.01 c                   parm                    w_skuf
7.01 c                   parm                    w_draw1
7.01  *
7.01 c                   if        l_copy > 0
7.01 c                   eval      w_copy = l_copy
7.01 c                   else
7.01 c                   eval      w_copy = 1
7.01 c                   endif
7.01  *
7.01  /Free
7.01       // Finn print informasjon
7.01           UpdHTMLVar('Printername':         l_outq);
7.01           UpdHTMLVar('Copies':        %char(w_copy));
7.01           UpdHTMLVar('Papersource':        w_draw1);
7.01           UpdHTMLVar('Lastpagedrawer':         ' ');
7.01           UpdHTMLVar('Duplex':             'false');
7.01           UpdHTMLVar('Quality':                ' ');
7.01           UpdHTMLVar('Sorting':                ' ');
7.01           UpdHTMLVar('Staple':              'true');
7.01           UPDHTMLVar('Alignment':           w_land);
7.01           WrtSection('PrintCommand');
7.01  /End-free
7.01 c                   endif
7.01 c                   endif
7.01 c                   endif
7.01  *
7.01 c                   endsr
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01  * Subrutiner for XML/jasper integrasjon - Heading                 *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01 c     xml_head      begsr
7.01  *
7.01 c                   eval      w_str_in = *blanks
7.01 c                   eval      w_str_out = *blanks
7.01  *
7.01  * Hvis mail skal skrives, må vi hente mail informasjon
7.01  *
7.01 c                   if        l_mail = 1
7.01 c                   eval      p_kule = 'L'
7.01 c                   eval      p_kund = 0
7.01 c                   eval      p_kpro = 0
7.01 c                   eval      p_numm = 0
7.01 c                   eval      p_selg = 0
7.01 c                   eval      p_in03 = *off
7.01  * Henter tilbake mailserver
7.01 c                   eval      p_serv = *blank
7.01 c                   eval      p_stat = *blank
7.01 c                   call      'AM705C'
7.01 c                   parm                    p_serv
7.01 c                   parm                    p_stat
7.01  *
7.01 c                   call      'FO798R'
7.01 c                   parm                    p_kule
7.01 c                   parm                    p_kund
7.01 c                   parm                    p_kpro
7.01 c                   parm                    p_numm
7.01 c                   parm                    p_suff
7.01 c                   parm                    p_selg
7.01 c                   parm                    p_navn
7.01 c                   parm                    p_emal
7.01 c                   parm                    p_ema2
7.01 c                   parm                    p_ema3
7.01 c                   parm                    p_emne
7.01 c                   parm                    p_txt1
7.01 c                   parm                    p_txt2
7.01 c                   parm                    p_txt3
7.01 c                   parm                    p_txt4
7.01 c                   parm                    p_pers
7.01 c                   parm                    p_kopi
7.01 c                   parm                    p_inif
7.01 c                   parm                    p_in03
7.01  * Scann av strenger
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     p_emne        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_pemne
7.01  * Scann av strenger
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     p_txt1        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_ptxt1
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     p_txt2        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_ptxt2
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     p_txt3        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_ptxt3
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     p_txt4        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_ptxt4
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     p_pers        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_ppers
7.01  *
7.01 c                   eval      w_mtxt = %trim(w_ptxt1) + crlf +
7.01 c                                      %trim(w_ptxt2) + crlf +
7.01 c                                      %trim(w_ptxt3) + crlf +
7.01 c                                      %trim(w_ptxt4) + crlf +
7.01 c                                      %trim(w_ppers)
7.01  *
7.01 c                   if        p_kopi = *blanks
7.01 c                   eval      p_kopi = d_emal
7.01 c                   endif
7.01  *
7.01 c                   if        p_in03 = *off
7.01  *
7.01  /Free
7.01       // Skriv mailinformasjon
7.01           WrtSection('MailCommandStart');
7.01       //  UpdHTMLVar('Receivers':           p_emal);
7.01           if %Trim(p_emal)<> *blanks;
7.01           UpdHTMLVar('Receivers':           p_emal);
7.01           WrtSection('MailReceiver');
7.01           endif;
7.01           if %Trim(p_ema2)<> *blanks;
7.01           UpdHTMLVar('Receivers':           p_ema2);
7.01           WrtSection('MailReceiver');
7.01           endif;
7.01           if %Trim(p_ema3)<> *blanks;
7.01           UpdHTMLVar('Receivers':           p_ema3);
7.01           WrtSection('MailReceiver');
7.01           endif;
7.01
7.01           UpdHTMLVar('CC':                     ' ');
7.01           UpdHTMLVar('BCC':                 p_kopi);
7.01           UpdHTMLVar('Sender':              p_kopi);
7.01           UpdHTMLVar('Subject':            w_pemne);
7.01           UpdHTMLVar('Message':             w_mtxt);
7.01           UpdHTMLVar('Message1':            p_pers);
7.01           UpdHTMLVar('SMTPServer':          p_serv);
7.01           UPDHTMLVar('SMTPUser':               ' ');
7.01           UPDHTMLVar('SMTPPw':                 ' ');
7.01           WrtSection('MailCommandEnd');
7.01  /End-free
7.01 c                   endif
7.01 c                   endif
7.01  *
7.01  * Vi må oversette aktuelle tekster til "xml" tegn - Firma
7.01 c                   eval      w_1fnav = *blank
7.01 c                   eval      w_1fad1 = *blank
7.01 c                   eval      w_1fad2 = *blank
7.01 c                   eval      w_1fste = *blank
7.01  * Avdelingsinfo
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   movel     aafnav        p_str_in
7.01 c                   eval      p_lr = '0'
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_1fnav
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     aafad1        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_1fad1
7.01  *
7.01 c                   eval      p_lr = '0'
7.01 c                   eval      p_str_in = *blank
7.01 c                   movel     aafad2        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_1fad2
7.01  *
7.01 c                   eval      p_lr = '0'
7.01 c                   eval      p_str_in = *blank
7.01 c                   movel     aafste        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_1fste
7.01  *
7.01  /Free
7.01
7.01       // Skriv firmavariabler
7.01           UpdHTMLVar('Reporttext':            a1txt1);
7.01           UpdHTMLVar('CompanyName':          w_1fnav);
7.01           UpdHTMLVar('Companyadress1':       w_1fad1);
7.01           UpdHTMLVar('Companyadress2':       w_1fad2);
7.01           UpdHTMLVar('Companypostalcode':        ' ');
7.01           UpdHTMLVar('Companypostoffice':    w_1fste);
7.01           UpdHTMLVar('Companyphone':             ' ');
7.01           UpdHTMLVar('Companyfax':               ' ');
7.01           UpdHTMLVar('Companyorgno':             ' ');
7.01           UpdHTMLVar('Companygiro':    %char(aafbgi));
7.01           UpdHTMLVar('Companyemail':             ' ');
7.01           UpdHTMLVar('Companywebpage':           ' ');
7.01           WrtSection('Company');
7.01
7.01           test(de) *dmy a1dato;
7.01           if %error;
7.01           tmpdate = *loval;
7.01           else;
7.01           tmpdate = %date(a1dato : *dmy);
7.01           endif;
7.01           UpdHTMLVar('Creationdate':   %char(tmpdate : *iso));
7.01           test(te) *hms a1time;
7.01           if %error;
7.01           tmptime = *loval;
7.01           else;
7.01           tmptime = %time(a1time : *hms);
7.01           endif;
7.01           UpdHTMLVar('Creationtime': %char(tmptime : *hms));
7.01           UpdHTMLVar('Documentno':        %trim(a1paid));
7.01           WrtSection('Creation');
7.01
7.01  /End-free
7.01
7.01  *
7.01  * Hent ut informasjon om tekster til "xml" tegn - (kjøper)
7.01  *
7.01 c                   eval      w_navn = *blank
7.01 c                   eval      w_adr1 = *blank
7.01 c                   eval      w_adr2 = *blank
7.01 c                   eval      w_sted = *blank
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1navn        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_navn
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1adr1        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_adr1
      *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1adr2        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_adr2
      *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1sted        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_sted
7.01  *
7.01  /Free
7.01
7.01       // Skriv partnerinfo (kjøper)
7.01           UpdHTMLVar('Partnerorgno':             '0');
7.01           UpdHTMLVar('Partnerglnno':   %char(a1eank));
7.01           UpdHTMLVar('Partnerno':                '0');
7.01           UpdHTMLVar('Partnercategory':         'BY');
7.01           UpdHTMLVar('Partnername':           w_navn);
7.01           UpdHTMLVar('Partneradress1':        w_adr1);
7.01           UpdHTMLVar('Partneradress2':        w_adr2);
7.01           UpdHTMLVar('Partnerpostalcode':        ' ');
7.01           UpdHTMLVar('Partnerpostoffice':     w_sted);
7.01           UpdHTMLVar('Partnerphone':             ' ');
7.01           UpdHTMLVar('Partnercellphone':         ' ');
7.01           UpdHTMLVar('Partnerfax':               ' ');
7.01           WrtSection('Partner');
7.01
7.01  /End-free
7.01  *
7.01  * Hent ut informasjon om tekster til "xml" tegn - (leverandør)
7.01  *
7.01 c                   eval      w_fnav = *blank
7.01 c                   eval      w_fad1 = *blank
7.01 c                   eval      w_fad2 = *blank
7.01 c                   eval      w_fste = *blank
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1fnav        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_fnav
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1fad1        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_fad1
      *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1fad2        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_fad2
      *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1fste        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_fste
7.01  *
7.01  /Free
7.01
7.01       // Skriv partnerinfo (kjøper)
7.01           UpdHTMLVar('Partnerorgno':             '0');
7.01           UpdHTMLVar('Partnerglnno':   %char(a1eanl));
7.01           UpdHTMLVar('Partnerno':                '0');
7.01           UpdHTMLVar('Partnercategory':         'SU');
7.01           UpdHTMLVar('Partnername':           w_fnav);
7.01           UpdHTMLVar('Partneradress1':        w_fad1);
7.01           UpdHTMLVar('Partneradress2':        w_fad2);
7.01           UpdHTMLVar('Partnerpostalcode':        ' ');
7.01           UpdHTMLVar('Partnerpostoffice':     w_fste);
7.01           UpdHTMLVar('Partnerphone':             ' ');
7.01           UpdHTMLVar('Partnercellphone':         ' ');
7.01           UpdHTMLVar('Partnerfax':               ' ');
7.01           WrtSection('Partner');
7.01
7.01  /End-free
7.01  *
7.01  * Hent ut informasjon om tekster til "xml" tegn - (leveringsadresse)
7.01  *
7.01 c                   eval      w_mnav = *blank
7.01 c                   eval      w_mad1 = *blank
7.01 c                   eval      w_mad2 = *blank
7.01 c                   eval      w_mste = *blank
7.01  *
7.01 c                   if        %trim(a1mnav) <> *blanks
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1mnav        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_mnav
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1mad1        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_mad1
      *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1mad2        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_mad2
      *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     a1mste        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_mste
7.01  *
7.01  /Free
7.01
7.01       // Skriv partnerinfo (leveringsadresse)
7.01           UpdHTMLVar('Partnerorgno':             '0');
7.01           UpdHTMLVar('Partnerglnno':   %char(a1eanm));
7.01           UpdHTMLVar('Partnerno':                '0');
7.01           UpdHTMLVar('Partnercategory':         'DP');
7.01           UpdHTMLVar('Partnername':           w_mnav);
7.01           UpdHTMLVar('Partneradress1':        w_mad1);
7.01           UpdHTMLVar('Partneradress2':        w_mad2);
7.01           UpdHTMLVar('Partnerpostalcode':        ' ');
7.01           UpdHTMLVar('Partnerpostoffice':     w_mste);
7.01           UpdHTMLVar('Partnerphone':             ' ');
7.01           UpdHTMLVar('Partnercellphone':         ' ');
7.01           UpdHTMLVar('Partnerfax':               ' ');
7.01           WrtSection('Partner');
7.01
7.01  /End-free
7.01  *
7.01 c                   endif
7.01  *  Flyttet ut fra betingelsen om a2navn må være utfyllt
7.01  *
7.01 c*                  eval      p_str_in = *blank
7.01 c*                  eval      p_lr = '0'
7.01 c*                  movel     a1lmtx        p_str_in
7.01 c*                  call      'AP613R'
7.01 c*                  parm                    p_str_in
7.01 c*                  parm                    p_str_out
7.01 c*                  parm                    p_lr
7.01 c*                  movel     p_str_out     w_lmtx
7.01  *
7.01  /Free
7.01
7.01  //       UpdHTMLVar('Deliverymethod':               w_lmtx);
7.01  //       test(de) *dmy w_ldat;
7.01  //       if %error;
7.01  //       tmpdate = *loval;
7.01  //       else;
7.01  //       tmpdate = %date(w_ldat : *dmy);
7.01  //       endif;
7.01  //       UpdHTMLVar('Deliverydate':   %char(tmpdate : *iso));
7.01  //       UpdHTMLVar('Deliverytype':           %char(folety));
7.01  //       UpdHTMLVar('Deliveryterms':                 w_lbtx);
7.01  //       UpdHTMLVar('Drivingroute':           %char(fokjor));
7.01  //       WrtSection('DeliveryInfo');
7.01
7.01  /End-free
7.01  *
7.01 c                   endsr
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01  * Subrutiner for XML/jasper integrasjon - Detaljer                *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01 c     xml_kol_head  begsr
7.01  *
7.01 c                   if        b_koli = *on
7.01  * Skriv xmlfila til disk
7.01  /Free
7.01           WrtSection('DespatchAdvicePackageLineEnd');
7.01           WrtSection('DespatchAdvicePackageEndTag');
7.01  /End-free
7.01  *
7.01 c                   endif
7.01  *
7.01 c                   eval      b_koli = *on
7.01  *
7.01  /Free
7.01
7.01       // Skriv kolli informasjon
7.01           UpdHTMLVar('SSCCCode':          %char(posscc));
7.01           UpdHTMLVar('Serialnumber':      %trim(poksnr));
7.01           UpdHTMLVar('Packagetype':       %trim(pokoty));
7.01           UpdHTMLVar('Packagecount':      %char(popant));
7.01           UpdHTMLVar('Packageweight':     %char(pobvkt));
7.01           UpdHTMLVar('Packagenetweight':  %char(ponvkt));
7.01           UpdHTMLVar('Packageweightunit': %char(poveen));
7.01           UpdHTMLVar('Packagevolume':     %char(povolu));
7.01           UpdHTMLVar('Packagevolumeunit': %char(povenh));
7.01           UpdHTMLVar('Packageheight':     %char(pohoyd));
7.01           UpdHTMLVar('Packageheightunit': %char(pohenh));
7.01           UpdHTMLVar('Packagelenght':     %char(poleng));
7.01           UpdHTMLVar('Packagelenghtunit': %char(polenh));
7.01           UpdHTMLVar('Packagewith':       %char(pobred));
7.01           UpdHTMLVar('Packagewithunit':   %char(pobenh));
7.01           WrtSection('DespatchAdvicePackageStart');
7.01
7.01           WrtSection('DespatchAdvicePackageLineStart');
7.01
7.01  /End-free
7.01  *
7.01 c                   endsr
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01  * Subrutiner for XML/jasper integrasjon - Detaljer                *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01 c     xml_deta      begsr
7.01  *
7.01  * Vi må oversette aktuelle tekster til "xml" tegn - Varetekster
7.01 c                   eval      w_lvar = *blank
7.01 c                   eval      w_tek1 = *blank
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     d1navn        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_tek1
      * Lev.varenummer
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '0'
7.01 c                   movel     pllvar        P_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_lvar
      *
7.01 c                   callp     updHTMLVar('Orderedquantity':%char(d1bant))
7.01 c                   callp     updHTMLVar('NoDecimals':        '2')
      *
7.01 c                   callp     updHTMLVar('Despatchquantity':%char(d1pant))
7.01 c                   callp     updHTMLVar('NoDecimals':        '2')
      *
7.01 c                   callp     updHTMLVar('Backorderquantity':%char(plrant))
7.01 c                   callp     updHTMLVar('NoDecimals':        '2')
      *
7.01  *
7.01  /Free
7.01       // Skriv detaljer
7.01           UpdHTMLVar('Gtin':              %char(plgtin));
7.01           UpdHTMLVar('Partneritemno':     %trim(w_lvar));
7.01           UpdHTMLVar('Nobbno':            %char(d1nobb));
7.01           UpdHTMLVar('Text1':                    w_tek1);
7.01           UpdHTMLVar('Text2':                       ' ');
7.01           UpdHTMLVar('Orderedunit':       %trim(plbenh));
7.01           UpdHTMLVar('Despatchunit':      %trim(plpenh));
7.01           UpdHTMLVar('Backorderunit':     %trim(plrenh));
7.01           UpdHTMLVar('NXOrdernumber':     %char(d1benr));
7.01           UpdHTMLVar('NXLineno':          %char(d1blin));
7.01           WrtSection('PackageLine');
7.01
7.01  /End-free
7.01  *
7.01 c                   endsr
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01  * Subrutiner for XML/jasper integrasjon - Slutt                   *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01 c     xml_end       begsr
7.01  * Skriv xmlfila til disk
7.01  /Free
7.01           WrtSection('DespatchAdvicePackageLineEnd');
7.01           WrtSection('DespatchAdvicePackageEndTag');
7.01           WrtSection('DespatchAdviceEndTag');
7.01  /End-free
7.01  *
7.01  * Hvis denne ikke skal arkiveres, lages ikke archive tagg.
7.01  *
7.01 c                   if        l_arch = 1
7.01  * Lag tag for vising i arkivklienten
7.01 c                   eval      w_dspl = *blank
7.01 c                   eval      w_dspl = 'EDI pakkseddel: ' + %trim(a1paid)
7.01  *
7.01 c                   eval      p_str_in = *blank
7.01 c                   eval      p_lr = '1'
7.01 c                   movel     w_dspl        p_str_in
7.01 c                   call      'AP613R'
7.01 c                   parm                    p_str_in
7.01 c                   parm                    p_str_out
7.01 c                   parm                    p_lr
7.01 c                   movel     p_str_out     w_dspl
7.01  * Referansetagg
7.01 c                   eval      w_refn = *blank
7.01 c                   eval      w_refn = %char(%subdt(w_date:*years)) +
7.01 c                             %char(a1paid)
7.01  /Free
7.01
7.01       // Skriv metattags
7.01
7.01           UpdHTMLVar('Refno':          %trim(w_refn));
7.01           UpdHTMLVar('Displaytag':     %trim(w_dspl));
7.01           WrtSection('ArchiveCommandStart');
7.01
7.01           UpdHTMLVar('Metavalue':      %char(a1paid));
7.01           UpdHTMLVar('Metakey':   'PAKKSEDDELNUMMER');
7.01           WrtSection('MetaTag');
7.01
7.01           UpdHTMLVar('Metavalue':      %char(a1fnav));
7.01           UpdHTMLVar('Metakey':         'LEVERANDOR');
7.01           WrtSection('MetaTag');
7.01
7.01           UpdHTMLVar('Metavalue': %char(w_date:*iso));
7.01           UpdHTMLVar('Metakey':               'DATO');
7.01           WrtSection('MetaTag');
7.01
7.01           UpdHTMLVar('Metavalue':             l_user);
7.01           UpdHTMLVar('Metakey':             'BRUKER');
7.01           WrtSection('MetaTag');
7.01
7.01           UpdHTMLVar('Metavalue':             a1txt1);
7.01           UpdHTMLVar('Metakey':         'RUTINETEKST');
7.01           WrtSection('MetaTag');
7.01
7.01           UpdHTMLVar('Metavalue':             l_ruti);
7.01           UpdHTMLVar('Metakey':             'RUTINE');
7.01           WrtSection('MetaTag');
7.01
7.01           UpdHTMLVar('Metavalue':      %char(l_firm));
7.01           UpdHTMLVar('Metakey':              'FIRMA');
7.01           WrtSection('MetaTag');
7.01
7.01           UpdHTMLVar('Metavalue':             l_wsid);
7.01           UpdHTMLVar('Metakey':             'SKJERM');
7.01           WrtSection('MetaTag');
7.01
7.01           WrtSection('ArchiveCommandEnd');
7.01  /End-free
7.01 c                   endif
7.01  *
7.01  /Free
7.01
7.01           WrtSection('Footer');
7.01  /End-free
7.01  *
7.01  * Så legge vi ut xml fila
7.01 c                   eval      XML_Output = XML_path + l_filg +'/'+
7.01 c                             'EDIPakk_'+ %trim(w_jkey) + '.xml'
7.01  *
7.01 c                   callp     WrtHtmlToStmf(XML_Output: 819)
7.01  * Skriver til datakø for å aktivere sniffer, hvis dataq er aktiv
7.01 c                   if        d_dtaq = '1'
7.01 c                   eval      p_xmlf = xml_output
7.01 c                   eval      p_filg = 'ADB'+l_filg
7.01 c                   call      'AP629C'
7.01 c                   parm                    p_filg
7.01 c                   parm                    p_xmlf
7.01 c                   endif
7.01  *
7.01 c                   endsr
7.01  *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01  * Subrutiner for XML/jasper integrasjon - Skjermvisning           *
7.01  * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
7.01 c     pdf_preview   begsr
7.01  * Vi kaller program for launch av PDF i browser
7.01 c                   call      'AP621R'
7.01 c                   parm                    w_jkey
7.01  *
7.01 c                   endsr
7.01  *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Parametre
      *
     c     *entry        plist
     c                   parm                    p_prec
      *
      * Key for les av pakkseddel hode
      *
     c     lphoi1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lphoi1_type
     c                   kfld                    lphoi1_mnum
     c                   kfld                    lphoi1_aarr
     c                   kfld                    lphoi1_paid
     c                   kfld                    lphoi1_pver
      *
      * Key for les av pakkseddel kolli
      *
     c     lpkoir_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lpkoir_type
     c                   kfld                    lpkoir_mnum
     c                   kfld                    lpkoir_aarr
     c                   kfld                    lpkoir_paid
     c                   kfld                    lpkoir_pver
      *
      * Key for les av pakkseddel kolli linjer
      *
     c     lpklir_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lpklir_type
     c                   kfld                    lpklir_mnum
     c                   kfld                    lpklir_aarr
     c                   kfld                    lpklir_paid
     c                   kfld                    lpklir_pver
     c                   kfld                    lpklir_fsni
     c                   kfld                    lpklir_fniv
      *
      * Key for les av pakkseddel part
      *
     c     lppai1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    lppai1_type
     c                   kfld                    lppai1_mnum
     c                   kfld                    lppai1_aarr
     c                   kfld                    lppai1_paid
     c                   kfld                    lppai1_pver
     c                   kfld                    lppai1_paty
      *
      * Key for les av FIRMA
      *
     c     afirl1_key    klist
     c                   kfld                    w_firm
      *
      * Key for les av FORMULAR
      *
     c     aforl1_key    klist
     c                   kfld                    aforl1_ruti
      *
      * Hente inn rutine informasjon
      *
     c                   eval      aforl1_ruti = l_ruti
     c                   eval      d_prec = p_prec
     c                   eval      w_firm = d_firm
      *
     c                   eval      lphoi1_type = d_type
     c                   eval      lphoi1_mnum = d_mnum
     c                   eval      lphoi1_aarr = d_aarr
     c                   eval      lphoi1_paid = d_paid
     c                   eval      lphoi1_pver = d_pver
      *
     c                   eval      lppai1_type = d_type
     c                   eval      lppai1_mnum = d_mnum
     c                   eval      lppai1_aarr = d_aarr
     c                   eval      lppai1_paid = d_paid
     c                   eval      lppai1_pver = d_pver
      *
     c     aforl1_key    chain     aforl1r
     c                   if        %found
     c                   eval      a1txt1 = aftxt1
     c                   endif
      *
      * Hent firma-opplysninger dersom de skal printes ut
      *
     c     afirl1_key    chain     afirl1r
     c                   if        %found
     c                   eval      a1navn = aafnav
     c                   eval      a1adr1 = aafad1
     c                   eval      a1adr2 = aafad2
     c                   eval      a1sted = aafste
     c                   endif
      *
     c                   eval      a1tx1 = c_02
7.01  *
7.01  * Sjekk om vi skal bruke JASPER og XML generering av dokumenter
7.01 c                   if        l_poff = '1'
7.01 c                   eval      b_pdfp = *off
7.01 c                   eval      w_pdf = 0
7.01 c                   eval      w_pdf_ds = *blanks
7.01 c                   eval      w_ruti = l_ruti
7.01  *
7.01 c                   call      'AP609R'
7.01 c                   parm                    w_ruti
7.01 c                   parm                    w_pdf
7.01 c                   parm                    w_pdf_ds
7.01 c                   eval      d_pdf_ds = w_pdf_ds
7.01  * Vi skal kjøre med jasper
7.01 c                   if        w_pdf = 1 and
7.01 c                             %trim(d_xmlm) <> *blanks
7.01 c                   eval      p_mail = '0'
7.01 c                   eval      w_jkey = l_bach
7.01  * Hent inn xml templaten
7.01 c                   callp     GetHTMLIFS(d_xmlm :'<AS400>')
7.01 c                   callp     ClrHtmlBuffer
7.01  *
7.01  * Hent hvor xml'en skal ligge
7.01  *
7.01 c                   eval      XML_path = *blanks
7.01 c                   eval      XML_path = %trim(d_path)
7.01  *
7.01  * Finn path til logo
7.01  *
7.01 c                   eval      jasper_logo = *blanks
7.01 c                   eval      jasper_logo = %trim(d_logo)
7.01  *
7.01  * Jobbnummer er allerede generert i AP600R. Overføres i *lda
7.01  *
7.01 c                   time                    w_date
7.01  * Vi logger at utskriftprogrammet har startet
7.01 c                   eval      w_jstat = 10
7.01 c                   eval      w_jtext = 'Utskrift av EDI Pakkseddel har -
7.01 c                                        startet'
7.01 c                   call      'AB705R'
7.01 c                   parm                    l_bach
7.01 c                   parm                    w_jstat
7.01 c                   parm                    w_jtext
7.01  * Vi skriver xml for miljø formater
7.01 c                   exsr      xml_envm
7.01 c                   eval      b_pdfp = *on
7.01 c                   endif
7.01  * Hvis et eller annet er galt med parametrene, logges og kjør uten PROA
7.01 c                   if        %trim(d_xmlm) = *blanks
7.01 c                   eval      b_pdfp = *off
7.01  * Vi logger at noe er galt med parametrene
7.01 c                   eval      w_jstat = 20
7.01 c                   eval      w_jtext = 'Finner ikke path til xml !!! +
7.01 c                             Sjekk rutineregister !'
7.01 c                   call      'AB705R'
7.01 c                   parm                    l_bach
7.01 c                   parm                    w_jstat
7.01 c                   parm                    w_jtext
7.01 c                   endif
7.01  *
7.01 c                   else
7.01 c                   eval      b_pdfp = *off
7.01 c                   endif
      *
     c                   endsr
