     h datedit(*dmy.) option(*nodebugio)
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      * System. . . . . : ASOKON                                              *
6.30  * 210815 nho   Nytt program vedr summering Visma Business               *
7.01  * 180220 nho   Nytt brudd på avdeling                                   *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
7.01 fbqbwl2    if   e           k disk    rename(bqbwpfr:bqbwl2r)
     fra01l1    if   e           k disk    rename(ra01pfr:ra01l1r)
     fbobfut    o    e             disk    rename(bobfutr:bobfutl)
      *
     d w_belØ          s                   like(bfbelp)
     d w_belp          s                   like(bfbelp)
     d w_tell          s              1  0
      *
7.01 d bqbwl2_firm     s                   like(bffirm)
7.01 d bqbwl2_bdat     s                   like(bfbdat)
7.01 d bqbwl2_dkto     s                   like(bfdkto)
7.01 d bqbwl2_ckto     s                   like(bfckto)
7.01 d bqbwl2_bilk     s                   like(bfbilk)
7.01 d bqbwl2_davd     s                   like(bfdavd)
7.01 d bqbwl2_cavd     s                   like(bfcavd)
     d bqbwl2_dbkr     s                   like(bfdbkr)
     d ra01l1_firm     s                   like(raafir)
     d ra01l1_akod     s                   like(raakod)
610   *
610  d w_bdat          s                   like(bfbdat)
610  d w_dkto          s                   like(bfdkto)
610  d w_ckto          s                   like(bfckto)
610  d w_bilk          s                   like(bfbilk)
7.01 d w_davd          s                   like(bfdavd)
7.01 d w_cavd          s                   like(bfcavd)
610  d w_dbkr          s                   like(bfdbkr)
610   *
610  d x_dato          s                   like(bfbdat)
610  d x_kond          s                   like(bfdkto)
610  d x_konc          s                   like(bfckto)
610  d x_bilk          s                   like(bfbilk)
7.01 d x_davd          s                   like(bfdavd)
7.01 d x_cavd          s                   like(bfcavd)
610  d x_dbkr          s                   like(bfdbkr)
6.11 d                uds
6.11 d l_user                911    920
6.11 d l_firm                944    946  0
      *
      *
      * Key for fordelings-parametre
7.01 c     bqbwl2_key    klist
7.01 c                   kfld                    bqbwl2_firm
7.01 c                   kfld                    bqbwl2_bdat
7.01 c                   kfld                    bqbwl2_dbkr
7.01 c                   kfld                    bqbwl2_dkto
7.01 c                   kfld                    bqbwl2_ckto
7.01 c                   kfld                    bqbwl2_bilk
7.01 c                   kfld                    bqbwl2_davd
7.01 c                   kfld                    bqbwl2_cavd
      * Key for posisjonering på bilagskode
      *
     c     ra01l1_key    klist
     c                   kfld                    ra01l1_firm
     c                   kfld                    ra01l1_akod
      *
      /eject
610  c                   eval      ra01l1_firm = l_firm
      *
7.01 c                   eval      bqbwl2_firm = l_firm
7.01 c                   eval      bqbwl2_dkto = *zero
7.01 c                   eval      bqbwl2_ckto = *zero
7.01 c                   eval      bqbwl2_bilk = *zero
7.01 c                   eval      bqbwl2_dbkr = *blank
7.01 c                   eval      bqbwl2_davd = *zero
7.01 c                   eval      bqbwl2_cavd = *zero
      *
7.01 c     bqbwl2_key    setll     bqbwl2
610   **********************************************************************
     c     nyles         tag
610   *
7.01 c                   read      bqbwl2                                 15
610   *
     c                   eval      w_belp = bfbelp
610   * Eof
610  c                   if        *in15  = '1'
610  c                   move      *on           *inlr
610  c                   goto      ut
610  c                   endif
      *
      * Test på inneværend firma
      *
7.01 c                   if        bqbwl2_firm <> bffirm
610  c                   move      *on           *inlr
610  c                   goto      ut
610  c                   endif
610   *
      * Ta vare på brudd første gang
610  c                   if        w_tell = 0
     c                   eval      w_bdat = bfbdat
     c                   eval      w_dkto = bfdkto
     c                   eval      w_ckto = bfckto
     c                   eval      w_bilk = bfbilk
7.01 c                   eval      w_davd = bfdavd
7.01 c                   eval      w_cavd = bfcavd
     c                   eval      w_dbkr = bfdbkr
610  c                   eval      w_tell = 1
     c                   eval      x_dato = bfbdat
     c                   eval      x_kond = bfdkto
     c                   eval      x_konc = bfckto
     c                   eval      x_bilk = bfbilk
7.01 c                   eval      x_davd = bfdavd
7.01 c                   eval      x_cavd = bfcavd
     c                   eval      x_dbkr = bfdbkr
610  c                   endif
6.10  *
      * Sjekk om brudd på bilagsdato
     c
6.10 c                   if        w_bdat <>  bfbdat
610  c                   eval      x_bilk = bfbilk
7.01 c                   eval      x_davd = bfdavd
7.01 c                   eval      x_cavd = bfcavd
610  c                   eval      x_kond = bfdkto
610  c                   eval      x_konc = bfckto
610  c                   eval      x_dato = bfbdat
610  c                   eval      x_dbkr = bfdbkr
      *
7.01 c                   readp     bqbwl2                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
      *
     c                   eval      bfbelp =  w_belØ
     c                   write     bobfutl
7.01 c                   read      bqbwl2                                 15
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
      *
     c                   eval      bfdbkr = x_dbkr
     c                   eval      w_dbkr = bfdbkr
     c                   eval      bfbilk = x_bilk
     c                   eval      w_bilk = bfbilk
7.01 c                   eval      bfdavd = x_davd
7.01 c                   eval      w_davd = bfdavd
7.01 c                   eval      bfcavd = x_cavd
7.01 c                   eval      w_cavd = bfcavd
     c                   eval      bfdkto = x_kond
     c                   eval      w_dkto = bfdkto
     c                   eval      bfckto = x_konc
     c                   eval      w_ckto = bfckto
     c                   eval      bfbdat = x_dato
     c                   eval      w_bdat = bfbdat
      *
     c                   eval      w_bdat = bfbdat
     c                   eval      w_dkto = bfdkto
     c                   eval      w_ckto = bfckto
     c                   eval      w_bilk = bfbilk
7.01 c                   eval      w_davd = bfdavd
7.01 c                   eval      w_cavd = bfcavd
     c                   eval      w_dbkr = bfdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
610   *
      * Sjekk om brudd på Debet/Kredit
     c
6.10 c                   if        w_dbkr <>  bfdbkr
610  c                   eval      x_dbkr = bfdbkr
610  c                   eval      x_bilk = bfbilk
7.01 c                   eval      x_davd = bfdavd
7.01 c                   eval      x_cavd = bfcavd
610  c                   eval      x_kond = bfdkto
610  c                   eval      x_konc = bfckto
7.01 c                   readp     bqbwl2                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
     c                   eval      bfbelp =  w_belØ
     c                   write     bobfutl
7.01 c                   read      bqbwl2                                 15
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
     c                   eval      bfdbkr = x_dbkr
     c                   eval      w_dbkr = bfdbkr
     c                   eval      w_dkto = bfdkto
     c                   eval      w_ckto = bfckto
     c                   eval      w_bilk = bfbilk
7.01 c                   eval      w_davd = bfdavd
7.01 c                   eval      w_cavd = bfcavd
     c                   goto      nyles
6.10 c                   endif
610   *
      * Sjekk om brudd på konto /debet
     c
6.10 c                   if        w_dkto <>  bfdkto
610  c                   eval      x_dbkr = bfdbkr
610  c                   eval      x_bilk = bfbilk
610  c                   eval      x_kond = bfdkto
610  c                   eval      x_konc = bfckto
7.01 c                   eval      x_davd = bfdavd
7.01 c                   eval      x_cavd = bfcavd
      *
7.01 c                   readp     bqbwl2                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
      *
     c                   eval      bfbelp =  w_belØ
     c                   write     bobfutl
7.01 c                   read      bqbwl2                                 15
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
      *
     c                   eval      bfdbkr = x_dbkr
     c                   eval      w_dbkr = bfdbkr
     c                   eval      bfbilk = x_bilk
     c                   eval      w_bilk = bfbilk
7.01 c                   eval      bfdavd = x_davd
7.01 c                   eval      w_davd = bfdavd
7.01 c                   eval      bfcavd = x_cavd
7.01 c                   eval      w_cavd = bfcavd
     c                   eval      bfdkto = x_kond
     c                   eval      w_dkto = bfdkto
     c                   eval      bfckto = x_konc
     c                   eval      w_ckto = bfckto
      *
     c                   eval      w_dkto = bfdkto
     c                   eval      w_ckto = bfckto
     c                   eval      w_bilk = bfbilk
     c                   eval      w_dbkr = bfdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
610   *
      * Sjekk om brudd på konto /kredit
     c
6.10 c                   if        w_ckto <>  bfckto
610  c                   eval      x_dbkr = bfdbkr
610  c                   eval      x_bilk = bfbilk
610  c                   eval      x_kond = bfdkto
610  c                   eval      x_konc = bfckto
7.01 c                   eval      x_davd = bfdavd
7.01 c                   eval      x_cavd = bfcavd
      *
7.01 c                   readp     bqbwl2                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
      *
     c                   eval      bfbelp =  w_belØ
     c                   write     bobfutl
7.01 c                   read      bqbwl2                                 15
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
      *
     c                   eval      bfdbkr = x_dbkr
     c                   eval      w_dbkr = bfdbkr
     c                   eval      bfbilk = x_bilk
     c                   eval      w_bilk = bfbilk
7.01 c                   eval      bfdavd = x_davd
7.01 c                   eval      w_davd = bfdavd
7.01 c                   eval      bfcavd = x_cavd
7.01 c                   eval      w_cavd = bfcavd
     c                   eval      bfdkto = x_kond
     c                   eval      w_dkto = bfdkto
     c                   eval      bfckto = x_konc
     c                   eval      w_ckto = bfckto
      *
     c                   eval      w_dkto = bfdkto
     c                   eval      w_ckto = bfckto
     c                   eval      w_bilk = bfbilk
     c                   eval      w_dbkr = bfdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
7.01  * Sjekk om brudd på debet avdeling
7.01 c
7.01 c                   if        w_davd <>  bfdavd
7.01 c                   eval      x_davd = bfdavd
7.01 c                   eval      x_dbkr = bfdbkr
7.01 c                   readp     bqbwl2                                 15
7.01 c                   eval      ra01l1_akod = bfbilk
7.01 c     ra01l1_key    chain     ra01l1
7.01 c                   eval      bftext = raatxt
7.01 c                   eval      bfbelp =  w_belØ
7.01 c                   write     bobfutl
7.01 c                   read      bqbwl2                                 15
7.01 c                   eval      w_belØ = *zero
7.01 c                   z-add     w_belp        w_belØ
7.01 c                   eval      bfdavd = x_davd
7.01 c                   eval      w_davd = bfdavd
7.01 c                   eval      bfdbkr = x_dbkr
7.01 c                   eval      w_dbkr = bfdbkr
7.01 c                   goto      nyles
7.01 c                   endif
610   *
7.01  * Sjekk om brudd på kredit avdeling
7.01 c
7.01 c                   if        w_cavd <>  bfcavd
7.01 c                   eval      x_cavd = bfcavd
7.01 c                   eval      x_dbkr = bfdbkr
7.01 c                   readp     bqbwl2                                 15
7.01 c                   eval      ra01l1_akod = bfbilk
7.01 c     ra01l1_key    chain     ra01l1
7.01 c                   eval      bftext = raatxt
7.01 c                   eval      bfbelp =  w_belØ
7.01 c                   write     bobfutl
7.01 c                   read      bqbwl2                                 15
7.01 c                   eval      w_belØ = *zero
7.01 c                   z-add     w_belp        w_belØ
7.01 c                   eval      bfcavd = x_cavd
7.01 c                   eval      w_cavd = bfcavd
7.01 c                   eval      bfdbkr = x_dbkr
7.01 c                   eval      w_dbkr = bfdbkr
7.01 c                   goto      nyles
7.01 c                   endif
610   *
      * Sjekk om brudd på bilagskode
     c
6.10 c                   if        w_bilk <>  bfbilk
610  c                   eval      x_bilk = bfbilk
610  c                   eval      x_dbkr = bfdbkr
7.01 c                   readp     bqbwl2                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
     c                   eval      bfbelp =  w_belØ
     c                   write     bobfutl
7.01 c                   read      bqbwl2                                 15
     c                   eval      w_belØ = *zero
6.10 c                   z-add     w_belp        w_belØ
     c                   eval      bfbilk = x_bilk
     c                   eval      w_bilk = bfbilk
     c                   eval      bfdbkr = x_dbkr
     c                   eval      w_dbkr = bfdbkr
     c                   goto      nyles
6.10 c                   endif
610   *
     c                   add       bfbelp        w_belØ
      *
      ******************************************************
      *  AVSLUTT DENNE TRANS                               *
      ******************************************************
      *
     c     ut            tag
610  c                   if        *inlr = '0'
610  c                   goto      nyles
610  c                   endif
      *
     c                   if        *inlr  =  '1'   and
     c                             w_belØ > 0
7.01 c                   readp     bqbwl2                                 15
     c                   eval      ra01l1_akod = bfbilk
     c     ra01l1_key    chain     ra01l1
     c                   eval      bftext = raatxt
     c                   eval      bfbelp =  w_belØ
     c                   write     bobfutl
610  c                   endif
      *
     c/eject
      *
