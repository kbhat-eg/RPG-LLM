# RPG Program Explanation

This ILE RPG program, AG900R, is designed to **create or update an SQL table** by modifying "source" lines in a file called `QSQLSRC`, specifically replacing a placeholder value with a given library name passed as a parameter. Hereâ€™s a breakdown of the code to help you get oriented:

---

## Header Specifications

```rpg
h option(*nodebugio) datedit(*dmy)
```
- `option(*nodebugio)` disables debug I/O support.
- `dateedit(*dmy)` sets the default date format to day/month/year.

---

## File Declarations

```rpg
fqsqlsrc   uf   e           k disk
```
- Declares the `QSQLSRC` file for **Update** (`u`), **Full procedural** (`f`), **Externally described** (`e`), with keyed access (`k`).  
- This is a source physical file, typically holding SQL source statements.

---

## Data Definitions

### Parameters

```rpg
d p_dlib          s              6
```
- `p_dlib`: Holds the library name (6 characters).

### Working Variables

```rpg
d w_posi          s              2  0
```
- `w_posi`: Used to store found position of the string 'ADBSQL' in the source line (2 digits, no decimals).

---

## Main Program Logic

### 1. Read and Process Records

```rpg
c                   read      qsqlsrc
c                   dow       not %eof
```
- Reads each record from `QSQLSRC` until end-of-file.

### 2. Search for 'ADBSQL' Placeholder

```rpg
c                   eval      w_posi = %scan('ADBSQL':srcdta)
c                   if        w_posi > 0
```
- Searches for the string `'ADBSQL'` in the current source line (`srcdta`).
- If found (`w_posi > 0`), proceeds to update.

### 3. Replace Placeholder with Library Name

```rpg
c                   eval      srcdta = %subst(srcdta:1:w_posi-1) +
c                                      p_dlib +
c                                      %subst(srcdta:w_posi+6:75-w_posi)
c                   update    frfotil
```
- Replaces `'ADBSQL'` with the passed-in library name (`p_dlib`):
    - Keeps everything before `'ADBSQL'`.
    - Inserts the library name.
    - Keeps everything after the `'ADBSQL'` string (which is 6 characters long).
- Updates the record in the file (field name `frfotil`).

### 4. Read Next Record

```rpg
c                   read      qsqlsrc
c                   enddo
```
- Continues until all records processed.

---

## Program Termination

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Marks the end of the program.
- Sets the last record indicator (`*inlr`) to on, closing files and cleaning up.
- Returns control to the caller.

---

## Initialization Subroutine

```rpg
c     *inzsr        begsr
...
c     *entry        plist
c                   parm                    p_dlib
c                   endsr
```
- Subroutine `*inzsr` runs at program start.
- Defines parameter list (`*entry plist`) for incoming parameters.
- `p_dlib` receives the library name to substitute into the source.

---

## Summary

- **Purpose:** This RPG program scans each record in a source file (QSQLSRC). For any source line containing `'ADBSQL'`, it replaces that string with an input library name and updates the record in place.
- **Input:** The replacement library name is passed as a parameter.
- **Usage:** Typically used to "personalize" SQL source members by plugging in the correct library before running SQL.

---

## Concepts Demonstrated

- Use of file I/O in RPG
- String searching and substitution
- Parameter passing via `plist`
- File update mechanics
- Structured program flow (main loop, subroutine, cleanup)