# Program Documentation: LL840R

## Overview

**Program:** LL840R  
**System:** ASLAGR  
**Description:** Parameter entry for deleting inventory records (Sletter lagerposteer, Parameterinntasting)

This program is a workstation (interactive) RPG application that facilitates the controlled deletion of inventory records. It presents a parameter entry screen, validates user choices, confirms deletion actions, and then invokes the next step in the process, passing along the selected parameters.

The business logic enforces restrictions on certain deletion options and guides the user through a confirmation process before any deletions are executed.

---

## File and Data Definitions

### Display File

- **ll840d**: Workstation file used for user interaction (screen display and input).

### Data Structures

- **d_prec (64A):**  
  Used as a buffer for passing parameters between programs.  
  Overlaid subfields:
    - d_val1 (1,0): Option 1 selection
    - d_val2 (1,0): Option 2 selection
    - d_val3 (1,0): Option 3 selection
    - d_val4 (1,0): Option 4 selection
    - d_lage (2,0): Warehouse/location input

- **Local Data Area (LDA) Overlays:**  
  Not used in this program logic but reserved for company and name info:
    - l_firm (positions 944-946)
    - l_fnav (positions 951-980)

### Standalone Variables

- **w_valg (1A):**  
  Used to indicate whether the job should be submitted to batch (F10) or processed interactively.

- **w_mld1 (50A):**  
  Message text for user feedback (e.g., when an option is disallowed).

---

## Main Program Flow

### 1. Initialization

- Control options:  
  - `datedit(*dmy)`: Date format
  - `option(*nodebugio)`: No debug I/O

- The program begins at label `b1tag`, where all option-related variables (`b1val1`-`b1val4`, `b1lage`) are initialized to zero.

---

### 2. Parameter Entry Screen

- **Label:** `b1tagb`
- **Screen Format:** `b1bld`  
  The user is presented with a screen to enter/select deletion parameters.

#### Special Keys Handling

- **F3 (Exit):**  
  If pressed (`*INKC`), the program jumps to `end_pgm` and exits.

#### Option 1 Restriction (Business Rule)

- If the user selects option 1 (`b1val1 = 1`):
    - The program prevents this choice (business restriction as per change 6.10).
    - Displays a message (`w_mld1 = 'Kan ikke slette lagerposter på dette punktet'`) via a call to message program `AA005R`.
    - Returns to the parameter entry screen (`goto b1taga`).

---

### 3. Validation of Selections

- If **no options** are selected (all `b1val1`-`b1val4` = 0), the program exits immediately (`goto end_pgm`).

---

### 4. Confirmation Screen

- Prepares confirmation text (`d1tek1`, `d1tek2`, `d1tek3`) based on selected options:
    - Option 3: "alle poster på lager" (all records in inventory)
    - Option 1: "poster som ikke er varetype L" (records not of item type 'L')
    - Option 2: "poster som mangler i varereg." (records missing in item registry)
    - Option 4: "alle poster i historisk lagerbok" (all records in historical inventory book)
- Sets `d1lage` to the selected warehouse/location.
- Displays confirmation window (`d1win`).

#### Confirmation Keys

- **F3/F12:**  
  If pressed (`*INKC` or `*INKL`), returns to parameter entry.

---

### 5. Parameter Packing and Next Step

- User selections are packed into the `d_prec` data structure.
- Determines if the job should be submitted to batch (`*INKJ` key, sets `w_valg` to '1') or run interactively ('0').

#### Call to Next Program

- Calls program **LL842C** (likely a CL program) with:
    - `d_prec` (packed parameters)
    - `w_valg` (batch/interactive indicator)

---

### 6. Program Exit

- **Label:** `end_pgm`
- Sets LR (`*INLR = *ON`) and returns.

---

## Subroutines

- **\*INZSR:**  
  Initialization subroutine, currently empty (reserved for future use or standardization).

---

## Design and Business Logic Notes

- **Option Restriction:**  
  The program enforces a business rule (change 6.10) by disallowing option 1, providing user feedback, and preventing further processing with this option.

- **Parameter Passing:**  
  Parameters are packed into a single buffer (`d_prec`) for easy passing between programs, a common pattern in this codebase.

- **Screen Navigation:**  
  Uses labels and `goto` statements for screen flow control, typical for legacy interactive RPG programs.

- **User Confirmation:**  
  All destructive actions (deletions) require explicit user confirmation, with a summary of actions to be taken.

- **Modular Processing:**  
  The actual deletion logic is not in this program but is delegated to `LL842C`, which receives all necessary parameters.

- **Message Handling:**  
  User messages are handled via a call to a common message program (`AA005R`), ensuring consistent user communication.

---

## External Interactions

- **Display File (`ll840d`):**  
  Handles all user interaction.

- **Program `AA005R`:**  
  Used for displaying messages to the user.

- **Program `LL842C`:**  
  Receives parameters and executes the deletion process (not shown here).

---

## Summary

LL840R is the parameter entry and validation front-end for an inventory deletion process. It enforces business rules, secures user confirmation, and passes control and parameters to the backend process. The code is structured for clarity in user interaction and business rule enforcement, with modular delegation to other programs for message handling and actual data processing.