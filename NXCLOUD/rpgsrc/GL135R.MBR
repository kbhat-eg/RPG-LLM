      /TITLE  ASOKON Spørring på mottakskvittering
     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      * System  . . . . : ASOKON                                        *
      * Program . . . . : GL135R                                        *
      * Beskrivelse . . : Spørring på overføringer til banken           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      * Spesialversjon. :                                               *
      * Tilpasset for . :                                               *
      *                                                                 *
      * Referanse  Dato   Endringsbeskrivelse                      Sign.*
      * --------- ------  ----------------------------------------------*
      *           201205  Nytt program.                            RH   *
      *                                                                 *
      *                                                                 *
      *                                                                 *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *                                                                 *
      *  BRUK AV INDIKATORER                                            *
      *                                                                 *
      *       KC = F3  = Exit                                           *
      *       KE = F5  = Forny                                          *
      *       KL = F12 = Annuller                                       *
      *                                                                 *
      *       LR = Avslutt program                                      *
      *   SUBFILE-1:                                                    *
      *       10 = Roll                                                 *
      *       12 = Sfldsp                                               *
      *       13 = Sfldspctl                                            *
      *       14 = Sflclr                                               *
      *       15 = Sflend                                               *
      *       16 = Readc 16 on, no more records                         *
      *    30-59 = Varsle m/feilmeldinger/skjermindikatorer             *
      *    60-69 = Fileindikatorer chain etc.                           *
      *    70-79 = Arbeidsindikatorer i sub-rutiner                     *
      *    80-89 = Arbeidsindikatorer ordinære                          *
      *    90-99 = Benyttes ved std. sub-rutiner                        *
      *                                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     fgl135d    cf   e             workstn
     f                                     sfile(b1sfl:srrn01)
     fgbtrl2    if   e           k disk
      *
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Definering av felter                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      *     nn - er 01 for subfile 01,
      *             02 for subfile 02,
      *             03 for subfile 03, o.s.v.
      * SRRNnn - Relativt recordnummer i subfile
      * SPGEnn - Sidestørrelse i subfile (page)
      * SFRNnn - Første recordnummer på siden
      * SSRNnn - Siste  recordnummer på siden
      * SVRNnn - Vis den side som inneholder denne record.
      *
      * Forklaring på spesielle felter
      * som benyttes ved windows.
      * - - - - - - - - - - - - - - - - -
      *
      * w_arow - Actual line, angir startlinje for vindu.
      * w_acol - Actual posision, angir startposisjon for vindu.
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      *
      * B1SFL  - B1 Subfile - record
      * B2CTL  - B2 Subfile - control record - Mottatte transaksjoner
      * B2CMD  - B2 Eget skjermbilde for CMD-taster
      * C1SFL  - C1 Subfile - record
      * C2CTL  - C2 Subfile - control record - Viser RECORD ("rådump").
      * C2CMD  - C2 Eget skjermbilde for CMD-taster
      * D1WSF  - C1 Subfile window - record
      * D2WCT  - C2 Subfile window - control record - Til oppdatering.
      * D2CMD  - C2 Eget skjermbilde for CMD-taster - Window definisjon
      *
      /EJECT
      *
      * Henter firmanavn.
      *
     d                uds
     d dsuser                911    920
     d dsfgrp                931    933
     d dsfirm                944    946  0
     d dsfnav                951    980
      /EJECT
      *
      * Datastruktur_1 for dato:
      *
     d                 ds
     d wpdato                         8  0
     d  wpdatÅ                        4  0 overlay(wpdato)
     d  wpdatm                        2  0 overlay(wpdato:5)
     d  wpdatd                        2  0 overlay(wpdato:7)
      *
      * Datastruktur_2 for dato:
      *
     d                 ds
     d wpdat2                         8  0
     d  wpda2Å                        4  0 overlay(wpdat2)
     d  wpda2m                        2  0 overlay(wpdat2:5)
     d  wpda2d                        2  0 overlay(wpdat2:7)
      *
      * Datastruktur for record:
      *
     d                 ds
     d wpreco                        80
     d  wpbetf                        8    overlay(wpreco:41)
     d  wpfbel                       15  2 overlay(wpreco:18)
     d  wplbel                       15  2 overlay(wpreco:42)
      *---------------------------------------------------------------------
      * Stand Alone Fields - TOP
      *---------------------------------------------------------------------
     d sfrn01          s                   like(srrn01)
     d spge01          s              3  0
     d srrn01          s              4  0
     d ssrn01          s                   like(srrn01)
     d w_arow          s              2  0
     d w_acol          s              3  0
     d wpfelt          s              1
     d wpslet          s              2
      *
     d s               s              5  0 dim(12)
     d sum             s             11  2 dim(12)
     d mnd             s             15    dim(12) ctdata perrcd(1)
     d wpfgrp          s              3
     d wpfirm          s              3  0
     d w_firm          s              3
     d wpfnav          s             30
     d i               s              2  0
     d wptype          s              3
     d wpanta          s              6  0
      *---------------------------------------------------------------------
      * Stand Alone Fields - BOTTOM
      *---------------------------------------------------------------------
      *
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * B2CTL Behandle åpningsbildet med subfile                        *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Fyll opp subfile:
      *
     c                   exsr      xcrt01
      *
      * Send Alt
      *
     c     b2taga        tag
      *
     c                   write     b2cmd
      *
      * Bare data
      *
     c     b2tagb        tag
      *
     c                   exsr      xdsp01
      *
      * F3=Avslutt program i fra subfile program.
      *
     c     *inkc         cabeq     *on           xslutt
      *
      * Vis filgruppe/firma:                                 . .
      *                                                        .
     c                   exsr      xclr01
     c                   exsr      xcrt01
     c                   goto      b2taga
      *
      * Forny
      *
     c                   if        *inke = *on
     c                   exsr      xforny
     c                   goto      b2taga
     c                   endif
      *
      * Roll
      *
     c                   if        *in10 = *on
     c                   exsr      xcrt01
     c                   goto      b2tagb
     c                   endif
      *
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Behandling av subfile                                           *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
      * Sjekk om valg
      * er foretatt i
      * subfile
      *
     c                   do        ssrn01
     c                   readc     b1sfl                                  16
      *                                                                 .
     c                   if        *in16 = *on
     c                   leave
     c                   endif
      *                                                                 .
     c                   enddo
      *
     c                   goto      b2taga
      *
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Avslutt program                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Les subfile på nytt:                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xforny        begsr
      *
      * Vis alle:                                              .
     c                   movel     dsfgrp        wpfgrp
     c                   eval      wpfirm = dsfirm
      *
     c                   exsr      xclr01
     c                   exsr      xcrt01
      *
     c                   endsr
      *
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Tøm subfile - 1                                                 *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xclr01        begsr
     c                   move      *on           *in14
     c                   write     b2ctl
     c                   move      *off          *in14
      *
     c                   move      *off          *in15
     c                   eval      srrn01 = 0
     c                   eval      sfrn01 = 0
     c                   eval      ssrn01 = 0
     c                   eval      spge01 = 0
      *
     c                   endsr
      *
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Fyll opp subfile - 1                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xcrt01        begsr
     c                   eval      spge01 = spge01 + 12
     c                   eval      srrn01 = ssrn01
      *                                                                 .
      *    Fyller opp variable:                                         .
      *                                                                 .
     c                   eval      b1tota = *zeros
     c                   eval      s = *zeros
     c                   eval      sum = *zeros
     c                   eval      a1tota = *zeros
     c                   movel     a1aar         wpdato
     c                   move      0101          wpdato
     c                   movel     a1fgrp        wpfgrp
     c                   eval      wpfirm = a1firm
     c                   movel     *blanks       wpfnav
     c                   movel     a1fnav        wpfnav
     c                   movel     wpfirm        w_firm
      *                                                                 .
      * Henter firmanavn:                                               .
      *                                                                 .
     c                   call      'GL136C'
     c                   parm                    wpfgrp
     c                   parm                    w_firm
     c                   parm                    wpfnav
      *                                                                 .
     c                   movel     wpfnav        a1fnav
      *                                                                 .
     c                   exsr      xlestf1
     c                   exsr      xlestl1
      *
     c                   eval      i = 1
     c                   dou       srrn01 = spge01
      *
     c     i             do        12
      * Display felter:                                                 .
     c                   eval      srrn01 = srrn01 + 1
     c                   eval      b1mfgr = wpfgrp
     c                   eval      b1mfir = wpfirm
     c                   movel     a1aar         b1dato
     c                   move      i             b1dato
     c                   eval      b1anta = s(i)
     c                   eval      b1tots = 999
     c                   eval      b1tots = 999
      *                                                                 .
     c                   movel     mnd(i)        b1komm
      *                                                                 .
     c                   eval      b1tota = b1tota + b1anta
      *                                                                 .
     c                   write     b1sfl
     c                   eval      i = i + 1
      *                                                                 .
     c                   if        i     = 13
     c                   goto      xend01
     c                   endif
      *                                                                 .
     c                   enddo
     c                   enddo
      *
     c     xend01        tag
      *
     c                   if        srrn01 > ssrn01
     c                   eval      sfrn01 = ssrn01 + 1
     c                   endif
      *
     c                   eval      ssrn01 = srrn01
     c                   eval      w_virn = sfrn01
      *
     c                   endsr
      *
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Les BETFOR23 poster:                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xlestf1       begsr
      *                                                                 .
      * Starter å lese TF1, dvs 1. gangsreturer:
      *
     c                   movel     'TF1'         wptype
      *
      * Posisjonerer med dato:
      *
     c     key01         setll     gbtrl2
      *
      * Leser med FILGR, FIRM og TYPE:
      *
     c     key02         reade     gbtrl2                                 60
      *
      * Hopper ut dersom feil år, eller ved EOF:
      *
     c                   movel     gfdato        wpdat2
     c     wpda2Å        cabne     a1aar         xenda1
     c     *in60         cabeq     *on           xenda1
      *                                                                 .
     c                   dou       *in60  = *on
      *                                                                 .
      * Skal kun lese BETFOR23:                                         .
      *                                                                 .
     c                   movel     gfreco        wpreco
      *                                                                 .
     c                   if        wpbetf = 'BETFOR23'
      * Januar:                                                         .
     c                   if        wpdatm = 01
     c                   add       1             s(1)
     c                   add       1             a1tota
     c                   endif
      * Februar                                                         .
     c                   if        wpdatm = 02
     c                   add       1             s(2)
     c                   add       1             a1tota
     c                   endif
      * Mars:                                                           .
     c                   if        wpdatm = 03
     c                   add       1             s(3)
     c                   add       1             a1tota
     c                   endif
      * April:                                                          .
     c                   if        wpdatm = 04
     c                   add       1             s(4)
     c                   add       1             a1tota
     c                   endif
      * Mai:                                                            .
     c                   if        wpdatm = 05
     c                   add       1             s(5)
     c                   add       1             a1tota
     c                   endif
      * Juni:                                                           .
     c                   if        wpdatm = 06
     c                   add       1             s(6)
     c                   add       1             a1tota
     c                   endif
      * Juli:                                                           .
     c                   if        wpdatm = 07
     c                   add       1             s(7)
     c                   add       1             a1tota
     c                   endif
      * August:                                                         .
     c                   if        wpdatm = 08
     c                   add       1             s(8)
     c                   add       1             a1tota
     c                   endif
      * September:                                                      .
     c                   if        wpdatm = 09
     c                   add       1             s(9)
     c                   add       1             a1tota
     c                   endif
      * Oktober:                                                        .
     c                   if        wpdatm = 10
     c                   add       1             s(10)
     c                   add       1             a1tota
     c                   endif
      * November:                                                       .
     c                   if        wpdatm = 11
     c                   add       1             s(11)
     c                   add       1             a1tota
     c                   endif
      * Desember:                                                       .
     c                   if        wpdatm = 12
     c                   add       1             s(12)
     c                   add       1             a1tota
     c                   endif
      *                                                                 .
     c                   endif
      *
     c     key02         reade     gbtrl2                                 60
      *
     c                   movel     gfdato        wpdato
     c     wpdatÅ        cabne     a1aar         xenda1
      *                                                                 .
     c                   enddo
      *
     c     xenda1        tag
      *
     c                   endsr
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Les BETFOR22 poster:                                            *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xlestl1       begsr
      *                                                                 .
      * Starter å lese TL1, dvs 1. gangsreturer Lønn:
      *
     c                   movel     'TL1'         wptype
      *
      * Posisjonerer med dato:
      *
     c     key01         setll     gbtrl2
      *
      * Leser med FILGR, FIRM og TYPE:
      *
     c     key02         reade     gbtrl2                                 60
      *
      * Hopper ut dersom feil år, eller ved EOF:
      *
     c                   movel     gfdato        wpdato
     c     wpdatÅ        cabne     a1aar         xenda2
     c     *in60         cabeq     *on           xenda2
      *                                                                 .
     c                   dou       *in60  = *on
      *                                                                 .
      * Skal kun lese BETFOR22:                                         .
      *                                                                 .
     c                   movel     gfreco        wpreco
      *                                                                 .
     c                   if        wpbetf = 'BETFOR22'
      * Januar:                                                         .
     c                   if        wpdatm = 01
     c                   add       1             s(1)
     c                   add       1             a1tota
     c                   endif
      * Februar                                                         .
     c                   if        wpdatm = 02
     c                   add       1             s(2)
     c                   add       1             a1tota
     c                   endif
      * Mars:                                                           .
     c                   if        wpdatm = 03
     c                   add       1             s(3)
     c                   add       1             a1tota
     c                   endif
      * April:                                                          .
     c                   if        wpdatm = 04
     c                   add       1             s(4)
     c                   add       1             a1tota
     c                   endif
      * Mai:                                                            .
     c                   if        wpdatm = 05
     c                   add       1             s(5)
     c                   add       1             a1tota
     c                   endif
      * Juni:                                                           .
     c                   if        wpdatm = 06
     c                   add       1             s(6)
     c                   add       1             a1tota
     c                   endif
      * Juli:                                                           .
     c                   if        wpdatm = 07
     c                   add       1             s(7)
     c                   add       1             a1tota
     c                   endif
      * August:                                                         .
     c                   if        wpdatm = 08
     c                   add       1             s(8)
     c                   add       1             a1tota
     c                   endif
      * September:                                                      .
     c                   if        wpdatm = 09
     c                   add       1             s(9)
     c                   add       1             a1tota
     c                   endif
      * Oktober:                                                        .
     c                   if        wpdatm = 10
     c                   add       1             s(10)
     c                   add       1             a1tota
     c                   endif
      * November:                                                       .
     c                   if        wpdatm = 11
     c                   add       1             s(11)
     c                   add       1             a1tota
     c                   endif
      * Desember:                                                       .
     c                   if        wpdatm = 12
     c                   add       1             s(12)
     c                   add       1             a1tota
     c                   endif
      *                                                                 .
     c                   endif
      *
     c     key02         reade     gbtrl2                                 60
      *
     c                   movel     gfdato        wpdato
     c     wpdatÅ        cabne     a1aar         xenda2
      *                                                                 .
     c                   enddo
      *
     c     xenda2        tag
      *
     c                   endsr
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Display subfile - 1                                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     xdsp01        begsr
      *
     c                   if        srrn01 <> 0
     c                   move      *on           *in12
     c                   endif
      *
     c                   move      *on           *in13
     c                   exfmt     b2ctl
     c                   move      *off          *in12
     c                   move      *off          *in13
      *
     c                   endsr
      *
      /EJECT
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
      * Initierer hjelpefelt:
      *
     c                   eval      spge01 = 0
     c                   eval      srrn01 = 0
     c                   eval      wpfelt = *blank
     c                   eval      wpslet = *blanks
     c                   eval      w_arow = 4
     c                   eval      w_acol = 39
      *
     c                   movel     dsfgrp        a1fgrp
     c                   movel     a1fgrp        wpfgrp
     c                   eval      a1firm = dsfirm
     c                   eval      wpfirm = dsfirm
     c                   movel     dsfnav        a1fnav
      *
     c                   eval      a1aar  = uyear
     c                   eval      a1aar  = a1aar + 2000
     c                   eval      wpdato = uyear
     c                   move      0101          wpdato
      *
      * Key til bruk på GBTRL2:
      *
     c     key01         klist
     c                   kfld                    wpfgrp
     c                   kfld                    wpfirm
     c                   kfld                    wptype
     c                   kfld                    wpdato
      *
      * Key til bruk på GBTRL2:
      *
     c     key02         klist
     c                   kfld                    wpfgrp
     c                   kfld                    wpfirm
     c                   kfld                    wptype
     c                   endsr
**
Januar
Februar
Mars
April
Mai
Juni
Juli
August
September
Oktober
November
Desember
