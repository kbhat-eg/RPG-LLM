## Program Overview

**Program Name:** SF610R  
**System:** ASSTAT  
**Purpose:** Copies parameters from the parameter register (`SKPML1`) to a working file (`SKPWPF`).  
**Domain:** Parameter management for company-specific processes.

---

## High-Level Functionality

The program reads parameter records from the `SKPML1` file (parameter register) based on a composite key (company and type), and writes selected fields to the `SKPWPF` working file. This is typically done to stage or prepare data for further processing by other jobs or modules.

---

## File Definitions

- **SKPML1** (Input, keyed, external, renamed as `skpml1r`, prefix `x:`)
  - Holds parameter records.
  - Accessed in keyed order using a composite key (company/type).
  - Fields from this file are referenced with `x` prefix (e.g., `xpfirm`, `xptype`).

- **SKPWPF** (Output, keyed, external, renamed as `skpwpfr`)
  - Acts as a working file for staged parameters.
  - Records are written here with selected fields copied from `SKPML1`.

---

## Data Area Usage

- Uses the local data area (LDA) to retrieve:
  - `l_user` (positions 911–920): Current user ID (not used in logic here).
  - `l_firm` (positions 944–946): Company number, used as part of the key.
  - `l_navn` (positions 951–980): User name (not used in logic here).

---

## Variable Definitions

- `w_firm`: Local variable, same type as `spfirm`, used to store company number from LDA.
- `w_type`: Local variable, same type as `sptype`, used to store parameter type from input parameter.

---

## Program Flow

### 1. Initialization (`*INZSR` Subroutine)

- Receives one parameter on entry: `p_type` (parameter type).
- Sets `w_type` to the input parameter value.
- Sets `w_firm` to the company number from LDA (`l_firm`).
- Builds the key list `skpml1_key` for the parameter register using `w_firm` and `w_type`.

### 2. Main Processing Loop

- Positions to the first relevant record in `SKPML1` using the composite key (`skpml1_key`).
- Reads records matching the key (`reade skpml1r` with indicator 61).
- For each record found:
  - Maps fields from the input record (with `x` prefix) to output fields:
    - `spfirm = xpfirm`
    - `sptype = xptype`
    - `spkode = xpkode`
    - `spvalg = xpvalg`
    - `sprest = xprest`
    - `spsyst = xpsyst`
  - Writes the mapped record to `SKPWPF`.
  - Continues reading next matching record.
- Loop ends when no more matching records (`*in61 = *on`).

### 3. Program Termination

- Sets LR indicator (`*INLR = *ON`) to close files and end the program.
- Returns control.

---

## Business/Domain-Specific Logic

- **Company-Specific Parameters:** The program is designed to handle parameters that can vary by company (`firma`). The correction noted in the comments (V5.60 220109) refers to a bug fix for cases where the company number is not `000`.
- **Parameter Staging:** This is a staging or copying routine, not a transformation or calculation. The main business logic is to ensure that only parameters for the current company and type are copied to the working file.
- **Local Data Area Dependency:** The company number is read from a specific position in the LDA, which is a convention in this system for passing context between jobs/programs.

---

## Design Decisions & Conventions

- **Key List Usage:** The composite key for `SKPML1` is built dynamically in the `*INZSR` subroutine, allowing for flexible selection based on runtime parameters.
- **Field Prefixing:** The use of the `prefix(x:1)` on the input file is a codebase convention to distinguish source fields (`x` prefix) from destination fields.
- **No Debug I/O:** The `h option(*nodebugio)` indicates this program is not intended for step-debugging of I/O, likely because it is a batch or utility routine.

---

## External Interactions

- **Data Files:** The program interacts directly with two physical files (`SKPML1` and `SKPWPF`) and indirectly with the LDA.
- **No External APIs or Modules:** The program is self-contained and does not call external programs or APIs.

---

## Summary Table

| File      | Role     | Key Fields         | Notes                          |
|-----------|----------|--------------------|--------------------------------|
| SKPML1    | Input    | Company, Type      | Parameter register, `x` prefix |
| SKPWPF    | Output   | Company, Type, ... | Working file for staging       |
| LDA       | Context  | Company (944–946)  | Used to set `w_firm`           |

---

## Typical Use Case

This program is typically invoked as a preparatory step in a batch process, where parameters relevant to a specific company and type are needed in a working file for downstream jobs or reporting.

---

## Maintenance Notes

- Ensure the LDA layout is consistent system-wide.
- Any changes to the structure of `SKPML1` or `SKPWPF` require corresponding updates to this program.
- If expanding to multi-company or multi-type processing, consider parameterizing or looping over `w_firm`/`w_type`.

---