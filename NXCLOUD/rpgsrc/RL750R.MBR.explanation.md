# RPG Program Overview

This IBM ILE RPG program (`RL750R`) is part of the `ASOKON` system and is designed to **update the supplier ("leverandør") search text** ("søketekst") in a supplier-related file. The code follows traditional fixed-form RPG IV syntax and incorporates Norwegian comments and variable names.

---

## Program Purpose

- **Main function:** Given a supplier number (`leverandørnummer`) and a company ID (`firma`), the program reads the supplier's record, assembles a search text composed of various supplier details (name, address, phone, etc.), and stores this in a separate file dedicated to search optimization.

---

## Key Files and Data Structures

### Files

- `rlevl1`: Supplier master file (disk-based, keyed access, renamed record format `rlevl1r`)
- `rlsolu`: Search text file (update/add, renamed format `rlsolur`)

### Parameters

- `p_firm`: Company ID (like DB field `rlfirm`)
- `p_levr`: Supplier ID (like DB field `rllevr`)

### Working Variables

- Variables for trimming, copying, and building search text, e.g., `w_stek` ("søketekst"), `w_firm`, `w_tlfn` (phone), `w_mobn` (mobile), and alpha representations for numerical fields (e.g., `w_levr_alf`).

### Constants

- `Lo`, `Up`: Strings with lowercase and uppercase letters (including Norwegian special characters) used for case normalization.

---

## High-Level Flow

1. **Initialization** (`*inzsr`):
   - Receives parameters and assigns them to working variables.
   - Builds key lists for file lookups.

2. **Main Logic**:
   - Uses `chain` to read the supplier record (`rlevl1`) by company and supplier IDs.
   - If found, invokes the `oppdater` ("update") subroutine to build and store the search text.

3. **Program Exit**:
   - Sets LR indicator to signal program end and returns.

---

## Main Logic Details

### Building the Search Text (`oppdater` subroutine)

- **Alfa Field:** Uses the `rlalfa` field (free-text or code) as the search text base.
- **Name:** Appends the supplier’s name (`rlnavn`), with normalization to uppercase.
- **Addresses:** Adds primary (`rlgate`) and secondary (`rladr2`) address lines, if they exist.
- **City:** Adds city/post location (`rlsted`), if present.
- **Phone/Mobile:** Appends phone (`rltlfn`) and mobile (`rlmobn`) numbers, stripping spaces.
- **Supplier Number:** Included in search text as alpha.
- **Company Registration Number:** (`rlftnr`) Added if nonzero.
- **Bank Account Number:** (`rlbgir`) Added if nonzero.

All fields are concatenated with single spaces and right-trimmed where appropriate.

### Stripping Spaces from Phone/Mobile

A loop uses `scan` to find spaces, then `%subst` to reassemble the string without spaces until none remain.

### Updating the Search Text File

- Tries to `chain` (find) a record in `rlsolu` for this supplier.
  - If found, updates the record.
  - If not found, sets company and supplier numbers and writes a new record.

---

## Subroutine: Initialization

- **Parameter Passing:** The parameters are defined and received via a procedure interface (`plist` and `parm`).
- **Key Lists:** Keys for file operations are built for both supplier master and search text files.

---

## Sample Data Flow

1. Receive parameters: Company = `12345`, Supplier = `987654`
2. Look up supplier in `rlevl1` using these keys.
3. If supplier exists:
   - Build search text: e.g., `"ALFA NAVN GATE STED 12345678 91234567 987654 123456789 12345678901"`
   - Update or add in `rlsolu` file.
4. Return and end.

---

## Notable RPG Features Demonstrated

- **File specifications** (`f` specs) for DB access.
- **Subroutine calls** with indicators for record-not-found (`*in90`, `*in91`).
- **String manipulation:** uppercase conversion (`xlate`), concatenation, trimming (`%trim`, `%trimr`), substringing (`%subst`).
- **Key lists** (`klist`, `kfld`) for file access.
- **Parameter passing** (`plist`, `parm`).
- **Error/exception handling** via indicators.

---

## Comments on Code Style

- The program uses Norwegian identifiers and comments.
- Field/variable names often match file field names for clarity.
- Modularity is maintained using subroutines for initialization and updating.

---

## Summary

This RPG program is a batch utility that **keeps the supplier search text up to date**—crucial for efficient lookup/search operations elsewhere in the system. It demonstrates classic RPG IV programming patterns, with careful string and field management necessary for traditional IBM i applications.