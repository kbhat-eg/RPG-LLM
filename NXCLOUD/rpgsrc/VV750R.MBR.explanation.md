# Program Overview

This RPG program (`VV750R`) is responsible for creating or updating a "search text" ("s�ketekst") for items ("varer") in a database. This search text is a concatenation of various attributes (description, supplier, group, EAN, etc.) to make searching for products more effective. The program reads several files/tables, collects relevant data, concatenates it into a search string, and writes or updates this back to a search index file. 

## Main Features

- **Collects information from multiple sources** (item, supplier, group, EAN, etc.)
- **Builds a comprehensive search string** for each item
- **Updates or creates** a record in the search text file (`vvsolur`)
- **Handles different enhancements/patches** over time (noted by version comments in the code, e.g., EAN, NOBB, logistikkvare)

---

## Key Sections & Flow

### File Declarations

- Multiple files are defined with `DISK` keyword and `RENAME` to give more meaningful record names in the program.
- Files include product master (`vvarl1`), supplier (`rlevl1`), group (`vugrl1`), EAN (`veanl2`), search text (`vsokl1`), and others for various lookups.

### Parameter Definitions

- Parameters for company (`p_firm`) and item (`p_vare`) are defined, to support processing by company and item number.

### Key & Working Variable Definitions

- Variables are created to handle keys for various files, working variables for company, and for assembling the search text string (`w_stek`).

### Constants

- `Lo` and `Up` are string constants containing lowercase and uppercase letters (including Scandinavian characters), used for uppercasing text.

---

### Main Program Logic

1. **Fetch Item:**  
   The main logic starts by attempting to `CHAIN` (random access by key) to the item master (`vvarl1`) for the input item.
   - If the item is found, it calls the `oppdater` (update) subroutine.

2. **End Program:**  
   - Sets *INLR = *ON to close files and return.

---

### Subroutine: `oppdater` (Update Search Text)

This is the core of the program, assembling the search text:

1. **Item Description:**  
   Begins with the first description field (`vvtek1`). If there's a second description (`vvtek2`), it's appended.

2. **Supplier Name:**  
   If the supplier number is present, looks it up, uppercases the supplier name, and appends it.

3. **Under Group Text:**  
   Fetches under group text (for item category) and appends if present, uppercasing as well.

4. **Item Number:**  
   Appends the item number.

5. **Supplier's Item Number:**  
   Appends if present.

6. **NOBB Number:**  
   Appends if present (NOBB is a Norwegian product numbering system).

7. **Logistics Item/Supplier Data:**  
   Reads logistics data (multiple records possible) and adds unique NOBB and supplier numbers if different from main.

8. **Custom Search Texts:**  
   Looks for custom search texts defined in a different table and appends these.

9. **EAN from Item Units & Registry:**  
   Loops through item units to find and append EAN numbers, then looks for EAN in the registry and appends.

10. **Module Number:**  
    Appends if present.

11. **Update or Write Search Text Record:**  
    Sets keys and fields, then if the search text exists, updates it; otherwise, creates it.

---

### Subroutine: *INZSR (Initialization)

- Handles program initialization, parameter assignment, and key list definitions for later use in the program.
- *ENTRY PLIST defines the entry parameters.
- Sets up KLISTs (key lists) for all necessary key fields, ensuring that subsequent CHAIN, SETLL, READE operations can use these properly.
- Assigns received company parameter to `w_firm`.

---

## Summary Table

| File       | Purpose                                               |
|------------|------------------------------------------------------|
| vvarl1     | Item master data                                     |
| rlevl1     | Supplier master data                                 |
| vugrl1     | Item group (category) data                           |
| veanl2     | EAN registry                                         |
| vvepl1     | Item unit-level EANs                                 |
| vvlel1     | Logistics item/supplier links                        |
| vsokl1     | Custom search text                                   |
| vvsolu     | Search text file (to be updated/written)             |

---

## Key RPG Concepts Illustrated

- **CHAIN/SETLL/READE**: Used for keyed file access (fetch, read by key, read next matching key)
- **KLIST/KFLD**: Grouping fields for multi-part keys
- **%TRIM/%TRIMR/%EDITC/%CHAR**: String/number formatting built-ins
- **XLATE**: For converting to uppercase using `Lo`/`Up` constants
- **Subroutines**: For logical code grouping (`begsr`/`endsr`)
- **Program Initialization**: *INZSR subroutine for setup

---

## High-level Example (Pseudo-algorithm)

1. Receive Company and Item as parameters
2. Look up item in item master
3. If found:
    - Start building search text:
      - Add description(s)
      - Add supplier name (uppercased)
      - Add group/category text (uppercased), item number, supplier’s item number, NOBB, etc.
      - Add logistics info/NOBB/supplier numbers/EAN/module numbers as present
      - Add custom search texts
    - Update/create search text record in the search table

---

## Final Remarks

- The program is modular and easy to extend for new search components.
- Error handling is minimal and assumes data consistency (typical for batch RPGs).
- Comments in Norwegian, but code structure is readable and maintainable.
- Good use of version-level comments to explain new features.

This program is foundational for building a flexible item search index in an IBM i environment.