# RPG Program LL625R â€“ Parameter Screen for Min/Max Stock Printout

This RPG/400 (ILE RPG, fixed format) program presents a screen for entering parameters for min/max inventory reports. It validates the input, checks reference files, and builds a packed parameter string for downstream processing. Below is an explanation of the code, its structure, and its logic.

---

## Header & Program Documentation

- `/TITLE` and comment blocks provide program name (`LL625R`), a short description, and change logs.
- Indicator usage is documented for clarity (see "BRUK AV INDIKATORER" section).

---

## File Declarations

```rpg
frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
fra26l1    if   e           k disk    rename(ra26pfr:ra26l1r)
fll625d    cf   e             workstn
```
- **rlevpfr** and **ra26pfr**: Supplier and buyer handler master files, renamed to `rlevl1r` and `ra26l1r`.
- **ll625d**: Display file for the parameter entry screen (`A1BLD` format).

---

## Variables and Data Structures

### User Data Section (LDA)
```rpg
d                uds
d l_firm                944    946  0
```
- Reads the firm number from the LDA (positions 944-946).

### Parameter Structure
```rpg
d                 ds
d p_prec                       128
d  p_fvar                        8  0 overlay(p_prec)
d  ...
```
- Packed parameter record (`p_prec`), overlays for each field (from-var, to-var, etc.).
- Used to build a single string passed to downstream processing.

### Key and Working Variables
```rpg
d rlevl1_levr     s                   like(rllevr)
d ra26l1_sakb     s                   like(razsak)
d w_firm          s              3  0
d w_in03          s              1
...
d w_parm          s            128
```
- Variables for file key fields, input parameter, and working storage.

---

## Mainline Logic

### Initial Screen and Processing Loop

```rpg
c     a1taga        tag
c                   exfmt     a1bld
```
- Displays the main parameter entry screen (`A1BLD`).

#### Exit (F3)
```rpg
c                   if        *inkc = *on
c                   eval      w_in03 = '1'
c                   goto      end_pgm
c                   endif
```
- If user presses F3, set exit flag and terminate.

#### Inquiry (F4)
```rpg
c                   if        *inkd = *on
c                   exsr      sp_input
c                   goto      a1taga
c                   endif
```
- If user presses F4, go to inquiry subroutine (`sp_input`), then redisplay.

#### Input Validations
- **Range validations** on all "from" and "to" fields, setting error indicators and returning to screen if invalid.

#### Existence Checks
- **Supplier and Buyer Handler:** Looks up supplier and handler codes in their respective files (`rlevl1r`, `ra26l1r`). If not found, signals error.

#### Variant Check
```rpg
c                   if        a1vari < 1
c                             or a1vari > 2
c                   eval      *in36 = *on
c                   goto      a1taga
c                   endif
```
- Only variants 1 or 2 are allowed.

#### Pack Parameters
```rpg
c                   eval      p_fvar = a1fvar
c                   ...
c                   eval      w_parm = p_prec
```
- Moves validated input to the parameter data structure (`p_prec`), then to the output field (`w_parm`).

---

## Program End

```rpg
c     end_pgm       tag
c                   eval      *inlr = *on
c                   return
```
- Normal end-of-program housekeeping.

---

## Subroutine: Inquiry Function (`sp_input`)

Handles the F4 inquiry for various fields:

- **Item, group, sub-group, warehouse, supplier, handler** codes can be looked up by calling related programs. 
- For example:
  - If `wactfe = 'A1FVAR'`, calls program `VV500R` to look up items, and so on for the other fields (VG510R, VG511R, etc.).
- After each inquiry, returns to screen display.

---

## Subroutine: Initialization (`*INZSR`)

```rpg
c     *inzsr        begsr
c     rlevl1_key    klist
c                   kfld                    w_firm
c                   kfld                    rlevl1_levr
...
c     *entry        plist
c                   parm                    w_in03
c                   parm                    w_parm
...
c                   eval      a1fvar = 0
... (sets default values for all parameters)
c                   eval      w_firm = l_firm
c                   endsr
```
- Sets up key lists for file lookups.
- Defines entry parameter list (w_in03 and w_parm).
- Sets default values for each input field (e.g., all "to" fields to their max, from-fields to min, etc.).
- Sets `w_firm` from company number in LDA.

---

## Key Indicators and Their Use

- **Indicator 30-34, 35, 36, 38**: Error handling on different field validations.
- **Indicator 90**: Set if a `CHAIN` fails (record not found).
- **F3 (KC), F4 (KD)**: Exit and inquiry function keys.
- **LR**: Last record, used for program end.

---

## Summary

- The program is a parameter screen handler for min/max stock reporting.
- All input is validated (ranges, existence in master files, variant check).
- Parameter values are packed into a data structure for later processing.
- Supports F4-lookup (prompt) on all fields referencing external files.
- Well-structured with code comments, indicator documentation, and clear error handling.

---

**Main Takeaway:**  
If you need to onboard or maintain this program, focus on understanding:  
- The validation rules for each parameter.
- How lookups work (via subroutines/calls).
- How the packed parameter string is constructed.
- The indicator handling for user feedback and control flow.