     h datedit(*dmy) option(*nodebugio)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
      *                                                                       *
      * System. . . . . : ASOKON                                              *
      * Program . . . . : RP621R                                              *
      * Beskrivelse . . : Resultatrapport til PC - utplukk                    *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Spesialversjon. :                                                     *
      * Tilpasset for . :                                                     *
      *                                                                       *
      * Referanse  Dato   Endringsbeskrivelse                            Sign *
      * --------- ------  ---------------------------------------------- ---- *
      *                                                                       *
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
      *
     frrf0l1    if   e           k disk    rename(rrf0pfr:rrf0l1r)
     frrf5l1    if   e           k disk    rename(rrf5pfr:rrf5l1r)
     frrf9l1    if   e           k disk    rename(rrf9pfr:rrf9l1r)
     fra07l1    if   e           k disk    rename(ra07pfr:ra07l1r)
     fre02pf    o  a e             disk
      *
     d sal             s             11  2 dim(14)                              Saldo
     d saÅ             s             11  2 dim(14)                              Saldo i år
     d saf             s             11  2 dim(14)                              Saldo i fjor
     d sab             s             11  2 dim(14)                              Saldo budsjett
      *
     d                uds
     d pfirm                 300    302  0                                      Firma
     d pnavn                         30                                         Navn
     d puser                         10                                         BruerI
     d pdato                          6  0                                      Pr. da
     d praar                          4  0                                      Pr. år
     d pperf                          2  0                                      Period
     d ppert                          2  0                                      Pr. pe
     d pavdf                          4  0                                      Avd. f
     d pavdt                          4  0                                      Avd. t
     d prapp                          2  0                                      Rappor
     d psumm                          1                                         Avd.su
      *
     d l_user                911    920
     d l_firm                944    946  0
     d l_navn                951    970
      *
     d wa07ok          s              1  0
     d w_raar          s                   like(rr9aar)
     d w_firm          s                   like(rr9fir)
     d x               s              3  0
      *
      *  Rapportregister
      *
     irrf9l1r       01
      *
     i              rr9s01                      sal(01)
     i              rr9s02                      sal(02)
     i              rr9s03                      sal(03)
     i              rr9s04                      sal(04)
     i              rr9s05                      sal(05)
     i              rr9s06                      sal(06)
     i              rr9s07                      sal(07)
     i              rr9s08                      sal(08)
     i              rr9s09                      sal(09)
     i              rr9s10                      sal(10)
     i              rr9s11                      sal(11)
     i              rr9s12                      sal(12)
     i              rr9s13                      sal(13)
     i              rr9s00                      sal(14)
      *
     c/eject
      *
      * Kontroll av firma
      *
     c     les           tag
      *
     c                   read      rrf5l1r                                11
      *
B001 c                   if        *in11 = *on
 001 c                             or rr5fir > l_firm
 001 c                             or rr5rap > prapp
 001 c                   eval      *inlr = *on
 001 c                   goto      slutt
E001 c                   endif
      *
      * Nullstill tabeller
      *
     c                   z-add     0             saÅ
     c                   z-add     0             saf
     c                   z-add     0             sab
      *
     c                   eval      wa07ok = 0
      *
      * Finn avdeling
      *
 001 c                   eval      ragkod = pavdf
      *
B001 c                   if        pavdf = *zero
     c                   eval      ragkod = 1
E001 c                   endif
      *
     c     ra07l1_key    setll     ra07l1r
      *
     c     avdlop        tag
     c*
B001 c                   if        pavdf = *zero and
 001 c                             wa07ok = 0
 001 c                   eval      ragkod = pavdf
 001 c                   goto      finsal
E001 c                   endif
      *
     c                   read      ra07l1r                                10
      *
B001 c                   if        ragfir > l_firm or
 001 c                             ragkod > pavdt
 001 c                   goto      skrlin
E001 c                   endif
      *
B001 c                   if        wa07ok = 1 and
 001 c                             *in10 = *on
 001 c                   goto      skrlin
E001 c                   endif
      *
      * Finn saldo til linje
      *
     c     finsal        tag
      *
     c                   eval      wa07ok = 1
     c                   eval      rr9fir = rr5fir
     c                   eval      rr9rap = rr5rap
     c                   eval      rr9lin = rr5lin
     c                   eval      rr9per = ppert
     c                   eval      rr9aar = praar
      *
B001 c                   if        rr5kod <> 'T'                                ............
 001 c                   eval      rr9avd = ragkod                                         .
      *
      * Hent saldo i år
      *
 001 c                   eval      rr9typ = 1                                              .
 001 c     rrf9l1_key    chain     rrf9l1                             99                   .
      *
B002 c                   if        *in99 = *off                                            .
 002 c                   add       sal           saÅ                                       .
E002 c                   endif                                                             .
      *
      * Hent budsjett i år
      *
 001 c                   eval      rr9typ = 3                                              .
 001 c     rrf9l1_key    chain     rrf9l1                             99                   .
      *
B002 c                   if        *in99 = *off                                            .
 002 c                   add       sal           sab                                       .
E002 c                   endif                                                             .
      *
      * Hent saldo i fjor
      *
 001 c                   eval      rr9aar = w_raar                                         .
 001 c                   eval      rr9typ = 1                                              .
 001 c     rrf9l1_key    chain     rrf9l1                             99                   .
      *
B002 c                   if        *in99 = *off                                            .
 002 c                   add       sal           saf                                       .
E002 c                   endif                                                             .
E001 c                   endif                                                  ............
      *
B001 c                   if        psumm = 'J'
 001 c                   goto      avdlop
E001 c                   endif
      *
     c     skrlin        tag
      *
B001 c                   if        psumm = 'N' and
 001 c                             ragfir <> l_firm
 001 c                   goto      les
E001 c                   endif
      *
B001 c                   if        psumm = 'N'
 001 c                   eval      rr9avd = ragkod
X001 c                   else
 001 c                   eval      rr9avd = pavdf
E001 c                   endif
      *
     c                   eval      rr9aar = praar
     c                   eval      rr9txt = rr5txt
     c                   eval      rr9typ = 1
      *
     c                   z-add     saÅ(14)       rrftÅr
     c                   z-add     ppert         x
     c                   z-add     saÅ(x)        rrfpÅr
     c                   z-add     1             x
      *
B001 c                   dou       x > ppert
 001 c                   add       saÅ(x)        rrftÅr
 001 c                   add       1             x
E001 c                   enddo
      *
     c                   z-add     sab(14)       rrbtÅr
     c                   z-add     ppert         x
     c                   z-add     sab(x)        rrbpÅr
     c                   z-add     1             x
      *
B001 c                   dou       x > ppert
 001 c                   add       sab(x)        rrbtÅr
 001 c                   add       1             x
E001 c                   enddo
      *
     c                   z-add     saf(14)       rrftfj
     c                   z-add     ppert         x
     c                   z-add     saf(x)        rrfpfj
     c                   z-add     1             x
      *
B001 c                   dou       x > ppert
 001 c                   add       saf(x)        rrftfj
 001 c                   add       1             x
E001 c                   enddo
      *
     c                   write     re02pfr                                       SKRIV POST
      *
     c                   z-add     0             saÅ
     c                   z-add     0             saf
     c                   z-add     0             sab
      *
B001 c                   if        rr5kod = 'T'                                 ............
 001 c                   goto      les                                                     .
E001 c                   endif                                                  ............
      *
B001 c                   if        psumm = 'J'
 001 c                   goto      les
E001 c                   endif
      *
B001 c                   if        psumm = 'N' and
 001 c                             ragfir = l_firm
 001 c                   goto      avdlop
X001 c                   else
 001 c                   goto      les
E001 c                   endif
      *
     c     slutt         tag
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      * Subrutine for initiering av program                             *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - *
      *
     c     *inzsr        begsr
      *
     c                   z-add     0             x
     c                   z-add     0             wa07ok
      *
     c                   eval      w_firm = l_firm
      *
     c                   eval      w_raar = praar - 1
      *
      * Hent rapport heading
      *
     c                   eval      rr0rap = prapp
     c     rrf0l1_key    chain     rrf0l1                             99
      *
      * Legg ut record
      *
     c                   eval      rr9fir = rr0fir
     c                   eval      rr9rap = prapp
     c                   eval      rr9lin = *zeros
     c                   eval      rr9typ = *zeros
     c                   eval      rr9avd = pavdf
     c                   eval      rr9per = ppert
     c                   eval      rr9aar = praar
     c                   eval      rrfpÅr = *zeros
     c                   eval      rrftÅr = *zeros
     c                   eval      rrbpÅr = *zeros
     c                   eval      rrbtÅr = *zeros
     c                   eval      rrfpfj = *zeros
     c                   eval      rrftfj = *zeros
     c                   eval      rr9txt = rr0txt
      *
     c                   write     re02pfr                                       SKRIV RAPPORT-NAVN
      *
      * Sett starverdi
      *
     c                   eval      rr5rap = prapp
     c                   eval      rr5lin = *zeros
      *
     c     rrf5l1_key    setll     rrf5l1
      *
      * Key for resultatrapporter
      *
     c     rrf0l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rr0rap
      *
      * Key for resultatrapporter - linjer
      *
     c     rrf5l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rr5rap
     c                   kfld                    rr5lin
      *
      * Key for resultatregister
      *
     c     rrf9l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rr9rap
     c                   kfld                    rr9lin
     c                   kfld                    rr9avd
     c                   kfld                    rr9aar
     c                   kfld                    rr9typ
      *
      * Key for avdeling
      *
     c     ra07l1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    ragkod
      *
     c                   endsr
