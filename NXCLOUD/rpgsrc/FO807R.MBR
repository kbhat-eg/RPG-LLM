      /TITLE  ASOFAK: Start utkjøring av ordrepapirer
     h datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System. . . . . : ASOFAK
      * Program . . . . : FO807R
      * Beskrivelse . . : Start utkjøring av ordrepapirer
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      * 8.xx  020522 bsa  Nytt program
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fvotyl1    if   e           k disk    rename(votypfr:votyl1r)
     ffpm1lu    uf a e           k disk    rename(fpm1pfr:fpm1lur)
      *
      * Definering av LDA
      *
     d                uds
     d l_wsid                901    910
     d l_user                911    920
     d l_sfir                944    946  0
     d l_fnav                951    980
      *
      * Datastruktur for navn på member
      *
     d                 ds
     d d_memb                        10
     d  d_alf1                        1    overlay(d_memb)
     d  d_firm                        3  0 overlay(d_memb:2)
     d  d_numm                        6  0 overlay(d_memb:5)
      *
      * Datastruktur for periode
      *
     d                 ds
     d d_peri                         6  0
     d  d_aaar                        4  0 overlay(d_peri)
     d  d_mmnd                        2  0 overlay(d_peri:3)
      *
      * Definering av parametere
      *
     d p_dirk          s              1  0
     d p_firm          s              3  0
     d p_numm          s              8  0
     d p_otyp          s              2
     d p_outq          s             10
     d p_skor          s              1
     d p_suff          s              2  0
      *
      * Definering av variable i nøkler
      *
     d votyl1_otyp     s                   like(vaotyp)
     d fpm1lu_1lst     s                   like(fk1lst)
     d fpm1lu_1usr     s                   like(fk1usr)
     d fpm1lu_1wsd     s                   like(fk1wsd)
      *
      * Definering av variable
      *
     d w_firm          s                   like(vaofir)
     d w_valg          s                   like(fk1vg1)
     d w_numm          s              6  0
     d w_alf1          s              1
     d w_mnd1          s              2  0
     d w_mnd2          s              2  0
     d w_aar1          s              4  0
     d w_aar2          s              4  0
     d w_aar3          s              4  0
     d w_avik          s              4  0
     d w_dato          s               d   datfmt(*iso)
     d w_kode          s              2  0
     d w_onof          s              1  0
     d w_memb          s             10
     d w_stat          s              1
     d w_peri          s              6  0
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Direkte utskrift kjøres dersom ordrenummer er utfylt
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c                   eval      p_dirk = *zero
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * START Behandler danning av parameter før utskrift
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * Kaller opp subrutine for utlegging av parameter, for
      * start av utskrift (w_valg=Internt listenummer fra 0 til 3)
      *
     c                   eval      w_valg = *zero
     c                   exsr      param
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * NESTE Kaller opp 'CL'-programmet for å starte utskriften
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     neste         tag
      *
     c                   call      'FO807C'
     c                   parm                    d_memb
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Avslutt program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     xslutt        tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Oppdaterer  ORDRE-PLUKK-PARAM1-REGISTER
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     param         begsr
      *
     c                   eval      fpm1lu_1lst = w_valg
     c     fpm1lu_key    chain     fpm1lur                            90
      *
     c                   eval      fk1utq = p_outq
     c                   eval      fk1oty = p_otyp
     c                   eval      fk1onr = p_numm
     c                   eval      fk1suf = p_suff
     c                   eval      fk1vg0 = p_dirk
     c                   eval      fk1vg1 = w_valg
     c                   eval      fk1vg2 = 1
     c                   eval      fk1vg3 = 1
      *
     c                   eval      d_aaar = *year
     c                   eval      d_peri = *month
      *
     c                   time                    fk1dat
     c                   eval      fk1per = d_peri
      *
     c                   if        *in90 = *off
     c                   update    fpm1lur
     c                   else
     c                   eval      fk1fir = w_firm
     c                   eval      fk1wsd = l_wsid
     c                   eval      fk1usr = l_user
     c                   eval      fk1lst = w_valg
     c                   write     fpm1lur
     c                   endif
      *
     c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      * Key for file : Kode - status 1
      *
     c     raa1l1_key    klist
     c                   kfld                    w_firm
      *
      * Key for file : ORDRETYPE-REGISTER
      *
     c     votyl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    votyl1_otyp
      *
      * Key for file : PLUKK-1-LINJE-REGISTER
      *
     c     fpm1lu_key    klist
     c                   kfld                    w_firm
     c                   kfld                    fpm1lu_1wsd
     c                   kfld                    fpm1lu_1usr
     c                   kfld                    fpm1lu_1lst
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Tar inn parameter fra forrige program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *entry        plist
     c                   parm                    p_skor
     c                   parm                    p_firm
     c                   parm                    p_numm
     c                   parm                    p_suff
     c                   parm                    p_otyp
     c                   parm                    p_dirk
     c                   parm                    p_outq
      *
      * Legger inn firmanummer i nøkklene
      *
     c                   eval      w_firm = p_firm
     c                   eval      d_firm = p_firm
      *
      * Legger inn opplysninger i nøkklene
      *
     c                   eval      fpm1lu_1wsd = l_wsid
     c                   eval      fpm1lu_1usr = l_user
      *
      * Henter siste nummer for File-member
      *
     c     new_memb      tag
      *
     c                   call      'FA920R'
     c                   parm                    w_alf1
     c                   parm                    w_numm
      *
     c                   move      'A'           d_alf1
     c                   move      w_numm        d_numm
      * Sjekk om member ikke er brukt tidligere
     c                   eval      w_stat = *blanks
     c                   eval      w_memb = d_memb
     c                   call      'FO604C'
     c                   parm                    w_memb
     c                   parm                    w_stat
      *
     c                   if        w_stat = '1'
     c                   eval      w_numm = *zeros
     c                   goto      new_memb
     c                   endif
      *
     c                   time                    w_dato
      *
     c                   endsr
      *
