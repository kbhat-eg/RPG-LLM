```markdown
# Explanation of IBM ILE RPG Code: RK620R (Utskrift av kunderegister - parameter)

## Overview

This RPG program, named `RK620R`, is part of the ASOKON system and handles parameter entry and validation for printing the customer register ("kunderegister"). The focus is on collecting, validating, and passing filter/sorting criteria to downstream processing via a workstation display and program parameters.

The program supports interactive selection of ranges for customers, departments, categories, sellers, and districts, along with sorting and additional options. It validates the user's input, offers inquiry support for lookups, and prepares parameters for further processing.

---

## Structure Breakdown

### **Header Section and Documentation**

- The `/TITLE` directive and the commented header provide metadata about the program: its purpose, version history, and conventions for indicator usage (for function keys, protections, warnings, errors, etc.).
- Special attention is paid to function key mapping (e.g., F1=Firm selection, F3=Exit), and which indicators control which logic sections (e.g., 31-59 are for error messages, 60-69 for file operations).

---

### **File Definitions**

```rpg
fausrl1    if   e           k disk
frk620d    cf   e             workstn
```
- `ausrl1` is a keyed input file (probably user records).
- `rk620d` is a workstation display file (likely the parameter entry screen).

---

### **Variable Definitions**

Various variables are defined for temporary storage and parameter passing:
- `s`, `wpakod`, `wpdat1`: general or temporary variables.
- `p_in03`, `p_stat`, `p_kode`, `p_kund`, `p_dist`, `p_tx30`: parameters for inquiries/subroutines.
- `w_firm`, `w_user`: working copies for firm and user values.

#### **Parameter Definitions & Copybook**

```rpg
d/COPY QCPYLESRC,RPARRKDS
```
- Imports a copybook, probably containing parameter structure definitions shared across programs.

---

### **Initialization Subroutine (*inzsr)**

- Sets default values for all range fields (from/til for customers, departments, etc.).
- Sets today's date as default where appropriate.
- Loads the user record to check access privileges (e.g., limited to certain departments).
- Reads parameters from the program entry parameter list.
- Prepares the key for later use in loading user configuration.

---

### **Main Control Logic**

#### **Main Tag/Entry Point**

- Uses the tag `dummy` as a logical entry point.

#### **Display Parameter Screen**

```rpg
c exfmt a2bld
```
- Presents the parameter selection screen (`A2BLD`).

#### **Reset Error Indicators**

```rpg
c eval *in31 = *off
...
c eval *in48 = *off
```
- Clears all error/warning indicators before user entry is validated.

---

#### **Function Key Handling**

- **F3 (KC Indicator):** Exits program immediately, setting a return parameter and jumping to termination.
- **F4 (KD Indicator):** Invokes an inquiry subroutine (`spr_rut`) to look up referenced data (e.g., customer, department, category) and redisplays the screen.

---

#### **Field Validations**

For each input field (or range), the program performs validation:
- **Date:** Ensures that the "older than date" field is valid (must be a valid date, fills with today's date if blank).
- **Ranges (customer number, department, category, seller, district):** Validates that 'from' values are not greater than 'to' values. If incorrect, sets the corresponding error indicator and redisplays the screen.
- **Print Type (`a2ptyp`):** Must be 'E' or 'F'.
- **Additional Fields validation:** Only one among certain flags (`a2psal`, `a2prab`, `a2ppsl`) may be chosen; ensures values are either blank or 'J' (yes).
- **Sorting Type:** Must be 'J' or blank.

If any validation fails, the appropriate indicator is set for the screen to display errors, and input is requested again.

---

#### **Parameter Passing**

When all validations pass, user input is assigned to final parameter variables that will be used for the next process/program (via the copybook structure).

---

### **Exit Logic**

```rpg
c xslutt tag
c eval *inlr = *on
c return
```
- Normal RPG termination sequence: sets the LR (Last Record) indicator and returns.

---

### **Inquiry Subroutine (spr_rut)**

- Used for field-specific lookups, e.g., fetching full descriptions or valid codes for customers, departments, categories, sellers, and districts.
- Calls external programs like `RK500R`, `RA507R`, `RA511R`, `RA509R`, `RA510R` with relevant parameters for lookup, and returns the fetched data to the input fields.
- Sets the correct input indicator after updating each field, then exits the subroutine.

---

### **Initialization Subroutine Details**

- Resets working variables.
- Assigns default values for all range fields.
- If the user's record restricts the user to a department (`abbavd = 'J'`), locks the department fields to that value.
- Prepares the key for the user record lookup.

---

## **Key Points for Developers**

- **Screen fields:** Parameter ranges for customers, departments, categories, sellers, districts, options for sorting and other print flags.
- **Indicators:** Extensive use for controlling screen display, field protection, and error feedback.
- **External Calls:** Lookup programs and parameter copybooks are reused throughout the solution.
- **Validation:** All user input is rigorously validated to ensure correct operation downstream.
- **Exit/Entry:** Clean and clearly marked exit and entry points.
- **User Restrictions:** If the user is limited to a department, the UI is protected and auto-filled.
- **Localization:** Some comments and field names are in Norwegian (e.g., "Utskrift av kunderegister" = "Printing customer register").

---

## **Useful Conventions**

- Use the documentation at the top for indicator conventions.
- Use the copybook for consistent parameter definitions across programs.
- Subroutines are used for modularization (especially for lookups and initialization).

---

## **Summary**

This program is a well-commented RPG "parameter entry" routine for a customer register print process. It demonstrates classic RPG patterns: heavy use of indicators, display files, subroutine modularization, and batch parameter handling. New developers should focus on understanding the display file (`A2BLD`), the copybook (`RPARRKDS`), indicator conventions, and how inquiry programs are integrated for lookup functionality.
```