# RPG Program Overview

This RPG (Report Program Generator) source code is for an IBM i (AS/400) application designed to **display information about who holds an order** ("vise informasjon om hvem som holder ordre"). The program reads data from database files, gathers relevant information, and presents it to the user on a workstation display.

---

## High-Level Structure

### File Declarations (`F-specs`)
- **fohel1**: Order header table (renamed record format)
- **ausrl1**: User table (renamed)
- **ra09l1**: Salesperson table (renamed)
- **fo710d**: Workstation (display file)

### Data Definitions (`D-specs`)
- **LDA fields**: Reads firm/user/workstation info from Local Data Area.
- **Parameters**: Company, order number, and suffix.
- **Key variables**: For accessing each table.
- **Work variables**: For tracking info like user, date, time, status codes, etc.

### Program Logic (`C-specs`)
- **Initialization**: Process parameters and fetch firm number from LDA.
- **Main logic**:
    - Fetch order info from the order header table (`fohel1`).
    - If found, retrieve and transfer details.
    - Optionally, call a subprogram (`FU704R`) to get "order sent to picking" info.
    - Fetch and display user and salesperson names.
    - Display the information in a screen format.
- **Exit/return**.

---

## Detailed Step-by-Step Walkthrough

### 1. Indicators

Comments explain indicator usage:
- **LR**: Last record (used to end/close the program).
- **30, 31-79, 80-99**: Used for screen control, warnings, work indicators, and file operations.

---

### 2. Data Area and Parameter Definitions

- **LDA**: Used for default firm, user, workstation context.
- **Parameters**: Program expects company (firm), order number, and suffix as parameters.

---

### 3. File Access and Key Definitions

- **fohel1_key**: Multi-field key to access order by firm, number, and suffix.
- **ausrl1_key**: Key for user record.
- **ra09l1_key**: Key for salesperson record.

---

### 4. Main Processing (Who Holds the Order)

#### a. Fetch Order Data

```rpg
eval      fohel1_numm = p_numm
eval      fohel1_suff = p_suff
fohel1_key chain fohel1r
if        %found
    // Transfer data fields from order record to display variables
endif
```

- Retrieves the order header using the given order number and suffix.
- If found, copies info (such as who is holding the order, date/time fields) into variables for display.

---

#### b. Order Sent to Picking (Status Check)

```rpg
w_kode = '2'
w_aarr = %subdt(fobdat:*years)
call 'FU704R'
    parm w_aarr
    parm fonumm
    parm fosuff
    parm w_kode
    parm w_svar
    parm w_date
    parm w_time
    parm w_user
    parm w_wsid
if w_svar = 'J'
    // Move date and time into display variables
endif
```

- Calls another program ('FU704R') to get info about when the order was sent to picking.
- Passes and retrieves several variables (year, order number, code, etc.).
- If successful (`w_svar = 'J'`), sets display date/time.

---

#### c. Fetch User and Salesperson Information

```rpg
if fokous <> *blank
    ausrl1_user = fokous
    ausrl1_key chain ausrl1r
    if %found
        x1knav = abnavn   // User holding the order
endif
ausrl1_user = fouser
ausrl1_key chain ausrl1r
if %found
    x1onav = abnavn   // Order's originator user
endif
if foplse <> 0
    ra09l1_ikod = foplse
    ra09l1_key chain ra09l1r
    if %found
        x1plna = raitxt   // Salesperson name
endif
```

- Looks up names for both the "order holder" user and the original user in the user table.
- Looks up the salesperson if present.

---

#### d. Display the Information

```rpg
e1tabg tag
exfmt x1bld
```

- Formats and displays the order information on the screen.

---

#### e. Return/Exit Logic

```rpg
if *inkc   // Cancel action
    goto xslutt
xslutt tag
eval *inlr = *on
return
```

- Handles user cancellation and orderly program exit.

---

### 5. Initialization Subroutine (*INZSR)

- Receives parameters.
- Sets up key lists for table lookups.
- Reads the firm number from LDA.

---

## Summary Table

| Component          | Purpose                                                                         |
|--------------------|---------------------------------------------------------------------------------|
| Files              | Access order headers, user, and salesperson tables                              |
| Parameters         | Receive firm, order number, suffix                                              |
| Main logic         | Fetch order info, get picking info, look up user/salesperson names, display     |
| Subprogram call    | Retrieves special order log info ("sent to picking")                            |
| Display handling   | Presents data to the user via workstation screen                                |
| Exit logic         | Handles end-of-job and user cancelling                                          |

---

## Notes on Language and History

- **Comments are in Norwegian** (For example, "Bruk av indikatorer" = "Use of Indicators").
- The revision history at the top shows the program's evolution and modifications.
- Uses both RPG III and RPG IV (ILE) features.

---

## Key Takeaways

- This is a classic IBM i program for displaying who is holding an order.
- It accesses multiple files, sometimes through cross-references, to compile all requested information.
- The program uses subprogram calls, indicators, and standard RPG screen handling.
- Understanding of IBM i file operations, indicators, and RPG syntax is assumed for maintenance and enhancement.

---

If you have more specific questions about structure, data flow, or code modernization, let me know!