# Documentation for Program RH623R

## Overview

**Program Name:** RH623R  
**System:** ASOKON  
**Description:**  
This program is part of the General Ledger (Hovedbok) module. It manages the entry and validation of parameters for balance/budget reports, supporting both printout and parameter handling. The program is screen-driven, collecting user input for report criteria, validating them, and storing the results in the LDA (Local Data Area) for downstream processes.

**Special Notes:**  
- The program is tailored for use with a new GUI (as of version 7.xx, 2014-06-18, for BKV).
- The codebase uses a well-documented indicator convention for program flow, error handling, and file operations.

---

## File and Display Declarations

- **File `AUSRL1`**:  
  Used for retrieving user information. Accessed via keyed disk I/O.
- **Display File `RH623D`**:  
  Used for interactive workstation input/output (the primary user interface).

---

## Data Definitions

### Key Fields and Parameters

- **Report Parameters (a2.../rh... fields):**  
  These fields represent report criteria such as period, account range, department, cost center, and various report options.
  - Example: `a2pkda` (run date), `a2prår` (year), `a2pper` (period), `a2pavf`/`a2pavt` (department from/to), etc.
  - The `rh...` fields are used for storing the final, validated parameters in the LDA.

- **User and Firm Data:**  
  Fields like `l_user`, `l_firm`, and `l_fnav` are loaded from the environment or calling program and used for context.

- **Work Variables:**  
  Used for interim calculations and logic flow (`waar`, `wmnd`, `wpakod`, etc.).

---

## Indicator Usage

The codebase follows a strict indicator convention:
- **KA, KC:** Function keys (F1 = select firm, F3 = exit).
- **LR:** End of program.
- **30:** Field protection (display only).
- **31–59:** Error/warning indicators.
- **60–69:** File operation indicators (chain, etc.).
- **70–79:** Subroutine work indicators.
- **80–89:** General work indicators.
- **90–99:** Standard subroutine indicators.

---

## Program Flow

### 1. Initialization (`*INZSR`)

- Sets default values for all report parameters.
- Loads firm and user information into work variables.
- Sets up initial ranges for department, cost center, and account numbers.
- Calculates the default reporting period (previous month/year).
- Retrieves user-specific settings from `AUSRL1` (e.g., department restrictions).
- Prepares the parameter list for the mainline code.

### 2. Mainline Logic

#### a. Parameter Entry Screen

- Displays the parameter entry screen (`exfmt a2bld`).
- Handles function key F3 (exit): sets return flag and exits.

#### b. Parameter Validation

- **Department Range:**  
  Validates that "from" is not greater than "to". If invalid, sets error indicator and redisplays the screen.
- **Cost Center Range:**  
  Same logic as above.
- **Account Range:**  
  Same logic as above.
- **Run Date:**  
  If not provided, defaults to the current date. Checks for valid date format.
- **Report Type:**  
  If not provided, defaults to 'H'.

#### c. Parameter Storage

- After validation, moves all parameters into the LDA (`rh...` fields) for use by downstream reporting processes.

#### d. Program End

- Sets LR indicator and returns.

---

## Business and Domain Logic

- **Parameter Ranges:**  
  Users can specify ranges for department, cost center, and account. These are validated to prevent logical errors (e.g., "from" > "to").
- **Period Calculation:**  
  The default reporting period is set to the previous month. If the current month is January, it rolls back to December of the previous year.
- **User Restrictions:**  
  If the user is restricted to a specific department (`abbavd = '1'`), the department range is set to that department only, and the report type is set to 'K'.
- **Data Passing:**  
  Parameters are passed via the LDA for subsequent batch/reporting programs.

---

## Interactions with Other Modules

- **User Master (`AUSRL1`):**  
  Used to retrieve user-level restrictions (e.g., department limits).
- **Display File (`RH623D`):**  
  Provides the UI for parameter input and error display.
- **Downstream Reporting:**  
  This program acts as a parameter collector; actual report generation is handled by other programs that read the LDA.

---

## Notable Design Decisions

- **Indicator Discipline:**  
  The program uses a strict indicator range convention for maintainability and clarity.
- **Parameter Handling:**  
  All user input is validated before being committed to the LDA, ensuring downstream processes receive only valid, consistent data.
- **Separation of Concerns:**  
  The code is structured to keep UI, business logic, and data storage distinct, simplifying future modifications.

---

## Summary

RH623R is the entry point for collecting and validating report parameters in the General Ledger module. It ensures that all user-supplied criteria are valid, applies business rules (such as user restrictions), and prepares data for reporting. The program is tightly integrated with user management and downstream reporting modules, following established conventions for indicator usage and data handling.