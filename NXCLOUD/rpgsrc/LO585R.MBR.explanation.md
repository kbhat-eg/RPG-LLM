# RPG Source Code Explanation

This RPG program appears to generate a list highlighting "holes" (gaps) within a number series in a file called **FDELPF**. The context and comments suggest it is likely used for order or invoice number management within a business system. Below is a breakdown of the code structure and logic to help onboard new developers.

---

## 1. Header and File Declarations

### Control Specifications
```rpg
h option(*nodebugio) datedit(*dmy)
```
- `option(*nodebugio)`: Disables debug I/O; program runs slightly faster.
- `datedit(*dmy)`: Sets date format Day-Month-Year throughout.

### System and Program Information
- Contains program name, description, and change history (comments, in Norwegian).

### File Declarations
```rpg
ffdell1    if   e           k disk    rename(fdelpfr:fdell1r)
flo585p    o    e             printer
f                                     usropn
```
- `fdell1`: Input file, externally described, keyed access, renamed from FDELPFR to FDELL1R.
- `lo585p`: Output printer file (report), opened by the program (`usropn`).

---

## 2. Variables and Data Structures

### Parameters (Passed to Program)
```rpg
d p_aarr          s              4  0
d p_a1fr          s              8  0
d p_a1ti          s              8  0
d p_a2fr          s              8  0
d p_a2ti          s              8  0
d p_a3fr          s              8  0
d p_a3ti          s              8  0
d p_pf03          s              1  0
```
- These correspond to the date/year/number ranges defining the series to examine.

### Local Data Area Definitions
```rpg
d                uds
d l_user                911    920
d l_firm                944    946  0
d l_fnav                951    980
```
- Used for obtaining job/environment context, such as user, firm number, etc., from the user data area.

### Key Variables for File Access
```rpg
d fdell1_firm     s                   like(fyfirm)
d fdell1_aarr     s                   like(fyaarr)
d fdell1_numm     s                   like(fynumm)
d fdell1_suff     s                   like(fysuff)
```
- Used to compose the key for reading from `FDELL1`.

---

## 3. Program Mainline

### Main Execution
```rpg
c                   exsr      les
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Calls subroutine `les` to process the records.
- Exits the program (`*inlr = *on` signals last record processed).

---

## 4. Subroutines

### *inzsr (Initialization Subroutine)
```rpg
c     *inzsr        begsr
...
c     *entry        plist
c                   parm                    p_aarr
... (other parm)
c                   parm                    p_pf03
...
c     fdell1_key    klist
c                   kfld                    fdell1_firm
c                   kfld                    fdell1_aarr
c                   kfld                    fdell1_numm
...
c                   endsr
```
- Sets up the parameter list the program expects and key lists for file access.

### les (Main Logic Subroutine)
```rpg
c     les           begsr
c                   open      lo585p
c                   write     a1hdr
c                   eval      fdell1_aarr = p_aarr
c                   eval      fdell1_firm = l_firm
c                   eval      fdell1_numm = p_a3fr
c     fdell1_key    setll     fdell1
c     nyles         tag
c                   read      fdell1                                 60
c                   if        *in60 = *on
c                   goto      avslutt
c                   endif
c                   if        fyaarr > p_aarr
c                   goto      avslutt
c                   endif
c                   if        fynumm > p_a3ti
c                   goto      avslutt
c                   endif
c     f�rste        ifeq      1
c                   add       1             fdell1_numm
c                   endif
c     f�rste        ifeq      0
c                   add       1             f�rste            1 0
c                   endif
c     neste         tag
c                   if        fynumm > fdell1_numm
c                   eval      a1numm = fdell1_numm
c                   write     d1det                                20
C     *in20         ifeQ      *on
C                   write     a1hdr
C                   endif
c                   add       1             fdell1_numm
c                   goto      neste
c                   end
c                   if        fynumm = fdell1_numm
c                   goto      nyles
c                   endif
c                   endsr
```

#### Subroutine Workflow:
1. **Open Printer File**: Ensures output is ready.
2. **Write Heading**: Prints report header.
3. **Setup Key Values**: For record selection (using input parameters).
4. **Position to Start**: Using `SETLL` to start at the requested point in the file.
5. **Main Reading Loop**:
    - Reads next record from file.
    - If EOF or record is outside chosen range, exit.
    - Checks if current number is less than the expected number in the series.
    - If so, writes out the missing number (hole in the series).
    - Steps through possible missing numbers, writes each out as needed.
6. **Page Overflow Handling**: Writes new page header on overflow.
7. **Continue or Finish**: Proceeds until all needed records are processed.

---

## 5. Key Handling

```rpg
c     fdell1_key    klist
c                   kfld                    fdell1_firm
c                   kfld                    fdell1_aarr
c                   kfld                    fdell1_numm
```
- Defines the compound key for sorting/selection in the file.

---

## 6. Summary

### What does this program do?
- The program generates a report showing holes (gaps) in a serial number sequence between a user-specified range for a given year and firm.
- Reads the existing number records from `FDELL1`, identifies missing numbers, and outputs them to a printer file.

### Where are the key parameters?
- Passed via the parameter list (year, number-from, number-to, etc.).
- Mapped and used for positioning in the source file (`FDELL1`).

### How does it work?
- Seeks to the right starting key.
- Steps through expected sequence, comparing to existing records.
- Any missing numbers (holes) are listed in the report.

---

### **Norwegian Terms Glossary**

- **Beskrivelse**: Description
- **Bruk av indikatorer**: Use of indicators
- **Utvidet mtp**: Extended regarding
- **Les poster**: Read records
- **Avslutt program**: End program
- **Finner faktura-hode**: Finds invoice header
- **Ordre-hode-register**: Order header file
- **Avslutter dersom**: Exit if
- **Teller til ordrenummer**: Counter for order number

---

## For a New Developer

- **Start with the initialization section (\*inzsr) and parameter list.**
- **Follow the mainline, noting how the program immediately branches to the reading logic (les) and then exits.**
- **Within the les subroutine is the main logic: reading, comparing, identifying missing records, and writing the report.**
- **All file activity is done using keyed access, based on parameters.**
- **Main output is a printer file, with page handling for overflows.**

Feel free to ask for more details or for a flowchart if needed!