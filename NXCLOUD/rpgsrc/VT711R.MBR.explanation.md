# RPG Source Code Explanation

This RPG program (program name: **VT701R**) is designed to process a file related to a campaign ("Kampanjefil"), allowing for input via display files and performing validation and calling other programs.

Let's break down the sections:

---

## 1. Header Section

```rpg
h option(*nodebugio) datedit(*dmy)
```
- `option(*nodebugio)`: Compiles the program without debug input/output.
- `dateedit(*dmy)`: Specifies date editing, using Day-Month-Year format.

The following block is a comment header, describing the system, program, and modification history.

---

## 2. File Definition

```rpg
fvt711d    cf   e             workstn
```
- Declares the display file `VT711D` for workstation I/O with externally described fields.

---

## 3. Data Structure and Variable Definitions

### Local Data Area
```rpg
d                uds
d l_fgrp                931    933
d l_filg                934    939
d l_firm                944    946  0
```
- `uds`: Declares use of the User Data Space (`*LDA`).
- Data area fields are mapped:
  - `l_fgrp`: Bytes 931-933, likely group identifier.
  - `l_filg`: Bytes 934-939, likely file name/library identifier.
  - `l_firm`: Bytes 944-946, likely the firm/company code.

### Standalone Variables

```rpg
d b_feil          s              1    inz(*off)
d w_firm          s              3  0
d w_stat          s             10
d w_fldr          s             30
d w_tlib          s             10
d w_tfil          s             10
d w_tmbr          s             10
```
- `b_feil`: Flag for input errors (`*off` by default).
- `w_firm`, `w_stat`, `w_fldr`, `w_tlib`, `w_tfil`, `w_tmbr`: Work variables for company, status, folder, library, file, and member namesâ€”used for passing parameters to called programs.

---

## 4. Main Logic

### Screen Handling and Input Loop

```rpg
c                   eval      b1fldr = l_fgrp + '/PRIS_INN'
c     b1taga        tag
c                   exfmt     b1bld
```
- Initializes `b1fldr` with a directory path using the file group from LDA.
- Displays the initial screen (`b1bld`) for user input.

#### Function Key Handling

```rpg
c                   select
c                   when      *inkc or *inkl
c                   goto      avslutt
c                   endsl
```
- Checks for the function keys (likely F3=Exit, F12=Cancel) to end the program.

#### Input Validation

```rpg
c                   exsr      sjekk_input
c                   if        b_feil = *on
c                   goto      b1taga
c                   endif
```
- Calls the validation subroutine (`sjekk_input`). If errors, redisplays the input screen for correction.

#### Prepare and Call Data Retrieve Program

```rpg
c                   if        b1fldr = *blank
c                   eval      b1fldr = l_fgrp + '/PRIS_INN'
c                   endif
c                   eval      w_fldr = *Blank
c                   eval      w_fldr = '/asp/' + %trim(b1fldr)
c                   eval      w_tlib = l_filg
c                   eval      w_tfil = 'flvwpf'
c                   eval      w_tmbr = 'flvwpf'
c                   eval      w_stat = *blank
c                   call      'ASPFRSTMF'
c                   parm                    b1file
c                   parm                    w_fldr
c                   parm                    w_tlib
c                   parm                    w_tfil
c                   parm                    w_tmbr
c                   parm                    w_stat
```
- Prepares parameters and calls external program `ASPFRSTMF` to retrieve data.
- If the status (`w_stat`) is not blank after the call, a message screen is displayed, and control returns to input.

#### Call Control Program

```rpg
c                   call      'VT712R'
c                   parm                    w_firm
```
- Calls another program `VT712R` (probably further processing) with `w_firm` as parameter.

---

## 5. Program End

```rpg
c     avslutt       tag
c                   eval      *inlr = *on
c                   return
```
- Sets the last record indicator (`*inlr`) to true and returns to exit the program cleanly.

---

## 6. Subroutine: `sjekk_input`

```rpg
c     sjekk_input   begsr
c                   eval      b_feil = *off
c                   if        b1file = *blank
c                   eval      b_feil = *on
c                   endif
c                   endsr
```
- Verifies that the input field `b1file` is not blank. If blank, sets the error flag (`b_feil`) to `*on`.

---

## 7. Subroutine: *INZSR (Initialization routine)

```rpg
c     *inzsr        begsr
c                   eval      w_firm = l_firm
c                   eval      b1fldr = 'PRIS_INN'
c                   endsr
```
- On program startup:
  - Initializes `w_firm` from the LDA firm value.
  - Sets the initial directory (`b1fldr`) to `'PRIS_INN'`.

---

# Key Concepts for Onboarding

- **User interface**: Program is driven by workstation screens (display file `VT711D`).
- **Initialization**: Uses data from LDA to set up company and paths.
- **Input Loop**: Prompts user for input, validates, handles function keys gracefully.
- **Processing**: Calls external programs to fetch or process data.
- **Error Handling**: Uses flag variable (`b_feil`) and redisplays screens on error.
- **Subroutines**: Used for modular code (e.g., input validation, initialization).
- **Legacy Style**: Uses fixed-format RPG IV (ILE RPG), with subroutines instead of procedures.

---

## Additional Notes

- Variables like `b1file`, `b1fldr`, `b1bld`, and `b1msg` are probably fields/screens defined externally in the display file.
- All display and field names using the `b1` prefix refer to the first/main screen.
- External programs `ASPFRSTMF` and `VT712R` must exist and take parameters as defined.
- Most variable and field names use Norwegian abbreviations (e.g., `fil` = file, `firma` = company, `gruppe` = group).

---

This program is a relatively straightforward data entry and processing module typical for IBM i RPG applications, especially those with legacy roots.