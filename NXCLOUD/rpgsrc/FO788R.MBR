     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : FO788R
      * Beskrivelse . . : Leser oppsamling av byggdok og sender kall
      *                   for de som enda ikke er sendt.
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * Ref.   Dato  Sign Endringsbeskrivelse
      * ----- ------ ---- -------------------------------------------------
      *       150412 bø   Nytt program
6.30  * 6.30  221014 BKV  Søtte for cobuilder og byggmakk
6.3q  *       260515 bof  Datoformat sql
6.31  *       100516 bof  Kaller COBUILDER nå.
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      *  Bruk av indikatorer:
      *
      *       LR = Avslutt program
      *       10 = Rollup
      *       11 = Rolldown
      *       12 = Sfldsp
      *       13 = Sfldspctl
      *       14 = Sflclr
      *       15 = Sflend
      *       21 = Home-key
      *       22 = Plassering av cursor
      *       30 = prutect av felter ved vise
      *    31-79 = Varsle m/feilmeldinger/skjermindikatorer
      *    80-99 = Arbeidsindikatorer
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     ffbdol1    if   e           k disk    rename(fbdopfr:fbdol1r)
     fafpslr    if   e           k disk    rename(afpspfr:afpslrr)
6.30 famodl1    if   e           k disk    rename(amodpfr:amodl1r)
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
     d l_filg                931    933
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av variabler i nøkler
      *
     d afpslr_ufil     s                   like(l_filg)
     d afpslr_uide     s                   like(afuide)
6.30 d amodl1_modu     s                   like(axmodu)
      *
      * Definering av variable
      *
     d w_firm          s                   like(fwbfir)
     d w_brpt          s            200
     d w_cmd200        s            200
     d w_jnav          s             15
     d w_jkey          s             41
     d w_jtxt          s             35
     d w_bnum          s              6
6.30 d w_bdok          s              1
6.30 d w_cobu          s              1
      *
      * Definering av konstanter
      *
      *
      * Forklaring på spesielle felter
      * som benyttes ved sub-files.
      * - - - - - - - - - - - - - - - - -
      * w_fcrn - Første recordnummer på siden
      * w_stel - Subfile-teller
      * w_spge - Sidestørrelse i subfile (page)
      * w_srrn - Relativt recordnummer i subfile
      * w_sfrn - Første recordnummer på siste side
      * w_ssrn - Siste recordnummer på siste side
      * w_curn - Current recordnummer på siden
      * w_virn - Side og cursorplassering som skal vises
      * w_afld - Aktivt feltnavn
      * w_arow - Aktiv rad for cursor
      * w_acol - Aktiv kolonne for cursor
      *
      * Benyttede skjermbilder.
      * - - - - - - - - - - - - - - - - -
      *
6.3q C/Exec SQL
6.3q C+  Set Option DatFmt=*ISO
6.3q C/End-Exec
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * B2CTL Behandle åpningsbildet med subfile
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
   x  *
6.30 c                   eval      w_bdok = *off
6.30 c                   eval      w_cobu = *off
6.30  * Sjekk om BYGGDOK aktivering er på/av
      *
     c                   eval      amodl1_modu = 'BYGGDOK'
     c     amodl1_key    chain     amodl1
     c                   if        not %found(amodl1)
6.30 c                   goto      avslutt
     c                   endif
      *
     c                   eval      afpslr_ufil = l_filg
     c                   eval      afpslr_uide = 'BYGGDOK   '
     c     afpslr_key    chain     afpslrr
6.30 c                   if        %found(afpslr)
6.30 c                   eval      w_bdok = *on
     c                   endif
6.30  *
6.30  * Sjekk om COBUILDER aktivering er på/av
6.30  *
6.30 c                   eval      afpslr_ufil = l_filg
6.30 c                   eval      afpslr_uide = 'COBUMALNY '
6.30 c     afpslr_key    chain     afpslrr
6.30 c                   if        %found(afpslr)
6.30 c                   eval      w_cobu = *on
6.30 c                   endif

6.30 c                   if        not(w_bdok = *on or w_cobu = *on)
6.30 c                   goto      avslutt
6.30 c                   endif

      *
      * Initierer SQL for søk
      *
     c                   eval      *in15 = *off
      *
      *
     c/exec sql
     c+                  declare sok_o cursor for
     c+                  select distinct
     c+                         fwbfir,
     c+                         fwbnum
     c+                  from   fbdopf
     c+                  where  fwbfir = :w_firm and
6.30 c+                         ((fwbovf = 0 and 1=:w_bdok)
6.30 c+                         or (fwcovf = 0 and 1=:w_cobu))
     c+                  for read only
     c/end-exec
     c/exec sql
     c+                  close sok_o
     c/end-exec
     c/exec sql
     c+                  open sok_o
     c/end-exec
      *
     c                   dow       *in15 = *off
      *
     c/exec sql
     c+                  fetch next
     c+                  from  sok_o
     c+                  into  :fwbfir,
     c+                        :fwbnum
     c/end-exec
      *
     c                   if        sqlcod = 100 or sqlstt = '02000'
     c                   eval      *in15 = *on
     c                   goto      avslutt
     c                   endif
      *
      * Test om ByggDok har blitt behandlet og skal overføres
      *
     c*                  eval      w_jnav = 'ByggDok'
     c*                  eval      w_jkey = *blank
     c*                  eval      w_jtxt = *blank
     c*                  call      'AB700R  '
     c*                  parm                    w_jnav
     c*                  parm                    w_jkey
     c*                  parm                    w_jtxt
     c*                  eval      w_brpt = 'f=' + %char(fwbfir) +
     c*                                     '^&o='  + %trim(fwbnum)
     c*                                     + '^&j=' + w_jkey
     c*                  eval      w_cmd200 = 'STRPCCMD PCCMD(''start '+
     c*                            %trim(afudss)+%Trim(w_brpt)+''')  +
     c*                             Pause(*no)'
      *
      *
6.30 c                   if        w_bdok = *on
6.30 c                   call      'FO787R  '
6.30 c                   parm                    fwbnum
6.30 c                   endif
      *
6.31 c                   if        w_cobu = *on
6.31 c                   call      'FO793R  '
6.31 c                   parm                    fwbnum
6.30 c                   endif
      *
      *
     c                   enddo
      * Avslutt program
      *
     c     avslutt       tag
      *
     c                   eval      *inlr = *on
     c                   return
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ERROR-rutine
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *pssr         begsr
      *
     c                   goto      avslutt
      *
     c                   endsr
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
      *
      * Key for propertiesfil
      *
     c     afpslr_key    klist
     c                   kfld                    afpslr_ufil
     c                   kfld                    afpslr_uide
6.30  *
6.30  * Key for les av moduler Nexstep
6.30  *
6.30 c     amodl1_key    klist
6.30 c                   kfld                    amodl1_modu
      *
     c                   eval      w_firm = l_firm
      *
      *
     c                   endsr
