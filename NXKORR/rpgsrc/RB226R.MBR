     h option(*nodebugio) datedit(*dmy)
     h decedit('0.')
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
      * System  . . . . : ASOFAK
      * Program . . . . : RB002R
      * Beskrivelse . . : Leser linjer fra LOVF til kommaseparert til
      *                   (Business, kundeinfo)
      * Spesialversjon. :
      * Tilpasset for . :
      *
      * ----- ------ ---- -------------------------------------------------
      *       181012 nho  Visma  Business
      *       030418 nho  Endret tekst i heading
      *       171219 nho  Fjernet innhold i RLSTED
7.00  *       130220 nho  Henter inn firm_end
8.00  *       041021 sst  Legger ut Poststed uten postnummer
8.01  *       181021 sst  Fjerne postnummer fra poststed Hvis ikke switch
8.01  *                   ØKONOMI_EKSTERNT_POSTNR_POSTSTED er satt
8.02  *       220422 mst  InvoCust og FactNO skal sendes blank, hvis de er 0 i NextStep
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     flovfl1    if   e           k disk
     frlevl1    if   e           k disk    rename(rlevpfr:rlevl1r)
7.00 frb10l1    if   e           k disk    rename(rb10pfr:rb10l1r)
      *
      *
     frv03pf    o    e           k disk
      *
      * Definering av Local data area
      *
     d                uds
8.01 d l_filg                931    933
     d l_firm                944    946  0
      *
     d w_levr          s                   like(rllevr)
     d w_biln          s                   like(lgbiln)
     d w_firm          s                   like(lgfirm)
     d rlevl1_levr     s                   like(rllevr)
     d tell            s              1  0
     d w_rlflev        s              8
     d w_rlfacn        s              8
8.01  *
8.01  * Eksternt program
8.01   dcl-s co402_verdi1  char(1);
8.01   dcl-s co402_verdi2  char(2048);
8.01   DCL-PR CO402R EXTPGM('CO402R');
8.01     p_filgrp            char(3)     const;
8.01     p_firm              packed(3:0) const;
8.01     p_lager             packed(2:0) const;
8.01     p_nokkel            char(50)    const;
8.01     p_verdi1            char(1);
7.00     p_verdi2            char(2048);
7.00   END-PR;
7.02 d u_post          s              1    inz(*off)
      * ______________________________________________________________
      *
6.20 c                   eval      w_firm = l_firm
      *
      *
      * Leser post
     c     nyles         tag
      *
     c                   read      lovfl1                                 60
      *
610  c                   if        *in60 = '1'
610  c                   goto      slutt
610  c                   endif
      *
     c* Heading for kjøring
     c                   if        tell   = 0
     c                   add       1             tell
      *
     c                   eval      rvdata = *blank
     c                   write     rv03pfr
      *
      *
     c                   eval      rvdata = *blank
     c                   eval      rvdata = %trim('@IMPORT_METHOD(1)')
     c                   write     rv03pfr
      *
     c**                 eval      rvdata = %trim('@ActoR(=CustNO,') +
     c                   eval      rvdata = %trim('@ActoR(=SupNO,') +
     c                                           ('Nm,Shrt,Ad1,Ad2,') +
     c                                           ('PNo,PArea,Phone,') +
     c                                           ('PrivPh,Fax,') +
     c                                           ('InvoCust,FactNo)')
     c                   write     rv03pfr
      *
      * Ta vare på første bilagsnr
     c                   eval      w_biln = lgbiln
      *
     c                   endif
      *
      *
     c                   exsr      finnadr
     c**                 eval      w_biln = lgbiln
     c                   goto      nyles
      *
      * Les ny post
     c                   goto      nyles
      *
     c     slutt         tag
      *
      * Avslutnings tekster
      *
     c                   eval      rvdata = *blank
     c                   write     rv03pfr
      *
      *
     c                   eval      rvdata = *blank
7.00 c                   read      rb10l1                                 90
7.00 c**                 eval      rvdata = %trim('@FIRM_END(20063)')
7.00 c                   eval      rvdata = %trim('@FIRM_END(') +
7.00 c                                      %trim(rafirb) +
7.00 c                                      %trim(')')
     c                   write     rv03pfr
      *
     c                   eval      *inlr = *on
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Finner navn, adresse osv. / skriv post
      *
     c     finnadr       begsr
      *
     c                   eval      w_levr = lgkund
      *
     c                   eval      rlevl1_levr = w_levr
     c     rlevl1_key    chain     rlevl1                             90
8.00 c                   if        %found(rlevl1)
8.01 c                             and u_post = *off
8.00 c                             and %char(rlponr) = %subst(rlsted:1:4)
8.00 c                   eval      rlsted = %subst(rlsted:6:25)
8.00 c                   endif
8.02 c*
8.02 c                   if        rlflev = 0
8.02 c                   movel     *blanks       w_rlflev
8.02 c                   else
8.02 c                   movel     rlflev        w_rlflev
8.02 c                   endif
8.02 c                   if        rlfacn = 0
8.02 c                   movel     *blanks       w_rlfacn
8.02 c                   else
8.02 c                   movel     rlfacn        w_rlfacn
8.02 c                   endif
      *
     c                   if        *in90 = *off
     c                   eval      rvdata = *blank
     c                   eval      rvdata = %trim('"') +
      * Kundenr
     c                                     %char(w_levr)     + '" "' +
      * Navn
     c                                     %trim(rlnavn)     + '" "' +
      * Søkenavn
     c                                     %trim(rlalfa)    + '" "' +
      * Adresse 1
     c                                     %trim(rlgate)     + '" "' +
      * Adresse 2
     c                                     %trim(rladr2)     + '" "' +
      * Postnummer
     c                                     %char(rlponr)     + '" "' +
      * Poststed
     c**                                   %trim(rlsted)     + '" "' +
     c                                     %trim('" "') +
      * Telefon
     c                                     %trim(rlmobn)     + '" "' +
      * Priv. telefon
     c                                     %trim(rltlfn)     + '" "' +
      * Fax
     c                                     %trim(rltlfx)     + '" "' +
      * Fakturaknr.
8.02 c*                                    %char(rlflev)     + '" "' +
8.02 c                                     %trim(w_rlflev)     + '" "' +
      * Factoringnr.
8.02 c*                                    %char(rlfacn)     + '"'
8.02 c                                     %trim(w_rlfacn)     + '"'
      *
     c                   write     rv03pfr
     c                   endif
      *
     c                   endsr
      *
8.01  *
8.01 c     *inzsr        begsr
8.01  *
      *
      * Key for oppslag på kunde
      *
     c     rlevl1_key    klist
     c                   kfld                    w_firm
     c                   kfld                    rlevl1_levr
      *
8.01  * Skal postnummer fjernes fra Poststed
8.01  *
8.01   CallP CO402R(l_filg:w_firm:0:'ØKONOMI_EKSTERNT_POSTNR_POSTSTED':
8.01                    co402_verdi1:co402_verdi2);
8.01   if co402_verdi1 = '1';
8.01     u_post = *on;
8.01   endif;
8.01  *
8.01  *
8.01 c                   endsr
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
