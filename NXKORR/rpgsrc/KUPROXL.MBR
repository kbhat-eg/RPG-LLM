     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *Ref    Dato  Sign  Beskrivelse
8.01  *K0000 240925  bsa  Nytt program
      *
      *
      *
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     fxlkupro   up   f  512        disk
     ffkprlu    uf   e           k disk    rename(fkprpfr:fkprlur)
     frkunl1    if   e           k disk    rename(rkunpfr:rkunl1r)
      *
      * Definering av Local data area
      *
     d c_digi          c                   '0123456789 '
      *
     d                uds
     d l_user                911    920
     d l_fgr                 931    933
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av variabler i nøkler
      *
     d fkprlu_firm     s                   like(flfirm)
     d fkprlu_kund     s                   like(flkund)
     d fkprlu_kpro     s                   like(flkpro)
     d rkunl1_firm     s                   like(rkfirm)
     d rkunl1_kund     s                   like(rkkund)
      *
      * Definering av variable
      *
     d x               s              3  0
     d i               s              3  0
     d d_firm          s              3
     d d_kund          s              6
     d d_kpro          s             10
     d d_selg          s              4
     d d_fdat          s             10
     d d_tdat          s             10
     d d_navn          s             30
     d d_adr1          s             30
     d d_adr2          s             30
     d d_ponr          s              4
     d d_post          s             30
     d d_kprs          s             30
     d d_tlfa          s             15
     d d_tlfp          s             15
     d d_tlfm          s             15
     d d_mail          s             50
     d d_epro          s             15
     d d_faty          s              2
     d d_kjor          s              2
     d d_kjnr          s              5
     d d_boku          s              6
     d d_orka          s              3
     d d_okun          s              6
     d d_okpr          s              6
     d d_opda          s             10
     d d_priv          s              1
     d d_proj          s              6
     d d_bdok          s              1
     d d_cobu          s              1
     d d_mkod          s              1
     d d_betb          s              2
     d d_prpa          s              1
     d d_neto          s              1
     d d_ekgb          s              1
     d d_sekv          s              2
     d d_samf          s              1
     d d_fagb          s              1
     d d_fkun          s              1
      *
     d w_knr           s              6  0
     d w_okun          s              6  0
     d w_dat           s              6
     d w_datn          s              6  0
     d w_edat          s              6  0
     d w_fdat          s              6  0
     d w_tdat          s              6  0
     d w_pdat          s              6  0
      *
     Ixlkupro   ns  01
     I                                  1  256  kunde
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  NBNBNBNBNBNB!!!!!!!!!!
     c                   if        (%subst(kunde:1:1) <> ';'
     c                              and %subst(kunde:1:2)<> '0;')
     c                             or %subst(kunde:1:4) = ';;;;'
     c                   goto      end
     c                   endif
     c                   eval      i = 256
     c                   dow       %subst(kunde:i:1) = ' '
     c                   eval      i = i - 1
     c                   enddo
     c                   eval      %subst(kunde:i+1:5) = ';;;;;'
      * Æ,Ø,Å
     c                   eval      kunde = %xlate(x'77':'Ø':kunde)
     c                   eval      kunde = %xlate(x'14':'Ø':kunde)
     c                   eval      kunde = %xlate(x'2A':'Å':kunde)
     c                   eval      kunde = %xlate(x'1B':'Å':kunde)
     c                   eval      kunde = %xlate(x'46':'Æ':kunde)
     c                   eval      kunde = %xlate(x'1A':'Æ':kunde)
     c                   eval      kunde = %xlate(x'EF':'å':kunde)
     c                   eval      kunde = %xlate(x'90':'ø':kunde)
     c                   eval      kunde = %xlate(x'A0':'æ':kunde)
      *
      *  Firmanummer   A
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_firm = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_firm:3:1) = ' ' and
     c                             d_firm <> *blank
     c                   eval      %subst(d_firm:2:2) = %subst(d_firm:1:2)
     c                   eval      %subst(d_firm:1:1) = ' '
     c                   enddo
     c                   move      *zero         d_firm
     c                   movel     d_firm        rkunl1_firm
      *
      *  kundenummer   B
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kund = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_kund:6:1) = ' ' and
     c                             d_kund <> *blank
     c                   eval      %subst(d_kund:2:5) = %subst(d_kund:1:5)
     c                   eval      %subst(d_kund:1:1) = ' '
     c                   enddo
     c                   move      d_kund        rkunl1_kund
      *
      *  Kundeprosjekt C
      *
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kpro = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   eval      i = %scan('-':d_kpro)
     c                   if        i > 0
     c                   eval      %subst(d_kpro:i:10-i) =
     c                             %subst(d_kpro:i+1:10-i)
     c                   eval      %subst(d_kpro:10:1) = *blank
     c                   endif
     c                   dow       %subst(d_kpro:10:1) = ' ' and
     c                             d_kpro <> *blank
     c                   eval      %subst(d_kpro:2:9) = %subst(d_kpro:1:9)
     c                   eval      %subst(d_kpro:1:1) = ' '
     c                   enddo
      *
      *  Selger nummer  D
      *
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_selg = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_selg:4:1) = ' ' and
     c                             d_selg <> *blank
     c                   eval      %subst(d_selg:2:3) = %subst(d_selg:1:3)
     c                   eval      %subst(d_selg:1:1) = ' '
     c                   enddo
      *
      *  Fra dato    E
      *
     c                   eval      w_dat = *blanks
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_fdat = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   if            %subst(d_fdat:3:1) = '.'
     c                             and %subst(d_fdat:6:1) = '.'
     c                   eval      w_dat  = %subst(d_fdat:1:2)
     c                                    + %subst(d_fdat:4:2)
     c                                    + %subst(d_fdat:9:2)
     c                   endif
     c                   if            %subst(d_fdat:5:1) = '-'
     c                             and %subst(d_fdat:8:1) = '-'
     c                   eval      w_dat  = %subst(d_fdat:9:2)
     c                                    + %subst(d_fdat:6:2)
     c                                    + %subst(d_fdat:3:2)
     c                   endif
     c                   eval      x = 0
     c                   eval      x = %len(%trim(d_fdat))
     c                   if        x = 10
     c                   if            %subst(d_fdat:5:1) = '/'
     c                             and %subst(d_fdat:8:1) = '/'
     c                   eval      w_dat  = %subst(d_fdat:9:2)
     c                                    + %subst(d_fdat:6:2)
     c                                    + %subst(d_fdat:3:2)
     c                   endif
     c                   if            %subst(d_fdat:3:1) = '/'
     c                             and %subst(d_fdat:6:1) = '/'
     c                   eval      w_dat  = %subst(d_fdat:9:2)
     c                                    + %subst(d_fdat:4:2)
     c                                    + %subst(d_fdat:1:2)
     c                   endif
     c                   endif
     c                   if        %trim(w_dat) = *blanks
     c                   eval      w_dat = '000000'
     c                   endif
     c                   move      w_dat         w_fdat
      *
      *  Til dato F
      *
     c                   eval      w_dat = *blanks
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_tdat = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   if            %subst(d_tdat:3:1) = '.'
     c                             and %subst(d_tdat:6:1) = '.'
     c                   eval      w_dat  = %subst(d_tdat:1:2)
     c                                    + %subst(d_tdat:4:2)
     c                                    + %subst(d_tdat:9:2)
     c                   endif
     c                   if            %subst(d_tdat:5:1) = '-'
     c                             and %subst(d_tdat:8:1) = '-'
     c                   eval      w_dat  = %subst(d_tdat:9:2)
     c                                    + %subst(d_tdat:6:2)
     c                                    + %subst(d_tdat:3:2)
     c                   endif
     c                   eval      x = 0
     c                   eval      x = %len(%trim(d_tdat))
     c                   if        x = 10
     c                   if            %subst(d_tdat:5:1) = '/'
     c                             and %subst(d_tdat:8:1) = '/'
     c                   eval      w_dat  = %subst(d_tdat:9:2)
     c                                    + %subst(d_tdat:6:2)
     c                                    + %subst(d_tdat:3:2)
     c                   endif
     c                   if            %subst(d_tdat:3:1) = '/'
     c                             and %subst(d_tdat:6:1) = '/'
     c                   eval      w_dat  = %subst(d_tdat:9:2)
     c                                    + %subst(d_tdat:4:2)
     c                                    + %subst(d_tdat:1:2)
     c                   endif
     c                   endif
     c                   if        %trim(w_dat) = *blanks
     c                   eval      w_dat = '000000'
     c                   endif
     c                   move      w_dat         w_tdat
      *
      *  Navn        G
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_navn = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Adresse1    H
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_adr1 = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Adresse2    I
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_adr2 = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Postsnummer J
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ponr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_ponr:4:1) = ' ' and
     c                             d_ponr <> *blank
     c                   eval      %subst(d_ponr:2:3) = %subst(d_ponr:1:3)
     c                   eval      %subst(d_ponr:1:1) = '0'
     c                   enddo
      *
      *  kontaktperson  K
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kprs = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Telefonnummer, arbeid  L
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_tlfa = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Telefonnummer, Privat  M
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_tlfp = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Mobilnummer  N
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_tlfm = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  mail adresse  O
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_mail = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   if        d_mail = '0 '
     c                   eval      d_mail = *blank
     c                   endif
      *  Eksternt prosjekt  P
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_epro = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Fakturatype  Q
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_faty = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Kjørerute  R
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kjor = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   eval      %subst(d_kjor:1:1) = ' '
      *  Kjørerute rekkefølge S
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kjnr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   eval      %subst(d_kjnr:1:1) = ' '
     c                   dow       %subst(d_kjnr:5:1) = ' ' and
     c                             d_kjnr <> *blank
     c                   eval      %subst(d_kjnr:2:4) = %subst(d_kjnr:1:4)
     c                   eval      %subst(d_kjnr:1:1) = ' '
     c                   enddo
      *  Kundenummer bonuskunde T
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_boku = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_boku:6:1) = ' ' and
     c                             d_boku <> *blank
     c                   eval      %subst(d_boku:2:5) = %subst(d_boku:1:5)
     c                   eval      %subst(d_boku:1:1) = ' '
     c                   enddo
      *  Rabatt kategori  U
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_orka = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_orka:3:1) = ' ' and
     c                             d_orka <> *blank
     c                   eval      %subst(d_orka:2:2) = %subst(d_orka:1:2)
     c                   eval      %subst(d_orka:1:1) = ' '
     c                   enddo
      *  Rabatt fra kundenr  V
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_okun = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_okun:6:1) = ' ' and
     c                             d_okun <> *blank
     c                   eval      %subst(d_okun:2:5) = %subst(d_okun:1:5)
     c                   eval      %subst(d_okun:1:1) = ' '
     c                   enddo
      *  Rabatt fra kunde/kundeprosjekt W
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_okpr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_okpr:6:1) = ' ' and
     c                             d_okpr <> *blank
     c                   eval      %subst(d_okpr:2:5) = %subst(d_okpr:1:5)
     c                   eval      %subst(d_okpr:1:1) = ' '
     c                   enddo
      *  Overstyrt prisdato      X
     c                   eval      w_dat = *blanks
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_opda = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   if            %subst(d_opda:3:1) = '.'
     c                             and %subst(d_opda:6:1) = '.'
     c                   eval      w_dat  = %subst(d_opda:1:2)
     c                                    + %subst(d_opda:4:2)
     c                                    + %subst(d_opda:9:2)
     c                   endif
     c                   if            %subst(d_opda:5:1) = '-'
     c                             and %subst(d_opda:8:1) = '-'
     c                   eval      w_dat  = %subst(d_opda:9:2)
     c                                    + %subst(d_opda:6:2)
     c                                    + %subst(d_opda:3:2)
     c                   endif
     c                   eval      x = 0
     c                   eval      x = %len(%trim(d_opda))
     c                   if        x = 10
     c                   if            %subst(d_opda:5:1) = '/'
     c                             and %subst(d_opda:8:1) = '/'
     c                   eval      w_dat  = %subst(d_opda:9:2)
     c                                    + %subst(d_opda:6:2)
     c                                    + %subst(d_opda:3:2)
     c                   endif
     c                   if            %subst(d_opda:3:1) = '/'
     c                             and %subst(d_opda:6:1) = '/'
     c                   eval      w_dat  = %subst(d_opda:9:2)
     c                                    + %subst(d_opda:4:2)
     c                                    + %subst(d_opda:1:2)
     c                   endif
     c                   endif
     c                   if        %trim(w_dat) = *blanks
     c                   eval      w_dat = '000000'
     c                   endif
     c                   move      w_dat         w_pdat
      *  Privat  Y
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_priv = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *
      *  Regnskapsprosjekt Z
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_proj = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  ByggDok AA
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_bdok = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Cobuilder AB
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_cobu = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  MVA beregning  AC
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_mkod = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Betalingsbetingelse  AD
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_betb = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_betb:2:1) = ' ' and
     c                             d_betb <> *blank
     c                   eval      %subst(d_betb:2:1) = %subst(d_betb:1:1)
     c                   eval      %subst(d_betb:1:1) = ' '
     c                   enddo
      *  Pris/Pakkseddel AE
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_prpa = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Pris/Faktura  AF
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_neto = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Ekspedisjonsgebyr  AG
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ekgb = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Fakturasekvens  AH
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_sekv = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
     c                   dow       %subst(d_sekv:2:1) = ' ' and
     c                             d_sekv <> *blank
     c                   eval      %subst(d_sekv:2:1) = %subst(d_sekv:1:1)
     c                   eval      %subst(d_sekv:1:1) = ' '
     c                   enddo
      *  Samlefaktura  AI
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_samf = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Fakturagebyr  AJ
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_fagb = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *  Frikoblet kunde  AK
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_fkun = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:256-i)
      *
     c     ikkefler      tag
      *
      *  Kundeprosjekt
      *
     c                   eval      fkprlu_firm = *zero
     c                   eval      rkunl1_firm = *zero
     c                   move      d_firm        fkprlu_firm
     c                   move      d_kund        fkprlu_kund
     c                   move      d_kpro        fkprlu_kpro
      *
     c     fkprlu_key    chain     fkprlur
     c                   if        %found(fkprlu)
     c                   move      d_selg        flselg
     c     *dmy          move      w_fdat        flfdat
     c     *dmy          move      w_tdat        fltdat
     c                   movel     d_navn        flnavn
     c                   movel     d_adr1        fladr1
     c                   movel     d_adr2        fladr2
     c                   move      d_ponr        flponr
     c                   movel     d_kprs        flkprs
     c                   move      d_tlfa        fltlfa
     c                   move      d_tlfp        fltlfp
     c                   move      d_tlfm        fltlfm
     c                   move      d_mail        flmail
     c                   move      d_epro        flepro
     c                   move      d_faty        flfaty
     c                   move      d_boku        flboku
     c                   move      d_orka        florka
     c                   move      d_okun        w_okun
     c                   eval      flokun = w_okun
     c                   move      d_okpr        flokpr
     c                   if        w_pdat <> 0
     c     *dmy          move      w_pdat        flopda
     c                   endif
     c                   move      d_proj        flproj
     c                   move      d_bdok        flbdok
     c                   move      d_cobu        flcobu
     c                   move      d_mkod        flmkod
     c                   move      d_betb        flbetb
      *
      * Ikke oppdater med verdier fra kunde, da dette bør være basert
      * på info i regnearket.
      *
8.xx c                   if        1 = 2
     c                   move      d_kund        rkunl1_kund
     c     rkunl1_key    chain     rkunl1
     c                   if        %found(rkunl1)
     c                   eval      flmkod = rkmkod
     c                   eval      flekgb = rkekgb
     c                   eval      flprpa = rkprpa
     c                   eval      flneto = rkneto
     c                   eval      flsamf = rksamf
     c                   eval      flsekv = rksekv
     c                   eval      flbetb = rkbetb
     c                   eval      flfagb = rkfagb
     c                   eval      flfaty = rkfaty
     c                   endif
8.xx c                   endif
      *
     c                   eval      fleusr = l_user
     c                   time                    fledat
     c                   time                    fletim
     c                   update    fkprlur
      *
     c                   endif
      *
     c     end           tag
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
     c     fkprlu_key    klist
     c                   kfld                    fkprlu_firm
     c                   kfld                    fkprlu_kund
     c                   kfld                    fkprlu_kpro
      *
     c     rkunl1_key    klist
     c                   kfld                    rkunl1_firm
     c                   kfld                    rkunl1_kund
      *
     c                   endsr
