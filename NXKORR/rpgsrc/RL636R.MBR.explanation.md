# Program Overview

This RPG program is designed to **print open items for suppliers** ("Utskrift av åpne poster - leverandører"). It is an ILE RPG (RPG IV) application following traditional fixed-format coding style, meant for execution on IBM i (AS/400) systems. The program structure encompasses database file I/O, print file output, integration with spooling, and (in later versions) XML and PDF generation for output presentation.

The code is annotated in Norwegian, with version history and comments throughout.

## File Declarations

- **Input Files**
  - `rlevl1`, `rltrl9`, `aforl1`: Supplier, transaction and routine master files, all with external descriptions (`if`), keyed access (`k disk`), and renamed record formats.
- **Output File**
  - `rl636p`: Printer file for report output, with overflow indicator `*in30` and manual open (`usropn`).

## Data Structures & Variables

### Working Storage
Defined for holding supplier, company, and other report details, e.g.:
- `w_firm`, `w_prfi`, `w_ffir`, etc.: Company and address info.
- `p_levr`: Passed supplier key.
- Other fields for periods, balancing, and reporting.

### Spool and XML Integration (v8.01+)
Additional variables handle:
- Spool file information (to identify and manipulate print jobs)
- XML tag/value pairs for output
- Integration to external programs for generating and previewing XML/PDF (`AP627R`, `AP621R`).

### Local Data
Overlay structure for parameter data, company fields, user, etc.

## Main Program Logic

### Initialization (`*INZSR`)
- Receives supplier key as parameter (`p_levr`).
- Opens the printer file.
- Sets up company and supplier key lists for file I/O.
- Optionally, retrieves company info from routine master and/or calls external program (`RÅ707R`) to get company address info, saving it into record fields for printing.
- Optionally clears company info, based on a flag (`w_prfi`).

### Mainline
- Reads supplier master (`rlevl1`) for the given key.
- Outputs header.
- Executes `les_levtr` subroutine to process supplier transactions.
- Outputs totals.
- Performs end-of-job logic, including XML and PDF steps if required.

### Supplier Transaction Reading (`les_levtr`)
- Reads supplier transactions (`rltrl9`) for the supplier.
- For each item:
  - Checks posting period versus report period.
  - Updates totals (balance).
  - Writes transaction line to report.
  - Handles print file overflow by reprinting the header.
- Loops until all open items are read.

### End-of-Job (if statement on `l_poff`)
- Gets spool number via QSPRILSP API.
- Closes printer file.
- Calls subroutines to create XML (`xml_create`), preview PDF (`pdf_preview`).
- Calls another program (`AB710R`) to finalize processing.

## Subroutines (v8.01+)

### `spoolnbr`
- Calls system API `QSPRILSP` to retrieve spool file metadata for further processing.

### `xml_create`
- Sets up blank/default values for multiple possible XML tags and info fields.
- Calls external program (`AP627R`) with all relevant print and report meta-information to generate an XML document for the report.

### `pdf_preview`
- If flag set (`l_skje = 1`), calls program (`AP621R`) to launch PDF preview in a browser, passing batch info.

## Notable Features

- **Version Control:** Extensive in-code versioning and modification comments.
- **Internationalization:** Norwegian comments and fields, but standard RPG logic.
- **API/Program Calls:** Uses IBM i system APIs and external application programs for advanced reporting and output (PDF, XML).
- **Manual Spool Handling:** Determines spool file info programmatically for integration.

---

## Key RPG Statements in Context

- `chain`, `setll`, `reade`: Used for keyed reads and loops over physical files.
- `write`: Outputs records to report (printer) file.
- `open`, `close`: Manual print file handling (`usropn`).
- `call`, `parm`: Calls external CL/ILE or integration programs.
- `begsr`, `endsr`, `exsr`: RPG subroutine structure.
- Parameters come in via PLIST and are moved/overlaid into working variables for logic.

---

## Summary

**This program prints a report of open supplier ledger items, supports total calculation and detail printing, and (in newer versions) integrates with spooling, XML, and PDF output to support modernized reporting and documentation requirements.** It leverages IBM i's modular programming and external program call capabilities to connect classic RPG reporting with contemporary output technologies. The code is a good example of evolving RPG programs on the IBM i platform, blending legacy logic with new output formats.