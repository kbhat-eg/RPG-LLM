     h option(*nodebugio) datedit(*dmy)
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *Ref    Dato  Beskrivelse
      *
8.00  *K000  170925 Nytt program
8.01  *K000  230925 Endret håndtering av kundekategori.
      *
      *
      *
      *-------------------------------------------------------------------------
      * Inputrecord:
      *(Firma)    Kundenr.  Kortnr.   Kundenavn Adresse   Adresse2  Postnr
      * Poststed  Bet.Bet   Bet.måte  Samlefakt FaktType  PrisPakk  Kr.Grens
      * Kr.sperr  Kr.Type   RabKat    Kundekat  Orgnr     Kont.Pers KontPMail
      * Telefon   Mobil     Passiv    Faktf fsekSpesAvt   SpesAvttxtePostadr
      *
      *  Skal kun oppdatere eksisterende poster
      *
      *
      *-------------------------------------------------------------------------
      *
     fxlkunde   up   f 1024        disk
     frkunlu    uf   e           k disk    rename(rkunpfr:rkunlur)
     frkunl4    uf   e           k disk    rename(rkunpfr:rkunl4r)
     f                                     prefix(S:1)
     f*rukplu    uf   e           k disk    rename(rukppfr:rukplur)
     frkbplu    uf   e           k disk    rename(rkbppfr:rkbplur)
      *
      * Definering av Local data area
      *
     d                uds
     d l_user                911    920
     d l_fgr                 931    933
     d l_firm                944    946  0
     d l_fnav                951    980
      *
      * Definering av variabler i nøkler
      *
     d rkunlu_firm     s                   like(rkfirm)
     d rkunlu_kund     s                   like(rkkund)
     d rkunl4_firm     s                   like(rkfirm)
     d rkunl4_ftnr     s                   like(rkftnr)
     d*rukplu_firm     s                   like(rufirm)
     d*rukplu_kund     s                   like(rukund)
     d*rukplu_levr     s                   like(rukund)
     d*rukplu_kpnr     s                   like(rukpnr)
     d rkbplu_firm     s                   like(rkbfir)
     d rkbplu_kund     s                   like(rkbkun)
      *
      * Definering av variable
      *
     d w_ogrn          s                    like(rkogrn)
     d w_tgrn          s                    like(rktgrn)
     d w_gdat          s                    like(rkgdat)
      *
     d i               s              4  0
     d vare            s             15
     d w_grns          s              9  0
     d w_kper          s             30
     d w_amdedat       s              6  0
      *
     d d_firm          s              3
     d d_kund          s              9
     d d_knav          s             50
     d d_alfa          s             50
     d d_kadr          s             50
     d d_kad2          s             50
     d d_kpnr          s              4
     d d_upnr          s              9
     d d_kpst          s                        like(rksted)
     d d_kbtb          s              3
     d d_kbtm          s             10
     d d_ksam          s             10
     d d_kfty          s              2
     d d_kprp          s              1
     d d_kgrn          s              9
     d d_kgrk          s                        like(rkkgrk)
     d d_klan          s              2
     d d_kmva          s              1
     d d_krek          s              1
     d d_prpa          s              1
     d d_kspr          s              4
     d d_kres          s             10
     d d_krab          s             10
     d d_kkat          s             10
     d d_konr          s              9
     d d_kper          s             30
     d d_kbnr          s             11
     d d_ktlf          s                        like(rktlfn)
     d d_kmob          s                        like(rkmobn)
     d d_kepo          s                        like(rkemal)
     d d_kfax          s                        like(rktlfx)
     d d_kpas          s                        like(rkpass)
     d d_fagb          s              1
     d d_ksek          s              2
     d d_kspa          s              1
     d d_kmal          s                        like(rkemal)
     d d_prdo          s             10
     d d_pbok          s              1
     d d_kjop          s             11
     d d_kjof          s             11
     d d_edat          s             10
     d d_n1            s             30
     d d_n2            s             30
     d d_n3            s             30
     d d_n4            s             30
     d d_ndat          s             10
     d d_penr          s             11
     d d_eank          s             13
     d d_eanf          s             13
     d d_ogrn          s             10
     d d_tgrn          s             10
     d d_gdat          s             10
     d d_fcop          s              1
     d d_renk          s              1
     d d_purr          s              1
     d d_slgr          s              4
     d d_dist          s              4
     d d_avde          s              4
     d d_lagr          s              2
     d d_spl1          s              1
     d d_spl2          s              1
     d d_spl3          s              1
     d d_spl4          s              1
     d d_spl5          s              1
     d d_neto          s              1
     d d_ebiz          s              1
      *
     d p_firm          s              3
     d p_kund          s              6
      *
      * Definering av konstanter
      *
     d Lo              c                   'abcdefghijklmnopqrstuvwxyzæøå'
     d Up              c                   'ABCDEFGHIJKLMNOPQRSTUVWXYZÆØÅ'
      *
      *
     Ixlkunde   ns  01
     I                                  1  768  kunde
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  NBNBNBNBNBNB!!!!!!!!!!
     c                   if           (%subst(kunde:1:2) <> '0;'
     c                             and %subst(kunde:1:1) <> ';')
     c                             or  %subst(kunde:1:5)  = ';;;;;'
     c                   goto      end
     c                   endif
      *
     c                   eval      d_kund = *blank
     c                   eval      d_knav = *blank
     c                   eval      d_alfa = *blank
     c                   eval      d_kadr = *blank
     c                   eval      d_kad2 = *blank
     c                   eval      d_kpnr = *blank
     c                   eval      d_upnr = *blank
     c                   eval      d_kpst = *blank
     c                   eval      d_kbtb = *blank
     c                   eval      d_kbtm = *blank
     c                   eval      d_ksam = *blank
     c                   eval      d_kfty = *blank
     c                   eval      d_kprp = *blank
     c                   eval      d_kgrn = *blank
     c                   eval      d_kgrk = *blank
     c                   eval      d_klan = *blank
     c                   eval      d_kmva = *blank
     c                   eval      d_krek = *blank
     c                   eval      d_kspr = *blank
     c                   eval      d_kres = *blank
     c                   eval      d_krab = *blank
     c                   eval      d_kkat = *blank
     c                   eval      d_konr = *blank
     c                   eval      d_kper = *blank
     c                   eval      d_kbnr = *blank
     c                   eval      d_ktlf = *blank
     c                   eval      d_kmob = *blank
     c                   eval      d_kepo = *blank
     c                   eval      d_kfax = *blank
     c                   eval      d_kpas = *blank
     c                   eval      d_fagb = *blank
     c                   eval      d_ksek = *blank
     c                   eval      d_kspa = *blank
     c                   eval      d_kmal = *blank
     c                   eval      d_pbok = *blank
     c                   eval      d_kjop = *blank
     c                   eval      d_kjof = *blank
     c                   eval      d_n1   = *blank
     c                   eval      d_n2   = *blank
     c                   eval      d_n3   = *blank
     c                   eval      d_n4   = *blank
     c                   eval      d_ndat = *blank
     c                   eval      d_ogrn = *blank
     c                   eval      d_tgrn = *blank
     c                   eval      d_gdat = *blank
     c                   eval      d_fcop = *blank
     c                   eval      d_renk = *blank
     c                   eval      d_purr = *blank
     c                   eval      d_slgr = *blank
     c                   eval      d_dist = *blank
     c                   eval      d_avde = *blank
     c                   eval      d_lagr = *blank
     c                   eval      d_spl1 = *blank
     c                   eval      d_spl2 = *blank
     c                   eval      d_spl3 = *blank
     c                   eval      d_spl4 = *blank
     c                   eval      d_spl5 = *blank
     c                   eval      d_neto = *blank
      *
     c                   eval      i = 768
     c                   dow       %subst(kunde:i:1) = *blank
     c                   eval      i = i - 1
     c                   enddo
     c                   eval      %subst(kunde:i+1:10) = ';;;;;;;;;;'
     c                   eval      %subst(kunde:i+11:10) = ';;;;;;;;;;'
     c                   eval      %subst(kunde:i+21:10) = ';;;;;;;;;;'
      * Æ,Ø,Å
     c                   eval      kunde = %xlate(x'77':'Ø':kunde)
     c                   eval      kunde = %xlate(x'14':'Ø':kunde)
     c                   eval      kunde = %xlate(x'2A':'Å':kunde)
     c                   eval      kunde = %xlate(x'1B':'Å':kunde)
     c
     c                   eval      kunde = %xlate(x'1A':'Æ':kunde)
     c                   eval      kunde = %xlate(x'EF':'å':kunde)
     c                   eval      kunde = %xlate(x'06':'å':kunde)
     c                   eval      kunde = %xlate(x'3B':'ø':kunde)
     c                   eval      kunde = %xlate(x'90':'ø':kunde)
     c                   eval      kunde = %xlate(x'A0':'æ':kunde)
     c                   eval      kunde = %xlate(x'31':'æ':kunde)
     c                   eval      kunde = %xlate(x'41':' ':kunde)
      *
      * Så begynner vi å lese poster
      *
      * Firmanummer - RKFIRM
      *
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_firm = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_firm:3:1) = ' ' and
     c                             d_firm <> *blank
     c                   eval      %subst(d_firm:2:2) = %subst(d_firm:1:2)
     c                   eval      %subst(d_firm:1:1) = ' '
     c                   enddo
     c                   movel     d_firm        rkunlu_firm
      * Kundenummer - RKKUND
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kund = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_kund:9:1) = ' ' and
     c                             d_kund <> *blank
     c                   eval      %subst(d_kund:2:8) = %subst(d_kund:1:8)
     c                   eval      %subst(d_kund:1:1) = '0'
     c                   enddo
      * Kundenavn - RKNAVN
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_knav = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Kunde-alfa - RKALFA
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_alfa = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Kunde-adrese 1 - RKGATE
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kadr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Kunde-adrese 2 - RKADR2
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kad2 = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Postnummer, kunde - RKPONR
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kpnr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_kpnr:4:1) = ' ' and
     c                             d_kpnr <> *blank
     c                   eval      %subst(d_kpnr:2:3) = %subst(d_kpnr:1:3)
     c                   eval      %subst(d_kpnr:1:1) = '0'
     c                   enddo
      * Utenlandsk postnummer, kunde - RKUPNR
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_upnr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Kunde-poststed - RKSTED
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kpst = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Betalingsbetingelse - RKBETB
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kbtb = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_kbtb:3:1) = ' ' and
     c                             d_kbtb <> *blank
     c                   eval      %subst(d_kbtb:2:2) = %subst(d_kbtb:1:2)
     c                   eval      %subst(d_kbtb:1:1) = '0'
     c                   enddo
      * Betalingsmåte - RKBETM
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kbtm = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Samlefaktura - RKSAMM
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ksam = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Pris på pakkseddel - RKPRPA
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kprp = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Kreditgrense i hele tusen - RKGRNS
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kgrn = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_kgrn:9:1) = ' ' and
     c                             d_kgrn <> *blank
     c                   eval      %subst(d_kgrn:2:8) = %subst(d_kgrn:1:8)
     c                   eval      %subst(d_kgrn:1:1) = ' '
     c                   enddo
      * Kredittype - RKKRES
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kres = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Rabattkategori - RKRABK
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_krab = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_krab:10:1) = ' ' and
     c                             d_krab <> *blank
     c                   eval      %subst(d_krab:2:9) = %subst(d_krab:1:9)
     c                   eval      %subst(d_krab:1:1) = ' '
     c                   enddo
      * Kundeandørkategori - RKKATG
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kkat = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   if        %subst(d_kkat:1:1) >= '0' and
     c                             %subst(d_kkat:1:1) <= '9'
     c                   dow       %subst(d_kkat:10:1) = ' '  and
     c                             d_kkat <> *blank
     c                   eval      %subst(d_kkat:2:9) = %subst(d_kkat:1:9)
     c                   eval      %subst(d_kkat:1:1) = ' '
     c                   enddo
     c                   endif
      * Organisasjonsnummer - RKFTNR
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_konr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_konr:9:1) = ' ' and
     c                             d_konr <> *blank
     c                   eval      %subst(d_konr:2:8) = %subst(d_konr:1:8)
     c                   eval      %subst(d_konr:1:1) = '0'
     c                   enddo
      * Fakt.gebyr - RKFAGB
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_fagb = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * email adresse - RKEMAL
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kepo = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Telefonnummer - RKTLFN
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ktlf = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Telefax - RKTLFX
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kfax = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Mobil nummer - RKMOBN
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kmob = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Land-kode - RKLAND
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_klan = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
NB    * Passiv - RKPASS
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kpas = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Faktura sekvens - RKSEKV
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ksek = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_ksek:2:1) = ' ' and
     c                             d_ksek <> *blank
     c                   eval      %subst(d_ksek:2:1) = %subst(d_ksek:1:1)
     c                   eval      %subst(d_ksek:1:1) = '0'
     c                   enddo
      * Prisbok - RKPBOK
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_pbok = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Kjøp i år - RKSALD
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kjop = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Kjøp i fjor - RKSAIF
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kjof = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Mva fritt - RKMKOD
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kmva = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Krav til Rekv - RKREKV
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_krek = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Fakturatype - RKFATY
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kfty = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_kfty:2:1) = ' ' and
     c                             d_kfty <> *blank
     c                   eval      %subst(d_kfty:2:1) = %subst(d_kfty:1:1)
     c                   eval      %subst(d_kfty:1:1) = '0'
     c                   enddo
      * Sperret - RKSPRK
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kspr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Opprettet.dato - RKNDAT
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ndat = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Personnr. - RKPENR
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_penr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   if        %check(' 0123456789':d_penr) > 1
     c                   eval      d_penr = *blank
     c                   endif
     c                   dow       %subst(d_penr:11:1) = ' ' and
     c                             d_penr <> *blank
     c                   eval      %subst(d_penr:2:10) = %subst(d_penr:1:10)
     c                   eval      %subst(d_penr:1:1) = '0'
     c                   enddo
      * Ean-kunde - RKENAK
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_eank = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_eank:13:1) = ' ' and
     c                             d_eank <> *blank
     c                   eval      %subst(d_eank:2:12) = %subst(d_eank:1:12)
     c                   eval      %subst(d_eank:1:1) = '0'
     c                   enddo
      * Ean-faktura-kunde - RKEANF
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_eanf = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_eanf:13:1) = ' ' and
     c                             d_eanf <> *blank
     c                   eval      %subst(d_eanf:2:12) = %subst(d_eanf:1:12)
     c                   eval      %subst(d_eanf:1:1) = '0'
     c                   enddo
      * Oppr.kredit grense - RKOGRN
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ogrn = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_ogrn:10:1) = ' ' and
     c                             d_ogrn <> *blank
     c                   eval      %subst(d_ogrn:2:09) = %subst(d_ogrn:1:09)
     c                   eval      %subst(d_ogrn:1:1) = '0'
     c                   enddo
      * Tilleggs.kredit - RKTGRN
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_tgrn = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_tgrn:10:1) = ' ' and
     c                             d_tgrn <> *blank
     c                   eval      %subst(d_tgrn:2:09) = %subst(d_tgrn:1:09)
     c                   eval      %subst(d_tgrn:1:1) = '0'
     c                   enddo
      * Tilleggs.kredit dato - RKGDAT
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_gdat = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Ant. faktura kopier - RKFCOP
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_fcop = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Rentekode - RKRENK
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_renk = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Purrekode - RKPURR
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_purr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Selger - RKSLGR
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_slgr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_slgr:4:1) = ' ' and
     c                             d_slgr <> *blank
     c                   eval      %subst(d_slgr:2:03) = %subst(d_slgr:1:03)
     c                   eval      %subst(d_slgr:1:1) = '0'
     c                   enddo
      * Distrikt - RKDIST
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_dist = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_dist:4:1) = ' ' and
     c                             d_dist <> *blank
     c                   eval      %subst(d_dist:2:03) = %subst(d_dist:1:03)
     c                   eval      %subst(d_dist:1:1) = '0'
     c                   enddo
      * Avdeling - RKAVDE
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_avde = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_avde:4:1) = ' ' and
     c                             d_avde <> *blank
     c                   eval      %subst(d_avde:2:03) = %subst(d_avde:1:03)
     c                   eval      %subst(d_avde:1:1) = '0'
     c                   enddo
      * Lager - RKLAGR
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_lagr = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
     c                   dow       %subst(d_lagr:2:1) = ' ' and
     c                             d_lagr <> *blank
     c                   eval      %subst(d_lagr:2:01) = %subst(d_lagr:1:01)
     c                   eval      %subst(d_lagr:1:1) = '0'
     c                   enddo
      * Egne koder 1 - 5 - RKFRIE
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_spl1 = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      *
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_spl2 = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      *
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_spl3 = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      *
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_spl4 = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      *
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_spl5 = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Pris på faktura - RKNETO
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_neto = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * Kreditkode - RKKKOD
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_kgrk = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      * EBIZ - RKEBIZ
     c                   eval      i = %scan(';':kunde)
     c                   eval      d_ebiz = %trim(%subst(kunde:1:i-1))
     c                   eval      kunde  = %subst(kunde:i+1:768-i)
      *
     c     Ikke_Flere    tag
      *  ---------------------------------------------------------------------
     c                   move      d_kund        rkunlu_kund
      *
     c     rkunlu_key    chain     rkunlu
     c                   if        %found(rkunlu)
     c*                  if        not %found(rkunlu)
     c*                  clear                   rkunlur
      *
     c*                  eval      rkfirm = rkunlu_firm
     c*                  eval      rkkund = rkunlu_kund
     c                   movel     d_knav        rknavn
     c     Lo:Up         xlate     rknavn        rknavn
     c                   movel     d_kadr        rkgate
     c     Lo:Up         xlate     rkgate        rkgate
     c                   movel     d_kad2        rkadr2
     c     Lo:Up         xlate     rkadr2        rkadr2
     c                   move      d_kpnr        rkponr
     c                   if        d_alfa = *blank
     c                   movel     d_knav        d_alfa
     c                   endif
     c                   movel     d_alfa        rkalfa
     c                   if        %subst(d_kpst:1:1) >= '0'
     c                             and %subst(d_kpst:1:1) <= '9'
     c                   eval      rksted = d_kpst
     c                   else
     c                   eval      rksted = %trim(d_kpnr + ' ' +
     c                                      %trim(d_kpst))
     c                   endif
     c                   if        d_kpnr = *blank and
     c                             %subst(rksted:1:1) >= '0' and
     c                             %subst(rksted:1:1) <= '9' and
     c                             %subst(rksted:2:1) >= '0' and
     c                             %subst(rksted:2:1) <= '9' and
     c                             %subst(rksted:3:1) >= '0' and
     c                             %subst(rksted:3:1) <= '9' and
     c                             %subst(rksted:4:1) >= '0' and
     c                             %subst(rksted:4:1) <= '9' and
     c                             %subst(rksted:5:1)  = ' '
     c                   movel     rksted        rkponr
     c                   endif
     c                   if        %subst(rksted:5:4) = 'OSLO'
     c                   eval      rksted = '0' + %trim(rksted)
     c                   endif
     c                   if        d_upnr <> *blank
     c                   move      d_upnr        rkupnr
     c                   endif
     c                   if        d_kbtb <> *blank
     c                   move      d_kbtb        rkbetb
     c                   endif
     c                   move      d_kbtm        rkbetm
     c                   movel     d_ksam        rksamf
     c                   if        d_kprp <> *blank
     c                   move      d_kprp        rkprpa
     c                   endif
     c                   if        d_kgrn <> *blank
     c                   move      d_kgrn        w_grns
     c                   eval      rkgrns = w_grns
     c                   endif
     c                   move      d_ogrn        w_ogrn
     c                   move      d_tgrn        w_tgrn
     c                   eval      rkgrns = w_ogrn + w_tgrn
      *
     c                   movel     d_kres        rkkres
     c                   move      d_krab        rkrabk
     c                   move      d_kkat        rkkatg
      *
     c                   if        d_konr <> *blank
     c                   move      d_konr        rkftnr
     c                   endif
     c                   if        d_fagb <> *blank
     c                   move      d_fagb        rkfagb
     c                   endif
     c                   if        d_kepo <> *blank
     c                   movel     d_kepo        rkemal
     c                   endif
     c                   if        d_ktlf <> *blank
     c                   movel     d_ktlf        rktlfn
     c                   endif
     c                   if        d_kfax <> *blank
     c                   movel     d_kfax        rktlfx
     c                   endif
     c                   if        d_kmob <> *blank
     c                   movel     d_kmob        rkmobn
     c                   endif
     c                   if        d_klan <> *blank
     c                   move      d_klan        rkland
     c                   endif
     c                   move      d_kpas        rkpass
     c                   if        d_ksek <> *blank
     c                   move      d_ksek        rksekv
     c                   endif
     c                   if        d_pbok <> *blank
     c                   eval      rkpbok = %dec(d_pbok:1:0)
     c                   endif
     c                   if        d_kmva <> *blank
     c                   move      d_kmva        rkmkod
     c                   endif
     c                   if        d_krek <> *blank
     c                   move      d_krek        rkrekv
     c                   endif
     c                   if        d_kfty <> *blank
     c                   move      d_kfty        rkfaty
     c                   endif
     c                   movel     d_kspr        rksprk
     c                   move      d_penr        rkpenr
     c                   move      d_eank        rkeank
     c                   move      d_eanf        rkeanf
      *
     c                   move      d_ogrn        w_ogrn
     c                   move      d_tgrn        w_tgrn
     c                   move      d_fcop        rkfcop
     c                   move      d_neto        rkneto
     c                   eval      w_amdedat = *zero
     c                   if        %subst(d_gdat:5:1) = '-'
     c                             and %subst(d_gdat:8:1) = '-'
     c                   eval      d_gdat = %subst(d_gdat:3:2) +
     c                                      %subst(d_gdat:6:2) +
     c                                      %subst(d_gdat:9:2)
     c                   movel     d_gdat        w_amdedat
     c                   endif
     c                   if        %subst(d_gdat:3:1) = '.'
     c                             and %subst(d_gdat:6:1) = '.'
     c                   eval      d_gdat = %subst(d_gdat:9:2) +
     c                                      %subst(d_gdat:4:2) +
     c                                      %subst(d_gdat:1:2)
     c                   movel     d_gdat        w_amdedat
     c                   endif
     c                   if        w_amdedat <> *zero
     c     *ymd          move      w_amdedat     w_gdat
     c                   else
     c                   eval      w_gdat = *loval
     c                   endif
      *
     c                   move      d_renk        rkrenk
     c                   move      d_purr        rkpurr
     c                   move      d_slgr        rkslgr
     c                   move      d_dist        rkdist
     c                   move      d_avde        rkavde
     c                   move      d_lagr        rklagr
     c                   move      d_spl1        rkspl1
     c                   move      d_spl2        rkspl2
     c                   move      d_spl3        rkspl3
     c                   move      d_spl4        rkspl4
     c                   move      d_spl5        rkspl5
     c                   move      d_kgrk        rkkgrk
     c                   move      d_ebiz        rkebiz
      *
     c*                  if        not %found(rkunlu)
     c                   time                    rkndat
     c                   time                    rkntim
     c                   eval      rknsig = %trim(l_user) + '_x'
     c*                  endif
     c                   eval      d_edat = %subst(d_edat:3:2) +
     c                                      %subst(d_edat:6:2) +
     c                                      %subst(d_edat:9:2)
     c                   movel     d_edat        w_amdedat
     c                   time                    rkedat
     c                   time                    rketim
     c                   eval      rkesig = %trim(l_user) + '_x'
     c                   eval      rkepgm = 'NYKUNDEXL'
     c                   time                    rk2dpt
      *
     c*                  if        %found(rkunlu)
     c                   update    rkunlur
     c*                  else
     c*                  time                    rkndat
     c*                  time                    rkntim
     c*                  write     rkunlur
      *  Opprette - RKMEPF
     c*                  move      rkunlu_firm   p_firm
     c*                  move      rkunlu_kund   p_kund
     c*                  call      'FO763R'
     c*                  parm                    p_firm
     c*                  parm                    p_kund
      *
     c*                  endif
      *
     c                   eval      rkbplu_firm = rkfirm
     c                   eval      rkbplu_kund = rkkund
     c     rkbplu_key    chain     rkbplu
     c                   eval      rkogrn = w_ogrn
     c                   eval      rktgrn = w_tgrn
     c                   eval      rkgdat = w_gdat
     c                   eval      rkbous = rknsig
     c                   eval      rkbeus = rkesig
     c                   eval      rkboda = rkndat
     c                   eval      rkboti = rkntim
     c                   eval      rkbeda = rkedat
     c                   eval      rkbeti = rketim
     c                   if        %found(rkbplu)
     c                   update    rkbplur
     c                   else
     c*                  eval      rkbfir = rkfirm
     c*                  eval      rkbkun = rkkund
     c*                  write     rkbplur
     c                   endif
      *
     c                   endif
      *
     c                   goto      end
      *
      *  Kontaktperson
      *
      *  Faktura epost <> blank + Rolle EMAIL1
     c*                  if        d_kmal <> *blank
     c*                  eval      rukplu_firm = *zero
     c*                  move      d_kund        rukplu_kund
     c*                  eval      rukplu_kpnr = 1
     c*    rukplu_key    chain     rukplur
     c*                  dow       %found(rukplu)
     c*                  if        rukrol = 'EMAIL1'
     c*                  goto      noemail1
     c*                  endif
     c*                  eval      rukplu_kpnr = rukplu_kpnr + 1
     c*    rukplu_key    chain     rukplu
     c*                  enddo
     c*                  clear                   rukplur
     c*                  eval      rufirm = rukplu_firm
     c*                  eval      rukund = rukplu_kund
     c*                  eval      rulevr = *zero
     c*                  eval      rukpnr = rukplu_kpnr
      *
     c*                  movel     w_kper        ruenav
     c*                  move      *blank        rufnav
     c*                  eval      rualfa = ruenav + ' ' + %trim(rufnav)
     c*                  eval      rumail = d_kmal
     c*                  eval      rukrol = 'EMAIL1'
      *
     c*                  eval      ruousr = l_user
     c*                  time                    ruodat
     c*                  time                    ruotim
     c*                  eval      rueusr = l_user
     c*                  time                    ruedat
     c*                  time                    ruetim
      *
     c*                  write     rukplur
     c*                  endif
     c*    noemail1      tag
      *
      *  Byggdok
      *
     c*                  if        d_bygd = 'true'
     c*                            and d_kepo <> *blank
     c*                  eval      rukplu_firm = *zero
     c*                  move      d_kund        rukplu_kund
     c*                  eval      rukplu_kpnr = 1
     c*    rukplu_key    chain     rukplur
     c*                  dow       %found(rukplu)
     c*                  if        rukrol = 'BYGGDOK'
     c*                  goto      nobyggdo
     c*                  endif
     c*                  eval      rukplu_kpnr = rukplu_kpnr + 1
     c*    rukplu_key    chain     rukplu
     c*                  enddo
     c*                  clear                   rukplur
     c*                  eval      rufirm = rukplu_firm
     c*                  eval      rukund = rukplu_kund
     c*                  eval      rulevr = *zero
     c*                  eval      rukpnr = rukplu_kpnr
      *
     c*                  movel     w_kper        ruenav
     c*                  move      *blank        rufnav
     c*                  eval      rualfa = ruenav + ' ' + %trim(rufnav)
     c*                  eval      rumail = d_kepo
     c*                  eval      rukrol = 'BYGGDOK'
      *
     c*                  eval      ruousr = l_user
     c*                  time                    ruodat
     c*                  time                    ruotim
     c*                  eval      rueusr = l_user
     c*                  time                    ruedat
     c*                  time                    ruetim
      *
     c*                  write     rukplur
     c*                  endif
     c*    nobyggdo      tag
      *
     c     end           tag
      *
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Subrutine for initiering av program
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *
     c     *inzsr        begsr
      *
     c*    *entry        plist
     c*                  parm                    p_knradd
      *
      * Key for posisjonering på prosjekt
      *
     c     rkunlu_key    klist
     c                   kfld                    rkunlu_firm
     c                   kfld                    rkunlu_kund
      *
     c     rkunl4_key    klist
     c                   kfld                    rkunl4_firm
     c                   kfld                    rkunl4_ftnr
      *
     c*    rukplu_key    klist
     c*                  kfld                    rukplu_firm
     c*                  kfld                    rukplu_kund
     c*                  kfld                    rukplu_levr
     c*                  kfld                    rukplu_kpnr
      *
     c     rkbplu_key    klist
     c                   kfld                    rkbplu_firm
     c                   kfld                    rkbplu_kund
      *
     c                   endsr
