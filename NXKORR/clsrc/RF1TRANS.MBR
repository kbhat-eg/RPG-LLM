/*-------------------------------------------------------------------*/
             pgm        parm(&syst)

             dcl        var(&fgrp)  type(*char) len(3)
             dcl        var(&syst)  type(*char) len(4)
             dcl        var(&ffir)  type(*char) len(3)
             dcl        var(&user)  type(*char) len(10)
             dcl        var(&wali)  type(*dec)  len(2 0)
             dcl        var(&wapo)  type(*dec)  len(2 0)
             dcl        var(&mld1)  type(*char) len(40)
             dcl        var(&mld2)  type(*char) len(40)
             dcl        var(&memb)  type(*char) len(10)
             dcl        var(&wplib) type(*char) len(8)

             dcl        var(&valg)  type(*dec)  len(2 0) value(0)
             dcl        var(&valgc) type(*char) len(2)
             dcl        var(&nxdr)  type(*dec)  len(1 0) value(0)
             dcl        var(&recs)  type(*dec)  len(10 0)

             dcl        var(&bpro)  type(*char) len(7)
             dcl        var(&fpro)  type(*char) len(7)
             dcl        var(&lpro)  type(*char) len(7)

/* Henter verdier i fra LDA.                                         */

             rtvdtaara  dtaara(*lda (944 03)) rtnvar(&ffir)
             rtvdtaara  dtaara(*lda (931 03)) rtnvar(&fgrp)
             rtvdtaara  dtaara(*lda (911 10)) rtnvar(&user)

             chgvar     var(%sst(&memb 1 4))  value(&syst)
             chgvar     var(%sst(&memb 5 3))  value(&ffir)

/* Sjekk hvilke økonomisystem som skal oppdateres                   */

             call       pgm(rom01r)  parm(&valg)
             call       pgm(rv015r)  parm(&nxdr)
             chgvar     var(&valgc)  value(&valg)

/* Overføring av poster fra ORDRE                                    */

             if         cond(&syst *eq 'FAKT') then(do)
/*Finnes poster*/
                chkobj     obj(*libl/fovfpf) objtype(*file) mbr(*first)
                monmsg     msgid(cpf9815) exec(do)
                   chgvar     var(&mld1) value('Ingen poster fra ordre   ')
                   goto       cmdlbl(notrans)
                enddo
                rtvmbrd    file(*libl/fovfpf) nbrcurrcd(&recs)
                if         cond(&recs *eq 0) then(do)
                   chgvar     var(&mld1) value('Ingen poster fra ordre   ')
                   goto       cmdlbl(notrans)
                enddo

/*Eksternt økonomisystem*/
                if         cond(&valg *gt 0) then(do)
                   chgvar     var(&fpro) value('ROMF' *cat &valgc *cat 'C')

                   chkobj     obj(*libl/&fpro) objtype(*pgm)
                   monmsg     msgid(cpf9801) exec(do)
                      call       pgm(AA011C) parm(6 5 'Program for overf. +
                                 finnes ikke på systemet. Kontakt EG')
                      goto       cmdlbl(endpgm)
                   enddo
                call       pgm(&fpro)
                enddo

/* Oppdatere Nexstep*/
             if         cond(&nxdr *eq 0) then(do)
                call       pgm(RFA15R)  parm(&memb)
             enddo

/*Avslutter oppdatering*/
             clrpfm     file(*libl/fovfpf) mbr(*first)
             monmsg     msgid(cpf3200)
             goto       cmdlbl(endpgm)
             enddo

/* Overføring av poster fra BUTIKK                                   */

             if         cond(&syst *eq 'SHOP') then(do)
/*Finnes poster*/
                chkobj     obj(*libl/bovfpf) objtype(*file) mbr(*first)
                monmsg     msgid(cpf9815) exec(do)
                   chgvar     var(&mld1) value('Ingen poster fra butikk  ')
                   goto       cmdlbl(notrans)
                enddo
                rtvmbrd    file(*libl/bovfpf) nbrcurrcd(&recs)
                if         cond(&recs *eq 0) then(do)
                   chgvar     var(&mld1) value('Ingen poster fra butikk  ')
                   goto       cmdlbl(notrans)
                enddo

/*Eksternt økonomisystem*/
                if         cond(&valg *gt 0) then(do)
                   chgvar     var(&bpro) value('ROMB' *cat &valgc *cat 'C')

                   chkobj     obj(*libl/&bpro) objtype(*pgm)
                   monmsg     msgid(cpf9801) exec(do)
                      call       pgm(AA011C) parm(6 5 'Program for overf. +
                                 finnes ikke på systemet. Kontakt EG')
                      goto       cmdlbl(endpgm)
                   enddo
                   call       pgm(&bpro)
                enddo

/* Oppdatere Nexstep*/
                if         cond(&nxdr *eq 0) then(do)
                   call       pgm(RFB15R)  parm(&memb)
                enddo

/*Avslutter oppdatering*/
                clrpfm     file(*libl/bovfpf) mbr(*first)
                monmsg     msgid(cpf3200)
                goto       cmdlbl(endpgm)
             enddo

/* Overføring av poster fra INNKJØP                                  */

             if         cond(&syst *eq 'LAGR') then(do)
/*Finnes poster*/
                chkobj     obj(*libl/lovfpf) objtype(*file) mbr(*first)
                monmsg     msgid(cpf9815) exec(do)
                   chgvar     var(&mld1) value('Ingen poster fra innkjøp ')
                   goto       cmdlbl(notrans)
                enddo
                rtvmbrd    file(*libl/lovfpf) nbrcurrcd(&recs)
                if         cond(&recs *eq 0) then(do)
                   chgvar     var(&mld1) value('Ingen poster fra innkjøp ')
                   goto       cmdlbl(notrans)
                enddo

/*Eksternt økonomisystem*/
                if         cond(&valg *gt 0) then(do)
                   chgvar     var(&lpro) value('ROML' *cat &valgc *cat 'C')

                   chkobj     obj(*libl/&lpro) objtype(*pgm)
                   monmsg     msgid(cpf9801) exec(do)
                      call       pgm(AA011C) parm(6 5 'Program for overf. +
                                 finnes ikke på systemet. Kontakt EG')
                      goto       cmdlbl(endpgm)
                   enddo
                   call       pgm(&lpro)
                enddo

/* Oppdatere Nexstep*/
                if         cond(&nxdr *eq 0) then(do)
                   call       pgm(RFI15R)  parm(&memb)
                enddo

/*Avslutter oppdatering*/
                clrpfm     file(*libl/lovfpf) mbr(*first)
                monmsg     msgid(cpf3200)
                goto       cmdlbl(endpgm)
             enddo

/* Denne overføring er ikke spesifisert                              */

             chgvar     var(&wali) value(10)
             chgvar     var(&wapo) value(26)
             chgvar     var(&mld1) value('Denne type overføring er ')
             chgvar     var(&mld2) value('ikke definert i RF1TRANS ')
             chgvar     var(&wali) value(10)
             chgvar     var(&wapo) value(26)
             call       pgm(aa006c)  parm(&wali &wapo &mld1 &mld2)
             dlyjob     dly(3)
             goto       cmdlbl(endpgm)


/* Ingen posteringstranser fubbet - rutinen avsluttes                */
 notrans:
             chgvar     var(&wali) value(10)
             chgvar     var(&wapo) value(26)
             chgvar     var(&mld2) value('rutinen avsluttes ...... ')
             call       pgm(aa006c)  parm(&wali &wapo &mld1 &mld2)
             dlyjob     dly(3)

 endpgm:     endpgm
