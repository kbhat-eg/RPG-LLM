/* 04.05.11 NHO Sjekk om jobb er i bruk fra register RJOBPF          */
/*6.30    11.10.16 NHO User må angis til 10 posisjoner               */
/*                                                                   */
/* 8.01 090924 bsa Sender mail                                       */
/*                                                                   */
/*                                                                   */
/*-------------------------------------------------------------------*/

             PGM        PARM(&SYST)

/*8.01*/     DCL        VAR(&WKOD)     TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&SYST) TYPE(*CHAR) LEN(4)
             DCL        VAR(&FFIR)  TYPE(*CHAR) LEN(3)
             DCL        VAR(&USER) TYPE(*CHAR) LEN(10)
             DCL        VAR(&WALI) TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&WAPO) TYPE(*DEC)  LEN(2 0)
             DCL        VAR(&MLD1) TYPE(*CHAR) LEN(40)
             DCL        VAR(&MLD2) TYPE(*CHAR) LEN(40)
             DCL        VAR(&MEMB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&BTCH)  TYPE(*CHAR) LEN(1)

             DCL        VAR(&INFO)  TYPE(*CHAR) LEN(1)
             DCL        VAR(&Ms1)   TYPE(*CHAR) LEN(50)
             DCL        VAR(&Ms2)   TYPE(*CHAR) LEN(50)
             DCL        VAR(&sv)    TYPE(*CHAR) LEN(1)
             DCL        VAR(&f3)    TYPE(*DEC)  LEN(1 0)
             dcl        var(&msg)   type(*char) len(100)
             dcl        var(&mj)    type(*char) len(3)
             dcl        var(&mi)    type(*dec)  len(3 0) value(0)

             RTVDTAARA  DTAARA(*LDA (911 10)) RTNVAR(&USER)
             RTVDTAARA  DTAARA(*LDA (863 1))  RTNVAR(&BTCH)
             rtvjoba    type(&btch)

/* Sjekk om bilagsregistrering eller overføring fra delsystem        */

             IF         COND(&SYST *EQ 'BRUK') THEN(DO)
/*           CHGVAR     VAR(%SST(&MEMB 1 7)) VALUE(&USER)            */
             CHGVAR     VAR(%SST(&MEMB 1 10)) VALUE(&USER)
             ENDDO

             IF         COND(&SYST *NE 'BRUK') THEN(DO)
             RTVDTAARA  DTAARA(*LDA (944 03)) RTNVAR(&FFIR)
             CHGVAR     VAR(%SST(&MEMB 1 4))  VALUE(&SYST)
             CHGVAR     VAR(%SST(&MEMB 5 3))  VALUE(&FFIR)
             ENDDO

/* Sjekk jobbregister                                                */
             CALL       PGM(RJ001R)    PARM(&MEMB &INFO)

             IF         COND(&INFO *EQ '2') THEN(DO)
             if         cond(&btch *eq '1') then(do)
               CHGVAR     VAR(&WALI) VALUE(10)
               CHGVAR     VAR(&WAPO) VALUE(26)
               CHGVAR     VAR(&MS1)  VALUE('Rutinen er i bruk....... ')
               CHGVAR     VAR(&MS2)  VALUE('Rutinen avsluttes ...... ')
               CALL       PGM(AA007R)  PARM(&MS1 &MS2 &SV &F3)
               enddo
             else do
               chgvar   var(&msg)   value('Økonomi Oppdatering, Rutinen +
                                           er i bruk,  avsluttes')
               CallSubr subr(melding)
/*8.01*/       chgvar     var(&wkod) value(3)
/*8.01*/       call       pgm(bo132r)  parm(&wkod)
             enddo
             GOTO       CMDLBL(ENDPGM)
             ENDDO

/* Varselbilde 1                                                     */

             if         cond(&syst *ne 'FAKT' *and +
                             &syst *ne 'SHOP' *and +
                             &syst *ne 'LAGR') then(do)
               IF         COND(&BTCH *eq '1') THEN(DO)
                 CHGVAR     VAR(&WALI) VALUE(4)
                 CHGVAR     VAR(&WAPO) VALUE(2)
                 CHGVAR     VAR(&MLD1) VALUE('J O U R N A L - L I S T E  ')
                 CHGVAR     VAR(&MLD2) VALUE('*************************  ')
                 CALL       PGM(AA006C)  PARM(&WALI &WAPO &MLD1 &MLD2)
               ENDDO
             enddo
/* Call av utskriftsprogram                                          */

             CALL       PGM(RF1VALJO) PARM(&MEMB)
/* ______________________________________________________________________*/
Subr         Subr(Melding)
             chgvar     var(&mi)              value(&mi + 1)
             chgvar     var(&mj)              value(&mi)
             call       pgm(egd97c) parm+
                        ('Dagsoppgj.' +
                         'RF1Journ  ' +
                         &mj +
                         &msg)
EndSubr

 ENDPGM:     ENDPGM
