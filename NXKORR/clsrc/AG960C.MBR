             pgm        parm(&serv &valg &vers &table &sqldef)

/*--------------------------------------------------------------------------*/
/* 8.xx 180925  bsa Nytt program                                            */
/*                                                                          */
/*                  Programmet gjør endringer i trigger/views/sqlinder      */
/*                  ut fra hva valg parameter innholder                     */
/*                  Programmet får inn en parameter for hva                 */
/*                     &valg                                                */
/*                      S1 :  legg inn views                                */
/*                      S2 :  slett og legg inn views                       */
/*                      S3 :  legg inn index                                */
/*                      S4 :  slett og legg inn index                       */
/*                      S7 :  sletter triggere                              */
/*                      S8 :  oppdater inn trigger                          */
/*                      S9 :  slett og legg inn trigger                     */
/*                                                                          */
/*                      D1:   Oppdatere database tabeller                   */
/*                                                                          */
/* call ag960c parm('server' 'valg' 'versjon av script' 'tabell' 'sqldef')  */
/*                                                                          */
/*8.01 240925 bsa Legger til parameter om SQLDEF skal kjøres.               */
/*                                                                          */
/*                                                                          */
/*                                                                          */
/*--------------------------------------------------------------------------*/

             dcl        var(&valg) type(*char) len(2)
             dcl        var(&vers) type(*char) len(3)
             dcl        var(&serv) type(*char) len(10)
             dcl        var(&lvr) type(*char) len(10) value(' ')
             dcl        var(&table) type(*char) len(10)
             dcl        var(&job)  type(*char) len(10) value('AG961')
             dcl        var(&user) type(*char) len(10)
/*8.01*/     dcl        var(&sqldef) type(*char) len(1)
             dclf       file(ADB/AFGRST)

/* Kjører SQLDEF for å oppdatere trigger script                             */
/*8.01*/     if         cond(&sqldef *eq '1') then(do)
             call       pgm(sqldef)
/*8.01*/     enddo

             rtvjoba    user(&user)


rcvf:        rcvf
             monmsg     msgid(cpf0864)  exec(goto cmdlbl(end))

             if         cond(&afgsrv *ne &serv) then(do)
               goto     cmdlbl(rcvf)
             enddo

             if         cond(&afgakt *ne 1) then(do)
               goto     cmdlbl(rcvf)
             enddo

             if         cond(&afgver *ne &vers) then(do)
               goto     cmdlbl(rcvf)
             enddo

/*Eks på utelatelse                                       */
             if         cond(&afgfgr *eq 'NXC') then(do)
               goto     cmdlbl(rcvf)
             enddo

             chgvar     var(%sst(&job  6 3)) value(&afgfgr)

            sbmjob cmd(call pgm(ag961c) parm(&afgmil +
                   &afgfgr &lvr &table &valg &vers)) +
                   JOBPTY(3) JOBQ(QGPL/EG_SQL) JOB(&job)  +
                   CCSID(277) USER(&user)

/*          call pgm(ag961c) parm(&afgmil +               */
/*                 &afgfgr &lvr &table &valg &vers)       */

            goto       cmdlbl(rcvf)

END:        endpgm

